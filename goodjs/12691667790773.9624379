twttr=window.twttr||{},twttr.conversion=function(){function n(t,n){function i(){try{a.doScroll("left")}catch(e){return void setTimeout(i,50)}f("poll")}var r=!1,e=!0,o=t.document,a=o.documentElement,s=o.addEventListener,u=s?"addEventListener":"attachEvent",c=s?"removeEventListener":"detachEvent",d=s?"":"on",f=function(e){"readystatechange"===e.type&&"complete"!==o.readyState||(("load"===e.type?t:o)[c](d+e.type,f,!1),!r&&(r=!0)&&n.call(t,e.type||e))};if("complete"===o.readyState)n.call(t,"lazy");else{if(!s&&a.doScroll){try{e=!t.frameElement}catch(t){}e&&i()}o[u](d+"DOMContentLoaded",f,!1),t[u](d+"load",f,!1)}}function t(){this.pixelId="",this.eventQueue=[[]]}function i(e,t){var n,i=t.toLowerCase();for(n in e)if(n.toLowerCase()===i&&e.hasOwnProperty(n))return 1}function r(e,t){var n,i=t.toLowerCase();for(n in e)if(n.toLowerCase()===i&&e.hasOwnProperty(n))return e[n]}var o="//t.co/i/adsct?type=javascript&version=1.1.0&p_id=Twitter&p_user_id=0",a="https://analytics.twitter.com/i/adsct?type=javascript&version=1.1.0&p_id=Twitter&p_user_id=0";return t.prototype={setPixelId:function(e){this.pixelId=e},queueEvent:function(e,t){var n=this;e="function"!=typeof String.prototype.trim?e.toLowerCase().replace(/^\s+|\s+$/g,""):e.toLowerCase().trim(),n.eventQueue[n.eventQueue.length-1].push({event:[e,t],pixelId:n.pixelId}),setTimeout(function(){n.sendEvents()},0)},addFlushPoint:function(){var e=this;0!==e.eventQueue[e.eventQueue.length-1].length&&e.eventQueue.push([])},sendEventsWithParams:function(e,t){var n=this.getLegacyParams(e);n.events=this.stringifyObject(e),twttr.conversion.trackPid(t,n)},sendEvents:function(){var e=this;if(0!==e.eventQueue[0].length){var t=e.eventQueue.shift();0===e.eventQueue.length&&e.eventQueue.push([]);for(var n=0;n<t.length;n++)e.sendEventsWithParams([t[n].event],t[n].pixelId)}},getLegacyParams:function(e){var t={},e=this.isObject(e[0])?e[0]:{},e=this.isObject(e[1])?e[1]:{};return i(e,"value")&&(t.tw_sale_amount=r(e,"value")),i(e,"num_items")&&(t.tw_order_quantity=r(e,"num_items")),this.isObject(r(e,"content_ids"))&&(t.tw_product_id=r(e,"content_ids")[0]),i(e,"partner_id")&&(t.oct_p_id=r(e,"partner_id")),t},stringifyObject:function(e){return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify?JSON.stringify(e):""},isObject:function(e){return Object(e)===e}},function(){if(window.twq){var i=new t;twq.exe=function(){var e,t=Array.prototype.slice.call(arguments),n=t[0],t=t.slice(1);switch(n){case"init":e=i.setPixelId;break;case"track":e=i.queueEvent;break;case"new_event":e=i.addFlushPoint}"function"==typeof e&&e.apply(i,t)};for(var e=0;e<twq.queue.length;e++)twq.exe.apply(null,twq.queue[e])}}(),{trackBase:function(e,t,n,i){"string"==typeof t&&"string"==typeof n&&(t=e+"&merch_id="+encodeURIComponent(t),t+="&event="+encodeURIComponent(n),void 0!==i&&(t+="&value="+encodeURIComponent(i)),this.buildPixel(t))},trackPidBase:function(e,t,n,i){if(t){var r="";if("object"==typeof n)for(var o in"tw_sale_amount"in n||(n.tw_sale_amount=0),"tw_order_quantity"in n||(n.tw_order_quantity=0),n)n.hasOwnProperty(o)&&(r+="&"+encodeURIComponent(o)+"="+encodeURIComponent(n[o]));else r="&tw_sale_amount=0&tw_order_quantity=0";e=e+"&txn_id="+encodeURIComponent(t)+r,t=this.getIframeStatus();e+="&tw_iframe_status="+encodeURIComponent(t.value),t===this.IframeStatusCodes.IN_IFRAME&&""!=document.referrer&&(e+="&tw_document_referrer="+encodeURIComponent(document.referrer));t=this.buildPixel;i&&(e+="&tpx_cb=twttr.conversion.loadPixels",t=this.buildScript),e+="&tw_document_href="+encodeURIComponent(document.location.href);i=this.getHiddenProp();this.isDocumentHidden()?this.buildPixelWhenVizChange(e,i,t):t(e)}},track:function(e,t,n){this.trackBase(a,e,t,n),this.trackBase(o,e,t,n)},trackPid:function(e,t){this.trackPidBase(a,e,t,!0),this.trackPidBase(o,e,t)},buildScript:function(e){var t=document.createElement("script");t.src=e,t.setAttribute("type","text/javascript"),n(window,function(){document.body.appendChild(t)})},cs:!0,buildIframe:function(e){var t;twttr.conversion.cs&&(twttr.conversion.cs=!1,(t=document.createElement("iframe")).src=e,t.hidden=!0,n(window,function(){document.body.appendChild(t)}))},buildPixel:function(e){(new Image).src=e},isDocumentHidden:function(){var e=this.getHiddenProp();return e&&document[e]},getHiddenProp:function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null},buildPixelWhenVizChange:function(e,t,n){var i=t.replace(/[H|h]idden/,"")+"visibilitychange",r=function(){n(e),document.removeEventListener(i,r,!1)}.bind(this);document.addEventListener(i,r,!1)},getIframeStatus:function(){try{return this.isIframed()?this.IframeStatusCodes.IN_IFRAME:this.IframeStatusCodes.NOT_IN_IFRAME}catch(e){return this.IframeStatusCodes.ERROR}},isIframed:function(){return window.self!==window.top},IframeStatusCodes:{NOT_IN_IFRAME:{value:0},IN_IFRAME:{value:1},ERROR:{value:2}},loadPixels:function(e){"hif"in e&&e.hif.forEach(twttr.conversion.buildIframe),"tags"in e&&e.tags.forEach(twttr.conversion.buildPixel)}}}();
