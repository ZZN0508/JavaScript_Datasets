define(function(){"use strict";if(void 0===window.bbcdotcom||void 0===bbcdotcom.objects)return{addEventListeners:function(){},callback:function(){},trackEvent:function(){}};function i(a,e){var t,i;e.flags.previewPlaying||(t=bbcdotcom.config.isContinuousPlayPage()&&0!==l.length?(i=Number(document.getElementsByClassName("vxp-carousel__item--selected")[0].getAttribute("data-index")),{vpid:(i=l[i].media).externalId,title:i.altText,duration:i.duration,counterName:i.istatsCounterName}):{vpid:(i=(t=e.player.settings()).playlistObject.items[t.playlistObject.items.length-1]).vpid,title:t.playlistObject.title,duration:i.duration,counterName:t.counterName},bbcdotcom.pubsub.trigger(a,t))}function s(a){var e;"undefined"!=typeof COMSCORE&&(e=bbcdotcom.objects("bbcdotcom.sections")?bbcdotcom.sections.getSection():"other",COMSCORE.beacon({c1:1,c2:"6035051",c3:e,c4:"",c5:"ad"===a?"09":"02",c6:"",c15:""}))}function n(a){a.flags.playlistStarted||(a.flags.playlistStarted=!0,o("startPlaylist",a))}var d=[],l=[],r=function(a){var e=a.player.settings();e.playlistObject.items[e.playlistObject.items.length-1];a.data.mediaType=a.player.kind(),a.data.mediaOffset=a.player.currentTime(),a.data.mediaLength=a.player.duration(),a.data.mediaPlayerName=a.player.name(),a.data.adId=null,a.data.mediaId=bbcdotcom.objects("settings.container.0.id")},o=function(a,e,t){if(void 0===bbcdotcom.analytics)return!1;r(e),!0===t&&(e.data.mediaOffset=0),bbcdotcom.analytics[a](e.data)};return bbcdotcom.objects("bbcdotcom.av.emp.analytics","create"),bbcdotcom.av.emp.analytics={addEventListeners:function(a){var e;if(void 0!==a){for(e=0;e<d.length;e++)if(d[e].player===a)return;var t={player:a,data:{videoPlaysAutomatically:!0,bumpVersion:a.bumpVersion},flags:{playlistStarted:!1,programStarted:!1,isPaused:!1,isSeeking:!1,adRequestOrPlaybackInProgress:!1,ended:!1,playlistEnded:!1,trackProgramStartOnNextTimeupdate:!1,previewPlaying:!1}};d.push(t),bbcdotcom.config.isContinuousPlayPage()&&1===document.getElementsByClassName("vxp-playlist-data").length&&(l=JSON.parse(document.getElementsByClassName("vxp-playlist-data")[0].innerHTML||"[]")),t.player.bind("playlistLoading",function(a){}),t.player.bind("playlistLoaded",function(a){var e;(e=t).data={videoPlaysAutomatically:!0,adLength:0},e.flags.receivedDuration=!1,e.flags.playlistStarted=!1,e.flags.programStarted=!1,e.flags.isPaused=!1,e.flags.isSeeking=!1,e.flags.adRequestOrPlaybackInProgress=!1,e.flags.ended=!1,e.flags.playlistEnded=!1,e.flags.trackProgramStartOnNextTimeupdate=!1,e.flags.previewPlaying=!1,t.data.mediaName=a.playlist.title,t.data.hasAds=a.playlist.hasAds||a.playlist.hasAdvert||!1,e=a,bbcdotcom.config.isContinuousPlayPage()&&0!==l.length&&(e=e.url?Number(e.url.replace("playlist_","")):Number(document.getElementsByClassName("vxp-carousel__item--selected")[0].getAttribute("data-index")),(e=l[e].advert.adCampaignKeyword)!==bbcdotcom.adverts.keyValues.get("keyword")&&(""===e||null==e?bbcdotcom.adverts.keyValues.unset("keyword"):bbcdotcom.adverts.keyValues.set("keyword",e)));a=a.playlist.items;t.data.isLive=a[a.length-1].live,t.data.kind=a[a.length-1].kind}),t.player.bind("userPlay",function(a){t.data.videoPlaysAutomatically=!1,i("userPlay",t)}),t.player.bind("playing",function(a){n(t),t.flags.programStarted||t.flags.adRequestOrPlaybackInProgress||(t.flags.programStarted=!0,o("startProgramme",t,!0),i("startProgramme",t),s(),!0===t.flags.previewPlaying&&(t.flags.programStarted=!1)),t.flags.isPaused&&(t.flags.isPaused=!1,o("endPause",t))}),t.player.bind("pause",function(a){r(t),t.data.mediaOffset+1<t.data.mediaLength&&(t.flags.isPaused=!0,o("startPause",t))}),t.player.bind("loadedmetadata",function(a){t.flags.receivedDuration=!0,o("duration",t)}),t.player.bind("timeupdate",function(a){t.flags.receivedDuration||(t.flags.receivedDuration=!0,o("duration",t)),t.flags.isSeeking&&(t.flags.isSeeking=!1,o("endSeek",t))}),t.player.bind("seeking",function(a){t.flags.isSeeking=!0,o("startSeek",t)}),t.player.bind("ended",function(a){t.flags.ended=!0,o("endProgramme",t),i("endProgramme",t),t.flags.playlistEnded&&o("endPlaylist",t)}),t.player.bind("playlistEnded",function(a){t.flags.playlistEnded=!0,t.flags.ended&&o("endPlaylist",t)}),t.player.bind("uiinfo",function(a){t.data.uiinfo=a,o("uiinfo",t)}),t.player.bind("volumechange",function(a){t.data.volume=a.volume,o("volumeChange",t)}),t.player.bind("bbc.smp.plugins.ads.event.AdsPluginExternalEvent.ALL_ADS_COMPLETED",function(a){t.flags.adRequestOrPlaybackInProgress=!1}),t.player.bind("adsPlugin",function(a){switch(a.id){case"adRequest":t.flags.adRequestOrPlaybackInProgress=!0,n(t),o("adRequest",t);break;case"adManagerLoaded":o("adManagerLoaded",t);break;case"adEnded":t.flags.adRequestOrPlaybackInProgress=!1,o("endAdvert",t);break;case"adStarted":n(t),o("startAdvert",t),s("ad");break;case"adError":t.flags.adRequestOrPlaybackInProgress=!1;break;case"adDuration":t.data.adLength=1e3*a.duration}}),t.player.bind("bbc.smp.plugins.preview",function(a){switch(a.id){case"start":t.flags.previewPlaying=!0,o("startPreview",t);break;case"user_stop":case"complete_stop":case"scroll_stop":case"error_stop":t.flags.previewPlaying=!1,t.data.previewStoppedReason=a.id,o("endProgramme",t),o("stopPreview",t)}})}},callback:o,trackEvent:function(a,e){if(void 0===bbcdotcom.analytics)return!1;var t,i={},s=d[0];for(t in r(s),s.data)i[t]=s.data[t];if("object"==typeof e)for(t in e)i[t]=e[t];bbcdotcom.analytics.trackEvent(a,i)}},bbcdotcom.av.emp.analytics});
