var SuggestServer=function(){this._stringOriginalUrl="http://suggest3.sinajs.cn/suggest/type=@TYPE@&key=@KEY@&name=@NAME@",this._stringUrl="",this._elementScriptLoader=null,this._elementContainer=null,this._stringOriginalValue="",this._stringLastValue="",this._functionCallback=null,this._elementLineCurrent=null,this._objectHtml={},this._objectData={},this._booleanHideDelay=!1,this._stringBrowserType="",this._objectType={11:"A 股",12:"B 股",13:"权证",14:"期货",15:"债券",21:"开基",22:"ETF",23:"LOF",24:"货基",25:"QDII",26:"封基",31:"港股",32:"窝轮",33:"港指数",41:"美股",42:"外期",81:"债券",82:"债券"},this._objectConfig={input:null,loader:null,value:null,default:null,type:0,max:10,width:220,link:null,target:"_blank",head:["选项","代码","名称"],body:[-1,2,4],fix:{firefox:[1,1]},onshow:function(){},onhide:function(){},hideSelectForIE6:!1,callback:null},this._getElement=function(e){return document.getElementById(e)},this._getRandom=function(){return(new Date).getTime()},this._bind=function(i,n){var s=this;return function(){var e,t=null;if(void 0!==n){for(e=0;e<arguments.length;e++)n.push(arguments[e]);t=n}else t=arguments;return i.apply(s,t)}},this._aevent=function(e,t,i){window.addEventListener?e.addEventListener(t,i,!1):window.attachEvent&&e.attachEvent("on"+t,i)},this._position=function(){for(var e,t,i,n=0,s=0,o=this._elementInput;n+=o.offsetTop||0,s+=o.offsetLeft||0,"relative"==o.style.position&&(o=o.offsetParent););i=[+this._elementInput.parentNode.style.borderTopWidth.replace("px",""),+this._elementInput.parentNode.style.borderLeftWidth.replace("px","")],__arrayPositionFix=[0,0],this._elementContainer.style.top!=n+"px"&&(this._elementContainer.style.top=n-i[0]+__arrayPositionFix[0]+"px"),this._elementContainer.style.left!=s+"px"&&(this._elementContainer.style.left=s-i[1]+__arrayPositionFix[1]+"px"),e=this._elementInput.style.borderTopWidth,t=this._elementInput.style.borderBottomWidth,i=this._elementInput.clientHeight,i+=""!=e?+e.replace("px",""):2,i+=""!=t?+t.replace("px",""):2,this._elementContainer.style.marginTop!=i+"px"&&(this._elementContainer.style.marginTop=i+"px")},this._getType=function(e){return{1:"stock",2:"fund",3:"hk",4:"us"}[e.substr(0,1)]},this._fill=function(){var e,t,i,n,s,o,l,a,h,r=this._elementInput.value;if("key_"+r in this._objectData&&""!=this._objectData["key_"+r]){if(null==this._elementContainer&&(this._elementContainer=document.createElement("div"),this._elementContainer.style.cssText+="display:none; filter:alpha(opacity=95); opacity:0.95; position:absolute; width:"+this._objectConfig.width+"px; z-index:999;",this._elementInput.parentNode.insertBefore(this._elementContainer,this._elementInput),this._elementContainer.suggest=this),this._position(),e="",e+='<table style="border-collapse:collapse; line-height:18px; border:2px solid #EEE; background-color:#FFF; font-size:12px; text-align:center; color:#999; width:'+(this._objectConfig.width-2)+'px;">',null!=this._objectConfig.head){for(t in e+='<tr style="background-color:#F3F3F3;">',this._objectConfig.head)this._objectConfig.head.hasOwnProperty(t)&&(e+="<td>"+this._objectConfig.head[t]+"</td>");e+="</tr>"}for(n=(i=(this._objectData["key_"+r]||"").replace(/&amp;/g,"&").replace(/;$/,"").split(";")).length>this._objectConfig.max?this._objectConfig.max:i.length,s="parentNode.parentNode.parentNode['suggest']",t=0;t<n;t++){if((o=i[t].split(","))[-1]=o[0].replace(new RegExp(r.toLowerCase().replace(/(^\s*)|(\s*$)/g,"").replace(/\./g,function(e){return"\\"+e}),"gi"),function(e){return'<span style="color:#F00;">'+e+"</span>"}),o[-2]=o[1]in this._objectType?this._objectType[o[1]]:"——",null==this._objectConfig.link||""==this._objectConfig.link)l=['<td style="padding:0px;"><span style="display:block; padding:1px;">',"</span></td>"];else{for(h in a=this._objectConfig.link.replace(/@type@/g,this._getType(o[1])||o[1]).replace(/@code@/g,this._getFullCode(o)),o)o.hasOwnProperty(h)&&(a=a.replace(new RegExp("@"+h+"@","g"),o[h]));l=['<td style="padding:0px;"><a href="'+a+'" hidefocus="true" onmousedown="return this.parentNode.parentNode.'+s+"['hidepause'](this);\" onclick=\"return this.parentNode.parentNode."+s+'[\'hideresume\'](this);" style="color:#999; display:block; outline:none; padding:1px; text-decoration:none; width:100%;" target="'+this._objectConfig.target+'">',"</a></td>"]}for(h in e+='<tr id="'+i[t]+'" style="cursor:pointer;" onmouseover="this.'+s+"['mouseoverLine'](this);\" onmouseout=\"this."+s+"['mouseoutLine'](this);\" onmousedown=\"this."+s+"['setLineMouse'](this);\">",this._objectConfig.body)this._objectConfig.body.hasOwnProperty(h)&&(e+=l[0]+o[this._objectConfig.body[h]]+l[1]);e+="</tr>"}this._objectHtml["key_"+r]=e+="</table>",this._elementLineCurrent=null,document.createElement("div"),this._elementContainer.innerHTML=this._objectHtml["key_"+r],this._show()}else this._hide()},this._color=function(e){var t="";e._booleanArrow&&e._booleanMouse?t="#F8FBDF":e._booleanArrow?t="#F1F5FC":e._booleanMouse&&(t="#FCFEDF"),e.style.backgroundColor!=t&&(e.style.backgroundColor=t)},this.mouseoverLine=function(e){e._booleanMouse=!0,this._color(e)},this.mouseoutLine=function(e){e._booleanMouse=!1,this._color(e)},this.setLineMouse=function(e){this.setLine(e),null!=this._functionCallback&&this._functionCallback(this._elementInput.value,e.id.split(","))},this._getFullCode=function(e){switch(e[1]){case"11":case"12":case"13":case"14":case"15":case"21":case"22":case"23":case"24":case"25":case"26":return e[3];default:return e[2]}},this.setLine=function(e){var t,i,n,s=e.id.split(","),o=this._objectConfig.value;if(null!=o&&""!=o){for(t=0;t<s.length;t++)o=o.replace(new RegExp("@"+t+"@","g"),s[t]);i=o}else i=this._getFullCode(s);for(n=e.id,t=2;t<5;t++)this._objectData["key_"+s[t]]=n+";";this._stringLastValue=i,this._elementInput.value=i,null!=this._elementLineCurrent&&(this._elementLineCurrent._booleanArrow=!1,this._color(this._elementLineCurrent)),e._booleanArrow=!0,this._color(e),this._elementLineCurrent=e},this._show=function(){var e,t;if(null!=this._elementContainer&&(this._elementContainer.style.display="",this._objectConfig.onshow(),this._objectConfig.hideSelectForIE6&&"ie6"==this._stringBrowserType))for(e=document.getElementsByTagName("select"),t=0;t<e.length;t++)e[t].style.visibility="hidden"},this.hidepause=function(){this._booleanHideDelay=!0},this.hideresume=function(){this._booleanHideDelay=!1,this._hideNow()},this._hide=function(){0==this._booleanHideDelay&&this._hideNow()},this._hideNow=function(){var e,t;if(null!=this._elementContainer&&(this._elementContainer.style.display="none",this._objectConfig.onhide(),this._objectConfig.hideSelectForIE6&&"ie6"==this._stringBrowserType))for(e=document.getElementsByTagName("select"),t=0;t<e.length;t++)e[t].style.visibility="visible"},this._load=function(e,t,i){var n,s;null==this._elementScriptLoader&&(this._elementScriptLoader=document.createElement("div"),this._elementScriptLoader.style.display="none",this._elementInput.parentNode.insertBefore(this._elementScriptLoader,this._elementInput)),n="suggestdata_"+this._getRandom(),(s=document.createElement("script")).type="text/javascript",s.charset="gb2312",s.src=this._stringUrl.replace("@NAME@",n).replace("@KEY@",encodeURIComponent(e.toLowerCase())),s._object=this,t&&(s._functionCallbackTrue=t),i&&(s._functionCallbackFalse=i),s._stringValue=e,s._stringName=n,s[document.all?"onreadystatechange":"onload"]=function(){var e;document.all&&"loaded"!=this.readyState&&"complete"!=this.readyState||(void 0!==(e=window[this._stringName])?(this._object._objectData["key_"+this._stringValue]=e,this._functionCallbackTrue(e),window[this._stringName]=null):this._functionCallbackFasle&&this._functionCallbackFasle(""),this._object=null,this._stringValue=null,this._stringName=null,this[document.all?"onreadystatechange":"onload"]=null,this.parentNode.removeChild(this))},this._elementScriptLoader.appendChild(s)},this._check=function(){var e=this._elementInput.value;this._stringLastValue!=e?""!=(this._stringLastValue=e)?"key_"+e in this._objectData?this._fill():this._load(e,this._bind(this._fill),this._bind(this._hide)):(null!=this._elementContainer&&(this._elementLineCurrent=null,this._elementContainer.innerHTML=""),this._hide()):this._show()},this._eventFocus=function(){this._elementInput.value==this._stringOriginalValue&&(this._elementInput.value=""),this._stringLastValue="",this._check()},this._eventBlur=function(){""==this._elementInput.value&&(this._elementInput.value=this._stringOriginalValue),this._stringLastValue="",this._hide()},this._eventButtonUp=function(){var e=arguments[0]||window.event,t=null==this._objectConfig.head?0:1;switch(e.keyCode){case 38:null!=this._elementContainer&&null!=this._elementContainer.firstChild&&this.setLine(this._elementContainer.firstChild.rows[this._elementLineCurrent&&this._elementLineCurrent.rowIndex!=t?this._elementLineCurrent.rowIndex-1:this._elementContainer.firstChild.rows.length-1]);break;case 40:null!=this._elementContainer&&null!=this._elementContainer.firstChild&&this.setLine(this._elementContainer.firstChild.rows[this._elementLineCurrent&&this._elementLineCurrent.rowIndex!=this._elementContainer.firstChild.rows.length-1?this._elementLineCurrent.rowIndex+1:t]);break;case 13:null!=this._elementContainer&&(null!=this._elementLineCurrent&&this.setLine(this._elementLineCurrent),null!=this._functionCallback&&this._functionCallback(this._elementInput.value,this._elementLineCurrent?this._elementLineCurrent.id.split(","):[])),this._hide();break;default:this._check()}},this.getCodeFromCache=function(e){return"key_"+e in this._objectData?this._objectData["key_"+e]:void 0},this.getCode=function(e,t){"key_"+e in this._objectData?t(this._objectData["key_"+e]):this._load(e,t,t)},this.changeType=function(e){if(this._objectHtml={},this._objectData={},this._elementInput.value=this._stringOriginalValue,void 0!==e){var t="";switch(e.toLowerCase()){case"stock":t="11,12,13,14,15";break;case"fund":t="21,22,23,24,25,26";break;case"hkstock":t="31";break;case"hk":t="31,33,32";break;case"usstock":t="41";break;case"us":t="41,42";break;default:t=e}this._stringUrl=this._stringOriginalUrl.replace("@TYPE@",t)}else this._stringUrl=this._stringOriginalUrl.replace("type=@TYPE@&","");this._objectConfig.type=e},this.changeLink=function(e){this._objectConfig.link=e,this._fill(),this._hide()},this.clear=function(){this._stringLastValue=null,this._elementInput.value="",this._check(),this._elementInput.value=this._stringOriginalValue},this.bind=function(e){if(void 0!==e)for(var t in e)this._objectConfig[t]=e[t];this._elementInput="string"==typeof this._objectConfig.input?document.getElementById(this._objectConfig.input):this._objectConfig.input,null!=this._objectConfig.loader&&(this._elementScriptLoader="string"==typeof this._objectConfig.loader?document.getElementById(this._objectConfig.loader):this._objectConfig.loader),this._elementInput&&(this._stringOriginalValue=null==this._objectConfig.default||""==this._objectConfig.default?this._elementInput.value:this._objectConfig.default,this.changeType(this._objectConfig.type),this._elementInput.value=this._stringOriginalValue,this._elementInput.setAttribute("autocomplete","off"),this._elementInput.autoComplete="off",this._aevent(this._elementInput,"focus",this._bind(this._eventFocus)),this._aevent(this._elementInput,"blur",this._bind(this._eventBlur)),this._aevent(this._elementInput,"keyup",this._bind(this._eventButtonUp)),this._aevent(this._elementInput,"mouseup",this._bind(this._eventButtonUp)),this._functionCallback=this._objectConfig.callback)}};
