define("pkg/@alife/refly-tracelog/0.0.12/index",["jquery","lofty/util/exposure/1.0/exposure","require","module","exports"],function(e,t,r,a,n){function o(e){e=i(e);var t=e.find("[name=refly-trace-click-url]").val()||"btob.4",r=function(e){var r=i(e.target).closest("[data-trace-click]"),a=r.data(),n=a.traceClickUrl||t,o=u.getData(r);u.report("CLK",o,n)};e.on("click","[data-trace-click]",r)}function c(e){function t(){var e=i("[data-trace-exposure]:not(.exposured)");e.addClass("exposured"),n.collectResouce(e)}function r(){u.schedule("exposured.load",t,100)}var a=i(e).find("[name=refly-trace-click-url]").val()||"btob.40",n=new s({target:"[data-trace-exposure]",threshold:0,container:e});n.on("exposure",function(e){var t=e.data(),r=t.traceExposureUrl||a,n=u.getData(e,"exposure");u.report("EXP",n,r)}),d.addHandler(i(e).get(0),"DOMSubtreeModified",r),n.execute()}var i=e,s=t,u={_schedule:{},schedule:function(e,t,r){this._schedule[e]&&clearTimeout(this._schedule[e]),this._schedule[e]=0,t&&(0===r?t():this._schedule[e]=setTimeout(t,r||1e3))},getData:function(e,t){var r=e.data(),a=/traceClickParam(\w+)/,n="traceClick";"exposure"==t&&(n="traceExposure",a=/traceExposureParam(\w+)/);var o={action:r[n],st_page_id:window.dmtrack_pageid||u.getPageId()};for(var c in r)if(r.hasOwnProperty(c)&&a.test(c)){var i=c.replace(a,"$1");i=i.charAt(0).toLowerCase()+i.slice(1),o[i]="object"==typeof r[c]?JSON.stringify(r[c]):r[c]}return o},report:function(e,t,r){t||window.console&&console.error&&console.error("data is empty"),r=r||"ctr.1688.2";var a;a=encodeURIComponent("string"==typeof t?t:i.param(t));var n=r+":"+a+":"+e;this.schedule(n,this.invoke(r,a,e),3e3)},invoke:function(e,t,r){return function(){var a=new Image;a.src="//gm.mmstat.com/"+e+"?gokey="+t+"&type="+r+"&time="+Date.now()}},getPageId:function(){var e=i("#tb-beacon-aplus");if(!e||!e.length)return"";var t=e.attr("exparams");if(!t)return"";var r=u.param2obj(t);return r?r.st_page_id:""},param2obj:function(e){for(var t=e.split("&"),r=0,a=t.length,n={};a>r;r++){var o=t[r],c=o.indexOf("="),i=o.substring(0,c),s=o.substring(c+1);n[i]=u.tryToDecodeURIComponent(s)}return n},tryToDecodeURIComponent:function(e,t){var r=t||"";if(e)try{r=decodeURIComponent(e)}catch(a){}return r}},d={addHandler:function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r},removeHandler:function(e,t,r){e.removeEventListener?e.removeEventListener(t,r):e.detachEvent?e.detachEvent("on"+t,r):e["on"+t]=null}};a.exports=function(e,t){e&&(t&&t.noClick||o(e),t&&t.noExposure||c(e))}});;