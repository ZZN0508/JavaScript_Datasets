$(document).ready(function(){var a,e=new Date,h=e.getDate()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear();function b(e){e=e.split("/");return new Date(e[2],e[1]-1,e[0])}var t,e=$("#cityJson").val();$.ajax({type:"GET",url:e,datatype:"json",async:!1,success:function(e){t=e}});$("#nearbyoffers div span").find(".ui-selectmenu-text").text();var o,s="Mumbai";n(t,s);$("#nearbyoffers div .ui-selectmenu-button").find(".ui-selectmenu-text");function n(e,o){console.log("citydatavalue: "+o),$("#offerblock").empty();for(var t=new Array(e.length),s=new Array(e.length),n=new Array(e.length),r=new Array(e.length),a=new Array(e.length),i=new Array(e.length),l=new Array(e.length),c=new Array(e.length),d=new Array(e.length),f=new Array(e.length),g=new Array(e.length),u=new Array(e.length),p=new Array(e.length),y=new Array(e.length),v=new Array(e.length),e=JSON.parse(e),L=$.grep(e.mapDetails,function(e,t){return e.City==o}),w="<div class='trending-deals-slider extra-offer-text'>",x=0;x<L.length;x++)t[x]=L[x].ShopName,s[x]=L[x].Address,n[x]=L[x].Locality,r[x]=L[x].City,a[x]=L[x].OfferDescription1,i[x]=L[x].OfferDescription2,l[x]=L[x].StartDate,c[x]=L[x].EndDate,d[x]=L[x].Latitude,f[x]=L[x].Longitude,g[x]=L[x].TandCLink,u[x]=L[x].ThumbnaiUrl,p[x]=L[x].Category,y[x]=L[x].GetDirectionUrl,v[x]=L[x].City,void 0!==t[x]&&""!=t[x]&&(t[x]=t[x].replace(/\s+/g,"-").toLowerCase()),void 0!==s[x]&&""!=s[x]&&(s[x]=s[x].replace(/\s+/g,"-").toLowerCase()),void 0!==n[x]&&""!=n[x]&&(n[x]=n[x].replace(/\s+/g,"-").toLowerCase()),void 0!==r[x]&&""!=r[x]&&(r[x]=r[x].replace(/\s+/g,"-").toLowerCase()),void 0!==a[x]&&""!=a[x]&&(a[x]=a[x].replace(/\s+/g,"-").toLowerCase()),void 0!==i[x]&&""!=i[x]&&(i[x]=i[x].replace(/\s+/g,"-").toLowerCase()),void 0!==l[x]&&""!=l[x]&&(l[x]=l[x].replace(/\s+/g,"-").toLowerCase()),void 0!==c[x]&&""!=c[x]&&(c[x]=c[x].replace(/\s+/g,"-").toLowerCase()),void 0!==d[x]&&""!=d[x]&&(d[x]=d[x].replace(/\s+/g,"-").toLowerCase()),void 0!==f[x]&&""!=f[x]&&(f[x]=f[x].replace(/\s+/g,"-").toLowerCase()),void 0!==g[x]&&""!=g[x]&&(g[x]=g[x].replace(/\s+/g,"-").toLowerCase()),void 0!==u[x]&&""!=u[x]&&(u[x]=u[x].replace(/\s+/g,"-").toLowerCase()),void 0!==p[x]&&""!=p[x]&&(p[x]=p[x].replace(/\s+/g,"-").toLowerCase()),void 0!==y[x]&&""!=y[x]&&(y[x]=y[x].replace(/\s+/g,"-").toLowerCase()),b(L[x].EndDate)>=b(h)&&b(L[x].StartDate)<=b(h)&&x<12&&(w+="<div class='deal-card myOffers "+r[x]+"'><div class='deal-inner'><div class='image'><a href='"+L[x].GetDirectionUrl+"'><img src='"+L[x].ThumbnaiUrl+"'></a></div><div class='offer'><a href='"+L[x].GetDirectionUrl+"'>"+L[x].OfferDescription1+"</a><p class='offer-red'>"+L[x].OfferDescription2+"</p></div><div class='description'>"+L[x].Address+"</div><div class='buttons'><a href='"+L[x].GetDirectionUrl+"' class='ic-btn'>Get Directions</a></div></div></div>");w+="</div>",$("#offerblock").append(w),$("#nearbyoffers .trending-deals-slider").slick({dots:!0,infinite:!0,autoplay:!0,speed:500,slidesToShow:3,slidesToScroll:1,responsive:[{breakpoint:1025,settings:{slidesToShow:2}},{breakpoint:767,settings:{slidesToShow:1,arrows:!1,dots:!0}},{breakpoint:640,settings:{slidesToShow:1,arrows:!1,dots:!0,centerMode:!0,centerPadding:"15px",infinite:!0}}]})}$("#nearbyoffers div span").on("DOMSubtreeModified",function(){var e=$(this).find(".ui-selectmenu-text").text();void 0!==e&&""!=e&&(o=e,console.log("citySelectedDropdown::: "+o),n(t,o),blockLength=$(".myOffers."+o).length,0<blockLength||(o=s.replace(/\s+/g,"-").toLowerCase()),$(".myOffers."+o).attr("style","display:block;"))}),function(){var n,r="Mumbai";$("#nearbyoffers div span").find(".ui-selectmenu-text").text();var o=new google.maps.Geocoder,e=window.location.href;0<=e.indexOf("lat=")&&0<=e.indexOf("long=")?(e.substring(0,e.indexOf("lat=")),suffixLat=e.substring(e.indexOf("lat=")),suffixLat=suffixLat.substring(suffixLat.indexOf("=")+1),suffixLat=parseFloat(suffixLat.substring(0,suffixLat.indexOf("&"))),console.log("suffixLat...."+suffixLat),e.substring(0,e.indexOf("long=")),suffixLong=e.substring(e.indexOf("long=")),suffixLong=parseFloat(suffixLong.substring(suffixLong.indexOf("=")+1)),console.log("suffixLong...."+suffixLong),pos1={lat:suffixLat,lng:suffixLong},t(pos1)):navigator.geolocation?navigator.geolocation.getCurrentPosition(t,function(e){switch(e.code){case e.PERMISSION_DENIED:console.log("PERMISSION_DENIED : User denied the request for Geolocation."),$("#nearbyoffers div span").find(".ui-selectmenu-text").text("Mumbai"),$("#nearbyoffers div span").find(".ui-selectmenu-text").text();break;case e.POSITION_UNAVAILABLE:console.log("POSITION_UNAVAILABLE : Location information is unavailable.");break;case e.TIMEOUT:console.log("TIMEOUT : The request to get user location timed out.");break;case e.UNKNOWN_ERROR:console.log("UNKNOWN_ERROR : An unknown error occurred.")}}):console.log("Geolocation is not supported by this browser.");function t(e){var t;e=void 0!==e.lat&&void 0!==e.lng?(t=e.lat,e.lng):(t=e.coords.latitude,e.coords.longitude),function(e,t){t=new google.maps.LatLng(e,t);o.geocode({latLng:t},function(e,t){if(t==google.maps.GeocoderStatus.OK&&e[1]){for(var o=0;o<e[0].address_components.length;o++)for(var s=0;s<e[0].address_components[o].types.length;s++)if("locality"==e[0].address_components[o].types[s]){city=e[0].address_components[o];break}a=city.short_name.replace(/\s+/g,"-").toLowerCase(),console.log("cityname:: "+a+" cityShortName:: "+city.short_name),void 0!==a&&null!=a&&""!=a&&($("#nearbyoffers div span").find(".ui-selectmenu-text").text(city.short_name),$(".citySelect option[value="+a+"]").attr("selected","selected").change(),$("#nearbyoffers div span").find(".ui-selectmenu-text").text(),n=city.short_name,console.log("citynameval after location is fetched: "+n),0<$(".myOffers."+n.replace(/\s+/g,"-").toLowerCase()).length?$(".myOffers."+a.replace(/\s+/g,"-").toLowerCase()).attr("style","display:block;"):($("#nearbyoffers div span").find(".ui-selectmenu-text").text(r),a=r.replace(/\s+/g,"-").toLowerCase(),$(".myOffers."+a).attr("style","display:block;")))}})}(t,e),console.log("Latitude: "+t),console.log("Longitude: "+e)}}()});
