var OKdiscussions,OK=OK||{};OK.editor={CLASS:"ok-e",JS_CLASS:"js-ok-e",DECORATION_STYLE_NAME:"text-decoration"},OK.editor.el={bridge:{triggerSave:{},send:{},updateLengthCounter:{},closeDropdowns:{},onFocus:{},onArrowUpClickOnEmptyTA:{},onEscClick:{},openTextarea:{}}},OK.editor.caretPosition,OK.editor.hasFocus=!1,OK.editor.harness={timer:0,onKeyDown:function(e,t){var n,i=OK.editor,o=i.el,r=i.util,s=i.tools,a=o.bridge;13!=e.keyCode||e.altKey?38!=e.keyCode||e.ctrlKey||e.metaKey||e.altKey?27!=e.keyCode||e.ctrlKey||e.metaKey||e.altKey||a.onEscClick(e):0==r.getAreaText().length&&(a.onArrowUpClickOnEmptyTA(),e.preventDefault()):(n=e.ctrlKey||e.metaKey,e.shiftKey?r.isWebkit&&s.insertHtml("br"):(t&&n||!t&&!n)&&(a.triggerSave(),o.data("emojiarea")&&o.data("emojiarea").hideMenu(),OK.logging.logger.success("ta","send",n?"ctrlEnter":"enter"),e.preventDefault())),clearTimeout(this.timer),this.timer=setTimeout((function(){a.closeDropdowns(),a.updateLengthCounter("keyDown"),r.updateSrollStyles()}),100)},click:function(){var e=OK.editor;e.selector.supportsSelection()&&(e.util.saveCaretPosition(),setTimeout("OK.editor.tools.highlightFormatting()",50))}},OK.editor.selector={getElement:function(e){return util.isText(e)?e.parentNode:e},addRange:function(e){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},getFocusElement:function(e){var t;return e?(t=util.getSelectedNode(e,e.startContainer,e.startOffset,!0),util.isText(t)||util.isImg(t)||util.isElement(t,"BR")?t.parentNode:t):null},getFocusNode:function(){return window.getSelection().rangeCount>0?window.getSelection().getRangeAt(0).startContainer:null},getFocusOffset:function(){return window.getSelection().getRangeAt(0).startOffset},isSelected:function(e){return 1==e.rangeCount&&e.getRangeAt(0)&&util.isInEditor(e.getRangeAt(0).startContainer)},supportsSelection:function(){return void 0!==window.getSelection},supportsRange:function(){return this.supportsSelection()&&void 0!==document.createRange},supportsTextRange:function(){return void 0!==document.body.createTextRange},getSelection:function(){return this.supportsSelection()?window.getSelection():null},getRange:function(){try{var e=this.getSelection();return e&&this.isSelected(e)?e.getRangeAt(0):null}catch(e){return OK.logging.logger.error("ta.e","getRange_e"),null}},createTextRange:function(){var e=document.selection;return null!=e?e.createRange():null},setStart:function(e,t){e.setStart(t,0)},setEnd:function(e,t){var n;util.isText(t)?e.setEnd(t,t.nodeValue.length):util.isWebKit?e.setEnd(util.normalizeFocus(t),0):(n=Array.prototype.indexOf.call(t.parentNode.childNodes,t),e.setEnd(t.parentNode,n))}},OK.editor.tools={insertHtml:function(e){var t,n,i,o,r,s,a,l,c,d,u=OK.editor.selector,g=OK.editor.util,f=String.fromCharCode(160);void 0===e.nodeType?a=document.createElement(e):(a=e.cloneNode(!1),g.isImg(a)&&(l=!0)),u.supportsRange()?(i=u.getSelection(),t=u.getRange(),i&&t&&(t.deleteContents(),g.isSpan(u.getElement(i.anchorNode))&&(o=g.getSelectedNode(t,t.startContainer,t.startOffset,!0),r=g.getSelectedNode(t,t.endContainer,t.endOffset,!1),OK.editor.command.splitTextNodes(t,o,r),OK.editor.command.splitSpans(t,o,r),(s=o.parentNode)===r.parentNode&&g.isEmpty(s)&&$(s).remove()),t.insertNode(a),l&&(c={text:f,offset:1}),g.moveFocus(a,c),tools.highlightFormatting())):u.supportsTextRange()&&(n=u.createTextRange())&&(d=a.outerHTML,l&&(d+=f),n.pasteHTML(d))},highlightFormatting:function(){var e,t,n,i,o,r,s=OK.editor.selector,a=0;try{if(s.supportsRange()&&void 0!==s.getRange&&(a=1,r=s.getRange(),a=2,n=$(".decoration"),r))if(a=3,tools.cleanFormatting(),a=4,r.collapsed)a=5,e=s.getFocusElement(r),a=6,e&&e.style.cssText&&(a=7,tools.cleanFormatting(),a=8,$.each(e.style.cssText.split(";"),(function(e,t){""!=t&&(a=9,tools.decorate(n,t))})));else for(o in i={},a=10,t=r.cloneContents().querySelectorAll("span"),a=11,$.each(0==t.length?[s.getFocusElement(r)]:t,(function(e,t){a=12,t.style.cssText&&(a=13,$.each(t.style.cssText.split(";"),(function(e,t){""!=t&&(a=14,i[t]=!0)})))})),a=15,i)a=16,tools.decorate(n,o)}catch(e){return void OK.logging.logger.error("ta.e","highlight_e_"+a)}},decorate:function(e,t){e.find("[data-style='"+t.trim()+"']").addClass(util.decorationSelectedCss)},cleanFormatting:function(){jQuery(".decoration").find("."+util.decorationSelectedCss).removeClass(util.decorationSelectedCss)},beforeSendMsg:function(){var e=OK.editor.el;e.saveText&&e.saveText.clearText(e)},setCaretToEnd:function(e){var t,n=OK.editor,i=n.selector,o=n.util,r=0,s=n.el;try{if(r=1,!e&&n.hasFocus||!s||void 0===s||"undefined"==typeof jQuery||!(s instanceof jQuery)||s.size()<1)return;if(r=3,t=s[0],r=4,this.setFocus(!1),r=5,i.supportsRange()){r=6;var a=document.createRange(),l=i.getSelection(),c=n.caretPosition;r=7,l&&a&&(c&&a.setStart&&c.anchorNode&&o.isInEditor(c.anchorNode)&&c.anchorOffset?(r=8,a.setStart(c.anchorNode,c.anchorOffset)):(r=9,a.selectNodeContents(t)),r=12,a.collapse(!1),r=13,void 0!==l.removeAllRanges&&l.removeAllRanges(),r=14,l.addRange(a),r=15,this.highlightFormatting())}else if(i.supportsTextRange()){r=16;var d=document.body.createTextRange();r=17,d&&(r=18,d.moveToElementText(t),r=19,d.collapse(!1),r=20,d.select())}}catch(e){return void OK.logging.logger.error("ta.e","setCaretJs_e_"+r)}},setFocus:function(e){var t,n=OK.editor,i=n.selector,o=n.el,r=0;try{if(n.hasFocus||!o||void 0===o||o.size()<1)return;r=1,t=o[0],r=2,i.supportsRange()||e?(r=3,t.focus()):(r=4,setTimeout((function(){t.focus()}),10))}catch(e){return void OK.logging.logger.error("ta.e","setFocus_e_"+r)}}},OK.editor.util={zeroWidthSpace:String.fromCharCode(8203),decorationSelectedCss:"d-selected",isWebKit:!1,isSafari:!1,isFireFox:!1,ie11:!1,setActiveElement:function(e){try{if("undefined"==typeof jQuery)return;"ok-e-d"===e&&((void 0===OKdiscussions||OKdiscussions.size()<1)&&(OKdiscussions=jQuery("#"+e)),OK.editor.el=OKdiscussions)}catch(e){OK.logging.logger.error("ta.e","setActiveElementJs_e_"+step)}},isParagraph:function(e){if(void 0!==e){var t=e.nodeName.toUpperCase();if("BR"==t||"DIV"==t||"P"==t)return!0}return!1},isSpan:function(e){return this.isElement(e,"SPAN")},isImg:function(e){return this.isElement(e,"IMG")},isElement:function(e,t){return e&&1==e.nodeType&&e.tagName.toUpperCase()==t},isSpace:function(e){return 160==e||32==e},isText:function(e){return e&&3==e.nodeType},isEmpty:function(e){return util.isEmptyText(util.cleanZeroWidth(e.innerHTML))},isEmptyText:function(e){return 0==util.cleanZeroWidth(e).length},isEmptyElement:function(e){return void 0!==e&&(e.innerHTML==util.zeroWidthSpace||util.isEmpty(e)||util.hasOnlyBr(e))},getAreaText:function(){var e=OK.editor.el,t=0,n=e.text(),i=e.html();try{return e?(t=1,n=e.text(),t=2,i=e.html(),t=3,""!=n.trim()||(t=4,t=5,/[<]img[^>]* alt=[^>]+[>]/gi.test(i))?(t=6,this.prepareText(i)):""):""}catch(e){return OK.logging.logger.error("ta.e","getAreaText_e_"+t),""}},prepareText:function(e){var t=0,n=e;try{return n?(t=1,n=n.replace(/(<(\/?(strong|b|em|i|strike|a|u|p|br|img|div|span|font)(([ ][^>]*)|([\/]?)))>)/gi,"[%%[$2]%%]"),t=2,n=n.replace(/<[^>]*>/gi,""),t=3,n=n.replace(/(\[%%\[([^\]]*)\]%%\])/gi,"<$2>"),t=4,n=n.replace(/(<\w+)(?=[^>]*=\s*')(?:[^\/>]*(?:[\/][^>])?)*([\/]?>)/gi,"$1$2"),t=5,n.replace(/&nbsp;/g," ")):""}catch(n){return OK.logging.logger.error("ta.e","prepareTextJs_e_"+t),e}},cleanZeroWidth:function(e){for(;-1!=e.indexOf(this.zeroWidthSpace);)e=e.replace(this.zeroWidthSpace,"");return e},isEditor:function(e){return!util.isText(e)&&$(e).hasClass(OK.editor.JS_CLASS)},hasOnlyBr:function(e){return 1==e.childNodes.length&&util.isElement(e.firstChild,"BR")},after:function(e,t){this.checkScheme(e.parentNode,t),e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)},before:function(e,t){this.checkScheme(e.parentNode,t),e.parentNode.insertBefore(t,e)},throwSchemeViolation:function(){},throwSelectionError:function(){},checkScheme:function(e,t){(this.isSpan(e)&&this.isSpan(t)||this.isImg(e))&&this.throwSchemeViolation()},isInEditor:function(e,t){for(;e;){if(this.isEditor(e))return!t||t.id==e.id;e=e.parentNode}return!1},createEl:function(e,t,n){return this.formatCss(e,t),n.nodeType?this.append(e,n):this.append(e,document.createTextNode(n)),e},createSpan:function(e,t){var n=document.createElement("span");return this.createEl(n,e,t)},inheritSpan:function(e,t,n){var i;return i=e&&this.isSpan(e)?e.cloneNode(!1):document.createElement("span"),t&&this.formatCss(i,t),n&&(n.nodeType?this.append(i,n):$(i).text(n)),i},formatCss:function(e,t,n){var i=$(e),o=t.split(":"),r=o[0].trim();n&&OK.editor.command.hasSameStyle(e,t)?i.css(r,""):i.css(r,o[1].trim())},moveAllAfter:function(e,t,n){for(var i;e.nextSibling;)i=e.nextSibling,$(i).remove(),util.append(t,i,n)},moveAllBefore:function(e,t){for(var n,i=e.parentNode;i.firstChild!=e;)n=i.firstChild,$(n).remove(),this.append(t,n)},append:function(e,t,n){n&&util.checkScheme(e,t),e.appendChild(t)},replace:function(e,t){this.isEditor(e)&&this.throwSchemeViolation(),this.checkScheme(e.parentNode,t),e.parentNode.replaceChild(t,e)},normalizeFocus:function(e){var t;return!e.nextSibling||util.isText(e.nextSibling)&&0==e.nextSibling.nodeValue.length?(t=document.createTextNode(""),util.after(e,t),e=t):e=e.nextSibling,e},moveFocus:function(e,t){var n,i,o=document.createRange();t||(t={text:util.zeroWidthSpace,offset:0}),i=document.createTextNode(t.text),n=e.firstChild||e,util.after(n,i),o.setStart(i,t.offset),selector.addRange(o),this.saveCaretPosition()},getSelectedNode:function(e,t,n,i){var o,r=!i,s=!1;return util.isText(t)||0==t.childNodes.length?t:((o=t.childNodes[n])||(o=t.lastChild,s=!0),o||util.throwSelectionError(),r&&(util.isWebKit&&util.isText(o)||(util.isFireFox||util.isWebKit&&!s)&&util.isImg(o))&&(o=util.find(o,!1),util.isFireFox&&(o=o.lastChild||o)),o)},find:function(e,t){for(var n=t?"nextSibling":"previousSibling",i=e.parentNode,o=e[n];null==o&&i;)o=i[n],i=i.parentNode;return util.isInEditor(o)?o:null},findBr:function(e,t){var n=t?"nextSibling":"previousSibling",i=(e.parentNode,e);for(i.nodeName;null!=i;){if(this.isParagraph(i))return i;var o=i[n];if(null!=o){if(this.isParagraph(o))return i;i=o}else{if(null==i.parentNode||this.isEditor(i.parentNode))return i;i=i.parentNode}}},move:function(e,t){$(e).remove(),this.append(t,e)},staticInit:function(e,t,n,i){var o,r,s,a=OK.editor,l=a.util,c=a.harness;l.setActiveElement(e),(o=a.el).size()<1?setTimeout((function(){l.staticInit(e,t,n,i)}),100):(o.bridge=n,r=$.extend({},{formattingDisabled:!1,allowedTags:"",saveTextInLS:!1},i),o.on({click:function(){c.click()},paste:function(){var e=$(this);setTimeout((function(){r.allowedTags?l.cleanPaste(e,r.allowedTags):l.cleanPasteOld(e,void 0),l.updateSrollStyles(),o.bridge.updateLengthCounter("paste")}),50)},keydown:function(e){!r.formattingDisabled||!e.ctrlKey&&!e.metaKey||66!==e.keyCode&&73!==e.keyCode&&85!==e.keyCode||e.preventDefault()},focus:function(){a.hasFocus=!0,o.bridge.updateLengthCounter("focus"),o.bridge.onFocus(),l.updateIsEmpty()},blur:function(){a.hasFocus=!1,l.updateIsEmpty()}}),o.on("keypress",(function(e){c.onKeyDown(e,t)})),o.on("textchange",(function(){s&&clearTimeout(s),s=setTimeout((function(){l.updateSrollStyles()}),500)})),r.saveTextInLS&&require(["OK/saveText"],(function(){o.saveText({afterRestoreValue:function(){s&&clearTimeout(s),s=setTimeout((function(){tools.setCaretToEnd(!0),l.onSetText()}),100)}})})),l.hideLoadingProcess(e),l.updateSrollStyles(!0),l.updateIsEmpty())},initDropdown:function(e,t){var n,i,o,r=(new Date).getTime(),s=OK.logging.logger,a=OK.editor,l=a.util,c=a.tools;"format"==t?(i="A",n=function(e){var t,n=l.decorationSelectedCss,i=$(e),o=i.attr("data-style");-1==o.indexOf(":")&&(t=i.css(o),o===OK.editor.DECORATION_STYLE_NAME&&(t=t.split(" ")[0]),o=o+": "+t,i.attr("data-style",o)),s.success("ta","format",o.split(":")[0]),a.command.format(i.hasClass(n),o)}):"smiles"==t&&(i="IMG",n=function(e){s.success("ta","smile"),c.insertHtml(e)}),$("#"+e).on({mousedown:!1,click:function(e){e.preventDefault(),a.selector.supportsSelection()?c.setCaretToEnd():c.setFocus(!0);var t=e.target;t.nodeName.toUpperCase()==i&&n(t)}}),(o=(new Date).getTime()-r)>0&&s.durationScalar("ta",t+"_duration",o)},hideLoadingProcess:function(e){var t;null!=(t=document.getElementById(e+"_button"))&&t.classList.remove("__loading")},normalizeFont:function(){var e,t,n;if(selector.supportsRange()){n=selector.getRange();var i=util.isElement(selector.getFocusElement(n),"FONT")||util.isElement(selector.getFocusElement(n),"B")&&util.isElement(selector.getFocusElement(n).parentNode,"FONT");if(n&&(util.isSafari||util.isWebKit)&&i){t=(e=selector.getFocusNode()).parentNode,n=document.createRange();var o=$(t).contents();$(t).replaceWith(o),n.setStart(e,e.length),selector.addRange(n)}}},cleanWordComments:function(e){e.contents().filter((function(){return 8==this.nodeType})).remove()},cleanPasteOld:function(e,t){this.cleanWordComments(e),t&&e.html(util.stripTags(e.html(),t));for(var n,i,o,r,s=e.get(0).firstChild;s;)(r=$(s)).hasClass("emoji")||r.removeAttr("class"),util.isSpan(s)&&util.isSpan(s.parentNode)&&(i=s.parentNode,n=util.inheritSpan(i),util.moveAllAfter(s,n,!1),util.after(i,n),r.remove(),util.before(n,s),o=s),s=s.firstChild||util.find(s,!0);o&&util.moveFocus(o)},cleanPaste:function(e,t){util.saveCaretPosition(),e.find("*").addBack().contents().filter((function(){return 8===this.nodeType})).remove();var n=e.find("*:not("+t+")");n.contents().unwrap(),n.remove(),e.find("*:not(img.emoji, img.usmile, img[alt^='#u'][alt$='s#'])").each((function(){for(var e=this.attributes,t=e.length;t--;){var n=e[t];this.removeAttributeNode(n)}}));var i=e.children(),o=1==i.size();o&&i.contents().unwrap(),(o||n.size()>0)&&(e.get(0).normalize(),tools.setCaretToEnd(!0))},saveCaretPosition:function(){var e,t=OK.editor,n=t.selector;t.hasFocus&&n.supportsSelection()&&(e=t.selector.getSelection())&&(t.caretPosition=$.extend({},e))},stripTags:function(e,t){var n="",i=!1,o=[],r=[],s="",a=0,l="",c="";try{var d=function(e,t,n){return n.split(e).join(t)};for(n in t&&(r=t.match(/([a-zA-Z0-9]+)/gi)),o=(e+="").match(/(<\/?[\S][^>]*>)/gi))if(!isNaN(n)){for(l in c=o[n].toString(),i=!1,r)if(s=r[l],0!=(a=-1)&&(a=c.toLowerCase().indexOf("<"+s+">")),0!=a&&(a=c.toLowerCase().indexOf("<"+s+" ")),0!=a&&(a=c.toLowerCase().indexOf("</"+s)),0==a){i=!0;break}i||(e=d(c,"",e),OK.logging.logger.success("ta","strip"))}return e}catch(t){return OK.logging.logger.error("ta.e","stripTags_e_"+step),e}},hasScroll:function(){var e=0;try{if(!OK.editor.el)return!1;e=1;var t=OK.editor.el[0];if(void 0===t)return!1;e=2;var n=!!t.scrollTop;return e=3,n||(e=4,t.scrollTop=1,e=5,n=!!t.scrollTop,e=6,t.scrollTop=0),e=7,n}catch(t){return OK.logging.logger.error("ta.e","hasScroll_e_"+e),!1}},updateSrollStyles:function(e){var t=0;try{if("undefined"==typeof jQuery)return;t=1;var n=jQuery,i=util.hasScroll();if(t=2,!e&&OK.editor.hasScroll===i)return;t=3,OK.editor.hasScroll=i,t=4,OK.editor.toolbar||(t=5,OK.editor.toolbar=n(".topPanel_m .disc_toolbar_w")),t=6,OK.editor.toolbar.toggleClass("__has-scroll",i)}catch(e){OK.logging.logger.error("ta.e","updateSrollStyles_e_"+t)}},updateIsEmpty:function(){var e=OK.editor.el;(e.hasClass("add-placeholder")||e.hasClass("add-caret"))&&setTimeout((function(){e.toggleClass("__empty",0===util.getAreaText().length)}),0)},initMentions:function(e,t,n,i,o,r){var s=document.getElementById(e);require(["OK/postingForm/mentions","PTS/discussion.client","OK/suggest/searchEngines"],(function(e,a,l){var c,d=e("cfmdsc_"+(new Date).getTime()),u=OK.editor.selector;d.mentionsCharStart=t||3,d.cleanupOnPaste=!1,d.useText=!0,o&&(c=l.commentMentionsEngine(o,r)),d.init(a.markFriendDisabled,i,u,!0,c),n.resolve(d.bind(s))}))},onSetText:function(){util.updateIsEmpty(),OK.editor.el.trigger("keypress"),tools.cleanFormatting()}};var harness=OK.editor.harness,selector=OK.editor.selector,tools=OK.editor.tools,util=OK.editor.util;OK.editor.command={format:function(e,t){OK.editor.el.get(0).normalize();var n,i,o,r=OK.editor.util;selector.supportsRange()&&(n=selector.getRange())&&(i=r.getSelectedNode(n,n.startContainer,n.startOffset,!0),o=r.getSelectedNode(n,n.endContainer,n.endOffset,!1),i&&o||r.throwSelectionError(),-1!=t.indexOf("text-align")?this.formatDiv(n,i,o,t):n.collapsed?this.formatSingle(n,i,o,t,e):this.formatRange(n,i,o,t,e),tools.highlightFormatting())},formatSpan:function(e,t,n){OK.editor.util.formatCss(e,t,!0)},formatRange:function(e,t,n,i,o){var r,s,a,l,c=OK.editor.util;for(this.splitTextNodes(e,t,n),this.splitSpans(e,t,n),r=t;r;)(a=(s=r)===n)?(r=null,selector.setEnd(e,s)):r=r.firstChild||c.find(r,!0),c.isImg(s)||(c.isText(s)?c.isSpan(s.parentNode)?this.formatSpan(s.parentNode,i,o):c.isSpan(s.previousSibling)?c.move(s,s.previousSibling):(l=s.cloneNode(!1),c.replace(s,c.createSpan(o?"":i,l)),a&&selector.setEnd(e,l)):c.isSpan(s)&&0==s.childNodes.length&&this.formatSpan(s,i,o));selector.addRange(e)},formatDiv:function(e,t,n,i){var o,r,s,a=OK.editor.util,l=document.createDocumentFragment();if(!OK.editor.el.get(0).hasChildNodes()){r=document.createElement("div"),a.formatCss(r,i,!1),a.append(r,document.createTextNode(String.fromCharCode(8203))),a.append(t,r);e=document.createRange();var c=window.getSelection();return e.setStart(r,0),e.collapse(!1),c.removeAllRanges(),void c.addRange(e)}if("BR"==t.nodeName.toUpperCase()&&t.previousSibling&&!a.isParagraph(t.previousSibling)&&(t=t.previousSibling),o=a.findBr(t,!1),a.findBr(n,!0),"DIV"==o.nodeName.toUpperCase())r=o,a.formatCss(r,i,!0);else{r=document.createElement("div"),a.formatCss(r,i,!1);do{o=(s=o).nextSibling,a.append(r,s)}while(o&&!a.isParagraph(o));o&&"BR"==o.nodeName.toUpperCase()&&o.nextSibling&&(o=(s=o).nextSibling,$(s).remove()),r.innerHTML||a.append(r,document.createTextNode(String.fromCharCode(8203))),l.appendChild(r)}l.hasChildNodes()&&(e.insertNode(l),a.moveFocus(r))},splitTextNodes:function(e,t,n){var i,o,r=t.nodeValue,s=OK.editor.util,a=n.nodeValue,l=s.isText(t)&&e.startOffset>0,c=s.isText(n)&&e.endOffset<a.length;l&&(i=r.substr(0,e.startOffset),s.cleanZeroWidth(i).length>0&&s.before(t,document.createTextNode(i))),c&&(o=a.substr(e.endOffset),s.cleanZeroWidth(o).length>0&&s.after(n,document.createTextNode(o))),t===n&&s.isText(t)?t.nodeValue=r.substr(e.startOffset,e.endOffset-e.startOffset):(l&&(t.nodeValue=r.substr(e.startOffset)),c&&(n.nodeValue=a.substr(0,e.endOffset)))},splitSpans:function(e,t,n){var i,o,r=t.parentNode,s=n.parentNode,a=OK.editor.util;a.isSpan(r)&&t.previousSibling&&(i=a.inheritSpan(r,null,null),a.moveAllBefore(t,i),a.isEmpty(i)||a.before(r,i)),a.isSpan(s)&&n.nextSibling&&(o=a.inheritSpan(s,null,null),a.moveAllAfter(n,o),a.isEmpty(o)||a.after(s,o))},hasSameStyle:function(e,t){var n=t.split(":"),i=n[0],o=n[1].trim(),r=$(e).css(i);return i===OK.editor.DECORATION_STYLE_NAME&&(r=r.split(" ")[0]),r===o},formatSingle:function(e,t,n,i,o){var r,s,a=OK.editor.util,l=a.isText(t)&&(a.isWebKit||a.isSafari?t.nodeValue:a.cleanZeroWidth(t.nodeValue)).length===e.endOffset&&(a.isSafari||a.isWebKit||t.parentNode.lastChild==t);a.isSpan(t.parentNode)?r=t.parentNode:a.isSpan(t)&&(r=t),r&&this.hasSameStyle(r,i)&&(!l||a.isEmptyElement(r))?$(r).css(i.split(":")[0],""):r?a.isEmptyElement(r)?a.formatCss(r,i):(s=a.inheritSpan(r,i,a.zeroWidthSpace),a.isText(n)&&e.endOffset<n.nodeValue.length&&this.splitTextNodes(e,t,n),this.splitSpans(e,t,n),l&&o&&$(s).css(i.split(":")[0],""),a.after(t.parentNode,s),a.moveFocus(s)):(s=a.createSpan(i,a.zeroWidthSpace),e.insertNode(s),a.moveFocus(s))}};