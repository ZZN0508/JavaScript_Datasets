!function(y){var e,n,t,r;void 0===y.b2bLoader&&((e=y.fmd)&&(y.fmd=null),function(e){"use strict";var u,c,a,n;e.fmd||(u={},c=[],a=function(e){return u[e]},(n=function(e,n,t){if(!u[e]){if(t||(t=n,n=[]),"function"==typeof t){for(var r=[],i=0,o=n.length;i<o;i++)r.push(a(n[i]));t=t.apply(null,r)}u[e]=t||1,c.push(e)}}).version="0.2.8",n.cache={parts:c},n("global",e),n("require",function(){return a}),n("env",function(){return n}),n("cache",function(){return n.cache}),e.fmd=n)}(this),fmd("lang",function(){"use strict";var n={}.toString,e=Array.prototype,t={isFunction:function(e){return"[object Function]"===n.call(e)},isArray:Array.isArray||function(e){return"[object Array]"===n.call(e)},isString:function(e){return"string"==typeof e},forEach:e.forEach?function(e,n,t){e.forEach(n,t)}:function(e,n,t){for(var r=0,i=e.length;r<i;r++)n.call(t,e[r],r,e)},map:e.map?function(e,n,t){return e.map(n,t)}:function(e,r,i){var o=[];return t.forEach(e,function(e,n,t){o.push(r.call(i,e,n,t))}),o},inArray:e.indexOf?function(e,n){return e.indexOf(n)}:function(e,n){for(var t=0,r=e.length;t<r;t++)if(e[t]===n)return t;return-1}};return t}),fmd("event",["env","cache"],function(e,n){"use strict";var o=n.events={},u=[].slice,n={on:function(e,n){(o[e]||(o[e]=[])).push(n)},emit:function(e){var n,t=u.call(arguments,1),r=o[e],i=0;if(r)for(;n=r[i++];)n.apply(null,t)},off:function(e,n){var t=o[e];if(t)if(n)for(var r=t.length-1;0<=r;r--)t[r]===n&&t.splice(r,1);else delete o[e]}};return e.on=n.on,e.off=n.off,n}),fmd("config",["env","cache","lang"],function(e,n,u){"use strict";var c=n.config={},a=n.configRules={},t=0,r={get:function(e){return c[e]},set:function(e){for(var n in e){var t=c[n],r=e[n];!function(e,n,t){var r,i,o=!1;for(i in a){if(o)break;r=a[i],o=-1<u.inArray(r.keys,n)&&void 0===r.rule.call(c,e,n,t)}return o}(t,n,r)&&(c[n]=r)}},register:function(e){var n;return u.isFunction(e.rule)&&(e.name||(e.name="_rule_"+t++),n=a[e.name]={rule:e.rule,keys:[]}),(n=n||a[e.name])&&e.keys&&(u.isArray(e.keys)?n.keys=n.keys.concat(e.keys):n.keys.push(e.keys)),this}};return r.register({name:"object",rule:function(e,n,t){if(!e)return!1;for(var r in t)e[r]=t[r]}}).register({name:"array",rule:function(e,n,t){e?e.push(t):this[n]=[t]}}),e.config=function(e){if(u.isString(e))return r.get(e);r.set(e)},r}),fmd("module",["global","env","cache","lang","event","config"],function(e,n,t,i,o,r){"use strict";var u=[],c=0,a=t.modules={},s={require:function(e){return e.require||f.makeRequire(e),o.emit("makeRequire",e.require,e),e.require},exports:function(e){return e.exports},module:function(e){return e.module={id:e.id,exports:e.exports},e.module}},f=function(e,n,t){var r=this;r.id=e,r.deps=n||[],r.factory=t,r.exports={},r.unnamed()&&(e="_!_fmd_anonymous_"+c,c++),r.uid=e};f.prototype={unnamed:function(){return""===this.id},extract:function(){var t=this,e=t.deps,r=[];return i.isArray(e)&&i.forEach(e,function(e){var n,e=(n=s[e])?n(t):(t.require||f.makeRequire(t),t.require(e));r.push(e)}),r},compile:function(){if(r.get("hasCatch"))try{f.compile(this)}catch(e){o.emit("compileFailed",e,this)}else f.compile(this)},autocompile:function(){this.unnamed()&&this.compile()}},f.get=function(e){return a[e]},f.has=function(e,n){if(s[e])return!0;e={id:e};return n&&o.emit("alias",e),!!a[e.id]},f.save=function(e){a[e.uid]=e,o.emit("saved",e),e.autocompile()},f.require=function(e){var n=f.get(e);return n?(n.compiled||(n.compiled=!0,n.compile()),o.emit("required",n),n.exports):(o.emit("requireFailed",{id:e}),null)},f.makeRequire=function(n){n.require=function(e){e={id:e};return o.emit("relative",e,n),o.emit("alias",e),f.require(e.id)}},f.define=function(e,n,t){var r=arguments.length;if(1===r?(t=e,e=""):2===r&&(t=n,n=u,i.isString(e)||(n=e,e="")),f.has(e,!0))return o.emit("existed",{id:e}),null;f.save(new f(e,n,t))},f.compile=function(e){var n;i.isFunction(e.factory)?(n=e.extract(),void 0!==(n=e.factory.apply(null,n))?e.exports=n:e.module&&(e.exports=e.module.exports),e.module&&delete e.module):void 0!==e.factory&&(e.exports=e.factory),o.emit("compiled",e)},f.define.fmd={};var l=e.define;return n.noConflict=function(){e.define=l},n.define=e.define=f.define,f}),fmd("alias",["config","event"],function(r,e){"use strict";var i="alias";r.register({keys:i,name:"object"}),e.on(i,function(e){var n,t=r.get(i);t&&(n=t[e.id])&&(e.id=n)})}),fmd("relative",["lang","event","module"],function(e,n,t){"use strict";var r=/.*\//,i=/\/\.\//,o=/[^\/]+\/\.\.\//,u={cwd:function(e){return e.match(r)[0]},isDotStart:function(e){return"."===e.charAt(0)},hasSlash:function(e){return 0<e.lastIndexOf("/")},resolve:function(e,n){for(var t=(e+n).replace(i,"/");t.match(o);)t=t.replace(o,"");return t}};return n.on("relative",function(e,n){u.isDotStart(e.id)&&n&&u.hasSlash(n.id)&&(n._cwd||(n._cwd=u.cwd(n.id)),e.id=u.resolve(n._cwd,e.id))}),u}),fmd("id2url",["global","event","config"],function(e,r,o){"use strict";var i=/^https?:\/\//i,u=(new Date).getTime(),c="resolve",a="stamp";o.set({baseUrl:(e=(e=(e=(e=e.document.getElementsByTagName("script"))[e.length-1]).hasAttribute?e.src:e.getAttribute("src",4))?e.match(/^\w+\:\/\/[\w\-\.:]+\//i):null)?e[0]:""}),o.register({keys:c,name:"array"}).register({keys:a,name:"object"});r.on(c,function(e){var n,t=o.get(c);if(t)for(var r=0,i=t.length;r<i&&(n=t[r](e.id))===e.id;r++);e.url=n||e.id}),r.on(a,function(e){var n=o.get("hasStamp")?u:null,t=o.get(a);if(t)for(var r in t)if(new RegExp(r).test(e.id)){n=t[r];break}n&&(e.url+="?fmd.stamp="+n)}),r.on("id2url",function(e){var n,t;r.emit(c,e),t=e,i.test(t.url)||(t.url=o.get("baseUrl")+t.url),(t=(n=e).url).lastIndexOf(".")<t.lastIndexOf("/")&&(n.url+=".js"),r.emit(a,e)})}),fmd("assets",["cache","lang","event","config","module"],function(e,t,r,n,i){"use strict";var o=e.assets={},u={},c={make:function(e,n){e={id:e};return r.emit("analyze",e),r.emit("relative",e,n),r.emit("alias",e),u[e.id]?o[u[e.id]]:(i.has(e.id)?e.url=e.id:r.emit("id2url",e),u[e.id]=e.url,o[e.url]=e)},group:function(n){return t.map(n.deps,function(e){return c.make(e,n)})}};return c}),fmd("when",function(){"use strict";function r(e){var n=this,r=[],t=0,i=0;function o(){t+i===e&&u()}e=e||0;var u=function(){n.then=i?function(e,n){n&&n()}:function(e,n){e&&e()},u=a,c(i?1:0),c=a,r=[]},c=function(e){for(var n,t=0;n=r[t++];)(n=n[e])&&n()};this.then=function(e,n){r.push([e,n])},this.resolve=function(){t++,o()},this.reject=function(){i++,o()},o()}var a=function(){};return function(){for(var e,n=new r(arguments.length),t=0;e=arguments[t++];)e(n);return n}}),fmd("request",["global","config","event"],function(e,a,s){"use strict";var f=e.document,l=e.setTimeout,d=/\.css(?:\?|$)/i,u=/loaded|complete/,c=/security|denied/i,m="requested",g="charset",n=e.navigator.userAgent.toLowerCase(),e=n.match(/.*webkit\/?(\d+)\..*/),h=!!e&&+e[1]<536||!e&&/mobile/.test(n),p=f&&(f.head||f.getElementsByTagName("head")[0]||f.documentElement),v=function(e,n,t){var r,i,o=!1;try{(r=e.sheet)&&(i=r.cssRules,o=i?0<i.length:void 0!==i)}catch(e){o=c.test(e.message)}l(function(){o?(n&&n(),s.emit(m,t)):v(e,n,t)},20)},y=function(e,n,t,r,i){function o(){e.onload=e.onreadystatechange=e.onerror=null,i||a.get("debug")||e.parentNode&&e.parentNode.removeChild(e),e=void 0,n&&n()}t?(e.onload=function(){o(),s.emit(m,r)},e.onerror=function(){o(),s.emit("requestError",r)}):e.onreadystatechange=function(){u.test(e.readyState)&&(o(),s.emit(m,r))}};return function(e,n){var t,r,i,o,u,c=d.test(e.url),t=(t=e,c?((r=f.createElement("link")).rel="stylesheet",r.href=t.url):((r=f.createElement("script")).async=!0,r.src=t.url),a.get(g)&&(r.charset=a.get(g)),s.emit("createNode",r,t),r),r="onload"in t;c?(i=t,o=n,u=e,(c=r)&&!h?y(i,o,c,u,!0):l(function(){v(i,o,u)},1)):y(t,n,r,e),p.appendChild(t)}}),fmd("loader",["global","event","config","request"],function(t,r,i,o){"use strict";function u(){}var c="loading",a="requestComplete";i.set({timeout:1e4}),r.on(a,function(e){var n,t;for(e.state="loaded",t=e.onload;n=t.shift();)n()});return function(e,n){n=n||u,"loaded"!==e.state?e.state!==c?(e.state=c,e.onload=[n],r.emit("request",e,n),e.requested||(e.timer=t.setTimeout(function(){r.emit("requestTimeout",e)},i.get("timeout")),o(e,function(){t.clearTimeout(e.timer),r.emit(a,e)}))):e.onload.push(n):n()}}),fmd("remote",["lang","event","module","assets","when","loader"],function(r,i,o,u,c,t){"use strict";var a={};return a.bring=a.get=function(e,n){c.apply(null,r.map(e,function(n){return function(e){o.has(n.id)?e.resolve():t(n,function(){e.resolve()})}})).then(n)},a.fetch=function(e,n){var t=u.group(e);i.emit("fetch",t),a.bring(t,function(){c.apply(null,r.map(t,function(t){return function(e){var n=o.get(t.id);n&&!n.compiled&&n.deps.length?a.fetch(n,function(){e.resolve()}):e.resolve()}})).then(function(){n.call(null,t)})})},a}),fmd("use",["lang","event","module","remote"],function(r,e,i,o){"use strict";e.on("makeRequire",function(e,t){e.use=function(e,n){r.isArray(e)||(e=[e]),o.fetch({id:t.id,deps:e},function(e){e=r.map(e,function(e){return i.require(e.id)});n&&n.apply(null,e)})}})}),fmd("async",["config","module","remote"],function(e,r,n){"use strict";function i(){var e=this;e.unnamed()&&n.fetch(e,function(){e.compile()})}var o=r.prototype.autocompile;e.register({keys:"async",rule:function(e,n,t){e!==(t=!!t)&&(this.async=t,r.prototype.autocompile=!0===t?i:o)}}).set({async:!0})}),fmd("logger",["global","require","env","config","assets","loader","console"],function(e,r,i,n,o,u,c){"use strict";var a=i.log=function(){},s=e.console;n.register({keys:"debug",rule:function(e,n,t){i.log=t?s&&s.warn?function(e,n){s[n||"log"](e)}:function(e,n){c?c(e,n):u&&u(o.make("fmd/console"),function(){(c=c||r("console"))(e,n)})}:a,this.debug=t}})}),fmd.config({baseUrl:function(){for(var e=/^\w+\:\/\/[\w\-\.:]+\//i,n=/bg?\.alicdn\.com/i,t=y.document.getElementsByTagName("script"),r=t.length-1;0<=r;r--){var i=t[r],i=i.hasAttribute?i.src:i.getAttribute("src",4);if(i&&n.test(i))return(i.match(e)||[""])[0]}var o="";try{var u=location.hostname;u.indexOf("alibaba.com")?o="b.alicdn.com":u.indexOf("1688.com")&&(o="bg.alicdn.com")}catch(e){}return o}()}),fmd("hash",["cache","event","config","lang"],function(e,n,t,r){var u=e.hashmap={},i=t.get("baseUrl"),o=/^[0-9a-f]{8}$/i;n.on("fetch",function(e){r.forEach(e,function(e){var n,t;e.id!==e.url&&(t=e.url.replace(i,""),(n=u[t])&&(o.test(n)?(t=t.substring(t.lastIndexOf(".")),e.url=e.url.replace(new RegExp(t+"$"),"."+n+t)):e.url=i+n))})}),t.register({keys:"hashmap",rule:function(e,n,t){var r,i=[];for(r in t=t||{}){var o=t[r];u[r]&&o!==u[r]?i.push(r):u[r]=o}i.length&&console.log("以下这些模块已经定义过 hash，请勿重复定义！\n"+i.join(", "))}})}),fmd("saga-resource",["cache","event","config","lang"],function(e,n,t,r){var i=t.get("baseUrl");n.on("fetch",function(e){r.forEach(e,function(e){var n;e.id!==e.url&&(0!==(n=e.url).indexOf(i)||(/\.js$/i.test(n=n)||/\.css$/i.test(n))||(e.url+=".js"))})})}),fmd("plugin",["cache","lang","event","config","when","remote"],function(e,i,r,n,t,o){"use strict";var u=e.plugin={},c=/(.+)!(.+)/,a="analyze",s={defaultPlugin:"async",register:function(e,n){u[e]=n},sorting:function(e){var n,t=[],r={};return i.forEach(e,function(e){(-1<r[e.plugin]?t[r[e.plugin]]:(n=r[e.plugin]=t.length,t[n]={group:[],execute:u[e.plugin]})).group.push(e)}),t}};s.register(s.defaultPlugin,function(e){o.get(this.group,e)});function f(e){var n=e.id.match(c);n&&(e.plugin=n[1],e.id=n[2]),u[e.plugin]||(e.plugin=s.defaultPlugin)}function l(e,n){t.apply(null,i.map(s.sorting(e),function(n){return function(e){n.execute?n.execute(function(){e.resolve()}):e.resolve()}})).then(n)}return n.register({keys:"plugin",rule:function(e,n,t){e!==(t=!!t)&&(!0===(this.plugin=t)?(r.on(a,f),o.bring=l):(r.off(a,f),o.bring=o.get))}}).set({plugin:!0}),s}),fmd("combo",["cache","lang","event","config","module","assets","plugin","when","loader","preload"],function(e,a,r,o,u,c,i,n,t,s){"use strict";function f(e){var n=w[0],t=w[1];return n&&0<e.indexOf(n)||t&&0<e.indexOf(t)}function l(n){if(!(n.length<2)){o.get(_)&&(w=o.get(_)),o.get(q)&&(E=o.get(q));for(var e,t,r=[],i=0;i<n.length;i++)(e=n[i]).plugin!==p&&e.plugin!==v||e.comboed||e.state||e.preState||(!x.test(e.url)||f(e.url)?e.url!==e.id?f(e.url)||r.push(e):(t=u.get(e.id))&&!t.compiled&&a.forEach(t.deps,function(e){n.push(c.make(e,t))}):r.push(e));r.length&&function(e,n){var t,r,i,o,u={},c=function(e,n){var t=u[e]={id:"",url:n._host,plugin:y,included:[]};return t};for(o in a.forEach(e,function(e){t=A(e);r=u[t]||c(t,e);i=O(r,e);if(i.length>E){S(r,n);delete u[t];r=c(t,e);i=O(r,e)}r.id+=e.id+" ";r.url=i;r.included.push(e);if(e.plugin===v){r.plugin=b;e.plugin=p}e.comboed=!0;e.requested=!0}),u)S(u[o],n)}(r,n)}}function d(e){a.forEach(e.included,function(e){r.emit("requestComplete",e)})}function m(e){n.apply(null,a.map(this.group,function(n){return function(e){t(n,function(){d(n),e.resolve()})}})).then(e)}function g(e){var n=this.group;s(n,function(){a.forEach(n,function(e){d(e)}),e()})}var h=e.combo={},p="async",v="non",y="_combo",b="_combo_non",_="comboSyntax",q="comboMaxLength",x=/\.css(?:\?|$)/i,k=/(^\w+\:\/\/[\w\-\.:]+\/)(.+)/i,w=["??",","],E=1500,A=function(e){var n=e.url.split("?fmd.stamp")[0],t=n.substring(n.lastIndexOf("."));return function(e,n){e=e.match(k);n._host=e[1],n._path=e[2]}(n,e),[t,e._host].join("_")},S=function(e,n){1<e.included.length||e.plugin===b?(r.emit("stamp",e),h[e.url]=e,n.push(e)):delete e.included[0].requested},O=function(e,n){return e.url+w[e.url===n._host?0:1]+n._path};o.register({keys:"combo",rule:function(e,n,t){e!==(t=!!t)&&(!0===(this.combo=t)?(r.on("fetch",l),i.register(y,m),i.register(b,g)):(r.off("fetch",l),i.register(y,null),i.register(b,null)))}}).set({combo:!0})}),fmd("utils",["lang"],function(e){var r=["??",","],i=/(\?[^\?]+)$/i;return{parseUrl:function(e){if(!e)return{host:"",parts:[],query:""};var n=e.split(r[0]),t=1<n.length?n[0]:"",e=t?n[1]:n[0],n="";return i.test(e)&&(e=e.replace(i,""),n=RegExp.$1),{host:t,parts:e.split(r[1]),query:n}},formatUrl:function(e){return(e.host?e.host+r[0]:"")+e.parts.join(r[1])+e.query}}}),(r=y.fmd).on("createNode",function(e,n){var t;e&&e.src&&(e.src=(t=e.src,void 0===(e=r.config("buildTime"))?t:t+(-1!==t.replace("??","").indexOf("?")?"&":"?")+"_t="+e))}),window.fmd.config({combo:!1}),fmd("script-async",["event","lang","utils"],function(e,c,d){function m(e){return e.replace(n,"").replace(t,".")}var g=0,h=Array.prototype.some?function(e,n,t){return e.some(n,t)}:function(e,n,t){for(var r=0,i=e.length;r<i;r++)if(!0===n.call(t,e[r],r))return!0;return!1},p={},n=/^\w+\:/i,t=/\.[0-9a-f]{8}\./i,v={};e.on("createNode",function(e){e.__fmd__=!0}),e.on("request",function(e,n){var a,t,s,f,l,r,i,o,u;e.comboed||e.requested||(t=(a=d.parseUrl(e.url)).parts,i=n,o=t.length,u=0,s=function(){++u===o&&i()},f=[],l=y.document.scripts,c.forEach(t,function(e){for(var n,t,r=a.host+e,i=0,o=l.length;i<o;i++){var u=l[i];if(!u.__fmd__){var c=(t=void 0,(t=(n=u).__async__)||(t=n.__async__=g++,(n.async||n.defer)&&(n=n.hasAttribute?n.src:n.getAttribute("src",4),/bg?\.alicdn\.com/i.test(n)&&(p[t]=d.parseUrl(n)))),p[t]);if(c&&h(c.parts,function(e){return m(r)===m(c.host+e)}))return void function(n,e){var t,r=n.__onload__;r||(r=n.__onload__=g++,v[r]=[],t=function(){n.onload=n.onreadystatechange=n.onerror=null;for(var e;e=v[r].shift();)e()},"onload"in n?n.onload=n.onerror=t:n.onreadystatechange=function(){"loaded"!==n.readyState&&"complete"!==n.readyState||t()}),v[r].push(e)}(u,s)}}f.push(e)}),0===f.length?e.requested=!0:f.length!==t.length&&(e.url=d.formatUrl({host:a.host,parts:f,query:a.query}),e.onload[e.onload.length-1]=(r=f.length,function(){for(;0<r--;)s()})))})}),n=y.__def=y.fmd.define,y.fmd.noConflict(),t=y.b2bLoader=y.fmd,n("loader",[],function(){return t}),y.fmd=e||null)}(window);
