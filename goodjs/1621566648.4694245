define(["OK/logger"],(function(e){var t=null,n=[],r="",d=[];function a(e){for(var t=[],n=[],r=[],a=0;a<e.length;a++)"file"===e[a].kind&&t.push(e[a]);return t.forEach((function(e){d.some((function(t){return e.type.match(t)}))?n.push(e):r.push(e)})),{supported:n,unsupported:r}}function s(r){t.classList.contains("__enabled")||e.success("dnd.layer","drag_started"),r.preventDefault();var d=n.some((function(e){return function(e,t){var n=document.querySelector(e);if(!n)return!1;var r=n.getBoundingClientRect();return r.top<=t.y&&r.bottom>=t.y&&r.left<=t.x&&r.right>=t.x}(e,r)})),s=r.dataTransfer&&r.dataTransfer.items,o=!OK.Layers.isAnyLayerOpened()&&!d&&(!(s.length>0)||a(s).supported.length);t.classList.toggle("__enabled",o)}function o(){e.success("dnd.layer","drag_ended"),t.classList.toggle("__enabled",!1)}function u(n){e.success("dnd.layer","dropped"),n.preventDefault(),t.classList.toggle("__enabled",!1);var d=a(n.dataTransfer&&n.dataTransfer.items),s=d.supported,o=d.unsupported;(s=s.map((function(e){return e.getAsFile()}))).length&&require([r],(function(e){e.performUpload(s)})),o.forEach((function(t){e.success("dnd.layer","unsupported_file_type",t.type)})),e.success("dnd.layer","uploaded")}return{activate:function(e){t=e.querySelector(".dnd-overlay"),r=t.getAttribute("data-upload-handler"),n=t.getAttribute("data-exclude-selectors").split(";"),d=t.getAttribute("data-media-types").split(";"),t&&(document.body.addEventListener("dragenter",s),t.addEventListener("dragover",s),t.addEventListener("dragleave",o),t.addEventListener("dragend",o),t.addEventListener("drop",u))},deactivate:function(){t&&(document.body.removeEventListener("dragenter",s),t.removeEventListener("dragover",s),t.removeEventListener("dragleave",o),t.removeEventListener("dragend",o),t.removeEventListener("drop",u))}}}));