!function(window,$,undefined){var can=window.can||{};"undefined"!=typeof GLOBALCAN&&!1===GLOBALCAN||(window.can=can),can.isDeferred=function(e){var t=this.isFunction;return e&&t(e.then)&&t(e.pipe)},can.each=function(e,t,n){var r,a=0;if(e)if("number"==typeof e.length&&e.pop)for(e.attr&&e.attr("length"),r=e.length;a<r&&!1!==t.call(n||e[a],e[a],a,e);a++);else if(e.hasOwnProperty)for(r in e)if(e.hasOwnProperty(r)&&!1===t.call(n||e[r],e[r],r,e))break;return e},$.extend(can,$,{trigger:function(e,t,n){e.trigger?e.trigger(t,n):$.event.trigger(t,n,e,!0)},addEvent:function(e,t){return $([this]).bind(e,t),this},removeEvent:function(e,t){return $([this]).unbind(e,t),this},buildFragment:function(e,t){t=$.buildFragment([e],$(t));return t.cacheable?$.clone(t.fragment):t.fragment},$:$,each:can.each}),$.each(["bind","unbind","undelegate","delegate"],function(e,t){can[t]=function(){var e=this[t]?this:$([this]);return e[t].apply(e,arguments),this}}),$.each(["append","filter","addClass","remove","data","get"],function(e,t){can[t]=function(e){return e[t].apply(e,can.makeArray(arguments).slice(1))}});var oldClean=$.cleanData;$.cleanData=function(e){$.each(e,function(e,t){t&&can.trigger(t,"destroyed",[],!1)}),oldClean(e)};var undHash=/_|-/,colons=/\=\=/,words=/([A-Z]+)([A-Z][a-z])/g,lowUp=/([a-z\d])([A-Z])/g,dash=/([a-z\d])([A-Z])/g,replacer=/\{([^\}]+)\}/g,quote=/"/g,singleQuote=/'/g,getNext=function(e,t,n){return t in e?e[t]:n&&(e[t]={})},isContainer=function(e){return/^f|^o/.test(typeof e)};can.extend(can,{esc:function(e){return(""+(null===e||e===undefined||isNaN(e)&&""+e=="NaN"?"":e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(quote,"&#34;").replace(singleQuote,"&#39;")},getObject:function(e,t,n){var r,a,i,c=e?e.split("."):[],s=c.length,o=0;if(t=can.isArray(t)?t:[t||window],!s)return t[0];for(;t[o];){for(r=t[o],i=0;i<s-1&&isContainer(r);i++)r=getNext(r,c[i],n);if(isContainer(r)&&(a=getNext(r,c[i],n))!==undefined)return!1===n&&delete r[c[i]],a;o++}},capitalize:function(e,t){return e.charAt(0).toUpperCase()+e.slice(1)},underscore:function(e){return e.replace(colons,"/").replace(words,"$1_$2").replace(lowUp,"$1_$2").replace(dash,"_").toLowerCase()},sub:function(e,n,r){var a=[];return a.push(e.replace(replacer,function(e,t){t=can.getObject(t,n,r===undefined?r:!r);return t===undefined?(a=null,""):isContainer(t)&&a?(a.push(t),""):""+t})),null!==a&&a.length<=1?a[0]:a},replacer:replacer,undHash:undHash});var initializing=0;can.Construct=function(){if(arguments.length)return can.Construct.extend.apply(can.Construct,arguments)},can.extend(can.Construct,{newInstance:function(){var e,t=this.instance();return t.setup&&(e=t.setup.apply(t,arguments)),t.init&&t.init.apply(t,e||arguments),t},_inherit:function(e,t,n){can.extend(n||e,e||{})},_overwrite:function(e,t,n,r){e[n]=r},setup:function(e,t){this.defaults=can.extend(!0,{},e.defaults,this.defaults)},instance:function(){initializing=1;var e=new this;return initializing=0,e},extend:function(e,t,n){"string"!=typeof e&&(n=t,t=e,e=null),n||(n=t,t=null),n=n||{};var r,a,i,c,s=this,o=this.prototype;function u(){if(!initializing)return this.constructor!==u&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.constructor.newInstance.apply(this.constructor,arguments)}for(r in a=this.instance(),can.Construct._inherit(n,o,a),s)s.hasOwnProperty(r)&&(u[r]=s[r]);can.Construct._inherit(t,s,u),e&&(i=(h=e.split(".")).pop(),c=o=can.getObject(h.join("."),window,!0),d=can.underscore(e.replace(/\./g,"_")),h=can.underscore(i),o[i]=u),can.extend(u,{constructor:u,prototype:a,namespace:c,shortName:i,_shortName:h,fullName:e,_fullName:d}),u.prototype.constructor=u;var h=[s].concat(can.makeArray(arguments)),d=u.setup.apply(u,h);return u.init&&u.init.apply(u,d||h),u}});var canMakeObserve=function(e){return e&&(can.isArray(e)||can.isPlainObject(e)||e instanceof can.Observe)},unhookup=function(e,t){return can.each(e,function(e){e&&e.unbind&&e.unbind("change"+t)})},hookupBubble=function(n,r,a,e,t){return e=e||Observe,t=t||Observe.List,n instanceof Observe?unhookup([n],a._cid):n=new(can.isArray(n)?t:e)(n),n.bind("change"+a._cid,function(){var e=can.makeArray(arguments),t=e.shift();e[0]=("*"===r?[a.indexOf(n),e[0]]:[r,e[0]]).join("."),t.triggeredNS=t.triggeredNS||{},t.triggeredNS[a._cid]||(t.triggeredNS[a._cid]=!0,can.trigger(a,t,e))}),n},observeId=0,serialize=function(e,n,r){return e.each(function(e,t){r[t]=canMakeObserve(e)&&can.isFunction(e[n])?e[n]():e}),r},$method=function(e){return function(){return can[e].apply(this,arguments)}},bind=$method("addEvent"),unbind=$method("removeEvent"),attrParts=function(e){return can.isArray(e)?e:(""+e).split(".")},batchNum=1,transactions=0,batchEvents=[],stopCallbacks=[],cid=0;can.cid=function(e,t){return e._cid||(e._cid=(t||"")+ ++cid)};var Observe=can.Observe=can.Construct({bind:bind,unbind:unbind,id:"id",canMakeObserve:canMakeObserve,startBatch:function(e){transactions++,e&&stopCallbacks.push(e)},stopBatch:function(e,t){var n;e?transactions=0:transactions--,0==transactions&&(n=batchEvents.slice(0),e=stopCallbacks.slice(0),batchEvents=[],stopCallbacks=[],batchNum++,t&&this.startBatch(),can.each(n,function(e){can.trigger.apply(can,e)}),can.each(e,function(e){}))},triggerBatch:function(e,t,n){if(!e._init){if(0==transactions)return can.trigger(e,t,n);batchEvents.push([e,{type:t,batchNum:batchNum},n])}},keys:function(e){var t,n=[];for(t in Observe.__reading&&Observe.__reading(e,"__keys"),e._data)n.push(t);return n}},{setup:function(e){this._data={},can.cid(this,".observe"),this._init=1,this.attr(e),this.bind("change"+this._cid,can.proxy(this._changes,this)),delete this._init},_changes:function(e,t,n,r,a){Observe.triggerBatch(this,{type:t,batchNum:e.batchNum},[r,a])},attr:function(e,t){var n=typeof e;return"string"!=n&&"number"!=n?this._attrs(e,t):t===undefined?(Observe.__reading&&Observe.__reading(this,e),this._get(e)):(this._set(e,t),this)},each:function(){return Observe.__reading&&Observe.__reading(this,"__keys"),can.each.apply(undefined,[this.__get()].concat(can.makeArray(arguments)))},removeAttr:function(e){var t=attrParts(e),n=t.shift(),e=this._data[n];return t.length?e.removeAttr(t):(n in this._data&&(delete this._data[n],n in this.constructor.prototype||delete this[n],Observe.triggerBatch(this,"__keys",undefined),Observe.triggerBatch(this,"change",[n,"remove",undefined,e]),Observe.triggerBatch(this,n,[undefined,e])),e)},_get:function(e){var t=attrParts(e),e=this.__get(t.shift());return t.length?e?e._get(t):undefined:e},__get:function(e){return e?this._data[e]:this._data},_set:function(e,t){var n=attrParts(e),r=n.shift(),e=this.__get(r);if(canMakeObserve(e)&&n.length)e._set(n,t);else{if(n.length)throw"can.Observe: Object does not exist";this.__convert&&(t=this.__convert(r,t)),e||Observe.triggerBatch(this,"__keys",undefined),this.__set(r,t,e)}},__set:function(e,t,n){var r;t!==n&&(r=this.__get().hasOwnProperty(e)?"set":"add",this.___set(e,canMakeObserve(t)?hookupBubble(t,e,this):t),Observe.triggerBatch(this,"change",[e,r,t,n]),n&&unhookup([n],this._cid))},___set:function(e,t){this._data[e]=t,e in this.constructor.prototype||(this[e]=t)},bind:bind,unbind:unbind,serialize:function(){return serialize(this,"serialize",{})},_attrs:function(r,a){if(r===undefined)return serialize(this,"attr",{});r=can.extend(!0,{},r);var i,e,c=this;for(e in Observe.startBatch(),this.each(function(e,t,n){(i=r[t])!==undefined?(e!==(i=c.__convert?c.__convert(t,i):i)&&(e instanceof can.Observe&&i instanceof can.Observe&&unhookup([e],c._cid),i instanceof can.Observe?c._set(t,i):canMakeObserve(e)&&canMakeObserve(i)?e.attr(i,n):e!=i&&c._set(t,i)),delete r[t]):a&&c.removeAttr(t)}),r)i=r[e],this._set(e,i);return Observe.stopBatch(),this}}),splice=[].splice,list=Observe({setup:function(e,t){this.length=0,can.cid(this,".observe"),this._init=1,this.push.apply(this,can.makeArray(e||[])),this.bind("change"+this._cid,can.proxy(this._changes,this)),can.extend(this,t),delete this._init},_changes:function(e,t,n,r,a){~t.indexOf(".")||("add"===n?(Observe.triggerBatch(this,n,[r,+t]),Observe.triggerBatch(this,"length",[this.length])):"remove"===n?(Observe.triggerBatch(this,n,[a,+t]),Observe.triggerBatch(this,"length",[this.length])):Observe.triggerBatch(this,n,[r,+t])),Observe.prototype._changes.apply(this,arguments)},__get:function(e){return e?this[e]:this},___set:function(e,t){this[e]=t,+e>=this.length&&(this.length=+e+1)},serialize:function(){return serialize(this,"serialize",[])},splice:function(e,t){for(var n=can.makeArray(arguments),r=2;r<n.length;r++){var a=n[r];canMakeObserve(a)&&(n[r]=hookupBubble(a,"*",this))}t===undefined&&(t=n[1]=this.length-e);var i=splice.apply(this,n);return 0<t&&(Observe.triggerBatch(this,"change",[""+e,"remove",undefined,i]),unhookup(i,this._cid)),2<n.length&&Observe.triggerBatch(this,"change",[""+e,"add",n.slice(2),i]),i},_attrs:function(e,t){if(e===undefined)return serialize(this,"attr",[]);e=can.makeArray(e),Observe.startBatch(),this._updateAttrs(e,t),Observe.stopBatch()},_updateAttrs:function(e,t){for(var n=Math.min(e.length,this.length),r=0;r<n;r++){var a=this[r],i=e[r];canMakeObserve(a)&&canMakeObserve(i)?a.attr(i,t):a!=i&&this._set(r,i)}e.length>this.length?this.push.apply(this,e.slice(this.length)):e.length<this.length&&t&&this.splice(e.length)}}),getArgs=function(e){return e[0]&&can.isArray(e[0])?e[0]:can.makeArray(e)};can.each({push:"length",unshift:0},function(i,c){list.prototype[c]=function(){for(var e=can.makeArray(arguments),t=i?this.length:0,n=0;n<e.length;n++){var r=e[n];canMakeObserve(r)&&(e[n]=hookupBubble(r,"*",this,this.constructor.Observe,this.constructor))}var a=[][c].apply(this,e);return this.comparator&&e.length||Observe.triggerBatch(this,"change",[""+t,"add",e,undefined]),a}}),can.each({pop:"length",shift:0},function(n,r){list.prototype[r]=function(){var e=getArgs(arguments),t=n&&this.length?this.length-1:0,e=[][r].apply(this,e);return Observe.triggerBatch(this,"change",[""+t,"remove",undefined,[e]]),e&&e.unbind&&e.unbind("change"+this._cid),e}}),can.extend(list.prototype,{indexOf:function(e){return this.attr("length"),can.inArray(e,this)},join:[].join,slice:function(){var e=Array.prototype.slice.apply(this,arguments);return new this.constructor(e)},concat:function(){var n=[];return can.each(can.makeArray(arguments),function(e,t){n[t]=e instanceof can.Observe.List?e.serialize():e}),new this.constructor(Array.prototype.concat.apply(this.serialize(),n))},forEach:function(e,t){can.each(this,e,t||this)}}),Observe.List=list,Observe.setup=function(){can.Construct.setup.apply(this,arguments),this.List=Observe.List({Observe:this},{})};var pipe=function(e,t,n){var r=new can.Deferred;return e.then(function(){var e=can.makeArray(arguments);e[0]=t[n](e[0]),r.resolveWith(r,e)},function(){r.rejectWith(this,arguments)}),"function"==typeof e.abort&&(r.abort=function(){return e.abort()}),r},modelNum=0,ignoreHookup=/change.observe\d+/,getId=function(e){return can.Observe.__reading&&can.Observe.__reading(e,e.constructor.id),e.__get(e.constructor.id)},ajax=function(e,t,n,r,a,i){var c,s={};return"string"==typeof e?(c=e.split(/\s/),s.url=c.pop(),c.length&&(s.type=c.pop())):can.extend(s,e),s.data="object"!=typeof t||can.isArray(t)?t:can.extend(s.data||{},t),s.url=can.sub(s.url,s.data,!0),can.ajax(can.extend({type:n||"post",dataType:r||"json",success:a,error:i},s))},makeRequest=function(t,n,e,r,a){var i,c=[t.serialize()],s=t.constructor;return"destroy"==n&&c.shift(),"create"!==n&&c.unshift(getId(t)),c=(i=s[n].apply(s,c)).pipe(function(e){return t[a||n+"d"](e,i),t}),i.abort&&(c.abort=function(){i.abort()}),c.then(e,r),c},ajaxMethods={create:{url:"_shortName",type:"post"},update:{data:function(e,t){var n=this.id;return(t=t||{})[n]&&t[n]!==e&&(t["new"+can.capitalize(e)]=t[n],delete t[n]),t[n]=e,t},type:"put"},destroy:{type:"delete",data:function(e){var t={};return t.id=t[this.id]=e,t}},findAll:{url:"_shortName"},findOne:{}},ajaxMaker=function(t,n){return function(e){return e=t.data?t.data.apply(this,arguments):e,ajax(n||this[t.url||"_url"],e,t.type||"get")}};can.Model=can.Observe({fullName:"can.Model",setup:function(r){var a,i;this.store={},can.Observe.setup.apply(this,arguments),can.Model&&(this.List=ML({Observe:this},{}),i=can.proxy((a=this)._clean,a),can.each(ajaxMethods,function(e,t){var n;can.isFunction(a[t])||(a[t]=ajaxMaker(e,a[t])),a["make"+can.capitalize(t)]&&(n=a["make"+can.capitalize(t)](a[t]),can.Construct._overwrite(a,r,t,function(){this._reqs++;var e=n.apply(this,arguments),t=e.then(i,i);return t.abort=e.abort,t}))}),"can.Model"!=a.fullName&&a.fullName||(a.fullName="Model"+ ++modelNum),this._reqs=0,this._url=this._shortName+"/{"+this.id+"}")},_ajax:ajaxMaker,_clean:function(){if(this._reqs--,!this._reqs)for(var e in this.store)this.store[e]._bindings||delete this.store[e];return arguments[0]},models:function(e,t){if(e){if(e instanceof this.List)return e;var n=this,r=[],a=t instanceof can.Observe.List?t:new(n.List||ML),i=can.isArray(e),t=i?e:e instanceof ML?e.serialize():e.data;return 0<a.length&&a.splice(0),can.each(t,function(e){r.push(n.model(e))}),a.push.apply(a,r),i||can.each(e,function(e,t){"data"!==t&&a.attr(t,e)}),a}},model:function(e){if(e){var t=(e=e instanceof this?e.serialize():e)[this.id],t=t&&this.store[t]?this.store[t].attr(e):new this(e);return this._reqs&&(this.store[e[this.id]]=t),t}}},{isNew:function(){var e=getId(this);return!(e||0===e)},save:function(e,t){return makeRequest(this,this.isNew()?"create":"update",e,t)},destroy:function(e,t){return makeRequest(this,"destroy",e,t,"destroyed")},bind:function(e){return ignoreHookup.test(e)||(this._bindings||((this.constructor.store[getId(this)]=this)._bindings=0),this._bindings++),can.Observe.prototype.bind.apply(this,arguments)},unbind:function(e){return ignoreHookup.test(e)||(this._bindings--,this._bindings||delete this.constructor.store[getId(this)]),can.Observe.prototype.unbind.apply(this,arguments)},___set:function(e,t){can.Observe.prototype.___set.call(this,e,t),e===this.constructor.id&&this._bindings&&(this.constructor.store[getId(this)]=this)}}),can.each({makeFindAll:"models",makeFindOne:"model"},function(a,e){can.Model[e]=function(r){return function(e,t,n){e=pipe(r.call(this,e),this,a);return e.then(t,n),e}}}),can.each(["created","updated","destroyed"],function(n){can.Model.prototype[n]=function(e){var t=this.constructor;e&&"object"==typeof e&&this.attr(e.attr?e.attr():e);can.trigger(this,n),can.trigger(this,"change",n),can.trigger(t,n,this)}});var ML=can.Model.List=can.Observe.List({setup:function(){can.Observe.List.prototype.setup.apply(this,arguments);var n=this;this.bind("change",function(e,t){!/\w+\.destroyed/.test(t)||-1!=(e=n.indexOf(e.target))&&n.splice(e,1)})}}),digitTest=/^\d+$/,keyBreaker=/([^\[\]]+)|(\[\])/g,paramTest=/([^?#]*)(#.*)?$/,prep=function(e){return decodeURIComponent(e.replace(/\+/g," "))};can.extend(can,{deparam:function(e){var c,s={};return e&&paramTest.test(e)&&(e=e.split("&"),can.each(e,function(e){for(var t=e.split("="),n=prep(t.shift()),e=prep(t.join("=")),r=s,a=0,i=(t=n.match(keyBreaker)).length-1;a<i;a++)r[t[a]]||(r[t[a]]=digitTest.test(t[a+1])||"[]"==t[a+1]?[]:{}),r=r[t[a]];"[]"==(c=t.pop())?r.push(e):r[c]=e})),s}});var matcher=/\:([\w\.]+)/g,paramsMatcher=/^(?:&[^=]+=[^&]*)+/,makeProps=function(e){var n=[];return can.each(e,function(e,t){n.push(("className"===t?"class":t)+'="'+("href"===t?e:can.esc(e))+'"')}),n.join(" ")},matchesData=function(e,t){var n,r=0,a=0,i={};for(n in e.defaults)e.defaults[n]===t[n]&&(i[n]=1,r++);for(;a<e.names.length;a++){if(!t.hasOwnProperty(e.names[a]))return-1;i[e.names[a]]||r++}return r},onready=!0,location=window.location,wrapQuote=function(e){return(e+"").replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1")},each=can.each,extend=can.extend;can.route=function(r,a){a=a||{};var i=[],e=r.replace(matcher,function(e,t,n){return i.push(t),"([^"+("\\"+(r.substr(n+e.length,1)||can.route._querySeparator))+"]"+(a[t]?"*":"+")+")"});return can.route.routes[r]={test:new RegExp("^"+e+"($|"+wrapQuote(can.route._querySeparator)+")"),route:r,names:i,defaults:a,length:r.split("/").length},can.route},extend(can.route,{_querySeparator:"&",_paramsMatcher:paramsMatcher,param:function(n,e){var r,a,i=0,t=n.route,c=0;if(delete n.route,each(n,function(){c++}),each(can.route.routes,function(e,t){if(a=matchesData(e,n),i<a&&(r=e,i=a),c<=a)return!1}),r=can.route.routes[t]&&matchesData(can.route.routes[t],n)===i?can.route.routes[t]:r){var s=extend({},n),o=r.route.replace(matcher,function(e,t){return delete s[t],n[t]===r.defaults[t]?"":encodeURIComponent(n[t])});return each(r.defaults,function(e,t){s[t]===e&&delete s[t]}),t=can.param(s),e&&can.route.attr("route",r.route),o+(t?can.route._querySeparator+t:"")}return can.isEmptyObject(n)?"":can.route._querySeparator+can.param(n)},deparam:function(n){var r={length:-1};if(each(can.route.routes,function(e,t){e.test.test(n)&&e.length>r.length&&(r=e)}),-1<r.length){var e=n.match(r.test),t=e.shift(),t=n.substr(t.length-(e[e.length-1]===can.route._querySeparator?1:0)),a=t&&can.route._paramsMatcher.test(t)?can.deparam(t.slice(1)):{},a=extend(!0,{},r.defaults,a);return each(e,function(e,t){e&&e!==can.route._querySeparator&&(a[r.names[t]]=decodeURIComponent(e))}),a.route=r.route,a}return n.charAt(0)!==can.route._querySeparator&&(n=can.route._querySeparator+n),can.route._paramsMatcher.test(n)?can.deparam(n.slice(1)):{}},data:new can.Observe({}),routes:{},ready:function(e){return!1===e&&(onready=e),!0!==e&&!0!==onready||(can.route._setup(),setState()),can.route},url:function(e,t){return t&&(e=extend({},curParams,e)),"#!"+can.route.param(e)},link:function(e,t,n,r){return"<a "+makeProps(extend({href:can.route.url(t,r)},n))+">"+e+"</a>"},current:function(e){return location.hash=="#!"+can.route.param(e)},_setup:function(){can.bind.call(window,"hashchange",setState)},_getHash:function(){return location.href.split(/#!?/)[1]||""},_setHash:function(e){e=can.route.param(e,!0);return location.hash="#!"+e,e}}),each(["bind","unbind","delegate","undelegate","attr","removeAttr"],function(e){can.route[e]=function(){return can.route.data[e].apply(can.route.data,arguments)}});var timer,curParams,setState=can.route.setState=function(){var e=can.route._getHash();curParams=can.route.deparam(e),changingData&&e===lastHash||can.route.attr(curParams,!0)},lastHash,changingData;can.route.bind("change",function(e,t){changingData=1,clearTimeout(timer),timer=setTimeout(function(){changingData=0;var e=can.route.data.serialize();lastHash=can.route._setHash(e)},1)}),can.bind.call(document,"ready",can.route.ready),can.route.constructor.canMakeObserve=can.Observe.canMakeObserve;var bind=function(e,t,n){return can.bind.call(e,t,n),function(){can.unbind.call(e,t,n)}},isFunction=can.isFunction,extend=can.extend,each=can.each,slice=[].slice,paramReplacer=/\{([^\}]+)\}/g,special=can.getObject("$.event.special")||{},delegate=function(e,t,n,r){return can.delegate.call(e,t,n,r),function(){can.undelegate.call(e,t,n,r)}},binder=function(e,t,n,r){return r?delegate(e,can.trim(r),t,n):bind(e,t,n)},basicProcessor,Control=can.Control=can.Construct({setup:function(){if(can.Construct.setup.apply(this,arguments),can.Control){var e,t=this;for(e in t.actions={},t.prototype)t._isAction(e)&&(t.actions[e]=t._action(e))}},_shifter:function(e,t){var n="string"==typeof t?e[t]:t;return isFunction(n)||(n=e[n]),function(){return e.called=t,n.apply(e,[this.nodeName?can.$(this):this].concat(slice.call(arguments,0)))}},_isAction:function(e){var t=this.prototype[e],n=typeof t;return"constructor"!==e&&("function"==n||"string"==n&&isFunction(this.prototype[t]))&&!!(special[e]||processors[e]||/[^\w]/.test(e))},_action:function(e,t){if(paramReplacer.lastIndex=0,t||!paramReplacer.test(e)){var n=t?can.sub(e,[t,window]):e;if(!n)return null;var r=can.isArray(n),a=r?n[1]:n,t=a.split(/\s+/g),e=t.pop();return{processor:processors[e]||basicProcessor,parts:[a,t.join(" "),e],delegate:r?n[0]:undefined}}},processors:{},defaults:{}},{setup:function(e,t){var n=this.constructor,r=n.pluginName||n._fullName;return this.element=can.$(e),r&&"can_control"!==r&&this.element.addClass(r),(r=can.data(this.element,"controls"))||can.data(this.element,"controls",r=[]),r.push(this),this.options=extend({},n.defaults,t),this.on(),[this.element,this.options]},on:function(e,t,n,r){if(e)return"string"==typeof e&&(r=n,n=t,t=e,e=this.element),r===undefined&&(r=n,n=t,t=null),"string"==typeof r&&(r=can.Control._shifter(this,r)),this._bindings.push(binder(e,n,r,t)),this._bindings.length;this.off();var a,i,c=this.constructor,s=this._bindings,o=c.actions,u=this.element,h=can.Control._shifter(this,"destroy");for(a in o)o.hasOwnProperty(a)&&(i=o[a]||c._action(a,this.options))&&s.push(i.processor(i.delegate||u,i.parts[2],i.parts[1],a,this));return can.bind.call(u,"destroyed",h),s.push(function(e){can.unbind.call(e,"destroyed",h)}),s.length},off:function(){var t=this.element[0];each(this._bindings||[],function(e){e(t)}),this._bindings=[]},destroy:function(){var e=this.constructor,e=e.pluginName||e._fullName;this.off(),e&&"can_control"!==e&&this.element.removeClass(e),(e=can.data(this.element,"controls")).splice(can.inArray(this,e),1),can.trigger(this,"destroyed"),this.element=null}}),processors=can.Control.processors,basicProcessor=function(e,t,n,r,a){return binder(e,t,can.Control._shifter(a,r),n)};each(["change","click","contextmenu","dblclick","keydown","keyup","keypress","mousedown","mousemove","mouseout","mouseover","mouseup","reset","resize","scroll","select","submit","focusin","focusout","mouseenter","mouseleave","touchstart","touchmove","touchcancel","touchend","touchleave"],function(e){processors[e]=basicProcessor}),can.Control.processors.route=function(e,t,r,a,i){r=r||"",can.route(r);function n(e,t,n){can.route.attr("route")!==r||e.batchNum!==undefined&&e.batchNum===c||(c=e.batchNum,delete(e=can.route.attr()).route,can.isFunction(i[a])?i[a](e):i[i[a]](e))}var c;return can.route.bind("change",n),function(){can.route.unbind("change",n)}};var isFunction=can.isFunction,makeArray=can.makeArray,hookupId=1,$view=can.view=function(e,t,n,r){r=$view.render(e,t,n,r);return isFunction(r)?r:can.isDeferred(r)?r.pipe(function(e){return $view.frag(e)}):$view.frag(r)};can.extend($view,{frag:function(e,t){return $view.hookup($view.fragment(e),t)},fragment:function(e){e=can.buildFragment(e,document.body);return e.childNodes.length||e.appendChild(document.createTextNode("")),e},toId:function(e){return can.map(e.toString().split(/\/|\./g),function(e){if(e)return e}).join("_")},hookup:function(e,t){var n,r,a=[];return can.each(e.childNodes?can.makeArray(e.childNodes):e,function(e){1===e.nodeType&&(a.push(e),a.push.apply(a,can.makeArray(e.getElementsByTagName("*"))))}),can.each(a,function(e){e.getAttribute&&(n=e.getAttribute("data-view-id"))&&(r=$view.hookups[n])&&(r(e,t,n),delete $view.hookups[n],e.removeAttribute("data-view-id"))}),e},hookups:{},hook:function(e){return $view.hookups[++hookupId]=e," data-view-id='"+hookupId+"'"},cached:{},cachedRenderers:{},cache:!0,register:function(e){this.types["."+e.suffix]=e},types:{},ext:".ejs",registerScript:function(){},preload:function(){},render:function(e,a,i,c){isFunction(i)&&(c=i,i=undefined);var t=getDeferreds(a);if(t.length){var s=new can.Deferred;return t.push(get(e,!0)),can.when.apply(can,t).then(function(e){var t=makeArray(arguments),n=t.pop();if(can.isDeferred(a))a=usefulPart(e);else for(var r in a)can.isDeferred(a[r])&&(a[r]=usefulPart(t.shift()));n=n(a,i),s.resolve(n),c&&c(n)}),s}var n,t=isFunction(c),s=get(e,t);if(t)(n=s).then(function(e){c(a?e(a,i):e)});else{if("resolved"===s.state()&&s.__view_id){t=$view.cachedRenderers[s.__view_id];return a?t(a,i):t}s.then(function(e){n=a?e(a,i):e})}return n},registerView:function(e,t,n,r){t=(n||$view.types[$view.ext]).renderer(e,t);return r=r||new can.Deferred,$view.cache&&(($view.cached[e]=r).__view_id=e,$view.cachedRenderers[e]=t),r.resolve(t)}});var checkText=function(e,t){if(!e.length)throw"can.view: No template or empty template:"+t},get=function(t,e){var n,r,a,i,c=t.match(/\.[\w\d]+$/);if(t.match(/^#/)&&(t=t.substr(1)),(c=(r=document.getElementById(t))?"."+r.type.match(/\/(x\-)?(.+)/)[2]:c)||$view.cached[t]||(t+=c=$view.ext),can.isArray(c)&&(c=c[0]),a=$view.toId(t),t.match(/^\/\//)&&(i=t.substr(2),t=window.steal?steal.config().root.mapJoin(i):i),n=$view.types[c],$view.cached[a])return $view.cached[a];if(r)return $view.registerView(a,r.innerHTML,n);var s=new can.Deferred;return can.ajax({async:e,url:t,dataType:"text",error:function(e){checkText("",t),s.reject(e)},success:function(e){checkText(e,t),$view.registerView(a,e,n,s)}}),s},getDeferreds=function(e){var t,n=[];if(can.isDeferred(e))return[e];for(t in e)can.isDeferred(e[t])&&n.push(e[t]);return n},usefulPart=function(e){return can.isArray(e)&&"success"===e[1]?e[0]:e};window.steal&&steal.type("view js",function(e,t,n){var r=$view.types["."+e.type],a=$view.toId(e.id);e.text="steal('"+(r.plugin||"can/view/"+e.type)+"',function(can){return can.view.preload('"+a+"',"+e.text+");\n})",t()}),can.extend($view,{register:function(n){this.types["."+n.suffix]=n,window.steal&&steal.type(n.suffix+" view js",function(e,t,n){var r=$view.types["."+e.type],a=$view.toId(e.id+"");e.text=r.script(a,e.text),t()}),$view[n.suffix]=function(e,t){return t?($view.preload(e,n.renderer(e,t)),can.view(e)):n.renderer(null,e)}},registerScript:function(e,t,n){return"can.view.preload('"+t+"',"+$view.types["."+e].script(t,n)+");"},preload:function(e,n){return $view.cached[e]=(new can.Deferred).resolve(function(e,t){return n.call(e,e,t)}),function(){return $view.frag(n.apply(this,arguments))}}});var getValueAndObserved=function(e,t){var n;can.Observe&&(n=can.Observe.__reading,can.Observe.__reading=function(e,t){r.push({obj:e,attr:t})});var r=[],t=e.call(t);return can.Observe&&(can.Observe.__reading=n),{value:t,observed:r}},computeBinder=function(a,i,r){var c,s={},o=!0,u={value:undefined,teardown:function(){for(var e in s){var t=s[e];t.observe.obj.unbind(t.observe.attr,h),delete s[e]}}},h=function(e){var t,n;e.batchNum!==undefined&&e.batchNum===c||(t=u.value,n=d(),(u.value=n)!==t&&r(n,t),c=e.batchNum)},d=function(){var e,t=getValueAndObserved(a,i),n=t.observed,t=t.value;for(e in o=!o,can.each(n,function(e){s[e.obj._cid+"|"+e.attr]?s[e.obj._cid+"|"+e.attr].matched=o:(s[e.obj._cid+"|"+e.attr]={matched:o,observe:e},e.obj.bind(e.attr,h))}),s){var r=s[e];r.matched!==o&&(r.observe.obj.unbind(r.observe.attr,h),delete s[e])}return t};return u.value=d(),u.isListening=!can.isEmptyObject(s),u};can.compute=function(n,r){if(n&&n.isComputed)return n;var a,i,c=0,s=!0;return"function"==typeof n?i=function(e){return e===undefined?a?(c&&can.Observe.__reading&&can.Observe.__reading(i,"change"),a.value):n.call(r||this):n.apply(r||this,arguments)}:s=!(i=function(e){if(e===undefined)return can.Observe.__reading&&can.Observe.__reading(i,"change"),n;var t=n;return t!==(n=e)&&can.Observe.triggerBatch(i,"change",[e,t]),e}),i.isComputed=!0,i.bind=function(e,t){can.addEvent.apply(i,arguments),0===c&&s&&(a=computeBinder(n,r||this,function(e,t){can.Observe.triggerBatch(i,"change",[e,t])})),c++},i.unbind=function(e,t){can.removeEvent.apply(i,arguments),0===--c&&s&&a.teardown()},i},can.compute.binder=computeBinder;var newLine=/(\r|\n)+/g,tagToContentPropMap={option:"textContent",textarea:"value"},clean=function(e){return e.split("\\").join("\\\\").split("\n").join("\\n").split('"').join('\\"').split("\t").join("\\t")},reverseTagMap={tr:"tbody",option:"select",td:"tr",li:"ul"},getTag=function(e,t,n){if(e)return e;for(;n<t.length;){if("<"==t[n]&&reverseTagMap[t[n+1]])return reverseTagMap[t[n+1]];n++}},bracketNum=function(e){return--e.split("{").length- --e.split("}").length},myEval=function(script){eval(script)},attrReg=/([^\s]+)[\s]*=[\s]*$/,startTxt="var ___v1ew = [];",finishTxt="return ___v1ew.join('')",put_cmd="___v1ew.push(",insert_cmd=put_cmd,htmlTag=null,quote=null,beforeQuote=null,rescan=null,status=function(){return quote?"'"+beforeQuote.match(attrReg)[1]+"'":htmlTag?1:0};can.view.Scanner=Scanner=function(e){can.extend(this,{text:{},tokens:[]},e),this.tokenReg=[],this.tokenSimple={"<":"<",">":">",'"':'"',"'":"'"},this.tokenComplex=[],this.tokenMap={};for(var t,n=0;t=this.tokens[n];n++)t[2]?(this.tokenReg.push(t[2]),this.tokenComplex.push({abbr:t[1],re:new RegExp(t[2]),rescan:t[3]})):(this.tokenReg.push(t[1]),this.tokenSimple[t[1]]=t[0]),this.tokenMap[t[0]]=t[1];this.tokenReg=new RegExp("("+this.tokenReg.slice(0).concat(["<",">",'"',"'"]).join("|")+")","g")},Scanner.prototype={helpers:[{name:/\s*\(([\$\w]+)\)\s*->([^\n]*)/,fn:function(e){e=e.match(/\s*\(([\$\w]+)\)\s*->([^\n]*)/);return"function(__){var "+e[1]+"=can.$(__);"+e[2]+"}"}}],scan:function(i,e){var c=[],s=0,o=this.tokenSimple,u=this.tokenComplex;(i=i.replace(newLine,"\n")).replace(this.tokenReg,function(e,t){var n=arguments[arguments.length-2];if(s<n&&c.push(i.substring(s,n)),o[e])c.push(e);else for(var r,a=0;r=u[a];a++)if(r.re.test(e)){c.push(r.abbr),r.rescan&&c.push(r.rescan(t));break}s=n+t.length}),s<i.length&&c.push(i.substr(s));function t(e,t){d.push(put_cmd,'"',clean(e),'"'+(t||"")+");")}var n,r,a,h="",d=[startTxt+(this.text.start||"")],l=[],p=null,f=!1,g="",v=[],b=0,m=this.tokenMap;for(htmlTag=quote=beforeQuote=null;(a=c[b++])!==undefined;){if(null===p)switch(a){case m.left:case m.escapeLeft:case m.returnLeft:f=htmlTag&&1;case m.commentLeft:p=a,h.length&&t(h),h="";break;case m.escapeFull:f=htmlTag&&1,rescan=1,p=m.escapeLeft,h.length&&t(h),h=(rescan=c[b++]).content||rescan,rescan.before&&t(rescan.before),c.splice(b,0,m.right);break;case m.commentFull:break;case m.templateLeft:h+=m.left;break;case"<":0!==c[b].indexOf("!--")&&(htmlTag=1,f=0),h+=a;break;case">":htmlTag=0;var _="/"==h.substr(h.length-1);f||tagToContentPropMap[v[v.length-1]]?(_?t(h.substr(0,h.length-1),',can.view.pending(),"/>"'):t(h,',can.view.pending(),">"'),h=""):h+=a,_&&(v.pop(),g=v[v.length-1]);break;case"'":case'"':htmlTag&&(quote&&quote===a?quote=null:null===quote&&(quote=a,beforeQuote=n));default:"<"===n&&(0===(g=a.split(/\s/)[0]).indexOf("/")&&v.pop()===g.substr(1)?g=v[v.length-1]:v.push(g)),h+=a}else switch(a){case m.right:case m.returnRight:switch(p){case m.left:1==(r=bracketNum(h))?(d.push(insert_cmd,"can.view.txt(0,'"+getTag(g,c,b)+"',"+status()+",this,function(){",startTxt,h),l.push({before:"",after:finishTxt+"}));\n"})):((s=l.length&&-1==r?l.pop():{after:";"}).before&&d.push(s.before),d.push(h,";",s.after));break;case m.escapeLeft:case m.returnLeft:(r=bracketNum(h))&&l.push({before:finishTxt,after:"}));"});for(var y=p===m.escapeLeft?1:0,w={insert:insert_cmd,tagName:g,status:status()},k=0;k<this.helpers.length;k++){var x=this.helpers[k];if(x.name.test(h)){h=x.fn(h,w),x.name.source==/^>[\s|\w]\w*/.source&&(y=0);break}}"object"==typeof h?h.raw&&d.push(h.raw):d.push(insert_cmd,"can.view.txt("+y+",'"+g+"',"+status()+",this,function(){ "+(this.text.escape||"")+"return ",h,r?startTxt:"}));"),rescan&&rescan.after&&rescan.after.length&&(t(rescan.after.length),rescan=null)}p=null,h="";break;case m.templateLeft:h+=m.left;break;default:h+=a}n=a}h.length&&t(h),d.push(";");var O={out:"with(_VIEW) { with (_CONTEXT) {"+d.join("")+" "+finishTxt+"}}"};return myEval.call(O,"this.fn = (function(_CONTEXT,_VIEW){"+O.out+"});\r\n//@ sourceURL="+e+".js"),O}};var canExpando=!0;try{document.createTextNode()._=0}catch(ex){canExpando=!1}var attrMap={class:"className",value:"value",textContent:"textContent"},tagMap={"":"span",table:"tr",tr:"td",ol:"li",ul:"li",tbody:"tr",thead:"tr",tfoot:"tr",select:"option",optgroup:"option"},attributePlaceholder="__!!__",attributeReplace=/__!!__/g,tagToContentPropMap={option:"textContent",textarea:"value"},bool=can.each(["checked","disabled","readonly","required"],function(e){attrMap[e]=e}),getParentNode=function(e,t){return t&&11===e.parentNode.nodeType?t:e.parentNode},setAttr=function(e,t,n){var r=e.nodeName.toString().toLowerCase(),a=attrMap[t];a?(e[a]=-1<can.inArray(t,bool)||n,"value"===a&&"input"===r&&(e.defaultValue=n)):e.setAttribute(t,n)},getAttr=function(e,t){return(attrMap[t]?e[attrMap[t]]:e.getAttribute(t))||""},removeAttr=function(e,t){-1<can.inArray(t,bool)?e[t]=!1:e.removeAttribute(t)},pendingHookups=[],contentText=function(n){if("string"==typeof n)return n;if(!n&&0!==n)return"";var e=n.hookup?function(e,t){n.hookup.call(n,e,t)}:"function"==typeof n&&n;return e?(pendingHookups.push(e),""):""+n},contentEscape=function(e){return"string"==typeof e||"number"==typeof e?can.esc(e):contentText(e)},nodeMap={},textNodeMap={},nodeListMap={},expando="ejs_"+Math.random(),_id=0,id=function(e){if(canExpando||3!==e.nodeType)return e[expando]||(e[expando]=(e.nodeName?"element_":"obj_")+ ++_id);for(var t in textNodeMap)if(textNodeMap[t]===e)return t;return textNodeMap["text_"+ ++_id]=e,"text_"+_id},removeNodeListId=function(e,t){var n=nodeMap[id(e)];n&&(0<=(t=can.inArray(t,n))&&n.splice(t,1),n.length||delete nodeMap[id(e)])},addNodeListId=function(e,t){(nodeMap[id(e)]||(nodeMap[id(e)]=[])).push(t)},tagChildren=function(e){e=tagMap[e]||"span";return"span"===e?"@@!!@@":"<"+e+">"+tagChildren(e)+"</"+e+">"};can.extend(can.view,{pending:function(){var e=pendingHookups.slice(0);return lastHookups=e,pendingHookups=[],can.view.hook(function(t){can.each(e,function(e){e(t)})})},registerNode:function(e){var t=id(e);nodeListMap[t]=e,can.each(e,function(e){addNodeListId(e,t)})},unregisterNode:function(e){var t=id(e);can.each(e,function(e){removeNodeListId(e,t)}),delete nodeListMap[t]},txt:function(e,t,n,r,a){var c=can.compute.binder(a,r,function(e,t){h(e,t)});if(!c.isListening)return(e||0!==n?contentEscape:contentText)(c.value);function s(e){can.bind.call(e,"destroyed",d),i=e}function o(e){e||(d(),can.unbind.call(i,"destroyed",d))}var i,u,h,d=function(){c.teardown(),u&&can.view.unregisterNode(u)},r=tagMap[t]||"span",l=tagToContentPropMap[t];if(0!==n||l){if(1===n){var p=c.value.replace(/['"]/g,"").split("=")[0];return pendingHookups.push(function(n){h=function(e){var t=(e||"").replace(/['"]/g,"").split("="),e=t[0];e!=p&&p&&removeAttr(n,p),e&&(setAttr(n,e,t[1]),p=e)},s(n)}),c.value}var f=0===n?l:n;return(0===n?lastHookups:pendingHookups).push(function(e){h=function(){setAttr(e,f,r.render(),l)};var t=can.$(e),n=can.data(t,"hooks");n||can.data(t,"hooks",n={});var r,a=getAttr(e,f,l),i=a.split(attributePlaceholder),t=[];t.push(i.shift(),i.join(attributePlaceholder)),n[f]?n[f].bindings.push(c):n[f]={render:function(){var e=0;return a.replace(attributeReplace,function(){return contentText(r.bindings[e++].value)})},bindings:[c],batchNum:undefined},r=n[f],t.splice(1,0,c.value),setAttr(e,f,t.join(""),l),s(e)}),attributePlaceholder}return"<"+r+can.view.hook(e?function(e,t){h=function(e){n.nodeValue=""+e,o(n.parentNode)};var t=getParentNode(e,t),n=document.createTextNode(c.value);t.insertBefore(n,e),t.removeChild(e),s(t)}:function(r,a){h=function(e){i[0].parentNode&&t(e),o(i[0].parentNode)},a=getParentNode(r,a);var i,t=function(e){var t=can.view.frag(e,a),n=can.makeArray(t.childNodes),e=i?i[i.length-1]:r;e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t),i?(can.remove(can.$(i)),can.view.replace(i,n)):(can.remove(can.$(r)),u=i=n,can.view.registerNode(i))};t(c.value,[r]),s(a)})+">"+tagChildren(r)+"</"+r+">"},replace:function(s,o){s=can.makeArray(s),can.each(s,function(c){can.each(can.makeArray(nodeMap[id(c)]),function(t){var e=nodeListMap[t],n=can.inArray(c,e),r=can.inArray(s[s.length-1],e);if(0<=n&&0<=r){for(var a=n;a<=r;a++){var i=e[a];removeNodeListId(i,t)}e.splice.apply(e,[n,r-n+1].concat(o)),can.each(o,function(e){addNodeListId(e,t)})}else can.view.unregisterNode(e)})})},canExpando:canExpando,textNodeMap:textNodeMap,nodeMap:nodeMap,nodeListMap:nodeListMap});var extend=can.extend,EJS=function(e){if(this.constructor!=EJS){var n=new EJS(e);return function(e,t){return n.render(e,t)}}"function"!=typeof e?(extend(this,e),this.template=this.scanner.scan(this.text,this.name)):this.template={fn:e}};can.EJS=EJS,EJS.prototype.render=function(e,t){return this.template.fn.call(e=e||{},e,new EJS.Helpers(e,t||{}))},extend(EJS.prototype,{scanner:new can.view.Scanner({tokens:[["templateLeft","<%%"],["templateRight","%>"],["returnLeft","<%=="],["escapeLeft","<%="],["commentLeft","<%#"],["left","<%"],["right","%>"],["returnRight","%>"]]})}),EJS.Helpers=function(e,t){this._data=e,this._extras=t,extend(this,t)},EJS.Helpers.prototype={list:function(n,r){can.each(n,function(e,t){r(e,t,n)})}},can.view.register({suffix:"ejs",script:function(e,t){return"can.EJS(function(_CONTEXT,_VIEW) { "+new EJS({text:t,name:e}).template.out+" })"},renderer:function(e,t){return EJS({text:t,name:e})}})}(this,jQuery);
