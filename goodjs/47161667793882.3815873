!function r(i,o,s){function a(t,e){if(!o[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}n=o[t]={exports:{}};i[t][0].call(n.exports,function(e){return a(i[t][1][e]||e)},n,n.exports,r,i,o,s)}return o[t].exports}for(var c="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,n){"use strict";t.exports=function(i,r,e,o){function s(e){var t=new a,n=r.apiEndpoint+"/"+e.requestType+"/"+r.apiVersion;e.url&&(n=n+"/"+e.url),t.open(e.method,n),t.onComplete(e.resolve,e.reject),e.data?t.send(JSON.stringify(e.data)):t.send()}var a,t={JSON:"application/json"},c="events",n="tags",u="errors",d="POST";i.XDomainRequest&&e.isMinimunIE(10)?a=function(e){var n=new i.XDomainRequest;return{onComplete:function(e,t){n.ontimeout=n.onerror=t,n.onload=function(){n.responseText?e(JSON.parse(n.responseText)):e()}},open:function(){n.open.apply(n,arguments)},send:function(e){i.setTimeout(function(){n.send(e)},0)}}}:i.XMLHttpRequest&&(a=function(e){function n(e,t){var n={xhr:{status:e.status,statusText:e.statusText,readyState:e.readyState,response:e.response,responseText:e.responseText,responseHeaders:e.getAllResponseHeaders()}};if(e.responseText)try{n.response=JSON.parse(e.responseText)}catch(t){n.response=e.responseText}t(n)}var r=new i.XMLHttpRequest;return{onComplete:function(e,t){r.onreadystatechange=function(){r.readyState===i.XMLHttpRequest.DONE&&(200===r.status?n(r,e):n(r,t))}},open:function(){r.open.apply(r,arguments),r.setRequestHeader("Content-Type",t.JSON),r.setRequestHeader("Accept",t.JSON),"withCredentials"in r&&(r.withCredentials=!0)},send:r.send.bind(r)}}),this.sendEvent=function(e,t){t=o.makeEvent(e,t);r.debug&&console.log("Sending Event: "+JSON.stringify(t)),s({method:d,url:"collect",requestType:c,data:t,resolve:function(e){return!0},reject:function(e){r.debug&&console.log(e.response)}})},this.sendIdentity=function(e,t){var n=o.makeIdentify();r.debug&&console.log("Sending Identify Event: "+JSON.stringify(n)),s({method:d,url:"collect",requestType:c,data:n,resolve:function(e){return!0},reject:function(e){r.debug&&console.log(e.response)}})},this.sendError=function(e){e=o.makeEvent(r.EventTypes.EXCEPTION,e);r.debug?console.log("Sending Error: "+JSON.stringify(e)):s({method:d,requestType:u,data:e,resolve:function(e){return!0},reject:function(e){console.log("Unable to send Simon Data error")}})},this.getTags=function(e){s({method:d,data:{partnerId:r.partnerId,clientId:r.getClientId(),identity:r.getIdentityData()},requestType:n,resolve:e,reject:function(e){r.debug&&console.log("Unable to get Simon Data tags")}})}}},{}],2:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){var i=(e.document.location.protocol,"https://");switch(this.apiVersion="v1",this.partnerId=e._sd.partnerId,this.env=e._sd.environment||e._sd.env,this.libraryName=e._sd.lib,this.debug=!!e._sd.debug,this.version=t,this.EventTypes={PAGE_VIEW:"page_view",EXCEPTION:"exception"},this.clientId=null,this.identityData=null,this.eventListeners={},this.env){case"localhost":case"local":this.apiEndpoint=i+"localhost";break;case"development":case"dev":this.apiEndpoint=i+"dev.simonsignal.com";break;case"staging":case"stg":this.apiEndpoint=i+"staging.simonsignal.com";break;default:this.apiEndpoint=i+"simonsignal.com"}this.addListener=function(e,t){this.eventListeners[e]=this.eventListeners[e]||[],this.eventListeners[e].push(t)},this.call=function(e,t){if(this.eventListeners[e])for(var n=0;n<this.eventListeners[e].length;n++)this.eventListeners[e][n](t)},this.getClientId=function(){var e;return this.clientId||(e=r.readCookies(!0),this.clientId=e[r.CookieNames.CLIENT_ID_COOKIE]),this.clientId},this.createClientId=function(){var e=n.newUuid();return this.clientId=e,r.createCookie(r.CookieNames.CLIENT_ID_COOKIE,this.clientId,730),this.clientId},this.getIdentityData=function(){var e;return this.identityData||(e=r.readCookies(!0)[r.CookieNames.IDENTITY_COOKIE])&&(this.identityData=JSON.parse(e)),this.identityData},this.setIdentityData=function(e){return this.identityData=e,r.createCookie(r.CookieNames.IDENTITY_COOKIE,JSON.stringify(this.identityData)),this.identityData},this.getCoreMetadata=function(){return{partnerId:this.partnerId,clientId:this.getClientId(),context:{version:this.version,name:this.libraryName,debug:this.debug}}}}},{}],3:[function(require,module,exports){"use strict";function Document(win){var domain=win._sd.domain;this.CookieNames={CLIENT_ID_COOKIE:"sd_client_id",IDENTITY_COOKIE:"sd_identity"},this.createCookie=function(e,t,n){var r="";n&&((i=new Date).setTime(i.getTime()+24*n*60*60*1e3),r="; expires="+i.toGMTString());var i=domain&&""!==domain?";domain="+domain:"";win.document.cookie=e+"="+t+r+i+"; path=/"},this.readCookies=function(e){for(var t={},n=decodeURIComponent(win.document.cookie).split(";"),r=0;r<n.length;r++){var i,o=n[r].trim().split("=");2<=o.length&&(!e||0===o[0].indexOf("sd_"))&&(i=o.slice(1).join("="),t[o[0]]=i)}return t},this.getUrlEmail=function(){for(var e,t,n,r=["sd_email","WT.dscvid","cm_emid","vid","email"],i=/^([_\.\-\+a-zA-Z0-9]+)@([\.\-a-zA-Z0-9]+)\.([A-Za-z]{2,})$/,o=/\+/g,s=/([^&=]+)=?([^&]*)/g,a=function(e){return decodeURIComponent(e.replace(o," "))},c=win.location.search.substring(1),u={},d=0;e=s.exec(c);)u[a(e[1])]=a(e[2]),d++;if(0<d){for(var p=0;p<r.length;p++){var l=r[p];if(l in u){if(n=u[t=l],!i.test(n))try{var f=win.atob(n);i.test(f)&&(n=f)}catch(e){}break}}if(!t)for(var g in u)if(u.hasOwnProperty(g)){var m=u[g];if(i.test(m)){t=g,n=m;break}}}if(t&&n)return{email:n,url_parameter_name:t,source:"url_parameter"}},this.getDocumentMetadata=function(e){var t=new Date,t={context:{userAgent:win.navigator.userAgent,page:{url:win.location.href}},sentAt:t.getTime(),timezone:t.getTimezoneOffset()};return e&&(t.properties={title:win.document.title,language:win.navigator.language},win.document.referrer&&""!==win.document.referrer&&(t.properties.referrer=win.document.referrer)),t},this.isSafari=function(){return win.navigator.vendor&&-1<win.navigator.vendor.indexOf("Apple")&&win.navigator.userAgent&&!win.navigator.userAgent.match("CriOS")},this.createHtmlAsChild=function(html,ele){var div=win.document.createElement("div");div.innerHTML=html;for(var elements=div.childNodes,e=0;e<elements.length;e++){var subElement=elements[e];this.isSafari()&&subElement.tagName&&"script"===subElement.tagName.toLowerCase()?eval(subElement.innerHTML||subElement.text):ele.appendChild(win.document.importNode(subElement,!0))}},this.getElementByTagName=function(e){e=win.document.getElementsByTagName(e);return 0<e.length?e[0]:void 0}}module.exports=Document},{}],4:[function(e,t,n){"use strict";t.exports=function(n,r,t){function i(e,t){return function(){try{return e.apply(this,arguments)}catch(e){if(n.debug)throw e;t.logError(e)}}}n.addListener("exception",function(e){t.sendError(e)}),this.logError=function(e){r.isDefined(e)&&n.call("exception",{name:e.name,message:e.message,stacktrace:e.stack||e.stacktrace})},this.wrap=function(e){if(r.isFunction(e))return i(e,this);if(r.isObject(e)){for(var t in e){var n=e[t];r.isFunction(n)&&(e[t]=i(n,this))}return e}}}},{}],5:[function(e,t,n){"use strict";var l=e("./SimonError");t.exports=function(i,o,s,a,c,u){function d(){var e=Array.prototype.shift.apply(arguments),t=Array.prototype.shift.apply(arguments)||{};s.isString(e)&&s.isObject(t)&&c.sendEvent(e,{properties:t})}function e(){var e=Array.prototype.shift.apply(arguments),t=Array.prototype.shift.apply(arguments)||{};s.isString(e)&&s.isObject(t)&&(o.setIdentityData(t={userId:e,traits:t}),c.sendIdentity("identify",t))}function p(){return{send:function(){switch(Array.prototype.shift.apply(arguments)){case"track":d.apply(null,arguments);break;case"identify":e.apply(null,arguments)}},identify:e,track:d}}this.init=function(){var e=i[i.SimonData],t=new p;if(i[i.SimonData]=t,!s.isDefined(e))throw new l("Global SimonData object is undefined.  Possible corrupted simon.js script tag.");var n=o.getClientId();if(n?a.createCookie(a.CookieNames.CLIENT_ID_COOKIE,n,730):o.createClientId(),e.q)for(var r=0;r<e.q.length;r++)t.send.apply(null,e.q[r]);d(o.EventTypes.PAGE_VIEW);n=a.getUrlEmail();n&&(n={userId:n.email,traits:n},o.setIdentityData(n),c.sendIdentity("identify",n)),u.createTags()}}},{"./SimonError":8}],6:[function(e,t,n){"use strict";t.exports=function(o,s,a){this.makeEvent=function(e,t){var n,r=o.getCoreMetadata(),i=a.getDocumentMetadata(e===o.EventTypes.PAGE_VIEW),i=s.mergeObjects(r,i);return e===o.EventTypes.EXCEPTION?i.type="exception":(n=o.getIdentityData(),i.type="track"),i=t&&s.isObject(t)?("properties"in t&&(t=t.properties),s.mergeObjects(i,{event:e,properties:t})):this.mergeObjects(i,{properties:t}),i=n?s.mergeObjects(i,n):i},this.makeIdentify=function(){var e=o.getCoreMetadata(),t=a.getDocumentMetadata(),n=o.getIdentityData(),t=s.mergeObjects(e,t);return(t=n?s.mergeObjects(t,n):t).type="identify",t}}},{}],7:[function(e,t,n){"use strict";var r="parent"in window?window.parent:window,i=r._sd,o=e("./../package.json"),s=e("./Core"),a=e("./Utility"),c=e("./ErrorHandler"),u=e("./Communication"),d=e("./Initialize"),p=e("./Document"),l=e("./Payloader"),f=e("./Tagger");e("./Validator"),i&&(a=new a,p=new p(r),l=new c(s=new s(r,o.version,a,p),a,u=new u(r,s,a,o=new l(s,a,p))),f=new d(r,s,a,p,u,r=new f(p,u)),l.wrap(a),l.wrap(p),l.wrap(s),l.wrap(o),l.wrap(u),l.wrap(r),l.wrap(f),f.init())},{"./../package.json":15,"./Communication":1,"./Core":2,"./Document":3,"./ErrorHandler":4,"./Initialize":5,"./Payloader":6,"./Tagger":9,"./Utility":10,"./Validator":11}],8:[function(e,t,n){"use strict";function r(e){this.message=e;e=new Error;this.stack=e.stack||e.stacktrace||""}(((t.exports=r).prototype=Object.create(Error.prototype)).constructor=r).prototype.name="SimonError"},{}],9:[function(e,t,n){"use strict";t.exports=function(a,e){this.getTagsResolver=function(e){e=e.response;var t=a.getElementByTagName("head"),n=a.getElementByTagName("body");if(e&&"tags"in e)for(var r=0;r<e.tags.length;r++){var i=e.tags[r];if(i.embeddedScripts)for(var o=0;o<i.embeddedScripts.length;o++)a.createHtmlAsChild(i.embeddedScripts[o].html.trim(),n);if(i.externalScripts)for(var s=0;s<i.externalScripts.length;s++)a.createHtmlAsChild('<script src="'+i.externalScripts[s].src+'"><\/script>',t)}},this.createTags=function(){e.getTags(this.getTagsResolver)}}},{}],10:[function(e,t,n){"use strict";var r=e("uuid/v4");t.exports=function(n){Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function t(){return r.apply(this instanceof i?this:e,n.concat(Array.prototype.slice.call(arguments)))}var n=Array.prototype.slice.call(arguments,1),r=this,i=function(){};return this.prototype&&(i.prototype=this.prototype),t.prototype=new i,t}),this.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},this.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},this.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},this.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},this.isValue=function(e){return!this.isArray(e)&&!this.isObject(e)&&!this.isFunction(e)},this.isDefined=function(e){return null!=e},this.isGoodValue=function(e){return this.isDefined(e)&&""!==e},this.isMinimumIE=function(e){var t=n.navigator.userAgent.toLowerCase();return-1!=t.indexOf("msie")&&parseInt(t.split("msie")[1])>=e},this.newUuid=function(){return r()},this.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},this.mergeObjects=function(e,t){var n,r,i,o=this.deepCopy(e);for(n in t)t.hasOwnProperty(n)&&this.isGoodValue(t[n])&&(r=t[n],i=o[n],this.isObject(i)&&this.isObject(r)?o[n]=this.mergeObjects(i,r):o[n]=t[n]);return o}}},{"uuid/v4":14}],11:[function(e,t,n){"use strict";t.exports=function(t){function a(e,t,n){for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];if(i&&!(r in t))return console.error("Error validating event: "+e+"; property not found: "+r),!1;if(Array.isArray(i)){var o=t[r];if(!Array.isArray(o))return console.error("Error validating event: "+e+"; property: "+r+" must be an array"),!1;for(var s=0;s<o.length;s++)if(!a(e+"_"+r+"_"+s,o[s],i[0]))return!1}}return!0}this.validateEvent=function(e){if(!e)return!1;switch(e.event){case"add_to_cart":return a(e.event,e.properties,{productId:!0,variant:!0,quantity:!0});case"complete_transaction":return a(e.event,e.properties,{transactionId:!0,revenue:!0,items:[{productId:!0,variant:!0,quantity:!0}]});case"product_view":return a(e.event,e.properties,{productId:!0});case"update_cart":case"remove_from_cart":return a(e.event,e.properties,{productId:!0,variant:!0,quantity:!0});case"page_view":return!0;default:return"identify"==e.type?a("identify",e.properties,{email:!0}):(t.debug&&console.warn("Unknown custom event but still sending: "+e.event),!0)}return!1}}},{}],12:[function(e,t,n){for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){t=t||0;return r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]}},{}],13:[function(e,o,t){!function(e){var t,n,r,i=e.crypto||e.msCrypto;i&&i.getRandomValues&&(t=new Uint8Array(16),n=function(){return i.getRandomValues(t),t}),n||(r=new Array(16),n=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}),o.exports=n}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(e,t,n){var s=e("./lib/rng"),a=e("./lib/bytesToUuid");t.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||s)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[r+o]=i[o];return t||a(i)}},{"./lib/bytesToUuid":12,"./lib/rng":13}],15:[function(e,t,n){t.exports={name:"simonjs",version:"1.0.0",description:"Simon Data JavaScript Tracker",license:"UNLICENSED",repository:{type:"git",url:"git@github.com:Radico/simonjs.git"},devDependencies:{brfs:"^1.4.3","browserify-shim":"^3.8.14",grunt:"1.0.1","grunt-browserify":"4.0.1","grunt-contrib-clean":"1.1.0","grunt-contrib-compress":"1.4.3","grunt-contrib-concat":"1.0.1","grunt-contrib-copy":"1.0.0","grunt-contrib-jshint":"1.1.0","grunt-contrib-uglify":"3.0.1","grunt-gitinfo":"0.1.8","grunt-karma":"2.0.0","grunt-serve":"0.1.6","jasmine-core":"2.6.3",karma:"1.7.0","karma-browserify":"5.1.1","karma-chrome-launcher":"2.1.1","karma-jasmine":"1.1.0","karma-phantomjs-launcher":"1.0.4",lodash:"4.17.4",matchdep:"1.0.1","package-json-versionify":"1.0.4","phantomjs-prebuilt":"2.1.14",uuid:"3.0.1"},engines:{node:"6.11.0"},"browserify-shim":{external:"global:External"}}},{}]},{},[7]);
