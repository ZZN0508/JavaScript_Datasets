function hex2b64(t){for(var e,n="",i=0;i+3<=t.length;i+=3)e=parseInt(t.substring(i,i+3),16),n+=b64map.charAt(e>>6)+b64map.charAt(63&e);if(i+1==t.length?(e=parseInt(t.substring(i,i+1),16),n+=b64map.charAt(e<<2)):i+2==t.length&&(e=parseInt(t.substring(i,i+2),16),n+=b64map.charAt(e>>2)+b64map.charAt((3&e)<<4)),b64pad)for(;0<(3&n.length);)n+=b64pad;return n}function b64tohex(t){for(var e,n,i="",r=0,s=0;s<t.length&&t.charAt(s)!=b64pad;++s)(n=b64map.indexOf(t.charAt(s)))<0||(r=0==r?(i+=int2char(n>>2),e=3&n,1):1==r?(i+=int2char(e<<2|n>>4),e=15&n,2):2==r?(i+=int2char(e),i+=int2char(n>>2),e=3&n,3):(i+=int2char(e<<2|n>>4),i+=int2char(15&n),0));return 1==r&&(i+=int2char(e<<2)),i}function b64toBA(t){for(var e=b64tohex(t),n=new Array,i=0;2*i<e.length;++i)n[i]=parseInt(e.substring(2*i,2*i+2),16);return n}function BigInteger(t,e,n){null!=t&&("number"==typeof t?this.fromNumber(t,e,n):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function nbi(){return new BigInteger(null)}function am1(t,e,n,i,r,s){for(;0<=--s;){var o=e*this[t++]+n[i]+r;r=Math.floor(o/67108864),n[i++]=67108863&o}return r}function am2(t,e,n,i,r,s){for(var o=32767&e,a=e>>15;0<=--s;){var u=32767&this[t],h=this[t++]>>15,c=a*u+h*o;r=((u=o*u+((32767&c)<<15)+n[i]+(1073741823&r))>>>30)+(c>>>15)+a*h+(r>>>30),n[i++]=1073741823&u}return r}function am3(t,e,n,i,r,s){for(var o=16383&e,a=e>>14;0<=--s;){var u=16383&this[t],h=this[t++]>>14,c=a*u+h*o;r=((u=o*u+((16383&c)<<14)+n[i]+r)>>28)+(c>>14)+a*h,n[i++]=268435455&u}return r}function int2char(t){return BI_RM.charAt(t)}function intAt(t,e){e=BI_RC[t.charCodeAt(e)];return null==e?-1:e}function bnpCopyTo(t){for(var e=this.t-1;0<=e;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function bnpFromInt(t){this.t=1,this.s=t<0?-1:0,0<t?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}function nbv(t){var e=nbi();return e.fromInt(t),e}function bnpFromString(t,e){var n;if(16==e)n=4;else if(8==e)n=3;else if(256==e)n=8;else if(2==e)n=1;else if(32==e)n=5;else{if(4!=e)return void this.fromRadix(t,e);n=2}this.t=0,this.s=0;for(var i=t.length,r=!1,s=0;0<=--i;){var o=8==n?255&t[i]:intAt(t,i);o<0?"-"==t.charAt(i)&&(r=!0):(r=!1,0==s?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,(s+=n)>=this.DB&&(s-=this.DB))}8==n&&0!=(128&t[0])&&(this.s=-1,0<s&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),r&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var t=this.s&this.DM;0<this.t&&this[this.t-1]==t;)--this.t}function bnToString(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var n,i=(1<<e)-1,r=!1,s="",o=this.t,a=this.DB-o*this.DB%e;if(0<o--)for(a<this.DB&&0<(n=this[o]>>a)&&(r=!0,s=int2char(n));0<=o;)a<e?(n=(this[o]&(1<<a)-1)<<e-a,n|=this[--o]>>(a+=this.DB-e)):(n=this[o]>>(a-=e)&i,a<=0&&(a+=this.DB,--o)),(r=0<n?!0:r)&&(s+=int2char(n));return r?s:"0"}function bnNegate(){var t=nbi();return BigInteger.ZERO.subTo(this,t),t}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(t){var e=this.s-t.s;if(0!=e)return e;var n=this.t;if(0!=(e=n-t.t))return this.s<0?-e:e;for(;0<=--n;)if(0!=(e=this[n]-t[n]))return e;return 0}function nbits(t){var e,n=1;return 0!=(e=t>>>16)&&(t=e,n+=16),0!=(e=t>>8)&&(t=e,n+=8),0!=(e=t>>4)&&(t=e,n+=4),0!=(e=t>>2)&&(t=e,n+=2),0!=(e=t>>1)&&(t=e,n+=1),n}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(t,e){for(var n=this.t-1;0<=n;--n)e[n+t]=this[n];for(n=t-1;0<=n;--n)e[n]=0;e.t=this.t+t,e.s=this.s}function bnpDRShiftTo(t,e){for(var n=t;n<this.t;++n)e[n-t]=this[n];e.t=Math.max(this.t-t,0),e.s=this.s}function bnpLShiftTo(t,e){for(var n=t%this.DB,i=this.DB-n,r=(1<<i)-1,s=Math.floor(t/this.DB),o=this.s<<n&this.DM,a=this.t-1;0<=a;--a)e[a+s+1]=this[a]>>i|o,o=(this[a]&r)<<n;for(a=s-1;0<=a;--a)e[a]=0;e[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()}function bnpRShiftTo(t,e){e.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)e.t=0;else{var i=t%this.DB,r=this.DB-i,s=(1<<i)-1;e[0]=this[n]>>i;for(var o=n+1;o<this.t;++o)e[o-n-1]|=(this[o]&s)<<r,e[o-n]=this[o]>>i;0<i&&(e[this.t-n-1]|=(this.s&s)<<r),e.t=this.t-n,e.clamp()}}function bnpSubTo(t,e){for(var n=0,i=0,r=Math.min(t.t,this.t);n<r;)i+=this[n]-t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i-=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i-=t[n],e[n++]=i&this.DM,i>>=this.DB;i-=t.s}e.s=i<0?-1:0,i<-1?e[n++]=this.DV+i:0<i&&(e[n++]=i),e.t=n,e.clamp()}function bnpMultiplyTo(t,e){var n=this.abs(),i=t.abs(),r=n.t;for(e.t=r+i.t;0<=--r;)e[r]=0;for(r=0;r<i.t;++r)e[r+n.t]=n.am(0,i[r],e,r,0,n.t);e.s=0,e.clamp(),this.s!=t.s&&BigInteger.ZERO.subTo(e,e)}function bnpSquareTo(t){for(var e=this.abs(),n=t.t=2*e.t;0<=--n;)t[n]=0;for(n=0;n<e.t-1;++n){var i=e.am(n,e[n],t,2*n,0,1);(t[n+e.t]+=e.am(n+1,2*e[n],t,2*n+1,i,e.t-n-1))>=e.DV&&(t[n+e.t]-=e.DV,t[n+e.t+1]=1)}0<t.t&&(t[t.t-1]+=e.am(n,e[n],t,2*n,0,1)),t.s=0,t.clamp()}function bnpDivRemTo(t,e,n){var i=t.abs();if(!(i.t<=0)){var r=this.abs();if(r.t<i.t)return null!=e&&e.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=nbi());var s=nbi(),o=this.s,a=t.s,t=this.DB-nbits(i[i.t-1]);0<t?(i.lShiftTo(t,s),r.lShiftTo(t,n)):(i.copyTo(s),r.copyTo(n));var u=s.t,h=s[u-1];if(0!=h){var r=h*(1<<this.F1)+(1<u?s[u-2]>>this.F2:0),c=this.FV/r,l=(1<<this.F1)/r,f=1<<this.F2,p=n.t,d=p-u,g=null==e?nbi():e;for(s.dlShiftTo(d,g),0<=n.compareTo(g)&&(n[n.t++]=1,n.subTo(g,n)),BigInteger.ONE.dlShiftTo(u,g),g.subTo(s,s);s.t<u;)s[s.t++]=0;for(;0<=--d;){var y=n[--p]==h?this.DM:Math.floor(n[p]*c+(n[p-1]+f)*l);if((n[p]+=s.am(0,y,n,d,0,u))<y)for(s.dlShiftTo(d,g),n.subTo(g,n);n[p]<--y;)n.subTo(g,n)}null!=e&&(n.drShiftTo(u,e),o!=a&&BigInteger.ZERO.subTo(e,e)),n.t=u,n.clamp(),0<t&&n.rShiftTo(t,n),o<0&&BigInteger.ZERO.subTo(n,n)}}}function bnMod(t){var e=nbi();return this.abs().divRemTo(t,null,e),this.s<0&&0<e.compareTo(BigInteger.ZERO)&&t.subTo(e,e),e}function Classic(t){this.m=t}function cConvert(t){return t.s<0||0<=t.compareTo(this.m)?t.mod(this.m):t}function cRevert(t){return t}function cReduce(t){t.divRemTo(this.m,null,t)}function cMulTo(t,e,n){t.multiplyTo(e,n),this.reduce(n)}function cSqrTo(t,e){t.squareTo(e),this.reduce(e)}function bnpInvDigit(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return 0<(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)?this.DV-e:-e}function Montgomery(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function montConvert(t){var e=nbi();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&0<e.compareTo(BigInteger.ZERO)&&this.m.subTo(e,e),e}function montRevert(t){var e=nbi();return t.copyTo(e),this.reduce(e),e}function montReduce(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var n=32767&t[e],i=n*this.mpl+((n*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[n=e+this.m.t]+=this.m.am(0,i,t,e,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),0<=t.compareTo(this.m)&&t.subTo(this.m,t)}function montSqrTo(t,e){t.squareTo(e),this.reduce(e)}function montMulTo(t,e,n){t.multiplyTo(e,n),this.reduce(n)}function bnpIsEven(){return 0==(0<this.t?1&this[0]:this.s)}function bnpExp(t,e){if(4294967295<t||t<1)return BigInteger.ONE;var n,i=nbi(),r=nbi(),s=e.convert(this),o=nbits(t)-1;for(s.copyTo(i);0<=--o;)e.sqrTo(i,r),0<(t&1<<o)?e.mulTo(r,s,i):(n=i,i=r,r=n);return e.revert(i)}function bnModPowInt(t,e){e=new(t<256||e.isEven()?Classic:Montgomery)(e);return this.exp(t,e)}function bnClone(){var t=nbi();return this.copyTo(t),t}function bnIntValue(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24}function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16}function bnpChunkSize(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function bnpToRadix(t){if(null==t&&(t=10),0==this.signum()||t<2||36<t)return"0";var e=this.chunkSize(t),n=Math.pow(t,e),i=nbv(n),r=nbi(),s=nbi(),o="";for(this.divRemTo(i,r,s);0<r.signum();)o=(n+s.intValue()).toString(t).substr(1)+o,r.divRemTo(i,r,s);return s.intValue().toString(t)+o}function bnpFromRadix(t,e){this.fromInt(0);for(var n=this.chunkSize(e=null==e?10:e),i=Math.pow(e,n),r=!1,s=0,o=0,a=0;a<t.length;++a){var u=intAt(t,a);u<0?"-"==t.charAt(a)&&0==this.signum()&&(r=!0):(o=e*o+u,++s>=n&&(this.dMultiply(i),this.dAddOffset(o,0),o=s=0))}0<s&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(o,0)),r&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(t,e,n){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(t-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(BigInteger.ONE.shiftLeft(t-1),this);else{var i=new Array,n=7&t;i.length=1+(t>>3),e.nextBytes(i),0<n?i[0]&=(1<<n)-1:i[0]=0,this.fromString(i,256)}}function bnToByteArray(){var t=this.t,e=new Array;e[0]=this.s;var n,i=this.DB-t*this.DB%8,r=0;if(0<t--)for(i<this.DB&&(n=this[t]>>i)!=(this.s&this.DM)>>i&&(e[r++]=n|this.s<<this.DB-i);0<=t;)i<8?(n=(this[t]&(1<<i)-1)<<8-i,n|=this[--t]>>(i+=this.DB-8)):(n=this[t]>>(i-=8)&255,i<=0&&(i+=this.DB,--t)),0!=(128&n)&&(n|=-256),0==r&&(128&this.s)!=(128&n)&&++r,(0<r||n!=this.s)&&(e[r++]=n);return e}function bnEquals(t){return 0==this.compareTo(t)}function bnMin(t){return this.compareTo(t)<0?this:t}function bnMax(t){return 0<this.compareTo(t)?this:t}function bnpBitwiseTo(t,e,n){for(var i,r=Math.min(t.t,this.t),s=0;s<r;++s)n[s]=e(this[s],t[s]);if(t.t<this.t){for(i=t.s&this.DM,s=r;s<this.t;++s)n[s]=e(this[s],i);n.t=this.t}else{for(i=this.s&this.DM,s=r;s<t.t;++s)n[s]=e(i,t[s]);n.t=t.t}n.s=e(this.s,t.s),n.clamp()}function op_and(t,e){return t&e}function bnAnd(t){var e=nbi();return this.bitwiseTo(t,op_and,e),e}function op_or(t,e){return t|e}function bnOr(t){var e=nbi();return this.bitwiseTo(t,op_or,e),e}function op_xor(t,e){return t^e}function bnXor(t){var e=nbi();return this.bitwiseTo(t,op_xor,e),e}function op_andnot(t,e){return t&~e}function bnAndNot(t){var e=nbi();return this.bitwiseTo(t,op_andnot,e),e}function bnNot(){for(var t=nbi(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function bnShiftLeft(t){var e=nbi();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function bnShiftRight(t){var e=nbi();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function lbit(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function bnGetLowestSetBit(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+lbit(this[t]);return this.s<0?this.t*this.DB:-1}function cbit(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function bnBitCount(){for(var t=0,e=this.s&this.DM,n=0;n<this.t;++n)t+=cbit(this[n]^e);return t}function bnTestBit(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)}function bnpChangeBit(t,e){t=BigInteger.ONE.shiftLeft(t);return this.bitwiseTo(t,e,t),t}function bnSetBit(t){return this.changeBit(t,op_or)}function bnClearBit(t){return this.changeBit(t,op_andnot)}function bnFlipBit(t){return this.changeBit(t,op_xor)}function bnpAddTo(t,e){for(var n=0,i=0,r=Math.min(t.t,this.t);n<r;)i+=this[n]+t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i+=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i+=t[n],e[n++]=i&this.DM,i>>=this.DB;i+=t.s}e.s=i<0?-1:0,0<i?e[n++]=i:i<-1&&(e[n++]=this.DV+i),e.t=n,e.clamp()}function bnAdd(t){var e=nbi();return this.addTo(t,e),e}function bnSubtract(t){var e=nbi();return this.subTo(t,e),e}function bnMultiply(t){var e=nbi();return this.multiplyTo(t,e),e}function bnSquare(){var t=nbi();return this.squareTo(t),t}function bnDivide(t){var e=nbi();return this.divRemTo(t,e,null),e}function bnRemainder(t){var e=nbi();return this.divRemTo(t,null,e),e}function bnDivideAndRemainder(t){var e=nbi(),n=nbi();return this.divRemTo(t,e,n),new Array(e,n)}function bnpDMultiply(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function NullExp(){}function nNop(t){return t}function nMulTo(t,e,n){t.multiplyTo(e,n)}function nSqrTo(t,e){t.squareTo(e)}function bnPow(t){return this.exp(t,new NullExp)}function bnpMultiplyLowerTo(t,e,n){var i,r=Math.min(this.t+t.t,e);for(n.s=0,n.t=r;0<r;)n[--r]=0;for(i=n.t-this.t;r<i;++r)n[r+this.t]=this.am(0,t[r],n,r,0,this.t);for(i=Math.min(t.t,e);r<i;++r)this.am(0,t[r],n,r,0,e-r);n.clamp()}function bnpMultiplyUpperTo(t,e,n){var i=n.t=this.t+t.t- --e;for(n.s=0;0<=--i;)n[i]=0;for(i=Math.max(e-this.t,0);i<t.t;++i)n[this.t+i-e]=this.am(e-i,t[i],n,0,0,this.t+i-e);n.clamp(),n.drShiftTo(1,n)}function Barrett(t){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function barrettConvert(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=nbi();return t.copyTo(e),this.reduce(e),e}function barrettRevert(t){return t}function barrettReduce(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);0<=t.compareTo(this.m);)t.subTo(this.m,t)}function barrettSqrTo(t,e){t.squareTo(e),this.reduce(e)}function barrettMulTo(t,e,n){t.multiplyTo(e,n),this.reduce(n)}function bnModPow(t,e){var n=t.bitLength(),i=nbv(1);if(n<=0)return i;var r=n<18?1:n<48?3:n<144?4:n<768?5:6,s=new(n<8?Classic:e.isEven()?Barrett:Montgomery)(e),o=new Array,a=3,u=r-1,h=(1<<r)-1;if(o[1]=s.convert(this),1<r){var c=nbi();for(s.sqrTo(o[1],c);a<=h;)o[a]=nbi(),s.mulTo(c,o[a-2],o[a]),a+=2}for(var l,f,p=t.t-1,d=!0,g=nbi(),n=nbits(t[p])-1;0<=p;){for(u<=n?l=t[p]>>n-u&h:(l=(t[p]&(1<<n+1)-1)<<u-n,0<p&&(l|=t[p-1]>>this.DB+n-u)),a=r;0==(1&l);)l>>=1,--a;if((n-=a)<0&&(n+=this.DB,--p),d)o[l].copyTo(i),d=!1;else{for(;1<a;)s.sqrTo(i,g),s.sqrTo(g,i),a-=2;0<a?s.sqrTo(i,g):(f=i,i=g,g=f),s.mulTo(g,o[l],i)}for(;0<=p&&0==(t[p]&1<<n);)s.sqrTo(i,g),f=i,i=g,g=f,--n<0&&(n=this.DB-1,--p)}return s.revert(i)}function bnGCD(t){var e=this.s<0?this.negate():this.clone(),n=t.s<0?t.negate():t.clone();e.compareTo(n)<0&&(r=e,e=n,n=r);var i=e.getLowestSetBit(),r=n.getLowestSetBit();if(r<0)return e;for(0<(r=i<r?i:r)&&(e.rShiftTo(r,e),n.rShiftTo(r,n));0<e.signum();)0<(i=e.getLowestSetBit())&&e.rShiftTo(i,e),0<(i=n.getLowestSetBit())&&n.rShiftTo(i,n),0<=e.compareTo(n)?(e.subTo(n,e),e.rShiftTo(1,e)):(n.subTo(e,n),n.rShiftTo(1,n));return 0<r&&n.lShiftTo(r,n),n}function bnpModInt(t){if(t<=0)return 0;var e=this.DV%t,n=this.s<0?t-1:0;if(0<this.t)if(0==e)n=this[0]%t;else for(var i=this.t-1;0<=i;--i)n=(e*n+this[i])%t;return n}function bnModInverse(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return BigInteger.ZERO;for(var n=t.clone(),i=this.clone(),r=nbv(1),s=nbv(0),o=nbv(0),a=nbv(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),e?(r.isEven()&&s.isEven()||(r.addTo(this,r),s.subTo(t,s)),r.rShiftTo(1,r)):s.isEven()||s.subTo(t,s),s.rShiftTo(1,s);for(;i.isEven();)i.rShiftTo(1,i),e?(o.isEven()&&a.isEven()||(o.addTo(this,o),a.subTo(t,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);0<=n.compareTo(i)?(n.subTo(i,n),e&&r.subTo(o,r),s.subTo(a,s)):(i.subTo(n,i),e&&o.subTo(r,o),a.subTo(s,a))}return 0!=i.compareTo(BigInteger.ONE)?BigInteger.ZERO:0<=a.compareTo(t)?a.subtract(t):a.signum()<0?(a.addTo(t,a),a.signum()<0?a.add(t):a):a}function bnIsProbablePrime(t){var e,n=this.abs();if(1==n.t&&n[0]<=lowprimes[lowprimes.length-1]){for(e=0;e<lowprimes.length;++e)if(n[0]==lowprimes[e])return!0;return!1}if(n.isEven())return!1;for(e=1;e<lowprimes.length;){for(var i=lowprimes[e],r=e+1;r<lowprimes.length&&i<lplim;)i*=lowprimes[r++];for(i=n.modInt(i);e<r;)if(i%lowprimes[e++]==0)return!1}return n.millerRabin(t)}function bnpMillerRabin(t){var e=this.subtract(BigInteger.ONE),n=e.getLowestSetBit();if(n<=0)return!1;var i=e.shiftRight(n);(t=t+1>>1)>lowprimes.length&&(t=lowprimes.length);for(var r=nbi(),s=0;s<t;++s){r.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var o=r.modPow(i,this);if(0!=o.compareTo(BigInteger.ONE)&&0!=o.compareTo(e)){for(var a=1;a++<n&&0!=o.compareTo(e);)if(0==(o=o.modPowInt(2,this)).compareTo(BigInteger.ONE))return!1;if(0!=o.compareTo(e))return!1}}return!0}function parseBigInt(t,e){return new BigInteger(t,e)}function linebrk(t,e){for(var n="",i=0;i+e<t.length;)n+=t.substring(i,i+e)+"\n",i+=e;return n+t.substring(i,t.length)}function byte2Hex(t){return t<16?"0"+t.toString(16):t.toString(16)}function pkcs1pad2(t,e){if(e<t.length+11)return alert("Message too long for RSA"),null;for(var n=new Array,i=t.length-1;0<=i&&0<e;){var r=t.charCodeAt(i--);r<128?n[--e]=r:127<r&&r<2048?(n[--e]=63&r|128,n[--e]=r>>6|192):(n[--e]=63&r|128,n[--e]=r>>6&63|128,n[--e]=r>>12|224)}n[--e]=0;for(var s=new SecureRandom,o=new Array;2<e;){for(o[0]=0;0==o[0];)s.nextBytes(o);n[--e]=o[0]}return n[--e]=2,n[--e]=0,new BigInteger(n)}function oaep_mgf1_arr(t,e,n){for(var i="",r=0;i.length<e;)i+=n(String.fromCharCode.apply(String,t.concat([(4278190080&r)>>24,(16711680&r)>>16,(65280&r)>>8,255&r]))),r+=1;return i}function oaep_pad(t,e,n){if(t.length+2*SHA1_SIZE+2>e)throw"Message too long for RSA";for(var i="",r=0;r<e-t.length-2*SHA1_SIZE-2;r+=1)i+="\0";var s=rstr_sha1("")+i+""+t,o=new Array(SHA1_SIZE);(new SecureRandom).nextBytes(o);var a=oaep_mgf1_arr(o,s.length,n||rstr_sha1),u=[];for(r=0;r<s.length;r+=1)u[r]=s.charCodeAt(r)^a.charCodeAt(r);var h=oaep_mgf1_arr(u,o.length,rstr_sha1),c=[0];for(r=0;r<o.length;r+=1)c[r+1]=o[r]^h.charCodeAt(r);return new BigInteger(c.concat(u))}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(t,e){this.isPublic=!0,"string"!=typeof t?(this.n=t,this.e=e):null!=t&&null!=e&&0<t.length&&0<e.length?(this.n=parseBigInt(t,16),this.e=parseInt(e,16)):alert("Invalid RSA public key")}function RSADoPublic(t){return t.modPowInt(this.e,this.n)}function RSAEncrypt(t){t=pkcs1pad2(t,this.n.bitLength()+7>>3);if(null==t)return null;t=this.doPublic(t);if(null==t)return null;t=t.toString(16);return 0==(1&t.length)?t:"0"+t}function RSAEncryptOAEP(t,e){e=oaep_pad(t,this.n.bitLength()+7>>3,e);if(null==e)return null;e=this.doPublic(e);if(null==e)return null;e=e.toString(16);return 0==(1&e.length)?e:"0"+e}function pkcs1unpad2(t,e){for(var n=t.toByteArray(),i=0;i<n.length&&0==n[i];)++i;if(n.length-i!=e-1||2!=n[i])return null;for(++i;0!=n[i];)if(++i>=n.length)return null;for(var r="";++i<n.length;){var s=255&n[i];s<128?r+=String.fromCharCode(s):191<s&&s<224?(r+=String.fromCharCode((31&s)<<6|63&n[i+1]),++i):(r+=String.fromCharCode((15&s)<<12|(63&n[i+1])<<6|63&n[i+2]),i+=2)}return r}function oaep_mgf1_str(t,e,n){for(var i="",r=0;i.length<e;)i+=n(t+String.fromCharCode.apply(String,[(4278190080&r)>>24,(16711680&r)>>16,(65280&r)>>8,255&r])),r+=1;return i}function oaep_unpad(t,e,n){for(t=t.toByteArray(),i=0;i<t.length;i+=1)t[i]&=255;for(;t.length<e;)t.unshift(0);if((t=String.fromCharCode.apply(String,t)).length<2*SHA1_SIZE+2)throw"Cipher too short";var i,r=t.substr(1,SHA1_SIZE),s=t.substr(SHA1_SIZE+1),o=oaep_mgf1_str(s,SHA1_SIZE,n||rstr_sha1),a=[];for(i=0;i<r.length;i+=1)a[i]=r.charCodeAt(i)^o.charCodeAt(i);var u=oaep_mgf1_str(String.fromCharCode.apply(String,a),t.length-SHA1_SIZE,rstr_sha1),h=[];for(i=0;i<s.length;i+=1)h[i]=s.charCodeAt(i)^u.charCodeAt(i);if((h=String.fromCharCode.apply(String,h)).substr(0,SHA1_SIZE)!==rstr_sha1(""))throw"Hash mismatch";n=(h=h.substr(SHA1_SIZE)).indexOf("");if((-1!=n?h.substr(0,n).lastIndexOf("\0"):-1)+1!=n)throw"Malformed data";return h.substr(n+1)}function RSASetPrivate(t,e,n){this.isPrivate=!0,"string"!=typeof t?(this.n=t,this.e=e,this.d=n):null!=t&&null!=e&&0<t.length&&0<e.length?(this.n=parseBigInt(t,16),this.e=parseInt(e,16),this.d=parseBigInt(n,16)):alert("Invalid RSA private key")}function RSASetPrivateEx(t,e,n,i,r,s,o,a){if(this.isPrivate=!0,null==t)throw"RSASetPrivateEx N == null";if(null==e)throw"RSASetPrivateEx E == null";if(0==t.length)throw"RSASetPrivateEx N.length == 0";if(0==e.length)throw"RSASetPrivateEx E.length == 0";null!=t&&null!=e&&0<t.length&&0<e.length?(this.n=parseBigInt(t,16),this.e=parseInt(e,16),this.d=parseBigInt(n,16),this.p=parseBigInt(i,16),this.q=parseBigInt(r,16),this.dmp1=parseBigInt(s,16),this.dmq1=parseBigInt(o,16),this.coeff=parseBigInt(a,16)):alert("Invalid RSA private key in RSASetPrivateEx")}function RSAGenerate(t,e){var n=new SecureRandom,i=t>>1;this.e=parseInt(e,16);for(var r=new BigInteger(e,16);;){for(;this.p=new BigInteger(t-i,1,n),0!=this.p.subtract(BigInteger.ONE).gcd(r).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(i,1,n),0!=this.q.subtract(BigInteger.ONE).gcd(r).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););this.p.compareTo(this.q)<=0&&(a=this.p,this.p=this.q,this.q=a);var s=this.p.subtract(BigInteger.ONE),o=this.q.subtract(BigInteger.ONE),a=s.multiply(o);if(0==a.gcd(r).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q),this.d=r.modInverse(a),this.dmp1=this.d.mod(s),this.dmq1=this.d.mod(o),this.coeff=this.q.modInverse(this.p);break}}this.isPrivate=!0}function RSADoPrivate(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),n=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(n)<0;)e=e.add(this.p);return e.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)}function RSADecrypt(t){t=parseBigInt(t,16),t=this.doPrivate(t);return null==t?null:pkcs1unpad2(t,this.n.bitLength()+7>>3)}function RSADecryptOAEP(t,e){t=parseBigInt(t,16),t=this.doPrivate(t);return null==t?null:oaep_unpad(t,this.n.bitLength()+7>>3,e)}function _rsapem_pemToBase64(t){return t=(t=(t=t.replace("-----BEGIN RSA PRIVATE KEY-----","")).replace("-----END RSA PRIVATE KEY-----","")).replace(/[ \n]+/g,"")}function _rsapem_getPosArrayOfChildrenFromHex(t){var e=new Array,n=ASN1HEX.getStartPosOfV_AtObj(t,0),i=ASN1HEX.getPosOfNextSibling_AtObj(t,n),r=ASN1HEX.getPosOfNextSibling_AtObj(t,i),s=ASN1HEX.getPosOfNextSibling_AtObj(t,r),o=ASN1HEX.getPosOfNextSibling_AtObj(t,s),a=ASN1HEX.getPosOfNextSibling_AtObj(t,o),u=ASN1HEX.getPosOfNextSibling_AtObj(t,a),h=ASN1HEX.getPosOfNextSibling_AtObj(t,u),t=ASN1HEX.getPosOfNextSibling_AtObj(t,h);return e.push(n,i,r,s,o,a,u,h,t),e}function _rsapem_getHexValueArrayOfChildrenFromHex(t){var e=_rsapem_getPosArrayOfChildrenFromHex(t),n=ASN1HEX.getHexOfV_AtObj(t,e[0]),i=ASN1HEX.getHexOfV_AtObj(t,e[1]),r=ASN1HEX.getHexOfV_AtObj(t,e[2]),s=ASN1HEX.getHexOfV_AtObj(t,e[3]),o=ASN1HEX.getHexOfV_AtObj(t,e[4]),a=ASN1HEX.getHexOfV_AtObj(t,e[5]),u=ASN1HEX.getHexOfV_AtObj(t,e[6]),h=ASN1HEX.getHexOfV_AtObj(t,e[7]),t=ASN1HEX.getHexOfV_AtObj(t,e[8]),e=new Array;return e.push(n,i,r,s,o,a,u,h,t),e}function _rsapem_readPrivateKeyFromASN1HexString(t){t=_rsapem_getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function _rsapem_readPrivateKeyFromPEMString(t){t=_rsapem_getHexValueArrayOfChildrenFromHex(b64tohex(_rsapem_pemToBase64(t)));this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function _rsasign_getHexPaddedDigestInfoForString(t,e,n){var i=KJUR.crypto.Util.hashString(t,n);return KJUR.crypto.Util.getPaddedDigestInfoHex(i,n,e)}function _zeroPaddingOfSignature(t,e){for(var n="",i=e/4-t.length,r=0;r<i;r++)n+="0";return n+t}function _rsasign_signString(t,e){var n=KJUR.crypto.Util.hashString(t,e);return this.signWithMessageHash(n,e)}function _rsasign_signWithMessageHash(t,e){e=parseBigInt(KJUR.crypto.Util.getPaddedDigestInfoHex(t,e,this.n.bitLength()),16);return _zeroPaddingOfSignature(this.doPrivate(e).toString(16),this.n.bitLength())}function _rsasign_signStringWithSHA1(t){return _rsasign_signString.call(this,t,"sha1")}function _rsasign_signStringWithSHA256(t){return _rsasign_signString.call(this,t,"sha256")}function pss_mgf1_str(t,e,n){for(var i="",r=0;i.length<e;)i+=hextorstr(n(rstrtohex(t+String.fromCharCode.apply(String,[(4278190080&r)>>24,(16711680&r)>>16,(65280&r)>>8,255&r])))),r+=1;return i}function _rsasign_signStringPSS(t,e,n){var i,t=(i=rstrtohex(t),KJUR.crypto.Util.hashHex(i,e));return this.signWithMessageHashPSS(t,e,n=void 0===n?-1:n)}function _rsasign_signWithMessageHashPSS(t,e,n){function i(t){return KJUR.crypto.Util.hashHex(t,e)}var r=hextorstr(t),s=r.length,o=this.n.bitLength()-1,a=Math.ceil(o/8);if(-1===n||void 0===n)n=s;else if(-2===n)n=a-s-2;else if(n<-2)throw"invalid salt length";if(a<s+n+2)throw"data too long";t="";0<n&&(t=new Array(n),(new SecureRandom).nextBytes(t),t=String.fromCharCode.apply(String,t));for(var u=hextorstr(i(rstrtohex("\0\0\0\0\0\0\0\0"+r+t))),h=[],c=0;c<a-n-s-2;c+=1)h[c]=0;var l=String.fromCharCode.apply(String,h)+""+t,f=pss_mgf1_str(u,l.length,i),p=[];for(c=0;c<l.length;c+=1)p[c]=l.charCodeAt(c)^f.charCodeAt(c);for(p[0]&=~(65280>>8*a-o&255),c=0;c<s;c++)p.push(u.charCodeAt(c));return p.push(188),_zeroPaddingOfSignature(this.doPrivate(new BigInteger(p)).toString(16),this.n.bitLength())}function _rsasign_getDecryptSignatureBI(t,e,n){var i=new RSAKey;return i.setPublic(e,n),i.doPublic(t)}function _rsasign_getHexDigestInfoFromSig(t,e,n){return _rsasign_getDecryptSignatureBI(t,e,n).toString(16).replace(/^1f+00/,"")}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(t){for(var e in KJUR.crypto.Util.DIGESTINFOHEAD){var n=KJUR.crypto.Util.DIGESTINFOHEAD[e],i=n.length;if(t.substring(0,i)==n)return[e,t.substring(i)]}return[]}function _rsasign_verifySignatureWithArgs(t,e,n,i){i=_rsasign_getAlgNameAndHashFromHexDisgestInfo(_rsasign_getHexDigestInfoFromSig(e,n,i));if(0==i.length)return!1;var r=i[0];return i[1]==KJUR.crypto.Util.hashString(t,r)}function _rsasign_verifyHexSignatureForMessage(t,e){return _rsasign_verifySignatureWithArgs(e,parseBigInt(t,16),this.n.toString(16),this.e.toString(16))}function _rsasign_verifyString(t,e){e=parseBigInt(e=(e=e.replace(_RE_HEXDECONLY,"")).replace(/[ \n]+/g,""),16);if(e.bitLength()>this.n.bitLength())return 0;e=_rsasign_getAlgNameAndHashFromHexDisgestInfo(this.doPublic(e).toString(16).replace(/^1f+00/,""));if(0==e.length)return!1;var n=e[0];return e[1]==KJUR.crypto.Util.hashString(t,n)}function _rsasign_verifyWithMessageHash(t,e){e=parseBigInt(e=(e=e.replace(_RE_HEXDECONLY,"")).replace(/[ \n]+/g,""),16);if(e.bitLength()>this.n.bitLength())return 0;e=_rsasign_getAlgNameAndHashFromHexDisgestInfo(this.doPublic(e).toString(16).replace(/^1f+00/,""));if(0==e.length)return!1;e[0];return e[1]==t}function _rsasign_verifyStringPSS(t,e,n,i){var r,t=(r=rstrtohex(t),KJUR.crypto.Util.hashHex(r,n));return this.verifyWithMessageHashPSS(t,e,n,i=void 0===i?-1:i)}function _rsasign_verifyWithMessageHashPSS(t,e,n,i){var r=new BigInteger(e,16);if(r.bitLength()>this.n.bitLength())return!1;function s(t){return KJUR.crypto.Util.hashHex(t,n)}var o=hextorstr(t),e=o.length,t=this.n.bitLength()-1,a=Math.ceil(t/8);if(-1===i||void 0===i)i=e;else if(-2===i)i=a-e-2;else if(i<-2)throw"invalid salt length";if(a<e+i+2)throw"data too long";for(var u=this.doPublic(r).toByteArray(),h=0;h<u.length;h+=1)u[h]&=255;for(;u.length<a;)u.unshift(0);if(188!==u[a-1])throw"encoded message does not end in 0xbc";var c=(u=String.fromCharCode.apply(String,u)).substr(0,a-e-1),r=u.substr(c.length,e),t=65280>>8*a-t&255;if(0!=(c.charCodeAt(0)&t))throw"bits beyond keysize not zero";var l=pss_mgf1_str(r,c.length,s),f=[];for(h=0;h<c.length;h+=1)f[h]=c.charCodeAt(h)^l.charCodeAt(h);f[0]&=~t;var p=a-e-i-2;for(h=0;h<p;h+=1)if(0!==f[h])throw"leftmost octets not zero";if(1!==f[p])throw"0x01 marker not found";return r===hextorstr(s(rstrtohex("\0\0\0\0\0\0\0\0"+o+String.fromCharCode.apply(String,f.slice(-i)))))}function X509(){this.subjectPublicKeyRSA=null,this.subjectPublicKeyRSA_hN=null,this.subjectPublicKeyRSA_hE=null,this.hex=null,this.getSerialNumberHex=function(){return ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,1])},this.getIssuerHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3])},this.getIssuerString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3]))},this.getSubjectHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5])},this.getSubjectString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5]))},this.getNotBefore=function(){var t=(t=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,0])).replace(/(..)/g,"%$1");return t=decodeURIComponent(t)},this.getNotAfter=function(){var t=(t=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,1])).replace(/(..)/g,"%$1");return t=decodeURIComponent(t)},this.readCertPEM=function(t){var e=X509.pemToHex(t),n=X509.getPublicKeyHexArrayFromCertHex(e),t=new RSAKey;t.setPublic(n[0],n[1]),this.subjectPublicKeyRSA=t,this.subjectPublicKeyRSA_hN=n[0],this.subjectPublicKeyRSA_hE=n[1],this.hex=e},this.readCertPEMWithoutRSAInit=function(t){var e=X509.pemToHex(t),t=X509.getPublicKeyHexArrayFromCertHex(e);this.subjectPublicKeyRSA.setPublic(t[0],t[1]),this.subjectPublicKeyRSA_hN=t[0],this.subjectPublicKeyRSA_hE=t[1],this.hex=e}}function Base64x(){}function stoBA(t){for(var e=new Array,n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function BAtos(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e}function BAtohex(t){for(var e="",n=0;n<t.length;n++){var i=t[n].toString(16);e+=i=1==i.length?"0"+i:i}return e}function stohex(t){return BAtohex(stoBA(t))}function stob64(t){return hex2b64(stohex(t))}function stob64u(t){return b64tob64u(hex2b64(stohex(t)))}function b64utos(t){return BAtos(b64toBA(b64utob64(t)))}function b64tob64u(t){return t=(t=(t=t.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function b64utob64(t){return t.length%4==2?t+="==":t.length%4==3&&(t+="="),t=(t=t.replace(/-/g,"+")).replace(/_/g,"/")}function hextob64u(t){return b64tob64u(hex2b64(t))}function b64utohex(t){return b64tohex(b64utob64(t))}function utf8tob64(t){return hex2b64(uricmptohex(encodeURIComponentAll(t)))}function b64toutf8(t){return decodeURIComponent(hextouricmp(b64tohex(t)))}function utf8tohex(t){return uricmptohex(encodeURIComponentAll(t))}function hextoutf8(t){return decodeURIComponent(hextouricmp(t))}function hextorstr(t){for(var e="",n=0;n<t.length-1;n+=2)e+=String.fromCharCode(parseInt(t.substr(n,2),16));return e}function rstrtohex(t){for(var e="",n=0;n<t.length;n++)e+=("0"+t.charCodeAt(n).toString(16)).slice(-2);return e}function hextob64(t){return hex2b64(t)}function hextob64nl(t){return hextob64(t).replace(/(.{64})/g,"$1\r\n").replace(/\r\n$/,"")}function b64nltohex(t){return b64tohex(t.replace(/[^0-9A-Za-z\/+=]*/g,""))}function uricmptohex(t){return t.replace(/%/g,"")}function hextouricmp(t){return t.replace(/(..)/g,"%$1")}function encodeURIComponentAll(t){for(var e=encodeURIComponent(t),n="",i=0;i<e.length;i++)"%"==e[i]?(n+=e.substr(i,3),i+=2):n=n+"%"+stohex(e[i]);return n}function newline_toUnix(t){return t=t.replace(/\r\n/gm,"\n")}function newline_toDos(t){return t=(t=t.replace(/\r\n/gm,"\n")).replace(/\n/gm,"\r\n")}var CryptoJS=CryptoJS||function(h){var t={},e=t.lib={},n=e.Base={extend:function(t){l.prototype=this;var e=new l;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),(e.init.prototype=e).$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=e.WordArray=n.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||r).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes,r=t.sigBytes;if(this.clamp(),i%4)for(var s=0;s<r;s++){var o=n[s>>>2]>>>24-s%4*8&255;e[i+s>>>2]|=o<<24-(i+s)%4*8}else if(65535<n.length)for(s=0;s<r;s+=4)e[i+s>>>2]=n[s>>>2];else e.push.apply(e,n);return this.sigBytes+=r,this},clamp:function(){var t=this.words,e=this.sigBytes;t[e>>>2]&=4294967295<<32-e%4*8,t.length=h.ceil(e/4)},clone:function(){var t=n.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(4294967296*h.random()|0);return new c.init(e,t)}}),i=t.enc={},r=i.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,i=[],r=0;r<n;r++){var s=e[r>>>2]>>>24-r%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new c.init(n,e/2)}},s=i.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,i=[],r=0;r<n;r++){var s=e[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new c.init(n,e)}},o=i.Utf8={stringify:function(t){try{return decodeURIComponent(escape(s.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return s.parse(unescape(encodeURIComponent(t)))}},a=e.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=o.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var e=this._data,n=e.words,i=e.sigBytes,r=this.blockSize,s=i/(4*r),o=(s=t?h.ceil(s):h.max((0|s)-this._minBufferSize,0))*r,i=h.min(4*o,i);if(o){for(var a=0;a<o;a+=r)this._doProcessBlock(n,a);var u=n.splice(0,o);e.sigBytes-=i}return new c.init(u,i)},clone:function(){var t=n.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),u=(e.Hasher=a.extend({cfg:n.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){a.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(t,e){return new n.init(e).finalize(t)}},_createHmacHelper:function(n){return function(t,e){return new u.HMAC.init(n,e).finalize(t)}}}),t.algo={});function l(){}return t}(Math);(function(){var t=CryptoJS,e=t.lib,n=e.WordArray,i=e.Hasher,e=t.algo,c=[],e=e.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],u=0;u<80;u++){u<16?c[u]=0|t[e+u]:(h=c[u-3]^c[u-8]^c[u-14]^c[u-16],c[u]=h<<1|h>>>31);var h=(i<<5|i>>>27)+a+c[u];h+=u<20?1518500249+(r&s|~r&o):u<40?1859775393+(r^s^o):u<60?(r&s|r&o|s&o)-1894007588:(r^s^o)-899497514,a=o,o=s,s=r<<30|r>>>2,r=i,i=h}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[14+(64+i>>>9<<4)]=Math.floor(n/4294967296),e[15+(64+i>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=i._createHelper(e),t.HmacSHA1=i._createHmacHelper(e)})(),function(r){var t=CryptoJS,e=t.lib,n=e.WordArray,i=e.Hasher,e=t.algo,s=[],d=[];!function(){function t(t){return 4294967296*(t-(0|t))|0}for(var e=2,n=0;n<64;)!function(t){for(var e=r.sqrt(t),n=2;n<=e;n++)if(!(t%n))return;return 1}(e)||(n<8&&(s[n]=t(r.pow(e,.5))),d[n]=t(r.pow(e,1/3)),n++),e++}();var g=[],e=e.SHA256=i.extend({_doReset:function(){this._hash=new n.init(s.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],u=n[5],h=n[6],c=n[7],l=0;l<64;l++){l<16?g[l]=0|t[e+l]:(f=g[l-15],p=g[l-2],g[l]=((f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3)+g[l-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+g[l-16]);var f=i&r^i&s^r&s,p=c+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&u^~a&h)+d[l]+g[l],c=h,h=u,u=a,a=o+p|0,o=s,s=r,r=i,i=p+(((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+f)|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0,n[5]=n[5]+u|0,n[6]=n[6]+h|0,n[7]=n[7]+c|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[14+(64+i>>>9<<4)]=r.floor(n/4294967296),e[15+(64+i>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA256=i._createHelper(e),t.HmacSHA256=i._createHmacHelper(e)}(Math),function(){var t=CryptoJS,e=t.lib,r=e.Base,s=e.WordArray,t=t.x64={};t.Word=r.extend({init:function(t,e){this.high=t,this.low=e}}),t.WordArray=r.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:8*t.length},toX32:function(){for(var t=this.words,e=t.length,n=[],i=0;i<e;i++){var r=t[i];n.push(r.high),n.push(r.low)}return s.create(n,this.sigBytes)},clone:function(){for(var t=r.clone.call(this),e=t.words=this.words.slice(0),n=e.length,i=0;i<n;i++)e[i]=e[i].clone();return t}})}(),function(){function e(){return r.create.apply(r,arguments)}var t=CryptoJS,n=t.lib.Hasher,i=t.x64,r=i.Word,s=i.WordArray,i=t.algo,tt=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],et=[];!function(){for(var t=0;t<80;t++)et[t]=e()}();i=i.SHA512=n.extend({_doReset:function(){this._hash=new s.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],u=n[5],h=n[6],c=n[7],l=i.high,f=i.low,p=r.high,d=r.low,g=s.high,y=s.low,m=o.high,S=o.low,v=a.high,b=a.low,_=u.high,A=u.low,w=h.high,k=h.low,T=c.high,n=c.low,x=l,R=f,I=p,E=d,H=g,C=y,B=m,P=S,O=v,N=b,j=_,D=A,J=w,M=k,U=T,K=n,L=0;L<80;L++){var F,q,W=et[L];L<16?(q=W.high=0|t[e+2*L],F=W.low=0|t[e+2*L+1]):(V=($=et[L-15]).high,Y=$.low,Z=(Q=et[L-2]).high,z=Q.low,q=(q=(q=((V>>>1|Y<<31)^(V>>>8|Y<<24)^V>>>7)+(X=et[L-7]).high+((F=(G=(Y>>>1|V<<31)^(Y>>>8|V<<24)^(Y>>>7|V<<25))+X.low)>>>0<G>>>0?1:0))+((Z>>>19|z<<13)^(Z<<3|z>>>29)^Z>>>6)+((F=F+($=(z>>>19|Z<<13)^(z<<3|Z>>>29)^(z>>>6|Z<<26)))>>>0<$>>>0?1:0))+(Q=et[L-16]).high+((F=F+(Y=Q.low))>>>0<Y>>>0?1:0),W.high=q,W.low=F);var V=O&j^~O&J,X=N&D^~N&M,G=x&I^x&H^I&H,z=(R>>>28|x<<4)^(R<<30|x>>>2)^(R<<25|x>>>7),Z=tt[L],$=Z.high,Q=Z.low,Y=K+((N>>>14|O<<18)^(N>>>18|O<<14)^(N<<23|O>>>9)),W=U+((O>>>14|N<<18)^(O>>>18|N<<14)^(O<<23|N>>>9))+(Y>>>0<K>>>0?1:0),Z=z+(R&E^R&C^E&C),U=J,K=M,J=j,M=D,j=O,D=N,O=B+(W=(W=(W=W+V+((Y=Y+X)>>>0<X>>>0?1:0))+$+((Y=Y+Q)>>>0<Q>>>0?1:0))+q+((Y=Y+F)>>>0<F>>>0?1:0))+((N=P+Y|0)>>>0<P>>>0?1:0)|0,B=H,P=C,H=I,C=E,I=x,E=R,x=W+(((x>>>28|R<<4)^(x<<30|R>>>2)^(x<<25|R>>>7))+G+(Z>>>0<z>>>0?1:0))+((R=Y+Z|0)>>>0<Y>>>0?1:0)|0}f=i.low=f+R,i.high=l+x+(f>>>0<R>>>0?1:0),d=r.low=d+E,r.high=p+I+(d>>>0<E>>>0?1:0),y=s.low=y+C,s.high=g+H+(y>>>0<C>>>0?1:0),S=o.low=S+P,o.high=m+B+(S>>>0<P>>>0?1:0),b=a.low=b+N,a.high=v+O+(b>>>0<N>>>0?1:0),A=u.low=A+D,u.high=_+j+(A>>>0<D>>>0?1:0),k=h.low=k+M,h.high=w+J+(k>>>0<M>>>0?1:0),n=c.low=n+K,c.high=T+U+(n>>>0<K>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[30+(128+i>>>10<<5)]=Math.floor(n/4294967296),e[31+(128+i>>>10<<5)]=n,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32});t.SHA512=n._createHelper(i),t.HmacSHA512=n._createHmacHelper(i)}(),define("third-party-libs/crypto.js",function(){}),function(){"use strict";function h(t){return"function"==typeof t}function t(){}function e(){for(var t=0;t<A;t+=2)(0,T[t])(T[t+1]),T[t]=void 0,T[t+1]=void 0;A=0}function a(){}function r(t,i,r){w(function(e){var n=!1,t=function(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}(r,i,function(t){n||(n=!0,(i!==t?c:l)(e,t))},function(t){n||(n=!0,f(e,t))},e._label);!n&&t&&(n=!0,f(e,t))},t)}function i(t,e){var n,i;e.constructor===t.constructor?(n=t,(i=e)._state===I?l(n,i._result):n._state===E?f(n,i._result):u(i,void 0,function(t){c(n,t)},function(t){f(n,t)})):(i=function(t){try{return t.then}catch(t){return H.error=t,H}}(e))===H?f(t,H.error):void 0!==i&&h(i)?r(t,e,i):l(t,e)}function c(t,e){var n;t===e?f(t,new TypeError("You cannot resolve a promise with itself")):("function"==typeof(n=e)||"object"==typeof n&&null!==n?i:l)(t,e)}function n(t){t._onerror&&t._onerror(t._result),o(t)}function l(t,e){t._state===R&&(t._result=e,t._state=I,0!==t._subscribers.length&&w(o,t))}function f(t,e){t._state===R&&(t._state=E,t._result=e,w(n,t))}function u(t,e,n,i){var r=t._subscribers,s=r.length;t._onerror=null,r[s]=e,r[s+I]=n,r[s+E]=i,0===s&&t._state&&w(o,t)}function o(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i,r,s=t._result,o=0;o<e.length;o+=3)i=e[o],r=e[o+n],i?p(n,i,r,s):r(s);t._subscribers.length=0}}function s(){this.error=null}function p(t,e,n,i){var r,s,o,a,u=h(n);if(u){if((r=function(t,e){try{return t(e)}catch(t){return C.error=t,C}}(n,i))===C?(a=!0,s=r.error,r=null):o=!0,e===r)return void f(e,new TypeError("A promises callback cannot return that same promise."))}else r=i,o=!0;e._state===R&&(u&&o?c(e,r):a?f(e,s):t===I?l(e,r):t===E&&f(e,r))}function d(t,e,n,i){this._instanceConstructor=t,this.promise=new t(a,i),this._abortOnReject=n,this._validateInput(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._init(),0===this.length?l(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&l(this.promise,this._result))):f(this.promise,this._validationError())}function g(t,e){this._id=P++,this._label=e,this._state=void 0,this._result=void 0,this._subscribers=[],a!==t&&(h(t)||function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof g||function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}(),function(e,t){try{t(function(t){c(e,t)},function(t){f(e,t)})}catch(t){f(e,t)}}(this,t))}var y,m,S,v,b=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},_=b,A=(Date.now,Object.create,0),w=function(t,e){T[A]=t,T[A+1]=e,2===(A+=2)&&x()},b="undefined"!=typeof window?window:{},k=b.MutationObserver||b.WebKitMutationObserver,b="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,T=new Array(1e3),x="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?function(){process.nextTick(e)}:k?(m=0,S=new k(e),v=document.createTextNode(""),S.observe(v,{characterData:!0}),function(){v.data=m=++m%2}):b?((y=new MessageChannel).port1.onmessage=e,function(){y.port2.postMessage(0)}):function(){setTimeout(e,1)},R=void 0,I=1,E=2,H=new s,C=new s;d.prototype._validateInput=function(t){return _(t)},d.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},d.prototype._init=function(){this._result=new Array(this.length)};var B=d;d.prototype._enumerate=function(){for(var t=this.length,e=this.promise,n=this._input,i=0;e._state===R&&i<t;i++)this._eachEntry(n[i],i)},d.prototype._eachEntry=function(t,e){var n,i=this._instanceConstructor;"object"==typeof(n=t)&&null!==n?t.constructor===i&&t._state!==R?(t._onerror=null,this._settledAt(t._state,e,t._result)):this._willSettleAt(i.resolve(t),e):(this._remaining--,this._result[e]=this._makeResult(I,e,t))},d.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===R&&(this._remaining--,this._abortOnReject&&t===E?f(i,n):this._result[e]=this._makeResult(t,e,n)),0===this._remaining&&l(i,this._result)},d.prototype._makeResult=function(t,e,n){return n},d.prototype._willSettleAt=function(t,e){var n=this;u(t,void 0,function(t){n._settledAt(I,e,t)},function(t){n._settledAt(E,e,t)})};var P=0,O=g;g.all=function(t,e){return new B(this,t,!0,e).promise},g.race=function(t,e){function n(t){c(r,t)}function i(t){f(r,t)}var r=new this(a,e);if(!_(t))return f(r,new TypeError("You must pass an array to race.")),r;for(var s=t.length,o=0;r._state===R&&o<s;o++)u(this.resolve(t[o]),void 0,n,i);return r},g.resolve=function(t,e){if(t&&"object"==typeof t&&t.constructor===this)return t;e=new this(a,e);return c(e,t),e},g.reject=function(t,e){e=new this(a,e);return f(e,t),e},g.prototype={constructor:g,then:function(t,e,n){var i=this._state;if(i===I&&!t||i===E&&!e)return this;this._onerror=null;var r,s=new this.constructor(a,n),o=this._result;return i?(r=arguments[i-1],w(function(){p(i,s,r,o)})):u(this,s,t,e),s},catch:function(t,e){return this.then(null,t,e)}};var N={Promise:O,polyfill:function(){var e,t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;"Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&(new t.Promise(function(t){e=t}),h(e))||(t.Promise=O)}};"function"==typeof define&&define.amd?define("third-party-libs/es6-promise-2.0.0.js",[],function(){return N}):"undefined"!=typeof module&&module.exports?module.exports=N:void 0!==this&&(this.ES6Promise=N),window.Promise=window.Promise||N.Promise}.call(this);var jsonParse=function(){function l(t,e,n){return e?i[e]:String.fromCharCode(parseInt(n,16))}var f=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),p=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),i={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:" "},d=new String(""),g=(Object,Array,Object.hasOwnProperty);return function(t,a){var e=t.match(f),n=e[0],t=!1;"{"===n?s={}:"["===n?s=[]:(s=[],t=!0);for(var i,r,u,s,o=[s],h=1-t,c=e.length;h<c;++h)switch((n=e[h]).charCodeAt(0)){default:(r=o[0])[i||r.length]=+n,i=void 0;break;case 34:if(-1!==(n=n.substring(1,n.length-1)).indexOf("\\")&&(n=n.replace(p,l)),r=o[0],!i){if(!(r instanceof Array)){i=n||d;break}i=r.length}r[i]=n,i=void 0;break;case 91:r=o[0],o.unshift(r[i||r.length]=[]),i=void 0;break;case 93:o.shift();break;case 102:(r=o[0])[i||r.length]=!1,i=void 0;break;case 110:(r=o[0])[i||r.length]=null,i=void 0;break;case 116:(r=o[0])[i||r.length]=!0,i=void 0;break;case 123:r=o[0],o.unshift(r[i||r.length]={}),i=void 0;break;case 125:o.shift()}if(t){if(1!==o.length)throw new Error;s=s[0]}else if(o.length)throw new Error;return s=a?(u=function(t,e){var n=t[e];if(n&&"object"==typeof n){var i,r,s=null;for(i in n)g.call(n,i)&&n!==t&&(void 0!==(r=u(n,i))?n[i]=r:(s=s||[]).push(i));if(s)for(var o=s.length;0<=--o;)delete n[s[o]]}return a.call(t,e,n)})({"":s},""):s}}();define("third-party-libs/json-sans-eval.js",function(){}),"undefined"!=typeof KJUR&&KJUR||(KJUR={}),void 0!==KJUR.jws&&KJUR.jws||(KJUR.jws={}),KJUR.jws.JWS=function(){function o(t,e){return utf8tob64u(t)+"."+utf8tob64u(e)}function a(t){var e=t.alg,t="";if("RS256"!=e&&"RS512"!=e&&"PS256"!=e&&"PS512"!=e)throw"JWS signature algorithm not supported: "+e;return"256"==e.substr(2)&&(t="sha256"),t="512"==e.substr(2)?"sha512":t}function u(t){return a(jsonParse(t))}function s(t,e,n,i,r,s){var o=new RSAKey;o.setPrivate(i,r,s);t=u(t);return o.signString(n,t)}this.parseJWS=function(t,e){if(void 0===this.parsedJWS||!e&&void 0===this.parsedJWS.sigvalH){if(null==t.match(/^([^.]+)\.([^.]+)\.([^.]+)$/))throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var n=RegExp.$1,i=RegExp.$2,r=RegExp.$3,t=n+"."+i;this.parsedJWS={},this.parsedJWS.headB64U=n,this.parsedJWS.payloadB64U=i,this.parsedJWS.sigvalB64U=r,this.parsedJWS.si=t,e||(r=parseBigInt(e=b64utohex(r),16),this.parsedJWS.sigvalH=e,this.parsedJWS.sigvalBI=r);n=b64utoutf8(n),i=b64utoutf8(i);if(this.parsedJWS.headS=n,this.parsedJWS.payloadS=i,!KJUR.jws.JWS.isSafeJSONString(n,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+n}},this.verifyJWSByNE=function(t,e,n){return this.parseJWS(t),_rsasign_verifySignatureWithArgs(this.parsedJWS.si,this.parsedJWS.sigvalBI,e,n)},this.verifyJWSByKey=function(t,e){this.parseJWS(t);var n=a(this.parsedJWS.headP),t="PS"==this.parsedJWS.headP.alg.substr(0,2);return e.hashAndVerify?e.hashAndVerify(n,new Buffer(this.parsedJWS.si,"utf8").toString("base64"),b64utob64(this.parsedJWS.sigvalB64U),"base64",t):t?e.verifyStringPSS(this.parsedJWS.si,this.parsedJWS.sigvalH,n):e.verifyString(this.parsedJWS.si,this.parsedJWS.sigvalH)},this.verifyJWSByPemX509Cert=function(t,e){this.parseJWS(t);t=new X509;return t.readCertPEM(e),t.subjectPublicKeyRSA.verifyString(this.parsedJWS.si,this.parsedJWS.sigvalH)},this.generateJWSByNED=function(t,e,n,i,r){if(!KJUR.jws.JWS.isSafeJSONString(t))throw"JWS Head is not safe JSON string: "+t;e=o(t,e),r=hextob64u(s(t,0,e,n,i,r));return this.parsedJWS={},this.parsedJWS.headB64U=e.split(".")[0],this.parsedJWS.payloadB64U=e.split(".")[1],e+"."+(this.parsedJWS.sigvalB64U=r)},this.generateJWSByKey=function(t,e,n){var i={};if(!KJUR.jws.JWS.isSafeJSONString(t,i,"headP"))throw"JWS Head is not safe JSON string: "+t;var r,s=o(t,e),n=(r=t,e=s,t=n,n=null,n=void 0===(i=i.headP)?u(r):a(i),i="PS"==i.alg.substr(0,2),t.hashAndSign?b64tob64u(t.hashAndSign(n,e,"binary","base64",i)):hextob64u(i?t.signStringPSS(e,n):t.signString(e,n)));return this.parsedJWS={},this.parsedJWS.headB64U=s.split(".")[0],this.parsedJWS.payloadB64U=s.split(".")[1],s+"."+(this.parsedJWS.sigvalB64U=n)},this.generateJWSByP1PrvKey=function(t,e,n){if(!KJUR.jws.JWS.isSafeJSONString(t))throw"JWS Head is not safe JSON string: "+t;var i,r=o(t,e),i=hextob64u((i=t,e=r,t=n,(n=new RSAKey).readPrivateKeyFromPEMString(t),i=u(i),n.signString(e,i)));return this.parsedJWS={},this.parsedJWS.headB64U=r.split(".")[0],this.parsedJWS.payloadB64U=r.split(".")[1],r+"."+(this.parsedJWS.sigvalB64U=i)}},KJUR.jws.JWS.sign=function(t,e,n,i,r){var s=KJUR.jws.JWS;if(!s.isSafeJSONString(e))throw"JWS Head is not safe JSON string: "+sHead;var o=s.readSafeJSONString(e);""!=(t=(""==t||null==t)&&void 0!==o.alg?o.alg:t)&&null!=t&&void 0===o.alg&&(o.alg=t,e=JSON.stringify(o));o=null;if(void 0===s.jwsalg2sigalg[t])throw"unsupported alg name: "+t;var a,o=s.jwsalg2sigalg[t],t=utf8tob64u(e)+"."+utf8tob64u(n),e="";if("Hmac"==o.substr(0,4)){if(void 0===i)throw"hexadecimal key shall be specified for HMAC";n=new KJUR.crypto.Mac({alg:o,pass:hextorstr(i)});n.updateString(t),e=n.doFinal()}else-1!=o.indexOf("withECDSA")?((a=new KJUR.crypto.Signature({alg:o})).init(i,r),a.updateString(t),hASN1Sig=a.sign(),e=KJUR.crypto.ECDSA.asn1SigToConcatSig(hASN1Sig)):"none"!=o&&((a=new KJUR.crypto.Signature({alg:o})).init(i,r),a.updateString(t),e=a.sign());return t+"."+hextob64u(e)},KJUR.jws.JWS.verify=function(t,e){var n=KJUR.jws.JWS,i=t.split("."),r=i[0]+"."+i[1],s=b64utohex(i[2]),o=n.readSafeJSONString(b64utoutf8(i[0])),t=null;if(void 0===o.alg)throw"algorithm not specified in header";t=o.alg,i=null;if(void 0===n.jwsalg2sigalg[o.alg])throw"unsupported alg name: "+t;if("none"==(i=n.jwsalg2sigalg[t]))return!0;if("Hmac"==i.substr(0,4)){if(void 0===e)throw"hexadecimal key shall be specified for HMAC";var a=new KJUR.crypto.Mac({alg:i,pass:hextorstr(e)});return a.updateString(r),hSig2=a.doFinal(),s==hSig2}if(-1==i.indexOf("withECDSA"))return(u=new KJUR.crypto.Signature({alg:i})).init(e),u.updateString(r),u.verify(s);var u,a=null;try{a=KJUR.crypto.ECDSA.concatSigToASN1Sig(s)}catch(t){return!1}return(u=new KJUR.crypto.Signature({alg:i})).init(e),u.updateString(r),u.verify(a)},KJUR.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},KJUR.jws.JWS.isSafeJSONString=function(t,e,n){var i;try{return"object"!=typeof(i=jsonParse(t))||i.constructor===Array?0:(e&&(e[n]=i),1)}catch(t){return 0}},KJUR.jws.JWS.readSafeJSONString=function(t){var e;try{return"object"!=typeof(e=jsonParse(t))||e.constructor===Array?null:e}catch(t){return null}},KJUR.jws.JWS.getEncodedSignatureValueFromJWS=function(t){if(null==t.match(/^[^.]+\.[^.]+\.([^.]+)$/))throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return RegExp.$1},KJUR.jws.IntDate=function(){},KJUR.jws.IntDate.get=function(t){if("now"==t)return KJUR.jws.IntDate.getNow();if("now + 1hour"==t)return KJUR.jws.IntDate.getNow()+3600;if("now + 1day"==t)return KJUR.jws.IntDate.getNow()+86400;if("now + 1month"==t)return KJUR.jws.IntDate.getNow()+2592e3;if("now + 1year"==t)return KJUR.jws.IntDate.getNow()+31536e3;if(t.match(/Z$/))return KJUR.jws.IntDate.getZulu(t);if(t.match(/^[0-9]+$/))return parseInt(t);throw"unsupported format: "+t},KJUR.jws.IntDate.getZulu=function(t){if(a=t.match(/(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z/)){var e=parseInt(RegExp.$1),n=parseInt(RegExp.$2)-1,i=parseInt(RegExp.$3),r=parseInt(RegExp.$4),s=parseInt(RegExp.$5),o=parseInt(RegExp.$6);return~~(new Date(Date.UTC(e,n,i,r,s,o))/1e3)}throw"unsupported format: "+t},KJUR.jws.IntDate.getNow=function(){return~~(new Date/1e3)},KJUR.jws.IntDate.intDate2UTCString=function(t){return new Date(1e3*t).toUTCString()},KJUR.jws.IntDate.intDate2Zulu=function(t){t=new Date(1e3*t);return("0000"+t.getUTCFullYear()).slice(-4)+("00"+(t.getUTCMonth()+1)).slice(-2)+("00"+t.getUTCDate()).slice(-2)+("00"+t.getUTCHours()).slice(-2)+("00"+t.getUTCMinutes()).slice(-2)+("00"+t.getUTCSeconds()).slice(-2)+"Z"},define("third-party-libs/jws-3.0.js",function(){});var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64pad="=",dbits,canary=0xdeadbeefcafe,j_lm=15715070==(16777215&canary),dbits=j_lm&&"Microsoft Internet Explorer"==navigator.appName?(BigInteger.prototype.am=am2,30):j_lm&&"Netscape"!=navigator.appName?(BigInteger.prototype.am=am1,26):(BigInteger.prototype.am=am3,28);BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;for(var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv,rr="0".charCodeAt(0),vv=0;vv<=9;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare;var SHA1_SIZE=20;RSAKey.prototype.doPublic=RSADoPublic,RSAKey.prototype.setPublic=RSASetPublic,RSAKey.prototype.encrypt=RSAEncrypt,RSAKey.prototype.encryptOAEP=RSAEncryptOAEP,RSAKey.prototype.type="RSA";var SHA1_SIZE=20;RSAKey.prototype.doPrivate=RSADoPrivate,RSAKey.prototype.setPrivate=RSASetPrivate,RSAKey.prototype.setPrivateEx=RSASetPrivateEx,RSAKey.prototype.generate=RSAGenerate,RSAKey.prototype.decrypt=RSADecrypt,RSAKey.prototype.decryptOAEP=RSADecryptOAEP,RSAKey.prototype.readPrivateKeyFromPEMString=_rsapem_readPrivateKeyFromPEMString,RSAKey.prototype.readPrivateKeyFromASN1HexString=_rsapem_readPrivateKeyFromASN1HexString;var _RE_HEXDECONLY=new RegExp("");_RE_HEXDECONLY.compile("[^0-9a-f]","gi"),RSAKey.prototype.signWithMessageHash=_rsasign_signWithMessageHash,RSAKey.prototype.signString=_rsasign_signString,RSAKey.prototype.signStringWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signStringWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.sign=_rsasign_signString,RSAKey.prototype.signWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.signWithMessageHashPSS=_rsasign_signWithMessageHashPSS,RSAKey.prototype.signStringPSS=_rsasign_signStringPSS,RSAKey.prototype.signPSS=_rsasign_signStringPSS,RSAKey.SALT_LEN_HLEN=-1,RSAKey.SALT_LEN_MAX=-2,RSAKey.prototype.verifyWithMessageHash=_rsasign_verifyWithMessageHash,RSAKey.prototype.verifyString=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verify=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForByteArrayMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verifyWithMessageHashPSS=_rsasign_verifyWithMessageHashPSS,RSAKey.prototype.verifyStringPSS=_rsasign_verifyStringPSS,RSAKey.prototype.verifyPSS=_rsasign_verifyStringPSS,RSAKey.SALT_LEN_RECOVER=-2;var ASN1HEX=new function(){this.getByteLengthOfL_AtObj=function(t,e){if("8"!=t.substring(e+2,e+3))return 1;e=parseInt(t.substring(e+3,e+4));return 0==e?-1:0<e&&e<10?e+1:-2},this.getHexOfL_AtObj=function(t,e){var n=this.getByteLengthOfL_AtObj(t,e);return n<1?"":t.substring(e+2,e+2+2*n)},this.getIntOfL_AtObj=function(t,e){e=this.getHexOfL_AtObj(t,e);return""==e?-1:(parseInt(e.substring(0,1))<8?new BigInteger(e,16):new BigInteger(e.substring(2),16)).intValue()},this.getStartPosOfV_AtObj=function(t,e){t=this.getByteLengthOfL_AtObj(t,e);return t<0?t:e+2*(t+1)},this.getHexOfV_AtObj=function(t,e){var n=this.getStartPosOfV_AtObj(t,e),e=this.getIntOfL_AtObj(t,e);return t.substring(n,n+2*e)},this.getHexOfTLV_AtObj=function(t,e){return t.substr(e,2)+this.getHexOfL_AtObj(t,e)+this.getHexOfV_AtObj(t,e)},this.getPosOfNextSibling_AtObj=function(t,e){return this.getStartPosOfV_AtObj(t,e)+2*this.getIntOfL_AtObj(t,e)},this.getPosArrayOfChildren_AtObj=function(t,e){var n=new Array,i=this.getStartPosOfV_AtObj(t,e);n.push(i);for(var r=this.getIntOfL_AtObj(t,e),s=i,o=0;;){var a=this.getPosOfNextSibling_AtObj(t,s);if(null==a||2*r<=a-i)break;if(200<=o)break;n.push(a),s=a,o++}return n},this.getNthChildIndex_AtObj=function(t,e,n){return this.getPosArrayOfChildren_AtObj(t,e)[n]},this.getDecendantIndexByNthList=function(t,e,n){if(0==n.length)return e;var i=n.shift(),e=this.getPosArrayOfChildren_AtObj(t,e);return this.getDecendantIndexByNthList(t,e[i],n)},this.getDecendantHexTLVByNthList=function(t,e,n){n=this.getDecendantIndexByNthList(t,e,n);return this.getHexOfTLV_AtObj(t,n)},this.getDecendantHexVByNthList=function(t,e,n){n=this.getDecendantIndexByNthList(t,e,n);return this.getHexOfV_AtObj(t,n)}},utf8tob64u,b64utoutf8;ASN1HEX.getVbyList=function(t,e,n,i){n=this.getDecendantIndexByNthList(t,e,n);if(void 0===n)throw"can't find nthList object";if(void 0!==i&&t.substr(n,2)!=i)throw"checking tag doesn't match: "+t.substr(n,2)+"!="+i;return this.getHexOfV_AtObj(t,n)},ASN1HEX.hextooidstr=function(t){function e(t,e){return t.length>=e?t:new Array(e-t.length+1).join("0")+t}var n=[],i=t.substr(0,2),i=parseInt(i,16);n[0]=new String(Math.floor(i/40)),n[1]=new String(i%40);for(var r=t.substr(2),s=[],o=0;o<r.length/2;o++)s.push(parseInt(r.substr(2*o,2),16));for(var a=[],u="",o=0;o<s.length;o++)128&s[o]?u+=e((127&s[o]).toString(2),7):(u+=e((127&s[o]).toString(2),7),a.push(new String(parseInt(u,2))),u="");n=n.join(".");return n=0<a.length?n+"."+a.join("."):n},X509.pemToBase64=function(t){return t=(t=(t=t.replace("-----BEGIN CERTIFICATE-----","")).replace("-----END CERTIFICATE-----","")).replace(/[ \n]+/g,"")},X509.pemToHex=function(t){return b64tohex(X509.pemToBase64(t))},X509.getSubjectPublicKeyPosFromCertHex=function(t){var e=X509.getSubjectPublicKeyInfoPosFromCertHex(t);if(-1==e)return-1;e=ASN1HEX.getPosArrayOfChildren_AtObj(t,e);if(2!=e.length)return-1;e=e[1];if("03"!=t.substring(e,e+2))return-1;e=ASN1HEX.getStartPosOfV_AtObj(t,e);return"00"!=t.substring(e,e+2)?-1:e+2},X509.getSubjectPublicKeyInfoPosFromCertHex=function(t){var e=ASN1HEX.getStartPosOfV_AtObj(t,0),e=ASN1HEX.getPosArrayOfChildren_AtObj(t,e);return e.length<1?-1:"a003020102"==t.substring(e[0],e[0]+10)?e.length<6?-1:e[6]:e.length<5?-1:e[5]},X509.getPublicKeyHexArrayFromCertHex=function(t){var e=X509.getSubjectPublicKeyPosFromCertHex(t),n=ASN1HEX.getPosArrayOfChildren_AtObj(t,e);if(2!=n.length)return[];e=ASN1HEX.getHexOfV_AtObj(t,n[0]),n=ASN1HEX.getHexOfV_AtObj(t,n[1]);return null!=e&&null!=n?[e,n]:[]},X509.getHexTbsCertificateFromCert=function(t){return ASN1HEX.getStartPosOfV_AtObj(t,0)},X509.getPublicKeyHexArrayFromCertPEM=function(t){t=X509.pemToHex(t);return X509.getPublicKeyHexArrayFromCertHex(t)},X509.hex2dn=function(t){for(var e="",n=ASN1HEX.getPosArrayOfChildren_AtObj(t,0),i=0;i<n.length;i++)var r=ASN1HEX.getHexOfTLV_AtObj(t,n[i]),e=e+"/"+X509.hex2rdn(r);return e},X509.hex2rdn=function(e){var n=ASN1HEX.getDecendantHexTLVByNthList(e,0,[0,0]),t=ASN1HEX.getDecendantHexVByNthList(e,0,[0,1]),e="";try{e=X509.DN_ATTRHEX[n]}catch(t){e=n}t=t.replace(/(..)/g,"%$1");return e+"="+decodeURIComponent(t)},X509.DN_ATTRHEX={"0603550406":"C","060355040a":"O","060355040b":"OU","0603550403":"CN","0603550405":"SN","0603550408":"ST","0603550407":"L"},X509.getPublicKeyFromCertPEM=function(t){var e=X509.getPublicKeyInfoPropOfCertPEM(t);if("2a864886f70d010101"==e.algoid){var n=KEYUTIL.parsePublicRawRSAKeyHex(e.keyhex);return(r=new RSAKey).setPublic(n.n,n.e),r}if("2a8648ce3d0201"==e.algoid){var i=KJUR.crypto.OID.oidhex2name[e.algparam];return(r=new KJUR.crypto.ECDSA({curve:i,info:e.keyhex})).setPublicKeyHex(e.keyhex),r}if("2a8648ce380401"!=e.algoid)throw"unsupported key";var r,t=ASN1HEX.getVbyList(e.algparam,0,[0],"02"),n=ASN1HEX.getVbyList(e.algparam,0,[1],"02"),i=ASN1HEX.getVbyList(e.algparam,0,[2],"02"),e=(e=ASN1HEX.getHexOfV_AtObj(e.keyhex,0)).substr(2);return(r=new KJUR.crypto.DSA).setPublic(new BigInteger(t,16),new BigInteger(n,16),new BigInteger(i,16),new BigInteger(e,16)),r},X509.getPublicKeyInfoPropOfCertPEM=function(t){var e={algparam:null},n=X509.pemToHex(t),i=ASN1HEX.getPosArrayOfChildren_AtObj(n,0);if(3!=i.length)throw"malformed X.509 certificate PEM (code:001)";if("30"!=n.substr(i[0],2))throw"malformed X.509 certificate PEM (code:002)";t=ASN1HEX.getPosArrayOfChildren_AtObj(n,i[0]);if(t.length<7)throw"malformed X.509 certificate PEM (code:003)";i=ASN1HEX.getPosArrayOfChildren_AtObj(n,t[6]);if(2!=i.length)throw"malformed X.509 certificate PEM (code:004)";t=ASN1HEX.getPosArrayOfChildren_AtObj(n,i[0]);if(2!=t.length)throw"malformed X.509 certificate PEM (code:005)";if(e.algoid=ASN1HEX.getHexOfV_AtObj(n,t[0]),"06"==n.substr(t[1],2)?e.algparam=ASN1HEX.getHexOfV_AtObj(n,t[1]):"30"==n.substr(t[1],2)&&(e.algparam=ASN1HEX.getHexOfTLV_AtObj(n,t[1])),"03"!=n.substr(i[1],2))throw"malformed X.509 certificate PEM (code:006)";i=ASN1HEX.getHexOfV_AtObj(n,i[1]);return e.keyhex=i.substr(2),e},"undefined"!=typeof KJUR&&KJUR||(KJUR={}),void 0!==KJUR.crypto&&KJUR.crypto||(KJUR.crypto={}),KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:"CryptoJS.algo.MD5",sha1:"CryptoJS.algo.SHA1",sha224:"CryptoJS.algo.SHA224",sha256:"CryptoJS.algo.SHA256",sha384:"CryptoJS.algo.SHA384",sha512:"CryptoJS.algo.SHA512",ripemd160:"CryptoJS.algo.RIPEMD160"},this.getDigestInfoHex=function(t,e){if(void 0===this.DIGESTINFOHEAD[e])throw"alg not supported in Util.DIGESTINFOHEAD: "+e;return this.DIGESTINFOHEAD[e]+t},this.getPaddedDigestInfoHex=function(t,e,n){var i=this.getDigestInfoHex(t,e),t=n/4;if(i.length+22>t)throw"key is too short for SigAlg: keylen="+n+","+e;for(var i="00"+i,r="",s=t-"0001".length-i.length,o=0;o<s;o+=2)r+="ff";return"0001"+r+i},this.hashString=function(t,e){return new KJUR.crypto.MessageDigest({alg:e}).digestString(t)},this.hashHex=function(t,e){return new KJUR.crypto.MessageDigest({alg:e}).digestHex(t)},this.sha1=function(t){return new KJUR.crypto.MessageDigest({alg:"sha1",prov:"cryptojs"}).digestString(t)},this.sha256=function(t){return new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"}).digestString(t)},this.sha256Hex=function(t){return new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"}).digestHex(t)},this.sha512=function(t){return new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"}).digestString(t)},this.sha512Hex=function(t){return new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"}).digestHex(t)},this.md5=function(t){return new KJUR.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(t)},this.ripemd160=function(t){return new KJUR.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(t)},this.getCryptoJSMDByName=function(t){}},KJUR.crypto.MessageDigest=function(params){var md=null,algName=null,provName=null;this.setAlgAndProvider=function(alg,prov){if(null!=alg&&void 0===prov&&(prov=KJUR.crypto.Util.DEFAULTPROVIDER[alg]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(alg)&&"cryptojs"==prov){try{this.md=eval(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[alg]).create()}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(t){this.md.update(t)},this.updateHex=function(t){t=CryptoJS.enc.Hex.parse(t);this.md.update(t)},this.digest=function(){return this.md.finalize().toString(CryptoJS.enc.Hex)},this.digestString=function(t){return this.updateString(t),this.digest()},this.digestHex=function(t){return this.updateHex(t),this.digest()}}if(-1!=":sha256:".indexOf(alg)&&"sjcl"==prov){try{this.md=new sjcl.hash.sha256}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(t){this.md.update(t)},this.updateHex=function(t){t=sjcl.codec.hex.toBits(t);this.md.update(t)},this.digest=function(){var t=this.md.finalize();return sjcl.codec.hex.fromBits(t)},this.digestString=function(t){return this.updateString(t),this.digest()},this.digestHex=function(t){return this.updateHex(t),this.digest()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==params&&void 0!==params.alg&&(this.algName=params.alg,void 0===params.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},KJUR.crypto.Mac=function(params){var mac=null,pass=null,algName=null,provName=null,algProv=null;this.setAlgAndProvider=function(alg,prov){if(null==alg&&(alg="hmacsha1"),alg=alg.toLowerCase(),"hmac"!=alg.substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+alg;void 0===prov&&(prov=KJUR.crypto.Util.DEFAULTPROVIDER[alg]),this.algProv=alg+"/"+prov;var hashAlg=alg.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(hashAlg)&&"cryptojs"==prov){try{var mdObj=eval(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[hashAlg]);this.mac=CryptoJS.algo.HMAC.create(mdObj,this.pass)}catch(ex){throw"setAlgAndProvider hash alg set fail hashAlg="+hashAlg+"/"+ex}this.updateString=function(t){this.mac.update(t)},this.updateHex=function(t){t=CryptoJS.enc.Hex.parse(t);this.mac.update(t)},this.doFinal=function(){return this.mac.finalize().toString(CryptoJS.enc.Hex)},this.doFinalString=function(t){return this.updateString(t),this.doFinal()},this.doFinalHex=function(t){return this.updateHex(t),this.doFinal()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},void 0!==params&&(void 0!==params.pass&&(this.pass=params.pass),void 0!==params.alg&&(this.algName=params.alg,void 0===params.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},KJUR.crypto.Signature=function(t){var e=null;if(this._setAlgNames=function(){this.algName.match(/^(.+)with(.+)$/)&&(this.mdAlgName=RegExp.$1.toLowerCase(),this.pubkeyAlgName=RegExp.$2.toLowerCase())},this._zeroPaddingOfSignature=function(t,e){for(var n="",i=e/4-t.length,r=0;r<i;r++)n+="0";return n+t},this.setAlgAndProvider=function(t,e){if(this._setAlgNames(),"cryptojs/jsrsa"!=e)throw"provider not supported: "+e;if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName})}catch(t){throw"setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+t}this.init=function(t,e){var n=null;try{n=void 0===e?KEYUTIL.getKey(t):KEYUTIL.getKey(t,e)}catch(t){throw"init failed:"+t}if(!0===n.isPrivate)this.prvKey=n,this.state="SIGN";else{if(!0!==n.isPublic)throw"init failed.:"+n;this.pubKey=n,this.state="VERIFY"}},this.initSign=function(t){"string"==typeof t.ecprvhex&&"string"==typeof t.eccurvename?(this.ecprvhex=t.ecprvhex,this.eccurvename=t.eccurvename):this.prvKey=t,this.state="SIGN"},this.initVerifyByPublicKey=function(t){"string"==typeof t.ecpubhex&&"string"==typeof t.eccurvename?(this.ecpubhex=t.ecpubhex,this.eccurvename=t.eccurvename):(t instanceof KJUR.crypto.ECDSA||t instanceof RSAKey)&&(this.pubKey=t),this.state="VERIFY"},this.initVerifyByCertificatePEM=function(t){var e=new X509;e.readCertPEM(t),this.pubKey=e.subjectPublicKeyRSA,this.state="VERIFY"},this.updateString=function(t){this.md.updateString(t)},this.updateHex=function(t){this.md.updateHex(t)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0!==this.ecprvhex&&void 0!==this.eccurvename){var t=new KJUR.crypto.ECDSA({curve:this.eccurvename});this.hSign=t.signHex(this.sHashHex,this.ecprvhex)}else if("rsaandmgf1"==this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if("rsa"==this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof KJUR.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof KJUR.crypto.DSA))throw"Signature: unsupported public key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(t){return this.updateString(t),this.sign()},this.signHex=function(t){return this.updateHex(t),this.sign()},this.verify=function(t){if(this.sHashHex=this.md.digest(),void 0!==this.ecpubhex&&void 0!==this.eccurvename)return new KJUR.crypto.ECDSA({curve:this.eccurvename}).verifyHex(this.sHashHex,t,this.ecpubhex);if("rsaandmgf1"==this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,t,this.mdAlgName,this.pssSaltLen);if("rsa"==this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,t);if(this.pubKey instanceof KJUR.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,t);if(this.pubKey instanceof KJUR.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,t);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(t,e){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.initVerifyByPublicKey=function(t){throw"initVerifyByPublicKey(rsaPubKeyy) not supported for this alg:prov="+this.algProvName},this.initVerifyByCertificatePEM=function(t){throw"initVerifyByCertificatePEM(certPEM) not supported for this alg:prov="+this.algProvName},this.initSign=function(t){throw"initSign(prvKey) not supported for this alg:prov="+this.algProvName},this.updateString=function(t){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(t){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(t){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(t){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},void 0!==(this.initParams=t)&&(void 0!==t.alg&&(this.algName=t.alg,void 0===t.prov?this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=t.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==t.psssaltlen&&(this.pssSaltLen=t.psssaltlen),void 0!==t.prvkeypem)){if(void 0!==t.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{(e=new RSAKey).readPrivateKeyFromPEMString(t.prvkeypem),this.initSign(e)}catch(t){throw"fatal error to load pem private key: "+t}}},KJUR.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},b64utoutf8="function"==typeof Buffer?(utf8tob64u=function(t){return b64tob64u(new Buffer(t,"utf8").toString("base64"))},function(t){return new Buffer(b64utob64(t),"base64").toString("utf8")}):(utf8tob64u=function(t){return hextob64u(uricmptohex(encodeURIComponentAll(t)))},function(t){return decodeURIComponent(hextouricmp(b64utohex(t)))}),define("third-party-libs/rsa.js",function(){}),define("DefaultHttpRequest",["DefaultPromiseFactory","asos.identity.helper","frameloader","asos.identity.sdk.config"],function(e,u,h,t){"use strict";return new function(t){this.gatewayURL=t,Object.keys||(Object.keys=function(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e);return n}),this.getJSON=function(a,t){return t&&t.query&&t.query.forEach(function(t){a=u.queryString.setValue(a,t.name,t.value)}),e.create(function(n,e){try{var t=(r="GET",s=a,void 0!==(o=new XMLHttpRequest).withCredentials?(u.log("CORS supported (XHR)"),o.open(r,s,!0),o.withCredentials=!0):(u.log("No CORS Support!"),o=null),o);if(!t){var i=new h({url:this.gatewayURL});return i.loadAsync().then(function(t){i.postMessage(t,a).then(function(t){try{var e=t.data;"string"==typeof e&&(e=JSON.parse(e)),n(e),i.dispose()}catch(t){i.dispose()}},function(){i.dispose()})})}t.setRequestHeader("Accept","application/json"),t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&(200===t.status?n(JSON.parse(t.responseText)):e(t))},t.send()}catch(t){e(t)}var r,s,o}.bind(this))},this.postJSON=function(r,s,o){return e.create(function(t,e){try{o&&o.query&&o.query.forEach(function(t){r=u.queryString.setValue(r,t.name,t.value)});var n=new XMLHttpRequest;n.open("POST",r,!0),n.withCredentials=!0,n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?t(JSON.parse(n.responseText)):e(n))},n.send((i=s,Object.keys(i).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(i[t])}).join("&")))}catch(t){e(t)}var i}.bind(this))}}(t.gatewayURL)}),define("thirdparty-wrappers/defaultHttpRequest.js",function(){}),define("CustomerApiHttpRequest",["asos.identity.sdk.initializer","DefaultPromiseFactory","asos.identity.helper","asos.identity.sdk.config"],function(e,n,i,u){"use strict";return{getJSON:function(a,t){return t&&t.query&&t.query.forEach(function(t){a=i.queryString.setValue(a,t.name,t.value)}),n.create(function(s,o){try{e.ready().then(function(t){t.getFreshAccessTokenAsync().then(function(t){var e,n,i,r;e=a,t=t,n=s,i=o,(r=function(t,e){var n=new XMLHttpRequest;return void 0!==n.withCredentials?(n.open(t,e,!0),n.withCredentials=!0):n=null,n}("GET",u.customerApiUrl+e)).setRequestHeader("Authorization","Bearer "+t),r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&(200===r.status?n(JSON.parse(r.responseText)):i(r))},r.send()},o)})}catch(t){o(t)}})}}}),define("thirdparty-wrappers/customerApiHttpRequest.js",function(){}),define("DefaultPromiseFactory",["cryptoLibs"],function(e){"use strict";function i(n){this.then=function(t,e){return new i(n.then(t,e))},this.catch=function(t){return new i(n.catch(t))}}return new function(){this.resolve=function(t){return new i(e.Promise.resolve(t))},this.reject=function(t){return new i(e.Promise.reject(t))},this.create=function(t){return new i(new e.Promise(t))}}}),define("thirdparty-wrappers/defaultPromiseFactory.js",function(){}),define("Asos.Identity.Web.ClientSdk.OidcWrapper",["asos.identity.task","asos.identity.sdk.customerparser","asos.identity.events","asos.identity.sdk.supportedEventTypes","asos.identity.helper","DefaultHttpRequest","DefaultPromiseFactory","tokenmanager","Asos.Identity.Web.ClientSdk.CheckSession","asos.identity.sdk.asosCookieHandler","asos.identity.sdk.perxCookieHandler"],function(p,d,g,y,m,S,v,b,_,A){"use strict";return function(){function e(t){t=d.getCustomer(t);t.isNewUser&&g.publish(y.onRegistered,t),t.isAnonymous?g.publish(y.onAnonymous,t):g.publish(y.onLoggedIn,t)}function i(t){t&&((t=d.getCustomer(t)).isAnonymous||g.publish(y.onSessionExpired,t))}function r(t){t&&((t=d.getCustomer(t)).isAnonymous||g.publish(y.onSessionEnded,t))}function s(i){return v.create(function(e,t){var n=d.getCustomer(f.getToken());if("unchanged"===i.state&&n&&n.isAuthenticated)return _.checkSessionState(f,o).then(function(){e()},t);if("changed"===i.state)return u({saveToStorage:!1}).then(function(t){if(t&&!t.isAnonymous())return f.saveToken(t),_.checkSessionState(f,o).then(function(){e()})},function(){f.removeToken(),e()});if("unauthenticated"===i.state&&f.removeToken(),"recognised"===i.state)if(null==n||n.isAnonymous)i.state="anonymous";else if(f.expired(f.getToken())||f.markTokenAsExpired(),!i.asosTsCookie)return f.getNewAccessTokenForBrowserSessionAsync().then(function(){e()},t);if("anonymous"===i.state){if(!n||!n.isAnonymous||n.customerGuid!==i.data)return f.removeToken(),h().then(function(){e()},t);if(!i.asosTsCookie)return f.removeToken(),h().then(function(){e()},t)}e()})}function o(t){var e=f.getToken();"changed"===t.data&&e&&!e.isAnonymous()&&f.removeToken()}function a(){return f.getToken()?d.getCustomer(f.getToken()):void 0}function u(t){return n.run(function(){var e=m.extend({},{response_type:"id_token token",prompt:"none",defaultQuery:l.defaultQuery.slice(0)},t);return f.generateTokenRequestUrl(e).then(function(t){return S.getJSON(t,{withCredentials:!0,query:e.defaultQuery}).then(function(t){return c(t).then(function(t){return f.transformToken(t)})})})})}function h(n){return t.run(function(){var e=m.extend({},{response_type:"id_token token",acr_values:"0",defaultQuery:l.defaultQuery.slice(0),saveToStorage:!0},n),t=a(),t=t&&t.isAnonymous?t.customerGuid:A.readCustomerGuid();return t&&e.defaultQuery.push({name:"cgd",value:t}),f.generateTokenRequestUrl(e).then(function(t){return S.getJSON(t,{withCredentials:!0,query:e.defaultQuery}).then(function(t){return c(t).then(function(t){return e.saveToStorage&&f.saveToken(t),f.transformToken(t)})},function(t){m.error("errored: "+t.message)})})})}function c(t){return f.oidcClient.processResponseAsync(t).then(function(t){return t},function(t){m.error(t.message)})}var l=void 0,f=void 0,t=new p,n=new p;return{init:function(n){return f=function(t){t=new b(t);return t.addOnTokenObtained(e),t.addOnTokenExpired(i),t.addOnTokenRemoved(r),t}(l=n),v.create(function(e,t){return l.hash?f.processTokenCallbackAsync(n.hash).then(function(){return _.checkSessionState(f,o).then(e)},t):_.getCurrentState(f).then(function(t){return s(t).then(e)},t)})},customer:a,profile:function(){return f.profile()},authorize:function(t){f.redirectForToken(t)},logout:function(){f.redirectForLogout()},loadAnonToken:h,getAccessToken:function(){return f.getToken()},getFreshAccessTokenAsync:function(){return f.getFreshAccessTokenAsync()},getCurrentStateCallback:s,checkSessionStateCallback:o,checkIfAuthenticated:u,handleAnonCallback:c}}}),define("thirdparty-wrappers/OpenIdComponentWrapper.js",function(){}),define("frameloader",["DefaultPromiseFactory","asos.identity.helper"],function(e,n){"use strict";function t(t){t&&(this.url=t.url,this.id=t.id),this.callback=function(t){this.messageCallbackHandler(t)}}return t.prototype.messageCallbackHandler=function(t){try{var e=function(t){if(t&&t.data&&t.origin===this.target){var e;try{e=JSON.parse(t.data)}catch(t){return}return e&&e.sig===this.id?{origin:t.origin,data:e.data}:void 0}}.call(this,t);e&&this.resolve(e)}catch(t){console.error(t)}},t.prototype.postMessage=function(t,i){var r=(t.currentTarget||t.srcElement).contentWindow;return e.create(function(t,e){this.resolve=t;try{var n=JSON.stringify({sig:this.id,data:i});(function(){this.listenerSubscribed||(window.addEventListener?window.addEventListener("message",this.callback.bind(this),!1):window.attachEvent("onmessage",this.callback.bind(this)),this.listenerSubscribed=!0)}).call(this),r.postMessage(n,this.target)}catch(t){e(t)}}.bind(this))},t.prototype.dispose=function(){window.removeEventListener?window.removeEventListener("message",this.callback.bind(this),!1):window.detachEvent("onmessage",this.callback.bind(this)),document.body.removeChild(this.frame)},t.prototype.loadAsync=function(t){return this.url=t||this.url,this.id=this.id||n.getRandomId(),this.url?(this.target=n.getOrigin(this.url),e.create(function(e,n){function t(t){t={currentTarget:t.currentTarget||t.srcElement};e(t)}try{this.frame=window.document.createElement("iframe"),this.frame.setAttribute("id",this.id),this.frame.setAttribute("name",this.id),this.frame.style.display="none",this.frame.src=this.url,this.frame.attachEvent?this.frame.attachEvent("onload",t):this.frame.onload=t,window.document.body.appendChild(this.frame)}catch(t){n(t)}}.bind(this))):e.reject("No url provided")},t}),define("thirdparty-wrappers/frameloader.js",function(){}),define("tokenmanager",["oidc.client","frameloader","DefaultHttpRequest","asos.identity.helper","asos.identity.storage","asos.identity.sdk.tokenExchanger","DefaultPromiseFactory"],function(r,t,o,a,s,e,i){"use strict";function n(t){if(t){if(this.profile=t.profile,this.id_token=t.id_token,t.access_token instanceof Object?this.access_token=null:(this.access_token=t.access_token,t.access_token&&(this.access_token_expires_at=t.access_token_expires_at),this.scopes=(t.scope||"").split(" ")),!t.id_token)throw Error("Either access_token or id_token required.");this.expires_at=t.profile.exp,this.session_state=t.session_state,t.marked_as_expired?this.marked_as_expired=t.marked_as_expired:this.marked_as_expired=!1}else this.expires_at=0;this.timeLeftToExpire=function(t){return t-parseInt((new Date).getTime()/1e3)},this.accessTokenExpired=function(){return this.timeLeftToExpire(this.access_token_expires_at)<0},this.accessTokenExpiresIn=function(){return this.timeLeftToExpire(this.access_token_expires_at)},this.expired=function(){return this.timeLeftToExpire(this.expires_at)<0||this.marked_as_expired},this.expiresIn=function(){return this.timeLeftToExpire(this.expires_at)}}function u(e){function n(){r=null,a.log("token expiring"),e._callTokenExpiring()}function i(){r&&(window.clearTimeout(r),r=null)}function t(){var t;i(),e.expired(e.getToken())||(60<(t=e.expiresIn())?(t=t-60,r=window.setTimeout(n,1e3*t)):n())}var r=null;t(),e.addOnTokenObtained(t),e.addOnTokenRemoved(i)}function h(e){function n(){r=null,e._callTokenExpired(e.getToken())}function i(){r&&(window.clearTimeout(r),r=null)}function t(){var t;i(),0<e.expiresIn()&&(t=e.expiresIn()+1,r=window.setTimeout(n,1e3*t))}var r=null;t(),e.addOnTokenObtained(t),e.addOnTokenRemoved(i)}function c(t){this._settings=a.extend({},t,{persist:!0,persistKey:"Asos.TokenManager.token",current_user_state:a.rand(),access_token_lock_key:"Asos.TokenManager.access_token_lock"}),this.oidcClient=new r(this._settings),this._callbacks={tokenRemovedCallbacks:[],tokenExpiringCallbacks:[],tokenExpiredCallbacks:[],tokenObtainedCallbacks:[],silentTokenRenewFailedCallbacks:[]},this.dropToken=function(){s.local.removeItem(this._settings.persistKey)},this.profile=function(){if(this.getToken())return this.getToken().profile},this.idToken=function(){if(this.getToken())return this.getToken().id_token},this.expired=function(t){return!t||t.expired()},this.expiresIn=function(){return this.getToken()?this.getToken().expiresIn():0},this.accessTokenExpiresIn=function(){return this.getToken()?this.getToken().accessTokenExpiresIn():0},this.expiresAt=function(){return this.getToken()?this.getToken().expires_at:0},this.scopes=function(){return this.getToken()?[].concat(this.getToken().scopes):[]},this.sessionState=function(){if(this.getToken())return this.getToken().session_state};var e,n,i=this;(n=i)._token=null,n._settings.persist&&((t=n.getTokenFromStorage())?n._token=t:n.dropToken()),h(i),(e=i)._settings.silent_renew&&e.addOnTokenExpiring(function(){e.renewTokenSilentAsync().catch(function(t){e._callSilentTokenRenewFailed(),a.log(t.message||t)})}),window.setTimeout(function(){u(i)},0)}return n.fromResponse=function(t){var e;return t.access_token&&(e=parseInt((new Date).getTime()/1e3),t.access_token_expires_at=e+parseInt(t.expires_in)),new n(t)},n.prototype.isAnonymous=function(){return!!this.profile.amr&&0<=this.profile.amr.indexOf("anon")},n.fromJSON=function(t){if(t)try{return new n(JSON.parse(t))}catch(t){}return new n(null)},n.prototype.toJSON=function(){return JSON.stringify({profile:this.profile,id_token:this.id_token,access_token:this.access_token,expires_at:this.expires_at,scope:this.scopes.join(" "),session_state:this.session_state,access_token_expires_at:this.access_token_expires_at,marked_as_expired:this.marked_as_expired})},c.prototype.getToken=function(){return this._settings.persist?this.getTokenFromStorage():this._token},c.prototype.setToken=function(t){this.setAccessTokenPending(!1),t||s.local.removeItem(this._settings.persistKey),this._settings.persist&&t&&(s.local.setItem(this._settings.persistKey,t.toJSON()),a.log("Saving token to local storage.")),this._token=t},c.prototype.isAccessTokenFresh=function(){return this.accessTokenExpiresIn()>=this._settings.access_token_renew_threshold_in_seconds},c.prototype.setAccessTokenPending=function(t){t?s.local.setItem(this._settings.access_token_lock_key,"true"):s.local.removeItem(this._settings.access_token_lock_key)},c.prototype.isAccessTokenPending=function(){return"true"===s.local.getItem(this._settings.access_token_lock_key)},c.prototype.waitForPendingTokenRequest=function(){var n=this;return i.create(function(t,e){a.waitCondition(50,2e3,function(){return n.isAccessTokenFresh()},function(){n.setAccessTokenPending(!1),t(n.getToken().access_token)},function(){n.setAccessTokenPending(!1),e({statusCode:500,statusMessage:"Timed out waiting for access token"})})})},c.prototype.getFreshAccessTokenAsync=function(){return i.create(function(e,n){if(this.getToken())if(this.isAccessTokenFresh())e(this.getToken().access_token);else{if(!this.isAccessTokenPending())return this.expired(this.getToken())?this.renewAccessTokenViaTokenExchange().then(function(t){e(t)},function(t){n({statusCode:t.status,statusMessage:t.responseText})}):this.renewTokenSilentAsync(!1).then(function(t){e(t.access_token)},function(t){n(t)});this.waitForPendingTokenRequest().then(e,n)}else e(void 0)}.bind(this))},c.prototype.getNewAccessTokenForBrowserSessionAsync=function(){return i.create(function(e,t){if(this.getToken()&&this.accessTokenExpiresIn()>=this._settings.access_token_renew_threshold_in_seconds)return this.expired(this.getToken())?this.renewAccessTokenViaTokenExchange().then(function(t){e(t)},t):this.renewTokenSilentAsync(!1).then(function(t){e(t.access_token)},t);e()}.bind(this))},c.prototype.ready=function(){return this.oidcClient.loadMetadataAsync().then(function(){return this.oidcClient.loadX509SigningKeyAsync()}.bind(this))},c.prototype.getTokenFromStorage=function(){var t=s.local.getItem(this._settings.persistKey);return t?n.fromJSON(t):null},c.setHttpRequest=function(t){if("object"!=typeof t||"function"!=typeof t.getJSON)throw Error("The provided value is not a valid http request.");_httpRequest=t},c.prototype._callTokenRemoved=function(e){this._callbacks.tokenRemovedCallbacks.forEach(function(t){t(e)})},c.prototype._callTokenExpiring=function(e){this._callbacks.tokenExpiringCallbacks.forEach(function(t){t(e)})},c.prototype._callTokenExpired=function(e){this._callbacks.tokenExpiredCallbacks.forEach(function(t){t(e)})},c.prototype._callTokenObtained=function(e){this._callbacks.tokenObtainedCallbacks.forEach(function(t){t(e)})},c.prototype._callSilentTokenRenewFailed=function(){this._callbacks.silentTokenRenewFailedCallbacks.forEach(function(t){t()})},c.prototype.transformToken=function(t){return!t||t instanceof n?t:n.fromResponse(t)},c.prototype.updateAccessToken=function(t){var e;this.getToken()&&(a.log("Saving renewed access token to local storage."),(e=this.getToken()).access_token=t.access_token,e.access_token_expires_at=parseInt(new Date(t.expires).getTime()/1e3),this.setToken(e))},c.prototype.renewAccessTokenViaTokenExchange=function(){return this.setAccessTokenPending(!0),a.log("Renewing access token via token exchange."),e.renewAccessToken(this.idToken()).then(function(t){return this.updateAccessToken(t),t.access_token}.bind(this))},c.prototype.saveToken=function(t,e){e=void 0===e||e,t=this.transformToken(t);var n=this.getToken();this.expired(t)?(a.log("this._settings.persist="+this._settings.persist+"--this.expired()="+this.expired(t)),this.dropToken()):this.setToken(t),e&&(t?this._callTokenObtained(t):this._callTokenRemoved(n))},c.prototype.addOnTokenRemoved=function(t){this._callbacks.tokenRemovedCallbacks.push(t)},c.prototype.addOnTokenObtained=function(t){this._callbacks.tokenObtainedCallbacks.push(t)},c.prototype.addOnTokenExpiring=function(t){this._callbacks.tokenExpiringCallbacks.push(t)},c.prototype.addOnTokenExpired=function(t){this._callbacks.tokenExpiredCallbacks.push(t)},c.prototype.addOnSilentTokenRenewFailed=function(t){this._callbacks.silentTokenRenewFailedCallbacks.push(t)},c.prototype.removeToken=function(){this.saveToken(null)},c.prototype.generateTokenRequestUrl=function(t){return this.oidcClient.createTokenRequestAsync(t).then(function(t){return t.url},function(t){a.error("TokenManager.redirectForToken error: "+(t&&t.message||t||""))})},c.prototype.redirectForToken=function(t){return this.generateTokenRequestUrl(t).then(function(t){window.location=t},function(t){a.error("TokenManager.redirectForToken error: "+(t&&t.message||t||""))})},c.prototype.redirectForLogout=function(){var e=this;e.oidcClient.createLogoutRequestAsync(e.idToken()).then(function(t){e.removeToken(),window.location=t},function(t){a.error("TokenManager.redirectForLogout error: "+(t&&t.message||t||""))})},c.prototype.processTokenCallbackAsync=function(t){a.log("TokenManager.prototype.processTokenCallbackAsync");var e=this;return e.oidcClient.parseOidcResult(t).then(function(t){return e.oidcClient.processResponseAsync(t).then(function(t){e.saveToken(t)})})},c.prototype.renewTokenSilentAsync=function(r){this.setAccessTokenPending(!0),r=void 0===r||r;var s=this;return a.log("Renewing token."),i.create(function(n,i){s.oidcClient.createTokenRequestAsync().then(function(t){var e={withCredentials:!0};s._settings.defaultQuery&&(e.query=s._settings.defaultQuery),a.log("Get json from: "+t.url),o.getJSON(t.url,e).then(function(t){s.oidcClient.processResponseAsync(t).then(function(t){s.saveToken(t,r),n(t)},i)},i)},i)})},c.prototype.processTokenCallbackSilent=function(t){window.top&&window!==window.top&&(t=t||window.location.hash)&&window.top.postMessage(t,location.protocol+"//"+location.host)},c.prototype.markTokenAsExpired=function(){a.log("Marking token as expired");var t=this.getToken();t.marked_as_expired=!0,this.setToken(t)},c}),define("thirdparty-wrappers/tokenmanager.js",function(){}),define("cryptoLibs",[],function(){return{KJUR:window.KJUR,hextob64u:window.hextob64u,Promise:window.Promise}}),define("thirdparty-wrappers/cryptoLibs.js",function(){}),define("oidc.client",["asos.identity.helper","DefaultHttpRequest","DefaultPromiseFactory","asos.identity.storage","cryptoLibs"],function(o,i,a,u,h){function c(){var t=[].join.call(arguments);o.log(t)}function t(t){if(!t)throw"settings is not provided";this._settings=o.extend({},t,{post_logout_redirect_uri:window.location.href,redirect_uri:window.location.href}),this.isOidc=function(){return!!this._settings.response_type&&!!this._settings.response_type.split(/\s+/g).filter(function(t){return"id_token"===t})[0]},this.isOAuth=function(){return!!this._settings.response_type&&!!this._settings.response_type.split(/\s+/g).filter(function(t){return"token"===t})[0]}}return t.prototype.parseOidcResult=function(t){var e=(t=t||location.hash).lastIndexOf("#");0<=e&&(t=t.substr(e+1));for(var n,i,r={},s=/([^&=]+)=([^&]*)/g,o=0;n=s.exec(t);)if(r[decodeURIComponent(n[1])]=decodeURIComponent(n[2]),50<o++)return{error:"Response exceeded expected number of parameters"};for(i in r)return a.resolve(r)},t.prototype.error=function(t){return a.reject(new Error(t))},t.prototype.getJson=function(t,e){var n={};return this._settings.defaultQuery&&(n.query=this._settings.defaultQuery),e&&(n.headers={Authorization:"Bearer "+e}),i.getJSON(t,n)},t.prototype.loadMetadataAsync=function(){var e=this._settings;return e.metadata=JSON.parse(u.session.getItem(e.well_known_configuration)),e.metadata?a.resolve(e.metadata):e.well_known_configuration?this.getJson(e.well_known_configuration).then(function(t){return o.log("loaded"),e.metadata=t,u.session.setItem(e.well_known_configuration,JSON.stringify(t)),t},function(t){return this.error("Failed to load metadata ("+t.message+")")}.bind(this)):this.error("No authority configured")},t.prototype.loadX509SigningKeyAsync=function(){function n(t){if(!t.keys||!t.keys.length)return this.error("Signing keys empty");t=t.keys[0];return"RSA"!==t.kty?this.error("Signing key not RSA"):t.x5c&&t.x5c.length?a.resolve(t.x5c[0]):this.error("RSA keys empty")}var i=this._settings;return i.jwks?n(i.jwks):this.loadMetadataAsync().then(function(e){return e.jwks_uri?(i.jwks=JSON.parse(u.session.getItem(e.jwks_uri)),i.jwks?a.resolve(n(i.jwks)):this.getJson(e.jwks_uri).then(function(t){return i.jwks=t,u.session.setItem(e.jwks_uri,JSON.stringify(t)),n(t)},function(t){return this.error("Failed to load signing keys ("+t.message+")")}.bind(this))):this.error("Metadata does not contain jwks_uri")}.bind(this))},t.prototype.loadUserProfile=function(e){return this.loadMetadataAsync().then(function(t){return t.userinfo_endpoint?this.getJson(t.userinfo_endpoint,e):a.reject(new Error("Metadata does not contain userinfo_endpoint"))}.bind(this))},t.prototype.loadAuthorizationEndpoint=function(){return c("OidcClient.loadAuthorizationEndpoint"),this._settings.authorization_endpoint?a.resolve(this._settings.authorization_endpoint):this._settings.well_known_configuration?this.loadMetadataAsync().then(function(t){return t.authorization_endpoint||this.error("Metadata does not contain authorization_endpoint")}.bind(this)):this.error("No authorization_endpoint configured")},t.prototype.createTokenRequestAsync=function(t){c("OidcClient.createTokenRequestAsync");var r=this,s=o.extend({},r._settings,t);return r.loadAuthorizationEndpoint().then(function(t){var e,n=o.rand(),i=t+"?state="+encodeURIComponent(n);r.isOidc()&&(e=o.rand(),i+="&nonce="+encodeURIComponent(e));["client_id","redirect_uri","response_type","scope"].forEach(function(t){var e=s[t];e&&(i+="&"+t+"="+encodeURIComponent(e))});["prompt","display","max_age","ui_locales","id_token_hint","login_hint","acr_values","response_mode"].forEach(function(t){var e=s[t];e&&(i+="&"+t+"="+encodeURIComponent(e))}),s.defaultQuery&&s.defaultQuery.forEach(function(t){i=o.queryString.setValue(i,t.name,t.value)});n={oidc:r.isOidc(),oauth:r.isOAuth(),state:n};return e&&(n.nonce=e),u.local.setItem(s.request_state_key,JSON.stringify(n)),{request_state:n,url:i}})},t.prototype.createLogoutRequestAsync=function(e){c("OidcClient.createLogoutRequestAsync");var n=this._settings;return this.loadMetadataAsync().then(function(t){if(!t.end_session_endpoint)return this.error("No end_session_endpoint in metadata");t=t.end_session_endpoint;return e&&n.post_logout_redirect_uri&&(t+="?post_logout_redirect_uri="+encodeURIComponent(n.post_logout_redirect_uri),t+="&id_token_hint="+encodeURIComponent(e),t+="&ui_locales="+n.ui_locales),t}.bind(this))},t.prototype.validateIdTokenAsync=function(i,r,t){var s=this._settings;return this.loadX509SigningKeyAsync().then(function(t){var e=new h.KJUR.jws.JWS;if(e.verifyJWSByPemX509Cert(i,t)){var n=JSON.parse(e.parsedJWS.payloadS);return r!==n.nonce?this.error("Invalid nonce"):this.loadMetadataAsync().then(function(t){if(n.iss!==t.issuer)return this.error("Invalid issuer");if(n.aud!==s.client_id)return this.error("Invalid audience");t=parseInt(Date.now()/1e3);return 300<t-n.iat?this.error("Token issued too long ago"):n.exp<t?this.error("Token expired"):n}.bind(this))}return this.error("JWT failed to validate")}.bind(this))},t.prototype.validateAccessTokenAsync=function(t,e){if(c("OidcClient.validateAccessTokenAsync"),!t.at_hash)return this.error("No at_hash in id_token");e=h.KJUR.crypto.Util.sha256(e),e=e.substr(0,e.length/2);return h.hextob64u(e)!==t.at_hash?this.error("at_hash failed to validate"):a.resolve()},t.prototype.validateIdTokenAndAccessTokenAsync=function(t,e,n){c("OidcClient.validateIdTokenAndAccessTokenAsync");var i=this;return i.validateIdTokenAsync(t,e,n).then(function(t){return i.validateAccessTokenAsync(t,n).then(function(){return t})})},t.prototype.processResponseAsync=function(t){c("OidcClient.processResponseAsync");var n=this._settings,e=u.local.getItem(n.request_state_key);if(u.local.removeItem(n.request_state_key),!e)return this.error("No request state loaded");if(!(e=JSON.parse(e)))return this.error("No request state loaded");if(!e.state)return this.error("No state loaded");if(!t)return this.error("No OIDC response");if(t.error)return this.error(t.error);if(t.state!==e.state)return this.error("Invalid state");if(e.oidc){if(!t.id_token)return this.error("No identity token");if(!e.nonce)return this.error("No nonce loaded")}if(e.oauth){if(!t.access_token)return this.error("No access token");if(!t.token_type||"bearer"!==t.token_type.toLowerCase())return this.error("Invalid token type");if(!t.expires_in)return this.error("No token expiration")}var i=a.resolve();return e.oidc&&e.oauth?i=this.validateIdTokenAndAccessTokenAsync(t.id_token,e.nonce,t.access_token):e.oidc&&(i=this.validateIdTokenAsync(t.id_token,e.nonce)),i.then(function(e){return e&&n.filter_protocol_claims&&["nonce","at_hash","iat","nbf","aud","iss"].forEach(function(t){delete e[t]}),{profile:e,id_token:t.id_token,access_token:t.access_token,expires_in:t.expires_in,scope:t.scope,session_state:t.session_state}})},t}),define("third-party-libs/oidc-client.js",function(){}),define("Asos.Identity.Web.ClientSdk.CheckSession",["DefaultPromiseFactory","asos.identity.helper","frameloader","asos.identity.sdk.config"],function(e,u,h,c){"use strict";return new function(){function i(t,e,n){var i,r,s,o,a,t=(a=t,{check_session_iframe:c.check_session_iframe,session_state:a.sessionState(),client_id:a._settings.client_id,locale:a._settings.ui_locales});if(t.check_session_iframe&&t.session_state){if(u.log("check_session_frame",t),(a=t).session_state?a.check_session_iframe?a.client_id||(console.error("No client_id passed to RP session frame"),0):(console.error("No check_session_iframe passed to RP session frame"),0):(console.error("No session_state passed to RP session frame"),0))return i=t,r=e,s=n,e=u.queryString.setValue(i.check_session_iframe,"ui_locales",i.locale),(o=new h).loadAsync(e).then(function(e){var n=window.setInterval(function(){var t=i.client_id+" "+i.session_state;return o.postMessage(e,t).then(function(t){"changed"!==t.data&&"error"!==t.data||(window.clearInterval(n),o.dispose()),r(t)},function(t){o.dispose(),s(t)})},2e3)});n()}}return{getCurrentState:function(t){return e.create(function(n,i){var r={check_login_iframe:t._settings.checkLoginIframeUrl,session_state:t.sessionState(),client_id:t._settings.client_id},s=new h({url:r.check_login_iframe});return s.loadAsync().then(function(t){var e=JSON.stringify({client_id:r.client_id,session_state:r.session_state});return s.postMessage(t,e).then(function(t){s.dispose(),t&&t.data&&n(JSON.parse(t.data))},function(t){s.dispose(),i(t)})})})},checkSessionState:function(n){return e.create(function(t,e){return n.oidcClient.loadMetadataAsync().then(function(){return i(n,t,e)},e)})}}}}),define("widget/sdk/asos.identity.sdk.checksession.js",function(){}),define("asos.identity.sdk.initializer",["DefaultPromiseFactory","asos.identity.storage","asos.identity.helper","Asos.Identity.Web.ClientSdk.OidcWrapper","asos.identity.sdk.config","asos.identity.events","asos.identity.task"],function(o,t,e,a,u,n,h){"use strict";return new function(){function t(){return u.hash=e(window.location.hash),u.hash&&(window.location.hash=window.location.hash.replace(u.hash.substring(1),"")),o.create(function(t,e){return n().then(function(){t(r)},e)})}function e(t){var e=t.indexOf("id_token=");if(0<=e)return"#"+t.substring(e)}function n(){return r.init(u)}var i=new h,r=new a(u),s=null;return{ready:function(){return s?o.resolve(s):i.run(t).then(function(t){return s=t})},getIdentityHash:e,initialiseComponent:n}}}),define("widget/sdk/asos.identity.sdk.initializer.js",function(){}),define("asos.identity.sdk.config",["asos.identity.helper"],function(n){"use strict";var i={initialised:!1,defaultQuery:[],persistKey:"Asos.TokenManager.token",buildNumber:"1551704232152",setConfig:function(t){var e;this.initialised=!0,this.client_id=t.clientId,this.auth_host=t.authenticationHost,this.identity_origin=t.identityOrigin,this.silent_renew=t.silentRenew||!1,this.ui_locales=t&&t.lang?t.lang:"en-gb",this.well_known_configuration=t.authenticationHost,this.scope=t.scope||"openid sensitive profile",this.types=t.types||"id_token token",this.response_mode=t.responseMode||"json",this.checkLoginIframeUrl=t.checkLoginUrl,this.gatewayURL=t.gatewayUrl,this.customerApiUrl=t.customerApiUrl,this.check_session_iframe=t.checkSessionUrl,this.access_token_renew_threshold_in_seconds=t.access_token_renew_threshold_in_seconds||120,this.store=t.store,this.country=t.countryCode,this.keyStoreDataversion=t.keyStoreDataversion,i.check_session_iframe=i.check_session_iframe||i.auth_host+"/resource/checksession",i.checkLoginIframeUrl=i.checkLoginIframeUrl||i.auth_host+"/resource/checklogin?path=1",i.gatewayURL=i.gatewayURL||i.auth_host+"/resource/gateway",i.check_session_iframe=n.queryString.setValue(i.check_session_iframe,"n",i.buildNumber),i.checkLoginIframeUrl=n.queryString.setValue(i.checkLoginIframeUrl,"n",i.buildNumber),i.gatewayURL=n.queryString.setValue(i.gatewayURL,"n",i.buildNumber),i.defaultTokenExchangeEndpoint=i.auth_host+"/oauth/v2/token/exchange",t.post_logout_redirect_uri&&(this.post_logout_redirect_uri=t.post_logout_redirect_uri),t.redirect_uri&&(this.redirect_uri=t.redirect_uri),i.identity_origin&&(e={name:"x-identity-origin",value:i.identity_origin},i.check_session_iframe=n.queryString.setValue(i.check_session_iframe,e.name,e.value),i.checkLoginIframeUrl=n.queryString.setValue(i.checkLoginIframeUrl,e.name,e.value),i.gatewayURL=n.queryString.setValue(i.gatewayURL,e.name,e.value),i.defaultQuery.push(e)),i.store&&i.defaultQuery.push({name:"store",value:i.store}),i.country&&i.defaultQuery.push({name:"country",value:i.country}),i.keyStoreDataversion&&i.defaultQuery.push({name:"keyStoreDataversion",value:i.keyStoreDataversion}),i.defaultQuery.push({name:"lang",value:i.ui_locales}),i.request_state_key||(i.request_state_key="OidcClient.request_state"),void 0===i.load_user_profile&&(i.load_user_profile=!0),void 0===i.filter_protocol_claims&&(i.filter_protocol_claims=!0),i.well_known_configuration&&("/"!==i.well_known_configuration[i.auth_host.length-1]&&(i.well_known_configuration+="/"),i.well_known_configuration+=".well-known/openid-configuration"),i.response_type||(i.response_type="id_token token"),i.registrationUrl=(e=(t=i).auth_host+"/register",e=n.queryString.setValue(e,"store",t.store),e=n.queryString.setValue(e,"country",t.country),e=n.queryString.setValue(e,"lang",t.ui_locales),e=n.queryString.setValue(e,"keyStoreDataversion",t.keyStoreDataversion),n.queryString.setValue(e,"redirect_uri",t.redirect_uri))}};return i}),define("widget/sdk/asos.identity.sdk.config.js",function(){}),define("Asos.Identity.Web.ClientSdk.Customer",["asos.identity.helper","DefaultPromiseFactory","asos.identity.sdk.initializer","asos.identity.sdk.customerprofile"],function(t,s,n,i){"use strict";return function(){function r(){return n.ready().then(function(t){var e=t.customer();return e||t.loadAnonToken().then(function(){return t.customer()})})}function t(n){return s.create(function(e,t){return r().then(function(t){e(n(t))},t)})}function e(i){return s.create(function(e,n){return r().then(function(t){t&&t.customerId?i(t.customerId).then(function(t){e(t)},n):e(void 0)},n)})}return{profile:r,isRecognised:function(){return t(function(t){return!!t&&t.isRecognised})},firstName:function(){return t(function(t){return t?t.firstName:void 0})},lastName:function(){return t(function(t){return t?t.lastName:void 0})},customerGuid:function(){return s.create(function(e,t){return r().then(function(t){e(t.customerGuid)},t)})},customerId:function(){return t(function(t){return t?t.customerId:void 0})},firstTimeBuyer:function(){return t(function(t){return t?t.firstTimeBuyer:void 0})},homeSite:function(){return t(function(t){return t?t.homeSite:void 0})},subscriptions:function(){return t(function(t){return t&&t.subscriptions?[t.subscriptions]:[]})},subscriptionDetails:function(){return e(i.getSubscription)},isReconsentRequired:function(){return e(i.getIsReconsentRequired)},preferences:function(){return e(i.getPreferences)},rewards:function(){return e(i.getRewards)},isAuthenticated:function(){return t(function(t){return!!t&&t.isAuthenticated})},resetLocalCopy:function(){i.deCache()}}}}),define("widget/sdk/AsosIdentityCustomer.js",function(){}),define("asos.identity.web.clientsdk",["DefaultPromiseFactory","asos.identity.helper","asos.identity.events","Asos.Identity.Web.ClientSdk.Customer","asos.identity.sdk.supportedEventTypes","asos.identity.sdk.initializer","asos.identity.sdk.config","asos.identity.sdk.storagecleardown","asos.identity.sdk.constants.deprecatedKeys"],function(t,n,i,e,r,s,o,a,u){"use strict";if(!o.initialised)throw{message:"asos.identity.sdk.config has not been initialised. Please call require('asos.identity.web.clientsdk/dist/asos.identity.sdk.config').setConfig(....)"};function h(){this.preInitialiseSteps(),this.customer=new e,this.events={onLoggedIn:function(e){i.subscribe(r.onLoggedIn,e);try{s.ready().then(function(t){t=t.customer();t&&t.isAuthenticated&&e(t)}.bind(this))}catch(t){n.error(t)}return this}.bind(this),onRegistered:function(t){return i.subscribe(r.onRegistered,t),this}.bind(this),onSessionEnded:function(t){return i.subscribe(r.onSessionEnded,t),this}.bind(this),onAnonymous:function(t){return i.subscribe(r.onAnonymous,t),this}.bind(this),onSessionExpired:function(t){return i.subscribe(r.onSessionExpired,t),this}.bind(this)}}return h.prototype.preInitialiseSteps=function(){a.clearDownStorageKeys(n.getStorage(),u.tokenmanagerKeys)},h.prototype.getAccessToken=function(){return t.create(function(n,i){s.ready().then(function(e){e.getFreshAccessTokenAsync().then(function(t){t?n(t):e.loadAnonToken().then(function(t){n(t.access_token)}.bind(this),function(t){i(t)}.bind(this))}.bind(this),function(t){401===t.statusCode&&this.login(),i("Failed to get access token. "+(t.statusMessage||t))}.bind(this))}.bind(this),function(t){i(t)})}.bind(this))},h.prototype.ready=function(){return s.ready()},h.prototype.login=function(){s.ready().then(function(t){try{var e=n.extend({},o,{response_mode:"fragment"});t.authorize(e)}catch(t){n.error(t)}})},h.prototype.logout=function(){s.ready().then(function(t){t.logout()})},new h}),define("widget/sdk/asos.identity.sdk.main.js",function(){}),define("asos.identity.sdk.supportedEventTypes",[],function(){"use strict";return{onLoggedIn:"asos.identity.sdk.loggedin",onSessionEnded:"asos.identity.sdk.sessionend",onAnonymous:"asos.identity.sdk.anontoken",onSessionExpired:"asos.identity.sdk.expired",onRegistered:"asos.identity.sdk.registered"}}),define("widget/sdk/asos.identity.sdk.supportedEventTypes.js",function(){}),define("asos.identity.sdk.asosCookieHandler",["asos.identity.helper","asos.identity.events","asos.identity.sdk.supportedEventTypes"],function(r,t,e){"use strict";function n(){t.subscribe(e.onAnonymous,function(t){this.readCustomerGuid()||this.setCustomerGuid(t.customerGuid||t.customerId)}.bind(this)),t.subscribe(e.onLoggedIn,function(t){this.setCustomerGuid(t.customerGuid),this.setCustomerId(t.customerId)}.bind(this)),t.subscribe(e.onSessionEnded,function(){this.remove(this.constants.customerGuidName),this.setCustomerId("-1")}.bind(this)),t.subscribe(e.onSessionExpired,function(){this.remove(this.constants.customerGuidName),this.setCustomerId("-1")}.bind(this))}return n.prototype.constants={asosCookieName:"asos",customerGuidName:"customerguid",customerIdName:"customerid"},n.prototype.readCustomerGuid=function(){var t=this.getAsosCookie();if(t){t=t.filter(function(t){return t&&t.name&&t.value&&t.name.toLowerCase()===this.constants.customerGuidName}.bind(this));if(t&&0<t.length&&t[0].value)return t[0].value}},n.prototype.getAsosCookie=function(t){var e=r.cookies.getAll().filter(function(t){return t.name.toLowerCase()===this.constants.asosCookieName}.bind(this));return e[0]&&e[0].value?e[0].value.split("&").map(function(t){var e=t.indexOf("=");if(0<e)return{name:t.substring(0,e).trim(),value:t.slice(e+1).trim()}}):void 0},n.prototype.remove=function(e){var t=(this.getAsosCookie()||[]).filter(function(t){return t.name.toLowerCase()!==e}.bind(this)).map(function(t){return t.name.toLowerCase()===e?(count++,t.name+"="+value):t.name+"="+t.value});r.cookies.create(this.constants.asosCookieName,t.join("&"),365)},n.prototype.update=function(e,n){var t=(this.getAsosCookie()||[]).concat({name:e,value:n}),i=0,t=t.map(function(t){return t.name.toLowerCase()===e?(i++,t.name+"="+n):t.name+"="+t.value});1<i&&t.splice(-1,1),r.cookies.create(this.constants.asosCookieName,t.join("&"),365)},n.prototype.setCustomerGuid=function(t){this.update(this.constants.customerGuidName,t)},n.prototype.setCustomerId=function(t){this.update(this.constants.customerIdName,t)},new n}),define("widget/sdk/asos.identity.sdk.asosCookieHandler.js",function(){}),define("asos.identity.sdk.perxCookieHandler",["asos.identity.helper","asos.identity.events","asos.identity.sdk.supportedEventTypes"],function(e,t,n){"use strict";return s={perxCookieName:"asos-perx"},t.subscribe(n.onAnonymous,i),t.subscribe(n.onLoggedIn,function(t){r([t.customerGuid,t.customerAid,t.sessionId])}),t.subscribe(n.onSessionEnded,i),{getCookie:function(){var t=e.cookies.getAll().filter(function(t){return t.name.toLowerCase()===s.perxCookieName}.bind(this));return t[0]&&t[0].value?t[0].value:null}};function i(t){r([t.customerGuid,"",t.sessionId])}function r(t){e.cookies.create(s.perxCookieName,t.join("|"),365)}var s}),define("widget/sdk/asos.identity.sdk.perxCookieHandler.js",function(){}),define("asos.identity.sdk.customerparser",["asos.identity.helper"],function(i){"use strict";function t(){}return t.prototype.lastActionEnum={signUpSocial:1,signUpEmail:2,linkAccounts:3,signInSocial:6,signInEmail:7},t.prototype.getCustomer=function(t){if(t){var e,n={};n.isAnonymous=t.isAnonymous(),n.isRecognised=!n.isAnonymous&&t.expired(),n.isAuthenticated=!t.expired()&&!n.isAnonymous,n.customerId=n.isAnonymous?void 0:t.profile.sub,n.customerGuid=n.isAnonymous?t.profile.sub:t.profile.cgd,n.customerAid=t.profile.aid,n.subscriptions=t.profile.sbs,n.firstTimeBuyer=t.profile.ftb,n.homeSite=t.profile.hom,n.firstName=t.profile.given_name,n.lastName=t.profile.family_name,t.access_token&&(e=i.parseJwt(t.access_token),n.sessionId=e.sess);t=t.profile.la;return n.isNewUser=t===this.lastActionEnum.linkAccounts||t===this.lastActionEnum.signUpEmail||t===this.lastActionEnum.signUpSocial,n.lastAction={isSignUpSocial:t===this.lastActionEnum.signUpSocial,isSignUpEmail:t===this.lastActionEnum.signUpEmail,isLinkAccounts:t===this.lastActionEnum.linkAccounts,isSignInSocial:t===this.lastActionEnum.signInSocial,isSignInEmail:t===this.lastActionEnum.signInEmail},n}},new t}),define("widget/sdk/asos.identity.sdk.customerparser.js",function(){}),define("asos.identity.sdk.customerprofile",["DefaultPromiseFactory","asos.identity.storage","CustomerApiHttpRequest","asos.identity.events","asos.identity.sdk.supportedEventTypes","asos.identity.task"],function(t,e,h,n,i,r){"use strict";var s=new r,o="Asos.Identity.CustomerProfile",a=["subscriptions","rewards","isreconsentrequired","preferences"],c="CustomerInfo";return n.subscribe(i.onAnonymous,u),n.subscribe(i.onSessionEnded,u),{getSubscription:function(t){return p(t,a,[]).then(function(t){return t.subscriptions})},getRewards:function(t){return p(t,a,[]).then(function(t){return t.rewards})},getPreferences:function(t){return p(t,a,[]).then(function(t){return t.preferences})},getIsReconsentRequired:function(t){return p(t,a,[]).then(function(t){return t.isReconsentRequired})},deCache:function(){e.local.removeItem(o)}};function l(){var t=e.local.getItem(o);return t?JSON.parse(t):null}function f(t){t?(t=JSON.stringify(t),e.local.setItem(o,t)):e.local.removeItem(o)}function u(){e.local.removeItem(o)}function p(o,a,u){return s.run(function(){return t.create(function(s,e){var t,n,i,r=a instanceof Array?a:[a];o?(i=(t=c,n=l(),(i=null==n?null:n[t])&&i.expiry&&i.expiry<(new Date).getTime()?(n[t]=null,f(n),null):i?i.data:null))?s(i):h.getJSON("/customer/profile/v2/customers/"+o+"?fields="+r.join()).then(function(t){var e,n,i,r=(new Date).setUTCHours(24,0,0,0);e=c,n=t,i=r,(r=(r=l())||{})[e]={data:n,expiry:i},f(r),s(t)},function(t){e(t)}):s(u)})})}}),define("widget/sdk/asos.identity.sdk.customerprofile.js",function(){}),define("asos.identity.sdk.tokenExchanger",["DefaultPromiseFactory","DefaultHttpRequest","asos.identity.sdk.config"],function(t,s,o){"use strict";function e(){}return e.prototype.renewAccessToken=function(r){return t.create(function(e,t){if(r){var n={Id_Token:r,grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",assertion_format:"JWT",client_id:o.client_id,scope:"sensitive"},i={};return i.query=o.defaultQuery||null,s.postJSON(o.defaultTokenExchangeEndpoint,n,i).then(function(t){e(t)},t)}t()})},new e}),define("widget/sdk/asos.identity.sdk.tokenExchanger.js",function(){}),define("asos.identity.sdk.storagecleardown",[],function(){function t(){}return t.prototype.clearDownStorageKeys=function(t,e){if(e&&t)for(var n=0;n<e.length;n++)t.removeItem(e[n])},new t}),define("widget/sdk/asos.identity.sdk.storagecleardown.js",function(){}),define("asos.identity.sdk.constants.deprecatedKeys",[],function(){return{tokenmanagerKeys:["TokenManager.token"]}}),define("widget/sdk/constants/asos.identity.sdk.constants.deprecatedKeys.js",function(){}),define("Asos.Identity.Web.ClientSdk",["asos.identity.web.clientsdk"],function(t){return t}),define("widget/sdk/asos.identity.web.clientsdk.alias.js",function(){}),define("asos.identity.helper",["asos.identity.storage"],function(t){"use strict";var o=window.document;return{rand:function(){return((Date.now()+Math.random())*Math.random()).toString().replace(".","")},getRandomId:function(){return Math.random().toString(36).substring(7)},extend:function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]},error:function(){var e=Array.prototype.slice.call(arguments);try{console.error.apply(console,e)}catch(t){console.error(e)}},getOrigin:function(t){var e=t.indexOf("/",t.indexOf("//")+2);return t.substr(0,e)},getStorage:function(){return t.local},log:function(){if(t.local.getItem("sdk.log.enable")){var e=Array.prototype.slice.call(arguments);try{console.log.apply(console,e)}catch(t){console.log(e)}}else window.sdkLoggingHint||(window.sdkLoggingHint=!0)},cookies:{getAll:function(){return o.cookie.split(";").map(function(t){var e=t.trim().split("=");if(2<=e.length){e=e[0].trim();return{name:e,value:t.trim().slice(e.length+1)}}}).filter(function(t){return t&&t.name&&t.value})},create:function(t,e,n,i){var r,s="";n&&((r=new Date).setTime(r.getTime()+24*n*60*60*1e3),s="; expires="+r.toGMTString()),o.cookie=t+"="+e+s+"; path="+(i||"/")}},queryString:{getValue:function(t){return function(){for(var t,e=location.search.slice(1).split("&"),n={},i=e.length-1;0<=i;i--)n[(t=e[i].split("="))[0]]?Array.isArray(n[t[0]])?n[t[0]].push(t[1]||""):n[t[0]]=[n[t[0]],t[1]||""]:n[t[0]]=t[1]||"";return n}()[t]},setValue:function(t,e,n){n=encodeURIComponent(n);var i=new RegExp("([?&])"+e+"=.*?(&|$)","i"),r=-1!==t.indexOf("?")?"&":"?";return t.match(i)?t.replace(i,"$1"+e+"="+n+"$2"):t+r+e+"="+n}},stringFormat:function(t){var n=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,e){return void 0!==n[e]?n[e]:t})},waitCondition:function(t,e,n,i,r){var s=0,o=e/t,a=setInterval(function(){s++,n()&&(clearInterval(a),i()),o<=s&&(clearInterval(a),r())},100)},parseJwt:function(t){t=t.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(window.atob(t))}}}),define("../Javascript/asos.identity.helper.js",function(){}),define("asos.identity.events",[],function(){"use strict";function t(){this.topics={}}return t.prototype.subscribe=function(t,e){(t="string"==typeof t?[t]:t).forEach(function(t){this.topics[t]||(this.topics[t]=[]),this.topics[t].push(e)}.bind(this))},t.prototype.publish=function(t){var n;!this.topics[t]||this.topics[t].length<1||(n=Array.prototype.slice.call(arguments,1),this.topics[t].forEach(function(e){try{e.apply(null,n)}catch(t){console.error("Failed to invoke callback:",e,"the error is:",t)}}))},new t}),define("../Javascript/asos.identity.events.js",function(){}),define("asos.identity.storage",[],function(){"use strict";var t=new function(){this.storagePolyfill=new function(){window.asosStorage=window.asosStorage||{},this.getItem=function(t){return null!=window.asosStorage[t]?window.asosStorage[t]:null},this.removeItem=function(t){window.asosStorage[t]=void 0},this.setItem=function(t,e){window.asosStorage[t]=e}},this.checkBrowserCompatibility=function(t){if(t){try{t.setItem("fd","true")}catch(t){}if("true"===t.getItem("fd"))return t.removeItem("fd"),!0}return!1},this.setStorageTypes=function(t,e){this.checkBrowserCompatibility(t)?this.local=t:this.local=this.storagePolyfill,this.checkBrowserCompatibility(e)?this.session=e:this.session=this.storagePolyfill}};return t.setStorageTypes(window.localStorage,window.sessionStorage),t}),define("../Javascript/asos.identity.storage.js",function(){}),define("asos.identity.task",["DefaultPromiseFactory","asos.identity.events","asos.identity.helper"],function(u,h,t){"use strict";return function(){function r(){o=!1}var s,o=!1,a="asos.identity.task.onCompleted"+t.getRandomId();return{result:s,reset:r,run:function(n){return u.create(function(t,e){return o?void h.subscribe(a,t):function(t,e,n){function i(t){r(),n(t)}o=!0;try{return u.resolve(t()).then(function(t){s=t,o=!1,h.publish(a,t),e(t)},i)}catch(t){i(t)}}(n,t,e)})}}}}),define("../Javascript/asos.identity.task.js",function(){});
