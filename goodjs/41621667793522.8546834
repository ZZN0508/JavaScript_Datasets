YUI.add("flickr-people-getGroupsWithStatus-fetcher",function(d,s){"use strict";d.namespace("ListFetchers")["flickr-people-getGroupsWithStatus"]={run:function(t,e){var r=this,o={extras:d.APIHelper.request.getRebootGroupExtras()+", icon_urls, date_activity, date_last_viewed",user_id:t.id,status:t.status};return t.id!==e.getViewer().nsid&&(o.public_only=1,o.status="2,3,4"),d.Promise.all([e.callAPI("flickr.people.getGroupsWithStatus",o,!0),e.getModelRegistry("person-groups-models"),e.getModelRegistry("group-models"),e.getModelRegistry("group-activity-models")]).then(function(e){return r._processResponse(e,t)},d.FetcherErrorLogger(s))},_processResponse:function(e,n){var a,t=e[0],r=e[1],l=e[2],p=e[3],o=t.groups,s=n.id,e={},u=[];if(o)return d.Array.each(o,function(e,t){var r,o,s,i=l.parseGroupModel(n.id,n.pathAlias,e);e.id&&(r=l.addOrUpdate(i),u.push(r),e.viewDates?(o="0"!==e.viewDates.pool?d.moment(e.viewDates.pool,"X"):p.getDefaultViewedDate(),(s="0"!==e.viewDates.discussions?d.moment(e.viewDates.discussions,"X"):p.getDefaultViewedDate()).isValid()||(s=p.getDefaultViewedDate()),o.isValid()||(o=p.getDefaultViewedDate())):(o=p.getDefaultViewedDate(),s=p.getDefaultViewedDate()),a={id:i.id,viewedPool:o,viewedDiscussions:s,group:r},p.addOrUpdate(a))}),(e={id:s,memberCount:t.members||null,moderatorCount:0,adminCount:0,invitedCount:0})[n.attribute]=u,r.exists(s)?r.setValue(s,n.attribute,e[n.attribute]):r.add(e),e[n.attribute]}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models"]}),YUI.add("person-groups-models",function(r){function t(e){t.superclass.constructor.call(this,e)}r.Models[this.name]=t,r.extend(t,r.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return r.ModelFetchers["flickr-people-getInfo"].run(e,this.appContext)},faveGroup:function(e,t){return r.ModelFetchers["flickr-groups-fave"].run(e,t)},unfaveGroup:function(e,t){return r.ModelFetchers["flickr-groups-unfave"].run(e,t)}},faveGroup:function(e){var t=this,r=e.group_id,o=e.user_id;return this.remote.faveGroup(e,this.appContext).then(null,function(){t.appContext.getModel("group-models",r).then(function(e){t.getValue(o,"groupsFaved").removeFromList(r)})}),this.appContext.getModel("group-models",r).then(function(e){t.getValue(o,"groupsFaved").appendToList(e)})},unfaveGroup:function(e){var t=e.group_id,r=e.user_id,o=this;return this.remote.unfaveGroup(e,this.appContext).then(null,function(){o.appContext.getModel("group-models",t).then(function(e){o.getValue(r,"groupsFaved").appendToList(e)})}),this.appContext.getModel("group-models",t).then(function(e){o.getValue(r,"groupsFaved").removeFromList(t)})},attributes:{id:{},memberCount:{validator:function(e){return r.AttributeHelpers.validateInteger(e)},setter:function(e){return r.AttributeHelpers.coerceInteger(e)}},moderatorCount:{validator:function(e){return r.AttributeHelpers.validateInteger(e)},setter:function(e){return r.AttributeHelpers.coerceInteger(e)}},adminCount:{validator:function(e){return r.AttributeHelpers.validateInteger(e)},setter:function(e){return r.AttributeHelpers.coerceInteger(e)}},invitedCount:{validator:function(e){return r.AttributeHelpers.validateInteger(e)},setter:function(e){return r.AttributeHelpers.coerceInteger(e)}},groups:{isListProxy:!0,pageFetch:{listFetcher:r.ListFetchers["flickr-groups-pools-getGroups"]}},groupsAdministered:{isListProxy:!0,pageFetch:{listFetcher:r.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsModerated:{isListProxy:!0,pageFetch:{listFetcher:r.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsBelongingTo:{isListProxy:!0,pageFetch:{listFetcher:r.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsFaved:{isListProxy:!0,pageFetch:{listFetcher:r.ListFetchers["flickr-people-getGroupsWithStatus"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getGroups-fetcher","flickr-people-getInfo-fetcher","flickr-groups-fave-fetcher","flickr-groups-unfave-fetcher","flickr-people-getGroupsWithStatus-fetcher"]}),YUI.add("flickr-photos-getContext-fetcher",function(c,o){"use strict";c.namespace("ListFetchers")["flickr-photos-getContext"]={run:function(t,e){var r=this;return c.Promise.all([e.callAPI("flickr.photos.getContext",this._processParams(t,e),!0),e.getModelRegistry("photostream-models"),e.getModelRegistry("photo-models"),e.getModelRegistry("photo-engagement-models"),e.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},c.FetcherErrorLogger(o))},_processParams:function(e,t){var r={photo_id:e.photoId,num_prev:e.numNext,num_next:e.numPrev,extras:c.APIHelper.request.getRebootPhotoExtras()};return e.viewAs&&(r.view_as=e.viewAs),e.orderBy&&(r.order_by=e.orderBy),r},_processResponse:function(e,t){var r=e[0],o=e[1],s=e[2],i=e[3],n=e[4],a=[],l=s.proxy(t.photoId),p=l.getValue("owner"),e=r.prevphotos,r=r.nextphotos,u=c.APIHelper.response.parsePhotos({photos:e.photo,existingPerson:p,photoModelRegistry:s,photoEngagementModelRegistry:i,photoStatsModelRegistry:n}),a=c.APIHelper.response.parsePhotos({photos:r.photo,existingPerson:p,photoModelRegistry:s,photoEngagementModelRegistry:i,photoStatsModelRegistry:n}),s=o.getValue(t.id,"photoContextList"),i=!!s.hasMinBoundary&&s.hasMinBoundary(),n=!!s.hasMaxBoundary&&s.hasMaxBoundary(),s=s.getList(),d=c.APIHelper.response.addOrReplaceListByContext({model:l,next:u,prev:a.reverse(),hasMin:i,hasMax:n,current:s,numNext:t.numNext,numPrev:t.numPrev});return o.setValue(t.id,"photoContextList",d),{next:u,previous:a.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photostream-models","photo-models","photo-engagement-models","photo-stats-models"]}),YUI.add("flickr-photos-getPerms-fetcher",function(s,i){"use strict";s.namespace("ModelFetchers")["flickr-photos-getPerms"]={run:function(t,e){var r={photo_id:t.id},o=this;return s.Promise.all([e.callAPI("flickr.photos.getPerms",r),e.getModelRegistry("photo-privacy-models")]).then(function(e){return o._processResponse(e,t)},s.FetcherErrorLogger(i))},_processResponse:function(e,t){var r=e[0],e=e[1],r={id:t.id,isPublic:r.perms.ispublic,isVisibleByFriends:r.perms.isfriend,isVisibleByFamily:r.perms.isfamily,permAddMeta:r.perms.permaddmeta,permComment:r.perms.permcomment};e.addOrUpdate(r)}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-privacy-models"]}),YUI.add("photo-privacy-models",function(o){function t(e){t.superclass.constructor.call(this,e)}o.Models[this.name]=t,o.extend(t,o.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return o.ModelFetchers["flickr-photos-getInfo"].run(e,this.appContext)},update:function(e,t){e={photo_id:e,is_public:this.getValue(e,"isPublic"),is_friend:this.getValue(e,"isVisibleByFriends"),is_family:this.getValue(e,"isVisibleByFamily"),perm_addmeta:this.getValue(e,"permAddMeta"),perm_comment:this.getValue(e,"permComment"),perm_print:this.getValue(e,"permPrint")};return o.ModelUpdaters["flickr-photos-setPerms"].run(e,this.appContext)},batchUpdate:function(e,t){var r={};return r.photo_ids=e,"privacy"in t&&(r.is_public=t.privacy.isPublic,r.is_friend=t.privacy.isVisibleByFriends,r.is_family=t.privacy.isVisibleByFamily),"commenting"in t&&(r.perm_comment=t.commenting),"addMeta"in t&&(r.perm_addmeta=t.addMeta),"permPrint"in t&&(r.perm_print=t.permPrint),r.full_response=1,o.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)}},attributes:{isPublic:{validator:function(e){return o.AttributeHelpers.validateBoolean(e)},setter:function(e){return o.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isVisibleByFriends:{validator:function(e){return o.AttributeHelpers.validateBoolean(e)},setter:function(e){return o.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isVisibleByFamily:{validator:function(e){return o.AttributeHelpers.validateBoolean(e)},setter:function(e){return o.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},permAddMeta:{validator:function(e){return o.AttributeHelpers.validateInteger(e)},setter:function(e){return o.AttributeHelpers.coerceInteger(e)},defaultValue:0},permComment:{validator:function(e){return o.AttributeHelpers.validateInteger(e)},setter:function(e){return o.AttributeHelpers.coerceInteger(e)},defaultValue:0},permPrint:{validator:function(e){return o.AttributeHelpers.validateInteger(e)},setter:function(e){return o.AttributeHelpers.coerceInteger(e)},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getPerms-fetcher","flickr-photos-setPerms-updater","attribute-helpers"]}),YUI.add("flickr-people-getPhotos-fetcher",function(d,s){"use strict";d.namespace("ListFetchers")["flickr-people-getPhotos"]={run:function(t,e){var r=this,o=[e.callAPI("flickr.people.getPhotos",this._processParams(t),!0),e.getModelRegistry("photo-models"),e.getModelRegistry("person-models"),e.getModelRegistry("photostream-models"),e.getModelRegistry("photo-engagement-models"),e.getModelRegistry("photo-stats-models"),e.getModelRegistry("photo-privacy-models")];return t.createCompoundID&&e.getViewer().signedIn&&e.getViewer().nsid&&o.push(e.getModel("person-preferences-models",e.getViewer().nsid)),d.Promise.all(o).then(function(e){return r._processResponse(e,t)},d.FetcherErrorLogger(s))},_processParams:function(e){var t={per_page:e.perPage||20,page:e.page||1,extras:d.APIHelper.request.getRebootPhotoExtras(),get_user_info:1,jump_to:e.withPhotoId||""};return e.id||e.userId?t.user_id=(e.id||e.userId).split("-")[0]:e.pathAlias&&(t.path_alias=e.pathAlias),e.privacyFilter&&(t.privacy_filter=e.privacyFilter),e.viewAs&&(t.view_as=e.viewAs),e.orderBy&&("datetaken"===e.orderBy?t.sort="date-taken-desc":t.sort=e.orderBy),e.safeSearch&&(t.safe_search=e.safeSearch),e.media&&(t.media=e.media),e.withPhotoId&&(t.jump_to=e.withPhotoId),e.contentType&&(t.content_type=e.contentType),t},_processResponse:function(e,t){var r=e[0],o=e[1],s=e[2],i=e[3],n=e[4],a=e[5],l=e[6],p=r&&r.user?r.user.nsid:null,u=t.id||t.userId;if(!p)throw new Error("API was missing valid nsid");return t={id:p,pathAlias:r.user.pathAlias,owner:d.APIHelper.response.parsePerson(r.user),totalItems:r.photos.total},u&&u!==p&&(t.id=u),e[7]&&(t.id=p+"-"+d.Models["person-preferences-models"].buildContextSuffix(e[7],p)),t.owner=s.addOrUpdate(t.owner),l=d.APIHelper.response.parsePhotos({photos:r.photos.photo,ownerID:r.photos.owner,personModelRegistry:s,photoModelRegistry:o,photoEngagementModelRegistry:n,photoStatsModelRegistry:a,photoPrivacyModelRegistry:l}),t.photoPageList={perPage:r.photos.perpage,page:r.photos.page,pageContent:l,totalItems:parseInt(r.photos.total,10)||0},i.addOrUpdate(t),l}}},"@VERSION@",{requires:["flickr-promise","api-helper","person-preferences-models"],optional:["photo-models","person-models","photostream-models","photo-engagement-models","photo-stats-models","photo-privacy-models"]}),YUI.add("photostream-models",function(r,e){function o(e){o.superclass.constructor.call(this,e)}r.Models[this.name]=o,r.extend(o,r.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(e){return r.ListFetchers["flickr-people-getPhotos"].run(e,this.appContext)}},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"photostream"}},title:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.appContext.getViewer(),r=this.getValue(e,"normalizedId");return t&&t.nsid===r?this.intlMessage({intlName:"models.YOUR_PHOTOSTREAM"}):(e=this.getValue(e,"owner"))?this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:e.getValue("displayname")}):this.intlMessage({intlName:"models.PHOTOSTREAM"})}},pathAlias:{validator:function(e,t){return r.AttributeHelpers.validateString(e)},setter:function(e){return r.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(e){return this.getValue(e,"normalizedId")}},owner:{isModel:!0},isOwner:r.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:r.ListFetchers["flickr-people-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:r.ListFetchers["flickr-photos-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),e=this.getValue(e,"normalizedId");return"/photos/"+(t?t.getValue("pathAlias"):e)+"/"}},totalItems:{defaultFn:function(){return null}},urlSuffix:{readOnly:!0,defaultFn:function(e){var t,e=o.splitCompoundId(e);return e.orderBy?(t=e.orderBy,e.viewAs?t+="-"+e.viewAs:"dateposted"===e.orderBy&&(t="photostream")):t="photostream",t}}}},{buildCompoundId:function(e,t,r){return t&&(e+="-"+t),r&&(t||(e+="-dateposted"),e+="-"+r),e},splitCompoundId:function(e){e=e.split("-");return{nsid:e[0],orderBy:e[1],viewAs:e[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getContext-fetcher","flickr-people-getPhotos-fetcher","photo-model-helper"],langBundles:["models"]}),YUI.add("person-model-helper",function(r){r.PersonModelHelper={attributes:{pathAlias:{validator:function(e,t){return r.AttributeHelpers.validateString(e)},setter:function(e){return r.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(e){return e}},username:{validator:function(e,t){return r.AttributeHelpers.validateString(e)},setter:function(e){return r.AttributeHelpers.coerceString(e)}},realname:{validator:function(e,t){return r.AttributeHelpers.validateString(e)},setter:function(e){return r.AttributeHelpers.coerceString(e)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},nsid:{readOnly:!0,defaultFn:function(e){return e}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){return"/photos/"+this.getValue(e,"pathAlias")+"/"}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}}}}},"@VERSION@",{requires:[]});
