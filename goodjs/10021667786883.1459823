define(["OK/utils/dom","OK/autofocus","OK/capture"],function(i,s,o){"use strict";function t(){this.options={closable:"0",resetActiveItems:"1",autofocus:"",resetLoaderHook:!1},this._activeItems=[],this._toogle=this._toogle.bind(this),this._loaders=[]}return t.prototype={_show:function(){var e;"1"===this.options.resetActiveItems&&(e=this._activeItems,i.byClass(this._filter,"filter_i").forEach(function(t){t.classList.contains("__active")&&(e.push(t),t.classList.remove("__active"))})),this._el.classList.add("__active"),this._toogleNext(),this._filter.classList.add("__search-visible"),"true"===this.options.resetLoaderHook&&this._loaders.forEach(function(t){o.deactivate(t,!0)})},_toogleNext:function(){for(var t=this._filter.nextElementSibling,e=this.options.autofocus;t;)t.classList.toggle("invisible"),t=t.nextElementSibling;(e=e&&this._filter.parentNode.querySelector(e))&&s.activate(e)},_hide:function(){"0"!==this.options.closable&&(this._activeItems.forEach(function(t){t.classList.add("__active")}),this._activeItems=[],this._el.classList.remove("__active"),this._toogleNext(),this._filter.classList.remove("__search-visible"),"true"===this.options.resetLoaderHook&&this._loaders.forEach(function(t){o.activate(t)}))},_toogle:function(t){var e=this._el;t.preventDefault(),e.classList.contains("__active")?this._hide():this._show()},_initOptions:function(t){Object.assign(this.options,t)},_findLoaders:function(){var t=this._filter.parentNode.querySelectorAll(".hookBlock .loader-container");this._loaders=Array.prototype.slice.call(t)},_handleLinkClick:function(t){var e=t.currentTarget.getAttribute("href");window.navigateOnUrlFromJS?window.navigateOnUrlFromJS(e):window.location.href=e,t.preventDefault()},activate:function(t){(this._el=t).getAttribute("href")?t.addEventListener("click",this._handleLinkClick):(this._initOptions(t.dataset),this._filter=i.parent(t,"filter"),this._filter&&(t.addEventListener("click",this._toogle),"true"===this.options.resetLoaderHook&&this._findLoaders()))},deactivate:function(){this._el.removeEventListener("click",this._toogle),this._el.removeEventListener("click",this._handleLinkClick),OK.util.clean(this)}},t});
