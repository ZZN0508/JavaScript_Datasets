OK.gifts=function(t,n){"use strict";var r,c,l,o;function e(){$("#ifDcards").height($(t).height()-250).scroll(),$(t).scroll()}var u,d,g=null;return{activateFriendSelectPopup:function(){setTimeout(function(){$("#popLayerBodyWrapper").css("top","60px"),e()},1),$(t).bind("resize",e)},deActivateFriendSelectPopup:function(){$(t).unbind("resize",e)},activateGiftsFront:function(t,a){var e,i,s;r=$("#gf-search-form"),c=$("#gf-search-input"),(l=0===r.length)?(o=n.getElementById("field_qs"),(i=n.getElementById("gifts-tags-container"))&&i.addEventListener("click",function(t){t.target.classList.contains("js-tag")&&OK.gifts.doSearch(t.target.innerHTML)},!1)):(e=$("#gf-search-lupa"),$("#gf-search-progress"),i=$("#gf-search-reset"),OK.onload.addCallback(function(){r[0]&&(r[0].onsubmit=function(){return u===c.val().trim()?($(".gift-front_cnt").removeClass("__process"),!1):($(".gift-front_cnt").addClass("__process"),u=c.val().trim(),r.toggleClass("search-input_active",""!==u),this.onsubmitGwt())})}),e.bind("click",function(){r.submit()}),c.val()&&""!==c.val().trim()&&r.addClass("search-input_active"),s=function(){d=!0,$(".gift-front_cnt").addClass("__process"),r.submit()},t&&c.on("keyup",function(){var t=c.val().trim(),e=""===t;return null!==g&&clearTimeout(g),u!==t?e?s():(r.toggleClass("search-input_active",!e),r.addClass("search-input_searching"),g=setTimeout(s,a)):($(".gift-front_cnt").removeClass("__process"),r.removeClass("search-input_active")),!0}),i.bind("click",function(){c.val(""),r.removeClass("search-input_active"),r.submit(),c.focus()}),r.on("click",".js-tag",function(){OK.gifts.doSearch(this.innerHTML)}))},giftsFrontContentLoaded:function(){l||(r.removeClass("search-input_searching"),u=c.val()?c.val().trim():"",d&&(setTimeout(function(){c.focus()},100),d=!1))},doSearch:function(t){OK.logging.logger.success("giftFront","tagClick",t),l?(o.value=t,o.dispatchEvent(new CustomEvent("paste"))):(c.val(t),r.addClass("search-input_active"),r.submit())}}}(window,document),OK.musicalGifts=function(){"use strict";var c,a,l,o,r,u,d,g,v,f="#music-gifts-content",e=null,m="click",_="search-input_searching",p="search-input_active",C="__process";function h(t,e){return function t(e,a,i){return e.getAttribute(a)?{value:e.getAttribute(a),action:e.getAttribute("action")}:i<5?t(e.parentNode,a,++i):void 0}(t,e,0)}function i(t){return t.getAttribute("data-query")}function b(e){require(["OK/music2/app"],function(t){t.play(Number(e),{ctx:"gifts",tids:(t=document.getElementById("music-gifts-content"),Array.prototype.slice.call(t.childNodes).map(i).filter(Boolean).join(","))})})}function k(t){var e;t&&(t.id===a&&t.playing||(!(e=a&&document.getElementById("gt_"+a))||(e=e.querySelector(".js-track_play"))&&e.classList.remove("m_portal_track_pause")),t.playing)&&(!(e=document.getElementById("gt_"+t.id))||(e=e.querySelector(".js-track_play"))&&e.classList.add("m_portal_track_pause"),a=t.id)}function y(t){var e=t.target||t.srcElement,a=h(e,"data-query"),i=h(e,"send-present-link"),s=h(e,"linkOnSelectFriend"),n=h(e,"alt-link"),r=$("#hook_FormButton_button-add");void 0!==a&&("select"===a.action?(c||($("#giftMusicIco").removeClass("__disabled"),$("#sendMP").removeClass("invisible"),$("#gmSelectedTr").removeClass("invisible"),$("#sendMPD").addClass("invisible"),S(r,!0)),c!==a.value&&($("#gt_"+c).removeClass("__selected"),$("#gt_"+c).attr("data-redesign")&&$("#gt_"+c+" div:first").removeClass("__selected"),q(c=a.value),l=void 0!==i?i.value:"",o=void 0!==n?n.value:"",s=void 0!==s?s.value:"",$("#giftMusicIco").attr("data-query",c),$("#mg-track-id").val(c),$("#sendMP").attr("data-query",l).attr("data-alt",o),$("#linkOpenSelFriend").attr("data-query",s),(s=$("#gt_"+a.value)).addClass("__selected"),s.attr("data-redesign")&&$("#gt_"+a.value+" div:first").addClass("__selected"),$("#gmSelectedTr").html('<span class="lp-t">'+s.attr("data-artist")+"</span> вЂ“ "+s.attr("data-track"))),e.classList.contains("track_play")&&b(c)):"play"===a.action?b(c):"link"===a.action&&(a=a.value,g.val(""),"sendMP"===e.getAttribute("id")&&(u||(a=e.getAttribute("data-alt")),c&&(a+="&st.layer.trackId="+c)),S(r,!1),navigateOnUrlFromJS(a),OK.historyManager.pushState(a),t.preventDefault()))}function S(t,e){e?(t.removeClass("__disabled"),t.removeAttr("disabled")):(t.addClass("__disabled"),t.attr("disabled","disabled"))}function O(){var t=g.val().trim();return d.toggleClass(p,""!==t),null!==e&&clearTimeout(e),v!==t?(e=setTimeout(function(){d.submit()},500),$(f).addClass(C)):$(f).removeClass(C),!0}function q(t){$("input#field_trackId[name='st.layer.trackId']").attr("value",t)}return{bind:function(i,s,n){OK.loader.use("jQuery",function(){!function(){d=$("#mg-search-form");var t=$("#giftMSCC").attr("data-query");d.attr("action",t),g=$("#mg-search-input");var e=$("#mg-search-lupa"),a=($("#mg-search-progress"),$("#mg-search-reset"));i||(r=void 0),q(c=i),$("#mg-track-id").val(c),u=s,i&&((t=$("#giftMusicIco")).attr("data-query",c),c===r&&($("#gt_"+r).addClass("__selected"),$("#gt_"+r).attr("data-redesign")&&$("#gt_"+r+" div:first").addClass("__selected"),t.addClass("__animated"))),$("#giftMSCC").click(y),require("OK/music2/app").on("current-track-changed",k),d.removeClass(_),v=g.val()?g.val().trim():"",n&&(g.on("keyup",O),OK.onload.addCallback(function(){d[0]&&(d[0].onsubmit=function(){return v===g.val().trim()?($(f).removeClass(C),!1):($(f).addClass(C),d.addClass(_),v=g.val().trim(),d.toggleClass(p,""!==v),this.onsubmitGwt())})}),e.bind(m,function(){d.submit()}),g.val()&&""!==g.val().trim()&&d.addClass(p),a.bind(m,function(){g.val(""),d.removeClass(p),d.submit(),g.focus()}))}()})},deActivate:function(){q(c=null),$("#giftMSCC").off("click",y),require("OK/music2/app").off("current-track-changed",k)}}}();
