!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports&&(module.exports=t()),void 0===e||void 0===e.Conviva&&(e.ConvivaLoading||(e.ConvivaLoading=!0,e.Conviva=t(),delete e.ConvivaLoading))}(this,function(){var te={};return function(){"use strict";var ee={};!function(){var c=te.Client=function(e,t){var r=this;this.defaultGatewayURLError=!1,this._logger=null,this._sessionFactory=null,this._systemFactory=null,this._globalSessionKey=-1,this._settings=null,this._systemSettings=null,this._exceptionCatcher=null,this._config=null,this._id=-1,this._released=!1,function(e,t){if(!(e instanceof i))throw new Error("clientSettings parameter should be an instance of ClientSettings.");if(!(t instanceof n))throw new Error("systemFactory parameter should be an instance of SystemFactory.");e.gatewayUrl!=i._httpsProtocol+i.defaultProductionGatewayDNS&&e.gatewayUrl!=i._httpProtocol+i.defaultProductionGatewayDNS||(this.defaultGatewayURLError=!0),this._settings=e.clone(),this._systemFactory=t,this._systemFactory.configure("SDK",this._settings),this._exceptionCatcher=this._systemFactory.buildExceptionCatcher(),this._exceptionCatcher.runProtected("Client.init",function(){r._id=W.uinteger32(),r._logger=r._systemFactory.buildLogger(),r._logger.setModuleName("Client"),r.defaultGatewayURLError&&r._logger.info("Gateway URL should not be set to https://cws.conviva.com or http://cws.conviva.com, therefore this call is ignored"),r._logger.info("init(): url="+r._settings.gatewayUrl+" customerKey="+r._settings.customerKey),r._config=r._systemFactory.buildConfig(),r._config.load(),r._sessionFactory=r._systemFactory.buildSessionFactory(r,r._settings,r._config),r._logger.info("init(): done.")},function(e){throw new Error("Client constructor failed: "+e.message)})}.apply(this,arguments),this.release=function(){this._released||this._exceptionCatcher.runProtected("Client.release",function(){r._logger.info("release()"),r._sessionFactory.cleanup(),r._sessionFactory=null,r._globalSessionKey=-1,r._logger=null,r._id=-1,r._exceptionCatcher=null,r._settings=null,r._systemSettings=null,r._systemFactory=null,r._released=!0})},this.createSession=function(e){var t=c.NO_SESSION_KEY;return this._released||(null==e||e instanceof s?this._exceptionCatcher.runProtected("Client.createSession",function(){t=r._sessionFactory.makeVideoSession(e,D.SESSION_TYPE.VIDEO)}):r._logger.error("createSession(): expecting an instance of ContentMetadata for contentMetadata parameter")),t},this.createAdSession=function(t,n){var i=c.NO_SESSION_KEY;return this._released||(null==n||n instanceof s?this._exceptionCatcher.runProtected("Client.createAdSession",function(){var e=r._sessionFactory.getVideoSession(t);null!=e&&(null!=(n=null==n?new s:n).applicationName&&null!=n.viewerId||(null==n.viewerId&&null!=e._contentMetadata.viewerId&&(n.viewerId=e._contentMetadata.viewerId),null==n.applicationName&&null!=e._contentMetadata.applicationName&&(n.applicationName=e._contentMetadata.applicationName)),n.custom["c3.csid"]=H.ToString(e._id)),i=r._sessionFactory.makeVideoSession(n,D.SESSION_TYPE.AD)}):r._logger.error("createAdSession(): expecting an instance of ContentMetadata for adMetadata parameter")),i},this.reportError=function(t,n,i){return this._released?void 0:H.isValidString(n)?i!==te.Client.ErrorSeverity.FATAL&&i!==te.Client.ErrorSeverity.WARNING?void this._logger.error("reportError(): invalid error severity: "+i):void this._exceptionCatcher.runProtected("Client.reportError",function(){var e=r._sessionFactory.getVideoSession(t);null!=e&&e.reportError(n,i)}):void this._logger.error("reportError(): invalid error message string: "+n)},this.updateContentMetadata=function(n,i){return this._released?void 0:i instanceof s?void this._exceptionCatcher.runProtected("Client.updateContentMetadata",function(){var e,t=r._sessionFactory.getVideoSession(n);null!=t&&(e=i.clone(),t.updateContentMetadata(e))}):void r._logger.error("updateContentMetadata(): expecting an instance of ContentMetadata for contentMetadata parameter")},this.detachPlayer=function(t){this._released||this._exceptionCatcher.runProtected("Client.detachPlayer",function(){var e=r._sessionFactory.getVideoSession(t);null!=e&&e.detachPlayer()})},this.attachPlayer=function(t,n){return this._released?void 0:n instanceof g?void this._exceptionCatcher.runProtected("Client.attachPlayer",function(){var e=r._sessionFactory.getVideoSession(t);null!=e&&e.attachPlayer(n)}):void r._logger.error("attachPlayer(): expecting an instance of PlayerStateManager for playerStateManager parameter")},this.contentPreload=function(t){this._released||this._exceptionCatcher.runProtected("Client.contentPreload",function(){var e=r._sessionFactory.getVideoSession(t);null!=e&&e.contentPreload()})},this.contentStart=function(t){this._released||this._exceptionCatcher.runProtected("Client.contentStart",function(){var e=r._sessionFactory.getVideoSession(t);null!=e&&e.contentStart()})},this.sendCustomEvent=function(n,i,a){return this._released?void 0:H.isValidString(i)?void this._exceptionCatcher.runProtected("Client.sendCustomEvent",function(){n==c.NO_SESSION_KEY&&(r._globalSessionKey<0&&(t=new s,r._globalSessionKey=r._sessionFactory.makeGlobalSession(t,null)),n=r._globalSessionKey);var e=H.sanitizeStringToStringObject(a),t=r._sessionFactory.getSession(n);null!=t&&t.sendCustomEvent(i,e)}):void r._logger.error("sendCustomEvent(): eventName parameter must be a valid string.")},this.adStart=function(t,n,i,a){return this._released?void 0:n!==c.AdStream.CONTENT&&n!==c.AdStream.SEPARATE?void this._logger.error("adStart(): ignored, invalid value for adStream parameter: "+n):i!==c.AdPlayer.CONTENT&&i!==c.AdPlayer.SEPARATE?void this._logger.error("adStart(): ignored, invalid value for adPlayer parameter: "+i):a!==c.AdPosition.BUMPER&&a!==c.AdPosition.PREROLL&&a!==c.AdPosition.MIDROLL&&a!==c.AdPosition.POSTROLL?void this._logger.error("adStart(): ignored, invalid value for adPosition parameter: "+a):void this._exceptionCatcher.runProtected("Client.adStart",function(){var e=r._sessionFactory.getVideoSession(t);null!=e&&e.adStart(n,i,a)})},this.adEnd=function(t){this._released||this._exceptionCatcher.runProtected("Client.adEnd",function(){var e=r._sessionFactory.getVideoSession(t);null!=e&&e.adEnd()})},this.cleanupSession=function(e){return this._released?void 0:e===c.NO_SESSION_KEY?void this._logger.warning("cleanupSession(): ignored, can't cleanup Client.NO_SESSION_KEY"):void this._exceptionCatcher.runProtected("Client.cleanupSession",function(){null!=r._sessionFactory.getVideoSession(e)&&r._sessionFactory.cleanupSession(e)})},this.getAttachedPlayer=function(t){var n=null;return this._released||(t===c.NO_SESSION_KEY?this._logger.warning("getAttachedPlayer(): ignored for Client.NO_SESSION_KEY"):this._exceptionCatcher.runProtected("Client.getAttachedPlayer",function(){var e=r._sessionFactory.getVideoSession(t);null!=e&&(n=e.getPlayerStateManager())})),n},this.isPlayerAttached=function(e){return!this._released&&null!==this.getAttachedPlayer(e)},this.getPlayerStateManager=function(){if(this._released)throw new Error("This instance of Conviva.Client has been released.");return new g(this._systemFactory)},this.releasePlayerStateManager=function(e){if(this._released)throw new Error("This instance of Conviva.Client has been released.");this._exceptionCatcher.runProtected("Client.releasePlayerStateManager",function(){e instanceof g&&e.release()})},this.getSettings=function(){return this._settings},this.getId=function(){return this._id}};c.version="2.151.0.36981",c.NO_SESSION_KEY=-2,c.AdPosition={BUMPER:"BUMPER",PREROLL:"PREROLL",MIDROLL:"MIDROLL",POSTROLL:"POSTROLL"},c.AdStream={CONTENT:"CONTENT",SEPARATE:"SEPARATE"},c.AdPlayer={CONTENT:"CONTENT",SEPARATE:"SEPARATE"},c.ErrorSeverity={FATAL:0,WARNING:1},c.DeviceType={DESKTOP:"DESKTOP",CONSOLE:"Console",SETTOP:"Settop",MOBILE:"Mobile",TABLET:"Tablet",SMARTTV:"SmartTV"},c.AdTechnology={CLIENT_SIDE:"Client Side",SERVER_SIDE:"Server Side"},c.AdType={BLACKOUT_SLATE:"Blackout slate",TECHNICAL_DIFFICULTIES_SLATE:"Technical Difficulties slate",COMMERCIAL_SLATE:"Commercial Break slate",OTHER_SLATE:"Other slate",VPAID:"VPAID",REGULAR:"Regular Ad"},c.AdServingType={INLINE:"Inline",WRAPPER:"Wrapper"},c.DeviceCategory={ANDROID_DEVICE:"AND",APPLE_DEVICE:"APL",CHROMECAST:"CHR",DESKTOP_APP:"DSKAPP",DEVICE_SIMULATOR:"SIMULATOR",LG_TV:"LGTV",NINTENDO:"NINTENDO",PLAYSTATION:"PS",ROKU:"RK",SAMSUNG_TV:"SAMSUNGTV",SMART_TV:"TV",SET_TOP_BOX:"STB",TIVO:"TIVO",WEB:"WEB",WINDOWS_DEVICE:"WIN",XBOX:"XB"};var i=te.ClientSettings=function(e){var n=this;this._customerKey=null,H.defGet(this,"customerKey",function(){return this._customerKey}),H.defSet(this,"customerKey",function(e){H.isValidString(e)&&(this._customerKey=e)}),this._heartbeatInterval=i.defaultProductionHeartbeatInterval,H.defGet(this,"heartbeatInterval",function(){return this._heartbeatInterval}),H.defSet(this,"heartbeatInterval",function(e){var t;"number"!=typeof e||(t=H.NumberToUnsignedInt(e))===e&&(this._heartbeatInterval=t)}),this._gatewayUrl=null,H.defGet(this,"gatewayUrl",function(){return this._gatewayUrl}),H.defSet(this,"gatewayUrl",function(e){H.isValidString(e)&&(this._gatewayUrl=e)}),function(e){if(!H.isValidString(e))throw new Error("customerKey must be valid");this.customerKey=e}.apply(this,arguments),this.equals=function(e){return this.customerKey===e.customerKey&&this.gatewayUrl===e.gatewayUrl&&this.heartbeatInterval===e.heartbeatInterval},this.clone=function(){var e=new i(this.customerKey);return e.gatewayUrl=function(e){if(H.isValidString(e)){var t=e.split("://");if("cws.conviva.com"!=t[1]&&("https"==t[0]||"http"==t[0]))return e}return"https://"+n.customerKey+"."+i.defaultProductionGatewayDNS}(this.gatewayUrl),e.heartbeatInterval=this.heartbeatInterval,e}};i.defaultDevelopmentGatewayUrl="https://conviva.testonly.conviva.com",i.defaultProductionGatewayUrl="https://cws.conviva.com",i.defaultProductionGatewayDNS="cws.conviva.com",i.defaultDevelopmentGatewayDNS="conviva.testonly.conviva.com",i._httpsProtocol="https://",i._httpProtocol="http://",i.defaultDevelopmentHeartbeatInterval=5,i.defaultProductionHeartbeatInterval=20;var s=te.ContentMetadata=function(){this._assetName=null,H.defGet(this,"assetName",function(){return this._assetName}),H.defSet(this,"assetName",function(e){"string"==typeof e&&(this._assetName=e)}),this._custom={},H.defGet(this,"custom",function(){return this._custom}),H.defSet(this,"custom",function(e){"object"==typeof e&&(this._custom=H.sanitizeStringToStringObject(e))}),this._defaultResource=null,H.defGet(this,"defaultResource",function(){return this._defaultResource}),H.defSet(this,"defaultResource",function(e){"string"==typeof e&&(this._defaultResource=e)}),this._viewerId=null,H.defGet(this,"viewerId",function(){return this._viewerId}),H.defSet(this,"viewerId",function(e){"string"==typeof e&&(this._viewerId=e)}),this._applicationName=null,H.defGet(this,"applicationName",function(){return this._applicationName}),H.defSet(this,"applicationName",function(e){"string"==typeof e&&(this._applicationName=e)}),this._streamUrl=null,H.defGet(this,"streamUrl",function(){return this._streamUrl}),H.defSet(this,"streamUrl",function(e){"string"==typeof e&&(this._streamUrl=e)}),this._streamType=s.StreamType.UNKNOWN,H.defGet(this,"streamType",function(){return this._streamType}),H.defSet(this,"streamType",function(e){e!==s.StreamType.UNKNOWN&&e!==s.StreamType.VOD&&e!==s.StreamType.LIVE||(this._streamType=e)}),this._duration=-1,H.defGet(this,"duration",function(){return this._duration}),H.defSet(this,"duration",function(e){this._duration=q.sanitizeSpecialIntegerValue(e)}),this._encodedFrameRate=-1,H.defGet(this,"encodedFrameRate",function(){return this._encodedFrameRate}),H.defSet(this,"encodedFrameRate",function(e){this._encodedFrameRate=q.sanitizeSpecialIntegerValue(e)}),function(){}.apply(this,arguments),this.clone=function(){var e,t=new s;for(e in t.assetName=this.assetName,t.applicationName=this.applicationName,t.streamUrl=this.streamUrl,t.viewerId=this.viewerId,t.defaultResource=this.defaultResource,t.streamType=this.streamType,t.duration=this.duration,t.encodedFrameRate=this.encodedFrameRate,this.custom)t.custom[e]=this.custom[e];return t}};s.StreamType={UNKNOWN:"UNKNOWN",LIVE:"LIVE",VOD:"VOD"};var n=(te.ErrorType={ERROR_UNKNOWN:"ERROR_UNKNOWN",ERROR_IO:"ERROR_IO",ERROR_TIMEOUT:"ERROR_TIMEOUT",ERROR_NULL_ASSET:"ERROR_NULL_ASSET",ERROR_MISSING_PARAMETER:"ERROR_MISSING_PARAMETER",ERROR_NO_AD_AVAILABLE:"ERROR_NO_AD_AVAILABLE",ERROR_PARSE:"ERROR_PARSE",ERROR_INVALID_VALUE:"ERROR_INVALID_VALUE",ERROR_INVALID_SLOT:"ERROR_INVALID_SLOT",ERROR_3P_COMPONENT:"ERROR_3P_COMPONENT",ERROR_UNSUPPORTED_3P_FEATURE:"ERROR_UNSUPPORTED_3P_FEATURE",ERROR_DEVICE_LIMIT:"ERROR_DEVICE_LIMIT",ERROR_UNMATCHED_SLOT_SIZE:"ERROR_UNMATCHED_SLOT_SIZE"},te.Events={AD_REQUESTED:"Conviva.AdRequested",AD_RESPONSE:"Conviva.AdResponse",AD_SLOT_STARTED:"Conviva.SlotStarted",AD_ATTEMPTED:"Conviva.AdAttempted",AD_SLOT_ENDED:"Conviva.SlotEnded",AD_IMPRESSION_START:"Conviva.AdImpression",AD_START:"Conviva.AdStart",AD_FIRST_QUARTILE:"Conviva.AdFirstQuartile",AD_MID_QUARTILE:"Conviva.AdMidQuartile",AD_THIRD_QUARTILE:"Conviva.AdThirdQuartile",AD_COMPLETE:"Conviva.AdComplete",AD_END:"Conviva.AdEnd",AD_IMPRESSION_END:"Conviva.AdImpressionEnd",AD_SKIPPED:"Conviva.AdSkipped",AD_ERROR:"Conviva.AdError",AD_PROGRESS:"Conviva.AdProgress",AD_CLOSE:"Conviva.AdClose",CONTENT_PAUSED:"Conviva.PauseContent",CONTENT_RESUMED:"Conviva.ResumeContent",POD_START:"Conviva.PodStart",POD_END:"Conviva.PodEnd"},te.SystemFactory=function(e,t){var n=this;(function(e,t){if(!(e instanceof S))throw new Error("systemInterface parameter should be an instance of SystemInterface.");this._systemInterface=e,this._timeInterface=this._systemInterface._timeInterface,this._timerInterface=this._systemInterface._timerInterface,this._httpInterface=this._systemInterface._httpInterface,this._storageInterface=this._systemInterface._storageInterface,this._metadataInterface=this._systemInterface._metadataInterface,this._loggingInterface=this._systemInterface._loggingInterface,this._settings=t instanceof r?t.clone():new r}).apply(this,arguments),this.configure=function(e,t){this._packageName=e,this._clientSettings=t},this.release=function(){this._systemInterface.release(),this._systemInterface=null,this._packageName=null,this._settings=null,this._logBuffer=null};var i=function(){return new J(n._loggingInterface,n._timeInterface,n.getSettings(),n._logBuffer,n._packageName)};this.buildLogger=function(){return i()},this.buildSessionFactory=function(e,t,n){return new K(e,t,n,this)},this.buildPing=function(){return new x(this.buildLogger(),this.buildHttpClient(),this._clientSettings)},this.buildCallbackWithTimeout=function(){return new Y(this.buildTimer())},this.buildCallbackWithTimeoutNoPing=function(){var e=new G(this.buildLogger(),null,this.getSettings()),e=new $(this.buildLogger(),this._timerInterface,e);return new Y(e)},this.buildHttpClient=function(){return new j(this.buildLogger(),this._httpInterface,this.buildCallbackWithTimeoutNoPing(),this.getSettings())},this.buildExceptionCatcher=function(){return new G(this.buildLogger(),this.buildPing(),this.getSettings())},this.buildTime=function(){return new Z(this._timeInterface,this.buildLogger())},this.buildTimer=function(){return new $(this.buildLogger(),this._timerInterface,this.buildExceptionCatcher())},this.buildStorage=function(){return new z(this.buildLogger(),this._storageInterface,this.buildCallbackWithTimeout(),this.getSettings())},this.buildConfig=function(){return new V(this.buildLogger(),this.buildStorage(),this.buildJsonInterface())},this.buildSystemMetadata=function(){return new X(this.buildLogger(),this._metadataInterface,this.buildExceptionCatcher())},this.buildCwsProtocol=function(){return new U},this.buildGatewayControl=function(e){return new B(e,this.buildLogger(),this.buildHttpClient(),this.buildJsonInterface())},this.buildCwsSession=function(e,t,n){var i=this.buildGatewayControl(t);return new D(this.buildEventQueue(),e,t,this.buildLogger(),this.buildExceptionCatcher(),this.buildTimer(),i,this.buildCwsProtocol(),this.buildTime(),this.getLogBuffer(),n)},this.buildSession=function(e,t,n,i,a,r){var o=this.buildExceptionCatcher(),s=this.buildLogger(),t=t.clone(),t=this.buildCwsSession(e,t,n);return new w(i,a,r,n,this.buildSystemMetadata(),t,o,s)},this.buildEventQueue=function(){return new Q},this.buildJsonInterface=function(){return new F},this.getLogBuffer=function(){return this._logBuffer},this.getSettings=function(){return this._settings},this._logBuffer=new k}),r=te.SystemSettings=function(){this._logLevel=r.defaultProductionLogLevel,H.defGet(this,"logLevel",function(){return this._logLevel}),H.defSet(this,"logLevel",function(e){var t;"number"!=typeof e||(t=H.NumberToUnsignedInt(e))===e&&t>=r.LogLevel.DEBUG&&t<=r.LogLevel.ERROR&&(this._logLevel=t)}),this._allowUncaughtExceptions=r.defaultProductionAllowUncaughtExceptions,H.defGet(this,"allowUncaughtExceptions",function(){return this._allowUncaughtExceptions}),H.defSet(this,"allowUncaughtExceptions",function(e){H.isBoolean(e)&&(this._allowUncaughtExceptions=e)}),this._storageTimeout=r.defaultStorageTimeout,H.defGet(this,"storageTimeout",function(){return this._storageTimeout}),H.defSet(this,"storageTimeout",function(e){var t;"number"!=typeof e||(t=H.NumberToUnsignedInt(e))===e&&(this._storageTimeout=t)}),this._httpTimeout=r.defaultHttpTimeout,H.defGet(this,"httpTimeout",function(){return this._httpTimeout}),H.defSet(this,"httpTimeout",function(e){var t;"number"!=typeof e||(t=H.NumberToUnsignedInt(e))===e&&(this._httpTimeout=t)}),function(){}.apply(this,arguments),this.equals=function(e){return this.logLevel===e.logLevel&&this.allowUncaughtExceptions===e.allowUncaughtExceptions&&this.storageTimeout===e.storageTimeout&&this.httpTimeout===e.httpTimeout},this.clone=function(){var e=new r;return e.logLevel=this.logLevel,e.allowUncaughtExceptions=this.allowUncaughtExceptions,e.storageTimeout=this.storageTimeout,e.httpTimeout=this.httpTimeout,e}};r.LogLevel={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},r.defaultDevelopmentLogLevel=r.LogLevel.DEBUG,r.defaultProductionLogLevel=r.LogLevel.ERROR,r.defaultDevelopmentAllowUncaughtExceptions=!0,r.defaultProductionAllowUncaughtExceptions=!1,r.defaultStorageTimeout=10,r.defaultHttpTimeout=10;var g=te.PlayerStateManager=function(e){var i=this;i._monitorNotifier=null,i._bitrateKbps=-2,i._playerState=g.PlayerState.UNKNOWN,i._currentMetadata={},i._renderedFrameRate=-2,i._encodedFrameRate=-2,i._duration=-2,i._playerVersion=null,i._playerType=null,i._streamUrl=null,i._moduleName=null,i._moduleVersion=null,i._width=-1,i._height=-1,i._connectionType=null,i._linkEncryption=null,i._lastError=null,i._pendingErrors=[],i._released=!1,this.release=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.release",function(){null!=i._monitorNotifier&&i._monitorNotifier.onRelease(),i.removeMonitoringNotifier(),i._systemFactory=null,i._logger=null,i._exceptionCatcher=null,i._released=!0})},this.setPlayheadTime=function(e){},this.setBufferLength=function(e){},this.setRenderedFrameRate=function(e){},this.getEncodedFrameRate=function(){return i._encodedFrameRate},this.setEncodedFrameRate=function(t){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setEncodedFrameRate",function(){var e=q.sanitizeSpecialIntegerValue(t);-1<=e&&(i._encodedFrameRate=e,null!=i._monitorNotifier&&i._monitorNotifier.onEncodedFrameRateChange(i._encodedFrameRate))})},this.getDuration=function(){return i._duration},this.setClientMeasureInterface=function(e){H.validateInterface(e,new te.ClientMeasureInterface,"ClientMeasureInterface"),this._playerInterface=e},this.getPHT=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getPHT?this._playerInterface.getPHT():g.DEFAULT_PHT},this.getBufferLength=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getBufferLength?this._playerInterface.getBufferLength():g.DEFAULT_BUFFER_LENGTH},this.getSignalStrength=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getSignalStrength?this._playerInterface.getSignalStrength():g.DEFAULT_SIGNAL_STRENGTH},this.getRenderedFrameRate=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getRenderedFrameRate?this._playerInterface.getRenderedFrameRate():g.DEFAULT_RENDERED_FRAME_RATE},this.setDuration=function(t){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setDuration",function(){var e=q.sanitizeSpecialIntegerValue(t);-1<=e&&(i._duration=e,null!=i._monitorNotifier&&i._monitorNotifier.onContentLengthChange(i._duration))})},this.getStreamUrl=function(){return i._streamUrl},this.setStreamUrl=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setStreamUrl",function(){null!=e&&(i._streamUrl=e,null!=i._monitorNotifier&&i._monitorNotifier.onStreamUrlChange(i._streamUrl))})},this.getModuleName=function(){return i._moduleName},this.getModuleVersion=function(){return i._moduleVersion},this.setModuleNameAndVersion=function(e,t){i._moduleName=e,i._moduleVersion=t},this.getPlayerType=function(){return i._playerType},this.setPlayerType=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerType",function(){i._playerType=e,null!=i._monitorNotifier&&i._monitorNotifier.onPlayerTypeChange(i._playerType)})},this.getPlayerVersion=function(){return i._playerVersion},this.setPlayerVersion=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerVersion",function(){i._playerVersion=e,null!=i._monitorNotifier&&i._monitorNotifier.onPlayerVersionChange(i._playerVersion)})},this.setMonitoringNotifier=function(e,t){return i._released?void 0:null==i._monitorNotifier&&(i._monitorNotifier=e,i._logger.setSessionId(t),!0)},this.removeMonitoringNotifier=function(){i._released||(i._monitorNotifier=null,i._logger.setSessionId(null))},this.pushCurrentState=function(){i.setPlayerState(i.getPlayerState()),i.setBitrateKbps(i.getBitrateKbps()),i.setDuration(i.getDuration()),i.setEncodedFrameRate(i.getEncodedFrameRate()),i.setStreamUrl(i.getStreamUrl()),i.setPlayerType(i.getPlayerType()),i.setPlayerVersion(i.getPlayerVersion());for(var e=0;e<i._pendingErrors.length;e++){var t=i._pendingErrors[e];i.setError(t)}i._pendingErrors=[]},this.getPlayerState=function(){return i._playerState},this.setPlayerState=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerState",function(){g.isValidPlayerState(e)?(i._playerState=e,null!=i._monitorNotifier&&i._monitorNotifier.onPlayerStateChange(i._playerState)):i._logger.error("PlayerStateManager.SetPlayerState(): invalid state: "+e)})},this.getBitrateKbps=function(){return i._bitrateKbps},this.setBitrateKbps=function(t){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setBitrateKbps",function(){var e=q.sanitizeSpecialIntegerValue(t);-1<=e&&(i._bitrateKbps=e,null!=i._monitorNotifier&&i._monitorNotifier.onBitrateChange(i._bitrateKbps))})},this.setPlayerSeekStart=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerSeekStart()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(g.SEEK_ACTIONS_TYPE.SEEK_START,e)})},this.setPlayerSeekEnd=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerSeekEnd()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(g.SEEK_ACTIONS_TYPE.SEEK_END,-1)})},this.setUserSeekButtonUp=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setUserSeekButtonUp()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(g.SEEK_ACTIONS_TYPE.BUTTON_UP,-1)})},this.setUserSeekButtonDown=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setUserSeekButtonDown()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(g.SEEK_ACTIONS_TYPE.BUTTON_DOWN,-1)})},this.setVideoResolutionWidth=function(t){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setVideoResolutionWidth()",function(){var e=q.sanitizeSpecialIntegerValue(t);0<e&&(i._width=e),null!=i._monitorNotifier&&i._monitorNotifier.onStreamResolutionWidthChange(i._width)})},this.setVideoResolutionHeight=function(t){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setVideoResolutionHeight()",function(){var e=q.sanitizeSpecialIntegerValue(t);0<e&&(i._height=e),null!=i._monitorNotifier&&i._monitorNotifier.onStreamResolutionHeightChange(i._height)})},this.setConnectionType=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setConnectionType()",function(){i._connectionType=e,null!=i._monitorNotifier&&i._monitorNotifier.onConnectionTypeChange(i._connectionType)})},this.setLinkEncryption=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setLinkEncryption()",function(){i._linkEncryption=e,null!=i._monitorNotifier&&i._monitorNotifier.onLinkEncryptionChange(i._linkEncryption)})},this.setSignalStrength=function(e){},this.setError=function(e){var t,n;i._lastError=e,null!=i._monitorNotifier?(t=e.errorCode,n=e.severity,i._monitorNotifier.onError(t,n)):i._pendingErrors.push(e)},this.sendError=function(t,n){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.sendError",function(){var e=new ee.StreamerError(t,n);i.setError(e)})},this.reset=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.reset",function(){i._bitrateKbps=-2,i._playerState=g.PlayerState.UNKNOWN,i._currentMetadata={},i._renderedFrameRate=-1,i._encodedFrameRate=-1,i._duration=-1,i._playerVersion=null,i._playerType=null,i._streamUrl=null,i._lastError=null,i._pendingErrors=[]})},this.getError=function(){return i._lastError},function(e){i._systemFactory=e,i._logger=i._systemFactory.buildLogger(),i._logger.setModuleName("PlayerStateManager"),i._exceptionCatcher=i._systemFactory.buildExceptionCatcher()}.apply(i,arguments),g.DEFAULT_SIGNAL_STRENGTH=1e3,g.DEFAULT_RENDERED_FRAME_RATE=-1,g.DEFAULT_BUFFER_LENGTH=-1,g.DEFAULT_PHT=-1};g.PlayerState={STOPPED:"STOPPED",PLAYING:"PLAYING",BUFFERING:"BUFFERING",PAUSED:"PAUSED",UNKNOWN:"UNKNOWN",NOT_MONITORED:"NOT_MONITORED"},g.isValidPlayerState=function(e){return e===g.PlayerState.STOPPED||e===g.PlayerState.PLAYING||e===g.PlayerState.BUFFERING||e===g.PlayerState.PAUSED||e===g.PlayerState.UNKNOWN||e===g.PlayerState.NOT_MONITORED},g.SEEK_ACTIONS_TYPE={SEEK_START:"pss",SEEK_END:"pse",BUTTON_UP:"bu",BUTTON_DOWN:"bd"};var t,E,u,a,d,o=(te.ClientMeasureInterface=function(){this.getPHT=function(){},this.getBufferLength=function(){},this.getSignalStrength=function(){},this.getRenderedFrameRate=function(){}},te.HttpInterface=function(){this.makeRequest=function(e,t,n,i,a,r){},this.release=function(){}}),_=te.LoggingInterface=function(){this.consoleLog=function(e,t){},this.release=function(){}},l=te.MetadataInterface=function(){this.getBrowserName=function(){},this.getBrowserVersion=function(){},this.getDeviceBrand=function(){},this.getDeviceManufacturer=function(){},this.getDeviceModel=function(){},this.getDeviceType=function(){},this.getDeviceVersion=function(){},this.getFrameworkName=function(){},this.getFrameworkVersion=function(){},this.getOperatingSystemName=function(){},this.getOperatingSystemVersion=function(){},this.getDeviceCategory=function(){},this.release=function(){}},h=te.StorageInterface=function(){this.saveData=function(e,t,n,i){},this.loadData=function(e,t,n){},this.release=function(){}},S=te.SystemInterface=function(e,t,n,i,a,r){(function(e,t,n,i,a,r){H.validateInterface(e,new f,"TimeInterface"),H.validateInterface(t,new T,"TimerInterface"),H.validateInterface(n,new o,"HttpInterface"),H.validateInterface(i,new h,"StorageInterface"),H.validateInterface(a,new l,"MetadataInterface"),H.validateInterface(r,new _,"LoggingInterface"),this._timeInterface=e,this._timerInterface=t,this._httpInterface=n,this._storageInterface=i,this._metadataInterface=a,this._loggingInterface=r}).apply(this,arguments),this.release=function(){this._timeInterface.release(),this._timeInterface=null,this._timerInterface.release(),this._timerInterface=null,this._httpInterface.release(),this._httpInterface=null,this._storageInterface.release(),this._storageInterface=null,this._metadataInterface.release(),this._metadataInterface=null,this._loggingInterface.release(),this._loggingInterface=null}},f=te.TimeInterface=function(){this.getEpochTimeMs=function(){},this.release=function(){}},T=te.TimerInterface=function(){this.createTimer=function(e,t,n){},this.release=function(){}},R=ee.JSON2={};function e(e){return e<10?"0"+e:e}function m(e){return t.lastIndex=0,t.test(e)?'"'+e.replace(t,function(e){var t=a[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}),"function"!=typeof R.stringify&&(t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a={"\b":"\\b"," ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},R.stringify=function(e,t,n){var i;if(u=E="","number"==typeof n)for(i=0;i<n;i+=1)u+=" ";else"string"==typeof n&&(u=n);if((d=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON2.stringify");return function e(t,n){var i,a,r,o,s,_=E,l=n[t];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(t)),typeof(l="function"==typeof d?d.call(n,t,l):l)){case"string":return m(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(E+=u,s=[],Object.prototype.toString.apply(l)===Object.prototype.toString.apply([])){for(o=l.length,i=0;i<o;i+=1)s[i]=e(i,l)||"null";return r=0===s.length?"[]":E?"[\n"+E+s.join(",\n"+E)+"\n"+_+"]":"["+s.join(",")+"]",E=_,r}if(d&&"object"==typeof d)for(o=d.length,i=0;i<o;i+=1)"string"==typeof d[i]&&(r=e(a=d[i],l))&&s.push(m(a)+(E?": ":":")+r);else for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(r=e(a,l),r&&s.push(m(a)+(E?": ":":")+r));return r=0===s.length?"{}":E?"{\n"+E+s.join(",\n"+E)+"\n"+_+"}":"{"+s.join(",")+"}",E=_,r}}("",{"":e})});var A,p,N,I,y,C,v,M,O,P=ee.JsonParse=(I={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:" "},y=function(e){throw{name:"SyntaxError",message:e,at:A,text:N}},C=function(e){return e&&e!==p&&y("Expected '"+e+"' instead of '"+p+"'"),p=N.charAt(A),A+=1,p},v=function(){var e,t,n,i="";if('"'===p)for(;C();){if('"'===p)return C(),i;if("\\"===p)if(C(),"u"===p){for(t=n=0;t<4&&(e=parseInt(C(),16),isFinite(e));t+=1)n=16*n+e;i+=String.fromCharCode(n)}else{if("string"!=typeof I[p])break;i+=I[p]}else i+=p}y("Bad string")},M=function(){for(;p&&p<=" ";)C()},O=function(){switch(M(),p){case"{":return function(){var e,t={};if("{"===p){if(C("{"),M(),"}"===p)return C("}"),t;for(;p;){if(e=v(),M(),C(":"),Object.hasOwnProperty.call(t,e)&&y('Duplicate key "'+e+'"'),t[e]=O(),M(),"}"===p)return C("}"),t;C(","),M()}}y("Bad object")}();case"[":return function(){var e=[];if("["===p){if(C("["),M(),"]"===p)return C("]"),e;for(;p;){if(e.push(O()),M(),"]"===p)return C("]"),e;C(","),M()}}y("Bad array")}();case'"':return v();case"-":return b();default:return("0"<=p&&p<="9"?b:function(){switch(p){case"t":return C("t"),C("r"),C("u"),C("e"),!0;case"f":return C("f"),C("a"),C("l"),C("s"),C("e"),!1;case"n":return C("n"),C("u"),C("l"),C("l"),null}y("Unexpected '"+p+"'")})()}},function(e,o){return N=e,A=0,p=" ",e=O(),M(),p&&y("Syntax error"),"function"==typeof o?function e(t,n){var i,a,r=t[n];if(r&&"object"==typeof r)for(i in r)Object.hasOwnProperty.call(r,i)&&(a=e(r,i),void 0!==a?r[i]=a:delete r[i]);return o.call(t,n,r)}({"":e},""):e}),U=ee.CwsProtocol=function(){this.generateEvent=function(e,t,n,i){return i.seq=e,i.st=t,i.t=n,i},this.generateSessionEndEvent=function(e,t){var n=U.EVENT_TYPE_SESSION_END;return this.generateEvent(e,t,n,{})}};function b(){var e,t="";for("-"===p&&C(t="-");"0"<=p&&p<="9";)t+=p,C();if("."===p)for(t+=".";C()&&"0"<=p&&p<="9";)t+=p;if("e"===p||"E"===p)for(t+=p,C(),"-"!==p&&"+"!==p||(t+=p,C());"0"<=p&&p<="9";)t+=p,C();return e=+t,isNaN(e)?void y("Bad number"):e}U.version="2.4",U.gatewayPath="/0/wsg",U.DEFAULT_CLIENT_ID="0",U.DEFAULT_MAX_HEARTBEAT_INFOS=0,U.DEFAULT_PLAYHEAD_TIME=-1,U.DEFAULT_BUFFER_LENGTH=-1,U.DEFAULT_SIGNAL_STRENGTH=1e3,U.SDK_METADATA_SCHEMA="sdk.js.1",U.EVENT_TYPE_STATE_CHANGE="CwsStateChangeEvent",U.EVENT_TYPE_ERROR="CwsErrorEvent",U.EVENT_TYPE_SESSION_END="CwsSessionEndEvent",U.EVENT_TYPE_CUSTOM="CwsCustomEvent",U.EVENT_TYPE_SEEK="CwsSeekEvent",U.EVENT_TYPE_DATA_SAMPLE="CwsDataSamplesEvent",U.RESPONSE_STATUS_NO_ERRORS="ok",U.RESPONSE_KEY_STATUS="err",U.RESPONSE_KEY_CLIENT_ID="clid",U.RESPONSE_KEY_CONFIG="cfg",U.RESPONSE_KEY_EVENTS="evs",U.RESPONSE_CONFIG_KEY_MAX_HEARTBEAT_INFOS="maxhbinfos",U.RESPONSE_CONFIG_KEY_SEND_LOGS="slg",U.RESPONSE_CONFIG_KEY_HEARTBEAT_INTERVAL="hbi",U.RESPONSE_CONFIG_KEY_GATEWAY_URL="gw",U.MESSAGE_TYPE_SESSION_HEARTBEAT="CwsSessionHb",U.REQUEST_KEY_MESSAGE_TYPE="t",U.REQUEST_KEY_SESSION_TIME="st",U.REQUEST_KEY_SESSION_START_TIME="sst",U.REQUEST_KEY_IS_LIVE="lv",U.REQUEST_KEY_SEQUENCE_NUMBER="seq",U.REQUEST_KEY_CUSTOMER_KEY="cid",U.REQUEST_KEY_CLIENT_ID="clid",U.REQUEST_KEY_CLIENT_VERSION="clv",U.REQUEST_KEY_PROTOCOL_VERSION="pver",U.REQUEST_KEY_INSTANCE_ID="iid",U.REQUEST_KEY_SESSION_ID="sid",U.REQUEST_KEY_VIEWER_ID="vid",U.REQUEST_KEY_ASSET_NAME="an",U.REQUEST_KEY_PLAYER_NAME="pn",U.REQUEST_KEY_TAGS="tags",U.REQUEST_KEY_SESSION_FLAGS="sf",U.REQUEST_KEY_EVENTS="evs",U.REQUEST_KEY_LOGS="lg",U.REQUEST_KEY_HEARTBEAT_INFOS="hbinfos",U.REQUEST_KEY_IS_SDK_CLIENT="sdk",U.REQUEST_KEY_PAUSE_JOIN="pj",U.REQUEST_KEY_PLAYER_STATE="ps",U.REQUEST_KEY_BITRATE="br",U.REQUEST_KEY_CONTENT_LENGTH="cl",U.REQUEST_KEY_ENCODED_FRAME_RATE="efps",U.REQUEST_KEY_AVERAGE_FRAME_RATE="afps",U.REQUEST_KEY_RFPS_TOTAL="rfpstot",U.REQUEST_KEY_RFPS_COUNT="rfpscnt",U.REQUEST_KEY_RESOURCE="rs",U.REQUEST_KEY_PLAYHEAD_TIME="pht",U.REQUEST_KEY_BUFFER_LENGTH="bl",U.REQUEST_KEY_STREAM_URL="url",U.REQUEST_KEY_CAPABILITIES="caps",U.REQUEST_KEY_PLATFORM_METADATA="pm",U.REQUEST_KEY_VIDEO_WIDTH="w",U.REQUEST_KEY_VIDEO_HEIGHT="h",U.REQUEST_KEY_CONNECTION_TYPE="ct",U.REQUEST_KEY_LINK_ENCRYPTION="le",U.REQUEST_KEY_SIGNAL_STRENGTH="ss",U.REQUEST_KEY_STREAM_METADATA_CHANGE="strmetadata",U.REQUEST_PLATFORM_METADATA_KEY_SCHEMA="sch",U.REQUEST_PLATFORM_METADATA_KEY_BROWSER_NAME="br",U.REQUEST_PLATFORM_METADATA_KEY_BROWSER_VERSION="brv",U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_BRAND="dvb",U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MANUFACTURER="dvma",U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MODEL="dvm",U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_TYPE="dvt",U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_VERSION="dvv",U.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME="fw",U.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION="fwv",U.REQUEST_PLATFORM_METADATA_KEY_CLIENT_CONFIGURATION="cc",U.REQUEST_PLATFORM_METADATA_KEY_MODULE_NAME="mn",U.REQUEST_PLATFORM_METADATA_KEY_MODULE_VERSION="mv",U.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_NAME="os",U.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_VERSION="osv",U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_CATEGORY="cat",U.REQUEST_KEY_PROTOCOL_CAPP="caps",U.REQUEST_EVENT_KEY_TYPE="t",U.REQUEST_EVENT_KEY_SEQUENCE_NUMBER="seq",U.REQUEST_EVENT_KEY_SESSION_TIME="st",U.REQUEST_EVENT_KEY_SEEK_ACT_TYPE="act",U.REQUEST_EVENT_KEY_SEEK_TO_POS="skto",U.REQUEST_ERROR_EVENT_KEY_MESSAGE="err",U.REQUEST_ERROR_EVENT_KEY_FATAL="ft",U.REQUEST_STATE_CHANGE_EVENT_KEY_NEW="new",U.REQUEST_STATE_CHANGE_EVENT_KEY_OLD="old",U.REQUEST_CUSTOM_EVENT_KEY_NAME="name",U.REQUEST_CUSTOM_EVENT_KEY_ATTRIBUTES="attr",U.REQUEST_HEARTBEAT_INFO_KEY_SEQUENCE_NUMBER="seq",U.REQUEST_HEARTBEAT_INFO_KEY_STATUS="err",U.REQUEST_HEARTBEAT_INFO_KEY_ROUNDTRIP_TIME="rtt",U.REQUEST_KEY_IS_AD_SESSION="ad",U.convertPlayerState=function(e){switch(e){case g.PlayerState.STOPPED:return U.eStopped;case g.PlayerState.PLAYING:return U.ePlaying;case g.PlayerState.BUFFERING:return U.eBuffering;case g.PlayerState.PAUSED:return U.ePaused;case g.PlayerState.NOT_MONITORED:return U.eNotMonitored;default:return U.eUnknown}},U.eStopped=1,U.ePlaying=3,U.eBuffering=6,U.ePaused=12,U.eNotMonitored=98,U.eUnknown=100,U.SessionFlags={GLOBAL:0,VIDEO:1,QUALITY_METRICS:2,BITRATE_METRICS:4},U.Capabilities={INSIGHTS:0};var F=(ee.JSONInterface=function(){this.encode=function(e){},this.decode=function(e){}},ee.LibJSONInterface=function(){this.encode=function(e){var t=null;try{t=R.stringify(e)}catch(e){}return t},this.decode=function(e){var t=null;try{t=P(e)}catch(e){}return t=!H.isObject(t)?null:t}}),L=ee.CwsHeartbeat=function(){this._data={},function(){}.apply(this,arguments),this.get=function(){return this._data},this.setField=function(e,t){this._data[e]=t},this.setInnerField=function(e,t,n){this._data[e]||(this._data[e]={}),this._data[e][t]=n},this.setMessageType=function(e){this.setField(U.REQUEST_KEY_MESSAGE_TYPE,e)},this.setSessionTime=function(e){this.setField(U.REQUEST_KEY_SESSION_TIME,e)},this.setSessionStartTime=function(e){this.setField(U.REQUEST_KEY_SESSION_START_TIME,e)},this.setIsLive=function(e){this.setField(U.REQUEST_KEY_IS_LIVE,e)},this.setSequenceNumber=function(e){this.setField(U.REQUEST_KEY_SEQUENCE_NUMBER,e)},this.setCustomerKey=function(e){this.setField(U.REQUEST_KEY_CUSTOMER_KEY,e)},this.setClientId=function(e){this.setField(U.REQUEST_KEY_CLIENT_ID,e)},this.setClientVersion=function(e){this.setField(U.REQUEST_KEY_CLIENT_VERSION,e)},this.setProtocolVersion=function(e){this.setField(U.REQUEST_KEY_PROTOCOL_VERSION,e)},this.setCapfield=function(e){this.setField(U.REQUEST_KEY_PROTOCOL_CAPP,e)},this.setSessionId=function(e){this.setField(U.REQUEST_KEY_SESSION_ID,e)},this.setInstanceId=function(e){this.setField(U.REQUEST_KEY_INSTANCE_ID,e)},this.setViewerId=function(e){this.setField(U.REQUEST_KEY_VIEWER_ID,e)},this.setAssetName=function(e){this.setField(U.REQUEST_KEY_ASSET_NAME,e)},this.setPlayerName=function(e){this.setField(U.REQUEST_KEY_PLAYER_NAME,e)},this.setTags=function(e){this.setField(U.REQUEST_KEY_TAGS,e)},this.setSessionFlags=function(e){this.setField(U.REQUEST_KEY_SESSION_FLAGS,e)},this.setCapabilities=function(e){this.setField(U.REQUEST_KEY_CAPABILITIES,e)},this.setEvents=function(e){this.setField(U.REQUEST_KEY_EVENTS,e)},this.setIsSdkClient=function(e){this.setField(U.REQUEST_KEY_IS_SDK_CLIENT,e)},this.setLogs=function(e){this.setField(U.REQUEST_KEY_LOGS,e)},this.setHeartbeatInfos=function(e){this.setField(U.REQUEST_KEY_HEARTBEAT_INFOS,e)},this.setPlayerState=function(e){this.setField(U.REQUEST_KEY_PLAYER_STATE,e)},this.setPauseJoin=function(e){this.setField(U.REQUEST_KEY_PAUSE_JOIN,e)},this.setContentLength=function(e){this.setField(U.REQUEST_KEY_CONTENT_LENGTH,e)},this.setBitrate=function(e){this.setField(U.REQUEST_KEY_BITRATE,e)},this.setResource=function(e){this.setField(U.REQUEST_KEY_RESOURCE,e)},this.setEncodedFrameRate=function(e){this.setField(U.REQUEST_KEY_ENCODED_FRAME_RATE,e)},this.setAverageFrameRate=function(e){this.setField(U.REQUEST_KEY_AVERAGE_FRAME_RATE,e)},this.setRfpsObservationCount=function(e){this.setField(U.REQUEST_KEY_RFPS_COUNT,e)},this.setRfpsTotal=function(e){this.setField(U.REQUEST_KEY_RFPS_TOTAL,e)},this.setPlatformMetadataSchema=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_SCHEMA,e)},this.setBrowserName=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_BROWSER_NAME,e)},this.setBrowserVersion=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_BROWSER_VERSION,e)},this.setDeviceBrand=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_BRAND,e)},this.setDeviceManufacturer=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MANUFACTURER,e)},this.setDeviceModel=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MODEL,e)},this.setDeviceType=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_TYPE,e)},this.setDeviceVersion=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_VERSION,e)},this.setFrameworkName=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME,e),this.setField(U.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME,e)},this.setFrameworkVersion=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION,e),this.setField(U.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION,e)},this.setOperatingSystemName=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_NAME,e.toUpperCase())},this.setOperatingSystemVersion=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_VERSION,e)},this.setDeviceCategory=function(e){this.setInnerField(U.REQUEST_KEY_PLATFORM_METADATA,U.REQUEST_PLATFORM_METADATA_KEY_DEVICE_CATEGORY,e)},this.setPlayheadTime=function(e){this.setField(U.REQUEST_KEY_PLAYHEAD_TIME,e)},this.setBufferLength=function(e){this.setField(U.REQUEST_KEY_BUFFER_LENGTH,e)},this.setStreamUrl=function(e){this.setField(U.REQUEST_KEY_STREAM_URL,e)},this.setStreamWidth=function(e){this.setField(U.REQUEST_KEY_VIDEO_WIDTH,e)},this.setStreamHeight=function(e){this.setField(U.REQUEST_KEY_VIDEO_HEIGHT,e)},this.setConnectionType=function(e){this.setField(U.REQUEST_KEY_CONNECTION_TYPE,e)},this.setLinkEncryption=function(e){this.setField(U.REQUEST_KEY_LINK_ENCRYPTION,e)},this.setIsAdSession=function(){this.setField(U.REQUEST_KEY_IS_AD_SESSION,!0)},this.setSignalStrength=function(e){this.setField(U.REQUEST_KEY_SIGNAL_STRENGTH,e)},this.setModuleName=function(e){this.setInnerField(U.REQUEST_PLATFORM_METADATA_KEY_CLIENT_CONFIGURATION,U.REQUEST_PLATFORM_METADATA_KEY_MODULE_NAME,e)},this.setModuleVersion=function(e){this.setInnerField(U.REQUEST_PLATFORM_METADATA_KEY_CLIENT_CONFIGURATION,U.REQUEST_PLATFORM_METADATA_KEY_MODULE_VERSION,e)}},D=ee.CwsSession=function(e,t,n,i,a,r,o,s,_,l,E){var u=this;u._heartbeatTimerCancel=null,u._startTimeMs=0,u._heartbeatSequenceNumber=0,u._sessionFlags=U.SessionFlags.GLOBAL,u._capabilities=U.Capabilities.INSIGHTS,u._heartbeatInfos=[],u._lastRequestSentMs=-1,u._bitrateKbps=-2,u._resource=null,u._playerState=g.PlayerState.NOT_MONITORED,u._encodedFrameRate=-1,u._contentLengthSec=-1,u._streamUrl=null,u._width=-1,u._height=-1,u._playerStateManager=null,u._assetName=null,u._viewerId=null,u._playerName=null,u._isLive=null,u._tags={},u._browserName=null,u._browserVersion=null,u._deviceBrand=null,u._deviceManufacturer=null,u._deviceModel=null,u._deviceType=null,u._deviceVersion=null,u._frameworkName=null,u._frameworkVersion=null,u._operatingSystemName=null,u._operatingSystemVersion=null,u._deviceCategory=null,u._moduleName=null,u._moduleVersion=null,u._connectionType=null,u._linkEncryption=null,u._pauseJoin=!1,u._hasJoined=!1,u._cleanedUp=!1,u._willEndSoon=!1,u._rfpsTimerCancel=null,u._rfpsTimerInterval=1e3,u._playingFpsObservationCount=0,u._playingFpsTotal=0,function(e,t,n,i,a,r,o,s,_,l,E){this._eventQueue=e,this._client=t,this._clientSettings=n,this._logger=i,this._logger.setModuleName("CwsSession"),this._exceptionCatcher=a,this._timer=r,this._gatewayControl=o,this._cwsProtocol=s,this._time=_,this._logBuffer=l,this._clientConfig=E}.apply(this,arguments),this.cleanup=function(){this._clientConfig=null,this._logBuffer=null,this._systemSettings=null,this._time=null,this._cwsProtocol=null,this._gatewayControl=null,this._timer=null,this._exceptionCatcher=null,this._logger=null,this._clientSettings=null,this._client=null,this._eventQueue.flush(),this._eventQueue=null,this._cleanedUp=!0},this.start=function(e){this._session=e,this._global=this._session._global,this._logger.setSessionId(this._session._id),this._startTimeMs=this._time.current(),(this.isVideoSession()||this.isAdSession())&&(this._sessionFlags+=D.DEFAULT_VIDEO_SESSION_FLAGS)},this.willEndSoon=function(){this._willEndSoon=!0},this.initialize=function(){this._logger.debug("initialize()")},this.end=function(){(this.isVideoSession()||this.isAdSession())&&(this._logger.debug("end(): schedule the last hb before session cleanup"+u.sessionTypeTag()),this.enqueueSessionEndEvent()),this.cancelHeartbeatTimer(),this.sendHeartbeat()},this.startSendingHeartbeats=function(){this._willEndSoon||(this.sendHeartbeat(),this.resetHeartbeatTimer())},this.setBrowserName=function(e){u._logger.debug("setBrowserName(): "+e);var t=u._browserName;t!==e&&null!=e&&(u._logger.debug("Change browserName from "+t+" to "+e),u._browserName=e)},this.setBrowserVersion=function(e){u._logger.debug("setBrowserVersion(): "+e);var t=u._browserVersion;t!==e&&null!=e&&(u._logger.debug("Change browserVersion from "+t+" to "+e),u._browserVersion=e)},this.setDeviceBrand=function(e){u._logger.debug("setDeviceBrand(): "+e);var t=u._deviceBrand;t!==e&&null!=e&&(u._logger.debug("Change deviceBrand from "+t+" to "+e),u._deviceBrand=e)},this.setDeviceManufacturer=function(e){u._logger.debug("setDeviceManufacturer(): "+e);var t=u._deviceManufacturer;t!==e&&null!=e&&(u._logger.debug("Change deviceManufacturer from "+t+" to "+e),u._deviceManufacturer=e)},this.setDeviceModel=function(e){u._logger.debug("setDeviceModel(): "+e);var t=u._deviceModel;t!==e&&null!=e&&(u._logger.debug("Change deviceModel from "+t+" to "+e),u._deviceModel=e)},this.setDeviceType=function(e){u._logger.debug("setDeviceBrand(): "+e);var t=u._deviceType;t!==e&&null!=e&&(u._logger.debug("Change deviceType from "+t+" to "+e),u._deviceType=e)},this.setDeviceVersion=function(e){u._logger.debug("setDeviceVersion(): "+e);var t=u._deviceVersion;t!==e&&null!=e&&(u._logger.debug("Change deviceVersion from "+t+" to "+e),u._deviceVersion=e)},this.setOperatingSystemName=function(e){u._logger.debug("setOperatingSystemName(): "+e);var t=u._operatingSystemName;t!==e&&null!=e&&(u._logger.debug("Change operatingSystemName from "+t+" to "+e),u._operatingSystemName=e)},this.setOperatingSystemVersion=function(e){u._logger.debug("setOperatingSystemVersion(): "+e);var t=u._operatingSystemVersion;t!==e&&null!=e&&(u._logger.debug("Change operatingSystemVersion from "+t+" to "+e),u._operatingSystemVersion=e)},this.setDeviceCategory=function(e){u._logger.debug("setDeviceCategory(): "+e);var t=u._deviceCategory;t!==e&&null!=e&&(u._logger.debug("Change operatingSystemVersion from "+t+" to "+e),u._deviceCategory=e)},this.getFrameworkName=function(){return u._frameworkName},this.setFrameworkName=function(e){u._logger.debug("setFrameworkName(): "+e);var t=u._frameworkName;t!==e&&null!=e&&(u._logger.debug("Change frameworkName from "+t+" to "+e),u._frameworkName=e)},this.getFrameworkVersion=function(){return u._frameworkVersion},this.setFrameworkVersion=function(e){u._logger.debug("setFrameworkVersion(): "+e);var t=u._frameworkVersion;t!==e&&null!=e&&(u._logger.debug("Change frameworkVersion from "+t+" to "+e),u._frameworkVersion=e)},this.setStreamUrl=function(e){u._logger.debug("setStreamUrl(): "+e);var t=u._streamUrl;t!==e&&null!=e&&(u._logger.debug("Change stream url from "+t+" to "+e),u._streamUrl=e)},this.setBitrateKbps=function(e){u._logger.debug("setBitrateKbps(): "+e);var t=u._bitrateKbps;t!==e&&0<e&&(u._logger.info("Change bitrate from "+t+" to "+e),u.enqueueBitrateChangeEvent(t,e),u._bitrateKbps=e)},this.setResource=function(e){u._logger.debug("setResource(): "+e);var t=u._resource;t!==e&&null!=e&&(u._logger.info("Change resource from "+t+" to "+e),u._resource=e)},this.setAssetName=function(e){u._logger.debug("setAssetName(): "+e),u._assetName!==e&&null!=e&&(u._logger.info("Change assetName from "+u._assetName+" to "+e),u._assetName=e)},this.setIsLive=function(e){u._logger.debug("setIsLive(): "+e);var t=u._isLive;t!==e&&null!=e&&(u._logger.info("Change isLive from "+t+" to "+e),u._isLive=e)},this.setViewerId=function(e){u._logger.debug("setViewerId(): "+e);var t=u._viewerId;t!==e&&null!=e&&(u._logger.info("Change viewerId from "+t+" to "+e),u._viewerId=e)},this.setPlayerName=function(e){u._logger.debug("setPlayerName(): "+e);var t=u._playerName;t!==e&&null!=e&&(u._logger.info("Change playerName from "+t+" to "+e),u._playerName=e)},this.setTags=function(e){u._logger.debug("setTags()");var t=u._tags;H.ObjectShallowEquals(t,e)||null==e||(u._logger.info("Change tags from "+H.ObjectToString(t)+" to "+H.ObjectToString(e)),u._tags=e)},this.setEncodedFrameRate=function(e){u._logger.debug("setEncodedFrameRate(): "+e),u._encodedFrameRate=e},this.setContentLength=function(e){u._logger.debug("setContentLength(): "+e),u._contentLengthSec=e},this.setPlayerState=function(e){var t;u._logger.debug("setPlayerState(): "+e),u._hasJoined||e!=g.PlayerState.PLAYING||(u.togglePauseJoin(!1),u._hasJoined=!0),u._playerState!==e&&(t=u._playerState,u._logger.info("setPlayerState(): changing player state from "+t+" to "+e),u.enqueuePlayerStateChangeEvent(t,e),u._playerState=e)},this.setStreamResolutionWidth=function(e){u._logger.debug("setStreamResolutionWidth(): "+e);var t=u._width;t!==e&&0<e&&(u._logger.debug("Change stream resolution width from "+t+" to "+e),u.enqueueResolutionWidthChangeEvent(t,e),u._width=e)},this.setStreamResolutionHeight=function(e){u._logger.debug("setStreamResolutionHeight(): "+e);var t=u._height;t!==e&&0<e&&(u._logger.debug("Change stream resolution height from "+t+" to "+e),u.enqueueResolutionHeightChangeEvent(t,e),u._height=e)},this.setConnectionType=function(e){u._logger.debug("setConnectionType(): "+e);var t=u._connectionType;t!==e&&null!=e&&(u._logger.debug("Change network connection type from "+t+" to "+e),u.enqueueConnectionTypeChangeEvent(t,e),u._connectionType=e)},this.setLinkEncryption=function(e){u._logger.debug("setLinkEncryption(): "+e);var t=u._linkEncryption;t!==e&&null!=e&&(u._logger.debug("Change network link encryption from "+t+" to "+e),u.enqueueLinkEncryptionChangeEvent(t,e),u._linkEncryption=e)},this.togglePauseJoin=function(e){var t;u._logger.debug("togglePauseJoin()"),u._pauseJoin!==e?(t=u._pauseJoin,e=!u._pauseJoin,u.enqueuePauseJoinChangeEvent(t,e),u._pauseJoin=!u._pauseJoin):u._logger.debug("togglePauseJoin(): same value, ignoring")},this.sendError=function(e,t){u.enqueueErrorEvent(e,t)},this.enqueueEvent=function(e,t){var n;t[U.REQUEST_EVENT_KEY_TYPE]=e,t[U.REQUEST_EVENT_KEY_SESSION_TIME]=this.getSessionTime(),t[U.REQUEST_EVENT_KEY_SEQUENCE_NUMBER]=this._eventQueue.getNumber(),this._playerStateManager&&(n=q.Integer(this._playerStateManager.getPHT(),0,null,-1),e=q.Integer(this._playerStateManager.getBufferLength(),0,null,-1),0<=n&&(t[U.REQUEST_KEY_PLAYHEAD_TIME]=n),0<e&&(t[U.REQUEST_KEY_BUFFER_LENGTH]=e)),this._eventQueue.enqueue(t)},this.setPlayerStateManager=function(e){u._playerStateManager=e,null!=u._playerStateManager?u.startRfpsTimer():u.cancelRfpsTimer()},this.enqueueSessionEndEvent=function(){var e=this.getSessionTime(),t=this.getNextEventNumber(),e=this._cwsProtocol.generateSessionEndEvent(t,e);this._eventQueue.enqueue(e)},this.enqueueErrorEvent=function(e,t){var n={};n[U.REQUEST_ERROR_EVENT_KEY_MESSAGE]=e,n[U.REQUEST_ERROR_EVENT_KEY_FATAL]=t,this.enqueueEvent(U.EVENT_TYPE_ERROR,n)},this.enqueueBitrateChangeEvent=function(e,t){var n={},i={};0<e&&(i[U.REQUEST_KEY_BITRATE]=e),n[U.REQUEST_KEY_BITRATE]=t,this.declareStateChange(n,i)},this.enqueueSeekEvent=function(e,t){var n={};n[U.REQUEST_EVENT_KEY_SEEK_ACT_TYPE]=e,0<=t&&(n[U.REQUEST_EVENT_KEY_SEEK_TO_POS]=t),this.enqueueEvent(U.EVENT_TYPE_SEEK,n)},this.enqueueResolutionWidthChangeEvent=function(e,t){var n={},i={};-1!==e&&(i[U.REQUEST_KEY_VIDEO_WIDTH]=e),n[U.REQUEST_KEY_VIDEO_WIDTH]=t,this.declareStateChange(n,i)},this.enqueueResolutionHeightChangeEvent=function(e,t){var n={},i={};-1!==e&&(i[U.REQUEST_KEY_VIDEO_HEIGHT]=e),n[U.REQUEST_KEY_VIDEO_HEIGHT]=t,this.declareStateChange(n,i)},this.enqueueConnectionTypeChangeEvent=function(e,t){var n={},i={};null!==e&&(i[U.REQUEST_KEY_CONNECTION_TYPE]=e),n[U.REQUEST_KEY_CONNECTION_TYPE]=t,this.declareStateChange(n,i)},this.enqueueLinkEncryptionChangeEvent=function(e,t){var n={},i={};null!==e&&(i[U.REQUEST_KEY_LINK_ENCRYPTION]=e),n[U.REQUEST_KEY_LINK_ENCRYPTION]=t,this.declareStateChange(n,i)},this.enqueuePauseJoinChangeEvent=function(e,t){var n={},i={};i[U.REQUEST_KEY_PAUSE_JOIN]=e,n[U.REQUEST_KEY_PAUSE_JOIN]=t,this.declareStateChange(n,i)},this.enqueuePlayerStateChangeEvent=function(e,t){var n={},i={};n[U.REQUEST_KEY_PLAYER_STATE]=U.convertPlayerState(t),i[U.REQUEST_KEY_PLAYER_STATE]=U.convertPlayerState(e),this.declareStateChange(n,i)},this.declareStateChange=function(e,t){var n={};n[U.REQUEST_STATE_CHANGE_EVENT_KEY_NEW]=e,null!=t&&0<H.dictCount(t)&&(n[U.REQUEST_STATE_CHANGE_EVENT_KEY_OLD]=t),this.enqueueEvent(U.EVENT_TYPE_STATE_CHANGE,n)},this.enqueueCustomEvent=function(e,t){var n={};n[U.REQUEST_CUSTOM_EVENT_KEY_NAME]=e,n[U.REQUEST_CUSTOM_EVENT_KEY_ATTRIBUTES]=t,this.enqueueEvent(U.EVENT_TYPE_CUSTOM,n)},this.cancelHeartbeatTimer=function(){null!=u._heartbeatTimerCancel&&(u._heartbeatTimerCancel(),u._heartbeatTimerCancel=null)},this.resetHeartbeatTimer=function(){u.cancelHeartbeatTimer();var e=1e3*u._clientSettings.heartbeatInterval;u._heartbeatTimerCancel=u._timer.create(u.sendHeartbeat,e,"Session.sendHeartbeat")},this.cancelRfpsTimer=function(){null!=u._rfpsTimerCancel&&(u._rfpsTimerCancel(),u._rfpsTimerCancel=null)},this.startRfpsTimer=function(){u.cancelRfpsTimer(),u._rfpsTimerCancel=u._timer.create(u.countRfps,u._rfpsTimerInterval,"Session.startRfpsTimer")},this.createHeartbeatInfo=function(){var e={err:"pending"};e.seq=u._heartbeatSequenceNumber-1,e.sentAt=u.getSessionTime(),e.rtt=-1,u._heartbeatInfos.push(e)},this.updateHeartbeatInfoOnFailure=function(e,t){for(var n=0;n<u._heartbeatInfos.length;n++){var i=u._heartbeatInfos[n];i.seq===e&&(i.rtt=u.getSessionTime()-i.sentAt,i.err=t)}},this.updateHeartbeatInfoOnSuccess=function(e){for(var t=0;t<u._heartbeatInfos.length;t++){var n=u._heartbeatInfos[t];n.seq===e&&(n.rtt=u.getSessionTime()-n.sentAt,n.err="ok")}},this.removeOutdatedHeartbeatInfos=function(){for(var e=u._clientConfig.get(V.CONFIG_KEY_MAX_HEARTBEAT_INFOS),t=[],n=0;n<u._heartbeatInfos.length;n++)u._heartbeatInfos[n].seq<u._heartbeatSequenceNumber-e&&t.push(n);for(var i=[],a=0;a<u._heartbeatInfos.length;a++)u._heartbeatInfos[a].seq,t.indexOf(a)<0&&i.push(u._heartbeatInfos[a]);u._heartbeatInfos=i},this.compileHeartbeatInfos=function(){u.removeOutdatedHeartbeatInfos();for(var e=[],t=0;t<u._heartbeatInfos.length;t++){var n=u._heartbeatInfos[t],i={};i[U.REQUEST_HEARTBEAT_INFO_KEY_SEQUENCE_NUMBER]=n.seq,i[U.REQUEST_HEARTBEAT_INFO_KEY_ROUNDTRIP_TIME]=n.rtt,i[U.REQUEST_HEARTBEAT_INFO_KEY_STATUS]=n.err,e.push(i)}return e},this.makeHeartbeat=function(){var e=u._eventQueue.flush();if(u.isGlobalSession()&&0===e.length)return null;var t,n,i,a,r,o=new L;return o.setMessageType(U.MESSAGE_TYPE_SESSION_HEARTBEAT),o.setCustomerKey(u._clientSettings.customerKey),o.setClientId(u._clientConfig.get(V.CONFIG_KEY_CLIENT_ID)),o.setSessionId(u._session._id),o.setSequenceNumber(u._heartbeatSequenceNumber),o.setProtocolVersion(U.version),o.setClientVersion(c.version),o.setInstanceId(u._client.getId()),o.setCapfield(0),null!=u._connectionType&&o.setConnectionType(u._connectionType),null!=u._linkEncryption&&o.setLinkEncryption(u._linkEncryption),o.setPlatformMetadataSchema(U.SDK_METADATA_SCHEMA),null!=u._browserName&&o.setBrowserName(u._browserName),null!=u._browserVersion&&o.setBrowserVersion(u._browserVersion),null!=u._deviceBrand&&o.setDeviceBrand(u._deviceBrand),null!=u._deviceManufacturer&&o.setDeviceManufacturer(u._deviceManufacturer),null!=u._deviceModel&&o.setDeviceModel(u._deviceModel),null!=u._deviceType&&o.setDeviceType(u._deviceType),null!=u._deviceVersion&&o.setDeviceVersion(u._deviceVersion),null!=u._frameworkName&&o.setFrameworkName(u._frameworkName),null!=u._frameworkVersion&&o.setFrameworkVersion(u._frameworkVersion),null!=u._operatingSystemName&&o.setOperatingSystemName(u._operatingSystemName),null!=u._operatingSystemVersion&&o.setOperatingSystemVersion(u._operatingSystemVersion),null!=u._deviceCategory&&o.setDeviceCategory(u._deviceCategory),null!=u._playerStateManager&&(u._moduleName=u._playerStateManager.getModuleName(),null!=u._moduleName&&o.setModuleName(u._moduleName)),null!=u._playerStateManager&&(u._moduleVersion=u._playerStateManager.getModuleVersion(),null!=u._moduleVersion&&o.setModuleVersion(u._moduleVersion)),null!=u._viewerId&&o.setViewerId(u._viewerId),0<H.dictCount(u._tags)&&o.setTags(u._tags),u.isVideoSession()||u.isAdSession()?(u.isAdSession()&&o.setIsAdSession(),null!=u._assetName&&o.setAssetName(u._assetName),o.setSessionFlags(u._sessionFlags),t=U.convertPlayerState(u._playerState),o.setPlayerState(t),o.setPauseJoin(u._pauseJoin),null!=u._playerName&&o.setPlayerName(u._playerName),null!=u._isLive&&o.setIsLive(u._isLive),0<u._contentLengthSec&&o.setContentLength(u._contentLengthSec),0<u._bitrateKbps&&o.setBitrate(u._bitrateKbps),null!==u._resource&&o.setResource(u._resource),0<u._encodedFrameRate&&o.setEncodedFrameRate(u._encodedFrameRate),null!=u._playerStateManager&&(n=q.Integer(u._playerStateManager.getPHT(),0,null,-1),a=q.Integer(u._playerStateManager.getBufferLength(),0,null,-1),i=u._playerStateManager.getSignalStrength()),0<=n&&o.setPlayheadTime(n),0<a&&o.setBufferLength(a),0<(a=u.updateAverageFrameRate())&&o.setAverageFrameRate(a),0<u._playingFpsTotal&&o.setRfpsTotal(q.Integer(u._playingFpsTotal,0,null,-1)),0<u._playingFpsObservationCount&&o.setRfpsObservationCount(q.Integer(u._playingFpsObservationCount,0,null,-1)),i<=0&&o.setSignalStrength(i),null!=u._streamUrl&&o.setStreamUrl(u._streamUrl),0<u._width&&o.setStreamWidth(u._width),0<u._height&&o.setStreamHeight(u._height)):o.setSessionFlags(U.SessionFlags.GLOBAL),0<e.length&&o.setEvents(e),o.setCapabilities(u._capabilities),o.setIsSdkClient(!0),u._clientConfig.get(V.CONFIG_KEY_SEND_LOGS)&&o.setLogs(u._logBuffer.flush()),0<u._clientConfig.get(V.CONFIG_KEY_MAX_HEARTBEAT_INFOS)&&0<(r=u.compileHeartbeatInfos()).length&&o.setHeartbeatInfos(r),o.setSessionStartTime(u._startTimeMs),o.setSessionTime(u.getSessionTime()),u._heartbeatSequenceNumber++,o.get()},this.sendHeartbeat=function(){var e;u._cleanedUp||null!=(e=u.makeHeartbeat())&&u.postHeartbeat(e)},this.countRfps=function(){var e;u._playerState!==g.PlayerState.PLAYING||0<=(e=u._playerStateManager.getRenderedFrameRate())&&(u._playingFpsTotal+=e,u._playingFpsObservationCount++)},this.updateAverageFrameRate=function(){if(u._playerState!==g.PlayerState.PLAYING)return-1;var e=u._playerStateManager.getRenderedFrameRate();return 0<=e?(u._playingFpsTotal+=e,u._playingFpsObservationCount++,H.Int32.Cast(+u._playingFpsTotal/u._playingFpsObservationCount)):-1},this.postHeartbeat=function(e){u.createHeartbeatInfo();var n=u._heartbeatSequenceNumber-1;u._logger.info("postHeartbeat(): Send HB["+n+"]"+u.sessionTypeTag());u._gatewayControl.send(e,function(e,t){u.onHeartbeatResponse(e,t,n)})},this.onHeartbeatResponse=function(i,a,r){u._cleanedUp||u._exceptionCatcher.runProtected("onHeartbeatResponse",function(){var e,t,n;i?null!=(t=a)?(u._logger.debug("onHeartbeatResponse(): received valid response for HB["+r+"]"),u.updateHeartbeatInfoOnSuccess(r),null!=(e=t[U.RESPONSE_KEY_CLIENT_ID])&&e!=u._clientConfig.get(V.CONFIG_KEY_CLIENT_ID)&&(u._logger.debug("onHeartbeatResponse(): setting the client id to "+e+" (from gateway)"),u._clientConfig.set(V.CONFIG_KEY_CLIENT_ID,e),u._clientConfig.save()),null!=(e=t[U.RESPONSE_KEY_STATUS])&&e!=U.RESPONSE_STATUS_NO_ERRORS&&u._logger.error("onHeartbeatResponse(): error from gateway: "+e),"object"==typeof(e=t[U.RESPONSE_KEY_CONFIG])&&(null!=(t=e[U.RESPONSE_CONFIG_KEY_MAX_HEARTBEAT_INFOS])&&u._clientConfig.get(V.CONFIG_KEY_MAX_HEARTBEAT_INFOS)!==t&&(u._logger.debug("onHeartbeatResponse(): setting Maximum Heartbeat Infos to "+t+" (from gateway)"),u._clientConfig.set(V.CONFIG_KEY_MAX_HEARTBEAT_INFOS,t)),(t=null!=(t=e[U.RESPONSE_CONFIG_KEY_SEND_LOGS])&&H.AsBoolean(t))!==u._clientConfig.get(V.CONFIG_KEY_SEND_LOGS)&&(u._logger.debug("onHeartbeatResponse(): turning "+(t?"on":"off")+" sending of logs"),u._clientConfig.set(V.CONFIG_KEY_SEND_LOGS,t)),null==(t=e[U.RESPONSE_CONFIG_KEY_HEARTBEAT_INTERVAL])||(n=H.Int32.Cast(t))!=u._clientSettings.heartbeatInterval&&(u._logger.debug("onHeartbeatResponse(): received hbIntervalMs from gateway: "+n),u._clientSettings.heartbeatInterval=n,null!=u._heartbeatTimerCancel&&u.resetHeartbeatTimer()),null!=(n=e[U.RESPONSE_CONFIG_KEY_GATEWAY_URL])&&n!=u._clientSettings.gatewayUrl&&(u._logger.debug("onHeartbeatResponse(): received gatewayUrl from gateway: "+n),u._clientSettings.gatewayUrl=n))):u._logger.warning("onHeartbeatResponse(): decoded heartbeat response is null."):(H.isValidString(n=a)?H.stringStartsWith(n,"HTTP timeout")?u._logger.warning("onHeartbeatResponse(): "+n):u._logger.error("onHeartbeatResponse(): failed to send heartbeat: "+n):(n=w.DEFAULT_HEARTBEAT_ERROR_MESSAGE,u._logger.error("onHeartbeatResponse(): "+n)),u.updateHeartbeatInfoOnFailure(r,n))})},this.getSessionTime=function(){return H.Int32.Cast(u._time.current()-u._startTimeMs)},this.getNextEventNumber=function(){return this._eventQueue.getNumber()},this.sessionTypeTag=function(){return this.isGlobalSession()?" (global session)":""},this.isGlobalSession=function(){return this._global==D.SESSION_TYPE.GLOBAL},this.isVideoSession=function(){return this._global==D.SESSION_TYPE.VIDEO},this.isAdSession=function(){return this._global==D.SESSION_TYPE.AD}};D.DEFAULT_VIDEO_SESSION_FLAGS=U.SessionFlags.VIDEO+U.SessionFlags.QUALITY_METRICS+U.SessionFlags.BITRATE_METRICS,D.SESSION_TYPE={VIDEO:"Video",GLOBAL:"Global",AD:"Ad"};var w=(ee.IMonitor=function(){this.onPlayerStateChange=function(e){},this.onBitrateChange=function(e){},this.onSeekEvent=function(e,t){},this.onEncodedFrameRateChange=function(e){},this.onRenderedFrameRateChange=function(e){},this.onContentLengthChange=function(e){},this.onPlayheadTimeChange=function(e){},this.onStreamUrlChange=function(e){},this.onBufferLengthChange=function(e){},this.onPlayerTypeChange=function(e){},this.onPlayerVersionChange=function(e){},this.onStreamResolutionWidthChange=function(e){},this.onStreamResolutionHeightChange=function(e){},this.onConnectionTypeChange=function(e){},this.onLinkEncryptionChange=function(e){},this.onSignalStrengthChange=function(e){},this.onError=function(e,t){},this.onRelease=function(){}},ee.Session=function(){var o=this;o._contentMetadata=null,o._playerStateManager=null,o._id=0,o._global=D.SESSION_TYPE.VIDEO,o._cleaningUp=!1,o._cleanedUp=!1,o._adPlaying=!1,o._adStream=null,o._adPlayer=null,o._adPosition=null,o._ignorePlayerState=!1,o._pooledPlayerState=g.PlayerState.NOT_MONITORED,o._ignoreBitrateAndResource=!1,o._ignorePlayheadTimeandBufferLength=!1,o._ignoreEncodedFrameRateAndDuration=!1,o._ignoreError=!1,function(e,t,n,i,a,r,o,s){this._id=e,this._global=t,this._contentMetadata=n,this._clientConfig=i,this._systemMetadata=a,this._cwsSession=r,this._exceptionCatcher=o,this._logger=s,this._logger.setModuleName("Session"),this._logger.setSessionId(H.ToString(this._id))}.apply(o,arguments),this.start=function(){o.isVideoSession()||o.isAdSession()?o._logger.info("start(): assetName="+o._contentMetadata.assetName):o._logger.info("start()"+o.sessionTypeTag()),o._cwsSession.start(this),o._clientConfig.isReady()?o.initiateSession():o._clientConfig.register(function(){o.initiateSession()})},this.cleanup=function(){o._logger.info("cleanup()"+o.sessionTypeTag()),o._cleaningUp=!0,o._cwsSession.willEndSoon(),o._clientConfig.isReady()?o.endCwsSessionAndCleanupAll():o._clientConfig.register(function(){o.endCwsSessionAndCleanupAll()})},this.cleanupAll=function(){o._logger.debug("cleanupAll()"+o.sessionTypeTag()),(o.isVideoSession()||o.isAdSession())&&null!=o._playerStateManager&&o.detachPlayer(),o._contentMetadata=null,o._logger.setSessionId(null),o._logger=null,o._exceptionCatcher=null,o._client=null,o._clientConfig=null,o._systemMetadata=null,o._cwsSession.cleanup(),o._cwsSession=null,o._cleanedUp=!0},this.endCwsSessionAndCleanupAll=function(){o._cwsSession.end(),o.cleanupAll()},this.initiateSession=function(){o._cwsSession.initialize(),o.setStatesFromSystemMetadata(),(o.isVideoSession()||o.isAdSession())&&(o.setStatesFromContentMetadata(),o.enqueueEventForContentMetadata()),o._cwsSession.startSendingHeartbeats()},this.enqueueEventForContentMetadata=function(){var e={};if(null!=o._contentMetadata.assetName?e[U.REQUEST_KEY_ASSET_NAME]=o._contentMetadata.assetName:o._logger.warning("enqueueEventForContentMetadata(): assetName was not set."),null!=o._contentMetadata.applicationName?(void 0===e[U.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(e[U.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),e[U.REQUEST_KEY_STREAM_METADATA_CHANGE][U.REQUEST_KEY_PLAYER_NAME]=o._contentMetadata.applicationName):o._logger.warning("enqueueEventForContentMetadata(): applicationName was not set."),null!=o._contentMetadata.streamUrl?e[U.REQUEST_KEY_STREAM_URL]=o._contentMetadata.streamUrl:o._logger.warning("enqueueEventForContentMetadata(): streamUrl was not set."),null!=o._contentMetadata.viewerId?(void 0===e[U.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(e[U.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),e[U.REQUEST_KEY_STREAM_METADATA_CHANGE][U.REQUEST_KEY_VIEWER_ID]=o._contentMetadata.viewerId):o._logger.warning("enqueueEventForContentMetadata(): viewerId was not set."),null!=o._contentMetadata.defaultResource?e[U.REQUEST_KEY_RESOURCE]=o._contentMetadata.defaultResource:o._logger.warning("enqueueEventForContentMetadata(): defaultResource was not set."),-1<o._contentMetadata.duration?e[U.REQUEST_KEY_CONTENT_LENGTH]=o._contentMetadata.duration:o._logger.warning("enqueueEventForContentMetadata(): duration was not set."),-1<o._contentMetadata.encodedFrameRate?e[U.REQUEST_KEY_ENCODED_FRAME_RATE]=o._contentMetadata.encodedFrameRate:o._logger.warning("enqueueEventForContentMetadata(): encodedFrameRate was not set."),o._contentMetadata.streamType!=s.StreamType.UNKNOWN?o._contentMetadata.streamType==te.ContentMetadata.StreamType.LIVE?e[U.REQUEST_KEY_IS_LIVE]=!0:e[U.REQUEST_KEY_IS_LIVE]=!1:o._logger.warning("enqueueEventForContentMetadata(): streamType was not set."),0<H.dictCount(o._contentMetadata.custom))for(var t in e[U.REQUEST_KEY_TAGS]={},o._contentMetadata.custom)e[U.REQUEST_KEY_TAGS][t]=o._contentMetadata.custom[t];else o._logger.warning("enqueueEventForContentMetadata(): custom tags were not set.");0<H.dictCount(e)&&o._cwsSession.declareStateChange(e,null)},this.setStatesFromSystemMetadata=function(){o._logger.debug("setStatesFromSystemMetadata()");var e=o._systemMetadata.get(),t=e[X.BROWSER_NAME];null!=t&&o._cwsSession.setBrowserName(t);t=e[X.BROWSER_VERSION];null!=t&&o._cwsSession.setBrowserVersion(t);t=e[X.DEVICE_BRAND];null!=t&&o._cwsSession.setDeviceBrand(t);t=e[X.DEVICE_MANUFACTURER];null!=t&&o._cwsSession.setDeviceManufacturer(t);t=e[X.DEVICE_MODEL];null!=t&&o._cwsSession.setDeviceModel(t);t=e[X.DEVICE_TYPE];null!=t&&o._cwsSession.setDeviceType(t);t=e[X.DEVICE_VERSION];null!=t&&o._cwsSession.setDeviceVersion(t);t=e[X.FRAMEWORK_NAME];null!=t&&o._cwsSession.setFrameworkName(t);t=e[X.FRAMEWORK_VERSION];null!=t&&o._cwsSession.setFrameworkVersion(t);t=e[X.OPERATING_SYSTEM_NAME];null!=t&&o._cwsSession.setOperatingSystemName(t);t=e[X.OPERATING_SYSTEM_VERSION];null!=t&&o._cwsSession.setOperatingSystemVersion(t);e=e[X.DEVICE_CATEGORY];null!=e&&o._cwsSession.setDeviceCategory(e)},this.setStatesFromContentMetadata=function(){var e;o._logger.debug("setStatesFromContentMetadata()"),null!=o._contentMetadata.defaultResource&&o._cwsSession.setResource(o._contentMetadata.defaultResource),null!=o._contentMetadata.streamUrl&&o._cwsSession.setStreamUrl(o._contentMetadata.streamUrl),0<o._contentMetadata.duration&&o._cwsSession.setContentLength(o._contentMetadata.duration),0<o._contentMetadata.encodedFrameRate&&o._cwsSession.setEncodedFrameRate(o._contentMetadata.encodedFrameRate),o._contentMetadata.streamType!==s.StreamType.UNKNOWN&&(e=o._contentMetadata.streamType===s.StreamType.LIVE,o._cwsSession.setIsLive(e)),null!=o._contentMetadata.assetName&&o._cwsSession.setAssetName(o._contentMetadata.assetName),null!=o._contentMetadata.viewerId&&o._cwsSession.setViewerId(o._contentMetadata.viewerId),null!=o._contentMetadata.applicationName&&o._cwsSession.setPlayerName(o._contentMetadata.applicationName),0<H.dictCount(o._contentMetadata.custom)&&o._cwsSession.setTags(o._contentMetadata.custom)},this.onPlayerStateChange=function(e){return o._logger.debug("onPlayerStateChange(): "+e),o._cwsSession._playerState!=e?(o._cwsSession._playerState==g.PlayerState.NOT_MONITORED&&e!=g.PlayerState.NOT_MONITORED&&(o._pooledPlayerState=e),o._ignorePlayerState?void o._logger.debug("onPlayerStateChange(): "+e+" (pooled, "+(o._adPlaying?"ad playing":"preloading")+")"):void o._cwsSession.setPlayerState(e)):void 0},this.onBitrateChange=function(e){return o._logger.debug("onBitrateChange(): "+e),o._ignoreBitrateAndResource?void o._logger.info("onBitrateChange(): ignored"):void o._cwsSession.setBitrateKbps(e)},this.onSeekEvent=function(e,t){null==t||H.isInteger(t)||(o._logger.error("onSeekEvent(): Ignored non-integer seekToPosition data: "+t),t=-1),o._cwsSession.enqueueSeekEvent(e,t)},this.onEncodedFrameRateChange=function(e){o._logger.debug("onEncodedFrameRateChange(): "+e),0<o._contentMetadata.encodedFrameRate||(0<e?o._ignoreEncodedFrameRateAndDuration?o._logger.info("onEncodedFrameRateChange(): Ignored encoded frame rate data: "+e+" (ads)"):(o._cwsSession.setEncodedFrameRate(e),o._logger.info("onEncodedFrameRateChange(): Received encoded frame rate data: "+e)):o._logger.warning("onEncodedFrameRateChange(): Ignored invalid encoded frame rate data: "+e))},this.onContentLengthChange=function(e){o._logger.debug("onContentLengthChange(): "+e),0<o._contentMetadata.duration||(0<e?o._ignoreEncodedFrameRateAndDuration?o._logger.info("setContentLength(): Ignored content length data: "+e+" (ads)"):(o._cwsSession.setContentLength(e),o._logger.info("setContentLength(): Received content length data: "+e)):o._logger.warning("setContentLength(): Ignored invalid content length data: "+e))},this.onStreamUrlChange=function(e){o._logger.debug("onStreamUrlChange(): "+e),null==o._contentMetadata.streamUrl&&o._cwsSession.setStreamUrl(e)},this.onStreamResolutionWidthChange=function(e){o._logger.debug("onStreamResolutionWidthChange(): "+e),o._cwsSession.setStreamResolutionWidth(e)},this.onStreamResolutionHeightChange=function(e){o._logger.debug("onStreamResolutionHeightChange(): "+e),o._cwsSession.setStreamResolutionHeight(e)},this.onConnectionTypeChange=function(e){o._logger.debug("onConnectionTypeChange(): "+e),o._cwsSession.setConnectionType(e)},this.onLinkEncryptionChange=function(e){o._logger.debug("onLinkEncryptionChange(): "+e),o._cwsSession.setLinkEncryption(e)},this.onPlayerTypeChange=function(e){o._logger.debug("onPlayerTypeChange(): "+e),null==o._cwsSession.getFrameworkName()&&o._cwsSession.setFrameworkName(e)},this.onPlayerVersionChange=function(e){o._logger.debug("onPlayerVersionChange(): "+e),null==o._cwsSession.getFrameworkVersion()&&o._cwsSession.setFrameworkVersion(e)},this.onError=function(e,t){o._logger.debug("onError(): "+e+" ("+t+")"),o.reportError(e,t)},this.onRelease=function(){o._logger.debug("onRelease()"),o.detachPlayer()},this.adStart=function(e,t,n){return o._logger.debug("adStart(): adStream="+e+" adPlayer="+t+" adPosition="+n),o._adPlaying?void o._logger.warning("adStart(): multiple adStart calls, ignoring"):(o._adPlaying=!0,o._adStream=e,o._adPlayer=t,o._adPosition=n,o._cwsSession._hasJoined||o._cwsSession.togglePauseJoin(!0),void(o._adStream==te.Client.AdStream.CONTENT||o._adPlayer==te.Client.AdPlayer.SEPARATE?(o._cwsSession._playerState!==g.PlayerState.NOT_MONITORED&&(o._pooledPlayerState=o._cwsSession._playerState),o._cwsSession.setPlayerState(g.PlayerState.NOT_MONITORED),o._ignorePlayerState=!0):o._adStream==te.Client.AdStream.SEPARATE&&o._adPlayer==te.Client.AdPlayer.CONTENT&&(o._cwsSession._playerState!==g.PlayerState.NOT_MONITORED&&(o._pooledPlayerState=o._cwsSession._playerState),o._cwsSession.setPlayerState(g.PlayerState.NOT_MONITORED),o._ignorePlayerState=!0,o._ignoreBitrateAndResource=!0,o._ignoreEncodedFrameRateAndDuration=!0,o._ignorePlayheadTimeandBufferLength=!0,o._ignoreError=!0)))},this.adEnd=function(){return o._logger.debug("adEnd()"),o._adPlaying?(o._cwsSession._hasJoined||o._cwsSession.togglePauseJoin(!1),o._adStream==te.Client.AdStream.CONTENT||o._adPlayer==te.Client.AdPlayer.SEPARATE?o._preloading||(o._ignorePlayerState=!1,o._cwsSession.setPlayerState(o._pooledPlayerState)):o._adStream==te.Client.AdStream.SEPARATE&&o._adPlayer==te.Client.AdPlayer.CONTENT&&(o._ignoreBitrateAndResource=!1,o._ignoreEncodedFrameRateAndDuration=!1,o._ignorePlayheadTimeandBufferLength=!1,o._ignoreError=!1,o._preloading||(o._ignorePlayerState=!1,o._cwsSession.setPlayerState(o._pooledPlayerState))),o._adPlaying=!1,void(o._adStream=o._adPlayer=o._adPosition=null)):void o._logger.debug("adEnd(): called before adStart, ignoring")},this.detachPlayer=function(){o._logger.debug("detachPlayer()"),null!==o._playerStateManager&&(o._exceptionCatcher.runProtected("Session.detachPlayer",function(){o._playerStateManager.removeMonitoringNotifier()}),o._playerStateManager=null,o._cwsSession.setPlayerStateManager(null),o._cwsSession.setPlayerState(g.PlayerState.NOT_MONITORED))},this.attachPlayer=function(e){return o._logger.debug("attachPlayer()"),null!=o._playerStateManager?void o._logger.error("attachPlayer(): detach current PlayerStateManager first"):void o._exceptionCatcher.runProtected("Session.attachPlayer()",function(){e.setMonitoringNotifier(o,o._id)?(e.pushCurrentState(),o._playerStateManager=e,o._cwsSession.setPlayerStateManager(o._playerStateManager)):o._logger.error("attachPlayer(): instance of PlayerStateManager is already attached to a session")})},this.getPlayerStateManager=function(){return o._logger.debug("getPlayerStateManager()"),o._playerStateManager},this.contentPreload=function(){return o._logger.debug("contentPreload()"),o._preloading?void o._logger.debug("contentPreload(): called twice, ignoring"):(o._preloading=!0,void(o._ignorePlayerState=!0))},this.contentStart=function(){return o._logger.debug("contentStart()"),o._preloading?(o._preloading=!1,void(o._adPlaying||(o._ignorePlayerState=!1,o._cwsSession.setPlayerState(o._pooledPlayerState)))):void o._logger.warning("contentStart(): called without contentPreload, ignoring")},this.reportError=function(e,t){var n;o._logger.info("reportError(): "+e),H.isValidString(e)?t===te.Client.ErrorSeverity.FATAL||t===te.Client.ErrorSeverity.WARNING?o._ignoreError?o._logger.debug("reportError(): ignored"):(n=t===te.Client.ErrorSeverity.FATAL,o._cwsSession.sendError(e,n)):o._logger.error("reportError(): invalid error severity: "+t):o._logger.error("reportError(): invalid error message string: "+e)},this.updateContentMetadata=function(e){o._logger.debug("updateContentMetadata(): enter"),o._exceptionCatcher.runProtected("Session.updateContentMetadata",function(){o.mergeContentMetadata(e),o.setStatesFromContentMetadata()})},this.sendCustomEvent=function(e,t){o._logger.info("sendEvent(): eventName="+e+o.sessionTypeTag()),o._cwsSession.enqueueCustomEvent(e,t)},this.mergeContentMetadata=function(e){var t={},n={};if(H.isValidString(e.assetName)&&(o._contentMetadata.assetName!=e.assetName?(null!=o._contentMetadata.assetName&&(t[U.REQUEST_KEY_ASSET_NAME]=o._contentMetadata.assetName),n[U.REQUEST_KEY_ASSET_NAME]=e.assetName,o._contentMetadata.assetName=e.assetName):o._logger.warning("mergeContentMetadata(): assetName was not changed.")),H.isValidString(e.applicationName)&&(o._contentMetadata.applicationName!=e.applicationName?(null!=o._contentMetadata.applicationName&&(void 0===t[U.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(t[U.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),t[U.REQUEST_KEY_STREAM_METADATA_CHANGE][U.REQUEST_KEY_PLAYER_NAME]=o._contentMetadata.applicationName),void 0===n[U.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(n[U.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),n[U.REQUEST_KEY_STREAM_METADATA_CHANGE][U.REQUEST_KEY_PLAYER_NAME]=e.applicationName,o._contentMetadata.applicationName=e.applicationName):o._logger.warning("mergeContentMetadata(): applicationName was not changed.")),H.isValidString(e.streamUrl)&&(o._contentMetadata.streamUrl!=e.streamUrl?(null!=o._contentMetadata.streamUrl&&(t[U.REQUEST_KEY_STREAM_URL]=o._contentMetadata.streamUrl),n[U.REQUEST_KEY_STREAM_URL]=e.streamUrl,o._contentMetadata.streamUrl=e.streamUrl):o._logger.warning("mergeContentMetadata(): streamUrl was not changed.")),H.isValidString(e.viewerId)&&(o._contentMetadata.viewerId!=e.viewerId?(null!=o._contentMetadata.viewerId&&(void 0===t[U.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(t[U.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),t[U.REQUEST_KEY_STREAM_METADATA_CHANGE][U.REQUEST_KEY_VIEWER_ID]=o._contentMetadata.viewerId),void 0===n[U.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(n[U.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),n[U.REQUEST_KEY_STREAM_METADATA_CHANGE][U.REQUEST_KEY_VIEWER_ID]=e.viewerId,o._contentMetadata.viewerId=e.viewerId):o._logger.warning("mergeContentMetadata(): viewerId was not changed.")),H.isValidString(e.defaultResource)&&(o._contentMetadata.defaultResource!=e.defaultResource?(null!=o._contentMetadata.defaultResource&&(t[U.REQUEST_KEY_RESOURCE]=o._contentMetadata.defaultResource),n[U.REQUEST_KEY_RESOURCE]=e.defaultResource,o._contentMetadata.defaultResource=e.defaultResource):o._logger.warning("mergeContentMetadata(): defaultResource was not changed.")),H.isInteger(e.duration)&&0<e.duration&&(o._contentMetadata.duration!=e.duration?(0<o._cwsSession._contentLengthSec&&(t[U.REQUEST_KEY_CONTENT_LENGTH]=o._cwsSession._contentLengthSec),n[U.REQUEST_KEY_CONTENT_LENGTH]=e.duration,o._contentMetadata.duration=e.duration):o._logger.warning("mergeContentMetadata(): duration was not changed.")),H.isInteger(e.encodedFrameRate)&&0<e.encodedFrameRate&&(o._contentMetadata.encodedFrameRate!=e.encodedFrameRate?(-1<o._contentMetadata.encodedFrameRate&&(t[U.REQUEST_KEY_ENCODED_FRAME_RATE]=o._contentMetadata.encodedFrameRate),n[U.REQUEST_KEY_ENCODED_FRAME_RATE]=e.encodedFrameRate,o._contentMetadata.encodedFrameRate=e.encodedFrameRate):o._logger.warning("mergeContentMetadata(): encodedFrameRate was not changed.")),e.streamType!=s.StreamType.UNKNOWN&&(o._contentMetadata.streamType!=e.streamType?(o._contentMetadata.streamType!=s.StreamType.UNKNOWN&&(o._contentMetadata.streamType==te.ContentMetadata.StreamType.LIVE?t[U.REQUEST_KEY_IS_LIVE]=!0:t[U.REQUEST_KEY_IS_LIVE]=!1),e.streamType==te.ContentMetadata.StreamType.LIVE?n[U.REQUEST_KEY_IS_LIVE]=!0:n[U.REQUEST_KEY_IS_LIVE]=!1,o._contentMetadata.streamType=e.streamType):o._logger.warning("mergeContentMetadata(): streamType was not changed.")),0<H.dictCount(e.custom)){var i,a={},r={};for(i in e.custom)o._contentMetadata.custom[i]!=e.custom[i]?(a[i]=e.custom[i],o._contentMetadata.custom[i]&&(r[i]=o._contentMetadata.custom[i]),o._contentMetadata.custom[i]=e.custom[i]):o._logger.info("mergeContentMetadata(): custom."+i+" was not changed.");0<H.dictCount(a)?(0<H.dictCount(r)&&(t[U.REQUEST_KEY_TAGS]=r),n[U.REQUEST_KEY_TAGS]=a):o._logger.warning("mergeContentMetadata(): custom was not changed.")}0<H.dictCount(n)&&o._cwsSession.declareStateChange(n,t)},this.isGlobalSession=function(){return o._global==D.SESSION_TYPE.GLOBAL},this.isVideoSession=function(){return o._global==D.SESSION_TYPE.VIDEO},this.isAdSession=function(){return o._global==D.SESSION_TYPE.AD},this.sessionTypeTag=function(){return o.isGlobalSession()?" (global session)":""}});w.DEFAULT_HEARTBEAT_ERROR_MESSAGE="received no response (or a bad response) to heartbeat POST request";var K=ee.SessionFactory=function(){var a=this;a._logger=null,a._logBuffer=null,a._nextSessionKey=0,a._sessionsByKey=null,function(e,t,n,i){a._client=e,a._clientSettings=t,a._clientConfig=n,a._systemFactory=i,a._logger=a._systemFactory.buildLogger(),a._logger.setModuleName("SessionFactory"),a._nextSessionKey=0,a._sessionsByKey={}}.apply(a,arguments),this.cleanup=function(){for(var e in a._logger=null,a._logBuffer=null,a._sessionsByKey)a._sessionsByKey[e].cleanup();a._sessionsByKey=null,a._nextSessionKey=0},this.newSessionKey=function(){var e=a._nextSessionKey;return a._nextSessionKey++,e},this.makeVideoSession=function(e,t){return null==e&&(e=new s),a.makeSession(e,t)},this.makeGlobalSession=function(e){return a.makeSession(e,D.SESSION_TYPE.GLOBAL)},this.generateSessionId=function(){return W.integer32()},this.makeSession=function(e,t){var n=e.clone(),e=a.generateSessionId(),t=a._systemFactory.buildSession(a._client,a._clientSettings,a._clientConfig,e,t,n),n=a.newSessionKey();return a.addSession(n,t),t.start(),n},this.getSession=function(e){e=a._sessionsByKey[e];return null==e&&a._logger.error("Client: invalid sessionKey. Did you cleanup that session previously?"),e},this.getVideoSession=function(e){e=this.getSession(e);return null!=e&&(e.isVideoSession()||e.isAdSession()||(a._logger.error("Client: invalid sessionKey. Did you cleanup that session previously?"),e=null)),e},this.addSession=function(e,t){a._sessionsByKey[e]=t},this.removeSession=function(e){delete a._sessionsByKey[e]},this.cleanupSession=function(e){var t=a.getSession(e);a.removeSession(e),t.cleanup()}},Y=ee.CallbackWithTimeout=function(e){this._timer=e,this.getWrapperCallback=function(n,e,t){var i=!1;this._timer.createOnce(function(){i||n(!(i=!0),t+" ("+e+" ms)")},e,"CallbackWithTimeout.wrap");return function(e,t){i||(i=!0,n(e,t))}}},V=ee.Config=function(e,t,n){var i=this;this._logger=e,this._logger.setModuleName("Config"),this._storage=t,this._jsonInterface=n,this._defaultConfig={clientId:U.DEFAULT_CLIENT_ID,sendLogs:!1,maxHbInfos:U.DEFAULT_MAX_HEARTBEAT_INFOS},this._config=H.ObjectShallowCopy(this._defaultConfig),this._loaded=!1,this._loadedEmpty=!1,this._waitingConsumers=[],this.isReady=function(){return this._loaded},this.load=function(){this._storage.load(V.STORAGE_KEY,function(e,t){e?(i._parse(t),i._logger.debug("load(): configuration successfully loaded from local storage"+(i._loadedEmpty?" (was empty)":"")+".")):i._logger.error("load(): error loading configuration from local storage: "+t),i._loaded=!0,i._notify()})},this._parse=function(e){e=this._jsonInterface.decode(e);null!=e?null!=(e=e[V.CONFIG_STORAGE_KEY_CLIENT_ID])&&e!=U.DEFAULT_CLIENT_ID&&""!=e&&"null"!=e&&(this._config[V.CONFIG_KEY_CLIENT_ID]=e,this._logger.debug("parse(): loaded clientId="+e+" (from local storage)")):this._loadedEmpty=!0},this._marshall=function(){var e={};return e[V.CONFIG_STORAGE_KEY_CLIENT_ID]=this._config.clientId,this._logger.debug("_marshall(): saving clientId="+this._config.clientId+" (to local storage)"),this._jsonInterface.encode(e)},this.save=function(){this._storage.save(V.STORAGE_KEY,this._marshall(),function(e,t){e?i._logger.debug("save(): configuration successfully saved to local storage."):i._logger.error("save(): error saving configuration to local storage: "+t)})},this.register=function(e){return this.isReady()?void e():void this._waitingConsumers.push(e)},this.get=function(e){return this._loaded?this._config[e]:null},this.set=function(e,t){this._loaded&&(this._config[e]=t)},this._notify=function(){for(var e;null!=(e=this._waitingConsumers.shift());)e()}};V.STORAGE_KEY="sdkConfig",V.CONFIG_STORAGE_KEY_CLIENT_ID="clId",V.CONFIG_KEY_CLIENT_ID="clientId",V.CONFIG_KEY_SEND_LOGS="sendLogs",V.CONFIG_KEY_MAX_HEARTBEAT_INFOS="maxHbInfos";var Q=ee.EventQueue=function(){this._events=[],this._nextEventNumber=0,this.enqueue=function(e){this._events.push(e)},this.getNumber=function(){var e=this._nextEventNumber;return this._nextEventNumber++,e},this.flush=function(){var e=this._events;return this._events=[],e}},G=ee.ExceptionCatcher=function(e,t,n){this._logger=e,this._logger.setModuleName("ExceptionCatcher"),this._ping=t,this._systemSettings=n,this.runProtected=function(t,e,n){try{e()}catch(e){if(null!=n)n(e);else{if(this._systemSettings.allowUncaughtExceptions)throw e;this.onUncaughtException(t,e)}}},this.onUncaughtException=function(e,t){t="Uncaught exception: "+e+": "+t.toString();if(null!=this._ping)try{this._ping.send(t)}catch(e){this._logger.error("Caught exception while sending ping: "+e.toString())}this._logger.error(t)}},B=ee.GatewayControl=function(e,t,n,i){var a=this;this._clientSettings=e,this._logger=t,this._logger.setModuleName("GatewayControl"),this._httpClient=n,this._jsonInterface=i,this.send=function(e,i){var t=this._jsonInterface.encode(e),e=this._clientSettings.gatewayUrl+U.gatewayPath;this._httpClient.request("POST",e,t,"application/json",function(e,t){var n;e?(n=a._jsonInterface.decode(t),i(e,n)):i(e,t)})}},H=ee.Lang={};H.isMeaningfulString=function(e){return H.isValidString(e)&&null!=e&&"undefined"!=e&&"null"!=e},H.sanitizeStringToStringObject=function(e){var t,n,i={};for(t in e)H.isMeaningfulString(t)&&(n=e[t],H.isMeaningfulString(n)&&(i[t]=n));return i},H.validateInterface=function(e,t,n){if(null==e)throw new Error("Expected "+n+" implementation is null.");for(var i in t)if("function"!=typeof e[i])throw new Error("Expected method "+i+" in "+n+" implementation.")},H.dictCount=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},H.ToString=function(e){return""+e},H.NumberToInt=function(e){return Math.floor(e)},H.NumberToUnsignedInt=function(e){return Math.abs(H.NumberToInt(e))},H.AsBoolean=function(e){return Boolean(e)},H.isValidString=function(e){return"string"==typeof e&&""!==e},H.stringStartsWith=function(e,t){return"string"==typeof e&&"string"==typeof t&&("function"==typeof e.indexOf&&0===e.indexOf(t))},H.isBoolean=function(e){return"boolean"==typeof e},H.UrlEncodeString=function(e){return escape(e)},H.isObject=function(e){return"object"==typeof e},H.ObjectToString=function(e){var t,n="";for(t in e)n+=t+"="+e[t];return"Object{"+n+"}"},H.ObjectShallowCopyOmitNull=function(e){var t,n=H.ObjectShallowCopy(e);for(t in n)null==n[t]&&delete n[t];return n},H.ObjectShallowCopy=function(e){var t,n={};for(t in e)n[t]=e[t];return n},H.ObjectShallowEquals=function(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Object&&t instanceof Object){if(H.dictCount(e)!==H.dictCount(t))return!1;var n,i;for(i in e)if(n=e[i]===t[i],!n)return!1;return!0}return e===t},H.isInteger=function(e){return"number"==typeof e&&Math.round(e)===e},H.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},H.ArrayEquals=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(H.isArray(e[n])&&H.isArray(t[n])){if(!H.ArrayEquals(e[n],t[n]))return!1}else if(e[n]!==t[n])return!1;return!0},H.isObjectDefinePropertyPresent=function(){return void 0!==Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()},H.defGet=function(e,t,n){if(H.isObjectDefinePropertyPresent())Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n});else{if(void 0===e.__defineGetter__)throw new Error("JavaScript runtime must support either Object.defineProperty or __defineGetter__");e.__defineGetter__(t,n)}},H.defSet=function(e,t,n){if(H.isObjectDefinePropertyPresent())Object.defineProperty(e,t,{configurable:!0,set:n});else{if(void 0===e.__defineSetter__)throw new Error("JavaScript runtime must support either Object.defineProperty or __defineSetter__");e.__defineSetter__(t,n)}},function(){var t={two32:4294967296};t.MaxValue=t.two32-1,t.MinValue=0,H.UInt32=t,H.UInt32.Cast=function(e){e=parseInt(e,10);return e>t.MaxValue?e%=t.two32:e<t.MinValue&&(e=-e%t.two32,e=t.two32-e),e},H.UInt32.InRange=function(e){e=parseInt(e,10);return e<=t.MaxValue&&e>=t.MinValue};var n={MaxValue:2147483647,MinValue:-2147483648};H.Int32=n,H.Int32.Cast=function(e){e=parseInt(e,10);return e>n.MaxValue?e%=n.MaxValue:e<n.MinValue&&(e=-e%n.MaxValue,e=n.MaxValue-e),e},H.Int32.InRange=function(e){e=parseInt(e,10);return e<=n.MaxValue&&e>=n.MinValue}}();var k=ee.LogBuffer=function(){this._buffer=[],this.add=function(e){32<=this._buffer.length&&this._buffer.shift(),this._buffer.push(e)},this.flush=function(){var e=this._buffer;return this._buffer=[],e}},x=ee.Ping=function(e,t,n){this._isSendingPing=!1,this._cachedBasePingUrl=null,this._logger=e,this._logger.setModuleName("Ping"),this._httpClient=t,this._clientSettings=n,this.send=function(e){this._isSendingPing||(this._isSendingPing=!0,e=this.getBasePingUrl()+"&d="+H.UrlEncodeString(e.toString()),this._logger.error("send(): "+e),this._httpClient.request("GET",e,null,null,null),this._isSendingPing=!1)},this.getBasePingUrl=function(){if(!this._cachedBasePingUrl){var e=x.SERVICE_URL+"?comp="+x.COMPONENT_NAME+"&clv="+c.version;if(this._clientSettings&&(e+="&cid="+this._clientSettings.customerKey),e+="&sch="+U.SDK_METADATA_SCHEMA,!this._clientSettings)return e;this._cachedBasePingUrl=e}return this._cachedBasePingUrl}};x.COMPONENT_NAME="sdkjs",x.SERVICE_URL="https://pings.conviva.com/ping.ping";var W=ee.Random={};W.maxUInt32=4294967295,W.maxInt32=2147483647,W.minInt32=-2147483648,W.integer32=function(){return Math.floor(Math.random()*W.maxUInt32)+W.minInt32},W.uinteger32=function(){return Math.floor(Math.random()*W.maxUInt32)};var q=ee.Sanitize={};q.Integer=function(e,t,n,i){if(isNaN(e))return i;if("number"!=typeof e)return i;if(e==i)return i;e=H.NumberToInt(e);return q.EnforceBoundaries(e,t,n)},q.EnforceBoundaries=function(e,t,n){return null!=n&&n<e?e=n:null!=t&&e<t&&(e=t),e},q.sanitizeSpecialIntegerValue=function(e){return-1==e||-2==e?e:q.Integer(e,0,null,-1)};var j=(ee.StreamerError=function(){var n=this;n.errorCode=null,n.severity=c.ErrorSeverity.FATAL,function(e,t){n.errorCode=e,n.severity=t}.apply(n,arguments)},ee.HttpClient=function(e,t,n,i){this._logger=e,this._logger.setModuleName("HttpClient"),this._httpInterface=t,this._callbackWithTimeout=n,this._systemSettings=i,this.request=function(e,t,n,i,a){var r=1e3*this._systemSettings.httpTimeout,a=this._callbackWithTimeout.getWrapperCallback(a,r,"HTTP timeout");this._logger.debug("request(): calling HttpInterface.makeRequest"),this._httpInterface.makeRequest(e,t,n,i,r,a)}}),J=ee.Logger=function(e,t,n,i,a){this._loggingInterface=e,this._timeInterface=t,this._settings=n,this._logBuffer=i,this._packageName=a,this.debug=function(e){this.log(e,r.LogLevel.DEBUG)},this.info=function(e){this.log(e,r.LogLevel.INFO)},this.warning=function(e){this.log(e,r.LogLevel.WARNING)},this.error=function(e){this.log(e,r.LogLevel.ERROR)},this.log=function(e,t){e=this.formatMessage(e,t);this._logBuffer.add(e),this._settings.logLevel<=t&&this._loggingInterface.consoleLog(e,t)},this.prependModuleName=function(e){return"["+this._moduleName+"] "+e},this.prependPackageName=function(e){return"["+this._packageName+"] "+e},this.prependConvivaNamespace=function(e){return"[Conviva] "+e},this.prependTime=function(e){return"["+(this._timeInterface.getEpochTimeMs()/1e3).toFixed(3).toString()+"] "+e},this.prependLogLevel=function(e,t){return"["+J.getLogLevelString(t)+"] "+e},this.prependSessionId=function(e){return e=null!=this._sessionId?"sid="+this._sessionId+" "+e:e},this.setSessionId=function(e){this._sessionId=e},this.setModuleName=function(e){this._moduleName=e},this.formatMessage=function(e,t){return this.prependConvivaNamespace(this.prependTime(this.prependLogLevel(this.prependPackageName(this.prependModuleName(this.prependSessionId(e))),t)))}};J.getLogLevelString=function(e){var t;switch(e){case r.LogLevel.ERROR:t="ERROR";break;case r.LogLevel.WARNING:t="WARNING";break;case r.LogLevel.INFO:t="INFO";break;case r.LogLevel.DEBUG:t="DEBUG"}return t};var z=ee.Storage=function(e,t,n,i){this._logger=e,this._logger.setModuleName("Storage"),this._storageInterface=t,this._callbackWithTimeout=n,this._systemSettings=i,this.load=function(e,t){t=this._callbackWithTimeout.getWrapperCallback(t,1e3*this._systemSettings.storageTimeout,"storage load timeout");this._logger.debug("load(): calling StorageInterface.loadData"),this._storageInterface.loadData(z.STORAGE_SPACE,e,t)},this.save=function(e,t,n){n=this._callbackWithTimeout.getWrapperCallback(n,1e3*this._systemSettings.storageTimeout,"storage save timeout");this._logger.debug("save(): calling StorageInterface.saveData"),this._storageInterface.saveData(z.STORAGE_SPACE,e,t,n)}};z.STORAGE_SPACE="Conviva";var X=ee.SystemMetadata=function(e,t,n){this._logger=e,this._logger.setModuleName("SystemMetadata"),this._metadataInterface=t,this._exceptionCatcher=n,this._cachedMetadata=null,this.get=function(){return this._cachedMetadata||this.retrieve(),this._cachedMetadata},this.retrieve=function(){var e={};e[X.BROWSER_NAME]=this._metadataInterface.getBrowserName,e[X.BROWSER_VERSION]=this._metadataInterface.getBrowserVersion,e[X.DEVICE_BRAND]=this._metadataInterface.getDeviceBrand,e[X.DEVICE_MANUFACTURER]=this._metadataInterface.getDeviceManufacturer,e[X.DEVICE_MODEL]=this._metadataInterface.getDeviceModel,e[X.DEVICE_TYPE]=this._metadataInterface.getDeviceType,e[X.DEVICE_VERSION]=this._metadataInterface.getDeviceVersion,e[X.FRAMEWORK_NAME]=this._metadataInterface.getFrameworkName,e[X.FRAMEWORK_VERSION]=this._metadataInterface.getFrameworkVersion,e[X.OPERATING_SYSTEM_NAME]=this._metadataInterface.getOperatingSystemName,e[X.OPERATING_SYSTEM_VERSION]=this._metadataInterface.getOperatingSystemVersion,e[X.DEVICE_CATEGORY]=this._metadataInterface.getDeviceCategory;var t,i=this;for(t in this._logger.debug("retrieve(): calling MetadataInterface methods"),e)(function(t,n){i._exceptionCatcher.runProtected("Session.getSystemMetadataSchema(): "+t,function(){var e=n[t];n[t]=e.call(i._metadataInterface)})})(t,e),H.isValidString(e[t])||delete e[t];var n=!1;if(void 0!==e[X.DEVICE_TYPE]){for(var a in te.Client.DeviceType)if(e[X.DEVICE_TYPE]===te.Client.DeviceType[a]){n=!0;break}n||delete e[X.DEVICE_TYPE]}if(n=!1,void 0!==e[X.DEVICE_CATEGORY]){for(var r in te.Client.DeviceCategory)if(e[X.DEVICE_CATEGORY]===te.Client.DeviceCategory[r]){n=!0;break}n||delete e[X.DEVICE_CATEGORY]}this._cachedMetadata=H.ObjectShallowCopyOmitNull(e)}};X.BROWSER_NAME="browserName",X.BROWSER_VERSION="browserVersion",X.DEVICE_BRAND="deviceBrand",X.DEVICE_MANUFACTURER="deviceManufacturer",X.DEVICE_MODEL="deviceModel",X.DEVICE_TYPE="deviceType",X.DEVICE_VERSION="deviceVersion",X.FRAMEWORK_NAME="frameworkName",X.FRAMEWORK_VERSION="frameworkVersion",X.OPERATING_SYSTEM_NAME="operatingSystemName",X.OPERATING_SYSTEM_VERSION="operatingSystemVersion",X.DEVICE_CATEGORY="deviceCategory";var Z=ee.Time=function(e,t){this._timeInterface=e,this._logger=t,this._logger.setModuleName("Time"),this.current=function(){var e=this._timeInterface.getEpochTimeMs();return H.isInteger(e)||this._logger.error("current(): TimeInterface.getEpochTimeMs() did not return an integer ("+e+")"),e}},$=ee.Timer=function(e,t,n){var a=this;this._logger=e,this._logger.setModuleName("Timer"),this._timerInterface=t,this._exceptionCatcher=n,this.create=function(e,t,n){return this.createTimer(function(){a._exceptionCatcher.runProtected(n,function(){e()})},t,n)},this.createOnce=function(e,t,n){var i={cancel:null},t=this.createTimer(function(){a._exceptionCatcher.runProtected(n,function(){i&&"function"==typeof i.cancel&&(i.cancel(),i.cancel=null,i=null),e()})},t,n);return i.cancel=t},this.createTimer=function(e,t,n){return this._logger.debug("createTimer(): calling TimerInterface.create"),this._timerInterface.createTimer(e,t,n)}}}()}(),te});
