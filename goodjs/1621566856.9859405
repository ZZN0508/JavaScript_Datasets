(function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.bookingSSO=b()}):a.bookingSSO=b()})("undefined"==typeof self?this:self,function(){var a=[1,5,10,15,30,60,120,300,600],b={initAnonSession:function initAnonSession(b,c){function d(a,b){try{e(a,b)}catch(a){"function"==typeof b&&b(a)}}function e(a,b){var c=Date.now(),d=window!==window.top;if(d)throw new Error("SSO should not be used in iframes");if(h())throw new Error("Too many attempts, please try again later");var e,f,j=function done(d,g){j=function done(){},document.removeEventListener("message",e),f&&f.parentElement.removeChild(f),b&&b(d,g);var h=Date.now()-c;i(a,h,d)},k=g(a);f=document.createElement("iframe"),f.id="booking-sso-iframe",f.name="booking-sso-iframe",l(f);var m=!1;f.addEventListener("load",function(){setTimeout(function(){m||j(new Error("IFrame load error"))},5e3)}),f.addEventListener("error",function(){j(new Error("HTTP request error"))}),e=function(b){if(b.origin===location.origin){var c=b.data;if("string"==typeof c)try{c=JSON.parse(b.data)}catch(a){}c&&c.sessionState&&c.oauthClientId===a.oauthClientId&&(m=!0,j(void 0,c))}},window.addEventListener("message",e),document.body.appendChild(f),f.src=k}function f(){if(b.apHost)return"https://"+b.apHost;var a=/\b(dev|dqs|localhost)\.booking\.com$/.test(location.hostname),c=a?"account.dqs":"account";return"https://"+c+".booking.com"}function g(a){if(!a.oauthClientId)throw new TypeError("oauthClientId is empty");if(!a.redirectUri)throw new TypeError("redirectUri is empty");var b=f(a)+"/oauth2/authorize/v2",c={client_id:a.oauthClientId,redirect_uri:a.redirectUri,response_type:"anon_session",prompt:"none",iframe:1,dt:Date.now(),state:a.state||"",bkng_referrer:location.origin+location.pathname};window.booking&&window.booking.env&&window.booking.env.b_action&&(c.bkng_action=window.booking.env.b_action);var d="?";for(var e in c)Object.prototype.hasOwnProperty.call(c,e)&&(b+=d+e+"="+encodeURIComponent(c[e]),d="&");return b}function h(){try{var a=JSON.parse(localStorage.bssoNextAttempt),b=a.dt;return Date.now()<b}catch(a){}}function i(a,b,c){j(),k(a,b,c)}function j(){try{var h;if(localStorage.bssoNextAttempt){var b=JSON.parse(localStorage.bssoNextAttempt),c=b.dt,d=b.interval,e=Date.now()>c+1e3*d;if(e){var j=Date.now()>c+1e3*(2*d);if(j)for(var k=a.length-1;0<=k;k--)if(a[k]<d){d=a[k];break}}else for(var i=0;i<a.length;i++)if(a[i]>d){d=a[i];break}c=Date.now()+1e3*d,h={dt:c,interval:d}}else{var f=a[0],g=Date.now()+1e3*f;h={dt:g,interval:f}}localStorage.bssoNextAttempt=JSON.stringify(h)}catch(a){}}function k(a,b,c){var d={client_id:a.oauthClientId,success:c?0:1,elapsed:b,referrer:location.href};window!==window.top&&(d.iframe=1),window.booking&&window.booking.env&&window.booking.env.b_action&&(d.bkng_action=window.booking.env.b_action);var e=f(a)+"/collector/anon_session_init",g=new XMLHttpRequest;g.withCredentials=!0,g.open("POST",e),g.setRequestHeader("Content-Type","application/json"),g.send(JSON.stringify(d))}function l(a){a.style.top="-100000px",a.style.left="-100000px",a.style.border="none",a.style.width="1px",a.style.height="1px"}return"function"==typeof Promise?new Promise(function(a,f){d(b,function(b,d){"function"==typeof c&&c(b),b?f(b):a(d)})}):void d(b,c)}},c=window.bookingSSO;if(null!==c&&void 0!==c&&c.autoInitAnonSession){var d=0|c.autoInitAnonSessionTimeout;setTimeout(function(){b.initAnonSession(c,function(a,b){"function"==typeof c.initAnonSessionCallback&&c.initAnonSessionCallback(a,b)})},d)}return b});