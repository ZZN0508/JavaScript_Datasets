define(["local/common/components/nsglibCommon","local/"+window.nsglibCommon.ress.getRessVersion()+"/phx/layer"],function(r,o){var s,a,t,n=document.location.pathname,i=document.location.search,d=document.location.href;return{close:p,init:function(){h(),r.headData.save(),r.domBuilder.addEvent(document.body,"click",e),r.domBuilder.addEvent(document.body,"click",u),r.domBuilder.addEvent(window,"popstate",f)}};function e(o){if(!("undefined"!=typeof offline&&!0===offline||"undefined"!=typeof accStaticr&&void 0!==accStaticr.offline&&!0===accStaticr.offline||o.ctrlKey||o.shiftKey||o.metaKey||o.button&&1==o.button)){var i=o.target.closest("a");if(i&&i.href&&i.getAttribute("data-phx-url")){if(0==+i.getAttribute("data-phx-url"))return t=i.href,void requestAnimationFrame(l);void 0!==window.dlApi&&(window.interstitialAds&&window.interstitialAds.isActive?(o.preventDefault(),window.interstitialAds.callback({destinationUrl:i.href,eventTarget:i,event:o,callback:e})):e())}}function e(){window.interstitialAds={};var e=document.querySelector(".pageHeader");r.domBuilder.addClass(e,"phxOpening"),r.domBuilder.hasClass(document.body,"pageHeaderSmall")||r.domBuilder.removeClass(e,"switch"),setTimeout(function(){r.domBuilder.removeClass(e,"phxOpening")},500);var t=i.getAttribute("data-art-type"),n=new URL(i.href);n.hash="",a={domElement:i,rect:i.getBoundingClientRect()},history.pushState({phxURL:n.href,detailType:t},void 0,n.href),m(n.href),o.preventDefault()}}function l(){window.nsglibCommon.phxAdsConfigurator.saveOriginalAdsConfiguration(),window.nsglibCommon.phxAdsConfigurator.destroyMainPageSlots(),localStorage.setItem("sg.externalOpen.url",t),r.domBuilder.addEvent(window,"focus",c)}function c(){r.gemius.hit(),window.nsglibCommon.phxAdsConfigurator.restoreMainPageAdsConfiguration("nonInstantBack",window.location.href),window.nsglibCommon.phxAdsConfigurator.restoreMainPageSlots(),localStorage.removeItem("sg.externalOpen.url"),r.domBuilder.removeEvent(window,"focus",c)}function u(e){"close"===e.target.getAttribute("data-action-phx")&&p(!1,e.target.getAttribute("data-phx-close-type")||"unknown")}function f(e){e=e.state||{};window.nsglibCommon.phxLayer.layerIsStatic()&&location.href.indexOf("#")<0?window.open(e.phxURL||"/","_self"):e.phxURL?m(e.phxURL,e.detailType):window.nsglibCommon.phxLayer.layerIsOpened()&&location.href.indexOf("#")<0&&p(!0,"back")}function p(e,t){if(window.nsglibCommon.phxLayer.layerIsStatic()){if("scroll"===t)try{localStorage.setItem("sg.phxautorefresh.time",+new Date)}catch(e){}window.open("/","_self")}else window.nsglibCommon.phxLayer.layerIsOpened()&&(h(function(e){e.destroy("#Detail")}),r.phxAdsConfigurator.destroyLayerSlots(),o.close(a),r.headData.restore(),r.windowParams.restore(),window.dataLayer.push({layerCloseType:t}),r.dataLayer.restore(),e||history.pushState(void 0,void 0,n+i),r.phxAdsConfigurator.restoreMainPageAdsConfiguration(t,d),r.phxAdsConfigurator.restoreMainPageSlots(),"scroll"!==t&&r.gemius.hit(),r.backupYT&&r.backupYT.restore(),require(["local/common/playerSwitcher/index"],function(e){e.enablePlayers()}),window.store.restore())}function m(t){var e=new URL(t),n=e.origin+e.pathname;r.phxAdsConfigurator.saveOriginalAdsConfiguration(),require(["local/common/playerSwitcher/index"],function(e){e.disablePlayers()}),r.phxAdsConfigurator.destroyMainPageSlots(),o.open(),h(function(e){e?(e.render({type:"detail",container:"#Detail",params:{url:n},onRender:function(){r.phxAdsConfigurator.addStaticSlots(),o.runAmd(),window.dlApi.fetch()}}),e.on("dataLayerUpdateRequest",r.dataLayer.update),e.on("headUpdateRequest",function(e){e.referrer="unsafe-url",r.headData.set(e)}),e.on("enetWidget",function(e){e&&function(e){for(var t=0;t<e.length;t++){var n=document.createElement(e[t].tagName);null===document.getElementById(e[t].id)&&(n.id=e[t].id,void 0!==e[t].src&&(n.src=e[t].src),void 0!==e[t].async&&(n.async=e[t].async),void 0!==e[t].type&&(n.type=e[t].type),void 0!==e[t].innerHTML&&(n.innerHTML=e[t].innerHTML),void 0!==e[t].rel&&(n.rel=e[t].rel),void 0!==e[t].href&&(n.href=e[t].href),document.head.appendChild(n))}}(e)}),e.on("adsUpdateRequest",function(e){r.phxAdsConfigurator.updateAdsConfiguration(e,t),r.gemius.hit(e.gemius)}),e.on("windowParamsUpdateRequest",r.windowParams.update)):window.open(t,"_self")})}function h(a){var d;a=a||function(){},s?a(s):(d={dlApi:window.onetAds||window.dlApi,ress:r.ress.getRessVersion(),websiteVariant:r.getWebsiteVariant()},window.PhxRenderer?(s=new window.PhxRenderer(d),a(s)):window.phxScripts&&function(e,t){var n=e.length;function o(){0==--n&&t()}for(var i=0;i<e.length;i++){var r,a=e[i];(function(t){var e=document.head.querySelectorAll("script");return[].slice.call(e).filter(function(e){return e.src===t})[0]})(a)?o():((r=document.createElement("script")).onload=o,r.onerror=o,r.src=a,document.head.appendChild(r))}}(window.phxScripts,function(){var e,t,n,o,i,r;t=(e={maxAttempts:5,timeout:100,truthTest:function(){return window.PhxRenderer},callback:function(){window.PhxRenderer&&(s=new window.PhxRenderer(d)),a(s)}}).maxAttempts,n=e.timeout,o=e.truthTest,i=e.callback,r=0,function e(){r++,o()||r===t?i():setTimeout(e,n)}()}))}});
