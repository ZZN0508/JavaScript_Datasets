!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("wafer-module",[],t):"object"==typeof exports?exports["wafer-module"]=t():(e.wafer=e.wafer||{},e.wafer.wafers=e.wafer.wafers||{},e.wafer.wafers["wafer-module"]=t())}("undefined"!=typeof self?self:this,function(){return a={"./src/base.js":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t,a){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);return void 0!==r?"value"in r?r.value:void 0!==(r=r.get)?r.call(a):void 0:null===(e=Object.getPrototypeOf(e))?void 0:l(e,t,a)}var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,r=arguments[t];for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},r=function(e,t,a){return t&&b(e.prototype,t),a&&b(e,a),e},f=[],n=window.wafer,m=n.base,o=n.constants,i=n.utils,n=n.WaferBaseClass,s=i.convertNodeListToArray,d=i.findAncestor,g=i.getConfigFromJSONScriptNode,c=i.getTemplateContent,p=i.setTimeout,v=i.throttle,h=o.ATTR_PREFIX,y=["handleAdd","handleDrag","handleDragEnd","handleDragEnter","handleDragIndicatorFocusIn","handleDragLeave","handleDragOver","handleDragStart","handleDrop","handleKeyDown","handleMouseEnter","handleMouseleave","handleMoveDown","handleMoveToColumn","handleMoveUp","handleRemove"],_="wafer-module-drag-indicator",E=document.body,r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(w,n),r(w,[{key:"removeDragDropOverCueFromAll",value:function(){var e,t=this._state.dragProxy;!t||(e=t.parentNode)&&e.removeChild(t),s(document.getElementsByClassName("wafer-module-drop-over")).forEach(function(e){e.classList.remove("wafer-module-drop-over")})}},{key:"focus",value:function(){var e=this._util.dragElement;e&&p(function(){e.focus()},50,this)}},{key:"destroy",value:function(){var e=this._util,t=e.elem,a=e.id,e=e.isDraggable;m.emitWaferEvent("module:destroyed",{elem:t,meta:{id:a}}),e&&this.removeEventListeners();for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];(e=l(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"destroy",this)).call.apply(e,[this].concat(n))}},{key:"_closeContextMenu",value:function(){var a=this;p(function(){var e=a._state.focusMenuElem,t=a._util.elem;t&&t.classList.remove("wafer-module-context-menu-open"),e&&e.parentNode.removeChild(e),a._state.focusMenuElem=null,a._state.focusDragElem=null,a._state.contextMenuButtons=null},5,this)}},{key:"_pageScroll",value:function(e){var t=this,a=window.scrollY;window.scrollTo({top:a+e}),this._state.scrollStop||p(function(){t._pageScroll(e)},20,this)}},{key:"handleRemove",value:function(){var e=this,t=this._util,a=t.elem,r=t.delay,n=t.removeSelfOnDelete;a.classList.add("wafer-module-delete-in-progress"),p(function(){n&&(m.destroy(a),e.destroy(),a.parentNode.removeChild(a)),a.classList.remove("wafer-module-delete-in-progress")},r,this),this.didRemove(a)}},{key:"handleDrag",value:function(e){e.stopPropagation();var t=this._util.elem;this._state.scrollStop=!0,t.classList.add("wafer-module-drag-in-progress"),E.classList.add("wafer-module-drag-in-progress"),this.setDragElem(e.currentTarget),e.clientY<150&&(this._state.scrollStop=!1,this._pageScroll(-1))}},{key:"handleDragEnter",value:function(e){e=e.currentTarget;this.getDragElem()!==e&&(this.removeDragDropOverCueFromAll(),e.classList.add("wafer-module-drop-over"))}},{key:"handleDragLeave",value:function(e){var t=e.clientX,a=e.clientY,r=e.currentTarget,e=r.parentNode.getBoundingClientRect();(a<e.top||a>=e.bottom||t<e.left||t>=e.right)&&this.getDragElem()!==r&&r.classList.remove("wafer-module-drop-over")}},{key:"handleDragEnd",value:function(e){var t=this._util.elem;this._state.scrollStop=!0,t.classList.remove("wafer-module-drag-in-progress"),E.classList.remove("wafer-module-drag-in-progress"),this.removeDragDropOverCueFromAll()}},{key:"handleDragOver",value:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}},{key:"handleDragStart",value:function(e){var t=this._util,a=t.dragImageElem,r=t.elem;e.dataTransfer.effectAllowed="move",a&&((t=document.createElement("div")).classList.add("wafer-module-drag-proxy"),t.appendChild(a.cloneNode(!0)),document.body.appendChild(t),t.style.width=r.offsetWidth+"px",e.dataTransfer.setDragImage(t,e.offsetX,t.offsetHeight/2),this._state.dragProxy=t)}},{key:"handleAdd",value:function(e){this._closeContextMenu(),this.handleAdd()}},{key:"handleMoveUp",value:function(e){this._closeContextMenu(),this._handleMoveUp(e)}},{key:"handleMoveDown",value:function(e){this._closeContextMenu(),this._handleMoveDown(e)}},{key:"handleMoveToColumn",value:function(e){this._closeContextMenu(),this._handleMoveToColumn(e)}},{key:"handleMouseEnter",value:function(){var e,t;this._util.isDraggable&&(t=this._util,e=t.elem,t=t.dragMouseEnterTimeout,this._state.hoverTimeout=p(function(){e.classList.add("wafer-module-drag-hover-enter")},t,this))}},{key:"handleMouseleave",value:function(){var e=this._util,t=e.isDraggable,e=e.isDropOnly;t&&!e&&(e=this._util.elem,clearTimeout(this._state.hoverTimeout,this),e.classList.remove("wafer-module-drag-hover-enter"))}},{key:"handleDragIndicatorFocusIn",value:function(e){this._state.focusDragElem=e.target}},{key:"handleKeyDown",value:function(e){var t=this._state.focusDragElem;if(t){var a=e.keyCode,r=e.target.classList,n=void 0;if(32===a&&r&&r.contains(_)){e.preventDefault();var o=d(this._util.elem,"wafer-module-drop-target");!o||(r=c(o.getElementsByClassName("wafer-module-drag-context-menu")[0]))&&(o=this._util.elem,(l=document.createElement("div")).classList.add("wafer-module-drag-options-context-menu"),(this._state.focusMenuElem=l).innerHTML=r,t.parentNode.appendChild(l),o.classList.add("wafer-module-context-menu-open"),l=this._state.contextMenuButtons=l.getElementsByTagName("button"),this._state.contextMenuActiveIndex=0,(n=l[this._state.contextMenuActiveIndex])&&p(function(){n.focus()},100,this))}else if(!this._state.contextMenuButtons)return;var l=this._state.contextMenuActiveIndex;38===a?(e.preventDefault(),0===l?this._state.contextMenuActiveIndex=this._state.contextMenuButtons.length-1:--this._state.contextMenuActiveIndex,n=this._state.contextMenuButtons[this._state.contextMenuActiveIndex]):40===a&&(e.preventDefault(),l>=this._state.contextMenuButtons.length-1?this._state.contextMenuActiveIndex=0:++this._state.contextMenuActiveIndex,n=this._state.contextMenuButtons[this._state.contextMenuActiveIndex]),n?p(function(){n.focus()},100,this):this._closeContextMenu()}}},{key:"handleClickOutside",value:function(e){var t=this._state.focusDragElem;(0,e.waferComposedMap)().get(t)||this._closeContextMenu()}},{key:"handleDrop",value:function(e){var t,a=this.getDragElem();e.stopPropagation(),a&&"true"===(t=e.currentTarget).getAttribute("draggable")&&(t.previousElementSibling===a?(t.parentElement.insertBefore(t,a),this.didDrag({dragElem:t,dropElem:a})):(t.parentElement.insertBefore(a,t),this.didDrag({dragElem:a,dropElem:t})))}},{key:"config",get:function(){var e=this._util,t=e.config;return{config:void 0===t?{}:t,elem:e.elem,id:e.id}}}]),w);function w(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=t.selector,r=t.successClass;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(w.__proto__||Object.getPrototypeOf(w)).call(this,e,{selector:a},{STATE_ATTRS:f})),o=e.getAttribute(h+"module-id"),l=e.getAttribute(h+"module-remove-delay")||"1000",i=e.getAttribute(h+"module-drag-image-elem"),s=e.getAttribute(h+"module-remove-self-on-delete"),d="true"===e.getAttribute("draggable"),c=g(e.getElementsByClassName("wafer-module-config")[0]),t=e.getElementsByClassName(_)[0],a=void 0;return i&&(a=e.getElementsByClassName(i)[0]),y.forEach(function(e){n[e]=n[e].bind(n)}),n._util=u({},n._util,{config:c,contextMenuActiveIndex:0,contextMenuButtons:null,delay:l,dragElement:t,dragImageElem:a,elem:e,id:o,isDraggable:d,removeSelfOnDelete:null==s?1:Number(s),successClass:r}),n._state=n._state||{},d&&(d=e.getAttribute(h+"module-drag-mouseenter-timeout")||100,n.addEventListeners(),n._util.dragMouseEnterTimeout=d,n._state=u({},n._state,{dragElem:null,dragProxy:null,focusDragElem:null,focusMenuElem:null,hoverTimeout:null,scrollStop:!0})),e.classList.add(r),n.handleDragOver=v(n.handleDragOver,100),p(function(){n.addInstanceToIdMap(n),m.emitWaferEvent("module:added",{elem:e,meta:{id:o}})},n,0),n}function b(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}r.events={click:[["wafer-module-add","handleAdd"],["wafer-module-move-down","handleMoveDown"],["wafer-module-move-to-column","handleMoveToColumn"],["wafer-module-move-up","handleMoveUp"],["wafer-module-remove","handleRemove"]],drag:[["_self","handleDrag"]],dragend:[["_self","handleDragEnd"]],dragenter:[["_self","handleDragEnter"]],dragleave:[["_self","handleDragLeave"]],dragover:[["_self","handleDragOver"]],dragstart:[["_self","handleDragStart"]],drop:[["_self","handleDrop"]],focusin:[[_,"handleDragIndicatorFocusIn"]],keydown:[["_self","handleKeyDown"]],mouseenter:[[_,"handleMouseEnter"]],mouseleave:[[_,"handleMouseleave"]]},t.default=r,e.exports=t.default},"./src/controller.js":function(e,t,a){"use strict";function l(){return e=a("./src/base.js"),i=e&&e.__esModule?e:{default:e};var e}function u(){return f=a("./src/utils.js")}Object.defineProperty(t,"__esModule",{value:!0});function n(e,t,a){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);return void 0!==r?"value"in r?r.value:void 0!==(r=r.get)?r.call(a):void 0:null===(e=Object.getPrototypeOf(e))?void 0:n(e,t,a)}var i,f,v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,r=arguments[t];for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},r=function(e,t,a){return t&&p(e.prototype,t),a&&p(e,a),e},o=window.wafer,h=o.base,o=o.utils,s=o.bindEvent,y=o.convertNodeListToArray,m=o.fetchWithCache,_=o.findAncestor,c=o.getConfigFromJSONScriptNode,E=o.throttle,d=o.unbindEvent,o=window.wafer.controllers.WaferBaseController,w="wafer-module-drop-target",b="wafer-module-set-active",D="wafer-module-added",M="wafer-module-add-in-progress",C=document.body,g=void 0,r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(A,o),r(A,[{key:"handleInlineAddingModule",value:function(n,o,e,l,i,s,d,c){var t=this._util.moduleConfig,a=void 0===t?{}:t,t=a.addFetchUrl;return m((void 0===t?"/?p_id=MODULE_ID":t).replace(/MODULE_ID/,e),{cacheStrategy:"cacheFirst"}).then(function(e){var t=e.html,a=document.createElement("div"),e=o.length&&o[s];d[l]=!0,i.classList.remove(M),a.innerHTML=t;var r,a=a.children[0];e?n.insertBefore(a,o[s]):(r=n.children,r=s?r[r.length-1]:r[0],n.insertBefore(a,r)),h.sync(n),c&&(r=(void 0===(r=c.config.config)?{}:r).addMessage,c.focus(),r&&(h.liveAriaRegion.innerHTML=r))}).catch(function(e){var t=a.bodyErrorClass;C.classList.add(t),d[l]=!1,i.classList.remove(M),h.emitError({name:"WaferModule",elem:i,meta:{type:"addModuleActionFailed"},stack:e.stack})})}},{key:"getActiveTarget",value:function(){var e=y(document.getElementsByClassName(w));return e.length?(this._state.lastTargetIndex>=e.length&&(this._state.lastTargetIndex=0),e[this._state.lastTargetIndex++]):null}},{key:"handleEvent",value:function(e,t,a){var r;n(A.prototype.__proto__||Object.getPrototypeOf(A.prototype),"handleEvent",this).call(this,e,t,a),a&&"click"===a.type&&(r=a.target).className&&r.classList.contains(b)&&(this._state.activeElem=r)}},{key:"triggerAction",value:function(){var s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).critical,d=void 0!==e&&e,e=this._util.moduleConfig,c=void 0===e?{}:e;return c.actionHost?this.getCrumb().then(function(e){if(!e)throw new Error("crumb not found");var t=c.actionHost,a=c.actionVersion,r=void 0===a?"v2":a,n=c.appId,o=c.experienceId,l=c.currentContainers,i=void 0===l?{}:l,a=c.propertyId,l=(l={},a=a,i={selectedContainer:o,containers:[v({id:o},s)],currentContainers:i},a in l?Object.defineProperty(l,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):l[a]=i,l),n=t+"api/"+r+"/preferences/declared/common?appId="+n;return d&&(n+="&criticalWrite=true&criticalWriteTimeout=1200"),m(n,{cache:0,clientHeaders:{Crumb:e},credentials:"include",method:"PUT",body:JSON.stringify(l)})}):Promise.resolve()}},{key:"getDropTargetConfig",value:function(e){var t=this._state.dropTargetElementConfigMap,a=t.get(e);if(!a)try{a=JSON.parse(e.getAttribute("data-wf-module-drop-target-config")),t.set(e,a)}catch(e){}return a}},{key:"getCrumb",value:function(){var e=this._util.moduleConfig,t=void 0===e?{}:e,e=t.crumb||g;if(e)return Promise.resolve(e);e=t.actionHost,t=t.appId;return m(e+"api/v1/auth/crumb?appId="+t,{cache:0,credentials:"include"}).then(function(e){if(!(g=e.crumb))throw new Error("crumb not found");return g})}},{key:"handleBodyDragover",value:function(e){var t,a,r=e.target;r.classList.contains(w)&&(e.preventDefault(),!this._state.proxyElem)&&(t=document.createElement("div"),e=(a=y(r.getElementsByClassName("wafer-module"))).length,t.style.pointerEvents="none",t.classList.add("wafer-module-drop-proxy"),this._state.proxyElem=t,e?(e=a[e-1],r.insertBefore(t,e.nextSibling)):r.insertBefore(t,r.children[0]))}},{key:"handleBodyDrop",value:function(e){var t=this._state.dragElem;if(t){var a=this._util.moduleConfig,r=void 0===a?{}:a,n=r.bodyErrorClass,o=r.moveAriaMessage,l=e.target;if(l.classList.contains(w)){var i=this._state,s=i.elementInstances,d=i.dropTargetElementConfigMap,a=(s.get(t)||{}).instance,r=d.get(l);if(!r)try{r=JSON.parse(l.getAttribute("data-wf-module-drop-target-config")),d.set(l,r)}catch(e){}i=y(l.getElementsByClassName("wafer-module")).filter(function(e){return e.getAttribute("draggable")}),s=i.length,d=void 0;s?(c=i[s-1],d=s,l.insertBefore(t,c.nextSibling)):l.insertBefore(t,l.children[d=0]);var c=a.config.config,l=v({},c,r),a=(0,(f||u()).getSnapshot)(l);this.triggerAction({packageData:a}).catch(function(e){C.classList.add(n),h.emitError({name:"WaferModule",elem:t,meta:{type:"actionFailed"},stack:e.stack})});c=c.name,r=r.name;c&&r&&o&&(d=o.replace("[NAME]",c).replace("[DROP_NAME]",r).replace("[DROP_ITEMS_COUNT]",s).replace("[RANK]",d+1),h.liveAriaRegion.innerHTML=d),h.emitWaferEvent("wafer:module:drop:complete",{elem:t,meta:{config:l}})}}}},{key:"handleDragLeave",value:function(e){var t=e.target,e=this._state.proxyElem;e&&t.classList.contains(w)&&(e.parentNode.removeChild(e),this._state.proxyElem=null)}},{key:"handleDragEnd",value:function(e){var t,a=this._state.proxyElem;a&&((t=a.parentNode)&&t.removeChild(a),this._state.proxyElem=null)}},{key:"destroy",value:function(e){n(A.prototype.__proto__||Object.getPrototypeOf(A.prototype),"destroy",this).call(this,e),e||(d(document.body,"dragover",this.handleBodyDragover,{passive:!1}),d(document.body,"drop",this.handleBodyDrop),d(document.body,"dragend",this.handleDragEnd,{passive:!1}),d(document.body,"dragleave",this.handleDragLeave,{passive:!1}))}}]),A);function A(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.root,a=void 0===t?document:t,r=e.selector,n=e.successClass,t=void 0===n?"wafer-module-complete":n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A);var e=c(document.getElementById("wafer-module-config")),m={};e.bodyErrorClass=e.bodyErrorClass||"wafer-module-error";var g=e.bodyErrorClass,n=e.modulesAdded,n=void 0===n?[]:n,d=e.moveAriaMessage;n.forEach(function(e){m[e]=!0});var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(A.__proto__||Object.getPrototypeOf(A)).call(this,{root:a,selector:r,props:{selector:r,successClass:t},WaferClass:(i||l()).default})),p=o;o._util=v({},o._util,{moduleConfig:e}),o._state=v({},o._state,{activeElem:null,dragElem:null,dropTargetElementConfigMap:new Map,idInstanceMapping:new Map,lastTargetIndex:0,modulesAddedMap:m,proxyElem:null}),o.handleBodyDragover=o.handleBodyDragover.bind(o),o.handleBodyDrop=o.handleBodyDrop.bind(o),o.handleDragEnd=o.handleDragEnd.bind(o),o.handleDragLeave=E(o.handleDragLeave.bind(o)),s(document.body,"dragover",o.handleBodyDragover,{passive:!1}),s(document.body,"drop",o.handleBodyDrop),s(document.body,"dragend",o.handleDragEnd,{passive:!1}),s(document.body,"dragleave",o.handleDragLeave,{passive:!1});e=e.enableSnapshotOnLoad,e=void 0===e||e;return(i||l()).default.prototype.addInstanceToIdMap=function(){var e=p._state.idInstanceMapping,t=this._util.id;e.has(t)||e.set(t,[]);var a=p._state.modulesAddedMap;e.get(t).push(this),a[t]&&e.get(t).forEach(function(e){e._destroyed||e._util.elem.classList.add(D)})},(i||l()).default.prototype.setDragElem=function(e){p._state.dragElem=e},(i||l()).default.prototype.getDragElem=function(){return p._state.dragElem},(i||l()).default.prototype.handleAdd=function(){var e=p._state.activeElem,t=!1;e||(t=!0,e=p.getActiveTarget());var a,r,n=_(e,"wafer-module"),o=_(e,w),l=this.config,i=l.config,s=l.id,d=this._util.elem;d.classList.contains(M)||(d.classList.add(M),e=o&&o.getElementsByClassName("wafer-module"),l=0,l=n?y(n.parentNode.children).indexOf(n):t||0===(a=e&&e.length||0)?0:a+1,o&&(a=p.getDropTargetConfig(o),(r=v({},i,a)).rank=l||0,this.focus(),p.handleInlineAddingModule(o,e,r.packageId||r.id||s,s,d,l,m,this).then(function(){var e=(0,(f||u()).getSnapshot)(r);p.triggerAction({packageData:e})}).catch(function(e){C.classList.add(g),d.classList.remove(M),h.emitError({name:"WaferModule",elem:d,meta:{type:"addModuleActionFailed"},stack:e.stack})})))},(i||l()).default.prototype.didDrag=function(){var t,e,a,r,n,o,l,i,s=p._state.dragElem;s&&(s.classList.remove("wafer-module-drag-in-progress"),(o=(p._state.elementInstances.get(s)||{}).instance)&&(t=this.config.elem,(n=_(t,w))&&(e=p.getDropTargetConfig(n),a=o.config.config,r=s.parentNode.children,i=y(r).indexOf(s),l=v({},a,e,{rank:i}),n=a.name,o=e.name,l=(0,(f||u()).getSnapshot)(l),n&&o&&d&&(i=d.replace("[NAME]",n).replace("[DROP_NAME]",o).replace("[DROP_ITEMS_COUNT]",r.length).replace("[RANK]",i+1),h.liveAriaRegion.innerHTML=i),this.focus(),p.triggerAction({packageData:l}).catch(function(e){C.classList.add(g),h.emitError({name:"WaferModule",elem:t,meta:{type:"dragdropModuleActionFailed"},stack:e.stack})}),h.emitWaferEvent("wafer:module:drop:complete",{elem:s,meta:{config:v({},a,e)}})),p._state.dragElem=null))},(i||l()).default.prototype.didRemove=function(e){var t=p._state.idInstanceMapping,a=this._util,r=a.config,n=a.elem,o=a.id;if(m[o]&&t.has(o))for(var l=p._state.activeElem,i=t.get(o),a=i.length,s=_(l,"wafer-module"),d=a-1;0<=d;d--){var c,u,f=i[d];f._destroyed?t.get(o).splice(d,1):(c=(u=f._util).elem,u.removeSelfOnDelete&&c!==e&&(s!==c||(p._state.activeElem=c.previousSibling,p._state.activeElem)||(u=c.parentNode.getElementsByClassName(b),p._state.activeElem=u[u.length-1]),h.destroy(c),f.destroy(),c.parentNode.removeChild(c),t.get(o).splice(d,1)),c.classList.remove(D))}m[o]=!1,p.triggerAction({removedPackages:[r.packageId||r.id||o]}).catch(function(e){C.classList.add(g),h.emitError({name:"WaferModule",elem:n,meta:{type:"removeModuleActionFailed"},stack:e.stack})}),r.removeMessage&&(h.liveAriaRegion.innerHTML=r.removeMessage),h.emitWaferEvent("wafer:module:deleted",{elem:n,meta:{config:{id:r.id||o}}})},(i||l()).default.prototype._handleMoveUp=function(){var e,t,a,r,n,o=this._util.elem,l=o.previousElementSibling;l&&(r=e=this.config.config,o.parentNode.insertBefore(o,l),t=(0,(f||u()).getSnapshot)(r),n=_(o,w),a=y(n.getElementsByClassName("wafer-module")).filter(function(e){return e.getAttribute("draggable")}),l=e.name,r=p.getDropTargetConfig(n).name,n=a.indexOf(o),l&&r&&d&&(n=d.replace("[NAME]",l).replace("[DROP_NAME]",r).replace("[DROP_ITEMS_COUNT]",a.length).replace("[RANK]",n+1),h.liveAriaRegion.innerHTML=n),this.focus(),p.triggerAction({packageData:t}).catch(function(e){C.classList.add(g),h.emitError({name:"WaferModule",elem:o,meta:{type:"moveUpFailed"},stack:e.stack})}),h.emitWaferEvent("wafer:module:moveup:complete",{elem:o,meta:{config:e}}))},(i||l()).default.prototype._handleMoveDown=function(){var t=this._util.elem,e=_(t,w),a=y(e.getElementsByClassName("wafer-module")).filter(function(e){return e.getAttribute("draggable")}),r=a.indexOf(t),n=this.config.config,o=n;t.parentNode.insertBefore(a[r+1],t);var l=(0,(f||u()).getSnapshot)(o),a=y(e.getElementsByClassName("wafer-module")),r=n.name,o=p.getDropTargetConfig(e).name,e=a.indexOf(t);r&&o&&d&&(e=d.replace("[NAME]",r).replace("[DROP_NAME]",o).replace("[DROP_ITEMS_COUNT]",a.length).replace("[RANK]",e+1),h.liveAriaRegion.innerHTML=e),this.focus(),p.triggerAction({packageData:l}).catch(function(e){C.classList.add(g),h.emitError({name:"WaferModule",elem:t,meta:{type:"moveDownFailed"},stack:e.stack})}),h.emitWaferEvent("wafer:module:movedown:complete",{elem:t,meta:{config:n}})},(i||l()).default.prototype._handleMoveToColumn=function(e){var t=e.target,a=this._util.elem,r=this.config.config,n=r,o=t.getAttribute("data-index"),o=parseInt(o,10)||1,l=document.getElementsByClassName(w)[o-1],e=l.getElementsByClassName("wafer-module")[0]||l.children[0];e&&l.insertBefore(a,e);t=(0,(f||u()).getSnapshot)(n),o=_(a,w),l=y(o.getElementsByClassName("wafer-module")).filter(function(e){return e.getAttribute("draggable")}),e=r.name,n=p.getDropTargetConfig(o).name,o=l.indexOf(a);e&&n&&d&&(o=d.replace("[NAME]",e).replace("[DROP_NAME]",n).replace("[DROP_ITEMS_COUNT]",l.length).replace("[RANK]",o+1),h.liveAriaRegion.innerHTML=o),this.focus(),p.triggerAction({packageData:t}).catch(function(e){C.classList.add(g),h.emitError({name:"WaferModule",elem:a,meta:{type:"moveUpFailed"},stack:e.stack})}),h.emitWaferEvent("wafer:module:moveacrosscolumns:complete",{elem:a,meta:{config:r}})},o.sync(),e&&setTimeout(function(){var e=(0,(f||u()).getSnapshot)();e.length&&o.triggerAction({packageData:e}).catch(function(e){})},100),o}function p(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.default=r,e.exports=t.default},"./src/entry.js":function(e,t,a){"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=new(r||(n=a("./src/controller.js"),r=n&&n.__esModule?n:{default:n})).default({selector:"wafer-module"}),e.exports=t.default},"./src/utils.js":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=window.wafer.utils,l=r.convertNodeListToArray,i=r.getWaferInstanceForElem,s={},n=l(document.getElementsByClassName("wafer-module-drop-target")).map(function(e){var t=e.getAttribute("data-wf-module-drop-target-config");try{t=JSON.parse(t)}catch(e){}return{elem:e,regionId:(t=t||{}).regionId}});t.getSnapshot=function(){var o=[],e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).packageId;return e&&(s[e]=!0),n.forEach(function(e){var t=e.elem,n=e.regionId;l(t.getElementsByClassName("wafer-module")).forEach(function(e,t){var a=i(e,"wafer-module").instance,r=((void 0===a?{}:a).config||{}).config,e=r||{},a=e.id,e=e.pin;(r=(r=(r||{}).packageId)||a)&&o.push({id:r,pin:s[r]||void 0!==e&&e,rank:t,regionId:n})})}),o}}},n={},r.m=a,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="https://s.yimg.com/aaq/wf/",r(r.s="./src/entry.js");function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return a[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var a,n});
