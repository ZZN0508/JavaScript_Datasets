var COMSCORE;void 0===(COMSCORE=void 0===COMSCORE?{}:COMSCORE).SiteRecruit&&(COMSCORE.SiteRecruit={sv:"scor",testUrl:"broker-test.js",configUrl:"broker-config.js",builderUrl:"builder.js",CONSTANTS:{STATE_NAME:{IDLE:"IDLE",DDINPROGRESS:"DDINPROGRESS"}}},COMSCORE.SiteRecruit.Utils=function(){var r=COMSCORE.SiteRecruit;return{location:document.location.toString(),referrer:document.referrer.toString(),loadScript:function(e,t){t&&!r.allowScriptCaching&&(e=r.Utils.appendQueryParams(e,(new Date).getTime()));t=document.createElement("script");t.src=e,document.body.appendChild(t)},cleanURL:function(e){var t=e.split("?");if(1<t.length){var r="?";if(/([^.@\s]+)(\.[^.@\s]+)*@([^.@\s]+\.)+([^.@\s]+)|%40/i.test(t[1])){var o=t[1].split("&");for(i=0;i<o.length;i++)/([^.@\s]+)(\.[^.@\s]+)*@([^.@\s]+\.)+([^.@\s]+)|%40/i.test(o[i])||(r+=0==i?o[i]:"&"+o[i]);e=1<r.length?t[0]+r:t[0]}}return e},getDevice:function(e,t){var i=new RegExp(e,"i"),r=navigator.userAgent,o=new RegExp(t,"i"),e=self.screen.availWidth,t={};return i.test(r)?(t.type=2,770<=e&&!o.test(r)&&(t.type=3)):t.type=1,t},fireBeacon:function(e){setTimeout(function(){-1==e.indexOf("?")?e+=(/\?/.test(e)?"&":"?")+(new Date).getTime():e+="&"+(new Date).getTime(),(new Image).src=e},1)},appendQueryParams:function(e,t){return e?(e=e.replace("?","")+"?",t&&(e+=t.toString().replace("?","")),e):t},getRandom:function(e){function t(e,t,i,r,o){e=t*(e-(e=Math.floor(e/i))*i)-e*r;return Math.round(e<0?e+o:e)}for(var i=2147483563,r=40014,o=53668,n=12211,s=u=2147483647&Math.round((new Date).getTime()%1e5),a=[32],c=0;c<19;c++)s=t(s,r,o,n,i);for(c=0;c<32;c++)s=t(s,r,o,n,i),a[31-c]=s;var s=t(s,r,o,n,i),u=t(u,40692,52774,3791,2147483399),u=Math.round((a[Math.floor(a[0]/67108862)]+u)%i),u=Math.floor(u/(i/(1e9+1)))/1e9;return void 0===e?u:Math.floor(u*(e+1))},getExecutingPath:function(e){for(var t=document.getElementsByTagName("script"),i=t.length-1;0<=i;i--){var r=t[i].src;if(-1!=(this.scriptUrl=r).indexOf("/"+e))return r.replace(/(.*)(\/.*)$/,"$1/")}},JSONDeserialize:function(e){return JSON.parse(e)},JSONSerialize:function(e){return JSON.stringify(e)}}}(),COMSCORE.SiteRecruit.Utils.UserPersistence={CONSTANTS:{STATE_NAME:{IDLE:"IDLE",DDINPROGRESS:"DDINPROGRESS"}},getCookieName:function(){var e;return COMSCORE.SiteRecruit.Broker&&COMSCORE.SiteRecruit.Broker.config&&(e=COMSCORE.SiteRecruit.Broker.config.cookie).name?e.name:""},getDefaultCookieOptions:function(){return{cookiename:"msresearch",path:"/",domain:".microsoft.com",duration:90}},getJSONCookieString:function(){var e=this.getDefaultCookieOptions().cookiename,e=this.getCookieValue(e).toString();return e=/\:undefined/i.test(e)?e.replace(/\:undefined/g,':"undefined"'):e},getUserId:function(){var e="",t=this.getJSONCookieString();return e=0!=t&&/userid/i.test(t)?JSON.parse(t).userid:e},isWithinExcludePeriod:function(){var e=this.getDefaultCookieOptions().cookiename,e=this.getCookieValue(e).toString();return!!/IDLE/i.test(e)},updateOldCookie:function(){var e,t=COMSCORE.SiteRecruit,i=this.getJSONCookieString();!1!==i&&/lastinvited/i.test(i)&&(e=(new Date).getTime(),i=parseInt(JSON.parse(i).lastinvited),e=90-Math.round((e-i)/1e3/60/60/24),isNaN(e)||(i=this.getUserId(),t.Utils.UserPersistence.removeCookie(t.Utils.UserPersistence.getDefaultCookieOptions().cookiename,t.Utils.UserPersistence.getDefaultCookieOptions().domain),0<e&&t.Utils.UserPersistence.setIdleAlreadyAskedCookie(e,i)))},setIdleAlreadyAskedCookie:function(e,t){var i={},i=this.getDefaultCookieOptions();inputcookiename=i.cookiename,i.cookieoptions||(i.cookieoptions=this.getDefaultCookieOptions());var r={state:{}};r.state.name=this.CONSTANTS.STATE_NAME.IDLE,t=t||this.getUserId(),r.userid=t;r=COMSCORE.SiteRecruit.Utils.JSONSerialize(r);i.cookieoptions.duration=e||90,this.createCookie(inputcookiename,r,i.cookieoptions)},createCookie:function(e,t,i){var r;return t=escape(t),i.duration&&0<i.duration?((r=new Date).setTime(r.getTime()+24*i.duration*60*60*1e3),t+="; expires="+r.toGMTString()):/msie|rv\:11|edge/i.test(navigator.userAgent)||(t+="; expires="),i.path&&(t+="; path="+i.path),i.domain&&(t+="; domain="+i.domain),t+="; secure",i.graceperiod&&(t+="; graceperiod="+i.graceperiod),t+="; SameSite=Strict",document.cookie=e+"="+t,!0},removeCookie:function(e,t){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain="+t},getCookieValue:function(e){e=document.cookie.match("(?:^|;)\\s*"+e+"=([^;]*)");return!!e&&unescape(e[1])},createUserObj:function(e){var t=new Date,i=e.url,r=this.CONSTANTS.STATE_NAME.IDLE;e.statename&&(r=e.statename);var o=t.getTime();e.timestamp&&(o=e.timestamp);var n=this.getCookieName();e.cookiename&&(n=e.cookiename),e.cookieoptions||(e.cookieoptions=this.getDefaultCookieOptions());var s={state:{}};s.state.name=r,"IDLE"!==s.state.name&&(s.state.timestamp=o,s.state.url="undefined"==i?"":i,s.graceperiod=5),s.userid=t.getTime().toString()+Math.floor(1e16*Math.random()).toString();t=COMSCORE.SiteRecruit.Utils.JSONSerialize(s);return this.createCookie(n,t,e.cookieoptions),s},setUserObj:function(e){var t,i,r,o,n,s=(s=this.getUserObj(e))||this.createUserObj(e);new Date,r=0,o=this.getCookieName(),n=5,a=0,i=this.CONSTANTS.STATE_NAME.IDLE,e.url?t=e.url:s.state.url&&(t=s.state.url),e.statename?i=e.statename:s.state&&s.state.name&&(i=s.state.name),e.timestamp?r=e.timestamp:s.state&&s.state.timestamp&&(r=s.state.timestamp),e.cookiename&&(o=e.cookiename),e.cookieoptions||(e.cookieoptions=this.getDefaultCookieOptions()),e.graceperiod?n=e.graceperiod:s.graceperiod&&(n=s.graceperiod),e.trackertimestamp?a=e.trackertimestamp:s.trackertimestamp&&(a=s.trackertimestamp),i&&(s.state.name=i,s.state.url=t,i!==this.CONSTANTS.STATE_NAME.IDLE?(s.state.timestamp=r,s.graceperiod=n,s.trackertimestamp=a):(delete s.state.timestamp,delete s.gracePeriod,delete s.trackertimestamp));var a=COMSCORE.SiteRecruit.Utils.JSONSerialize(s);return this.createCookie(o,a,e.cookieoptions),s},getUserObj:function(e){var t=this.getCookieName();e.cookiename&&(t=e.cookiename);t=this.getCookieValue(t);if(t&&""!==t){t=COMSCORE.SiteRecruit.Utils.JSONDeserialize(t);if(t)return t}return null}},COMSCORE.SiteRecruit.DDKeepAlive=function(){var n,r=COMSCORE.SiteRecruit,s=r.Utils,o=s.UserPersistence;return{start:function(){var e=this;n=setInterval(function(){r.Broker.isDDInProgress()&&e.isTrackerPageOpen()?e.setDDTrackerCookie():(e.isTrackerPageOpen()||e.handleClosedTrackerPage(),e.stop())},1e3)},stop:function(){clearInterval(n),!1!==o.getCookieValue(r.Broker.config.cookie.name)&&o.setIdleAlreadyAskedCookie(90)},isTrackerPageOpen:function(){var e={};e.cookiename=COMSCORE.SiteRecruit.Broker.config.cookie.name;var t=s.UserPersistence.getUserObj(e),i=(new Date).getTime(),e=!0;return t&&t.state&&t.state.name==r.CONSTANTS.STATE_NAME.DDINPROGRESS&&t.state.timestamp&&t.trackertimestamp&&(i=i-t.trackertimestamp,(t=COMSCORE.SiteRecruit.Builder&&COMSCORE.SiteRecruit.Builder.invitation&&COMSCORE.SiteRecruit.Builder.invitation.config?COMSCORE.SiteRecruit.Builder.invitation.config.trackerGracePeriod:t.gracePeriod||1!=COMSCORE.SiteRecruit.Utils.UserPersistence.getCookieValue("graceIncr")&&!COMSCORE.SiteRecruit.Utils.UserPersistence.getCookieValue("cddsinprogress")&&8)&&1!=COMSCORE.SiteRecruit.Utils.UserPersistence.getCookieValue("graceIncr")&&(i<2*parseInt(t)*1e3||(e=!1))),e},handleClosedTrackerPage:function(){this.stop()},setDDTrackerCookie:function(){var e=r.Broker.config.cookie,t={};t.cookiename=e.name,t.cookieoptions={path:e.path,domain:e.domain,duration:e.duration};var i=o.getUserObj(t);!1===document.hidden||void 0===document.hidden?t.url=encodeURIComponent(s.location):t.url=o.getUserObj(e.name).state.url,t.statename=r.CONSTANTS.STATE_NAME.DDINPROGRESS,t.timestamp=(new Date).getTime(),r.Builder&&r.Builder.invitation&&r.Builder.invitation.config?(t.pid=r.Builder.invitation.config.projectId,t.graceperiod=r.Builder.invitation.config.trackerGracePeriod):i&&i.gracePeriod&&(t.graceperiod=i.graceperiod),s.UserPersistence.setUserObj(t)},mDDKeepAlive:function(){n=setInterval(function(){var e,t,i=0;null!=sessionStorage.locationList&&(e=sessionStorage.locationList),null!=sessionStorage.timeList&&(t=sessionStorage.timeList);var r,o=escape(s.cleanURL(window.location.toString()));/\,/.test(e)?(r=e.split(","))[r.length-1]!=o&&(e+=","+o,t+=","+(new Date).getTime(),i=1):o!=e&&(e+=","+o,t+=","+(new Date).getTime(),i=1),1==i&&(sessionStorage.locationList=e,sessionStorage.timeList=t),0==COMSCORE.SiteRecruit.Utils.UserPersistence.getCookieValue("mDDS")&&(clearInterval(n),null!=sessionStorage.locationList&&sessionStorage.removeItem("locationList"),null!=sessionStorage.timeList&&sessionStorage.removeItem("timeList"),null!=sessionStorage.locationList&&sessionStorage.removeItem("csLocation"),null!=sessionStorage.timeList&&sessionStorage.removeItem("csReferrer"))},3e3)}}}(),COMSCORE.SiteRecruit.PagemapFinder=function(){var u,n=COMSCORE.SiteRecruit.Utils;return{getTotalFreq:function(){return u},find:function(e){var t=window.location.toString();/cs\_tstMode\=(.+)/i.test(t)&&/([^\#+]*)/.test(t)&&(t=RegExp.$1);for(var i=e,r=[],o=!1,n=u=0;i&&n<i.length;n++){var s=!1,a=i[n];if(a){var c=new RegExp(a.m,"i");if(-1!=t.search(c)&&(c=i[n].prereqs,s=!0,a.d&&(new RegExp(COMSCORE.SiteRecruit.device.type).test(a.d)||"0"===a.d||(s=!1)),c&&(this.isMatchContent(c.content)||(s=!1),this.isMatchCookie(c.cookie)||(s=!1),this.isMatchLanguage(c.language)||(s=!1))),s){if(a.halt){o=!0;break}r.push(a),u=a.f}}}return!0===o?(u=0,null):this.choosePriority(r)},choosePriority:function(e){for(var t=null,i=0;i<e.length;i++)(null===t||t.p<e[i].p)&&(t=e[i],u=e[i].f);return t},isMatchContent:function(e){for(var t=!0,i=0;t&&i<e.length;){var r=!1,o=!1,n=e[i];if(n.element)for(var s=document.getElementsByTagName(n.element),a=0;a<s.length;a++){var c,u=new RegExp(n.elementValue,"i");u?u.test(s[a].innerHTML)&&(r=!0):r=!0,n.attrib&&n.attrib.length?(c=s[a].attributes.getNamedItem(n.attrib),u=new RegExp(n.attribValue),!c||n.attribValue&&n.attribValue.length&&!u.test(c.value)||(o=!0)):o=!0}r&&o||(t=!1),i++}return t},isMatchCookie:function(e){for(var t=!0,i=0;t&&i<e.length;){var r,o=e[i],o=(n.UserPersistence.getCookieValue(o.name),e[i]);if(!(r=n.UserPersistence.getCookieValue(o.name))||null===r)return!1;t=new RegExp(o.value,"i").test(r),i++}return t},isMatchLanguage:function(e){var t=(t=navigator.language||navigator.userLanguage).toLowerCase();return!e||!!new RegExp(e).test(t)}}}(),COMSCORE.SiteRecruit.Broker=function(){var r=COMSCORE.SiteRecruit,o=r.Utils;return{init:function(){o.location=o.cleanURL(o.location),o.referrer=o.cleanURL(o.referrer),r.executingPath=o.getExecutingPath("broker.js"),o.UserPersistence.updateOldCookie(),_isMsResearchIdle=o.UserPersistence.isWithinExcludePeriod(),/cs\_tstMode/i.test(window.location)&&o.loadScript("https://www.microsoft.com/library/svy/"+r.testUrl,!1);var e=o.UserPersistence.getCookieValue("cddsinprogress"),t=o.UserPersistence.getCookieValue("mDDS"),i=/cs\_tstMode/i.test(window.location)||/cs_tstMode/i.test(document.cookie);_isMsResearchIdle&&!e&&!t&&!i&&o.UserPersistence.getCookieValue("msresearch")||o.loadScript(r.executingPath+r.configUrl,!0);i=unescape(o.UserPersistence.getCookieValue("msresearch"));/ddinprogress/i.test(i)&&COMSCORE.isDDInProgress()&&((i=COMSCORE.SiteRecruit.Utils.JSONDeserialize(i))&&i.trackertimestamp&&(900<((new Date).getTime()-i.trackertimestamp)/1e3||!COMSCORE.SiteRecruit.DDKeepAlive.isTrackerPageOpen())&&COMSCORE.SiteRecruit.DDKeepAlive.handleClosedTrackerPage())},start:function(){this.init()},run:function(){r.device=o.getDevice(COMSCORE.SiteRecruit.Broker.config.mobile.match,COMSCORE.SiteRecruit.Broker.config.mobile.largePhones),COMSCORE.SiteRecruit.Broker.config.mTracker;var e=COMSCORE.SiteRecruit.Utils.UserPersistence.getCookieValue("mDDS");if(/^1/.test(e)&&/pid=(p\d+)\,site\=(\d+)/.test(e)&&(o.loadScript(r.executingPath+"inv_mdds_"+RegExp.$1+"_"+RegExp.$2+".js",!0),COMSCORE.SiteRecruit.DDKeepAlive.mDDKeepAlive()),this.config.Events.beforeRecruit(),this.config.mobile){var t=new RegExp(this.config.mobile.match,"i");if(!0===this.config.mobile.halt&&t.test(navigator.userAgent))return}if(r.sv===this.config.sv){var e=this.config.testMode,t=!1!==o.UserPersistence.getCookieValue("tstMode"),t=e||t;if(this.isDDInProgress())this.processDDInProgress();else{if(!e||this.isDDInProgress()){e={};e.cookiename=this.config.cookie.name;e=o.UserPersistence.getUserObj(e);if(e&&"IDLE"==e.state.name)return}!this.findPageMapping()||COMSCORE.SiteRecruit._halt&&!0===COMSCORE.SiteRecruit._halt||(t?this.pagemap&&this.loadBuilder():o.getRandom()<=r.PagemapFinder.getTotalFreq()&&this.pagemap&&this.loadBuilder())}}},mDDSbuildLayer:function(e,t,i,r,o){COMSCORE.SiteRecruit.Utils;var n=document.createElement("div");n.id=r;var s=n;s.innerHTML=e;r=this.mDDSgetPageWidth(2),n=this.mDDSgetPageHeight(2),e=s.style;e.position="fixed",e.zIndex=1999999999999,e.left=r,e.top=n,e.marginLeft=-1*t+"px",e.marginTop=-1*i+"px",e.visibility=1==o?"visible":"hidden",document.body.appendChild(s)},mDDSdestroyLayer:function(e){var t=document.getElementById(e);t.style.visibility="hidden";try{t.parentNode.removeChild(t)}catch(e){}},mDDSshowLayer:function(e){document.getElementById(e).style.visibility="visible"},mDDSlaunchSurvey:function(){var e=COMSCORE.SiteRecruit.mobile.tracker;/pid=(p\d+)\,site\=(\d+),frequency\=(.+)/.test(o.UserPersistence.getCookieValue("mDDS"))&&(e.f=RegExp.$3);var t=o.UserPersistence.getUserObj("msresearch");o.UserPersistence.removeCookie("mDDS",".microsoft.com"),null!=sessionStorage.locationList?e.acceptParams.raw+="&locationList="+sessionStorage.locationList+","+encodeURIComponent(window.location.toString())+"&timeList="+sessionStorage.timeList+","+(new Date).getTime()+"&location="+sessionStorage.csLocation+"&referrer="+sessionStorage.csReferrer:e.acceptParams.raw+="&locationList=NOTSUPPORTED&timeList=NOTSUPPORTED&location=NOTSUPPORTED&referrer=NOTSUPPORTED",null!=sessionStorage.removeItem("locationList")&&sessionStorage.removeItem("locationList"),null!=sessionStorage.removeItem("timeList")&&sessionStorage.removeItem("timeList"),null!=sessionStorage.removeItem("csLocation")&&sessionStorage.removeItem("csLocation"),null!=sessionStorage.removeItem("csReferrer")&&sessionStorage.removeItem("csReferrer"),e.beforeSubmit(),window.open(e.acceptUrl+"?"+e.acceptParams.raw+"&site="+e.acceptParams.siteCode+"&projectId="+e.projectId+"&SRmethodology="+e.methodology+"&weight="+e.weight+"&device="+COMSCORE.SiteRecruit.device.type+"&sv=scor&frequency="+e.f+"&userid="+t.userid)},mDDStrackerSwap:function(e){1==e?(this.mDDSdestroyLayer("csMenu"),this.mDDSlaunchSurvey()):(this.mDDSdestroyLayer("csTrack"),this.mDDSshowLayer("csMenu"))},mDDSgetPageWidth:function(e){switch(e){case 0:return"0%";case 1:return"50%";case 2:return"100%";default:return"0%"}},mDDSgetPageHeight:function(e){switch(e){case 0:return"0%";case 1:return"50%";case 2:return"100%";default:return"0%"}},isDDInProgress:function(){var e=!1,t={};t.cookiename=COMSCORE.SiteRecruit.Utils.UserPersistence.getDefaultCookieOptions().cookiename;t=o.UserPersistence.getUserObj(t);return e=t&&t.state.name==r.CONSTANTS.STATE_NAME.DDINPROGRESS?!0:e},processDDInProgress:function(){r.DDKeepAlive.start()},findPageMapping:function(){return this.pagemap=r.PagemapFinder.find(this.config.mapping),this.pagemap},loadBuilder:function(){var e=r.executingPath+r.builderUrl;o.loadScript(e)}}}(),COMSCORE.isDDInProgress=COMSCORE.SiteRecruit.Broker.isDDInProgress,COMSCORE.SiteRecruit.OnReady=function(){var r=COMSCORE.SiteRecruit;return{onload:function(){r.OnReady.done||(r.OnReady.done=!0,r.Broker.start(),r.OnReady.timer&&clearInterval(r.OnReady.timer),document.addEventListener&&document.removeEventListener("DOMContentLoaded",r.OnReady.onload,!1))},listen:function(){var e="."+(e=document.domain.split("."))[e.length-2]+"."+e[e.length-1],t="msresearch",i=COMSCORE.SiteRecruit.Utils.UserPersistence.getCookieValue(t);/DDINPROGRESS/i.test(i)&&(COMSCORE.SiteRecruit.Broker.config={cookie:{name:t,path:"/",domain:e,duration:90,rapidDuration:0,expireDate:""}},COMSCORE.SiteRecruit.Broker.processDDInProgress());t="",e=(e=document.domain.split("."))[e.length-2]+"."+e[e.length-1],e=new RegExp(e,"i");if(""===(t=""!==document.referrer?document.referrer:t)||void 0===t||e.test(t)?r.Broker.delayConfig=!1:r.Broker.delayConfig=!0,document.addEventListener&&(/loading|uninitialized/i.test(document.readyState)?document.addEventListener("DOMContentLoaded",r.OnReady.onload,!1):r.OnReady.onload()),window.ActiveXObject)COMSCORE.SiteRecruit.OnReady.waitForLoad=setInterval(function(){try{document.documentElement.doScroll("left")}catch(e){return}COMSCORE.SiteRecruit.OnReady.waitForLoad=clearInterval(COMSCORE.SiteRecruit.OnReady.waitForLoad),COMSCORE.SiteRecruit.OnReady.onload()},1e3);else if(window.addEventListener)window.addEventListener("load",r.OnReady.onload,!1);else if(window.attachEvent)return window.attachEvent("onload",r.OnReady.onload)},f:[],done:!1,timer:null}}(),COMSCORE.SiteRecruit.OnReady.listen());
