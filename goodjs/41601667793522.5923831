YUI.add("group-pool-by-tag-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.Models["group-pool-models"],{name:this.name,attributes:{tagFilter:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:null}}})},"@VERSION@",{requires:["attribute-helpers"]}),YUI.add("flickr-groups-pools-getPhotos-fetcher",function(a,s){"use strict";a.namespace("ListFetchers")["flickr-groups-pools-getPhotos"]={run:function(o,e){var t=this,r=this._processParams(o),r={apiResponse:e.callAPI("flickr.groups.pools.getPhotos",r,!0),photoModelRegistry:e.getModelRegistry("photo-models"),personModelRegistry:e.getModelRegistry("person-models"),groupPoolModelRegistry:e.getModelRegistry("group-pool-models"),photoEngagementModelRegistry:e.getModelRegistry("photo-engagement-models"),photoStatsModelRegistry:e.getModelRegistry("photo-stats-models"),groupModelRegistry:e.getModelRegistry("group-models")};return o.personFilter&&(r.groupPoolByPersonModelRegistry=e.getModelRegistry("group-pool-by-person-models")),o.tagFilter&&(r.groupPoolByTagModelRegistry=e.getModelRegistry("group-pool-by-tag-models")),new a.FlickrPromise(r).then(function(e){return t._processResponse(e,o)},a.FetcherErrorLogger(s))},_processParams:function(e){var o={extras:a.APIHelper.request.getRebootPhotoExtras()+","+a.APIHelper.request.getRebootGroupExtras(),per_page:e.perPage||20,page:e.page||1,get_group_info:1};if(e.id)o.group_id=a.Models["group-pool-models"].extractGroupFromCompoundId(e.id);else{if(!e.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");o.group_path_alias=e.pathAlias}return e.withPhotoId&&(o.jump_to=e.withPhotoId),e.privacyFilter&&(o.privacy_filter=e.privacyFilter),e.safeSearch&&(o.safe_search=e.safeSearch),e.media&&(o.media=e.media),e.personFilter&&(o.user_id=e.personFilter),e.tagFilter&&(o.tags=e.tagFilter),o},_processResponse:function(e,o){var t=e.apiResponse,r=e.photoModelRegistry,s=e.personModelRegistry,i=e.groupPoolModelRegistry,l=e.groupPoolByPersonModelRegistry,n=e.groupPoolByTagModelRegistry,u=e.photoEngagementModelRegistry,p=e.photoStatsModelRegistry,d=e.groupModelRegistry;return t.group.pathAlias=""===t.group.pathalias?null:t.group.pathalias,e=d.parseGroupModel(t.group.nsid,t.group.pathAlias,t.group),d.addOrUpdate(e),e={pathAlias:t.group.pathAlias,group:d.proxy(e.id),filteredPoolCount:t.group.poolCount},p=a.APIHelper.response.parsePhotos({photos:t.photos.photo,personModelRegistry:s,photoModelRegistry:r,photoEngagementModelRegistry:u,photoStatsModelRegistry:p}),e.photoPageList={perPage:t.photos.perpage,page:t.photos.page,pageContent:p,totalItems:e.filteredPoolCount},(i=o.personFilter?(e.id=a.Models["group-pool-models"].buildCompoundId(t.group.nsid,o.personFilter),e.personFilter=o.personFilter,e.filteredPoolCount=e.photoPageList.totalItems=t.photos.total,l):o.tagFilter?(e.id=a.Models["group-pool-models"].buildCompoundId(t.group.nsid,o.tagFilter),e.tagFilter=o.tagFilter,e.filteredPoolCount=e.photoPageList.totalItems=t.photos.total,n):(o.id&&o.id!==t.group.nsid?e.id=o.id:e.id=t.group.nsid,i)).exists(e.id)?(i.setValue(e.id,"photoPageList",e.photoPageList),i.setValue(e.id,"group",e.group),i.setValue(e.id,"pathAlias",e.pathAlias),i.setValue(e.id,"filteredPoolCount",parseInt(e.filteredPoolCount,10)||0),e.group.setValue("poolCount",parseInt(t.group.poolCount,10)||0)):i.add(e),p}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","photo-engagement-models","photo-stats-models","group-models","group-pool-models","group-pool-by-person-models","group-pool-by-tag-models"]}),YUI.add("flickr-groups-admin-acceptPhoto-updater",function(n,u){"use strict";n.namespace("ModelUpdaters")["flickr-groups-admin-acceptPhoto"]={run:function(o,t){var e,r,s=this,i=o.registryName||"group-pool-models",l=[];return o.photoID?o.photoIds=[o.photoID]:o.photoIds="string"==typeof o.photoIds?[o.photoIds]:o.photoIds,e=this._processParams(o),r={apiResponse:t.callAPI("flickr.groups.admin.acceptPhoto",e),groupPoolModel:t.getModel(i,o.groupID),photoGroupsModelRegistry:t.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:t.getModelRegistry("photo-contexts-models"),pendingModelRegistry:t.getModelRegistry("photo-group-pending-models"),pendingsModelRegistry:t.getModelRegistry("photo-group-pendings-models"),adminPendingModelRegistry:t.getModelRegistry("group-admin-pending-models")},o.photoIds.forEach(function(e){l.push(t.getModel("photo-models",e))}),r.photoModels=n.Promise.all(l),o.unfilteredGroupId=e.group_id,"group-pool-models"!==i&&(r.unfilteredGroupPoolModel=t.getModel("group-pool-models",o.unfilteredGroupId)),new n.FlickrPromise(r).then(function(e){return s._processResponse(e,o)},n.FetcherErrorLogger(u))},_processParams:function(e){return{photo_id:e.photoIds.join(","),group_id:n.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(e,o){var t,r=e.apiResponse,s=e.groupPoolModel,i=e.photoModels,l=e.photoGroupsModelRegistry,n=e.photoContextsModelRegistry,u=e.unfilteredGroupPoolModel,p=e.pendingModelRegistry,d=e.pendingsModelRegistry,a=e.adminPendingModelRegistry;if("ok"===r.stat)return i.forEach(function(e){s&&!s.hasPhoto(e.getValue("id"))&&s.acceptPhotoLocal(e),u&&!u.hasPhoto(e.getValue("id"))&&u.acceptPhotoLocal(e),l.exists(e.id)&&!l.getValue(e.id,"groups").getFromListByID(o.unfilteredGroupId)&&(l.getValue(e.id,"groups").unshift(s),l.setValue(e.id,"total",l.getValue(e.id,"total")+1)),n.exists(e.id)&&!n.getValue(e.id,"contexts").getFromListByID(o.unfilteredGroupId)&&(n.setValue(e.id,"totalGroups",n.getValue(e.id,"totalGroups")+1),n.getValue(e.id,"contexts").push(s)),t=[e.id,o.unfilteredGroupId].join("-"),d.exists(e.id)&&d.getValue(e.id,"pendings").getFromListByID(t)&&(d.setValue(e.id,"total",d.getValue(e.id,"total")-1),d.getValue(e.id,"pendings").removeFromList(t)),p.remove(t),a.exists(o.groupID)&&a.removePhotoLocal(o.groupID,e.id)}),s}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]}),YUI.add("flickr-groups-admin-declinePhoto-deletor",function(n,u){"use strict";n.namespace("ModelDeletors")["flickr-groups-admin-declinePhoto"]={run:function(o,t){var e,r,s=this,i=o.registryName||"group-pool-models",l=[];return o.photoID?o.photoIds=[o.photoID]:o.photoIds="string"==typeof o.photoIds?[o.photoIds]:o.photoIds,e=this._processParams(o),r={apiResponse:t.callAPI("flickr.groups.admin.declinePhoto",e),groupPoolModel:t.getModel(i,o.groupID),photoGroupsModelRegistry:t.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:t.getModelRegistry("photo-contexts-models"),adminPendingModelRegistry:t.getModelRegistry("group-admin-pending-models")},o.photoIds.forEach(function(e){l.push(t.getModel("photo-models",e))}),r.photoModels=n.Promise.all(l),o.unfilteredGroupId=e.group_id,"group-pool-models"!==i&&(r.unfilteredGroupPoolModel=t.getModel("group-pool-models",o.unfilteredGroupId)),new n.FlickrPromise(r).then(function(e){return s._processResponse(e,o)},n.FetcherErrorLogger(u))},_processParams:function(e){return{photo_id:e.photoIds.join(","),group_id:n.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(e,o){var t=e.apiResponse,r=e.groupPoolModel,s=e.photoModels,i=e.photoGroupsModelRegistry,l=e.photoContextsModelRegistry,n=e.unfilteredGroupPoolModel,u=e.adminPendingModelRegistry;if("ok"===t.stat)return s.forEach(function(e){l.exists(e.id)&&l.getValue(e.id,"contexts").getFromListByID(o.unfilteredGroupId)&&(l.setValue(e.id,"totalGroups",l.getValue(e.id,"totalGroups")-1),l.getValue(e.id,"contexts").removeFromList(o.unfilteredGroupId)),i.exists(e.id)&&i.getValue(e.id,"groups").getFromListByID(o.unfilteredGroupId)&&(i.setValue(e.id,"total",i.getValue(e.id,"total")-1),i.getValue(e.id,"groups").removeFromList(o.unfilteredGroupId)),u.exists(o.groupID)&&u.removePhotoLocal(o.groupID,e.id),r&&r.declinePhotoLocal(e),n&&n.declinePhotoLocal(e)}),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]}),YUI.add("group-contributor-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{name:this.name,attributes:{nsid:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},dateJoined:{validator:function(e){return t.AttributeHelpers.validateDate(e)},setter:function(e){return t.AttributeHelpers.coerceDate(e)},serialize:function(e){return e.format("X")},deserialize:function(e){return t.moment(e,"X")}},groupDiscussionCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},groupPhotoCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},pathAlias:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},rank:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},realname:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},username:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoId:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoTitle:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},buddyicon:{},latestPhotoUrl:{readOnly:!0,derivedBy:["contributorUrl","latestPhotoId"],getter:function(e,o){return!!this.getValue(o,"latestPhotoId")&&this.getValue(o,"contributorUrl")+this.getValue(o,"latestPhotoId")+"/"}},displayname:{readOnly:!0,derivedBy:["username"],getter:function(e,o){return this.getValue(o,"username")}},contributorUrl:{readOnly:!0,derivedBy:["id","pathAlias"],getter:function(e,o){return"/photos/"+(this.getValue(o,"pathAlias")||this.getValue(o,"nsid"))+"/"}},isPro:{defaultValue:!1,setter:function(e){return t.AttributeHelpers.coerceBoolean(e)}},proBadge:{defaultValue:"standard",setter:function(e){return t.AttributeHelpers.coerceString(e)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","attribute-helpers"]}),YUI.add("flickr-groups-getTopContributors-fetcher",function(r,s){"use strict";function u(e,o,t){t={id:o+"-"+e.id+"-"+t,nsid:e.id,dateJoined:e.dateJoined?r.moment(e.dateJoined.toString(),"X"):r.moment(),groupDiscussionCount:e.groupDiscussionCount,groupPhotoCount:e.groupPhotoCount,pathAlias:e.pathAlias,rank:e.rank,realname:e.realname,username:e.username,isPro:e.isPro,proBadge:e.proBadge,buddyicon:e.iconurls};return e.latestPhoto&&(t.latestPhotoId=e.latestPhoto.id,t.latestPhotoTitle=e.latestPhoto.name),t}r.namespace("ModelFetchers")["flickr-groups-getTopContributors"]={run:function(o,e){var t=this;return r.Promise.all([e.callAPI("flickr.groups.getTopContributors",this._processParams(o),!0),e.getModelRegistry("group-top-contributors-models"),e.getModelRegistry("group-contributor-models")]).then(function(e){return t._processResponse(e,o)},r.FetcherErrorLogger(s))},_processParams:function(e){return{group_id:e.id,type:"all",extras:"include_viewer,is_pro,icon_urls"}},_processResponse:function(e,t){var r,s,i=e[0],o=e[1],l=e[2],n={photoContributors:[],discussionContributors:[],id:t.id};return i&&i.contributors&&[{k:"photos",v:"photoContributors"},{k:"discussions",v:"discussionContributors"}].forEach(function(o){i.contributors[o.k]&&(r=i.contributors[o.k]).contributor&&r.contributor.forEach(function(e){s=u(e,o.k,t.id),n[o.v].push(l.addOrUpdate(s))})}),i&&i.viewer&&0!==i.viewer.length?(s=u(i.viewer,"viewer",t.id),n.viewer=l.addOrUpdate(s)):n.viewer=null,o.addOrUpdate(n),o.proxy(n.id)}}},"@VERSION@",{requires:["flickr-promise","api-helper","moment","url-helper"],optional:["group-top-contributors-models","group-contributor-models"]}),YUI.add("group-top-contributors-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){var o=this;return t.ModelFetchers["flickr-groups-getTopContributors"].run(e,this.appContext).then(function(e){return o})}},attributes:{viewer:{isModel:!0,defaultValue:null},contributors:{isCollection:!0},photoContributors:{isCollection:!0},discussionContributors:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-getTopContributors-fetcher","attribute-helpers"]});
