(window.webpackJsonp=window.webpackJsonp||[]).push([[345],{1956:function(e,a,r){"use strict";r.d(a,"a",function(){return t}),r.d(a,"b",function(){return n}),r.d(a,"c",function(){return o}),r.d(a,"e",function(){return i}),r.d(a,"f",function(){return c}),r.d(a,"d",function(){return d});var t=function(e){return e.reverseImageSearch.isLoading},n=function(e){return e.reverseImageSearch.isRisDialogOpen},o=function(e){return e.reverseImageSearch.shouldCloseOnDragLeave},i=function(e){return e.reverseImageSearch.uploadError},c=function(e){return null===(e=e.reverseImageSearch)||void 0===e?void 0:e.uploadImageSrc},d=function(e){return e.location.siteIdentifier}},1977:function(e,a,r){"use strict";r.r(a);function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:u,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};switch(a.type){case c.g.CLEAR_UPLOAD_ERROR:return Object(n.a)({},e,{uploadError:""});case c.g.SET_DEFAULT_STATE:return Object(n.a)({},e,u);case c.g.SET_LOADING:return Object(n.a)({},e,{isLoading:!0});case c.g.SET_UPLOAD_ERROR:return Object(n.a)({},e,{uploadError:a.errType});case c.g.SET_UPLOAD_IMAGE_SRC:return Object(n.a)({},e,{uploadImageSrc:a.uploadImageSrc});case c.g.TOGGLE_RIS_DIALOG:return Object(n.a)({},e,{isRisDialogOpen:!e.isRisDialogOpen,shouldCloseOnDragLeave:a.shouldCloseOnDragLeave||!1,uploadError:""});case c.g.UPLOAD_IMAGE_FAILED:return Object(n.a)({},e,{isLoading:!1,uploadError:"generic"});default:return e}}var n=r(3),c=r(1955),o=r(2),d=r(16),i=r(15),l=(I={},Object(o.a)(I,d.k.video,"videos"),Object(o.a)(I,d.k.image,"images"),I),s=(L={},Object(o.a)(L,d.k.video,i.a.footage.searchRis),Object(o.a)(L,d.k.image,"route/IMAGE/SEARCH_RIS"),L),u={isLoading:!1,isRisDialogOpen:!1,shouldCloseOnDragLeave:!1,uploadError:"",uploadImageSrc:{}},g=r(4),_=r.n(g),p=r(13),h=r(0),m=r(90),f=r(1956),b=_.a.mark(v),O=_.a.mark(j);function D(e){return Object.entries(e).reduce(function(e,a){var r=Object(p.a)(a,2),a=r[0],r=r[1];return"content-type"!==a.toLowerCase()&&(e[a]=r),e},{})}function v(a){var r,t,n,o,i;return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.data,e.next=3,Object(h.i)(Object(c.b)());case 3:return e.next=5,Object(h.k)(f.d);case 5:return t=e.sent,n=l[t]||l[d.k.image],e.prev=7,e.next=10,Object(h.c)(d.h,"/".concat(n,"/reverse-image-search"),{method:"POST",body:r,stringifyBody:!1,timeout:1e4,transformHeaders:D});case 10:if((o=e.sent).errors)return i=Array.isArray(o.errors)?o.errors[0].detail:"unknown",e.next=15,Object(h.c)(m.b.error,"Reverse image search: Studio API upload responded with ".concat(i));e.next=18;break;case 15:return e.next=17,Object(h.i)(Object(c.i)());case 17:return e.abrupt("return");case 18:return e.next=20,o.map(function(e){return e.id}).join(",");case 20:return i=e.sent,e.next=23,Object(h.i)({type:s[t]||s[d.k.image],payload:{queryString:i}});case 23:e.next=31;break;case 25:return e.prev=25,e.t0=e.catch(7),e.next=29,Object(h.c)(m.b.error,"Reverse image search: Studio API upload failed.  Error details: ",e.t0);case 29:return e.next=31,Object(h.i)(Object(c.i)());case 31:case"end":return e.stop()}},b,this,[[7,25]])}function j(){return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.o)(c.g.UPLOAD_IMAGE,v);case 2:case"end":return e.stop()}},O,this)}var N=r(19),E=r(5),w=r(18),S=r(30),x=r(76),k=r(14),y=r(21),I=r(27),A=r(26),T=r(25),i=r(28),R=r(8),L=r(1),C=r.n(L),g=r(9),B=r.n(g),U=r(48),P=r(38),G=r(2612),F=r(2542),g=r(5701),H=r.n(g),z={upload:"SearchBar_reverse_image_search_upload_Button",cancel:"SearchBar_reverse_image_search_cancel_Button",close:"SearchBar_reverse_image_search_close_Button"},L=(L=L.Component,Object(i.a)(M,L),Object(I.a)(M,[{key:"render",value:function(){var e=this.props,a=e.cancel,r=e.dragAndDrop,t=e.dropAnywhere,n=e.isFloating,o=e.isRisDialogOpen,i=e.orUpload,c=e.showSearchByImageButton,d=e.toggleRisDialog,l=e.uploadError,e=e.risButtonLabel;return C.a.createElement("div",{className:B()(H.a.root)},c&&C.a.createElement(U.a,{size:"large",onClick:d,"data-track-action":"click","data-track-section":"searchBar","data-track-label":"reverseImageSearchButton","data-automation":"SearchBar_reverse_image_search_Button","aria-label":e,className:B()(H.a.button,n&&H.a.isFloating)},C.a.createElement(P.a,{alt:e,value:"search-by-image",theme:{icon:H.a.icon}}),e),d&&C.a.createElement(G.a,Object(k.a)({},this.props,{uploadError:!!l,toggleDialog:d,isDialogOpen:o,processDrop:this.handleFiles,dataTrackSection:"reverseImageSearchDialog",dataAutomation:z}),C.a.createElement(F.a,{upload:i,ctaTitle:r,ctaDragTitle:t,cancel:a,dataTrackSection:"reverseImageSearchDialog",dataAutomation:z,icon:"search-by-image"})))}}]),M);function M(){var e,n;Object(y.a)(this,M);for(var a=arguments.length,r=new Array(a),t=0;t<a;t++)r[t]=arguments[t];return n=Object(A.a)(this,(e=Object(T.a)(M)).call.apply(e,[this].concat(r))),Object(o.a)(Object(R.a)(Object(R.a)(n)),"handleValidation",function(e){return Array.from(e).find(function(e){return["image/jpg","image/jpeg","image/png"].includes(e.type)&&e.size<5e6})}),Object(o.a)(Object(R.a)(Object(R.a)(n)),"handleThumb",function(e){var a=e.width/e.height,r=Math.round(90*a),t=document.createElement("canvas");t.width=r,t.height=90,t.getContext("2d").drawImage(e,0,0,r,90),n.props.setUploadImageSrc({aspect:a,src:t.toDataURL("image/png",1),thumbWidth:r})}),Object(o.a)(Object(R.a)(Object(R.a)(n)),"handleFiles",function(e){var a,r,t=e.files;n.props.clearUploadError(),t.length?(a=n.handleValidation(t))&&"undefined"!=typeof window?((r=new window.FileReader).onload=function(){var e=new window.Image;e.onload=function(){n.handleThumb(e)},e.src=r.result},r.readAsDataURL(a),(e=new window.FormData).append("image",a),n.props.uploadImage(e)):n.props.setUploadError(["image/jpg","image/jpeg","image/png"].includes(t[0].type)?"size":"format"):n.props.setUploadError()}),n}Object(o.a)(L,"defaultProps",{showSearchByImageButton:!0});var I=L,L=r(5700),J=Object(E.createSelector)(f.e,function(e){return e?"search:ris_error_text_".concat(e):"search:ris_error_text_generic"}),E={clearUploadError:c.a,setUploadError:c.d,setUploadImageSrc:c.e,toggleRisDialog:c.f,uploadImage:c.h},q=Object(N.a)(Object(S.g)(Object(n.a)({},L,x.a)),Object(w.connect)(function(e,a){var r=a.t,a=Object(f.d)(e),a=a!==d.k.image?"_".concat(a):"";return{cancel:r("common:actions_cancel"),close:r("common:actions_close"),dragAndDrop:r("search:ris_drag_and_drop"),dropAnywhere:r("search:ris_drop_anywhere"),isLoading:Object(f.a)(e),isRisDialogOpen:Object(f.b)(e),loadingHelpText:r("search:ris_loading_help_text".concat(a)),orUpload:r("search:ris_or_upload"),shouldCloseOnDragLeave:Object(f.c)(e),supportedHelpText:r("search:ris_supported_help_text"),tooltipText:r("search:ris_tooltip_text".concat(a)),uploadError:Object(f.e)(e),errorText:r(J(e))}},E))(I);r.d(a,"register",function(){return W}),r.d(a,"default",function(){return q});var W=function(e){var a=e.registerReducer,e=e.registerWatchers;a("reverseImageSearch",t),e(j)}},2542:function(e,a,r){"use strict";var t=r(1),g=r.n(t),_=r(48),p=r(38),t=r(9),h=r.n(t),t=r(2628),m=r.n(t),t=function(e){var a=e.upload,r=e.cancel,t=e.ctaTitle,n=e.ctaDragTitle,o=e.isADrag,i=e.toggleDialog,c=e.uploadHandler,d=e.dataTrackSection,l=e.dataAutomation,s=e.icon,e=e.theme,u=g.a.createRef();return g.a.createElement("div",{className:h()(m.a.dddDialogContainer,e.cta)},g.a.createElement(p.a,{className:h()(m.a.dddDialogIcon,e.icon),value:s}),g.a.createElement("div",{className:h()(m.a.dddDialogHelpText,e.ctaTitle,o&&m.a.displayNone)},t),g.a.createElement("div",{className:h()(m.a.dddDialogHelpText,!o&&m.a.displayNone)},n),a&&g.a.createElement(_.a,{size:"small",disabled:o,label:a,className:"",onClick:function(){return u.current.click()},"data-track-action":"click","data-track-section":d,"data-track-label":"upload","data-automation":l.upload}),g.a.createElement("br",null),g.a.createElement("input",{type:"file",accept:".png, .jpg, .jpeg",ref:u,className:h()(m.a.displayNone),onChange:function(e){return c({e:e,files:e.target.files})}}),r&&g.a.createElement(_.a,{size:"small",disabled:o,neutral:!1,label:r,onClick:i,"data-track-action":"click","data-track-section":d,"data-track-label":"cancel","data-automation":l.cancel}))};t.defaultProps={upload:"upload",cancel:null,ctaTitle:"Drag and Drop an Image",ctaDragTitle:"Drop Anywhere",isADrag:!1,toggleDialog:function(){},uploadHandler:function(){},icon:"",dataTrackSection:"",dataAutomation:{upload:"",cancel:""},theme:{cta:"",ctaTitle:"",icon:""}},a.a=t},2612:function(e,o,i){"use strict";!function(e){i.d(o,"a",function(){return n});var a=i(6),r=i.n(a),a=i(7),t=i.n(a),a=i(156),n=Object(a.c)("DragDropDialog",function(){return t()({id:"./DragDropDialog",load:function(){return Promise.all([i.e(330).then(i.bind(null,2633))]).then(function(e){return e[0]})},path:function(){return r.a.join(e,"./DragDropDialog")},resolve:function(){return 2633},chunkName:function(){return"DragDropDialog"}})},{loading:null})}.call(this,"/")},2628:function(e,a,r){e.exports={"display-none":"N_a_9b892",displayNone:"N_a_9b892",label:"N_a_4dc52","ddd-dialog":"N_a_84455",dddDialog:"N_a_84455","ddd-dialog-content":"N_a_07ef8",dddDialogContent:"N_a_07ef8","main-content-container":"N_a_bf12c",mainContentContainer:"N_a_bf12c","close-button":"N_a_7e80d",closeButton:"N_a_7e80d","ddd-dialog-drop-area":"N_a_a2ec7",dddDialogDropArea:"N_a_a2ec7","ddd-dialog-drop-mask":"N_a_645c0",dddDialogDropMask:"N_a_645c0","ddd-dialog-pulse":"N_a_e7bc4",dddDialogPulse:"N_a_e7bc4",changePadding:"N_a_46a46","ddd-dialog-border":"N_a_52d3f",dddDialogBorder:"N_a_52d3f","ddd-dialog-close-btn":"N_a_07b59",dddDialogCloseBtn:"N_a_07b59","ddd-dialog-container":"N_a_038d2",dddDialogContainer:"N_a_038d2","ddd-dialog-icon":"N_a_61bf5",dddDialogIcon:"N_a_61bf5","ddd-dialog-help-text":"N_a_3fd6a",dddDialogHelpText:"N_a_3fd6a","ddd-dialog-error-text":"N_a_d5f9d",dddDialogErrorText:"N_a_d5f9d","ddd-dialog-file-requirements":"N_a_93b73 font-body-static-sm",dddDialogFileRequirements:"N_a_93b73 font-body-static-sm"}},5700:function(e){e.exports=JSON.parse('{"search:ris_drag_and_drop":"Drag and drop an image to find similar","search:ris_drop_anywhere":"Drop anywhere to find similar","search:ris_error_text_generic":"Something went wrong! Please try again.","search:ris_error_text_format":"Something went wrong! Check the file format and try again.","search:ris_error_text_size":"Something went wrong! Check the file size and try again.","search:ris_loading_help_text":"Finding similar images","search:ris_loading_help_text_video":"Finding similar videos","search:ris_or_upload":"Or, upload","search:ris_supported_help_text":"We only support JPG and PNG images under 5MB.","search:ris_tooltip_text":"Search with an image instead of text to discover similar images.","search:ris_tooltip_text_video":"Search with an image instead of text to discover similar videos."}')},5701:function(e,a,r){e.exports={root:"G_a_63359",button:"G_a_b4b4c","is-floating":"G_a_2354f",isFloating:"G_a_2354f",icon:"G_a_4560b"}}}]);
