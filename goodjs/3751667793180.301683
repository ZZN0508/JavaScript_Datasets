YUI.add("af-rapid",function(c,t){"use strict";var a={rapidInstance:null,moduleQueue:[],addModules:function(t){this.moduleQueue.push(t)}},o=c.Lang,n=c.Af.Utils;function e(t){var e,i="afRapid";n.perfStart(i),(t=t||{}).i13nConfig=t.i13nConfig||{},window.YAHOO=window.YAHOO||{},window.YAHOO.i13n=window.YAHOO.i13n||{},window.YAHOO.i13n=c.merge(window.YAHOO.i13n,t.i13nConfig.ywaMaps);try{c.rapid&&o.isFunction(c.rapid.initRapid)?this.tracker=c.rapid:(e=c.merge(a,{rapidConfig:t.i13nConfig.rapid||{}}),t.i13nConfig.rapidInstance&&(e.instance=t.i13nConfig.rapidInstance),this.tracker=new c.Media.RapidTracking(e),this.tracker.initRapid()),this._initAppletListeners()}catch(t){}c.Af.rapid=this,n.perfStop(i)}e.prototype={initializer:function(){this._initSelectBoxListeners()},getRapidTracker:function(){return this.tracker},_initAppletListeners:function(){o.isFunction(this.after)&&(this.after(["*:viewrender","*:viewupdate","*:appletinit"],function(t){this._addOrRefresh(t.applet.guid)},this),this.after("*:viewdisplay",function(t){null===t.viewdisplay.prevRegion&&t.viewdisplay.newRegion&&this._addOrRefresh(t.applet.guid)},this),this.after("*:appletremove",function(t){this.tracker&&this.tracker.removeModule("applet_"+t.applet.guid)},this))},_autoBeacon:function(t){var e,t=t.ancestor("[data-i13n]",!0);return!t||!(e=this._parseDataAttr(t,"i13n"))||"false"!==e.auto},_addOrRefresh:function(t){var e,i,a,n,r;this.tracker&&(a="applet_"+t,t=(r=(n=c.Af.Bootstrap.getMeta(t))&&n.i13n)&&r.pv,r&&r.pp&&(i={pp:r.pp}),this.tracker.isModuleTracked(a)?this.tracker.refreshModule(a,t,!0,i):(n=c.one("#"+a),this._autoBeacon(n)&&(!(r=r&&r.sec)&&n&&(r=(e=n?this._parseDataAttr(n,"i13n"):e).sec||n.getData("i13n-sec"),n&&e&&(!0===e.useViewability||"true"===e.useViewability)&&(i?i.useViewability=!0:i={useViewability:!0})),r?((e={})[a]=r,this.tracker.addModules(e,t,i),n.hasAttribute("data-i13n-secvw")&&this.tracker.beaconEvent("secvw",{sec:r},"")):this.tracker.addModules([a],t,i))))},_parseDataAttr:function(t,e){return t?c.Af.Utils.stringParseKV(t.getData(e)):{}},_getSelectBoxSelectedLinkName:function(t,e){var i=t.get("value"),t=t.all("option").item(t.get("selectedIndex"));return this._parseDataAttr(t,"i13n-ylk")[e]||i},_getSelectBoxName:function(t,e){return this._parseDataAttr(t,"i13n-ylk")[e]||t.get("name")},_initSelectBoxListeners:function(){var i,t,e;c.UA.ie&&c.UA.ie<9||((t=c.one("body")).delegate("mousedown",function(t){var e;"SELECT"===t.target.get("tagName")&&this._autoBeacon(t.target)&&(e={slk:this._getSelectBoxSelectedLinkName(t.target,"slk"),elm:"inpt",elmt:"mu",itc:1,t3:this._getSelectBoxName(t.target,"t3")},c.UA.ie?i=c.later(250,this,function(){i=null,this.triggerBeaconClickEvent(t.target,e)}):this.triggerBeaconClickEvent(t.target,e))},e="select",this),t.delegate("keyup",function(t){var e;this._autoBeacon(t.target)&&9===t.keyCode&&(e={slk:this._getSelectBoxSelectedLinkName(t.target,"slk"),elm:"inpt",elmt:"muk",itc:1,t3:this._getSelectBoxName(t.target,"t3")},this.triggerBeaconClickEvent(t.target,e))},e,this),t.delegate("change",function(t){var e;this._autoBeacon(t.target)&&(e={slk:this._getSelectBoxSelectedLinkName(t.target,"slk"),elm:"itm",elmt:"slct",itc:1,t3:this._getSelectBoxName(t.target,"t3")},c.UA.ie&&i&&(i.cancel(),i=null),this.triggerBeaconClickEvent(t.target,e))},e,this))},getSecValue:function(t){var e=t.ancestor("[data-i13n],[data-i13n-sec],[data-applet-type]",!0),t="";return t=e?this._parseDataAttr(e,"i13n").sec||e.getData("i13n-sec")||e.getData("applet-type"):t},getSlkValue:function(t){var e=t.getDOMNode(),t="";return t=e?(t=e.textContent||e.innerText||"").substring(0,299):t},parseYLK:function(t){var e=t?this._parseDataAttr(t,"ylk"):{},t=t.ancestor("[data-applet-type][data-ylk]",!0,"[data-applet-type]");return t?c.merge(this._parseDataAttr(t,"ylk"),e):e},triggerBeaconClickEvent:function(t,e,i,a){var n,r,s;t?(s={},(s=this.parseYLK(t)).sec||(n=this.getSecValue(t))&&(s.sec=n),s.slk||(r=this.getSlkValue(t))&&(s.slk=r),(s=e?c.merge(s,e):s).sec?(n=s.sec,delete s.sec,r=s.slk||"",delete s.slk,e=parseInt(s.pos,10),o.isNumber(e)||(e=1),t=t.getData("action-outcome"),this.tracker.beaconClick(n,r,e,s,t,i,a)):i&&i()):i&&i()}},c.namespace("Af").Rapid=e},"@VERSION@",{requires:["af-bootstrap","af-utils","media-rapid-tracking","node-core"]});
