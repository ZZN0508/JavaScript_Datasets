Highcharts.setOptions({lang:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weekdays:["周一","周二","周三","周四","周五","周六","周日"],thousandsSep:"",shortMonths:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}});var drawChart=function(t,e){this.elements=t,this.codeList=[],this.dataPool={},this.options=e||{}};drawChart.prototype.init=function(){var i=this;$(this.elements).each(function(t,e){i.codeList.push($(e).data("code"))}),this.fetchData()},drawChart.prototype.getStockPriceInfo=function(t,e){var i=function(t,e){var i,a,n,o=-1,r=t.length;if(1===arguments.length){for(;++o<r&&!(null!=(i=n=t[o])&&i<=i);)i=n=void 0;for(;++o<r;)null!=(a=t[o])&&(a<i&&(i=a),n<a&&(n=a))}else{for(;++o<r&&!(null!=(i=n=e.call(t,t[o],o))&&i<=i);)i=void 0;for(;++o<r;)null!=(a=e.call(t,t[o],o))&&(a<i&&(i=a),n<a&&(n=a))}return[i,n]}(t,function(t){return t[1]}),a=i[0],n=i[1];return e&&(t=Math.abs(e-n),i=Math.abs(e-a),a=+e-(i=Math.max(t,i)),n=+e+i),{max:n,min:a,pre:e}},drawChart.prototype.getSeriesInfo=function(t){return t?0<=t.indexOf("gqh_")?{count:1442,xLabel:[[0,"00:00"],[721,"12:00"],[1442,"23:59"]]}:0<=t.indexOf("gzqh")||0<=t.indexOf("129")?{count:272,xLabel:[[0,"09:15"],[136,"11:30/13:00"],[272,"15:15"]]}:0<=t.indexOf("hk")?{count:332,xLabel:[[0,"09:30"],[332,"16:00"]]}:{count:242,xLabel:[[0,"09:30"],[121,"11:30/13:00"],[241,"15:00"]]}:{count:242,xLabel:[[0,"09:30"],[121,"11:30/13:00"],[241,"15:00"]]}},drawChart.prototype.ready=function(t){this.drawHQ(t||this.elements)},drawChart.prototype.drawHQ=function(a){var n=this;$(a).each(function(t,e){var i=$(e).data("code");i&&(n.dataPool[i]?n.drawFn({element:e,code:i}):n.fetchData(i,a))})},drawChart.prototype.drawByData=function(t){return this.drawFn(t)},drawChart.prototype.drawFn=function(p){var u=this,f=p.code,g=p.element,t=u.options.tickDecimals,x=p.data||u.dataPool[f].data,m=p.data?null:u.dataPool[f].pre,e=u.getStockPriceInfo(x,m);$(g).highcharts({chart:{marginRight:0,marginLeft:0,marginBottom:u.options.hasXaxis?20:2,style:{"font-family":"Arial"},zoomType:"x",events:{selection:function(t){t=t.xAxis[0],t.min,t=t.max;return x[t>>0],!1},click:function(t){var e=u.options.clickCallback;e&&e(f)}}},title:{text:""},legend:{enabled:!1},credits:{enabled:!1},plotOptions:{area:{fillColor:"#F7FCFF",marker:{radius:2},lineWidth:1,states:{hover:{lineWidth:1,halo:{size:0}}},threshold:null}},series:[{type:"area",data:x,lineWidth:1,lineColor:"#0174DD",marker:{enabled:!1},animation:!1,yAxis:0}],tooltip:{shadow:!1,style:{padding:5},formatter:function(){return p.data?x[this.x][2]+"<br />"+this.y.toFixed(t):x[this.x][2].toString().replace(/(.{2})\B/g,"$1:")+"<br />"+this.y.toFixed(t)}},xAxis:{labels:{enabled:!1},tickLength:0,lineWidth:0,min:0,max:p.data?p.data.length-1:u.getSeriesInfo(f).count},yAxis:{title:{text:""},gridLineWidth:0,lineWidth:0,tickPositions:[+e.min,+e.max],tickAmount:6,labels:{align:"left",x:5,y:0,style:{"font-size":10,"line-height":1},formatter:function(){return this.value.toFixed(t)}},plotLines:u.options.showPreLine?[{color:"#D75442",width:1,dashStyle:"ShortDash",value:m,zIndex:4,label:{text:m,textAlign:"left",x:5,style:{color:"#888"}}}]:[]}},function(t){if(u.options.hasXaxis)for(var e=p.data?[[0,p.data[0][2]],[p.data.length-1,p.data[p.data.length-1][2]]]:u.getSeriesInfo(f).xLabel,i=t.plotHeight,a=(t.plotWidth,t.plotLeft),n=t.plotTop,o=0;o<e.length;o++){var r,s,l,d=a+t.xAxis[0].toPixels(e[o][0]);0==o?(r="left","number"==typeof(s=e[o][1])&&(s=e[o][1].toString().substring(0,4)+"-"+e[o][1].toString().substring(4,6)+"-"+e[o][1].toString().substring(6)),(l=$("<div />").css({position:"absolute",left:d,"text-align":r,top:-9999,"font-size":10,"z-index":99,"line-height":"20px"}).html(s).prependTo(t.container)).css({top:i+n})):o==e.length-1?(r="right","number"==typeof(s=e[o][1])&&(s=e[o][1].toString().substring(0,4)+"-"+e[o][1].toString().substring(4,6)+"-"+e[o][1].toString().substring(6)),(l=$("<div />").css({position:"absolute","text-align":r,top:-9999,"font-size":10,"z-index":99,"line-height":"20px"}).html(s).prependTo(t.container)).css({right:0,top:i+n})):(r="center","number"==typeof(s=e[o][1])&&(s=e[o][1].toString().substring(0,4)+"-"+e[o][1].toString().substring(4,6)+"-"+e[o][1].toString().substring(6)),(l=$("<div />").css({position:"absolute",left:d,"text-align":r,top:-9999,"font-size":10,"z-index":99,"line-height":"20px"}).html(s).prependTo(t.container)).css({left:d-l.width()/2,top:i+n}))}var h=t,c=x[x.length-1][1];$(g).data("stockLastInfo",{lastData:{pre:m,price:x[x.length-1][1],zde:c-m,zdf:(c-m)/m,min:h.yAxis[0].dataMin,max:h.yAxis[0].dataMax},originData:x}),u.options.drawComplete&&u.options.drawComplete($(g))})},drawChart.prototype.fetchData=function(e,s){e=e||this.codeList,!$.isArray(e)&&$.inArray(e,this.codeList)<0&&(this.codeList.push(e),e=[e]);var l=this,i=setInterval(function(){var t;window.hx_canvas_puredataprovider&&(clearInterval(i),t=e,new hx_canvas_puredataprovider({url:"http://d.10jqka.com.cn/",urlVersion:"v2/time/",lastPart:t.join(",")+"/last.js",isKeepingGet:!0,intervalTime:6e4,callbackName:"quotebridge_v2_time_"+t.join("_")+"_last",success:function(t){for(var e in t){for(var i=t[e],a=i.data.split(";"),n=0,o=[];n<a.length;n++){var r=a[n].split(",");o.push([n,+r[1],r[0]])}l.dataPool[e]=i,l.dataPool[e].data=o}l.ready(s)}}))},30)};
