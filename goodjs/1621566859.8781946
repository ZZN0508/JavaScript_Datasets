var _i_=this._i_||function(){},_r_=this._r_||function(e){return e};B.define("hotel/tpi/data-api",function(e,i,_){_i_("50d:8abfc0fa");var t,r,a=e("promise");function d(e){_i_("50d:a0cb4c70"),B.squeak&&B.env.wholesaler_configuration.tpi_track_ajax_failures&&e&&B.squeak(e),_r_()}function h(e,i){return _i_("50d:c6ffc0a4"),_r_(function(){return _i_("50d:084bf321"),_r_(e.apply(i,arguments))})}_.exports={run:function(s,c,l,e){_i_("50d:56ae6702");var f=(B.env||{}).wholesaler_configuration||{};return r&&e&&(r.should_abort=1,t=void 0),t||(t=new a(h(function(i,_){if(_i_("50d:78db3079"),c&&l||_("Error: Missing args, avData, avData, frgName and frgData  are required"),B.env.wholesaler_configuration.worker_url&&B.env.wholesaler_configuration.decision_url&&B.env.b_fragment_url_json){var e=B.env.b_fragment_url_json.split("?"),t=1<e.length?e[1]:"",r=Object.assign({},c),a=Object.assign({},l);a.exps=B.env.wholesaler_configuration.tpi_exps||{},r.url=s,B.env.wholesaler_configuration.use_k8s_dev_installations&&B.env.wholesaler_configuration.av_url&&(r.use_dev=1,r.av_service_url=B.env.wholesaler_configuration.av_url),r.call_supply_service=B.env.wholesaler_configuration.call_supply_service,r.worker_token=B.env.wholesaler_configuration.worker_token,r.frag_url=B.env.wholesaler_configuration.decision_url+"?"+t,r.frag_req=a,(n=B.env.wholesaler_configuration.worker_url,o=r,_i_("50d:0bc02a2f"),_r_($.ajax({type:"POST",url:n,data:JSON.stringify(o),cache:!1,xhrFields:{withCredentials:!0},dataType:"json",contentType:"application/json; charset=utf-8",timeout:2e4}))).then(h(function(e){_i_("50d:700af058"),this.should_abort?_("frg-aborted"):e&&e.data?i(e.data):_("frg-error"),_r_()},this),function(e,i){_i_("50d:bde19a10"),d(i&&"timeout"===i?f.tpi_av_timeout_squeak_name:f.tpi_av_squeak_name),_("av-error"),_r_()})}else d("tpi-client-fallback-"+B.env.b_site_type+"-"+B.env.b_action);var n,o;_r_()},r={}))),_r_(t)}},_r_()}),B.define("hotel/tpi/postproc-api",function(e,i,_){_i_("50d:cca324dc"),_.exports={send_postproc_request:function(e){_i_("50d:97faa462");var i="";"object"==typeof e?(e.forEach(function(e){_i_("50d:1bdb3ed6"),i+=e+"_",_r_()}),i=i.substring(0,i.length-1)):i=""+e;var _=B.env.b_countrycode;$.getJSON("/tpi_postproc?hotel_ids="+i+"&cc="+_+"&src=sr",null,function(){}),_r_()}},_r_()}),B.define("searchresults/tpi/data-api",function(e,i,_){_i_("50d:623da6bd");var t=new(B.require("event-emitter"));_.exports={emitTpiDataEvent:function(e){_i_("50d:936f124e"),t.emit("tpi_data",e),_r_()},onTpiData:function(e){_i_("50d:96a6acd1"),t.on("tpi_data",e),_r_()}},_r_()}),B.when({action:"searchresults",events:"ready",condition:1==B.env.b_bookings_owned&&B.env.wholesaler_configuration&&!B.env.fe_is_tdot}).run(function(r){_i_("50d:fe7133e7");var a=r("searchresults/tpi/data-api"),n=r("hotel/tpi/data-api"),o="www"===B.env.b_site_type,e="mdot"===B.env.b_site_type;function _(){_i_("50d:5f413896");var e,i=(e="wholesaler_configuration",_i_("50d:26e9d9d1"),_r_(o?r("searchresults/env").get(e):B.env[e]));if(i&&i.availability_api_request&&i.decision_fragment_request){var _=Object.assign({},i.availability_api_request);_.use_cache=i.use_cache;var t=Object.assign({},i.decision_fragment_request);n.run(i.b_wholesaler_url,_,t,!0).then(function(e){_i_("50d:432ff3c1"),null!=e&&a.emitTpiDataEvent(function(e){_i_("50d:e62d1ad5");var i={data:{},status:200,status_response:"OK"};for(var _ in e){if("exps"===_)continue;i.data[_]=[];var t=e[_],r={};r.wholesaler_code=t.min_room_block.wholesaler_code?t.min_room_block.wholesaler_code:"ag",r.price_formatted=t.min_room_block.price_formatted,r.price_inclusion=t.min_room_block.price_inclusion,r.price_user_currency=t.min_price,r.room_name=t.min_room_block.room_name,r.room_info=t.min_room_block.room_description,r.cancellation_information=t.min_room_block.cancellation_information,r.reservation_meta_data={ratechannel:"Retail"},r.price_detail=t.min_room_block.price_detail,t.min_room_block.exotic_tax&&(r.exotic_tax=t.min_room_block.exotic_tax),i.data[_].push(r)}e.exps&&(i.exps=e.exps);return _r_(i)}(e)),_r_()}).catch(function(){})}_r_()}if(o){var i=r("searchresults/events");i.on(i.DATA_ENVIRONMENT_UPDATED,_)}if(e){var t=r("event-bus");t.on(t.EVENTS.SR_AJAX_LOADED,function(e,i){_i_("50d:32526b0f"),0<=i.blocks.indexOf("results")&&_(),_r_()})}_(),_r_()}),B.define("searchresults/tpi/user-utils",function(e,i,_){_i_("50d:4aee45db");var t=B.require("et"),r={TRACKING_ASPECTS:{ALWAYS:"always",IS_GENIUS:"genius",IS_LOGGED_IN:"loggedin",IS_ASIAN:"asian",IS_EARLY:"early",IS_LAST_MINUTE:"lastminute",IS_DOMESTIC:"domestic",IS_INTERNATIONAL:"international",IS_META:"meta"},trackUser:function(e,i){var _;_i_("50d:98c03e0d"),void 0!==(_=i?i[r.TRACKING_ASPECTS.ALWAYS]:1)&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_GENIUS]:2)&&B.env.b_reg_user_is_genius&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_LOGGED_IN]:3)&&0<B.env.auth_level&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_ASIAN]:4)&&r.isUserAsian()&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_EARLY]:5)&&r.isEarlyBooker()&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_DOMESTIC]:6)&&B.env.b_countrycode===B.env.b_guest_country&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_INTERNATIONAL]:7)&&B.env.b_countrycode!==B.env.b_guest_country&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_LAST_MINUTE]:8)&&r.isLastMinuteBooker()&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_META]:9)&&"meta"==B.env.b_partner_vertical&&t.stage(e,_),_r_()},isUserAsian:function(){_i_("50d:ee3537b5");var e=!1,i=["cn","kp","kh","mm","la","ph","bn","bt","np","hk","th","mo","sg","jp","lk","id","mv","mn","bd","in","vn","kr","tw","my"];if(B.env.b_guest_country)for(var _=0;_<i.length;_++)i[_]==B.env.b_guest_country&&(e=!0);return _r_(e)},isLastMinuteBooker:function(){if(_i_("50d:31024b7d"),B.env.b_checkin_date){var e=new Date(B.env.b_checkin_date),i=new Date,_=Math.abs(e.getTime()-i.getTime());if(Math.ceil(_/864e5)<=3)return _r_(!0)}return _r_(!1)},isEarlyBooker:function(){if(_i_("50d:ee7d2bef"),B.env.b_checkin_date){var e=new Date(B.env.b_checkin_date),i=new Date,_=Math.abs(e.getTime()-i.getTime());if(30<=Math.ceil(_/864e5))return _r_(!0)}return _r_(!1)}};_.exports=r,_r_()}),B.when({action:"searchresults",events:"ready",condition:1==B.env.b_bookings_owned&&B.env.wholesaler_configuration&&B.env.wholesaler_configuration.availability_api_request}).run(function(_){_i_("50d:d88e906e");var e=_("searchresults/tpi/data-api"),c=_("hotel/tpi/postproc-api"),t=_("searchresults/filters").getInstance,f=_("jquery"),p=_("et"),u="PPXGSCZFRURURNWBOabFIRZZERT",b=B.env.tpi_search_config.b_children_total&&2==p.track(u),m="PPXGSCZFRURURNHPZAWe",v=1<B.env.tpi_search_config.b_nr_rooms_needed&&2==p.track(m),g="PPXGSCZFRURURNSGSTSEQbIOJRSESCeJXaT",y="PPXGFRURURYTaIXLCTEbaO";function i(){var e;_i_("50d:5ff8f9e4"),this.occupancy=B.env.wholesaler_configuration.availability_api_request.search_config.number_of_adults;var i=_("searchresults/env");if(this.wholesaler_configuration=i.get("wholesaler_configuration"),this.hotel_candidate_list=[],this.hotels_with_no_rate=[],this.search_filters={},this.hotel_info_prices=this.wholesaler_configuration.hotel_info_prices,this.searchresults_ordered_by_price=this.wholesaler_configuration.searchresults_ordered_by_price,this.translations=this.wholesaler_configuration.b_wholesaler_translations,this.rtl=i.get("rtl"),this.search_filters_raw=t(),!this.search_filters_raw.filters["fc-5"]&&!this.search_filters_raw.filters["fc-6"])for(this.hotel_candidate_list=this.wholesaler_configuration.b_wholesaler_hotel_ids,this.wholesaler_configuration.hotels_with_no_rate&&(this.hotels_with_no_rate=this.wholesaler_configuration.hotels_with_no_rate),this.search_filters_raw.filters["fc-2"]&&(this.search_filters.fc=1),this.search_filters.mealplan=0,this.search_filters_raw.filters["mealplan-1"]?this.search_filters.mealplan+=4:this.search_filters_raw.filters["mealplan-3"]?this.search_filters.mealplan=7:this.search_filters_raw.filters["mealplan-8"]?this.search_filters.mealplan=6:this.search_filters_raw.filters["mealplan-9"]?this.search_filters.mealplan=5:this.search_filters_raw.filters["mealplan-4"]&&(this.search_filters.all_inclusive=1),this.search_filters.price_slider_options=B.env.b_slider_options,e=1;e<=4;e++)if(this.search_filters_raw.filters["pri-"+e]){this.search_filters.price_range=e;break}_r_()}function l(e,_){_i_("50d:1f639a01"),e.find("a[href]").each(function(){_i_("50d:a79d53c4");var e=f(this).attr("href"),i=e.indexOf("#");-1===i?e+="&tpi_r="+_:e=e.slice(0,i)+"&tpi_r="+_+e.slice(i),f(this).attr("href",e),_r_()}),_r_()}i.prototype.render=function(e){_i_("50d:ac730b56"),this.search_filters_raw.filters["fc-5"]||this.search_filters_raw.filters["fc-6"]||this.processResult(e),_r_()},i.prototype.checkSearchFilters=function(e){var i;_i_("50d:c0ba7944");for(var _=0;_<e.length;_++){var t=e[_],r=!1;if(f.isEmptyObject(this.search_filters))r=!0;else{var a=!0;if((a=a&&1!=this.search_filters.all_inclusive)&&0<this.search_filters.mealplan)if(t.room_info&&t.room_info.meal_info){var n=0;1===t.room_info.meal_info.has_breakfast&&(n+=4),1===t.room_info.meal_info.has_lunch&&(n+=2),1===t.room_info.meal_info.has_dinner&&(n+=1),a=a&&n===this.search_filters.mealplan}else a=!1;if((a=(a=a&&(!this.search_filters.price_range||1==this.search_filters.price_range))&&(1!=this.search_filters.fc||t.cancellation_information&&t.cancellation_information.refund_info&&0<t.cancellation_information.refund_info.length&&"fully_refundable"===t.cancellation_information.refund_info[0].type))&&(r=!0),this.search_filters.price_slider_options&&this.search_filters.price_slider_options.selected){var o=this.search_filters.price_slider_options.min_selected,s=this.search_filters.price_slider_options.max_selected,c=t.price_user_currency;(s<c||c<o)&&(r=!1)}}if(r){i=t;break}}return _r_(i)},i.prototype.processResult=function(e){if(_i_("50d:3d43b29c"),e&&e.data&&200==e.status){for(var i={},_=0,t=[],r=0;r<this.hotel_candidate_list.length;r++){var a=this.hotel_candidate_list[r],n=e.data[a];if(n&&-1==this.hotels_with_no_rate.indexOf(a)){var o=this.checkSearchFilters(n);if(o){_++,t.push(""+a);var s=f("div.sr_item[data-hotelid='"+a+"']").addClass("hasTPIRateAvailable");s.length&&(this.injectTPIIntoRoomBlock(s,o,e.exps||{}),i[a]={hotel_block:s,room_info:o},l(s,1))}}}0<_&&(_i_("50d:34dd03a1"),f("div.sr_item:not(.hasTPIRateAvailable)").each(function(){_i_("50d:5de3eb7b"),l(f(this),2),_r_()}),_r_(),c.send_postproc_request(t)),this.sortTpiRooms(i)}_r_()},i.prototype.sortTpiRooms=function(e){if(_i_("50d:333a9240"),1===this.searchresults_ordered_by_price&&this.wholesaler_configuration.b_fix_price_sorting){var o,s,c=this.hotel_info_prices;for(o in e){var i=(s=e[o]).room_info.price_user_currency;s.price=i}for(o in e){if(0!=(s=e[o]).hotel_block.find("div.distfromdest--highlight").length)continue;var l=f("div.sr_item.sr_property_block");l.each(function(e){_i_("50d:91092359");var i=f(this),_=i.data("hotelid"),t=Number(c[_]);if(t&&e!==l.length-1)for(var r=e+1;r<l.length;r++){var a=f(l.eq(r)).data("hotelid"),n=Number(c[a]);if(n&&n<t){if(_==o)return _r_(!1);return _r_(!0)}if(0!=n)break}if(t&&t>=s.price)return s.hotel_block.detach(),i.before(s.hotel_block),c[_]=""+s.price,_r_(!1);if(e===l.length-1)return s.hotel_block.detach(),i.after(s.hotel_block),c[_]=""+s.price,_r_(!1);_r_()})}}_r_()},i.prototype.injectTPIIntoRoomBlock=function(e,i,_){if(_i_("50d:d73645c4"),i.exotic_tax&&(p.stage(g,1),i.price_detail&&i.price_detail.price_pretty_pay_now_and_pay_later&&i.exotic_tax.is_citizen?p.stage(g,2):i.price_detail&&i.price_detail.total_pay_now_and_pay_at_property_price_pretty||!i.exotic_tax.is_citizen?i.price_detail&&i.price_detail.total_pay_now_and_pay_at_property_price_pretty||i.exotic_tax.is_citizen||p.stage(g,4):p.stage(g,3),1===p.track(g)))return _r_();if(B.env.tpi_search_config.b_children_total&&p.track(u)&&(p.stage(u,1),p.track(u)<2))return _r_();if(1<B.env.tpi_search_config.b_nr_rooms_needed&&p.track(m)&&(p.stage(m,1),p.track(m)<2))return _r_();var t;p.stage("PPXGFRURURYTbUdSUHTRLFZPeZYaAFZKVHXT",2),i.room_name&&(t=i.room_name),t||(t=i.room_info&&this.translations[i.room_info.booking_room_type]?this.translations[i.room_info.booking_room_type]:this.translations[20]);var r=0;this.rtl&&(r=1);var a=e.find(".room_details"),n=a.find(".sr_room_table"),o=a.find(".sr-cta-button-row");(b||v)&&(n=a.find(".sr_gr.sr-group_recommendation"));var s=i.price_detail&&i.price_detail.total_pay_now_and_pay_at_property_price_pretty?i.price_detail.total_pay_now_and_pay_at_property_price_pretty:i.price_formatted;if(1===n.length){var c=function(e,i){_i_("50d:2da03b31");var _,t={};t.header=e.find("thead").clone(),t.url=e.find(".roomrow").attr("data-link"),t.noScrollUrl=i.find("a").attr("href"),t.bookButtonText=i.find(".js-sr-cta-text").html(),b?(_=B.env.tpi_search_config,t.occupancy=B.jstmpl("b_tpi_occupancy_icons").render({fe_icons_limit:5,fe_num_adults:_.b_adults_total,fe_num_children:_.b_children_total,fe_show_plus_sign_on_children:1,fe_icons_size:10,fe_disable_tooltip:1})):v?(_=B.env.tpi_search_config,t.occupancy=B.jstmpl("b_tpi_occupancy_icons").render({fe_icons_limit:5,fe_num_adults:Math.ceil(_.b_adults_total/_.b_nr_rooms_needed),fe_icons_size:10,fe_disable_tooltip:1})):t.occupancy=e.find(".room_link").find("div").clone();return t.price=e.find(".smart_price_style").clone(),t.roomReinforcment=e.find(".sr_room_reinforcement").clone(),t.bookButton=i.clone(),_r_(t)}(n,o),l={b_tpi_room_name:t,b_tpi_price:s,b_tpi_url:c.noScrollUrl,b_has_breakfast:i.room_info.meal_info.has_breakfast,b_is_rtl:r,prc_stay_night_num:B.env.tpi_los,prc_search_config:B.env.tpi_search_config,exps:_};if(l.b_tpi_book_button_text=c.bookButtonText,2<this.occupancy&&!b&&!v&&(l.fe_occupancy=this.occupancy,a.contents().hide()),p.track(y),i.cancellation_information&&i.cancellation_information.refund_info){var f=i.cancellation_information.refund_info;l.b_free_cancel=0<f.length&&"fully_refundable"===f[0].type,"hu"===B.env.b_guest_country&&l.b_free_cancel&&f[0].penalty_end_date&&(l.b_free_cancel_until=f[0].penalty_end_date)}else l.b_free_cancel=!1;var d=B.jstmpl("b_tpi_room_block_room_integration").render(l);a.append(d),p.initAttributesTracking(a);var h=a.find(".sr_room_table[data-table-type=tpi]");null!=h&&null!=c&&((b||v)&&(o.hide(),a.find(".sr-group-recommendation__title").hide()),function(e,i,_,t){_i_("50d:b5d3242d"),i.find(".tpi_room_name").append(e.occupancy);var r=i.find(".normal_book_button_holder");e.price.html('<label class="bui-radio__label normal_price_label" for="tpi_wholesale_price_radio">'+e.price.html()+"</label>"),e.header.addClass("tpi_room_table_header"),i.hide(),i.prepend(e.header),r.append(e.bookButton),_.hide(),i.show(),i.find(".normal_price_label").addClass("tpi_radio_active"),_r_()}(c,h,n),function(e,i,_){_i_("50d:e4b2b53f");var t=_.find(".bfast-included-ribbon"),r=_.find(".no_cc_02"),a=_.find(".b-no-cc-reinforcement__spacing"),n=_.find("[data-trips-promotion]"),o=i.find(".tpi_room_name_holder");e.room_info.meal_info.has_breakfast||t.hide();r.hide(),a.hide(),_.find(".js_sr_persuation_msg").hide(),_.find(".c-unit-configuration").hide(),n.hide();var s=_.find(".ge-free-room-upgrade-ribbon"),c=_.find(".ge-free-room-upgrade-sr-text");(0<s.length||0<c.length)&&(s.hide(),c.hide());i.find(".tpi_book_button_holder").show(),o.show(),_r_()}(i,h,e),function(i,e){_i_("50d:404fbedd");var _=e.find(".tpi_button_room_integration");e.click(function(){}),_.click(function(e){_i_("50d:dd676a0a"),e.preventDefault(),window.open(i.noScrollUrl,"_blank"),_r_()}),e.find(".roomrow.entire_row_clickable").click(function(){_i_("50d:033af5e5"),p.customGoal(y,1),_r_()}),_r_()}(c,h)),function(e,i){_i_("50d:d41fc9d5");var _,t=e.price_detail&&e.price_detail.total_pay_now_and_pay_at_property_price_pretty,r=i.find(".roomPrice");_=e.exotic_tax&&e.exotic_tax.is_citizen&&!t&&2===p.track(g)?B.jstmpl.translations("tpi_percent_vat_may_apply",null,{percent:e.exotic_tax.value}):"inclusive"===e.price_inclusion||t?B.jstmpl.translations("sr_search_card_includes_taxes_charges"):B.jstmpl.translations("sr_hp_taxes_and_charges_exception");r.find(".tpi-price-inclusion__no-radio__caption").text(_),_r_()}(i,a),a.find(".roomrow").attr("data-link",c.url)}_r_()},e.onTpiData(function(e){_i_("50d:e1cdb1d1"),p.track("PPXGSCZRDbfHGFbDZSIPfLHXT"),p.stage("PPXGSCZRDbfHGFbDZSIPfLHXT",4),(new i).render(e),_r_()}),_r_()});