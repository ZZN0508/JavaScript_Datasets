!function(){try{var a=this;function t(t,n){return t||(x.log(n),0)}function r(t){return t}function u(t,n){for(var e=n.split(".");e.length&&t;)t=t[e.shift()];return t}function c(t,n){if(!Array.isArray(t))return!1;n=n||r;for(var e=0,o=t.length;e<o;e++)if(!0===n(t[e]))return!0;return!1}function l(t,n,e){return"string"==typeof(t=u(t,n))?t:e||""}function f(t,n){n=u(t,n);return Array.isArray(n)?n:[]}function p(t,n){for(var e=f(t,n),o=[],r=0,i=e.length;r<i;r++)o.push(s(e[r])?e[r]:{});return o}function s(t){return t&&t.constructor===Object}function h(t,n){t=(a.ButtonWebConfig||{})[t];return void 0===t?n:t}function g(t,n){t=h(t,n);return"string"==typeof t?t:n||""}function i(t,n){t=h(t,n);return"boolean"==typeof t?t:n||!1}function d(t){if("function"==typeof(t=h(t)))return t}function b(t,n){"function"==typeof t&&t.apply(a,Array.prototype.slice.call(arguments,1))}var n=void 0;function v(){return"try{"+g("siteCatalyst","s")+".tl(true,'e','usebutton')}catch(e){}"}function y(){return n=void 0===n?"function"==typeof u(a,g("siteCatalyst","s")+".tl"):n}function m(t,n){var e=document.createElement(t),o=Array.prototype.splice.call(arguments,1);"a"===t&&(e.rel="noskim",e.setAttribute("data-bttnio-link",1),y()&&e.setAttribute("onclick",v()));for(var r=0,i=o.length;r<i;r++)for(var s in o[r])o[r].hasOwnProperty(s)&&(e.style[s]=o[r][s]);return e}function k(t){var n,e=m("a");!function t(n,e){for(var o in e){var r=e[o];"[object Object]"===Object.prototype.toString.call(r)?t(n[o],r):n[o]=r}}(e,t),t=0;for(var o=(n=[]).length;t<o;++t)e.appendChild(n[t]);return e}var _=/^(?:track\.bttn\.io\/([^\/]+).*|(?!track)([^\.]+)\.bttn\.io(?:\/.*|$))/,A=m("a");function w(t){return t.replace(/^www./,"").toLowerCase()}function O(t){if(void 0!==(n=t.dataset.bttnioTargetHref))return n;var n=s(n=h("relativeLinkLocation"))?n:null,e=document.createElement("a");return e.href="/",n=null===n||e.hostname!==t.hostname?{hostname:t.hostname,port:t.port}:{hostname:l(n,"hostname",t.hostname),port:l(n,"port",t.port)},A.href=t.href,A.hostname=n.hostname,n.port&&(A.port=n.port),A.href}function j(t,n){var e=n.links_configuration,n=O(t);A.href=n;var o=w(A.hostname),r=A.pathname,i=function(){for(var t,n={},e=A.search.replace(/^\?/,"").split("&"),o=0,r=e.length;o<r;o++)n[(t=e[o].split("="))[0]]=decodeURIComponent(t[1]||"");return n}();if(e&&!t.getAttribute("data-bttnio-enhanced")&&!t.getAttribute("data-bttnio-link")){var s=p(e,"supported_hostnames");if(c(s,function(t){return o===w(l(t,"hostname"))}))return 1;if((n=p(e,"supported_bttnio_subdomains")).length){t=(o+r).match(_);if(t){var a=t[1]||t[2];if(c(n,function(t){return a.toLowerCase()===l(t,"subdomain")}))return 1}}return c(p(e,"supported_affiliates"),function(t){if(o!==w(l(t,"hostname")))return!1;var n=c(n=p(t,"query_url_keys"),function(t){if(t=l(t,"key"),i.hasOwnProperty(t)){var n=w(k({href:i[t]}).hostname);return c(s,function(t){return n===w(l(t,"hostname"))})}return!1}),e=c(e=p(t,"query_ids"),function(t){var n=l(t,"key");return!!i.hasOwnProperty(n)&&c(t=p(t,"values"),function(t){return l(t,"value")===i[n]})});return t=c(t=p(t,"pathname_ids"),function(t){var n,e=l(t,"regex");if(!e)return!1;try{n=new RegExp(e).exec(r)}catch(t){return!1}if(n){var o=n.slice(1);return c(t=p(t,"matches"),function(t){t:if(t=f(t,"values"),Array.isArray(o)&&Array.isArray(t)&&o.length===t.length){for(var n=0,e=o.length;n<e;n++)if(o[n]!==t[n]){t=!1;break t}t=!0}else t=!1;return t})}return!1}),n||e||t})}}function e(t){var n=a.XMLHttpRequest,e=N;this.a=t,this.c=n,this.b=e}function C(t,n,e,o,r,i){var s=new t.c;if(s.onreadystatechange=function(){if(4===s.readyState&&"function"==typeof i){var n,e=s.responseText,o=t.b;try{(n=a.JSON.parse(e))&&n.constructor===Object||(n={})}catch(t){o.log("Invalid JSON:"+e),n={}}i(n)}},s.open(n,t.a+e),Array.isArray(r))for(n=0;n<r.length;n++)s.setRequestHeader(r[n].l,r[n].value);s.setRequestHeader("X-BTNVersion","2.0.0"),o&&s.setRequestHeader("Content-Type","application/json"),s.send(o?function(t){try{return a.JSON.stringify(t)}catch(t){return"{}"}}(o):void 0)}function R(t,n,e,o,r){C(t,"POST",n,e,o,r)}function S(t){t+="=";for(var n,e=document.cookie.split(";"),o=0;o<e.length;o++){for(n=e[o];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}}function q(t,n,e,o){t=[t+"="+n,"path=/","max-age="+(void 0===e?31536e3:e)],o&&"string"==typeof o&&0<o.trim().length&&t.push("domain=."+o),document.cookie=t.join(";")}var I=/^sess-/;function o(t,n,e){var o,r,i,s=S("bttnsessionid");this.c=I.test(s)?s:void 0,this.f=n,this.m=e,this.a=t,this.c&&this.a.log("Restored sessionId: "+this.c),this.i=!!S("bttnlockout"),this.h=!1,this.g=null,this.b=[],this.j=!1,function(){for(var t,n={},e=(u(a.location,"search")||"").replace(/^\?/,"").split("&"),o=0,r=e.length;o<r;o++)2===(t=e[o].split("=")).length&&(n[t[0]]=t[1]);(n=n.btn_ref)&&q("bttnreferrertoken",n,void 0,g("referrerCookieDomain"))}(),this.i?this.a.log("bttnlockout cookie found: platform is not supported"):(h("enhanceLinks")&&(r=o=this,i=function(t){o.g=t,o.refresh()},(e=h("applicationId"))?r.h||(r.h=!0,function(t,n,e){C(t,"GET",n,null,null,e)}(r.f,"/v1/web-session/config?application_id="+e,function(t){r.h=!1,b(i,u(t,"object")||null)})):r.a.log("Missing ButtonWebConfig.application_id")),(t=h("siteCatalyst"))&&"function"!=typeof a[t].tl&&this.a.log("Invalidate SiteCatalyst detected: "+t+".tl is not a function"))}function L(t){this.a=t}o.prototype.refresh=function(r){var i=this,t=g("applicationId");i.i?i.a.log("Unsupported platform; will not make requests"):t?(i.b=function(t){if(!t.g)return[];for(var n=[].slice.call(document.querySelectorAll(g("linkSelector","a"))),e=[],o=0,r=n.length;o<r;o++)j(n[o],t.g)&&e.push(n[o]);return e.slice(0,50)}(i),i.b.length<1||(t=function(t,n,e){for(var o=[],r=h("userIdentifier"),i=0,s=n.length;i<s;i++)o.push({pub_ref:n[i].dataset.bttnioPubRef,href:O(n[i])});return t={application_id:t,links:o},e&&(t.session_id=e),r&&(t.thirdparty_id=r),t}(t,i.b,i.c),R(i.f,"/v1/web-session/get-buttons",t,null,function(t){if("error"in t)i.a.log("Error enhancing links: "+u(t,"error.message")),b(r,!1,[]);else{var n=u(t,"object.supported_os");if(i.j||(i.j=!0,b(d("onLoad"),n)),n){var e=(n=u(t,"object.links")||[]).length,o=l(t,"object.session_id");if(t=[],i.c&&o===i.c||i.a.log("Initiating new session: "+o),q("bttnsessionid",i.c=o),e===i.b.length)for(o=0;o<e;o++)n[o]&&(i.b[o].href=n[o],i.b[o].setAttribute("rel","noskim"),i.b[o].setAttribute("data-bttnio-enhanced",1),y()&&i.b[o].setAttribute("onclick",v()));b(d("onButtonsLoaded"),t),b(r,!0,t)}else i.a.log("Received unsupported platform signal. Will set bttnlockout cookie"),q("bttnlockout","1",14400)}}))):i.a.log("Error: No applicationId present in ButtonWebConfig!")},o.prototype.logout=function(){q("bttnsessionid","",0)},o.prototype.reportEvent=function(t,n,e){var o;this.c?this.i?this.a.log("Platform not supported, will not report events"):(t={name:t},s(n)&&(t.value=n),t=[t],o=e,R((e=this).f,"/v1/web-session/events",{session_id:e.c,events:t},null,function(t){"function"==typeof o&&o("ok"===u(t,"meta.status"))})):this.a.log("No Button session â€“ cannot report events")},o.prototype.getReferrerToken=function(){return S("bttnreferrertoken")},o.prototype.reportOrder=function(t,n){var e,o,r;s(t)?(e=g("applicationId"))?(e=a.btoa(e+":"),o=S("bttnreferrertoken"),r=i("reportAllOrders"),o||r?(o&&(t.btn_ref=o),R(this.m,"/v1/mobile-order",t,[{l:"Authorization",value:"Basic "+e}],function(t){"function"==typeof n&&n(t)})):this.a.log("Missing btn_ref")):this.a.log("Missing ButtonWebConfig.application_id"):this.a.log("Invalid order, cannot post")},L.prototype.log=function(t){this.a&&a.console&&a.console.log("[Button]",t)};var B=a.__bttnio||"bttnio",N=new L(i("enableLogging",!1));if(u(a,B+".ok"))N.log("The ButtonJS snippet was loaded multiple times");else{var T=u(a,B+".q")||[],E=new e("https://web.usebutton.com"),H=new e("https://api.usebutton.com"),x=N,J=t(a.XMLHttpRequest,"No XMLHttpRequest")&&t(a.JSON,"No native JSON support")?new o(N,E,H):{};for(a[B]=function(){var t=[].slice.call(arguments),n=t.shift();if(n&&"function"==typeof J[n])return N.log(n+"("+t.join(",")+")"),J[n].apply(J,t)},a[B].ok=!0;T.length;)a[B].apply(this,T.shift())}}catch(t){}}();
