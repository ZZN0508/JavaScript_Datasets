var xmlPathSite="http://tv_html5.people.com.cn/",video_mp4=3,ptv_domain="people.com.cn",_replay=!1,_objName=null,ptvXmlDoc=null,ptvXmlhttp=null,b__ua=navigator.userAgent.toLowerCase(),isSafari=!!b__ua.match(/version\/([\d.]+).*safari/),isMac=-1!=b__ua.indexOf("macintosh"),isSafari=!0,isAndroid=-1!=b__ua.indexOf("android"),isUC=-1!=b__ua.indexOf("uc"),isIOS=-1!=b__ua.indexOf("iphone")||-1!=b__ua.indexOf("ipad")?1:0,isHTTPError=!1,safariObj=new Object,objname=null,clientWidth=document.body.clientWidth;function showPlayer(e){var t,a=e.name||"_v_p_"+Math.round(1e3*Math.random()),r=e.width||600;if(t=clientWidth<=600&&isSafari?(r=parseInt(.9*clientWidth),parseInt(r/1.3333)):"string"==typeof r&&-1!=r.indexOf("%")&&isSafari?isUC?(r=getVideoWH(r),parseInt(r/1.3333)):"auto":e.height||497.5,_replay=e.replay,_objName=a,e.cdn="100,0,0,0",e.sl="5",objname=a,isSafari)safariObj.w=r,safariObj.h=t,safariObj.name=a,safariObj.ap=e.autoplay,safariObj.fullscreen=e.fullscreen,safariObj.ori=e.ori,null!=safariObj.ap&&null!=safariObj.ap||(safariObj.ap=!0),safariObj.toid=e.showid,safariObj.xml=e.id,safariObj.xml||(safariObj.xml=e.xml),safariObj.xml?document.write('<script src="http://tvplayer.people.com.cn/getXML.php?path='+safariObj.xml+"&callback=playForMobile&ios="+isIOS+"&ori="+safariObj.ori+'" type="text/javascript"><\/script>'):(isHTTPError=!0,showVideoCodeInPage());else{var n,i=new Array;for(n in e)i.push(n+"="+_$_getTransStr(e[n]));isMaxthon()&&i.push("ism=1"),i.push("key="+_$_getPageKey());var o=i.join("&");1==e.fullscreen&&(t=r="100%");var s=2==e.skin?"http://tv.people.com.cn/img/2011ptv2/playerByOsmfnb.swf"+(isMaxthon()?"?"+Math.random():""):"http://tv.people.com.cn/img/2011ptv2/playerByOsmf.swf"+(isMaxthon()?"?"+Math.random():"");document.write('<object id="'+a+'" name="'+a+'" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,1,85,3" width="'+r+'" height="'+t+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ><param name="movie" value="'+s+'" /><param name="FlashVars" value="'+o+'" /><param name="wmode" value="opaque" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="true" /><embed name="'+a+'" width="'+r+'" height="'+t+'" src="'+s+'" wmode="opaque" allowFullScreen="true" allowScriptAccess="always" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" FlashVars="'+o+'" type="application/x-shockwave-flash"></embed></object>')}}function getVideoWH(e){var t=document.body.clientWidth,a=e.replace("%","");return e=parseInt(t*(a/100)*.9)}function playForMobile(t,e){1==safariObj.fullscreen&&(safariObj.w="100%",safariObj.h="100%"),t='<video id="'+safariObj.name+'" class="video-js vjs-default-skin" controls '+(safariObj.ap?'autoplay="autoplay"':"")+' width="'+safariObj.w+'" height="'+safariObj.h+'" poster="'+e+'" data-setup=\'{"example_option":true}\' <source src="'+t+'" type="video/mp4" /></video>';try{document.getElementById(safariObj.toid).innerHTML=t}catch(e){document.write(t)}}function isMaxthon(){return-1<window.navigator.userAgent.toLowerCase().indexOf("maxthon")}function _$_getTransStr(e){return("boolean"==typeof e?Number:escape)(e)}function _$_getPageKey(){try{var e=document.getElementById("videoadvertype").innerHTML.split(";"),t=e[1].split("="),a=new Array;a.push(t[1]);for(var r=2;r<e.length;r++)a.push(e[r]);var n=a.join(";");return encodeURIComponent(n)}catch(e){}n=window.location.href;return-1==n.indexOf("GB")?"":"人民电视:"+n.substring(n.indexOf("GB")+2,n.lastIndexOf("/")+1)}function _$_getSwfMovie(e){var t=document[e];return t?t.length?t[1]:t:window[e]}function changePlayerVideo(e,t){t&&_$_getSwfMovie(t).refreshPlayer(escape(e))}function setRelevantVideoToPage(e){e.shift();var t=document.getElementById("relevantVideoList");if(t){for(var a="",r=0;r<e.length;r++){var n=e[r];a+=(0==r?'<li onmouseover=this.className="current" onmouseout=this.className="current01" class="current">':'<li onmouseover=this.className="current" onmouseout=this.className="current01" class="current01">')+'<a href="'+n.link+'" titlr="'+n.title+'"><img src="'+n.image+'" width="80" height="60" alt="'+n.title+'" onerror="onErrorVideoImage(this)"  /></a><div class="txt"><h4><a href="'+n.link+'" titlr="'+n.title+'">'+n.title+"</a></h4><p><span>"+(""!=n.pt&&n.pt?n.pt:"")+"</span><span>"+(""!=n.len&&n.len?"时长："+n.len:"")+"</span></p></div></li>"}t.innerHTML=a;try{document.getElementById("relevantVideoNumber").innerHTML=e.length}catch(e){}}}function onErrorVideoImage(e){var t="http://tv.people.com.cn/img/2010tv_flash/tv_logo.jpg";return e&&(e.src=t),t}function setQuotePageInfo(e,t){try{document.getElementById("pageUrlInput").value=window.location.href}catch(e){}try{document.getElementById("flashUrlInput").value=e}catch(e){}try{document.getElementById("htmlCodeInput").value=t}catch(e){}}function loadByAjax(){null==(ptvXmlhttp=window.agentWindow.createHttpRequest())?(isHTTPError=!0,showVideoCodeInPage()):(ptvXmlhttp.open("GET",xmlPathSite+safariObj.xml,!0),ptvXmlhttp.setRequestHeader("Content-Type","text/xml"),ptvXmlhttp.onreadystatechange=getPtvVideoToApple,ptvXmlhttp.send(null))}function getPtvVideoToApple(){4==ptvXmlhttp.readyState&&200==ptvXmlhttp.status&&(null==(ptvXmlDoc=ptvXmlhttp.responseXML.documentElement)?isHTTPError=!0:(safariObj.video=getDecoderVideoForMP4(ptvXmlDoc.getElementsByTagName("video")[0].getElementsByTagName("item")[0].firstChild.nodeValue,ptvXmlDoc.getElementsByTagName("video")[0].getAttribute("type"),!1),"ERROR"==safariObj.video&&(isHTTPError=!0),parsePlayListXml(ptvXmlDoc.getElementsByTagName("associations")[0].getElementsByTagName("item"))),showVideoCodeInPage())}function getDecoderVideo(e,t){var a="";if(!e||""==e)return a;if(0!=e.indexOf("http://"))for(var r=0;r<e.length;){var n=e.charCodeAt(r++),i=e.charCodeAt(r++);a=(a=a.concat(String.fromCharCode(i-3))).concat(String.fromCharCode(n-3))}else a=e;if(a=trimString(a),t)return a;var o=a.substr(7,4).toLowerCase(),t=a.substr(-3).toLowerCase();return"flv2"!=o||"mp4"!=t&&"f4v"!=t?"flv."==o&&"mp4"==t||(a="ERROR"):(t=a.substring(a.lastIndexOf("/")+1,a.lastIndexOf(".")),a=a.substring(0,a.lastIndexOf("/")+1)+t+".ssm/"+t+".m3u8"),a}function getDecoderVideoForMP4(e,t,a){var r="";if(!e||""==e)return r;if(0!=e.indexOf("http://"))for(var n=0;n<e.length;){var i=e.charCodeAt(n++),o=e.charCodeAt(n++);r=(r=r.concat(String.fromCharCode(o-3))).concat(String.fromCharCode(i-3))}else r=e;if(r=trimString(r),a)return r;var s=r.substr(7,4).toLowerCase(),a=r.substr(-3).toLowerCase();return"flv2"!=s||"mp4"!=a&&"f4v"!=a?"flv."==s&&"mp4"==a?3==t&&(r=joinForMP4(r)):r=3==t?joinForMP4(r):"ERROR":r=3==t?joinForMP4(r):(t=r.substring(r.lastIndexOf("/")+1,r.lastIndexOf(".")),r.substring(0,r.lastIndexOf("/")+1)+t+".ssm/"+t+".m3u8"),r}function joinForMP4(e){var t=e.indexOf(ptv_domain)+ptv_domain.length+1;return e=e.substring(0,t)+"hls-vod/"+e.substring(t)+".m3u8"}function trimString(e){for(var t=(e=e.replace(/^(\s|\u00A0)+/,"")).length-1;0<=t;t--)if(/\S/.test(e.charAt(t))){e=e.substring(0,t+1);break}return e}function showVideoCodeInPage(){var t=isHTTPError?'<div style="width:'+safariObj.w+"px;height:"+safariObj.h+"px;background:#000;line-height:"+safariObj.h+'px;text-align:center;color:#fff;font-size:14px;clear:both;padding:0 20px;">此视频暂时不支持苹果设备，请在电脑上浏览观看！</div>':'<video width="'+safariObj.w+'" height="'+safariObj.h+'" controls="controls" '+(safariObj.ap?'autoplay="autoplay"':"")+' id="'+safariObj.name+'" src="'+safariObj.video+'"></video>';try{document.getElementById(safariObj.toid).innerHTML=t}catch(e){document.write(t)}}function parsePlayListXml(e){var t=new Array;t.push(null);for(var a=0;a<e.length;a++)t.push(getPlayListObject(e[a]));setRelevantVideoToPage(t)}function getPlayListObject(e){var t=new Object;return t.link=getXMLNodeValue(e,"staticpage"),t.title=getXMLNodeValue(e,"title"),t.image=getDecoderVideo(getXMLNodeValue(e,"image"),!0),t.pt=getPLTimeByNumber(getXMLNodeValue(e,"publishDate")),t.len=getLENTimeByNumber(getXMLNodeValue(e,"length")),t}function getXMLNodeValue(e,t){try{return e.getElementsByTagName(t)[0].firstChild.nodeValue}catch(e){return""}}function getPLTimeByNumber(e){if(""==e)return"";e=new Date(Number(e));return e.getFullYear()+"-"+checkNumberString(e.getMonth()+1)+"-"+checkNumberString(e.getDate())+" "+checkNumberString(e.getHours())+":"+checkNumberString(e.getMinutes())+":"+checkNumberString(e.getSeconds())}function getLENTimeByNumber(e){if(""==e)return"";e=new Date(Number(e));return(0<e.getUTCHours()?checkNumberString(e.getUTCHours())+":":"")+checkNumberString(e.getUTCMinutes())+":"+checkNumberString(e.getUTCSeconds())}function checkNumberString(e){return e<10?"0"+e:e.toString()}function controlWidescreen(e){document.getElementById(objname).style.width="600px"}function rmw_videoPlayOver(e){_replay&&changePlayerVideo(e,_objName)}
