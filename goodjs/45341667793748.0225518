(this.$WP=this.$WP||[]).push(["eFKnUp",(e,t)=>{"use strict";var i,o,r,n,a,s,c,p,l,d,u,m=e=>e.photo&&e.photo.photoSizes[e.photo.photoSizes.length-1]?e.photo.photoSizes[e.photo.photoSizes.length-1]:null,v=e=>{var t=e.owner||e.userProfile,t=t?[t]:[];return i("trips_2018_collab")&&(e=(e.collaborators||[]).map(e=>e.user).filter(Boolean),t=t.concat(e)||[]),t},P=(e,t)=>v(e).some(e=>e.isMe||e.userId&&e.userId===t||e.id&&e.id===t),f=e=>{var t;return null!=(t=e.owner)&&t.isMe?"OWNER":e&&P(e)?"COLLABORATOR":"PUBLIC"},h=(e,t)=>i("trips_2018_collab")?e.actionPermissions:{canAddCollaborators:t,canAddItem:t,canChangePrivacy:t,canDelete:t,canEdit:t,canUploadCoverPhoto:e.actionPermissions&&e.actionPermissions.canUploadCoverPhoto&&t},y=(e,t)=>i("trips_2018_collab")?e.actionPermissions:{canRemove:t},_=(e,t)=>i("trips_2018_collab")?e.actionPermissions:{canAddComment:t,canEdit:t,canRemove:t},b=(e,t)=>i("trips_2018_collab")?e.actionPermissions:{canEdit:t,canRemove:t},I=(e,t,o,r)=>{var i,e=v(e);return e=e.slice(0,t),0<o&&(i=0,e=e.filter(e=>(i=e.displayName.length+i)<o)),e=r?e.reverse():e},g=(t,e,o)=>{var r=o&&o.id,o=i("trips_2018_collab")?()=>!0:e=>e.author.id===r||"ITEM"===e.targetType&&e.targetId!==t.id;return(e||[]).filter(o).sort((e,t)=>e.created>t.created?1:-1)},T=e=>{var t;return null==e||null==(t=e.owner)?void 0:t.isMe},w=e=>e.owner&&e.owner.isMe?"OWNER":P(e)?"COLLABORATOR":"VIEWER",O=(e,a)=>(e.items||[]).find(e=>{var t=e.reference&&e.reference.type&&e.reference.type.toLowerCase(),o=null==(n=e.reference)?void 0:n.id,r=a.type.toLowerCase(),i=a.id.toString(),e=a.originalObject&&a.originalObject.type&&a.originalObject.type.toLowerCase(),n=a.originalObject&&a.originalObject.id.toString();return t===r&&o===i||t===e&&o===n}),R=(e,t)=>{t=O(e,t);return t?t.id:null},S={locationinformation:"location",attractionproductinformation:"attractionProduct",forumpost:"post",tripitem:"savesItem",linkpost:"link",linkpost_linkpostv2:"link",photo:"photo",video:"video",review:"review",repost:"repost",trip:"bundleSave",tripnotes_tripnote:"note"},L={locationinformation:"LOCATION",attractionproductinformation:"ATTRACTIONPRODUCT",forumpost:"POST",tripitem:"SAVESITEM",linkpost:"LINK",photo:"PHOTO",video:"VIDEO",review:"REVIEW",repost:"REPOST",trip:"TRIPCONTENT"},C=e=>({statQuery:e}),k=e=>S[e.toLowerCase()],j=e=>L[e.toLowerCase()],E=["LocationInformation","AttractionProductInformation","ForumPost","LinkPost","LinkPost_LinkPostV2","Review","Photo","Video","Repost","Trip","TripNotes_TripNote"],A=e=>{switch(e.__typename){case"AttractionProductInformation":case"LocationInformation":return[e];case"Photo":case"Review":return[e.location];case"Video":return e.orderedLocations;default:return[]}},V=(e,t)=>{if(!e)return null;var o=e.locationId||e.attractionProductId||e.postId||e.repostId||e.linkPostId||e.id||void 0,r=e.__typename?k(e.__typename):null;if(o&&r){if(E.includes(e.__typename))return{type:r,id:o};var i={id:e.reference.id,type:"attractionproduct"===e.reference.type?"attractionProduct":e.reference.type};if("TripItem"===e.__typename&&e.reference&&e.reference.id&&e.reference.type)return t&&"note"!==i.type?i:{type:r,id:o,originalObject:i}}return null},F=e=>({id:""+e.id,type:e.type}),N=(e,t)=>`/Trips/${e}${t?"?itemId="+t:""}`,U=e=>{var t=u[e.type];return t?Object.assign({},e,{query:t.statQuery,variables:{ids:[e.id]}}):null},z=e=>{var t,o;return["LinkPost","Photo","Review","Video"].includes(null==e||null==(t=e.object)||null==(o=t.repostedObject)?void 0:o.__typename)},B=(e,t)=>{if("_blank"!==t)return()=>{window.open(e,t)};var o=window.open("about:blank",t);return()=>{o.location=e}};function M(e,o){return e.reduce((e,t)=>((o(t)?e[0]:e[1]).push(t),e),[[],[]])}var W=e=>{if("LinkPost_LinkPostV2"===e.__typename){var t=e.preview&&e.preview.media||[];if(!t.length)return[];var[o,t]=M(t=t.reduce((e,t)=>t&&t.object?[...e,t]:e,[]).sort((e,t)=>t.id-e.id),e=>"LinkPreview_PhotoRefV2"===e.__typename);if(o.length){var[o]=o;return o.object&&o.object.photoSizes||[]}if(t.length){var[r]=t;return r.object?[r.object]:[]}}if("LinkPost"===e.__typename){r=e.preview&&e.preview.media||[];if(!r.length)return[];var i=e=>e.photoId||e.previewId||0,[e,r]=M(r=r.filter(Boolean).sort((e,t)=>i(t)-i(e)),e=>"Photo"===e.__typename);if(e.length){var[e]=e;return e.photoSizes||[]}if(r.length)return[r[0]]}return[]};return[()=>{u=Object.freeze({location:C(d),attractionProduct:C(o),post:C(r),savesItem:C(n),link:C(a),review:C(s),photo:C(c),video:C(p),repost:C(l)}),e({buildPublicTripShareUrl:N,getCollabPermissions:y,getCommentPermissions:b,getCommentsForDisplay:g,getItemByReference:O,getItemIdByReference:R,getItemPermissions:_,getPhotoSizesForLinkPost:W,getQueryReferenceTypeFromObjectType:j,getReferenceTypeFromObjectType:k,getTripCoverPhoto:m,getTripPermissions:h,getTripUsers:v,getTripUsersForDisplay:I,isOwner:T,isRepostSaveable:z,isTripUser:P,locationsForItem:A,objectStatisticQuery:U,toReference:F,toSavesObject:V,userRelation:w,userTypeFromTrip:f,windowOpener:B})},[e=>i=e.featureIsEnabled,e=>(o=e.AttractionStatistics,r=e.ForumStatistics,n=e.TripItemStatistics,a=e.LinkPostStatistics,s=e.ReviewStatistics,c=e.PhotoStatistics,p=e.VideoStatistics,l=e.RepostStatistics,d=e.LocationStatistics)]]},["-i3PJS","RXx5aI"]]);
