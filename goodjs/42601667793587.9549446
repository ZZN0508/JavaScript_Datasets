!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("wafer-uac",[],t):"object"==typeof exports?exports["wafer-uac"]=t():(e.wafer=e.wafer||{},e.wafer.wafers=e.wafer.wafers||{},e.wafer.wafers["wafer-uac"]=t())}("undefined"!=typeof self?self:this,function(){return n={"./src/base.js":function(e,t,n){"use strict";function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}Object.defineProperty(t,"__esModule",{value:!0});function i(){var e=document.documentElement.clientWidth,t=k[0],n=!0,a=!1,i=void 0;try{for(var r,o=k.entries()[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var d=h(r.value,2),s=d[0];e>h(d[1],2)[1]&&(t=k[s])}}catch(e){a=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw i}}return t}function y(e){var t=void 0===(o=e.ads)?{}:o;if(0===Object.keys(t).length)return{};var n=document.documentElement.clientWidth,a=t.display_0||{},i=!0,r=!1,o=void 0;try{for(var d,s=k.values()[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var l=h(d.value,2),c=l[0],u=l[1],f=t[c];f&&u<n&&f&&(a=f)}}catch(e){r=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return a}var r=function(e,t,n){return t&&C(e.prototype,t),n&&C(e,n),e},h=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,i=!1,r=void 0;try{for(var o,d=e[Symbol.iterator]();!(a=(o=d.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){i=!0,r=e}finally{try{!a&&d.return&&d.return()}finally{if(i)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=window.wafer,p=o.base,m=o.features,d=o.utils,o=o.WaferBaseClass,s=d.fetchWithCache,w=d.elementInView,l=d.throttle,v=d.convertNodeListToArray,c=["scroll"],g="gemini",b="C5VPNN3HH87ZR8M33TBQ",u="uac:item",_="gemini:item",f=["onAdReady","loadElement","bindMutationObserver","injectMarkupBesideNode","destroy"],A="GEMINI: NO ADS RETURNED",k=[["display_0",0],["display_480",480],["display_754",754],["display_900",900],["display_1128",1128],["display_1265",1265],["display_1450",1450]],r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(E,o),r(E,[{key:"isMobile",value:function(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0);return t<e&&t<=500&&e<=900||e<t&&e<=500&&t<=900}},{key:"setupMobileHeaderBidding",value:function(){if(this._util.elem,!window.headerBiddingConfigured&&window.atwHeaderBid){window.headerBiddingConfigured=!0;var e=v(document.getElementsByClassName("wafer-uac")),t=[],n=[],a=!0,i=!1,r=void 0;try{for(var o,d=e[Symbol.iterator]();!(a=(o=d.next()).done);a=!0){var s=o.value.dataset.wfUacConfig,l=void 0===s?{}:s,c=void 0;try{c=JSON.parse(l)}catch(e){return}var u,f,h,y=c.ads.display_0;void 0!==y&&(u=y.magicNumber,f=y.width,h=y.height,u&&(p=w=p=w=m=p=void 0,p=y.width,m=void 0===p?"":p,w=y.height,p=void 0===w?"":w,w=Number(m),p=Number(p),!("mm"===String(m).toLowerCase()||728===w&&90===p||300===w&&250===p||320===w&&50===p)||-1<n.indexOf(u)||(n.push(u),f&&"mm"===f.toLowerCase()?t.push({mn:u,width:"mm"}):f&&h&&t.push({mn:u,sizes:[[f,h]]}))))}}catch(e){i=!0,r=e}finally{try{!a&&d.return&&d.return()}finally{if(i)throw r}}window.atwPreBid={resizePortrait:"1",mns:t},window.atwHeaderBid()}var p,m,w}},{key:"onAdReady",value:function(e){var n=this,t=e.adConfig,a=e.placementNode,e=a.closest(".wafer-uac");e&&(e.classList.add("is-ready"),!0===t.isBlank?e.classList.add("is-blank"):e.classList.remove("is-blank"),0<=a.id.indexOf("ad_dl")&&this.getDLAdData(a).then(function(e){var t=n.adConfig.index;return e.index=t,n.fetchSlideMarkup({modId:"tdv2-wafer-dl",ctrl:"DLPagination",data:e})}).then(function(e){e=e.html;n.injectMarkupBesideNode(a,e)}))}},{key:"addWaferListeners",value:function(){var t=this;window.wafer.ready(function(e){c.forEach(function(e){window.wafer.on(e,t.syncWithThrottle)})})}},{key:"removeWaferListeners",value:function(){var t=this;window.wafer.ready(function(e){c.forEach(function(e){window.wafer.removeListener(e,t.syncWithThrottle)})})}},{key:"handleResize",value:function(){var e;document.getElementById("act-labs-holder")||(e=i(),h(e,2)[1]!==h(this.activeBreakpoint,2)[1]&&(this.activeBreakpoint=e,this._state.isLoaded=!1,this.addWaferListeners(),this.loadElement()))}},{key:"loadElement",value:function(){var e=this._util,t=e.elem,n=e.trigger,a=this._state,i=a.isLoaded,r=a.hasAdsRotate;if(!i&&("onView"!==n||w(t,{},p.viewport))){this._state.isLoaded=!0,this.removeWaferListeners();var o=this.adConfig,d=o.placement,s=o.index,l=document.getElementById(d),c=y(this.adConfig);if(c){var u=c.isGeminiAd,f=c.geminiApiKey,h=void 0===f?b:f,a=c.geminiAdUnitCode,i=c.magicNumber,n=c.adSetType,o=c.height,f=c.width,c=c.dynamicSizes;if(u)this.fetchGeminiAd({apiKey:h,adType:g,adUnitCode:a}).then(this.fetchMarkupAndRenderAd(_,s,l));else if(i)try{(m.mutationObserver&&this.bindMutationObserver(),r&&window.adsRotateMult(d),c&&""!==c)?window.htmlAdWHDyn(i,c,n,d):(window.htmlAdWH(i,f,o,n,d),t.classList.add(E.prototype.configs.successClass))}catch(e){this.destroy()}}}}},{key:"bindMutationObserver",value:function(){var i=this,r=this._util.elem,e=this.adConfig.placement,o=document.getElementById(e),d=y(this.adConfig),s=0,l=!0,c=!1,u=!(0<=r.id.indexOf("ad_dl")&&"filelesstext"===d.adSetType);new MutationObserver(function(e){if(20<=s)this.disconnect();else{20<e.length&&(e=e.slice(e.length-20));for(var t=0;t<e.length;t++){var n=e[t],a=n.target;u?"childList"===n.type?(n.addedNodes&&n.addedNodes.length&&"DIV"===n.addedNodes[0].tagName&&0<=n.addedNodes[0].className.indexOf("gemini")&&(a=n.target.previousElementSibling),(l=a.getBoundingClientRect().height<50)&&"0"!==d.adSetInView&&(d.adIsBlank=!1)):"attributes"===n.type&&"style"===n.attributeName&&("none"===r.style.display||"0px"===r.style.height)&&o.getBoundingClientRect().height<50&&(d.adIsBlank=!0):"childList"===n.type&&n.addedNodes.length&&"DIV"===n.addedNodes[0].tagName&&(c=u=!0)}u&&i.onAdReady({elem:r,adConfig:d,placementNode:o}),d.isBlank=l,c&&this.disconnect(),s++}}).observe(o,{childList:!0,attributes:!0,attributeFilter:["style"],subtree:!0})}},{key:"fetchMarkupAndRenderAd",value:function(t,n,a){var i=this;return function(e){e.placementType=t,e.index=n,i.fetchSlideMarkup({modId:"tdv2-wafer-dl",ctrl:"DLPagination",data:e}).then(function(e){e=e.html;i.injectMarkupBesideNode(a,e)})}}},{key:"fetchGeminiAd",value:function(e){var i=this,r=e.apiKey,o=e.adUnitCode,e=e.adType;return r&&e===g&&o?new Promise(function(t,n){var e="?cb=__fetchGeminiAdCb&local=en_us&agentVersion=205&adTrackingEnabled=true&totalAds=10&publisherUrl="+(window.location.href.match(/http:\/\/localhost/)?"www.aol.com":window.location.href)+"&apiKey="+r+"&adUnitCode="+o;window.__fetchGeminiAdCb=function(e){try{t(i.extractGeminiAdData(e))}catch(e){n(e)}};var a=document.createElement("script");a.src="https://ads.yap.yahoo.com/nosdk/wj/v1/getAds.do"+e,document.getElementsByTagName("head")[0].appendChild(a)}):Promise.reject(new Error("FetchGeminiAd failed: required params (apiKey, adUnitCode, adType)"))}},{key:"extractGeminiAdData",value:function(e){if(!e||e.error)throw new Error(e);var t=e.ads;if(!t||t.length<=0)throw new Error(A);e=Math.floor(Math.random()*t.length);return void 0!==t[e]?t[e]:t[0]}},{key:"fetchSlideMarkup",value:function(e){var t=e.mode,n=e.modId,a=e.ctrl,i=e.data,e=this._util.tdv2AjaxPath,i=JSON.stringify({m_mode:void 0===t?"json":t,m_id:n,ctrl:a,data:[i]});return s(e,{body:i})}},{key:"injectMarkupBesideNode",value:function(e,t){try{var n=document.createElement("div");n.innerHTML=t;var a=n.querySelector(".slides .dl__slide");n.innerHTML=a&&a.innerHTML||t,e.nextSibling&&e.parentNode.removeChild(e.nextSibling),e.insertAdjacentElement("afterend",n),setTimeout(function(){p.emitWaferEvent("uac:adinjected",{elem:e.parentNode,ad:e,adMarkup:n}),p.sync(e.parentNode)},25)}catch(e){this.destroy()}}},{key:"isGeminiPlacement",value:function(e){return e&&("gemini"===e||"NATIVE"===e)}},{key:"getDLAdData",value:function(e){var a=this,i=JSON.parse(e.getElementsByClassName("ad-code")[0].textContent),r=i.adType,o=i.apiKey,d=i.adUnitCode,e=i.views,s=void 0===e?[]:e;return new Promise(function(t,n){if(!a.isGeminiPlacement(r))return i.placementType=u,t(i);a.fetchGeminiAd({apiKey:o,adUnitCode:d,adType:r}).then(function(e){return e.tag=e.tag||{},e.tag.imprTrackingUrl=e.tag.imprTrackingUrl||[],e.tag.imprTrackingUrl=e.tag.imprTrackingUrl.concat(s),e.placementType=_,t(e)}).catch(function(e){n(e)})})}},{key:"destroy",value:function(){this._state.isLoaded=!1}}]),E);function E(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,E);var t=a(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,e,{},{})),n=e.dataset.wfUacConfig,n=void 0===n?{}:n;t._util={elem:e,trigger:e.getAttribute("data-wf-trigger")||"onLoad",tdv2AjaxPath:e.getAttribute("data-wf-tdv2-path")||"/_td/remote"},t._state={isLoaded:!1,hasAdsRotate:null!==window.location.host.match(/aol.com/)};try{t.adConfig=JSON.parse(n)}catch(e){return a(t)}return window.headerBiddingConfigured=window.headerBiddingConfigured||!1,t.isMobile()&&t.setupMobileHeaderBidding(),f.forEach(function(e){t[e]=t[e].bind(t)}),t.syncWithThrottle=l(function(){t.loadElement()},100,t),t.activeBreakpoint=i(),t.addWaferListeners(),t.loadElement(),t}function C(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}r.prototype.configs={selector:".wafer-uac",successClass:"wafer-uac-done"},t.default=r,e.exports=t.default},"./src/controller.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,a=arguments[t];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},n=function(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),e},a=window.wafer,d=a.controllers.WaferBaseController,a=a.utils,s=a.bindEvent,l=a.loadScriptAsync,c=a.getConfigFromJSONScriptNode,u=[9,24,39],f=["fi_1374016173","fi_ad_leaderboard"],h=0,n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(y,d),n(y,[{key:"ensureUacLibraryIsReady",value:function(){var a=this,e=this._state.asyncUacLibLoadComplete,t=this._utils,i=t.adsWrapperScript,t=t.useIntlAdsWrapper,r=void 0!==t&&t?"https://s.aolcdn.com/ads/adsWrapperIntlAOL.min.js":"https://s.aolcdn.com/ads/adsWrapperAOL.min.js";return e||"function"==typeof window.htmlAdWH?Promise.resolve(!0):new Promise(function(t,n){l({src:i||r},function(e){return e?(a._state.asyncUacLibLoadComplete=!0,void n()):(a._state.asyncUacLibLoadComplete=!0,void t(!0))})})}},{key:"reloadAd",value:function(e){e=e.detail;e&&window.adsReloadAd&&((e=document.getElementById(e))&&window.adsReloadAd(e))}},{key:"loadElement",value:function(e,t){t&&this.sync()}},{key:"willValidate",value:function(e){var t=this._state.elementInstances;e.forEach(function(e){e=t.get(e);e.instance._state.isLoaded||e.instance.loadElement()})}},{key:"addEventListeners",value:function(){s(window,"uac:reload",this.reloadAd),window.wafer.on("dl:change",this.refreshAds)}},{key:"refreshAds",value:function(e){var t=e.elem,n=e.meta,a=void 0===n?{index:!1}:n;if(t.classList.contains("dl")&&a.index){var i=t.dataset||{},r=i.wfAdRefreshLimit,o=i.wfAdRefreshIndexes,d=i.wfAdRefreshIds,n=3,t=u,i=f;if(r&&(r=parseInt(r,10),window.isNaN&&!window.isNaN(r)&&(n=r)),o)try{t=JSON.parse(o)}catch(e){}if(d)try{i=JSON.parse(d)}catch(e){}n<=h||-1===t.indexOf(a.index)||!window.adsReloadAd||!window.adsRotateMult||(h++,i.forEach(function(e){var t=document.getElementById(e),n=!!document.getElementById("act-labs-holder");!t||n&&"fi_ad_leaderboard"===e||(window.adsReloadAd&&window.adsReloadAd(t),window.adsRotateMult&&window.adsRotateMult(e))}))}}}]),y);function y(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.root,t=void 0===t?document:t,e=e.selector,e=void 0===e?".wafer-uac":e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y);var n,a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,{root:t,selector:e,WaferClass:(r||(n=i("./src/base.js"),r=n&&n.__esModule?n:{default:n})).default})),n=c(document.getElementById("wafer-uac-config"));return a._utils=o({},a._util,n),a._state=o({},a._state,{asyncUacLibLoadComplete:!1}),a.ensureUacLibraryIsReady().then(function(){a.sync()}).catch(function(e){}),window.wafer.ready(function(){a.addEventListeners()}),a}function p(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}n.prototype.configs={selector:".wafer-uac",successClass:"wafer-uac-done",allowPrefetch:!0},t.default=n,e.exports=t.default},"./src/entry.js":function(e,t,n){"use strict";var a,i;Object.defineProperty(t,"__esModule",{value:!0}),t.default=new(a||(i=n("./src/controller.js"),a=i&&i.__esModule?i:{default:i})).default({}),e.exports=t.default}},i={},a.m=n,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="https://s.yimg.com/aaq/wf/",a(a.s="./src/entry.js");function a(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}var n,i});
