!function(){var e,t,a,i,o,r,n,l,s,p,h,d,c,g,y,_;try{(t=(e=window.$MicrosoftMaps8).Internal).TaskData=t.TaskData||{};e.Anchor,e.BasicMapAnimation,e.BirdseyeV2Metadata,e.BitmapImageTemplate,t._BoundsAccumulator,t._ComponentNames;var u=t.Control,m=t.ControlTemplate,f=(t._BaseMapTemplateSelector,e.Internal._Debug),C=(e.DefaultTemplateSelector,t.DelayLoadedObject,t._EntityHelper,t._EntryPoints,t._FeatureNames,e.GlobalConfig),S=(t._Gimme,t._Helper),v=(e.ImageryMapLayer,t._JSEvent),T=(t._LatLonCrs,e.LocationRect,t._LocalStorageCache,t._LoggerConstants,t._LruCache,e.MapMath,C.features.mapDelay,e.MapQuadrant),b=e.MapTypeId,L=(t._MercatorTileId,t._MercatorTileUtility,e.MapView,e.Location,t._Network,t._Observable,t._ObservableObject),O=t._Overlay,M=(e.Point,e.PrimitiveOverlayHelper,e.RasterImageryScene,e.Rectangle,e.ResourceManager.MapDelay),B=(e.SimplePointPrimitive,e.Size,C.features.streetside,C.features.sharing,C.features.traffic,e.VectorImageTemplate,e.VectorMapLayer,t._VectorMath,e.Viewport,e.ZoomLevel),x=this&&this.__extends||(_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)},function(t,e){function a(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}),w=(x(K,y=u),K.prototype._updateCopyright=function(){var o=this;this._map&&this._map.getCopyrights(function(t){var e,a,i="";for(o._copyrightWithLink=null,e=0,a=t.length;e<a;e++)if(0<=t[e].indexOf("http")){o._copyrightWithLink=t.splice(e,1)[0];break}i=t.join(", "),o._updateCopyrightLinkDiv()&&(i+=", "),o.copyrightString!==i&&(o.copyrightProviders=t,o.copyrightString=i,o.setCopyrightAttributions&&o.setCopyrightAttributions(i),o._updateCopyrightSize(),o.copyrightUpdated.invoke())})},K.prototype._onMapTypeChanged=function(t){var e=this,a=t.newMapTypeId!==b.birdseyeV2||!C.isMapsVertical;this.setVisible(t.newMapTypeId!==b.streetside&&a),t.oldMapTypeId===b.aerial||t.oldMapTypeId===b.birdseye||t.newMapTypeId!==b.aerial&&t.newMapTypeId!==b.birdseye||this.setShadowTextStyle("ShadowTextLight"),t.oldMapTypeId!==b.aerial&&t.oldMapTypeId!==b.birdseye||t.newMapTypeId===b.aerial||t.newMapTypeId===b.birdseye||this.setShadowTextStyle("ShadowTextDark"),Microsoft.Maps.setTimeout(function(){e._updateCopyright()},0)},K.prototype._updateCopyrightLinkDiv=function(){var t,e,a,i=!1;return this._copyrightWithLink&&(0<=this._copyrightWithLink.indexOf("href")?(a=(new DOMParser).parseFromString(this._copyrightWithLink,"text/xml"))&&a.firstChild&&(a=(e=a.firstChild).textContent,e=e.attributes.getNamedItem("href")&&e.attributes.getNamedItem("href").nodeValue,a&&e&&(this.setCopyrightLinkText(a),this.setCopyrightLinkHref(e),i=!0)):3<=(t=this._copyrightWithLink.trim().split(" ")).length&&(i=!0,this.setCopyrightLinkText(t[0]+" "+t[1]),this.setCopyrightLinkHref(t[2]))),t=i?"":"none",this.getRootElement().select(".copyrightLink").set_style({display:t}),i},K.prototype._updateCopyrightSize=function(){var t;this._minStart||this._updateMinStart(),this._maxEnd||this._updateMaxEnd(),(this._map.getConfig().useOverlayQuadrants?this.getRootElement().get_absolute_pos():this.getRootElement().get_relative_pos()).x<this._minStart?this.getRootElement().add_class("multiLine"):this.getRootElement().remove_class("multiLine"),t=this._maxEnd-(this._minStart+1),this._copyrightControl.set_style({"max-width":parseInt(t+"",10)+"px"})},K.prototype._updateMinStart=function(){var t,e;this._map.getConfig().useOverlayQuadrants?(t=this._map.getMapOverlayManager())&&(e=t.getQuadrantForControl(this),this._minStart=t.getXStartForQuadrant(e)):this._minStart=this._map.getLogoEnd()},K.prototype._updateMaxEnd=function(){var t=document.getElementById("TermsLinkContainer");this._maxEnd=t?t.getBoundingClientRect().left:this._map.getActualSize().width},K._copyrightContainerTemplate='<div class="CopyrightContainer">',K._termsLinkTemplate='<div id="TermsLinkContainer" class="TermsLinkContainer"><a class="{TemplateBinding ShadowTextStyle}" href="{termsLink}" title="Terms" target="mc_bingMaps" style="pointer-events: auto">Terms</a></div>',K._copyrightControlTemplate='<div class="CopyrightControl"><span class="{TemplateBinding ShadowTextStyle}"><span class="CopyrightAttributionStyle"><TextBlock Text="{TemplateBinding CopyrightAttributions}"/></span>',K._clickableCopyrightTemplate='<a href="{TemplateBinding CopyrightLinkHref}" class="copyrightLink ShadowTextDark" style="pointer-events: auto"><TextBlock Text="{TemplateBinding CopyrightLinkText}"/></a>',K);m.registerControl("CopyrightControl",w),x(W,g=O),a=W,x(A,c=u),A.prototype._OnTouch=function(t){t.stopPropagation(),window.open(t.currentTarget.href)},A.prototype._updateHref=function(){var t=this._map.getView().cameraLocation,e=t.latitude,a=t.longitude,i=this._map.getMercatorZoomLevel(),t=this._map.getMapType().id.charAt(0);this.setBingHref(this._formattedHref(e,a,i,t))},A.prototype._formattedHref=function(t,e,a,i){return(location&&location.protocol?location.protocol:"https:")+this._hrefFormat.replace("{lat}",""+t).replace("{lon}",""+e).replace("{lvl}",""+a).replace("{style}",i)},A.prototype._onMapTypeChanged=function(t){this.setVisible(t.newMapTypeId!==b.streetside),this._setLogoStyle(t.newMapTypeId)},A.prototype._setLogoStyle=function(t){t===b.aerial||t===b.birdseye||t===b.birdseyeV2||t===b.canvasDark||t===b.roadDark?this.setLogoStyle("bingLogoDark"):this.setLogoStyle("bingLogoLight"),this._updateHref()},i=A,m.registerControl("LogoControl",i);var R=(x(j,d=O),j),k=(N.metersPerKm=1e3,N.yardsPerMeter=1.0936133,N.yardsPerMile=1760,N.feetPerYard=3,N.feetPerMeter=3.2808399,N.feetPerMile=5280,N),P=(x(H,h=L),H),D=(F.getScaleBarStyle=function(t){return t&&t.getConfig().useOverlayQuadrants?F._deserializeStyleObject(F._style.ScaleBarContainerQuadrant):F._deserializeStyleObject(F._style.ScaleBarContainer)},F.getScaleBarControlStyle=function(){return F._deserializeStyleObject(F._style.ScaleBarControl)},F.getShadowTextDarkStyle=function(){return F._deserializeStyleObject(F._style.ShadowTextDark)},F.getShadowTextLightStyle=function(){return F._deserializeStyleObject(F._style.ShadowTextLight)},F.getScaleBarRectStyle=function(){return F._deserializeStyleObject(F._style.ScaleBarRect)},F.getScaleBarRectFillStyle=function(){return F._deserializeStyleObject(F._style.ScaleBarRectFill)},F._deserializeStyleObject=function(t){var e,a,i=[];for(a in t)t.hasOwnProperty(a)&&(e=t[a],i[i.length]=[a+": "+e.toString()]);return i.join(";")},F._style={ScaleBarContainer:{"z-index":0,"font-family":"arial, helvetica, sans-serif","font-size":"9px","text-align":"right",right:"25px",bottom:"20px",position:"absolute",display:S._isSmallMapShownOnSerp()?"none":"block"},ScaleBarContainerQuadrant:{"z-index":0,"font-family":"arial, helvetica, sans-serif","font-size":"9px","text-align":"right",display:S._isSmallMapShownOnSerp()?"none":"block"},ScaleBarControl:{display:"inline-block",position:"relative","margin-left":"1em","padding-top":".5em","padding-bottom":".05em",width:"{x}px"},ShadowTextDark:{color:"#000","text-shadow":"#fff 1px 1px"},ShadowTextLight:{color:"#fff","text-shadow":"#000 1px 1px"},ScaleBarRect:{width:"100%",height:"3px",border:"1px solid #fff","line-height":0,overflow:"hidden"},ScaleBarRectFill:{width:"100%",height:"0",border:"10px solid #49f"}},F),E=(x(Q,p=u),Q.prototype._onDataModelChanged=function(t,e){f.assertNotNull(e,"new meters per pixel"),e&&this._setScale(e.getMetersPerPixel())},Q.prototype._setScale=function(t){var e,a,i,o=2===this.getUnits()?k.metersPerKm<(i=Q._maxWidth*t)?(e=this._largestRoundedNumber(i/k.metersPerKm),a=Math.floor(e*k.metersPerKm/t),M.L_ScaleBarKilometers_Text):(e=this._largestRoundedNumber(i),a=Math.floor(e/t),M.L_ScaleBarMeters_Text):k.feetPerMile<(t=(o=t*k.feetPerMeter)*Q._maxWidth)?(e=this._largestRoundedNumber(t/k.feetPerMile),a=Math.floor(e*k.feetPerMile/o),M.L_ScaleBarMiles_Text):0===this.getUnits()?(e=this._largestRoundedNumber(t),a=Math.floor(e/o),M.L_ScaleBarFeet_Text):(e=this._largestRoundedNumber(t/k.feetPerYard),a=Math.floor(e*k.feetPerYard/o),M.L_ScaleBarYards_Text);this._updateScaleBarControl(a,e.toString()+" "+o)},Q.prototype._updateScaleBarControl=function(t,e){this.setText(e),this.setWidth(t+2),this.setStyle(D.getScaleBarControlStyle().replace("{x}",this.getWidth().toString()))},Q.prototype._largestRoundedNumber=function(t){var e=Math.log(t)/Q._ln10,e=Math.floor(e),e=Math.pow(10,e),t=t/e;return 1===e?this._getSingleDigitValue(t):this._getMultiDigitValue(t,e)},Q.prototype._getSingleDigitValue=function(t){for(var e,a=Math.floor(t),i=0;i<Q._singleDigitValues.length;i++)if((e=Q._singleDigitValues[i])<a)return e;return 1},Q.prototype._getMultiDigitValue=function(t,e){for(var a,i=0;i<Q._multiDigitValues.length;i++)if((a=Q._multiDigitValues[i])<t)return a*e;return e},Q.prototype.handleMapChange=function(t){t.oldMapTypeId===b.aerial||t.oldMapTypeId===b.birdseye||t.newMapTypeId!==b.aerial&&t.newMapTypeId!==b.birdseye||this.setShadowTextStyle(D.getShadowTextLightStyle()),t.oldMapTypeId!==b.aerial&&t.oldMapTypeId!==b.birdseye||t.newMapTypeId===b.aerial||t.newMapTypeId===b.birdseye||this.setShadowTextStyle(D.getShadowTextDarkStyle())},Q._template='<div style="{TemplateBinding Style}"><div style="{TemplateBinding ShadowTextStyle}"><TextBlock Text="{TemplateBinding Text}"/></div><div style="{TemplateBinding ScaleBarRectStyle}"><div style="{TemplateBinding ScaleBarRectFillStyle}"></div></div></div>',Q._singleDigitValues=[5,2],Q._multiDigitValues=[5,2.5,2],Q._maxWidth=100,Q._ln10=2.302585092994046,Q);m.registerControl("ScaleBarControl",E),x(V,s=u),V.prototype._updateScaleBar=function(){var t,e=new P,a=this._map.getView().cameraLocation,i=B.fromLocation(a,!0),o=this._map.getMode(),o=o.getCurrentCrs&&o.getCurrentCrs();"number"!=typeof(t=o&&o.sceneMetadata?o.getScale({pixelWidth:0,pixelHeight:0,bounds:[],crs:o,zoom:i}):t)&&(t=B.toScale(a,i,!1)),e.setMetersPerPixel(t),this.setScaleBarDataModel(e)},V._defaultTemplate='<div class="ScaleBar bm_disable_highlighting{quadrantOverride}" style="{TemplateBinding Style}"><ScaleBarControl units="{TemplateBinding unitsMiles}" dataModel="{TemplateBinding ScaleBarDataModel}"></ScaleBarControl><ScaleBarControl units="{TemplateBinding unitsKMs}" dataModel="{TemplateBinding ScaleBarDataModel}"></ScaleBarControl></div>',o=V,m.registerControl("ScaleBar",o),x(z,l=O),r=z,I.prototype.getCopyrightControl=function(){return this._copyrightControl},I.prototype.getLogoControl=function(){return this._logoControl},I.prototype.getScaleBar=function(){return this._scaleBar},I.prototype.getXStartForQuadrant=function(t){switch(t){case T.BottomRight:if(this._bottomLeftOverlayContainer)return this._bottomLeftOverlayContainer.get_relative_pos().x+this._bottomLeftOverlayContainer.get_size().width;case T.TopRight:if(this._topLeftOverlayContainer)return this._topLeftOverlayContainer.get_relative_pos().x+this._topLeftOverlayContainer.get_size().width;default:return 0}},I.prototype.getXEndForQuadrant=function(t){switch(t){case T.BottomLeft:if(this._bottomRightOverlayContainer)return this._bottomRightOverlayContainer.get_relative_pos().x;case T.TopLeft:if(this._topRightOverlayContainer)return this._topRightOverlayContainer.get_relative_pos().x;default:return this._map.getActualSize().width}},I.prototype.getQuadrantForControl=function(t){t=t.getRootElement()[0];return this._topLeftOverlayContainer&&this._topLeftOverlayContainer.has(t)?T.TopLeft:this._topRightOverlayContainer&&this._topRightOverlayContainer.has(t)?T.TopRight:this._bottomLeftOverlayContainer&&this._bottomLeftOverlayContainer.has(t)?T.BottomLeft:this._bottomRightOverlayContainer&&this._bottomRightOverlayContainer.has(t)?T.BottomRight:T.None},I.prototype._appendMapOverlay=function(t,e){switch(e){case T.TopLeft:this._topLeftOverlayContainer||(this._topLeftOverlayContainer=this._createQuadrantDiv(e)),this._topLeftOverlayContainer.append(t.getOverlayElement());break;case T.TopRight:this._topRightOverlayContainer||(this._topRightOverlayContainer=this._createQuadrantDiv(e)),this._topRightOverlayContainer.append(t.getOverlayElement());break;case T.BottomRight:this._bottomRightOverlayContainer||(this._bottomRightOverlayContainer=this._createQuadrantDiv(e)),this._bottomRightOverlayContainer.append(t.getOverlayElement());break;case T.BottomLeft:this._bottomLeftOverlayContainer||(this._bottomLeftOverlayContainer=this._createQuadrantDiv(e)),this._bottomLeftOverlayContainer.append(t.getOverlayElement())}},I.prototype._createQuadrantDiv=function(t){var e={position:"absolute"},a="";switch(t){case T.topLeft:e.left="5px",e.top="5px",a="bm_topLeftOverlay";break;case T.topRight:e.right="5px",e.top="5px",a="bm_topRightOverlay";break;case T.bottomLeft:e.left="5px",e.bottom="5px",a="bm_bottomLeftOverlay";break;case T.bottomRight:e.right="25px",e.bottom="5px",a="bm_bottomRightOverlay"}return t=S._createElement("div").set_style(e).add_class(a),this._rootElement.append(t),t},I.prototype._initializeOverlayContainers=function(){this._mapOptions&&(C.isOnChina&&void 0===this._mapOptions.copyrightLocation&&(this._mapOptions.copyrightLocation=T.BottomLeft),void 0!==this._mapOptions.copyrightLocation&&this._mapOptions.copyrightLocation!==T.none||(this._mapOptions.copyrightLocation=T.BottomRight),void 0!==this._mapOptions.scalebarLocation&&this._mapOptions.scalebarLocation!==T.none||(this._mapOptions.scalebarLocation=T.BottomRight),void 0!==this._mapOptions.logoLocation&&this._mapOptions.logoLocation!==T.none||(this._mapOptions.logoLocation=T.BottomLeft),this._mapOptions.showLogo&&this._createLogoControl(),this._mapOptions.showScalebar&&this._createScaleBarControl(),this._mapOptions.showCopyright&&this._createCopyrightControl())},I.prototype._createCopyrightControl=function(){var t=this._mapOptions.showTermsLink||!1;this._copyrightControl=new w(this._map,this._map.getConfig(),t),this._appendMapOverlay(new a(this._copyrightControl),this._mapOptions.copyrightLocation),this._map.copyrightControlLoaded.invoke(this._copyrightControl),this._disposables.push(this._copyrightControl)},I.prototype._createLogoControl=function(){var t=void 0===this._mapOptions.enableClickableLogo||this._mapOptions.enableClickableLogo;this._logoControl=new i(this._map,t),this._appendMapOverlay(new R(this._logoControl),this._mapOptions.logoLocation),this._disposables.push(this._logoControl)},I.prototype._createScaleBarControl=function(){this._scaleBar=new o(this._map),this._appendMapOverlay(new r(this._scaleBar),this._mapOptions.scalebarLocation),this._disposables.push(this._scaleBar)},I.prototype.dispose=function(){for(var t=0;t<this._disposables.length;t++)this._disposables[t].dispose();this._disposables=[],this._rootElement&&this._rootElement.clear(),this._topLeftOverlayContainer&&this._topLeftOverlayContainer.clear(),this._topRightOverlayContainer&&this._topRightOverlayContainer.clear(),this._bottomLeftOverlayContainer&&this._bottomLeftOverlayContainer.clear(),this._bottomRightOverlayContainer&&this._bottomRightOverlayContainer.clear()},n=I,e.LogoOverlay=R,t.LogoControl=i,e.CopyrightOverlay=a,t.CopyrightControl=w,e.ScaleBarOverlay=r,t.ScaleBar=o,t.ScaleBarControl=E,t.ScaleBarDataModel=P,t.MapOverlayManager=n}catch(t){if(!e.logger)throw t;e.logger.logCriticalError(t)}function I(t,e){this._map=t,this._mapOptions=this._map.getMapOptions(),this._disposables=[],this._rootElement=e,this._initializeOverlayContainers()}function z(t){return f.assertNotNull(t,"scaleBar"),t=t.getRootElement(),l.call(this,t,null,null)||this}function V(t){var e=s.call(this,null,{map:t})||this;return e._map=t,e.disposables=[],e.unitsMiles=0,e.unitsKMs=2,e.defineProperty("style"),e.defineProperty("scaleBarDataModel"),e.disposables.push(e._map.viewChanged.addThrottled(function(){return e._updateScaleBar()},300)),t=t.getConfig().useOverlayQuadrants?" quadrantOverride":"",e.setTemplate(new m(V._defaultTemplate.replace("{quadrantOverride}",t))),e.setStyle(D.getScaleBarStyle(e._map)),e._updateScaleBar(),e}function Q(t){var a=p.call(this)||this;return a.defineProperty("dataModel",function(t,e){return a._onDataModelChanged(t,e)}),a.defineProperty("units"),a.defineProperty("width"),a.defineProperty("text"),a.defineProperty("style"),a.defineProperty("shadowTextStyle"),a.defineProperty("scaleBarRectStyle"),a.defineProperty("scaleBarRectFillStyle"),a._map=t.map,a.disposables.push(a._map.mapTypeChanged.add(function(t){return a.handleMapChange(t)})),a.setTemplate(new m(Q._template)),a.setStyle(D.getScaleBarControlStyle()),a.setShadowTextStyle(D.getShadowTextDarkStyle()),a.setScaleBarRectStyle(D.getScaleBarRectStyle()),a.setScaleBarRectFillStyle(D.getScaleBarRectFillStyle()),a}function F(){}function H(t){var t=t||{},e=h.call(this,t)||this;return t.defineProperty("metersPerPixel"),e}function N(){}function j(t){var e=this;return t&&(t=t.getRootElement(),e=d.call(this,t,null,null)||this),e}function A(t,e){var a,i=c.call(this)||this;return i._hrefFormat="//www.bing.com/maps?cp={lat}~{lon}&lvl={lvl}&style={style}&FORM=BMLOGO",i.defineProperty("BingHref"),i.defineProperty("LogoStyle"),i.defineProperty("Clickable"),a=t.getConfig().useOverlayQuadrants?" quadrantOverride":"",i.setTemplate(new m('<div class="bm_LogoContainer'+a+'"><a href="{TemplateBinding BingHref}" title="Bing Maps" target="mc_bingMaps" style="{TemplateBinding Clickable}" event:touchstart="touchStart"><div id="bingLogo" class="{TemplateBinding LogoStyle}"/></a></div>',{touchStart:function(t){return i._OnTouch(t)}})),i._map=t,void 0!==e&&e?(i.setClickable("pointer-events: auto"),i.disposables.push(i._map.viewChanged.add(function(){return i._updateHref()}))):i.setClickable("pointer-events: none"),i.disposables.push(i._map.mapTypeChanged.add(function(t){return i._onMapTypeChanged(t)})),i._setLogoStyle(i._map.getMapType().id),i}function W(t){var e=this;return t&&(t=t.getRootElement(),e=g.call(this,t,null,null)||this),e}function K(t,e,a){var i=y.call(this)||this,o=K._copyrightContainerTemplate;return a&&e&&e.copyrightTermsLinkUrl&&(o+=K._termsLinkTemplate.replace("{termsLink}",e.copyrightTermsLinkUrl)),o+=K._copyrightControlTemplate,o+=K._clickableCopyrightTemplate,o+="</span></div></div>",i._map=t,i.defineProperty("shadowTextStyle"),i.defineProperty("copyrightAttributions"),i.defineProperty("CopyrightLinkHref"),i.defineProperty("CopyrightLinkText"),i.setTemplate(new m(o)),i.setShadowTextStyle("ShadowTextDark"),i._minStart=null,i._maxEnd=null,i.copyrightUpdated=new v,i.disposables.push(i._map.copyrightChanged.addThrottled(function(){return i._updateCopyright()},2e3)),i.disposables.push(i._map.mapTypeChanged.add(function(t){return i._onMapTypeChanged(t)})),i.disposables.push(i._map.actualSizeChanged.add(function(){i._updateMinStart(),i._updateMaxEnd(),i._updateCopyrightSize()})),i.rendered.addOne(function(){i._copyrightControl=i.getRootElement().select(".CopyrightControl"),i._map.getConfig().useOverlayQuadrants&&i.getRootElement().add_class("quadrantOverride")}),i._updateCopyright(),i}}.call(window);
