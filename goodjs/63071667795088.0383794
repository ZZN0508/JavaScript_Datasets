define("lofty/ui/tabs/2.0/tabs",["lofty/lang/class","lofty/ui/widget/1.0/widget","lofty/util/template/2.0/tplhandler","jquery","lofty/util/webp/1.0/webp","lofty/util/exposure/1.0/exposure","lofty/util/datalazyload/2.0/datalazyload"],function(e,t,i,u,a,r,s){"use strict";function x(e){var l;this.get("isLazy")&&(l=this,e?((e={container:l.get("el"),imgSrcName:l.get("imgSrcName"),threshold:l.get("threshold"),webp:l.get("webp")}).overflowContainer=l.get("overflowContainer"),l._lazyObj=new s(e)):l.on("beforeSwitch",function(e){for(var t=l.get("el").find(e.boxSelector).eq(e.index).find("img["+l.get("imgSrcName")+"]"),i=0,s=t.length;i<s;i++){var o=u(t[i]),n=o.attr(l.get("imgSrcName"));l.get("webp")?function(t,e){a.convertSrc(e,function(e){t.attr("src",e)})}(o,n):o.attr("src",n),o.removeAttr(l.get("imgSrcName"))}}))}var o=e(t,{options:{autoPlay:"",stopWhenHide:!1,playWhenCompleteShow:!1,interval:3e3,event:"mouseenter",currentCls:"fui-tab-current",disableCls:"disabled",size:"small",titleSelector:".fui-tab-t",boxSelector:".fui-tab-b",selected:0,effect:"default",overflowContainer:".fui-d-container",isLoop:!0,isLazy:!1,webp:!0,step:1,listenDefault:!1,titleEvtPrevent:!0,imgSrcName:"data-lazyload-src",threshold:10,duration:500,prev:".fui-tab-prev",next:".fui-tab-next",items:[],classPrefix:"fui"},events:{"{options.titleSelector}":{"{options.event}":"onTitleEvent"},"{options.prev}":{click:"prev"},"{options.next}":{click:"next"},"{options.titleSelector} a":{click:function(e){this.get("titleEvtPrevent")&&e.preventDefault()}}},_create:function(){this.render();var e=this;this.index=-1;var t=this.get("selected")||0,i=this.get("el");this.titles=i.find(this.get("titleSelector")),this.boxes=i.find(this.get("boxSelector")),this.prevNode=i.find(this.get("prev")),this.nextNode=i.find(this.get("next")),0!==this.boxes.length&&(function(){var e=this.get("effect");"string"==typeof e&&(this.get("el").addClass("fui-tab-effect-"+e),e=o.Effect[e]),this.get("size")&&this.get("el").addClass("fui-tab-l"),(e="function"==typeof e?{show:e}:e).setup&&e.setup(this),this.effect=e}.call(this),function(){var i,s,o,n,l,a=this.get("autoPlay");!a||this.boxes.length<=1||(s=(i=this).get("interval"),n=!(o=!1),this.get("stopWhenHide")||this.get("playWhenCompleteShow")?(i._exposureObj=new r({target:i.get("el"),threshold:0,onlyOnce:!1}),this.get("playWhenCompleteShow")?(i._exposureObj.on("completeShow",function(e){e.is(i.get("el"))&&(n=!1)}),i._exposureObj.on("partShow",function(e){e.is(i.get("el"))&&(n=!0)})):i._exposureObj.on("exposure",function(e){e.is(i.get("el"))&&(n=!1)}),i._exposureObj.on("hide",function(e){e.is(i.get("el"))&&(n=!0)}),i._exposureObj.execute()):n=!1,this.get("el").on("mouseenter",function(){o=!0}).on("mouseleave",function(){o=!1}),l=function(){if(i._pause||n||o)i.loopTimer=setTimeout(l,s);else{var e=0;if("random"===a)for(;i.index===(e=Math.floor(Math.random()*i.boxes.length)););else{var t=i.index+i.get("step"),e=t%i.boxes.length;i.loopAndAnim&&(i.simulateIndex=t)}i._switchTo(e,function(){i.loopTimer2=setTimeout(l,s)})}},i.loopTimer=setTimeout(l,s))}.call(this),this.loopAndAnim=this.get("isLoop")&&this.effect.moveAnim,this.get("listenDefault")?setTimeout(function(){e._switchTo(t)},0):this._switchTo(t))},_switchTo:function(e,t){var i,s,o,n,l;(e=this._maxIndex&&e>this._maxIndex?this._maxIndex:e)!==this.index&&(s={lastIndex:(i=this).index,index:e,element:this.get("el"),duration:this.get("duration"),titles:this.titles,boxes:this.boxes,boxSelector:this.get("boxSelector"),overflowContainer:this.get("el").is(this.get("overflowContainer"))?this.get("el"):this.get("el").find(this.get("overflowContainer")),self:i},this.simulateIndex&&(s.simulateIndex=this.simulateIndex),this.trigger("beforeSwitch",s),o=this.get("currentCls"),n=this.get("disableCls"),this.titles.eq(this.index).removeClass(o),l=this.get("isLoop"),this.titles.eq(e).addClass(o),this.index=e,this.effect.show(s,function(){i.boxes.eq(s.lastIndex).removeClass(o),i.boxes.eq(s.index).addClass(o),l||(i.prevNode.toggleClass(n,0===s.index),i.nextNode.toggleClass(n,s.index===i.boxes.length-1)),t&&t(),i.trigger("switch",s)}))},onTitleEvent:function(e){this.get("titleEvtPrevent")&&e.preventDefault();e=u(e.currentTarget),e=this.titles.index(e);this.loopAndAnim&&(this.simulateIndex=e),this._switchTo(e)},switchTo:function(e,t){this.loopAndAnim&&(this.simulateIndex=e),this._switchTo(e,t)},prev:function(e){if(e&&e.preventDefault&&e.preventDefault(),!1!==this._canClick){e=this.index-this.get("step");return 0<=e?(this.loopAndAnim&&(this.simulateIndex=e),this._switchTo(e)):this.get("isLoop")?(this.effect.moveAnim&&(this.simulateIndex=e),this._switchTo(this.boxes.length+e)):0<this.index&&this._switchTo(0),this}},next:function(e){if(e&&e.preventDefault&&e.preventDefault(),!1!==this._canClick){e=this.index+this.get("step");return e<this.boxes.length?(this.loopAndAnim&&(this.simulateIndex=e),this._switchTo(e)):this.get("isLoop")?(this.effect.moveAnim&&(this.simulateIndex=e),this._switchTo(e-this.boxes.length)):this.index<this.boxes.length-1&&this._switchTo(this.boxes.length-1),this}},addTab:function(e,t){return this},removeTab:function(e){return this},getLength:function(){return this.boxes.length},getCurrentIndex:function(){return this.index},pause:function(){this._pause=!0},resume:function(){this._pause=!1},handleTpl:function(){var e={};e.classPrefix=this.get("classPrefix"),e.items=this.get("items")||[],i.process.call(this,e)},tpl:['<div class="{{classPrefix}}-tab">','<div class="{{classPrefix}}-t">','<ul class="{{classPrefix}}-tab-ul">',"{{each items as item}}",'<li class="{{classPrefix}}-tab-t"><a href="#">{{item.label}}</a></li>',"{{/each}}","</ul>","</div>",'<div class="{{classPrefix}}-d-container">','<div class="{{classPrefix}}-d">',"{{each items as item}}",'<div class="{{classPrefix}}-tab-b">{{item.content}}</div>',"{{/each}}","</div>","</div>","</div>"].join(""),end:0,destroy:function(){this._exposureObj&&this._exposureObj.destroy(),this.loopTimer&&clearTimeout(this.loopTimer),this.loopTimer2&&clearTimeout(this.loopTimer2),u(this.get("overflowContainer")).stop(!0),t.prototype.destroy.call(this)}});return o.Effect={default:{setup:function(e){x.call(e,!1)},show:function(e,t){e.boxes.hide(),e.boxes.eq(e.index).show(),t()}},updown:{moveAnim:!0,setup:function(e){var t=(e.get("el").is(e.get("overflowContainer"))?e.get("el"):e.get("el").find(e.get("overflowContainer"))).height(),i=0,s=0,o=e.boxes.length;if(e.get("isLoop")){for(var n=e.boxes.eq(0).parent(),l=e.get("step")-1;s<l;s++){var a=e.boxes.eq(s).clone();a.addClass("_tab_simulate_item_"),n.append(a)}for(;i<t&&s<o;){var r,h=(r=e.boxes.eq(s)).clone();h.addClass("_tab_simulate_item_"),n.append(h),s++,i+=r.outerHeight(!0)}}else{for(s=o;i<t&&0<s;)s--,i+=(r=e.boxes.eq(s)).outerHeight(!0);e._maxIndex=s}x.call(e,!0)},show:function(e,t){var i=e.self._canClick=!1,s=!1,o=e.overflowContainer?u(e.overflowContainer):u(),n=e.simulateIndex&&e.simulateIndex!==e.index?(e.simulateIndex<0?(e.simulateIndex=e.index,s=!0):i=!0,e.element.find(e.boxSelector).eq(e.simulateIndex)):e.boxes.eq(e.index),l=e.overflowContainer;s&&(a=o.scrollTop(),o.stop(!0).scrollTop(e.element.find(e.boxSelector).eq(e.boxes.length+e.lastIndex).offset().top-l.offset().top+a));var s=n.offset().top,n=l.offset().top,a=o.scrollTop();o.stop(!0).animate({scrollTop:s-n+a},e.duration,function(){i&&(a=o.scrollTop(),o.stop(!0).scrollTop(e.boxes.eq(e.simulateIndex-e.boxes.length).offset().top-l.offset().top+a)),t(),e.self._canClick=!0})}},leftright:{moveAnim:!0,setup:function(e){var t=(e.get("el").is(e.get("overflowContainer"))?e.get("el"):e.get("el").find(e.get("overflowContainer"))).width(),i=0,s=0,o=e.boxes.length;if(e.get("isLoop")){for(var n=e.boxes.eq(0).parent(),l=e.get("step")-1;s<l;s++){var a=e.boxes.eq(s).clone();a.addClass("_tab_simulate_item_"),n.append(a)}for(;i<t&&s<o;){var r,h=(r=e.boxes.eq(s)).clone();h.addClass("_tab_simulate_item_"),n.append(h),s++,i+=r.outerWidth(!0)}}else{for(s=o;i<t&&0<s;)s--,i+=(r=e.boxes.eq(s)).outerWidth(!0);e._maxIndex=s}var f=e.get("el").find(e.get("boxSelector")),c=0,d=f.eq(0).parent();f.each(function(){var e=u(this).outerWidth(!0);c+=e}),d.addClass("fd-clr").width(c+100),f.css("float","left"),x.call(e,!0)},show:function(e,t){var i=e.self._canClick=!1,s=!1,o=e.overflowContainer?u(e.overflowContainer):u(),n=e.simulateIndex&&e.simulateIndex!==e.index?(e.simulateIndex<0?(e.simulateIndex=e.index,s=!0):i=!0,e.element.find(e.boxSelector).eq(e.simulateIndex)):e.boxes.eq(e.index),l=e.overflowContainer;s&&(a=o.scrollLeft(),o.stop(!0).scrollLeft(e.element.find(e.boxSelector).eq(e.boxes.length+e.lastIndex).offset().left-l.offset().left+a));var s=n.offset().left,n=l.offset().left,a=o.scrollLeft();o.stop(!0).animate({scrollLeft:s-n+a},e.duration,function(){i&&(a=o.scrollLeft(),o.stop(!0).scrollLeft(e.boxes.eq(e.simulateIndex-e.boxes.length).offset().left-l.offset().left+a)),t(),e.self._canClick=!0})}},fade:{setup:function(e){x.call(e,!1)},show:function(e,t){return e.boxes.eq(e.index).hasClass(e.self.get("currentCls"))?void t():(e.boxes.hide(),void e.boxes.eq(e.index).fadeIn(e.duration,t))}},intersectFade:{setup:function(e){e.prevNode.css("z-index","3"),e.nextNode.css("z-index","3"),e.boxes.eq(0).parent().css("position","relative"),e.boxes.css({position:"absolute",left:"0",top:"0"}),e.boxes.not(e.boxes.eq(0)).hide(),x.call(e,!1)},show:function(e,t){var i=e.self;e.boxes.eq(e.index).hasClass(e.self.get("currentCls"))||(e.boxes.stop(!0).not(e.lastIndex).css({"z-index":1,opacity:0}).hide(),e.boxes.eq(e.lastIndex).css({"z-index":2,opacity:1}).show(),i.tmId&&(clearTimeout(i.tmId),i.tmId=null),e.boxes.eq(e.lastIndex).animate({"z-index":1,opacity:0},e.duration),i.tmId=setTimeout(function(){e.boxes.eq(e.index).show().animate({"z-index":2,opacity:1},e.duration)},.5*e.duration)),t()}}},o});
