!function(a,i){"use strict";var r=$(),l=($(),$()),s=$(),c=0,u=0,h=$.Deferred(),f=$.Deferred(),d="photo-layer_fullScreen";function t(){try{!function(){if(!OK.photoLayer.isActive())return m(!1);var e=i.fullscreenElement||i.mozFullScreenElement||i.webkitFullscreenElement,o=i.body,t=(o.className||"").split(" "),n=t.indexOf(d);r.toggleClass("__disabled_adaptive2",e).toggleClass("__adaptive2",!e),e?(n<0&&(t.push(d),o.className=t.join(" "),a.OK.photoLayer.visualizePhoto()),a.OK.logger.success("photo.fs","resp_on")):(0<=n&&(t.splice(n,1),o.className=t.join(" "),a.OK.photoLayer.visualizePhoto()),a.OK.logger.success("photo.fs","resp_off")),r.scroll()}()}catch(e){OK.logger.error("photo.fs","toggle")}}function n(){OK.logger.error("photo.fs","fail")}function m(e){var o=i.documentElement,e=e?i.addEventListener:i.removeEventListener;return o.requestFullscreen?(e.call(i,"fullscreenchange",t),e.call(i,"fullscreenerror",n),!0):o.mozRequestFullScreen?(e.call(i,"mozfullscreenchange",t),e.call(i,"mozfullscreenerror",n),!0):!!o.webkitRequestFullscreen&&(e.call(i,"webkitfullscreenchange",t),e.call(i,"webkitfullscreenerror",n),!0)}function p(){i.webkitCancelFullScreen&&null==window.event||(i.fullscreenElement||i.webkitFullscreenElement||i.mozFullScreenElement||i.msFullscreenElement)&&(i.exitFullscreen?i.exitFullscreen():i.cancelFullScreen?i.cancelFullScreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitCancelFullScreen&&i.webkitCancelFullScreen())}function y(e){var o=$(this),t=o.attr("data-id"),r=o.attr("data-type");t&&r&&require(["OK/DiscussionManager","jquery"],function(e,n){e.forEachOpened(t,r,function(){function o(e){n(this.element).animate({scrollTop:this.element.scrollTop+e},"500")}var t=this;this.element.each(function(){var e=t.scrollController;e.hasMore()?e.loadLast().done(function(){t.scrollController.scrollToBottomFancy(o)}):e.scrollToBottomFancy(o)}),this.form.focus()})}),e.preventDefault()}var _,g,O,v=!0;a.OK.util.extend(a.OK.photoLayer,{isActive:function(){return _},init:function(e){var o;O=!0,f=$.Deferred(),r=$(e),$(".photo-layer_bottom",r),l=$("#photo-layer_photo"),$(a).bind("resize.photoLayer",function(){l.each(function(){a.OK.photoLayer.centerLayer(this,s.get(0),c,u)})}),_||OK.loader.use("OKCustomJs",function(){require(["OK/PhotoLayer"],function(e){OK.Layers.register("layer_photo",function(){OK.photoLayer.onClose(!0)},null,!1,e.keyboardHandler),OK.Layers.onLayerShown&&OK.Layers.onLayerShown()})}),v&&(r.on("click",".js-scrollToComments",y).on("click",".arw__prev, .arw__next",function(){O=!0,a.OK.photoLayer.hideElements&&r.addClass("__no-controls")}).on("click",".js-photoLayerClose",function(e){e.preventDefault(),OK.photoLayer.close(!0)}).on("click",function(e){e.originalEvent.isReactEvent||OK.photoLayer.close(!0)}).on("click",".photo-layer_cnt",function(e){e.originalEvent.isReactEvent||e.stopPropagation()}).on("mouseover",".photo-layer_right_half",function(){$(".arw__next",r).addClass("__hover")}).on("mouseout",".photo-layer_right_half",function(){$(".arw__next",r).removeClass("__hover")}).on("mouseover",".photo-layer_img_w .photo-layer_klass_w",function(){var n=$(this),r=this.getBoundingClientRect();$(document).on("mousemove",function e(o){var t=o.clientX,o=o.clientY;(t>r.right||t<r.left||o<r.top||o>r.bottom)&&($(document).off("mousemove",e),n.removeClass("__hover"))}),$(this).addClass("__hover")}),o=$(".photo-layer_close",r),$(".modal_overlay",r).hover(function(){o.addClass("__hover")},function(){o.removeClass("__hover")})),m(!(v=!1))||g||(i.documentElement.className=(i.documentElement.className||"")+" nofs"),_=g=!0,h.resolve()},close:function(e){OK.loader.use(["OKCustomJs"],function(){OK.Layers.remove("layer_photo")}),OK.photoLayer.onClose(e)},onClose:function(e){if(!v)return a.OK.photoLayer.isLogPrematureClose&&O&&a.OK.logging.logger.success("photo","prematureClose"),v=!(O=!1),a.OK.photoLayer.isFirst=!0,a.OK.photoLayer.minHeight=480,a.OK.photoLayer.timeDiff=void 0,l.css("min-height",""),0<$("#RefreshMTLayerOnClose").length?setTimeout(function(){require(["OK/MediaLayer"],function(e){e.refreshLayerBody(o)})},50):o(),!1;function o(){r.addClass("invisible").removeClass("__active __ready"),$(".modal_overlay",r).off("hover"),r.off("click"),p(),a.OK.hookModel.setHookContent("PhotoLayerLB",""),a.OK.hookModel.setHookContent("PhotoLayerRB",""),a.OK.hookModel.setHookContent("PhotoLayerFooterRB",""),a.OK.hookModel.setHookContent("PhotoLayerPreviewRB",""),a.OK.hookModel.setHookContent("PhotoLayerRightColumnRB",""),a.OK.photoLayer.destroyFastNavigation(),$(a).off("resize.photoLayer"),_=!1,a.OK.photoLayer.minHeight=520,OK.loader.use("OKCustomJs",function(){OK.Layers.onLayerHidden&&OK.Layers.onLayerHidden(),e?OK.Layers.pop():OK.Layers.clear()})}},onPhotoShown:function(t,n){var e,o;t=t||!1,O=!1,a.OK.photoLayer.isRotated=!1,a.OK.photoLayer.isLogTimeDiff&&(e=(new Date).getTime(),void 0!==a.OK.photoLayer.timeDiff&&(o=e-a.OK.photoLayer.timeDiff,a.OK.logging.logger.durationScalar("photo","timeDiff",o)),a.OK.photoLayer.timeDiff=e),h.done(function(){var e,o;s=$("#__plpcte_target"),r.toggleClass("__unavailable",t),u=s&&0!=s.length?(a.OK.photoLayer.isGif=!1,c=parseInt(s.attr("data-nfs-width")),parseInt(s.attr("data-nfs-height"))):(a.OK.photoLayer.isGif=!0,e=$(".gif",l),s=$(".gif_video",e),c=parseInt(e.attr("data-width")),parseInt(e.attr("data-height"))),f.resolve(s.get(0)),a.OK.photoLayer.centerLayer(l.get(0),s.get(0),c,u),n&&f.done(n),l.toggleClass("__animated",!a.OK.photoLayer.isFirst),r.removeClass("__more"),a.OK.photoLayer.hideElements&&(o=0,l.off("mousemove").on("mousemove",function(){7==++o&&(r.removeClass("__no-controls"),l.off("mousemove"))}))})},footerRendered:function(){f.done(function(e){e&&requestAnimationFrame(function(){l.each(function(){a.OK.photoLayer.centerLayer(this,e,c,u+100)})}.bind(this));var o=$(".arw_cnt.__next");OK.scrollBar.width&&o.css("max-width",parseInt(o.css("max-width"),10)-OK.scrollBar.width),r.addClass("__ready"),a.OK.photoLayer.isFirst=!1})},toggleFullScreen:function(){var e;i.fullscreenElement||i.mozFullScreenElement||i.webkitFullscreenElement?(a.OK.logger.success("photo.fs","req_off"),p()):(a.OK.logger.success("photo.fs","req_on"),(e=i.documentElement).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT))},exitFullScreen:function(){_&&(a.OK.logger.success("photo.fs","req_exit"),p())},visualizePhoto:function(e){var o,t,n,r,l=0<=((i.body.className||"").split(" ")||[]).indexOf(d),s=i.getElementById("__plpcte_target");null!==s&&(null!=(o=s.getAttribute(l?"data-fs-src":"data-nfs-src"))&&0!=o.length?(t=l?"true":"false",void 0===(r=(n=s.fsData=s.fsData||{})["data-mode-fs"])||t!=r?(l&&(s.style.maxHeight="",s.style.maxWidth=""),n["data-mode-fs"]=t,s.src!=o&&(s.src=o),null!=e&&e.logViews&&a.OK.logger.success("photo.fs","vis_"+(l?"full":"wnd"))):a.OK.logger.success("photo.fs","vis_skip")):a.OK.logger.error("photo.fs","no_trg_src"))},hideFullScreenButton:function(){$(".photo-layer_fullscreen_btn",r).addClass("__disabled")},toggleFullScreenButton:function(){$(".photo-layer_fullscreen_btn",r).toggleClass("__disabled",!1)}}),a.OK.photoLayer.waitForInit&&(a.OK.photoLayer.init(a.OK.photoLayer.waitForInit),a.OK.photoLayer.waitForInit=null)}(window,document);
