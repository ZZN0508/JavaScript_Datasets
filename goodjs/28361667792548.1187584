trx=window.trx||{},trx.runtime=function(){"use strict";trx.magicLinksEngine=null,trx.MagicLinks=class{static prepareDefaultSettings(e){return"object"!=typeof e.detection_rules&&(e.detection_rules={auto:!0,custom:[],exclude_urls:[],page_url_filter:""}),null==e.detection_rules.auto&&(e.detection_rules.auto=!0),null==e.detection_rules.auto_networks&&(e.detection_rules.auto_networks={amazon:!1,ls:!0,cj:!0,sas:!1,awin:!1,pj:!1,sl:!1,vl:!1,ir:!1,td:!1,wg:!1,pt:!1,al:!1,at:!1,tt:!1,ho:!1,tc:!1,bol:!1,afs:!1,rv:!1,dynamic:!1}),e.detection_rules.custom instanceof Array||(e.detection_rules.custom=[]),e.detection_rules.exclude_urls instanceof Array||(e.detection_rules.exclude_urls=[]),null==e.detection_rules.page_url_filter&&(e.detection_rules.page_url_filter=""),null==e.detection_rules.amazon_no_append&&(e.detection_rules.amazon_no_append=!1),"object"!=typeof e.features&&(e.features={}),null==e.features.append_referrer&&(e.features.append_referrer={enabled:!0,attr_name:"referrer",new_query_param:!1}),null==e.features.asin_map&&(e.features.asin_map={enabled:!1}),null==e.features.asin_tag&&(e.features.asin_tag={enabled:!1}),null==e.features.wait_then_click&&(e.features.wait_then_click={enabled:!1}),null==e.features.use_beacon&&(e.features.use_beacon={enabled:!1}),null==e.features.observe&&(e.features.observe={enabled:!1}),null==e.features.urlchange&&(e.features.urlchange={enabled:!1}),null==e.features.iid_track&&(e.features.iid_track={enabled:!1}),null==e.features.new_window&&(e.features.new_window={enabled:!1}),null==e.features.attributes_forwarding&&(e.features.attributes_forwarding={enabled:!0,attributes:["utm_source","utm_campaign","utm_content","utm_medium","utm_term","gclid","fbclid"]}),null==e.features.append_timing&&(e.features.append_timing={enabled:!1,t_load:!1,t_clicked:!1,t_toclick:!1,new_query_param:!1}),null==e.features.append_attributes&&(e.features.append_attributes={enabled:!1,attributes:""}),null==e.features.track_events&&(e.features.track_events={enabled:!1,pageview:!1,clicks:!1,props_map:{xid:"prop1",link:"prop2",label:"prop3",referrer:"prop4",origin:"prop5"},props_map_custom:[]}),null==e.features.auto_optimize_link&&(e.features.auto_optimize_link={enabled:!1}),null==e.features.link_preview&&(e.features.link_preview={enabled:!1,show_icon:!1,show_metadata:!1,show_coupons:!1}),null==e.features.shorten_extra_param&&(e.features.shorten_extra_param={enabled:!1}),null==e.features.metadata&&(e.features.metadata={enabled:!1,selectors:""}),null==e.features.spot&&(e.features.spot={enabled:!1,link_rules:!1,asin_rules:!1,asin_per_page:!1,direct_deals:!1}),null==e.features.srs&&(e.features.srs={enabled:!1}),e}constructor(e){try{null==e&&(e=!0),null==t&&(t="prod"),this.isInRunFunction=!1,this._paramsBuffer={attr_forwarding:{},metadata:{},timing:{},urls:{},attr_append:{},page_trace:[],custom_meta:{}},this._xids={},this._autoRun=e,this.init(e)}catch(e){this._error(e,e.stack)}}init(){try{if(this._onPageSettings=trx.magic_links_settings||{},this._envSettings={events_recording_env:"cbs",events_recording_api:"https://yoerzkeuj0.execute-api.us-east-1.amazonaws.com/Prod",app_key:"gsd65fgr0hgTTT",events_recording_iid:"https://trx-hub.com"},this._serverSettings={detection_rules:{auto:"true",page_url_filter:"",auto_networks:{amazon:"false",awin:"true",cj:"true",dynamic:"true",ir:"true",ls:"true",sas:"true",sl:"true",pj:"true",td:"true",wg:"true",pt:"true",al:"true",at:"true",tt:"true",vg:"true",ho:"false",tc:"false",bol:"false",rv:"false",afs:"false"},exclude_urls:["bestbuy.7tiv.net","bestbuy.com","shop-links.co"],amazon_no_append:"true"},features:{append_referrer:{enabled:"true",attr_name:"referrer"},spot:{enabled:"false",link_rules:"false",asin_rules:"false",asin_per_page:"false",direct_deals:"false"},asin_map:{enabled:"false"},asin_tag:{enabled:"false",tags_required:"0"},iid_track:{enabled:"false"},wait_then_click:{enabled:"false"},use_beacon:{enabled:"false"},observe:{enabled:"false"},urlchange:{enabled:"false"},new_window:{enabled:"false"},attributes_forwarding:{enabled:"true",attributes:["utm_source","utm_campaign","utm_content","utm_medium","utm_term","ftag","gclid","fbclid"]},append_timing:{enabled:"true",t_load:"false",t_clicked:"true",t_toclick:"false"},append_attributes:{enabled:"false",attributes:""},track_events:{enabled:"true",pageview:"false",clicks:"true",analytics_code:"UA-30164722-1",props_map:{xid:"prop1",link:"prop2",label:"prop3",referrer:"prop4",origin:"prop5"}},link_preview:{enabled:"false",show_icon:"false",show_metadata:"false",show_coupons:"false"},link_optimization:{enabled:"false",shortening_extra_param:"false"},metadata:{enabled:"true",selectors:"pageViewGuid | js::pageData.pageViewGuid\narticleId | js::utag_data._articleId\nftag | ck::cnet_ad_ftag"}},dynamic_domains:[""],impact_domains:{"2cw9.net":1,"w6fg.net":1,"7ymy.net":1,"zz6n.net":1,"a4v3ci.net":1,"dttq.net":1,"5oih.net":1,"njih.net":1,"rfvk.net":1,"rt8x.net":1,"43k8.net":1,"7eer.net":1,"uzvs.net":1,"u44t.net":1,"pvxt.net":1,"vaz6fn.net":1,"ojrq.net":1,"mvvx.net":1,"yx69dc.net":1,"awb5.net":1,"k7qtpo.net":1,"8odi.net":1,"mp5l.net":1,"evyy.net":1,"fx3vf7.net":1,"2npn3e.net":1,"i9pljp.net":1,"l9vx.net":1,"75r4.net":1,"ulnv.net":1,"74rjtv.net":1,"trw6mw.net":1,"xwrk.net":1,"dgdrgu.net":1,"tnu8.net":1,"pq2o.net":1,"snlv.net":1,"yfb7.net":1,"vzck.net":1,"glg9ob.net":1,"5f77.net":1,"sk2bvq.net":1,"iln8.net":1,"7tiv.net":1,"o93x.net":1,"yfh6ag.net":1,"zfrcsk.net":1,"kwpkyy.net":1,"6cqhdo.net":1,"fziv.net":1,"f9tmep.net":1,"bwa8.net":1,"74az.net":1,"gnv2.net":1,"uidg.net":1,"i3zp.net":1,"ssxmnr.net":1,"l9yg.net":1,"ixmz.net":1,"fmtgqt.net":1,"uydo.net":1,"2lsp.net":1,"oie8.net":1,"7mh5.net":1,"tmfhgn.net":1,"ngi2ba.net":1,"bs6l.net":1,"fdf2.net":1,"ruqo.net":1,"bts6.net":1,"yxku6p.net":1,"xhuc.net":1,"b9i7.net":1,"vzffua.net":1,"oteh.net":1,"uskn.net":1,"kxyi.net":1,"hyyc7q.net":1,"5ad6.net":1,"n76h.net":1,"quvl.net":1,"qflm.net":1,"8hwt.net":1,"ig9i.net":1,"d2lsjo.net":1,"9quv.net":1,"rao4.net":1,"xikq.net":1,"72mu89.net":1,"xrx2ci.net":1,"q4ew.net":1,"j4ib.net":1,"wrrv.net":1,"uqzq.net":1,"mw46.net":1,"z6vo.net":1,"g39l.net":1,"2det.net":1,"ibfwsl.net":1,"jtlo.net":1,"dfjeo3.net":1,"wqi6.net":1,"jgpt48.net":1,"eccsr4.net":1,"myi4.net":1,"j4df.net":1,"s7so.net":1,"w2wxmz.net":1,"64ud.net":1,"6rfywi.net":1,"rrmo.net":1,"2m8f.net":1,"fu4n.net":1,"ryvx.net":1,"mjs4.net":1,"bn5x.net":1,"7xde.net":1,"5vju.net":1,"7zd4df.net":1,"xuok.net":1,"o64jx9.net":1,"am3t9s.net":1,"w2t6.net":1,"xr64.net":1,"vayb.net":1,"ygwk.net":1,"ioym.net":1,"dg6u.net":1,"oyuv.net":1,"otg8.net":1,"8ujrgu.net":1,"3qag.net":1,"3f64ir.net":1,"hrlo.net":1,"fjbu.net":1,"fqik.net":1,"43wo.net":1,"ncw6.net":1,"9nz77o.net":1,"xk3g.net":1,"p7qb.net":1,"mvqw.net":1,"ntaf.net":1,"iypa.net":1,"rv5k.net":1,"wjx7.net":1,"5d3x.net":1,"saq2.net":1,"vegb.net":1,"pxi6.net":1,"b54k.net":1,"njv3dp.net":1,"nob9.net":1,"t8puue.net":1,"briy.net":1,"bpu9.net":1,"voq9.net":1,"8aog.net":1,"dodxnr.net":1,"igs4ds.net":1,"w9v5.net":1,"exgl.net":1,"3uu8.net":1,"ei7w.net":1,"vjggsg.net":1,"79ic8e.net":1,"6noy.net":1,"zrjdwn.net":1,"vdcy.net":1,"8ne3.net":1,"tk2x2c.net":1,"2xc8.net":1,"3tvl.net":1,"tkjf.net":1,"r69o.net":1,"o5kg.net":1,"74wq.net":1,"zc5a.net":1,"e8i7.net":1,"bvrd.net":1,"r2oa.net":1,"uisv.net":1,"uqhv.net":1,"y8uw.net":1,"o67m.net":1,"ydow.net":1,"mlvy.net":1,"liln.net":1,"ga3c.net":1,"szey.net":1,"2lka.net":1,"opfm.net":1,"rhq9ml.net":1,"jvam.net":1,"uqog.net":1,"ork2.net":1,"nwh3qn.net":1,"znqymu.net":1,"wsslc4.net":1,"8kt6.net":1,"9pctbx.net":1,"7voo.net":1,"ifmu.net":1,"fzsu.net":1,"9j4c.net":1,"ow29pp.net":1,"sgur.net":1,"icjj.net":1,"27exom.net":1,"6ywx.net":1,"upvt.net":1,"4paxeq.net":1,"ue8cqz.net":1,"2su64p.net":1,"wo8g.net":1,"lvuv.net":1,"36c4.net":1,"vzew.net":1,"hmqldu.net":1,"m768hc.net":1,"7no9.net":1,"xuvt.net":1,"pfm4.net":1,"3lki.net":1,"p73z.net":1,"i3f2.net":1,"7isk.net":1,"7z5k.net":1,"brvi.net":1,"fi2z.net":1,"znvt.net":1,"tpeipe.net":1,"imlz.net":1,"audw.net":1,"rqu9.net":1,"hjef.net":1,"ln72.net":1,"a5fp.net":1,"juo2.net":1,"ir2by2.net":1,"tf77py.net":1,"eszb.net":1,"2gib.net":1,"bop8.net":1,"nsji.net":1,"mpye.net":1,"hs9x.net":1,"vocq.net":1,"msafflnk.net":1,"8zwg.net":1,"58dp.net":1,"973t.net":1,"hu6f.net":1,"5kd8.net":1,"ue7a.net":1,"i8h2.net":1,"7orgeq.net":1,"mp4l.net":1,"6wfgdb.net":1,"ayxtyv.net":1,"h4km.net":1,"mxu9.net":1,"w9iork.net":1,"ftcv.net":1,"6eld.net":1,"atkw.net":1,"nkwcmr.net":1,"vwz6.net":1,"xovt.net":1,"lkze4s.net":1,"uxsi.net":1,"wkq9.net":1,"8utb.net":1,"2j9x.net":1,"kk2kau.net":1,"iy7a.net":1,"2xje.net":1,"vqi8.net":1,"keof.net":1,"givvml.net":1,"x57o.net":1,"33qw.net":1,"nbq93e.net":1,"tlir.net":1,"7st3op.net":1,"l3km.net":1,"pb6g.net":1,"hj2i.net":1,"8f6i.net":1,"tql5.net":1,"otpb.net":1,"2gfm.net":1,"whij.net":1,"9zpg.net":1,"8mz3uu.net":1,"8hslpj.net":1,"nrku7u.net":1,"xg6r.net":1,"jyae.net":1,"o3ae.net":1,"9vn7kv.net":1,"rw9xb6.net":1,"z5dw.net":1,"wk5q.net":1,"e9jo.net":1,"r7kg.net":1,"uikc.net":1,"258o.net":1,"eyip.net":1,"c9ftyd.net":1,"a9yw.net":1,"krg4.net":1,"et7l.net":1,"wd2f.net":1,"nvaz.net":1,"ozkewk.net":1,"5sfo.net":1,"qumg.net":1,"5l5h.net":1,"cwv7.net":1,"qbt4.net":1,"ytuz.net":1,"3xvk.net":1,"zlyuo6.net":1,"58mq.net":1,"z27l.net":1,"iqoc.net":1,"eqjw.net":1,"dbapeb.net":1,"hgphc2.net":1,"wnbi.net":1,"te8rfv.net":1,"qyiv3c.net":1,"jv6k.net":1,"9rwv.net":1,"zgkv.net":1,"p5ld.net":1,"s4lle7.net":1,"eqcm.net":1,"wsktbf.net":1,"7ema.net":1,"2rch.net":1,"y6mxrg.net":1,"cmuw.net":1,"jedg.net":1,"wmempi.net":1,"lmwjx3.net":1,"zpn8dk.net":1,"z724.net":1,"zihf.net":1,"i5md.net":1,"yaub.net":1,"syuh.net":1,"htuy.net":1,"pbj2.net":1,"zvq6.net":1,"rg35.net":1,"8ibi.net":1,"kbp968.net":1,"5zd6.net":1,"n72aat.net":1,"aiy7.net":1,"nnh2.net":1,"z6rjha.net":1,"7fdy.net":1,"8bvm.net":1,"qodh.net":1,"jwpdsd.net":1,"otegtm.net":1,"2t23.net":1,"i5em.net":1,"xibx.net":1,"xlwzq3.net":1,"deg5.net":1,"3anx.net":1,"78cfvm.net":1,"57ib.net":1,"6dny.net":1,"auhm.net":1,"tm7566.net":1,"tm7516.net":1,"tm7569.net":1,"tm7559.net":1,"tm7560.net":1,"tm7562.net":1,"tm8534.net":1,"lusg.net":1,"bxvfun.net":1,"8bga.net":1,"22o6.net":1,"ebml.net":1,"9q66.net":1,"i679.net":1,"attfm2.net":1,"ztk5.net":1,"dubn.net":1,"yuxg.net":1,"2nm686.net":1,"meqk.net":1,"kd4a.net":1,"e2rq.net":1,"m43q4j.net":1,"hblm3c.net":1,"yvzx.net":1,"vp6l.net":1,"u97e.net":1,"5rmr.net":1,"qyov.net":1,"yoxl.net":1,"e54b.net":1,"akum7z.net":1,"hg7mxc.net":1,"pdy5.net":1,"aqpq.net":1,"mivh.net":1,"eqwh.net":1,"vx83.net":1,"vtdix3.net":1,"xvtl.net":1,"ulvh.net":1,"cw3o.net":1,"zvcr.net":1,"eat8mo.net":1,"ikkr9x.net":1,"6x7g.net":1,"bzi2vw.net":1,"43a8.net":1,"gfpv.net":1,"sjv.io":1,"pxf.io":1,"affiliates.abebooks.com":1,"go.corsair.com":1,"go.gemvara.com":1,"go.jewelry.com":1,"go.web.plus.espn.com":1,"goto.bodybuilding.com":1,"goto.carters.com":1,"goto.grocery.walmart.com":1,"goto.kayosports.com.au":1,"goto.target.com":1,"goto.walmart.com":1,"hpn.houzz.com":1,"linkto.hrblock.com":1,"partners.alamo.com":1,"partners.enterprise.com":1,"partners.hostgator.com":1,"partners.hotwire.com":1,"partners.nationalcar.com":1,"refer.turo.com":1,"tracking.maxcdn.com":1,"tracking.stackpath.com":1,"hpn.houzz.co.uk":1,"partners.wantable.co":1,"i284638.net":1,"xayxet.net":1,"7sb2uw.net":1,"dcm9zy.net":1,"6jxl.net":1,"cfzu.net":1,"i140643.net":1,"i125364.net":1,"i127288.net":1,"8ocm68.net":1,"jlud63.net":1,"i312864.net":1,"rv8crv.net":1,"haujjd.net":1,"qq3wj3.net":1,"4hyab9.net":1,"i308314.net":1,"oet7.net":1,"uym8.net":1,"avo2.net":1,"i279709.net":1,"i139476.net":1,"3tpfen.net":1,"bbgqo9.net":1,"i139049.net":1,"nm3tqp.net":1,"soyxmd.net":1,"partner.canva.com":1,"4xc4ep.net":1,"frhi32.net":1,"wrjfga.net":1,"i206080.net":1,"8s4u9r.net":1,"fubo.tv":1,"8u86.net":1,"shrw9t.net":1,"ouod.net":1,"i157428.net":1,"i274555.net":1,"gqce.net":1,"nhuie7.net":1,"i310051.net":1,"i351729.net":1,"i181536.net":1,"xyibsh.net":1,"i326295.net":1,"obak77.net":1,"7w7o67.net":1,"i206938.net":1,"zvvq7p.net":1,"oloiyb.net":1,"wvr2.net":1,"8rh8hm.net":1,"i276600.net":1,"i358707.net":1,"d67ag4.net":1,"magpmk.net":1,"i7cdw9.net":1,"i114090.net":1,"ubertrk.com":1,"i240138.net":1,"7ufqwl.net":1,"fdcm73.net":1,"n5ka.net":1,"q77h.net":1,"goto.bluenile.com":1,"bodybuilding.com":1,"ayph.net":1,"pvzi.net":1,"35p2.net":1,"cezg3w.net":1,"i294747.net":1,"ml6pmo.net":1,"i200065.net":1,"k77v.net":1,"l49yho.net":1,"i301580.net":1,"lf49oc.net":1,"i242740.net":1,"i142493.net":1,"zvbf.net":1,"risj.net":1,"partners.inmotionhosting.com":1,"fum2sp.net":1,"av4d.net":1,"i240196.net":1,"i134524.net":1,"i263265.net":1,"i8epma.net":1,"ihfo.net":1,"i209368.net":1,"oedf.net":1,"i6xjt2.net":1,"i328067.net":1,"i146980.net":1,"idgz2n.net":1,"drn3.net":1,"i305175.net":1,"i271380.net":1,"vxca.net":1,"c3me6x.net":1,"i317579.net":1,"iyhh.net":1,"wgn3fr.net":1,"vthnbx.net":1,"i277339.net":1,"ifgza3.net":1,"llbyf9.net":1,"c5l5.net":1,"i263671.net":1,"4fq8.net":1,"blihtq.net":1,"rjnwm7.net":1,"43zz.net":1,"i275503.net":1,"i276271.net":1,"2gl34e.net":1,"i206969.net":1,"i303683.net":1,"hbbswr.net":1,"ewrvdi.net":1,"hq6ajo.net":1,"kmlj9i.net":1,"goto.americanexpress.com":1,"hw4zyk.net":1,"4ok7ht.net":1,"i179050.net":1,"wmsyr7.net":1,"a6gkwq.net":1,"i257289.net":1,"4tqiav.net":1,"i203032.net":1,"ie8t3j.net":1,"xr2bd6.net":1,"i286093.net":1,"ustnul.net":1,"uewp.net":1,"nd8t.net":1,"txuqk6.net":1,"xpfo.net":1,"8x7ctf.net":1,"i130883.net":1,"i295461.net":1,"i294432.net":1,"t7c9v8.net":1,"chx3kt.net":1,"i297327.net":1,"c38gzp.net":1,"i123888.net":1,"i246982.net":1,"i148866.net":1,"gcc3.net":1,"ver28r.net":1,"xkpq.net":1,"xkri.net":1,"9yde.net":1,"i134784.net":1,"xhtgk3.net":1,"hv8ceq.net":1,"77jaha.net":1,"9u2rlz.net":1,"uztnuq.net":1,"mkr3.net":1,"642pbb.net":1,"2xkn.net":1,"qk4r.net":1,"gfko.net":1,"mno8.net":1,"znhhcm.net":1,"iybsj3.net":1,"aht6xo.net":1,"8zaeu3.net":1,"kjorbe.net":1,"sfe5.net":1,"i299105.net":1,"6uu72h.net":1,"4g9yrz.net":1,"1.envato.market":1,"4drrzr.net":1,"c3nu2i.net":1,"vs9au6.net":1,"tdndqm.net":1,"i339540.net":1,"i285710.net":1,"i250869.net":1,"775j.net":1,"7q8j.net":1,"83ckgt.net":1,"i300907.net":1,"qn6r.net":1,"p8mc.net":1,"lgkftb.net":1,"i334637.net":1,"i205484.net":1,"ldw66v.net":1,"aqp4qa.net":1,"i358993.net":1,"i168918.net":1,"hnyj8s.net":1,"7qto.net":1,"i121497.net":1,"mrlph3.net":1,"fhsxpf.net":1,"npfrrw.net":1,"i116782.net":1,"u7lr6p.net":1,"648q.net":1,"tbthfv.net":1,"i116503.net":1,"uqrxu7.net":1,"i302106.net":1,"i183635.net":1,"pa4kxy.net":1,"3obyns.net":1,"i210675.net":1,"xb398u.net":1,"i276400.net":1,"fb8d.net":1,"kbasqv.net":1,"i189637.net":1,"i190936.net":1,"i140070.net":1,"i353150.net":1,"t2bw9u.net":1,"vvtnn9.net":1,"p3oc.net":1,"g6gdil.net":1,"i213011.net":1,"ule4b9.net":1,"qy67zi.net":1,"8zgmnp.net":1,"wxc9hm.net":1,"bueme2.net":1,"wcmu8e.net":1,"i260660.net":1,"2ygtwc.net":1,"i122908.net":1,"74tzgq.net":1,"e4wb.net":1,"5nfc.net":1,"zafxzt.net":1,"e9ppfh.net":1,"tv2h87.net":1,"nkygzf.net":1,"i108736.net":1,"i163678.net":1,"i144304.net":1,"f6rcao.net":1,"9yoxzr.net":1,"erik73.net":1,"r37x9j.net":1,"ng4cgr.net":1,"8v4lqg.net":1,"o7n83a.net":1,"i261477.net":1,"m4ibck.net":1,"74xz8u.net":1,"i169060.net":1,"i117711.net":1,"epvitm.net":1,"puasq9.net":1,"wf373c.net":1,"gyuyee.net":1,"pkpakz.net":1,"i340849.net":1,"i344083.net":1,"i203761.net":1,"i270719.net":1,"vwli.net":1,"i295768.net":1,"i359245.net":1,"i258711.net":1,"rvgu.net":1,"mwztt8.net":1,"elfm.net":1,"eyjo.net":1,"gqco.net":1,"hmxg.net":1,"ijrn.net":1,"jewn.net":1,"tzva.net":1,"wfraqy.net":1,"dne9je.net":1,"4byfvk.net":1,"i181990.net":1,"xq2wid.net":1,"7oyhzp.net":1,"aydjxz.net":1,"i331371.net":1,"ffxwxg.net":1,"i363662.net":1,"obbk.net":1,"fgjaok.net":1,"h382za.net":1,"i113075.net":1,"i130297.net":1,"a49pb4.net":1,"8kpa2n.net":1,"i128439.net":1,"i326837.net":1,"w27s.net":1,"gtlppj.net":1,"i104546.net":1,"go.silpada.com":1,"i160067.net":1,"gvhb.net":1,"8lvxaf.net":1,"i191769.net":1,"awv4zz.net":1,"gtlptb.net":1,"7ck3j6.net":1,"w7ma.net":1,"j8ujgp.net":1,"c2ukkg.net":1,"u4prjd.net":1,"t2nfq3.net":1,"i317572.net":1,"i246054.net":1,"woc3yh.net":1,"zytd7d.net":1,"jpzeir.net":1,"li9jiy.net":1,"i141006.net":1,"i141602.net":1,"mzte.net":1,"vz7pkt.net":1,"yardaz.net":1,"a49tr6.net":1,"tkl68z.net":1,"i298770.net":1,"2uf4ta.net":1,"i156748.net":1,"jmx223.net":1,"nqn6.net":1,"n72y7a.net":1,"i357552.net":1,"i274396.net":1,"vdvm.net":1,"8n4773.net":1,"btyhsg.net":1,"g7ix2j.net":1,"4qxjn9.net":1,"vfjm.net":1,"nrlq2m.net":1,"wyfx2f.net":1,"4emhls.net":1,"ovon4f.net":1,"2rcf97.net":1,"krym8q.net":1}},null==this._envSettings.events_recording_env&&(this._envSettings.events_recording_env="prod"),this._embedUrlToken="FR-EMBEDDED-RF",this._delimiter1="|",this._delimiter2="~",this._delimiter3="%40%40",this._delimiter4="-",this._logPrefix="FunnelRelay:: ",this._loadTime=Date.now(),this._links=[],this._links_unique={},this._customLinks=new Map,this._report={},this._exclude_urls_regex=[],this._scriptEm=document.getElementById("funnel-relay-installer"),null!=this._scriptEm){if(!this._scriptEm.hasAttribute("data-property-id")||!this._scriptEm.hasAttribute("data-customer-id")||this._isEmpty(this._scriptEm.hasAttribute("data-property-id"))||this._isEmpty(this._scriptEm.hasAttribute("data-customer-id")))return void this._error("Missing one of the mandatory script attributes 'data-customer-id' and/or 'data-property-id'");this._customerId=this._scriptEm.getAttribute("data-customer-id"),this._propertyId=this._scriptEm.getAttribute("data-property-id"),this._isSimulator=this._scriptEm.hasAttribute("data-simulator")}else{if(!window.trxFrTag)return void this._error('Installation script is missing  id="funnel-relay-installer" attribute. Funnel Relay will not run');this._customerId=window.trxFrCustomerId,this._propertyId=window.trxFrPropertyId,this._isSimulator=!1}this._wait_then_click=!1,this._wait_then_click=/iPad|iPhone|iPod/.test(navigator.platform||""),0==this._wait_then_click&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.wait_then_click&&!0===this._asBoolean(this._serverSettings.features.wait_then_click.enabled)&&(this._wait_then_click=!0),this._new_window=!1,0==this._new_window&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.new_window&&!0===this._asBoolean(this._serverSettings.features.new_window.enabled)&&(this._new_window=!0),this._iid_track=!1,0==this._iid_track&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.iid_track&&!0===this._asBoolean(this._serverSettings.features.iid_track.enabled)&&(this._iid_track=!0),this._asin_map=!1,0==this._asin_map&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.asin_map&&!0===this._asBoolean(this._serverSettings.features.asin_map.enabled)&&(this._asin_map=!0),this._asin_tag=!1,0==this._asin_tag&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.asin_tag&&!0===this._asBoolean(this._serverSettings.features.asin_tag.enabled)&&(this._asin_tag=!0),this._use_beacon=!1,0==this._use_beacon&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.use_beacon&&!0===this._asBoolean(this._serverSettings.features.use_beacon.enabled)&&(this._use_beacon=!0),void 0!==trx.amp_redirect&&1==trx.amp_redirect?this.ampRedirectNow():(this._prepareSettings(),this._prepareExcludeRegExp(),this._autoRun&&this.run(),this.retransmit_sotrage_items(),this._observe=!1,0==this._observe&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.observe&&!0===this._asBoolean(this._serverSettings.features.observe.enabled)&&(this._observe=!0),this._observe&&this.observe(),this._url_change=!1,0==this._url_change&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.urlchange&&!0===this._asBoolean(this._serverSettings.features.urlchange.enabled)&&(this._url_change=!0),null==trx.his&&this._url_change&&(trx.his=!0,this._debug("bind location change!"),history.pushState=(n=history.pushState,function(){var e=n.apply(this,arguments);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange")),e}),history.replaceState=(t=history.replaceState,function(){var e=t.apply(this,arguments);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("locationchange")),e}),window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("locationchange"))}),window.addEventListener("locationchange",e=>{this._debug("location: "+document.location+", state: "+JSON.stringify(e.state)),this._runFeatures(!0)})))}catch(e){console.error("Magic Links 'init' procedure fail! Details: "+e),e.stack&&console.error(e.stack)}var t,n}observe(){var t;void 0===trx.observer&&(t=0,window.MutationObserver&&(trx.observer=new MutationObserver(function(e){1<t||1==(t+=1)&&setTimeout(function(){trx.magicLinksSimulator&&(this._links=[]),this._debug("Rerun..."),this.run(),t=0}.bind(this),3e3)}.bind(this)),trx.observer.observe(document.body,{attributes:!0,childList:!0,subtree:!0})))}retransmitlog(n){var e=this._envSettings.events_recording_api+"/log",t={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"*client",body:n};return navigator.sendBeacon&&this._use_beacon?navigator.sendBeacon(e,n):fetch(e,t).then(e=>{if(e.ok){var t="Write to events-recording service. Body:\n"+n;return this._isSimulator&&this._log(t),this._debug(t),e.json()}this._log("Fail to write event data. HTTP error, status = "+e.status)}).then(e=>{e&&e.message&&this._log(e.message)}).catch(e=>{this._log(e)})}retransmit(n){var e=this._envSettings.events_recording_api+"/write",t={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"*client",body:n};return navigator.sendBeacon&&this._use_beacon?navigator.sendBeacon(e,n):fetch(e,t).then(e=>{if(e.ok){var t="Write to events-recording service. Body:\n"+n;return this._isSimulator&&this._log(t),this._debug(t),e.json()}this._log("Fail to write event data. HTTP error, status = "+e.status)}).then(e=>{e&&e.message&&this._log(e.message)}).catch(e=>{this._log(e)})}retransmit_sotrage_items(){if("undefined"!=typeof Storage){var n;for(let t=0;t<localStorage.length;t++){let e=localStorage.key(t);e.startsWith("fr_click_")?(n=localStorage.getItem(e),this.retransmit(n),localStorage.removeItem(e)):e.startsWith("fr_log_")&&(n=localStorage.getItem(e),this.retransmitlog(n),localStorage.removeItem(e))}}}parseQueryString(e){for(var t,n,i={},r=0,a=(t=e.split("&")).length;r<a;r++)(n=t[r].split("="))[0]=n[0].replace("?",""),i[n[0]]=n[1];return i}ampRedirectNow(){this.targetUrl=null;var t,n=this.parseQueryString(location.search);if(n.anchor_href){this.targetUrl=n.anchor_href;let e=document.getElementById("fr-link");e.href=decodeURIComponent(this.targetUrl),n.source&&(trx.source=decodeURIComponent(n.source)),n.referrer&&(trx.referrer=decodeURIComponent(n.referrer),0<window.history.length)&&(t=window.history.pop(),console.log(t)),this._prepareSettings(),this._prepareExcludeRegExp(),this.run(),0===this._links.length&&(location.href=e.href),this._collectClickTimeParams(),this._addMetadataFromRequest(n),this._writeDataToEventsService(this._links[0],"AMP").then(()=>{e.setAttribute("data-written","true"),e.click()})}}_addMetadataFromRequest(n){if(void 0!==this._settings.features&&void 0!==this._settings.features.metadata){let e=this._settings.features.metadata;if(this._asBoolean(e.enabled)&&!this._isEmpty(e.selectors)){var i,r=e.selectors.split("\n");for(let e=0;e<r.length;e++)try{let t=r[e];if(this._isEmpty(t))this._log("Ignoring empty line in metadata settings.");else{let e=t.split("|");if(1<e.length){if(i=e[0].trim(),0===e[1].trim().length)continue;void 0===n[i]||this._isEmpty(n[i])||(this._paramsBuffer.metadata[i]=n[i])}else this._log("Invalid metadata line. Line must have name and Xpath value in this format: name | xpath ")}}catch(n){this._log(n)}}}}get onPageSettings(){return this._onPageSettings}get serverSettings(){return this._serverSettings.hasOwnProperty("SETTINGS_PLACEHOLDER")?{}:this._serverSettings}get paramsBuffer(){return this._paramsBuffer}static renderLinkPreview(a,e){let t=document.querySelector('iframe[data-ml-preview="'+a+'"]');if(null==t){let r=document.querySelector('a[data-ml-id="'+a+'"]');if(null!=r){let e=document.createElement("iframe");e.setAttribute("data-ml-preview",a),e.setAttribute("scrolling","no"),e.setAttribute("frameborder","0"),e.style.borderStyle="solid",e.style.borderWidth="2px",e.style.borderColor="grey",e.style.borderRadius="3px",e.style.position="absolute",e.style.width="120px",e.style.height="90px",e.style.background="#fff";var s=document.documentElement,a=r.getBoundingClientRect();e.style.top=a.top+(window.pageYOffset-s.clientTop)-100+"px",e.style.left=a.left+(window.pageXOffset-s.clientLeft)+(a.width-60)+"px",document.body.appendChild(e);let t=e.contentWindow||e.contentDocument;t.document&&(t=t.document);let n=t.createElement("img"),i="http://images.shrinktheweb.com/xino.php?stwembed=1&stwaccesskeyid=4abc115f8a632c5&stwsize=120x90&stwurl="+r.href;n.setAttribute("src",i),n.style.width="100%",n.style.height="auto",t.body.appendChild(n),t.body.style.padding="1px"}e.stopImmediatePropagation()}else t.parentNode.removeChild(t)}run(){if(this.isInRunFunction)this._debug("Already in run function.");else{this.isInRunFunction=!0;try{if(this._isEmpty(this._envSettings.events_recording_api))return void this._error("Missing environment settings. Check that you setup $ENV_SETTINGS in my.cfg.php and that 'events_recording_api' is set there!");if(!this._checkPageUrlMatch())return;if(0<document.links.length)for(let t=0;t<document.links.length;t++){let e=document.links[t];var n;trx.magicLinksSimulator&&(n=e.getAttribute("data-orig-url"),this._isEmpty(n)||(e.href=n),e.removeAttribute("data-ml-dynamic-type"),e.removeAttribute("data-ml-dynamic"),e.removeAttribute("data-ml-id"),e.removeAttribute("data-xid"),e.removeAttribute("data-ml")),e.hasAttribute("data-skimlinks-tracking")&&e.setAttribute("data-skimlinks-tracking",this._cleanupXid(e.getAttribute("data-skimlinks-tracking")))}this._detectLinks(),this._disbaleLinks(),0<this._links.length&&(this._appendUUID(),this._runFeatures()),(this._asin_map||this._asin_tag)&&this._asinMapCall(),this._logPageTrace(),this._debug("Links count "+this._links.length);for(let t=0;t<this._links.length;t++){let e=this._links[t];e.info.dynamic||e.info.disable||(e.info.embedded?e.anchor.href=e.info.wrapping_url.replace(this._embedUrlToken,encodeURIComponent(e.info.url)):void 0!==e.info.selector_attribute?e.anchor[e.info.selector_attribute]=e.info.url:e.anchor.href=e.info.url)}null!=r&&"true"===r.getAttribute("data-report")&&this._postReport(),void 0!==trx.SpotClient&&(trx.spotEngine=new trx.SpotClient(this),trx.spotEngine.start()),this._iid_track&&this._updateIID()}catch(e){this._error("'run' procedure fail! Details: "+e,e.stack),this.isInRunFunction=!1}this.isInRunFunction=!1}}_asinMapCall(){var r=this._customerId.split("_");if(this._envSettings.asin_map_api&&trx.LZString&&trx.md5&&1<r.length){let e=r[r.length-1],t=window.location.href,n=Object.keys(this._prepareAnchorASIN()).sort(),i=[this._envSettings.asin_map_api,e,"/",trx.md5(t+n.join(",")),"?client="+r[0]];this._asin_tag&&i.push("&tags=","1"),fetch(i.join("")+"&data="+trx.LZString.compressToEncodedURIComponent(JSON.stringify({url:t,asin:n})),{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},redirect:"follow",referrer:"*client"}).then(e=>{e.text().then(e=>{})})}}_prepareAnchorASIN(){let r={};for(let i=0;i<document.links.length;i++){let e=document.links[i],t=e.href,n=e.getAttribute("data-orig-url");var a;this._isEmpty(n)||(t=n),"amazon"===this._detectKnownAffiliateLink(t,{})&&null!==(a=this._findAsin(t))&&(null==r[a]&&(r[a]=[]),r[a].push(e))}return r}_updateIID(){var e=!1;if(void 0===trx.iid&&(e=!0,trx.iid=this._generateUUID().replace("fr","iid")),void 0!==trx.LZString&&void 0!==this._envSettings.events_recording_iid){if(e){let t=this._paramsBuffer;if(t.client_time=(new Date).toISOString(),t.page_title=document.title,t.iid=trx.iid,t.event_type="impression",void 0===t.customer_id){t.cidp1=t.customer_id=this._customerId;const n=this._paramsBuffer.customer_id.split("_");if(-1!==t.customer_id.indexOf("_")){const n=t.customer_id.split("_");if(2<n.length){let e=n.slice(0,n.length-1);t.cidp1=e.join("_"),t.cidp2=n[n.length-1]}}}var n=JSON.stringify(t),e=trx.LZString.compressToEncodedURIComponent(n);this._debug("Meta "+n.length+"  bytes decresed to "+e.length+" bytes ("+Math.round(100*e.length/n.length)+" %)");var i=this._envSettings.events_recording_iid+"/i/m/i.png?q="+e;this.pixel_append(i),8e3<=i.length&&"undefined"!=typeof Storage&&(d="fr_log_"+Math.round((new Date).getTime()/1e3),(c=this._getLogInfomration({})).url=window.location.href,c.message="pixel too big "+i.length,localStorage.setItem(d,JSON.stringify(c)))}if(0<this._links.length){var t,r=[],a=0,s=0;for(t in this._links)void 0===r[a]&&(r[a]={}),r[a][this._links[t].info.xid]=this._links[t].anchor.getAttribute("data-orig-url"),25<=s&&(a+=1,s=0),s+=1;for(var o,l,d,c,u=0;u<=a;u++)void 0!==r[u]&&(this._debug(r[u]),l={pid:this._paramsBuffer.customer_id,iid:trx.iid,xids:r[u]},o=JSON.stringify(l),l=trx.LZString.compressToEncodedURIComponent(o),this._debug(o.length+" bytes decresed to "+l.length+" bytes ("+Math.round(100*l.length/o.length)+" %)"),i=this._envSettings.events_recording_iid+"/i/x/i.png?q="+l,this.pixel_append(i),8e3<=i.length&&"undefined"!=typeof Storage&&(d="fr_log_"+Math.round((new Date).getTime()/1e3),(c=this._getLogInfomration({})).url=window.location.href,c.message="pixel too big "+i.length,localStorage.setItem(d,JSON.stringify(c))))}}}pixel_append(e){var t=document.createElement("img");t.height="1",t.width="1",t.style="border-style:none;",t.alt="",t.src=e,document.body.appendChild(t)}registerCustomLinks(e){for(var[t,n]of e)this.registerCustomLink(t,n)}registerCustomLink(t,n){if(this._isEmpty(t)||this._isEmpty(n))this._error("registerCustomLink method was invoked with either empty 'id' or empty 'url' arguments. Check you call to method(s) 'registerCustomLink' / 'registerCustomLinks'");else{let e=document.getElementById(t);null!=e&&e.parentNode.removeChild(e),(e=document.createElement("a")).href=n,e.id=t,e.style.display="none",e.setAttribute("data-ml-custom-link","true"),e.setAttribute("target","_blank"),document.body.append(e),this._customLinks.set(t,{orig_url:n})}}getProcessedCustomLinks(){for(var[t,n]of this._customLinks){let e=document.getElementById(t);n.processed=e.hasAttribute("data-ml"),n.processed&&(n.fr_url=e.href)}return this._customLinks}recordCustomLinkClick(n,i){try{let t=!1;for(let e=0;e<this._links.length;e++){var r=this._links[e];if(r.anchor.id===n){var a={type:"custom-url"};this._linkClicked(r,a,i),t=!0;break}}t||this._error("recordCustomLinkClick was invoked with unrecognized id: '"+n+"'. The id should be the same as the value used when you invoked registerCustomLink(...) or registerCustomLinks(...)")}catch(n){this._error("Fail to trigger custom link. Details: "+n,n.stack)}}_runFeatures(t){if(this._paramsBuffer.origin=this.href,this._paramsBuffer.property_id=this._propertyId,this._paramsBuffer.customer_id=this._customerId,this._paramsBuffer.cidp1=this._paramsBuffer.customer_id,this._paramsBuffer.cidp2="-",-1!==this._paramsBuffer.customer_id.indexOf("_")){const t=this._paramsBuffer.customer_id.split("_");if(2<t.length){let e=t.slice(0,t.length-1);this._paramsBuffer.cidp1=e.join("_"),this._paramsBuffer.cidp2=t[t.length-1]}}this._paramsBuffer.source=location.href,void 0!==trx.source&&(this._paramsBuffer.source=trx.source,this._paramsBuffer.urls.source=trx.source,this._paramsBuffer.amp_source=location.href),this._paramsBuffer.event_type="click",this._prepareCustomMetadata();let e=this._settings.features;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];if(!this._asBoolean(i.enabled))continue;switch(n){case"append_referrer":this._appendReferrer(i);break;case"append_timing":this._appendTiming(i);break;case"append_attributes":this._appendAttributes(i);break;case"attributes_forwarding":this._attributesForwarding(i,t);break;case"track_events":this._prepareEventTracking(i);break;case"auto_optimize_link":this._autoOptimizeLinks(i);break;case"link_preview":this._preparePreview(i);break;case"shorten_extra_param":this._prepareShortExtraParam(i);break;case"metadata":this._prepareMetadata(i)}}if(1!=t){for(let t=0;t<this._links.length;t++){let e=this._links[t];var r;1!=e.info.disable&&(null!=e.anchor.click_fn&&"function"==typeof e.anchor.click_fn&&e.anchor.removeEventListener("click",e.anchor.click_fn),r=this._linkClicked.bind(this,e),e.anchor.addEventListener("click",r),e.anchor.click_fn=r,null!=e.anchor.contextmenu_fn&&"function"==typeof e.anchor.contextmenu_fn&&e.anchor.removeEventListener("contextmenu",e.anchor.contextmenu_fn),r=this._linkClicked.bind(this,e),e.anchor.addEventListener("contextmenu",r),e.anchor.contextmenu_fn=r)}this._setSkimDynamicXcust()}}_setSkimDynamicXcust(){if(this._asBoolean(this._settings.detection_rules.auto_networks.dynamic))for(let e=0;e<this._links.length;e++){let t=this._links[e];if(t.info.dynamic&&"sl"===t.info.dynamicType){let e=t.anchor.hasAttribute("data-skimlinks-tracking")?t.anchor.getAttribute("data-skimlinks-tracking"):"";e=this._cleanupXid(e),this._isEmpty(e)||(e+="|"),e+="xid:"+t.info.xid,t.anchor.setAttribute("data-skimlinks-tracking",e)}}}_linkClicked(i,t,n){if("true"!==i.anchor.getAttribute("data-written")){if(this._wait_then_click&&0==t.button&&t.preventDefault(),i.info.dynamic)if("vg"===i.anchor.getAttribute("data-ml-dynamic-type")){let e=vglnk.opt("cuid");e=this._cleanupXid(e),this._isEmpty(e)||(e+="|"),e+="xid:"+i.info.xid,vglnk.opt("cuid",e)}this._collectClickTimeParams();if(void 0===i.anchor||"true"!==i.anchor.getAttribute("data-written")){let e=this._promiseTimeout(2e3,this._writeDataToEventsService(i,t.type,n));this._wait_then_click&&0==t.button&&(e.then(()=>{i.anchor.setAttribute("data-written","true"),i.anchor.click()}),e.catch(e=>{var t,n;"undefined"!=typeof Storage&&(t="fr_log_"+Math.round((new Date).getTime()/1e3),(n=this._getLogInfomration(JSON.parse(JSON.stringify(this._paramsBuffer)))).message=e,n.xid=i.info.xid,localStorage.setItem(t,JSON.stringify(n))),i.anchor.setAttribute("data-written","true"),i.anchor.click()}))}}else this._debug("click already saved.")}_promiseTimeout(i,e){var t=new Promise((e,t)=>{let n=setTimeout(()=>{clearTimeout(n),t("Timed out in "+i+"ms.")},i)});return Promise.race([e,t])}_cleanupXid(e,t){if(null==e)return"";let n,i;return null==t&&(t=""),this._isEmpty(e)||(n=e.indexOf("|xid:fr"),i="|xid:fr".length,-1===n&&(n=e.indexOf("xid:fr"),i="xid:fr".length),-1!==n&&(e=this._insertSubstringToString(e,t,n,n+i+16))),e}_appendUUID(){var r={amazon:this._asBoolean(this._settings.detection_rules.amazon_no_append)};for(let e=0;e<this._links.length;e++){let i=this._links[e];if(!i.anchor.hasAttribute("data-xid")){let e=i.info.url,t=i.network,n=this._generateUUID();1==i.anchor.hasAttribute("data-prepend-xid")&&(n=i.anchor.getAttribute("data-prepend-xid")),this._xids[n]="",i.info.xid=n,null!=r[t]&&!1!==r[t]||1==i.anchor.hasAttribute("data-prepend-xid")&&1==i.anchor.hasAttribute("data-affiliation-url")||(i.info.embedded&&null!=i.info.wrapping_url&&-1==i.info.wrapping_url.indexOf("shop-links.co")&&(i.info.wrapping_url=this._appendExtraParam(i.info.wrapping_net,i.info.wrapping_url,"xid",n,!1)),i.info.url=this._appendExtraParam(t,e,"xid",n,!1)),i.anchor.setAttribute("data-xid",n),this._new_window&&0==i.anchor.hasAttribute("target")&&i.anchor.setAttribute("target","_blank"),null!=window.trxdebug&&i.anchor.setAttribute("data-network",t)}}}_appendReferrer(n){if(this._asBoolean(n.enabled)){let e=n.attr_name,t=(this._asBoolean(n.new_query_param),document.referrer);void 0!==trx.referrer&&(t=trx.referrer),"/"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),this._paramsBuffer[e]=t,this._paramsBuffer.urls.referrer=t,this._paramsBuffer.urls.is_trx_referrer=void 0!==trx.referrer}}_appendTiming(e){this._asBoolean(e.enabled)&&(this._asBoolean(e.new_query_param),e.t_load&&(this._paramsBuffer.t_loaded=this._loadTime,this._paramsBuffer.timing.t_loaded=this._loadTime))}_appendAttributes(e){this._asBoolean(e.enabled)&&0<!this._isEmpty(e.attributes)&&this._parseQuery(e.attributes).forEach((t,n,e)=>{for(let e=0;e<this._links.length;e++){this._links[e];this._paramsBuffer[n]=t,this._paramsBuffer.attr_append[n]=t}})}_attributesForwarding(i,t){if(this._asBoolean(i.enabled)&&i.attributes instanceof Array&&0<i.attributes.length){!0===t&&(this._paramsBuffer.attr_forwarding={});let e=location.search;if(void 0!==trx.source&&(e="?"+trx.source.replace(/(\S*)\?/,"")),!this._isEmpty(e)&&1<e.length&&this._parseQuery(e.substring(1)).forEach((e,t,n)=>{i.attributes.includes(t)&&(this._paramsBuffer.attr_forwarding[t]=e)}),sessionStorage)if(null!=this._paramsBuffer.attr_forwarding&&"null"!=this._paramsBuffer.attr_forwarding||(this._paramsBuffer.attr_forwarding={}),0==Object.keys(this._paramsBuffer.attr_forwarding).length)try{this._paramsBuffer.attr_forwarding=JSON.parse(sessionStorage.getItem("fr_attr_forwarding")),null!=this._paramsBuffer.attr_forwarding&&"null"!=this._paramsBuffer.attr_forwarding||(this._paramsBuffer.attr_forwarding={})}catch(i){this._debug(i),this._paramsBuffer.attr_forwarding={}}else sessionStorage.setItem("fr_attr_forwarding",JSON.stringify(this._paramsBuffer.attr_forwarding))}}_prepareEventTracking(r){if(this._asBoolean(r.enabled)){if(this._isEmpty(r.analytics_code)||0!==r.analytics_code.indexOf("UA-")||"undefined"==typeof ga){if(this._isEmpty(r.analytics_code)||"undefined"==typeof s||"function"!=typeof s.tl)return;this.trackerObj=new trx.AdobeTracker(r.analytics_code)}else this.trackerObj=new trx.GATracker(r.analytics_code);if(this._asBoolean(r.pageview)&&this.trackerObj.trackPageView(),this._asBoolean(r.clicks))for(let i=0;i<this._links.length;i++){let e=this._links[i],t=e.anchor,n=e.info.xid;t.addEventListener("click",()=>{var e=this._getAnchorLabel(t,50)+" ["+t.href+"]";this.trackerObj.trackEvent("magic-links","click",e,"1",{xid:n,anchor:t,props_map:r.props_map,props_map_custom:r.props_map_custom,data:this.paramsBuffer})}),this._markLink("feature","track_events",t)}}}_autoOptimizeLinks(e){this._asBoolean(e.enabled)}_preparePreview(e){if(this._asBoolean(e.enabled)){if(e.show_icon)for(let n=0;n<this._links.length;n++){let e=this._links[n].anchor,t=document.createElement("span");t.style.cursor="pointer",t.innerHTML="&nearr;",t.addEventListener("click",trx.MagicLinks.renderLinkPreview.bind(this,e.getAttribute("data-ml-id"))),e.insertAdjacentElement("afterend",t),this._markLink("feature","preview",e)}e.show_metadata,e.show_coupons}}_prepareShortExtraParam(e){this._asBoolean(e.enabled)}_prepareCustomMetadata(){var e={autorun:1,report:1,version:1,simulator:1,"property-id":1,"customer-id":1};if(null!=this._scriptEm&&void 0!==this._scriptEm.attributes)for(var t=0;t<this._scriptEm.attributes.length;t++){var n,i=this._scriptEm.attributes[t];-1!==i.name.indexOf("data-")&&(e[n=i.name.replace("data-","")]||(this._debug(n+" = "+i.value),this._paramsBuffer.custom_meta[n]=i.value))}}_prepareMetadata(t){if(!this._isEmpty(t.selectors)){let n,i,r,a=t.selectors.split("\n");for(let e=0;e<a.length;e++)try{let t=a[e];if(this._isEmpty(t))this._log("Ignoring empty line in metadata settings.");else{let e=t.split("|");if(1<e.length){if(n=e[0].trim(),0===(i=e[1].trim()).length)continue;var s,o,l,d;0===i.indexOf("js::")?(s=i.replace("js::","").trim(),null==(r=trx.MagicLinks._getObjectByPath(s))&&("function"==typeof trx.get[n]?r=trx.get[n]():this._log("Missing function trx.get."+n))):0===i.indexOf("ck::")?(o=i.replace("ck::","").trim(),this._isEmpty(o)?this._log("Invalid metadata cookie line. Cookie name is missing"):r=this._getCookie(o)):0===i.indexOf("ls::")?(l=i.replace("ls::","").trim(),"undefined"!=typeof Storage&&(d=window.localStorage.getItem(l),this._isEmpty(d)?this._log("Invalid metadata localStorage line. Sorage name is missing"):r=d)):"function"==typeof document.evaluate&&(r=document.evaluate(i,document,null,XPathResult.STRING_TYPE,null).stringValue),this._isEmpty(r)||((r instanceof Array||"number"==typeof r)&&(r=r.toString()),this._paramsBuffer[n]=r.trim(),this._paramsBuffer.metadata[n]=r.trim())}else this._log("Invalid metadata line. Line must have name and Xpath value in this format: name | xpath ")}}catch(t){this._log(t)}}}_getCookie(e){var n=e+"=",i=decodeURIComponent(document.cookie).split(";");for(let t=0;t<i.length;t++){let e=i[t];for(;" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(n))return e.substring(n.length,e.length)}return""}_logPageTrace(){try{if(sessionStorage){var n,i=this._needToClearTraces(),r=[];try{r=JSON.parse(sessionStorage.getItem("fr_referrer_trace"))}catch(n){this._debug(n),r=[]}(null==r||i&&0==trx.global_trace.length&&1!==r.length)&&(r=trx.global_trace);let e=sessionStorage.getItem("fr_last_loaded_page"),t;if(null!=e&&e===location.href)return trx.global_trace=r,void(this._paramsBuffer.page_trace=r);sessionStorage.setItem("fr_last_loaded_page",location.href),t=10<=r.length?{source:"..."}:(n=location.href,{source:n=void 0!==trx.source?trx.source:n,referrer:document.referrer,attr_forwarding:this._paramsBuffer.attr_forwarding}),r.push(t),sessionStorage.setItem("fr_referrer_trace",JSON.stringify(r)),this._paramsBuffer.page_trace=r}}catch(r){this._error("Error when recording referrer trace. Details: ",r)}}_needToClearTraces(){if(this._isEmpty(document.referrer))return!0;let e=!1,t,n=document.referrer.split("/");return!Array.isArray(n)||(""!==(t=n[2])&&t===location.hostname||(e=!0),e)}_disbaleLinks(){if(void 0!==this._settings.disable_rules&&this._asBoolean(this._settings.disable_rules.enabled)&&void 0!==this._settings.disable_rules.networks)for(let e=0;e<this._links.length;e++){var t=this._links[e],n=t.info.url,i=t.network;if(this._asBoolean(this._settings.disable_rules.networks[i])&&this._disbaleLink(t),void 0!==this._settings.disable_rules.custom)for(var r of this._settings.disable_rules.custom)if("url"===r.type)if(!this._isEmpty(n)&&this._isAbsolute(n)&&!this._isExcludedUrl(n))try{new RegExp(r.pattern).test(n)&&this._disbaleLink(t)}catch(e){this._debug(e)}}}_disbaleLink(e){e.info.disable=!0;var t=e.anchor.href;e.anchor.setAttribute("data-orig-url",t),e.anchor.href="javascript:void(0)"}_detectLinks(){if(this._asBoolean(this._settings.detection_rules.auto)&&(this._asBoolean(this._settings.detection_rules.auto_networks.dynamic)&&this._markDynamicDomainLinks(),this._autoDetectByUrl()),void 0!==this._settings.detection_rules.custom&&0<this._settings.detection_rules.custom.length){this._autoDetectCustomRules(this._settings.detection_rules.custom);for(var e of this._settings.detection_rules.custom)"element"===e.type&&this._detectByElementSelector(e)}for(let t=0;t<this._links.length;t++){let e=this._links[t];e.anchor.setAttribute("data-ml-id",t),e.anchor.setAttribute("data-ml","true")}}_autoDetectCustomRules(){let n,i;for(var e of this._settings.detection_rules.custom)if(e.pattern)try{var t=new RegExp(e.pattern);e.regexp=t}catch(n){this._debug(n)}for(let e=0;e<document.links.length;e++){let t=document.links[e];if(!0===trx.magicLinksSimulator||!t.hasAttribute("data-xid")){n=t.href;var r=this._getAbsoluteOffsetFromBody(t);if(void 0===this._links_unique[r.top+"_"+r.left+"_"+n]){var a,s=!1;for(a of this._settings.detection_rules.custom)if("url"==a.type&&(s=this._detecLinktByUrlToken(t,a)))break;if(!this._isEmpty(n)&&this._isAbsolute(n)&&!this._isExcludedUrl(n)&&1==s){let e={inxStart:0,inxEnd:0,embedded:!1,dynamic:!1,dynamicType:null,url:n};!1===(i=this._detectKnownAffiliateLink(n,e))&&(i="other"),this._checkEmbeddedLink(n,e),e.network=i,this._links.push({network:i,anchor:t,info:e}),this._links_unique[r.top+"_"+r.left+"_"+n]=t,t.hasAttribute("data-orig-url")||t.setAttribute("data-orig-url",n)}}}}}_detecLinktByUrlToken(e,t){return!!t.regexp&&t.regexp.test(e)}_autoDetectByUrl(){var n,i=this._settings.detection_rules.auto_networks;for(let e=0;e<document.links.length;e++){let t=document.links[e];if(!0===trx.magicLinksSimulator||!t.hasAttribute("data-xid")){var r=t.href,a=this._getAbsoluteOffsetFromBody(t);if(void 0===this._links_unique[a.top+"_"+a.left+"_"+r]&&!this._isEmpty(r)&&this._isAbsolute(r)&&!this._isExcludedUrl(r)){let e={inxStart:0,inxEnd:0,embedded:!1,dynamic:!1,dynamicType:null,url:"",network:""};n=this._detectKnownAffiliateLink(r,e),this._checkEmbeddedLink(r,e),!1!==n&&this._asBoolean(i[n])||t.hasAttribute("data-prepend-xid")?(t.hasAttribute("data-prepend-xid")&&this._debug("found prepended xid"),e.network=n,this._links.push({network:n,anchor:t,info:e}),this._links_unique[a.top+"_"+a.left+"_"+r]=t,t.hasAttribute("data-orig-url")||t.setAttribute("data-orig-url",r)):!1===n&&this._asBoolean(i.dynamic)&&"true"===t.getAttribute("data-ml-dynamic")&&(e.inxStart=0,e.inxEnd=0,e.embedded=!1,e.dynamic=!0,e.dynamicType=t.getAttribute("data-ml-dynamic-type"),e.url="",e.network=t.getAttribute("data-ml-dynamic-type"),this._links.push({network:n,anchor:t,info:e}),this._links_unique[a.top+"_"+a.left+"_"+r]=t,t.hasAttribute("data-orig-url")||t.setAttribute("data-orig-url",r))}}}}_getAbsoluteOffsetFromBody(e){for(var t=0,n=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t+=e.offsetLeft-e.scrollLeft+e.clientLeft,n+=e.offsetTop-e.scrollTop+e.clientTop,e=e.offsetParent;return{top:n,left:t}}_detectByElementSelector(i){let r,a;document.querySelectorAll(i.selector).forEach(t=>{if(!0===trx.magicLinksSimulator||!t.hasAttribute("data-xid"))if("A"===t.nodeName){r=t.href;var n=this._getAbsoluteOffsetFromBody(t);if(void 0===this._links_unique[n.top+"_"+n.left+"_"+r]&&(!this._isEmpty(r)&&this._isAbsolute(r)&&!this._isExcludedUrl(r)))try{if(new RegExp(i.pattern).test(r)){let e={inxStart:0,inxEnd:0,embedded:!1,dynamic:!1,dynamicType:null,url:r};!1===(a=this._detectKnownAffiliateLink(r,e))&&(a="other"),this._checkEmbeddedLink(r,e),e.network=a,this._links.push({network:a,anchor:t,info:e}),(this._links_unique[n.top+"_"+n.left+"_"+r]=t).hasAttribute("data-orig-url")||t.setAttribute("data-orig-url",r)}}catch(e){this._debug(e)}}else if(t.nodeName.toLowerCase()===i.selector_element){console.log("found element "+i.selector_element),void 0!==t[i.selector_attribute]&&(r=t[i.selector_attribute]);n=this._getAbsoluteOffsetFromBody(t);if(void 0===this._links_unique[n.top+"_"+n.left+"_"+r]&&(!this._isEmpty(r)&&this._isAbsolute(r)&&!this._isExcludedUrl(r)))try{if(new RegExp(i.pattern).test(r)){let e={inxStart:0,inxEnd:0,embedded:!1,dynamic:!1,dynamicType:null,url:r};!1===(a=this._detectKnownAffiliateLink(r,e))&&(a="other"),this._checkEmbeddedLink(r,e),e.selector_element=i.selector_element,e.selector_attribute=i.selector_attribute,e.network=a,this._links.push({network:a,anchor:t,info:e}),(this._links_unique[n.top+"_"+n.left+"_"+r]=t).hasAttribute("data-orig-url")||t.setAttribute("data-orig-url",r)}}catch(e){this._debug(e)}}})}_detectKnownAffiliateLink(e,t){let n,i,r={};void 0!==this._serverSettings.impact_domains&&(r=this._serverSettings.impact_domains);var a=e.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i),s=a&&a[1];if(null!==s&&1!==r[s]){const e=/(([a-z\-0-9]+)(?:\.com|\.fr|\.co.uk|\.io|\.net|\.com.au|\.co))/g;null!==(a=s.match(e))&&1==a.length&&(s=a[0])}if(-1!==e.indexOf("/dp/")&&e.includes("tag=")&&(i=-1!==e.indexOf("amazon."))||-1!==e.indexOf("/gp/")&&e.includes("tag=")&&(i=-1!==e.indexOf("amazon."))||(i=-1!=e.indexOf("/amzn."))||(i=-1!=e.indexOf("/www.amzn."))||(i=-1!=e.indexOf(".amazon-adsystem.com")))n="amazon";else if(-1!==(i=e.indexOf("linksynergy")))n="ls";else if(-1!==(i=e.indexOf("anrdoezrs.net"))||-1!==(i=e.indexOf("jdoqocy.com"))||-1!==(i=e.indexOf("tqlkg.com"))||-1!==(i=e.indexOf("tkqlhce.com"))||-1!==(i=e.indexOf("dpbolvw.net"))||-1!==(i=e.indexOf("jqoqocy.com"))||-1!==(i=e.indexOf("kqzfj.com"))||-1!==(i=e.indexOf("kqzyfj.com"))||-1!==(i=e.indexOf("ftjcfx.com"))||-1!==(i=e.indexOf("lduhtrp.net"))||-1!==(i=e.indexOf("qksrv.net")))n="cj";else if(-1!==(i=e.indexOf("shareasale.com")))n="sas";else if(-1!==(i=e.indexOf("awin1.com")))n="awin";else if(-1!==(i=e.indexOf("pepperjamnetwork.com"))||-1!==(i=e.indexOf("pjtra.com/t/"))||-1!==(i=e.indexOf("gopjn.com/t/"))||-1!==(i=e.indexOf("pjatr.com/t/"))||-1!==(i=e.indexOf("pntra.com/t/"))||-1!==(i=e.indexOf("pntrs.com/t/"))||-1!==(i=e.indexOf("pntrac.com/t/")))n="pj";else if(-1!==(i=e.indexOf("track.webgains.com")))n="wg";else if(-1!==(i=e.indexOf("prf.hn/click")))n="pt";else if(-1!==(i=e.indexOf("tradedoubler.com/click?"))||-1!==(i=e.indexOf("pf.tradedoubler.com/pf/")))n="td";else if(-1!==(i=e.search(/\/c\/(\d+)\/(\d+)\//))||-1!==(i=e.search(/%2Fc%2F(\d+)%2F(\d+)%2F(\d+)%/))||1==r[s])n="ir";else if(-1!==(i=e.indexOf("go.redirectingat.com"))||-1!==e.indexOf("go.skimresources.com")||-1!==e.indexOf("fave.co"))n="sl";else if(-1!==(i=e.indexOf("redirect.viglink.com")))n="vg";else if(-1!==(i=e.indexOf("avantlink.com/click")))n="al";else if(-1!==(i=e.indexOf("track.adtraction.com"))||-1!==(i=e.indexOf("adtr.co"))||-1!==(i=e.search(/\/t\/t\/\?a=(\d+)/))||-1!==(i=e.search(/\/t\/t\?a=(\d+)/)))n="at";else if(-1!==(i=e.indexOf("tc.tradetracker.net"))||-1!==(i=e.search(/(\?|\&)tt=(\d+)_(\d+)_(\d+)(_[\w-]+)?/)))n="tt";else if(-1!==(i=e.indexOf("/aff_c"))&&-1!==e.search(/aff_id=(\d+)/))n="ho";else if(i=-1!==e.indexOf("c.trackmytarget.com"))n="tc";else if(i=-1!==e.indexOf("buy.geni.us/Proxy.ashx"))n="ge";else if((i=-1!==e.indexOf("partner.bol.com/click/click"))||(i=-1!==e.indexOf("tracking.bol.com/click/click")))n="bol";else if(i=-1!==e.indexOf("track.wg-aff.com/click"))n="afs";else{if(!(i=-1!==e.indexOf("oc.brcclx.com/t/?")))return!1;n="rv"}return t.inxNext=i,n}_isCJ(e){return-1!==e.indexOf("anrdoezrs.net")||-1!==e.indexOf("jdoqocy.com")||-1!==e.indexOf("tqlkg.com")||-1!==e.indexOf("tkqlhce.com")||-1!==e.indexOf("dpbolvw.net")||-1!==e.indexOf("jqoqocy.com")||-1!==e.indexOf("kqzfj.com")||-1!==e.indexOf("kqzyfj.com")||-1!==e.indexOf("ftjcfx.com")||-1!==e.indexOf("lduhtrp.net")||-1!==e.indexOf("qksrv.net")}_findAsin(e){let t=null;const n=e.match(/(?:[/dp/]|$)([A-Z0-9]{10})(?:[\/])/g);return null!==n&&0<n.length&&(t=n[0].replace("/","").replace("/","")),t}_checkEmbeddedLink(t,n){var i=n.inxNext,r=t.lastIndexOf("=",i);if(-1!==r&&r<i){n.inxStart=r+1;let e=t.indexOf("&",i);-1===e&&(e=t.length),n.inxEnd=e,n.embedded=!0,n.url=decodeURIComponent(t.substring(n.inxStart,n.inxEnd));r=t.substring(0,n.inxStart),i=t.substring(n.inxEnd);n.wrapping_url=r+this._embedUrlToken+i,-1!==t.indexOf("go.redirectingat.com")||-1!==t.indexOf("go.skimresources.com")?n.wrapping_net="sl":-1!==t.indexOf("redirect.viglink.com")&&(n.wrapping_net="vg")}else n.inxStart=0,n.inxEnd=t.length,n.embedded=!1,n.url=t}_markDynamicDomainLinks(){let r,a;var s=void 0;if("undefined"!=typeof skimlinksInitialized&&(s=!0),"undefined"!=typeof __SKIM_JS_GLOBAL__&&"function"==typeof __SKIM_JS_GLOBAL__.getDebugInfo)r="sl",a=__SKIM_JS_GLOBAL__.getDebugInfo().runTimeInfo.aff_domains;else if(void 0!==s)r="sl";else{if("undefined"==typeof vglnk||"function"!=typeof vglnk.opt)return;r="vg",a=vglnk.opt("commercial_domains")}if(null!=a){for(let n=0;n<document.links.length;n++)try{let e=document.links[n],t=e.hostname;!0===a[t=t.replace("www.","")]&&(e.setAttribute("data-ml-dynamic","true"),e.setAttribute("data-ml-dynamic-type",r))}catch(r){this._log(r)}try{this._debug("FR find dynamic domains: "+JSON.stringify(a))}catch(r){}}else if(void 0!==s){skimlinks_exclude;var o,s=[];"undefined"!=typeof skimlinksInitialized&&(s=skimlinks_exclude);let e=document.querySelectorAll("a[data-skimlinks-tracking]"),t="("+s.join("|").replace("*","")+")",n=new RegExp(t),i={};for(o in e)if(void 0!==e[o].href){if(n.test(e[o].href))continue;var l=e[o].href.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i),l=(l&&l[1]).replace("www.","");void 0!==l&&null==i[l]&&(i[l]=1);try{e[o].setAttribute("data-ml-dynamic","true"),e[o].setAttribute("data-ml-dynamic-type",r)}catch(r){this._log(r)}}void 0!==i&&(a=Object.keys(i))}else this._debug("FR didn't find dynamic domains")}_isExcludedUrl(t){let n=this._exclude_urls_regex;for(let e=0;e<n.length;e++)if(n[e].test(t))return!0;return!1}_prepareSettings(){this._settings=trx.MagicLinks.prepareDefaultSettings({}),0<Object.keys(this.serverSettings).length&&(this._settings=this._extendForte(this._settings,this.serverSettings)),0<Object.keys(this.onPageSettings).length&&(this._settings=this._extendForte(this._settings,this.onPageSettings))}_collectClickTimeParams(){var e,t,n=this._settings.features.append_timing;this._asBoolean(n.enabled)&&(e=n.t_clicked,t=n.t_toclick,n=Date.now(),e&&(this._paramsBuffer.t_clicked=n,this._paramsBuffer.timing.t_clicked=n),t&&(this._paramsBuffer.t_toclick=n-this._loadTime,this._paramsBuffer.timing.t_toclick=n-this._loadTime))}_writeDataToEventsService(n,e,t){let i;try{i=JSON.parse(JSON.stringify(this._paramsBuffer))}catch(n){i=this._paramsBuffer}i.uuid=n.info.xid;var r,a,s,o,l=n.info.xid;if(i.link_replaced=!1,n.anchor.hasAttribute("data-spot-rid")&&(r=n.anchor.getAttribute("data-spot-rid"),a=n.anchor.getAttribute("data-orig-url"),s=n.anchor.getAttribute("data-spot-replaced"),l=r,i.uuid=r,i.original_xid=n.info.xid,i.link_replaced=!0,i.orig_url=a,i.link_replace_to=s),void 0===l&&n.anchor.hasAttribute("data-xid")&&(l=n.anchor.getAttribute("data-xid")),n.anchor.hasAttribute("data-orig-url")&&(i.anchor_orig=n.anchor.getAttribute("data-orig-url")),i.client_time=(new Date).toISOString(),i.anchor_id=this._emptyIfNull(n.anchor.id),i.anchor_href=n.anchor.href,i.anchor_label=n.anchor.innerText,i.page_title=document.title,i.spot_id="",i.network=n.info.network,null!=e&&(i.event_type=e),n.anchor.hasAttribute("data-affiliation-url")&&(i.anchor_href=n.anchor.getAttribute("data-affiliation-url"),i.network=this._detectKnownAffiliateLink(i.anchor_href,{})),n.anchor.hasAttribute("data-vars-link-id")&&(void 0===i.metadata&&(i.metadata={}),i.metadata.linkid=n.anchor.getAttribute("data-vars-link-id")),null!=t&&"object"==typeof t)for(var d in t)t.hasOwnProperty(d)&&0===d.indexOf("custom_")&&(i[d]=t[d]);let c=this._envSettings.events_recording_api+"/write",u={env:this._envSettings.events_recording_env,id:l,app_key:this._envSettings.app_key,property_id:i.property_id,customer_id:i.customer_id,cidp1:i.cidp1,cidp2:i.cidp2,event_type:i.event_type,network:i.network,data:encodeURIComponent(JSON.stringify(i))},h=JSON.stringify(u),_=JSON.parse(h);_.data=i;let f=JSON.stringify(_),g=i.uuid;delete i.uuid,delete i.client_time,delete i.anchor_href,delete i.anchor_label,delete i.page_title,delete i.spot_id,"undefined"!=typeof Storage&&(o="fr_click_"+g,localStorage.setItem(o,h)),void 0!==this._envSettings.events_recording_api2&&(m=this._envSettings.events_recording_api2+"/write",fetch(m,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"*client",body:h}).then(e=>{if(e.ok){var t="Write to events-recording service. Body:\n"+f;return this._isSimulator&&this._log(t),void this._debug(t)}this._log("Fail to write event data. HTTP error, status = "+e.status),"undefined"!=typeof Storage&&(e=Math.round((new Date).getTime()/1e3),o="fr_log_"+e)}).then(e=>{e&&e.message&&this._log(e.message)}).catch(e=>{this._log(e)}));var m={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"*client",body:h};if(navigator.sendBeacon&&this._use_beacon){try{navigator.sendBeacon(c,h)}catch(n){console.log(n)}return this._debug("sendBeacon: URL = "+c+"; status = "+status),1==status&&localStorage.removeItem(o),status}return fetch(c,m).then(e=>{if(e.ok){var t="Write to events-recording service. Body:\n"+f;return this._isSimulator&&this._log(t),200==e.status&&"undefined"!=typeof Storage&&localStorage.removeItem(o),this._debug(t),e.json()}this._log("Fail to write event data. HTTP error, status = "+e.status),"undefined"!=typeof Storage&&(t=Math.round((new Date).getTime()/1e3),o="fr_log_"+t,(t=this._getLogInfomration(i)).message="Fail to write event data. HTTP error, status = "+e.status,t.xid=n.info.xid,localStorage.setItem(o,JSON.stringify(t)))}).then(e=>{var t;e&&e.message&&(this._log(e.message),"undefined"!=typeof Storage)&&(t=Math.round((new Date).getTime()/1e3),o="fr_log_"+t,(t=this._getLogInfomration(i)).message=e.message,t.xid=n.info.xid,localStorage.setItem(o,JSON.stringify(t)))}).catch(e=>{var t;this._log(e),"undefined"!=typeof Storage&&(t=Math.round((new Date).getTime()/1e3),o="fr_log_"+t,(t=this._getLogInfomration(i)).message=e.message,t.xid=n.info.xid,localStorage.setItem(o,JSON.stringify(t)))})}_getLogInfomration(e){return e.env=this._envSettings.events_recording_env,e.app_key=this._envSettings.app_key,e.property_id=this._propertyId,e.customer_id=this._customerId,e.loginfo={nAgt:navigator.userAgent,screen:screen.width+"*"+screen.height},e}_log(e){console.log(this._logPrefix+e)}_error(e,t){var n;console.error(this._logPrefix+e),null!=t&&console.error(t),"undefined"!=typeof Storage&&(n="fr_log_"+Math.round((new Date).getTime()/1e3),(t=this._getLogInfomration({})).message=this._logPrefix+e,localStorage.setItem(n,JSON.stringify(t)))}_debug(e){null!=window.trxdebug&&console.log(this._logPrefix+e)}_prepareExcludeRegExp(){this._exclude_urls_regex=[];var t=this._settings.detection_rules.exclude_urls;if(0<t.length)for(let e=0;e<t.length;e++)try{this._exclude_urls_regex.push(new RegExp(t[e],"i"))}catch(t){this._debug(t)}}_extendForte(e,t){if(null==e||null==t)throw"Null object provided to extendForte!";const n={};let i;for(i in e){var r,a;e.hasOwnProperty(i)&&(r=e[i],a=t[i],null!=r&&null!=a?r instanceof Array?n[i]=a:n[i]="object"==typeof r?this._extendForte(r,a):a:n[i]=null==r?a:null==a?r:null)}for(i in t)t.hasOwnProperty(i)&&(i in e&&null!=e[i]||(n[i]=t[i]));return n}_postReport(){this._report={links:[]};for(let e=0;e<this._links.length;e++){var t=this._links[e].anchor,n=this._getAnchorLabel(t,100);this._report.links.push({network:this._links[e].network,url:t.href,label:n})}window.postMessage({type:"MSG_FROM_MAGIC_LINKS",action:"report",report:JSON.stringify(this._report)},"*")}_markLink(e,t,n){var i=n.getAttribute("data-"+e);n.setAttribute("data-"+e,i+=","+t)}_appendExtraParam(e,t,n,i,r){let a=null,s=!1;var o=":";if(r)a=null;else switch(e){case"cj":a="sid",s=!0,o="-";break;case"ls":a="u1";break;case"sas":a="afftrack";break;case"awin":a="clickref";break;case"pj":a="sid";break;case"sl":a="xcust";break;case"vg":a="cuid";break;case"ir":a="subId3";break;case"wg":a="clickref";break;case"td":a="epi(",s=!0;break;case"pt":a="pubref:",s=!0;break;case"amazon":a="ascsubtag";break;case"al":a="ctc";break;case"at":a="epi",o="%3A";break;case"tt":-1!==t.indexOf("tc.tradetracker.net")?a="r":(a="tt",o="-");break;case"ho":a="aff_sub3",o="%3A";break;case"tc":a="ref3";break;case"bol":a="subid",o="-","xid"==n&&(n="fr-xid");break;case"afs":a="sub5",o="-";break;case"rv":a="tid",o="-","xid"==n&&(n="fr-xid");break;default:a=null}return this._appendNameValueToUrl(t,n,i,a,s,e,o)}_appendNameValueToUrl(e,t,n,i,r,a,s,o){let l,d,c,u;if(void 0===o&&(o=!1),n=encodeURIComponent(n),void 0===s&&(s=":"),null==i)return r?e+=t+"/"+n:-1!==e.indexOf("?")?e+="&"+t+"="+n:e+="?"+t+"="+n,e;if(c=t+s+n,r)return-1!==(l=e.indexOf(i+"/"))?(l+=(i+"/").length,-1===(d=e.indexOf("/",l))&&(d=e.length),0<(u=e.substring(l,d)).length&&(c=this._getDelimiter(e,a)+c),this._insertToString(e,c,d)):"pt"===a?this._appendNameValueToUrl_PT(e,t,n,i,c):"cj"===a?this._appendNameValueToUrl_CJ(e,t,n,i,c):"td"===a?this._appendNameValueToUrl_TD(e,t,n,i,c):(c="/"+i+"/"+c,this._insertToString(e,c,e.length));if(-1!==(l=e.toLocaleLowerCase().indexOf(i.toLocaleLowerCase()+"=")))return-1===(d=e.indexOf("&",l))&&(d=e.length),0<(u=e.substring(l+i.length+1,d)).length&&(c=this._getDelimiter(e,a)+c),this._insertToString(e,c,d);s="=";a="?";return-1!==e.indexOf("?")&&(a="&"),!0===o&&(a=encodeURIComponent(a),s=encodeURIComponent(s)),c=a+i+s+c,this._insertToString(e,c,e.length)}_appendNameValueToUrl_TD(e,t,n,i,r){let a,s,o,l;return-1===(a=e.indexOf("epi("))?-1!==(a=e.indexOf("url("))?e+"epi("+r+")":-1===(o=e.indexOf("&epi="))?e+"&epi="+r:-1===(l=e.indexOf("&",o+5))?e+this._getDelimiter(e)+r:(r=this._getDelimiter(e)+r,this._insertToString(e,r,l)):(a+=i.length,-1!==(s=e.indexOf(")",a))?(0<e.substring(a,s).length&&(r=this._getDelimiter(e)+r),this._insertToString(e,r,s)):e)}_appendNameValueToUrl_PT(e,t,n,i,r){let a,s;if(-1!==(a=e.indexOf(i))){if(a+=i.length,-1!==(s=e.indexOf("/",a)))return 0<e.substring(a,s).length&&(r=this._getDelimiter(e)+r),this._insertToString(e,r,s)}else if(-1!==(a=e.indexOf("/destination")))return this._insertToString(e,r="/pubref:"+r,a);return e}_appendNameValueToUrl_CJ(n,e,t,i,r){let a=n.indexOf("dlg/");if(-1===a&&(a=n.indexOf("/am/")),r=r.replace(":","-"),-1!==a)return this._insertToString(n,r=i+"/"+r+"/",a+4);if(-1===n.indexOf("?"))return n+"?sid="+r;{let e=n.indexOf("?"),t=n.indexOf("sid=",e+1);if(-1===t&&(t=n.indexOf("&sid=",e+1)),-1===t)return e===n.length-1?n+"sid="+r:n+"&sid="+r;i=n.indexOf("&",t+5);return-1===i?n+this._getDelimiter(n).replace("|",this._delimiter4)+r:(r=this._getDelimiter(n).replace("|",this._delimiter4)+r,this._insertToString(n,r,i))}}_checkPageUrlMatch(){return!!this._isEmpty(this._settings.detection_rules.page_url_filter)||location.href.includes(this._settings.detection_rules.page_url_filter)}_insertToString(e,t,n){return e.substring(0,n)+t+(n<e.length?e.substring(n):"")}_insertSubstringToString(e,t,n,i){return e.substring(0,n)+t+e.substring(i)}_parseQuery(e){let t=new Map;if(!e)return t;const n=e.split(/[;&]/);for(let e=0;e<n.length;e++){var i=n[e].split("=");if(i&&2===i.length){var r=unescape(i[0]);let e=unescape(i[1]);e=e.replace(/\+/g," "),t.set(r,e)}}return t}_getAnchorLabel(e,t){let n=document.createElement("label");n.innerHTML=e.innerHTML,n.normalize();let i=n.innerHTML;return(i=i.trim()).length>t&&(i=i.substring(0,t)+"..."),i}_isEmpty(e){return null==e||""===e||void 0===e}_emptyIfNull(e){return null==e?"":e}_isAbsolute(e){return 0===e.indexOf("http://")||0===e.indexOf("https://")}_asBoolean(e){return"true"===e||!0===e}_generateUUID(){return`fr${Date.now()}${String.fromCharCode(Math.floor(10*Math.random()+97))}${String.fromCharCode(Math.floor(10*Math.random()+97))}${String.fromCharCode(Math.floor(10*Math.random()+97))}`}static _getObjectByPath(e,n){null==n&&(n=window);var i=e.split(".");if(1===i.length)return n[i[0]];{let t=n;for(let e=0;e<i.length;e++){var r=i[e];if("window"!==r&&null==(t=t[r])&&e<i.length-1)return null}return t}}_getDelimiter(e,t){return e.includes("assoc-redirect.amazon")?this._delimiter2:this._isCJ(e)?this._delimiter4:"ho"==t||"at"==t?encodeURI(this._delimiter1):"tt"==t&&-1===e.indexOf("tc.tradetracker.net")||"bol"==t||"rv"==t||"afs"==t?this._delimiter4:this._delimiter1}_runFRCallback(){try{null!=window.funnelRelayReady&&"function"==typeof window.funnelRelayReady&&window.funnelRelayReady()}catch(e){this._error("Fail to run callback function 'funnelRelayReady'. Details: "+e)}}},trx.get={},trx.get.pageViewGuid=function(){return eval("pageData.pageViewGuid")},trx.get.articleId=function(){return eval("utag_data._articleId")},trx.GATracker=class{constructor(e){this.gaCode=e,window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create",this.gaCode,"auto","mlTracker",{alwaysSendReferrer:!0,allowAnchor:!1}),ga("mlTracker.set","referrer",document.referrer),ga("mlTracker.set","appName","trackonomics-relay")}trackEvent(t,n,i,r,a){ga(function(e){ga("mlTracker.send","event",{eventCategory:t,eventAction:n,eventLabel:i,eventValue:r,fieldsObject:a,transport:"beacon"})})}trackScreenView(t){ga(function(e){ga("mlTracker.send","screenview",{screenName:t,appId:this.appId,appVersion:this.appVersion,appName:this.appName})})}trackPageView(){ga(function(e){ga("mlTracker.set","page",location.href),ga("mlTracker.send","pageview",{page:location.href,title:document.title})})}},trx.AdobeTracker=class{constructor(e){null!=e&&0<e.length?this._rsId=e:this._rsId=null}trackEvent(e,t,n,i,a){if("function"==typeof s.tl){let t=s,e=null!=this._rsId?this._rsId:s_account;null!=e&&(t=s_gi(e));let n=a.props_map;null==n&&(n={xid:"prop1",link:"prop2",label:"prop3",referrer:"prop4",origin:"prop5"});let i=a.props_map_custom,r=[n.xid,n.link,n.label,n.referrer,n.origin];if(null!=i)for(let e=0;e<i.length;e++){var o=i[e];r.push(o.prop)}if(t.linkTrackVars=r.join(","),t[n.xid]=a.xid,t[n.link]=a.anchor.href,t[n.label]=a.anchor.innerHTML,t[n.referrer]=document.referrer,t[n.origin]=location.href,null!=i)for(let e=0;e<i.length;e++){var l=i[e];t[l.prop]=trx.MagicLinks._getObjectByPath(l.field,a.data)}t.linkTrackEvents="funnel-relay",t.events="funnel-relay";var d="funnel-relay-"+a.xid;t.tl(!0,"o",d,null)}}trackScreenView(e){}trackPageView(){}};let e=void 0,t="prod",i=!0,r=document.getElementById("funnel-relay-installer");null!=r&&r.hasAttribute("data-autorun")&&(i="false"!==r.getAttribute("data-autorun"));let n=3e3,a="{START_DELAY}",o=parseInt("{START_DELAY}");Number.isInteger(o)&&(n=o),null==trx.global_trace&&(trx.global_trace=[]),0<n?setTimeout(()=>{trx.magicLinksEngine=new trx.MagicLinks(i),trx.magicLinksEngine._runFRCallback()},n):(trx.magicLinksEngine=new trx.MagicLinks(i),trx.magicLinksEngine._runFRCallback())}();
