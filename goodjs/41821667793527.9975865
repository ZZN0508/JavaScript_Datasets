YUI.add("hermes-lang-shared-entity",function(e,t){e.Intl.add("hermes/shared-entity","en-US",{USERNAME_HAS_SHARED_PHOTOS_ONLY:["${username}"," has shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}}," with you!"],USERNAME_HAS_SHARED_VIDEOS_ONLY:["${username}"," has shared ",{type:"plural",valueName:"videoCount",options:{one:"${#} video",other:"${#} videos"}}," with you!"],USERNAME_HAS_SHARED_PHOTOS_VIDEOS:["${username}"," has shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}}," ",{type:"plural",valueName:"videoCount",options:{one:"and ${#} video",other:"and ${#} videos"}}," with you!"],OWNER_HAS_SHARED_PHOTOS_ONLY:["You have shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}},"."],OWNER_HAS_SHARED_VIDEOS_ONLY:["You have shared ",{type:"plural",valueName:"videoCount",options:{one:"${#} video",other:"${#} videos"}},"."],OWNER_HAS_SHARED_PHOTOS_VIDEOS:["You have shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}}," ",{type:"plural",valueName:"videoCount",options:{one:"and ${#} video",other:"and ${#} videos"}},"."],VIEW_YOUR_SHARING_HISTORY:["View your sharing history"]})},"@VERSION@",{requires:["intl"]}),YUI.add("photo-sets-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-photos-getAllContexts"].run(e,this.appContext)}},attributes:{id:{},sets:{isListProxy:!0},total:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]}),YUI.add("flickr-photosets-addPhoto-creator",function(r,i){"use strict";r.namespace("ModelCreators")["flickr-photosets-addPhoto"]={run:function(a,e){var t={full_response:1},o=[],s=a.isMultiplePhotos?"photo_ids":"photo_id",n=a.photoID.split(",").length;return t[s]=a.photoID,t.photoset_id=a.setID,a.gpCode&&(t.gp_code=a.gpCode),a.gpOwner&&(t.gp_owner=a.gpOwner),a.shareCode&&(t.share_code=a.shareCode),a.includeHiddenSets&&(t.extras="hidden_sets",t.user_id=a.userId),o=[e.callAPI("flickr.photosets.addPhoto",t),e.getModel("set-models",a.setID),e.getModelRegistry("photo-sets-models"),e.getModelRegistry("photo-contexts-models")],a.isMultiplePhotos||o.push(e.getModel("photo-models",a.photoID)),r.Promise.all(o).then(function(e){var t=e[0],o=e[1],s=e[2],r=e[3],i=t.errors,l=t.errors?t.errors.length:0;if(n-=l,"ok"===t.stat)return a.isMultiplePhotos?o&&a.updateItemCounts&&(o.setValue("photoCount",o.getValue("photoCount")+a.numberOfPhotosSelected),o.setValue("videoCount",o.getValue("videoCount")+a.numberOfVideosSelected)):(e=e[4],o&&!o.hasPhoto(e.getValue("id"))&&(o.addPhoto(e),e.getValue("isVideo")?o.setValue("videoCount",o.getValue("videoCount")+1):o.setValue("photoCount",o.getValue("photoCount")+1))),s.exists(a.photoID)&&!s.getValue(a.photoID,"sets").getFromListByID(o.getValue("id"))&&(s.getValue(a.photoID,"sets").prependToList(o),s.setValue(a.photoID,"total",s.getValue(a.photoID,"total")+n)),r.exists(a.photoID)&&!r.getValue(a.photoID,"contexts").getFromListByID(o.getValue("id"))&&(r.setValue(a.photoID,"totalSets",r.getValue(a.photoID,"totalSets")+n),r.getValue(a.photoID,"contexts").push(o)),a.isMultiplePhotos?(l&&i.forEach(function(e){-1!==a.photosSelectedIds.indexOf(e.photo_id)?o.setValue("photoCount",o.getValue("photoCount")-1):o.setValue("videoCount",o.getValue("videoCount")-1)}),{errors:i,setModel:o}):o},function(e){return r.FetcherErrorLogger(i),e}.bind(this))}}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","photo-sets-models","photo-contexts-models"]}),YUI.add("flickr-photosets-getList-fetcher",function(p,r){"use strict";p.namespace("ListFetchers")["flickr-photosets-getList"]={run:function(t,e){var o=this,s=this._processParams(t);return p.Promise.all([e.callAPI("flickr.photosets.getList",s,!0),e.getModelRegistry("sets-models"),e.getModelRegistry("set-models"),e.getModel("person-models",t.id||{pathAlias:t.pathAlias})]).then(function(e){return o._processResponse(e,t)},p.FetcherErrorLogger(r))},_processParams:function(e){var t={primary_photo_extras:p.APIHelper.request.getRebootAlbumsListExtras(),page:e.page,per_page:e.perPage||500,get_user_info:1,extras:"can_share,can_download"};if(e.id)t.user_id=e.id;else{if(!e.pathAlias)throw new Error("[flickr-favorites-getList-fetcher] `id` or `pathAlias` is required.");t.path_alias=e.pathAlias}return t},_processResponse:function(e,t){var o=e[0],s=e[1],r=e[2],i=e[3],l=o.photosets,a={},e=i.getValue("id"),n=[];if(l)return l.photoset&&p.Array.each(l.photoset,function(e,t){0!==e.visibilityCanSeeSet&&(e={id:e.id,title:e.title.content,description:e.description.content,owner:i,primary:e.primary,primaryPhotoSizes:p.APIHelper.response.parsePrimaryPhotoSizes(e),isAutoUploadSet:e.autoUpload,primaryNeedsInterstitial:e.needsInterstitial,photoCount:e.photos,videoCount:e.videos,publicPhotosCount:e.countPhotosPublic,totalCount:parseInt(e.photos,10)+parseInt(e.videos,10),viewCount:e.countViews,canShare:e.canShare+(e.canShareDeep||0),canDownload:e.canDownload},n.push(r.addOrUpdate(e)))}),a={id:e,pathAlias:i.getValue("pathAlias"),totalItems:o.photosets.total},l=parseInt(o.photosets.perpage),e=parseInt(o.photosets.page),a.albumsList={perPage:l,page:e,pageContent:n,totalItems:o.photosets.total,totalPages:Math.ceil(o.photosets.total/l)},s.addOrUpdate(a),n}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["sets-models","set-models","person-models"]}),YUI.add("sets-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-photosets-getList"].run(e,this.appContext)}},attributes:{id:{},pathAlias:{},albumsList:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-photosets-getList"]}},totalItems:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-getList-fetcher"]}),YUI.add("flickr-photosets-removePhoto-deletor",function(r,i){"use strict";r.namespace("ModelCreators")["flickr-photosets-removePhoto"]={run:function(l,e){var t={full_response:1},o=[],s=l.isMultiplePhotos?"photo_ids":"photo_id",a=l.photoID.split(",").length;return t[s]=l.photoID,t.photoset_id=l.setID,l.includeHiddenSets&&(t.extras="hidden_sets",t.user_id=l.userId),o=[e.callAPI("flickr.photosets.removePhoto",t),e.getModel("set-models",l.setID),e.getModel("sets-models",e.getViewer().nsid,{page:1,perPage:e.flipper.isFlipped("enable-sets-list-loading-fix")||l.includeHiddenSets?10:500}),e.getModelRegistry("photo-sets-models"),e.getModelRegistry("photo-contexts-models")],l.isMultiplePhotos||o.push(e.getModel("photo-models",l.photoID)),r.Promise.all(o).then(function(e){var t=e[0],o=e[1],s=e[2],r=e[3],i=e[4];if("ok"===t.stat)return i.exists(l.photoID)&&i.getValue(l.photoID,"contexts").getFromListByID(l.setID)&&(i.setValue(l.photoID,"totalSets",i.getValue(l.photoID,"totalSets")-a),i.getValue(l.photoID,"contexts").removeFromList(l.setID)),r.exists(l.photoID)&&r.getValue(l.photoID,"sets").getFromListByID(l.setID)&&(r.setValue(l.photoID,"total",r.getValue(l.photoID,"total")-a),r.getValue(l.photoID,"sets").removeFromList(l.setID)),o&&(l.isMultiplePhotos?o&&l.updateItemCounts&&(o.setValue("photoCount",o.getValue("photoCount")-l.numberOfPhotosSelected),o.setValue("videoCount",o.getValue("videoCount")-l.numberOfVideosSelected)):(e=e[5],o.hasPhoto(e.getValue("id"))&&o.removePhoto(e),e.getValue("isVideo")?o.setValue("videoCount",o.getValue("videoCount")-a):o.setValue("photoCount",o.getValue("photoCount")-a)),o.getValue("totalCount")<1&&!l.includeHiddenSets)?(s.getValue("albumsList").remove(l.setID),o.registry.remove(l.setID),null):o},r.FetcherErrorLogger(i))}}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","sets-models","photo-sets-models","photo-contexts-models"]}),YUI.add("flickr-photosets-delete-deletor",function(o,s){"use strict";o.namespace("ModelDeletors")["flickr-photosets-delete-deletor"]={run:function(e,t){return e.photoset_id=e.setID,e.gpCode&&(e.gp_code=e.gpCode),e.gpOwner&&(e.gp_owner=e.gpOwner),e.shareCode&&(e.share_code=e.shareCode),t.callAPI("flickr.photosets.delete",e).then(function(e){if(1===e.code)throw new Error(e)}).catch(o.FetcherErrorLogger(s))}}},"@VERSION@",{requires:["flickr-promise"]});
