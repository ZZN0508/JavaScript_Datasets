!function(c,e,h){"use strict";var x;e!==h&&(e.noConflict(),(x=e).extend({recommend_light_box:{itemClicked:"",clickCount:0,status:{isTimeout:!1},identifiers:{itemName:["#ITEMNAME#"],itemPrice:["#ITEMPRICE#"],shopid:["#shopid#"],itemid:["#itemid#"],index1:["#index1#"],index2:["#index2#"],index3:["#index3#"]},settings:{genrefilter:["551169","Str","^[0-9,]{1,69}$"],recommend_layer_url:["https://rp.rakuten.co.jp/v2/ichiba/recommend/top_lightbox_pc","Str","^^(https?:)?//(?:[a-zA-Z0-9_\\-]+\\.)+rakuten\\.co\\.jp\\/[a-zA-Z0-9_&=\\?\\-\\.%:\\/]+$"],lightbox_imgsize:["160x160","Str","^[1-9][0-9]{1,2}[x:][1-9][0-9]{1,2}"],recommend_items_number:[12,"Int","^[0-9][0-9]$"],omitname_lightbox:[63,"Range","0,100"],recommend_sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"],ranking_url:["","Str","^^(https?:)?//(?:[a-zA-Z0-9_\\-]+\\.)+rakuten\\.co\\.jp\\/[a-zA-Z0-9_&=\\?\\-\\.%:\\/]+$"],ranking_sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"],ranking_genrelayer:[1,"Int","^[1-5]$"],ajaxtimer:[3,"Range","1,99"],rankingshuffle:[1,"Int","^[0-1]$"],sc_displayed_prop18:["","Str","^[a-zA-Z0-9_]{3,64}$"],sc_displayed_flag:[1,"Int","^[0-1]$"],sc_relateditem_prop18:["","Str","^[a-zA-Z0-9_]{3,64}$"],sc_relateditem_flag:[1,"Int","^[0-1]$"],sid_clickcount_flag:[1,"Int","^[0-1]$"],recommend_shopitem_url:["","Str","^^(https?:)?//(?:[a-zA-Z0-9_\\-]+\\.)+rakuten\\.co\\.jp\\/[a-zA-Z0-9_&=\\?\\-\\.%:\\/]+$"],event:["","Str","^[a-zA-Z0-9_]{3,64}$"],eventtimer:[0,"Range","0,9999"],inshop_sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"]},eobj:{config:x("#lightBoxConfig")},props:{recommendLayer:{items:[]}},initLightBox:function(e){function n(e,t,i,o,r){m.prototypeLightBox.empty(),m.loading.show(),x.recommend_light_box.openRecoPopLightBox(m,e,t,i,o,r)}x.recommend_light_box.settings=x.RJS_Helpers.readAttr(x.recommend_light_box.eobj.config,x.recommend_light_box.settings),x.recommend_light_box.settings.ajaxtimer=1e3*x.recommend_light_box.settings.ajaxtimer;var _,m={lightBoxModal:x("#lightBox_ModalWindow"),lightBoxDialog:x("#lightBox_DialogBox"),prototypeErrorLightBox:x("#lightBox_prototypeError"),prototypeLightBox:x("#lightBox_prototype"),closeButtonLightBox:x("#lightBox_closeButton"),closeButtonErrorLightBox:x("#lightBox_closeButtonError"),loading:x("#lightBox_loading_Image"),prototypeLightBoxFrame:x("#lightBox_frame")},s=x.recommend_light_box.settings.event;x(e.eTarget).delegate(".lightBox_recommendLink",s,function(){var e=x(this),t=e.attr("item_id"),i=e.attr("shop_id"),o=e.attr("genre_id"),r=e.attr("shop_url"),m=e.attr("mng_number");"mouseover"===s?(clearTimeout(_),_=setTimeout(function(){n(t,i,o,r,m)},x.recommend_light_box.settings.eventtimer)):"click"===s&&n(t,i,o,r,m)})},openRecoPopLightBox:function(e,t,i,o,r,m){e.lightBoxModal.fadeIn(100),x.recommend_light_box.alignLightBox(),x.recommend_light_box.itemClicked="",x.recommend_light_box.clickCount=0,e.prototypeErrorLightBox.hide(),x.recommend_light_box.disable(e),c.SC&&"function"==typeof c.SC.sendSTL&&"1"==x.recommend_light_box.settings.sc_displayed_flag&&c.SC.sendSTL({prop18:x.recommend_light_box.settings.sc_displayed_prop18}),x.recommend_light_box.getRecommendDataLayer(e,t,i,o,r,m,!1,0)},alignLightBox:function(){var e=x(c).height(),t=x(c).width(),i=x("#lightBox_DialogBox");i.css("top",e/2-i.height()/2),i.css("left",t/2-i.width()/2)},displayErrorMessage:function(e){return e.loading.hide(),e.prototypeErrorLightBox.show(),e.prototypeLightBox.empty(),!1},updateLinkAreaOnError:function(e,t){t=e.prototypeLightBox.find(".lightBox_Content[index1="+t+"]");t.find(".lightBox_LinkArea").hide(),t.find(".lightBox_LinkAreaError").show()},updateItemURL:function(e){"1"==x.recommend_light_box.settings.sid_clickcount_flag&&e.prototypeLightBox.find(".lightBox_Content").each(function(){var e,t=x(this).find(".lightBox_imageEle"),i=t.attr("url");i&&(e=i.lastIndexOf("_"),e=i.substring(0,e+1)+x.recommend_light_box.clickCount,t.attr("url",e))})},getRecommendDataLayer:function(o,d,a,t,r,m,n,_){var g,e;if(x.recommend_light_box.status.isTimeout=!1,n){if(x.recommend_light_box.itemClicked=_,(e=x.recommend_light_box.props.recommendLayer.items[0])[_]==h)return x.recommend_light_box.displayErrorMessage(o),!1;a=e[_].shopid,d=e[_].itemid,g=setTimeout(function(){x.recommend_light_box.status.isTimeout=!0,x.recommend_light_box.updateLinkAreaOnError(o,_)},x.recommend_light_box.settings.ajaxtimer)}else g=setTimeout(function(){x.recommend_light_box.status.isTimeout=!0,x.recommend_light_box.displayErrorMessage(o)},x.recommend_light_box.settings.ajaxtimer);try{x.ajax({url:x.recommend_light_box.settings.recommend_layer_url,cache:!1,dataType:"jsonp",data:{id:a+"_"+d},scriptCharset:"euc-jp",timeout:x.recommend_light_box.settings.ajaxtimer,success:function(e){!function(e,t,i,o,r,m,n){var _=t.reco;if(!x.recommend_light_box.status.isTimeout){if(clearTimeout(g),t.status===h||t.reco_count===h)return x.recommend_light_box.displayErrorMessage(e);if("Success"!=t.status&&"NotFound"!=t.status)return x.recommend_light_box.displayErrorMessage(e);if(i&&0===_.length)return x.recommend_light_box.updateLinkAreaOnError(e,o),x.recommend_light_box.updateItemURL(e);for(var s=[],t=x.recommend_light_box.props.recommendLayer.items[0],l=0;l<_.length;l++)s.push({itemname:x.recommend_light_box.editItemnameLightBox(x.recommend_light_box,_[l].item_name),itemurl:"1"==x.recommend_light_box.settings.sid_clickcount_flag?x.recommend_light_box.editItemurl(_[l].item_url,x.recommend_light_box.settings.recommend_sid+"_"+x.recommend_light_box.clickCount):x.recommend_light_box.editItemurl(_[l].item_url,x.recommend_light_box.settings.recommend_sid),itemprice:x.recommend_light_box.editItemprice(_[l].item_price),imageele:"",imageurl:x.recommend_light_box.editImageurl(_[l].small_image_url,x.recommend_light_box.settings.lightbox_imgsize),imagealt:x.recommend_light_box.editItemnameLightBox(x.recommend_light_box,_[l].item_name),imagetitle:x.recommend_light_box.editItemnameLightBox(x.recommend_light_box,_[l].item_name),shopid:_[l].shop_id,itemid:_[l].item_id});t!=h&&i&&(t=t[o],s.length>=x.recommend_light_box.settings.recommend_items_number&&(o<s.length?s.splice(o,0,t):s[o]=t)),(x.recommend_light_box.props.recommendLayer.items[0]=s).length<x.recommend_light_box.settings.recommend_items_number?i?x.recommend_light_box.getShopRecommendData(e,_.length,i,a,d,o,t):x.recommend_light_box.getRankingDataLayer(e,_.length,i,r,m,n):x.recommend_light_box.prepareRecommendItems(e,s,i,o)}}(o,e,n,_,t,r,m)},error:function(e,t,i){n?x.recommend_light_box.updateLinkAreaOnError(o,_):x.recommend_light_box.getRankingDataLayer(o,0,n,genreidlist,r,m)}})}catch(e){n?x.recommend_light_box.updateLinkAreaOnError(o,_):x.recommend_light_box.getRankingDataLayer(o,0,n,genreidlist,r,m)}},getShopRecommendData:function(o,t,e,i,r,m,n){var s;x.recommend_light_box.status.isTimeout=!1;try{s=setTimeout(function(){x.recommend_light_box.status.isTimeout=!0,x.recommend_light_box.prepareRecommendItems(o,x.recommend_light_box.props.recommendLayer.items[0],!0,m)},x.recommend_light_box.settings.ajaxtimer),x.ajax({url:x.recommend_light_box.settings.recommend_shopitem_url,cache:!1,dataType:"jsonp",data:{shop_id:i,item_ids:r},scriptCharset:"euc-jp",timeout:x.recommend_light_box.settings.ajaxtimer,success:function(e){(function(e,t,i,o,r){if(!x.recommend_light_box.status.isTimeout){if(clearTimeout(s),t.num===h)return 0==i&&x.recommend_light_box.updateLinkAreaOnError(e,r);if("0"!=t.code)return 0==i&&x.recommend_light_box.updateLinkAreaOnError(e,r);if(0==t.num||0==t.items.length)return 0==i&&x.recommend_light_box.updateLinkAreaOnError(e,r);var m=[],n=x.recommend_light_box.settings.inshop_sid;"1"==x.recommend_light_box.settings.sid_clickcount_flag&&(n=x.recommend_light_box.settings.inshop_sid+"_"+x.recommend_light_box.clickCount);for(var _=0;_<t.items.length;_++)m.push({itemname:x.recommend_light_box.editItemnameLightBox(x.recommend_light_box,t.items[_].itemname),itemurl:x.recommend_light_box.editItemurl(t.items[_].itemurlfull,n),itemprice:x.recommend_light_box.editItemprice(t.items[_].itemprice),imageele:"",imageurl:x.recommend_light_box.editImageurl(t.items[_].imageurl64,x.recommend_light_box.settings.lightbox_imgsize),imagealt:x.recommend_light_box.editItemnameLightBox(x.recommend_light_box,t.items[_].itemname),imagetitle:x.recommend_light_box.editItemnameLightBox(x.recommend_light_box,t.items[_].itemname),shopid:t.items[_].shopid,itemid:t.items[_].itemid});e=x.recommend_light_box.props.recommendLayer.items[0];r<(e=x.merge(e=e==h?[]:e,m)).length?e.splice(r,0,o):e[r]=o,x.recommend_light_box.props.recommendLayer.items[0]=e}})(o,e,t,n,m),x.recommend_light_box.prepareRecommendItems(o,x.recommend_light_box.props.recommendLayer.items[0],!0,m)},error:function(e,t,i){x.recommend_light_box.prepareRecommendItems(o,x.recommend_light_box.props.recommendLayer.items[0],!0,m)}})}catch(e){x.recommend_light_box.prepareRecommendItems(o,x.recommend_light_box.props.recommendLayer.items[0],!0,m)}},prepareRecommendItems:function(g,e,t,i){function m(){try{g.prototypeLightBox.find(".lightBox_Content").each(function(){var e=x(this),o=e.find(".lightBox_prototypeItemImage"),m=o.find(".lightBox_imageEle"),n=e.find(".lightBox_hoverEle"),_=e.find(".lightBox_textArea"),r=_.find(".lightBox_LinkAreaError").is(":visible"),t=e.attr("index1"),i=_.find(".lightBox_LinkArea"),s=_.find(".lightBox_ItemNameArea"),l=_.find(".lightBox_ItemName"),d=_.find(".lightBox_PrototypeItemPrice"),a=(_.find(".lightBox_NameArea"),i.find(".lightBox_Link"));t%4!=3&&g.prototypeLightBox.find(".lightBox_Content[index1="+t+"]").addClass("lightBox_NotLastItem"),t<8&&g.prototypeLightBox.find(".lightBox_Content[index1="+t+"]").addClass("lightBox_NotBottomItem"),i.click(function(){var e,t,i;r||(e=o.attr("index2"))!=x.recommend_light_box.itemClicked&&(t=(i=x(this)).attr("itemid"),i=i.attr("shopid"),x.recommend_light_box.clickCount++,c.SC&&"function"==typeof c.SC.sendSTL&&"1"==x.recommend_light_box.settings.sc_relateditem_flag&&c.SC.sendSTL({prop18:x.recommend_light_box.settings.sc_relateditem_prop18+"_"+x.recommend_light_box.clickCount}),x.recommend_light_box.getRecommendDataLayer(g,t,i,"","","",!0,e))}),e.unbind("mousemove").unbind("mouseleave").mousemove(function(e){var t,i,o,r=x(this);0!=r.contents().length&&(t=r.attr("itemid"),i=r.find(".lightBox_anchor"),o=m.attr("url"),i.mousedown(function(e){1===e.which&&i.attr({href:o,target:"_self"}),3===e.which&&i.attr({href:o,target:"_blank"})}),t&&(n.css({display:"block"}),_.css({display:"block"})))}).mouseleave(function(){0!=x(this).contents().length&&(_.css({display:"none"}),n.css({display:"none"}))}),s.unbind("mousemove").unbind("mouseleave").mousemove(function(e){x(this).addClass("lightBox_linkHover"),l.addClass("lightBox_itemNameHover"),d.addClass("lightBox_itemNameHover")}).mouseleave(function(){x(this).removeClass("lightBox_linkHover"),l.removeClass("lightBox_itemNameHover"),d.removeClass("lightBox_itemNameHover")}),i.unbind("mousemove").unbind("mouseleave").mousemove(function(e){r?a.removeClass("lightBox_linkHover"):a.addClass("lightBox_linkHover")}).mouseleave(function(){a.removeClass("lightBox_linkHover")})})}catch(e){return}}var o=[],n=x.recommend_light_box.settings.recommend_items_number,_=e.length>n?e.slice(0,n):e,s=g.prototypeLightBoxFrame;if(_!=h&&0<_.length){if(t)!function(e){if(e!=h){for(var t=0;t<n;t++){var i,o,r=g.prototypeLightBox.find(".lightBox_Content[index1="+t+"]");t!=e?(o=x.recommend_light_box.prepareElement(g,s,t,_),r.replaceWith(o)):t!=e||"1"!=x.recommend_light_box.settings.sid_clickcount_flag||(o=(i=r.find(".lightBox_imageEle")).attr("url"))&&(r=o.lastIndexOf("_"),r=o.substring(0,r+1)+x.recommend_light_box.clickCount,i.attr("url",r))}m()}}(i);else{g.prototypeLightBox.empty();for(var r=0;r<n;r++){var l=x.recommend_light_box.prepareElement(g,s,r,_);o.push(l)}g.prototypeLightBox.append(o.join("")),m(),g.loading.hide(),g.prototypeLightBox.show()}7===x.recommend_light_box.detectBrowser()&&x(".lightBox_itemImage").each(function(e,t){var i=x(this),o=i.attr("src"),r=o.lastIndexOf("http"),r=o.substring(r);i.attr("src",r)})}},prepareElement:function(e,t,i,o){var r=[],m=0,n="",_=t.find(".lightBox_imageEle");if(void 0!==o[i])for(var s in r.push({itemName:o[i].itemname}),r.push({itemPrice:o[i].itemprice}),r.push({shopid:o[i].shopid}),r.push({itemid:o[i].itemid}),r.push({index1:i}),r.push({index2:i}),r.push({index3:i}),_.attr({src:o[i].imageurl,alt:o[i].itemname,url:o[i].itemurl}),n=t.html(),_.removeAttr("src"),_.removeAttr("alt"),_.removeAttr("url"),x.recommend_light_box.identifiers)n=n.replace(x.recommend_light_box.identifiers[s],r[m][s]),m++;else n=(n=x("#lightBox_frame_noimg").html()).replace(x.recommend_light_box.identifiers.index1,i);return n},getRankingDataLayer:function(t,i,o,e,r,m){var l;x.recommend_light_box.status.isTimeout=!1;try{var n,_=e.replace(/^\//,"").split("/"),s=x.recommend_light_box.settings.genrefilter.split(",");for(n in s)if(-1!=x.inArray(s[n],_))return 0!=i?x.recommend_light_box.prepareRecommendItems(t,x.recommend_light_box.props.recommendLayer.items[0],!1):x.recommend_light_box.displayErrorMessage(t),!1;(_=_[x.recommend_light_box.settings.ranking_genrelayer])===h&&(_=0),l=setTimeout(function(){x.recommend_light_box.status.isTimeout=!0,x.recommend_light_box.prepareRecommendItems(t,x.recommend_light_box.props.recommendLayer.items[0],!1)},x.recommend_light_box.settings.ajaxtimer),x.ajax({url:x.recommend_light_box.settings.ranking_url,cache:!0,dataType:"jsonp",data:{gid:_},jsonpCallback:"jsonp0123456789012",scriptCharset:"euc-jp",timeout:x.recommend_light_box.settings.ajaxtimer,success:function(e){(function(e,t,i,o,r,m){if(!x.recommend_light_box.status.isTimeout){if(clearTimeout(l),t.status===h||t.num===h)return 0==i&&x.recommend_light_box.displayErrorMessage(e);if("Success"!=t.status)return 0==i&&x.recommend_light_box.displayErrorMessage(e);if(!o&&t.items!=h&&0==t.items.length)return 0==i&&x.recommend_light_box.displayErrorMessage(e);if(e.prototypeErrorLightBox.hide(),0==t.num)return 0==i&&x.recommend_light_box.displayErrorMessage(e);for(var n=[],_=0;_<t.items.length;_++){var s=(/R2=([^\&]+)/.exec(t.items[_].itemurl)||[])[1];(s=s===h&&/^https?:\/\/item\.rakuten\.co\.jp/.test(t.items[_].itemurl)?t.items[_].itemurl:s)!==h&&(x.recommend_light_box.endsWith(s,r+"/"+m+"/")||n.push({itemname:x.recommend_light_box.editItemnameLightBox(x.recommend_light_box,t.items[_].itemname),itemurl:"1"==x.recommend_light_box.settings.sid_clickcount_flag?x.recommend_light_box.editItemurl(t.items[_].itemurl,x.recommend_light_box.settings.ranking_sid+"_"+x.recommend_light_box.clickCount):x.recommend_light_box.editItemurl(t.items[_].itemurl,x.recommend_light_box.settings.ranking_sid),itemprice:x.recommend_light_box.editItemprice(t.items[_].price),imageele:"",imageurl:x.recommend_light_box.editImageurl(t.items[_].imageurl64,x.recommend_light_box.settings.lightbox_imgsize),imagealt:x.recommend_light_box.editItemnameLightBox(x.recommend_light_box,t.items[_].itemname),imagetitle:x.recommend_light_box.editItemnameLightBox(x.recommend_light_box,t.items[_].itemname),shopid:t.items[_].shopid,itemid:t.items[_].itemid}))}1===x.recommend_light_box.settings.rankingshuffle&&(n=x.recommend_light_box.shuffle(n));e=x.recommend_light_box.props.recommendLayer.items[0],e=x.merge(e=e==h?[]:e,n);x.recommend_light_box.props.recommendLayer.items[0]=e}})(t,e,i,o,r,m),x.recommend_light_box.prepareRecommendItems(t,x.recommend_light_box.props.recommendLayer.items[0],!1)},error:function(e,t,i){}})}catch(e){x.recommend_light_box.prepareRecommendItems(t,x.recommend_light_box.props.recommendLayer.items[0],!1)}},disable:function(t){x(document).unbind("click").bind("click",function(e){e=e.target.id;"lightBox_closeButtonError"!=e&&"lightBox_closeButton"!=e&&"lightBox_ModalWindow"!=e||(t.prototypeLightBox.empty(),t.lightBoxModal.hide())})},editItemnameLightBox:function(e,t){return x.RJS_Helpers.omitStr(t,e.settings.omitname_lightbox,"…")},detectBrowser:function(){var e=c.navigator.userAgent,t=e.indexOf("MSIE ");return 0<t?parseInt(e.substring(t+5,e.indexOf(".",t)),10):0},editItemurl:function(e,t,i){return e=""!=t?i?x.RJS_Helpers.urlR2Parameter(e,{"s-id":t},!1):x.RJS_Helpers.urlParameter(e,{"s-id":t},!1):e},editItemprice:function(e){return""!=e&&e!==h?String(e).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):e},editImageurl:function(e,t){return e=""!=e&&t!==h?x.RJS_Helpers.urlParameter(e,{_ex:t.replace(":","x"),fitin:t.replace("x",":")}):e},shuffle:function(e){for(var t=Array.apply(null,e),i=t.length;i;){var o=Math.floor(Math.random()*i),r=t[--i];t[i]=t[o],t[o]=r}return t},endsWith:function(e,t){var i=e.length-t.length;return 0<=i&&e.lastIndexOf(t)===i}}}))}(window,window.jQuery);
