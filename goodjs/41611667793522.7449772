YUI.add("group-pool-models",function(r){function t(e){t.superclass.constructor.call(this,e)}r.Models[this.name]=t,r.extend(t,r.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return r.ListFetchers["flickr-groups-pools-getPhotos"].run(e,this.appContext)},addPhoto:function(e,t){return e.registryName=this.name,r.ModelCreators["flickr-groups-pools-add"].run(e,t)},removePhoto:function(e,t){return e.registryName=this.name,r.ModelDeletors["flickr-groups-pools-remove"].run(e,t)},invitePhoto:function(e,t){return r.ModelCreators["flickr-groups-invite-photo-invite"].run(e,t)},cancelPhotoInvitation:function(e,t){return r.ModelDeletors["flickr-groups-invite-photo-cancel"].run(e,t)},acceptPhoto:function(e,t){return r.ModelUpdaters["flickr-groups-admin-acceptPhoto"].run(e,t)},declinePhoto:function(e,t){return r.ModelDeletors["flickr-groups-admin-declinePhoto"].run(e,t)}},addPhotoRemote:function(e,t){return this.remote.addPhoto.call(this,{photoID:t,groupID:e},this.appContext)},removePhotoRemote:function(e,t){return this.remote.removePhoto.call(this,{photoIds:t,groupID:e},this.appContext)},invitePhotoRemote:function(e,t){return this.remote.invitePhoto.call(this,{photoID:t,groupID:e},this.appContext)},cancelPhotoInvitationRemote:function(e,t){return this.remote.cancelPhotoInvitation.call(this,{photoID:t,groupID:e},this.appContext)},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},acceptPhotoRemote:function(e,t){return this.remote.acceptPhoto.call(this,{photoIds:t,groupID:e},this.appContext)},declinePhotoRemote:function(e,t){return this.remote.declinePhoto.call(this,{photoIds:t,groupID:e},this.appContext)},addPhotoLocal:function(e,t){var r=this.getValue(e,"group");return this.getValue(e,"photoPageList").unshift(t),this.getValue(e,"photoPageList").totalItems++,this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),r.setValue("poolCount",r.getValue("poolCount")+1),this},removePhotoLocal:function(e,t){var r=this.getValue(e,"group");return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoPageList").totalItems--,this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),r.setValue("poolCount",r.getValue("poolCount")-1),this},acceptPhotoLocal:function(e,t){var r=this.getValue(e,"group");return r.setValue("pendingCount",r.getValue("pendingCount")-1),this.addPhotoLocal(e,t),this},declinePhotoLocal:function(e,t){e=this.getValue(e,"group");return e.setValue("pendingCount",e.getValue("pendingCount")-1),this},attributes:{displayType:{readOnly:!0,defaultFn:function(){return"group"}},pathAlias:{validator:function(e,t){return r.AttributeHelpers.validateString(e)},setter:function(e){return r.AttributeHelpers.coerceString(e)},defaultFn:function(e){return e}},photoPageList:{isCollection:!0,pageFetch:{listFetcher:r.ListFetchers["flickr-groups-pools-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:r.ListFetchers["flickr-groups-pools-getContext"],listItemIdField:"photoId"}},group:{isModel:!0},urlSuffix:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){return"pool-"+(this.getValue(e,"pathAlias")||e)}},url:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("url")}},title:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("title")}},poolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("poolCount")}},filteredPoolCount:{validator:function(e){return r.AttributeHelpers.validateInteger(e)},setter:function(e){return r.AttributeHelpers.coerceInteger(e)},defaultFn:function(e){return this.getValue(e,"group").getValue("poolCount")}},friendlyPoolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("friendlyPoolCount")}}}},{buildCompoundId:function(e,t){return e+"-"+t},extractGroupFromCompoundId:function(e){return e.split("-")[0]}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getContext-fetcher","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor","flickr-groups-admin-acceptPhoto-updater","flickr-groups-admin-declinePhoto-deletor","attribute-helpers"],optional:["group-top-contributors-models"]}),YUI.add("flickr-groups-create-creator",function(r,o){"use strict";r.namespace("ModelCreators")["flickr-groups-create"]={run:function(e,t){e={user_id:e.userId,name:e.name,description:e.description,grouptype:e.privacyLevel,age_restriction:e.ageRestriction,safety_level:e.safetyLevel};return t.callAPI("flickr.groups.create",e).then(function(e){return"ok"===e.stat?t.getModel("group-pool-models",e.groupNsid):r.Promise.reject(e)},r.FetcherErrorLogger(o))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]}),YUI.add("group-info-models",function(r){function t(e){t.superclass.constructor.call(this,e)}r.Models[this.name]=t,r.extend(t,r.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return r.ModelFetchers["flickr-groups-getInfo"].run(e,this.appContext)},join:function(e,t){return r.ModelCreators["flickr-groups-join"].run(e,t)},leave:function(e,t){return r.ModelDeletors["flickr-groups-leave"].run(e,t)},create:function(e,t){return r.ModelCreators["flickr-groups-create"].run(e,t)}},join:function(e){e=this.getValue(e,"group");return e&&(e.setValue("isMember",!0),e.setValue("isInvited",!1)),this},leave:function(e){var t=this.getValue(e,"group");return t&&(t.setValue("isAdmin",!1),t.setValue("isModerator",!1),t.setValue("isMember",!1),this.setValue(e,"hasPendingRequestToJoin",!1)),this},declineInvite:function(t){var r=this;return this.appContext.callAPI("flickr.groups.invite.member.decline",{group_id:t}).then(function(e){return r.setValue(t,"isInvited",!1),e})},attributes:{pathAlias:{validator:function(e,t){return r.AttributeHelpers.validateString(e)},setter:function(e){return r.AttributeHelpers.coerceString(e)},defaultValue:""},description:{validator:function(e,t){return r.AttributeHelpers.validateString(e)},setter:function(e){return r.AttributeHelpers.coerceString(e)},defaultValue:""},secureDescription:{validator:function(e,t){return r.AttributeHelpers.validateString(e)},setter:function(e){return r.AttributeHelpers.coerceString(e)},defaultValue:""},rules:{validator:function(e,t){return r.AttributeHelpers.validateString(e)},setter:function(e){return r.AttributeHelpers.coerceString(e)},defaultValue:""},roles:{},secureRules:{validator:function(e,t){return r.AttributeHelpers.validateString(e)},setter:function(e){return r.AttributeHelpers.coerceString(e)},defaultValue:""},hasPendingRequestToJoin:{validator:function(e){return r.AttributeHelpers.validateBoolean(e)},setter:function(e){return r.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},photoLimitOptOut:{validator:function(e){return r.AttributeHelpers.validateBoolean(e)},setter:function(e){return r.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isInvited:{validator:function(e){return r.AttributeHelpers.validateBoolean(e)},setter:function(e){return r.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},discussionsLocked:{validator:function(e){return r.AttributeHelpers.validateBoolean(e)},setter:function(e){return r.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},privacy:{validator:function(e){return r.AttributeHelpers.validateInteger(e)},setter:function(e){return r.AttributeHelpers.coerceInteger(e)},defaultValue:1},restrictions:{},throttle:{},poolPreviewRowsVisibleCount:{validator:function(e){return r.AttributeHelpers.validateInteger(e)},setter:function(e){return r.AttributeHelpers.coerceInteger(e)},defaultFn:function(e){return 1}},coverPhotoAttribution:{},group:{isModel:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-getInfo-fetcher","flickr-groups-join-creator","flickr-groups-leave-deletor","flickr-groups-create-creator","attribute-helpers","group-models"]}),YUI.add("flickr-groups-getInfo-fetcher",function(l,o){"use strict";l.namespace("ModelFetchers")["flickr-groups-getInfo"]={run:function(t,e){var r=this;return l.Promise.all([e.callAPI("flickr.groups.getInfo",this._processParams(t),!0),e.getModelRegistry("group-info-models"),e.getModelRegistry("group-models"),e.getModelRegistry("group-blast-models"),e.getModelRegistry("group-activity-models")]).then(function(e){return r._processResponse(e,t)},l.FetcherErrorLogger(o))},_processParams:function(e){var t={extras:l.APIHelper.request.getRebootPhotoExtras()+","+l.APIHelper.request.getRebootGroupExtras()+", blast_user_info, date_last_viewed, has_pending_invite, coverphoto_attribution, is_locked",secure_image_embeds:1,lang:void 0};if(e.id)t.group_id=e.id;else{if(!e.pathAlias)throw new Error("[flickr-groups-getInfo-fetcher] `id` or `pathAlias` is required.");t.group_path_alias=e.pathAlias}return t},_processResponse:function(e,t){var r=e[0],o=e[1],n=e[2],i=e[3],u=e[4],s=n.parseGroupModel(t.id,t.pathAlias,r.group);return n.addOrUpdate(s),e={id:s.id,viewedPool:l.moment(r.group.viewedDates?r.group.viewedDates.pool:void 0),viewedDiscussions:l.moment(r.group.viewedDates?r.group.viewedDates.discussions:void 0),group:n.proxy(s.id)},u.addOrUpdate(e),n={id:(s=n.proxy(s.id)).id,blastMessage:r.group.blast?r.group.blast.content:"",blastMessageSecure:r.group.blast?r.group.secureBlast.content:"",blastUserId:r.group.blast?r.group.blast.userId:"",blastDateAdded:r.group.blast?l.moment(r.group.blast.dateBlastAdded,"X"):l.moment(),blastUserName:r.group.blast?r.group.blast.userName:"",blastPathAlias:r.group.blast?r.group.blast.userPathAlias:"",blastUserNSID:r.group.blast?r.group.blast.userNsid:"",blastRealName:r.group.blast?r.group.blast.realName:"",blastUserStatus:r.group.blast?r.group.blast.userStatus:""},i.addOrUpdate(n),r={id:r.group.id,pathAlias:r.group.pathAlias||t.pathAlias,description:r.group.description.content,secureDescription:r.group.secureDescription?r.group.secureDescription.content:"",rules:r.group.rules.content,roles:r.group.roles,secureRules:r.group.secureRules.content,restrictions:r.group.restrictions,throttle:r.group.throttle,poolPreviewRowsVisibleCount:r.group.pool_rows,group:s,discussionsLocked:"1"===r.group.isLocked,hasPendingRequestToJoin:r.group.has_pending_request_to_join,isInvited:r.group.is_invited,coverPhotoAttribution:r.group.coverphoto,photoLimitOptOut:r.group.photo_limit_opt_out},o.addOrUpdate(r),o.proxy(r.id)}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["group-info-models","group-models"]}),YUI.add("group-models",function(n){function t(e){t.superclass.constructor.call(this,e)}n.Models[this.name]=t,n.extend(t,n.FlickrModelRegistry,{name:this.name,parseGroupModel:function(e,t,r){var o,t={id:r.id||e||r.nsid,pathAlias:r.pathAlias||t||r.pathalias,title:r.title,invitationOnly:r.invitationOnly,memberCount:r.memberCount,poolCount:r.photos,poolPreviewRowsVisibleCount:r.pool_rows,topicCount:"string"===r.topicCount?r.topicCount:void 0,pendingCount:r.pool_pending_count,memberPendingCount:r.member_pending_count,iconurls:n.APIHelper.response.removeProtocolFromURL(r.iconurls),isMember:r.is_member||r.member||r.isMember,isModerator:r.is_moderator||r.moderator||r.isModerator,isAdmin:r.is_admin||r.admin||r.isAdmin,eighteenplus:r.eighteenplus,coverPhotoUrls:n.APIHelper.response.removeProtocolFromURL(r.coverphotoUrl),latestPhotoActivity:n.moment(r.date_activity_detail?r.date_activity_detail.pool:void 0,"X"),latestDiscussionActivity:n.moment(r.date_activity_detail?r.date_activity_detail.discussions:void 0,"X"),showPoolToNonMembers:r.show_pool,showDiscussionToNonMembers:r.show_discussion,needsInterstitial:r.needs_interstitial,muted:r.muted};return"string"==typeof r.datecreate?o=r.datecreate:r.datecreate&&"string"==typeof r.datecreate.content&&(o=r.datecreate.content),o?t.dateCreated=n.moment(o+=" +0700","YYYY-MM-DD HH:mm:ss Z"):t.dateCreated=new n.moment,!t.title&&r.name&&(t.title="string"==typeof r.name?r.name:r.name.content),!t.memberCount&&r.members&&(t.memberCount="string"!=typeof r.members?r.members.content:r.members),!t.poolCount&&r.poolCount&&(t.poolCount="string"!=typeof r.poolCount?r.poolCount.content:r.poolCount),t.topicCount||(r.topicCount?t.topicCount="string"!=typeof r.topicCount?r.topicCount.content:r.topicCount:t.topicCount=0),r.privacy&&(parseInt(r.privacy,10)?t.privacy=parseInt(r.privacy,10):r.privacy.content&&(t.privacy=r.privacy.content)),t},getLargestCoverPhotoSize:function(e,t){return n.PhotoModelHelper.getLargestSize(e,t)},attributes:{title:{validator:function(e,t){return n.AttributeHelpers.validateString(e)},setter:function(e){return n.AttributeHelpers.coerceString(e)},defaultValue:""},pathAlias:{validator:function(e,t){return n.AttributeHelpers.validateString(e)},setter:function(e){return n.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(e){return e}},isModerator:{validator:function(e){return n.AttributeHelpers.validateBoolean(e)},setter:function(e){return n.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},invitationOnly:{validator:function(e){return n.AttributeHelpers.validateBoolean(e)},setter:function(e){return n.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isMember:{validator:function(e){return n.AttributeHelpers.validateBoolean(e)},setter:function(e){return n.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isAdmin:{validator:function(e){return n.AttributeHelpers.validateBoolean(e)},setter:function(e){return n.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},memberCount:{validator:function(e){return n.AttributeHelpers.validateInteger(e)},setter:function(e){return n.AttributeHelpers.coerceInteger(e)},defaultFn:function(e){return 0}},poolCount:{validator:function(e){return n.AttributeHelpers.validateInteger(e)},setter:function(e){return n.AttributeHelpers.coerceInteger(e)},defaultFn:function(e){return 0}},friendlyPoolCount:{readOnly:!0,derivedBy:["poolCount"],getter:function(e,t){return n.Number.format(this.getValue(t,"poolCount"),{thousandsSeparator:","})}},pendingCount:{validator:function(e){return n.AttributeHelpers.validateInteger(e)},setter:function(e){return n.AttributeHelpers.coerceInteger(e)},defaultFn:function(e){return 0}},memberPendingCount:{validator:function(e){return n.AttributeHelpers.validateInteger(e)},setter:function(e){return n.AttributeHelpers.coerceInteger(e)},defaultFn:function(e){return 0}},topicCount:{validator:function(e){return n.AttributeHelpers.validateInteger(e)},setter:function(e){return n.AttributeHelpers.coerceInteger(e)},defaultFn:function(e){return 0}},groupPoolAddURL:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){return"/groups/"+this.getValue(e,"pathAlias")+"/pool/add/"}},dateCreated:{validator:function(e){return n.AttributeHelpers.validateDate(e)},setter:function(e){return n.AttributeHelpers.coerceDate(e)},defaultFn:function(e){return n.moment()},serialize:function(e){return e.format("X")},deserialize:function(e){return n.moment(e,"X")}},latestPhotoActivity:{validator:function(e){return n.AttributeHelpers.validateDate(e)},setter:function(e){return n.AttributeHelpers.coerceDate(e)},defaultFn:function(e){return n.moment()},serialize:function(e){return e.format("X")},deserialize:function(e){return n.moment(e,"X")}},latestDiscussionActivity:{validator:function(e){return n.AttributeHelpers.validateDate(e)},setter:function(e){return n.AttributeHelpers.coerceDate(e)},defaultFn:function(e){return n.moment()},serialize:function(e){return e.format("X")},deserialize:function(e){return n.moment(e,"X")}},showPoolToNonMembers:{validator:function(e){return n.AttributeHelpers.validateBoolean(e)},setter:function(e){return n.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},showDiscussionToNonMembers:{validator:function(e){return n.AttributeHelpers.validateBoolean(e)},setter:function(e){return n.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},eighteenplus:{validator:function(e){return n.AttributeHelpers.validateBoolean(e)},setter:function(e){return n.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},needsInterstitial:{validator:function(e){return n.AttributeHelpers.validateBoolean(e)},setter:function(e){return n.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},privacy:{validator:function(e){return n.AttributeHelpers.validateInteger(e)},setter:function(e){return n.AttributeHelpers.coerceInteger(e)},defaultFn:function(e){return 0}},iconurls:{},bestIconURL:{readOnly:!0,derivedBy:["iconurls"],defaultFn:function(e,t){return n.URLHelper.getGroupIconURL(this.getValue(e,"iconurls"),t)||void 0}},mediumIconURL:{readOnly:!0,derivedBy:["iconurls"],defaultFn:function(e){return n.URLHelper.getGroupIconURL(this.getValue(e,"iconurls"),"medium")||void 0}},url:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return"/groups/"+(this.getValue(e,"pathAlias")||e)+"/"}},urlMembersPage:{readOnly:!0,derivedBy:["group","url"],defaultFn:function(e){return this.getValue(e,"url")+"members"}},urlPoolPage:{readOnly:!0,derivedBy:["group","url"],defaultFn:function(e){return this.getValue(e,"url")+"pool"}},urlDiscussionPage:{readOnly:!0,derivedBy:["group","url"],defaultFn:function(e){return this.getValue(e,"url")+"discuss"}},urlPendingMembersPage:{readOnly:!0,derivedBy:["id"],defaultFn:function(e){return"/groups_pending.gne?id="+e}},urlPendingPhotosPage:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){return"/groups/"+this.getValue(e,"pathAlias")+"/admin/pending"}},coverPhotoUrls:{},latestGroupActivity:{readOnly:!0,derivedBy:["latestPhotoActivity","latestDiscussionActivity","dateCreated"],defaultFn:function(e){var t=this.getValue(e,"latestDiscussionActivity"),r=this.getValue(e,"latestPhotoActivity"),e=this.getValue(e,"dateCreated");return t.isValid()&&(e=n.moment.min(e,t)),e=r.isValid()?n.moment.min(e,r):e}},muted:{validator:function(e){return n.AttributeHelpers.validateBoolean(e)},setter:function(e){return n.AttributeHelpers.coerceBoolean(e)},defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","api-helper","url-helper","moment","flickr-groups-getInfo-fetcher","attribute-helpers","photo-model-helper"]}),YUI.add("flickr-groups-pools-getGroups-fetcher",function(a,o){"use strict";a.namespace("ListFetchers")["flickr-groups-pools-getGroups"]={run:function(t,e){var r=this;return a.Promise.all([e.callAPI("flickr.groups.pools.getGroups",{extras:a.APIHelper.request.getRebootGroupExtras()+", icon_urls, needs_interstitial",page:t.page||0,per_page:t.perPage||400},!0),e.getModelRegistry("person-groups-models"),e.getModelRegistry("group-pool-models"),e.getModelRegistry("group-models")]).then(function(e){return r._processResponse(e,t)},a.FetcherErrorLogger(o))},_processResponse:function(e,t){var r=e[0],o=e[1],n=e[2],i=e[3],u=r.groups,s=t.id,e={},l=[];if(u)return u.group&&a.Array.each(u.group,function(e,t){var r;(r=i.parseGroupModel(e.id,e.pathAlias,e)).id&&(r=i.addOrUpdate(r),r=n.addOrUpdate({id:e.id,pathAlias:e.pathAlias,group:r}),l.push(r))}),(e={id:s,memberCount:r.userGroupMemberships?r.userGroupMemberships.member:null,moderatorCount:r.userGroupMemberships?r.userGroupMemberships.moderator:null,adminCount:r.userGroupMemberships?r.userGroupMemberships.admin:null,invitedCount:r.userGroupMemberships?r.userGroupMemberships.invited:null}).groups=a.APIHelper.response.addOrReplaceListByPage({current:o.exists(s)?o.proxy(s).getValue("groups").getList():[],perPage:t.perPage,pageNum:t.page,totalItems:r.groups.total,newPages:l}),o.exists(s)?o.setValue(s,"groups",e.groups):o.add(e),e.groups}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models","group-pool-models","person-models"]}),YUI.add("flickr-groups-fave-fetcher",function(r,o){"use strict";r.namespace("ModelFetchers")["flickr-groups-fave"]={run:function(e,t){return r.Promise.all([t.callAPI("flickr.groups.fave",e),t.getModelRegistry("person-groups-models")]).then(this._processResponse,r.FetcherErrorLogger(o))},_processResponse:function(e){}}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]}),YUI.add("flickr-groups-unfave-fetcher",function(r,o){"use strict";r.namespace("ModelFetchers")["flickr-groups-unfave"]={run:function(e,t){return r.Promise.all([t.callAPI("flickr.groups.unfave",e),t.getModelRegistry("person-groups-models")]).then(this._processResponse,r.FetcherErrorLogger(o))},_processResponse:function(e){}}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]});
