var _i_=this._i_||function(){},_r_=this._r_||function(e){return e};B.define("hotel/tpi/data-api",function(e,i,_){_i_("50d:8abfc0fa");var t,r,c=e("promise");function l(e){_i_("50d:a0cb4c70"),B.squeak&&B.env.wholesaler_configuration.tpi_track_ajax_failures&&e&&B.squeak(e),_r_()}function f(e,i){return _i_("50d:c6ffc0a4"),_r_(function(){return _i_("50d:084bf321"),_r_(e.apply(i,arguments))})}_.exports={run:function(n,a,o,e){_i_("50d:56ae6702");var s=(B.env||{}).wholesaler_configuration||{};return r&&e&&(r.should_abort=1,t=void 0),t=t||new c(f(function(i,_){var e,t,r;_i_("50d:78db3079"),a&&o||_("Error: Missing args, avData, avData, frgName and frgData  are required"),B.env.wholesaler_configuration.worker_url&&B.env.wholesaler_configuration.decision_url&&B.env.b_fragment_url_json?(e=1<(t=B.env.b_fragment_url_json.split("?")).length?t[1]:"",r=Object.assign({},a),(t=Object.assign({},o)).exps=B.env.wholesaler_configuration.tpi_exps||{},r.url=n,B.env.wholesaler_configuration.use_k8s_dev_installations&&B.env.wholesaler_configuration.av_url&&(r.use_dev=1,r.av_service_url=B.env.wholesaler_configuration.av_url),r.call_supply_service=B.env.wholesaler_configuration.call_supply_service,r.worker_token=B.env.wholesaler_configuration.worker_token,r.frag_url=B.env.wholesaler_configuration.decision_url+"?"+e,r.frag_req=t,t=B.env.wholesaler_configuration.worker_url,r=r,_i_("50d:0bc02a2f"),_r_($.ajax({type:"POST",url:t,data:JSON.stringify(r),cache:!1,xhrFields:{withCredentials:!0},dataType:"json",contentType:"application/json; charset=utf-8",timeout:2e4})).then(f(function(e){_i_("50d:700af058"),this.should_abort?_("frg-aborted"):e&&e.data?i(e.data):_("frg-error"),_r_()},this),function(e,i){_i_("50d:bde19a10"),l(i&&"timeout"===i?s.tpi_av_timeout_squeak_name:s.tpi_av_squeak_name),_("av-error"),_r_()})):l("tpi-client-fallback-"+B.env.b_site_type+"-"+B.env.b_action),_r_()},r={})),_r_(t)}},_r_()}),B.define("hotel/tpi/postproc-api",function(e,i,_){_i_("50d:cca324dc"),_.exports={send_postproc_request:function(e){_i_("50d:97faa462");var i="",i="object"==typeof e?(e.forEach(function(e){_i_("50d:1bdb3ed6"),i+=e+"_",_r_()}),i.substring(0,i.length-1)):""+e,e=B.env.b_countrycode;$.getJSON("/tpi_postproc?hotel_ids="+i+"&cc="+e+"&src=sr",null,function(){}),_r_()}},_r_()}),B.define("searchresults/tpi/data-api",function(e,i,_){_i_("50d:623da6bd");var t=new(B.require("event-emitter"));_.exports={emitTpiDataEvent:function(e){_i_("50d:936f124e"),t.emit("tpi_data",e),_r_()},onTpiData:function(e){_i_("50d:96a6acd1"),t.on("tpi_data",e),_r_()}},_r_()}),B.when({action:"searchresults",events:"ready",condition:1==B.env.b_bookings_owned&&B.env.wholesaler_configuration}).run(function(t){_i_("50d:f3038414");var r=t("et"),n="PPXGDPTPVSPXBFAHNEYRAKe";if(B.env.fe_is_tdot&&!r.track(n))return _r_();var e,a=t("searchresults/tpi/data-api"),o=t("hotel/tpi/data-api"),s="www"===B.env.b_site_type,i="mdot"===B.env.b_site_type;function _(){_i_("50d:812b1fea");var e,i,_=(i="wholesaler_configuration",_i_("50d:26e9d9d1"),_r_(s?t("searchresults/env").get(i):B.env[i]));_&&_.availability_api_request&&_.decision_fragment_request&&((e=Object.assign({},_.availability_api_request)).use_cache=_.use_cache,i=Object.assign({},_.decision_fragment_request),o.run(_.b_wholesaler_url,e,i,!0).then(function(e){_i_("50d:9ecda92e"),null!=e&&(B.env.fe_is_tdot&&r.stage(n,1),a.emitTpiDataEvent(function(e){_i_("50d:f3dc79b2");var i,_,t,r={data:{},status:200,status_response:"OK"};for(i in e)"exps"!==i&&(r.data[i]=[],_=e[i],(t={}).wholesaler_code=_.min_room_block.wholesaler_code||"ag",t.price_formatted=_.min_room_block.price_formatted,t.price_inclusion=_.min_room_block.price_inclusion,t.price_user_currency=_.min_price,t.room_name=_.min_room_block.room_name,t.room_info=_.min_room_block.room_description,t.cancellation_information=_.min_room_block.cancellation_information,t.reservation_meta_data={ratechannel:"Retail"},t.price_detail=_.min_room_block.price_detail,r.data[i].push(t));return e.exps&&(r.exps=e.exps),_r_(r)}(e))),_r_()}).catch(function(){})),_r_()}s&&(e=t("searchresults/events")).on(e.DATA_ENVIRONMENT_UPDATED,_),i&&(i=t("event-bus")).on(i.EVENTS.SR_AJAX_LOADED,function(e,i){_i_("50d:32526b0f"),0<=i.blocks.indexOf("results")&&_(),_r_()}),_(),_r_()}),B.define("searchresults/tpi/user-utils",function(e,i,_){_i_("50d:4aee45db");var t=B.require("et"),r={TRACKING_ASPECTS:{ALWAYS:"always",IS_GENIUS:"genius",IS_LOGGED_IN:"loggedin",IS_ASIAN:"asian",IS_EARLY:"early",IS_LAST_MINUTE:"lastminute",IS_DOMESTIC:"domestic",IS_INTERNATIONAL:"international",IS_META:"meta"},trackUser:function(e,i){var _;_i_("50d:98c03e0d"),void 0!==(_=i?i[r.TRACKING_ASPECTS.ALWAYS]:1)&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_GENIUS]:2)&&B.env.b_reg_user_is_genius&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_LOGGED_IN]:3)&&0<B.env.auth_level&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_ASIAN]:4)&&r.isUserAsian()&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_EARLY]:5)&&r.isEarlyBooker()&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_DOMESTIC]:6)&&B.env.b_countrycode===B.env.b_guest_country&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_INTERNATIONAL]:7)&&B.env.b_countrycode!==B.env.b_guest_country&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_LAST_MINUTE]:8)&&r.isLastMinuteBooker()&&t.stage(e,_),void 0!==(_=i?i[r.TRACKING_ASPECTS.IS_META]:9)&&"meta"==B.env.b_partner_vertical&&t.stage(e,_),_r_()},isUserAsian:function(){_i_("50d:ee3537b5");var e=!1,i=["cn","kp","kh","mm","la","ph","bn","bt","np","hk","th","mo","sg","jp","lk","id","mv","mn","bd","in","vn","kr","tw","my"];if(B.env.b_guest_country)for(var _=0;_<i.length;_++)i[_]==B.env.b_guest_country&&(e=!0);return _r_(e)},isLastMinuteBooker:function(){if(_i_("50d:31024b7d"),B.env.b_checkin_date){var e=new Date(B.env.b_checkin_date),i=new Date,i=Math.abs(e.getTime()-i.getTime());if(Math.ceil(i/864e5)<=3)return _r_(!0)}return _r_(!1)},isEarlyBooker:function(){if(_i_("50d:ee7d2bef"),B.env.b_checkin_date){var e=new Date(B.env.b_checkin_date),i=new Date,i=Math.abs(e.getTime()-i.getTime());if(30<=Math.ceil(i/864e5))return _r_(!0)}return _r_(!1)}};_.exports=r,_r_()}),B.when({action:"searchresults",events:"ready",condition:1==B.env.b_bookings_owned&&B.env.wholesaler_configuration&&B.env.wholesaler_configuration.availability_api_request}).run(function(_){_i_("50d:2f3ed11b");var e=_("searchresults/tpi/data-api"),s=_("hotel/tpi/postproc-api"),t=_("searchresults/filters").getInstance,l=_("jquery"),c=_("et"),f="PPXGSCZFRURURNWBOabFIRZZERT",d=B.env.tpi_search_config.b_children_total&&2==c.track(f),h="PPXGSCZFRURURNHPZAWe",u=1<B.env.tpi_search_config.b_nr_rooms_needed&&2==c.track(h),p="PPXGFRURURYTaIXLCTEbaO";function i(){var e;_i_("50d:5ff8f9e4"),this.occupancy=B.env.wholesaler_configuration.availability_api_request.search_config.number_of_adults;var i=_("searchresults/env");if(this.wholesaler_configuration=i.get("wholesaler_configuration"),this.hotel_candidate_list=[],this.hotels_with_no_rate=[],this.search_filters={},this.hotel_info_prices=this.wholesaler_configuration.hotel_info_prices,this.searchresults_ordered_by_price=this.wholesaler_configuration.searchresults_ordered_by_price,this.translations=this.wholesaler_configuration.b_wholesaler_translations,this.rtl=i.get("rtl"),this.search_filters_raw=t(),!this.search_filters_raw.filters["fc-5"]&&!this.search_filters_raw.filters["fc-6"])for(this.hotel_candidate_list=this.wholesaler_configuration.b_wholesaler_hotel_ids,this.wholesaler_configuration.hotels_with_no_rate&&(this.hotels_with_no_rate=this.wholesaler_configuration.hotels_with_no_rate),this.search_filters_raw.filters["fc-2"]&&(this.search_filters.fc=1),this.search_filters.mealplan=0,this.search_filters_raw.filters["mealplan-1"]?this.search_filters.mealplan+=4:this.search_filters_raw.filters["mealplan-3"]?this.search_filters.mealplan=7:this.search_filters_raw.filters["mealplan-8"]?this.search_filters.mealplan=6:this.search_filters_raw.filters["mealplan-9"]?this.search_filters.mealplan=5:this.search_filters_raw.filters["mealplan-4"]&&(this.search_filters.all_inclusive=1),this.search_filters.price_slider_options=B.env.b_slider_options,e=1;e<=4;e++)if(this.search_filters_raw.filters["pri-"+e]){this.search_filters.price_range=e;break}_r_()}function b(e,_){_i_("50d:1f639a01"),e.find("a[href]").each(function(){_i_("50d:a79d53c4");var e=l(this).attr("href"),i=e.indexOf("#");-1===i?e+="&tpi_r="+_:e=e.slice(0,i)+"&tpi_r="+_+e.slice(i),l(this).attr("href",e),_r_()}),_r_()}i.prototype.render=function(e){_i_("50d:ac730b56"),this.search_filters_raw.filters["fc-5"]||this.search_filters_raw.filters["fc-6"]||this.processResult(e),_r_()},i.prototype.checkSearchFilters=function(e){var i;_i_("50d:c0ba7944");for(var _=0;_<e.length;_++){var t,r,n=e[_],a=!1;if(l.isEmptyObject(this.search_filters)?a=!0:((r=(r=(r=(r=(r=!0)&&1!=this.search_filters.all_inclusive)&&0<this.search_filters.mealplan?!(!n.room_info||!n.room_info.meal_info)&&(t=0,1===n.room_info.meal_info.has_breakfast&&(t+=4),1===n.room_info.meal_info.has_lunch&&(t+=2),1===n.room_info.meal_info.has_dinner&&(t+=1),r&&t===this.search_filters.mealplan):r)&&(!this.search_filters.price_range||1==this.search_filters.price_range))&&(1!=this.search_filters.fc||n.cancellation_information&&n.cancellation_information.refund_info&&0<n.cancellation_information.refund_info.length&&"fully_refundable"===n.cancellation_information.refund_info[0].type))&&(a=!0),this.search_filters.price_slider_options&&this.search_filters.price_slider_options.selected&&(t=this.search_filters.price_slider_options.min_selected,(this.search_filters.price_slider_options.max_selected<(r=n.price_user_currency)||r<t)&&(a=!1))),a){i=n;break}}return _r_(i)},i.prototype.processResult=function(e){if(_i_("50d:3d43b29c"),e&&e.data&&200==e.status){for(var i={},_=0,t=[],r=0;r<this.hotel_candidate_list.length;r++){var n,a=this.hotel_candidate_list[r],o=e.data[a];!o||-1!=this.hotels_with_no_rate.indexOf(a)||(n=this.checkSearchFilters(o))&&(_++,t.push(""+a),(o=l("div.sr_item[data-hotelid='"+a+"']").addClass("hasTPIRateAvailable")).length&&(this.injectTPIIntoRoomBlock(o,n,e.exps||{}),i[a]={hotel_block:o,room_info:n},b(o,1)))}0<_&&(_i_("50d:34dd03a1"),l("div.sr_item:not(.hasTPIRateAvailable)").each(function(){_i_("50d:5de3eb7b"),b(l(this),2),_r_()}),_r_(),s.send_postproc_request(t)),this.sortTpiRooms(i)}_r_()},i.prototype.sortTpiRooms=function(e){if(_i_("50d:333a9240"),1===this.searchresults_ordered_by_price&&this.wholesaler_configuration.b_fix_price_sorting){var a,o,s,c=this.hotel_info_prices;for(a in e){var i=(o=e[a]).room_info.price_user_currency;o.price=i}for(a in e)0==(o=e[a]).hotel_block.find("div.distfromdest--highlight").length&&(s=l("div.sr_item.sr_property_block")).each(function(e){_i_("50d:91092359");var i=l(this),_=i.data("hotelid"),t=Number(c[_]);if(t&&e!==s.length-1)for(var r=e+1;r<s.length;r++){var n=l(s.eq(r)).data("hotelid"),n=Number(c[n]);if(n&&n<t)return _r_(_!=a);if(0!=n)break}return t&&t>=o.price?(o.hotel_block.detach(),i.before(o.hotel_block),c[_]=""+o.price,_r_(!1)):e===s.length-1?(o.hotel_block.detach(),i.after(o.hotel_block),c[_]=""+o.price,_r_(!1)):void _r_()})}_r_()},i.prototype.injectTPIIntoRoomBlock=function(e,i,_){if(_i_("50d:ccc4806c"),B.env.tpi_search_config.b_children_total&&c.track(f)&&(c.stage(f,1),c.track(f)<2))return _r_();if(1<B.env.tpi_search_config.b_nr_rooms_needed&&c.track(h)&&(c.stage(h,1),c.track(h)<2))return _r_();c.stage("PPXGFRURURYTbUdSUHTRLFZPeZYaAFZKVHXT",2);var t=(t=i.room_name?i.room_name:t)||(i.room_info&&this.translations[i.room_info.booking_room_type]?this.translations[i.room_info.booking_room_type]:this.translations[20]),r=0;this.rtl&&(r=1);var n=e.find(".room_details"),a=n.find(".sr_room_table"),o=n.find(".sr-cta-button-row");(d||u)&&(a=n.find(".sr_gr.sr-group_recommendation"));var s=i.price_detail&&i.price_detail.total_pay_now_and_pay_at_property_price_pretty?i.price_detail.total_pay_now_and_pay_at_property_price_pretty:i.price_formatted;1===a.length&&((r={b_tpi_room_name:t,b_tpi_price:s,b_tpi_url:(s=function(e,i){_i_("50d:2da03b31");var _,t={};return t.header=e.find("thead").clone(),t.url=e.find(".roomrow").attr("data-link"),t.noScrollUrl=i.find("a").attr("href"),t.bookButtonText=i.find(".js-sr-cta-text").html(),d?(_=B.env.tpi_search_config,t.occupancy=B.jstmpl("b_tpi_occupancy_icons").render({fe_icons_limit:5,fe_num_adults:_.b_adults_total,fe_num_children:_.b_children_total,fe_show_plus_sign_on_children:1,fe_icons_size:10,fe_disable_tooltip:1})):u?(_=B.env.tpi_search_config,t.occupancy=B.jstmpl("b_tpi_occupancy_icons").render({fe_icons_limit:5,fe_num_adults:Math.ceil(_.b_adults_total/_.b_nr_rooms_needed),fe_icons_size:10,fe_disable_tooltip:1})):t.occupancy=e.find(".room_link").find("div").clone(),t.price=e.find(".smart_price_style").clone(),t.roomReinforcment=e.find(".sr_room_reinforcement").clone(),t.bookButton=i.clone(),_r_(t)}(a,o)).noScrollUrl,b_has_breakfast:i.room_info.meal_info.has_breakfast,b_is_rtl:r,prc_stay_night_num:B.env.tpi_los,prc_search_config:B.env.tpi_search_config,exps:_}).b_tpi_book_button_text=s.bookButtonText,2<this.occupancy&&!d&&!u&&(r.fe_occupancy=this.occupancy,n.contents().hide()),c.track(p),i.cancellation_information&&i.cancellation_information.refund_info?(_=i.cancellation_information.refund_info,r.b_free_cancel=0<_.length&&"fully_refundable"===_[0].type,"hu"===B.env.b_guest_country&&r.b_free_cancel&&_[0].penalty_end_date&&(r.b_free_cancel_until=_[0].penalty_end_date)):r.b_free_cancel=!1,r=B.jstmpl("b_tpi_room_block_room_integration").render(r),n.append(r),c.initAttributesTracking(n),null!=(r=n.find(".sr_room_table[data-table-type=tpi]"))&&null!=s&&((d||u)&&(o.hide(),n.find(".sr-group-recommendation__title").hide()),function(e,i,_){_i_("50d:b5d3242d"),i.find(".tpi_room_name").append(e.occupancy);var t=i.find(".normal_book_button_holder");e.price.html('<label class="bui-radio__label normal_price_label" for="tpi_wholesale_price_radio">'+e.price.html()+"</label>"),e.header.addClass("tpi_room_table_header"),i.hide(),i.prepend(e.header),t.append(e.bookButton),_.hide(),i.show(),i.find(".normal_price_label").addClass("tpi_radio_active"),_r_()}(s,r,a),function(e,i,_){_i_("50d:e4b2b53f");var t=_.find(".bfast-included-ribbon"),r=_.find(".no_cc_02"),n=_.find(".b-no-cc-reinforcement__spacing"),a=_.find("[data-trips-promotion]"),o=i.find(".tpi_room_name_holder");e.room_info.meal_info.has_breakfast||t.hide(),r.hide(),n.hide(),_.find(".js_sr_persuation_msg").hide(),_.find(".c-unit-configuration").hide(),a.hide();a=_.find(".ge-free-room-upgrade-ribbon"),_=_.find(".ge-free-room-upgrade-sr-text");(0<a.length||0<_.length)&&(a.hide(),_.hide()),i.find(".tpi_book_button_holder").show(),o.show(),_r_()}(i,r,e),function(i,e){_i_("50d:404fbedd");var _=e.find(".tpi_button_room_integration");e.click(function(){}),_.click(function(e){_i_("50d:dd676a0a"),e.preventDefault(),window.open(i.noScrollUrl,"_blank"),_r_()}),e.find(".roomrow.entire_row_clickable").click(function(){_i_("50d:033af5e5"),c.customGoal(p,1),_r_()}),_r_()}(s,r)),function(e,i){_i_("50d:bcf593e5");var _=e.price_detail&&e.price_detail.total_pay_now_and_pay_at_property_price_pretty,i=i.find(".roomPrice"),_="inclusive"===e.price_inclusion||_?B.jstmpl.translations("sr_search_card_includes_taxes_charges"):B.jstmpl.translations("sr_hp_taxes_and_charges_exception");i.find(".tpi-price-inclusion__no-radio__caption").text(_),_r_()}(i,n),n.find(".roomrow").attr("data-link",s.url)),_r_()},e.onTpiData(function(e){_i_("50d:e1cdb1d1"),c.track("PPXGSCZRDbfHGFbDZSIPfLHXT"),c.stage("PPXGSCZRDbfHGFbDZSIPfLHXT",4),(new i).render(e),_r_()}),_r_()});
