YUI.add("media-rapid-tracking",function(u){"use strict";var t,e="rapid-tracker:",n=e+"click",i=e+"event",o=e+"reinit",a=e+"destroy-instance",r=null;function c(e){c.superclass.constructor.apply(this,arguments)}c.NAME="RapidTracking",c.ATTRS={},u.extend(c,u.Base,{config:null,refererSpaceid:null,currentSpaceid:null,rapidConfig:null,_globalEvents:{},moduleQueue:null,beaconQueue:[],initializer:function(e){var n=this;r=r||e.instance||null,n.moduleQueue=n.moduleQueue||e.moduleQueue||[],n.config=n.config||e.config||{},n.rapidConfig=n.rapidConfig||e.rapidConfig||{},n._initEventListeners(),n._initPublish(),r&&n._processQueue()},initRapid:function(){this._initRapid(),this._processQueue()},_initRapid:function(e){var n=this;r&&!e||(r&&r.destroy(),n.updateRequestAttributes(),n.rapidConfig.tracked_mods=n._getTrackedMods(),void 0!==YAHOO.i13n.Rapid&&(r=new YAHOO.i13n.Rapid(n.rapidConfig),n.currentSpaceid=n.rapidConfig.spaceid,window.rapidInstance=r,YAHOO&&YAHOO.i13n&&(YAHOO.i13n.currentSID=n.getCurrentSID())))},getCurrentSID:function(e){return r&&r.getCurrentSID?r.getCurrentSID():null},getRefererSpaceid:function(){return this.refererSpaceid||null},_getTrackedMods:function(){var e=this,n=e.rapidConfig&&e.rapidConfig.tracked_mods||[];return u.Lang.isArray(n)&&(n=e._getModulesArrayFromQueue(!0).concat(n),n=u.Array.dedupe(n)),n},_initPublish:function(){u.publish("rapid:init",{fireOnce:!0}).fire()},_initEventListeners:function(){var e=this;e._globalEvents[n]||(u.Global.on(n,e._handleBeaconing,e,"click"),e._globalEvents[n]=!0),e._globalEvents[i]||(u.Global.on(i,e._handleBeaconing,e,"event"),e._globalEvents[i]=!0),e._globalEvents[o]||(u.Global.on(o,e._handleReInit,e),e._globalEvents[o]=!0),e._globalEvents[a]||(u.Global.on(a,e._handleDestroyInstance,e),e._globalEvents[a]=!0)},updateRequestAttributes:function(){var e=this;window.YMEDIA_REQ_ATTR&&"object"==typeof YMEDIA_REQ_ATTR.instr&&(e.rapidConfig.keys=e.rapidConfig.keys||{},e.rapidConfig.keys.authfb=YMEDIA_REQ_ATTR.instr.authfb,e.rapidConfig.keys.rid=YMEDIA_REQ_ATTR.instr.request_id)},addModules:function(e,n,i){r?r.addModules(e,n,i):this._addModulesQueue(e)},refreshModule:function(e,n,i,t){r&&r.refreshModule(e,n,i,t)},refreshModuleAsRichView:function(e,n){r&&(u.Lang.isFunction(r.refreshModuleAsRichView)?r.refreshModuleAsRichView(e,n):this.refreshModule(e))},removeModule:function(e){r&&r.removeModule(e)},isModuleTracked:function(e){if(r)return r.isModuleTracked(e)},setRapidAttribute:function(e){r&&"function"==typeof r.setRapidAttribute&&r.setRapidAttribute(e)},clearRapidAttribute:function(e){r&&"function"==typeof r.clearRapidAttribute&&r.clearRapidAttribute(e)},beaconPageview:function(e){r&&r.beaconPageview(e)},beaconClick:function(e,n,i,t,o,a,u){var c={};c.sec=e||"",c.linkname=n||"",c.pos=i&&"number"==typeof i?i:0,c.keys="object"==typeof t?t:{},c.outcome=o||"",c.callback="function"==typeof a?a:null,c.sec?r?c.outcome?r.beaconClick(c.sec,c.linkname,c.pos,c.keys,c.outcome,c.callback,u):r.beaconClick(c.sec,c.linkname,c.pos,c.keys,null,c.callback,u):this._addBeaconQueue(c,"click"):c.callback&&c.callback()},beaconLinkViews:function(e,n,i){r&&r.beaconLinkViews&&r.beaconLinkViews(e,n,i)},beaconPerformanceData:function(e,n){r&&r.beaconPerformanceData&&r.beaconPerformanceData(e,n)},beaconEvent:function(e){1<arguments.length&&(e={name:arguments[0],keys:arguments[1]},2<arguments.length&&arguments[2]&&(e.outcome=arguments[2]),3<arguments.length&&arguments[3]&&(e.callback="function"==typeof arguments[3]?arguments[3]:null)),r?e.name&&e.keys?(e.keys="object"==typeof e.keys?e.keys:{},e.outcome?r.beaconEvent(e.name,e.keys,e.outcome,e.callback):r.beaconEvent(e.name,e.keys,null,e.callback)):e.callback&&e.callback():this._addBeaconQueue(e,"event")},updateConfig:function(e){r&&(this.refererSpaceid=this.currentSpaceid||null,this.currentSpaceid=e.spaceid||null,r.reInit(e))},addModuleAPV:function(e){if(r&&r.addModuleAPV)return r.addModuleAPV(e)},beaconAPV:function(e,n){r&&r.beaconAPV&&r.beaconAPV(e,n)},_addModulesQueue:function(e){e&&this.moduleQueue.push(e)},_addBeaconQueue:function(e,n){this.beaconQueue.push({data:e,type:n})},_processQueue:function(){var e,n,i,t,o=this,a=o.beaconQueue.length;if(r){for(0<(i=o._getModulesArrayFromQueue(!0)).length&&o.addModules(i),e=o.moduleQueue.length,t=0;t<e;t++)"object"==typeof o.moduleQueue[t]&&(n=u.merge(n,o.moduleQueue[t]));for(n&&o.addModules(n),t=0;t<a;t++)o._handleBeaconing(o.beaconQueue[t].data,o.beaconQueue[t].type);o.moduleQueue=[],o.beaconQueue=[]}},_getModulesArrayFromQueue:function(e){for(var n=this,i=n.moduleQueue.length,t=[],o=[],a=0;a<i;a++)u.Lang.isArray(n.moduleQueue[a])?t=t.concat(n.moduleQueue[a]):("object"==typeof n.moduleQueue[a]&&e?o:t).push(n.moduleQueue[a]);return 0<t.length&&e&&(n.moduleQueue=o),t},_handleBeaconing:function(e,n){var i=e&&"object"==typeof e.data?e.data:null,t=e.mod_id||"";r?i&&(i.keys=this._addMpos(i.keys,t),"click"===n?this.beaconClick(i.sec,i.linkname,i.pos,i.keys,i.outcome,i.callback):this.beaconEvent(i)):this._addBeaconQueue(e,n)},_handleDestroyInstance:function(){r&&(this.rapidConfig={},r.destroy(),r=null)},_handleReInit:function(e){this.rapidConfig=e,this._initRapid(!0)},_addMpos:function(e,n){var i=this.config.selectors;return n&&e&&!e.mpos&&(i=(t=t||i&&u.one(i.bd))&&t.all(i.mods),n=n&&i?i.indexOf(u.one("#"+n))+1:0,"object"==typeof e?e.mpos=n:e={mpos:n}),e}}),u.namespace("Media").RapidTracking=c},"@VERSION@",{requires:["event-custom","base","node"]});
