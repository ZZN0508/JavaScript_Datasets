(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{ujfh:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return h}),n("+KXO"),n("1t7P"),n("daRM"),n("FtHn");var r=n("m3Bd"),a=n.n(r),t=n("VrFO"),o=n.n(t),r=n("Y9Ll"),t=n.n(r),r=n("KEM+"),i=n.n(r),u=(n("Cm4o"),n("7x/C"),n("87if"),n("lTEL"),n("kYxP"),n("vrRf"),n("jwue"),n("+oxZ"),n("ho0z"),n("Ee2X"),n("LW0h"),n("z84I"),n("LJOr"),n("KqXw"),n("pXBW")),r=n("k49u"),_=n("ZjLa"),c=n("Myq3"),s=n("EhiH"),m=n("/NU0");function p(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach(function(e){i()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var f=[r.a.BadOauthToken,r.a.OauthTimestampException,r.a.BadAuthenticationData,r.a.AccessDeniedByBouncer],h=(t()(l,[{key:"_record",value:function(e){this._sample(e)&&this._scribe.log(void 0,e)}},{key:"_possiblyRecordErrorToAllNamespace",value:function(e){"api:error"===e.event_type&&(e=d(d({},e),{},{event_type:"api:all"}),this._record(e))}},{key:"_flushBuffer",value:function(){var t=this;this._buffer.splice(0,this._buffer.length).forEach(function(e){t._record(e),t._possiblyRecordErrorToAllNamespace(e)})}},{key:"_sample",value:function(e){e=e.event_type,e=this._options[{"api:all":"apiSampleSize","api:error":"apiErrorSampleSize","cdn:all":"cdnSampleSize","web:nav":"navSampleSize"}[e]]||0;return Math.random()<e}},{key:"_getEventType",value:function(e,t){return-1<this._options.cdnHostList.indexOf(e)?"cdn:all":-1<e.indexOf("twitter.com")?200<=t&&t<300?"api:all":"api:error":"none"}},{key:"_createCommonHeader",value:function(e){return{commonHeader:{clientHeader:{timestampMs:e.getTime(),timezoneOffsetMin:-e.getTimezoneOffset()}}}}},{key:"_prepareEvent",value:function(e){var t=new window.URL(e);if(this._shouldFilter(t))return null;e="api.twitter.com"===t.hostname;return{_category_:"client_network_request_event",request:{uri_scheme:t.protocol,uri_host_name:t.hostname,uri_path:t.pathname,uri_query:t.query||"",http_method:"GET",http_status_code:e?0:200,start_time_ms:Date.now(),request_details:{duration_ms:0}},common_header:this._createCommonHeader(new Date),network_measurements:this._getNetworkMeasurements(),event_type:this._getEventType(t.hostname,200),event_source:"rweb"}}},{key:"_extractApiErrorCode",value:function(e){e=e.errors,e=(void 0===e?[]:e).map(function(e){return e.code}).filter(function(e){return void 0!==e});return Object(s.a)(e,function(e){return-1<f.indexOf(e)})||(0<e.length?e[0]:void 0)}},{key:"_updateEventWithRequestResponse",value:function(e,t,n,r){var o=e.request.request_details;return d(d({},e),{},{request:d(d({},e.request),{},{http_method:t.method,http_status_code:n.status,start_time_ms:t.startTimestamp,trace_id:t.headers["x-b3-traceid"],twitter_api_error_code:r&&this._extractApiErrorCode(r)||void 0,request_details:d(d({},o),{},{duration_ms:o.duration_ms||t.endTimestamp-t.startTimestamp,request_body_size:o.request_body_size||("string"==typeof t.data?t.data.length:t.data?JSON.stringify(t.data).length:void 0),response_body_size:o.response_body_size||(n&&n.body?n.body.length:void 0)})}),event_type:this._getEventType(e.request.uri_host_name,n.status)})}},{key:"_getTiming",value:function(e,t){return Object(m.a)(e)&&Object(m.a)(t)?Math.round(t-e):void 0}},{key:"_getRequestDetails",value:function(e){var t=this._getTiming(e.startTime,e.responseEnd)||0,n=e.secureConnectionStart||e.connectEnd;return{duration_ms:t,rx_bytes:e.transferSize,dns_ms:this._getTiming(e.domainLookupStart,e.domainLookupEnd),tcp_ms:this._getTiming(e.connectStart,n),tls_ms:0===e.secureConnectionStart?void 0:this._getTiming(e.secureConnectionStart,e.connectEnd),response_body_size:e.decodedBodySize}}},{key:"_updateEventWithPrecisionTimings",value:function(e,t){t=this._getRequestDetails(t);return d(d({},e),{},{request:d(d({},e.request),{},{request_details:d(d({},e.request.request_details),t)})})}},{key:"_getPerformanceNavigationTimingClientNetworkRequestEvent",value:function(e){var t=new window.URL(e.name),e=this._getRequestDetails(e);return{_category_:"client_network_request_event",request:{uri_scheme:t.protocol,uri_host_name:t.hostname,uri_path:t.pathname,uri_query:t.query||"",http_method:"GET",http_status_code:200,start_time_ms:Date.now(),request_details:e},common_header:this._createCommonHeader(new Date),network_measurements:this._getNetworkMeasurements(),event_type:"web:nav",event_source:"rweb"}}},{key:"_getPerformanceTimingClientNetworkRequestEvent",value:function(e,t){var n=e.secureConnectionStart||e.connectEnd;return{_category_:"client_network_request_event",request:{uri_scheme:t.protocol,uri_host_name:t.hostname,uri_path:t.pathname,uri_query:t.search||"",http_method:"GET",http_status_code:200,start_time_ms:Date.now(),request_details:{duration_ms:this._getTiming(e.navigationStart,e.responseEnd)||0,dns_ms:this._getTiming(e.domainLookupStart,e.domainLookupEnd),tcp_ms:this._getTiming(e.connectStart,n),tls_ms:0===e.secureConnectionStart?void 0:this._getTiming(e.secureConnectionStart,e.connectEnd)}},common_header:this._createCommonHeader(new Date),network_measurements:this._getNetworkMeasurements(),event_type:"web:nav",event_source:"rweb"}}},{key:"_getNavigationClientNetworkRequestEvent",value:function(){if(window.performance&&window.performance.getEntriesByType){var e=window.performance.getEntriesByType("navigation");if(e&&e.length){var t=e[0];return this._getPerformanceNavigationTimingClientNetworkRequestEvent(t)}}else if(window.performance&&window.performance.timing&&window.location){e=window.performance.timing,t=window.location;return this._getPerformanceTimingClientNetworkRequestEvent(e,t)}}}]),l);function l(e,t){var s=this;o()(this,l),i()(this,"scribeRequest",function(e){var t,n=e.response,r=e.error,o=a()(e,["error"]),i=new window.URL(o.url);(!r&&n||(n={headers:{},body:"",status:r?r.status:500},r instanceof u.a))&&!s._shouldFilter(i)&&(s._flushResourceTimingBuffer(),(t=Object(c.a)(s._buffer,function(e){e=e.request;return i.protocol===e.uri_scheme&&i.hostname===e.uri_host_name&&i.pathname===e.uri_path&&(i.query||"")===e.uri_query}))?(e=s._buffer.indexOf(t),s._buffer[e]=s._updateEventWithRequestResponse(t,o,n,r)):(r=(t=s._prepareEvent(o.url))&&s._updateEventWithRequestResponse(t,o,n,r))&&s._buffer.push(r),s._flushBuffer())}),i()(this,"_shouldFilter",function(e){return-1<e.pathname.indexOf("/1.1/jot")}),i()(this,"_flushResourceTimingBuffer",function(){var e;s._resourceTimingApiSupported&&(e=window.performance.getEntriesByType("resource"),window.performance.clearResourceTimings(),e.forEach(function(e){var t;!e.name||(t=s._prepareEvent(e.name))&&(e=s._updateEventWithPrecisionTimings(t,e),s._buffer.push(e))}))}),i()(this,"_updateNetworkInfo",function(e){s._networkInfo=e}),i()(this,"_getNetworkMeasurements",function(){return{connection_type:s._networkInfo.type||"unknown",speed_class:s._networkInfo.effectiveType,download_mbps:s._networkInfo.downlink,download_max_mbps:s._networkInfo.downlinkMax,rtt_ms:s._networkInfo.rtt,reduced_data_usage:s._networkInfo.saveData}}),this._resourceTimingApiSupported=window.performance&&window.performance.getEntriesByType&&window.performance.getEntriesByType("resource")&&window.performance.clearResourceTimings,this._scribe=e,this._options=d({apiErrorSampleSize:0,apiSampleSize:0,cdnSampleSize:0,navSampleSize:0,cdnHostList:[]},t),this._buffer=[],this._networkInfo={},_.a.getConnectionInfo().then(function(e){s._updateNetworkInfo(e),_.a.addEventListener("connectionChange",s._updateNetworkInfo)}),this._resourceTimingApiSupported&&(window.performance.onresourcetimingbufferfull=this._flushResourceTimingBuffer);t=this._getNavigationClientNetworkRequestEvent();t&&this._buffer.push(t)}}}]);
