define("modules/clean/abuse/captcha_helper",["require","exports","tslib","modules/constants/login_and_register","modules/constants/page_load","modules/clean/web_timing_logger","modules/core/exception","modules/core/uri"],function(c,n,o,i,t,a,s,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DUMMY_RESPONSE=n.BuildRecaptchaURI=n.isTest=n.LoadRecaptcha=n.ClearCaptchaPromise=n.HasCaptchaLoaded=n.captchaPromise=void 0,i=o.__importStar(i),s=o.__importStar(s);var u=!1;function l(){var e={onload:"recaptchaOnloadCallback",render:"explicit",hl:t.USER_LOCALE.replace("_","-")};return new r.URI({scheme:"https",authority:"www.google.com",path:"/recaptcha/api.js",query:e}).toString()}function p(){return new Promise(function(e,t){if(window.recaptchaOnloadCallback=function(){e(window.grecaptcha)},i.SHOULD_LOAD_FUNCAPTCHA&&u&&new Promise(function(e,t){c(["modules/clean/abuse/funcaptcha_modal"],e,t)}).then(o.__importStar).then(function(e){var t=e.loadFuncaptchaModal,a=e.recordFunCaptchaLoadingStats,r=performance.now(),c="",n=!1;try{t(),n=!0}catch(e){c=e.message}finally{t=performance.now()}a("funcaptcha_modal_loading",t-r,n,c)}),n.isTest())e(_);else{var a=document.createElement("script"),r=l();a.setAttribute("src",r);r=window.CSP_SCRIPT_NONCE;if(!r)return s.reportException({err:new Error("CSP nonce not set"),severity:s.SEVERITY.CRITICAL,tags:["product-safety-infra","recaptcha"]}),void t();a.setAttribute("nonce",r),document.body.appendChild(a)}})}n.HasCaptchaLoaded=function(){return null!=n.captchaPromise},n.ClearCaptchaPromise=function(){n.captchaPromise=null},n.LoadRecaptcha=function(e,t){return void 0!==t&&(u=t),n.captchaPromise||(n.captchaPromise=e?new Promise(function(e,t){a.waitForTTI().then(e),setTimeout(e,2500)}).then(p):p()),n.captchaPromise},n.isTest=function(){return i.IS_SELENIUM_TEST},n.BuildRecaptchaURI=l;var d={},h={},m=0;n.DUMMY_RESPONSE="DUMMY-RESPONSE";function f(e){e.setAttribute("class","g-recaptcha-response"),e.setAttribute("name","g-recaptcha-response"),e.value=""}var _={reset:function(e){e=h[e].querySelector(".g-recaptcha-response");return f(e),!0},render:function(e,t,a){var r=m;m+=1,s.assert(null==e.querySelector(".g-recaptcha-response"),"can't render multiple recaptcha elements in same div");var c=document.createElement("textarea");return c.id="g-recaptcha-response-"+r,f(c),e.appendChild(c),h[r]=e,d[r]=function(){var e=n.DUMMY_RESPONSE;return c.value=e,t.callback&&t.callback(e),e},r},execute:function(e){return Promise.resolve(d[e]())}}});
