!function(l){"use strict";var e,u,f,a,g,w,h,p,o,m,b,i,y,v;function k(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}function F(e,n,i){"addEventListener"in window?e.addEventListener(n,i,!1):"attachEvent"in window&&e.attachEvent("on"+n,i)}function I(e,n,i){"removeEventListener"in window?e.removeEventListener(n,i,!1):"detachEvent"in window&&e.detachEvent("on"+n,i)}function t(e){return b[e]?b[e].log:f}function M(e,n){r("log",e,n,t(e))}function x(e,n){r("info",e,n,t(e))}function z(e,n){r("warn",e,n,!0)}function r(e,n,i,t){!0===t&&"object"==typeof window.console&&console[e](w+"["+(e="Host page: "+(n=e=n),e=window.top!==window.self?window.parentIFrame&&window.parentIFrame.getId?window.parentIFrame.getId()+": "+n:"Nested host page: "+n:e)+"]",i)}function n(n){function t(){e("Height"),e("Width"),S(function(){P(f),T(m),u("resizedCallback",f)},f,"init")}function e(e){var n=Number(b[m]["max"+e]),i=Number(b[m]["min"+e]),t=e.toLowerCase(),e=Number(f[t]);M(m,"Checking "+t+" is in range "+i+"-"+n),e<i&&(e=i,M(m,"Set "+t+" to min value")),n<e&&(e=n,M(m,"Set "+t+" to max value")),f[t]=""+e}function a(e){return r.substr(r.indexOf(":")+g+e)}function s(i,t){var e,n=function(){var e,n;H("Send Page Info","pageInfo:"+(e=document.body.getBoundingClientRect(),n=f.iframe.getBoundingClientRect(),JSON.stringify({iframeHeight:n.height,iframeWidth:n.width,clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),offsetTop:parseInt(n.top-e.top,10),offsetLeft:parseInt(n.left-e.left,10),scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset})),i,t)};v[e=t]||(v[e]=setTimeout(function(){v[e]=null,n()},32))}function d(e){e=e.getBoundingClientRect();return O(m),{x:Math.floor(Number(e.left)+Number(p.x)),y:Math.floor(Number(e.top)+Number(p.y))}}function c(e){var n=e?d(f.iframe):{x:0,y:0},i={x:Number(f.width)+n.x,y:Number(f.height)+n.y};M(m,"Reposition requested from iFrame (offset x:"+n.x+" y:"+n.y+")"),window.top!==window.self?window.parentIFrame?window.parentIFrame["scrollTo"+(e?"Offset":"")](i.x,i.y):z(m,"Unable to scroll to requested position, window.parentIFrame not found"):(p=i,l(),M(m,"--"))}function l(){!1!==u("scrollCallback",p)?T(m):N()}function u(e,n){return R(m,e,n)}var i,o,r=n.data,f={},m=null;"[iFrameResizerChild]Ready"===r?function(){for(var e in b)H("iFrame requested init",A(e),document.getElementById(e),e)}():w===(""+r).substr(0,h)&&r.substr(h).split(":")[0]in b?(o=r.substr(h).split(":"),f={iframe:b[o[0]]&&b[o[0]].iframe,id:o[0],height:o[1],width:o[2],type:o[3]},m=f.id,b[m]&&(b[m].loaded=!0),(o=f.type in{true:1,false:1,undefined:1})&&M(m,"Ignoring init message from meta parent page"),!o&&(i=!0,b[o=m]||(i=!1,z(f.type+" No settings for "+o+". Message was: "+r)),i)&&(M(m,"Received: "+r),i=!0,null===f.iframe&&(z(m,"IFrame ("+f.id+") not found"),i=!1),i&&function(){var e,i=n.origin,t=b[m]&&b[m].checkOrigin;if(t&&""+i!="null"&&!(t.constructor===Array?function(){var e=0,n=!1;for(M(m,"Checking connection is from allowed list of origins: "+t);e<t.length;e++)if(t[e]===i){n=!0;break}return n}():(e=b[m]&&b[m].remoteHost,M(m,"Checking connection is from: "+e),i===e)))throw new Error("Unexpected message received from: "+i+" for "+f.iframe.id+". Message was: "+n.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return 1}()&&function(){switch(b[m]&&b[m].firstRun&&b[m]&&(b[m].firstRun=!1),f.type){case"close":b[m].closeRequestCallback?R(m,"closeRequestCallback",b[m].iframe):C(f.iframe);break;case"message":i=a(6),M(m,"MessageCallback passed: {iframe: "+f.iframe.id+", message: "+i+"}"),u("messageCallback",{iframe:f.iframe,message:JSON.parse(i)}),M(m,"--");break;case"scrollTo":c(!1);break;case"scrollToOffset":c(!0);break;case"pageInfo":s(b[m]&&b[m].iframe,m),r=m,e("Add ",F),b[r]&&(b[r].stopPageInfo=o);break;case"pageInfoStop":b[m]&&b[m].stopPageInfo&&(b[m].stopPageInfo(),delete b[m].stopPageInfo);break;case"inPageLink":n=a(9).split("#")[1]||"",i=decodeURIComponent(n),(i=document.getElementById(i)||document.getElementsByName(i)[0])?(i=d(i),M(m,"Moving to in page link (#"+n+") at x: "+i.x+" y: "+i.y),p={x:i.x,y:i.y},l(),M(m,"--")):window.top!==window.self?window.parentIFrame?window.parentIFrame.moveToAnchor(n):M(m,"In page link #"+n+" not found and window.parentIFrame not found"):M(m,"In page link #"+n+" not found");break;case"reset":W(f);break;case"init":t(),u("initCallback",f.iframe);break;default:t()}function e(n,i){function t(){b[r]?s(b[r].iframe,r):o()}["scroll","resize"].forEach(function(e){M(r,n+e+" listener for sendPageInfo"),i(window,e,t)})}function o(){e("Remove ",I)}var r,n,i}())):x(m,"Ignored: "+r)}function R(e,n,i){var t=null,o=null;if(b[e]){if("function"!=typeof(t=b[e][n]))throw new TypeError(n+" on iFrame["+e+"] is not a function");o=t(i)}return o}function E(e){e=e.id;delete b[e]}function C(e){var n=e.id;M(n,"Removing iFrame: "+n);try{e.parentNode&&e.parentNode.removeChild(e)}catch(e){}R(n,"closedCallback",n),M(n,"--"),E(e)}function O(e){null===p&&M(e,"Get page position: "+(p={x:window.pageXOffset!==l?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==l?window.pageYOffset:document.documentElement.scrollTop}).x+","+p.y)}function T(e){null!==p&&(window.scrollTo(p.x,p.y),M(e,"Set page position: "+p.x+","+p.y),N())}function N(){p=null}function W(e){M(e.id,"Size reset requested by "+("init"===e.type?"host page":"iFrame")),O(e.id),S(function(){P(e),H("reset","reset",e.iframe,e.id)},e,"reset")}function P(o){function i(e){function n(){for(var e in b)!function(n){function e(e){return"0px"===(b[n]&&b[n].iframe.style[e])}b[n]&&null!==b[n].iframe.offsetParent&&(e("height")||e("width"))&&H("Visibility change","resize",b[n].iframe,n)}(e)}var i,t;a||"0"!==o[e]||(a=!0,M(r,"Hidden iFrame detected, creating visibility listener"),(t=k())&&(i=document.querySelector("body"),e={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0},new t(function(e){M("window","Mutation observed: "+e[0].target+" "+e[0].type),d(n,16)}).observe(i,e)))}function e(e){var n=e;o.id?(o.iframe.style[n]=o[n]+"px",M(o.id,"IFrame ("+r+") "+n+" set to "+o[n]+"px")):M("undefined","messageData id not set"),i(e)}var r=o.iframe.id;b[r]&&(b[r].sizeHeight&&e("height"),b[r].sizeWidth&&e("width"))}function S(e,n,i){i!==n.type&&o?(M(n.id,"Requesting animation frame"),o(e)):e()}function H(e,n,i,t,o){var r,a=!1;t=t||i.id,b[t]&&(i&&"contentWindow"in i&&null!==i.contentWindow?(r=b[t]&&b[t].targetOrigin,M(t,"["+e+"] Sending msg to iframe["+t+"] ("+n+") targetOrigin: "+r),i.contentWindow.postMessage(w+n,r)):z(t,"["+e+"] IFrame("+t+") not found"),o&&b[t]&&b[t].warningTimeout&&(b[t].msgTimeout=setTimeout(function(){!b[t]||b[t].loaded||a||(a=!0,z(t,"IFrame has not responded within "+b[t].warningTimeout/1e3+" seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ignored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning."))},b[t].warningTimeout)))}function A(e){return e+":"+b[e].bodyMarginV1+":"+b[e].sizeWidth+":"+b[e].log+":"+b[e].interval+":"+b[e].enablePublicMethods+":"+b[e].autoResize+":"+b[e].bodyMargin+":"+b[e].heightCalculationMethod+":"+b[e].bodyBackground+":"+b[e].bodyPadding+":"+b[e].tolerance+":"+b[e].inPageLinks+":"+b[e].resizeFrom+":"+b[e].widthCalculationMethod}function s(i,e){var n,t,o,r,a,s=(""===(n=i.id)&&(i.id=(t=e&&e.id||y.id+u++,null!==document.getElementById(t)&&(t+=u++),n=t),f=(e||{}).log,M(n,"Added missing iframe ID: "+n+" ("+i.src+")")),n);function d(e){1/0!==b[s][e]&&0!==b[s][e]&&(i.style[e]=b[s][e]+"px",M(s,"Set "+e+" = "+b[s][e]+"px"))}function c(e){if(b[s]["min"+e]>b[s]["max"+e])throw new Error("Value for min"+e+" can not be greater than max"+e)}s in b&&"iFrameResizer"in i?z(s,"Ignored iFrame, already setup."):(r=e||{},b[s]={firstRun:!0,iframe:i,remoteHost:i.src.split("/").slice(0,3).join("/")},function(){if("object"!=typeof r)throw new TypeError("Options is not an object")}(),function(e){for(var n in y)y.hasOwnProperty(n)&&(b[s][n]=(e.hasOwnProperty(n)?e:y)[n])}(r),b[s]&&(b[s].targetOrigin=!0!==b[s].checkOrigin||""===(a=b[s].remoteHost)||"file://"===a?"*":a),function(){switch(M(s,"IFrame scrolling "+(b[s]&&b[s].scrolling?"enabled":"disabled")+" for "+s),i.style.overflow=!1===(b[s]&&b[s].scrolling)?"hidden":"auto",b[s]&&b[s].scrolling){case"omit":break;case!0:i.scrolling="yes";break;case!1:i.scrolling="no";break;default:i.scrolling=b[s]?b[s].scrolling:"no"}}(),c("Height"),c("Width"),d("maxHeight"),d("minHeight"),d("maxWidth"),d("minWidth"),"number"!=typeof(b[s]&&b[s].bodyMargin)&&"0"!==(b[s]&&b[s].bodyMargin)||(b[s].bodyMarginV1=b[s].bodyMargin,b[s].bodyMargin=b[s].bodyMargin+"px"),o=A(s),!(a=k())||i.parentNode&&new a(function(e){e.forEach(function(e){Array.prototype.slice.call(e.removedNodes).forEach(function(e){e===i&&C(i)})})}).observe(i.parentNode,{childList:!0}),F(i,"load",function(){var e,n;H("iFrame.onload",o,i,l,!0),e=b[s]&&b[s].firstRun,n=b[s]&&b[s].heightCalculationMethod in m,!e&&n&&W({iframe:i,height:0,width:0,type:"init"})}),H("init",o,i,l,!0),Function.prototype.bind&&b[s]&&(b[s].iframe.iFrameResizer={close:C.bind(null,b[s].iframe),removeListeners:E.bind(null,b[s].iframe),resize:H.bind(null,"Window resize","resize",b[s].iframe),moveToAnchor:function(e){H("Move to anchor","moveToAnchor:"+e,b[s].iframe,s)},sendMessage:function(e){H("Send Message","message:"+(e=JSON.stringify(e)),b[s].iframe,s)}}))}function d(e,n){null===i&&(i=setTimeout(function(){i=null,e()},n))}function c(e){M("window","Trigger event: "+e),d(function(){j("Window "+e,"resize")},16)}function L(){"hidden"!==document.visibilityState&&(M("document","Trigger event: Visiblity change"),d(function(){j("Tab Visable","resize")},16))}function j(e,n){for(var i in b)b[t=i]&&"parent"===b[t].resizeFrom&&b[t].autoResize&&!b[t].firstRun&&H(e,n,document.getElementById(i),i);var t}function q(){function i(e,n){n&&(function(){if(!n.tagName)throw new TypeError("Object is not a valid DOM element");if("IFRAME"!==n.tagName.toUpperCase())throw new TypeError("Expected <IFRAME> tag, found <"+n.tagName+">")}(),s(n,e),t.push(n))}var t;return function(){for(var e=["moz","webkit","o","ms"],n=0;n<e.length&&!o;n+=1)o=window[e[n]+"RequestAnimationFrame"];o||M("setup","RequestAnimationFrame not supported")}(),F(window,"message",n),F(window,"resize",function(){c("resize")}),F(document,"visibilitychange",L),F(document,"-webkit-visibilitychange",L),F(window,"focusin",function(){c("focus")}),F(window,"focus",function(){c("focus")}),function(e,n){switch(t=[],e&&e.enablePublicMethods&&z("enablePublicMethods option has been removed, public methods are now always available in the iFrame"),typeof n){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(n||"iframe"),i.bind(l,e));break;case"object":i(e,n);break;default:throw new TypeError("Unexpected data type ("+typeof n+")")}return t}}"undefined"!=typeof window&&(u=0,a=f=!1,g="message".length,h=(w="[iFrameSizer]").length,p=null,o=window.requestAnimationFrame,y={autoResize:!(i=null),bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!(b={}),enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!(m={max:1,scroll:1,bodyScroll:1,documentElementScroll:1}),maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,warningTimeout:5e3,tolerance:0,widthCalculationMethod:"scroll",closedCallback:function(){},initCallback:function(){},messageCallback:function(){z("MessageCallback function not defined")},resizedCallback:function(){},scrollCallback:function(){return!0}},v={},window.jQuery&&((e=window.jQuery).fn?e.fn.iFrameResize||(e.fn.iFrameResize=function(i){return this.filter("iframe").each(function(e,n){s(n,i)}).end()}):x("","Unable to bind to jQuery, it is not fully loaded.")),"function"==typeof define&&define.amd?define([],q):"object"==typeof module&&"object"==typeof module.exports&&(module.exports=q()),window.iFrameResize=window.iFrameResize||q())}();
