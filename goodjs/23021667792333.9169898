!function(s){try{s.TRC.cds={userId:null,getHttpsPrefix:function(){return"https://"},doNothing:function(){return!0},safeGetTfaConfig:function(t,e,n){return s._tfa&&s._tfa.config&&s._tfa.config.safeGet?s._tfa.config.safeGet(t,e,n):null},safeGetRboxConfig:function(t){return(TRCImpl?TRCImpl.global:{})[t]},prepareGenericRequest:function(t,e){var n=new(s.XDomainRequest||s.XMLHttpRequest);return n.open(t,e),n.onload=this.doNothing,n.onerror=this.doNothing,n.onprogress=this.doNothing,n},getUserId:function(){var t=s.TFASC&&s.TFASC.tfaUserId&&"function"==typeof s.TFASC.tfaUserId.getUserId?s.TFASC.tfaUserId.getUserId():null,e=s.TRC.pageManager&&"function"==typeof s.TRC.pageManager.getUserId?s.TRC.pageManager.getUserId():null;return t||e},sendFinalReq:function(t){var e="".concat(this.getHttpsPrefix(),"cds.taboola.com?uid=").concat(this.userId);null!==t[0]&&(e+="&uad=".concat(t[0])),this.prepareGenericRequest("GET",e).send()},sendSimpleReq:function(){var t="".concat(this.getHttpsPrefix(),"cds.taboola.com?uid=").concat(this.userId);this.prepareGenericRequest("GET",t).send()},sendUadRequest:function(){var r=this;return new Promise(function(e,t){var n;r.safeGetTfaConfig("cds:send-uad-req",!0)||r.safeGetRboxConfig("cds:send-uad")?((n=r.prepareGenericRequest("GET",s.atob("aHR0cHM6Ly9waXBzLnRhYm9vbGEuY29t"))).onreadystatechange=function(){var t;4===this.readyState&&(200===this.status?((t=n.responseText)||__trcWarn("cds: error in pips - status ".concat(this.status,", return null")),e("NULL"!==t?t:null)):(__trcWarn("cds: error in pips - status ".concat(this.status,", return null")),e(null)))},n.timeout=3e4,n.ontimeout=function(){__trcWarn("cds: error in pips - timeout"),e(null)},n.send()):e(null)})},init:function(){var e=this;s.TRC.cdsInitialized||(s.Promise&&(this.userId=this.getUserId(),this.userId&&Promise.all([this.sendUadRequest()]).then(function(t){return e.sendFinalReq(t)},function(){return e.sendSimpleReq()})),s.TRC.cdsInitialized=!0)}},s.TRC.cds.init()}catch(s){__trcError("Error running cds",s)}}(window);
