define(["OK/logger"],function(r){var d=null,a=[],n="",s=[];function o(e){for(var t=[],n=[],r=[],d=0;d<e.length;d++)"file"===e[d].kind&&t.push(e[d]);return t.forEach(function(t){(s.some(function(e){return t.type.match(e)})?n:r).push(t)}),{supported:n,unsupported:r}}function t(e){d.classList.contains("__enabled")||r.success("dnd.layer","drag_started"),e.preventDefault();var t=a.some(function(n){return function(e){var t=document.querySelector(n);if(!t)return!1;t=t.getBoundingClientRect();return t.top<=e.y&&t.bottom>=e.y&&t.left<=e.x&&t.right>=e.x}(e)}),n=e.dataTransfer&&e.dataTransfer.items,n=!OK.Layers.isAnyLayerOpened()&&!t&&(!(0<n.length)||o(n).supported.length);d.classList.toggle("__enabled",n)}function u(){r.success("dnd.layer","drag_ended"),d.classList.toggle("__enabled",!1)}function i(e){r.success("dnd.layer","dropped"),e.preventDefault(),d.classList.toggle("__enabled",!1);var e=o(e.dataTransfer&&e.dataTransfer.items),t=e.supported,e=e.unsupported;(t=t.map(function(e){return e.getAsFile()})).length&&require([n],function(e){e.performUpload(t)}),e.forEach(function(e){r.success("dnd.layer","unsupported_file_type",e.type)}),r.success("dnd.layer","uploaded")}return{activate:function(e){d=e.querySelector(".dnd-overlay"),n=d.getAttribute("data-upload-handler"),a=d.getAttribute("data-exclude-selectors").split(";"),s=d.getAttribute("data-media-types").split(";"),d&&(document.body.addEventListener("dragenter",t),d.addEventListener("dragover",t),d.addEventListener("dragleave",u),d.addEventListener("dragend",u),d.addEventListener("drop",i))},deactivate:function(){d&&(document.body.removeEventListener("dragenter",t),d.removeEventListener("dragover",t),d.removeEventListener("dragleave",u),d.removeEventListener("dragend",u),d.removeEventListener("drop",i))}}});
