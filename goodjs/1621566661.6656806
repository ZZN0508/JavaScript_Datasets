define(["OK/logger","OK/utils/utils"],(function(t,e){"use strict";var i,s="GoSearch",a=document.getElementById("hook_Cfg_CurrentUser"),r=a?OK.util.parseJSON(a.innerHTML):null;function u(a){var u,o,n,c=this.getAttribute("data-gid"),l=this.getAttribute("data-query"),d=this.getAttribute("data-state"),g=this.getAttribute("data-tip"),h="1"===this.getAttribute("data-close-layers"),f={"st.cmd":d},k=this.getAttribute("data-url");l&&(f.query=l,c&&(f["st.groupId"]=c),i&&i.xhr.abort(),i=e.ajax({url:"/",data:f}).fail((function(){t.success(s,"fail")})).done((function(t,i,s){e.updateBlockModelCallback(t,i,s),o=parseInt(s.getResponseHeader("X-ScT")||"0",10),isNaN(o)&&(o=0),window.scrollTo(0,o),k&&OK.historyManager.pushState(k),g&&OK.hookModel.setHookContent("TipBlock",""),h&&OK.Layers.unregisterAll()})),u=OK.hookModel.getNearestBlockHookId(this),t.success(s,"query",d+(u?"_"+u:"")),r&&r.uid&&(n=~~(r.uid%256/64),t.success(s,"query."+n,d+(u?"_"+u:"")),g&&t.success(s,"tip."+g+"."+n,d+(u?"_"+u:""))),a.preventDefault())}return({activate:function(t){t.addEventListener("click",u)},deactivate:function(t){t.removeEventListener("click",u)}})}));