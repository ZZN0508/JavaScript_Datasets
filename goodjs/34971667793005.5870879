!function(c){var a,s,r=[],i={DELAY:500,API_VERSION:"0.6.0",SERVER_URL:"https://event.csdn.net/"},d=["utm_source"],n={pv:i.SERVER_URL+"logstores/csdn-pc-tracking-pageview/track_ua.gif?APIVersion="+i.API_VERSION,click:i.SERVER_URL+"logstores/csdn-pc-tracking-page-click/track_ua.gif?APIVersion="+i.API_VERSION,view:i.SERVER_URL+"logstores/csdn-pc-tracking-page-exposure/track"},f={PV:"pv",VIEW:"view",DELAY_VIEW:"delay_view",CLICK:"click"},u={SKIPPED_AND_VISIBLE:"0",VISIBLE:"1"},p={guid:function(){return+new Date+"-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},setLogIdCookie:function(e){if(-1!==["pv","click","view"].indexOf(e)){var t="log_Id_"+e,o=p.getCookie(t)||0;try{"number"==typeof(o=parseInt(o))&&isNaN(o)?p.setCookie(t,1,31536e7):p.setCookie(t,++o,31536e7)}catch(e){}}},getRequest:function(){for(var e=new Object,t=(window.location.href.split("?")[1]||"").split("&"),o=0;o<t.length;o++){var r=t[o].split("=")[0],i=t[o].split("=")[1];r&&i&&(e[r]=unescape(i))}return e},initUTM:function(){s={};var e=p.getRequest();if("{}"!==JSON.stringify(e)){var t,o,r=!1;for(c in e)if(0==c.indexOf("utm_")&&e.hasOwnProperty(c)){r=!0;break}if(r){var i,n=p.getFuzzyCookie("c_utm_").split(";");for(c in n)!n.hasOwnProperty(c)||(i=n[c].split("=")[0])&&p.setCookie(i,"",-1);p.setCookie("utm_source","",-1)}for(c in e)0==c.indexOf("utm_")&&e.hasOwnProperty(c)&&p.setCookie("c_"+c,e[c],36e5);for(c in d)d.hasOwnProperty(c)&&(t=d[c],(o=e[d[c]])?(p.setCookie(t,o,36e5),s[t]=o):s[t]="")}else for(var c in d)d.hasOwnProperty(c)&&(t=d[c],o=p.getCookie(t),s[t]=o);return s},initTraceInfo:function(){for(var e=["blog","bbs","download","ask","edu","biwen"],t=0;t<e.length;t++)-1<window.location.host.indexOf(e[t]+".csdn.net")&&(p.setCookie("c_page_id","",-1),p.setCookie("c_mod","",-1))},preserveTraceInfo:function(e){e.mod&&p.setCookie("c_mod",e.mod,36e5),e.page_id?p.setCookie("c_page_id",e.page_id,36e5):p.setCookie("c_page_id","default",36e5)},getTimestamp:function(){return Math.round(new Date/1e3)},getXPath:function(e){if(""!==e.id)return'//*[@id="'+e.id+'"]';if(e==document.body)return"/html/"+e.tagName.toLowerCase();if(!e.parentNode)return"";for(var t=1,o=e.parentNode.childNodes,r=0,i=o.length;r<i;r++){var n=o[r];if(n==e)return arguments.callee(e.parentNode)+"/"+e.tagName.toLowerCase()+"["+t+"]";1==n.nodeType&&n.tagName==e.tagName&&t++}},getScreen:function(){return window.screen.width+"*"+window.screen.height},getCookie:function(e){var e=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(e=document.cookie.match(e))?unescape(e[2]):""},getFuzzyCookie:function(e){var e=new RegExp(e+"[A-Za-z0-9_]+=([^;]*);","ig");return(e=document.cookie.match(e))?e.join(""):""},checkoutUtm:function(){var e=[],t=[],o=window.location.href.split("?")[1]||"";if(o.length)for(var e=o.split("&"),r=0;r<e.length;r++)0==e[r].indexOf("utm_")&&t.push(e[r].split("=")[0]);return t},setCookie:function(e,t,o){var r=new Date;r.setTime(r.getTime()+o),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()+";path=/ ; domain=."+this.topDomain(window.location.host)},setUtmInfo:function(){},setUserSegment:function(){var e=(null!=(_ref1=/(; )?(uuid_tt_dd|_javaeye_cookie_id_)=([^;]+)/.exec(window.document.cookie))?_ref1[3]:void 0)||"",e=e?e.substring(e.length-6)%16:0;p.setCookie("c_segment",e)},setfirstPageInfo:function(){if(!(p.getCookie("c_first_ref")&&-1<p.getCookie("c_first_ref").indexOf(".csdn.net"))){var e=new RegExp(/[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?/),e=window.document.referrer?window.document.referrer.match(e)[0]:"default";return"default"!=(e=-1<e.indexOf(".csdn.net")||-1<e.indexOf("wx.tenpay.com")?"default":e)?(p.setCookie("c_first_ref",e),void p.setCookie("c_first_page",window.location.href)):p.getCookie("c_first_ref")?void 0:(p.setCookie("c_first_ref","default"),void p.setCookie("c_first_page",window.location.href))}p.setCookie("c_first_ref","default")},initData:function(){p.setfirstPageInfo(),p.initTraceInfo(),p.setUserSegment();var e,t=(null!=(o=/(; )?(uuid_tt_dd|_javaeye_cookie_id_)=([^;]+)/.exec(window.document.cookie))?o[3]:void 0)||"",o=(o=p.getCookie("dc_session_id"))||"10_"+(new Date).getTime()+"."+Math.random().toString().slice(-6);if(p.setCookie("dc_session_id",o,18e5),a={cid:t,sid:o||"",pid:window.location.host.split(".csdn.net")[0],uid:p.getCookie("UserName"),did:p.getCookie("X-Device-ID")||t||"",dc_sid:p.getCookie("dc_sid"),ref:window.document.referrer||("(null)"===p.getCookie("refer_app")?"":p.getCookie("refer_app")),curl:window.location.href,dest:"",cfg:{viewStrategy:u.VISIBLE}},t=p.initUTM(),c("meta[name=report]").attr("content")){e=JSON.parse(c("meta[name=report]").attr("content"));try{for(var r=Object.prototype.hasOwnProperty,i=["disabledViewCheck"],n=0;n<i.length;n++)r.call(e,i[n])&&delete e[i[n]]}catch(e){}}else e={};return a=c.extend({},a,{utm:t.utm_source},e),p.preserveTraceInfo(a),a},tos:function(){var e,t=+new Date/1e3|0,o=null!=(o=/\bdc_tos=([^;]*)(?:$|;)/.exec(document.cookie))?o[1]:void 0;try{e=t-parseInt(o,36)}catch(t){e=-1}return document.cookie="dc_tos="+t.toString(36)+" ; expires="+new Date(1e3*(t+14400)).toGMTString()+" ; max-age=14400 ; path=/ ; domain=."+this.topDomain(window.location.host),e},topDomain:function(e){return/\.?([a-z0-9\-]+\.[a-z0-9\-]+)(:\d+)?$/.exec(e)[1]},copyArr:function(e){for(var t=[],o=0;o<e.length;o++)t.push(e[o]);return t},isView:function(e,t){var o=this;if(!e)return!1;var r=this.getElementBottom(e),e=r+e.offsetHeight;return u.VISIBLE==t?o.scrollTop()<r&&r<o.scrollTop()+o.windowHeight()||o.scrollTop()<e&&e<o.scrollTop()+o.windowHeight():u.SKIPPED_AND_VISIBLE==t?r<=o.scrollTop()+o.windowHeight()||o.scrollTop()<r&&r<o.scrollTop()+o.windowHeight()||o.scrollTop()<e&&e<o.scrollTop()+o.windowHeight():void 0},scrollTop:function(){return Math.max(document.body.scrollTop,document.documentElement.scrollTop)},windowHeight:function(){return("CSS1Compat"==document.compatMode?document.documentElement:document.body).clientHeight},getElementTop:function(e){if("undefined"!=typeof jQuery)return c(e).offset().top;var t=e.offsetTop;for(e=e.offsetParent;null!=e;)t+=e.offsetTop,e=e.offsetParent;return t},getElementBottom:function(e){if("undefined"!=typeof jQuery)return c(e).offset().top+c(e).height();var t=e.offsetTop;for(e=e.offsetParent;null!=e;)t+=e.offsetTop,e=e.offsetParent;return t},url2Obj:function(e){var t,o={},r=e.split("&");for(t in r)o.hasOwnProperty(t)&&(o[r[t].split("=")[0]]=decodeURIComponent(r[t].split("=")[1]));return o},fixParamConTop:function(e,t){return-1<e.con.split(",top_")||(e.con=e.con+",top_"+c(t).offset().top),e},urlParamsToObj:function(e){var t={};return e.replace(/([^=&#]+)=([^&#]*)/g,function(){t[arguments[1]]=arguments[2]}),t},objToUrlParams:function(t){var o="";return c.each(t,function(e){o+="&"+e+"="+t[e]}),o.substr(1)},trackOrderSource:function(){var e=document.referrer;if(e){const n=document.createElement("a");n.href=e;var t=["passport","order.csdn.net","wx.tenpay.com","cart.csdn.net"],o=[/(^https:\/\/mall\.csdn\.net(:[0-9]{1,5})?\/cart$)/],r=!1;try{for(var i=0;i<t.length;i++)-1<n.hostname.indexOf(t[i])&&(r=!0);for(i=0;i<o.length;i++)o[i].test(e)&&(r=!0)}catch(e){r=!1}r||(-1<n.hostname.indexOf(".csdn.net")?(p.setCookie("c_pref",p.getCookie("c_ref")),p.setCookie("c_ref",e)):(p.setCookie("c_pref",p.getCookie("c_ref")),p.setCookie("c_ref",e.split("?")[0])))}}},e={timer:0,checkTimer:0,getFullSpm:function(e){if(2!==e.split(".").length)return e;var t=document.querySelector('meta[name="report"]'),t=t&&t.getAttribute("content")||"{}",t=JSON.parse(t);return t.spm?t.spm+"."+e:e},reportServer:function(e,t){void 0!==e&&void 0!==t&&r.push(t);var o=p.copyArr(r);0!=o.length&&(r=[],t={__source__:"csdn",__logs__:o},p.setLogIdCookie(f.VIEW),e!==f.VIEW&&e!==f.DELAY_VIEW||(o="PC",-1<(e=window.navigator.userAgent).toLowerCase().indexOf("csdnedu")?o="CSDNEDU":-1<e.toLowerCase().indexOf("csdnapp")?o="CSDNApp":-1<e.toLowerCase().indexOf("mobile")&&(o="mobile"),t.__tags__={useragent:e,platform:o,log_id:p.getCookie("log_Id_"+f.VIEW)}),c.ajax({url:n[f.VIEW],type:"POST",crossDomain:!0,xhrFields:{withCredentials:!1},contentType:"text/plain;charset=UTF-8",headers:{"x-log-apiversion":i.API_VERSION,"x-log-bodyrawsize":"1234"},data:JSON.stringify(t),success:function(){},error:function(){}}))},reportServerDelay:function(e,t){r.push(t);var o=this;o.timer&&clearTimeout(o.timer),o.timer=setTimeout(function(){o.reportServer(f.DELAY_VIEW)},i.DELAY)},reportView:function(e,t,o){var r,i;e&&(e.spm&&(e.spm=this.getFullSpm(e.spm)),r=c.extend(!0,{},a,e),i=p.getFuzzyCookie("c_"),r.t=p.getTimestamp()+"",r.eleTop=t?t.offset().top+"":"",delete r.cfg,i&&(r.cCookie=i),r.__time__=p.getTimestamp(),r.curl=window.location.href,void 0===o?this.reportServerDelay(f.VIEW,r):this.reportServer(f.VIEW,r),"function"==typeof csdn.afterReportView&&csdn.afterReportView(t,e))},reportClick:function(e,t){var o=c.extend(!0,{},a,e);e.spm||(o.spm=""),o.spm=this.getFullSpm(o.spm),o.t=p.getTimestamp(),o.elePath=t?p.getXPath(t[0])+"":"",o.eleTop=t?t.offset().top+"":"",o.trace&&p.preserveTraceInfo(o);t=p.getFuzzyCookie("c_");t&&(o.cCookie=t),o.curl=window.location.href,delete o.cfg,p.setLogIdCookie(f.CLICK),o.log_id=p.getCookie("log_Id_"+f.CLICK),c.ajax({url:n[f.CLICK],type:"get",crossDomain:!0,xhrFields:{withCredentials:!1},contentType:"text/plain;charset=UTF-8",data:o,success:function(){},error:function(){}})},reportPageView:function(e){var t=c.extend(!0,{},a,e);t.tos=p.tos(),t.adb=p.getCookie("c_adb")||0,t.curl=window.location.href;e=p.getFuzzyCookie("c_");e&&(t.cCookie=e),t.t=p.getTimestamp(),t.screen=p.getScreen(),t.un=p.getCookie("UN")||p.getCookie("UserName"),t.urn=p.guid(),t.vType=p.getCookie("p_uid")||"",delete t.cfg,delete t.dest,p.setLogIdCookie(f.PV),t.log_id=p.getCookie("log_Id_"+f.PV),c.ajax({url:n[f.PV],type:"get",crossDomain:!0,xhrFields:{withCredentials:!1},contentType:"text/plain;charset=UTF-8",data:t,success:function(){},error:function(){}})},viewCheck:function(){var r=this;clearTimeout(r.checkTimer),r.checkTimer=setTimeout(function(){c("[data-report-view]").each(function(){var e=c(this),t=e.data("reportView"),o=c.extend({},a,t);t.spm||(o.spm=""),o.spm=r.getFullSpm(o.spm),o.curl=window.location.href,p.isView(e.get(0),o.cfg.viewStrategy)&&(csdn.report.reportView(o,e),e.removeData("reportView"),e.removeAttr("data-report-view"))})},200)},isView:function(e){return p.isView(e)},addSpmToHref:function(e){var t,o,r=e,i=r.data("reportQuery")||"";i&&(t={},-1!==(e=o=r.attr("href")).indexOf("?")&&(e=o.split("?")[0],t=p.urlParamsToObj(o.split("?")[1])),o=p.urlParamsToObj(i),(-1<i.indexOf("spm")||-1<i.indexOf("SPM"))&&(o.spm=o.spm||o.SPM,o.spm=this.getFullSpm(o.spm)),e+="?"+p.objToUrlParams(Object.assign(t,o)),r.attr("href",e))}};void 0===window.csdn&&(window.csdn={}),csdn.report||(p.trackOrderSource(),window.csdn.report=e,(a=p.initData()).disabled||csdn.report.reportPageView(),c(function(){var r=csdn.report;c(document).on("click","[data-report-click]",function(){var e=c(this).data("reportClick");r.reportClick(e,c(this))}),r.viewCheck(c("[data-report-view]")),c(window).on("scroll",function(){r.viewCheck(c("[data-report-view]"))}),c(document).on("contextmenu","a[data-report-query]",function(){r.addSpmToHref(c(this))}),c(document).on("click","a[data-report-query]",function(){r.addSpmToHref(c(this))}),c(document).on("click","a[href]",function(){var e,t=c(this),o=t.attr("href");!/^https:\/\/|^http:\/\//gi.test(e=o)||"/"===e||-1<e.indexOf(".csdn.net")||-1<e.indexOf(".iteye.com")||r.reportClick({mod:"1583921753_001",dest:o},t)})}))}(jQuery);
