!function(e,o,t){"use strict";var n=$(),r=($(),$()),l=$(),s=0,a=0,i=$.Deferred(),c=$.Deferred(),u="photo-layer_fullScreen";function f(){try{!function(t){if(!OK.photoLayer.isActive())return void d(!1);var r=void 0===t?o.fullscreenElement||o.mozFullScreenElement||o.webkitFullscreenElement:t,l=o.body,s=(l.className||"").split(" "),a=s.indexOf(u);n.toggleClass("__disabled_adaptive2",r).toggleClass("__adaptive2",!r),r?(a<0&&(s.push(u),l.className=s.join(" "),e.OK.photoLayer.visualizePhoto()),e.OK.logger.success("photo.fs","resp_on")):(a>=0&&(s.splice(a,1),l.className=s.join(" "),e.OK.photoLayer.visualizePhoto()),e.OK.logger.success("photo.fs","resp_off"));n.scroll()}()}catch(e){OK.logger.error("photo.fs","toggle")}}function h(){OK.logger.error("photo.fs","fail")}function d(e){var t=o.documentElement,n=e?o.addEventListener:o.removeEventListener;return t.requestFullscreen?(n.call(o,"fullscreenchange",f),n.call(o,"fullscreenerror",h),!0):t.mozRequestFullScreen?(n.call(o,"mozfullscreenchange",f),n.call(o,"mozfullscreenerror",h),!0):!!t.webkitRequestFullscreen&&(n.call(o,"webkitfullscreenchange",f),n.call(o,"webkitfullscreenerror",h),!0)}function m(){o.webkitCancelFullScreen&&null==window.event||(o.fullscreenElement||o.webkitFullscreenElement||o.mozFullScreenElement||o.msFullscreenElement)&&(o.exitFullscreen?o.exitFullscreen():o.cancelFullScreen?o.cancelFullScreen():o.mozCancelFullScreen?o.mozCancelFullScreen():o.webkitCancelFullScreen&&o.webkitCancelFullScreen())}function p(e){var o=$(this),t=o.attr("data-id"),n=o.attr("data-type");t&&n&&require(["OK/DiscussionManager","jquery"],(function(e,o){e.forEachOpened(t,n,(function(){function e(e){o(this.element).animate({scrollTop:this.element.scrollTop+e},"500")}var t=this;this.element.each((function(){var o=t.scrollController;o.hasMore()?o.loadLast().done((function(){t.scrollController.scrollToBottomFancy(e)})):o.scrollToBottomFancy(e)})),this.form.focus()}))})),e.preventDefault()}var y,_,g,v=!0;e.OK.util.extend(e.OK.photoLayer,{isActive:function(){return y},init:function(t){if(g=!0,c=$.Deferred(),n=$(t),$(".photo-layer_bottom",n),r=$("#photo-layer_photo"),$(e).bind("resize.photoLayer",(function(){r.each((function(){e.OK.photoLayer.centerLayer(this,l.get(0),s,a)}))})),y||OK.loader.use("OKCustomJs",(function(){require(["OK/PhotoLayer"],(function(e){OK.Layers.register("layer_photo",(function(){OK.photoLayer.onClose(!0)}),null,!1,e.keyboardHandler),OK.Layers.onLayerShown&&OK.Layers.onLayerShown()}))})),v){n.on("click",".js-scrollToComments",p).on("click",".arw__prev, .arw__next",(function(){g=!0,e.OK.photoLayer.hideElements&&n.addClass("__no-controls")})).on("click",".js-photoLayerClose",(function(e){e.preventDefault(),OK.photoLayer.close(!0)})).on("click",(function(e){e.originalEvent.isReactEvent||OK.photoLayer.close(!0)})).on("click",".photo-layer_cnt",(function(e){e.originalEvent.isReactEvent||e.stopPropagation()})).on("mouseover",".photo-layer_right_half",(function(){$(".arw__next",n).addClass("__hover")})).on("mouseout",".photo-layer_right_half",(function(){$(".arw__next",n).removeClass("__hover")})).on("mouseover",".photo-layer_img_w .photo-layer_klass_w",(function(){var e=$(this),o=this.getBoundingClientRect();$(document).on("mousemove",(function t(n){var r=n.clientX,l=n.clientY;(r>o.right||r<o.left||l<o.top||l>o.bottom)&&($(document).off("mousemove",t),e.removeClass("__hover"))})),$(this).addClass("__hover")}));var u=$(".photo-layer_close",n);$(".modal_overlay",n).hover((function(){u.addClass("__hover")}),(function(){u.removeClass("__hover")}))}v=!1,d(!0)||_||(o.documentElement.className=(o.documentElement.className||"")+" nofs"),_=!0,y=!0,i.resolve()},close:function(e){OK.loader.use(["OKCustomJs"],(function(){OK.Layers.remove("layer_photo")})),OK.photoLayer.onClose(e)},onClose:function(o){if(!v)return e.OK.photoLayer.isLogPrematureClose&&g&&e.OK.logging.logger.success("photo","prematureClose"),g=!1,v=!0,e.OK.photoLayer.isFirst=!0,e.OK.photoLayer.minHeight=480,e.OK.photoLayer.timeDiff=void 0,r.css("min-height",""),$("#RefreshMTLayerOnClose").length>0?setTimeout((function(){require(["OK/MediaLayer"],(function(e){e.refreshLayerBody(t)}))}),50):t(),!1;function t(){n.addClass("invisible").removeClass("__active __ready"),$(".modal_overlay",n).off("hover"),n.off("click"),m(),e.OK.hookModel.setHookContent("PhotoLayerLB",""),e.OK.hookModel.setHookContent("PhotoLayerRB",""),e.OK.hookModel.setHookContent("PhotoLayerFooterRB",""),e.OK.hookModel.setHookContent("PhotoLayerPreviewRB",""),e.OK.hookModel.setHookContent("PhotoLayerRightColumnRB",""),e.OK.photoLayer.destroyFastNavigation(),$(e).off("resize.photoLayer"),!1,y=!1,e.OK.photoLayer.minHeight=520,OK.loader.use("OKCustomJs",(function(){OK.Layers.onLayerHidden&&OK.Layers.onLayerHidden(),o?OK.Layers.pop():OK.Layers.clear()}))}},onPhotoShown:function(o,t){if(o=o||!1,g=!1,e.OK.photoLayer.isRotated=!1,e.OK.photoLayer.isLogTimeDiff){var u=(new Date).getTime();if(void 0!==e.OK.photoLayer.timeDiff){var f=u-e.OK.photoLayer.timeDiff;e.OK.logging.logger.durationScalar("photo","timeDiff",f),e.OK.photoLayer.timeDiff=u}else e.OK.photoLayer.timeDiff=u}i.done((function(){var i;if(l=$("#__plpcte_target"),n.toggleClass("__unavailable",o),l&&0!=l.length?(e.OK.photoLayer.isGif=!1,s=parseInt(l.attr("data-nfs-width")),a=parseInt(l.attr("data-nfs-height"))):(e.OK.photoLayer.isGif=!0,i=$(".gif",r),l=$(".gif_video",i),s=parseInt(i.attr("data-width")),a=parseInt(i.attr("data-height"))),c.resolve(l.get(0)),e.OK.photoLayer.centerLayer(r.get(0),l.get(0),s,a),t&&c.done(t),r.toggleClass("__animated",!e.OK.photoLayer.isFirst),n.removeClass("__more"),e.OK.photoLayer.hideElements){var u=0;r.off("mousemove").on("mousemove",(function(){7==++u&&(n.removeClass("__no-controls"),r.off("mousemove"))}))}}))},footerRendered:function(){c.done((function(o){o&&requestAnimationFrame(function(){r.each((function(){e.OK.photoLayer.centerLayer(this,o,s,a+100)}))}.bind(this));var t=$(".arw_cnt.__next");OK.scrollBar.width&&t.css("max-width",parseInt(t.css("max-width"),10)-OK.scrollBar.width),n.addClass("__ready"),e.OK.photoLayer.isFirst=!1}))},toggleFullScreen:function(){var t;o.fullscreenElement||o.mozFullScreenElement||o.webkitFullscreenElement?(e.OK.logger.success("photo.fs","req_off"),m()):(e.OK.logger.success("photo.fs","req_on"),(t=o.documentElement).requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT))},exitFullScreen:function(){y&&(e.OK.logger.success("photo.fs","req_exit"),m())},visualizePhoto:function(t){var n=((o.body.className||"").split(" ")||[]).indexOf(u)>=0,r=o.getElementById("__plpcte_target");if(null!==r){var l=r.getAttribute(n?"data-fs-src":"data-nfs-src");if(null!=l&&0!=l.length){var s=n?"true":"false",a=r.fsData=r.fsData||{},i=a["data-mode-fs"];void 0===i||s!=i?(n&&(r.style.maxHeight="",r.style.maxWidth=""),a["data-mode-fs"]=s,r.src!=l&&(r.src=l),null!=t&&t.logViews&&e.OK.logger.success("photo.fs","vis_"+(n?"full":"wnd"))):e.OK.logger.success("photo.fs","vis_skip")}else e.OK.logger.error("photo.fs","no_trg_src")}},hideFullScreenButton:function(){$(".photo-layer_fullscreen_btn",n).addClass("__disabled")},toggleFullScreenButton:function(){$(".photo-layer_fullscreen_btn",n).toggleClass("__disabled",!1)}}),e.OK.photoLayer.waitForInit&&(e.OK.photoLayer.init(e.OK.photoLayer.waitForInit),e.OK.photoLayer.waitForInit=null)}(window,document);