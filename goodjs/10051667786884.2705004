define("OK/DiscussionManager",["jquery"],function(s){var o={};return{add:function(e){var t=e.getId();if(e||t){o[t]||(o[t]=[]);for(var n=0;n<o[t].length;n++)if(o[t][n]==e)return;o[t].push(e)}},remove:function(e){var t=e.getId();!e&&!t||-1<(e=o[t].indexOf(e))&&o[t].splice(e,1)},processUpdate:function(e){var t;"news"===e["tlb.act"]&&"newsFetch"===e.refId&&(t=e.respCO,e=e.respNK,t&&s.each(t,function(e,t){var n=o[e],e=t.dNCC;0<e?r(n,e):t.dntfCs&&r(n,500);for(var i=0;n&&i<n.length;i++)t.dntfECs&&s.each(t.dntfECs,function(){n[i].updateComment(this.cId),OK.logging.logger.success("discussions.processUpdate","edit")}),t.dntfRCs&&s.each(t.dntfRCs,function(){n[i].updateComment(this.cId),n[i].updateCount(-1),OK.logging.logger.success("discussions.processUpdate","remove")})}),e&&s.each(e,function(e,n){e=o[e];e&&s.each(e,function(){var t=this;s.each(n,function(){var e=t.list.findComment(this.cId);e&&e.updateKlass()})})}))},deleteComment:function(e,t,n){e=o[e];e&&s.each(e,function(){this.deleteComment(t,n)})},restoreComment:function(e){e=o[e];e&&s.each(e,function(){this.restoreComment()})},markAsRead:function(e){e=o[e];e&&s.each(e,function(){this.markAsRead()})},forEachOpened:function(e,t,n){e=o[t+"_"+e];e&&n&&s.each(e,function(){n.call(this)})}};function r(e,t){var n=e?e.length:0;if(!(n<1)){var i=e[0].refresh(t);if(i)for(var s=0;s<n;s++)e[s].processNewComments(i)}}}),define("OK/discussions/ScrollController",["jquery","OK/utils/throttle","OK/utils/utils"],function(i,e,t){function r(e){this.element.scrollTop=this.element.scrollTop+e}function n(e,t,n){e=OK.util.extend({stickyContainer:i()},e),this.element=e.scrollingContainer,this.$element=i(this.element),this.loaderId=t,this.stickyContainer=e.stickyContainer,this.scrollingFn=n||r}return n.prototype={getLoader:function(){return OK.hookModel.getHookById(this.loaderId)},hasMore:function(){return null!=this.getLoader()&&this.getLoader().hasMore()},hasLess:function(){return null!=this.getLoader()&&this.getLoader().hasLess()},scroll:function(e,t){(t||this.scrollingFn).call(this,e)},scrollToBottom:function(e,t){e?this.scroll(e.getBoundingClientRect().bottom-this.visibleBottomOfContainer(this),t):(e=this.element)&&this.scroll(e.scrollHeight,t)},scrollToTop:function(e){var t=this.element;t&&this.scroll(-t.scrollTop,e=e||r)},scrollToBottomFancy:function(e){var t=this.element;t&&this.scroll(t.scrollHeight,e)},scrollToTopOf:function(e){var t=this.element;!this.isVisible(e)&&t&&(t=t.getBoundingClientRect(),e=e.getBoundingClientRect(),this.scroll(Math.max(e.top-t.top,0)),this.trigger())},hasScroll:function(){var e=this.element;if(e)return e.scrollHeight>e.offsetHeight},isScrolledToBottom:function(e){var t=this.element;if(t)return t.scrollTop+(e=e||0)>=t.scrollHeight-t.offsetHeight},getScrollTop:function(){return this.element&&this.element.scrollTop},setScrollTop:function(e){var t=this.element;t&&(t.scrollTop=e)},scrollTo:function(e,t){t=t||0;var n=this.element;n&&this.scroll(e.getBoundingClientRect().bottom-n.getBoundingClientRect().top+t)},scrollToCenter:function(e,t){t=t||r;var n,i,s,o=this.element;o&&(s=o.getBoundingClientRect(),n=e.getBoundingClientRect(),i=s.bottom-s.top,o=s.top+i/2,e=n.bottom-n.top,s=n.top+e/2,i<e?this.scroll(n.top-o+i/3,t):this.scroll(s-o,t))},isVisible:function(e){var t=this.element;if(!e||!t)return!1;t=t.getBoundingClientRect(),e=e.getBoundingClientRect();return e.top>=t.top&&e.bottom<=this.visibleBottomOfContainer(this)},isVisibleBottomOf:function(e){return e.getBoundingClientRect().bottom<=this.visibleBottomOfContainer(this)},isVisibleBottomOfElFromTop:function(e){var t=this.element;if(t){var n=e.getBoundingClientRect(),t=t.getBoundingClientRect(),t=Math.min(n.top-t.top,0);return 0<=t||Math.abs(t)<=e.offsetHeight}},loadLast:function(){var e=this;return this.getLoader().loadLast().done(function(){e.scrollToBottom()})},loadMore:function(){var e=this;return this.getLoader().loadMore().done(function(){e.scrollToBottom()})},load:function(e){return this.getLoader()?this.getLoader().loadByUrl(e):t.ajax({url:e})},trigger:function(){this.$element.trigger("scroll")},addListener:function(e,t){return t?this.$element.on("scroll."+t,e):this.$element.on("scroll",e),this},removeListener:function(e){return this.$element.off("scroll",e),this},removeListeners:function(e){this.$element.off("scroll."+e)},makeVisible:function(e){var t=this.element;!this.isVisible(e)&&t&&(t=t.getBoundingClientRect(),e=e.getBoundingClientRect(),e=Math.min(e.top-t.top,0)+Math.max(e.bottom-this.visibleBottomOfContainer(this),0),this.scroll(e))},isScrollable:function(){var e=this.element;if(e)return e.scrollHeight>e.clientHeight},visibleBottomOfContainer:function(e){var t=e.element;if(t)return t.getBoundingClientRect().bottom-e.stickyContainer.height()},scrollTop:function(e){var t=this.element;t&&(t.scrollTop=e)}},n}),define("OK/textarea",["jquery"],function(f){var g,e={className:"autosizejs",append:"",callback:!1,onBeforeResize:f.noop,resizeDelay:10},p=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],v=f('<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>').data("autosize",!0)[0],C=f('<div tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>').data("autosize",!0);return(v.style.lineHeight="99px")===f(v).css("lineHeight")&&p.push("lineHeight"),v.style.lineHeight="",(C[0].style.lineHeight="99px")===C.css("lineHeight")&&p.push("lineHeight"),C[0].style.lineHeight="",f.fn.autosize=function(d){var m=0;try{return this.length?(d=f.extend({},e,d||{}),m=1,v&&v.parentNode!==document.body&&(f(document.body).append(v),f(document.body).append(C)),m=2,this.each(function(){var s,o,e,r=this,a=f(r),c=0,l=f.isFunction(d.callback),t={height:r.style.height,overflow:r.style.overflow,overflowY:r.style.overflowY,wordWrap:r.style.wordWrap,resize:r.style.resize},n=a.width();function u(){var n,i;m=8,"getComputedStyle"in window?(n=window.getComputedStyle(r),i=r.getBoundingClientRect().width,m=9,f.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(e,t){i-=parseInt(n[t],10)}),m=10,v.style.width=C[0].style.width=i+"px"):(m=11,v.style.width=C[0].style.width=Math.max(a.width(),0)+"px")}function i(){m=19;var e,t,n,i="true"===r.contentEditable;m=20,m=g!==r?(n={},m=12,g=r,v.className=d.className,s=parseInt(a.css("maxHeight"),10),m=13,f.each(p,function(e,t){n[t]=a.css(t)}),m=14,f(v).css(n),C.css(n),m=15,u(),window.chrome&&(m=16,t=r.style.width,m=17,r.style.width="0px",m=18,r.offsetWidth,r.style.width=t),21):(u(),22),t=parseInt(r.style.height,10),m=23,m=i?(C.html(a.html()+d.append),m=24,e=C[0],25):(v.value=r.value+d.append,m=26,e=v,27),e.style.overflowY=r.style.overflowY,m=28,e.scrollTop=0,m=29,e.scrollTop=9e4,e=e.scrollTop,m=30,s&&s<e?(r.style.overflowY="scroll",m=31,e=s,m=32):(r.style.overflowY="hidden",m=33,e<o&&(e=o)),m=35,t!==(e+=c)&&(d.onBeforeResize.call(r,e),m=36,r.style.height=e+"px",m=37,l&&(d.callback.call(r,r),m=38))}function h(){m=39,clearTimeout(e),m=40,e=setTimeout(function(){m=41;var e=a.width();m=42,e!==n&&(n=e,m=43,i())},parseInt(d.resizeDelay,10))}m=3,a.data("autosize")||(a.data("autosize",!0),m=4,"border-box"!==a.css("box-sizing")&&"border-box"!==a.css("-moz-box-sizing")&&"border-box"!==a.css("-webkit-box-sizing")||(c=a.outerHeight()-a.height()),m=5,o=Math.max(parseInt(a.css("minHeight"),10)-c||0,a.height()),m=6,a.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word",resize:"none"===a.css("resize")||"vertical"===a.css("resize")?"none":"horizontal"}),m=48,a.on("input.autosize",i),!1!==d.resizeDelay&&(m=49,f(window).on("resize.autosize",h)),a.on("autosize.resize",i),m=50,a.on("autosize.resizeIncludeStyle",function(){m=51,g=null,m=52,i()}),a.on("autosize.destroy",function(){m=53,g=null,m=54,clearTimeout(e),m=55,f(window).off("resize",h),m=56,a.off("autosize").off(".autosize").css(t).removeData("autosize")}),m=57,i())})):this}catch(e){OK.logging.logger.success("messagesLayer","e.autosize_"+m)}},f.fn.persistant=function(r){var e="localStorage"in window&&null!==window.localStorage;if(!this.length||!e)return f(this);var n=f("<div/>"),e={idKey:"data-id",afterInit:f.noop,valueGetAdapter:function(e){return e?this.html():this.val()},valueSetAdapter:function(e,t){e?this.html(n.text(t).html().replace(/\n/g,"<br>")):this.val(t)}};return r=f.extend({},e,r||{}),this.each(function(){var e,t=f(this),n="true"===this.contentEditable,i=r.valueGetAdapter.call(t,n),s=t.attr(r.idKey)||t.attr("id"),o=s?localStorage.getItem(s):null;!i&&o&&(r.valueSetAdapter.call(t,n,o),r.afterInit.call(this,o)),t.on("reset.persistant",function(){localStorage.removeItem(s)}),t.on("textchange",function(){e&&clearTimeout(e),e=setTimeout(function(){var e=r.valueGetAdapter.call(t,n);0===e.length||/^[<br>\s\t\n\r]+$/.test(e)?localStorage.removeItem(s):s&&e&&localStorage.setItem(s,e)},200)})})},{activate:function(e){f(e).autosize()}}}),define("OK/discussions/NewCommentsLabel",["jquery"],function(i){function e(e,t,n){this.discussion=t,this.form=n,this.element=e,this.$element=i(e),this.icon=i(".tico_img",this.element),this.text=i(".text",this.element),this.newCommentsMessage=null,this.comentAddedMessage=null,this.t=0}function s(e){e.removeClass("__hidden").addClass("__active")}return e.prototype={showAsNew:function(e){return this.newCommentsMessage=this.text.data("textnew"),this.refresh(e),this},show:function(e){var t=this;return this.comentAddedMessage=this.text.data("text"),this.refresh(e),this.t=setTimeout(function(){clearTimeout(t.t),t.refresh(e)},4e3),this},refresh:function(e){var t,n=this;e&&this.$element.off("click.label").one("click.label",function(){n.hide().discussion.showLatest(e)}),(this.comentAddedMessage||this.newCommentsMessage)&&this.discussion.scrollController.addListener(t=function(){n.discussion.scrollController.hasMore()||(n.hide(),n.discussion.scrollController.removeListener(t))}),this.comentAddedMessage?(this.text.html(this.comentAddedMessage),this.icon.removeClass("ic_arrow-d-w").addClass("ic_ok-w"),s(this.$element),this.comentAddedMessage=null):this.newCommentsMessage?(this.text.html(this.newCommentsMessage),this.icon.removeClass("ic_ok-w").addClass("ic_arrow-d-w"),s(this.$element),this.newCommentsMessage=null):this.hide()},hide:function(){return this.$element.addClass("__hidden").removeClass("__active"),this}},e}),define("OK/CurrentUserCfg",["require","exports","OK/GwtConfig"],function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.getInstance=t.CurrentUserCfg=void 0;var s,n=((s=n.GwtConfig)&&(o.__proto__=s),((o.prototype=Object.create(s&&s.prototype)).constructor=o).prototype.setData=function(e){s.prototype.setData.call(this,e),this.urlPattern=null},o.prototype.getUrlPattern=function(){return this.urlPattern||(this.urlPattern=new RegExp(this.data["share.urlPattern"])),this.urlPattern},o.prototype.getUserId=function(){return this.data.uid},o.prototype.getLanguage=function(){return this.data.lang},o.prototype.getBannerParameters=function(){return this.data.bannerTargeting||null},o.prototype.getReplaceFeedBannerDelayMs=function(){return this.data.replaceFeedBannerDelayMs},o.getInstance=function(){return i=i||new o},o);function o(){s.call(this,"CurrentUser")}t.CurrentUserCfg=n,t.getInstance=n.getInstance}),define("OK/LinkDetector",["OK/CurrentUserCfg"],function(u){function h(e,t){return{url:e[0],substr:t}}function e(){}return e.prototype.parse=function(c,l){return new Promise(function(e){var t=u.getInstance().getUrlPattern(),n=[];if(c&&0!==c.trim().length)for(var i=c.split(/\s+/),s=0;s<i.length;s++){var o,r=i[s],a=t.exec(r);null!=a&&a[0]===r&&(l&&" "!=(o=c.charAt(c.length-1))&&"\n"!=o&&"В "!==o||n.push(h(a,r)))}e(n)})},e}),define("OK/discussions/LinkAttachController",["jquery","OK/utils/utils","OK/AttachPicker"],function(l,u,h){var n={maxLinks:1,isSmall:!1};function e(e,t){var i;this.settings=l.extend({},n,t),this.attachPickerId=e,this.queue={},this.processed={},this.removed={},this.linksProcessed=0,this.onAttachRemoved=function(e,n,i){var s=this;l.each(s.processed,function(e,t){i=parseInt(i,10),t.type!==n||!isNaN(i)&&t.objectId!==i||("TOPIC"===n&&--s.linksProcessed,s.removed[e]=!0,delete s.processed[e])})}.bind(this),h.subscribe(e,"remove",this.onAttachRemoved),this.attachPickerId&&(e=h.getFiles((i=this).attachPickerId),l.each(e,function(e,t){var n=t.linkPreviewViewState;!n||(n=n.sourceUrl)&&d(i,n,t.type,t.id)}))}function d(e,t,n,i){e.processed[t]={type:n,objectId:parseInt(i,10)},"TOPIC"===n&&++e.linksProcessed}return e.prototype.process=function(e,t){return s=this,r=(n=t).url,a=l.Deferred(),t=s,n=n.url,c=!(t.queue[n]||(i=n,o=!1,t.processed[i]||(l.each(t.processed,function(e){o=o||0===e.indexOf(i)}),o))||t.removed[n]),a.notify(c),c&&(n=u.ajax({url:"/dk?cmd=AttachLinkPreview",data:{linkUrl:r,sm:s.settings.isSmall?"on":"off"}}),(s.queue[r]=n).done(function(e){var t,n,i=!1;e&&!(e=JSON.parse(e)).error&&s.queue[r]===this&&(t=e.id,(n=e.type)&&("TOPIC"!==n||s.linksProcessed<s.settings.maxLinks)&&(OK.logging.logger.success("discussions.linkAttached",n),h.add(s.attachPickerId,[e],!0),d(s,r,n,t),i=!0)),a.resolve(i)}),n.always(function(){delete s.queue[r]}),n.fail(function(){OK.logging.logger.success("discussions.linkPreviewFailed"),a.reject(c)}),a.fail(function(){s.processed[r]={failed:!0}})),a;var s,n,i,o,r,a,c},e.prototype.destroy=function(){h.unsubscribe(self.attachPickerId,"remove",this.onAttachRemoved)},e.prototype.reset=function(){this.queue={},this.processed={},this.removed={},this.linksProcessed=0},e.prototype.getAttachedLinks=function(){return Object.keys(this.processed)},e}),define("OK/StickerSuggester",["require","OK/utils/utils","OK/utils/dom","OK/logger"],function(e){"use strict";var i=e("OK/utils/utils"),s=(e("OK/utils/dom"),e("OK/logger")),r="propertychange.stSug change.stSug click.stSug keyup.stSug input.stSug paste.stSug",e=function(e,t){this.element=t,this.textarea=e.textarea,this.lastQuery="",this.isClearOnStickerSend="true"===t.getAttribute("data-clear-on-send");var n,i,s=this,o="true"===t.getAttribute("data-replace-images");s.textarea.on(r,function(){clearTimeout(i),i=setTimeout(function(){document.activeElement===s.textarea.get(0)?(n=e.getValue(o).trim())?s.lastQuery!=n?s.sendRequest(n):s.lastContent&&s.show():s.clear(""):s.hide()},100)})};return e.prototype={sendRequest:function(t){var n=this;i.ajax({url:"/dk?cmd=SuggestStickers",data:{"st.q":t}}).fail(function(){s.error("StickerSuggester","ajax")}).done(function(e){e?(n.lastQuery=t,n.lastContent=e,OK.hookModel.setHookContent("StickerSuggestCnt",e),n.show(),s.success("StickerSuggester","show",t)):n.clear(t)})},isEmojiMenuVisible:function(){var e=this.textarea.data("emojiarea"),e=e&&e.menu;return e&&e.visible},clear:function(e){this.hide(),this.lastQuery=e,this.lastContent=""},hide:function(){this.element.classList.remove("__active")},show:function(){this.isEmojiMenuVisible()||this.element.classList.add("__active")},destroy:function(){this.hide(),this.textarea.off(r)}},e}),define("OK/utils/scrollHelper",["jquery"],function(a){return{scrollToVisible:function(e,t){var n=a(t),i=a(e),s=i.offset().top,o=i.scrollTop(),r=i.height(),t=s+r,e=n.height(),n=n.offset().top;t<n+e?i.scrollTop(o+n+e-s-r+5):n<s&&i.scrollTop(o+n-s-5)},scrollInLoadMoreDataPosition:function(e){var t=a(e);return e.scrollHeight-t.scrollTop()-t.height()<=200},isScrollingVisible:function(e){var t=e.offsetHeight||0;return(e.scrollHeight||0)>t},scrollIntoOKViewport:function(e){var t=e.getBoundingClientRect().top+document.scrollingElement.scrollTop,e=document.getElementById("topPanel");e&&(t-=e.offsetHeight),document.scrollingElement.scrollTo(0,t)}}}),define("OK/suggest/suggestImpl",["jquery","OK/utils/scrollHelper"],function(ee,te){function ne(e,t,n){return e?t&&n&&t.type===n.type&&t.query===n.query:t===n}return function(u,h,s){var t=(h=ee.extend(h,ee.extend({selectOnReload:!1,correctSelection:!0,minSearchQueryLength:0,getMaxItemsInSuggest:function(){return 5},getMaxSelectedFriends:function(){return 5},getMarkFriendDisabledMsg:function(){return""},getSearchQuery:function(){return""},onItemsChanged:function(){},onItemClicked:function(e){},onSelectedItemChanged:function(e){},onLoadingChanged:function(e){},onSearchProgressChanged:function(e){},onSearchInputChanged:function(){}},h))).elementId,o="mm_"+t,r="mo_"+t,a="mc_"+t,c=h.selectOnReload,l=h.correctSelection,e=h.customCls||"",n=h.suggestElId||t,i=h.messageElId||t+"_msg",d=h.itemsElId||t+"_itms",m=h.loadingElId||t+"_loading";function f(e){return t+"_"+e}function g(e){return ee(document.getElementById(f(e)))}var p,v,C,y,b,k,_,S,x,w=!0,O=h.getMaxItemsInSuggest()<=0,T=!1,E=[],I=[],M=-1,L=!1;function K(){return x||(0<(x=ee("#"+n)).length?O&&(t=function(){w&&!C&&_&&te.scrollInLoadMoreDataPosition(x[0])&&Y(k)},x.scroll(function(){e&&clearTimeout(e),e=setTimeout(t,300)})):x=null,x);var e,t}function A(){var e;O&&w&&!C&&_&&((e=K())&&!te.isScrollingVisible(e[0])&&Y(k))}function R(e){var t="",n=0;E=[];for(var i=0,s=0;s<e.length;s++){var o=e[s],r=u.getItemById(o);if(r){if(!O&&(I[o]||i++,i>h.getMaxItemsInSuggest()))break;var a=j(o,n++,r),r=document.createElement("div");r.appendChild(a),t+=r.innerHTML,E.push(o)}}O&&((c=document.createElement("div")).appendChild(H()),t+=c.innerHTML);var c=ee("#"+d);h.mention&&c.html()===t||c.html(t)}function H(){var e=document.createElement("li");return e.className="suggest_li "+(C?"":" invisible"),h.disableLoadingProgress||(e.innerHTML='<div id="'+m+'" class="loader-controls in-progress"><div class="link-show-more_loading"><span class="fetching-hor">***</span></div></div>'),e}function j(e,t,n){n.visible=!I[e];var i=document.createElement("li");return i.className="suggest_li"+(n.visible?"":" invisible"),i.innerHTML=s.createItemElement(n),i.setAttribute("id",f(e)),i.setAttribute("onmousemove","OK.il.f(event,'"+o+"', "+t+");"),i.setAttribute("onmouseover","OK.il.f(event,'"+r+"', "+t+");"),i.setAttribute("onclick","OK.il.f(event,'"+a+"', "+t+");"),i}function P(e){return 0!==g(e).length&&(t=!I[e],0!==(e=g(e)).length&&e.toggleClass("invisible",!t),1);var t}function B(e,t){var n=u.getItemById(e),e=g(e);s.setItemSelected(n,e,t)}function D(e){return I[E[e]]}function N(e){return!D(e)&&(e=E[e],!u.getItemById(e).disabled)}var F={id:o,handlerId:"h"+this.id,handle:function(e,t){p||(L=!1)}},q={id:r,handlerId:"h"+this.id,handle:function(e,t){p||v||0<=t&&t<E.length&&M!==t&&N(t)&&(L=!1,z(t))}},V={id:a,handlerId:"h"+this.id,handle:function(e,t){if(!p&&0<=t&&t<E.length&&N(t)){L=!1,z(t);for(var n,i=e.target;null!=i&&!i.getAttribute("id")&&!(n=i.getAttribute("data-action"));)i=i.parentNode;h.onItemClicked(u.getItemById(E[t]),n)}}};function U(e,t){if(0!==E.length)if(l){if(c&&e&&-1!=e){for(var n=0;n<E.length;n++)if(e==E[n])return N(n)&&z(n),0}else if(-1!==M){if(D(M)){for(var i=M+1;i<E.length;i++)if(N(i))return z(i),0;for(var s=M-1;0<=s;s--)if(N(s))return z(s),0;z(-1)}}else for(n=0;n<E.length;n++)if(N(n)){z(n);break}}else t||z(-1);else-1!==M&&z(-1)}function z(e){var t,n=M!==(e="string"==typeof e?+e:e);if(0<=M&&M<E.length){var i=E[M];if(i){if(!n)return void B(i,!p);B(i,!1)}}M=-1,0<=e&&e<E.length&&(t=E[e])&&N(e)&&(B(t,!p),M=e,h.onSelectedItemChanged(u.getItemById(t)),n&&W())}function W(){if(O&&L){if(0<=M&&M<E.length)e=M;else{if(-1!=M)return;e=0}var e,t=E[e];!t||0<(e=g(t)).length&&(t=K(),te.scrollToVisible(t[0],e[0]))}}OK.il.ah(F),OK.il.ah(q),OK.il.ah(V);var $=1,Q=function(e,t){var n,i=(S=e).query;e.type&&(i={query:i,type:e.type});var s=e.itemIds,o=e.hasMore,o=ne(e.type,i,k)?(function(e,t){var n;K(),_=t;var i,s=E.length,o=ee("#"+d),r=function(){for(var e=0,t=0;t<E.length;t++)I[E[t]]||e++;return e}();O&&(i=ee("#"+m));for(var a=0;a<e.length;a++){var c=e[a],l=u.getItemById(c);if(l){if(!O&&(I[c]||r++,r>h.getMaxItemsInSuggest()))break;l=j(c,s++,l);O&&i&&(i.parent().remove(),i=null),o.append(l),E.push(c),n=!0}}O&&n&&o.append(H()),U(null,!0),W(),n&&h.onItemsChanged()}(t,o),2):ne(e.type,i,h.getSearchQuery())||!e.type&&i.toString()==h.getSearchQuery().toString()?function(e,t,n){var i=0<=M&&M<E.length?E[M]:-1;if(K(),k=e,_=n,E.length==t.length||!O&&E.length>=h.getMaxItemsInSuggest()&&t.length>=h.getMaxItemsInSuggest()){if(0===t.length&&0===E.length)return;for(var s,o={},r=0,a=0;a<t.length&&(o[t[a]]=!0,O||(I[t[a]]||r++,!(r>=h.getMaxItemsInSuggest())));a++);var c=0;for(a=0;a<E.length;a++){if(!o[E[a]]){s=!0;break}if(!O&&(I[E[a]]||c++,c>=h.getMaxItemsInSuggest()))break}if(a=null,!(s=!O&&(c!=r||c>=h.getMaxItemsInSuggest())?!0:s))return}M=-1,L=!0;n=0<E.length&&0===t.length;return R(t),n=n||0<E.length,U(i,!1),W(),n&&h.onItemsChanged(),n}(i,s,o)?3:4:(n=!0,5);X(!1,!0,i,o,e),n||A()},G=function(e,t){b=e,X(!1,!1,t,-1)};function Y(e){var t;X(!0,!0,e,$),e=e||h.getSearchQuery(),t=0<h.getMaxItemsInSuggest()?h.getMaxItemsInSuggest()+h.getMaxSelectedFriends():0,u.search(e,t,Q,G)}function J(){var e=k;k=null,Y(e)}function X(e,t,n,i,s){C!=e&&(C=e,Z(),!O||h.disableLoadingProgress||0!=(e=ee("#"+m)).length&&(e.toggleClass("invisible",!C),C&&K()),h.onLoadingChanged(C,t,n,i,s))}function Z(){var e=ee("#"+n);e.toggleClass("__active",w),e.toggleClass("__disabled",p||C),e.toggleClass("__message",T)}return{createHtml:function(){return'<div id="'+n+'" class="suggest'+(w?" __active":"")+(O?" __scroll":"")+(p||C?" __disabled":"")+(e?" "+e:"")+(T?" __message":"")+'"><div id="'+i+'" class="suggest_tx">'+(y||"")+'</div><ul id="'+d+'" class="suggest_ul"></ul></div>'},resetSelection:function(){var e=K();if(e){e.scrollTop(0);for(var t=0;t<E.length;t++)if(N(t)){z(t);break}}},isVisible:function(){return!!w},setVisible:function(e){w!=e&&(w=e,Z())},setDisabled:function(e){p!=e&&(p=e,Z())},setMouseOverDisabled:function(e){v!=e&&(v=e)},isMessageVisible:function(){return!!T},setMessageVisible:function(e){T!=e&&(T=e,Z())},setMessage:function(e){y!=(e=e)&&(y=e,ee("#"+i).html(y))},search:function(e){Y(e||h.getSearchQuery())},isSearchDisabled:function(){return!!b},getDisplayQuery:function(){return k},hasVisibleItems:function(){for(var e=0;e<E.length;e++)if(!I[E[e]])return!0;return!1},hasHiddenItems:function(){for(var e=0;e<E.length;e++)if(I[E[e]])return!0;return!1},setHiddenItemId:function(e,t){t!=I[e]&&(I[e]=t,P(e)&&(O?(U(),h.onItemsChanged(),t&&A()):J()))},resetHiddenItemIds:function(e){var t,n=I;I=e=e||{};for(var i=0;i<E.length;i++){var s=E[i];(I[s]&&!n[s]||!I[s]&&n[s])&&P(s)&&(t=!0)}t&&(O?(U(),h.onItemsChanged(),A()):J())},resetItems:function(e,t){R(e||E),_selectedItemId=-1,void 0!==t&&(k=t)},getItemElId:f,selectPrevious:function(){if(0!==E.length&&-1!==M)for(var e=M-1;0<=e;e--)if(N(e)){L=!0,z(e);break}},selectNext:function(){if(0!==E.length)for(var e=M+1;e<E.length;e++)if(N(e)){L=!0,z(e);break}},selectItemById:function(e){for(var t=0;t<E.length;t++)if(E[t]==e){N(t)&&(L=!0,z(t));break}},getSelectedItem:function(){return 0<=M&&M<E.length?u.getItemById(E[M]):null},getSearchEntry:function(e){return e?u.getSearchEntry(e):S},SEARCH_RESULT_ERROR:-1,SEARCH_RESULT_LOADING:$,SEARCH_RESULT_APPEND_ITEMS:2,SEARCH_RESULT_SET_ITEMS:3,SEARCH_RESULT_SET_ITEMS_CACHED:4,SEARCH_RESULT_UNKNOWN:5,destroy:function(){OK.il.rh(F),OK.il.rh(q),OK.il.rh(V),u.clearCaches(),h=null}}}}),define("OK/suggest/searchEngines",["jquery","OK/utils/utils","OK/utils/vanilla"],function(i,a,c){"use strict";function e(e,t,n,i){return s("/dk?cmd="+e,t,n,i)}function r(e){var t=e.address;e.distance&&(0<t.length?t+=" ("+e.distance+")":t=e.distance),e.latitude=parseFloat(e.latitude),e.longitude=parseFloat(e.longitude),e.text=c.encodeHtml(e.name),e.smallText=e.categoryName,e.smallText2=c.encodeHtml(t)}function n(e){for(var t=0;t<e.length;t++){var n=e[t];n.imageSrc=n.photo,n.text=c.encodeHtml(n.name),n.ui=""+n.id,n.ul=0+n.id,n.uf=c.encodeHtml(n.name),n.mkto=!0}}function l(e,t){e.id=e.ui,e.imageSrc=OK.userCache.getLinkOnUserAvatar(e),e.text=e.uf,t||e.mkto||(e.disabled=!0)}function s(n,i,e,t){function s(e){return e&&e.type}function o(e){var t=s(e);return t?e.query+t:e}function r(e,t){return"function"==typeof e?r(e(t),t):e}var g={},p={},v={endpoint:n,dataType:i,search:function(l,e,u,h){var t;g[o(l)]||(g[o(l)]={query:s(t=l)?t.query:t,type:s(l),index:0,itemIds:[],hasMore:!0,requestId:""});var d=g[o(l)];if(!d.hasMore||e&&d.itemIds.length>=e)return u(d,[]),d;var m="search-d-"+(new Date).getTime();d.requestId=m;e={"gwt.requested":window.pageCtx.gwtHash,refId:d.requestId};if(!1!==v.prepareRequest(l,d,e)){var f=r(i,d);return a.ajax({type:"POST",url:r(n,d),data:e,dataType:f,timeout:1e4}).done(function(e,t,n){var i,n=n.getResponseHeader("TKN");if(n&&OK.tkn.set(n),d.requestId===m&&0!==g.length){"html"===f?i=OK.util.parseJSON(e):"json"===f&&(i=e);var s=v.processResponse(i,d);if(s){for(var o=[],r=0;r<s.length;r++){var a=s[r],c=a.id;d.itemIds.push(c),o.push(c),p[c]=a}u(d,o)}else h(!0,l)}else h(!1,l)}).fail(function(e,t,n){h(!1,l)}),d}},prepareRequest:e,processResponse:t,clearCaches:function(){g={},p={}},getItemById:function(e){return p[e]},getSearchEntry:function(e){return g[o(e)]}};return v}function t(i){var o={},e=s("/web-api/suggest/locations/profile","json",function(e,t,n){n.q=t.query,i&&(n.cid=i.value)},function(e,t){t.hasMore=!1;for(var n=e||[],i=0;i<n.length;i++){var s=n[i];s.id=s.cityId,s.text=s.city,s.smallText=s.regions?s.regions+", "+s.country:s.country,s.city&&(o[s.city.trim().toLowerCase()]=s)}return n});return e.locationByCityCache=o,e}function o(a){return e("FriendsSearch","html",function(e,t,n){i.extend(n,{"d.sq":t.query,"d.o":t.index,"d.d":"d.in"})},function(e,t){if(!1===e.searchEnabled)return null;var n=e["jsp.cc"],i=e["jsp.stc"]||0;t.index=t.index+n,t.hasMore=t.index<i,t.totalCount=i;var s=[],o=e["jsp.sr"]||[],e=e["jsp.sl"]||[];if(e.length&&e.forEach(function(e){o[e.ui]=e}),a||OK.userCache.updateUserCache(o),e.length)e.forEach(function(e){l(e,a),s.push(e)});else for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l(r=o[r],a),s.push(r));return s})}var u,h=s("/web-api/suggest/hashtags/search","json",function(e,t,n){n.query=t.query},function(e,t){t.hasMore=!1;for(var n=e||[],i=0;i<n.length;i++){var s=n[i];s.hashTag=!0,s.id="#"+s.text}return n}),d=e("FriendsSearch","html",function(e,t,n){i.extend(n,{"d.sq":t.query,"d.o":t.index,"d.d":"d.in","d.wg":"on"})},function(e,t){if(!1===e.searchEnabled)return null;var n=e["jsp.cc"],i=e["jsp.stc"]||0;t.index=t.index+n,t.hasMore=t.index<i,t.totalCount=i;var s,o=[],r=e["jsp.sr"]||[],e=e["jsp.sl"]||[],a={};if(e.length)e.forEach(function(e){a[e.ui]=e});else for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&((s=r[c]).group||(a[c]=s));function l(e,t){var n;e.id=e.ul,e.group?(n=e.photo)&&(e.imageSrc=n):e.imageSrc=OK.userCache.getLinkOnUserAvatar(e),e.text=e.uf,e.mkto||(e.disabled=!0),t.push(e)}if(OK.userCache.updateUserCache(a),e.length)e.forEach(function(e){l(e,o)});else for(c in r)Object.prototype.hasOwnProperty.call(r,c)&&l(r[c],o);return o});return{createSearchEngine:e,createYandexSearchEngineEndpoint:function(e,t){var n={},u={},h={search:function(r,e,a,c){n[r]||(n[r]={query:r,index:0,itemIds:[],requestId:""});var l=n[r];if(l.itemIds.length)return a(l,[]),l;l.requestId="search-d-"+(new Date).getTime();var t={refId:l.requestId};return!1!==h.prepareRequest(r,l,t)?(require(["OK/YandexMapsApi"],function(e){e.then(function(e){e.suggest(t.request,t.options).then(function(e){var t=h.processResponse(e,l);if(t){for(var n=[],i=0;i<t.length;i++){var s=t[i],o=s.id;l.itemIds.push(o),n.push(o),u[o]=s}a(l,n)}else c(!0,r)},function(){c(!0,r)})})}),l):void 0},prepareRequest:e,processResponse:t,clearCaches:function(){n={},u={}},getItemById:function(e){return u[e]},getSearchEntry:function(e){return n[e]}};return h},locationsSearchEngine:t(),createLocationsSearchEngine:t,friendsSearchEngine:o(),allFriendsSearchEngine:o(!0),prepareUsersForRenderer:function(e){for(var t=0;t<e.length;t++)l(e[t])},hashtagsEngine:h,mentionsEngine:d,postingFormEngine:(u=function(e){return"hash"===e.type?h:d},s(function(e){return u(e).endpoint},function(e){return u(e).dataType},function(e,t,n){return u(e).prepareRequest(e.query,t,n)},function(e,t){return u(t).processResponse(e,t)})),conversationsSearchEngine:e("ConversationsSearch","html",function(e,t,n){i.extend(n,{"st.query":t.query,"st.count":t.index}),t.forwardMarker&&i.extend(n,{"st.lastelem":t.forwardMarker})},function(e,t){var n=e["jsp.cc"];t.hasMore=e["jsp.hm"],t.index=t.index+n,t.forwardMarker=e["jsp.fwd"];for(var i=[],s=e["jsp.ch"],o=0;o<s.length;++o){var r=s[o];r.disabled=!1,r.mkto=!0,r.uf=r.text,r.ui=r.id,r.ul=r.id,i.push(r)}return i}),placesSearchEngine:e("PostingFormPlacesSearch","json",function(e,t,n){n["d.sq"]=e.query,n["d.o"]=t.index,n["ps.pin"]=e.pin,e.coords&&(n["ps.lt"]=e.coords[0],n["ps.lng"]=e.coords[1])},function(e,t){if(!1===e.searchEnabled)return null;var n=e["jsp.scc"]||0,i=e["jsp.sr"]||[],s=Math.min(e["jsp.stc"]||0,200);t.index=t.index+n,t.hasMore=t.index<s,t.totalCount=s,t.realTotalCount=e["jsp.str"]||0;for(var o=0;o<i.length;o++)r(i[o]);return i}),preparePlaceForRenderer:r,groupsSearchEngine:e("SearchCrossPostingGroups","json",function(e,t,n){n["d.sq"]=t.query,n["d.o"]=t.index},function(e,t){if(!1===e.searchEnabled)return null;var n=e["jsp.cc"]||0,i=e["jsp.stc"]||0;t.index=t.index+n,t.hasMore=t.index<i,t.totalCount=i;for(var s=e["jsp.sr"]||[],o=0;o<s.length;o++){var r=s[o];r.imageSrc=r.photo,r.text=c.encodeHtml(r.name)}return s}),userGroupsSearchEngine:s("/web-api/suggest/groups/portal","json",function(e,t,n){n.q=t.query},function(e,t){t.hasMore=!1;for(var n=e||[],i=0;i<n.length;i++){var s=n[i];s.text=c.encodeHtml(s.name)}return n}),prepareAdvertSelectionForRenderer:n,advertCatalogSearchEngine:function(i){return e("AdvertCatalogsSearch","json",function(e,t,n){n["d.sq"]=t.query,n["d.fwd"]=t.forwardMarker,n["d.gr"]=i},function(e,t){if(!1===e.searchEnabled)return null;t.totalCount=e["jsp.stc"]||0,t.hasMore=e["jsp.hm"],t.forwardMarker=e["jsp.fwd"];e=e["jsp.sr"]||[];return n(e),e})},commentMentionsEngine:function(i,s){return e("ParticipantsSearch","html",function(e,t,n){n["st.query"]=t.query,n["st.did"]=i(),s&&(n["st.wg"]="on")},function(e,t){if(!1===e.searchEnabled)return null;var n=e["jsp.cc"],i=e["jsp.stc"]||0;t.index=t.index+n,t.hasMore=t.index<i,t.totalCount=i;var s,o,r,a=[],c=e["jsp.sr"]||{},l={};for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&((o=c[s]).group||(l[s]=o));for(s in OK.userCache.updateUserCache(l),c)Object.prototype.hasOwnProperty.call(c,s)&&((o=c[s]).group?(o.id=o.ui,(r=o.photo)&&(o.imageSrc=r)):(o.id=s,o.imageSrc=OK.userCache.getLinkOnUserAvatar(o)),o.text=o.uf,o.mkto||(o.disabled=!0),a.push(o));return a})}}}),define("OK/suggest/renderers",[],function(){function e(e){return this.options=e,this}function t(e){return this.options=e,this}function n(e){return this.options=e,this}return e.prototype.createItemElement=function(e){return'<div class="ucard-mini'+(e.hashTag?" __hash-tag":"")+(e.selected?" __selected":"")+(e.disabled?" __na":"")+'">'+(e.imageSrc?'<img class="ucard-mini_img" src="'+e.imageSrc+'" alt="Image" width="32" height="32">':e.stub?'<div class="ucard-mini_img '+e.stub+'"></div>':"")+'<div class="ucard-mini_cnt"><div class="ucard-mini_cnt_i ellip">'+(e.text||"")+"</div>"+(e.smallText?'<div class="ucard-mini_info">'+e.smallText+"</div>":"")+"</div></div>"},e.prototype.setItemSelected=function(e,t,n){t.find(".ucard-mini").toggleClass("__selected",n)},t.prototype.createItemElement=function(e){return'<div class="ucard-mini'+(e.selected?" __selected":"")+(e.disabled?" __na":"")+'">'+e.image+'<div class="ucard-mini_cnt"><div class="ucard-mini_cnt_i ellip">'+(e.text||"")+"</div>"+(e.smallText?'<div class="ucard-mini_info">'+e.smallText+"</div>":"")+"</div></div>"},t.prototype.setItemSelected=function(e,t,n){t.find(".ucard-mini").toggleClass("__selected",n)},n.prototype.createItemElement=function(e){return'<div class="ucard-v __xxs __h'+(e.selected?" __selected":"")+(e.disabled?" __na":"")+'">'+(e.imageSrc?'<div class="section"><div class="photo"><img class="photo_img" src="'+e.imageSrc+'" alt="Image" width="32" height="32"></div></div>':"")+'<div class="caption"><div class="ellip">'+(e.text||"")+"</div>"+(e.smallText?'<div class="info ellip">'+e.smallText+"</div>":"")+"</div></div>"},n.prototype.setItemSelected=function(e,t,n){t.find(".ucard-v").toggleClass("__selected",n)},{MiniCard:e,UCard:n,ConversationCard:t}}),define("OK/postingForm/mentions",["jquery","OK/suggest/suggestImpl","OK/suggest/searchEngines","OK/suggest/renderers","OK/logger"],function(_,a,c,l,S){var x="mediatopic.m",w="pform_name",O="__active",s="data-name",r=_("<span class='"+w+" o'></span>").get(0),T=_("<span class='"+w+" al' data-hash-tag='true'></span>").get(0),E=new RegExp("[W#$%!^&*()_+'']");function t(e){var n={ELEMENT_NODE:1,TEXT_NODE:3};function i(e){return e.nodeType==n.TEXT_NODE}function s(e,t){return e.nodeType==n.ELEMENT_NODE&&e.tagName.toUpperCase()==t}function o(e){return i(e)||s(e,"BR")||function(e){if(s(e,"SPAN")){var t=_(e);if(!t.contents().is(function(){return!i(this)}))return e.className==w+" o"&&(t.removeAttr("style"),!0)}return!1}(e)}for(;;){var t=e.contents().not(function(){return o(this)||((n=s(t=e=this,"DIV"))&&((t=_(t)).removeAttr("style"),t.removeAttr("class")),n&&!_(e).contents().is(function(){return!o(this)}));var e,t,n});if(0==t.length)break;t.filter(function(){return this.nodeType!=n.ELEMENT_NODE}).remove().end().filter(function(){return this.nodeType==n.ELEMENT_NODE}).replaceWith(function(){var e=_(this).contents();return"DIV"==this.tagName.toUpperCase()||"P"==this.tagName.toUpperCase()?e.filter(function(){return o(this)}).wrap("<div></div>").end():e})}}function I(e){return e&&"true"===e.getAttribute("data-hash-tag")}function M(l,e){var u,h=/#[^\s#\\.]+/,t=l.selector.getRange(),d=t.startContainer,m=t.startOffset,f=!1;e.find("span").filter(function(){return!this.className}).replaceWith(function(){return f=!0,d===this&&(d=this.firstChild),this.childNodes}),e.find("span").filter(function(){if(I(this)){var e=this.innerText,t=h.exec(e);if(!t||t[0].length!==e.length)return!0;if(l.util.isText(this.nextSibling)&&0<this.nextSibling.nodeValue.length&&!/\s/.test(this.nextSibling.nodeValue[0]))return!0}return!1}).replaceWith(function(){return f=!0,d===this&&(d=this.firstChild),this.childNodes}),e.children().each(function(e,t){for(u=0;function(e){for(;u<e.childNodes.length;){if(l.util.isText(e.childNodes[u]))return 1;u++}}(t);){var n=function(e){for(var t;u<e.childNodes.length;){var n=e.childNodes[u];if(!l.util.isText(n))break;t?(t===d?f=!0:n===d&&(f=!0,m=(d=t).nodeValue.length+m),t.nodeValue+=n.nodeValue,n.parentNode.removeChild(n),u--):t=n,u++}return t}(t);if(n){for(var i=d===n,s=n.nodeValue;s;)var o,r,a,c=h.exec(s),s=c&&0<c[0].length?(o=o||document.createElement("DIV"),a=c[0],0<(c=c.index)&&(r=document.createTextNode(s.substring(0,c)),i&&(m<c?(d=r,f=!(i=!1)):m-=c),o.appendChild(r)),(r=_(T.cloneNode(!1))).text(a),o.appendChild(r[0]),i&&(m<=a.length?(d=r[0].firstChild,f=!(i=!1)):m-=a.length),s.substring(c+a.length)):(o&&(a=document.createTextNode(s),i&&(d=a,f=!(i=!1)),o.appendChild(a)),!1);if(o){for(;o.firstChild;)n.parentNode.insertBefore(o.firstChild,n),u++;n.parentNode.removeChild(n),u--}}}}),f&&((t=document.createRange()).setStart(d,m),l.selector.addRange(t))}return function(e){var k={bindStep:0,getDebugStep:function(){return bindStep},suggestCtx:{onItemClicked:_.noop,onLoadingChanged:_.noop,getMaxSelectedFriends:function(){return 1},onItemsChanged:_.noop,onSelectedItemChanged:_.noop,getMaxItemsInSuggest:function(){return 5},getMarkFriendDisabledMsg:function(){return k.markDisabledMsg},elementId:e||"_mPF",mention:!0,customCls:""},suggest:null,suggestElement:null,suggestElementVisible:!1,mentionsCharStart:3,mentionsFirstCharUpperCase:!0,cleanupOnPaste:!0,redesign:!1,customCls:"__mentions",searchTimer:!1,searchTimerDelay:0,scMenuWidth:"300px",useText:!1,util:function(){S.error("mt.e","util")},selector:function(){S.error("mt.e","selector")},init:function(e,t,n,i,s,o){var r;bindStep=1,k.markDisabledMsg=e,k.util=t,k.selector=n,bindStep=2,document.getElementById(k.suggestCtx.elementId)||(bindStep=3,(n=new(r=l.MiniCard)).createItemElement=function(e){return e.group?e.smallText=e.gi:e.hashTag?e.smallText=e.count:e.smallText=e.disabled?k.markDisabledMsg:"",r.prototype.createItemElement(e)},bindStep=4,s=s||(o?c.postingFormEngine:i?c.mentionsEngine:c.friendsSearchEngine),k.suggest=a(s,k.suggestCtx,n),bindStep=5,n="sc-menu "+k.customCls,i&&(k.redesign=!0,k.searchTimerDelay=300,n+=" __redesign"),k.withHashTags=o,_(document.body).append('<div id="'+k.suggestCtx.elementId+'" class="'+n+'">'+k.suggest.createHtml()+'<div class="sc-menu_arw_w"><div class="sc-menu_arw"></div></div></div>'),bindStep=6,k.suggestElement=_("#"+k.suggestCtx.elementId).css({width:k.scMenuWidth}),k.suggestElementVisible=!0,bindStep=7)},destroy:function(){k.suggest&&k.suggest.destroy(),k.suggest=null,_("#"+k.suggestCtx.elementId).remove()},bind:function(h){var o,d=!1,m=_(h);bindStep=8;var e,f=m.parent().find(".pform_name-bg");if(bindStep=9,0===f.length&&(f=_('<span class="pform_name-bg"></span>')).insertBefore(m),bindStep=10,b(),bindStep=11,k.selector.supportsRange())return bindStep=12,k.util.isFireFox||m.on("focusout.mentions",function(){e=k.selector.getRange()}),m.on("keydown.mentions",function(e){13!==e.which&&9!==e.which&&27!==e.which&&38!==e.which&&40!==e.which||!k.suggestElementVisible||(e.preventDefault(),9===e.which&&e.stopPropagation(),27===e.which&&(e.stopPropagation(),b()))}).on("keyup.mentions",function(a){var t,n,c;k.suggestCtx.onItemClicked=_.noop,k.suggestCtx.getSearchQuery=function(){var e=t||"";return e=n?{query:e,type:n}:e},k.suggestCtx.onLoadingChanged=function(e){var t,n,i,s,o,r;!e&&k.suggest.hasVisibleItems()&&(n=a,(t=c)?(k.redesign?(o=(i=m.offset().left)+(s=m.width())+22>t.left+300,r=_(window).scrollTop(),e=t.bottom+r,o?k.suggestElement.css({left:t.left-10,top:e}):k.suggestElement.css({left:i+s+20-300,top:e}),window.innerHeight+r<e+(r=k.suggestElement.outerHeight(!0))&&k.suggestElement.css({top:e-t.height-r})):k.suggestElement.css({left:t.left-140,top:t.bottom+_(window).scrollTop()}),k.suggestElement.removeClass("sc-menu__hidden"),k.suggestElementVisible=!0,r=f.parent().get(0).getBoundingClientRect(),f.css({top:t.top-r.top-2,left:t.left-r.left,width:t.width,height:t.height}),f.toggleClass(O,!0),38==n.which?k.suggest&&k.suggest.selectPrevious():40==n.which&&k.suggest&&k.suggest.selectNext(),S.success(x,"show_menu")):b()),k.suggest.hasVisibleItems()||b()};var e,i,s,o,r,l=k.selector.getRange(),u=k.util.getSelectedNode(l,l.startContainer,l.startOffset,!0);k.util.isSpace(a.which)&&k.util.isSpan(u.parentNode)&&_(u.parentNode).hasClass(w)&&!I(u.parentNode)&&u.parentNode.lastChild===u&&k.util.isText(u)&&u.nodeValue.length===l.startOffset&&(y(u.parentNode,l),a.preventDefault()),(t=p(u,l,a,d))&&(t.length>=(0<k.mentionsCharStart?k.mentionsCharStart:3)&&(!k.mentionsFirstCharUpperCase||k.mentionsFirstCharUpperCase&&t[0].toUpperCase()===t[0]&&!E.test(t[0]))||"@"===t[0]||"+"===t[0]||k.withHashTags&&"#"===t[0])&&(s=!1,(i=v(u,l))&&(13===a.which||9===a.which?(d=!1,C(i,l)):(c=i.getBoundingClientRect(),S.success(x,"search"),k.withHashTags&&(n="#"===t[0]?"hash":"mention"),("@"===t[0]||"+"===t[0]||k.withHashTags&&"#"===t[0])&&(S.success(x,"trigger"),t=t.substr(1),d=k.redesign),e=n?{query:t,type:n}:t,k.searchTimer&&clearTimeout(k.searchTimer),!k.redesign||"@"===t[0]||"+"===t[0]||k.withHashTags&&"#"===t[0]||0==k.searchTimerDelay||k.suggestElementVisible?(k.searchTimer=!1,k.suggest.search(e)):k.searchTimer=setTimeout(function(){k.suggest.search(e)},k.searchTimerDelay),s=!0,k.suggestCtx.onItemClicked=function(){k.util.isInEditor(i.startContainer)&&(C(i,l),b())}))),c&&k.suggest.hasVisibleItems()||b(),k.util.normalizeFont(),o=l,r=!0,8===a.which&&k.util.isFireFox&&(o=k.selector.getFocusElement(o),_(o).hasClass(w)&&(_(o.childNodes).each(function(e,t){k.util.isText(t)&&0<t.nodeValue.length&&(r=!1)}),r&&0===h.innerHTML.indexOf(o.outerHTML)&&(_(o).replaceWith(document.createTextNode(String.fromCharCode(160))),m.focus()))),k.withHashTags&&(M(k,m),s&&(l=k.selector.getRange(),p(u=k.util.getSelectedNode(l,l.startContainer,l.startOffset,!0),l,a,d)&&(i=v(u,l)))),g()}).on("paste.mentions",function(){setTimeout(function(){k.cleanupOnPaste&&(k.util.cleanWordComments(m),t(m)),k.withHashTags&&M(k,m),g()},50)}).on("click.mentions",function(){m.focus(),g()}),bindStep=14,{unbind:function(){m.off(".mentions"),f.remove(),k.searchTimer&&clearTimeout(k.searchTimer),k.searchTimer=!1},getFocus:function(){return e},restoreFocus:function(){m.focus(),e&&k.selector.addRange(e)},hide:b,log:function(){m.find("span."+w).each(function(e,t){var n=_(this).attr(s);n&&this.innerHTML!==n&&S.success(x,"mention_changed")})}};function g(){k.util.isFireFox&&(e=k.selector.getRange())}function p(e,t,n,i){if(27===n.which)return null;t=t.startOffset;if(t<=0||!k.util.isText(e)||e.nodeValue.length<=0||!i&&k.util.isSpace(n.which))return null;n=_(e).parents("."+w);if(!(0===n.length||k.withHashTags&&I(n[0])))return null;var s=e.nodeValue,e=s[t-1];if(!i&&k.util.isSpace(e))return null;if(i)for(o=t-1;0<=o&&!("+"===s[o]||"@"===s[o]||k.withHashTags&&"#"===s[o]);--o);else for(o=t-1;0<=o;--o)if(k.util.isSpace(s.charCodeAt(o))){o+=1;break}return o<0&&(o+=1),s.substring(o,t)}function v(e,t){var n;return k.util.isText(e)&&0<=o?((n=document.createRange()).setStart(e,o),n.setEnd(e,t.startOffset),n):null}function C(e,t){var n,i=k.suggest&&k.suggest.getSelectedItem();e&&i&&!i.disabled&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(e),n=(i.hashTag?T:r).cloneNode(!1),e.surroundContents(n),e=_(n),i.hashTag?e.text(i.id):(e.html(k.useText?i.text:i.un),e.attr(i.group?"data-group-id":"data-user-id",i.ul).attr(s,e.html())),y(n,t))}function y(e,t){var n=I(e)?" ":String.fromCharCode(160),n=document.createTextNode(n);m.focus(),k.util.after(e,n),t.setStart(n,1),k.selector.addRange(t)}function b(){d=!1,k.suggestElement.css({left:0,top:-1e3}),k.suggestElementVisible=!1,k.suggest.resetSelection(),f.css({top:0,left:0,width:0,height:0}),f.removeClass(O)}S.success(x,"not_supported")}};return k}}),define("OK/scroll",[],function(){function t(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}return{animateVScroll:function(n,i){var e,s=(e=Math.min(500,Math.max(300,3*Math.abs(i))),Math.floor(e)),o=t,r=Date.now(),a=n.scrollTop,c=a;this._animationId=r;var l=function(){var e,t;this._animationId===r&&(e=Math.min(Date.now()-r,s),t=Math.round(o(e,a,i,s)),n.scrollTop+=t-c,c=t,e<s&&requestAnimationFrame(l))}.bind(this);requestAnimationFrame(l)}}}),define("OK/discussions/CommentForm",["require","OK/textarea","jquery","OK/utils/vanilla","OK/discussions/NewCommentsLabel","OK/AttachPicker","OK/LinkDetector","OK/discussions/LinkAttachController","OK/emojiarea","OK/StickerSuggester","OK/postingForm/mentions","PTS/discussion.client","OK/suggest/searchEngines","OK/scroll"],function(g,e,p,o,a,v,c,l,t,u,C,y,b,r){"use strict";var h={commentAreaContainer:p(),scrollingContainer:document.body,onStateChanged:p.noop,persistant:!0,collapsable:!0,cleanOnPaste:!1,isStickyForm:!0,typingListener:{onTypingStatusChanged:p.noop},parseLinks:!0,instantSending:!1,instantPaste:!1,sendOnCtrlEnter:!1,newLineOnCmdEnter:!1,collapseText:!0},k=["PHOTOUPLOADED","VIDEOUPLOADED","FILE"],n=p("html"),d=n.hasClass("gecko"),m="вЂ‹",i=p(),s=!1,_=n.hasClass("chrome")||n.hasClass("mac-chrome"),S=n.hasClass("mac-saf");function x(e){d&&!s&&(s=!0,i=p(document.createTextNode(m)),e.textarea.append(i),e.container.toggleClass("__placeholder",e.isEmpty()))}function w(e){d&&s&&(s=!1,i=null,e.getValue().substr(0,1)===m&&e.setValue(e.getValue().substr(1)),e.container.toggleClass("__placeholder",e.isEmpty()))}function O(e){e.hasFocus=!1,e.typingStatusCheck&&(e.typingStatusCheck=clearInterval(e.typingStatusCheck)),e.textarea.off("click.cC keyup.linkParsing paste.linkParsing"),p(document).off("paste.imagePasting")}function T(i){g(["OK/AttachUploader"],function(e){var t=p(".js-uploader-hook",i.discussion.element);i.options.parseLinks&&(i.onPasteUploader=t.data("uploader"),i.onPasteUploader||(i.onPasteUploader=new e,i.onPasteUploader.activate(t))),p(document).on("paste.imagePasting",function(e){e=e.clipboardData||e.originalEvent.clipboardData;e&&e.items&&(e=e.items,p.each(e,function(e,t){var n=t.getAsFile();n&&0===n.type.indexOf("image")&&(OK.logging.logger.success("discussions.imagePasted"),t=new Date,t=new File([n],"attached-picture"+t,{type:n.type,lastModifiedDate:t}),i.onPasteUploader&&i.onPasteUploader.onFileSelect([t]))}))})})}function E(e){e=e.container&&e.container[0]&&e.container[0].closest(".comment-form_cnt");return e&&e.querySelector(".instant-comments")}function I(e){e=E(e);e&&e.classList.toggle("__collapsed",!0)}function M(e,t,n){var i=0;try{this.options=p.extend({},h,t.options,n||{}),i=1,this.textarea=e,i=2,this.form=this.textarea.closest("form"),i=3,this.container=this.textarea.closest(".js-comments_form"),i=4,this.cancelBtn=p(".comments_add-controls_cancel",this.container),i=5,this.official=p(".form-actions__official",this.container),i=6,this.attached=p(".attachedInput",this.container),i=7,this.officialContainer=p(".comments_add-controls_checkbox",this.container),i=8,this.userAvatar=p(".comments_author-avatar__user",this.container),i=9,this.groupAvatar=p(".comments_author-avatar__group",this.container),i=10,this.discussion=t,i=11,this.replyMode=!1,i=12,this.comment=null,i=13,this.replyCommentIdInput=p('[name="st.cId1"]',this.container);var i=14,s=p(".attachPicker",this.container);i=15,s&&0<s.length?(i=16,this.objectId=s.data("object-id")):(i=17,this.objectId=null),i=18,this.states={},i=19;var o=p(".tipDiscussion",this.container);0<o.size()&&(this.label=new a(o,t,this)),i=20,this.linkDetector=new c(e),i=21,this.linksController=new l(this.objectId),i=22,this.disabled=!1,i=23;var r=p(".js-st-suggest",this.container);i=24,0<r.size()&&(i=25,this.stickerSuggester=new u(this,r[0])),this.persistants=null}catch(e){OK.logging.logger.success("messagesLayer","e.commentForm_"+i)}}function L(e){var n=this;function i(){n.linksInProgress&&(n.linksInProgress=n.linksInProgress-1,0===n.linksInProgress&&n.changeState(M.states.progress,!1))}function s(e){e&&(n.changeState(M.states.progress,!0),n.linksInProgress=(n.linksInProgress||0)+1)}n.linkDetectionTimer&&clearTimeout(n.linkDetectionTimer);var t="paste"===e.type;function o(){n.linkDetector.parse(n.getValue(),!t).then(function(e){0<e.length&&OK.logging.logger.success("discussions.linksParsed",e.length,t),p.each(e,function(e,t){OK.logging.logger.success("discussions.linkParsed"),n.linksController.process(e,t).progress(s).always(i)})})}t?setTimeout(o,10):n.linkDetectionTimer=setTimeout(o,400)}return M.states={initial:"__initial",active:"__active",disabled:"__disabled",error:"__error",notify:"__notify",cancelable:"__cancelable",invisible:"__invisible",progress:"__progress"},M.prototype={init:function(){var t,e,n=0,a=this,i=this.container,c=this.textarea,s=p(".js-comments_add-error",this.container),o=p(".form-actions_yes",i),r=p(".comments_add-controls_save",i);function l(){i.removeClass("__disabled"),o.removeAttr("disabled","disabled").removeClass("__disabled"),r.removeAttr("disabled","disabled").removeClass("__disabled"),a.disabled=!1}function u(){a.isInProgress=!0,a.posted=p.Deferred(),w(a);var e=c.data("emojiarea");e&&e.hideMenu();e=a.isValid();return a.options.instantSending&&e?a.resetState():(i.addClass("__disabled"),o.attr("disabled","disabled").addClass("__disabled"),r.attr("disabled","disabled").addClass("__disabled"),a.disabled=!0),e}function h(e){l(),a.setCaretToEnd(),a.isValid()&&(a.changeState(M.states.error),e&&e.key&&s.html(e.key))}function d(e){38!==e.which||a.isValid()?27===e.keyCode&&(a.cancelReplyEditMode(),e.stopPropagation()):(a.discussion.list.editLast(),e.stopPropagation())}try{var m,n=1;g(["OK/textCounter"],function(){var e=a.textarea.attr("data-maxLength")||4096;p(".txt-counter",a.container).textCounter(c,{maxLength:e,valueGet:function(){return a.getValue(!0)}})}),n=2,a.initAutosize(),n=3,a.objectId&&((m=v.get(a.objectId)).on("update",a.onAttachUpdate.bind(a)),m.on("instantSendAttaches",a.instantSendAttaches.bind(a)),m.serializeAttachesCb=a.serializeAttaches.bind(a),m.sendUploadedAttachesCb=a.sendUploadedAttaches.bind(a)),n=4,a.options.persistant&&(a.persistants=c.persistant({afterInit:function(e){a.collapse()}})),n=5,a.form.submit(function(e,t){if(e.preventDefault(),a.beforeFormSubmit(),a.isValid()&&!a.disabled){if(a.options.checkAttachOnSubmit){var n=a.attached.val(),i=n&&""!==n?JSON.parse(a.attached.val()):[];if(0<i.length){for(var s=!1,o=0;o<i.length;o++){var r=i[o];-1<k.indexOf(r.type)&&r.id<0&&(s=!0)}if(s)return void(a.options.asyncUploadEnabled?(a.scheduleMessage(),function(){w(a);var e=c.data("emojiarea");e&&e.hideMenu(),a.resetState()}()):h())}}n=a.serialize({});a.createRequest(n,u,h,l),OK.logging.logger.success("discussions.formSubmit",t||!1)}}),n=6,c.keypress(function(e){var t=e.keyCode||e.which,n=S&&(e.ctrlKey||e.altKey),i=13===t&&e.altKey,s=13===t&&!e.ctrlKey&&!e.metaKey,o=(13===t||10===t)&&(e.ctrlKey||e.metaKey),t=a.options.sendOnCtrlEnter?o:s,o=a.options.sendOnCtrlEnter?s:o,n=a.options.newLineOnCmdEnter&&!n&&(i||o);!t||e.altKey||e.shiftKey||(a.form.trigger("submit",[!0]),e.preventDefault()),n&&(e.preventDefault(),window.getSelection)&&(o=(i=window.getSelection()).getRangeAt(0),t=document.createElement("br"),n=this.childNodes.length,e=this.childNodes[n-1],(n<2||e.nodeName&&"#text"==e.nodeName)&&(e=document.createElement("br"),this.appendChild(e)),o.deleteContents(),o.insertNode(t),o.setStartAfter(t),o.setEndAfter(t),o.collapse(!1),i.removeAllRanges(),i.addRange(o)),a.changeState(M.states.active)}).keydown(function(e){var t=e.keyCode||e.which;37!==t&&39!==t||e.stopPropagation();e=(13===t||10===t)&&e.metaKey;a.options.newLineOnCmdEnter&&_&&e&&((e=jQuery.Event("keypress")).keyCode=13,e.metaKey=!0,p(this).trigger(e))}).focus(function(){var e;a.hasFocus=!0,a.options.collapsable&&p(document).off("click.cF").on("click.cF",function(){a.deactivate(!1)}),x(a),c.on("keydown.esc",d),a.options.instantPaste||c.one("blur",function(){O(a)}),c.on("click.cC",function(){a.changeState(M.states.active)}),a.changeState(M.states.active),i.on("click.cC",function(e){e.stopPropagation()}),a.options.parseLinks&&c.on("keyup.linkParsing paste.linkParsing",L.bind(a)),a.typingStatusCheck?OK.logging.logger.success("discussions.typingAlreadyActivated"):(e=a.options.typingCheckTimeout||1e3,a.typingStatusCheck=setInterval(function(){var e,t;a.isEditMode()||((t=c.data("previousText"))&&(e=a.getValue().length,t=t.length,0===e?a.options.typingListener.onTypingStatusChanged(2):e!==t&&a.options.typingListener.onTypingStatusChanged(0)),c.data("previousText",a.getValue()))},e)),a.options.isStickyForm&&!a.discussion.isPanelSticky()&&i.each(function(){a.discussion.scrollController.makeVisible(this)}),a.options.instantPaste||T(a),a.mentions&&a.mentions.hide(),OK.logging.logger.success("discussions.formActivate",a.discussion.scrollController.isScrolledToBottom())}).focus(function(e){var t=E(e);t&&(e=!e.replyMode,t.classList.toggle("__collapsed",!e))}.bind(a,a)).one("focus",function(s){s.options.mentionsEnabled&&OK.loader.use(["jQuery","OKCustomJs","OKTextarea"],function(){var e,t=C("cfm_"+Date.now()),n=OK.editor.util,i=OK.editor.selector;n.isSafari=OK.util.isSafari(),n.isWebKit=OK.util.isWebkit(),t.mentionsCharStart=s.options.mentionsCharStart,t.useText=!0,s.options.participantsSearchEnabled&&(e=b.commentMentionsEngine(function(){return s.discussion.getId2()},s.options.groupMentionsEnabled)),t.init(y.markFriendDisabled,n,i,!0,e),s.mentions=t.bind(s.textarea)})}.bind(a,a)),n=7,a.options.cleanOnPaste&&c.on("paste",function(e){e.preventDefault();e=(e.originalEvent||e).clipboardData;e?document.execCommand("insertText",!1,e.getData("text/plain")):window.clipboardData&&document.execCommand("paste",!1,window.clipboardData.getData("Text"))}),n=8;var f=function(){var e=a.isBlank();return a.container.toggleClass("__placeholder",e),e&&a.linksController.reset(),f};n=9,c.on("textchange",f()),n=10,a.initSmiles(),n=11,a.cancelBtn.click(p.proxy(this.onCancel,this)),0<a.official.length&&a.official.change(p.proxy(this.onOfficialChange,this)),n=12,a.changeState(M.states.initial,!0),n=13,x(a),a.options.instantPaste&&T(a),(e=E(t=a))&&(e.addEventListener("click",function(e){e=e.target;e.classList.contains("usmile")&&(I(t),t.postToForm({content:e.getAttribute("data-code"),isSticker:!0,stickerPlace:null}))}),e.classList.toggle("__activated",!0),e.querySelector(".instant-comments_stickers").addEventListener("click",function(){var e=t.textarea.data("emojiarea");e&&e.$button.click()}))}catch(e){OK.logging.logger.success("messagesLayer","e.commFormInit_"+n)}return this},beforeFormSubmit:function(){},scheduleMessage:function(){},destroy:function(){var e;O(this),this.textarea.off(),this.textarea.emojiareaOff&&this.textarea.emojiareaOff(),this.textarea.removeData(),this.container.off(".cC"),p(document).off(".cF"),p(".js-comments_smiles_trigger",this.container).off("click"),this.cancelBtn.off(),this.form.off(),this.stickerSuggester&&this.stickerSuggester.destroy(),this.onPasteUploader&&this.onPasteUploader.deactivate(),this.persistants&&this.persistants.off(),this.mentions&&(this.mentions.hide(),this.mentions.unbind()),this.objectId&&((e=v.get(this.objectId)).off("update"),e.off("instantSendAttaches"))},isEmpty:function(){var e=this.getValue().trim().replace(/[\n\s]+/gi,"");return 0===e.length||d&&e===m},isBlank:function(){var e=this.getValue();return 0===e.length||d&&e===m},showNotification:function(e){this.label&&this.label.show(e)},showNotificationAboutNew:function(e){this.label&&this.label.showAsNew(e)},onSuccess:function(e,t){function n(e){i.isEditMode()||(i.discussion.scrollController.hasMore()?setTimeout(i.showNotification.bind(i,e),100):e&&e.element.each(function(){i.discussion.scrollController.isVisibleBottomOf(this)||setTimeout(i.showNotification.bind(i,e),100)})),i.options.instantSending||i.resetState()}var i=this,s=e.getResponseHeader(OK.navigation.HEADER).split(",")[0],o=t.split(OK.navigation.SPLITER)[0],e=i.discussion.commentsCount;OK.logging.logger.success("discussions.commentPosted",e<=5?e:e<=10?10:e<=20?20:e<=50?50:"50+"),i.isEditMode()?(t&&(OK.hookModel.setHookContent(s,t.split(OK.navigation.SPLITER)[0]),i.comment.init(p(OK.hookModel.getHookById(s).element.firstChild))),n(i.comment)):i.discussion.post(s,o).always(n)},createRequest:function(e,t,i,n){var s=this,o=p.param(e),e=function(){},t=(t=t||e,i=i||e,n=n||e,p.ajax({type:"POST",headers:{TKN:OK.tkn.get()},url:s.getSubmitUrl(),data:o+"&gwt.requested="+window.pageCtx.gwtHash,beforeSend:t}));return t.done(function(e,t,n){try{"true"===n.getResponseHeader("failed")?i(OK.util.parseJSON(e)):s.onSuccess(n,e)}catch(e){throw i(),e}}),t.fail(i).then(n),t.always(function(){s.isInProgress=!1,s.posted&&s.posted.resolve()}),t.then(function(){I(s),function(e){e=e.container&&e.container[0]&&e.container[0].closest(".plc");e&&r.animateVScroll(e,e.scrollHeight)}(s)})},getSubmitUrl:function(){return this.form.attr("action")},clear:function(){this.fullText=null,this.setValue("").changeState(M.states.error,!1).changeState(M.states.progress,!1),this.objectId&&v.clear(this.objectId),this.linksController.reset()},onCancel:function(e){this.discussion.replyMode(!1),this.discussion.editMode(!1),e.preventDefault()},onOfficialChange:function(){0<this.official.length&&(this.official.prop("checked")?(this.userAvatar.hide(),this.groupAvatar.show()):(this.groupAvatar.hide(),this.userAvatar.show()))},getAttachesCount:function(){var e=this.attached.val();return(e&&""!==e?JSON.parse(this.attached.val()):[]).filter(function(e){return"VIDEOERROR"!==e.type}).length},isValid:function(){return!this.isEmpty()||0<this.getAttachesCount()},deactivate:function(e){return this.options.collapsable&&(p(document).off("click.cF"),this.textarea.off("keydown.esc change.valid textchange.valid"),this.container.off("click.cC"),!e&&this.isValid()||this.changeState(M.states.initial).changeState(M.states.error,!1).changeState(M.states.active,!1)),this.mentions&&this.mentions.hide(),this},setComment:function(e){return this.comment=e,this.replyCommentIdInput.val(this.comment?this.comment.id:""),this},resetState:function(){this.clear(),this.discussion.replyMode(!1),this.isEditMode()&&this.discussion.editMode(!1)},activateEditMode:function(e){var t;return this.replyMode=!1,this.comment=e,this.setValue(e.getText()),this.objectId&&(t=e.getAttachments(),v.clear(this.objectId),v.add(this.objectId,t),this.linksController=new l(this.objectId)),this.setCaretToEnd(),this.textarea.focus(),0<this.official.length&&(this.official.prop("checked",e.official),this.onOfficialChange(),this.officialContainer.hide()),this.changeState(M.states.cancelable),this},activateReplyMode:function(e){return this.replyMode=!0,this.setComment(e),this.setCaretToEnd(),this.textarea.focus(),0<this.official.length&&e.official&&(this.options.canReplyFromGroup=this.official.prop("checked"),this.official.prop("checked",!1),this.onOfficialChange(),this.officialContainer.hide()),this.changeState(M.states.cancelable),this._preparePhotoLayerReplyMode(e),this},_preparePhotoLayerReplyMode:function(e){var t=this.container[0],n=t&&t.closest(".plc"),e=e&&e.element&&e.element[0];t&&n&&e&&(I(this),(t=t.getBoundingClientRect().top)<(e=e.getBoundingClientRect().bottom)&&r.animateVScroll(n,e-t))},cancelReplyEditMode:function(){this.isReplyMode()?this.discussion.replyMode(!1):(this.discussion.editMode(!1),this.collapse().deactivate(!0).textarea.blur())},deactivateReplyEditMode:function(){return(this.isReplyMode()||this.isEditMode())&&(this.options.canReplyFromGroup&&(this.official.prop("checked",!0),this.userAvatar.hide(),this.groupAvatar.show(),this.officialContainer.show()),this.isEditMode()&&(this.linksController=new l(this.objectId)),this.clear(),this.replyMode=!1,0<this.official.length&&this.officialContainer.show(),this.setComment(null),this.deactivate(!0),this.changeState(M.states.cancelable,!1)),this},changeState:function(e,t){var n=0;try{return(t=null==t||t,n=1,this.states[e]===t)?this:(n=2,e&&(n=3,e!=M.states.initial&&t&&(n=4,this.changeState(M.states.initial,!1)),n=6,this.options.commentAreaContainer.toggleClass(e,t),n=7,this.options.onStateChanged.call(this.textarea,e,t),n=8,this.states[e]=t,n=9,this.textarea.trigger("commentForm.stateChanged",[e,t]).trigger("autosize.resize")),this)}catch(e){OK.logging.logger.success("messagesLayer","e.commFormState_"+n)}},onStateChange:function(e){this.options.onStateChanged=e},getValue:function(c){if(this.fullText)return this.fullText;var i=this,l=["p","div","pre","form"];return function(){var e=[],r=[];function a(){e.push(r.join("")),r=[]}if(0<i.textarea.length)for(var t=i.textarea[0].childNodes,n=0;n<t.length;n++)!function e(t){if(3===t.nodeType){var n=t.nodeValue;d&&(n=n.replace(new RegExp(m,"g"),"")),r.push(n)}else if(1===t.nodeType){var i=t.tagName.toLowerCase();if((n=-1!==l.indexOf(i))&&r.length&&a(),"img"!==i){if("br"===i)a();else if(t.hasAttribute("data-user-id")||t.hasAttribute("data-group-id"))return r.push(t.outerHTML),0;for(var s=t.childNodes,o=0;o<s.length;o++)e(s[o]);n&&r.length&&a()}else c?(n=t.getAttribute("alt")||"")&&r.push(n):r.push(t.outerHTML)}}(t[n]);return r.length&&a(),e.join("\n")}().replace(/<br\s*[\/]?>/gi,"\n")},setValue:function(e){return this.textarea.html(e),""===e&&this.isEmpty()&&x(this),this.textarea.trigger("textchange").trigger("autosize.resize"),this},serialize:function(e){var t=e.content,n=e.isSticker,i=e.attached||this.attached&&this.attached.val(),s=n&&this.options.sendStickerAsAttach,e={"st.dOFC":0<this.official.length&&this.official.prop("checked")?"on":"off","st.dAGid":this.container.attr("data-author-groupId"),"st.dM":s?"":t||this.getValue(!0),"st.dRT":null===this.comment?"off":"on"};(i=s?JSON.stringify([{type:"STICKER",code:t}]):i)&&0<i.length&&(!n||s)&&p.extend(e,{"st.attached":i});i=this.linksController.getAttachedLinks();0<i.length&&!n&&(i=p.map(i,function(e,t){return o.encodeHtml(e)}),p.extend(e,{links:i.join(",")}));i=Math.round((new Date).getTime()*Math.random());return this.isEditMode()?p.extend(e,{"st.tlb.act":"actEC","st.cntId":this.comment.blockHookId,"st.refId":"editComment-"+i}):p.extend(e,{"st.tlb.act":"actSC","st.cntId":"cf"+i,"st.refId":"sendComment-"+i}),this.comment&&p.extend(e,{"st.cId1":this.comment.id}),e},isEditMode:function(){return this.comment&&!this.replyMode},isReplyMode:function(){return this.comment&&this.replyMode},focus:function(){this.textarea.focus()},collapse:function(){this.fullText=this.getValue();var e=this;if(e.options.collapseText){var n=[],i=[],t=this.fullText.replace(/<img.*?>/gi,function(e,t){return n.push(e),i.push(t),""});50<t.length&&(t=t.substring(0,50)+"вЂ¦");for(var s=0,o=n.length;s<o&&!(i[s]>=t.length);s++)t=t.substr(0,i[s])+n[s]+t.substr(i[s]);this.setValue(t)}return this.changeState(M.states.active,!1),setTimeout(function(){e.textarea.trigger("textchange").trigger("autosize.resize")},10),this.textarea.one("focus",function(){e.expand()}),e.options.collapseText||e.focus(),this},expand:function(){return this.fullText&&(this.setValue(this.fullText.replace(/\n/g,"<br>")),this.fullText=null,this.changeState(M.states.active),this.setCaretToEnd()),this},extendedEmojiareaOptions:function(){return{stickerSource:function(){return"discussions"},commentsWrapperEl:this.discussion.element}},postToForm:function(e){e=this.serialize(e);return this.isReplyMode()&&this.discussion.replyMode(!1),this.createRequest(e,null,function(e){var t;!e||"STICKER_SERVICE_UNAVAILABLE"!==e.type&&"STICKER_SERVICE_UNAVAILABLE_VIP"!==e.type||(t="STICKER_SERVICE_UNAVAILABLE_VIP"===e.type?33:19,g(["OK/emojiarea"],function(e){e.callStickerSetLayer(t)}))})},instantSendAttaches:function(e,t){var n,i=this;t&&t.length&&(t.forEach(function(e){n=i.serialize({content:" ",attached:"["+JSON.stringify(e)+"]"}),i.createRequest(n)}),i.isReplyMode()&&i.discussion.replyMode(!1))},serializeAttaches:function(e){return this.serialize({content:" ",attached:"["+JSON.stringify(e)+"]",instantAttachSend:!0})},sendUploadedAttaches:function(e,t){},initSmiles:function(){var e,t,n=0;try{this.emojiarea||(n=1,e=p(".js-comments_smiles_trigger",this.container),n=2,t=p.extend({button:e,postFunction:this.postToForm.bind(this),scrollingContainer:this.discussion.scrollController.element,stickerSuggester:this.stickerSuggester,needStickerOnSmileSuggester:!!this.container.find(".js-smile-st-suggest").length},this.extendedEmojiareaOptions()),n=3,p.fn.emojiarea&&(n=30,this.textarea.emojiarea(t)),n=4,this.emojiarea=!0)}catch(e){OK.logging.logger.success("messagesLayer","e.commFormSmile_"+n)}},setCaretToEnd:function(e){function t(){n.textarea.each(function(){var e=document.createRange();e.selectNodeContents(this),e.collapse(!1);var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}),n.textarea.trigger("change")}var n=this;e?t():setTimeout(t,5)},checkStickyRecalculate:function(e){var t=this.options.stickyContainerParent.outerHeight(),n=this.options.stickyContainer.outerHeight();t!==n&&e(t,n)},initAutosize:function(){var s=this;this.textarea.autosize({onBeforeResize:function(){var t=0;try{var e=s.discussion,t=1,n=e.scrollController;t=2;var i=n&&n.isScrolledToBottom&&n.isScrolledToBottom();t=3,this.scrolledToBottom=i}catch(e){OK.logging.logger.success("messagesLayer","e.commFormoOnBeforeResize_"+t)}},callback:function(){s.options.stickyContainer&&s.options.stickyContainerParent&&(s.checkStickyRecalculate(function(e,t){s.discussion.scrollController.scroll(t-e),s.options.stickyContainerParent.css({minHeight:s.options.stickyContainer.outerHeight()})}),this.scrolledToBottom&&s.discussion.scrollController.scrollToBottom(),s.options.stickyContainer.scrollTop(s.options.stickyContainer.prop("scrollHeight")))}})},whenPosted:function(e){this.isInProgress?this.posted.done(e):e()},onAttachUpdate:function(){var e;this.options.isStickyForm&&this.options.stickyContainer&&this.options.stickyContainerParent&&(e=this,requestAnimationFrame(function(){e.checkStickyRecalculate(function(){e.options.stickyContainerParent.css({minHeight:e.options.stickyContainer.outerHeight()})})})),this.setCaretToEnd(),this.discussion.scrollController.trigger()}},M.linkParsingHandler=L,M}),define("OK/discussions/Comment",["jquery","OK/discussions/CommentForm","OK/utils/utils"],function(t,e,s){function n(e,t,n){2===arguments.length&&(n=new Date(e.data("time"))),this.discussion=t,this.time=n,this.level=parseInt(e.data("level")),this.url=e.data("url"),this.userId=e.data("uid"),this.unseen=!1,this.init(e)}return n.prototype={init:function(e){this.element=e,this.parent=this.element.parent(),this.blockHookId=OK.hookModel.getNearestBlockHookId(this.element.get(0)),this.contentBlockHookId=this.element.data("cid")+"",this.contentContainer=t("#hook_Block_"+this.contentBlockHookId,this.element),this.textContainer=t(".comments_text",this.contentContainer),this.id=this.element.data("id"),this.content=this.contentContainer.html(),this.official=e.data("official"),this.initHandlers()},initHandlers:function(){this.element.on("click",".comments_cancel-reply",t.proxy(this.cancel,this))},destroy:function(){this.element.off("click",".comments_cancel-reply"),this.element.off(),this.element.removeData()},edit:function(){var e=this;this.discussion.editMode(!0,this),this.element.each(function(){e.discussion.scrollController.isVisibleBottomOf(this)||e.discussion.scrollController.scrollToBottom(this)})},setContent:function(e){OK.hookModel.setHookContent(this.contentBlockHookId,e)},initExpand:function(){var t=this;require(["OK/discussions/Reveal"],function(e){t.element.each(function(){e.activate(this)})})},expand:function(){var t=this;require(["OK/discussions/Reveal"],function(e){t.element.each(function(){e.expand(this)})})},cancelEdit:function(){this.discussion.editMode(!1),this.setContent(this.content)},cancel:function(e){return this.element.trigger("comment.cancel"),e.preventDefault(),e.stopPropagation(),this},select:function(){return this.element.addClass("__active"),this},refresh:function(){return t.ajax({type:"POST",headers:{TKN:OK.tkn.get()},data:{"gwt.requested":window.pageCtx.gwtHash},url:this.url}).done(function(e,t,n){for(var i=e.split(OK.navigation.SPLITER),s=n.getResponseHeader(OK.navigation.HEADER).split(","),o=0;o<i.length;o++)s[o]&&OK.hookModel.setHookContent(s[o],i[o])}),this},bind:function(e,t){return this.element.on(e,t),this},unbind:function(e,t){return this.element.off(e,t),this},deselect:function(){this.element.removeClass("__active")},highlight:function(e){var t=this;t.element.addClass("__highlight"),(e=void 0===e?!0:e)&&setTimeout(function(){t.element.removeClass("__highlight")},3e3)},updateKlass:function(){var e=this.element.data("classurl"),i=this;e&&s.ajax({type:"POST",url:e}).done(function(e,t,n){i.highlight(),s.updateBlockModelCallback(e,t,n)})},getAttachments:function(){return this.element.data("attaches")||[]},getText:function(){var i=this,c=["p","div","pre","form"];return function(){var e=[],r=[];function a(){e.push(r.join("")),r=[]}if(0<i.textContainer.length)for(var t=i.textContainer[0].childNodes,n=0;n<t.length;n++)!function e(t){if(3===t.nodeType){var n=t.nodeValue;r.push(n)}else if(1===t.nodeType){var i=t.tagName.toLowerCase();if((n=-1!==c.indexOf(i))&&r.length)return a(),0;if("img"===i)return r.push(t.outerHTML),0;if("br"===i)a();else if(t.hasAttribute("data-user-id")||t.hasAttribute("data-group-id"))return r.push(t.outerHTML),0;for(var s=t.childNodes,o=0;o<s.length;o++)e(s[o]);n&&r.length&&a()}}(t[n]);return r.length&&a(),e.join("")}()}},n}),define("OK/discussions/CommentEntry",[],function(){function e(e,t){this.element=e,this.comment=t,this.next=null,this.prev=null}return e.prototype={append:function(e){return this.comment.id!==e.comment.id&&((this.next=e).prev=this,e.element.insertAfter(this.element),!0)},prepend:function(e){return this.comment.id!==e.comment.id&&(this.prev&&(this.prev.next=e),(this.prev=e).next=this,e.element.insertBefore(this.element),!0)},compare:function(e){return this.comment.time.getTime()-e.comment.time.getTime()}},e}),define("OK/ReplyList",["require","jquery","OK/logger","OK/utils/utils","OK/utils/dom"],function(e){"use strict";var d=e("jquery"),r=(e("OK/logger"),e("OK/utils/utils")),t=e("OK/utils/dom"),e=function(e){this.toggleClick=e&&e.toggleClick,this.clearOnDestroy=e&&e.clearOnDestroy,this.onlyOnClick=e&&e.onlyOnClick};return e.prototype={init:function(e){this.container=d(e);e=this.onlyOnClick?"click":"hover click";this.container.on(e,".comments_replied",d.proxy(this.showReply,this))},destroy:function(){var e;this.onlyOnClick||this.container.off("hover"),this.container.off("click"),this.clearOnDestroy&&(e=t.byClass(this.container[0],"comments_reply-comment"))&&e.forEach(function(e){e.classList.contains("__show")&&!e.classList.contains("__popup")&&(e.classList.remove("__show"),e.classList.add("__popup"))})},showReply:function(e){var t,c,n,i,l,s=d(e.target).closest(".comments_replied");function u(){var e=c.reply;e&&(e.hasClass("__show")&&!e.hasClass("__popup")?t.toggleClick&&(e.addClass("invisible"),setTimeout(function(){e.removeClass("__show invisible").addClass("__popup")},100),t.scroller&&t.scroller.scroll(-e.height())):(e.removeClass("__popup").addClass("__show").children().removeClass("__active __popup"),t.scroller&&(t.scroller.scroll(e.height()),e.each(function(){t.scroller.makeVisible(this)}))))}function h(){c.showTimeout=setTimeout(function(){var e=c.reply||d();e.addClass("__show"),c.arrow||(c.arrow=e.find(".comments_reply-comment_arrow").css("left",function(){return s.offset().left-e.offset().left}))},300)}function o(){setTimeout(function(){clearTimeout(c.showTimeout),(c.reply||d()).removeClass("__show")},100)}0!=s.length&&(t=this,c=s[0],n=s.data("url"),parseInt(s.data("level"),10),c.embedded?t.toggleClick&&(i=c.reply.hasClass("__show")&&!c.reply.hasClass("__popup"),"click"===e.type?u():i||"mouseenter"!==e.type?i||"mouseleave"!==e.type||o():h()):(l=t.onlyOnClick&&"click"===e.type,"mouseenter"!==e.type&&!l||(c.reply||c.requested?h():(c.requested=!0,r.ajax({url:n}).done(function(e,t,n){for(var i=e.split(OK.navigation.SPLITER),s=n.getResponseHeader(OK.navigation.HEADER).split(","),o=0;o<i.length;o++){var r,a=s[o];a&&(r=OK.hookModel.getHookById(a).element,(r=d(r)).children().addClass("__active __popup"),OK.hookModel.setHookContent(a,i[o]),c.reply=r,(l?u:h)())}}))),"mouseleave"===e.type&&o(),"click"===e.type&&(c.embedded=!0,u())),e.preventDefault())}},e}),define("OK/discussions/CommentsList",["jquery","OK/discussions/Comment","OK/discussions/CommentEntry","OK/ReplyList"],function(l,u,h,i){function e(e,t,n){this.selectedComment=null,this.container=l(e),this.discussion=n,this.scroller=t,this.last=null,this.parentHookId=OK.hookModel.getNearestBlockHookId(e),this.replyList=new i}return e.prototype={init:function(){this.replyList.init(this.container),this.container.on("mousedown click",".comments_reply",l.proxy(this.reply,this)).on("click","a.comments_edit",l.proxy(this.edit,this)).on("click",".comments_text_more",l.proxy(this.expandComment,this)),this.initExpandComments()},destroy:function(){this.container.off("hover click",".comments_replied"),this.container.off("mousedown click",".comments_reply"),this.container.off("click","a.comments_edit"),this.container.off("click",".comments_text_more");var e=l(".comments_i",this.container);e.off("click",".comments_cancel-reply"),e.off(),e.removeData()},createListHead:function(){var e=this.container.children();if(0==e.length)return null;var t=e.last(),e=new u(l(".comments_i",t),this.discussion);return new h(t,e)},getLast:function(){return this.last&&l.contains(this.container.get(0),this.last.element.get(0))||(this.last=this.createListHead()),this.last},getComment:function(e){e=e.closest(".comments_i");return new u(e,this.discussion)},editLast:function(){var e=l("a.comments_edit:last",this.container);0!=e.length&&this.editComment(this.getComment(e))},edit:function(e){this.editComment(this.getComment(l(e.target))),e.preventDefault(),e.stopPropagation()},expandComment:function(e){this.getComment(l(e.target)).expand()},editComment:function(e){var t=this.selectedComment;t&&t.cancelEdit();var n=this;e.bind("comment.cancel",function(){n.discussion.editMode(!1)}),e.edit(),this.selectedComment=e,OK.logging.logger.success("discussions.commentEdit","click")},reply:function(e){var t,n;"mousedown"!==e.type&&((n=(t=this).getComment(l(e.target))).bind("comment.cancel",function(){t.discussion.replyMode(!1)}),OK.logging.logger.success("discussions.commentReply","click"),t.discussion.replyMode(!0,n),e.preventDefault()),e.stopPropagation()},selectComment:function(e){var t;e&&(this.deselectComment(this.selectedComment),this.container.addClass("__blur"),(this.selectedComment=e).select(),(t=0)<this.discussion.elements.stickyContainer.length&&(t=this.discussion.elements.stickyContainer.offset().top),0<(t=e.element.offset().top+e.element.outerHeight()-t)&&this.scroller.scroll(10+t))},deselectComment:function(e){(e=e||this.selectedComment)&&(e.deselect(),this.container.removeClass("__blur"),this.selectedComment=null)},addNewComment:function(e,t){var n=l.Deferred();if(this.scroller.hasMore())return n.resolve(null);var i=this,s=l('<div id="hook_Block_'+e+'">').html(t),o=new u(l(".comments_i",s),this.discussion),r=new h(s,o),a=this.scroller.isScrolledToBottom();a&&this.discussion.toggleStickyPanel(!1);e=this.getLast(),t=!1;if(e)if(0<=r.compare(e))(t=e.append(r))&&(this.last=r);else{for(var c=e;null!=c.prev&&r.compare(c.prev)<=0;)c=c.prev;t=c.prepend(r)}else t=!0,this.last=r,this.container.append(r.element),l(document.createElement("div")).addClass("comments_first_sep").appendTo(s);return a&&(this.scroller.scroll(r.element.outerHeight()),this.discussion.toggleStickyPanel(!0)),t&&s.each(function(){i.parentHookId&&OK.hookModel.captureBlockHook(i.parentHookId,this)}),t?n.resolve(o):n.fail(o),n.promise()},updateComment:function(e){e=this.findComment(e);e&&e.refresh()},findComment:function(e){if(e){e=l('[data-id="'+e+'"]',this.container);if(0!=e.length)return new u(e,this.discussion)}return null},findCommentsFromAuthor:function(t){var n=this,i=[];return l(".comments_i",this.container).each(function(){var e=l(this);t==e.data("uid")&&i.push(new u(e,n.discussion))}),i},deleteStub:function(e,t){var n=OK.hookModel.getHookById(e).element,r=l("input[type=checkbox]",n),a=l(n);a.find(".block-user").change(function(){var e=l(n).find(".delete-content");e.toggleClass("invisible"),e.find("input[type=checkbox]").prop("checked",!1)}),r.change(function(){var e=!0;r.each(function(){e=e&&!this.checked}),l(".comments_delete_form-action",n).toggleClass("invisible",e)});var c=a.find(".lsid").val();window&&window.localStorage&&c&&(function(){var t=window.localStorage.getItem(c);if(t){r.each(function(e){-1!=t.indexOf("c"+e)&&l(this).prop("checked","checked").trigger("change")});for(var e=a.find(".block-user-dd"),n=e.find("option"),i=0;i<n.length;i++)if(-1!=t.indexOf("bu"+i)){n.eq(i).attr("selected","selected"),e.trigger("change");break}for(var s=a.find(".delete-content-dd"),o=s.find("option"),i=0;i<o.length;i++)if(-1!=t.indexOf("dd"+i)){o.eq(i).attr("selected","selected"),s.trigger("change");break}}}(),a.find(".comments_delete_form-action").click(function(){var t="";r.each(function(e){l(this).prop("checked")&&(t+="c"+e)}),a.find(".block-user").prop("checked")&&a.find(".block-user-dd option").each(function(e){if(l(this).prop("selected"))return t+="bu"+e,!1}),a.find(".delete-content-cb").prop("checked")&&a.find(".delete-content-dd option").each(function(e){if(l(this).prop("selected"))return t+="dd"+e,!1}),t&&window.localStorage.setItem(c,t)}))},isVisible:function(e){return this.scroller.isVisible(e.element.get(0))},highlightUnseen:function(){for(var e=this.getLast();e;)e.comment.unseen&&(e.comment.highlight(),e.comment.unseen=!1),e=e.prev},getFirstUnseen:function(){for(var e=this.getLast();e;){if(!e.comment.unseen){var t=e.next;return t?t.comment:null}e=e.prev}return null},initExpandComments:function(){var n=this;l(".comments_i",this.container).each(function(e,t){n.getComment(l(t)).initExpand()})}},e}),define("OK/discussions/TypingStatus",["jquery"],function(s){function e(e,t){this.element=e,this.discussion=t,this.currentStatus=0,this.typingUsers=[]}function t(e){var t="",n="";return s.each(e,function(){var e=this.uf;e&&(t+=n,t+=e,n=", ")}),t}return e.prototype={init:function(){return this.inited||(this.usersContainer=s(".comments-typing_tx",this.element),this.inited=!0),this},show:function(){var e=this.discussion.scrollController.isScrolledToBottom();return this.element.removeClass("invisible"),e&&this.discussion.scrollController.scrollToBottom(),this},hide:function(){return this.element.addClass("invisible"),this},setTypingUsers:function(e){return this.typingUsers=e,this.show().setStatus(0).usersContainer.html(t(e)),this},removeUser:function(n){var i=this;s.each(this.typingUsers,function(e,t){if(parseInt(this.ul,10)===n)return i.typingUsers.splice(e,1),!1}),0===this.typingUsers.length?this.hide():this.usersContainer.html(t(this.typingUsers))},setStatus:function(e){return s(".comments-typing",this.element).removeClass("__status-"+this.currentStatus).addClass("__status-"+e),this.currentStatus=e,this}},e}),define("OK/utils/textchange",["jquery"],function(n){return n.event.special.textchange={setup:function(e,t){n(this).data("lastValue","true"===this.contentEditable?n(this).html():n(this).val()),n(this).bind("keyup.textchange",n.event.special.textchange.handler),n(this).bind("cut.textchange paste.textchange input.textchange",n.event.special.textchange.delayedHandler)},teardown:function(e){n(this).unbind(".textchange").removeData("lastValue")},handler:function(e){n.event.special.textchange.triggerIfChanged(n(this))},delayedHandler:function(e){var t=n(this);setTimeout(function(){n.event.special.textchange.triggerIfChanged(t)},25)},triggerIfChanged:function(e){var t="true"===e[0].contentEditable?e.html():e.val();t!==e.data("lastValue")&&(e.trigger("textchange",[e.data("lastValue")]),e.data("lastValue",t))}},n.event.special.textchange}),define("OK/Discussion",["require","jquery","OK/DiscussionManager","OK/discussions/ScrollController","OK/discussions/CommentsList","OK/discussions/CommentForm","OK/discussions/TypingStatus","OK/utils/textchange","OK/utils/utils"],function(t){var n,r=t("jquery"),i=t("OK/DiscussionManager"),o=t("OK/discussions/ScrollController"),a=t("OK/discussions/CommentsList"),c=t("OK/discussions/CommentForm"),s=t("OK/discussions/TypingStatus"),l=(t("OK/utils/textchange"),t("OK/utils/utils")),u={containerId:null,commentsListContainerId:null,commentAreaId:null,commentAreaCounterId:null,commentAreaContainerId:null,scrollingContainerId:null,lastCommentsUrl:null,isStickyForm:!0,stickyContainerId:null,isFormActiveByDefault:!1,mentionsEnabled:!1,groupMentionsEnabled:!1,mentionsCharStart:3,participantsSearchEnabled:!1,batchUnsubscribe:!1},h={};function d(){var e=Object.keys(h);h={},l.ajax({url:"/dk?cmd=DiscussionsUnsubscribe",data:{"st.dIds":e.join(",")}})}function e(e,t,n,i,s){this.id=t,this.type=n,this.element=e,this.options=r.extend({},u,s||{}),n=r(".comments_cnt",this.element),e=r(".comments_sticky",this.element),s=r(".js-addFormContainer",this.element),this.elements={container:n,commentsListContainer:r(".comments_lst_cnt",this.element),commentArea:r(".js-comments_add",s),commentAreaContainer:r(".js-comments_form",s),stickyContainer:e,stickyContainerParent:e.parent(),scrollingContainer:this.options.scrollingContainerId?document.getElementById(this.options.scrollingContainerId):window},this.scrollController=new o(this.elements,this.options.loaderId),this.setCount(i)}return e.prototype={getId:function(){return this.type+"_"+this.id},getId2:function(){return this.id+"_"+this.type},getTypeString:function(){return this.typeString||(this.typeString=this.element.attr("data-types"))},focusForm:function(e,t){this.form.focus()},init:function(){var s=this;if(r.data(this.element,"instance"))return this;var e=s.form=new c(s.elements.commentArea,s,s.elements);(s.list=new a(s.elements.commentsListContainer[0],s.scrollController,s)).init(),e.init().textarea.one("focus",function(){e.onStateChange(function(e){var t;e!=c.states.active&&e!=c.states.error||(t=s.elements.stickyContainer.outerHeight(),s.elements.stickyContainer.parent().css({minHeight:t}),s.elements.stickyContainer.each(function(){s.scrollController.isVisibleBottomOf(this)||s.isPanelSticky()||s.scrollController.scroll(t)}))})});var o,t=r("#mtLayer");0<s.element.closest(t).length&&t.one("mtLayer.close",function(){s.unsubscribe(),s.editMode(!1)}),r(".js-friendsList",this.element).on("click",".js-name",function(e){var t=r(this),n=t.attr("data-uid");function i(){var e=s.list.findCommentsFromAuthor(n);return r.each(e,function(){this.highlight(!0)}),0<e.length&&s.scrollController.scrollToTopOf(e[0].element.get(0)),0<e.length}OK.logging.logger.success("discussions.findFriendComment","click"),i()?OK.logging.logger.success("discussions.findFriendComment","foundCurrentPage"):s.scrollController.load(t.attr("href")).done(i).fail(function(e){e.responseText&&(e=e.responseText),o||(o=r(document.createElement("div"))).prependTo(s.element),o.html(e).find(".tipDiscussion").addClass("__active"),setTimeout(function(){r(".tipDiscussion",o).removeClass("__active")},3e3),OK.logging.logger.success("discussions.findFriendComment","notFound")}),e.preventDefault()}).on("click",".js-showAll",function(e){r(this).addClass("invisible"),r(".js-nameCnt",e.delegateTarget).removeClass("invisible")});var n,t=s.element.data("cid");return!t||(n=s.list.findComment(t))&&n.element.each(function(){s.scrollController.scrollToCenter(this),n.highlight(!0)}),this},destroy:function(){this.needToUnsubscribe()&&this.unsubscribe(),this.editMode(!1),this.replyMode(!1);var e=r(".js-friendsList",this.element);e.off("click",".js-name"),e.off("click",".js-showAll"),this.element.removeData(),this.form.destroy(),this.list.destroy(),this.elements.container.off(),this.stickyPanel&&this.stickyPanel.deactivate()},post:function(e,t){var n=this;return n.list.addNewComment(e,t).done(function(e){n.updateCount(1),n.scrollController.trigger(),e&&n.pen&&n.pen.removeUser(e.userId)})},postPush:function(e,t,n){this.post(e,t)},replyMode:function(e,t){var n=this.form,i=this.list;e?(n.activateReplyMode(t),i.selectComment(t)):(n.deactivateReplyEditMode(),i.deselectComment())},editMode:function(e,t){var n=this.form,i=this.list;e?(n.activateEditMode(t),i.selectComment(t)):(n.deactivateReplyEditMode(),i.deselectComment())},refresh:function(e){if(this.options.lastCommentsUrl){var t=this.list,n={"gwt.requested":window.pageCtx.gwtHash},t=t.getLast();t&&r.extend(n,{"st.cId1":t.comment.id});e={type:"POST",headers:{TKN:OK.tkn.get()},data:r.extend(n,{"st.dCo":e||1}),url:this.options.lastCommentsUrl.replace(/&amp;/g,"&")};return r.ajax(e)}},updateComment:function(e){this.list.updateComment(e)},subscribe:function(){i.add(this)},unsubscribe:function(){var e;this.options.batchUnsubscribe?(n&&clearTimeout(n),h[this.getId2()]=!0,n=setTimeout(d,1e3)):(e=this.element.attr("data-unurl"))&&l.ajax({url:e}),i.remove(this)},showLatest:function(e){var t=this;this.scrollController.hasMore()?this.scrollController.loadMore().done(function(){t.markAsRead(),t.pen&&t.pen.hide()}):((e||this.list.getLast().comment).element.each(function(){t.options.isStickyForm?t.scrollController.scrollToCenter(this):t.scrollController.scrollTo(this)}),t.markAsRead(),t.list.highlightUnseen())},toggleStickyPanel:function(e){e||this.elements.stickyContainer.removeClass("__on").addClass("__off"),this.scrollController.trigger()},isPanelSticky:function(){return this.stickyPanel&&this.stickyPanel.isStickyOn()},updateCount:function(e){this.setCount(this.commentsCount+e)},setCount:function(e){var n,i=this;this.commentsCount=Math.max(e,0),r(".comments_h",this.element).each(function(){var e=r(this),t=e.find(".lstp-t");e.toggleClass("__hidden",i.commentsCount<1),t.html(i.commentsCount.toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1&nbsp;"))}),t(["OK/CommentWidgets"],function(e){e.setCount(i.id,i.type,i.commentsCount)}),0<this.commentsCount&&(this.element.removeClass("__empty"),(n=i).options.isStickyForm&&t(["OK/StickyPanel"],function(e){var t=r(".comments_first_sep",n.elements.container);0===t.length&&(t=n.elements.container),n.stickyPanel=new e,n.stickyPanel.activateWithOptions(n.elements.stickyContainer,{container:n.elements.scrollingContainer,bound:t})}),this.form&&this.form.initAutosize())},deleteComment:function(e,t){this.list.deleteStub(e,t),this.updateCount(-1),this.scrollController.trigger()},restoreComment:function(){this.updateCount(1)},markAsRead:r.noop,setTypingUsers:function(e){this.pen||(this.pen=new s(r(".comments_pen_cnt",this.element),this),this.pen.init()),this.pen.setTypingUsers(e)},resetTypingStatus:function(){this.pen&&this.pen.hide()},setTypingStatus:function(e){this.pen&&this.pen.setStatus(e)},processNewComments:function(e){var n=this;e.done(function(e){n.form.whenPosted(function(){!n.scrollController.hasMore()&&e&&(n.scrollController.isVisibleBottomOf(n.element[0])&&n.markAsRead(),r(e).each(function(){var e=r(this),t=e.attr("data-wId")||"nc"+Date.now(),e=n.postPush(t,e,!0===e.attr("data-own"));e&&e.done(function(e){n.processComment(e)})}))})})},processComment:function(e){null!=e&&(this.list.isVisible(e)?e.highlight():(e.unseen=!0,this.form.showNotificationAboutNew(this.list.getFirstUnseen())))},needToSubscribe:function(){return!0},needToUnsubscribe:function(){return!0}},e}),define("OK/utils/delegate",[],function(){"use strict";function t(e){this.listenerMap=[{},{}],e&&this.root(e),this.handle=t.prototype.handle.bind(this)}t.prototype.root=function(e){var t,n=this.listenerMap;if(this.rootElement){for(t in n[1])n[1].hasOwnProperty(t)&&this.rootElement.removeEventListener(t,this.handle,!0);for(t in n[0])n[0].hasOwnProperty(t)&&this.rootElement.removeEventListener(t,this.handle,!1)}if(!e||!e.addEventListener)return this.rootElement&&delete this.rootElement,this;for(t in this.rootElement=e,n[1])n[1].hasOwnProperty(t)&&this.rootElement.addEventListener(t,this.handle,!0);for(t in n[0])n[0].hasOwnProperty(t)&&this.rootElement.addEventListener(t,this.handle,!1);return this},t.prototype.captureForType=function(e){return-1!==["blur","error","focus","load","resize","scroll"].indexOf(e)},t.prototype.on=function(e,t,n,i){var s,o,r;if(!e)throw new TypeError("Invalid event type: "+e);if("function"==typeof t&&(i=n,n=t,t=null),void 0===i&&(i=this.captureForType(e)),"function"!=typeof n)throw new TypeError("Handler must be a type of Function");s=this.rootElement,(o=this.listenerMap[i?1:0])[e]||(s&&s.addEventListener(e,this.handle,i),o[e]=[]);for(var a,i=t?/^[a-z]+$/i.test(t)?(r=t,d):/^#[a-z0-9\-_]+$/i.test(t)?(r=t.slice(1),m):(r=t,h):(r=null,function(e,t){return this.rootElement===window?t===document:this.rootElement===t}.bind(this)),c=o[e],l=!1,u=c.length-1;0<=u;u--)if(a=c[u],!(t&&t!==a.selector||n&&n!==a.handler)){l=!0;break}return l||c.push({selector:t,handler:n,matcher:i,matcherParam:r}),this},t.prototype.off=function(e,t,n,i){var s,o,r,a,c;if("function"==typeof t&&(i=n,n=t,t=null),void 0===i)return this.off(e,t,n,!0),this.off(e,t,n,!1),this;if(r=this.listenerMap[i?1:0],!e){for(c in r)r.hasOwnProperty(c)&&this.off(c,t,n);return this}if(!(a=r[e])||!a.length)return this;for(s=a.length-1;0<=s;s--)o=a[s],t&&t!==o.selector||n&&n!==o.handler||a.splice(s,1);return a.length||(delete r[e],this.rootElement&&this.rootElement.removeEventListener(e,this.handle,i)),this},t.prototype.handle=function(e){var t,n,i,s,o,r,a=e.type,c=[];if(!0!==e.ftLabsDelegateIgnore){switch(3===(r=e.target).nodeType&&(r=r.parentNode),i=this.rootElement,e.eventPhase||(e.target!==e.currentTarget?3:2)){case 1:c=this.listenerMap[1][a];break;case 2:this.listenerMap[0]&&this.listenerMap[0][a]&&(c=c.concat(this.listenerMap[0][a])),this.listenerMap[1]&&this.listenerMap[1][a]&&(c=c.concat(this.listenerMap[1][a]));break;case 3:c=this.listenerMap[0][a]}for(n=c.length;r&&n;){for(t=0;t<n&&(s=c[t]);t++)if(!1===(o=s.matcher.call(r,s.matcherParam,r)?this.fire(e,r,s):o))return e.ftLabsDelegateIgnore=!0,void e.preventDefault();if(r===i)break;n=c.length,r=r.parentElement}}},t.prototype.fire=function(e,t,n){return n.handler.call(t,e,t)};var h=function(e){if(e){e=e.prototype;return e.matches||e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector}}(Element);function d(e,t){return e.toLowerCase()===t.tagName.toLowerCase()}function m(e,t){return e===t.id}return t.prototype.destroy=function(){this.off(),this.root()},t}),define("OK/AbstractShortcutMenu",["OK/utils/dom","OK/utils/vanilla","OK/utils/delegate"],function(v,i,t){"use strict";var n=null,e=document.createElement("div");function s(){this.holder=null,this.menuElement=null,this.showTimeout=null,this.hideTimeout=null,this.ajaxRequest=null,this.direction="",this.position="center",this._visible=!1,this.inplace=!1,this.detectScrollableContainer=!1,this.menuElementHoverInListenerCalled=!1}return e.id="hook_Block_ShortcutMenu",document.body.appendChild(e),OK.hookModel.captureBlockHook("body",e),e.addEventListener("change",function(){n&&n.visible()&&n.positingElement()}),s.getActiveInstance=function(){return n},s.setActiveInstance=function(e){n=e},s.getBlockId=function(){return"ShortcutMenu"},s.prototype.getBlock=function(){return this.inplace?this.block:e},s.prototype.getHtml=function(){},s.prototype.initListeners=function(e){this.shortcutMenuDelegate=new t(e),this.shortcutMenuDelegate.on("click",".sc-menu a",this.menuElementLinkClickListener.bind(this)),this.shortcutMenuDelegate.on("click",".sc-menu .js-hide",this.menuElementClickListener.bind(this)),this.shortcutMenuDelegate.on("click",".js-forceHide",function(e,t){this.hideMenu({forceHide:!t.classList.contains("js-supress-forceHide")})}.bind(this)),this.shortcutMenuDelegate.on("mouseenter",this.menuElementHoverInListener.bind(this)),this.shortcutMenuDelegate.on("mouseleave",this.hoverOutListener.bind(this)),OK.device.isTouch&&this.shortcutMenuDelegate.on("touchstart",this.holderTouchStartListener.bind(this))},s.prototype.processHTML=function(e){var t=[];this.inplace?(this.initBlock(),t[0]=this.blockId):t[0]=s.getBlockId();var n=this.getBlock();i.updateBlocks(e,t),this.initListeners(n),this.menuElement=v.firstByClass(n,"sc-menu"),this.positingElement(),this.menuElement.classList.remove("sc-menu__hidden"),this.holder.classList.add("__vis"),s.setActiveInstance(this),this._visible=!0},s.prototype.showMenu=function(){clearTimeout(this.hideTimeout),this.showTimeout=null,this.visible()||(n&&n.hide(),this.processHTML(this.getHtml()),i.trigger(this.holder,"shortcut-menu-show"),this.hideOnScroll&&(this.oneScrollListener={element:this.getClosestScrollable(!0),type:"scroll",handler:this.hoverOutListener.bind(this)},this.oneScrollListener.element.addEventListener("scroll",this.oneScrollListener.handler)))},s.prototype.hideMenu=function(e){this.clearShowTimeout(),this.clearHideTimeout(),i.trigger(this.holder,"shortcut-menu-hide",e),this.menuElement&&(this.menuElement.classList.add("sc-menu__hidden"),OK.hookModel.setHookContent("ShortcutMenu",""),this.menuElement=null),this.holder.classList.remove("__vis"),this.shortcutMenuDelegate&&this.shortcutMenuDelegate.off(),this._visible=!1,this.removeOneTimeListener(this.oneScrollListener),s.setActiveInstance(null)},s.prototype.hide=function(){this.clearShowTimeout(),this.clearHideTimeout(),this.menuElement&&this.hideMenu()},s.prototype.getClosestScrollable=function(n){var i,e;return this.closestScrollable||(i=/(auto|scroll)/,e=v.traverseParents(this.holder,function(e){var t=window.getComputedStyle(e);return i.test(t.overflow+t.overflowY+t.overflowX)&&(!n||e.scrollHeight>e.clientHeight)}),this.closestScrollable=e||window),this.closestScrollable},s.prototype.isTopDirection=function(e,t){var n=this.holder.getBoundingClientRect().top;if(this.detectScrollableContainer){var i=this.holder.getBoundingClientRect().height,s=this.getClosestScrollable(),o=n-s.getBoundingClientRect().top,r=s.clientHeight-i,i=s.scrollTop+o+i+t,s=s.scrollHeight;return r/2<o||s<i}return window.innerHeight-e-n<t},s.prototype.isInsideViewportWhileCentered=function(e){var t,n=this.holder.getBoundingClientRect(),i=n.left,s=window.innerWidth-OK.scrollBar.width;this.detectScrollableContainer&&(i-=(t=this.getClosestScrollable().getBoundingClientRect()).left,s=t.right);n=i+(n.width-e)/2;return 0<n&&n+e<s},s.prototype.toRightFromHolder=function(e,t){if(this.detectScrollableContainer){var n=this.getClosestScrollable().getBoundingClientRect(),i=this.holder.getBoundingClientRect().left-n.left;return n.width/2>i}return window.innerWidth-OK.scrollBar.width>e.left+t},s.prototype.visible=function(){return this._visible},s.prototype.getOffset=function(e){e=e.getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset}},s.prototype.positingElement=function(){var e=v.outerSize(this.holder,!1,!1),t=this.inplace?{top:0,left:0}:this.getOffset(this.holder),n=v.outerSize(this.holder,!0,!1),i=v.outerSize(this.menuElement,!0,!0),s=this.position;"center"!==(s="center"===s&&!this.isInsideViewportWhileCentered(i)?"auto":s)&&"auto"!==s&&this.menuElement.classList.add("__noarrow");var o=v.outerSize(this.menuElement,!1,!0),r="top_force"===this.direction||"bottom_force"===this.direction?"top_force"===this.direction:"top"===this.direction?this.getOffset(this.holder).top-window.pageYOffset-90>o:"bottom"!==this.direction&&this.isTopDirection(e,o),a=t.top,c=[];r?(this.menuElement.classList.add("sc-menu__top"),this.inplace?c.push("top: auto; bottom: "+Math.round(a+e)+"px;"):(a-=o,c.push("bottom: auto; top: "+Math.round(a)+"px;"))):(this.menuElement.classList.remove("sc-menu__top"),this.inplace||(a+=e),c.push("bottom: auto; top: "+Math.round(a)+"px;"));var l=Math.round(t.left-(i-n)),u=Math.round(t.left),h=Math.round(t.left+(n-i)/2);switch(s){case"left":c.push("left: "+l+"px;");break;case"right":c.push("left: "+u+"px;");break;case"auto":var d,m=v.firstByClass(this.menuElement,"entity-shortcut-menu_arw"),f=0,g=m?54:0,p=this.toRightFromHolder(t,i);p?(this.menuElement.classList.remove("__right"),this.menuElement.classList.add("__left")):(this.menuElement.classList.add("__right"),this.menuElement.classList.remove("__left")),!g&&(m=v.firstByClass(this.menuElement,"sc-menu_arw"))&&(d=m.getBoundingClientRect()).width&&(m=this.menuElement.getBoundingClientRect(),g=p?2*(d.left-m.left)+d.width:2*(m.left+m.width-(d.left+d.width))+d.width),n<g&&(f=(g-n)/2),p?c.push("left: "+(u-f)+"px;"):c.push("left: "+(l+f)+"px;");break;default:c.push("left: "+h+"px;")}this.menuElement.setAttribute("style",c.join(""))},s.prototype.ajaxClose=function(e){this.ajaxRequest&&(this.ajaxRequest.xhr.abort(),this.ajaxRequest=null,"function"==typeof e&&e())},s.prototype.hoverInListener=function(e){OK.device.isTouch&&e||(n!==this&&(n&&n.hide(),s.setActiveInstance(this)),this.clearHideTimeout(),this.showTimeout||this.visible()||(this.showTimeout=setTimeout(this.showMenu.bind(this),this.showDelay)))},s.prototype.hoverOutListener=function(){this.clearShowTimeout(),this.ajaxClose(),!this.hideTimeout&&this.visible()&&(this.hideTimeout=setTimeout(function(){this.hideOnBlurElement!==document.activeElement?this.hideMenu():this.hideTimeout=null}.bind(this),this.hideDelay))},s.prototype.menuElementHoverInListener=function(){this.menuElementHoverInListenerCalled=!0,this.hideTimeout&&(this.hideTimeout=clearTimeout(this.hideTimeout))},s.prototype.menuElementLinkClickListener=function(e){v.parent(e.target,"js-doNotHide",this.block)||this.menuElementClickListener()},s.prototype.menuElementClickListener=function(){!0===this.hideTimeout&&(this.hideTimeout=null),this.hoverOutListener()},s.prototype.holderTouchStartListener=function(e){e.stopPropagation()},s.prototype.clearShowTimeout=function(){this.showTimeout&&(this.showTimeout=clearTimeout(this.showTimeout))},s.prototype.clearHideTimeout=function(){this.hideTimeout&&(this.hideTimeout=clearTimeout(this.hideTimeout))},s.prototype.removeOneTimeListener=function(e){e&&e.element.removeEventListener(e.type,e.handler)},s}),define("OK/discussions/CommentFormAuthorMenu",["OK/utils/dom","OK/AbstractShortcutMenu"],function(r,a){"use strict";function e(){}return e.prototype={activate:function(e){var s=this;if(s.container=e,s.compId=e.getAttribute("data-compId"),s.author=document.getElementById(s.compId),s.authorAvatar=r.firstByClass(s.author,"js-comments_author-avatar"),s.authorName=r.firstByClass(s.author,"js-comments_author-name"),s.author&&(s.commentsForm=r.parent(s.author,"js-comments_form")),s.commentsForm){s.clickHandler=function(e){var t,n,i;t=s,n=e,i=r.parent(n.target,"js-comments_authormenu-card"),e=r.firstByClass(i,"js-comments_authormenu-avatar"),i&&e&&(t.commentsForm.setAttribute("data-author-groupId",i.getAttribute("data-groupId")),t.commentsForm.setAttribute("data-author-json",i.getAttribute("data-json")),t.authorAvatar&&(t.authorAvatar.innerHTML=e.innerHTML),t.authorName&&(t.authorName.innerHTML=i.getAttribute("data-name")),r.byClass(t.container,"js-comments_authormenu-card").forEach(function(e){e.classList.remove("__selected")}),i.classList.add("__selected"),(i=a.getActiveInstance())&&i.hide(),n.stopPropagation())},s.container.addEventListener("click",s.clickHandler);e=r.firstByClass(s.commentsForm,"iblock-cloud");e&&e.classList.remove("__active");for(var t=s.commentsForm.getAttribute("data-author-groupId"),n=r.byClass(s.container,"js-comments_authormenu-card"),i=0;i<n.length;i++){var o=n[i].getAttribute("data-groupId");if(!o&&!t||t==o){n[i].classList.add("__selected");break}}}},deactivate:function(){this.container&&this.clickHandler&&this.container.addEventListener("click",this.clickHandler)}},e}),define("OK/discussions/Reveal",["OK/utils/dom"],function(s){return{expand:function(e){s.firstByClass(e,"comments_text").classList.remove("__reveal-2","__reveal-3"),s.firstByClass(e,"comments_text_more").classList.add("invisible")},activate:function(e){var t,n,i=s.firstByClass(e,"comments_text");i&&(t=parseInt(i.getAttribute("data-max-lines"),10),isNaN(t)||(n=s.firstByClass(e,"comments_text_more"),e=parseInt(window.getComputedStyle(i)["line-height"],10)||21,i.firstChild.clientHeight/e>t+1?n.classList.remove("invisible"):i.classList.remove("__reveal-2","__reveal-3")))}}}),define("OK/discussions/Mentions",[],function(){"use strict";function e(e,t){this.element=t,this.textarea=document.getElementById(t.getAttribute("data-bind"))}function t(){this.hasFocus&&(this.selection=function(){var e=window.getSelection(),t=[];if(e.rangeCount)for(var n=0,i=e.rangeCount;n<i;++n)t.push(e.getRangeAt(n));return t}())}function n(){var e,t,n,i,s=this,o=window.getSelection();this.selection?function(e){var t=window.getSelection();t.removeAllRanges();for(var n=0,i=e.length;n<i;++n)t.addRange(e[n])}(this.selection):((t=document.createRange()).selectNodeContents(this.textarea),t.collapse(!0),this.selection=[t],o.removeAllRanges(),o.addRange(t)),o.getRangeAt&&o.rangeCount&&(e=o.anchorNode&&o.anchorNode.nodeType===Node.TEXT_NODE&&/\s+$/.test(o.anchorNode.textContent),t=document.createTextNode(" "),n=document.createTextNode("@"),(i=o.getRangeAt(0)).deleteContents(),i.insertNode(n),0===o.anchorOffset||e||i.insertNode(t),setTimeout(function(){i.setStart(n,1),i.collapse(!0),o.removeAllRanges(),o.addRange(i),s.textarea.focus();var e=document.createEvent("Event");e.initEvent("keyup",!0,!0),s.textarea.dispatchEvent(e)},10))}return e.prototype={activate:function(){this.textarea.addEventListener("focus",this.focusListener=function(){this.hasFocus=!0}.bind(this)),this.textarea.addEventListener("change",this.textareaListener=t.bind(this)),this.textarea.addEventListener("mouseup",this.textareaListener),this.textarea.addEventListener("keyup",this.textareaListener),this.textarea.addEventListener("blur",this.blurListener=function(){this.hasFocus=!1}.bind(this)),this.element.addEventListener("click",this.clickListener=n.bind(this))},deactivate:function(){this.element.removeEventListener("click",this.clickListener),this.textarea.removeEventListener("focus",this.focusListener),this.textarea.removeEventListener("blur",this.blurListener),this.textarea.removeEventListener("change",this.textareaListener),this.textarea.removeEventListener("mouseup",this.textareaListener),this.textarea.removeEventListener("keyup",this.textareaListener)}},e}),define("b/discussions",["require","OK/Discussion","OK/DiscussionManager","OK/discussions/ScrollController","OK/discussions/Comment","OK/discussions/CommentEntry","OK/discussions/CommentsList","OK/discussions/CommentForm","OK/discussions/CommentFormAuthorMenu","OK/discussions/LinkAttachController","OK/discussions/TypingStatus","OK/utils/textchange","OK/discussions/Reveal","OK/discussions/Mentions"],function(e){"use strict";return e("OK/Discussion"),e("OK/DiscussionManager"),e("OK/discussions/ScrollController"),e("OK/discussions/Comment"),e("OK/discussions/CommentEntry"),e("OK/discussions/CommentsList"),e("OK/discussions/CommentForm"),e("OK/discussions/CommentFormAuthorMenu"),e("OK/discussions/LinkAttachController"),e("OK/discussions/TypingStatus"),e("OK/utils/textchange"),e("OK/discussions/Reveal"),e("OK/discussions/Mentions"),function(){}});
