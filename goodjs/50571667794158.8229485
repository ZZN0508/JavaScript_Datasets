var promoTracker={fireGTM:function(){var o,r;0!==promoTracker.gridOffsets.length&&(o=[],r=[],$.each(promoTracker.gridOffsets,function(t,e){$(e).find(".active .js-promo-body-title:visible, .active-promo p:visible, .js-promo-two-ways-title:visible").text()&&$(e).offset().top<window.pageYOffset+window.innerHeight?o.push($(e)):r.push(e)}),promoTracker.gridOffsets=r,$.each(o,function(t,e){var o={event:"ad_impression",site_section:promoTracker.siteSection};o.placement=e.attr("data-location")?e.attr("data-location"):"grid",o.type="promo",e.hasClass("js-promo-top")?o.title=promoTracker.getCleanText(e.find("p:visible, .js-promo-two-ways-title:visible").first()):e.hasClass("js-promo-body")&&(o.title=promoTracker.getCleanText(e.find(".active .js-promo-body-title:visible"))),dataLayer.push(o)}))},getCleanText:function(t){return t.text().replace(/\s+/g," ")},init:function(){dataLayer&&dataLayer[0]&&dataLayer[0].site_section&&(this.siteSection=dataLayer[0].site_section),this.promoTop(),this.promoBody(),promoTracker.gridOffsets=$(".js-promo-top, .js-promo-body"),$(window).scroll(webutils.debounce(promoTracker.fireGTM,300))},mavsSet:!1,addDL:function(t){var e=$(this).attr("href"),o=$(this).attr("target");dataLayer&&dataLayer.push(t),e&&webutils.redirect(e,o)},promoTop:function(){var t,o=$(".js-promo-top");o.length&&(t=setInterval(function(){var e;o.find(".active-promo p:visible, .js-promo-two-ways-title:visible")&&(promoTracker.fireGTM(),e={event:"ad_click",site_section:promoTracker.siteSection,placement:o.attr("data-location"),type:"promo",title:promoTracker.getCleanText(o.find(".active-promo p:visible, .js-promo-two-ways-title:visible").first())},o.find(".cta, .anchor").click(function(t){t.preventDefault(),promoTracker.addDL.call(this,e)}),clearTimeout(t))},500))},promoBody:function(){var t,o=$(".js-promo-body");o.length&&(t=setInterval(function(){o.find(".active .js-promo-body-title:visible")&&(promoTracker.fireGTM(),o.find("a").click(function(t){var e;t.preventDefault(),e=$(this).parents(".js-promo-body").find(".js-promo-body-title").length<2?(e=$(this).parents(".js-promo-body"),{event:"ad_click",site_section:promoTracker.siteSection,placement:e.attr("data-location"),type:"promo",title:promoTracker.getCleanText(e.find(".js-promo-body-title"))}):{event:"ad_click",site_section:promoTracker.siteSection,placement:o.attr("data-location"),type:"promo",title:promoTracker.getCleanText(o.find(".active .js-promo-body-title:visible"))},promoTracker.addDL.call(this,e)}),clearTimeout(t))},500))}};promoTracker.init();
