YUI.add("flickr-photosets-getPhotos-fetcher",function(c,s){"use strict";var o=require("hermes-core/flog")(s);c.namespace("ListFetchers")["flickr-photosets-getPhotos"]={run:function(t,e){var o=this;return c.Promise.all([e.callAPI("flickr.photosets.getPhotos",this._processParams(t),!0),e.getModelRegistry("photo-models"),e.getModelRegistry("person-models"),e.getModelRegistry("set-models"),e.getModelRegistry("photo-engagement-models"),e.getModelRegistry("photo-stats-models"),e.getModelRegistry("album-privacy-models")]).then(function(e){return o._processResponse(e,t)},c.FetcherErrorLogger(s))},_processParams:function(e){e.page=e.page||1,e.perPage=e.perPage||100;var t={extras:c.APIHelper.request.getRebootPhotoExtras(),per_page:e.perPage,page:e.page,get_user_info:1,primary_photo_extras:"url_c, url_h, url_k, url_l, url_m, url_n, url_o, url_q, url_s, url_sq, url_t, url_z, needs_interstitial, can_share",jump_to:e.withPhotoId||""};return e.gpCode&&null!==e.gpCode?(t.gp_code=e.gpCode,t.share_code=e.gpCode,t.gp_owner=e.gpOwner,o.info("Calling sets api with GP "+e.gpCode)):t.photoset_id=e.id.split("-")[0],e.includeHiddenSets&&(t.extras+=",hidden_sets",t.user_id=e.userId),e.viewAs&&(t.view_as=e.viewAs),e.filter&&(t.privacy_filter=e.filter),e.moderationFilter&&(t.moderation_filter=e.moderationFilter),t},_processResponse:function(e,t){var o=e[0],s=e[1],r=e[2],i=e[3],n=e[4],a=e[5],l=e[6],p=[],d=!1,h=!1,u=t.id,e=c.APIHelper.response.parsePerson(o.user),e=r.addOrUpdate(e),e={id:t.id,title:o.photoset.title,description:o.photoset.description,owner:e,primary:o.photoset.primary,primaryPhotoSizes:c.APIHelper.response.parsePrimaryPhotoSizes(o.photoset),isAutoUploadSet:o.photoset.isAutoUploadSet,isSharedEntity:o.photoset.hidden&&1===o.photoset.hidden,photoCount:o.photoset.photoCount,videoCount:o.photoset.videoCount,publicPhotosCount:o.photoset.countPhotosPublic,primaryNeedsInterstitial:o.photoset.needsInterstitial,totalCount:parseInt(o.photoset.photoCount,10)+parseInt(o.photoset.videoCount,10),photoList:[],viewCount:o.photoset.countViews,canShare:o.photoset.canShare+(o.photoset.canShareDeep||0),canDownload:o.photoset.canDownload};u&&u!==o.photoset.id&&(e.id=u),"1"===o.photoset.isAutoUploadSet&&(e.canShare=!1),i.exists(t.id)&&(d=!!(u=i.getValue(t.id,"photoPageList")).hasMinBoundary&&u.hasMinBoundary(),h=!!u.hasMaxBoundary&&u.hasMaxBoundary(),p=u.getList()),a=c.APIHelper.response.parsePhotos({photos:o.photoset.photo,ownerID:o.photoset.owner,personModelRegistry:r,photoModelRegistry:s,photoEngagementModelRegistry:n,photoStatsModelRegistry:a}),e.photoPageList=c.APIHelper.response.addOrReplaceListByPage({current:p,perPage:t.perPage,pageNum:t.page,hasMax:h,hasMin:d,totalItems:o.photoset.total,newPages:a}),e.photoPageList={perPage:o.photoset.perPage,page:o.photoset.page,pageContent:a,totalItems:o.photoset.total},e.photoList.length&&(e.primary=o.photoset.primary);o={id:e.id,countPhotosFamily:o.photoset.countPhotosFamily,countPhotosFriend:o.photoset.countPhotosFriend,countPhotosPublic:o.photoset.countPhotosPublic,countPhotosFriendFamily:o.photoset.countPhotosFriendFamily,totalCount:o.photoset.countPhotosAll};return l.exists(o.id)?l.setValues(t.id,o):l.add(o),i.exists(e.id)?i.setValue(t.id,"photoPageList",e.photoPageList):i.add(e),a}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","set-models","photo-engagement-models","photo-stats-models"]}),YUI.add("flickr-photosets-getContext-fetcher",function(u,s){"use strict";u.namespace("ListFetchers")["flickr-photosets-getContext"]={run:function(t,e){var o=this;return u.Promise.all([e.callAPI("flickr.photosets.getContext",this._processParams(t,e),!0),e.getModelRegistry("set-models"),e.getModelRegistry("photo-models"),e.getModelRegistry("person-models"),e.getModelRegistry("photo-engagement-models"),e.getModelRegistry("photo-stats-models")]).then(function(e){return o._processResponse(e,t)},function(e){throw 2===e.code&&"Photo not in set"===e.message&&(e.notInContext=!0),e}).then(null,u.FetcherErrorLogger(s))},_processParams:function(e,t){var o={extras:u.APIHelper.request.getRebootPhotoExtras(),photo_id:e.photoId,num_prev:e.numNext,num_next:e.numPrev,get_photoset_info:1};return e.gpCode?(o.share_code=e.gpCode,o.share_owner=e.gpOwner,o.gp_code=e.gpCode,o.gp_owner=e.gpOwner):o.photoset_id=e.id,o},_processResponse:function(e,t){var o=e[0],s=e[1],r=e[2],i=e[3],n=e[4],a=e[5],l=[],p=r.proxy(t.photoId),e=o.prevphotos,o=o.nextphotos,d=u.APIHelper.response.parsePhotos({photos:e.photo,personModelRegistry:i,photoModelRegistry:r,photoEngagementModelRegistry:n,photoStatsModelRegistry:a}),l=u.APIHelper.response.parsePhotos({photos:o.photo,personModelRegistry:i,photoModelRegistry:r,photoEngagementModelRegistry:n,photoStatsModelRegistry:a}),r=s.getValue(t.id,"photoContextList"),n=!!r.hasMinBoundary&&r.hasMinBoundary(),a=!!r.hasMaxBoundary&&r.hasMaxBoundary(),r=r.getList(),h=u.APIHelper.response.addOrReplaceListByContext({model:p,next:d,prev:l.reverse(),current:r,hasMin:n,hasMax:a,numNext:t.numNext,numPrev:t.numPrev});return s.setValue(t.id,"photoContextList",h),{next:d,previous:l.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]}),YUI.add("flickr-photosets-create-creator",function(h,s){"use strict";h.namespace("ModelCreators")["flickr-photosets-create"]={run:function(d,e){var t={},o=[];return t.title=d.title,t.description=d.description,t.primary_photo_id=d.photoID,t.full_result=1,o=[e.callAPI("flickr.photosets.create",t),e.getModelRegistry("set-models"),e.getModel("person-models",e.getViewer().nsid),e.getModel("sets-models",e.getViewer().nsid,{page:1,perPage:e.flipper.isFlipped("enable-sets-list-loading-fix")?10:500}),e.getModelRegistry("photo-sets-models"),e.getModelRegistry("photo-contexts-models")],d.isMultiplePhotos||o.push(e.getModel("photo-models",d.photoID)),h.Promise.all(o).then(function(e){var t,o,s,r=e[0],i=e[1],n=e[2],a=e[3],l=e[4],p=e[5];return!!r.photoset.id&&(d.isMultiplePhotos?d.numberOfPhotosSelected+d.numberOfVideosSelected===1?(o=r.photoset.photos,s=r.photoset.videos):r.photoset.photos?(o=r.photoset.photos,s=0):(s=r.photoset.videos,o=0):(t=e[6],o=r.photoset.photos,s=r.photoset.videos),s={id:r.photoset.id,title:r.photoset.title.content,photoPageList:d.isMultiplePhotos?[]:[t],photoContextList:d.isMultiplePhotos?[]:[t],owner:n,primary:r.photoset.primary,primaryPhotoSizes:h.APIHelper.response.parsePrimaryPhotoSizes(r.photoset),isAutoUploadSet:!1,photoCount:o,videoCount:s,totalCount:1,viewCount:r.countViews||0},i.add(s),r=i.proxy(r.photoset.id),a.getValue("albumsList").unshift(r),l.exists(d.photoID)&&!l.getValue(d.photoID,"sets").getFromListByID(r.getValue("id"))&&(l.getValue(d.photoID,"sets").prependToList(r),l.setValue(d.photoID,"total",l.getValue(d.photoID,"total")+1)),p.exists(d.photoID)&&!p.getValue(d.photoID,"contexts").getFromListByID(r.getValue("id"))&&(p.setValue(d.photoID,"totalSets",p.getValue(d.photoID,"totalSets")+1),p.getValue(d.photoID,"contexts").appendToList(r)),r)},h.FetcherErrorLogger(s))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]}),YUI.add("flickr-photosets-createHidden-creator",function(r,i){"use strict";r.namespace("ModelCreators")["flickr-photosets-createHidden"]={run:function(e,t){var o,s={};return s.photo_ids=e.photoIds,o=[t.callAPI("flickr.photosets.createHidden",s),t.getModelRegistry("set-models"),t.getModel("person-models",t.getViewer().nsid)],r.Promise.all(o).then(function(e){var t=e[0],o=e[1],e=e[2];return!("ok"!==t.stat||!t.photoset.share_code)&&(t={id:t.photoset.share_code,shareCode:t.photoset.share_code,owner:e,gpCode:t.photoset.share_code,gpOwner:e.getValue("pathAlias")||e.getValue("nsid"),url:t.photoset.url,isAutoUploadSet:!1,isSharedEntity:!0,totalCount:t.photoset.count},o.add(t),o.proxy(t.id))},r.FetcherErrorLogger(i))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]}),YUI.add("flickr-photosets-editMeta-updater",function(r,i){"use strict";var n=require("hermes-core/flog")(i);r.namespace("ModelUpdaters")["flickr-photosets-editMeta"]={run:function(t,o){var e={},s=this;return e.photoset_id=t.photosetId,e.title=t.title,e.description=t.description,t.includeHiddenSets&&(e.extras="hidden_sets"),r.Promise.all([o.callAPI("flickr.photosets.editMeta",e),o.getModelRegistry("set-models")]).then(function(e){s._processResponse(e,t,o)},r.FetcherErrorLogger(i))},_processResponse:function(e,t,o){var s=e[0],e=e[1];if(s.photoset&&s.photoset.title&&s.photoset.description){if(!e.exists(t.photosetId))throw new Error("[flickr-photosets-editMeta-updater] - Set model cannot be updated if it does not exist");e.setValues(t.photosetId,{title:s.photoset.title.content,description:s.photoset.description.content})}else n.warn("No updated data returned from API.")}}},"@VERSION@",{requires:["flickr-promise"]}),YUI.add("flickr-photosets-setPrimaryPhoto-updater",function(s,r){"use strict";s.namespace("ModelUpdaters")["flickr-photosets-setPrimaryPhoto"]={run:function(e,t){var o={};return o.photoset_id=e.albumId,o.photo_id=e.photoId,t.callAPI("flickr.photosets.setPrimaryPhoto",o).then(null,s.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]}),YUI.add("set-models",function(s,e){function t(e){t.superclass.constructor.call(this,e)}var r=require("hermes-core/flog")(e);s.Models[this.name]=t,s.extend(t,s.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(e){return s.ListFetchers["flickr-photosets-getPhotos"].run(e,this.appContext)},create:function(e,t){return s.ModelCreators["flickr-photosets-create"].run(e,t)},createHidden:function(e,t){return s.ModelCreators["flickr-photosets-createHidden"].run(e,t)},addPhoto:function(e,t){return s.ModelCreators["flickr-photosets-addPhoto"].run(e,t)},removePhoto:function(e,t){return s.ModelCreators["flickr-photosets-removePhoto"].run(e,t)},update:function(e,t){return s.ModelUpdaters["flickr-photosets-editMeta"].run({photosetId:e,title:t.title?t.title.newVal:this.getValue(e,"title"),description:t.description?t.description.newVal:this.getValue(e,"description")},this.appContext)},setPrimaryPhoto:function(e,t){return s.ModelUpdaters["flickr-photosets-setPrimaryPhoto"].run(e,t)},delete:function(e){return s.ModelDeletors["flickr-photosets-delete-deletor"].run(e="string"==typeof e?{setID:e}:e,this.appContext)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},getSizeToFit:function(e,t,o){r.info("Using `getSizeToFit` is deprecated. See model comments for more details.");o=s.PhotoModelHelper.getSizeToFit(e,t,s.merge({sizes:this.getValue(e,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0},o));return o&&(o.url=o.src),o},getLargestPrimaryPhotoSize:function(e,t){return s.PhotoModelHelper.getLargestSize(e,t)},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"set"}},title:{validator:function(e,t){return s.AttributeHelpers.validateString(e)},setter:function(e){return s.AttributeHelpers.coerceString(e)},defaultValue:""},description:{validator:function(e,t){return s.AttributeHelpers.validateString(e)},setter:function(e){return s.AttributeHelpers.coerceString(e)},defaultValue:""},owner:{isModel:!0},isOwner:s.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:s.ListFetchers["flickr-photosets-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:s.ListFetchers["flickr-photosets-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(e){return s.AttributeHelpers.validateInteger(e)},setter:function(e){return s.AttributeHelpers.coerceInteger(e)}},videoCount:{validator:function(e){return s.AttributeHelpers.validateInteger(e)},setter:function(e){return s.AttributeHelpers.coerceInteger(e)}},publicPhotosCount:{validator:function(e){return s.AttributeHelpers.validateInteger(e)},setter:function(e){return s.AttributeHelpers.coerceInteger(e)}},totalCount:{validator:function(e){return s.AttributeHelpers.validateInteger(e)},setter:function(e){return s.AttributeHelpers.coerceInteger(e)},defaultFn:function(e){return this.getValue(e,"photoCount")+this.getValue(e,"videoCount")}},viewCount:{validator:function(e){return s.AttributeHelpers.validateInteger(e)},setter:function(e){return s.AttributeHelpers.coerceInteger(e)}},photoCountDisplay:{readOnly:!0,derivedBy:["totalCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),s=this.getValue(e,"totalCount"),e="";return 0==(t-=o)&&0===o?e=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1==t&&0===o?e=this.intlMessage({intlName:"models.ONE_PHOTO"}):1<t&&0===o?e=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0==t&&1===o?e=this.intlMessage({intlName:"models.ONE_VIDEO"}):1==t&&1===o?e=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):1<t&&1===o?e=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0==t&&1<o?e=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1==t&&1<o?e=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):1<t&&1<o&&(e=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:o})),0===s?e=this.intlMessage({intlName:"models.ZERO_ITEMS"}):1===s?e=this.intlMessage({intlName:"models.ONE_ITEM"}):1<s&&(e=this.intlMessage({intlName:"models.MULTIPLE_ITEMS",items:s})),e}},photoAndVideosDisplay:{readOnly:!0,derivedBy:["photoCount","videoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),e="";return 0===t&&0===o?e=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===o?e=this.intlMessage({intlName:"models.ONE_PHOTO"}):1<t&&0===o?e=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===o?e=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===o?e=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):1<t&&1===o?e=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&1<o?e=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1===t&&1<o?e=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):1<t&&1<o&&(e=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:o})),e}},sharedEntityDisplay:{readOnly:!0,derivedBy:["videoCount","photoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),s=this.getValue(e,"owner"),e="";return t&&!o?e=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_ONLY",username:s.getValue("displayname"),photoCount:parseInt(t,10)}):!t&&o?e=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_VIDEOS_ONLY",username:s.getValue("displayname"),videoCount:parseInt(o,10)}):t&&o&&(e=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_VIDEOS",username:s.getValue("displayname"),photoCount:parseInt(t,10),videoCount:parseInt(o,10)})),e}},primary:{},primaryPhotoSizes:{},primaryNeedsInterstitial:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(e){e=s.PhotoModelHelper.getSizeToFit(e,{height:75,width:75},s.merge({sizes:this.getValue(e,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0}));return e?e.src:""}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),o=this.getValue(e,"isSharedEntity"),e=this.getValue(e,"normalizedId");return t&&!0===o?"/photos/"+t.getValue("pathAlias")+"/shares/"+e:t?"/photos/"+t.getValue("pathAlias")+"/albums/"+e:void 0}},isAutoUploadSet:{validator:function(e){return s.AttributeHelpers.validateBoolean(e)},setter:function(e){return s.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isSharedEntity:{validator:function(e){return s.AttributeHelpers.validateBoolean(e)},setter:function(e){return s.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},canShare:{validator:function(e){return s.AttributeHelpers.validateInteger(e)},setter:function(e){return s.AttributeHelpers.coerceInteger(e)},defaultValue:0},canDownload:{validator:function(e){return s.AttributeHelpers.validateBoolean(e)},setter:function(e){return s.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},urlSuffix:{readOnly:!0,defaultFn:function(e){return this.getValue(e,"isSharedEntity")?"shares-"+e:"album-"+e}},gpCode:{defaultFn:function(e){return null}},gpOwner:{defaultFn:function(e){return null}}}},{buildCompoundId:function(e,t,o){return t&&(e+="-"+t),o&&(t||(e+="-dateposted"),e+="-"+o),e},splitCompoundId:function(e){e=e.split("-");return{nsid:e[0],orderBy:e[1],viewAs:e[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-addPhoto-creator","flickr-photosets-removePhoto-deletor","flickr-photosets-delete-deletor","flickr-photosets-getPhotos-fetcher","flickr-photosets-getContext-fetcher","flickr-photosets-create-creator","flickr-photosets-createHidden-creator","flickr-photosets-editMeta-updater","flickr-photosets-setPrimaryPhoto-updater","photo-model-helper"],langBundles:["models","shared-entity"]});
