window.wafer.ready(function(){window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var e=document.getElementById("pphw-triggerbtn"),t=document.createElement("canvas");if(!(!t.getContext||!t.getContext("2d"))&&e){var n=e.classList.remove("D(n)");e.classlist=n;var r=document.querySelector("#pphw-panel"),i=document.querySelector("#header-search-input"),a=document.querySelector("#header-clear-search"),o=document.querySelector("#handwrite-tooltip"),c=o.querySelector("#pphw-writepad-loading"),s=o.querySelector("#pphw-writepad-iframe"),t=o.querySelector("#pphw-label-select-btn"),d=t.querySelectorAll("button"),l=o.querySelector("#pphw-qmarkbtn"),n=o.querySelector("#pphw-closebtn"),u=o.querySelector("#pphw-undobtn"),p=o.querySelector("#pphw-cleanbtn"),h=r.getAttribute("data-intl")||"zh_TW",w=s.getAttribute("data-src")||"https://s.yimg.com/pv/hw-html5-iframe/index-20170907022622.html",r=null;try{r=new URL(w)}catch(e){(r=document.createElement("a")).href=w}function y(){f&&(d.forEach(function(e){e.setAttribute("disabled","disabled")}),u.setAttribute("disabled","disabled"),p.setAttribute("disabled","disabled"),f=0)}var b=r?[r.protocol,"//",r.hostname,r.port&&"80"!==r.port&&"443"!==r.port?":"+r.port:""].join(""):"",f=0;l.addEventListener("click",function(e){!function(e){if(!e||""===e)return;window.open(e,"","heigth=768,width=1024,resizable=1")}(l.getAttribute("data-link")||"http://tw.help.cc.yahoo.com/help_cp.html?product=40&catyname=%A4%E2%BCg%BF%E9%A4J")}),n.addEventListener("click",function(e){o.classList.remove("active")}),u.addEventListener("click",function(e){s.contentWindow.postMessage(JSON.stringify({type:"hw:undo"}),b),y()}),p.addEventListener("click",function(e){s.contentWindow.postMessage(JSON.stringify({type:"hw:clean"}),b),y()}),t.addEventListener("click",function(e){var t;i.value+=e.target.innerHTML,i.setAttribute("data-fr-override-by-handwriting",""),"function"==typeof Event?t=new Event("focus",{bubbles:!0,cancelable:!0,view:window}):(t=document.createEvent("Event")).initEvent("focus",!0,!0),i.dispatchEvent(t),s.contentWindow.postMessage(JSON.stringify({type:"hw:clean"}),b),a&&(a.classList.remove("D(n)"),a.classList.add("D(b)"))}),i.addEventListener("keyup",function(e){a&&(i.value?(a.classList.remove("D(n)"),a.classList.add("D(b)")):(a.classList.remove("D(b)"),a.classList.add("D(n)")))});var v=!1;e.addEventListener("click",function(e){var t="about:blank"!==s.getAttribute("src");v||t||(s.setAttribute("src",w),v=!0)}),window.addEventListener("message",function(e){if(e.source!==window&&/\.yimg\.com$/.test(e.origin))try{var n,r=JSON.parse(e.data);switch(r.type){case"hw:ready":s.contentWindow.postMessage(JSON.stringify({payload:h,type:"hw:intl"}),b),c.style.display="none";break;case"hw:candidates":d.forEach(function(e,t){n=String(r.payload&&r.payload[t]),e.innerHTML=1===n.length?n:""}),f||(d.forEach(function(e){e.removeAttribute("disabled")}),u.removeAttribute("disabled"),p.removeAttribute("disabled"),f=1);break;case"hw:empty":d.forEach(function(e,t){e.innerHTML=""}),y()}}catch(e){}})}});
