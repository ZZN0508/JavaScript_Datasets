YUI.add("type_abu_video_manager",function(u,e){var r="3",t=u.Object.getValue(YUI,["Env","My","settings","context"]),p=1===t.videoAutoplay,o=0===t.videoBuffering,n=0===t.videoRelated,s=(t.videoForcedError,1===t.videoFullscreen),a=1===t.videoHtml5,d=1===t.videoLooping,v=(t.videoMaxInstances,t.videoMaxLoops,t.videoSingleVideo||!1),f=1===t.videoMinControls,l=1===t.videoMute,c=t.videoPausescreen,h=t.videoQosRate||".1",g=t.videoSSButton,y=t.videoExpName||"default",A=t.videoComscoreC4||"TW fp",b=1===t.videoAdBeaconsDisabled,V=t.videoYwaRate||"0",m=t.suppressAdContext||!1,I=t.videoplayerUrl;u.VideoManager={STATE:{playerJs:"not-ready",isWindowFocused:!0,isLightboxOpen:!1},VIDEO_MAP:{},FAILED_VIDEO_MAP:{},init:function(){var e=this;u.Af.Event.on("content:init",e.onContentEvent,e),u.Af.Event.on("content:batch",e.onContentEvent,e),u.Af.Event.on("video_state:change",e.onVideoStateChange,e),u.Af.Event.on("video:hide",e.onVideoHide,e),u.Af.Event.on("video:show",e.onVideoShow,e),u.on("blur",e.onWindowBlur.bind(e),window),u.on("focus",e.onWindowFocus.bind(e),window),u.Af.Event.on("lightbox:show",e.onLightboxShow,e),u.Af.Event.on("lightbox:hide",e.onLightboxHide,e),e.activeVideosInit()},onContentEvent:function(e){var i,t,o,n=this.getContainerNodes(e.guid,e.list),s=this;destroyableVideos=this.findDestroyableVideos(),destroyableVideos&&0<destroyableVideos.length&&this.destroyVideos(destroyableVideos),n&&n.length&&(i=function(){s.createVideos(n)},t=function(){s.initPlayerJs(i)},(e=n[0])&&"function"==typeof e.inViewportRegion&&(o=e.inViewportRegion()),"ready"!==this.STATE.playerJs?o?t():u.one("window").once("scroll",t):o?i():u.one("window").once("scroll",i))},onVideoStateChange:function(e){if(e)if(e.isInViewport()&&e.isDestroyed()&&this.createVideo(e.containerNode),e.isPlayable())v&&this.isAnyVideoPlaying()||e.play();else if((!e.isLiveEvent()||e.isMute())&&e.pause(),v&&this.STATE.isWindowFocused&&!this.STATE.isLightboxOpen)for(guid=e.getGuid(),videoGuids=this.findPlayableVideos(),i=0;i<videoGuids.length;i++)if(guid!==videoGuids[i]&&(playableVideo=this.VIDEO_MAP[videoGuids[i]],playableVideo)){playableVideo.play();break}},onVideoShow:function(e){e=this.VIDEO_MAP[e];e&&e.show()},onVideoHide:function(e){e=this.VIDEO_MAP[e];e&&e.hide()},onWindowBlur:function(){this.STATE.isWindowFocused=!1,this.disableAllVideos()},onWindowFocus:function(){this.STATE.isWindowFocused=!0,this.enableAllVideos()},onLightboxShow:function(){this.STATE.isLightboxOpen=!0,this.disableAllVideos()},onLightboxHide:function(){this.STATE.isLightboxOpen=!1,this.enableAllVideos()},disableAllVideos:function(){var e=Object.keys(this.VIDEO_MAP);e.length&&this.disableVideos(e)},enableAllVideos:function(){var e;this.STATE.isLightboxOpen||!this.STATE.isWindowFocused||(e=Object.keys(this.VIDEO_MAP)).length&&this.enableVideos(e)},initPlayerJs:function(e){function i(){t.STATE.playerJs="ready","function"==typeof e&&e.call(t)}var t=this;if("not-ready"===this.STATE.playerJs){if(this.isPlayerJsLoaded())return void i();this.STATE.playerJs="fetching",I&&!u.config.groups.videoplayer&&(yuiConfig={modules:{videoplayer:{group:"videoplayer",name:"videoplayer",type:"js",fullpath:I}},groups:{videoplayer:{name:"videoplayer",combine:!1,filter:"min"}}},u.applyConfig(yuiConfig))}u.use("videoplayer",i)},activeVideosInit:function(){window.VEX&&this.initPlayerJs(u.bind(this.videoModeInstancesInit,this))},videoModeInstancesInit:function(){var i,t,o,n,s,a=this;window.VEX&&u.Array.each(window.VEX.VideoModeInstances,function(e){(i=e&&e.getPlayerInfos&&e.getPlayerInfos())&&(t=i.config||{},s=t.autoplay,o=u.one(i.node),n=o.generateID(),(s=new u.Video(o,{isAutoplayable:s,isDestroyable:!1,isMute:t.mute,isPlaying:s,isLiveEvent:!0})).videoPlayer=i.instance,s.videoNode=o,s.guid=n,s.attachListeners(),a.VIDEO_MAP[n]=s)})},isPlayerJsLoaded:function(){return YAHOO&&YAHOO.VideoPlatform&&YAHOO.VideoPlatform.VideoPlayer},getContainerNodes:function(e,i){var s=u.one("#applet_"+e),a=[],d=this;return s?(u.Array.each(i,function(e){var i,t,o,n=null;e&&e.type===r&&(n=s.one('[data-uuid="'+e.id+'"]'))&&(e.videoAdAssets&&(o=d.mapVideoAdAssets(e.videoAdAssets).videoUrl),i=e.videoAdImage,t=e.videoAdBeacons,o&&(n.setData("videoUrl",o),b&&o&&(o=Array.isArray(e.videoAdAssets)?u.Object.getValue(e,["videoAdAssets",0,"mediaInfo"]):e.videoAdAssets.mediaInfo,o={clickUrl:e.link,mediaInfo:o},u.Array.each(o.mediaInfo,function(e){e.height=parseInt(e.height,10),e.width=parseInt(e.width,10),e.bitrate=parseInt(e.bitrate,10),e.length=parseInt(e.length,10)}),t&&u.Object.each(t,function(e,i){Array.isArray(e)?t[i]=e:t[i]=[e]}),n.setData("geminiData",o))),i&&n.setData("imageUrl",i),t&&n.setData("videoBeacons",t),e.videoAdRules&&(u.Object.each(e.videoAdRules,function(t,e){Array.isArray(t)?u.Object.each(t,function(t){u.Object.each(t,function(e,i){t[i]=parseInt(e,10)})}):u.Object.each(t,function(e,i){t[i]=parseInt(e,10)})}),n.setData("videoRules",e.videoAdRules)),a.push(n))}),a&&0<a.length?a:null):null},mapVideoAdAssets:function(e){var t,o={VIDEO_PRIMARY:{contentType:"video/mp4",assetName:"videoUrl"}},n={};return(e=e?[].concat(e):[]).forEach(function(e){var i=o[e.usageType];e.mediaInfo=e.mediaInfo?[].concat(e.mediaInfo):[],i&&(t=1<e.mediaInfo.length?e.mediaInfo.filter(function(e,i){return new RegExp(e).test(i.contentType)}.bind(null,i.contentType))||[]:e.mediaInfo,n[i.assetName]=t[0]&&t[0].url)}),n},createVideos:function(e){var i;if(e&&e.length)for(i=0;i<e.length;i++)this.createVideo(e[i])},createVideo:function(e){var i,t,o,n,s,a,d,r,l,c,h=!0;if(e&&e.getDOMNode()){if(l=e.getData("videoManagerConfig")||{},r=e.getData("videoConfig")||{},n=e.getData("opts")||{},s={isAutoplayable:void 0!==r.autoplay?r.autoplay:p,isDestroyable:void 0===n.isDestroyable||n.isDestroyable},e.detachAll(),d=e.getData("videoBeacons"),c=e.getData("videoUrl"),i=e.getData("imageUrl"),t=(a=new u.Video(e,s)).isPlayable(),v&&(h=!this.isAnyVideoPlaying()&&h),r.autoplay=h=s.isAutoplayable&&t&&h,c)o=this.createMediaItemsByUrls([{videoUrl:c||"",imageUrl:i||""}]),b&&(o=[{id:"6bf451fd-11f9-37f9-a54c-d73d795839f6",images:{thumbnail:i}}],r.YVAP={standaloneAd:{gemini:e.getData("geminiData"),rules:e.getData("videoRules"),beacons:d}});else{if(!(d=a.getUuid()))return;o=this.createMediaItemsByUuids([d])}r=this.createVideoConfig(r,o),c&&(r.disableRecoverer=!0,r.expName="gemini-hpstrm"),a&&a.createVideoPlayerByConfig(r),r=void 0!==l.uiControl?r.uiControl:f,(!!a.containerNode.one(".js-cstm-end-screen")||r)&&new M(a,{shouldShowOverlayButtons:r}).setUp(),u.Global.fire("video-manager:create_player_instance",a),n.createVideoOnly||(e=e&&e.generateID())&&(this.VIDEO_MAP[e]=a)}},createMediaItemsByUuids:function(e){var i,t,o=[];if(e&&e.length){for(i=0;i<e.length;i++)t={id:e[i]},o.push(t);return o}},createMediaItemsByUrls:function(e){var i,t,o=[];if(e&&e.length){for(i=0;i<e.length;i++)t={streams:[{url:(t=e[i]).videoUrl}],images:{thumbnail:t.imageUrl}},o.push(t);return o}},createVideoConfig:function(e,i){var t,i={autoplay:p,comscoreC4:A,continuousPlay:!1,disableCasting:!0,expBucket:u.Af.Config.getContext("bucket"),expName:y,expType:"strm-inline",fullscreenBtn:s,html5:a,lang:u.Af.Config.getContext("lang")||"en-US",loop:d,mute:l,pageSpaceId:u.Af.Config.get("spaceid"),pausescreen:c,playlist:{mediaItems:i},preload:!0,qosSamplingRate:parseFloat(h),region:u.Af.Config.getContext("region")||"US",replayonlyendscreen:n,stopBufferingOnPause:o,settingscreen:!1,site:"frontpage",startscreen:{showButton:g,showDesc:!1,showProvider:!1,showTitle:!1},CMS:{env:"prod",suppressAdContext:m},videoapps:!1,ywaSamplingRate:parseFloat(V)};return t=e&&"object"==typeof e?u.merge(i,e):t},isAnyVideoPlaying:function(){for(var e,i=Object.keys(this.VIDEO_MAP),t=!1,o=0;o<i.length;o++)if(guid=i[o],t=(e=this.VIDEO_MAP[guid])&&e.isPlaying())return t;return t},findPlayableVideos:function(){for(var e,i,t=Object.keys(this.VIDEO_MAP),o=[],n=0;n<t.length;n++)e=t[n],(i=this.VIDEO_MAP[e])&&i.isPlayable()&&o.push(e);return o},findDestroyableVideos:function(){for(var e,i,t=[],o=Object.keys(this.VIDEO_MAP),n=0;n<o.length;n++)e=o[n],(!(i=this.VIDEO_MAP[e])||i.isDestroyable()&&0===t.length||i.isDOMNodeRemoved())&&t.push(e);return t},disableVideos:function(e){for(var i,t=0;t<e.length;t++)i=e[t],(i=this.VIDEO_MAP[i])&&i.disable()},enableVideos:function(e){for(var i,t=0;t<e.length;t++)i=e[t],(i=this.VIDEO_MAP[i])&&i.enable()},destroyVideos:function(e){for(var i,t,o=0;o<e.length;o++)i=e[o],(t=this.VIDEO_MAP[i])&&t.destroy(),t=null,delete this.VIDEO_MAP[i]}},u.VideoManager.init();var E="ui-mute-btn",w="ui-expand-btn",O={isMute:"ui-state-is-mute",isExpanded:"ui-state-is-expanded"},D={shouldShowOverlayButtons:!1},M=function(e,i){this.video=e,this.wrapperNode=null,this.containerNode=this.video&&this.video.containerNode,this.options=i||D};M.prototype.setUp=function(){this.options.shouldShowOverlayButtons&&this._createOverlayButtons(),this.containerNode&&this.containerNode.getDOMNode()&&this.containerNode.on("video_state:change",this._onVideoStateChange,this)},M.prototype._createOverlayButtons=function(){var e,i,t;this.video&&(t=this.video.videoNode)&&t.getDOMNode()&&(i=t.one(".yvp-custom-controls"))&&(this.wrapperNode=u.Node.create('<div class="ui-wrapper"></div>'),e=u.Node.create('<span class="'+E+'"><i></i></span>'),t=u.Node.create('<span class="'+w+'"><i></i></span>'),i.addClass("ui-overlay-btns"),i.append(this.wrapperNode),this.wrapperNode.append(e),this.wrapperNode.append(t),this.wrapperNode.delegate("click",this._onMuteBtnClick,"."+E,this),this.wrapperNode.delegate("click",this._onExpandBtnClick,"."+w,this),this._onVideoStateChange("isMute",this.video.isMute()))},M.prototype._onMuteBtnClick=function(){this.video&&this.video.setMute(!this.video.isMute())},M.prototype._onExpandBtnClick=function(){this.video&&this.containerNode&&this.containerNode.fire("video_expand",!this.video.isExpanded())},M.prototype._onVideoStateChange=function(e,i){var t,o;this.containerNode&&this.containerNode.getDOMNode()&&((t=O[e])&&(i?this.containerNode.hasClass(t)||this.containerNode.addClass(t):this.containerNode.removeClass(t)),"isOnEndScreen"===e&&(o=this.containerNode.one(".js-cstm-end-screen"))&&(!1===i?o.hide():(i=this.containerNode.one(".yvp-bottom-bar"))&&(o.remove(),this.containerNode.insert(o,i),o.hasClass("D-n")&&o.removeClass("D-n"),o.show())))}},"0.0.1",{requires:["af-content","af-event","base","event-custom","type_abu_event","type_abu_video","node-core"]});
