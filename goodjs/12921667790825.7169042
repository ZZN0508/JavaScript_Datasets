!function(){var c,e,t,u,l,o,g,n,p,d,y,s,_,m,k,i,b,v,w,q,x,r,h={}.hasOwnProperty,E=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};function f(e){var t,n;for(t in e)h.call(e,t)&&!1!==(n=e[t])&&(this[t]=n);this.keys=this.keys||[],this.count=this.count||0}function a(e,t){var n,o,i,r;for(n in"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery&&(1!==e.length&&v("Warning: your jQuery selector should have exactly one object."),e=e[0]),this.should_suppress_event_defaults=!1,this.should_force_event_defaults=!1,this.sequence_delay=800,this._registered_combos=[],this._keys_down=[],this._active_combos=[],this._sequence=[],this._sequence_timer=null,this._prevent_capture=!1,this._defaults=t||{},p)h.call(p,n)&&(this._defaults[n]=this._defaults[n]||p[n]);this.element=e||document.body,this.keydown_event=(e=function(e,t,n){return e.addEventListener?e.addEventListener(t,n):e.attachEvent&&e.attachEvent("on"+t,n),n})(this.element,"keydown",(o=this,function(e){return e=e||window.event,o._receive_input(e,!0),o._bug_catcher(e)})),this.keyup_event=e(this.element,"keyup",(i=this,function(e){return e=e||window.event,i._receive_input(e,!1)})),this.blur_event=e(window,"blur",(r=this,function(){for(var e,t=r._keys_down,n=0,o=t.length;n<o;n++)e=t[n],r._key_up(e,{});return r._keys_down=[]}))}p={is_unordered:!1,is_counting:!1,is_exclusive:!1,is_solitary:!1,prevent_default:!1,prevent_repeat:!1},x=["meta","alt","option","ctrl","shift","cmd"],e={debug:!(w="ctrl")},f.prototype.allows_key_repeat=function(){return!this.prevent_repeat&&"function"==typeof this.on_keydown},f.prototype.reset=function(){return this.count=0,this.keyup_fired=null},c=f,e.Listener=(a.prototype.destroy=function(){var e=function(e,t,n){return null!=e.removeEventListener?e.removeEventListener(t,n):null!=e.removeEvent?e.removeEvent("on"+t,n):void 0};return e(this.element,"keydown",this.keydown_event),e(this.element,"keyup",this.keyup_event),e(window,"blur",this.blur_event)},a.prototype._bug_catcher=function(e){var t;if("cmd"===w&&0<=E.call(this._keys_down,"cmd")&&"cmd"!==(t=o(e.keyCode))&&"shift"!==t&&"alt"!==t&&"caps"!==t&&"tab"!==t)return this._receive_input(e,!1)},a.prototype._cmd_bug_check=function(e){return!("cmd"===w&&0<=E.call(this._keys_down,"cmd")&&E.call(e,"cmd")<0)},a.prototype._prevent_default=function(e,t){if((t||this.should_suppress_event_defaults)&&!this.should_force_event_defaults&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation))return e.stopPropagation()},a.prototype._get_active_combos=function(t){var n,o,i=[],e=d(this._keys_down,function(e){return e!==t});return e.push(t),this._match_combo_arrays(e,(n=this,function(e){if(n._cmd_bug_check(e.keys))return i.push(e)})),this._fuzzy_match_combo_arrays(e,(o=this,function(e){if(!(0<=E.call(i,e)))return!e.is_solitary&&o._cmd_bug_check(e.keys)?i.push(e):void 0})),i},a.prototype._get_potential_combos=function(e){for(var t,n=[],o=this._registered_combos,i=0,r=o.length;i<r;i++)(t=o[i]).is_sequence||0<=E.call(t.keys,e)&&this._cmd_bug_check(t.keys)&&n.push(t);return n},a.prototype._add_to_active_combos=function(e){var t,n,o,i,r,s,_,c,u,l,h,f,a=!1,p=!0,d=!1;if(0<=E.call(this._active_combos,e))return!0;if(this._active_combos.length)for(r=s=0,h=this._active_combos.length;0<=h?s<h:h<s;r=0<=h?++s:--s)if((t=this._active_combos[r])&&t.is_exclusive&&e.is_exclusive){if(o=t.keys,!a)for(_=0,u=o.length;_<u;_++)if(n=o[_],a=!0,E.call(e.keys,n)<0){a=!1;break}if(p&&!a)for(c=0,l=(f=e.keys).length;c<l;c++)if(i=f[c],p=!1,E.call(o,i)<0){p=!0;break}a&&(d?null!=(t=this._active_combos.splice(r,1)[0])&&t.reset():(null!=(t=this._active_combos.splice(r,1,e)[0])&&t.reset(),d=!0),p=!1)}return p&&this._active_combos.unshift(e),a||p},a.prototype._remove_from_active_combos=function(e){for(var t,n=t=0,o=this._active_combos.length;0<=o?t<o:o<t;n=0<=o?++t:--t)if(this._active_combos[n]===e){(e=this._active_combos.splice(n,1)[0]).reset();break}},a.prototype._get_possible_sequences=function(){for(var e,t,n,o,i,r,s,_,c,u=[],l=this._registered_combos,h=0,f=l.length;h<f;h++)for(e=l[h],n=r=1,_=this._sequence.length;1<=_?r<=_:_<=r;n=1<=_?++r:--r)if(i=this._sequence.slice(-n),e.is_sequence&&(!(E.call(e.keys,"shift")<0)||(i=d(i,function(e){return"shift"!==e})).length)){for(t=s=0,c=i.length;0<=c?s<c:c<s;t=0<=c?++s:--s){if(e.keys[t]!==i[t]){o=!1;break}o=!0}o&&u.push(e)}return u},a.prototype._add_key_to_sequence=function(e,t){var n,o,i,r;if(this._sequence.push(e),(o=this._get_possible_sequences()).length){for(i=0,r=o.length;i<r;i++)n=o[i],this._prevent_default(t,n.prevent_default);this._sequence_timer&&clearTimeout(this._sequence_timer),-1<this.sequence_delay&&(this._sequence_timer=setTimeout(function(){return this._sequence=[]},this.sequence_delay))}else this._sequence=[]},a.prototype._get_sequence=function(e){for(var t,n,o,i,r,s,_,c,u,l,h=this._registered_combos,f=0,a=h.length;f<a;f++)if((t=h[f]).is_sequence){for(o=_=1,u=this._sequence.length;1<=u?_<=u:u<=_;o=1<=u?++_:--_)if(s=d(this._sequence,function(e){return 0<=E.call(t.keys,"shift")||"shift"!==e}).slice(-o),t.keys.length===s.length)for(n=c=0,l=s.length;0<=l?c<l:l<c;n=0<=l?++c:--c)if(r=s[n],!(E.call(t.keys,"shift")<0&&"shift"===r||"shift"===e&&E.call(t.keys,"shift")<0)){if(t.keys[n]!==r){i=!1;break}i=!0}if(i)return t.is_exclusive&&(this._sequence=[]),t}return!1},a.prototype._receive_input=function(e,t){var n;if(this._prevent_capture)this._keys_down.length&&(this._keys_down=[]);else if(n=o(e.keyCode),(t||this._keys_down.length||"alt"!==n&&n!==w)&&n)return t?this._key_down(n,e):this._key_up(n,e)},a.prototype._fire=function(e,t,n,o){if("function"==typeof t["on_"+e]&&this._prevent_default(n,!0!==t["on_"+e].call(t.this,n,t.count,o)),"release"===e&&(t.count=0),"keyup"===e)return t.keyup_fired=!0},a.prototype._match_combo_arrays=function(e,t){for(var n,o=this._registered_combos,i=0,r=o.length;i<r;i++)(!(n=o[i]).is_unordered&&l(e,n.keys)||n.is_unordered&&u(e,n.keys))&&t(n)},a.prototype._fuzzy_match_combo_arrays=function(e,t){for(var n,o=this._registered_combos,i=0,r=o.length;i<r;i++)(!(n=o[i]).is_unordered&&_(n.keys,e)||n.is_unordered&&s(n.keys,e))&&t(n)},a.prototype._keys_remain=function(e){for(var t,n,o=e.keys,i=0,r=o.length;i<r;i++)if(t=o[i],0<=E.call(this._keys_down,t)){n=!0;break}return n},a.prototype._key_down=function(e,t){var n,o,i,r,s,_,c,u,l,h,f,a,p,d=g(e,t);for(s in this._add_key_to_sequence(e=d?d:e,t),(d=this._get_sequence(e))&&this._fire("keydown",d,t),q)t[i=q[s]]&&(s===e||0<=E.call(this._keys_down,s)||this._keys_down.push(s));for(s in q)if(i=q[s],s!==e&&0<=E.call(this._keys_down,s)&&!t[i]&&("cmd"!==s||"cmd"===w))for(r=u=0,p=this._keys_down.length;0<=p?u<p:p<u;r=0<=p?++u:--u)this._keys_down[r]===s&&this._keys_down.splice(r,1);for(o=this._get_active_combos(e),c=this._get_potential_combos(e),l=0,f=o.length;l<f;l++)n=o[l],this._handle_combo_down(n,c,e,t);if(c.length)for(h=0,a=c.length;h<a;h++)_=c[h],this._prevent_default(t,_.prevent_default);E.call(this._keys_down,e)<0&&this._keys_down.push(e)},a.prototype._handle_combo_down=function(e,t,n,o){var i,r,s,_,c;if(E.call(e.keys,n)<0)return!1;if(this._prevent_default(o,e&&e.prevent_default),i=!1,0<=E.call(this._keys_down,n)&&(i=!0,!e.allows_key_repeat()))return!1;if(n=this._add_to_active_combos(e,n),r=e.keyup_fired=!1,e.is_exclusive)for(_=0,c=t.length;_<c;_++)if((s=t[_]).is_exclusive&&s.keys.length>e.keys.length){r=!0;break}return!r&&(e.is_counting&&"function"==typeof e.on_keydown&&(e.count+=1),n)?this._fire("keydown",e,o,i):void 0},a.prototype._key_up=function(e,t){var n,o,i,r,s,_,c,u,l,h,f,a,p,d,y,m,k=e,v=g(e,t);if(v&&(e=v),v=b[k],t.shiftKey?v&&0<=E.call(this._keys_down,v)||(e=k):k&&0<=E.call(this._keys_down,k)||(e=v),(s=this._get_sequence(e))&&this._fire("keyup",s,t),E.call(this._keys_down,e)<0)return!1;for(r=_=0,p=this._keys_down.length;0<=p?_<p:p<_;r=0<=p?++_:--_)if((d=this._keys_down[r])===e||d===v||d===k){this._keys_down.splice(r,1);break}for(s=this._active_combos.length,i=[],c=0,h=(y=this._active_combos).length;c<h;c++)n=y[c],0<=E.call(n.keys,e)&&i.push(n);for(u=0,f=i.length;u<f;u++)o=i[u],this._handle_combo_up(o,t,e);if(1<s)for(l=0,a=(m=this._active_combos).length;l<a;l++)void 0===(n=m[l])||0<=E.call(i,n)||this._keys_remain(n)||this._remove_from_active_combos(n)},a.prototype._handle_combo_up=function(e,t,n){var o,i;this._prevent_default(t,e&&e.prevent_default),i=this._keys_remain(e),e.keyup_fired||((o=this._keys_down.slice()).push(n),e.is_solitary&&!u(o,e.keys)||(this._fire("keyup",e,t),e.is_counting&&"function"==typeof e.on_keyup&&"function"!=typeof e.on_keydown&&(e.count+=1))),i||(this._fire("release",e,t),this._remove_from_active_combos(e))},a.prototype.simple_combo=function(e,t){return this.register_combo({keys:e,on_keydown:t})},a.prototype.counting_combo=function(e,t){return this.register_combo({keys:e,is_counting:!0,is_unordered:!1,on_keydown:t})},a.prototype.sequence_combo=function(e,t){return this.register_combo({keys:e,on_keydown:t,is_sequence:!0,is_exclusive:!0})},a.prototype.register_combo=function(e){var t,n,o,i;for(n in"string"==typeof e.keys&&(e.keys=e.keys.split(" ")),i=this._defaults)h.call(i,n)&&(o=i[n],void 0===e[n]&&(e[n]=o));if(t=new c(e),r(t))return this._registered_combos.push(t),t},a.prototype.register_many=function(e){for(var t,n=[],o=0,i=e.length;o<i;o++)t=e[o],n.push(this.register_combo(t));return n},a.prototype.unregister_combo=function(e){var t,n,o,i,r,s,_;if(!e)return!1;if(_=this,n=function(e){for(var t,n=[],o=t=0,i=_._registered_combos.length;0<=i?t<i:i<t;o=0<=i?++t:--t){if(e===_._registered_combos[o]){_._registered_combos.splice(o,1);break}n.push(void 0)}return n},e instanceof c)return n(e);for("string"==typeof e&&(e=e.split(" ")),s=[],o=0,i=(r=this._registered_combos).length;o<i;o++)null!=(t=r[o])&&(t.is_unordered&&u(e,t.keys)||!t.is_unordered&&l(e,t.keys)?s.push(n(t)):s.push(void 0));return s},a.prototype.unregister_many=function(e){for(var t,n=[],o=0,i=e.length;o<i;o++)t=e[o],n.push(this.unregister_combo(t));return n},a.prototype.get_registered_combos=function(){return this._registered_combos},a.prototype.reset=function(){return this._registered_combos=[]},a.prototype.listen=function(){return this._prevent_capture=!1},a.prototype.stop_listening=function(){return this._prevent_capture=!0},a.prototype.get_meta_key=function(){return w},a),n=function(){-1!==navigator.userAgent.indexOf("Mac OS X")&&(w="cmd")},t=function(){-1!==navigator.userAgent.indexOf("Opera")&&(i[17]="cmd")},o=function(e){return i[e]},d=function(o,i){var r;return o.filter?o.filter(i):function(){for(var e=[],t=0,n=o.length;t<n;t++)r=o[t],i(r)&&e.push(r);return e}()},u=function(e,t){var n,o,i;if(e.length!==t.length)return!1;for(o=0,i=e.length;o<i;o++)if(n=e[o],!(0<=E.call(t,n)))return!1;return!0},l=function(e,t){var n,o,i;if(e.length!==t.length)return!1;for(n=o=0,i=e.length;0<=i?o<i:i<o;n=0<=i?++o:--o)if(e[n]!==t[n])return!1;return!0},s=function(e,t){for(var n,o=0,i=e.length;o<i;o++)if(n=e[o],E.call(t,n)<0)return!1;return!0},y=Array.prototype.indexOf||function(e,t){for(var n,o=n=0,i=e.length;0<=i?n<=i:i<=n;o=0<=i?++n:--n)if(e[o]===t)return o;return-1},_=function(e,t){for(var n,o=0,i=0,r=e.length;i<r;i++){if(n=e[i],!(o<=(n=y.call(t,n))))return!1;o=n}return!0},v=function(){if(e.debug)return console.log.apply(console,arguments)},m=function(e){var t,n=!1;for(t in i)if(e===i[t]){n=!0;break}if(!n)for(t in b)if(e===b[t]){n=!0;break}return n},r=function(e){var t,n,o,i,r,s,_,c,u,l,h,f,a=!0;for(e.keys.length||v("You're trying to bind a combo with no keys:",e),n=s=0,h=e.keys.length;0<=h?s<h:h<s;n=0<=h?++s:--s)o=e.keys[n],"meta"===(o=(t=k[o])?e.keys[n]=t:o)&&e.keys.splice(n,1,w),"cmd"===o&&v('Warning: use the "meta" key rather than "cmd" for Windows compatibility');for(_=0,u=(f=e.keys).length;_<u;_++)o=f[_],m(o)||(v('Do not recognize the key "'+o+'"'),a=!1);if(0<=E.call(e.keys,"meta")||0<=E.call(e.keys,"cmd")){for(i=e.keys.slice(),c=0,l=x.length;c<l;c++)-1<(n=y.call(i,x[c]))&&i.splice(n,1);1<i.length&&(v("META and CMD key combos cannot have more than 1 non-modifier keys",e,i),a=!1)}for(r in e)e[r],"undefined"===p[r]&&v("The property "+r+" is not a valid combo property. Your combo has still been registered.");return a},g=function(e,t){return!!t.shiftKey&&(null!=(e=b[e])&&e)},q={cmd:"metaKey",ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"},k={escape:"esc",control:"ctrl",command:"cmd",break:"pause",windows:"cmd",option:"alt",caps_lock:"caps",apostrophe:"'",semicolon:";",tilde:"~",accent:"`",scroll_lock:"scroll",num_lock:"num"},b={"/":"?",".":">",",":"<","'":'"',";":":","[":"{","]":"}","\\":"|","`":"~","=":"+","-":"_",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")"},i={0:"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},e._keycode_dictionary=i,e._is_array_in_array_sorted=_,n(),t(),"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof exports&&null!==exports?exports.keypress=e:window.keypress=e}.call(this),window.keypressLoaded=!0;
