var b$=b$||{};b$.universal=b$.universal||{},b$.universal.widgets=b$.universal.widgets||{},b$.universal.widgets.StructuredContentWidgetOverlay=function(p){"use strict";define("login-overlay",function(e,n,o){o.exports={loginOverlay:function(t,n,e,r){var i,l;p.ajax({url:e,success:function(e){p(t.htmlNode).find(".sme-wh-login-overlay .popup-heading").html(e.overlayTitle)},error:function(e){}});var o=!!document.documentMode;function a(e,n){var o;"clearExisting"==n&&p(".login-button-options").empty(),i.loginTypes[e].loginButtonName&&(o=1==i.loginTypes[e].loginUrlNb?'<a href="'+s+"/login?redirect="+s+i.loginTypes[e].loginUrl+'" class="btn-primary login-url">'+i.loginTypes[e].loginButtonName+"</a>":'<a href="'+i.loginTypes[e].loginUrl+'" class="btn-primary login-url">'+i.loginTypes[e].loginButtonName+"</a>",p(".login-button-options").append(o)),i.loginTypes[e].registerButtonName&&(o=1==i.loginTypes[e].registerUrlNb?'<a href="'+s+"/login?redirect="+s+"/"+i.loginTypes[e].registerUrl+'" class="btn-default register-url">'+i.loginTypes[e].registerButtonName+"</a>":'<a href="'+i.loginTypes[e].registerUrl+'" class="btn-default register-url">'+i.loginTypes[e].registerButtonName+"</a>",p(".login-button-options").append(o)),i.loginTypes[e].knowMorButtonName&&(e=1==i.loginTypes[e].knowMoreUrlNb?'<a href="'+s+"/login?redirect="+s+"/"+i.loginTypes[e].knowMoreUrl+'" class="know-more-url '+i.loginTypes[e].navigationType+'">'+i.loginTypes[e].knowMorButtonName+"</a>":'<a href="'+i.loginTypes[e].knowMoreUrl+'" class="know-more-url '+i.loginTypes[e].navigationType+'">'+i.loginTypes[e].knowMorButtonName+"</a>",p(".login-button-options").append(e)),p(".login-button-options a").each(function(){var e=p(this).attr("href");-1==e.indexOf("http")&&p(this).hasClass("friendly-url")?e=window.location.origin+r+e:-1==e.indexOf("http")&&p(this).hasClass("normal-url")||-1==e.indexOf("http")?e=window.location.origin+s+e:this.hrefVal=e,p(this).attr("href",e)})}gadgets.pubsub.subscribe("otherLogin",function(e){n==e&&(p(t.htmlNode).find(".sme-wh-login-overlay .cover").show(),p(t.htmlNode).find(".sme-wh-login-overlay .popup-container").addClass("opened"),p("body").addClass("no-scroll"))}),gadgets.pubsub.subscribe("dynamicLoginValue",function(e){i.loginTypes[0].loginUrl=e.loginUrl,a(0,"clearExisting")}),p(t.htmlNode).find(".close-button,.modal-header i.icon-left-open-big").on("click",function(){p(".modal.popup-container").removeClass("opened"),p(t.htmlNode).find(".sme-wh-login-overlay .cover").hide(),p("body").removeClass("no-scroll")}),p(t.htmlNode).find(".sme-wh-login-overlay .cover").on("click",function(){p(this).hide(),p(".modal.popup-container").removeClass("opened"),p("body").removeClass("no-scroll")}),document.onkeydown=function(e){27==e.keyCode&&(p(".modal").removeClass("opened"),p(".cover").hide(),p("body").removeClass("no-scroll"),gadgets.pubsub.publish("overlayClosed"))},p.ajax({url:e,success:function(e){for(var n=(i=e).loginTypes.length,o=0;o<n;o++)l=i.loginTypes[o].wayToLoginSub?'<div><label = "radio inline" class = "link-name"><input type="radio" class="login-rb" name="swlogin" value="'+o+'">'+i.loginTypes[o].wayToLogin+i.loginTypes[o].wayToLoginSub+"</label></div>":'<div><label = "radio inline" class = "link-name"><input type="radio" class="login-rb" name="swlogin" value="'+o+'">'+i.loginTypes[o].wayToLogin+"</label></div>",p(".radio-parent").append(l),p(t.htmlNode).find(".radio-parent div:first-child .login-rb").attr("checked","checked");a(0)},error:function(e){}}),1==o?setInterval(function(){"complete"===document.readyState&&p(".radio-parent input").on("change",function(){p(".login-button-options a").remove(),p(this).is(":checked")&&a(p(this).attr("value"))})},500):p(window).load(function(){p(".radio-parent input").on("change",function(){p(".login-button-options a").remove(),p(this).is(":checked")&&a(p(this).attr("value"))})})}}});var u="cs",g=window.b$||{},s=g.portal.urlRedirect;return{prefModified:function(e){e.refreshIncludes();var n=p(e.htmlNode);p(".bd-structured-content-widget",n).attr("data-type",e.getPreference("contentType")||"Content")},start:function(l){for(var e,n=[],o=0;o<l.model.preferences.array.length;o++)"templateUrl"==l.model.preferences.array[o].name&&(e=l.model.preferences.array[o].value);var t=l.getPreference("urlContent"),r=g.portal.portalModel.serverURL;null!=t&&(i=t.indexOf("content"),d=t.slice(i,t.length),t=r+"/"+d);var i=g.portal.portalModel.serverURL+"/static/widgets/%5BBBHOST%5D/widget-hdfc-sme-wholesale-login/media/pop-close.png";p(".close-icon-url").attr("src",i),null==e||(n=e.split("/"));var a,s,d=l.getPreference("contentRef"),c=p(l.htmlNode),i=!1;try{top.bd}catch(e){i=!0}(window.be&&!i&&be.utils.module("top.bd.PageMgmtTree.selectedLink").isMasterPage||"true"===l.model.manageable||""===l.model.manageable||void 0===l.model.manageable)&&(d||c.addClass("bd-empty-structured-content"),p(".bd-structured-content-widget",c).attr("data-type",l.getPreference("contentType")||"Content"),l.addEventListener("preferences-form",function(e){for(var n=g.portal.portalModel.filterPreferences(l.model.preferences.array),o=n.length-1;0<=o;o--)if("Template"==n[o].label)for(var t=l.getPreference("templateList").split(","),r=0,i=0;r<t.length;r++,i++)n[o].inputType.options[i]={label:t[r],value:t[r+1]},r++}),l.addEventListener("bdDrop.enter",function(e){e=e.detail.info.helper.bdDragData.fileDataArray[0];e.metaData&&e.metaData["cmis:objectTypeId"]&&"bb:structuredcontent"===e.metaData["cmis:objectTypeId"].property?(a=e,c.addClass("bd-over-structured-content")):a=void 0}),l.addEventListener("bdDrop.leave",function(e){c.removeClass("bd-over-structured-content")}),l.addEventListener("bdDrop.drop",function(e){var n=e.detail.info.helper.bdDragData.fileDataArray[0];a&&(l.model.preferences.getByName("contentRef")||(e=g.portal.portalModel.createPreference("contentRef","contentRef",void 0,""),l.model.preferences.add(e)),l.setPreference("urlContent",n.url),l.setPreference("contentRef",[u,"contentRepository"===a.repository?a.repository:"@portalRepository",a.contentUId].join(":")),l.model.save(function(){l.refreshHTML(),c.removeClass("bd-empty-structured-content")}),c.removeClass("bd-over-structured-content")),a=void 0}),window.bd&&window.bd.bindDropEvents&&window.bd.bindDropEvents(l.htmlNode),s=l.getPreference("section-name"),"login-overlay.html"==n[n.length-1]&&require(["login-overlay"],function(e){e.loginOverlay(l,s,t,r)}))}}}(jQuery);
