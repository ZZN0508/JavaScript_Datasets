define("lofty/alicn/suggestion/3.0/core",["lofty/lang/class","lofty/ui/widget/1.0/widget","lofty/util/misc/2.0/misc","lofty/util/template/2.0/tplhandler","jquery"],function(t,e,n,i,o){var h=38,u=40,g=37,d=39,c=13,f=27,_=n.isIE();return t(e,{options:{target:null,dTop:0,dLeft:0,width:0,dWidth:0,delay:300,noInputHandler:null,inputHandler:null,extendClass:"",callback:null},_create:function(){this.render(),this._enable=!0,this.get("noInputHandler")&&"setContext"in this.get("noInputHandler")&&this.get("noInputHandler").setContext(this),this.get("inputHandler")&&"setContext"in this.get("inputHandler")&&this.get("inputHandler").setContext(this),this._calCurrentHandler(),this.resetWidth(),this.resetPosition(),this._bindRenderEvent(),this._bindTargetEvent(),this._bindDocEvent(),this._tokenId=1,this.$sgtCtn=this.get("el").find(".fui-web-suggestion-inner")},_calCurrentHandler:function(){this._currentHandler=null;var t=o.trim(o(this.get("target")).val());this._currentHandler=this.get(""==t?"noInputHandler":"inputHandler")},enable:function(){this._enable=!0},disable:function(){this._enable=!1},_bindDocEvent:function(){var t=this;this.get("el").on("click",function(t){t.stopPropagation()}),o(this.get("target")).on("click",function(t){t.stopPropagation()}),o(document).on("click",function(){t.hide()})},_bindRenderEvent:function(){var e=this;this.on("htmlReady",function(t){t&&t.token==e._tokenId&&(t.html?(e.$sgtCtn.html(t.html),e.show()):e.hide())})},getCurrentHandler:function(){return this._currentHandler},_processHandler:function(t,e){var n;this._enable&&(n=o(this.get("target")),"onTargetKeyEnter"!=t&&(this._hasShow&&"onTargetInput"!=t||this._calCurrentHandler()),n=o.trim(n.val()),t in this._currentHandler&&(this._tokenId++,this._currentHandler[t](this._tokenId,n,e)))},_targetMousedownHandler:function(){this._processHandler("onTargetMouseDown")},_targetInputHandler:function(){this._processHandler("onTargetInput")},_targetEnterHandler:function(){this._processHandler("onTargetHover")},_targetLeaveHandler:function(){this._processHandler("onTargetBlur")},_targetKeyUpHandler:function(t){this._processHandler("onTargetKeyUp",t)},_targetKeyDownHandler:function(t){this._processHandler("onTargetKeyDown",t)},_targetKeyLeftHandler:function(t){this._processHandler("onTargetKeyLeft",t)},_targetKeyRightHandler:function(t){this._processHandler("onTargetKeyRight",t)},_targetKeyEnterHandler:function(t){this._processHandler("onTargetKeyEnter",t)},_sgtShow:function(){this._processHandler("onShow")},_bindTargetEvent:function(){var e=this,t=o(this.get("target"));t.on("mousedown",function(t){e._targetMousedownHandler()}),t.on("keydown",function(t){switch(t.which){case f:e.hide();break;case h:e._targetKeyUpHandler(t);break;case u:e._targetKeyDownHandler(t);break;case g:e._targetKeyLeftHandler(t);break;case d:e._targetKeyRightHandler(t);break;case c:e._targetKeyEnterHandler(t)}});var n,i,a,r,s,l=!1;this.get("el").on("mouseenter",function(){i&&(clearTimeout(i),i=null),n&&(clearTimeout(n),n=null),r&&(clearTimeout(r),r=null),a&&clearTimeout(a),l||(a=setTimeout(function(){l=!0,a=null,e._targetEnterHandler()},200))}).on("mouseleave",function(){a&&(clearTimeout(a),a=null),r&&clearTimeout(r),n&&(clearTimeout(n),n=null),i&&(clearTimeout(i),i=null),l&&(r=setTimeout(function(){l=!1,r=null,e._targetLeaveHandler()},200))}),t.on("mouseenter",function(){a&&(clearTimeout(a),a=null),r&&(clearTimeout(r),r=null),i&&(clearTimeout(i),i=null),n&&clearTimeout(n),l||(n=setTimeout(function(){l=!0,n=null,e._targetEnterHandler()},200))}).on("mouseleave",function(){a&&(clearTimeout(a),a=null),r&&(clearTimeout(r),r=null),n&&(clearTimeout(n),n=null),i&&clearTimeout(i),l&&(i=setTimeout(function(){l=!1,i=null,e._targetLeaveHandler()},200))}),_?(this.targetLast2Val=t.val(),this.targetLast1Val=void 0,this.valChangeTmId=null,this._listenTargetValChange(t)):(this.inputTmId=null,s=this.get("delay"),t.on("input",function(t){e.inputTmId&&clearTimeout(e.inputTmId),e.inputTmId=setTimeout(function(){e.inputTmId=null,e._targetInputHandler()},s)}))},setTargetValue:function(t){o(this.get("target")).val(t),_&&(this.targetLast2Val=t,this.targetLast1Val=void 0);var e=this.get("callback");e&&e(t)},getWidth:function(){return this.width},resetHeight:function(){var t=this.$sgtCtn.height();return this._hasShow&&this.get("el").stop().css({height:t}),t},resetWidth:function(){var t=this.get("width"),e=this.get("el");this.width=t?t+this.get("dWidth"):o(this.get("target")).outerWidth()+this.get("dWidth"),e.width(this.width)},resetPosition:function(){var t=o(this.get("target")),e=t.offset().left,n=t.offset().top,t=t.outerHeight(),e=e+this.get("dLeft"),t=n+t+this.get("dTop");this.get("el").css({top:t,left:e})},show:function(){var t=this.$sgtCtn.height(),e=this;this._hasShow?(this.get("el").stop().css({height:t}),e._sgtShow()):(this._hasShow=!0,this.get("el").animate({height:t},250,function(){e._sgtShow()})),this.trigger("show")},hide:function(){this._hasShow=!1,this.get("el").stop().height(0),this.trigger("hide")},_listenTargetValChange:function(e){var n=this;this.valChangeTmId=setTimeout(function(){n.valChangeTmId=null;var t=e.val();if(t!=n.targetLast2Val){if(void 0===n.targetLast1Val)return n.targetLast1Val=t,void n._listenTargetValChange(e);t===n.targetLast1Val?(n.targetLast2Val=t,n.targetLast1Val=void 0,n._targetInputHandler()):n.targetLast1Val=t,n._listenTargetValChange(e)}else n._listenTargetValChange(e)},this.get("delay")/2)},tpl:'<div class="fui-web-suggestion {{extendClass}}"><div class="fui-web-suggestion-inner"></div></div>',handleTpl:function(){var t={};t.extendClass=this.get("extendClass"),i.process.call(this,t)}})});
