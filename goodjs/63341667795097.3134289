define("pkg/@alife/refly-tracelog/0.0.12/index",["jquery","lofty/util/exposure/1.0/exposure","require","module","exports"],function(e,t,r,o,a){var i=e,s=t,u={_schedule:{},schedule:function(e,t,r){this._schedule[e]&&clearTimeout(this._schedule[e]),this._schedule[e]=0,t&&(0===r?t():this._schedule[e]=setTimeout(t,r||1e3))},getData:function(e,t){var r=e.data(),o=/traceClickParam(\w+)/,e="traceClick";"exposure"==t&&(e="traceExposure",o=/traceExposureParam(\w+)/);var a,n,c={action:r[e],st_page_id:window.dmtrack_pageid||u.getPageId()};for(a in r)r.hasOwnProperty(a)&&o.test(a)&&(c[n=(n=a.replace(o,"$1")).charAt(0).toLowerCase()+n.slice(1)]="object"==typeof r[a]?JSON.stringify(r[a]):r[a]);return c},report:function(e,t,r){t||window.console&&console.error&&console.error("data is empty"),r=r||"ctr.1688.2";t=encodeURIComponent("string"==typeof t?t:i.param(t));this.schedule(r+":"+t+":"+e,this.invoke(r,t,e),3e3)},invoke:function(e,t,r){return function(){(new Image).src="//gm.mmstat.com/"+e+"?gokey="+t+"&type="+r+"&time="+Date.now()}},getPageId:function(){var e=i("#tb-beacon-aplus");if(!e||!e.length)return"";e=e.attr("exparams");if(!e)return"";e=u.param2obj(e);return e?e.st_page_id:""},param2obj:function(e){for(var t=e.split("&"),r=0,o=t.length,a={};r<o;r++){var n=t[r],c=n.indexOf("="),i=n.substring(0,c),c=n.substring(c+1);a[i]=u.tryToDecodeURIComponent(c)}return a},tryToDecodeURIComponent:function(e,t){t=t||"";if(e)try{t=decodeURIComponent(e)}catch(e){}return t}},d=function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r};o.exports=function(e,t){function r(){var e=i("[data-trace-exposure]:not(.exposured)");e.addClass("exposured"),a.collectResouce(e)}var o,a,n,c;e&&(t&&t.noClick||(c=(n=i(n=e)).find("[name=refly-trace-click-url]").val()||"btob.4",n.on("click","[data-trace-click]",function(e){var t=i(e.target).closest("[data-trace-click]"),e=t.data().traceClickUrl||c,t=u.getData(t);u.report("CLK",t,e)})),t&&t.noExposure||(o=i(e=e).find("[name=refly-trace-click-url]").val()||"btob.40",(a=new s({target:"[data-trace-exposure]",threshold:0,container:e})).on("exposure",function(e){var t=e.data().traceExposureUrl||o,e=u.getData(e,"exposure");u.report("EXP",e,t)}),d(i(e).get(0),"DOMSubtreeModified",function(){u.schedule("exposured.load",r,100)}),a.execute()))}});
