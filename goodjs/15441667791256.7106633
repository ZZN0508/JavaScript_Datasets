!function(m){var e,p,g,a,s,t,l,P,r,n;void 0!==m&&(window.searchplat=window.searchplat||{},searchplat.suggest=searchplat.suggest||{},e=searchplat.suggest,g=0,s={DEBUG:1,INFO:2,WARN:3,ERROR:4},(r=(a=function(){this.enable=!1,this.logLevel=4}).prototype).setEnable=function(e){this.enable=!!e},r.setLogLevel=function(e){this.logLevel=e&&void 0!==s[e]?s[e]:this.logLevel},r.debug=function(e){this.log(e,"DEBUG")},r.info=function(e){this.log(e,"INFO")},r.warn=function(e){this.log(e,"WARN")},r.error=function(e){this.log(e,"ERROR")},r.log=function(e,a){(a=void 0===a?s.DEBUG:a)&&void 0===s[a]||s[a]<this.logLevel||this.enable&&"undefined"!=typeof console&&"function"==typeof console.log&&console.log(e)},unescape(String.fromCharCode("0x3000")),unescape(String.fromCharCode("0x00A0")),unescape(String.fromCharCode("0x3000")),unescape(String.fromCharCode("0x00A0")),l=0,P={sParam:{sq:"",gu:"",rid:"",sid:"",su:"search",cl:"",ccl:"",si:"",sfi:-1,ss:"",sgl:"",swgl:"",cnl:"",asl:"",ssl:"",sst:-1,sn:-1,sw:"",ge:"",op:"",ex:"",cex:"",ab:"",abt:"",pgl:"",pageId:"",pgn:"",assc:"",ref:"",fp:""},optionList:{},ajaxType:"jsonp",suggestApiUrl:"https://api.suggest.search.rakuten.co.jp",ajaxSubmitLogTimeout:1e3,ratInitWait:1e3,getTimeStamp:function(){var e=new Date;return e.getFullYear().toString()+("0"+(e.getMonth()+1)).slice(-2)+("0"+e.getDate()).slice(-2)+("00"+e.getHours()).slice(-2)+("00"+e.getMinutes()).slice(-2)+("00"+e.getMilliseconds()).slice(-3)},deleteSsrCookie:function(){var e=document.location.href;if(!e)return!0;e.match(/http(s|):\/\/[^/$#?]+.rakuten.co.jp\//)?(t=!0,document.cookie="ss_r=;domain=.rakuten.co.jp;path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT"):p.rslog.warn("do not delete cookie:domain is not same")},getSsrV:function(e,a){return e&&a?e+"_"+a+"_"+P.getTimeStamp():""},setSsrCookie:function(e){var a=new Date;t?(a.setMinutes(a.getMinutes()+1),document.cookie="ss_r="+e+";domain=.rakuten.co.jp;path=/;expires="+a.toUTCString()):p.rslog.warn("do not set cookie: domain is not same")},checkForSend:function(){return P.sParam.cl&&P.sParam.sid&&P.sParam.rid&&P.suggestApiUrl&&void 0!==P.sParam.sst&&P.sParam.pgn?-1!=P.suggestApiUrl.indexOf("api.suggest.search.rakuten.co.jp")||(p.rslog.warn("api url is invalid:"+P.suggestApiUrl),!1):(p.rslog.debug("parameter check error: cl:"+P.sParam.cl+" sid:"+P.sParam.sid+" rid:"+P.sParam.rid+" suggestApiUrl:"+P.suggestApiUrl+" sst:"+P.sParam.sst+" pgn:"+P.sParam.pgn),!1)},send:function(){var e,a=(new Date).getTime();if(p.rslog.info("_send start "),p.rslog.info((a-g)/1e3),!P.checkForSend())return!0;try{var s=P.getSsrV(P.sParam.sid,P.sParam.rid);P.setSsrCookie(s),e=P.createUrl(),p.rslog.debug("url:"+e),setTimeout(function(){return!0},1e3);var t=(new Date).getTime();p.rslog.info("_send ajax start "),p.rslog.info((t-a)/1e3),p.rslog.info((t-g)/1e3),m.ajax({url:e,timeout:P.ajaxSubmitLogTimeout,async:!1,dataType:P.ajaxType,scriptCharset:"urf-8",jsonp:"cb",success:function(){var e=(new Date).getTime();p.rslog.info("_send ajax end "),p.rslog.info((e-t)/1e3),p.rslog.info((e-g)/1e3)}})}catch(e){p.rslog.warn(e)}return!0},createUrl:function(){var e="",e=P.suggestApiUrl+"/submit?sid="+P.sParam.sid+"&cl="+P.sParam.cl+"&rid="+P.sParam.rid+"&q="+encodeURIComponent(P.sParam.sq)+"&pgl="+P.sParam.pgl+"&assc="+P.sParam.assc+"&pgid="+P.sParam.pageId+"&pgn="+encodeURIComponent(P.sParam.pgn)+"&ab="+encodeURIComponent(P.sParam.ab)+"&abt="+encodeURIComponent(P.sParam.abt)+"&sst="+P.sParam.sst+"&op="+encodeURIComponent(P.sParam.op)+"&sn="+P.sParam.sn+"&sfi="+P.sParam.sfi+"&si="+encodeURIComponent(P.sParam.si)+"&ss="+encodeURIComponent(P.sParam.ss)+"&su="+P.sParam.su+"&sw="+P.sParam.sw+"&fp="+encodeURIComponent(P.sParam.fp)+"&ex="+encodeURIComponent(P.sParam.ex)+"&ge="+P.sParam.ge+"&gu="+P.sParam.gu+"&ccl="+P.sParam.ccl+"&cex="+encodeURIComponent(P.sParam.cex),a="&sgl="+encodeURIComponent(P.sParam.sgl)+"&swgl="+encodeURIComponent(P.sParam.swgl)+"&cnl="+encodeURIComponent(P.sParam.cnl)+"&asl="+encodeURIComponent(P.sParam.asl)+"&ssl="+encodeURIComponent(P.sParam.ssl),s="&ref="+P.sParam.ref;return e.length+a.length+s.length<=8e3?e=e+a+s:e.length+s.length<=8e3&&(e+=s),e},getSi:function(e){var a;return e.isSuggestUse()?void 0!==e.lastSuggestQuery?a=e.lastSuggestQuery:""!==e.respInput&&(a=e.respInput.toLowerCase()):a=e.lastInput,a},setSubmitParamSuggestCommon:function(e){P.suggestApiUrl=e.baseUrl,P.sParam.sq=e.input.val().replace(e.spaceRegExp,""),P.sParam.sid=e.suggestId,P.sParam.cl=e.config.attr(e.configCollection),P.sParam.rid=e.sggstReqid,P.sParam.sn=e.sggstSelectNum,P.sParam.ss=e.usingChar,P.sParam.su=e.isSuggestUse()?1:0,P.sParam.sw=e.submitWay,P.sParam.fp=e.form.serialize()||"",P.sParam.op=P.getOption(e)},getOption:function(e){return(e=e.config.attr("id"))&&P.optionList[e]?P.optionList[e]:""},setSubmitParamsNp:function(e){var a,s=0;try{P.setSubmitParamSuggestCommon(e),P.sParam.si=P.getSi(e),P.sParam.su&&(s=1),void 0!==e.genreSelectBox&&"function"==typeof e.genreSelectBox.val&&(a=e.genreSelectBox.val(),void 0!==e.genreHidden&&(P.sParam.gu=e.genreHidden.val(),s=2)),P.sParam.sst=s,P.sParam.ex=e.exParam||"";for(var t=P.sParam.ex.split("&"),e=0,r=t.length;e<r;e++){var n=t[e].split("=");"ge"===n[0]&&2==n.length&&(a=n[1])}P.sParam.ge=a}catch(e){return p.rslog.warn("fail setSubmitParamNp"),p.rslog.warn(e),!1}return!0},setSubmitParamsPlugin:function(e,a){var s=0,t=(new Date).getTime();p.rslog.info("startSetSubmitParamPlugin");try{P.setSubmitParamSuggestCommon(e),P.sParam.si=P.getSi(e),P.sParam.su&&(s=1);for(var r,n,i,o=0;o<a.length;o++)if("swg"==a[o].pluginName){var g=a[o];void 0!==g.genreHidden&&(P.sParam.gu=g.genreHidden.val(),s=2),P.sParam.ex=g.exParam||e.exParam||"";for(var l=void 0===g.gbUse||1==g.gbUse?g.genreSelectBox.val():"",m=P.sParam.ex.split("&"),u=0,c=m.length;u<c;u++){var f=m[u].split("=");"ge"===f[0]&&2==f.length&&(l=f[1])}P.sParam.ge=l}else"cnavi"==a[o].pluginName?(r=a[o],P.sParam.ccl=r.cnaviCollection||P.sParam.cl,P.sParam.cex=r.exParam,r.isCNaviUsed&&(s=3,P.sParam.sq="",P.sParam.sfi=1)):"asuraku"==a[o].pluginName?(n=a[o]).isAsurakuUsed&&(s=4,P.sParam.sq=n.asurakuText,P.sParam.sfi=1):"sgstSs"!=a[o].pluginName||(i=a[o]).isSupersaleUsed&&(s=5,P.sParam.sq=i.superSaleText,P.sParam.sfi=1);P.sParam.sst=s;var d=(new Date).getTime();p.rslog.info((d-t)/1e3)}catch(e){return p.rslog.warn("fail setSubmitParamPlugin"),p.rslog.warn(e),!1}return!0},getSggstListNp:function(e){try{var t,a;void 0!==e.selectDiv?(t=e.selectDiv.attr("data-sgst-idx"))&&(a=t.split("_"),P.sParam.sfi=a[1]):e.isSuggestUse()||(P.sParam.sfi=0);var r=[],n=0,i=[];e.suggest.children(":visible").find(".sggstKeyword").each(function(e,a){var s;m(a).text()&&(void 0!==m(a).children("span").attr("key")?(n++,s=m(a).attr("data-sgst-idx"),t&&s==t&&(P.sParam.sfi=n),i.push('"'+m(a).children("span").attr("key")+'"')):r.push('"'+m(a).text()+'"'))}),P.sParam.swgl=i.join(","),1==P.sParam.sst&&P.sParam.sfi>n&&(P.sParam.sfi-=n),P.sParam.sgl=r.join(",")}catch(e){return p.rslog.warn("fail getSggstListNp"),p.rslog.warn(e),!1}return!0},getSggstListPlugin:function(e){var a,s,t=(new Date).getTime();p.rslog.info("start getSggstListPlugin");try{void 0!==e.selectDiv?(a=e.selectDiv.attr("data-sgst-idx"))&&(s=a.split("_"),P.sParam.sfi=s[1]):e.isSuggestUse()||(P.sParam.sfi=0);var r=e.suggest.children(":visible"),n=[];r.filter(".sggstRow").each(function(e,a){n.push('"'+m(a).text()+'"')}),P.sParam.sgl=n.join(",");var i=[];r.filter(".swgRow").find(".swgWordRow").each(function(e,a){i.push('"'+m(a).attr("key")+'"')}),P.sParam.swgl=i.join(",");e=[];(o=r.filter(".cnaviRow").find(".cnaviLink")).attr("href")&&e.push('"'+o.attr("href")+'"'),P.sParam.cnl=e.join(",");var o=[];(g=r.filter(".asurakuRow").find(".asurakuLink")).attr("href")&&o.push('"'+g.attr("href")+'"'),P.sParam.asl=o.join(",");var g=[],l=r.filter(".sgstSsRow").find(".supersaleLink");l.attr("href")&&g.push('"'+l.attr("href")+'"'),P.sParam.ssl=g.join(",")}catch(e){return p.rslog.warn("fail getSggstListPlugin"),p.rslog.warn(e),!1}return r=(new Date).getTime(),p.rslog.info((r-t)/1e3),p.rslog.info("end getSggstListPlugin"),!0}},(n=(r=function(){e.rsbmt=this}).prototype).init=function(){var e=this;e.setRatInitWait(),setTimeout(function(){e.setPageInfo(),l=1,p.rslog.debug("get page info"),P.deleteSsrCookie(),l=2,p.rslog.debug("delete cookie")},P.ratInitWait)},n.setRatInitWait=function(e){e&&(e=parseInt(e),P.ratInitWait=!isNaN(e)&&1<=e&&e<=3e4?e:P.ratInitWait)},n.sendSubmitLog=function(e,a,s){if(g=(new Date).getTime(),p.rslog.info("send start:"+l),3<=l)return p.rslog.debug("already started:"+l),!0;l=3;var t=(new Date).getTime();if(p.rslog.info("end start"),p.rslog.info((t-g)/1e3),!e||"function"!=typeof e)return p.rslog.error("setParamFunc is not function:"+typeof e),!0;var r=(new Date).getTime();p.rslog.info("end check setParamFunc"),p.rslog.info((r-t)/1e3);try{if(!e(a,s))return p.rslog.error("fail setParamFunc"),!0;var n=(new Date).getTime();p.rslog.info("end setParamFunc"),p.rslog.info((n-r)/1e3),p.rslog.info((n-g)/1e3),P.sParam.pgn||self.setPageInfo();var i=(new Date).getTime();p.rslog.info("end setPageInfor re-try"),p.rslog.info((i-n)/1e3),P.send();var o=(new Date).getTime();p.rslog.info("end send"),p.rslog.info((o-i)/1e3),p.rslog.info((o-g)/1e3),l=100,p.rslog.info("send end:"+l)}catch(e){l=90,p.rslog.error(e),p.rslog.error("send failure:"+l)}return!0},n.setParamNp=function(e){return P.setSubmitParamsNp(e)&&P.getSggstListNp(e)},n.setParamPlugin=function(e,a){return P.setSubmitParamsPlugin(e,a)&&P.getSggstListPlugin(e,a)},n.setPageInfo=function(){try{var e=m("#ratPageLayout");P.sParam.pgl=e&&e.val()?e.val():"";var a=m("#ratAdobeSiteSection");P.sParam.assc=a&&a.val()?a.val():"";var s=m("#ratPageName");P.sParam.pgn=s&&s.val()?s.val():"";var t=m("#ratAbTest");P.sParam.ab=t&&t.val()?t.val():"";var r=m("#ratTestTargeting");P.sParam.abt=r&&r.val()?r.val():"";var n,i,o=m("#ratAccountId")?m("#ratAccountId").val():"",g=m("#ratServiceId")?m("#ratServiceId").val():"";if(m("#RAT")&&m("#RAT").val())try{"undefined"!=typeof JSON&&(n=JSON.parse(m("#RAT").val()),P.sParam.ab=n.abtest||"",P.sParam.abt=n.abtest_target?JSON.stringify(n.abtest_target):"",P.sParam.pgl=n.pgl||"",P.sParam.pgn=n.pgn||"",P.sParam.assc=n.assc||"",o=n.acc||o,g=n.aid||g)}catch(e){p.rslog.error("json parse error #RAT"),p.rslog.error(e)}o&&g&&(P.sParam.pageId=o+"_"+g);try{P.sParam.abt&&JSON.parse(P.sParam.abt)}catch(e){P.sParam.abt="",p.rslog.error("json parse error #RAT"),p.rslog.error(e)}P.sParam.ref=encodeURIComponent(document.referrer),P.sParam.pgn||(i=(document.location.href||"").match(/https?:\/\/[^\/$#?]+(\/[^$#?]+)?/))&&(P.sParam.pgn=i[1]||"top"),"1"===o&&"1"===g&&void 0!==document.getElementById("sc_betaInfo")&&((r=P.sParam.abt?JSON.parse(P.sParam.abt):{}).ichiba_top=document.getElementById("sc_betaInfo").value,P.sParam.abt=JSON.stringify(r))}catch(e){p.rslog.error(e)}},n.getSsrCookieVal=function(e){return e?P.getSsrV(e.sid,e.rid):""},n.setOption=function(e){P.optionList=e},n.getProgress=function(){return l},(p=new r).rslog=new a,m(function(){p.init()}))}(window.jQuery);
