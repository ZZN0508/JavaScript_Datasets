YUI.add("stencil-imageloader",function(i,e){"use strict";function r(e){this.constructor.superclass.constructor.call(this,e);var s,a=m.documentElement,t=i.DOM.docScrollY(a)+i.DOM.winHeight(a),o=i.DOM.docScrollX(a)+i.DOM.winWidth(a),e=e.host;r.checkPosition=null!==m.body.getAttribute("data-imageloader-checkposition"),e.all&&e.all("."+n).each(function(e){var a;!e.getDOMNode()||e.hasClass(c)||e.hasClass(d)||e.hasClass(g)||(e.getY()<=t&&e.getX()<=o?null===(a=e.getDOMNode()).offsetParent||0===a.offsetHeight?e.addClass(l):r.loadImage(e):(s=e._yuid||e.generateID(),r.imgs[s]=e))},this)}var s=Modernizr,n="ImageLoader",l=n+"-Hidden",c=n+"-Loaded",d=n+"-Loading",g=n+"-Delayed",u=0,m=i.config.doc,a=i.config.win;i.one("html").hasClass("stencil-plugin-imageloader")||(i.extend(r,i.Stencil.BasePlugin,{},{NS:"StencilImageLoader",requiresInit:!0,defaultTriggerEvents:[],initOnRootOnly:!0,imgs:{},loadImage:function(t){var e;t&&(t._node?(e=t).hasClass(c)||t.hasClass(d)||(e.test("img")?(t._error=0,this.swapSrc(t)):(e=t.all(".ImageLoader-Group")).each(this.swapSrc,this),t.hasClass(g)||t.hasClass(l)||t.removeClass(n),e.on("load",function(){t.setStyle("opacity",1),t.removeClass(g),t.removeClass(d),t.removeClass(l),t.removeClass(n),t.addClass(c),this.imgs[t._yuid]&&delete this.imgs[t._yuid]},this),e.on("error",function(e){var a,s=e.target;s._error||(t._error+=1,s.removeClass(d),a=s.get("src"),(e=new Image).onload=function(){s.setStyle("backgroundImage","url("+a+")"),r.swapSrc(s),r.imgs[s._yuid]&&delete r.imgs[s._yuid]},e.onerror=function(){},e.src=a)},this)):t._yuid&&delete this.imgs[t._yuid])},swapSrc:function(e){var a=e.getStyle("backgroundImage"),a=a&&"none"!==a?a:e.getData("imageloader-src");(a=/url\(["']?(.*?)["']?\)/.test(a)?RegExp.$1:a)&&0<a.length&&a!==e.get("src")&&(/\.svg$/.test(a)?s&&s.svg?e.set("src",a):(e.set("src",e.getData("imageloader-fallback")||"http://l.yimg.com/g/images/spaceball.gif"),e.addClass(d)):(e.set("src",a),e.addClass(d)),e.setStyle("backgroundImage",""))}}),i.on("domready",function(){i.on(["scroll","resize"],function(){var e,a,s,t,o,n=+new Date;if(0===u||100<=n-u)for(a in u=n,n=m.documentElement,s=i.DOM.docScrollY(n)+i.DOM.winHeight(n),t=i.DOM.docScrollX(n)+i.DOM.winWidth(n),o=r.imgs)if(o.hasOwnProperty(a)){if(!(e=o[a]).getDOMNode()){delete o[a];continue}(!r.checkPosition||e.getY()<=s&&e.getX()<=t)&&r.loadImage(e)}})}),i.one(a).on("load",function(){setTimeout(function(){i.all("."+l).each(r.loadImage,r)},2e3)}),i.one("body").on("imageloader:delayed",function(e){var a,s="."+g;i.Lang.isArray(e)?a=i.Array.reduce(e,new i.NodeList,function(e,a){return e.concat(a.all(s))}):e instanceof i.NodeList?(a=new i.NodeList,e.each(function(e){a=a.concat(e.all(s))})):a=e&&e.all(s),a&&a.size()&&a.each(r.loadImage,r)}),i.Stencil.registerPlugin(r,"ImageLoader"))},"@VERSION@",{requires:["stencil-base","yui-base","dom-base","dom-screen","node-base","node-screen","node-style","node-pluginhost","array-extras"]});
