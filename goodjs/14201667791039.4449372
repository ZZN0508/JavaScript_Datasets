var SecurimageAudio=function(e){this.html5Support=!0,this.flashFallback=!1,this.captchaId=null,this.playing=!1,this.reload=!1,this.audioElement=null,this.controlsElement=null,this.playButton=null,this.playButtonImage=null,this.loadingImage=null,e.audioElement&&(this.audioElement=document.getElementById(e.audioElement)),e.controlsElement&&(this.controlsElement=document.getElementById(e.controlsElement)),this.init()};SecurimageAudio.prototype.init=function(){var e=navigator.userAgent.toLowerCase(),t=-1!=e.indexOf("msie")&&parseInt(e.split("msie")[1]);t||null==(t=e.match(/trident\/.*rv:(\d+\.\d+)/))||(t=parseInt(t[1]));var i=0<(i=this.audioElement.getElementsByTagName("object")).length?i[0]:null;if(t){if(t<9)return this.controlsElement.style.display="none",void(this.html5Support=!1);if(""==this.audioElement.canPlayType("audio/wav")){var a,l=this.audioElement.getElementsByTagName("source"),n=!1;i&&(this.flashFallback=!0);for(var o,r=0;r<l.length;++r)if(0<=(a=l[r].attributes.type.value).toLowerCase().indexOf("mpeg")||0<=a.toLowerCase().indexOf("mp3")){n=!0;break}if(0==n)return this.html5Support=!1,this.flashFallback&&(o=document.createElement("object"),e=document.createElement("param"),t=i.getElementsByTagName("param"),this.copyElementAttributes(o,i),0<t.length&&(this.copyElementAttributes(e,t[0]),o.appendChild(e)),i.parentNode.removeChild(i),this.audioElement.parentNode.appendChild(o)),this.audioElement.parentNode.removeChild(this.audioElement),void this.controlsElement.parentNode.removeChild(this.controlsElement)}}this.audioElement.addEventListener("playing",this.updateControls.bind(this),!1),this.audioElement.addEventListener("ended",this.audioStopped.bind(this),!1);for(var s=this.controlsElement.getElementsByTagName("*"),r=0;r<s.length;++r){var d=s[r];null!=d.className&&(0<=d.className.indexOf("play_button")?(this.playButton=d).addEventListener("click",this.play.bind(this),!1):0<=d.className.indexOf("play_image")?this.playButtonImage=d:0<=d.className.indexOf("loading_image")&&(this.loadingImage=d))}i&&i.parentNode.removeChild(i)},SecurimageAudio.prototype.play=function(e){null!=this.playButton&&this.playButton.blur(),this.reload&&(this.replaceElements(),this.reload=!1);try{if(this.playing)this.audioElement.pause(),null!=this.loadingImage&&(this.loadingImage.style.display="none"),null!=this.playButtonImage&&(this.playButtonImage.style.display=""),this.playing=!1;else{null!=this.playButtonImage&&(this.playButtonImage.style.display="none"),null!=this.loadingImage&&(this.loadingImage.style.display=""),this.audioElement.onerror=this.audioError;try{this.audioElement.play()}catch(e){alert("Audio error: "+e)}}}catch(e){alert("Audio error: "+e)}return void 0!==e&&e.preventDefault(),!1},SecurimageAudio.prototype.refresh=function(e){if(this.html5Support)return void 0!==e&&(this.captchaId=e),this.playing=!0,this.reload=!1,this.play(),!(this.reload=!0)},SecurimageAudio.prototype.copyElementAttributes=function(e,t){for(var i=0,a=t.attributes,l=a.length;i<l;++i)e.setAttribute(a[i].nodeName,a[i].value);return e},SecurimageAudio.prototype.replaceElements=function(){var e=this.audioElement.parentNode;e.removeChild(this.audioElement);var t=document.createElement("audio");t.setAttribute("style","display: none;"),t.setAttribute("preload","false"),t.setAttribute("id",this.audioElement.id);for(var i,a,l=0;l<this.audioElement.children.length;++l)"source"==this.audioElement.children[l].tagName.toLowerCase()&&(i=document.createElement("source"),this.copyElementAttributes(i,this.audioElement.children[l]),a=null!==this.captchaId?this.captchaId:(Math.random()+"").replace("0.",""),i.src=i.src.replace(/([?|&])id=[a-zA-Z0-9]+/,"$1id="+a),t.appendChild(i));this.audioElement=null,this.audioElement=t,e.appendChild(this.audioElement),this.audioElement.addEventListener("playing",this.updateControls.bind(this),!1),this.audioElement.addEventListener("ended",this.audioStopped.bind(this),!1)},SecurimageAudio.prototype.updateControls=function(){this.playing=!0,null!=this.loadingImage&&(this.loadingImage.style.display="none"),null!=this.playButtonImage&&(this.playButtonImage.style.display="")},SecurimageAudio.prototype.audioStopped=function(){this.playing=!1},SecurimageAudio.prototype.audioError=function(e){var t=null;switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:break;case e.target.error.MEDIA_ERR_NETWORK:t="A network error caused the audio download to fail.";break;case e.target.error.MEDIA_ERR_DECODE:alert("An error occurred while decoding the audio");break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:alert("The audio format is not supported by your browser.");break;default:alert("An unknown error occurred trying to play the audio.")}t&&alert("Audio playback error: "+t)};
