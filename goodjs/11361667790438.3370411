define("modules/clean/react/previews/video/preview_video",["require","exports","tslib","react","modules/clean/react/previews/video/preview_video_basic","modules/clean/react/previews/video/preview_video_comments2","modules/clean/react/previews/constants"],function(e,t,i,r,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewVideo=t.PreviewVideoProps=void 0,r=i.__importDefault(r),Object.defineProperty(t,"PreviewVideoProps",{enumerable:!0,get:function(){return o.PreviewVideoProps}}),t.PreviewVideo=function(e){var t=e.sourceContext,n=e.hidePageChrome;return t===s.PreviewSourceContext.EmbeddedSharedLinkFile||n?r.default.createElement(o.PreviewVideoBasic,i.__assign({},e)):r.default.createElement(a.PreviewVideoComments2,i.__assign({},e))}}),define("modules/clean/react/previews/error/preview_error",["require","exports","tslib","react","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/react/components/css","modules/clean/file_store/utils","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/fullscreen_view","modules/clean/react/previews/error/view","modules/clean/web_timing_logger","modules/clean/react/previews/error/upsell"],function(e,t,n,i,r,o,a,s,l,c,d,u,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewError=t._PreviewError=void 0,i=n.__importDefault(i),p=n.__importStar(p);var f,g=(f=i.default.Component,n.__extends(_,f),_.prototype.componentDidMount=function(){p.set_tti_exclusion_flow("failed previews not included"),p.mark_time_to_view(),p.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===c.ErrorType.PendingUploadError&&this.props.shareToken&&new o.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash).startPolling()},Object.defineProperty(_.prototype,"allowOpenInApp",{get:function(){return!!this.props.file.open_in_app_data&&!this.props.isMobileUserAgent},enumerable:!1,configurable:!0}),_.prototype.logPreviewSupportDenied=function(){this.props.errorType!==c.ErrorType.LoadError&&this.props.errorType!==c.ErrorType.PendingUploadError&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(l.EventType.FilePreviewSupportDenied,{errorType:this.props.errorType})},_.prototype.render=function(){var e=r.Emstring.em_snippet(s.getFilename(this.props.file),this.props.maxFilenameEmLength);return this.props.errorType===c.ErrorType.UpsellError?i.default.createElement(m.PreviewUpsellErrorView,{areActionablesEnabled:this.props.areActionablesEnabled,allowOpenInApp:this.allowOpenInApp,count:this.props.count,errorType:this.props.errorType,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,filePreviewSession:this.props.filePreviewSession,filename:e,index:this.props.index,onNext:this.props.onNext,onPrevious:this.props.onPrevious,preview:this.props.preview,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,sharedLinkInfo:this.props.sharedLinkInfo,shouldDisplayToolbar:this.props.shouldDisplayToolbar,sizeClass:this.props.sizeClass,user:this.props.user,encryptionOptions:this.props.encryptionOptions}):this.props.isFullscreen?i.default.createElement(d.PreviewErrorFullscreenView,n.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e})):i.default.createElement(u.PreviewErrorView,n.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e}))},_.defaultProps={areActionablesEnabled:!0,isFullscreen:!1},_);function _(){return null!==f&&f.apply(this,arguments)||this}t._PreviewError=g;g=a.requireCssWithComponent(g,["/static/css/preview_error-vflujfmWk.css"]);t.PreviewError=g}),define("modules/clean/react/previews/video/preview_video_comments2",["require","exports","tslib","react","react-redux","comments2/components/annotation_utils","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/video_annotations/annotation_helper","modules/clean/react/comments2/video_annotations/constants","modules/clean/react/comments2/video_annotations/video_preview_event_emitter","modules/clean/react/previews/video/preview_video_basic"],function(e,t,n,i,r,o,a,s,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewVideoComments2=t.ConnectedPreviewVideoComments2=t.PreviewVideoBasicWithPlayerIntegration=void 0;var m,f=(m=(i=n.__importDefault(i)).default.PureComponent,n.__extends(g,m),g.prototype.componentDidMount=function(){this.seekToActivatedTimecode()},g.prototype.componentDidUpdate=function(e){e.activatedTimecodeThread===this.props.activatedTimecodeThread||this.isPendingThread(e)||this.seekToActivatedTimecode()},g.prototype.isPendingThread=function(e){return(null===(e=e.activatedTimecodeThread)||void 0===e?void 0:e.pending)||(null===(e=this.props.activatedTimecodeThread)||void 0===e?void 0:e.pending)},g.prototype.seekToActivatedTimecode=function(){var e,t=this.props.activatedTimecodeThread;t&&(e=0,e=o.isVideoAnnotation(t.annotation)&&t.annotation.timeSec?t.annotation.timeSec:c.VideoAnnotationHelper.unitConvertDomainObjectTimeToSeconds(t.annotation.time),u.videoPreviewEventEmitter.emit(d.EventTypes.SEEK_POSITION_AND_PAUSE,e))},g.prototype.render=function(){var e=this.props,t=e.onTimeUpdate,e=e.playerIntegrationEnabled;return i.default.createElement(p.PreviewVideoBasic,n.__assign({},this.props,{onTimeUpdate:e?t:void 0}))},g);function g(){return null!==m&&m.apply(this,arguments)||this}t.PreviewVideoBasicWithPlayerIntegration=f,t.ConnectedPreviewVideoComments2=r.connect(function(e){var t=l.getIsPlayerIntegrationEnabled(e);return{showOnboarding:l.getShowOnboardingOnVideo(e),framePreciseCommentsEnabled:l.getFramePreciseCommentsEnabled(e),frameRate:l.getFrameRate(e),playerIntegrationEnabled:t,activatedTimecodeThread:t?l.getActivatedTimecodeThread(e):void 0}},{onTimeUpdate:a.Actions.updatePlayerCurrentTime,onGutterClick:a.Actions.deactivateAllThreads})(f);var _,f=(_=i.default.PureComponent,n.__extends(h,_),h.prototype.render=function(){return i.default.createElement(r.Provider,{store:this.store},i.default.createElement(t.ConnectedPreviewVideoComments2,n.__assign({},this.props)))},h);function h(e){e=_.call(this,e)||this;return e.store=s.getStoreForComments2(),e}t.PreviewVideoComments2=f}),define("modules/clean/react/workflows/markup/api",["require","exports","modules/clean/react/file_viewer/feedback_form/types","modules/clean/react/file_viewer/feedback_form/api"],function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.submitMarkupFeedback=void 0,t.submitMarkupFeedback=function(e,t,n){return r.submitFeedback(i.SubmitFeedbackProductName.DROPBOX_MARKUP,e,t,n)}}),define("modules/clean/react/previews/preview_zoom_container",["require","exports","tslib","keymaster","classnames","react","lodash","jquery","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n","modules/clean/react/sticky_position"],function(e,t,n,i,r,o,a,s,l,c,d,u,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewZoomContainer=void 0,i=n.__importDefault(i),r=n.__importDefault(r),o=n.__importDefault(o),a=n.__importStar(a),s=n.__importDefault(s);var g,_="",h="previewzoomcontainer",n=(g=o.default.Component,n.__extends(v,g),v.prototype.componentDidMount=function(){var e=this;this.flipNext=a.throttle(this.flipNext,100),this.flipPrevious=a.throttle(this.flipPrevious,100),i.default("esc",h,function(){e.onCloseFactory({},c.UserActionContext.Keyboard)}),null!=this.props.onZoomOut&&i.default("space",h,this.props.onZoomOut),_=i.default.getScope(),i.default.setScope(h),this.startControlsTimer()},v.prototype.componentWillUpdate=function(){i.default.setScope(h)},v.prototype.componentWillUnmount=function(){i.default.clearScope(h),i.default.setScope(_),clearTimeout(this.controlsHideTimer)},v.prototype.startControlsTimer=function(){var e=this;this.showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(){e.hideControls()},3e3)},v.prototype.showControls=function(){this.setState({controlsHidden:!1})},v.prototype.hideControls=function(){this.setState({controlsHidden:!0})},v.prototype.renderFlippableControls=function(){return this.props.fileCount?o.default.createElement(d.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious}):null},v.prototype.renderControls=function(){var e=this.props,t=e.renderZoomControls,n=e.scaleFactor,e=r.default("preview-toolbar-container",{hidden:this.state.controlsHidden});return o.default.createElement("div",{className:e,ref:"previewZoomerToolbarContainer"},o.default.createElement("div",{className:"preview-toolbar-overlay-container"},o.default.createElement("div",{className:"preview-toolbar-overlay"},o.default.createElement("div",{className:"preview-toolbar-content"},this.renderFlippableControls(),t?o.default.createElement("div",{className:r.default("toolbar-button-entry","zoom-out",{disabled:this.props.zoomOutDisabled}),onClick:this.props.onZoomOut},o.default.createElement(u.Sprite,{alt:m.intl.formatMessage({id:"pK5LJK",defaultMessage:"Zoom out"}),group:"web",name:"zoomout"})):null,t?o.default.createElement("div",{className:"toolbar-button-entry",ref:"zoomLabelContainer",onClick:this.props.onViewActualSize},o.default.createElement(p.TitleBubble,{content:m.intl.formatMessage({id:"Jzzn4t",defaultMessage:"View actual size"}),position:f.StickyPosition.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.default.createElement("span",null,Math.floor(100*(n||0)),"%"))):null,t?o.default.createElement("div",{className:r.default("toolbar-button-entry","zoom-in",{disabled:this.props.zoomInDisabled}),onClick:this.props.onZoomIn},o.default.createElement(u.Sprite,{alt:m.intl.formatMessage({id:"T8BfJ2",defaultMessage:"Zoom in"}),group:"web",name:"zoom"})):null))))},v.prototype.renderClose=function(){var e=r.default("preview-zoomer-close",{hidden:this.state.controlsHidden});return o.default.createElement("span",null,o.default.createElement("button",{"aria-label":m.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),className:e,onClick:this.onCloseFactory,ref:"previewZoomerClose"},o.default.createElement(u.Sprite,{alt:m.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),group:"web",name:"xclose"})))},v.prototype.render=function(){var e=r.default("preview-zoomer-container",{"zoomer-drag-disabled":this.props.dragDisabled});return o.default.createElement("div",{className:e,onClick:this.onClick,onMouseMove:this.onMouseMove,ref:"previewZoomerContainer"},this.props.children,this.renderClose(),this.renderControls())},v.defaultProps={dragDisabled:!0,zoomInDisabled:!0,zoomOutDisabled:!0},v);function v(){var n=null!==g&&g.apply(this,arguments)||this;return n.state={controlsHidden:!1},n.flipNext=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),n.props.onFlipNext&&n.props.onFlipNext(),l.logUserAction(c.UserAction.FlipNext,e)},n.flipPrevious=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),n.props.onFlipPrevious&&n.props.onFlipPrevious(),l.logUserAction(c.UserAction.FlipPrevious,e)},n.onClick=function(e){e.target===e.currentTarget&&(e.preventDefault(),n.onCloseFactory({},c.UserActionContext.LightboxFrame))},n.onMouseMove=function(e){0===s.default(e.target).parents(".preview-toolbar-overlay").length?n.startControlsTimer():clearTimeout(n.controlsHideTimer)},n.onCloseFactory=function(e,t){void 0===e&&(e={}),void 0===t&&(t=c.UserActionContext.LightboxCloseButton),l.logUserAction(c.UserAction.ToggleFullscreenOff,t),n.props.onClose()},n}t.PreviewZoomContainer=n}),define("modules/clean/react/previews/preview_html",["require","exports","tslib","react","react-dom","file-viewer/core/index","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/file_viewer/logging","modules/clean/react/previews/preview_toolbar","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/uri","modules/clean/react/previews/toolbar_flip_buttons","modules/clean/react/file_viewer/full_screen_helpers","file-viewer/toolbar/index","modules/clean/react/previews/preview_toolbar_button","modules/clean/react/previews/print_helpers","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","ts-keycode-enum","modules/clean/react/previews/preview_toolbar_frame_messenger","modules/core/i18n"],function(e,t,d,u,n,a,p,m,i,s,f,g,r,_,o,h,v,b,w,y,S,l,c,E,P){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewHTML=void 0,u=d.__importDefault(u),n=d.__importStar(n),r=d.__importStar(r),_=d.__importStar(_);var C,M=["failed","viewer-ready","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent","tab-switch","content-select"];(T=C=C||{}).ClearMouseTracking="clear-mouse-tracking",T.EnableRegionCreation="enable-region-creation",T.EnterFullscreen="enter-fullscreen",T.ExitViewerFullscreen="exit-viewer-fullscreen",T.PageDown="page-down",T.PageUp="page-up",T.SetCurrentPage="set-current-page",T.PreviewToolbarMounted="preview-toolbar-mounted",T.Print="print",T.ScreenDown="screen-down",T.ScreenUp="screen-up",T.ZoomIn="zoom-in",T.ZoomOut="zoom-out";var k,T=(k=u.default.Component,d.__extends(A,k),A.prototype.getIframeSrc=function(){var e=o.URI.parse(this.props.src);return this.props.isExcel&&(this.props.forceTestExcelHtml?e.updateQuery({canned_file_name:m.CannedTestFilename.ExcelHTML}):"password_protected"===this.props.forceRivieraException?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===this.props.forceRivieraException&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()},A.prototype.shouldIncreaseTabHeightForExcel=function(){return this.props.isExcel&&_.is_mobile_or_tablet()},A.prototype.isHtmlFrameMessage=function(e){return M.includes(e.action)},A.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},A.prototype.postKeysHandledByParent=function(){this.frameMessenger.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:I})},A.prototype.markWebTiming=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),r.mark_time_to_view(),r.mark_time_to_interactive()},A.prototype.componentDidMount=function(){this.logFilePreviewEvent(m.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(m.EventType.FilePreviewDownloadAttempted),this.props.usesFrameMessenger&&(this.frameMessenger=new i.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("iframe.previewhtml",this.handleTrustedMessageFromChild,M),this.frameMessenger.startListening(),this.postKeysHandledByParent());var e=n.findDOMNode(this.iframe);e.onload=this.handleIframeLoad,e.onerror=this.handleIframeError},A.prototype.componentWillUnmount=function(){this.props.usesFrameMessenger&&this.frameMessenger.stopListening()},A.prototype.render=function(){var e=this,t={};_.iOS&&(t=p.iOSIframeScrollStyles());var n=this.props,i=n.count,r=n.index,o=n.isFullscreen,a=n.isExcel,s=n.sharePermission,l=n.sizeClass,c=n.onClickNext,n=n.onClickPrevious;return u.default.createElement("div",{className:"preview-content",style:t},u.default.createElement("iframe",d.__assign({},this.getIframeProps())),u.default.createElement(f.PreviewToolbar,{elevateToolbar:a,isFullscreen:o,isHidden:l===g.SizeClass.Small,fadeController:function(e){var t=e.fadeIn,e=e.fadeOut;return u.default.createElement(E.PreviewToolbarFrameMessenger,{activeMouse:t,idleMouse:e})}},u.default.createElement(h.ToolbarFlipButtons,{index:r,count:i,onClickPrevious:n,onClickNext:c}),u.default.createElement(b.FullScreenButton,{className:"toolbar-button-entry",intl:P.intl,onClick:function(){return v.toggleFullScreen(o,m.UserActionContext.Toolbar)}}),u.default.createElement(w.PreviewToolbarButton,{className:"print","data-test":"print",disabled:!y.canPrint(s),spriteGroup:"web",spriteName:"print",tooltip:y.getPrintTooltip(s),onClick:y.canPrint(s)?function(){return e.printDocument(m.UserActionContext.Toolbar)}:function(){}}),u.default.createElement(S.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings})))},A.defaultProps={usesFrameMessenger:!0},A);function A(){var o=null!==k&&k.apply(this,arguments)||this;return o.getIframeProps=function(){var e={title:o.props.filename,name:"preview-content",type:"text/html",src:o.getIframeSrc(),sandbox:"",className:"previewhtml",ref:o.setRefIframe};return o.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},o.handleTrustedMessageFromChild=function(e){if(o.isHtmlFrameMessage(e)){var t=e.action,n=e.parameters;switch(t){case"failed":o.logFilePreviewEvent(m.EventType.FilePreviewDownloadSucceeded),o.logFilePreviewEvent(m.EventType.FilePreviewRenderFailed);var i=a.RivieraStatus.Unknown;n&&(i=n.rivieraStatusCode),o.props.onError&&o.props.onError(p.mapRivieraStatusToErrorType(i));break;case"viewer-ready":o.markWebTiming(),o.logFilePreviewEvent(m.EventType.FilePreviewDownloadSucceeded),o.logFilePreviewEvent(m.EventType.FilePreviewRenderSucceeded),o.props.setRenderStatusSuccess(),o.props.isFullscreen?o.frameMessenger.postMessageToChildren("enter-fullscreen"):o.frameMessenger.postMessageToChildren("exit-viewer-fullscreen"),o.props.sharePermission&&0===o.props.sharePermission.canDownloadRoles.length&&o.frameMessenger.postMessageToChildren("disable-download"),o.shouldIncreaseTabHeightForExcel()&&o.frameMessenger.postMessageToChildren("increase-tab-height");break;case"exit-parent-fullscreen":v.exitFullScreen(m.UserActionContext.Unknown);break;case"get-keydown-keys-handled-by-parent":o.postKeysHandledByParent();break;case"tab-switch":var r=null!=(null==n?void 0:n.tabId)?{tab_index:n.tabId}:void 0;s.logUserAction(m.UserAction.SwitchWorkbookTab,m.UserActionContext.Browser,r);break;case"content-select":r=null!=(null==n?void 0:n.tabId)?{tab_index:n.tabId}:void 0,s.logUserAction(m.UserAction.SelectWorkbookContent,m.UserActionContext.Browser,r)}}},o.handleIframeLoad=function(){o.logFilePreviewEvent(m.EventType.FilePreviewDownloadSucceeded),o.props.usesFrameMessenger||(o.markWebTiming(),o.logFilePreviewEvent(m.EventType.FilePreviewRenderSucceeded),o.props.setRenderStatusSuccess())},o.handleIframeError=function(){o.logFilePreviewEvent(m.EventType.FilePreviewDownloadFailed)},o.setRefIframe=function(e){o.iframe=e},o.printDocument=function(e){o.frameMessenger.postMessageToChildren(C.Print,{context:e})},o.keyboardBindings=[l.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.P},callback:function(){return o.printDocument(m.UserActionContext.Keyboard)}})],o}t.PreviewHTML=T;var I=((T={})[c.Key.Escape]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.Enter]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.Space]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.PageUp]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.PageDown]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.LeftArrow]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.UpArrow]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.RightArrow]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.DownArrow]={altKey:!0,ctrlKey:!0,metaKey:!0},T[l.ExtraKeyCodes.EQUALS]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.F]={altKey:!1,ctrlKey:!0,metaKey:!0},T[c.Key.P]={altKey:!0,ctrlKey:!0,metaKey:!0},T[l.ExtraKeyCodes.PLUS_EQUALS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},T[l.ExtraKeyCodes.MINUS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},T[l.ExtraKeyCodes.PLUS_EQUALS_FF_GERMAN]={altKey:!0,ctrlKey:!0,metaKey:!0},T[l.ExtraKeyCodes.MINUS_FF_MAC]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.PlusSign]={altKey:!0,ctrlKey:!0,metaKey:!0},T[c.Key.Dash]={altKey:!0,ctrlKey:!0,metaKey:!0},T)}),define("modules/clean/react/previews/preview_image",["require","exports","tslib","classnames","react","react-redux","modules/clean/analytics","modules/clean/image_preview_util","modules/clean/photos/thumbnail_url_util","modules/clean/previews/actions","modules/clean/react/comments2/components/annotations/loadable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","file-viewer/core/index","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_toolbar","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/clean/react/components/css","spectrum/dimensions/index","file-viewer/preview_image/index","modules/clean/file_store/utils","modules/clean/react/previews/toolbar_flip_buttons","file-viewer/toolbar/index","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","file-viewer/assets-metaserver","modules/clean/react/previews/print_helpers","modules/clean/react/previews/preview_toolbar_button","modules/clean/react/keyboard_binding/keyboard_binding","ts-keycode-enum","modules/clean/react/file_viewer/logging","modules/clean/react/watermarking/watermarking_layer","modules/clean/react/workflows/markup/markup_layer","modules/core/i18n"],function(n,e,s,y,S,t,i,E,P,r,l,C,o,a,c,M,d,u,k,T,A,p,m,f,g,I,F,O,x,D,_,h,R,N,v,L,b,w,U,W){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PreviewImage=e._PreviewImage=void 0,y=s.__importDefault(y),S=s.__importDefault(S),E=s.__importDefault(E),r=s.__importStar(r),T=s.__importStar(T),m=s.__importStar(m);var B=k.resolveAsset.bind(null,h.assets);function V(){}var K,j=(K=S.default.Component,s.__extends(q,K),q.prototype.componentWillUnmount=function(){this.rivieraStatusCodeRequest&&this.rivieraStatusCodeRequest.readyState!==XMLHttpRequest.DONE&&this.rivieraStatusCodeRequest.abort(),this.props.overflowZoomOff()},q.prototype.componentWillMount=function(){this.logFilePreviewEvent(C.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(C.EventType.FilePreviewDownloadAttempted)},q.prototype.componentDidMount=function(){this.logOpen();var e=this.props,t=e.nsId,e=e.sjId;null!=t&&null!=e&&window._timingData&&window._timingData.img&&window._timingData.img.dl_error_finish&&window._timingData.img.dl_error_finish[t+"_"+e]&&this.logRenderFailure(),new Promise(function(e,t){n(["modules/clean/react/previews/preview_image_zoom"],e,t)}).then(s.__importStar)},q.prototype.componentWillReceiveProps=function(e){e["preview-url"]!==this.props["preview-url"]&&(e=e.filePreviewSession,this.logFilePreviewEvent(C.EventType.FilePreviewSupportConfirmed,void 0,e),this.logFilePreviewEvent(C.EventType.FilePreviewDownloadAttempted,void 0,e),this.logOpen(),this.setState({scaleFactor:void 0,fitScaleFactor:void 0}),this.imgLoaded=!1)},q.prototype.componentDidUpdate=function(e,t){t.scaleFactor!==this.state.scaleFactor&&(null!=this.state.scaleFactor&&null!=this.state.fitScaleFactor&&this.state.scaleFactor>this.state.fitScaleFactor?this.props.overflowZoomOn():this.props.overflowZoomOff())},q.prototype.logFilePreviewEvent=function(e,t,n){void 0===t&&(t={}),null!=(n=void 0===n?this.props.filePreviewSession:n)&&n.recordEvent(e,t)},q.prototype.logOpen=function(){i.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})},q.prototype.shouldDisableZoom=function(){var e=this.props,t=e.sizeClass;return e.shouldDisplayToolbar||t===p.SizeClass.Small},q.prototype.zoomWithMultiplier=function(e){var t,n=this.state.fitScaleFactor,i=this.state.scaleFactor||n;1!==e&&i&&(t=.05*Math.round(i*e/.05),Math.abs(t-i)<.05&&(t+=1<e?.05:-.05),this.setState({scaleFactor:Math.min(Math.max(t,n||0),16)}))},q.prototype.render=function(){var t=this,e=this.props,n=e.count,i=e.currentMode,r=e.index,o=e.onNext,a=e.onPrevious,s=e.shouldDisplayToolbar,l=e.isEditMode,c=e.isFlippingEnabled,d=e.isFullscreen,u=e.sharePermission,p=e.contextMenuDisabled,m=e.windowWidth,f=e.windowHeight,g=e.nsId,_=void 0===g?0:g,h=e.sjId,v=void 0===h?0:h,b=e.fileName,w=e["preview-url"],g=this.state,h=g.scaleFactor,e=g.fitScaleFactor,g=h||e;return S.default.createElement("div",{className:y.default("flex-preview-container","image-visible","annotations-visible",E.default.PREVIEW_IMAGE_CONTAINER,{"zoom-disabled":this.shouldDisableZoom(),"has-toolbar":s})},S.default.createElement(I.PreviewImage,{previewMetadata:{content:{".tag":"image",default_src:T.getFallbackSrc(w),src_set:T.getSrcSet(w),full_size_src:P.fullSizeUrl(w),thumbnail_url_tmpl:w}},fileMetadata:{file_id:F.getFileRevisionId({ns_id:_,sjid:v}),file_name:b},fileInfo:{ns_id:_,sj_id:v,file_id:F.getFileRevisionId({ns_id:_,sjid:v}),bootstrap:{state:"ready"}},currentMode:i,data:void 0,filePreviewUiData:{zoomScaleFactor:h,fitScaleFactor:e||0,isSidebarOpen:!1,isFullScreen:!1,isFidelitySurveyVisible:!1},coreFileViewerUiData:{isDocSidebarOpen:!1},fileViewerId:"",intl:W.intl,dispatch:V,config:k.DEFAULT_CONFIG,contextMenuDisabled:!!p,onDoubleClick:this.onImageDoubleClick,onInteractive:this.logTTI,onRenderSucceeded:this.logRenderSuccess,onRenderFailed:this.logRenderFailure,sizerClassName:E.default.PREVIEW_IMAGE,className:y.default(E.default.PREVIEW_IMAGE_WRAPPER,"preview-content"),width:null!=m?m:0,height:null!=f?f:0,layerRenderFn:this.renderLayers,onFitScaleFactorChanged:this.handleFitScaleFactorChange,resolveAsset:B}),!l&&S.default.createElement(D.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),!l&&s&&S.default.createElement(A.PreviewToolbar,{isFullscreen:!!d},c?S.default.createElement(O.ToolbarFlipButtons,{index:r,count:n,onClickPrevious:a,onClickNext:o}):null,S.default.createElement(x.ZoomOutButton,{className:"toolbar-button-entry",disabled:null!=g&&null!=e&&g<=e,intl:W.intl,onClick:this.onZoomOut,onKeyUp:function(e){e.keyCode===L.Key.Enter&&t.onZoomOut()}}),S.default.createElement(x.ZoomToFitButton,{className:"zoom-label toolbar-button-entry",intl:W.intl,onClick:this.onZoomOriginalOrFit,zoomPercent:g}),S.default.createElement(x.ZoomInButton,{className:"toolbar-button-entry",disabled:null!=g&&16<=g,intl:W.intl,onClick:this.onZoomIn,onKeyUp:function(e){e.keyCode===L.Key.Enter&&t.onZoomIn()}}),S.default.createElement(x.FullScreenButton,{className:"toolbar-button-entry",intl:W.intl,onClick:function(){return M.toggleFullScreen(!!d,C.UserActionContext.Toolbar)}}),S.default.createElement(N.PreviewToolbarButton,{className:"print","data-test":"print",disabled:!R.canPrint(u),spriteGroup:"web",spriteName:"print",tooltip:R.getPrintTooltip(u),onClick:R.canPrint(u)?function(){return t.onPrint(C.UserActionContext.Toolbar)}:V})))},q);function q(){var a=null!==K&&K.apply(this,arguments)||this;return a.imgLoaded=!1,a.state={},a.logTTI=function(){a.props.filePreviewSession&&a.props.filePreviewSession.markPrimaryEvent(),m.mark_time_to_view(),m.mark_time_to_interactive()},a.logRenderSuccess=function(){a.imgLoaded||(a.imgLoaded=!0,a.logFilePreviewEvent(C.EventType.FilePreviewDownloadSucceeded),a.logFilePreviewEvent(C.EventType.FilePreviewRenderSucceeded),a.props.setRenderStatusSuccess(),null!=a.props.onLoad&&a.props.onLoad())},a.onImageDoubleClick=function(){a.shouldDisableZoom()&&a.props.sizeClass!==p.SizeClass.Small&&a.openFullscreen()},a.openFullscreen=function(){null!=a.props.isFullscreen&&M.enterFullScreen({})},a.logRenderFailure=function(){function e(e){var t={};void 0!==e&&(t.rivieraStatusCode=e.toString()),a.logFilePreviewEvent(C.EventType.FilePreviewDownloadFailed,t),a.props.onError&&a.props.onError(u.ErrorType.LoadError,e)}a.rivieraStatusCodeRequest=d.fetchRivieraStatusCode(a.props["preview-url"],e,e)},a.onZoomIn=function(){a.zoomWithMultiplier(1.25),o.logUserAction(C.UserAction.ZoomIn,C.UserActionContext.Toolbar)},a.onZoomOut=function(){a.zoomWithMultiplier(.8),o.logUserAction(C.UserAction.ZoomOut,C.UserActionContext.Toolbar)},a.onZoomOriginalOrFit=function(){var e=a.state,t=e.scaleFactor,e=e.fitScaleFactor;a.setState({scaleFactor:t===e?1:e})},a.onPrint=function(e){r.imagePrint(P.fullSizeUrl(a.props["preview-url"])),o.logUserAction(C.UserAction.Print,e)},a.handleFitScaleFactorChange=function(e){isNaN(e)||a.state.fitScaleFactor===e||a.setState({fitScaleFactor:e})},a.keyboardBindings=s.__spreadArrays(_.getEqualsKeyBindings(b.wrapKeyboardActionWithLogging(a.onZoomIn,C.UserAction.ZoomIn)),_.getMinusKeyBindings(b.wrapKeyboardActionWithLogging(a.onZoomOut,C.UserAction.ZoomOut)),[v.hydrateKeyboardBinding({keyboardEventCriteria:{which:L.Key.P},callback:function(){return a.onPrint(C.UserActionContext.Keyboard)}})]),a.renderLayers=function(o){return function(e){var t=S.default.createElement(I.ImageLayer,s.__assign({},o,e)),n=a.state.scaleFactor||a.state.fitScaleFactor||1,i=e.originalWidth,r=e.originalHeight,n=i&&r?{width:i*n,height:r*n}:void 0,r=i&&r?{width:i,height:r}:void 0,e=e.data.thumbnailUrl,e=n&&r&&a.props.isWatermarkingMode?S.default.createElement(w.WatermarkingLayer,{layerSize:n,pageDimensions:r,thumbUrl:e}):null,r=n&&r&&a.props.isMarkupMode?S.default.createElement(U.MarkupLayer,{layerSize:n,pageDimensions:r,page:0}):null;return n&&a.props.annotationAllowed?[S.default.createElement(l.AnnotationConductorLayer,{layerSize:n,key:"annotation-layer"},S.default.createElement(l.AnnotationInstructionalTooltipPane,{layerSize:n},t,e,r,S.default.createElement(l.AnnotationViewLayer,null)))]:[t,e,r]}},a}e._PreviewImage=j;f=f.requireCssWithComponent(function(n){return S.default.createElement(g.Dimensions,{className:"flex-preview-container"},function(e){var t=e.width,e=e.height;return S.default.createElement(j,s.__assign({},n,{windowHeight:e,windowWidth:t}))})},["/static/css/preview_image-vfl-h4TzK.css"]),f=t.connect(function(e){return{isFlippingEnabled:a.getIsFlippingEnabled(e),annotationAllowed:a.getAnnotationAllowed(e),isEditMode:a.getIsEditMode(e),isWatermarkingMode:a.getIsWatermarkingMode(e),isMarkupMode:a.getIsMarkupMode(e)}},{overflowZoomOn:c.overflowZoomOn,overflowZoomOff:c.overflowZoomOff})(f);e.PreviewImage=f}),define("modules/clean/react/previews/video/preview_video_basic",["require","exports","tslib","classnames","lodash","react","modules/clean/image_size","ts-keycode-enum","modules/clean/loggers/file_preview_logger","modules/clean/loggers/video_preview_logger","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/components/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/components/helpers","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/constants","modules/clean/react/previews/video/constants","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/uri","modules/clean/react/previews/video/utils","modules/clean/react/file_viewer/data/actions","react-redux"],function(n,p,m,f,e,g,_,t,i,r,h,o,a,s,l,c,d,v,b,u,w,y,S,E,P,C){"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.PreviewVideoBasic=p._PreviewVideoBasic=p.AsyncVideoPlayer=void 0,f=m.__importDefault(f),e=m.__importStar(e),g=m.__importDefault(g),w=m.__importStar(w),p.AsyncVideoPlayer=o.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/previews/video/video_player"],e,t)}).then(m.__importStar).then(function(e){return e.VideoPlayer})}});var M,o=(M=g.default.Component,m.__extends(k,M),k.prototype.setUpLoggers=function(){this.teardownLoggers(),this.userActionLogger=new i.FilePreviewUserActionLogger,this.userActionLogger.listenTo(l.filePreviewEventEmitter),this.videoLogger=new r.VideoPreviewLogger(this.props.fileExtension,this.props.filePreviewSession)},k.prototype.teardownLoggers=function(){this.userActionLogger&&(this.userActionLogger.unlistenTo(l.filePreviewEventEmitter),this.userActionLogger=null)},k.prototype.logFilePreviewTimelineEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},k.prototype.logUserAction=function(e,t){l.filePreviewEventEmitter.emit(s.EventType.FilePreviewUserAction,this.props.filePreviewSession,e,s.UserActionContext.VideoPlayer,t)},k.prototype.markRenderSucceeded=function(){this.logFilePreviewTimelineEvent(s.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess()},k.prototype.getPlaybackRates=function(){return[.5,1,1.25,1.5,2,4]},k.prototype.componentDidMount=function(){this.setUpLoggers()},k.prototype.componentWillUnmount=function(){this.teardownLoggers()},k.prototype.shouldComponentUpdate=function(e){return c.compareStateAndProps(e,{})},k.prototype.togglePlayback=function(){l.filePreviewEventEmitter.emit(s.EventType.FilePreviewVideoToggled)},k.prototype.render=function(){var e=this.props,t=e.title,n=e.previewUrl,i=e.separateResolutionUrls,r=e.sourceContext,o=e.thumbnailUrlTmpl,a=e.videoMetadataUrl,s=e.videoContainer,l=e.vttThumbnailsUrl,c=e.waveformUrl,d=E.video_type(s),u=r!==b.PreviewSourceContext.EmbeddedSharedLinkFile,e=!1,s=!1,r=0;y.is_mobile_or_tablet()&&(s=e=!0,r=1);r={preload:"auto",playbackRates:this.getPlaybackRates(),nativeControlsForTouch:s,playsinline:r};null!=o&&(r.poster=h.tagCriticalPathContentRequest(S.URI.parse(o).updateQuery({size:_.imageBestFitSize(window.innerWidth,window.innerHeight),size_mode:"2"}).toString(),this.props.filePreviewSession));u={videoProps:{src:n,separateResolutionSrcs:i,sourceContentType:d,metadataLink:a,title:t,vttThumbnailsUrl:l,waveformUrl:c},playerCallbacks:{onLoadedMetadata:this.onLoadedMetadata,onError:this.onError,onReady:this.onReady,onPlay:this.onPlay,onPause:this.onPause,onStartsPlaying:this.onStartsPlaying,onUserInactive:this.onUserInactive,onScrubberThumbnailsLoaded:this.onScrubberThumbnailsLoaded,onAudioWaveformLoaded:this.onAudioWaveformLoaded,onAudioWaveformFailed:this.onAudioWaveformFailed,onPlaybackRateChange:this.onPlaybackRateChange,onSeek:this.onSeek,onStalled:this.onStalled,onSelectQuality:this.onSelectQuality,onTimeUpdate:this.props.onTimeUpdate},playerOptions:r,seekPosition:this.props.seekPosition,shouldEnableControls:!this.props.hideControls,noDownload:e,shouldFocusOnReady:this.props.shouldFocusOnReady,onEmbed:this.onEmbed,onTruncated:this.onTruncated,onClose:this.onClose,shouldShowTruncationMessage:u,isAudio:this.props.isAudio,bytes:this.props.bytes,showOnboarding:!!this.props.showOnboarding,framePreciseCommentsEnabled:this.props.framePreciseCommentsEnabled,frameRate:this.props.frameRate,playerIntegrationEnabled:!!this.props.playerIntegrationEnabled};return g.default.createElement("div",{className:f.default({"flex-preview-container":!0,"touch-device":y.is_mobile_or_tablet()})},this.props.disableKeyboardShortcuts?null:g.default.createElement(v.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),g.default.createElement("div",{className:"preview-content preview-video",onClick:this.processGutterClick},g.default.createElement("div",{className:"preview-video__wrapper"},g.default.createElement("div",{className:f.default({"preview-video__aspect-container":!0,"preview-audio-transcoded":this.props.isAudio})},g.default.createElement("div",{className:"preview-video__container"},g.default.createElement(p.AsyncVideoPlayer,m.__assign({},u)))))))},k);function k(){var n=null!==M&&M.apply(this,arguments)||this;return n.lastPlaybackRate=1,n.userActionLogger=null,n.startsPlayingEvent=u.VideoPreviewEvent.VideoStartsPlaying,n.onEmbed=function(){n.logFilePreviewTimelineEvent(s.EventType.FilePreviewSupportConfirmed),n.logFilePreviewTimelineEvent(s.EventType.FilePreviewDownloadAttempted)},n.onLoadedMetadata=function(e){n.videoLogger.populateVideoDuration(e=void 0===e?0:e)},n.onReady=function(e){void 0===e&&(e=!1),n.logFilePreviewTimelineEvent(s.EventType.FilePreviewDownloadSucceeded),n.props.filePreviewSession&&n.props.filePreviewSession.markPrimaryEvent(),w.mark_time_to_view(),w.mark_time_to_interactive(),n.markRenderSucceeded(),n.videoLogger.logEvent(u.VideoPreviewEvent.PlayerRendered)},n.logPlay=e.once(function(){n.videoLogger.logEvent(u.VideoPreviewEvent.FirstClickPlay)}),n.onPlay=function(){var e=n.props.setMediaPlaying;n.logPlay(),e&&e()},n.onPause=function(e){var t=n.props.setMediaPaused;t&&t(),n.videoLogger.logEvent(u.VideoPreviewEvent.VideoPaused,{video_timestamp:e.toString()})},n.onStartsPlaying=function(e){n.videoLogger.logEvent(n.startsPlayingEvent,{play_latency:e.latency.toString(),play_latency_since:e.trigger}),n.startsPlayingEvent=u.VideoPreviewEvent.VideoResumesPlaying},n.onUserInactive=function(e){e!==n.lastPlaybackRate&&(n.lastPlaybackRate=e,n.logUserAction(s.UserAction.VideoPlaybackRateChanged,{playback_rate:e.toString()}))},n.onScrubberThumbnailsLoaded=function(e){e?n.videoLogger.logEvent(u.VideoPreviewEvent.ScrubberThumbnailsLoaded):n.videoLogger.logEvent(u.VideoPreviewEvent.ScrubberThumbnailsFailed)},n.onAudioWaveformLoaded=function(){n.videoLogger.logEvent(u.VideoPreviewEvent.AudioWaveformLoaded)},n.onAudioWaveformFailed=function(){n.videoLogger.logEvent(u.VideoPreviewEvent.AudioWaveformFailed)},n.onError=function(e){if(e&&(n.videoLogger.logEvent(u.VideoPreviewEvent.MediaError,{errorCode:e.code?e.code.toString():"",errorMessage:e.message||""}),"needflash"===e.message))return n.logFilePreviewTimelineEvent(s.EventType.FilePreviewSupportDenied),void("function"==typeof n.props.onError&&n.props.onError(b.ErrorType.NeedFlashError));n.logFilePreviewTimelineEvent(s.EventType.FilePreviewDownloadFailed),w.mark_time_to_view(),w.mark_time_to_interactive(),n.props.onError&&n.props.onError(b.ErrorType.LoadError)},n.onPlaybackRateChange=function(e,t){n.videoLogger.logEvent(u.VideoPreviewEvent.ChangePlaybackRate,{old_playback_rate:e.toString(),new_playback_rate:t.toString()})},n.onSeek=function(e,t){n.videoLogger.logEvent(u.VideoPreviewEvent.SeekVideo,{old_video_time:e.toString(),new_video_time:t.toString()})},n.onStalled=function(e,t){n.videoLogger.logEvent(u.VideoPreviewEvent.VideoStalled,{video_timestamp:e.toString(),playback_rate:t.toString()})},n.onTruncated=function(){l.filePreviewEventEmitter.emit(s.EventType.FilePreviewVideoTruncated),n.videoLogger.setVideoTruncated()},n.onClose=function(e){n.videoLogger.logEvent(u.VideoPreviewEvent.ClosePreview,{video_time_on_close:e.toString()})},n.onSelectQuality=function(e,t){n.videoLogger.logEvent(u.VideoPreviewEvent.ChangeVideoQuality,{old_video_quality:e,new_video_quality:t})},n.handleKeyPress=function(e){return(null==e?void 0:e.keyCode)===t.Key.Space&&(n.togglePlayback(),d.isKeyboardEvent(e)&&e.preventDefault(),!0)},n.keyboardBindings=[{keyboardEventCriteria:d.generateUnmodifiedKeyboardEventCriteria(t.Key.Space),callback:n.handleKeyPress}],n.processGutterClick=function(e){var t=n.props.onGutterClick;t&&e.target===e.currentTarget&&t()},n}p._PreviewVideoBasic=o;o=C.connect(void 0,{setMediaPlaying:P.setMediaPlaying,setMediaPaused:P.setMediaPaused})(o),o=a.requireCssWithComponent(o,["/static/css/preview_video-vflCsiyGF.css","/static/css/video-js-7-custom-v1-vflanqjiX.css"]);p.PreviewVideoBasic=o}),define("modules/clean/react/previews/error/view",["require","exports","tslib","classnames","react","modules/clean/react/previews/preview_toolbar","modules/clean/file_store/utils","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/core/i18n","modules/clean/react/previews/toolbar_flip_buttons"],function(e,t,n,b,w,y,S,E,P,C,M,k,T,i,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewErrorView=void 0,b=n.__importDefault(b),w=n.__importDefault(w),t.PreviewErrorView=function(e){var t=e.areActionablesEnabled,n=e.allowOpenInApp,i=e.count,r=e.errorType,o=e.extensionsEnabled,a=e.file,s=e.filename,l=e.index,c=e.message,d=e.onNext,u=e.onPrevious,p=e.preview,m=e.sharedLinkInfo,f=e.shareToken,g=e.sharePermission,_=e.shouldDisplayToolbar,h=e.sizeClass,v=e.user,e=e.encryptionOptions;return w.default.createElement("div",{className:b.default({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":_})},w.default.createElement("div",{className:"preview-error__wrapper"},w.default.createElement("div",{className:"preview-error__content"},w.default.createElement(k.PreviewErrorImage,{errorType:r}),w.default.createElement(T.PreviewErrorMessage,{file:a,preview:p,errorType:r,message:c}),w.default.createElement(M.PreviewErrorFileInfo,{filename:s,bytes:a.bytes}),t?w.default.createElement(E.Actionable,{allowOpenInApp:!!n,extensionsEnabled:o,file:a,variant:"primary",location:P.FileViewerPane.PreviewContent,sharedLinkInfo:m,shareToken:f,sharePermission:g,user:v,userActionContext:P.UserActionContext.PreviewContentMain,sizeClass:h,encryptionOptions:e}):null,r!==C.ErrorType.ExtensionError||S.isArchiveFile(a)?null:w.default.createElement(I,null)),_&&null!=l&&null!=i?w.default.createElement("div",{className:"preview-toolbar-container"},w.default.createElement(y.PreviewToolbar,{isFullscreen:!1},w.default.createElement(A.ToolbarFlipButtons,{index:l,count:i,onClickPrevious:u,onClickNext:d}))):null))};var I=function(){return w.default.createElement("div",{className:"preview-error__help-link"},w.default.createElement("a",{href:P.UnsupportedExtensionHelpLink,target:"_blank",rel:"noopener\n    noreferrer"},i.intl.formatMessage({id:"KlxqP+",defaultMessage:"Learn more."})))}}),define("modules/clean/react/previews/error/upsell",["require","exports","tslib","classnames","react","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/core/i18n","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/preview_toolbar","modules/clean/react/previews/toolbar_flip_buttons"],function(e,t,n,i,r,o,a,s,l,c,d,u,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewUpsellErrorView=void 0,i=n.__importDefault(i);var f,n=(f=(r=n.__importDefault(r)).default.Component,n.__extends(g,f),g.prototype.componentDidMount=function(){this.props.filePreviewSession&&u.filePreviewEventEmitter.emit(a.EventType.FilePreviewUpsellExposed,this.props.filePreviewSession)},g.prototype.render=function(){return r.default.createElement("div",{className:i.default({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":this.props.shouldDisplayToolbar})},r.default.createElement("div",{className:"preview-error__wrapper"},r.default.createElement("div",{className:"preview-error__content"},r.default.createElement(l.PreviewErrorImage,{errorType:this.props.errorType}),r.default.createElement(c.PreviewErrorMessage,{file:this.props.file,preview:this.props.preview,errorType:this.props.errorType}),r.default.createElement(s.PreviewErrorFileInfo,{filename:this.props.filename,bytes:this.props.file.bytes}),this.props.areActionablesEnabled?r.default.createElement("div",{className:"preview-error__upsell-cta"},r.default.createElement(o.Actionable,{allowOpenInApp:!!this.props.allowOpenInApp,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,variant:"primary",location:a.FileViewerPane.PreviewContent,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermission:this.props.sharePermission,user:this.props.user,userActionContext:a.UserActionContext.PreviewContentMain,sizeClass:this.props.sizeClass,encryptionOptions:this.props.encryptionOptions})):null,r.default.createElement("div",{className:"preview-error__help-link"},r.default.createElement("a",{href:a.PreviewsUpsellUrl,onClick:this.onClickCTA},d.intl.formatMessage({id:"pvR+AO",defaultMessage:"Upgrade"}))),this.props.shouldDisplayToolbar&&null!=this.props.index&&null!=this.props.count?r.default.createElement("div",{className:"preview-toolbar-container"},r.default.createElement(p.PreviewToolbar,{isFullscreen:!1},r.default.createElement(m.ToolbarFlipButtons,{index:this.props.index,count:this.props.count,onClickPrevious:this.props.onPrevious,onClickNext:this.props.onNext}))):null)))},g);function g(){var e=null!==f&&f.apply(this,arguments)||this;return e.onClickCTA=function(){e.props.filePreviewSession&&u.filePreviewEventEmitter.emit(a.EventType.FilePreviewUpsellClicked,e.props.filePreviewSession)},e}t.PreviewUpsellErrorView=n}),define("modules/clean/react/previews/error/fullscreen_view",["require","exports","tslib","react","modules/clean/react/components/css","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/message","modules/clean/react/previews/preview_zoom_container"],function(e,t,n,h,i,v,b,w,y,S,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewErrorFullscreenView=void 0,h=n.__importDefault(h);i=i.requireCssWithComponent(function(e){var t=e.allowOpenInApp,n=e.areActionablesEnabled,i=e.count,r=e.errorType,o=e.extensionsEnabled,a=e.file,s=e.filename,l=e.index,c=e.message,d=e.onNext,u=e.onPrevious,p=e.preview,m=e.sharedLinkInfo,f=e.shareToken,g=e.sharePermission,_=e.user,e=e.encryptionOptions;return h.default.createElement(E.PreviewZoomContainer,{fileCount:i,fileIndex:l,onClose:w.exitFullScreen,onFlipNext:d,onFlipPrevious:u,renderZoomControls:!1},h.default.createElement("div",{className:"preview-error--fullscreen fullscreen"},h.default.createElement(S.PreviewErrorMessage,{file:a,preview:p,errorType:r,message:c}),h.default.createElement(y.PreviewErrorFileInfo,{bytes:a.bytes,filename:s}),n?h.default.createElement(v.Actionable,{allowOpenInApp:!!t,extensionsEnabled:o,file:a,variant:"primary",location:b.FileViewerPane.PreviewContent,sharedLinkInfo:m,shareToken:f,sharePermission:g,user:_,userActionContext:b.UserActionContext.PreviewContentMain,encryptionOptions:e}):null))},["/static/css/preview_image-vfl-h4TzK.css","/static/css/preview_error-vflujfmWk.css"]);t.PreviewErrorFullscreenView=i}),define("modules/clean/average_counter",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AverageCounter=void 0;var n=(i.prototype.getAverage=function(){return this.average},i.prototype.add=function(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++},i.prototype.addArray=function(e){var t=e.reduce(function(e,t){return e+t}),e=this.count+e.length;this.average=(this.average*this.count+t)/e,this.count=e},i);function i(){this.average=0,this.count=0}t.AverageCounter=n}),define("modules/clean/callback_chain/callback_chain",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallbackChain=void 0;var n=(i.prototype.run=function(e){for(var t,n=void 0!==e.abortCallbackChain?e:(t=!1,(e=e).abortCallbackChain=function(){t=!0},Object.defineProperty(e,"callbackChainAborted",{get:function(){return t}}),e),i=0,r=this.callbacks;i<r.length;i++){var o=r[i];if(n.callbackChainAborted)break;o(n)}},i);function i(e){this.callbacks=e}t.CallbackChain=n}),define("modules/clean/react/file_action_button_group",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileActionButtonGroup=void 0,(t=t.FileActionButtonGroup||(t.FileActionButtonGroup={})).COMMENTS="COMMENTS",t.WATERMARKING="WATERMARKING"}),define("modules/clean/react/file_action_button_type",["require","exports","modules/core/i18n"],function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.getFileActionButtonText=t.FileActionButtonType=void 0,t.FileActionButtonType={COMMENT:"COMMENT",COPY:"COPY",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD",MOVE:"MOVE",OPEN:"OPEN",PREVIOUS_VERSIONS:"PREVIOUS_VERSIONS",REMOVE_LINK:"REMOVE_LINK",RENAME:"RENAME",SHARE:"SHARE",ENABLE_COMMENTS:"ENABLE_COMMENTS",DISABLE_COMMENTS:"DISABLE_COMMENTS",SHOW_RESOLVED_COMMENTS:"SHOW_RESOLVED_COMMENTS",HIDE_RESOLVED_COMMENTS:"HIDE_RESOLVED_COMMENTS",SUBSCRIBE:"SUBSCRIBE",SUBSCRIBE_TO_NOTIFICATIONS:"SUBSCRIBE_TO_NOTIFICATIONS",UNSUBSCRIBE:"UNSUBSCRIBE",UNSUBSCRIBE_FROM_NOTIFICATIONS:"UNSUBSCRIBE_FROM_NOTIFICATIONS",ENABLE_WATERMARKING:"ENABLE_WATERMARKING",REMOVE_WATERMARKING:"REMOVE_WATERMARKING"};var r=((i={})[t.FileActionButtonType.COMMENT]=n.intl.formatMessage({id:"aM022A",defaultMessage:"Comment"}),i[t.FileActionButtonType.COPY]=n.intl.formatMessage({id:"P7oHCQ",defaultMessage:"Copyâ€¦"}),i[t.FileActionButtonType.DELETE]=n.intl.formatMessage({id:"OADU7S",defaultMessage:"Deleteâ€¦"}),i[t.FileActionButtonType.DOWNLOAD]=n.intl.formatMessage({id:"n062nX",defaultMessage:"Download"}),i[t.FileActionButtonType.MOVE]=n.intl.formatMessage({id:"wz9EvW",defaultMessage:"Moveâ€¦"}),i[t.FileActionButtonType.OPEN]=n.intl.formatMessage({id:"PHsPd8",defaultMessage:"Open"}),i[t.FileActionButtonType.PREVIOUS_VERSIONS]=n.intl.formatMessage({id:"QSlOA6",defaultMessage:"Version history"}),i[t.FileActionButtonType.REMOVE_LINK]=n.intl.formatMessage({id:"yypOy/",defaultMessage:"Remove link"}),i[t.FileActionButtonType.RENAME]=n.intl.formatMessage({id:"cBNivm",defaultMessage:"Rename"}),i[t.FileActionButtonType.SHARE]=n.intl.formatMessage({id:"V5WMXh",defaultMessage:"Share"}),i[t.FileActionButtonType.ENABLE_COMMENTS]=n.intl.formatMessage({id:"ouKfC+",defaultMessage:"Enable comments"}),i[t.FileActionButtonType.DISABLE_COMMENTS]=n.intl.formatMessage({id:"iVmeBf",defaultMessage:"Disable comments"}),i[t.FileActionButtonType.SHOW_RESOLVED_COMMENTS]=n.intl.formatMessage({id:"fKXJUR",defaultMessage:"Show resolved comments"}),i[t.FileActionButtonType.HIDE_RESOLVED_COMMENTS]=n.intl.formatMessage({id:"U75RtN",defaultMessage:"Hide resolved comments"}),i[t.FileActionButtonType.SUBSCRIBE]=n.intl.formatMessage({id:"5rfGLn",defaultMessage:"Subscribe"}),i[t.FileActionButtonType.SUBSCRIBE_TO_NOTIFICATIONS]=n.intl.formatMessage({id:"9Zx9uj",defaultMessage:"Subscribe to notifications"}),i[t.FileActionButtonType.UNSUBSCRIBE]=n.intl.formatMessage({id:"JFibpn",defaultMessage:"Unsubscribe"}),i[t.FileActionButtonType.UNSUBSCRIBE_FROM_NOTIFICATIONS]=n.intl.formatMessage({id:"1Y5o16",defaultMessage:"Unsubscribe from notifications"}),i[t.FileActionButtonType.ENABLE_WATERMARKING]=n.intl.formatMessage({id:"WnWL5z",defaultMessage:"Enable watermarking"}),i[t.FileActionButtonType.REMOVE_WATERMARKING]=n.intl.formatMessage({id:"qXY4zf",defaultMessage:"Remove watermarking"}),i);t.getFileActionButtonText=function(e){return e&&r[e]?r[e]:null}}),define("modules/clean/react/file_viewer/more_dropdown/models",["require","exports","tslib","lodash"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoreOptionGroup=t.MoreOption=void 0,i=n.__importStar(i);var r,o=(l.prototype.equals=function(e){return i.isEqual(this,e)},l),a=(r=o,n.__extends(s,r),s);function s(e){void 0===e&&(e={});var t=r.call(this)||this;return t.className=e.className||null,t.fileActionButtonType=e.fileActionButtonType||null,t.handler=e.handler||i.noop,t.component=e.component||null,t.sortWeight=e.sortWeight||0,t}function l(){}t.MoreOption=a;var c,n=(c=o,n.__extends(d,c),d);function d(e){var t=c.call(this)||this;return t.fileActionButtonGroup=e.fileActionButtonGroup,t.options=e.options||[],t.sortWeight=e.sortWeight||0,t}t.MoreOptionGroup=n}),define("modules/clean/react/file_viewer/more_dropdown/more_option_registry",["require","exports","tslib","lodash","modules/clean/react/file_viewer/more_dropdown/models"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.moreOptionRegistry=t.MoreOptionRegistry=void 0,i=n.__importStar(i);var o,a=(l.prototype.emitChange=function(){return this.listeners.forEach(function(e){return e()})},l.prototype.addListener=function(t){var n=this;return this.listeners.push(t),function(){var e=n.listeners.indexOf(t);-1<e&&n.listeners.splice(e,1)}},l.prototype.removeListeners=function(){this.listeners=[]},o=l,n.__extends(s,o),s.prototype.isValidMoreOption=function(e){return null!=e.fileActionButtonType},s.prototype.isValidMoreOptionGroup=function(e){var t=this,e=e.options;return e.length&&e.every(function(e){return t.isValidMoreOption(e)})},s.prototype.isValidOption=function(e){return e instanceof r.MoreOption&&this.isValidMoreOption(e)||e instanceof r.MoreOptionGroup&&this.isValidMoreOptionGroup(e)},s.prototype.reset=function(){this.options=[],this.removeListeners()},s.prototype.getOptionItems=function(){return i.sortBy(this.options.slice(),function(e){return e.sortWeight})},s.prototype.addOption=function(e){if(!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");this.options=n.__spreadArrays(this.options,[e]),this.emitChange()},s.prototype.removeOption=function(e){if(null!=e&&!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");var t,n,i=this.options.length;this.options=(t=this.options,n=e,t.filter(function(e){return e!==n})),this.options.length<i&&this.emitChange()},s.prototype.replaceOption=function(t,n){if(null==n)throw new Error("Please provide option to replace it with. Otherwise use removeOption");if(!this.isValidOption(t)||!this.isValidOption(n))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");var i;t.equals(n)||(i=!1,this.options=this.options.map(function(e){return e===t?(i=!0,n):e}),i&&this.emitChange())},s);function s(){var e=null!==o&&o.apply(this,arguments)||this;return e.options=[],e}function l(){this.listeners=[]}t.MoreOptionRegistry=a,t.moreOptionRegistry=new a}),define("modules/clean/react/file_viewer/actionable",["require","exports","tslib","react","modules/clean/file_store/utils","modules/clean/react/open_in_app/button","modules/clean/react/share_download/button","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/extensions/data/types","modules/clean/react/file_viewer/open_button/open_button"],function(e,t,n,d,u,p,m,f,g,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Actionable=void 0,d=n.__importDefault(d),t.Actionable=function(e){var t,n=e.allowOpenInApp,i=e.extensionsEnabled,r=e.variant,o=e.location,a=e.sizeClass,s=e.user,l=e.userActionContext,c=e.encryptionOptions;return u.isSharedFile(e.file)?(t=e.file,n&&t.open_in_app_data?d.default.createElement(p.OpenInAppButton,{urls:t.open_in_app_data,userActionContext:l}):d.default.createElement(m.ShareDownloadButton,{copyable:t,importance:r,location:o,sharedLinkInfo:e.sharedLinkInfo,shareToken:e.shareToken,sharePermission:e.sharePermission,user:s,encryptionOptions:c})):s?(t=e.file,i?d.default.createElement(f.ExtensionsMenu,{file:t,user:s,showAsButtonIfDownloadOnly:!0,triggerType:g.TriggerType.PrimaryButton,telemetryContext:{surface:"previews"},onPresentInZoom:function(){}}):d.default.createElement(_.OpenButton,{file:t,user:s,justifyRight:!1,location:o,buttonVariant:r,sizeClass:a})):null}}),define("modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial",["require","exports","tslib","react","modules/clean/analytics","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/clean/react/file_viewer/app_download_interstitial/app_download_interstitial"],function(e,t,i,r,o,a,s,l,c,n,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilePreviewAppDownloadInterstitial=void 0;var u,p=(u=(r=i.__importDefault(r)).default.PureComponent,i.__extends(m,u),m.prototype.componentDidMount=function(){n.mark_time_to_interactive(),this.setupLogger(),this.filePreviewSession.markPrimaryEvent(),this.log(a.UserAction.AppDownloadInterstitialView)},m.prototype.componentWillReceiveProps=function(e){e.file.ns_id===this.props.file.ns_id&&e.file.sjid===this.props.file.sjid&&e.fileViewerSession===this.props.fileViewerSession||this.setupLogger(e)},m.prototype.setupLogger=function(e){void 0===e&&(e=this.props);var t=this.props,n=t.file,i=t.fileViewerSession,r=t.previewType,e=t.previewSourceAction,e=void 0===e?c.PreviewSourceAction.Visit:e,t=t.previewSourceContext,t=void 0===t?c.PreviewSourceContext.SharedLinkFile:t;i&&(this.filePreviewSession=new l.FilePreviewSession({file:n,previewType:r,fileViewerSession:i,sourceAction:e,sourceContext:t}))},m.prototype.log=function(e){var t=this.props,n=t.fileViewerSession,t=t.file;this.filePreviewSession&&n&&t.ns_id&&t.sjid&&o.MobileFilePreviewLogger.log(e,n.id,this.filePreviewSession.id,t.ns_id,t.sjid,{context:a.UserActionContext.AppDownloadInterstitial})},m.prototype.render=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,e=i.__rest(e,["file","sharedLinkInfo"]);return r.default.createElement(d.AppDownloadInterstitial,i.__assign({fileOrFolderName:s.getFilename(t),open_in_app_data:t.open_in_app_data,onContinue:this.onContinue,onAppDownload:this.onAppDownload,ownerName:n.ownerName,ownerTeamName:n.ownerTeamName,onClose:this.onClose},e))},m);function m(){var e=null!==u&&u.apply(this,arguments)||this;return e.onContinue=function(){e.log(a.UserAction.AppDownloadInterstitialContinue),"function"==typeof e.props.onContinue&&e.props.onContinue()},e.onClose=function(){e.log(a.UserAction.AppDownloadInterstitialClose),"function"==typeof e.props.onClose&&e.props.onClose()},e.onAppDownload=function(){e.log(a.UserAction.AppDownloadInterstitialInstall)},e}t.FilePreviewAppDownloadInterstitial=p}),define("modules/clean/react/file_viewer/cloud_doc_preview",["require","exports","tslib","react","modules/clean/cloud_docs/event_logging","modules/clean/cloud_docs/types","modules/clean/referrer_cleansing_redirect","modules/clean/file_store/utils","modules/clean/cloud_docs/constants"],function(e,t,n,i,r,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloudDocPreview=void 0,i=n.__importDefault(i),a=n.__importStar(a);var c,n=(c=i.default.Component,n.__extends(d,c),d.prototype.componentDidMount=function(){this.logPreviewAction(),this.shouldRedirect&&a.redirect(this.props.cloudDoc.exit_url)},d.prototype.componentDidUpdate=function(e){this.props.file.file_id!==e.file.file_id&&this.logPreviewAction()},d.prototype.shouldComponentUpdate=function(e){return this.props.file.file_id!==e.file.file_id},d.prototype.render=function(){if(this.shouldRedirect)return null;var e=s.getExtension(this.props.file);return["gdoc","gslides","paper","papert","binder"].includes(e)?this.props.renderPdfPreview(this.props.cloudDoc):["gsheet"].includes(e)?this.props.renderExcelPreview():this.props.renderUnsupportedErrorPreview()},d);function d(e){var t=c.call(this,e)||this;return t.logPreviewAction=function(){var e;t.props.file.file_id&&(e={},t.props.user?r.logUserAction({actionEvent:o.UserActionEventType.PREVIEW,userId:t.props.user.id,docPathOrId:t.props.file.file_id,actionSource:o.UserActionSourceType.WEB}):(t.props.LoggedOutUXGoogleVariant&&(e[l.CLOUD_DOCS_STORMCROW_LOGGED_OUT_UX_GOOGLE]=t.props.LoggedOutUXGoogleVariant||""),r.logLoggedOutUserAction({actionEvent:o.UserActionEventType.PREVIEW,userId:0,docPathOrId:t.props.file.file_id,actionSource:o.UserActionSourceType.WEB,extra:e})))},t.shouldRedirect=!e.showCloudDocPreview&&Boolean(e.cloudDoc.exit_url),t}t.CloudDocPreview=n}),define("modules/clean/react/file_viewer/exp_file_viewer_upsell_banner",["require","exports","tslib","react","modules/clean/react/components/css","modules/constants/payments","modules/core/i18n"],function(e,t,n,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExpFileViewerUpsellBannerV2=void 0,i=n.__importDefault(i),o=n.__importStar(o);var s,n=(s=i.default.Component,n.__extends(l,s),l.prototype.render=function(){var t=o.OUT_OF_SPACE_URL+"?oqa=oq_fp";return i.default.createElement("div",{className:"fileviewer-upsell-banner"},a.intl.formatMessage({id:"XOn3VZ",defaultMessage:"Get more space to add more files to your Dropbox. <a>Upgrade now.</a>"},{a:function(e){return i.default.createElement("a",{href:t},e)}}))},l);function l(){return null!==s&&s.apply(this,arguments)||this}t.ExpFileViewerUpsellBannerV2=r.requireCssWithComponent(n,["/static/css/exp_file_preview_upsell-vfli2_OuA.css"])}),define("modules/clean/react/file_viewer/feedback_form/api",["require","exports","tslib","api_v2/user_client","modules/clean/react/file_viewer/feedback_form/types"],function(e,t,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.submitFeedback=void 0,t.submitFeedback=function(n,i,r,o){return a.__awaiter(this,void 0,Promise,function(){var t;return a.__generator(this,function(e){switch(e.label){case 0:return o?(t=i===l.NOT_APPLICABLE_SATISFACTION_RATING_VALUE?void 0:i,t={product_name:n,satisfaction_rating:t,comment:r},[4,(new s.UserApiV2Client).ns("workflows").rpc("submit_feedback",t,{subjectUserId:o.id})]):[2];case 1:return[2,e.sent()]}})})}}),define("modules/clean/react/file_viewer/feedback_form/feedback_form_modal",["require","exports","tslib","react","modules/core/i18n","file-transfers/feedback-form/index","modules/clean/react/components/css","spectrum/modal/index","modules/clean/react/snackbar"],function(e,t,n,i,r,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackFormModal=t.FeedbackFormModalComponent=void 0,i=n.__importDefault(i);var c,d="feedback-snackbar-id",n=(c=i.default.Component,n.__extends(u,c),u.prototype.render=function(){var e=this.state,t=e.comment,e=e.rating;return i.default.createElement(s.UtilityModal,{ariaLabel:this.props.title,title:this.props.title,open:this.props.open,displayCloseButton:!0,overlayClickClose:!0,onReady:this.props.onReady,onRequestClose:this.props.onRequestClose,primaryAction:r.intl.formatMessage({id:"Laz2WV",defaultMessage:"Submit"}),onPrimaryAction:this.handlePrimaryAction,secondaryAction:r.intl.formatMessage({id:"5FcUkH",defaultMessage:"Not now"}),onSecondaryAction:this.props.onRequestClose,shouldRequestCloseOnActions:!1,overlayClassName:"file-viewer-modal-overlay",appElement:document.getElementById("embedded-app")||document.body},i.default.createElement(o.FeedbackForm,{comment:t,rating:e,commentPrompt:this.props.commentPrompt,onRatingChange:this.handleRatingChange,onCommentsChange:this.handleCommentsChange}))},u);function u(){var i=null!==c&&c.apply(this,arguments)||this;return i.state={comment:"",rating:null},i.handlePrimaryAction=function(){var e=i.state,t=e.rating,n=e.comment,e=i.props.user;t?(i.props.submitFeedback(t,n,e),i.props.onRequestClose(),l.Snackbar.complete(r.intl.formatMessage({id:"w0RwUf",defaultMessage:"Feedback submitted!"}),d)):l.Snackbar.fail(r.intl.formatMessage({id:"HnlRF6",defaultMessage:"Please provide a rating"}),d)},i.handleRatingChange=function(e){i.setState({rating:e})},i.handleCommentsChange=function(e){i.setState({comment:e})},i}t.FeedbackFormModalComponent=n,t.FeedbackFormModal=a.requireCssWithComponent(n,["/static/js/file-transfers/index.web-vflvWt1a4.css"])}),define("modules/clean/react/file_viewer/feedback_form/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=t.SubmitFeedbackProductName=void 0,(t.SubmitFeedbackProductName||(t.SubmitFeedbackProductName={})).DROPBOX_MARKUP="Dropbox Markup",t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=-1}),define("modules/clean/react/file_viewer/file_preview",["require","exports","tslib","classnames","react","lodash","file-viewer/core/index","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/previews/util","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/data/utils","modules/clean/cloud_docs/shared_components/routing","modules/clean/react/file_viewer/cloud_doc_preview","modules/clean/file_store/utils","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","file-viewer/core/index","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/error/preview_error","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/video/preview_video","modules/clean/react/previews/preview_pdf_loadable","modules/clean/react/previews/preview_ppt_loadable","modules/clean/react/previews/archive/preview_archive_loadable","spectrum-sharing/utils/sharing_constants","modules/core/i18n","modules/core/browser","modules/clean/react/file_viewer/file_preview_logging_manager","modules/clean/redux/types","modules/clean/previews/data/util","modules/clean/react/snackbar","modules/clean/react/file_viewer/logging"],function(n,e,E,d,P,r,C,o,u,p,M,t,i,a,s,l,k,c,b,m,f,w,g,_,h,v,T,A,y,S,I,F,O,x,D,R,N){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FilePreviewWithLogging=e.FilePreview=void 0,d=E.__importDefault(d),P=E.__importDefault(P),r=E.__importStar(r),u=E.__importStar(u),p=E.__importStar(p),F=E.__importStar(F);var L,U,W=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/previews/preview_image_zoom"],e,t)}).then(E.__importStar).then(function(e){return e.PreviewImageZoom})}}),B=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/previews/limited_preview_message"],e,t)}).then(E.__importStar).then(function(e){return e.LimitedPreviewMessage})}}),F=F.get_uri().getQuery(),V=F.forceRivieraException,K=F.forceTestPdf,j=F.forceTestExcelHtml,q=(U=P.default.Component,E.__extends(G,U),G.prototype.componentDidMount=function(){this.triggerDynamicRoutingModalCheck()},G.prototype.componentDidUpdate=function(e){var t=e.user,n=e.file,i=this.props,e=i.user,i=i.file;r.isEqual(n,i)&&r.isEqual(t,e)||this.triggerDynamicRoutingModalCheck()},G.prototype.triggerDynamicRoutingModalCheck=function(){var e=this.props,t=e.user,n=e.file,e=e.file.file_id;t&&e&&!this.isViewOnly()&&s.maybeShowDynamicRoutingModal(t,n,k.getExtension(n))},G.prototype.isViewOnly=function(){var e=!1;return e=this.props.hasOwnProperty("shareToken")&&void 0!==this.props.shareToken?this.props.shareToken.linkType===S.SharedLinkType.Shmodel:e},G.prototype.render=function(){var e=this.props,t=e.doc,n=t.autoprint_url,i=t.image_url_tmpl,r=t.refresh_url,o=void 0===r?"":r,a=t.text_url_tmpl,s=e.file,l=e.filePreviewSession,c=e.invalidateFrameMessenger,d=e.isFullscreen,u=e.isSidebarOpen,p=e.location,m=e.mode,f=void 0===m?C.FileViewerMode.Default:m,g=e.renderUnsupportedErrorPreview,_=e.setRenderStatusSuccess,h=e.sharePermission,v=e.shareToken,b=e.sidebar,w=e.sizeClass,y=e.triggerError,S=e.user,r=e.count,t=e.index,m=e.onPrevious,e=e.onNext;if(!i||!a)return g();g=k.getExtension(s),e={autoprintUrl:n,currentMode:{sidebar:b,mode:f},revisionId:D.buildRevisionId(s.ns_id,s.sjid),file:s,fileExtension:g,filePreviewSession:l,imageUrlTmpl:i,isArchiveFile:!1,isFullscreen:d,isSidebarOpen:u,onError:y,useCanned:!!K,refreshUrl:o,location:p,sharePermission:h,shareToken:v,sizeClass:w,textUrlTmpl:a,invalidateFrameMessenger:c,setRenderStatusSuccess:_,user:S,count:r,index:t,onPrevious:m,onNext:e};return M.isPptExtension(g)?P.default.createElement(A.PreviewPPTLoadable,E.__assign({},e)):P.default.createElement(T.PreviewPDFLoadable,E.__assign({},e))},G),H=(L=P.default.Component,E.__extends(z,L),z.prototype.componentWillReceiveProps=function(e){r.isEqual(e.file,this.props.file)||this.setState({hasError:!1,errorType:void 0})},z.prototype.componentDidMount=function(){var e,t;o.PreviewType.Excel===u.getPreviewType(this.props.previewApiData.data)&&(e=this.props.file,t=k.getExtension(e),this.props.user&&e.file_id&&!this.isViewOnly()&&s.maybeShowDynamicRoutingModal(this.props.user,e,t)),window.setTimeout(c.cleanupPrerenderPreview)},z.prototype.isViewOnly=function(){var e=!1;return e=this.props.hasOwnProperty("shareToken")&&void 0!==this.props.shareToken?this.props.shareToken.linkType===S.SharedLinkType.Shmodel:e},z.prototype.renderImagePreview=function(e){var t=this.props,n=t.file,i=t.mode,r=t.sidebar,t=k.getExtension(n),r={mode:i||C.FileViewerMode.Default,sidebar:r};if(this.props.isFullscreen)return P.default.createElement(W,{currentMode:r,thumbnailUrlTmpl:e.thumbnail_url_tmpl,fileCount:this.props.count,fileIndex:this.props.index,onError:this.triggerError,onFlipNext:this.handleNext,onFlipPrevious:this.handlePrevious,filePreviewSession:this.props.filePreviewSession,contextMenuDisabled:this.shouldDisableDownload(),fileExtension:t,fileId:this.props.file.file_id||"",fileName:k.getFilename(this.props.file),setRenderStatusSuccess:this.props.setRenderStatusSuccess});n={currentMode:r,"preview-url":e.thumbnail_url_tmpl,"file-extension":t,isFullscreen:this.props.isFullscreen,shouldDisplayToolbar:this.props.shouldDisplayToolbar&&!p.isLimitedPreview(n,o.PreviewType.Image),index:this.props.index,count:this.props.count,onPrevious:this.handlePrevious,onError:this.triggerError,onNext:this.handleNext,filePreviewSession:this.props.filePreviewSession,contextMenuDisabled:this.shouldDisableDownload(),nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:k.getFilename(this.props.file),sizeClass:this.props.sizeClass,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission};return P.default.createElement(_.PreviewImage,E.__assign({},n))},Object.defineProperty(z.prototype,"shouldShowActionables",{get:function(){return this.props.areActionablesEnabled&&!k.isArchiveFile(this.props.file)},enumerable:!1,configurable:!0}),z.prototype.renderVideoPreview=function(e){var t=this.props,n=t.file,t=t.hidePageChrome;return P.default.createElement(v.PreviewVideo,{title:k.getFilenameWithoutExtension(n),fileExtension:k.getExtension(n),previewUrl:e.transcode_url,separateResolutionUrls:e.transcode_urls_separate_resolutions,thumbnailUrlTmpl:e.poster_url_tmpl,videoMetadataUrl:e.metadata_url,videoContainer:e.container,shouldFocusOnReady:this.props.shouldFocusOnReady,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,sourceContext:this.props.sourceContext,vttThumbnailsUrl:e.thumb_scrubber_vtt_url,setRenderStatusSuccess:this.props.setRenderStatusSuccess,user:this.props.user,hidePageChrome:t})},z.prototype.renderLinkfilePreview=function(e){var t=this.props.file,n={url:e.url,authenticated:!!e.authenticated};return P.default.createElement(h.PreviewLinkfile,{filename:k.getFilename(t),data:n,source:e.authenticated?"browse":"sharedLink",filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess,index:this.props.index,count:this.props.count,onPrevious:this.handlePrevious,onNext:this.handleNext})},z.prototype.getCommonHtmlPreviewProps=function(){var e=this.props.file,t=k.getExtension(e);return{count:this.props.count,fileExtension:t,filePreviewSession:this.props.filePreviewSession,filename:k.getFilename(e),index:this.props.index,isFullscreen:this.props.isFullscreen,onClickNext:this.handleNext,onClickPrevious:this.handlePrevious,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission,sizeClass:this.props.sizeClass}},z.prototype.renderHtmlifiedPreview=function(e){var t=e.htmlified_link,e=e.uses_frame_messenger;return t?P.default.createElement(g.PreviewHTML,E.__assign({src:t,isExcel:!1,usesFrameMessenger:e},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},z.prototype.renderRawHtmlPreview=function(){var e=this.props.previewApiData.data.preview_url;return e?P.default.createElement(g.PreviewHTML,E.__assign({src:e,isExcel:!1,usesFrameMessenger:!1},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},z.prototype.renderAudioPreview=function(e){var t=this.props.file;return P.default.createElement(v.PreviewVideo,{title:k.getFilenameWithoutExtension(t),fileExtension:k.getExtension(t),previewUrl:e.transcode_url,videoContainer:e.container,filePreviewSession:this.props.filePreviewSession,shouldFocusOnReady:this.props.shouldFocusOnReady,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sourceContext:this.props.sourceContext,isAudio:!0,bytes:t.bytes,waveformUrl:e.waveform_url,user:this.props.user})},z.prototype.renderArchivePreview=function(){return P.default.createElement(y.PreviewArchiveLoadable,{rootFile:this.props.file,previewUrl:this.props.previewApiData.data.preview_url,fileSubpath:this.props.fileSubpath,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharedLinkUrl:this.props.sharedLinkUrl,user:this.props.user,encryptionOptions:this.props.encryptionOptions,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken})},z.prototype.renderCloudDocPreview=function(e){return P.default.createElement(l.CloudDocPreview,{file:this.props.file,user:this.props.user,cloudDoc:e,showCloudDocPreview:this.props.showCloudDocPreview,renderExcelPreview:this.renderExcelPreview,renderPdfPreview:this.renderPdfPreview,renderUnsupportedErrorPreview:this.renderUnsupportedErrorPreview,LoggedOutUXGoogleVariant:this.props.LoggedOutUXGoogleVariant})},z.prototype.renderErrorPreview=function(e){var t=this.state.rivieraStatusCode,n=this.props,i=n.count,r=n.extensionsEnabled,o=n.file,a=n.previewApiData,s=n.filePreviewSession,l=n.index,c=n.isFullscreen,d=n.isMobileUserAgent,u=n.maxFilenameEmLength,p=n.mode,m=n.sharedLinkInfo,f=n.sharePermission,g=n.shareToken,_=n.user,h=n.encryptionOptions,v=this.props.shouldDisplayToolbar&&!k.isArchiveFile(o),n=e;return p===C.FileViewerMode.Watermarking&&(R.Snackbar.close(),n=b.ErrorType.WatermarkingError),P.default.createElement(w.PreviewError,{file:o,extensionsEnabled:r,preview:a.data,maxFilenameEmLength:u,filePreviewSession:s,errorType:n,user:_,areActionablesEnabled:this.shouldShowActionables,sharedLinkInfo:m,shareToken:g,sharePermission:f,shouldDisplayToolbar:v,index:l,isFullscreen:c,isMobileUserAgent:d,count:i,onPrevious:this.handlePrevious,onNext:this.handleNext,message:this.getErrorMessage(e,t,o),sizeClass:this.props.sizeClass,encryptionOptions:h})},z.prototype.getPreviewTypeWhitelist=function(){return this.props.previewTypeWhitelist||p.VALID_PREVIEW_TYPES},z.prototype.choosePreview=function(){var e=this.props,t=e.file,n=e.previewApiData,i=this.getPreviewTypeWhitelist(),e=this.validateFile(t,n);if(e)return e;if(n.status===x.ApiClientStatus.Request)return this.showLoadingIndicator();if(n.status===x.ApiClientStatus.Error)return this.renderErrorPreview(b.ErrorType.ExtensionError);if(!n.data||!n.data.content)return k.isArchiveFile(t)?this.renderErrorPreview(b.ErrorType.ExtensionError):this.renderErrorPreview(b.ErrorType.UnknownError);var r=n.data.content,n=u.getPreviewType(n.data);if(p.isEmptyFile(t)&&n!==o.PreviewType.CloudDoc)return this.renderErrorPreview(b.ErrorType.EmptyFileError);if(null!=i&&!i.includes(n))return this.renderErrorPreview(b.ErrorType.ExtensionError);if(n===o.PreviewType.Restricted)return a.isUserOwnerOfFile(this.props.user,this.props.file)?this.renderErrorPreview(b.ErrorType.UpsellError):this.renderErrorPreview(b.ErrorType.ExtensionError);switch(n){case o.PreviewType.Video:return this.renderVideoPreview(r);case o.PreviewType.Audio:return this.renderAudioPreview(r);case o.PreviewType.Archive:return this.renderArchivePreview();case o.PreviewType.Image:return this.renderImagePreview(r);case o.PreviewType.SsrDoc:return P.default.createElement(q,E.__assign({},this.props,{onPrevious:this.handlePrevious,onNext:this.handleNext,doc:r,renderUnsupportedErrorPreview:this.renderUnsupportedErrorPreview,triggerError:this.triggerError}));case o.PreviewType.Linkfile:return this.renderLinkfilePreview(r);case o.PreviewType.CloudDoc:return this.renderCloudDocPreview(r);case o.PreviewType.Excel:return this.renderExcelPreview();case o.PreviewType.RawHTML:return this.renderRawHtmlPreview();case o.PreviewType.HTML:return this.renderHtmlifiedPreview(r)}},z.prototype.validateFile=function(e,t){return e.is_dir&&!p.isSupportedBundleFile(e)?this.renderErrorPreview(b.ErrorType.ExtensionError):null!=e.ns_id||k.isArchiveFile(e)?k.isSymLink(e)?this.renderErrorPreview(b.ErrorType.SymLinkError):t?p.filesizeSupported(e,u.getPreviewType(t.data))?void 0:this.renderErrorPreview(b.ErrorType.FileSizeError):this.renderErrorPreview(b.ErrorType.ExtensionError):this.renderErrorPreview(b.ErrorType.PendingUploadError)},z.prototype.render=function(){var e=this.props,t=e.file,n=e.previewApiData,i=e.sharedLinkInfo,r=e.shareToken,o=e.sharePermission,a=e.sizeClass,s=e.user,l=e.encryptionOptions,c=this.state,e=c.errorType;return c.hasError?this.renderErrorPreview(e):P.default.createElement("div",{className:d.default({"flex-preview-container":!0,"no-download":o&&0===o.canViewContextMenuRoles.length}),onContextMenu:this.onContextMenu,onCopy:this.onCopy},k.isArchiveFile(t)?null:P.default.createElement(O.FilePreviewPaasLoggerManager,{file:t}),this.choosePreview(),n&&p.isLimitedPreview(t,u.getPreviewType(n.data))?P.default.createElement(B,{extension:k.getExtension(t),file:t,sharedLinkInfo:i,shareToken:r,sharePermission:o,shouldShowActionables:this.shouldShowActionables,sizeClass:a,user:s,encryptionOptions:l}):null)},z.defaultProps={areActionablesEnabled:!0,isFullscreen:!1,sharePermission:null,setRenderStatusSuccess:r.noop,user:null},z);function z(){var n=null!==L&&L.apply(this,arguments)||this;return n.state={hasError:!1},n.handlePrevious=N.wrapToolbarActionWithLogging(function(){var e,t;return null===(t=(e=n.props).onPrevious)||void 0===t?void 0:t.call(e)},i.UserAction.FlipPrevious),n.handleNext=N.wrapToolbarActionWithLogging(function(){var e,t;return null===(t=(e=n.props).onNext)||void 0===t?void 0:t.call(e)},i.UserAction.FlipNext),n.shouldDisableDownload=function(){return!!n.props.sharePermission&&!n.props.sharePermission.canViewContextMenuRoles.length},n.onContextMenu=function(e){n.shouldDisableDownload()&&e.preventDefault()},n.onCopy=function(e){n.props.sharePermission&&0===n.props.sharePermission.canDownloadRoles.length&&e.preventDefault()},n.renderExcelPreview=function(){var e=n.props.previewApiData.data.preview_url;return e?P.default.createElement(g.PreviewHTML,E.__assign({src:e,isExcel:!0,forceRivieraException:Array.isArray(V)?V[0]:"",forceTestExcelHtml:!!j,usesFrameMessenger:!0},n.getCommonHtmlPreviewProps())):n.renderUnsupportedErrorPreview()},n.renderPdfPreview=function(e){return P.default.createElement(q,E.__assign({},n.props,{onPrevious:n.handlePrevious,onNext:n.handleNext,doc:e,renderUnsupportedErrorPreview:n.renderUnsupportedErrorPreview,triggerError:n.triggerError}))},n.renderUnsupportedErrorPreview=function(){return n.renderErrorPreview(b.ErrorType.SupportError)},n.showLoadingIndicator=function(){return P.default.createElement(f.LoadingIndicator,{className:"loading-indicator"})},n.getErrorMessage=function(e,t,n){if(n&&"sketch"===k.getExtension(n)&&e===b.ErrorType.LoadError&&t===m.RivieraStatus.UnsupportedFormat)return I.intl.formatMessage({id:"I5lVCX",defaultMessage:"This file canâ€™t be previewed. Previews are only available for files created in Sketch v43 and up."})},n.triggerError=function(e,t){n.setState({hasError:!0,errorType:e,rivieraStatusCode:t})},n}function G(){return null!==U&&U.apply(this,arguments)||this}e.FilePreview=H,e.FilePreviewWithLogging=function(t){var e=t.file,n=t.isInbandExperiment,i=t.sourceAction,r=t.sourceContext,o=t.previewApiData,a=t.onPreviewSessionInitialized;return P.default.createElement(O.FilePreviewSessionManager,{file:e,previewType:u.getPreviewType(o.data),sourceAction:i,sourceContext:r,extra:{is_inband_experiment:(!!n).toString()},onPreviewSessionInitialized:a,render:function(e){return P.default.createElement(H,E.__assign({},t,{filePreviewSession:e}))}})}}),define("modules/clean/react/file_viewer/file_preview_logging_manager",["require","exports","tslib","react","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/react/previews/frame_messenger_host","lodash"],function(e,t,n,i,r,o,a,s,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilePreviewPaasLoggerManager=t.FilePreviewSessionManager=void 0,i=n.__importDefault(i),o=n.__importStar(o),u=n.__importStar(u);var p,m=(p=i.default.Component,n.__extends(f,p),f.prototype.componentDidMount=function(){window.addEventListener("beforeunload",this.windowCloseHandler)},f.prototype.componentWillUnmount=function(){this.logPreviewSessionEnded(c.PreviewSessionEndReason.Unmount),this.teardownFilePreviewLogger(),window.removeEventListener("beforeunload",this.windowCloseHandler)},f.prototype.componentWillReceiveProps=function(e){u.isEqual(e.file,this.props.file)||(this.logPreviewSessionEnded(c.PreviewSessionEndReason.NewFile),e=this.getNewFilePreviewSession(e),this.setState({filePreviewSession:e}))},f.prototype.render=function(){return this.props.render(this.state.filePreviewSession)},f);function f(e){var o=p.call(this,e)||this;o.setUpFilePreviewLogger=function(e){o.teardownFilePreviewLogger(),o.filePreviewTimelineLogger=new r.FilePreviewTimelineLogger(e),o.filePreviewTimelineLogger.listenTo(s.filePreviewEventEmitter),o.filePreviewUserActionLogger=new r.FilePreviewUserActionLogger,o.filePreviewUserActionLogger.listenTo(s.filePreviewEventEmitter),o.filePreviewModeLogger=new r.FilePreviewModeLogger,o.filePreviewModeLogger.listenTo(s.filePreviewEventEmitter),o.filePreviewSidebarLogger=new r.FilePreviewSidebarLogger,o.filePreviewSidebarLogger.listenTo(s.filePreviewEventEmitter),o.filePreviewUpsellLogger=new r.FilePreviewUpsellLogger,o.filePreviewUpsellLogger.listenTo(s.filePreviewEventEmitter),o.filePreviewConversionLogger=new r.FilePreviewConversionLogger,o.filePreviewConversionLogger.listenTo(s.filePreviewEventEmitter),o.fileConversionLogger=new r.FileConversionLogger,o.fileConversionLogger.listenTo(s.filePreviewEventEmitter)},o.teardownFilePreviewLogger=function(){null!=o.filePreviewTimelineLogger&&o.filePreviewTimelineLogger.unlistenTo(s.filePreviewEventEmitter),null!=o.filePreviewUserActionLogger&&o.filePreviewUserActionLogger.unlistenTo(s.filePreviewEventEmitter),null!=o.filePreviewModeLogger&&o.filePreviewModeLogger.unlistenTo(s.filePreviewEventEmitter),null!=o.filePreviewSidebarLogger&&o.filePreviewSidebarLogger.unlistenTo(s.filePreviewEventEmitter),null!=o.filePreviewUpsellLogger&&o.filePreviewUpsellLogger.unlistenTo(s.filePreviewEventEmitter),null!=o.filePreviewConversionLogger&&o.filePreviewConversionLogger.unlistenTo(s.filePreviewEventEmitter),null!=o.fileConversionLogger&&o.fileConversionLogger.unlistenTo(s.filePreviewEventEmitter)},o.logPreviewSessionEnded=function(e){void 0===e&&(e=c.PreviewSessionEndReason.Unknown),o.state.filePreviewSession.recordEvent(a.EventType.FilePreviewSessionEnded,{min_page_width_ratio:"",max_page_width_ratio:"",session_end_reason:e})},o.getNewFilePreviewSession=function(e){var t=e.file,n=e.previewType,i=e.sourceAction,r=e.sourceContext,e=e.extra,e=new l.FilePreviewSession({file:t,previewType:n,fileViewerSession:l.FileViewerSession.currentSession,sourceAction:i,sourceContext:r,extra:e});return o.props.onPreviewSessionInitialized&&o.props.onPreviewSessionInitialized(e.id),l.FilePreviewSession.currentSession=e,o.setUpFilePreviewLogger(e.id),e.recordEvent(a.EventType.FilePreviewAttemptStarted,{window_width:""+window.innerWidth,window_height:""+window.innerHeight}),e},o.windowCloseHandler=function(){o.logPreviewSessionEnded(c.PreviewSessionEndReason.BeforeUnload)};e=o.getNewFilePreviewSession(o.props);return o.state={filePreviewSession:e},o}t.FilePreviewSessionManager=m;var g,n=(g=i.default.Component,n.__extends(_,g),_.prototype.componentDidMount=function(){this.startLogger()},_.prototype.componentWillUnmount=function(){this.stopLogger()},_.prototype.render=function(){return null},_);function _(){var i=null!==g&&g.apply(this,arguments)||this;return i.onFrameMessage=function(e){var t=i.props.file,n=e.action,e=e.parameters;"pagerendered"===n&&o.logPageRendered(t,e)},i.startLogger=function(){i.frameMessenger=new d.PreviewFrameMessengerHost,i.frameMessenger.configureChildMessaging(".react-file-viewer__preview iframe",i.onFrameMessage,["pagerendered"]),i.frameMessenger.startListening()},i.stopLogger=function(){i.frameMessenger.stopListening()},i}t.FilePreviewPaasLoggerManager=n}),define("modules/clean/react/file_viewer/file_viewer",["require","exports","tslib","classnames","keymaster","react","lodash","react-redux","modules/clean/react/comments2/components/mobile_web_comments","modules/clean/analytics","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/utils","modules/clean/loggers/file_viewer_logger","modules/clean/loggers/workflows_logger","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","file-viewer/core/index","modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_viewer/surface_existing_teams_header","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/ml_experiment","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/location_utils","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer_sidebar/sidebar","modules/clean/react/watermarking/utils","modules/clean/pro_analytics/data/util","modules/clean/previews/data/preview_type_util","modules/clean/react/keyboard_binding/keyboard_binding_provider","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","ts-keycode-enum","modules/clean/react/location/with_location","modules/clean/react/components/modal","modules/clean/react/open_in_app/banner","modules/clean/react/previews/constants","modules/clean/react/previews/fidelity_survey/fidelity_survey","modules/clean/react/size_class/constants","modules/clean/react/size_class/size_class","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/python","modules/core/browser","modules/core/browser_detection","modules/core/dom","modules/core/i18n","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/data/selectors","modules/clean/integrations/data/selectors","modules/clean/react/components/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/file_store/utils","spectrum-sharing/utils/sharing_constants","modules/clean/react/file_viewer_sidebar/data_managers/async_activity_data_manager","modules/clean/react/file_viewer_sidebar/data_managers/async_commenting_data_manager","modules/clean/react/file_viewer_sidebar/data_managers/async_pro_analytics_data_manager","modules/clean/react/workflows/i18n/with_translations","pro-ui/components/trial/banner/index","modules/clean/abuse/async_report_flag","modules/clean/react/file_viewer_titlebar/titlebar","file-viewer/core/data/modes/types","modules/clean/react/file_viewer/prompt/loadable_prompt","modules/clean/react/file_viewer/mode_manager","modules/clean/react/file_viewer_sidebar/buttons/more_dropdown","modules/clean/react/file_viewer_titlebar/edit_mode_titlebar","modules/clean/bug_reporting/routing","modules/clean/react/teams/team_discovery/data/logger","modules/clean/react/extensions/data/action_creators","dig-components/layer","modules/core/browser_detection","modules/constants/file_viewer","modules/clean/react/branding/branding_modal_controller","modules/clean/user_survey/user_survey"],function(o,e,a,_,l,h,t,n,s,i,r,c,d,u,p,m,f,g,v,b,w,y,S,E,P,C,M,k,T,A,I,F,O,x,D,R,N,L,U,W,B,V,K,j,q,H,z,G,Y,J,X,Z,Q,$,ee,te,ne,ie,re,oe,ae,se,le,ce,de,ue,pe,me,fe,ge,_e,he,ve,be,we,ye,Se,Ee,Pe,Ce){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FileViewer=e._FileViewer=void 0,_=a.__importDefault(_),l=a.__importDefault(l),h=a.__importDefault(h),t=a.__importStar(t),d=a.__importStar(d),m=a.__importStar(m),z=a.__importStar(z),G=a.__importStar(G),Y=a.__importStar(Y),X=a.__importStar(X),Se=a.__importStar(Se);var Me,ke="",Te="",Ae=(Me=h.default.Component,a.__extends(Ie,Me),Ie.prototype.componentWillMount=function(){this.setUpLogging()},Ie.prototype.componentDidMount=function(){var e=this.props,t=e.fetchShowOverQuotaUpsell,n=e.file,i=e.hasJoinableTeam,r=e.onComponentDidMount,o=e.openInHelloSign,a=e.user,s=e.docClassificationVariant,e=e.fetchDocClassificationAction;null!=r&&r(),this.setDocumentTitle(re.getFilename(n),!0),X.scroll_lock_document(),this.logView(),Ce.UserSurvey.trackEvent("preview_viewed","previews"),i&&(r=this.props.suggestTeamInfo,i="1"===Y.get_uri().getQuery().new_user,a&&(new be.Logger).logExposedToSETOnPreviewEvent(a.id,a.is_cdm_member,a.user_root_permissions,!!r,r?r.joinableTeam.id:void 0,r?r.joinableTeam.membersCount:void 0,i)),t(a),a&&this.previewType&&!this.props.hidePageChrome&&this.props.fetchBestCampaignsAction(a,this.previewType),a&&n&&s&&S.ML_ENDPOINT_FETCH_TYPES.includes(s)&&e(a.id,n.file_id),this.fetchControllerMode(),this.fetchActiveUserBrandingInfo(),o&&this.handleHelloSignDeepIntegrationLaunch()},Ie.prototype.componentWillUpdate=function(e){var t,n,i,r=e.file;r&&r!==this.props.file&&(this.setDocumentTitle(re.getFilename(r)),this.previewSourceAction=V.PreviewSourceAction.Click,this.previewSourceContext=V.PreviewSourceContext.FileViewer,t=e.user,n=e.docClassificationVariant,i=e.fetchDocClassificationAction,t&&n&&S.ML_ENDPOINT_FETCH_TYPES.includes(n)&&i(t.id,r.file_id)),l.default.setScope("fileviewer"),e.mode!==this.props.mode&&this.setState({modeClassnames:"state-"+this.props.mode+"-out state-"+e.mode+"-in"})},Ie.prototype.componentDidUpdate=function(e){re.areFilesEqual(e.file,this.props.file)||this.logView(),e.previewApiData&&x.isImage(e.previewApiData.data)&&this.props.previewApiData&&!x.isImage(this.props.previewApiData.data)&&P.exitFullScreen(),this.props.onFullscreenChange&&e.isFullscreen!==this.props.isFullscreen&&this.props.onFullscreenChange(this.props.isFullscreen)},Ie.prototype.componentWillUnmount=function(){this.unsetDocumentTitle(),X.scroll_unlock_document(),null!=this.props.onComponentWillUnmount&&this.props.onComponentWillUnmount(),W.Modal.close(),this.resetControllerMode()},Object.defineProperty(Ie.prototype,"fileSubpath",{get:function(){return this.props.location&&T.getFileSubpath(this.props.location)},enumerable:!1,configurable:!0}),Object.defineProperty(Ie.prototype,"previewType",{get:function(){return this.props.previewApiData&&m.getPreviewType(this.props.previewApiData.data)},enumerable:!1,configurable:!0}),Object.defineProperty(Ie.prototype,"isViewingFileSubpath",{get:function(){return m.isArchive(this.props.previewApiData.data)&&!!this.fileSubpath},enumerable:!1,configurable:!0}),Ie.prototype.shouldSuppressPassInfo=function(){return null==this.props.file.ns_id},Ie.prototype.setUpLogging=function(){var e,t,n;A.FileViewerSession.currentSession=new A.FileViewerSession,this.props.fileViewTarget===G.FileViewTargetType.SHARED_CONTENT_LINK&&(e=z.start_time(),t=(new Date).getTime(),n=oe.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,this.props.user&&i.ShareTibEventLogger.log(this.props.user.id,"PREVIEW_RENDER",n,{timing:t-e,containing_ns_id:this.props.file.ns_id,sjid:this.props.file.sjid}))},Ie.prototype.isDownloadDisabled=function(){return!(!this.props.sharePermission||!this.props.sharePermission.canDownloadRoles)&&0===this.props.sharePermission.canDownloadRoles.length},Ie.prototype.shouldShowAppDownloadInterstitial=function(){return!this.props.appDownloadInterstitialDismissed&&this.props.file.open_in_app_data},Ie.prototype.shouldIgnoreEscape=function(e){var t=document.querySelector(".vjs-fullscreen");return X.focus_in_input()||X.is_input(e.target)||document.querySelector(".annotation-bubble")||this.props.isFullscreen||this.fileSubpath||t||this.props.isEditMode},Ie.prototype.setDocumentTitle=function(e,t){void 0===t&&(t=!1),this.props.doNotUpdateDocumentTitle||(t&&(Te=document.title),document.title=e)},Ie.prototype.unsetDocumentTitle=function(){this.props.doNotUpdateDocumentTitle||""!==Te&&(document.title=Te)},Ie.prototype.logView=function(){var e,t,n=this;null===this.props.file.ns_id||ie.getSourceContext()===V.PreviewSourceContext.SharedLinkCollection||this.props.hidePageChrome||(e=function(){d.logView(n.props.file,n.props.user,n.props.fileViewTarget,n.props.fileViewOrigin,n.props.fileViewAction,null!=n.props.sharedLinkInfo?n.props.sharedLinkInfo.url:void 0,n.isDownloadDisabled(),H.Viewer.get_viewer().is_assume_user_session)},t=c.getFileExt(this.props.file),r.isCloudDocByExtension(t)?setTimeout(e,r.CLOUD_DOCS_PASS_LOG_DELAY_MS):e())},Ie.prototype.isImagePreviewAnnotationEnabled=function(){return!(this.props.sizeClass===j.SizeClass.Small||this.props.hidePageChrome)},Ie.prototype.renderFlippableControls=function(){if(!(this.props.forceDisplayToolbar||this.props.isFullscreen||this.isImagePreviewAnnotationEnabled()||null==this.props.fileIndex||[p.PreviewType.Video,p.PreviewType.Audio].includes(this.previewType)||this.props.isEditMode))return h.default.createElement(k.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.props.onFlipNext,onPrevious:this.props.onFlipPrevious})},Ie.prototype.getOpenInAppUrls=function(){var e=this.props,t=e.file,n=e.shareToken,i=e.sharePermission,e=e.user;if(t&&n&&i)return t.open_in_app_data;if(Se.iOS&&e){t=encodeURIComponent(t.fq_path),e=encodeURIComponent(e.id);return{platform:Ee.OpenInMobileAppPlatform.IPHONE,iOSAppUrl:"dbapi-5://1/viewPath?path="+t+"&userId="+e,iOSAppStoreUrl:"https://itunes.apple.com/us/app/dropbox/id327630330?mt=8e"}}return Se.is_android()?{platform:Ee.OpenInMobileAppPlatform.ANDROID_MARKET,androidAppUrl:"/dl/home/mobile?mobile_app_fallback"}:void 0},Ie.prototype.renderFilePreview=function(){var e=this.props,t=e.isEditMode,n=e.isInbandExperiment,i=e.file,r=e.shareToken,e=e.sharePermission;return h.default.createElement("div",{className:_.default("react-file-viewer__preview","react-file-preview",{"react-file-viewer__preview--edit-mode":t})},h.default.createElement("div",{className:"flex-preview-container"},this.maybeRenderFidelitySurvey(),this.renderReportFlag(),this.shouldShowOpenInAppBanner()&&h.default.createElement(B.OpenInAppBanner,{urls:this.getOpenInAppUrls(),onClick:this.openInAppBannerOnClick,isMountedFile:!(i&&r&&e)}),h.default.createElement(M.FilePreviewWithLogging,{areActionablesEnabled:!this.props.hidePageChrome&&null!=this.props.file.ns_id,count:this.props.fileCount,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,previewApiData:this.props.previewApiData,fileSubpath:this.fileSubpath,index:this.props.fileIndex,isFullscreen:this.props.isFullscreen,isMobileUserAgent:this.props.isMobileUserAgent,isInbandExperiment:n,isSidebarOpen:this.props.isSidebarOpen,maxFilenameEmLength:ne.SizeClassFilenameLengthMap[this.props.sizeClass],onNext:this.props.onFlipNext,onPrevious:this.props.onFlipPrevious,sharedLinkInfo:this.props.sharedLinkInfo,location:this.props.location,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,shouldFocusOnReady:!1,sidebar:this.props.sidebar,sourceAction:this.previewSourceAction,sourceContext:this.previewSourceContext,sharedLinkUrl:null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,setRenderStatusSuccess:this.props.setRenderStatusSuccessForCurrentFile,shouldDisplayToolbar:this.isImagePreviewAnnotationEnabled()||this.props.forceDisplayToolbar,sizeClass:this.props.sizeClass,user:this.props.user,mode:this.props.mode,showCloudDocPreview:this.props.showCloudDocPreview,LoggedOutUXGoogleVariant:this.props.LoggedOutUXGoogleVariant,encryptionOptions:this.props.encryptionOptions,onPreviewSessionInitialized:this.props.onPreviewSessionInitialized}),this.renderFlippableControls()))},Ie.prototype.shouldRenderSidebar=function(){return this.props.sizeClass!==j.SizeClass.Small&&!this.props.isFullscreen&&!this.props.hidePageChrome&&null!=this.props.file.ns_id},Ie.prototype.renderSidebar=function(){if(!this.shouldRenderSidebar())return null;var e=this.props,t=e.sizeClass,n=e.file,i=e.user,r=e.brandingInfo,o=e.activeUserBrandingInfo,a=e.sharedLinkInfo,s=e.hellosignAppAction,l=e.isVersionHistoryMode,c=e.shareToken,d=e.sharePermission,u=e.canRestoreRevision,p=e.onRestoreRevision,m=e.sidebar,f=e.encryptionOptions,g=e.expGrowthActSmbWorkflowsBaton,e=e.isCapture;return h.default.createElement("div",{className:_.default("react-file-viewer__sidebar",{"react-file-viewer__sidebar--closed":m.visibility===me.SidebarVisibility.Closed}),"data-preview-type":this.previewType,"data-theme":"web"},h.default.createElement(I.Sidebar,{sizeClass:t,file:n,user:i,brandingInfo:null!=r?r:o,sharedLinkInfo:a,hellosignAppAction:s,isVersionHistoryMode:l,isViewingFileSubpath:!!this.isViewingFileSubpath,sharePermission:d,shareToken:c,previewType:this.previewType,isSeenStatesEnabled:!this.shouldSuppressPassInfo(),isCapture:e,onHelloSignAppActionLaunch:this.handleHelloSignAppActionLaunch,onHelloSignDeepIntegrationLaunch:this.handleHelloSignDeepIntegrationLaunch,canRestoreRevision:u,onRestoreRevision:p,renderSidebarOverflowMenuFn:this.renderOverflowMenuFnFactory(ne.OverflowMenuDirection.BELOW),encryptionOptions:f,expGrowthActSmbWorkflowsBaton:g}))},Ie.prototype.shouldRenderMobileWebComments=function(){return this.props.sizeClass===j.SizeClass.Small},Ie.prototype.renderMobileComments=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,i=e.sizeClass,r=e.user,e=e.isFullscreen;return!this.shouldRenderMobileWebComments()||e||this.isViewingFileSubpath||this.props.hidePageChrome||null==t.ns_id?null:h.default.createElement(s.MobileWebComments,{currentFile:t,previewType:this.previewType,sharedLinkInfo:n,user:r,sizeClass:i,encryptionOptions:this.props.encryptionOptions})},Ie.prototype.renderBanner=function(){return h.default.createElement("div",{className:"react-file-viewer__banner"},this.renderUpsellBanner(),this.renderTrialBanner())},Ie.prototype.renderBrandingModalController=function(){var e=this.props,t=e.brandingInfo,n=e.isFullscreen,i=e.hidePageChrome,r=e.file,e=e.sharedLinkInfo;return n||i||!r||null===r.ns_id?null:h.default.createElement(Pe.BrandingModalController,{brandingInfo:t,closeButtonText:Z.intl.formatMessage({id:"D/tUrq",defaultMessage:"View file"}),sharedLinkInfo:e})},Ie.prototype.renderTitleBar=function(){return this.props.isFullscreen||this.props.hidePageChrome&&!m.isArchive(this.props.previewApiData.data)?null:this.props.mode===f.FileViewerMode.Watermarking?h.default.createElement(he.EditModeTitlebar,{user:this.props.user,file:this.props.file,maxFilenameEmLength:ne.SizeClassFilenameLengthMap[this.props.sizeClass],title:Z.intl.formatMessage({id:"TJfgIg",defaultMessage:"Watermarking"}),mode:f.FileViewerMode.Watermarking,sizeClass:this.props.sizeClass}):this.props.mode===f.FileViewerMode.Markup?h.default.createElement(he.EditModeTitlebar,{user:this.props.user,file:this.props.file,maxFilenameEmLength:ne.SizeClassFilenameLengthMap[this.props.sizeClass],title:Z.intl.formatMessage({id:"PSIegi",defaultMessage:"Markup"}),beta:!0,mode:f.FileViewerMode.Markup,sizeClass:this.props.sizeClass}):h.default.createElement(pe.FileTitleBar,{file:this.props.file,maxFilenameEmLength:ne.SizeClassFilenameLengthMap[this.props.sizeClass],isViewingFileSubpath:this.isViewingFileSubpath,user:this.props.user||null,isSidebarOpen:this.props.sidebar.visibility===me.SidebarVisibility.Open,closeUrl:this.props.titleBarCloseUrl,onClose:this.props.onCloseViewer,canClose:this.props.canClose,hidePageChrome:this.props.hidePageChrome,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,isVersionHistoryMode:this.props.isVersionHistoryMode,sharedLinkInfo:this.props.sharedLinkInfo,fileSubpath:this.fileSubpath,previewType:this.previewType,renderTitlebarOverflowMenuFn:this.renderOverflowMenuFnFactory(ne.OverflowMenuDirection.BELOW)})},Ie.prototype.shouldAllowFileDonation=function(){return null==this.props.sharedLinkInfo&&(null==this.props.user||this.props.user.home_ns_id===this.props.file.ns_id)},Ie.prototype.maybeRenderFidelitySurvey=function(){var e=this.props,t=e.file,n=e.hidePageChrome,i=e.isEditMode,r=e.renderStatus,e=e.sizeClass;return ie.canShowFidelitySurvey({file:t,sizeClass:e,hidePageChrome:n,renderStatus:r,isEditMode:i})?h.default.createElement(K.FidelitySurvey,{allowFileDonation:this.shouldAllowFileDonation(),file:t}):null},Ie.prototype.renderReportFlag=function(){return this.props.sharedLinkInfo&&!1!==this.props.sharedLinkInfo.hasPublicAudienceOrVisibility&&!this.props.hidePageChrome?h.default.createElement(ue.AsyncReportFlag,{sharedLink:this.props.sharedLinkInfo.url,previewType:this.previewType}):null},Ie.prototype.renderUpsellBanner=function(){return this.props.showOverQuotaUpsell?h.default.createElement(C.ExpFileViewerUpsellBannerV2,null):null},Ie.prototype.renderTrialBanner=function(){var e=this.props,t=e.mode;return e.isTrialMode?h.default.createElement(de.Banner,{mode:t,onClick:this.onTrialBannerClicked}):null},Ie.prototype.shouldRenderSETHeader=function(){return!(this.state.dismissedSETHeader||!this.props.suggestTeamInfo||!this.props.user||this.props.hidePageChrome||this.props.sizeClass===j.SizeClass.Small)},Ie.prototype.renderSETHeader=function(){var e=this;if(this.shouldRenderSETHeader()){var t=this.props,n=t.suggestTeamInfo,t=t.user;if(n&&t)return h.default.createElement(v.SurfaceExistingTeamsHeader,{suggestTeamInfo:n,user:t,dismissHeader:function(){return e.setState({dismissedSETHeader:!0})}})}return null},Ie.prototype.renderExperimentHeader=function(){return this.renderSETHeader()},Ie.prototype.render=function(){var e=this.props,t=e.className,n=e.file,i=e.hidePageChrome,r=e.isFullscreen,o=e.sharedLinkInfo,a=e.transparentBackground,s=e.user,l=e.isEditMode,c=void 0!==l&&l,d=e.isWatermarkingMode,u=void 0!==d&&d,l=e.campaign,d=re.getFilename(n),e=this.previewType;return this.shouldShowAppDownloadInterstitial()?h.default.createElement(ve.RegisterComponentWithBugReporter,{componentId:"web.previews",componentName:"File Preview"},h.default.createElement("div",{"aria-label":d},h.default.createElement(w.FilePreviewAppDownloadInterstitial,{sharedLinkInfo:o,file:n,previewType:e,fileViewerSession:A.FileViewerSession.currentSession,previewSourceAction:this.previewSourceAction,previewSourceContext:this.previewSourceContext,onClose:this.onInterstitialClose,onContinue:this.onInterstitialContinue}))):h.default.createElement(ye.LayerContext.Provider,{value:500},h.default.createElement(ve.RegisterComponentWithBugReporter,{componentId:"web.previews",componentName:"File Preview"},h.default.createElement(D.KeyboardBindingProvider,{onDestroy:this.cleanupKeymaster,onSetup:this.setupKeymaster},h.default.createElement(Fe,{ns_id:n.ns_id},h.default.createElement("div",{"aria-label":d,className:_.default("react-file-viewer","preview-type-"+(this.previewType?this.previewType.toLowerCase():"unknown"),t,this.state.modeClassnames,{"no-background":a&&!r,"react-file-viewer--edit-mode":c}),style:{top:this.props.hidePageChrome&&!this.props.isFullscreen?this.props.headerHeight:"0"},role:"dialog"},this.renderExperimentHeader(),h.default.createElement(R.KeyboardBindingConnector,{keyboardBindings:this.getKeyboardBindings({isFullscreen:r,isWatermarkingMode:u})}),this.renderBanner(),h.default.createElement("div",{className:"react-file-viewer__main"},l&&s&&!i?h.default.createElement(fe.FileViewerPrompt,{user:s,campaign:l}):null,h.default.createElement("div",{className:_.default("react-file-viewer__content","comments2",{"comments2-mobile-web":this.shouldRenderMobileWebComments(),"comments2-annotation-enabled":!0,"video-audio":this.previewType===p.PreviewType.Video||this.previewType===p.PreviewType.Audio,"react-file-viewer__content--edit-mode":c}),"data-preview-type":e,"data-theme":"web"},this.renderTitleBar(),this.renderFilePreview(),this.renderMobileComments(),this.renderManagers(),this.renderBrandingModalController()),this.renderSidebar()))))))},Ie.defaultProps={canClose:!1,canRestoreRevision:!1,className:"",hideComments:!1,hidePageChrome:!1,isVersionHistoryMode:!1,forceFileUnlocked:!1,oref:G.OREF_CONSTANTS.BROWSE_UNKNOWN,sizeClass:j.SizeClass.Large,fileCount:0,showCloudDocPreview:!1},Ie);function Ie(){var s=null!==Me&&Me.apply(this,arguments)||this;return s.state={modeClassnames:"",dismissedSETHeader:!1},s.previewSourceAction=s.props.initialPreviewSourceAction,s.previewSourceContext=s.props.initialPreviewSourceContext,s.fetchActiveUserBrandingInfo=function(){var e=s.props,t=e.user,n=e.sharedLinkInfo;e.brandingInfo||n||!t||s.props.fetchActiveUserBrandingInfoAction(t)},s.fetchControllerMode=function(){var e=s.props,t=e.file,n=e.sharedLinkInfo,i=e.user,e=e.sizeClass;s.props.fetchControllerModeAction({path:t.fq_path,shared_link_url:n&&n.url},i,e)},s.handleHelloSignDeepIntegrationLaunch=function(){if(s.hellosignDeepIntegrationLauncher)return s.hellosignDeepIntegrationLauncher.then(function(e){return e.launch(),e});var e=s.props,t=e.file,n=e.openInHelloSignSrc,i=e.user;return t&&re.isBrowseFile(t)&&i?s.hellosignDeepIntegrationLauncher=new Promise(function(e,t){o(["modules/clean/integrations/hellosign_deep_integration/launcher"],e,t)}).then(a.__importStar).then(function(e){e=(0,e.getLauncher)();return e.init({entryPoint:"file_preview_side_bar",file:t,user:i,source:n}),e}).then(function(e){return e.launch(),e}):Promise.resolve()},s.handleHelloSignAppActionLaunch=function(){var e=s.props,n=e.file,i=e.updateLinkState,r=e.user;n&&re.isBrowseFile(n)&&r&&new Promise(function(e,t){o(["modules/clean/react/app_actions/redirect"],e,t)}).then(a.__importStar).then(function(e){var e=e.redirectToActionOrShowAuth,t=s.props.hellosignAppAction;t&&(e(r,n,t,{},void 0,function(e,t){i({actionId:e,linkState:t})}),new Promise(function(e,t){o(["modules/clean/integrations/hellosign_deep_integration/logging"],e,t)}).then(a.__importStar).then(function(e){(0,e.logAppActionLaunch)(n,t)}))})},s.resetControllerMode=function(){s.props.changeMode(f.FileViewerMode.Default)},s.setupKeymaster=function(){ke=l.default.getScope(),l.default.setScope("fileviewer")},s.cleanupKeymaster=function(){l.default.clearScope("fileviewer"),l.default.setScope(ke)},s.shouldShowOpenInAppBanner=function(){var e=s.props,t=e.hidePageChrome,e=e.isMobileUserAgent;return!t&&(e||J.is_mobile_or_tablet())&&(Se.iOS||Se.is_android())&&void 0!==s.getOpenInAppUrls()},s.openInAppBannerOnClick=function(){b.logUserAction(ne.UserAction.OpenInApp,ne.UserActionContext.OpenInAppBanner)},s.renderOverflowMenuFnFactory=function(a){return function(){var e=s.props,t=e.file,n=e.sharedLinkInfo,i=e.isVersionHistoryMode,r=e.shareToken,o=e.sharePermission,e=e.encryptionOptions;if(n){if(t&&r&&o)return h.default.createElement(_e.AsyncSharedFileMoreDropdown,{user:s.props.user,file:t,sizeClass:s.props.sizeClass,sharedLinkInfo:n,shouldDisplayActionButtons:!s.isViewingFileSubpath,shareToken:r,sharePermission:o,direction:a,encryptionOptions:e})}else{if(i)return null;if(s.props.user&&t)return h.default.createElement(_e.AsyncMountedFileMoreDropdown,{user:s.props.user,file:t,sizeClass:s.props.sizeClass,direction:a})}return null}},s.renderManagers=function(){var e=s.props,t=e.file,n=e.isVersionHistoryMode,i=void 0!==n&&n,r=e.sharedLinkInfo,n=e.user,e=null!=(null==t?void 0:t.ns_id),t=t;return h.default.createElement(h.default.Fragment,null,h.default.createElement(ge.ModeManager,{isViewingFileSubpath:s.isViewingFileSubpath}),h.default.createElement(se.AsyncCommentingDataManager,{currentFile:t,isVersionHistoryMode:i,sharedLinkInfo:r,user:n}),e&&h.default.createElement(ae.AsyncActivityDataManager,{file:t,isVersionHistoryMode:i,user:s.props.user}),e&&!r&&O.isProAnalyticsEnabled(n)&&h.default.createElement(le.AsyncProAnalyticsDataManager,{fileId:t.file_id,user:n}))},s.onTrialBannerClicked=function(){u.logWorkflowsEvent(u.WorkflowsEvent.WatermarkUpsellHeaderButtonClicked,F.getWatermarkMilestone(s.props.user)),Y.redirect("/buy?_tk=watermarking_header_upsell")},s.onInterstitialClose=function(){s.props.onAppDownloadInterstitialDismissed()},s.onInterstitialContinue=function(){s.props.onAppDownloadInterstitialDismissed()},s.getKeyboardBindings=t.memoize(function(e){var t=e.isFullscreen,e=e.isWatermarkingMode;return t?[N.hydrateKeyboardBinding({keyboardEventCriteria:{which:L.Key.Escape},callback:function(){return P.exitFullScreen(ne.UserActionContext.Keyboard)}})]:e?[N.hydrateKeyboardBinding({keyboardEventCriteria:{which:L.Key.Escape},callback:function(){return s.props.changeMode(f.FileViewerMode.Documentation)}})]:[N.hydrateKeyboardBinding({keyboardEventCriteria:{which:L.Key.F},callback:function(){return P.enterFullScreen({logContext:ne.UserActionContext.Keyboard})}}),N.hydrateKeyboardBinding({keyboardEventCriteria:{which:L.Key.Escape},callback:function(e){N.isKeyboardEvent(e)&&s.shouldIgnoreEscape(e)||null==s.props.onCloseViewer||s.props.onCloseViewer()}})]}),s}e._FileViewer=Ae;var Fe=function(e){var t=e.children;return null==e.ns_id?h.default.createElement(h.default.Fragment,null,t):h.default.createElement(g.FileSidebarProvider,null,t)},U=U.withLocation(function(e){return null!=e.file?h.default.createElement(Ae,a.__assign({},e)):h.default.createElement("div",null)}),U=q.withSizeClass(U,{isResponsiveEnabled:ie.isResponsiveEnabled,responsiveClassName:ne.ResponsiveClassName}),U=ce.withTranslations(U),we={onAppDownloadInterstitialDismissed:y.dismissAppDownloadInterstitial,fetchShowOverQuotaUpsell:y.fetchShowOverQuotaUpsell,setRenderStatusSuccessForCurrentFile:y.setRenderStatusSuccessForCurrentFile,fetchControllerModeAction:y.fetchControllerModeAction,fetchActiveUserBrandingInfoAction:y.fetchActiveUserBrandingInfoAction,fetchBestCampaignsAction:y.fetchBestCampaignsAction,fetchDocClassificationAction:y.fetchDocClassificationAction,changeMode:y.changeMode,updateLinkState:we.updateLinkState},Oe=n.connect(function(t,e){var n=Q.getAppDownloadInterstitial(t);void 0===n&&e&&(n=e.appDownloadInterstitialDismissed);var i=Q.getActiveFile(t);return{appDownloadInterstitialDismissed:n,file:i,hellosignAppAction:function(){if(i)return Q.getHelloSignAppActionForFile(t,i)}(),mode:Q.getMode(t),isFullscreen:Q.getIsFullScreen(t),isSidebarOpen:Q.getIsSidebarOpen(t),renderStatus:Q.getRenderStatusForCurrentFile(t),showOverQuotaUpsell:Q.getShowOverQuotaUpsell(t),sidebar:Q.getSidebar(t),isEditMode:Q.getIsEditMode(t),isWatermarkingMode:Q.getIsWatermarkingMode(t),isTrialMode:Q.getIsTrialMode(t),campaign:Q.getSelectedPromptCampaign(t),activeUserBrandingInfo:Q.getActiveUserBrandingInfo(t),previewApiData:$.getApiDataForFile(t,i),extensionsEnabled:Q.getExtensionsEnabled(t),docClassificationVariant:function(){if(!i)return null;var e=re.getExtension(i);return e&&!1!==S.ML_EXPERIMENT_EXTENSIONS.includes(e)&&(ee.isHelloSignAppActionInFileViewerSidebarEnabled(t)||ee.isHelloSignDeepIntegrationInFileViewerSidebarEnabled(t))&&ee.isHelloSignMLClassificationEnabled(t)?ee.getHelloSignMLClassificationVariant(t):null}()}},we)(U),xe=E.getStoreForFileViewer(),te=te.requireCssWithComponent(function(e){return h.default.createElement(n.Provider,{store:xe},h.default.createElement(Oe,a.__assign({},e)))},["/static/css/preview_flexbox_layout-vflNFyVwu.css","/static/css/react_file_viewer-vfldZQLtI.css","/static/css/react_title_bar-vflSGo9Xd.css","/static/css/spectrum/index.web-vflmHVRF-.css","/static/js/file-viewer/index.web-vflOuVWvC.css","/static/js/pro-ui/index.web-vfliiqu7T.css"]);e.FileViewer=te}),define("modules/clean/react/file_viewer/flippable_controls",["require","exports","tslib","react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlippableControls=void 0;var a,n=(a=(i=n.__importDefault(i)).default.Component,n.__extends(s,a),s.prototype.getNavText=function(){return o.intl.formatMessage({id:"CQTi9x",defaultMessage:"{cur_file_num} of {num_total_files}"},{cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})},s.prototype.render=function(){if(this.props.numFlippableFiles<=1)return null;var e=o.intl.formatMessage({id:"J7UPY9",defaultMessage:"Flip left"}),t=o.intl.formatMessage({id:"vVU6YH",defaultMessage:"Flip right"});return i.default.createElement("div",{className:"react-file-viewer__controls"},i.default.createElement("button",{className:"nav-control",onClick:this.handlePreviousClick},i.default.createElement(r.Sprite,{group:"web",name:"s_flip_left",alt:e})),i.default.createElement("div",{className:"nav-text"},this.getNavText()),i.default.createElement("button",{className:"nav-control",onClick:this.handleNextClick},i.default.createElement(r.Sprite,{group:"web",name:"s_flip_right",alt:t})))},s);function s(){var e=null!==a&&a.apply(this,arguments)||this;return e.handlePreviousClick=function(){e.props.onPrevious&&e.props.onPrevious()},e.handleNextClick=function(){e.props.onNext&&e.props.onNext()},e}t.FlippableControls=n}),define("modules/clean/react/file_viewer/full_screen_helpers",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toggleFullScreen=t.isBrowserFullScreen=t.browserSupportFullScreen=t.exitFullScreen=t.enterFullScreen=void 0;function a(){return s.dispatch(i.closeFullScreen())}var s=n.getStoreForFileViewer(),l=a;function c(){m()||p(o.UserActionContext.Browser)}function d(){p(o.UserActionContext.Browser)}function u(e){var t=e.dispatchFunction,n=e.logContext,e=e.shouldDispatchReduxAction;l=void 0===t?a:t,void 0!==e&&!e||s.dispatch(i.openFullScreen()),null!=(e=document.body).requestFullscreen?e.requestFullscreen():null!=e.msRequestFullscreen?e.msRequestFullscreen():null!=e.mozRequestFullScreen?e.mozRequestFullScreen():null!=e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),e=c,document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e),window.addEventListener("popstate",d),n&&r.logUserAction(o.UserAction.ToggleFullscreenOn,n)}function p(e){var t;t=c,document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t),document.removeEventListener("mozfullscreenchange",t),window.removeEventListener("popstate",d),l(),(t=document).exitFullscreen?t.exitFullscreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen(),e&&r.logUserAction(o.UserAction.ToggleFullscreenOff,e)}function m(){var e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement}t.enterFullScreen=u,t.exitFullScreen=p,t.browserSupportFullScreen=function(){var e=document.body;return e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen},t.isBrowserFullScreen=m,t.toggleFullScreen=function(e,t){return e||m()?p(t):u({logContext:t})}}),define("modules/clean/react/file_viewer/mode_manager",["require","exports","tslib","react","react-redux","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/data/actions","file-viewer/core/index"],function(e,t,n,i,r,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModeManager=t.UnconnectedModeManager=void 0;var l,i=(l=(i=n.__importDefault(i)).default.PureComponent,n.__extends(c,l),c.prototype.componentDidUpdate=function(){this.unavailableModes()[this.props.mode]&&this.props.mode!==s.FileViewerMode.Default&&this.props.changeMode(s.FileViewerMode.Default)},c.prototype.unavailableModes=function(){var e=n.__assign({},this.props.disabledModes);return this.props.isViewingFileSubpath&&(e[s.FileViewerMode.Commenting]=!0),e},c.prototype.render=function(){return null},c);function c(){return null!==l&&l.apply(this,arguments)||this}t.UnconnectedModeManager=i,t.ModeManager=r.connect(function(e){return{mode:o.getMode(e),disabledModes:o.getDisabledModes(e)}},{changeMode:a.changeMode})(i)});var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer/open_button/open_button",["require","exports","modules/clean/react/async/loadable"],function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OpenButton=void 0,e.OpenButton=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer/open_button/open_button_component"],e,t)}).then(__importStar).then(function(e){return e.OpenButton})}})}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer/prompt/loadable_prompt",["require","exports","modules/clean/react/async/loadable"],function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FileViewerPrompt=void 0,e.FileViewerPrompt=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer/prompt/prompt"],e,t)}).then(__importStar).then(function(e){return e.SyncFileViewerPrompt})}})}),define("modules/clean/react/file_viewer/utils",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/core/browser","modules/clean/previews/constants","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/previews/data/preview_type_util","modules/core/uri","modules/clean/react/previews/constants","modules/clean/react/previews/image_helpers","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/constants","modules/clean/previews/api"],function(e,t,n,i,r,o,a,s,l,c,d,u,p,m,f){"use strict";function g(){return new c.URI({path:"/login",query:{cont:r.get_href()}}).toString()}function _(e){return!e}function h(){var e=r.get_uri().path;return/^\/(home|work|personal|search)/.test(e)?d.PreviewSourceContext.Browse:/^\/h$/.test(e)?d.PreviewSourceContext.Home:/^\/(s|scl\/fi)\//.test(e)?d.PreviewSourceContext.SharedLinkFile:/^\/(sh|scl\/fo)\//.test(e)?d.PreviewSourceContext.SharedLinkFolder:/^\/sc\//.test(e)?d.PreviewSourceContext.SharedLinkCollection:/^\/history/.test(e)?d.PreviewSourceContext.VersionHistory:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.isResponsiveEnabled=t.fetchRivieraStatusCode=t.preloadImages=t.getSourceAction=t.getSourceContext=t.canShowFidelitySurvey=t.canUserUsePaper=t.canDownloadFile=t.isFileEditable=t.isMountedFile=t.getFileViewerInterfaceTypeForSharedLink=t.sharedLinkLoginUrl=t.getSharedLinkLoginUrl=t.cleanupPrerenderPreview=t.modalIsUp=t.getSplitButtonUserActionContext=t.TooltipHelpers=void 0,i=n.__importStar(i),r=n.__importStar(r),u=n.__importStar(u),t.TooltipHelpers={fetchTooltipInfo:function(e,t){i.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return t(e)},subject_user:e})},getVendorAndApplication:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i,r=e[n];for(i in r)if(r.hasOwnProperty(i)&&-1<r[i].extensions.indexOf(t))return{vendor:n,application:i}}return null},logImpression:function(e,t,n){"acrobat_or_reader"===n?i.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:n,extension:e},subject_user:t}):i.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:n,extension:e},subject_user:t})}},t.getSplitButtonUserActionContext=function(e,t){if(e===a.SplitButtonActionLocation.Main){if(t===a.FileViewerPane.TitleBar)return a.UserActionContext.TitleBarMain;if(t===a.FileViewerPane.PreviewContent)return a.UserActionContext.PreviewContentMain}else if(e===a.SplitButtonActionLocation.Split){if(t===a.FileViewerPane.TitleBar)return a.UserActionContext.TitleBarSplitButton;if(t===a.FileViewerPane.PreviewContent)return a.UserActionContext.PreviewContentSplitButton}return a.UserActionContext.Unknown},t.modalIsUp=function(){for(var e=!1,t=document.getElementsByClassName("db-modal-wrapper"),n=0;!e&&n<t.length;n++)e="none"!==window.getComputedStyle(t[n]).display;return e},t.cleanupPrerenderPreview=function(){var e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,function(e){e.style.display="none"})},t.getSharedLinkLoginUrl=g,t.sharedLinkLoginUrl=g(),t.getFileViewerInterfaceTypeForSharedLink=function(e){switch(e){case o.PreviewType.Image:return a.FileViewerInterfaceType.Window;case o.PreviewType.SsrDoc:return a.FileViewerInterfaceType.Frame;default:return}},t.isMountedFile=_,t.isFileEditable=function(e){return!!e&&s.isBrowseFile(e)&&!e.read_only},t.canDownloadFile=function(e,t){return!e||t&&0<t.canDownloadRoles.length},t.canUserUsePaper=function(e){return null!=e&&!e.is_paper_disabled},t.canShowFidelitySurvey=function(e){var t=e.file,n=e.renderStatus,i=e.hidePageChrome,r=e.sizeClass,e=e.isEditMode;return!!t&&n===p.PreviewRenderStatus.Succeeded&&!i&&r!==m.SizeClass.Small&&!e},t.getSourceContext=h,t.getSourceAction=function(){switch(h()){case d.PreviewSourceContext.SharedLinkFile:case d.PreviewSourceContext.SharedLinkFolder:return d.PreviewSourceAction.Visit;default:return d.PreviewSourceAction.Click}},t.preloadImages=function(t,n){var i;0!==t.length&&(i=[],[0,1,2,3,4,5,6,-1,-2].forEach(function(e){e=(n+e+t.length)%t.length;-1===i.indexOf(e)&&i.push(e)}),i.forEach(function(e){t.length>e&&l.isImage(t[e])&&(!(e=t[e])||(e=e.content.thumbnail_url_tmpl||e.preview_url)&&u.preloadResponsiveImage(e))}))},t.fetchRivieraStatusCode=function(e,t,n){void 0===n&&(n=function(){});var i=new XMLHttpRequest;return i.open("GET",e),i.withCredentials=!0,i.onreadystatechange=function(){var e;i.readyState===XMLHttpRequest.DONE&&((e=f.getParsedDropboxMetadataHeader(i)).rivieraStatusCode?t(e.rivieraStatusCode):n())},i.send(),i},t.isResponsiveEnabled=function(){return h()!==d.PreviewSourceContext.VersionHistory}}),define("modules/clean/react/file_viewer_sidebar/buttons/icon",["require","exports","tslib","react","spectrum/icon_action/index","spectrum/colorized_icon/index"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonIcon=void 0,i=n.__importDefault(i),t.ButtonIcon=function(e){var t=e.isPrimary,e=n.__rest(e,["isPrimary"]);return i.default.createElement(o.ColorizedIcon,{color:t?"white":"#717781"},i.default.createElement(r.IconAction,n.__assign({},e)))}}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer_sidebar/buttons/more_dropdown",["require","exports","modules/clean/react/async/loadable"],function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncMountedFileMoreDropdown=e.AsyncSharedFileMoreDropdown=void 0,e.AsyncSharedFileMoreDropdown=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer/shared_file_actions"],e,t)}).then(__importStar).then(function(e){return e.SharedFileMoreDropdown})}}),e.AsyncMountedFileMoreDropdown=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer/mounted_file_actions"],e,t)}).then(__importStar).then(function(e){return e.MountedFileMoreDropdown})}})}),define("modules/clean/react/file_viewer_sidebar/buttons/mounted_file_actions",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/file_viewer/open_button/open_button"],function(n,e,t,i,r,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncExtensionsButton=e.AsyncOpenButton=e.AsyncSpacesDropdown=e.AsyncShareButton=void 0,i=t.__importDefault(i),e.AsyncShareButton=r.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer/share_button"],e,t)}).then(t.__importStar).then(function(e){return e.ShareButton})}}),e.AsyncSpacesDropdown=r.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer/spaces_dropdown"],e,t)}).then(t.__importStar).then(function(e){return e.SpacesDropdown})}}),Object.defineProperty(e,"AsyncOpenButton",{enumerable:!0,get:function(){return a.OpenButton}}),e.AsyncExtensionsButton=function(e){return i.default.createElement("div",{className:"control__button"},i.default.createElement(o.ExtensionsMenu,t.__assign({},e)))}}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer_sidebar/buttons/shared_file_actions",["require","exports","modules/clean/react/async/loadable","modules/clean/react/share_download/button"],function(n,e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncShareDownloadButton=e.AsyncOpenInAppButton=e.AsyncExtensionsMenuNoUnity=e.AsyncSignInButton=e.AsyncEditNowButton=void 0,e.AsyncEditNowButton=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/cloud_docs/edit_now_button"],e,t)}).then(__importStar).then(function(e){return e.EditNowButton})}}),e.AsyncSignInButton=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/sign_in/button"],e,t)}).then(__importStar).then(function(e){return e.SignInButton})}}),e.AsyncExtensionsMenuNoUnity=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/extensions/extensions_menu_component_v2"],e,t)}).then(__importStar).then(function(e){return e.ExtensionsMenuV2NoUnity})}}),e.AsyncOpenInAppButton=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/open_in_app/button"],e,t)}).then(__importStar).then(function(e){return e.OpenInAppButton})}}),Object.defineProperty(e,"AsyncShareDownloadButton",{enumerable:!0,get:function(){return i.ShareDownloadButton}})}),define("modules/clean/react/file_viewer_sidebar/buttons/version_history_file_actions",["require","exports","tslib","react","classnames","spectrum/button/index","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/core/i18n"],function(e,t,n,i,r,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RestoreButton=void 0,i=n.__importDefault(i),r=n.__importDefault(r),t.RestoreButton=function(e){var t=s.intl.formatMessage({id:"PL5ta5",defaultMessage:"Restore"});return i.default.createElement(o.Button,{variant:"primary",className:r.default("control__button","restore-button",{"control__button--collapsed":e.isCollapsed}),onClick:e.onClick},e.isCollapsed?i.default.createElement(a.ButtonIcon,{isPrimary:!0,name:"restore-file","aria-label":t}):t)}}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer_sidebar/data_managers/async_activity_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(n,e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncActivityDataManager=void 0,e.AsyncActivityDataManager=t.Loadable({loader:function(){return i.waitForTTI().then(function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer_sidebar/data_managers/activity_data_manager"],e,t)}).then(__importStar)}).then(function(e){return e.ActivityDataManager})}})}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer_sidebar/data_managers/async_commenting_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(n,e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncCommentingDataManager=void 0,e.AsyncCommentingDataManager=t.Loadable({loader:function(){return i.waitForTTI().then(function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer_sidebar/data_managers/commenting_data_manager"],e,t)}).then(__importStar)}).then(function(e){return e.CommentingDataManager})}})}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer_sidebar/data_managers/async_pro_analytics_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(n,e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncProAnalyticsDataManager=void 0,e.AsyncProAnalyticsDataManager=t.Loadable({loader:function(){return i.waitForTTI().then(function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer_sidebar/data_managers/pro_analytics_data_manager"],e,t)}).then(__importStar)}).then(function(e){return e.ProAnalayticsDataManager})}})}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer_sidebar/esign_upsell/async_esign_upsell",["require","exports","modules/clean/react/async/loadable"],function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncEsignUpsell=void 0,e.AsyncEsignUpsell=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer_sidebar/esign_upsell/esign_upsell"],e,t)}).then(__importStar).then(function(e){return e.EsignUpsell})}})}),define("modules/clean/react/file_viewer_sidebar/esign_upsell/esign_upsell",["require","exports","tslib","react","dig-components/typography","dig-components/buttons","modules/core/i18n","modules/clean/react/components/css","react","modules/clean/react/file_viewer_sidebar/esign_upsell/use_show_esign_upsell"],function(c,e,d,u,p,m,f,t,g,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EsignUpsell=void 0,u=d.__importStar(u),e.EsignUpsell=t.requireCssWithComponent(function(e){var t=e.isCollapsed,n=e.userId,i=e.file,r=e.launchHelloSignDeepIntegration,o=g.useState(!1),e=o[0],a=o[1],s=g.useRef(!0);u.useEffect(function(){return s.current=!0,function(){s.current=!1}});var o=_.useShowEsignUpsell(n,i),i=o.showEsignUpsell,l=o.stormcrowVariant,o=o.productPlanType;return t||e||!i?null:u.createElement("div",{className:"esign-upsell-dialog"},u.createElement(p.Title,{size:"standard",isBold:!0},f.intl.formatMessage({id:"14Lkt7",defaultMessage:"Collect signatures on your documents right from Dropbox"})),u.createElement(p.Text,{className:"esign-upsell-subtext",tagName:"p",isBold:!0},"PLUS"===o?f.intl.formatMessage({id:"Chr0Rd",defaultMessage:"Add e-sign to your plan and upgrade to Professional"}):f.intl.formatMessage({id:"jA1VlD",defaultMessage:"Add eSign to your plan"})),u.createElement(p.Text,{className:"esign-upsell-subtext",tagName:"p"},u.createElement("li",null,f.intl.formatMessage({id:"tIBR0E",defaultMessage:"Unlimited documents for signature"})),u.createElement("li",null,f.intl.formatMessage({id:"8oG+3m",defaultMessage:"5 templates for commonly signed documents"})),u.createElement("li",null,f.intl.formatMessage({id:"nnCgRS",defaultMessage:"Tamper-proofing and audit trail included"}))),u.createElement("div",{className:"esign-upsell-footer"},u.createElement(m.Button,{variant:"primary",onClick:function(e){e&&e.preventDefault(),Promise.all([new Promise(function(e,t){c(["modules/clean/account_page/widgets/plan/views/change_plan_modal"],e,t)}).then(d.__importStar),new Promise(function(e,t){c(["modules/clean/payments/skus/constants"],e,t)}).then(d.__importStar)]).then(function(e){var t=e[0],n=t.ChangePlanModalView,t=t.ChangePlanOrigin,e=e[1].ProductPlanType;s.current&&n.showInstance({origin:"V1"===l?t.ESIGN_UPSELL_V1:t.ESIGN_UPSELL_V2,admissiblePlans:[e.HS_DBX_PRO_BUNDLE],hideDetailsCurrentPlan:!0,defaultSelectedPlan:e.HS_DBX_PRO_BUNDLE,hideUpdateBillingInfo:!0,launchHelloSignDeepIntegration:r})}),a(!0)},"data-uxa-log":"preview-esign-upsell-continue"},f.intl.formatMessage({id:"BVa7ab",defaultMessage:"Continue"})),u.createElement("div",{className:"esign-upsell-secondary-button"},u.createElement(m.Button,{variant:"transparent",onClick:function(){a(!0),_.trackClickAction(n)},"data-uxa-log":"preview-esign-upsell-dismiss"},f.intl.formatMessage({id:"zBnSR/",defaultMessage:"Not now"})))))},["/static/css/file_viewer_sidebar/esign_upsell-vfl4W6PKM.css"])}),define("modules/clean/react/file_viewer_sidebar/esign_upsell/use_show_esign_upsell",["require","exports","react","api_v2/user_client","modules/clean/react/file_viewer_sidebar/esign_upsell/esign_upsell_user_actions_tracker"],function(e,t,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackClickAction=t.useShowEsignUpsell=void 0,t.useShowEsignUpsell=function(t,e){var n=c.useState(!1),i=n[0],r=n[1],o=c.useState("OFF"),a=o[0],s=o[1],n=c.useState("UNKNOWN"),o=n[0],l=n[1];return c.useEffect(function(){void 0!==t&&void 0!==e&&(new d.UserApiV2Client).ns("growth_bundling").rpc("show_pro_esign_upsell",{sjid:e.sjid,ns_id:e.ns_id,file_ext:e.ext.slice(1)},{subjectUserId:t}).then(function(e){e.show_campaign&&(r(!0),s(e.variant||""),l(e.product_plan_type||""),new u.EsignUpsellUserActionTracker(t).track(u.EsignUpsellUserAction.SHOW))})},[t,e]),{showEsignUpsell:i,stormcrowVariant:a,productPlanType:o}},t.trackClickAction=function(e){void 0!==e&&new u.EsignUpsellUserActionTracker(e).track(u.EsignUpsellUserAction.CLICK,{})}}),define("modules/clean/react/file_viewer_sidebar/panes/commenting_pane",["require","exports","tslib","react","file-viewer/modes/index","modules/clean/react/async/loadable","file-viewer/core/index"],function(n,e,i,r,o,t,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CommentingPane=void 0,r=i.__importDefault(r);var s=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer_sidebar/panes/commenting_pane_contents"],e,t)}).then(i.__importStar).then(function(e){return e.CommentingPaneContents})}});e.CommentingPane=function(e){var t=e.coreFVUiProps,n=e.encryptionOptions,e=e.user;return r.default.createElement(o.Pane,i.__assign({paneId:a.SidebarPaneId.Comments},t),r.default.createElement(s,{encryptionOptions:n,user:e}))}}),define("modules/clean/react/file_viewer_sidebar/panes/documentation_pane",["require","exports","tslib","react","file-viewer/modes/index","file-viewer/core/index","modules/clean/em_string","modules/clean/file_store/utils","dig-components/typography","modules/clean/react/components/css","modules/clean/react/file_viewer_sidebar/panes/strings","modules/clean/react/file_viewer/data/actions","react-redux","modules/clean/react/file_viewer_sidebar/panes/file_activity_section","modules/clean/react/file_viewer_sidebar/panes/loadable_details_section","modules/clean/react/file_viewer_sidebar/panes/loadable_tasks_section","modules/clean/react/branding/optional_branding_block","modules/clean/filepath/filepath"],function(e,t,d,u,p,m,f,g,_,n,h,i,r,v,b,w,y,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentationPane=t.ConnectedDocumentationPaneComponent=t.UnconnectedDocumentationPaneComponent=void 0,u=d.__importDefault(u),S=d.__importStar(S),t.UnconnectedDocumentationPaneComponent=function(e){var t=e.file,n=e.user,i=e.maxFilenameEmLength,r=e.brandingInfo,o=e.sharedLinkInfo,a=e.isVersionHistoryMode,s=e.coreFVUiProps,l=e.expGrowthActSmbWorkflowsBaton,c=f.Emstring.em_snippet(g.getFilename(t),i),i=t.fq_path,i=i&&n&&!S.inSubDirectory(n.cdm_tmf_path,i);return u.default.createElement(p.Pane,d.__assign({paneId:m.SidebarPaneId.Documentation},s),u.default.createElement("div",{className:"documentation-pane"},u.default.createElement(y.OptionalBrandingBlock,{className:"documentation-pane__branding-block",brandingInfo:r,sharedLinkInfo:o}),u.default.createElement(_.Title,{className:"documentation-pane__title"},c),u.default.createElement(b.LoadableDetailsSection,{title:h.DocumentationPaneStrings.details,file:t,user:n,sharedLinkInfo:o,pushMetadataPaneHandler:function(){return e.pushSidebarPane(m.SidebarPaneId.Metadata)}}),l&&i&&u.default.createElement(w.LoadableTasksSection,{title:h.DocumentationPaneStrings.tasks,file:t}),u.default.createElement(v.ConnectedFileActivitySection,{file:t,user:n,isVersionHistoryMode:a,title:h.DocumentationPaneStrings.activity,pushActivityPaneHandler:function(){return e.pushSidebarPane(m.SidebarPaneId.Activity)}})))};i={pushSidebarPane:i.pushSidebarPane};t.ConnectedDocumentationPaneComponent=r.connect(null,i)(t.UnconnectedDocumentationPaneComponent),t.DocumentationPane=n.requireCssWithComponent(t.ConnectedDocumentationPaneComponent,["/static/css/file_viewer_sidebar/documentation_pane-vflVp3XEa.css"])}),define("modules/clean/react/file_viewer_sidebar/panes/editing_pane",["require","exports","tslib","react","classnames","file-viewer/modes/index","modules/clean/react/components/css"],function(e,t,r,o,a,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditingPane=t.EditingPaneComponent=void 0,o=r.__importDefault(o),a=r.__importDefault(a);var i,l=(i=o.default.PureComponent,r.__extends(c,i),c.prototype.componentWillUnmount=function(){var e=this.props.paneId,e=document.querySelector('[data-control-id="'+e+'"]');e&&e.focus()},c.prototype.render=function(){var e=this.props,t=e.coreFVUiProps,n=e.paneId,i=e.children,e=e.classname;return o.default.createElement(s.Pane,r.__assign({paneId:n,className:"editing-pane-wrapper"},t),o.default.createElement("div",{"aria-labelledby":"react-file-viewer__title-bar","aria-modal":"true",className:a.default("editing-pane",e),role:"dialog"},i))},c);function c(){return null!==i&&i.apply(this,arguments)||this}t.EditingPaneComponent=l,t.EditingPane=n.requireCssWithComponent(l,["/static/css/file_viewer_sidebar/editing_pane-vfljT-58j.css"])}),define("modules/clean/react/file_viewer_sidebar/panes/file_activity_section",["require","exports","tslib","react","modules/clean/react/file_sidebar/file_sidebar_connect","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/components/css","modules/clean/react/file_viewer_sidebar/panes/loadable_file_activity_stream_summary","dig-components/icons","dig-components/icons/src","dig-components/typography","modules/clean/react/file_viewer_sidebar/panes/strings"],function(e,t,n,s,i,r,o,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedFileActivitySection=t.UnconnectedFileActivitySection=void 0,s=n.__importDefault(s),r=n.__importStar(r);var a,n=(a=s.default.Component,n.__extends(m,a),m.prototype.render=function(){var e=this.props,t=e.activities,n=e.user,i=e.isVersionHistoryMode,r=e.isFileActivityEnabled,o=e.title,a=e.pushActivityPaneHandler,e=e.file;if(!n||i||!r)return null;t=t&&!t.loading&&0!==t.value.length;return s.default.createElement("div",{className:"documentation-pane__section"},s.default.createElement(u.Title,{className:"documentation-pane__section-title",size:"small"},o),s.default.createElement(l.LoadableFileActivityStreamSummary,{file:e,user:n,maxVisibleActivityCards:2}),t&&s.default.createElement("div",{className:"documentation-pane__push-pane-button-wrapper"},s.default.createElement(u.Link,{href:"#",onClick:a},p.ActivitySectionStrings.viewAllActivities,s.default.createElement("span",{className:"documentation-pane__arrow-right-icon"},s.default.createElement(c.UIIcon,{size:"small",src:d.ChevronRightLine})))))},m);function m(){return null!==a&&a.apply(this,arguments)||this}t.UnconnectedFileActivitySection=n,t.ConnectedFileActivitySection=i.fileSidebarConnect(function(e){return{isFileActivityEnabled:r.isActivityEnabled(e),activities:r.getActivitiesMetadata(e)}})(o.requireCssWithComponent(n,["/static/css/file_activity_stream-vflVllHcH.css"]))}),define("modules/clean/react/file_viewer_sidebar/panes/image_chooser_section",["require","exports","tslib","react","dropins_sdk_refactor/src/v2_entry","modules/clean/filepath/filepath","modules/clean/loggers/workflows_logger","spectrum/popover/index","modules/core/i18n","modules/clean/react/snackbar","modules/clean/react/components/css","classnames","spectrum/colorized_icon/index","spectrum/icon_action/index","spectrum/tooltip/index","modules/clean/react/watermarking/utils"],function(e,t,a,s,n,r,l,i,c,d,o,u,p,m,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageChooserSection=t.ImageChooserSectionWithoutCSS=t.ImageSource=void 0,s=a.__importDefault(s),u=a.__importDefault(u);var _,h=["image/png","image/jpeg","image/jpg","image/gif","image/bmp"];(y=_=t.ImageSource||(t.ImageSource={})).FROM_DROPBOX="dropbox",y.FROM_COMPUTER="computer",y.FROM_DRAGDROP="dragdrop";function v(e){return s.default.createElement("svg",{className:e.className,viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},s.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},s.default.createElement("path",{d:"M16.9849536,10.3304435 L21.935986,13.4846597 L16.9501078,16.6610755 L11.9679572,13.4870801 L6.98587822,16.6610755 L2,13.4846597 L6.950961,10.330489 L2,7.17634414 L6.9859499,4 L11.9679214,7.17394657 L16.9501795,4 L21.9359143,7.17634414 L16.9849536,10.3304435 Z M16.9151901,10.330489 L11.9679213,7.17874171 L7.020724,10.3304435 L11.9679572,13.4822392 L16.9151901,10.330489 Z M7.01792123,17.713692 L12.0037994,14.5376346 L16.9897493,17.713692 L12.0037994,20.8901078 L7.01792123,17.713692 Z",fill:e.fill||"#ffffff"})))}v.displayName="DropboxIcon";function b(e){return s.default.createElement("svg",{className:e.className,viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},s.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},s.default.createElement("path",{d:"M14,10 L24,10 L24,14 L14,14 L14,24 L10,24 L10,14 L0,14 L0,10 L10,10 L10,0 L14,0 L14,10 Z",fill:e.fill||"#ffffff"})))}b.displayName="PlusIcon";var w,y=(w=s.default.PureComponent,a.__extends(S,w),S.prototype.componentDidMount=function(){this.props.isImageWatermarkingMode&&window.addEventListener("dragover",this.handleDragOver)},S.prototype.componentDidUpdate=function(e){this.props.isImageWatermarkingMode!==e.isImageWatermarkingMode&&(this.props.isImageWatermarkingMode?window.addEventListener("dragover",this.handleDragOver):window.removeEventListener("dragover",this.handleDragOver))},S.prototype.componentWillUnmount=function(){this.props.isImageWatermarkingMode&&window.removeEventListener("dragover",this.handleDragOver)},S.prototype.render=function(){var t=this;return s.default.createElement(s.default.Fragment,null,this.props.isImageWatermarkingMode&&s.default.createElement("div",{className:u.default("watermarking-drop-zone",{"watermarking-drop-zone--dragged-over":this.state.isDraggedOver}),onDrop:this.onDropFile,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},this.state.isDraggedOver?s.default.createElement("p",{className:"watermarking-drop-zone__text"},c.intl.formatMessage({id:"+j0wlP",defaultMessage:"Drop image here"})):null),s.default.createElement("div",{className:"image-chooser-section"},this.state.imageURL?s.default.createElement(s.default.Fragment,null,s.default.createElement(f.Tooltip,{positioning:"left",positionOffset:8,tooltipContent:c.intl.formatMessage({id:"9v2+SN",defaultMessage:"Delete"})},s.default.createElement("button",{"aria-label":c.intl.formatMessage({id:"EpYmFq",defaultMessage:"Delete selected watermark image"}),className:"image-chooser-section__delete-button",onClick:this.onDeleteButtonClicked},s.default.createElement(p.ColorizedIcon,{color:"white"},s.default.createElement(m.IconAction,{name:"delete"})))),s.default.createElement("img",{className:"image-chooser-section__selected-image",src:this.state.imageURL,alt:c.intl.formatMessage({id:"ZeTVlG",defaultMessage:"Selected watermark image"})})):s.default.createElement(s.default.Fragment,null,s.default.createElement(i.Popover,{onSelection:this.onSourceSelection},s.default.createElement(i.PopoverTrigger,{"aria-label":c.intl.formatMessage({id:"Fb32+S",defaultMessage:"Open image source selection menu"}),className:"image-chooser__popover-trigger"},s.default.createElement("span",{className:"image-chooser-section__popover-button"},s.default.createElement(b,{className:"image-chooser-section__plus-svg"}))),s.default.createElement(i.PopoverContent,null,s.default.createElement(i.PopoverContentItem,{className:"image-chooser-section__add-from-dropbox",value:_.FROM_DROPBOX},s.default.createElement(v,{className:"image-chooser-section__logo-svg"}),c.intl.formatMessage({id:"rIir19",defaultMessage:"Dropbox"}),s.default.createElement("span",{className:"ax-visually-hidden"}," "+c.intl.formatMessage({id:"dRhmBa",defaultMessage:"(opens a new window)"}))),s.default.createElement(i.PopoverContentItem,{className:"image-chooser-section__add-from-computer",value:_.FROM_COMPUTER},s.default.createElement(p.ColorizedIcon,{color:"white"},s.default.createElement(m.IconAction,{name:"upload"})),c.intl.formatMessage({id:"CVumiI",defaultMessage:"My computer"})))),s.default.createElement("p",{className:"image-chooser-section__drop-text","aria-hidden":"true"},c.intl.formatMessage({id:"+j0wlP",defaultMessage:"Drop image here"}))),s.default.createElement("input",{className:"image-chooser-section__image-upload",type:"file",accept:h.join(", "),onClick:function(e){return e.target.value=""},onChange:this.onChooseFromComputer,ref:function(e){return t.imageUploadRef=e}})))},S);function S(e){var o=w.call(this,e)||this;return o.handleDragOver=function(){o.setState({isDraggedOver:!0})},o.onChooseFromDropbox=function(r){return a.__awaiter(o,void 0,void 0,function(){var t,n,i;return a.__generator(this,function(e){switch(e.label){case 0:if(!(t=r.pop())||r.length)throw new Error("Dropbox chooser should only return one item");return n=t.link,[4,g.getImageFromURL(n)];case 1:return i=e.sent(),this.onImageSelected(i,n,t.name,_.FROM_DROPBOX),[2]}})})},o.onChooseFromComputer=function(r){return a.__awaiter(o,void 0,void 0,function(){var t,n,i;return a.__generator(this,function(e){switch(e.label){case 0:return r.currentTarget.files?(t=Array.from(r.currentTarget.files).pop())?(n=URL.createObjectURL(t),[4,g.getImageFromURL(n)]):[2]:[3,2];case 1:i=e.sent(),this.onImageSelected(i,n,t.name,_.FROM_COMPUTER),e.label=2;case 2:return[2]}})})},o.onDropFile=function(r){return a.__awaiter(o,void 0,void 0,function(){var t,n,i;return a.__generator(this,function(e){switch(e.label){case 0:return r.preventDefault(),this.setState({isDraggedOver:!1}),(t=r.dataTransfer.files[0])?h.includes(t.type)?(n=URL.createObjectURL(t),[4,g.getImageFromURL(n)]):(d.Snackbar.show(s.default.createElement(d.ControlledSnackbarComponent,{id:"image-watermarking-drag-drop-error",title:c.intl.formatMessage({id:"tRlSi7",defaultMessage:"Canâ€™t add. Choose an image file, like JPEG, GIF or PNG."}),variant:"fail",closeButtonText:c.intl.formatMessage({id:"2Cbv/y",defaultMessage:"Try again"})})),[2]):[2];case 1:return i=e.sent(),this.onImageSelected(i,n,t.name,_.FROM_DRAGDROP),[2]}})})},o.onDragOver=function(e){e.preventDefault(),o.setState({isDraggedOver:!0})},o.onDragLeave=function(e){e.preventDefault(),o.setState({isDraggedOver:!1})},o.onImageSelected=function(e,t,n,i){o.setState({imageURL:t},function(){var e=t&&o.props.focusOnSelect?o.props.focusOnSelect:document.querySelector(".image-chooser__popover-trigger");e&&e.focus()}),e&&(n=r.file_extension_for_logging(n||""),l.logWorkflowsEvent(l.WorkflowsEvent.WatermarkImageUploaded,g.getWatermarkMilestone(o.props.user),{source:i,image_ext:n})),o.props.onImageSelected(e)},o.onDeleteButtonClicked=function(e){l.logWorkflowsEvent(l.WorkflowsEvent.WatermarkImageDeleted,g.getWatermarkMilestone(o.props.user)),o.onImageSelected(void 0,void 0)},o.onSourceSelection=function(e){if(l.logWorkflowsEvent(l.WorkflowsEvent.WatermarkImageUploadClicked,g.getWatermarkMilestone(o.props.user),{source:e}),e===_.FROM_DROPBOX)try{n.Dropbox.choose({multiselect:!1,success:o.onChooseFromDropbox,linkType:"direct",extensions:["images"]})}catch(e){d.Snackbar.fail(c.intl.formatMessage({id:"muNFvG",defaultMessage:"Couldnâ€™t add image from Dropbox. Please reload the page and try again."}))}else o.imageUploadRef&&o.imageUploadRef.click()},o.state={isDraggedOver:!1,imageURL:e.defaultImageURL},n.Dropbox.init({appKey:"dropbox",productKey:"file_viewer_image_chooser"}),o}t.ImageChooserSectionWithoutCSS=y,t.ImageChooserSection=o.requireCssWithComponent(y,["/static/css/file_viewer_sidebar/image_chooser_section-vflr9AIyr.css"])}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer_sidebar/panes/loadable_activity_pane",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(n,e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoadableActivityPane=void 0,e.LoadableActivityPane=t.Loadable({loader:function(){return i.waitForTTI().then(function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer_sidebar/panes/activity_pane"],e,t)}).then(__importStar).then(function(e){return e.ActivityPane})})}})}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer_sidebar/panes/loadable_details_section",["require","exports","modules/clean/react/async/loadable"],function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoadableDetailsSection=void 0,e.LoadableDetailsSection=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer_sidebar/panes/details_section"],e,t)}).then(__importStar).then(function(e){return e.DetailsSection})}})}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer_sidebar/panes/loadable_tasks_section",["require","exports","modules/clean/react/async/loadable"],function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoadableTasksSection=void 0,e.LoadableTasksSection=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer_sidebar/panes/tasks_section"],e,t)}).then(__importStar).then(function(e){return e.TasksSection})}})}),__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},define("modules/clean/react/file_viewer_sidebar/panes/loadable_file_activity_stream_summary",["require","exports","modules/clean/react/async/loadable"],function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoadableFileActivityStreamSummary=void 0,e.LoadableFileActivityStreamSummary=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer_sidebar/panes/file_activity_stream_summary"],e,t)}).then(__importStar).then(function(e){return e.FileActivityStreamSummary})}})}),define("modules/clean/react/file_viewer_sidebar/panes/markup_pane",["require","exports","tslib","react","classnames","lodash","react-redux","file-viewer/core/index","modules/core/browser","modules/core/i18n","ts-keycode-enum","modules/clean/browse_uri_interface","modules/clean/file_store/utils","modules/clean/loggers/workflows_logger","modules/clean/previews/data/selectors","modules/clean/previews/data/preview_type_util","modules/clean/react/components/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/panes/editing_pane","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/previews/constants","modules/clean/react/snackbar","spectrum/button/index","modules/clean/react/workflows/markup/fabric","modules/clean/react/workflows/markup/selectors","modules/clean/react/workflows/markup/types","modules/clean/react/workflows/markup/utils","pro-ui/components/base/apply_button/index","modules/clean/react/workflows/markup_icons","spectrum/popover/index","spectrum/tooltip/index","spectrum/modal/index"],function(e,t,s,l,o,n,i,c,d,u,a,p,m,f,r,g,_,h,v,b,w,y,S,E,P,C,M,k,T,A,I,F,O,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarkupPane=t.ConnectedMarkupPaneComponent=t.MarkupPaneComponent=void 0,l=s.__importDefault(l),o=s.__importDefault(o),d=s.__importStar(d);function D(e,t){return void 0===t&&(t=!0),e===k.MarkupColor.TRANSPARENT?I.transparentFillIcon:I.circleIcon({stroke:e,fill:t?e:void 0})}var R,N,L=[k.MarkupColor.TRANSPARENT,k.MarkupColor.RED_CHERRY,k.MarkupColor.ORANGE_TANGERINE,k.MarkupColor.GREEN,k.MarkupColor.DARK_BLUE,k.MarkupColor.ULTRAVIOLET,k.MarkupColor.WHITE,k.MarkupColor.BLACK].map(function(e){return{color:e,icon:D(e)}}),U=((V={})[k.MarkupColor.TRANSPARENT]=u.intl.formatMessage({id:"cnToDS",defaultMessage:"No fill color"}),V[k.MarkupColor.RED_CHERRY]=u.intl.formatMessage({id:"rZnlRM",defaultMessage:"Red"}),V[k.MarkupColor.ORANGE_TANGERINE]=u.intl.formatMessage({id:"6YT7wY",defaultMessage:"Orange"}),V[k.MarkupColor.GREEN]=u.intl.formatMessage({id:"TfeWUu",defaultMessage:"Green"}),V[k.MarkupColor.DARK_BLUE]=u.intl.formatMessage({id:"Opr8C4",defaultMessage:"Blue"}),V[k.MarkupColor.ULTRAVIOLET]=u.intl.formatMessage({id:"IZk7A9",defaultMessage:"Purple"}),V[k.MarkupColor.WHITE]=u.intl.formatMessage({id:"NupPFJ",defaultMessage:"White"}),V[k.MarkupColor.BLACK]=u.intl.formatMessage({id:"ukyV/6",defaultMessage:"Black"}),V),W=(N=l.default.Component,s.__extends(j,N),j.prototype.render=function(){var e=this.props,t=e.icon,n=e.onChange,i=e.label,e=this.state.isSubmenuOpen;return l.default.createElement(F.Popover,{onSelection:n,onMenuToggle:this.toggleSubMenu,closeOnSelection:!1},l.default.createElement(F.PopoverTrigger,null,l.default.createElement("div",{className:"markup-pane__tool-buttons"},l.default.createElement(O.Tooltip,{positioning:"below",className:"markup-pane__tooltip",tooltipContent:i},l.default.createElement(P.Button,{variant:"secondary",size:"large",className:o.default("markup-pane__tool-button",{"markup-pane__tool-button--selected":e}),tagName:"span"},t)))),l.default.createElement(F.PopoverContent,null,L.map(function(e){var t=e.icon,e=e.color;return l.default.createElement(O.Tooltip,{positioning:"below",className:"markup-pane__tooltip",tooltipContent:U[e],key:U[e]},l.default.createElement(F.PopoverContentItem,{value:e},t))})))},j),B=((V={})[k.MarkupType.TEXT]=f.WorkflowsEvent.MarkupTextboxClicked,V[k.MarkupType.FREEFORM]=f.WorkflowsEvent.MarkupDrawClicked,V[k.MarkupType.ARROW]=f.WorkflowsEvent.MarkupArrowClicked,V[k.MarkupType.RECT]=f.WorkflowsEvent.MarkupRectangleClicked,V[k.MarkupType.CIRCLE]=f.WorkflowsEvent.MarkupCircleClicked,V),V=(R=l.default.Component,s.__extends(K,R),K.prototype.componentDidMount=function(){f.logWorkflowsEvent(f.WorkflowsEvent.MarkupEnabled)},K.prototype.componentWillUnmount=function(){this.props.resetMarkupState(),f.logWorkflowsEvent(f.WorkflowsEvent.MarkupCancel)},K.prototype.render=function(){var e=this.props,t=e.coreFVUiProps,n=e.markupState,i=n.isDrawingMode,r=n.formatSubmenu,e=n.fillColor,n=n.strokeColor,i=[{icon:I.rectIcon,onClick:this.onClickTool(k.MarkupType.RECT,[k.FormatSubmenuEntry.FILL,k.FormatSubmenuEntry.STROKE]),label:u.intl.formatMessage({id:"JZlohh",defaultMessage:"Add square"})},{icon:I.circleIcon({stroke:"white",fill:"none"}),onClick:this.onClickTool(k.MarkupType.CIRCLE,[k.FormatSubmenuEntry.FILL,k.FormatSubmenuEntry.STROKE]),label:u.intl.formatMessage({id:"vOLK2M",defaultMessage:"Add circle"})},{icon:I.textIcon,onClick:this.onClickTool(k.MarkupType.TEXT,[k.FormatSubmenuEntry.STROKE]),label:u.intl.formatMessage({id:"3uYwiW",defaultMessage:"Add text"})},{icon:I.arrowIcon,onClick:this.onClickTool(k.MarkupType.ARROW,[k.FormatSubmenuEntry.STROKE]),label:u.intl.formatMessage({id:"pL0M9g",defaultMessage:"Add arrow"})},{icon:I.drawIcon,onClick:this.onClickDraw,label:u.intl.formatMessage({id:"WwXu7L",defaultMessage:"Draw"}),className:o.default({"markup-pane__tool-button--selected":i})}];return l.default.createElement(b.EditingPane,{paneId:c.SidebarPaneId.Markup,coreFVUiProps:t},l.default.createElement("div",{className:"markup-pane__actions"},l.default.createElement(A.ApplyButton,{onApply:this.handleApply,onClick:function(){},disabled:!1}),l.default.createElement(P.Button,{tagName:"button",variant:"secondary",onClick:this.handleCancel},u.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))),l.default.createElement("div",{className:"markup-pane__control"},l.default.createElement("div",{className:o.default("markup-pane__main-tool-buttons",{"markup-pane__main-tool-buttons--submenu-open":0<r.length})},i.map(function(e,t){var n=e.icon,i=e.onClick,r=e.label,e=e.className;return l.default.createElement(O.Tooltip,{tooltipContent:r,className:"markup-pane__tooltip",positioning:"below",key:r},l.default.createElement(P.Button,{variant:"secondary",size:"large",onClick:i,className:o.default("markup-pane__tool-button",e)},n))}))),0<r.length&&l.default.createElement(q,{onFillChange:this.onFillChange,onStrokeChange:this.onStrokeChange,fillColor:e,strokeColor:n,menuEntries:r}),l.default.createElement(w.KeyboardBindingConnector,{keyboardBindings:[y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.Backspace},callback:this.onDelete}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.Delete},callback:this.onDelete}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.Escape},callback:this.onEscape}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.C,ctrlKey:!0},callback:this.onCopy}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.C,metaKey:!0},callback:this.onCopy}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.V,ctrlKey:!0},callback:this.onPaste}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.V,metaKey:!0},callback:this.onPaste}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.LeftArrow},callback:this.onLeftArrowPressed}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.UpArrow},callback:this.onUpArrowPressed}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.RightArrow},callback:this.onRightArrowPressed}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:a.Key.DownArrow},callback:this.onDownArrowPressed})]}),this.renderConfirmationModal())},K);function K(e){var a=R.call(this,e)||this;return a.onStrokeChange=function(e){var t=a.props,n=t.markupState,i=t.currentPageIndex;(0,t.setMarkupStroke)(e);i=n[i].fabric;C.setOptionsForActiveObjects(i,{stroke:e})},a.onFillChange=function(e){var t=a.props,n=t.markupState,i=t.currentPageIndex;(0,t.setMarkupFill)(e);i=n[i].fabric;C.setOptionsForActiveObjects(i,{fill:e})},a.addMarkupObject=function(e){var t=a.props,n=t.currentPageIndex,i=t.markupState,r=t.markupState,t=r.strokeColor,r=r.fillColor,n=i[n].fabric;n&&(C.addMarkupObject(n,e,{stroke:t,fill:r,left:a.left,top:a.top}),a.props.setMarkupDrawingMode(!1),a.left+=T.OFFSET,a.top+=T.OFFSET,a.left>=n.getWidth()&&(a.left=T.DEFAULT_LEFT),a.top>=n.getHeight()&&(a.top=T.DEFAULT_TOP))},a.onClickDraw=function(){var e=a.props,t=e.markupState.isDrawingMode,n=e.setMarkupDrawingMode,e=e.setMarkupFormatSubmenu;t||e([k.FormatSubmenuEntry.STROKE]),n(!t),f.logWorkflowsEvent(f.WorkflowsEvent.MarkupDrawClicked)},a.onClickTool=function(e,t){return function(){(0,a.props.setMarkupFormatSubmenu)(t),a.addMarkupObject(e),f.logWorkflowsEvent(B[e])}},a.exitWithConfirmation=function(){a.props.markupState[a.props.currentPageIndex].fabric.isEmpty()?a.props.changeMode(c.FileViewerMode.Documentation):a.setState({isConfirmationModalOpen:!0})},a.handleCancel=function(e){e.preventDefault(),a.exitWithConfirmation()},a.handleApply=function(o){return s.__awaiter(a,void 0,void 0,function(){var t,n,i,r;return s.__generator(this,function(e){switch(e.label){case 0:E.Snackbar.sync(u.intl.formatMessage({id:"Dn6iyj",defaultMessage:"Marking up file..."}),!1,"markup-notification"),f.logWorkflowsEvent(o?f.WorkflowsEvent.MarkupApplyOverwrite:f.WorkflowsEvent.MarkupApplySaveAsCopy),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,C.saveMarkup(this.props.user.id,this.props.file.file_id,o,this.props.markupState,this.props.previewType)];case 2:return t=e.sent(),[3,4];case 3:return i=e.sent(),n=T.getMarkupErrorMessage(i.error),r="over_quota_error"===i.error[".tag"],i=r?u.intl.formatMessage({id:"nvlC/2",defaultMessage:"Upgrade"}):u.intl.formatMessage({id:"o+sT31",defaultMessage:"Close"}),r=r?function(){return d.open_tab("/plans")}:function(){},[2,E.Snackbar.show(l.default.createElement(E.Snackbar,{id:"markup-notification",closeButtonText:i,timeoutDelayMs:5e3,title:n,variant:"fail",onCloseClick:r}))];case 4:return(r=t.fq_path||m.isBrowseFile(this.props.file)&&this.props.file.fq_path)?d.replace_location(p.preview_uri_for_fq_path(this.props.user,r,{context:S.PreviewSourceContext.Workflow})):d.reload(),[2]}})})},a.onDelete=function(e){e&&e instanceof KeyboardEvent&&e.preventDefault(),f.logWorkflowsEvent(f.WorkflowsEvent.MarkupDelete);e=a.props.markupState[a.props.currentPageIndex].fabric;e&&(e.remove.apply(e,e.getActiveObjects()),e.discardActiveObject().requestRenderAll())},a.onEscape=function(){var e,t=a.props.markupState[a.props.currentPageIndex].fabric;a.props.markupState.isDrawingMode?(a.props.setMarkupDrawingMode(!1),(e=n.last(t.getObjects()))&&t.setActiveObject(e).requestRenderAll()):t.getActiveObject()?t.discardActiveObject().requestRenderAll():a.exitWithConfirmation()},a.onCopy=function(){a.props.markupState[a.props.currentPageIndex].fabric.getActiveObject().clone(function(e){a.clipboard=e})},a.onPaste=function(){var n;a.clipboard&&(n=a.props.markupState[a.props.currentPageIndex].fabric,a.clipboard.top=(a.clipboard.top||T.DEFAULT_TOP)+T.OFFSET,a.clipboard.left=(a.clipboard.left||T.DEFAULT_LEFT)+T.OFFSET,a.clipboard.left>=n.getWidth()&&(a.clipboard.left=T.DEFAULT_LEFT),a.clipboard.top>=n.getHeight()&&(a.clipboard.top=T.DEFAULT_TOP),a.clipboard.clone(function(e){var t;n.discardActiveObject(),e.set({evented:!0,strokeUniform:!0}),"activeSelection"===e.type?((t=e).canvas=n,t.forEachObject(function(e){n.add(e)}),t.setCoords()):n.add(e),n.setActiveObject(e).requestRenderAll()}))},a.onLeftArrowPressed=function(){a.moveActiveObject(-T.MOVE_DISTANCE_X,0)},a.onRightArrowPressed=function(){a.moveActiveObject(T.MOVE_DISTANCE_X,0)},a.onUpArrowPressed=function(){a.moveActiveObject(0,-T.MOVE_DISTANCE_Y)},a.onDownArrowPressed=function(){a.moveActiveObject(0,T.MOVE_DISTANCE_Y)},a.moveActiveObject=function(e,t){var n=a.props.markupState[a.props.currentPageIndex].fabric,i=n.getActiveObject();i&&(i.left=i.left+e,i.top=i.top+t,n.trigger("object:moving",{target:i}),n.requestRenderAll())},a.renderConfirmationModal=function(){var e=u.intl.formatMessage({id:"c7pOMh",defaultMessage:"Exit without saving?"});return l.default.createElement(x.UtilityModal,{title:e,ariaLabel:e,open:a.state.isConfirmationModalOpen,primaryAction:u.intl.formatMessage({id:"U5fgWD",defaultMessage:"Yes"}),onPrimaryAction:function(){return a.props.changeMode(c.FileViewerMode.Documentation)},secondaryAction:u.intl.formatMessage({id:"gWxS/S",defaultMessage:"No"}),onSecondaryAction:function(){return a.setState({isConfirmationModalOpen:!1})},overlayClassName:"file-viewer-modal-overlay",appElement:document.getElementById("embedded-app")||document.body},u.intl.formatMessage({id:"rvkufC",defaultMessage:"Your markup will be lost if you exit before saving this file."}))},a.state={isConfirmationModalOpen:!1},a.left=T.DEFAULT_LEFT,a.top=T.DEFAULT_TOP,a}function j(){var t=null!==N&&N.apply(this,arguments)||this;return t.state={isSubmenuOpen:!1},t.toggleSubMenu=function(e){e=e.isOpen;t.setState({isSubmenuOpen:e})},t}t.MarkupPaneComponent=V;var q=function(e){var t=e.menuEntries,n=e.onFillChange,i=e.onStrokeChange,r=e.fillColor,o=e.strokeColor;return l.default.createElement("div",{className:"markup-pane__control markup-pane__control-colors"},t.map(function(e){switch(e){case k.FormatSubmenuEntry.FILL:return l.default.createElement(W,{icon:D(r),onChange:n,key:"fill-menu",label:u.intl.formatMessage({id:"H/EWDP",defaultMessage:"Change fill color"})});case k.FormatSubmenuEntry.STROKE:return l.default.createElement(W,{icon:D(o,!1),onChange:i,key:"stroke-menu",label:u.intl.formatMessage({id:"m+pG8Y",defaultMessage:"Change line color"})});default:return null}}))},h={changeMode:h.changeMode,setMarkupDrawingMode:h.setMarkupDrawingMode,resetMarkupState:h.resetMarkupState,setMarkupFill:h.setMarkupFill,setMarkupStroke:h.setMarkupStroke,setMarkupFormatSubmenu:h.setMarkupFormatSubmenu},h=i.connect(function(e,t){return{markupState:M.getMarkupState(e),currentPageIndex:v.getCurrentPageIndex(e)||0,previewType:g.getPreviewType(r.getApiDataForFile(e,t.file).data)}},h);t.ConnectedMarkupPaneComponent=h(V),t.MarkupPane=_.requireCssWithComponent(t.ConnectedMarkupPaneComponent,["/static/css/file_viewer_sidebar/editing_pane-vfljT-58j.css","/static/css/file_viewer_sidebar/markup_pane-vfl6W9OHv.css"])}),define("modules/clean/react/file_viewer_sidebar/panes/metadata_pane",["require","exports","tslib","react","file-viewer/modes/index","file-viewer/core/index","modules/clean/react/file_metadata/component/loadable_metadata_details","modules/clean/react/components/css","modules/clean/react/file_viewer_sidebar/panes/strings","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer_sidebar/utils","react-redux","modules/clean/react/file_viewer/data/selectors","file-viewer/modes/sidebar/pane_title"],function(e,t,i,r,o,a,s,n,l,c,d,u,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataPane=t.ConnectedMetadataPaneComponent=t.UnconnectedMetadataPaneComponent=void 0,r=i.__importDefault(r),t.UnconnectedMetadataPaneComponent=function(e){var t=d.isSidebarOpen(e.sidebar)&&d.isSidebarPaneIdAtTopOfStack(a.SidebarPaneId.Metadata,e.sidebar),n=d.getSecondFromTopSidebarPaneId(e.sidebar);return r.default.createElement(o.Pane,i.__assign({paneId:a.SidebarPaneId.Metadata},e.coreFVUiProps),r.default.createElement("div",{className:"metadata-pane"},r.default.createElement(m.PaneTitleComponent,{title:l.MetadataPaneStrings.details,backButton:n?{previousPaneId:n,onClick:e.popSidebarPane}:void 0,intl:e.coreFVUiProps.intl}),r.default.createElement(s.LoadableMetadataDetails,{file:e.file,user:e.user,sharedLinkInfo:e.sharedLinkInfo,isActiveTab:t,previewType:e.previewType})))};c={popSidebarPane:c.popSidebarPane};t.ConnectedMetadataPaneComponent=u.connect(function(e){return{sidebar:p.getSidebar(e)}},c)(t.UnconnectedMetadataPaneComponent),t.MetadataPane=n.requireCssWithComponent(t.ConnectedMetadataPaneComponent,["/static/css/file_viewer_sidebar/metadata_pane-vflJOp4bF.css"])}),define("modules/clean/react/file_viewer_sidebar/panes/rotation_control",["require","exports","tslib","react","classnames","modules/core/i18n","spectrum/button/index","modules/clean/mouse_button_code","ts-keycode-enum"],function(e,t,n,i,r,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RotationControl=void 0,i=n.__importDefault(i),r=n.__importDefault(r);var c,n=(c=i.default.Component,n.__extends(d,c),d.prototype.componentWillUnmount=function(){this.rotateTimeoutId&&clearTimeout(this.rotateTimeoutId)},d.prototype.render=function(){var e=this.props,t=e.className,n=e.disabled,e=e.value;return i.default.createElement("div",{className:r.default("rotation-control",t)},i.default.createElement("div",{className:"rotation-control--current-value ax-visually-hidden","aria-live":"polite"},o.intl.formatMessage({id:"TSbTsY",defaultMessage:"{value} degrees"},{value:e})),i.default.createElement(a.Button,{disabled:n,onKeyDown:this.startRotatingAC,onKeyUp:this.stopRotating,onMouseDown:this.startRotatingAC,onMouseUp:this.stopRotating,size:"large",variant:"secondary"},i.default.createElement("span",{className:"ax-visually-hidden"},o.intl.formatMessage({id:"ZhlNXH",defaultMessage:"Rotate Anticlockwise"})),i.default.createElement("svg",{"aria-hidden":!0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i.default.createElement("path",{d:"M9.87193 19.7329C10.5328 19.9073 11.227 20.0002 11.943 20.0002C16.3929 20.0002 20.0002 16.4106 20.0002 11.9825C20.0002 7.55449 16.3929 3.96484 11.943 3.96484C8.793 3.96484 6.06518 5.76364 4.74032 8.38529",stroke:"white",strokeWidth:"2"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.92141 7.72819L10.0233 7.21687L10.1704 8.66739L3.61077 9.3248L2.94905 2.79745L4.40675 2.65136L4.92141 7.72819Z",fill:"white"}))),i.default.createElement(a.Button,{disabled:n,onKeyDown:this.startRotatingCW,onKeyUp:this.stopRotating,onMouseDown:this.startRotatingCW,onMouseUp:this.stopRotating,size:"large",variant:"secondary"},i.default.createElement("span",{className:"ax-visually-hidden"},o.intl.formatMessage({id:"yDs6IE",defaultMessage:"Rotate Clockwise"})),i.default.createElement("svg",{"aria-hidden":!0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i.default.createElement("path",{d:"M14.1283 19.7329C13.4674 19.9073 12.7732 20.0002 12.0572 20.0002C7.60734 20.0002 4 16.4106 4 11.9825C4 7.55449 7.60734 3.96484 12.0572 3.96484C15.2072 3.96484 17.9351 5.76364 19.2599 8.38529",stroke:"white",strokeWidth:"2"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.0788 7.72819L13.9769 7.21687L13.8299 8.66739L20.3895 9.3248L21.0512 2.79745L19.5935 2.65136L19.0788 7.72819Z",fill:"white"}))))},d);function d(){var r=null!==c&&c.apply(this,arguments)||this;return r.rotateTimeoutId=null,r.state={isRotating:!1},r.startRotatingAC=function(e){e.button!==s.MouseButtonCode.LEFT&&e.keyCode!==l.Key.Enter||r.startRotating(1)},r.startRotatingCW=function(e){e.button!==s.MouseButtonCode.LEFT&&e.keyCode!==l.Key.Enter||r.startRotating(-1)},r.startRotating=function(e){r.setState({isRotating:!0},function(){return r.rotate(e)})},r.stopRotating=function(){r.setState({isRotating:!1})},r.rotate=function(e){var t=r.props,n=t.onChange,i=t.step,t=t.value;n&&r.state.isRotating&&(359<(i=(void 0===t?0:t)+e*(void 0===i?15:i))&&(i-=360),i<0&&(i+=360),n(i),r.rotateTimeoutId&&clearTimeout(r.rotateTimeoutId),i=setTimeout(function(){r.rotateTimeoutId=null,r.rotate(e)},200),r.rotateTimeoutId=i)},r}t.RotationControl=n}),define("modules/clean/react/file_viewer_sidebar/panes/strings",["require","exports","modules/core/i18n"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActivitySectionStrings=t.DetailsSectionStrings=t.ActivityPaneStrings=t.MetadataPaneStrings=t.DocumentationPaneStrings=void 0,t.DocumentationPaneStrings={details:n.intl.formatMessage({id:"ghld2g",defaultMessage:"Details"}),activity:n.intl.formatMessage({id:"wVS5Gq",defaultMessage:"Activity"}),tasks:n.intl.formatMessage({id:"kA8gdS",defaultMessage:"Tasks"})},t.MetadataPaneStrings={details:n.intl.formatMessage({id:"mBshLe",defaultMessage:"Details"})},t.ActivityPaneStrings={details:n.intl.formatMessage({id:"Zduv89",defaultMessage:"Activity"})},t.DetailsSectionStrings={viewPreviousVersions:n.intl.formatMessage({id:"cGuWuL",defaultMessage:"View previous versions"}),viewAllDetails:n.intl.formatMessage({id:"cdTbAt",defaultMessage:"View all details"})},t.ActivitySectionStrings={viewAllActivities:n.intl.formatMessage({id:"dkJoht",defaultMessage:"View all activity"})}}),define("modules/clean/react/file_viewer_sidebar/panes/watermarking_pane",["require","exports","tslib","react","react-dom","classnames","lodash","react-aria-tabpanel","file-viewer/core/index","react-redux","file-viewer/core/index","modules/clean/browse_uri_interface","modules/clean/file_store/utils","modules/clean/loggers/workflows_logger","modules/clean/react/components/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/panes/editing_pane","modules/clean/react/snackbar","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/api","modules/core/i18n","spectrum/button/index","spectrum/dropdown_menu/index","spectrum/input/index","ts-keycode-enum","modules/clean/react/file_viewer_sidebar/panes/rotation_control","modules/clean/react/watermarking/utils","modules/clean/previews/data/selectors","modules/clean/previews/data/preview_type_util","modules/clean/react/previews/constants","modules/clean/react/watermarking/types","modules/core/browser","modules/clean/react/watermarking/selectors","modules/clean/react/file_viewer_sidebar/panes/image_chooser_section","modules/clean/react/watermarking/apply_watermark_button","modules/clean/react/watermarking/utils","pro-ui/components/base/slider/index","spectrum/tabbed_header/index"],function(e,t,s,d,n,u,i,p,m,r,o,l,c,f,a,g,_,h,v,b,w,y,S,E,P,C,M,k,T,A,I,F,O,x,D,R,N,L,U){"use strict";var W;Object.defineProperty(t,"__esModule",{value:!0}),t.WatermarkingPane=t.ConnectedWatermarkingPaneComponent=t.WatermarkingPaneComponent=t.WATERMARKING_PANE_POSITION_BUTTON_CLASSNAME=void 0,d=s.__importDefault(d),n=s.__importStar(n),u=s.__importDefault(u),O=s.__importStar(O),t.WATERMARKING_PANE_POSITION_BUTTON_CLASSNAME="watermarking-pane__position-button",(H=W=W||{}).TEXT="watermark_pane_text_tab",H.IMAGE="watermark_pane_image_tab";function B(){return d.default.createElement("svg",{width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},d.default.createElement("circle",{className:"northwest",cx:"7",cy:"7",r:"2"}),d.default.createElement("circle",{className:"northeast",cx:"17",cy:"7",r:"2"}),d.default.createElement("circle",{className:"southeast",cx:"17",cy:"17",r:"2"}),d.default.createElement("circle",{className:"southwest",cx:"7",cy:"17",r:"2"}),d.default.createElement("circle",{className:"center",cx:"12",cy:"12",r:"2"}))}var V,K=4*Math.pow(10,6),j=[{key:F.WatermarkPosition.CENTER,description:y.intl.formatMessage({id:"2FTkI8",defaultMessage:"Center"})},{key:F.WatermarkPosition.NORTHWEST,description:y.intl.formatMessage({id:"0A9340",defaultMessage:"Upper left"})},{key:F.WatermarkPosition.NORTHEAST,description:y.intl.formatMessage({id:"DeXDpY",defaultMessage:"Upper right"})},{key:F.WatermarkPosition.SOUTHWEST,description:y.intl.formatMessage({id:"ON2oaH",defaultMessage:"Lower left"})},{key:F.WatermarkPosition.SOUTHEAST,description:y.intl.formatMessage({id:"JHqw26",defaultMessage:"Lower right"})},{key:F.WatermarkPosition.REPEAT,description:y.intl.formatMessage({id:"v5qde2",defaultMessage:"Repeat"})}],q=[{key:"black",description:y.intl.formatMessage({id:"GDUcy7",defaultMessage:"Dark"})},{key:"white",description:y.intl.formatMessage({id:"9QTLF+",defaultMessage:"Light"})}],H=(V=d.default.Component,s.__extends(z,V),z.prototype.componentDidMount=function(){var e=this.props.watermarkState;this.updateScale(),f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkEnable,N.getWatermarkMilestone(this.props.user),{num_characters:this.textInput&&String(this.textInput.value.length),start_position:String(F.getWatermarkingOptions(e).position),start_rotation:String(F.getWatermarkingOptions(e).angle),start_size:String(F.getWatermarkingOptions(e).size),start_transparency:String(F.getWatermarkingOptions(e).opacity)})},z.prototype.componentWillUnmount=function(){k.setUserMetadataTextWatermarkingState(this.props.user,this.props.watermarkState),f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkCancel,N.getWatermarkMilestone(this.props.user),{watermark_type:this.props.watermarkState.mode})},z.prototype.updateScale=function(){var e=this.props,t=e.updateWatermarkOptions,e=e.previewType,e=k.getWatermarkScale(e);t({imageWatermarkingOptions:{scale:e},textWatermarkingOptions:{scale:e}})},z.prototype.render=function(){var e=this.props,t=e.coreFVUiProps,n=e.file,i=e.watermarkState,r=e.user,o=F.getWatermarkingOptions(i),a=i.textWatermarkingOptions,s=i.imageWatermarkingOptions,l=o.position||F.WatermarkPosition.REPEAT,c=a.color,e=i.mode===F.WatermarkingMode.TEXT&&!!a.text||i.mode===F.WatermarkingMode.IMAGE&&!!s.image;return d.default.createElement(h.EditingPane,{paneId:m.SidebarPaneId.Watermarking,coreFVUiProps:t,classname:"watermarking-pane"},d.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__actions"},d.default.createElement(R.ApplyWatermarkButton,{onApply:this.handleApply,onClick:this.logApplyButtonClick,allowWatermark:N.allowWatermark(n,r),hasInput:i.mode===F.WatermarkingMode.TEXT?!!a.text:!!s.image,trialVariant:N.getWatermarkTrialVariant(r),milestone:N.getWatermarkMilestone(r),isPlusUser:r.paid}),d.default.createElement(S.Button,{tagName:"button",variant:"secondary",onClick:this.handleCancel},N.allowWatermarkTrial(r)?y.intl.formatMessage({id:"+Dtv46",defaultMessage:"Exit"}):y.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))),d.default.createElement(p.Wrapper,{ref:this.onTabWrapperRef},d.default.createElement(U.TabbedHeader,null,d.default.createElement(U.Tab,{id:W.TEXT,onClick:this.onTabClicked,onKeyUp:this.onTabKeyUp,active:i.mode===F.WatermarkingMode.TEXT},y.intl.formatMessage({id:"wzKMOb",defaultMessage:"Text"})),d.default.createElement(U.Tab,{id:W.IMAGE,onClick:this.onTabClicked,onKeyUp:this.onTabKeyUp,active:i.mode===F.WatermarkingMode.IMAGE},y.intl.formatMessage({id:"UOGf2g",defaultMessage:"Image"}))),d.default.createElement("div",{className:"watermarking-pane__tab-panels"},d.default.createElement(p.TabPanel,{active:i.mode===F.WatermarkingMode.TEXT,tabId:W.TEXT},d.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__text"},d.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"1n+LVR",defaultMessage:"Watermark"})),d.default.createElement(P.Input,{"aria-label":y.intl.formatMessage({id:"W853K9",defaultMessage:"Text of Watermark"}),autoComplete:"off",placeholder:y.intl.formatMessage({id:"YZ+Jsk",defaultMessage:"Add watermark text"}),forwardedRef:this.onInputRef,fullWidth:!0,name:"text",value:a.text,onChange:this.handleTextChange,onFocus:this.logTextInputFocus,onBlur:this.logTextInputBlur,maxLength:100}))),d.default.createElement(p.TabPanel,{active:i.mode===F.WatermarkingMode.IMAGE,tabId:W.IMAGE},d.default.createElement("p",{className:"watermarking-pane__label","aria-hidden":!0},y.intl.formatMessage({id:"1n+LVR",defaultMessage:"Watermark"})),d.default.createElement(D.ImageChooserSection,{coreFVUiProps:t,file:n,user:this.props.user,defaultImageURL:s.image?s.image.src:void 0,onImageSelected:this.handleImageChange,focusOnSelect:this.positionRef&&this.positionRef.querySelector("button"),isImageWatermarkingMode:i.mode===F.WatermarkingMode.IMAGE})))),d.default.createElement("div",{className:u.default({"watermarking-pane__controls--disabled":!e})},d.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__position watermarking-pane__dropdown",ref:this.onPositionRef},d.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"zxyFrb",defaultMessage:"Position"})),d.default.createElement(E.DropdownMenu,{disabled:!e,onSelection:this.handlePositionChange},d.default.createElement(E.DropdownMenuButton,null,d.default.createElement("span",{"aria-label":y.intl.formatMessage({id:"zxyFrb",defaultMessage:"Position"}),className:"icon icon-"+l.toLowerCase()},d.default.createElement(B,null)),this.getDropdownDescription(l,j)),d.default.createElement(E.Menu,null,j.map(function(e){return d.default.createElement(E.MenuItem,{key:e.key,value:e.key,selected:e.key===l},d.default.createElement("span",{className:"icon icon-"+e.key.toLowerCase()},d.default.createElement(B,null)),e.description)})))),i.mode===F.WatermarkingMode.TEXT?d.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__dropdown watermarking-pane__color"},d.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"HQyDBL",defaultMessage:"Color"})),d.default.createElement(E.DropdownMenu,{disabled:!e,onSelection:this.handleColorChange},d.default.createElement(E.DropdownMenuButton,null,d.default.createElement("span",{className:"icon watermarking-pane__color-icon",style:{backgroundColor:c}}),this.getDropdownDescription(c,q)),d.default.createElement(E.Menu,null,q.map(function(e){return d.default.createElement(E.MenuItem,{key:e.key,value:e.key,selected:e.key===c},d.default.createElement("span",{className:"icon watermarking-pane__color-icon",style:{backgroundColor:e.key}}),e.description)})))):null,d.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__rotation"},d.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"kG/lBo",defaultMessage:"Rotation"})),d.default.createElement(M.RotationControl,{disabled:!e,value:o.angle,onChange:this.handleRotationChange})),d.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__opacity"},d.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"8Ppp84",defaultMessage:"Opacity"})),d.default.createElement(L.Slider,{className:"watermarking-pane__opacity-slider",disabled:!e,min:0,max:100,darkMode:!0,fullWidth:!0,value:o.opacity,name:"opacity",onChange:this.handleOpacityChange})),d.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__font_size"},d.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"txUjQq",defaultMessage:"Size"})),d.default.createElement(L.Slider,{className:"watermarking-pane__fontsize-slider",disabled:!e,min:o.minSize,max:o.maxSize,darkMode:!0,fullWidth:!0,value:o.size,name:"fontsize",onChange:this.handleSizeChange,step:"any"}))))},z);function z(){var a=null!==V&&V.apply(this,arguments)||this;return a.defaultText="",a.getTiledImageWatermark=function(){var e=a.props,t=e.watermarkState,e=(0,e.tilingRenderer)(F.getWatermarkingOptions(t).scale),t=e.canvas.toDataURL().split(",",2).pop();if(t)return s.__assign(s.__assign({},e),{image:t})},a.getImageWatermark=function(){var e,t,n=a.props.watermarkState;if(n.mode===F.WatermarkingMode.TEXT){if(!(t=n.textWatermarkingOptions).text)return;e=b.drawTextTile(t.text,t.size*t.scale,t.fontFamily,t.color,t.opacity/100,t.angle/180*Math.PI).canvas}else{if(!(t=n.imageWatermarkingOptions).image)return;e=b.drawImageTile(t.image,t.size*t.scale,t.opacity/100,t.angle/180*Math.PI).canvas}if(e)return{image:e.toDataURL().split(",",2).pop(),position:t.position,marginX:t.position===F.WatermarkPosition.CENTER?0:t.marginX,marginY:t.position===F.WatermarkPosition.CENTER?0:t.marginY}},a.commitAndRedirect=function(o){return s.__awaiter(a,void 0,void 0,function(){var t,n,i,r;return s.__generator(this,function(e){switch(e.label){case 0:if(t=this.props.watermarkState,i=F.getWatermarkingOptions(t),!(t=i.position===F.WatermarkPosition.REPEAT?this.getTiledImageWatermark():this.getImageWatermark()))return[2];if(t.image.length>K)return[2,v.Snackbar.fail(y.intl.formatMessage({id:"g1Qc/Z",defaultMessage:"Thatâ€™s too big to save. Try making your watermark smaller."}),"watermarking-notification")];v.Snackbar.sync(y.intl.formatMessage({id:"sN5g4y",defaultMessage:"Watermarking file..."}),!1,"watermarking-notification"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,w.sendWatermarkRequest(this.props.user.id,this.props.file.file_id,o,t)];case 2:return n=e.sent(),[3,4];case 3:return i=e.sent(),r=k.isOverQuotaError(i.error)?y.intl.formatMessage({id:"ztdrtc",defaultMessage:"The watermark could not be saved because your account is over quota."}):k.isFilesystemError(i.error)?y.intl.formatMessage({id:"pHFNKD",defaultMessage:"The watermark could not be saved because the file was moved or deleted."}):k.isUnsupportedFileError(i.error)?y.intl.formatMessage({id:"1GlT+b",defaultMessage:"Watermarking is not available for this file type."}):k.isUnauthorizedAccessError(i.error)?y.intl.formatMessage({id:"sCMFzX",defaultMessage:"The watermark could not be saved because you do not have permission to save to this folder."}):y.intl.formatMessage({id:"PUQ8kA",defaultMessage:"Couldnâ€™t save watermark. Refresh the page to try again."}),[2,v.Snackbar.fail(r,"watermarking-notification")];case 4:return(r=n.fq_path||c.isBrowseFile(this.props.file)&&this.props.file.fq_path)?O.replace_location(l.preview_uri_for_fq_path(this.props.user,r,{context:I.PreviewSourceContext.Workflow})):O.reload(),[2]}})})},a.updateCommonWatermarkingOptions=function(e){a.props.watermarkState.mode===F.WatermarkingMode.TEXT?a.updateTextWatermarkingOptions(e):a.updateImageWatermarkingOptions(e)},a.updateTextWatermarkingOptions=function(e){a.props.updateWatermarkOptions({textWatermarkingOptions:e})},a.updateImageWatermarkingOptions=function(e){a.props.updateWatermarkOptions({imageWatermarkingOptions:e})},a.debouncedLogOpacityChange=i.debounce(function(e){f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkTransparencyChanged,N.getWatermarkMilestone(a.props.user),{watermark_type:a.props.watermarkState.mode,start_transparency:String(a.startingOpacity),end_transparency:String(e)}),a.startingOpacity=void 0},200),a.handleOpacityChange=function(e){var t=a.props.watermarkState,t=F.getWatermarkingOptions(t).opacity;e!==t&&(a.startingOpacity=a.startingOpacity||t,a.debouncedLogOpacityChange(e),a.updateCommonWatermarkingOptions({opacity:e}))},a.debouncedLogSizeChange=i.debounce(function(e){f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkSizeChanged,N.getWatermarkMilestone(a.props.user),{watermark_type:a.props.watermarkState.mode,start_size:String(a.startingSize),end_size:String(e)}),a.startingSize=void 0},200),a.handleSizeChange=function(e){var t=a.props.watermarkState,t=F.getWatermarkingOptions(t).size;e!==t&&(a.startingSize=a.startingSize||t,a.debouncedLogSizeChange(e),a.updateCommonWatermarkingOptions({size:e}))},a.handleTextChange=function(e){a.textInput&&a.updateTextWatermarkingOptions({text:a.textInput.value})},a.logTextInputFocus=function(){f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkTextInputEnterFocus,N.getWatermarkMilestone(a.props.user),{num_characters:a.textInput&&String(a.textInput.value.length)})},a.logTextInputBlur=function(){f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkTextInputExitFocus,N.getWatermarkMilestone(a.props.user),{num_characters:a.textInput&&String(a.textInput.value.length)})},a.handleImageChange=function(e){a.updateImageWatermarkingOptions(s.__assign({image:e,imageAsDataURL:void 0},N.getImageDefaultSizes(e,a.props.pageDimensions)))},a.handlePositionChange=function(e){var t,n=a.props.watermarkState,i=F.getWatermarkingOptions(n).position,r={position:e};i===F.WatermarkPosition.REPEAT&&r.position!==F.WatermarkPosition.REPEAT&&(r.angle=0),i!==F.WatermarkPosition.REPEAT&&r.position===F.WatermarkPosition.REPEAT&&(t=F.getWatermarkingOptions(k.DEFAULT_WATERMARKING_STATE),r.angle=t.angle),f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkPositionMenuSelectionMade,N.getWatermarkMilestone(a.props.user),{watermark_type:n.mode,start_position:i,end_position:e}),a.updateCommonWatermarkingOptions(r)},a.handleColorChange=function(e){f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkColorClicked,N.getWatermarkMilestone(a.props.user),{watermark_type:a.props.watermarkState.mode,color:e}),a.updateTextWatermarkingOptions({color:e})},a.handleRotationChange=function(e){var t=a.props.watermarkState,n=F.getWatermarkingOptions(t).angle;f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkRotationClicked,N.getWatermarkMilestone(a.props.user),{watermark_type:t.mode,start_rotation:String(n),end_rotation:String(e)}),a.updateCommonWatermarkingOptions({angle:e})},a.handleCancel=function(e){e.preventDefault(),a.props.changeMode(o.FileViewerMode.Documentation)},a.onTabClicked=function(e){e.currentTarget.id===W.TEXT?(f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkTextTabClicked,N.getWatermarkMilestone(a.props.user)),a.props.switchWatermarkingMode(F.WatermarkingMode.TEXT)):(f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkImageTabClicked,N.getWatermarkMilestone(a.props.user)),a.props.switchWatermarkingMode(F.WatermarkingMode.IMAGE))},a.onTabKeyUp=function(e){[C.Key.Enter,C.Key.Space].includes(e.keyCode)&&(e.currentTarget.id===W.TEXT?(f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkTextTabClicked,N.getWatermarkMilestone(a.props.user)),a.props.switchWatermarkingMode(F.WatermarkingMode.TEXT)):(f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkImageTabClicked,N.getWatermarkMilestone(a.props.user)),a.props.switchWatermarkingMode(F.WatermarkingMode.IMAGE)))},a.onInputRef=function(e){a.textInput=e},a.onTabWrapperRef=function(e){a.tabWrapperRef=e?n.findDOMNode(e):null;e=a.tabWrapperRef&&a.tabWrapperRef.querySelector('[role="tab"][aria-selected="true"]');e&&e.focus()},a.onPositionRef=function(e){a.positionRef=e},a.handleApply=function(r){return s.__awaiter(a,void 0,void 0,function(){var t,n,i;return s.__generator(this,function(e){return i=this.props,t=i.isTrialMode,n=i.user,i=i.watermarkState,t||(f.logWorkflowsEvent(r?f.WorkflowsEvent.WatermarkApplyOverwrite:f.WorkflowsEvent.WatermarkApplySaveAsCopy,N.getWatermarkMilestone(n),{watermark_type:i.mode,num_characters:this.textInput&&String(this.textInput.value.length),end_position:String(F.getWatermarkingOptions(i).position),end_rotation:String(F.getWatermarkingOptions(i).angle),end_size:String(F.getWatermarkingOptions(i).size),end_transparency:String(F.getWatermarkingOptions(i).opacity)}),k.setUserMetadataTextWatermarkingState(n,i),this.commitAndRedirect(r)),[2]})})},a.logApplyButtonClick=function(){f.logWorkflowsEvent(f.WorkflowsEvent.WatermarkOpenApplyMenu,N.getWatermarkMilestone(a.props.user),{watermark_type:a.props.watermarkState.mode})},a.getDropdownDescription=function(t,e){e=e.find(function(e){return e.key===t});return e?e.description:void 0},a}t.WatermarkingPaneComponent=H;g=r.connect(function(e,t){return{mode:_.getMode(e),isTrialMode:_.getIsTrialMode(e),watermarkState:x.getWatermarkState(e),tilingRenderer:x.getWatermarkTilingFunc(e),previewType:A.getPreviewType(T.getApiDataForFile(e,t.file).data),pageDimensions:_.getPageDimensions(e)}},{changeMode:g.changeMode,updateWatermarkOptions:g.updateWatermarkOptions,switchWatermarkingMode:g.switchWatermarkingMode});t.ConnectedWatermarkingPaneComponent=g(H),t.WatermarkingPane=a.requireCssWithComponent(t.ConnectedWatermarkingPaneComponent,["/static/css/file_viewer_sidebar/watermarking_pane-vflgy-27E.css"])}),define("modules/clean/react/file_viewer_sidebar/render_utils/call_to_action",["require","exports","tslib","react","modules/clean/auth/login_or_register/types","modules/clean/react/components/modal","modules/clean/react/file_viewer_sidebar/buttons/mounted_file_actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/constants","modules/clean/react/extensions/data/types","spectrum-sharing/utils/sharing_constants","modules/clean/react/file_viewer_sidebar/buttons/shared_file_actions","modules/clean/previews/util","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/clean/react/file_viewer_sidebar/buttons/version_history_file_actions","modules/clean/react/file_viewer/conversions/conversion_utils","modules/core/browser","modules/core/i18n","dig-components/buttons"],function(h,e,v,b,w,y,s,S,E,P,C,M,k,T,A,l,I,F,O,x){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.renderVersionHistoryActions=e.renderSharedFileActions=e.renderMountedFileActions=void 0,b=v.__importDefault(b),F=v.__importStar(F),e.renderMountedFileActions=function(e,t,n,i,r,o,a){if(void 0===a&&(a=!1),!i)return[];i=[b.default.createElement(s.AsyncShareButton,{key:"share",file:e,user:t,isCollapsed:(o=void 0===o?!1:o)&&a}),b.default.createElement(s.AsyncSpacesDropdown,{key:"spaces",file:e,user:t,isCollapsed:o&&a})];return r?i.push(b.default.createElement(s.AsyncExtensionsButton,{key:"extension",user:t,file:e,showAsButtonIfDownloadOnly:!0,telemetryContext:{surface:"previews"},showBigTooltip:!0,onPresentInZoom:function(){},triggerType:a&&o?P.TriggerType.CollapsedButton:void 0,isInFVSidebar:o})):i.push(b.default.createElement(s.AsyncOpenButton,{file:e,location:o?E.FileViewerPane.Sidebar:E.FileViewerPane.TitleBar,user:t,key:"open",sizeClass:n,isCollapsed:o})),i},e.renderSharedFileActions=function(e,t,n,i,r,o,a,s,l,c,d){void 0===s&&(s=!1),void 0===l&&(l=!1);var u=!(!e.open_in_app_data||!e.preview_type),p=[];(d=void 0===d?!1:d)&&!l&&p.push(b.default.createElement(x.Button,{variant:"primary",size:"standard",href:"https://dropbox.com/capture"},O.intl.formatMessage({id:"Z1jqLM",defaultMessage:"Try Capture for Free"})));var m,f,g,_=s?S.UserActionContext.Sidebar:S.UserActionContext.TitleBarMain;return u&&a&&p.push(b.default.createElement(M.AsyncOpenInAppButton,{urls:e.open_in_app_data,userActionContext:_})),t||(k.isCloudDocPreview(e)?p.push(b.default.createElement(M.AsyncEditNowButton,{isPrimaryButton:!u,onClick:function(){return T.logUserAction(S.UserAction.SignIn,_)},hideCallOut:!1,isCollapsed:s&&l})):(m=!u,f=l||s&&!m,g=I.shouldOpenModalFromSidebar()?{href:void 0,onClick:function(){T.logUserAction(S.UserAction.SignIn,_),new Promise(function(e,t){h(["modules/clean/auth/login_or_register/modal"],e,t)}).then(v.__importStar).then(function(e){e=e.LoginOrRegisterModal;y.Modal.showInstance(b.default.createElement(e,{downloadAction:null,onCancel:function(){},id:"file-viewer-sidebar-modal",initialMode:w.Mode.LOGIN,kind:w.LoginOrRegisterKind.SIDEBAR,signup_tag:"file-viewer-sidebar-modal",onAuthenticateSuccess:function(){return F.reload()},encryptionOptions:c}))})}}:{onClick:function(){return T.logUserAction(S.UserAction.SignIn,_)}},p.push(b.default.createElement(M.AsyncSignInButton,v.__assign({isPrimaryButton:m},g,{icon:f?b.default.createElement(A.ButtonIcon,{name:"sign-in",isPrimary:!u}):void 0}))),l||!I.shouldShowSignupButton()||d||p.push(b.default.createElement(M.AsyncSignInButton,{isPrimaryButton:!1,title:O.intl.formatMessage({id:"C4FJfI",defaultMessage:"Sign up"}),href:void 0,onClick:function(){T.logUserAction(S.UserAction.SignUp,_),new Promise(function(e,t){h(["modules/clean/auth/login_or_register/modal"],e,t)}).then(v.__importStar).then(function(e){e=e.LoginOrRegisterModal;y.Modal.showInstance(b.default.createElement(e,{downloadAction:null,onCancel:function(){},id:"file-viewer-sidebar-modal",initialMode:w.Mode.REGISTER,kind:w.LoginOrRegisterKind.SIDEBAR,signup_tag:"file-viewer-sidebar-modal",encryptionOptions:c}))})}})))),t&&a&&r.linkType===C.SharedLinkType.Content&&p.push(b.default.createElement("div",{className:"control__button"},b.default.createElement(M.AsyncExtensionsMenuNoUnity,{file:e,user:t,triggerType:s&&(l||0!==p.length)?P.TriggerType.CollapsedButton:void 0,isInFVSidebar:s}))),r&&o&&a&&!k.isCloudDocPreview(e)&&p.push(b.default.createElement(M.AsyncShareDownloadButton,{copyable:e,location:s?E.FileViewerPane.Sidebar:E.FileViewerPane.TitleBar,sharedLinkInfo:i,sharePermission:o,shareToken:r,user:t,isCollapsed:s&&(l||0!==p.length),encryptionOptions:c})),p},e.renderVersionHistoryActions=function(e,t,n,i,r,o,a){if(void 0===o&&(o=!1),void 0===a&&(a=!1),!n)return[];n=[];return i&&n.push(b.default.createElement(l.RestoreButton,{key:"restore",onClick:r,isCollapsed:a})),n.push(b.default.createElement(s.AsyncOpenButton,{key:"open",file:e,user:t,isUnityDisabled:!0,isOpenWithDisabled:!0,isCloudEditorDisabled:!0,location:o?E.FileViewerPane.Sidebar:E.FileViewerPane.TitleBar,isCollapsed:o})),n}}),define("modules/clean/react/file_viewer_sidebar/sidebar",["require","exports","tslib","react","react-redux","file-viewer/modes/index","file-viewer/core/index","modules/clean/integrations/data/selectors","modules/clean/pro_analytics/data/util","modules/clean/react/file_viewer_sidebar/utils","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","lodash","modules/clean/react/workflows/markup/utils","modules/clean/react/watermarking/utils","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer_sidebar/panes/documentation_pane","modules/clean/react/file_viewer_sidebar/panes/metadata_pane","modules/clean/react/file_viewer_sidebar/panes/commenting_pane","modules/clean/react/file_viewer_sidebar/panes/pro_analytics_pane","modules/clean/react/file_viewer_sidebar/panes/loadable_activity_pane","modules/clean/react/file_viewer_sidebar/panes/markup_pane","modules/clean/react/file_viewer_sidebar/panes/watermarking_pane","modules/clean/react/user_notifications/dropdown","modules/clean/react/extensions/file","file-viewer/modes/index","modules/clean/cloud_docs/constants","file-viewer/core/index","modules/clean/react/file_viewer/constants","modules/clean/viewer","modules/clean/react/file_viewer/logging","modules/clean/integrations/data/selectors","modules/clean/react/size_class/size_class","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/render_utils/call_to_action","modules/clean/react/file_viewer_sidebar/widgets/seen_states","classnames","modules/clean/react/file_viewer/ml_experiment","modules/clean/file_store/utils","modules/core/i18n","modules/clean/react/file_viewer_sidebar/esign_upsell/async_esign_upsell"],function(e,t,b,w,n,i,a,r,o,s,l,c,d,y,S,E,m,f,g,_,h,P,C,u,M,k,T,A,I,F,p,v,O,x,D,R,N,L,U,W,B){"use strict";var V;Object.defineProperty(t,"__esModule",{value:!0}),t.Sidebar=t.UnconnectedSidebar=void 0,w=b.__importDefault(w),o=b.__importStar(o),d=b.__importStar(d),N=b.__importDefault(N),(j=V=V||{})[j.MOUNTED_FILE=0]="MOUNTED_FILE",j[j.SHARED_FILE=1]="SHARED_FILE",j[j.VERSION_HISTORY=2]="VERSION_HISTORY";var K,j=(K=w.default.PureComponent,b.__extends(q,K),q.prototype.sidebarWidth=function(){switch(this.props.sizeClass){case O.SizeClass.ExtraLarge:return 490;case O.SizeClass.Large:return 440;case O.SizeClass.Medium:return 320;case O.SizeClass.Small:return 0}},q.prototype.componentWillUnmount=function(){this.props.resetSidebarPaneStack()},q.prototype.render=function(){var e=this.props,t=e.handleSidebarDispatch,n=e.fileViewerUiData,e={renderSidebarNotificationsFn:this.renderSidebarNotificationsFn,renderSidebarCallToActionsFn:this.renderSidebarCallToActionsFn,renderSidebarOverflowMenuFn:this.props.renderSidebarOverflowMenuFn,renderSidebarPASSFn:this.renderSidebarPASSFn,renderSidebarUpsellFn:this.renderSidebarUpsellFn},n=w.default.createElement(i.Sidebar,b.__assign({fileViewerUiData:n,fileId:"",intl:W.intl,dispatch:t,fileViewerId:"dummy",registerSidebarPanesFn:this.registerSidebarPanesFn,renderSidebarControlsFn:this.createRenderSidebarControlsFn(this.props.disabledModes),width:n.sidebar.visibility===a.SidebarVisibility.Open?this.sidebarWidth():void 0,pluginMode:{type:"default"}},e));return(e=this.getPASSProviderProps())?w.default.createElement(R.AsyncSeenStatesProviderWrapper,b.__assign({},e),n):n},Object.defineProperty(q.prototype,"isProAnalyticsPaneEnabled",{get:function(){var e=this.props,t=e.file,n=e.isViewingFileSubpath,i=e.sharedLinkInfo,e=e.user;return void 0!==t&&!n&&!i&&o.isProAnalyticsEnabled(e)},enumerable:!1,configurable:!0}),q);function q(e){var v=K.call(this,e)||this;return v.callToActionType=function(e){return e.sharedLinkInfo?V.SHARED_FILE:e.isVersionHistoryMode?V.VERSION_HISTORY:V.MOUNTED_FILE},v.renderSidebarNotificationsFn=function(){var e=v.props,t=e.sharedLinkInfo,e=e.user;return t||!e||e.is_guest_admin?null:w.default.createElement(u.UserNotificationsDropdown,{onClick:function(){return p.logUserAction(I.UserAction.ClickNotifications,I.UserActionContext.Sidebar)}})},v.registerSidebarPanesFn=function(e){var t=v.props,n=t.brandingInfo,i=t.encryptionOptions,r=t.file,o=t.isViewingFileSubpath,a=t.isVersionHistoryMode,s=void 0!==a&&a,l=t.previewType,c=t.sharedLinkInfo,d=t.sizeClass,u=t.user,p=t.expGrowthActSmbWorkflowsBaton,a=r,t=((t={})[A.SidebarPaneId.Documentation]=w.default.createElement(m.DocumentationPane,{key:"documentation-pane",coreFVUiProps:e,file:a,user:u,brandingInfo:n,sharedLinkInfo:c,maxFilenameEmLength:I.SizeClassFilenameLengthMap[d],isVersionHistoryMode:s,encryptionOptions:i,expGrowthActSmbWorkflowsBaton:p}),t[A.SidebarPaneId.Metadata]=w.default.createElement(f.MetadataPane,{key:"metadata-pane",coreFVUiProps:e,file:a,user:u,sharedLinkInfo:c,previewType:l}),t[A.SidebarPaneId.Activity]=w.default.createElement(h.LoadableActivityPane,{key:"activity-pane",coreFVUiProps:e,file:a,user:u,isVersionHistoryMode:s}),t);return o||(t[A.SidebarPaneId.Comments]=w.default.createElement(g.CommentingPane,{coreFVUiProps:e,encryptionOptions:i,user:u,key:"commenting-pane"})),u&&r&&(v.isProAnalyticsPaneEnabled&&(i=u.is_team?F.Viewer.get_viewer().team_name:void 0,t[A.SidebarPaneId.ProAnalytics]=w.default.createElement(_.ProAnalyticsPane,{coreFVUiProps:e,user:u,fileId:r.file_id,isCollapsed:d===O.SizeClass.Medium,teamName:i})),S.allowWatermarkOrTrial(r,u)&&E.isFileEditable(r)&&(t[A.SidebarPaneId.Watermarking]=w.default.createElement(C.WatermarkingPane,{key:"watermarking-pane",coreFVUiProps:e,file:r,user:u})),y.allowMarkup(r)&&(t[A.SidebarPaneId.Markup]=w.default.createElement(P.MarkupPane,{key:"markup-pane",coreFVUiProps:e,file:r,user:u}))),t},v.handleWatermarkControlClick=function(){v.setState({watermarkControlHasBeenClicked:!0})},v.createRenderSidebarControlsFn=d.memoize(function(h){return function(e){var t,n=[w.default.createElement(k.DocumentationControl,b.__assign({key:"documentation-control"},e))],i=v.props,r=i.docClassification,o=i.docClassificationVariant,a=i.file,s=i.hellosignAppAction,l=i.isHelloSignAppActionInSidebarEnabled,c=i.isHelloSignDeepIntegrationInSidebarEnabled,d=i.isSendForSignatureEnabled,u=i.isVersionHistoryMode,p=i.isViewingFileSubpath,m=i.onHelloSignAppActionLaunch,f=i.onHelloSignDeepIntegrationLaunch,g=i.previewType,i=i.user;p||n.push(w.default.createElement(k.CommentControl,b.__assign({disabled:h[A.FileViewerMode.Commenting],key:"comment-control"},e))),v.isProAnalyticsPaneEnabled&&(p=null!=i&&i.is_team?k.ProAnalyticsTeamUserControl:k.ProAnalyticsIndividualUserControl,n.push(w.default.createElement(p,b.__assign({disabled:h[A.FileViewerMode.ProAnalytics],key:"pro-analytics-control"},e)))),E.isFileEditable(a)&&(S.isWatermarkingEnabled(i)||S.allowWatermarkTrial(i))&&!u&&(t=!S.fileIsWatermarkable(a),n.push(w.default.createElement(k.WatermarkControl,b.__assign({key:"watermarking-control",disabled:t,labelText:S.getWatermarkingLabelText(t,g),onClick:v.handleWatermarkControlClick},e)))),y.userCanMarkup()&&E.isFileEditable(a)&&!u&&(t=!y.fileIsMarkupable(a),n.push(w.default.createElement(k.MarkupControl,b.__assign({key:"markup-control",disabled:t,labelText:y.getMarkupLabelText(t,g)},e))));var _,g=void 0!==a&&L.ML_EXPERIMENT_EXTENSIONS.includes(U.getExtension(a));return o&&L.ML_ENDPOINT_FETCH_TYPES.includes(o)&&r&&r.predicted_types&&0<r.predicted_types.length?_=N.default({"hs-classification-esign":r.predicted_types.includes(L.ML_EXPERIMENT_TYPES.esign)&&o===L.ML_EXPERIMENT_TYPES.esign,"hs-classification-contract":r.predicted_types.includes(L.ML_EXPERIMENT_TYPES.contract)&&o===L.ML_EXPERIMENT_TYPES.contract}):o===L.ML_EXPERIMENT_TYPES.file&&a&&g?["contract","agreement","nda","proposal","offer","form","application","terms"].forEach(function(e){-1!==U.getFilename(a).toLowerCase().indexOf(e)&&(_=N.default({"hs-classification-file":!0}))}):o===L.ML_EXPERIMENT_TYPES.control&&g&&(_=N.default({"hs-classification-control":!0})),c&&d&&a&&T.isHellosignFileByExtension(M.getFileExt(b.__assign(b.__assign({},a),{bytes:0})))?n.push(w.default.createElement(k.HelloSignControl,b.__assign({key:"hellosign-control",onClick:f,className:_},e))):i&&s&&l&&m&&n.push(w.default.createElement(k.HelloSignControl,b.__assign({key:"hellosign-control",className:_,onClick:m},e))),n}}),v.renderSidebarCallToActionsFn=function(e){var t=e.fileViewerUiData.sidebar.visibility,e=v.callToActionType(v.props),n=t===a.SidebarVisibility.Closed||v.props.sizeClass===O.SizeClass.Medium;switch(e){case V.SHARED_FILE:var i=v.props,r=i.sharedLinkInfo,o=i.shareToken,i=i.sharePermission;return D.renderSharedFileActions(v.props.file,v.props.user,v.props.sizeClass,r,o,i,!0,!0,n,v.props.encryptionOptions,v.props.isCapture);case V.MOUNTED_FILE:return D.renderMountedFileActions(v.props.file,v.props.user,v.props.sizeClass,!0,v.props.extensionsEnabled,!0,n);case V.VERSION_HISTORY:return D.renderVersionHistoryActions(v.props.file,v.props.user,!0,!!v.props.canRestoreRevision,v.props.onRestoreRevision||function(){},!0,n)}return[]},v.renderSidebarPASSFn=function(e){e=e.fileViewerUiData.sidebar.visibility;return w.default.createElement(R.AsyncSeenStateFacepileConsumer,{isCollapsed:e===a.SidebarVisibility.Closed})},v.renderSidebarUpsellFn=function(e){var e=e.fileViewerUiData.sidebar.visibility;return v.props.user?w.default.createElement(B.AsyncEsignUpsell,{isCollapsed:e===a.SidebarVisibility.Closed||v.props.sizeClass===O.SizeClass.Medium,file:v.props.file,userId:null===(e=v.props.user)||void 0===e?void 0:e.id,launchHelloSignDeepIntegration:v.props.onHelloSignDeepIntegrationLaunch}):null},v.getPASSProviderProps=function(){var e=v.props,t=e.user,n=e.file,i=e.isVersionHistoryMode,r=e.sizeClass,o=e.sharePermission,a=e.isSeenStatesEnabled,s=e.isViewingFileSubpath,e=e.sharedLinkInfo;return n?{user:void 0===t?null:t,file:n,isVersionHistoryMode:i,sizeClass:r,isViewMetadataDisabled:void 0!==o&&0===o.canViewMetadataRoles.length,isSeenStatesEnabled:a,isViewingFileSubpath:s,sharedLinkInfo:e}:null},v.state={watermarkControlHasBeenClicked:!1},v}t.UnconnectedSidebar=j,t.Sidebar=n.connect(function(e,t){var n=t.file,t=void 0!==n&&U.isBrowseFile(n);return{docClassification:n&&c.getDocClassificationForFile(e,n.file_id),docClassificationVariant:r.getHelloSignMLClassificationVariant(e),disabledModes:c.getDisabledModes(e),extensionsEnabled:x.getExtensionsEnabled(e),fileViewerUiData:{currentMode:c.getMode(e),sidebar:c.getSidebar(e)},isSendForSignatureEnabled:r.isSendForSignatureEnabled(e),hellosignAppAction:n&&c.getHelloSignAppActionForFile(e,n),isHelloSignAppActionInSidebarEnabled:t&&v.isHelloSignAppActionInFileViewerSidebarEnabled(e),isHelloSignDeepIntegrationInSidebarEnabled:t&&v.isHelloSignDeepIntegrationInFileViewerSidebarEnabled(e)}},function(t){return{handleSidebarDispatch:s.createSidebarDispatchHandler(t),changeMode:function(e){return t(l.changeMode(e))},resetSidebarPaneStack:function(){return t(l.resetSidebarPaneStack())}}})(j)}),define("modules/clean/react/file_viewer_sidebar/utils",["require","exports","modules/clean/react/file_viewer/data/actions","file-viewer/core/index"],function(e,t,i,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getSecondFromTopSidebarPaneId=t.isSidebarPaneIdAtTopOfStack=t.isSidebarOpen=t.createSidebarDispatchHandler=void 0;var o=((n={})[r.SidebarControlId.Documentation]=function(e){e(i.changeMode(r.FileViewerMode.Documentation))},n[r.SidebarControlId.Comments]=function(e){e(i.changeMode(r.FileViewerMode.Commenting))},n[r.SidebarControlId.Watermarking]=function(e){e(i.changeMode(r.FileViewerMode.Watermarking))},n[r.SidebarControlId.Zoom]=function(e){e(i.changeMode(r.FileViewerMode.Zoom))},n[r.SidebarControlId.Slack]=function(e){e(i.changeMode(r.FileViewerMode.Slack))},n[r.SidebarControlId.Markup]=function(e){e(i.changeMode(r.FileViewerMode.Markup))},n[r.SidebarControlId.HelloSign]=function(e){e(i.changeMode(r.FileViewerMode.HelloSign))},n[r.SidebarControlId.ProAnalytics]=function(e){e(i.changeMode(r.FileViewerMode.ProAnalytics))},n);t.createSidebarDispatchHandler=function(n){return function(e){if(e.type!==r.Action.SidebarControlClick)return e.type===r.Action.CloseSidebar?n(i.setSidebarVisibility(r.SidebarVisibility.Closed)):e.type===r.Action.OpenSidebar?n(i.setSidebarVisibility(r.SidebarVisibility.Open)):void 0;var t=e.payload.controlId;return(0,o[t])(n,e)}},t.isSidebarOpen=function(e){return e.visibility===r.SidebarVisibility.Open},t.isSidebarPaneIdAtTopOfStack=function(e,t){t=t.paneStack;return 0<t.length&&t[t.length-1]===e},t.getSecondFromTopSidebarPaneId=function(e){e=e.paneStack;return e.length<2?null:e[e.length-2]}}),define("modules/clean/react/file_viewer_sidebar/widgets/seen_states",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/previews/util"],function(n,c,e,d,t,u){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.AsyncSeenStatesProviderWrapper=c.AsyncSeenStateFacepileConsumer=c.AsyncSeenStateFacepileProvider=void 0,d=e.__importDefault(d),c.AsyncSeenStateFacepileProvider=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/pass/seen_state_facepile_controller"],e,t)}).then(e.__importStar).then(function(e){return e.SeenStateFacepileProvider})}}),c.AsyncSeenStateFacepileConsumer=t.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/pass/seen_state_facepile_consumer"],e,t)}).then(e.__importStar).then(function(e){return e.SeenStateFacepileConsumer})}}),c.AsyncSeenStatesProviderWrapper=function(e){var t=e.children,n=e.file,i=e.isSeenStatesEnabled,r=e.isVersionHistoryMode,o=e.isViewingFileSubpath,a=e.isViewMetadataDisabled,s=e.sharedLinkInfo,l=e.sizeClass,e=e.user;return!i||r||null===n.ns_id||u.isCloudDocPreview(n)?d.default.createElement(d.default.Fragment,null,t):d.default.createElement(c.AsyncSeenStateFacepileProvider,{file:n,isViewMetadataDisabled:a,isViewingFileSubpath:!!o,sharedLinkInfo:s,sizeClass:l,user:e},t)}}),define("modules/clean/react/file_viewer_titlebar/edit_mode_titlebar",["require","exports","tslib","react","classnames","file-viewer/titlebar/index","modules/clean/file_store/utils","modules/clean/em_string","modules/clean/react/file_viewer/feedback_form/feedback_form_modal","spectrum/button/index","modules/core/i18n","modules/clean/react/workflows/markup/api","file-viewer/core/index","modules/clean/react/size_class/constants","modules/constants/file_viewer"],function(e,t,n,i,r,o,a,s,l,c,d,u,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditModeTitlebar=void 0,i=n.__importDefault(i),r=n.__importDefault(r);var g,n=(g=i.default.PureComponent,n.__extends(_,g),_.prototype.render=function(){var e=f.FILE_MARKUP_FEEDBACK_FORM&&this.props.mode===p.FileViewerMode.Markup&&this.props.sizeClass!==m.SizeClass.Small;return i.default.createElement("div",{className:"files2-title-bar"},i.default.createElement(o.LargeTitlebar,{className:r.default("title"),title:i.default.createElement(i.default.Fragment,null,e&&i.default.createElement(c.Button,{className:"files2-title-bar__feedback-button",size:"large",variant:"primary",onClick:this.openFeedbackModal},d.intl.formatMessage({id:"yNdnfh",defaultMessage:"Feedback"})),i.default.createElement("h1",{className:r.default("filename")},i.default.createElement("div",{className:"filename--text"},i.default.createElement("span",{className:"filename--prefix"},this.props.title+": "),s.Emstring.em_snippet(a.getFilename(this.props.file),this.props.maxFilenameEmLength),this.props.beta?i.default.createElement("span",{className:"filename--beta-tag"},"beta"):null),this.renderFeedbackFormModal()))}))},_);function _(e){var n=g.call(this,e)||this;return n.openFeedbackModal=function(){n.setState({isFeedbackModalOpen:!0})},n.closeFeedbackModal=function(){n.setState({isFeedbackModalOpen:!1})},n.renderFeedbackFormModal=function(){if(n.props.mode!==p.FileViewerMode.Markup)return null;var e=d.intl.formatMessage({id:"eWxZ5f",defaultMessage:"How satisfied are you with Dropbox Markup?"}),t=d.intl.formatMessage({id:"Oi1tCv",defaultMessage:"Tell us what you liked and didnâ€™t like about Dropbox Markup."});return i.default.createElement(l.FeedbackFormModal,{user:n.props.user,title:e,commentPrompt:t,open:n.state.isFeedbackModalOpen,onRequestClose:n.closeFeedbackModal,submitFeedback:u.submitMarkupFeedback})},n.state={isFeedbackModalOpen:!1},n}t.EditModeTitlebar=n}),define("modules/clean/react/file_viewer_titlebar/loadable_icon",["require","exports","tslib","react","modules/clean/react/async/loadable"],function(n,e,t,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoadableTitleIcon=void 0,i=t.__importDefault(i),e.LoadableTitleIcon=r.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/title_bar/title_bar_title"],e,t)}).then(t.__importStar).then(function(e){return e.TitleBarTitle})},loading:i.default.createElement("div",{className:"react-title-icon"})}),e.LoadableTitleIcon.displayName="LoadableTitleIcon"}),define("modules/clean/react/file_viewer_titlebar/loadable_title",["require","exports","tslib","react","modules/clean/react/async/loadable"],function(n,e,t,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoadableTitle=void 0,i=t.__importDefault(i),e.LoadableTitle=r.Loadable({loader:function(){return new Promise(function(e,t){n(["modules/clean/react/file_viewer/title_name"],e,t)}).then(t.__importStar).then(function(e){return e.TitleName})},loading:i.default.createElement("div",{className:"react-title-name"})})}),define("modules/clean/react/file_viewer_titlebar/titlebar",["require","exports","tslib","file-viewer/titlebar/index","modules/clean/file_store/utils","modules/clean/react/file_viewer/title_utils","modules/clean/react/file_viewer_titlebar/loadable_icon","modules/clean/react/file_viewer_titlebar/loadable_title","modules/clean/react/size_class/constants","react","spectrum/file_icon/index","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/size_class","classnames"],function(e,t,n,i,r,o,a,s,l,c,d,u,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileTitleBar=t.Titlebar=void 0,c=n.__importDefault(c),f=n.__importDefault(f);var g,_=(g=c.default.PureComponent,n.__extends(h,g),h.prototype.render=function(){return c.default.createElement("div",{className:"files2-title-bar"},c.default.createElement(i.LargeTitlebar,n.__assign({className:f.default("title",{isSidebarOpen:this.props.isSidebarOpen}),title:c.default.createElement(s.LoadableTitle,{file:this.props.file,fileSubpath:this.props.fileSubpath,hidePageChrome:this.props.hidePageChrome,isViewingFileSubpath:this.props.isViewingFileSubpath,maxFilenameEmLength:this.props.maxFilenameEmLength,sharedLinkInfo:this.props.sharedLinkInfo,sizeClass:this.props.sizeClass,user:this.props.user}),icon:this.props.hideIcon?null:c.default.createElement(a.LoadableTitleIcon,{closeTitle:o.closeButtonTitle({file:this.props.file,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,sharedLinkInfo:this.props.sharedLinkInfo,isVersionHistoryMode:this.props.isVersionHistoryMode}),canClose:this.props.canClose,closeUrl:this.props.closeUrl,file:this.props.file,isSendForSignatureMode:!1,isSigningMode:!1,onClose:this.props.onClose,shouldShowIcon:!this.props.isViewingFileSubpath,sizeClass:this.props.sizeClass,overrideIcon:this.overrideIcon})},{renderTitleOverflowMenuFn:this.props.sizeClass===l.SizeClass.Small?this.props.renderTitlebarOverflowMenuFn:void 0})))},h);function h(){var e=null!==g&&g.apply(this,arguments)||this;return e.overrideIcon=e.props.hidePageChrome?c.default.createElement("div",{className:"file-icon"},c.default.createElement(d.FileIcon,{path:r.getFilename(e.props.file)})):null,e}t.Titlebar=_,t.FileTitleBar=m.withSizeClass(_,{isResponsiveEnabled:u.isResponsiveEnabled,responsiveClassName:p.ResponsiveClassName})}),define("modules/clean/react/file_viewer_sidebar/panes/pro_analytics_pane",["require","exports","tslib","react","file-viewer/modes/index","file-viewer/core/index","pro-ui/components/sidebar_pane/analytics_pane/index","pro-ui/data/amp-logger","react-redux","modules/clean/pro_analytics/data/store","modules/core/i18n","react-intl","modules/clean/metrics/index","modules/core/user_i18n","modules/clean/pro_analytics/data/util","modules/clean/react/pass/utils","modules/core/browser"],function(e,t,o,a,s,l,c,d,u,p,m,f,g,_,h,v,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProAnalyticsPane=void 0,a=o.__importDefault(a),_=o.__importStar(_),t.ProAnalyticsPane=function(e){var t=e.coreFVUiProps,n=e.user,i=e.fileId,r=e.isCollapsed,e=e.teamName,e={fileId:i,getUserInitials:function(e,t){return v.AnonymousViewerUtils.isAnonymousUserId(e)?v.AnonymousViewerUtils.getAnonymousViewerInitials(t):_.getInitials(t)},collapsed:r,displayStreamItemLocations:h.isProAnalyticsExperimentalEnabled(n),openTab:b.open_tab,teamName:e};return d.AmpLogger.conditionallySetSingleton(function(){return g.getMetricsReporter()}),a.default.createElement(u.Provider,{store:p.getProAnalyticsStore(n)},a.default.createElement(f.RawIntlProvider,{value:m.intl},a.default.createElement(s.Pane,o.__assign({paneId:l.SidebarPaneId.ProAnalytics},t),a.default.createElement(c.AnalyticsComponentPicker,o.__assign({},e)))))}}),define("modules/clean/react/pass/store",["require","exports","tslib","lodash","modules/clean/flux/base_store","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/core/exception"],function(e,t,f,l,n,d,u,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.passStore=t.PassStore=void 0,l=f.__importStar(l),o=f.__importStar(o);var i,r=(s.prototype.addUniqueUser=function(e,t){e in this.userIdToUniqueIds||(this.userIdToUniqueIds[e]={}),this.userIdToUniqueIds[e][t]=!0},s.prototype.removeUniqueUser=function(e,t){e in this.userIdToUniqueIds&&t in this.userIdToUniqueIds[e]&&(delete this.userIdToUniqueIds[e][t],Object.keys(this.userIdToUniqueIds[e]).length||delete this.userIdToUniqueIds[e])},s.prototype.getOnlineUserIds=function(){return Object.keys(this.userIdToUniqueIds)},s),n=(i=n.Store,f.__extends(a,i),a.prototype.presence=function(e){return e in this.presenceInfos?this.presenceInfos[e].getOnlineUserIds():null},a.prototype.seenStateInfo=function(e){return this.seenStateInfos[e]||null},a.prototype.identifiedSeenStateInfo=function(e){return e in this.seenStateInfos?{seen_states:l.reject(this.seenStateInfos[e].seen_states,u.AnonymousViewerUtils.isAnonymousSeenState)}:null},a.prototype.seenStateCursorHasNext=function(e){return e in this.seenStateCursors?this.seenStateCursors[e].has_next:null},a.prototype.seenStateCursorState=function(e){return e in this.seenStateCursors?this.seenStateCursors[e].cursor_state:null},a.prototype.passFetchingStatus=function(e){return this.passFetchingStatusMap[e]||d.PassFetchingStatus.NOT_YET_KNOWN},a.prototype.getLinkAndGroupSeenStateInfo=function(e){var t=null,n=null;if(!this.seenStateInfos[e])return{linkSeenStateInfo:t,groupSeenStateInfo:n};for(var t=[],n={},i=0,r=this.seenStateInfos[e].seen_states;i<r.length;i++){var o=r[i];if(!u.AnonymousViewerUtils.isAnonymousSeenState(o)){var a=o.seen_state_user.sharing_access_type;if(a)switch(a.type){case"link_only":case"view_link_access":case"edit_link_access":t.push(o);break;case"view_member_access":case"edit_member_access":for(var s=0,l=a.value.group_ids;s<l.length;s++){var c=l[s];c in n||(n[c]=[]),n[c].push(o)}}}}return{linkSeenStateInfo:t,groupSeenStateInfo:n}},a.prototype.anonymousPresence=function(e){return e in this.presenceInfos?u.AnonymousViewerUtils.getAnonymousUserIds(this.presenceInfos[e].getOnlineUserIds()):null},a.prototype.userIdsWithoutSeenStateInfo=function(e){return this.userIdsWithoutSeenStateInfoMap[e]||[]},a.prototype.userIdsWithoutTeamInteractionInfo=function(e){return this.userIdsWithoutTeamInteractionInfoMap[e]||[]},a.prototype.userTeamInteractionInfo=function(e){return this.userTeamInteractionInfoMap[e]||{}},a.prototype.isPassPermissionsPending=function(e){e=this.passPermissions[e];return null!=e&&!(e.hasOwnProperty("canReadPresence")&&e.hasOwnProperty("canReadSeenState")&&e.hasOwnProperty("canWritePresence"))},a.prototype.getPassPermissions=function(e){if(!e)return null;var t=this.passPermissions[e];return null==t||this.isPassPermissionsPending(e)?null:t},a.prototype.resetPassInfo=function(e){delete this.seenStateInfos[e],delete this.seenStateCursors[e],delete this.presenceInfos[e],delete this.passFetchingStatusMap[e],delete this.passPermissions[e],delete this.userIdsWithoutSeenStateInfoMap[e],this.emit_change()},a.prototype.setPassPermissionRequest=function(e){this.passPermissions[e]={},this.setPassFetchingStatus(e,d.PassFetchingStatus.FETCHING)},a.prototype.updatePermissions=function(e,t){this.passPermissions.hasOwnProperty(e)&&(this.passPermissions[e]=f.__assign(f.__assign({},this.passPermissions[e]),t),this.emit_change())},a.prototype.markPassConcludedIfNecessary=function(e){var t=this.passPermissions[e];t&&t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState")&&!t.canReadPresence&&!t.canReadSeenState&&(this.resetPassInfo(e),this.setPassFetchingStatus(e,d.PassFetchingStatus.CONCLUDED),this.updateSeenStateInfoWithEmptyData(e))},a.prototype.receivePresenceDelta=function(e,t,n,i){o.assert(-1===[d.PassFetchingStatus.FETCHING,d.PassFetchingStatus.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t)),"Before handling a presence delta, you must call assurePresenceSuccessRegistered");var r=this.getOnlineUsersForFileId(t);this.updatePresenceInfos(t,n,i),this.updateUserIdsWithoutSeenStateInfo(e,t,r),this.emit_change()},a.prototype.receivePresenceSnapshot=function(e,t,n){o.assert(-1===[d.PassFetchingStatus.FETCHING,d.PassFetchingStatus.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t)),"Before handling a presence delta, you must call assurePresenceSuccessRegistered");var i=this.getOnlineUsersForFileId(t);this.presenceInfos[t]=new r,this.updatePresenceInfos(t,n,{}),this.updateUserIdsWithoutSeenStateInfo(e,t,i),this.emit_change()},a.prototype.getOnlineUsersForFileId=function(e){return e in this.presenceInfos||(this.presenceInfos[e]=new r),this.presenceInfos[e].getOnlineUserIds()},a.prototype.updatePresenceInfos=function(e,t,n){for(var i=0,r=Object.keys(n);i<r.length;i++)for(var o=r[i],a=0,s=Object.keys(n[o]);a<s.length;a++){var l=s[a];this.presenceInfos[e].removeUniqueUser(o,l)}for(var c=0,d=Object.keys(t);c<d.length;c++)for(var u=d[c],p=0,m=Object.keys(t[u]);p<m.length;p++)l=m[p],this.presenceInfos[e].addUniqueUser(u,l)},a.prototype.updateUserIdsWithoutSeenStateInfo=function(e,t,n){var i,r=u.AnonymousViewerUtils.filterAnonymousUserIds(this.getOnlineUsersForFileId(t)),o=u.AnonymousViewerUtils.filterAnonymousUserIds(n),a=l.difference(o,r),s=l.difference(r,o);t in this.seenStateInfos?(n=void 0,o=this.passFetchingStatus(t),-1!==[d.PassFetchingStatus.SEEN_STATE_DISALLOWED,d.PassFetchingStatus.PASS_MIXED_SUCCESS].indexOf(o)?(i=(o=this.createMinimalBaseSeenStateInfo(t,r)).userIdsWithoutSeenStateInfo,n=o.baseSeenStateInfo,this.updateSeenStateInfo(t,n)):(i=(s=this.makeSeenStateAgreeWithUpdatedPresence(t,r,a,s)).userIdsWithoutSeenStateInfo,n=s.baseSeenStateInfo)):i=[],this.userIdsWithoutSeenStateInfoMap[t]=i},a.prototype.makeSeenStateAgreeWithUpdatedPresence=function(e,t,n,i){for(var r=[],o=this.seenStateInfos[e],e=o.seen_states,a=[],s=[],l=[],c=Date.now()/1e3,d=0,u=e;d<u.length;d++){var p=u[d],m=p.seen_state_user.user_id;m&&(r.push(m),i.includes(m)?(p.when_last_seen=c,p.seen_events=p.seen_events||[],s.push(p)):n.includes(m)?(p.when_last_seen=c,p.seen_events=p.seen_events||[],p.seen_events.push({ts:c}),l.push(p)):a.push(p))}return o.seen_states=f.__spreadArrays(s,l,a),{userIdsWithoutSeenStateInfo:t.filter(function(e){return!r.includes(e)}),baseSeenStateInfo:o}},a.prototype.createMinimalBaseSeenStateInfo=function(e,t){for(var n=[],i=[],r=0,o=this.seenStateInfos[e].seen_states;r<o.length;r++){var a=o[r],s=a.seen_state_user.user_id;s&&t.includes(s)&&(n.push(a),i.push(s))}return{userIdsWithoutSeenStateInfo:l.difference(t,i),baseSeenStateInfo:{seen_states:n}}},a.prototype.updateSeenStateInfo=function(e,t,n){void 0===n&&(n=!1),o.assert(-1===[null,d.PassFetchingStatus.FETCHING].indexOf(this.passFetchingStatus(e)),"Before updating seen state info, you must call assureSeenStateSuccessRegistered or onFetchSeenStateDisabled"),n&&e in this.seenStateInfos?this.seenStateInfos[e].seen_states=this.seenStateInfos[e].seen_states.concat(t.seen_states):this.seenStateInfos[e]=t,this.userIdsWithoutTeamInteractionInfoMap[e]=this.userIdsWithoutSeenStateInfoMap[e],this.userIdsWithoutSeenStateInfoMap[e]=[],this.emit_change()},a.prototype.updateSeenStateInfoWithEmptyData=function(e){this.updateSeenStateInfo(e,{seen_states:[]})},a.prototype.setPassFetchingStatus=function(e,t){this.passFetchingStatusMap[e]=t,this.emit_change()},a.prototype.updateSeenStateCursor=function(e,t){t&&(this.seenStateCursors[e]=t,this.emit_change())},a.prototype.assureSeenStateSuccessRegistered=function(e){switch(this.passFetchingStatus(e)){case d.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,d.PassFetchingStatus.SEEN_STATE_SUCCESS);break;case d.PassFetchingStatus.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,d.PassFetchingStatus.PASS_SUCCESS);break;case d.PassFetchingStatus.SEEN_STATE_DISALLOWED:o.reportStack("Debugging FETCHING_STATUS: pass fetching status is seen state disallowed",{severity:o.SEVERITY.NONCRITICAL,tags:["pass:fetch_seen_state_disallowed"],exc_extra:{storeHasPresence:e in this.presenceInfos,storeHasSeenState:e in this.seenStateInfos,passPermissions:JSON.stringify(this.passPermissions[e]),fetchingStatus:this.passFetchingStatusMap[e]}});break;case d.PassFetchingStatus.NOT_YET_KNOWN:o.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:o.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}},a.prototype.onFetchSeenStateDisabled=function(e){switch(this.passFetchingStatus(e)){case d.PassFetchingStatus.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,d.PassFetchingStatus.PASS_MIXED_SUCCESS);break;case d.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,d.PassFetchingStatus.SEEN_STATE_DISALLOWED);break;case d.PassFetchingStatus.NOT_YET_KNOWN:o.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:o.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}},a.prototype.assurePresenceSuccessRegistered=function(e){switch(this.passFetchingStatus(e)){case d.PassFetchingStatus.SEEN_STATE_SUCCESS:this.setPassFetchingStatus(e,d.PassFetchingStatus.PASS_SUCCESS);break;case d.PassFetchingStatus.SEEN_STATE_DISALLOWED:this.setPassFetchingStatus(e,d.PassFetchingStatus.PASS_MIXED_SUCCESS);break;case d.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,d.PassFetchingStatus.PRESENCE_SUCCESS);break;case d.PassFetchingStatus.NOT_YET_KNOWN:o.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:o.SEVERITY.CRITICAL,tags:["pass:fetch_presence_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}},a.prototype.updateUserTeamInteractionInfo=function(e,t){if(e in t)for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];this.userTeamInteractionInfoMap[e][r]=t[r]}else this.userTeamInteractionInfoMap[e]=t;this.userIdsWithoutTeamInteractionInfoMap[e]=[],this.emit_change()},a.prototype._new_payload=function(e){var t=e.action,e=t.type,t=t.data;if(t){var n=t.userId,i=t.fileId,r=(t.teamId,t.seenStateInfo),o=t.seenStateCursor,a=t.onlineUniqueUsers,s=t.offlineUniqueUsers,l=t.partialPermission,c=t.userTeamInteractionInfo;t.userTeamInteractionUserIds;switch(e){case d.ActionTypes.FETCH_PASS_ERROR:this.setPassFetchingStatus(i,d.PassFetchingStatus.ERROR);break;case d.ActionTypes.FETCH_PASS_CONCLUDED:this.setPassFetchingStatus(i,d.PassFetchingStatus.CONCLUDED),this.updateSeenStateInfoWithEmptyData(i);break;case d.ActionTypes.PASS_PERMISSION_REQUEST:this.setPassPermissionRequest(i);break;case d.ActionTypes.RECEIVE_PRESENCE_DELTA:this.assurePresenceSuccessRegistered(i),this.receivePresenceDelta(n,i,a,s);break;case d.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT:this.assurePresenceSuccessRegistered(i),this.receivePresenceSnapshot(n,i,a);break;case d.ActionTypes.RESET_PASS_INFO:this.resetPassInfo(i);break;case d.ActionTypes.UPDATE_PERMISSIONS:this.updatePermissions(i,l),this.markPassConcludedIfNecessary(i);break;case d.ActionTypes.DISCONTINUE_SEEN_STATE_INFO:this.updateSeenStateCursor(i,o={cursor_state:"",has_next:!1});break;case d.ActionTypes.UPDATE_SEEN_STATE_INFO:this.assureSeenStateSuccessRegistered(i),this.updateSeenStateInfo(i,r),this.updateSeenStateCursor(i,o);break;case d.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE:this.assureSeenStateSuccessRegistered(i),this.updateSeenStateInfo(i,r,!0),this.updateSeenStateCursor(i,o);break;case d.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE:this.onFetchSeenStateDisabled(i),this.updateSeenStateInfoWithEmptyData(i),this.updateUserIdsWithoutSeenStateInfo(n,i,[]);break;case d.ActionTypes.UPDATE_USER_TEAM_INTERACTION_INFO:this.updateUserTeamInteractionInfo(i,c)}}},a);function a(e){e=i.call(this,e)||this;return e.seenStateInfos={},e.seenStateCursors={},e.presenceInfos={},e.passFetchingStatusMap={},e.userIdsWithoutSeenStateInfoMap={},e.userIdsWithoutTeamInteractionInfoMap={},e.userTeamInteractionInfoMap={},e.passPermissions={},e}function s(){this.userIdToUniqueIds={}}t.PassStore=n,t.passStore=new n}),define("modules/clean/pro_analytics/data/util",["require","exports","modules/constants/file_viewer"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isProAnalyticsExperimentalEnabled=t.isProAnalyticsEnabled=void 0,t.isProAnalyticsEnabled=function(e){return Boolean(e&&n.SMART_LINKS_ANALYTICS_BY_USER_ID[e.id])},t.isProAnalyticsExperimentalEnabled=function(e){return!1}}),define("modules/clean/auth/login_or_register/types",["require","exports"],function(e,t){"use strict";var n,i,r,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.Mode=t.LoginOrRegisterKind=t.DownloadAction=t.CommentTextVariant=void 0,(a=o=o||{}).COMMENT="comment",a.DOWNLOAD="download",a.IMMEDIATE="immediate",a.SIDEBAR="sidebar",a.POSTDOWNLOAD="postdownload",t.LoginOrRegisterKind=o,(o=r=r||{}).DIRECT_DOWNLOAD="direct_download",o.SAVE_TO_DROPBOX="add_to_dropbox",t.DownloadAction=r,(r=i=i||{})[r.LOGIN=0]="LOGIN",r[r.REGISTER=1]="REGISTER",t.Mode=i,(i=n=n||{}).DEFAULT="",i.POST="post_comment_variant",i.SUBSCRIBE="subscribe_variant",t.CommentTextVariant=n}),define("modules/clean/react/file_viewer/conversions/conversion_utils",["require","exports","modules/constants/file_viewer"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldShowSplitSignup=t.shouldShowSuggestedTextComments=t.shouldShowSimplifiedModal=t.shouldShowSignupButton=t.shouldOpenModalFromSidebar=t.variantIsGAed=t.ConversionExperimentVariant=void 0,t.ConversionExperimentVariant=function(){return n.PREVIEWS_CONVERSION_EXPERIMENTS},t.variantIsGAed=function(){return"ON"===n.PREVIEWS_CONVERSION_GA||"M1"===n.PREVIEWS_CONVERSION_GA},t.shouldOpenModalFromSidebar=t.variantIsGAed,t.shouldShowSignupButton=t.variantIsGAed,t.shouldShowSimplifiedModal=function(){return"SIMPLIFIED_MODAL"===t.ConversionExperimentVariant()||"SPLIT_SIGNUP"===t.ConversionExperimentVariant()||t.variantIsGAed()},t.shouldShowSuggestedTextComments=function(){return"SUGGESTED_COMMENTS_TEXT"===t.ConversionExperimentVariant()||"M1"===n.PREVIEWS_CONVERSION_GA},t.shouldShowSplitSignup=function(){return"SPLIT_SIGNUP"===t.ConversionExperimentVariant()}}),define("modules/clean/react/keyboard_binding/keyboard_binding",["require","exports","tslib","lodash","ts-keycode-enum"],function(e,t,n,i,r){"use strict";var o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.withPreventDefault=t.isKeyboardEvent=t.getPrintKeyBindings=t.getMinusKeyBindings=t.getEqualsKeyBindings=t.addLegacyPropertiesToSimpleKeyboardEvent=t.getSimpleKeyboardEvent=t.getKeyboardEventCriteria=t.hydrateKeyboardBinding=t.generateUnmodifiedSimpleKeyboardEvent=t.generateUnmodifiedKeyboardEventCriteria=t.KeyboardEventCriteriaKeys=t.SimpleKeyboardEventKeys=t.genericKeyboardEventCriteria=t.ExtraKeyCodes=void 0,i=n.__importStar(i),(a=o=t.ExtraKeyCodes||(t.ExtraKeyCodes={}))[a.EQUALS=61]="EQUALS",a[a.PLUS_EQUALS_FF=107]="PLUS_EQUALS_FF",a[a.PLUS_EQUALS_FF_GERMAN=171]="PLUS_EQUALS_FF_GERMAN",a[a.MINUS_FF_MAC=173]="MINUS_FF_MAC",a[a.MINUS_FF=109]="MINUS_FF";var s={altKey:!(t.genericKeyboardEventCriteria={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0}),ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};t.SimpleKeyboardEventKeys=Object.keys(s),t.KeyboardEventCriteriaKeys=Object.keys(t.genericKeyboardEventCriteria),t.generateUnmodifiedKeyboardEventCriteria=function(e){return n.__assign(n.__assign({},t.genericKeyboardEventCriteria),{which:e})},t.generateUnmodifiedSimpleKeyboardEvent=function(e){return n.__assign(n.__assign({},s),{which:e})};function l(){}function c(e){return{keyboardEventCriteria:n.__assign(n.__assign({},t.genericKeyboardEventCriteria),e.keyboardEventCriteria),callback:null!=e.callback?e.callback:l}}function d(e){return i.flatten(e.map(function(e){return[((n={which:t=e})[e="shiftKey"]=!0,n),((t={which:t})[e]=!1,t)];var t,n}))}function u(e,t){return e.map(function(e){return c({keyboardEventCriteria:e,callback:t})})}t.hydrateKeyboardBinding=c,t.getKeyboardEventCriteria=function(e){return{altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,metaKey:!!e.metaKey,shiftKey:!!e.shiftKey,which:e.which||e.keyCode}},t.getSimpleKeyboardEvent=function(e){return{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,which:e.which||e.keyCode}},t.addLegacyPropertiesToSimpleKeyboardEvent=function(e){return n.__assign(n.__assign({},e),{keyCode:null!=e.keyCode?e.keyCode:e.which})};var p=d([o.EQUALS,o.PLUS_EQUALS_FF,r.Key.PlusSign,o.PLUS_EQUALS_FF_GERMAN]),m=d([r.Key.Dash,o.MINUS_FF_MAC,o.MINUS_FF]),f=[{which:r.Key.P},{which:r.Key.P,ctrlKey:!0},{which:r.Key.P,metaKey:!0}];function g(e){return void 0!==e.preventDefault}t.getEqualsKeyBindings=function(e){return u(p,e)},t.getMinusKeyBindings=function(e){return u(m,e)},t.getPrintKeyBindings=function(e){return u(f,e)},t.isKeyboardEvent=g,t.withPreventDefault=function(t){return function(e){t(),e&&g(e)&&e.preventDefault()}}}),define("modules/clean/react/keyboard_binding/keyboard_binding_connector",["require","exports","tslib","react","modules/clean/react/keyboard_binding/keyboard_binding_provider"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardBindingConnector=void 0;var o,r=(o=(i=n.__importDefault(i)).default.Component,n.__extends(a,o),a.prototype.componentDidMount=function(){this.registrationIdentifier=this.context.registerKeyBindings(this.props.keyboardBindings),this.context.registerAllKeyCallback(this.registrationIdentifier,this.props.allKeyCallback)},a.prototype.componentWillReceiveProps=function(e){this.props.keyboardBindings!==e.keyboardBindings&&this.context.updateKeyBindings(this.registrationIdentifier,e.keyboardBindings),this.props.allKeyCallback!==e.allKeyCallback&&this.context.registerAllKeyCallback(this.registrationIdentifier,e.allKeyCallback)},a.prototype.componentWillUnmount=function(){this.context.unregisterKeyBindings(this.registrationIdentifier)},a.prototype.render=function(){return null},a.contextTypes=r.KeyboardBindingProviderContextTypes,a);function a(e,t){e=o.call(this,e,t)||this;if(!t.registerKeyBindings||!t.unregisterKeyBindings)throw new Error("KeyboardBindingConnector must be a child of a KeyboardBindingProvider");return e}t.KeyboardBindingConnector=r}),define("modules/clean/react/keyboard_binding/keyboard_binding_provider",["require","exports","tslib","react","prop-types","modules/clean/callback_chain/callback_chain","ts-keycode-enum","modules/clean/react/keyboard_binding/keyboard_binding"],function(e,i,t,n,r,o,a,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.simulateKeyEvent=i.generateKeyboardBindingsByCriteriaFromKeyboardBindings=i.getIndexForkeyboardBindingsByCriteria=i.KeyboardBindingProvider=i.noop=i.KeyboardBindingProviderContextTypes=void 0,n=t.__importDefault(n),r=t.__importDefault(r),i.KeyboardBindingProviderContextTypes={registerAllKeyCallback:r.default.func,registerKeyBindings:r.default.func,unregisterKeyBindings:r.default.func,updateKeyBindings:r.default.func};var l=[];i.noop=function(e){};var c,t=(c=n.default.Component,t.__extends(d,c),d.prototype.componentDidMount=function(){document.addEventListener("keydown",this.onKeyDown),this.providerIdentifier=l.length,l.push(this.onKeyDown),this.props.onSetup&&this.props.onSetup()},d.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.onKeyDown),l[this.providerIdentifier]=i.noop,this.props.onDestroy&&this.props.onDestroy()},d.prototype.getChildContext=function(){return{registerAllKeyCallback:this.registerAllKeyCallback,registerKeyBindings:this.registerKeyBindings,unregisterKeyBindings:this.unregisterKeyBindings,updateKeyBindings:this.updateKeyBindings}},d.prototype.getCallbacksForKey=function(e){e=u(e);return(this.keyboardBindingsByCriteria[e]||[]).concat(this.allKeyHandlers)},d.prototype.render=function(){return n.default.Children.only(this.props.children)},d.childContextTypes=i.KeyboardBindingProviderContextTypes,d);function d(e){var n=c.call(this,e)||this;return n.registrationIdentifier=0,n.registeredBindings=[],n.keyboardBindingsByCriteria={},n.allKeyHandlers=[],n.registerKeyBindings=function(e){var t=n.registrationIdentifier++;return n.updateKeyBindings(t,e),n.allKeyHandlers[t]||(n.allKeyHandlers[t]=i.noop),t},n.registerAllKeyCallback=function(e,t){n.allKeyHandlers[e]=null!=t?t:i.noop},n.unregisterKeyBindings=function(e){n.updateKeyBindings(e,[]),n.allKeyHandlers[e]=i.noop},n.updateKeyBindings=function(e,t){n.registeredBindings[e]=null!=t?t:[],n.keyboardBindingsByCriteria=p(n.registeredBindings)},n.onKeyDown=function(r){var e;!r||s.isKeyboardEvent(r)&&!function(){var e=r.target||r.srcElement;if(!e)return 1;var t=e.tagName,n=r.which,i="INPUT"===t||"SELECT"===t||"TEXTAREA"===t,t=-1!==["submit","button"].indexOf(e.type),e=e.hasAttribute&&e.hasAttribute("contenteditable")&&"false"!==e.getAttribute("contenteditable").toLowerCase();return!(i&&!t||e)||(n===a.Key.Escape||n===a.Key.Tab)}()||(e=n.getCallbacksForKey(r),new o.CallbackChain(e).run(r))},n.allKeyHandlers=[],n.registeredBindings=[],n}function u(e){var t=s.getKeyboardEventCriteria(e),n="";return s.KeyboardEventCriteriaKeys.forEach(function(e){n+=e+":"+t[e]+","}),n}function p(e){return e.reduce(function(e,t){return t.reduce(function(e,t){var n=t.keyboardEventCriteria,t=t.callback,n=u(n);return e[n]=e[n]||[],e[n].push(t),e},e)},{})}i.KeyboardBindingProvider=t,i.getIndexForkeyboardBindingsByCriteria=u,i.generateKeyboardBindingsByCriteriaFromKeyboardBindings=p,i.simulateKeyEvent=function(e){e=s.addLegacyPropertiesToSimpleKeyboardEvent(e);new o.CallbackChain(l).run(e)}}),define("modules/clean/react/previews/video/audio_waveform/utils",["require","exports","modules/clean/average_counter"],function(e,t,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.returnWaveform=t.buildFromBuffer=void 0,t.buildFromBuffer=function(e,d,u,p,m){var f=e.getChannelData(0),g=new Array(d);setTimeout(function l(c){return function(){if(d<=c)m(g);else{var e=[],t=Math.ceil(c*f.length/d),n=Math.ceil((c+1)*f.length/d),i=n-t;if(u<i)for(var r=0;r<u;r++){var o=Math.floor(Math.random()*i)+t;e.push(Math.abs(f[o]))}else for(r=t;r<n;r++){var a=Math.floor(Math.abs(f[r]));e.push(a)}var s=new _.AverageCounter;s.addArray(e),g[c]=s.getAverage(),p()&&setTimeout(l(c+1),0)}}}(0),0)},t.returnWaveform=function(e,t,n){void 0===n&&(n=1);var i=[];if(0===e.length||t<=0||isNaN(t))return i;for(var r=[],o=0;o<t;o++)r.push(new _.AverageCounter);for(var a=0,s=0,o=0;o<e.length;o++){var l=e[o],c=Math.floor(o*t/e.length),d=r[c];d.add(l),i[c]=d.getAverage(),c!==s&&(a=Math.max(a,i[s]),s=c)}return a=Math.max(a,i[t-1]),i.map(function(e){return e*n/a})}}),define("modules/clean/react/file_sidebar/managed_comments_tab",["require","exports","tslib","react","react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/components/comments_tab","modules/clean/file_store/utils"],function(e,n,t,i,r,o,a,s,l){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ManagedCommentsTab=n.streamFromProps=void 0,i=t.__importDefault(i),n.streamFromProps=function(e){var t=e.currentFile,n=e.currentFile,i=n.bytes,r=n.file_id,o=n.ns_id,a=n.sjid,s=e.sharedLinkInfo,n=e.isVersionHistoryMode,e=e.reelId;return{id:r,linkUrl:s&&s.url,ns_id:o,sjid:a,type:"file",fq_path:"fq_path"in t?t.fq_path:void 0,isVersionHistoryMode:n,bytes:i,filename:l.getFilename(t),reel_id:e}};var c,d=(c=i.default.Component,t.__extends(u,c),u.prototype.componentDidMount=function(){this.setContext(this.props)},u.prototype.componentWillUpdate=function(e){this.setContext(e)},u.prototype.render=function(){return this.store?i.default.createElement(r.Provider,{store:this.store},i.default.createElement(s.CommentsTab,t.__assign({},this.props))):null},u);function u(e){var t=c.call(this,e)||this;return t.setContext=function(e){t.store.dispatch(o.Actions.setFileContext({stream:n.streamFromProps(e),viewer:e.user}))},t.store=a.getStoreForComments2(),t}n.ManagedCommentsTab=d}),define("modules/clean/react/comments2/data/sidebar_watcher",["require","exports","tslib","eventemitter3"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMMENTS_HIDDEN_SIGNAL=t.COMMENTS_VISIBLE_SIGNAL=t.sideChannelEventEmitter=void 0,i=n.__importDefault(i),t.sideChannelEventEmitter=new i.default,t.COMMENTS_VISIBLE_SIGNAL="comments_visible",t.COMMENTS_HIDDEN_SIGNAL="comments_hidden"}),define("file-transfers/common/constants",["require","exports","file-transfers/common/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FEEDBACK_FORM_MAX_COMMENT_LENGTH=t.S3_STATIC_URL=t.DEFAULT_MAX_UNEXPIRED_DAYS=t.DEFAULT_EXPIRATION_OPTION=t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=t.COLOR_STONE=t.BYTES_IN_GIGABYTE=t.BYTES_IN_MEGABYTE=t.BYTES_IN_KILOBYTE=t.MILLISECONDS_IN_DAY=void 0,t.MILLISECONDS_IN_DAY=864e5,t.BYTES_IN_KILOBYTE=1024,t.BYTES_IN_MEGABYTE=1048576,t.BYTES_IN_GIGABYTE=1073741824,t.COLOR_STONE="#637282",t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=-1,t.DEFAULT_EXPIRATION_OPTION=n.ExpirationOption.SEVEN_DAYS,t.DEFAULT_MAX_UNEXPIRED_DAYS=365,t.S3_STATIC_URL="https://showcase-marketing.dropboxstatic.com/file_transfers/backgrounds/",t.FEEDBACK_FORM_MAX_COMMENT_LENGTH=2e3}),define("file-transfers/common/types",["require","exports"],function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TransferShareStatus=t.ExpirationOption=void 0,(n=t.ExpirationOption||(t.ExpirationOption={}))[n.SEVEN_DAYS=7]="SEVEN_DAYS",n[n.THIRTY_DAYS=30]="THIRTY_DAYS",n[n.NINETY_DAYS=90]="NINETY_DAYS",n[n.CUSTOM=0]="CUSTOM",(t=t.TransferShareStatus||(t.TransferShareStatus={})).EXPIRED="expired",t.SHARED="shared"}),define("file-transfers/feedback-form/index",["require","exports","tslib","react","spectrum/radio_button/index","spectrum/input/index","react-intl","file-transfers/common/constants"],function(e,t,n,s,i,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackForm=void 0,s=n.__importStar(s),t.FeedbackForm=function(e){var t=e.comment,n=e.rating,i=e.commentPrompt,r=e.onRatingChange,o=e.onCommentsChange,a=c.useIntl(),e=function(e){r(parseInt(e.target.value,10))};return s.createElement("div",{className:"feedback-form"},s.createElement("div",{className:"feedback-form__satisfaction-rating-container"},s.createElement("div",{className:"feedback-form__satisfaction-rating-radio-buttons"},s.createElement(u,{currentRating:n,buttonRating:1,text:s.createElement(c.FormattedMessage,{id:"Ak0AwV",defaultMessage:"Extremely dissatisfied"}),onChange:e}),s.createElement(u,{currentRating:n,buttonRating:2,onChange:e}),s.createElement(u,{currentRating:n,buttonRating:3,text:s.createElement(c.FormattedMessage,{id:"WAMYrD",defaultMessage:"Neutral"}),onChange:e}),s.createElement(u,{currentRating:n,buttonRating:4,onChange:e}),s.createElement(u,{currentRating:n,buttonRating:5,text:s.createElement(c.FormattedMessage,{id:"WAXhkk",defaultMessage:"Extremely satisfied"}),onChange:e}),s.createElement(u,{currentRating:n,buttonRating:d.NOT_APPLICABLE_SATISFACTION_RATING_VALUE,text:s.createElement(c.FormattedMessage,{id:"TFC4CE",defaultMessage:"N/A"}),onChange:e}))),s.createElement("div",{className:"feedback-form__comments-container"},s.createElement("span",{className:"feedback-form__comments-prompt"},s.createElement("label",{htmlFor:"feedback-form__comments-textarea"},i)),s.createElement(l.TextArea,{className:"feedback-form__comments-textarea",id:"feedback-form__comments-textarea",placeholder:a.formatMessage({id:"r60TD+",defaultMessage:"Optional"}),value:t,onChange:function(e){o(e.currentTarget.value)},maxLength:d.FEEDBACK_FORM_MAX_COMMENT_LENGTH})))};var u=function(e){return s.createElement("div",{className:"satisfaction-rating-radio-button-block"},s.createElement(i.RadioButton,{name:"satisfaction-rating-radio-button","aria-checked":e.currentRating===e.buttonRating,checked:e.currentRating===e.buttonRating,id:e.buttonRating.toString(),onChange:e.onChange,value:e.buttonRating,className:"satisfaction-rating-radio-button"}),s.createElement("div",{className:"satisfaction-rating-radio-button-block__label"},s.createElement("span",{className:"satisfaction-rating-radio-button-block__rating-number"},e.buttonRating!==d.NOT_APPLICABLE_SATISFACTION_RATING_VALUE&&e.buttonRating),e.text&&s.createElement("span",{className:"satisfaction-rating-radio-button-block__rating-description"},e.text)))};u.displayName="SatisfactionRatingRadioButtonBlock"}),define("spectrum/tabbed_header/index",["require","exports","tslib","spectrum/tabbed_header/tabbed_header","spectrum/tabbed_header/tab"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(i,t),n.__exportStar(r,t)}),define("spectrum/tabbed_header/tab",["require","exports","tslib","classnames","react","react-aria-tabpanel"],function(e,t,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tab=void 0,a=o.__importDefault(a),s=o.__importStar(s),t.Tab=function(e){var t=e.children,n=e.className,i=e.id,r=e.ref,e=o.__rest(e,["children","className","id","ref"]),n=a.default("mc-tabbed-header-tab",n);return s.createElement(l.Tab,Object.assign({id:i,tag:"div",className:n,ref:r},e),function(e){e=e.isActive,e=a.default("mc-tabbed-header-tab-content",{"mc-tabbed-header-tab-content-selected":e});return[s.createElement("span",{key:"space",className:"mc-tabbed-header-tab-content-space"},t),s.createElement("span",{key:"content",className:e},t)]})},t.Tab.displayName="Tab"}),define("spectrum/tabbed_header/tabbed_header",["require","exports","tslib","react","react-aria-tabpanel"],function(e,t,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TabbedHeader=void 0,r=i.__importStar(r),t.TabbedHeader=function(e){var t=e.children,n=e.onSelection,e=i.__rest(e,["children","onSelection"]);return r.createElement(o.Wrapper,Object.assign({className:"mc-tabbed-header",onChange:n},e),r.createElement(o.TabList,{tag:"ul",className:"mc-tabbed-header-list"},t&&r.Children.map(t,function(e){return r.createElement("li",{className:"mc-tabbed-header-item",key:e.key||void 0,role:"presentation"},e)})))},t.TabbedHeader.displayName="TabbedHeader"}),define("modules/clean/react/file_viewer/surface_existing_teams_header",["require","exports","tslib","react","react-intl","dig-components/buttons","modules/clean/react/components/css","modules/core/i18n","modules/clean/react/sprite","modules/clean/react/teams/team_discovery/data/model","modules/clean/react/teams/team_discovery/data/client","modules/clean/react/teams/team_discovery/data/logger","modules/core/notify","modules/clean/react/teams/team_discovery/data/logger","modules/core/browser","api_v2/user_client"],function(e,t,i,a,n,s,r,l,c,d,u,o,p,m,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SurfaceExistingTeamsHeader=t.SurfaceExistingTeamsHeaderComponent=void 0,a=i.__importStar(a),f=i.__importStar(f);var _,h=n.defineMessage({id:"JTdDYP",defaultMessage:"Request sent. Watch for your invite at {user_email}"}),v=n.defineMessage({id:"wFT2+k",defaultMessage:"Success! Watch for your invite at {user_email}"}),b=l.intl.formatMessage({id:"xFjOJt",defaultMessage:"Couldnâ€™t send request. Try asking to join in person."}),w=l.intl.formatMessage({id:"cL+GSY",defaultMessage:"Couldnâ€™t send request. Check your connection."}),n=(_=a.Component,i.__extends(y,_),y.prototype.recordHeaderDismissed=function(t,n){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(e){switch(e.label){case 0:return[4,(new g.UserApiV2Client).ns("team_discovery").rpc("joinable_teams/dismiss",{team_id:n.id},{subjectUserId:t.id})];case 1:return e.sent(),[2]}})})},y.prototype.requestToJoin=function(e,t,n){var i=this,r=new u.LegacyClient,o=l.intl.formatMessage(h,{user_email:e.email}),a=l.intl.formatMessage(v,{user_email:e.email});r.joinTeam(t.id,"preview").then(function(e){switch(e?e.result:void 0){case d.JoinApiResultEnum.RequestSent:p.Notify.success(o),n();break;case d.JoinApiResultEnum.RequestNotSent:e.reason===d.JoinApiRetReason.Conflict?p.Notify.success(o):p.Notify.error(b),n();break;case d.JoinApiResultEnum.CanJoin:p.Notify.success(a),n();break;case void 0:p.Notify.error(w),i.setState({submitting:!1});break;default:p.Notify.error(b),n()}},function(){p.Notify.error(w),i.setState({submitting:!1})})},y.prototype.render=function(){var t=this,e=this.props,n=e.suggestTeamInfo,i=e.dismissHeader,r=e.user,o=l.intl.formatMessage({id:"mkG9ta",defaultMessage:"Are you part of {team_name}?"},{team_name:n.joinableTeam.name}),e=l.intl.formatMessage({id:"xIv/b5",defaultMessage:"Join this Dropbox team for easier collaboration and instant access to team files."});return a.createElement("div",{className:"surface-existing-teams-header"},a.createElement("div",{className:"surface-existing-teams-header__primary-text"},o,"Â "),a.createElement("div",{className:"surface-existing-teams-header__secondary-text"},e,"Â "),a.createElement("div",{className:"surface-existing-teams-header__buttons"},a.createElement(s.Button,{inverse:!0,variant:"primary",className:"surface-existing-teams-header__primary-button",disabled:this.state.submitting,onClick:function(){t.setState({submitting:!0}),t.requestToJoin(r,n.joinableTeam,i);var e="1"===f.get_uri().getQuery().new_user;t.logger.logClickedRequestToJoinEvent(n.joinableTeam.id,r.id,m.TeamJoinRequestOrigin.Preview,e)}},"can_auto_join"===n.joinableTeam.joinTeamRequestState[".tag"]?l.intl.formatMessage({id:"TL22S6",defaultMessage:"Join"}):l.intl.formatMessage({id:"Ugdb/e",defaultMessage:"Ask to Join"})),a.createElement(s.Button,{variant:"transparent",className:"close-button dismiss-x-icon",onClick:function(){t.recordHeaderDismissed(r,n.joinableTeam),i()},"aria-label":l.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"})},a.createElement(c.Sprite,{group:"web",name:"close_small",alt:l.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"})}))))},y);function y(e){e=_.call(this,e)||this;return e.state={submitting:!1},e.logger=new o.Logger,e}t.SurfaceExistingTeamsHeaderComponent=n,t.SurfaceExistingTeamsHeader=r.requireCssWithComponent(n,["/static/css/file_viewer/surface_existing_teams_header-vflN4Ae2w.css","/static/css/dig-components/index.web-vfldraCVQ.css"])}),define("modules/clean/react/teams/team_discovery/data/action",["require","exports","tslib","lodash","modules/core/browser","modules/core/i18n","modules/core/notify","modules/clean/react/teams/team_discovery/data/model","modules/clean/react/teams/team_discovery/data/logger","react","modules/clean/react/snackbar","modules/clean/react/teams/team_discovery/data/utils"],function(e,n,t,c,f,d,u,g,i,r,o,p){"use strict";var _;function h(e){e=r.default.createElement(o.Snackbar,t.__assign({},e,{closeButtonText:"Close",id:"teamDiscovery"}));o.Snackbar.show(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.ActionCreator=n.MEMBER_TO_FETCH_LIMIT=n.showSnackbar=n.ActionType=void 0,c=t.__importStar(c),f=t.__importStar(f),r=t.__importDefault(r),(a=_=n.ActionType||(n.ActionType={})).FetchInitData="FetchInitData",a.AskToJoinTeam="AskToJoinTeam",a.PopulateServerProps="PopulateServerProps",a.UpdateRequestState="UpdateRequestState",a.LoadUserData="LoadUserData",a.LoadCurrentAccountData="LoadCurrentAccountData",n.showSnackbar=h,n.MEMBER_TO_FETCH_LIMIT=5;var a=(s.prototype.redirectAndNotify=function(e,t){function n(){return f.redirect(i.contUrl)}var i=this;e?u.Notify.success(d.intl.formatMessage({id:"5lxkC0",defaultMessage:"Your request to join the team was sent successfully! Redirecting..."}),t,n):u.Notify.error(d.intl.formatMessage({id:"ZPbWOT",defaultMessage:"Something went wrong with your team join request. Redirecting..."}),t,n)},s.prototype.joinTeamAction=function(s,l,e,c,d,u,p){var m=this;return void 0===c&&(c=!0),void 0===p&&(p=3),function(r,o){r({type:_.UpdateRequestState,payload:{teamId:s.id,requestState:g.RequestState.Sending}});var a=i.TeamSuggestPageDesign.New;return m.apiClient.ns("team_discovery").rpc("joinable_teams/join",{team_id:s.id,source:l,extra:{design:a,origin:l,signup_tag:void 0===m.signupTag?"":m.signupTag,preselect_team_id:void 0===u?"":u.toString()}},{subjectUserId:e}).then(function(e){var t,n,i=e?e.result[".tag"]:void 0;switch(i){case g.JoinApiResultEnum.RequestSent:r({type:_.AskToJoinTeam}),t="ask_to_join",n="request_sent",r({type:_.UpdateRequestState,payload:{teamId:s.id,requestState:g.RequestState.PendingApproval}}),c?m.redirectAndNotify(!0,p):h({title:g.JoinApiRetReasonToLabel(n),variant:"complete"});break;case g.JoinApiResultEnum.RequestNotSent:(n=e.result.reason[".tag"])===g.JoinApiV2RetReason.Conflict?(r({type:_.AskToJoinTeam}),t="ask_to_join",c?m.redirectAndNotify(!0,p):h({title:g.JoinApiRetReasonToLabel(n),variant:"fail"})):(m.logger.logAskToJoinErrorEvent(s.id,m.selector.getTeamDiscoveryStoreState(o()).userId,i||"unknown",n||"unknown",l),c?m.redirectAndNotify(!1,p):h({title:g.JoinApiRetReasonToLabel(n),variant:"fail"})),r({type:_.UpdateRequestState,payload:{teamId:s.id}});break;case g.JoinApiResultEnum.CanJoin:t="can_auto_join",n="can_join",c?m.isViralFlow?m.redirectAndNotify(!0,p):f.redirect(e.result.url):h({title:"Joined team",variant:"complete"}),r({type:_.UpdateRequestState,payload:{teamId:s.id,requestState:g.RequestState.Joined}});break;default:m.logger.logAskToJoinErrorEvent(s.id,m.selector.getTeamDiscoveryStoreState(o()).userId,"unknown","other",l),r({type:_.UpdateRequestState,payload:{teamId:s.id}}),c?m.redirectAndNotify(!1,p):h({title:g.JoinApiRetReasonToLabel("other"),variant:"fail"})}m.logger.logAskToJoinEvent({teamId:s.id,userId:m.selector.getTeamDiscoveryStoreState(o()).userId,joinState:t,reason:n,origin:l,team_index:d,url:"team/discover/suggest",design:a,signupTag:m.signupTag,preselectTeamId:u})})}},s.prototype.fetchInitialData=function(o,a,s,t){var l=this;return void 0===a&&(a=n.MEMBER_TO_FETCH_LIMIT),void 0===s&&(s=!0),void 0===t&&(t=""),function(i,r){return i({type:_.PopulateServerProps,payload:{userEmail:o.userEmail,userId:o.userId}}),l.apiClient.ns("team_discovery").rpc("joinable_teams/list",{member_to_fetch_limit:a,sharer_dbx_team_id:o.sharerDbxTeamId,include_user_collab_teams:!0},{subjectUserId:o.userId}).then(function(e){var t,n=c.map(e.values,g.toJoinableTeam);s&&l.logger.logExposedToSETOnSignupPage(l.selector.getTeamDiscoveryStoreState(r()).userId,p.findSignupOriginType(!!o.sharerDbxTeamId,o.signupTag),o.signupTag,n.length,null===(t=p.preselectTeam(n,o.sharerName,o.sharerDbxTeamId))||void 0===t?void 0:t.id,a,null===(t=n[0])||void 0===t?void 0:t.isSameDomain,null===(t=n[0])||void 0===t?void 0:t.isCollaborator),i({type:_.FetchInitData,payload:{joinableTeams:n,domainName:e.domain_name}})}).catch(function(e){if(!t)throw e;e=d.intl.formatMessage({id:"/uOUwu",defaultMessage:"We encountered an error trying to fetch teams for you to join. Redirecting to the next page..."});u.Notify.error(e,3,function(){return f.redirect(t)})})}},s.prototype.fetchUserData=function(n,i){var r=this;return function(t,e){return r.apiClient.ns("team_discovery").rpc("joinable_teams/user",{dbx_account_id:i},{subjectUserId:n}).then(function(e){t({type:_.LoadUserData,payload:{userId:i,teamId:e.dbx_team_id}})})}},s.prototype.fetchCurrentAccount=function(n){var i=this;return function(t,e){return i.apiClient.ns("users").rpc("get_current_account",void 0,{subjectUserId:n}).then(function(e){t({type:_.LoadCurrentAccountData,payload:{suggestMembersEnabled:!(null===(e=e.team)||void 0===e||!e.team_user_permissions.suggest_members_enabled)}})})}},s.prototype.continueToNextPage=function(n,i){var r=this;return function(e,t){n.preventDefault(),r.logger.logContinueToInstallEvent(r.selector.getTeamDiscoveryStoreState(t()).userId,i),n.metaKey?f.open_tab(r.contUrl):f.redirect(r.contUrl)}},s);function s(e,t,n,i,r,o){void 0===o&&(o=!1),this.apiClient=e,this.logger=t,this.selector=n,this.contUrl=i||"/install",this.signupTag=r,this.isViralFlow=o}n.ActionCreator=a}),define("modules/clean/react/teams/team_discovery/data/client",["require","exports","modules/clean/deprecated_ajax/ajax_as_promised_jquery"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyClient=void 0;var n=(i.prototype.joinTeam=function(e,t,n,i,r){return o.WebRequest({url:"/team/discover/join_ajax",data:{team_id:e,isServerView:!1,skip_email_verify:!0,source:t,design:n,origin:t,signup_tag:i,preselect_team_id:r}}).then(function(e){if(e)return JSON.parse(e)})},i);function i(){}t.LegacyClient=n}),define("modules/clean/react/teams/team_discovery/data/logger",["require","exports","tslib","modules/clean/analytics","modules/core/browser"],function(e,t,n,p,d){"use strict";var i,l;Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.AMPNamespace=t.TeamSuggestPageDesign=t.TeamJoinRequestOrigin=void 0,d=n.__importStar(d),(n=i=t.TeamJoinRequestOrigin||(t.TeamJoinRequestOrigin={})).Signup="signup",n.Preview="preview",n.Requests="requests",n.Pass="pass",n.SignupViralInband="signup_viral_inband",n.SignupViralLinksharing="signup_viral_linksharing",n.SurfaceExistingTeamHomepage="surface_existing_teams_homepage",n.ShareRequestAccessPage="share_request_access_page",n.TeamDiscoveryPageRefresh="team_discovery_page_refresh",(n=l=t.TeamSuggestPageDesign||(t.TeamSuggestPageDesign={})).New="new",n.Old="old",(t.AMPNamespace||(t.AMPNamespace={})).TEAM_DISCOVERY="team_discovery";r.prototype.logAskToJoinEvent=function(e){var t=e.teamId,n=e.userId,i=e.joinState,r=e.reason,o=e.origin,a=e.team_index,s=e.url,l=e.design,c=e.signupTag,d=e.preselectTeamId,u=e.numAskToJoin,e=e.numAutoJoin;p.TeamsWebActionsLogger.log("clicked_req_to_join",{team_id:t,user_id:n,url:s,join_state:i,reason:r,origin:o,design:l,signup_tag:c,preselect_team_id:d,team_index:a+1,num_ask_to_join:u,num_auto_join:e})},r.prototype.logAskToJoinErrorEvent=function(e,t,n,i,r){p.TeamsWebActionsLogger.log("requested_access_to_team_error",{team_id:e,user_id:t,url:"team/discover/suggest",join_state:n,reason:i,origin:r})},r.prototype.logAcceptInvitation=function(e){p.TeamsWebActionsLogger.log("clicked_accept_invite",{team_id:e})},r.prototype.logTeamDiscoveryPageSeen=function(e,t,n){for(var i=[],r=[],o=[],a=[],s=0,l=e;s<l.length;s++){var c=l[s];"request_approved"===c.joinTeamRequestState[".tag"]?i.push(c):"waiting_for_approval"===c.joinTeamRequestState[".tag"]?r.push(c):"can_auto_join"===c.joinTeamRequestState[".tag"]?o.push(c):"approval_required"===c.joinTeamRequestState[".tag"]&&a.push(c)}n={has_pending_invite:!!t,has_outstanding_request:0<r.length,has_approved_request:0<i.length,num_auto_join:o.length,num_ask_to_join:a.length,verified:n,_tk:d.get_pathname(),url:d.get_uri().toString()},p.TeamsWebActionsLogger.log_for_category("saw_team_promo_page",p.TeamsWebActionsLogger.LOG_CATEGORY.PROMO_TEAMS,n)},r.prototype.logClickCancelJoinRequest=function(e,t){p.TeamsWebActionsLogger.log("cancel_request_to_join",{num_team_members:t,origin:i.TeamDiscoveryPageRefresh,source:"team_discovery_page",team_id:e})},r.prototype.logClickStartNewTeamLink=function(){p.TeamsWebActionsLogger.log("clicked_create_team_cta")},r.prototype.logEmailVerificationModalShown=function(e,t){p.TeamsWebActionsLogger.log("email_verification_modal_shown",{user_id:e,team_id:t})},r.prototype.logEmailVerifiedSnackbarShown=function(e){p.TeamsWebActionsLogger.log("email_verified_snackbar_shown",{user_id:e})},r.prototype.logContinueToInstallEvent=function(e,t){p.TeamsWebActionsLogger.log("surface_existing_team_continue_to_install",{user_id:e,url:"team/discover/suggest",is_cancel:t=void 0===t?!1:t},function(){},e)},r.prototype.logExposedToSETOnPreviewEvent=function(e,t,n,i,r,o,a){p.TeamsWebActionsLogger.log("exposed_to_set_on_preview",{team_id:r,user_id:e,url:"scl/fi/:sckey/:file_name",is_cdm_member:t,user_root_permissions:n,team_member_count:o,saw_ask_to_join:i,is_new_user:a},function(){},e)},r.prototype.logClickedRequestToJoinEvent=function(e,t,n,i){p.TeamsWebActionsLogger.log("clicked_req_to_join",{team_id:e,user_id:t,url:"scl/fi/:sckey/:file_name",origin:n,is_new_user:i},function(){},t)},r.prototype.logExposedToSETOnSignupPage=function(e,t,n,i,r,o,a,s){p.TeamsWebActionsLogger.log("exposed_to_set_on_signup_page",{design:l.New,origin:t,signup_tag:n,number_of_teams:i,preselect_team_id:r,member_to_fetch_limit:o,first_team_same_domain:a,first_team_tc:s},function(){},e)},r.prototype.logExposedToSETOnSignupPageLoadingScreen=function(e,t){p.TeamsWebActionsLogger.log("exposed_to_set_on_signup_page_loading",{origin:t},function(){},e)},r.prototype.logUserSelectedJoinableTeam=function(e,t,n,i,r){this._logUserJoinableTeamChoice("user_selected_joinable_team",e,t,n,i,r)},r.prototype.logUserUnselectedJoinableTeam=function(e,t,n,i,r){this._logUserJoinableTeamChoice("user_unselected_joinable_team",e,t,n,i,r)},r.prototype._logUserJoinableTeamChoice=function(e,t,n,i,r,o){p.TeamsWebActionsLogger.log(e,{team_id:t,design:l.New,origin:i,signup_tag:r,preselect_team_id:o},function(){},n)},n=r;function r(){}t.Logger=n}),define("modules/clean/react/teams/team_discovery/data/model",["require","exports","tslib","lodash","modules/core/i18n"],function(e,t,n,i,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.toTeamInvite=t.toJoinableTeam=t.Pages=t.RequestState=t.JoinApiRetReasonToLabel=t.JoinApiV2RetReason=t.JoinApiRetReason=t.JoinApiResultEnum=void 0,i=n.__importStar(i),(n=t.JoinApiResultEnum||(t.JoinApiResultEnum={})).RequestSent="request_sent",n.RequestNotSent="request_not_sent",n.CanJoin="can_join",(n=t.JoinApiRetReason||(t.JoinApiRetReason={}))[n.Conflict=5]="Conflict",(n=t.JoinApiV2RetReason||(t.JoinApiV2RetReason={})).ExistsSameTeam="exists_same_team",n.ExistsDifferentTeam="exists_different_team",n.Conflict="conflict",n.MaxTeamSizeAchieved="max_team_size_achieved",n.Rejected="rejected",n.Other="other",t.JoinApiRetReasonToLabel=function(e){return{request_sent:r.intl.formatMessage({id:"sQbTsQ",defaultMessage:"Request sent. Once itâ€™s approved, youâ€™ll get an invite from the team."}),exists_same_team:r.intl.formatMessage({id:"oZNXJZ",defaultMessage:"Looks like youâ€™ve already asked to join this team."}),exists_different_team:r.intl.formatMessage({id:"mHIpiE",defaultMessage:"Looks like you already asked to join a different team."}),rejected:r.intl.formatMessage({id:"H8TlMC",defaultMessage:"Looks like this team already denied your request."}),max_team_size_achieved:r.intl.formatMessage({id:"dEJ+SP",defaultMessage:"Looks like this team size has already been reached"})}[e]||r.intl.formatMessage({id:"s86tt6",defaultMessage:"Couldnâ€™t send request. Try asking to join in person."})},(n=o=t.RequestState||(t.RequestState={})).Sending="sending",n.PendingApproval="pending_approval",n.Joined="joined",(n=t.Pages||(t.Pages={})).Suggest="TeamDiscovery/Suggest",n.Confirm="TeamDiscovery/Confirm",t.toJoinableTeam=function(e){return{dbxTeamId:e.dbx_team_id,id:e.team_id,name:e.team_name,adminsCount:e.admins_count,membersCount:e.members_count,requestState:e.pending_request?o.PendingApproval:void 0,joinTeamRequestState:e.join_request_state,joinRequestStateDate:e.join_request_state_date,isSameDomain:e.is_same_domain,isCollaborator:e.is_collaborator,sharedFolderCount:e.shared_folder_count,lastShareTimestamp:e.last_share_timestamp,members:i.map(e.members,function(e){return{memberId:e.member_id,name:e.member_name,isAdmin:e.is_admin,avatarURL:e.photo_url}})}},t.toTeamInvite=function(e){return null==e?null:{teamId:e.team_id,userName:e.inviting_user_name,signupKey:e.signup_key,isNewInviteLinkInvitation:e.is_new_invite_link_invitation}}}),define("modules/clean/react/teams/team_discovery/data/utils",["require","exports","tslib","react","modules/clean/react/teams/team_discovery/data/logger","modules/core/i18n"],function(e,t,n,i,r,o){"use strict";function a(e,t,n){e=o.intl.formatMessage({id:"Om3b8J",defaultMessage:"{remainder, plural, =0{{adminName}} one{{adminName} + {remainder} more} few{{adminName} + {remainder} more} other{{adminName} + {remainder} more}}"},{adminName:e,remainder:t-1});return n?o.intl.formatMessage({id:"LQZIyx",defaultMessage:"{teamAdminCount, plural, one{Admin: {adminList}} other{Admins: {adminList}}}"},{teamAdminCount:t,adminList:e}):o.intl.formatMessage({id:"T2wYhx",defaultMessage:"{teamAdminCount, plural, one{Team admin: {adminList}} other{Team admins: {adminList}}}"},{teamAdminCount:t,adminList:e})}Object.defineProperty(t,"__esModule",{value:!0}),t.toFacepileMember=t.getLastShareTimeStr=t.getSharedFolderCountStr=t.getAdminNamesStrForTeam=t.getAdminNamesStr=t.shouldShowTeamCollabContext=t.preselectTeam=t.findSignupOriginType=void 0,i=n.__importDefault(i),t.findSignupOriginType=function(e,t){return e?"shared_content_link_register"===t?r.TeamJoinRequestOrigin.SignupViralInband:r.TeamJoinRequestOrigin.SignupViralLinksharing:r.TeamJoinRequestOrigin.Signup},t.preselectTeam=function(e,t,n){var i=e[0],e=1===e.length,n=t&&n&&i&&i.dbxTeamId===n;return e||n?i:void 0},t.shouldShowTeamCollabContext=function(e){return 0<(e=!Array.isArray(e)?[e]:e).length&&e.every(function(e){return void 0!==e.sharedFolderCount})},t.getAdminNamesStr=a,t.getAdminNamesStrForTeam=function(t,e){return a(function(){var e=t.members.find(function(e){return e.isAdmin});if(void 0===e)throw new Error("No admin on team given to team card");return e.name}(),t.adminsCount,e)},t.getSharedFolderCountStr=function(e){return o.intl.formatMessage({id:"8Izk7L",defaultMessage:"Shared {sharedFolderCount} {sharedFolderCount, plural, one {folder} other {folders}} with you"},{sharedFolderCount:e})},t.getLastShareTimeStr=function(e){return o.intl.formatMessage({id:"1Yl7QT",defaultMessage:"Last worked together {lastShareDate, date, medium}"},{lastShareDate:new Date(1e3*e)})},t.toFacepileMember=function(e){return{memberKey:e.memberId.toString(),active:!0,alt:null,avatarColorSeed:e.memberId.toString(),initials:e.name.charAt(0),photoUrl:void 0===e.avatarURL?null:e.avatarURL,tooltipContent:i.default.createElement("div",null,e.name)}}}),define("prod_assets_web_modules/react-aria-tabpanel",["react","./common/_commonjsHelpers"],function(e,t){"use strict";var r=e&&e.__esModule?e:{default:e};function i(){}function o(){}o.resetWarningCache=i;var n=t.createCommonjsModule(function(e){function t(e,t,n,i,r,o){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==o){o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function n(){return t}e.exports=(e={array:t.isRequired=t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:n,element:t,elementType:t,instanceOf:n,node:t,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:o,resetWarningCache:i}).PropTypes=e}),l=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable;var a=function(){try{if(!Object.assign)return;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(e){i[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return}}()?Object.assign:function(e,t){for(var n,i=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),r=1;r<arguments.length;r++){for(var o in n=Object(arguments[r]))c.call(n,o)&&(i[o]=n[o]);if(l)for(var a=l(n),s=0;s<a.length;s++)d.call(n,a[s])&&(i[a[s]]=n[a[s]])}return i},s={},u=function(e,t,n,i,r,o,a,s){var l,c,d;if(!e)throw void 0===t?l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings."):(c=[n,i,r,o,a,s],d=0,(l=new Error(t.replace(/%s/g,function(){return c[d++]}))).name="Invariant Violation"),l.framesToPop=1,l};if(void 0===r.default)throw Error("create-react-class could not find the React object. If you are using script tags, make sure that React is being loaded before create-react-class.");function p(e,t,n){for(var i in t)t.hasOwnProperty(i)&&(e[i]||n[i]||(e[i]=t[i]))}var m,f,g,_,h,v,b,w,y,S,E=(new r.default.Component).updater,e=(m=r.default.Component,f=r.default.isValidElement,g=E,_=[],h={mixins:"DEFINE_MANY",statics:"DEFINE_MANY",propTypes:"DEFINE_MANY",contextTypes:"DEFINE_MANY",childContextTypes:"DEFINE_MANY",getDefaultProps:"DEFINE_MANY_MERGED",getInitialState:"DEFINE_MANY_MERGED",getChildContext:"DEFINE_MANY_MERGED",render:"DEFINE_ONCE",componentWillMount:"DEFINE_MANY",componentDidMount:"DEFINE_MANY",componentWillReceiveProps:"DEFINE_MANY",shouldComponentUpdate:"DEFINE_ONCE",componentWillUpdate:"DEFINE_MANY",componentDidUpdate:"DEFINE_MANY",componentWillUnmount:"DEFINE_MANY",UNSAFE_componentWillMount:"DEFINE_MANY",UNSAFE_componentWillReceiveProps:"DEFINE_MANY",UNSAFE_componentWillUpdate:"DEFINE_MANY",updateComponent:"OVERRIDE_BASE"},v={getDerivedStateFromProps:"DEFINE_MANY_MERGED"},b={displayName:function(e,t){e.displayName=t},mixins:function(e,t){if(t)for(var n=0;n<t.length;n++)k(e,t[n])},childContextTypes:function(e,t){e.childContextTypes=a({},e.childContextTypes,t)},contextTypes:function(e,t){e.contextTypes=a({},e.contextTypes,t)},getDefaultProps:function(e,t){e.getDefaultProps?e.getDefaultProps=A(e.getDefaultProps,t):e.getDefaultProps=t},propTypes:function(e,t){e.propTypes=a({},e.propTypes,t)},statics:function(e,t){!function(e,t){if(t)for(var n in t){var i=t[n];if(t.hasOwnProperty(n)){if(u(!(n in b),'ReactClass: You are attempting to define a reserved property, `%s`, that shouldn\'t be on the "statics" key. Define it as an instance property instead; it will still be accessible on the constructor.',n),n in e){var r=v.hasOwnProperty(n)?v[n]:null;return u("DEFINE_MANY_MERGED"===r,"ReactClass: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",n),e[n]=A(e[n],i)}e[n]=i}}}(e,t)},autobind:function(){}},w={componentDidMount:function(){this.__isMounted=!0}},y={componentWillUnmount:function(){this.__isMounted=!1}},S={replaceState:function(e,t){this.updater.enqueueReplaceState(this,e,t)},isMounted:function(){return!!this.__isMounted}},a(I.prototype,m.prototype,S),function(e){function i(e,t,n){this.__reactAutoBindPairs.length&&function(e){for(var t=e.__reactAutoBindPairs,n=0;n<t.length;n+=2){var i=t[n],r=t[n+1];e[i]=r.bind(e)}}(this),this.props=e,this.context=t,this.refs=s,this.updater=n||g,this.state=null,n=this.getInitialState?this.getInitialState():null,u("object"==typeof n&&!Array.isArray(n),"%s.getInitialState(): must return an object or null",i.displayName||"ReactCompositeComponent"),this.state=n}for(var t in((i.prototype=new I).constructor=i).prototype.__reactAutoBindPairs=[],_.forEach(k.bind(null,i)),k(i,w),k(i,e),k(i,y),i.getDefaultProps&&(i.defaultProps=i.getDefaultProps()),u(i.prototype.render,"createClass(...): Class specification must implement a `render` method."),h)i.prototype[t]||(i.prototype[t]=null);return i}),P={children:n.oneOfType([n.node,n.func]).isRequired,id:n.string.isRequired,tag:n.string,role:n.string,index:n.number,active:n.bool,letterNavigationText:n.string},t=e({displayName:"AriaTabPanel-Tab",propTypes:P,getDefaultProps:function(){return{tag:"div",role:"tab"}},contextTypes:{atpManager:n.object.isRequired},getInitialState:function(){return{isActive:this.context.atpManager.memberStartsActive(this.props.id)||!1}},handleFocus:function(){this.context.atpManager.handleTabFocus(this.props.id)},handleRef:function(e){e&&(this.elRef=e,this.registerWithManager(this.elRef))},updateActiveState:function(e){this.setState({isActive:e})},registerWithManager:function(e){this.isRegistered||(this.isRegistered=!0,this.context.atpManager.registerTab({id:this.props.id,node:e,update:this.updateActiveState,index:this.props.index,letterNavigationText:this.props.letterNavigationText,active:void 0===this.props.active?this.state.isActive:this.props.active}))},unregisterWithManager:function(){var e=this.props;this.context.atpManager.unregisterTab(e.id)},render:function(){var e=this.props,t=void 0===e.active?this.state.isActive:e.active,n="function"==typeof e.children?e.children({isActive:t}):e.children,t={id:e.id,tabIndex:t?0:-1,onClick:this.handleClick,onFocus:this.handleFocus,role:e.role,"aria-selected":t,"aria-controls":this.context.atpManager.getTabPanelId(e.id),ref:this.handleRef};return p(t,e,P),r.default.createElement(e.tag,t,n)},componentWillUnmount:function(){this.unregisterWithManager()}}),C={children:n.node.isRequired,tag:n.string,role:n.string},E=e({displayName:"AriaTabPanel-TabList",propTypes:C,getDefaultProps:function(){return{tag:"div",role:"tablist"}},render:function(){var e=this.props,t={role:e.role};return p(t,e,C),r.default.createElement(e.tag,t,e.children)}}),M={children:n.oneOfType([n.node,n.func]).isRequired,tabId:n.string.isRequired,tag:n.string,role:n.string,active:n.bool},m=e({displayName:"AriaTabPanel-TabPanel",propTypes:M,getDefaultProps:function(){return{tag:"div",role:"tabpanel"}},contextTypes:{atpManager:n.object.isRequired},getInitialState:function(){return{isActive:this.context.atpManager.memberStartsActive(this.props.tabId)||!1}},handleKeyDown:function(e){e.ctrlKey&&"ArrowUp"===e.key&&(e.preventDefault(),this.context.atpManager.focusTab(this.props.tabId))},updateActiveState:function(e){this.setState({isActive:e})},registerWithManager:function(e){this.isRegistered||(this.isRegistered=!0,this.context.atpManager.registerTabPanel({node:e,update:this.updateActiveState,tabId:this.props.tabId}))},render:function(){var e=this.props,t=void 0===e.active?this.state.isActive||!1:e.active,n="function"==typeof e.children?e.children({isActive:t}):e.children,i=e.style||{};t||(i.display="none");t={className:e.className,id:this.context.atpManager.getTabPanelId(e.tabId),onKeyDown:this.handleKeyDown,role:e.role,style:i,"aria-hidden":!t,"aria-describedby":e.tabId,ref:this.registerWithManager};return p(t,e,M),r.default.createElement(e.tag,t,n)}});function k(e,t){if(t){u("function"!=typeof t,"ReactClass: You're attempting to use a component class or function as a mixin. Instead, just use a regular object."),u(!f(t),"ReactClass: You're attempting to use a component as a mixin. Instead, just use a regular object.");var n,i,r,o=e.prototype,a=o.__reactAutoBindPairs;for(n in t.hasOwnProperty("mixins")&&b.mixins(e,t.mixins),t)t.hasOwnProperty(n)&&"mixins"!==n&&(i=t[n],r=o.hasOwnProperty(n),s=r,l=n,c=void 0,c=h.hasOwnProperty(l)?h[l]:null,S.hasOwnProperty(l)&&u("OVERRIDE_BASE"===c,"ReactClassInterface: You are attempting to override `%s` from your class specification. Ensure that your method names do not overlap with React methods.",l),s&&u("DEFINE_MANY"===c||"DEFINE_MANY_MERGED"===c,"ReactClassInterface: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",l),b.hasOwnProperty(n)?b[n](e,i):(l=h.hasOwnProperty(n),"function"!=typeof i||l||r||!1===t.autobind?r?(r=h[n],u(l&&("DEFINE_MANY_MERGED"===r||"DEFINE_MANY"===r),"ReactClass: Unexpected spec policy %s for key %s when mixing in component specs.",r,n),"DEFINE_MANY_MERGED"===r?o[n]=A(o[n],i):"DEFINE_MANY"===r&&(o[n]=function(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}(o[n],i))):o[n]=i:(a.push(n,i),o[n]=i)))}var s,l,c}function T(e,t){for(var n in u(e&&t&&"object"==typeof e&&"object"==typeof t,"mergeIntoWithNoDuplicateKeys(): Cannot merge non-objects."),t)t.hasOwnProperty(n)&&(u(void 0===e[n],"mergeIntoWithNoDuplicateKeys(): Tried to merge two objects with the same key: `%s`. This conflict may be due to a mixin; in particular, this may be caused by two getInitialState() or getDefaultProps() methods returning objects with clashing keys.",n),e[n]=t[n]);return e}function A(i,r){return function(){var e=i.apply(this,arguments),t=r.apply(this,arguments);if(null==e)return t;if(null==t)return e;var n={};return T(n,e),T(n,t),n}}function I(){}function F(e){this._settings={forwardArrows:(e=e||{}).forwardArrows||["down"],backArrows:e.backArrows||["up"],wrap:e.wrap,stringSearch:e.stringSearch,stringSearchDelay:800},this._searchString="",this._members=[],e.members&&this.setMembers(e.members),this._boundHandleKeydownEvent=this._handleKeydownEvent.bind(this)}function O(e){e&&e.focus&&(e.focus(),"input"===e.tagName.toLowerCase()&&e.select())}function x(e){var t={wrap:!0,forwardArrows:["down","right"],backArrows:["up","left"],stringSearch:(this.options=e).letterNavigation};this.focusGroup=new F(t),this.tabs=[],this.tabPanels=[],this.activeTabId=e.activeTabId}F.prototype.activate=function(){return document.addEventListener("keydown",this._boundHandleKeydownEvent,!0),this},F.prototype.deactivate=function(){return document.removeEventListener("keydown",this._boundHandleKeydownEvent,!0),this._clearSearchStringRefreshTimer(),this},F.prototype._handleKeydownEvent=function(e){if(-1!==this._getActiveElementIndex()){var t="ArrowUp"===e.key||38===e.keyCode?"up":"ArrowDown"===e.key||40===e.keyCode?"down":"ArrowLeft"===e.key||37===e.keyCode?"left":"ArrowRight"===e.key||39===e.keyCode?"right":null;if(t)return-1!==this._settings.forwardArrows.indexOf(t)?(e.preventDefault(),void this.moveFocusForward()):-1!==this._settings.backArrows.indexOf(t)?(e.preventDefault(),void this.moveFocusBack()):void 0;this._handleNonArrowKey(e)}},F.prototype.moveFocusForward=function(){var e=this._getActiveElementIndex(),e=e<this._members.length-1?e+1:this._settings.wrap?0:e;return this.focusNodeAtIndex(e),e},F.prototype.moveFocusBack=function(){var e=this._getActiveElementIndex(),e=0<e?e-1:this._settings.wrap?this._members.length-1:e;return this.focusNodeAtIndex(e),e},F.prototype._handleNonArrowKey=function(e){var t;if(this._settings.stringSearch)return""===this._searchString||" "!==e.key&&32!==e.keyCode?!(65<=(t=e.keyCode)&&t<=90)||e.ctrlKey||e.metaKey||e.altKey?-1:(e.preventDefault(),this._addToSearchString(String.fromCharCode(e.keyCode)),void this._runStringSearch()):(e.preventDefault(),-1)},F.prototype._clearSearchString=function(){this._searchString=""},F.prototype._addToSearchString=function(e){this._searchString+=e.toLowerCase()},F.prototype._startSearchStringRefreshTimer=function(){var e=this;this._clearSearchStringRefreshTimer(),this._stringSearchTimer=setTimeout(function(){e._clearSearchString()},this._settings.stringSearchDelay)},F.prototype._clearSearchStringRefreshTimer=function(){clearTimeout(this._stringSearchTimer)},F.prototype._runStringSearch=function(){this._startSearchStringRefreshTimer(),this.moveFocusByString(this._searchString)},F.prototype.moveFocusByString=function(e){for(var t,n=0,i=this._members.length;n<i;n++)if((t=this._members[n]).text&&0===t.text.indexOf(e))return O(t.node)},F.prototype._findIndexOfNode=function(e){for(var t=0,n=this._members.length;t<n;t++)if(this._members[t].node===e)return t;return-1},F.prototype._getActiveElementIndex=function(){return this._findIndexOfNode(document.activeElement)},F.prototype.focusNodeAtIndex=function(e){e=this._members[e];return e&&O(e.node),this},F.prototype.addMember=function(e,t){var n=e.node||e,i=e.text||n.getAttribute("data-focus-group-text")||n.textContent||"";return this._checkNode(n),e={node:n,text:i.replace(/[\W_]/g,"").toLowerCase()},null!=t?this._members.splice(t,0,e):this._members.push(e),this},F.prototype.removeMember=function(e){e="number"==typeof e?e:this._findIndexOfNode(e);if(-1!==e)return this._members.splice(e,1),this},F.prototype.clearMembers=function(){return this._members=[],this},F.prototype.setMembers=function(e){this.clearMembers();for(var t=0,n=e.length;t<n;t++)this.addMember(e[t]);return this},F.prototype.getMembers=function(){return this._members},F.prototype._checkNode=function(e){if(!e.nodeType||e.nodeType!==window.Node.ELEMENT_NODE)throw new Error("focus-group: only DOM nodes allowed");return e},x.prototype.activate=function(){this.focusGroup.activate()},x.prototype.memberStartsActive=function(e){return this.activeTabId===e||void 0===this.activeTabId&&(this.activeTabId=e,!0)},x.prototype.registerTab=function(e){void 0===e.index?this.tabs.push(e):this.tabs.splice(e.index,0,e);var t=e.letterNavigationText?{node:e.node,text:e.letterNavigationText}:e.node;this.focusGroup.addMember(t,e.index);t=this.activeTabId;(!this.activeTabId||e.active&&e.id!==this.activeTabId)&&(t=e.id),this.activateTab(t)},x.prototype.unregisterTab=function(n){var i,r;this.tabs&&0<this.tabs.length&&(this.tabs.forEach(function(e,t){e.id===n&&(i=t,r=e)}),r&&r.node&&(this.tabs.splice(i,1),this.focusGroup.removeMember(r.node)))},x.prototype.registerTabPanel=function(e){this.tabPanels.push(e),this.activateTab(this.activeTabId),this.activateTab(this.activeTabId||e.tabId)},x.prototype.activateTab=function(t){t!==this.activeTabId&&(this.activeTabId=t,this.options.onChange?this.options.onChange(t):(this.tabPanels.forEach(function(e){e.update(t===e.tabId)}),this.tabs.forEach(function(e){e.update(t===e.id)})))},x.prototype.handleTabFocus=function(e){this.activateTab(e)},x.prototype.focusTab=function(t){var e=this.tabs.find(function(e){return e.id===t});e&&e.node.focus()},x.prototype.destroy=function(){this.focusGroup.deactivate()},x.prototype.getTabPanelId=function(e){return e+"-panel"};var D={children:n.node.isRequired,activeTabId:n.string,letterNavigation:n.bool,onChange:n.func,tag:n.string};return{Tab:t,TabList:E,TabPanel:m,Wrapper:e({displayName:"AriaTabPanel-Wrapper",propTypes:D,getDefaultProps:function(){return{tag:"div"}},childContextTypes:{atpManager:n.object.isRequired},getChildContext:function(){return{atpManager:this.manager}},componentWillMount:function(){this.manager=new x({onChange:this.props.onChange,activeTabId:this.props.activeTabId,letterNavigation:this.props.letterNavigation})},componentWillUnmount:function(){this.manager.destroy()},componentDidMount:function(){this.manager.activate()},componentDidUpdate:function(e){e.activeTabId===this.manager.activeTabId&&e.activeTabId!==this.props.activeTabId&&this.manager.activateTab(this.props.activeTabId)},render:function(){var e=this.props,t={};return p(t,e,D),r.default.createElement(e.tag,t,e.children)}})}});
