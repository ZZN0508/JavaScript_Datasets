define("modules/clean/abuse/funcaptcha_modal",["require","exports","tslib","react","modules/clean/deprecated_ajax/ajax_jquery","classnames","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/flux/store_listener","modules/constants/env","modules/constants/login_and_register","modules/core/browser_detection","modules/core/uri","react-dom","modules/core/dom","modules/clean/metrics/index","modules/core/exception"],function(e,o,t,n,i,r,s,a,c,u,l,d,p,h,_,f,g){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.recordFunCaptchaLoadingStats=o.openFuncaptchaModal=o.loadFuncaptchaModal=void 0,n=t.__importDefault(n),i=t.__importStar(i),r=t.__importDefault(r),l=t.__importStar(l),d=t.__importStar(d),h=t.__importStar(h),_=t.__importStar(_),g=t.__importStar(g);function m(e,t){a.Dispatcher.dispatch({type:e,data:t})}function E(e,t,r,o){i.BackgroundRequest({url:"/log_invisible_recaptcha_event",data:{event:e,email:t,source:r,captcha_session_token:o}})}o.loadFuncaptchaModal=function(){var e=new y,t=c.listenToStores(v,{fs:e},function(){return{show:e.show,email:e.email,firstTime:e.firstTime,onSuccess:e.onSuccess,onReady:e.onReady,runningFuncaptcha:e.runningFuncaptcha,source:e.source}}),r=document.createElement("div");document.body.insertBefore(r,document.body.firstChild||null),h.render(n.default.createElement(t,null),r)},o.openFuncaptchaModal=function(e,t,r,o){E("FUNCAPTCHA_START",e,t,""),m("FUNCAPTCHA_START",{email:e,source:t,onSuccess:r,onReady:o})},o.recordFunCaptchaLoadingStats=function(e,t,r,o){f.getMetricsReporter().createStats({ns:"abuse",name:"funcaptcha/"+e},{is_success:String(r)}).record(t),r||null==o||g.reportException({err:new Error(o),severity:g.SEVERITY.CRITICAL,tags:["content-abuse","funcaptcha"]})};var w,S,y=(S=s.Store,t.__extends(C,S),C.prototype._new_payload=function(e){if(e&&e.action&&e.action.type)switch(e.action.type){case"FUNCAPTCHA_START":this.runningFuncaptcha=!0,this.firstTime=!1;var t=e.action.data;this.email=t.email,this.onSuccess=t.onSuccess,this.onReady=t.onReady,this.source=t.source,this.emit_change();break;case"FUNCAPTCHA_OPEN_MODAL":this.show=!0,this.emit_change();break;case"FUNCAPTCHA_FINISH":this.show=!1,this.runningFuncaptcha=!1,this.onSuccess=void 0,this.onReady=void 0,this.emit_change()}},C),v=(w=n.default.Component,t.__extends(T,w),T.prototype.getIFrame=function(){return h.findDOMNode(this.refs.iframe)},T.prototype.componentDidMount=function(){var r=this;window.addEventListener("message",function(e){var t;e.data&&"funcaptcha-component"===e.data.origin&&p.URI.parse(e.origin).getAuthority()===u.FUNCAPTCHA_SERVER&&("invoked"===e.data.event?r.props.onReady&&r.props.onReady():"loaded"===e.data.event?(E("FUNCAPTCHA_CHALLENGE_SHOWN",r.props.email,r.props.source,e.data.fc_token||""),m("FUNCAPTCHA_OPEN_MODAL")):"played"===e.data.event?(t=r.props.show?"FUNCAPTCHA_SOLVED":"FUNCAPTCHA_SUCCESS",E(t,r.props.email,r.props.source,e.data.fc_token||""),r.props.onSuccess(e.data.fc_token),m("FUNCAPTCHA_FINISH")):"executed"===e.data.event&&o.recordFunCaptchaLoadingStats("funcaptcha_api_loading",e.data.latency,e.data.is_success,e.data.err_msg))})},T.prototype.componentWillReceiveProps=function(e){var t,r;!this.props.runningFuncaptcha&&e.runningFuncaptcha&&(t=this.props.firstTime?"load":"play",r=void 0,r="LOGIN"===(e=e.source)?l.FUNCAPTCHA_PUBLIC_KEY:l.FUNCAPTCHA_REGISTER_PUBLIC_KEY,this.getIFrame().contentWindow.postMessage({event:t,origin:"funcaptcha-component",public_key:r,source:e},"*"))},T.prototype.componentDidUpdate=function(e,t){!e.show&&this.props.show?_.scroll_lock_document():e.show&&!this.props.show&&_.scroll_unlock_document()},T.prototype.render=function(){var e=new p.URI({scheme:"https",authority:u.FUNCAPTCHA_SERVER,query:{fc_nosuppress:p.URI.parse(window.location.href).getQuery().fc_nosuppress}}).toString(),e=n.default.createElement("iframe",{frameBorder:0,height:"100%",width:"100%",sandbox:"allow-scripts allow-same-origin allow-forms",className:"funcaptcha-frame",src:e,ref:"iframe",key:"iframe-id"});return n.default.createElement("div",{className:r.default({"funcaptcha-modal--hidden-firefox":!this.props.show&&d.mozilla,"funcaptcha-modal--hidden-non-firefox":!this.props.show&&!d.mozilla,"funcaptcha-modal":!0})},n.default.createElement("div",{className:"funcaptcha-div"},e))},T);function T(){return null!==w&&w.apply(this,arguments)||this}function C(){var e=null!==S&&S.apply(this,arguments)||this;return e.show=!1,e.email="",e.runningFuncaptcha=!1,e.firstTime=!0,e.source="",e}}),define("modules/clean/abuse/invisible_captcha",["require","exports","tslib","modules/clean/abuse/captcha_helper","modules/clean/deprecated_pyxl/controllers/ajax_form"],function(s,e,a,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.loadCaptcha=void 0,u=a.__importDefault(u),e.loadCaptcha=function(r,o,n,i,e){var t=c.LoadRecaptcha(e,!0).then(function(e){return o.on(u.default.ERROR_EVENT,function(e,t){t&&t.funcaptcha_response&&(r.set_pending_state(),new Promise(function(e,t){s(["modules/clean/abuse/funcaptcha_modal"],e,t)}).then(a.__importStar).then(function(e){(0,e.openFuncaptchaModal)(o.find("input[name='"+n+"']").val(),i,function(e){var t=document.createElement("input");t.setAttribute("name","funcaptcha-response"),t.setAttribute("value",e),t.setAttribute("type","hidden"),r.$form.append(t),r.send_request(),r.$form.find("[name='funcaptcha-response']").remove()})}))}),e});r.send_request_wrapper=function(){t.then(function(){r.send_request()})}}}),define("modules/clean/auth/u2f",["require","exports","tslib","u2f-api","modules/core/browser_detection"],function(e,t,r,o,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.sign=t.register=t.canUseAuthenticator=t.canRegisterAuthenticator=t.isSupportedOnBrowser=t.LATEST_PROTOCOL=t.PROTOCOLS=t.FidoU2f=void 0,o=r.__importDefault(o),n=r.__importStar(n),r=t.FidoU2f||(t.FidoU2f={}),(i=i=i||{}).bt="bt",i.ble="ble",i.nfc="nfc",i.usb="usb",(r=r.ErrorCode||(r.ErrorCode={}))[r.OK=0]="OK",r[r.OTHER_ERROR=1]="OTHER_ERROR",r[r.BAD_REQUEST=2]="BAD_REQUEST",r[r.CONFIGURATION_UNSUPPORTED=3]="CONFIGURATION_UNSUPPORTED",r[r.DEVICE_INELIGIBLE=4]="DEVICE_INELIGIBLE",r[r.TIMEOUT=5]="TIMEOUT",t.PROTOCOLS={"u2f_js1.1":""},t.LATEST_PROTOCOL="u2f_js1.1";var s=window.u2f;function a(){return!0===n.chrome&&38<=parseInt(n.version,10)&&!n.is_mobile_or_tablet()||Boolean(s)}t.isSupportedOnBrowser=a,t.canRegisterAuthenticator=function(e){return!!e&&a()},t.canUseAuthenticator=function(e){return!!e&&a()},t.register=function(r){return new Promise(function(e,t){(s||o.default).register(r.appId,r.registerRequests,r.registeredKeys,e,r.opt_timeoutSeconds)})},t.sign=function(r){return new Promise(function(e,t){(s||o.default).sign(r.appId,r.challenge,r.registeredKeys,e,r.opt_timeoutSeconds)})}}),define("modules/clean/auth/authenticator",["require","exports","tslib","modules/clean/auth/u2f","modules/clean/auth/webauthn"],function(e,t,r,o,n){"use strict";function i(e){return n.canRegisterAuthenticator(e[n.LATEST_PROTOCOL])?n.LATEST_PROTOCOL:o.canRegisterAuthenticator(e[o.LATEST_PROTOCOL])?o.LATEST_PROTOCOL:null}function s(e){return n.canUseAuthenticator(e[n.LATEST_PROTOCOL])?n.LATEST_PROTOCOL:o.canUseAuthenticator(e[o.LATEST_PROTOCOL])?o.LATEST_PROTOCOL:null}Object.defineProperty(t,"__esModule",{value:!0}),t.sign=t.register=t.canUseAuthenticator=t.canRegisterAuthenticator=t.isWebAuthnEnabled=t.PROTOCOLS=void 0,o=r.__importStar(o),n=r.__importStar(n),t.PROTOCOLS=r.__assign(r.__assign({},o.PROTOCOLS),n.PROTOCOLS),t.isWebAuthnEnabled=function(e){return!!e&&!!e[n.LATEST_PROTOCOL]},t.canRegisterAuthenticator=function(e){return void 0===e?o.isSupportedOnBrowser():null!==i(e)},t.canUseAuthenticator=function(e){return null!==s(e)};var a={error:"Authenticator devices are not supported on this browser"},c={error:"Authenticator protocol not supported"};function u(e,t){return null!==(t=("register"===e?i:s)(t))?Promise.resolve(t):o.isSupportedOnBrowser()||n.isSupportedOnBrowser()?Promise.reject(c):Promise.reject(a)}t.register=function(r){return u("register",r).then(function(t){return t in n.PROTOCOLS?n.register(r[t]).then(function(e){return{protocol:t,challenge_id:r.challenge_id,response:e}}):t in o.PROTOCOLS?o.register(r[t]).then(function(e){return{protocol:t,challenge_id:r.challenge_id,response:e}}):Promise.reject(c)})},t.sign=function(r){return u("sign",r).then(function(t){return t in n.PROTOCOLS?n.sign(r[t]).then(function(e){return{protocol:t,challenge_id:r.challenge_id,response:e}}):t in o.PROTOCOLS?o.sign(r[t]).then(function(e){return{protocol:t,challenge_id:r.challenge_id,response:e}}):Promise.reject(c)})}}),define("modules/clean/auth/webauthn",["require","exports","tslib","modules/core/browser_detection","modules/clean/security/util"],function(e,t,r,o,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.sign=t.register=t.canUseAuthenticator=t.canRegisterAuthenticator=t.isSupportedOnBrowser=t.LATEST_PROTOCOL=t.PROTOCOLS=void 0,o=r.__importStar(o),t.PROTOCOLS={webauthn_wd07:""},t.LATEST_PROTOCOL="webauthn_wd07",(r=i=i||{})[r.OtherError=1]="OtherError",r[r.SecurityError=2]="SecurityError",r[r.NotAllowedError=3]="NotAllowedError",r[r.InvalidStateError=4]="InvalidStateError",r[r.Canceled=5]="Canceled",r[r.Timeout=6]="Timeout",r[r.NotSupportedError=7]="NotSupportedError";var s,a={SecurityError:i.SecurityError,NotAllowedError:i.NotAllowedError,InvalidStateError:i.InvalidStateError,AbortError:i.Canceled,TimeoutError:i.Timeout,NotSupportedError:i.NotSupportedError};function c(){return window.PublicKeyCredential&&(!0===o.mozilla&&60<=parseInt(o.version,10)||!0===o.chrome&&66<=parseInt(o.version,10)||!0===o.edge&&17.17682<=parseFloat(o.version)||!0===o.safari&&12.2<=parseFloat(o.version))}function u(e){return!(!e||!c()||!0===o.edge&&!0===e.disable_on_edge||!0===o.safari&&!0===e.disable_on_safari)}function l(e){if(e instanceof DOMException){var t=a[e.name];if(void 0!==t)return{errorCode:t,errorData:e.toString&&e.toString()}}return{errorCode:i.OtherError,errorData:e.toString&&e.toString()}}(r=s=s||{})[r.COSE=0]="COSE",r[r.DER=1]="DER",t.isSupportedOnBrowser=c,t.canRegisterAuthenticator=u,t.canUseAuthenticator=function(e){return u(e)&&function(e){if(!0===o.edge&&17.17682<=parseFloat(o.version)&&parseFloat(o.version)<17.17713||!0===o.chrome&&69===parseInt(o.version,10)||!0===o.safari&&parseFloat(o.version)<13.1){if(e.allowCredentials)for(var t=0,r=e.allowCredentials;t<r.length;t++)if(r[t].key_format===s.COSE)return!0;return!1}return!0}(e)},t.register=function(e){var t={challenge:n.b64urldecode(e.challenge),timeout:e.timeout,rp:{id:e.rp.id,name:e.rp.name,icon:e.rp.icon},user:{id:n.b64urldecode(e.user.id),name:e.user.name,displayName:e.user.displayName,icon:e.user.icon},authenticatorSelection:e.authenticatorSelection};return void 0!==e.excludeCredentials&&(t.excludeCredentials=e.excludeCredentials.map(function(e){return{type:e.type,id:n.b64urldecode(e.id),transports:e.transports}})),void 0!==e.pubKeyCredParams&&(t.pubKeyCredParams=e.pubKeyCredParams.map(function(e){return{type:e.type,alg:e.alg}})),void 0===e.attestation&&(t.attestation="direct"),navigator.credentials.create({publicKey:t}).then(function(e){return{response:{clientDataJSON:n.b64urlencode(e.response.clientDataJSON),attestationObject:n.b64urlencode(e.response.attestationObject)}}}).catch(l)},t.sign=function(e){var t={challenge:n.b64urldecode(e.challenge),timeout:e.timeout,rpId:e.rpId,userVerification:e.userVerification,extensions:e.extensions};return void 0!==e.allowCredentials&&(t.allowCredentials=e.allowCredentials.map(function(e){var t=void 0;return e.transports&&0<e.transports.length&&(t=e.transports),{type:e.type,id:n.b64urldecode(e.id),transports:t}})),navigator.credentials.get({publicKey:t}).then(function(e){return{id:e.id,response:{clientDataJSON:n.b64urlencode(e.response.clientDataJSON),authenticatorData:n.b64urlencode(e.response.authenticatorData),signature:n.b64urlencode(e.response.signature),userHandle:e.response.userHandle&&n.b64urlencode(e.response.userHandle)}}}).catch(l)}}),define("modules/clean/deprecated_pyxl/controllers/login_form",["require","exports","tslib","jquery","modules/clean/abuse/invisible_captcha","modules/clean/deprecated_ajax/ajax_jquery","modules/core/exception","modules/clean/deprecated_pyxl/controllers/ajax_form","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/sso_login_checks","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/auth/authenticator","modules/clean/web_register_logging_data","modules/clean/react/fedramp/fedramp_util"],function(_,e,f,g,m,n,i,E,o,s,w,S,a,c,u,y,l,r,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),g=f.__importDefault(g),n=f.__importStar(n),E=f.__importDefault(E),o=f.__importDefault(o),S=f.__importStar(S),l=f.__importStar(l);var t=(p.prototype.ie8SafeFocus=function(e){try{e.focus()}catch(e){}},p.prototype.setFocusToPassword=function(){this.$loginForm.find("input[name='login_email']").first().val()&&this.ie8SafeFocus(this.$loginForm.find("input[name='login_password']")[0])},p.prototype.isRememberMeChecked=function(){return"on"===this.$loginForm.find("input[name='remember_me']:checked").val()},p.prototype.setFocusToTwofactor=function(){this.ie8SafeFocus(this.$twoFactorForm.find("input[name='code']").val(""))},p.prototype.googleLogin=function(){E.default.clear_errors(this.$loginForm);var e=this.isRememberMeChecked(),t=new s.ProfileServicesLinkingHandler,r=this.$googleAuthContainer.find(".auth-google").data("is-popup");t.auth_service_login_web(o.default.GOOGLE,this.googleLoginCallback.bind(this),"login_form",r?s.AuthWindowOption.POP_UP:s.AuthWindowOption.REDIRECT,e,this.cont,this.pairing)},p.prototype.appleLogin=function(){E.default.clear_errors(this.$loginForm);var e=this.isRememberMeChecked(),t=new s.ProfileServicesLinkingHandler,r=this.$appleAuthContainer.find(".auth-apple").data("is-popup");t.auth_service_login_web(o.default.APPLE,this.appleLoginCallback.bind(this),"login_form",r?s.AuthWindowOption.POP_UP:s.AuthWindowOption.REDIRECT,e,this.cont,this.pairing)},p.prototype.googleLoginCallback=function(e){var t,r;e.success?(u.Notify.success(c.intl.formatMessage({id:"Ce9FpX",defaultMessage:"Log in successful! Your browser will be redirected in a few seconds."})),n.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success"}}),t=d.getFedrampRedirectUrlIfApplicable(e.is_fedramp_user||!1,this.cont||"/h"),S.redirect(t)):(n.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error"}}),"emails_do_not_match_redirect"===e.err_msg?(r=this.getThirdPartyAuthUrl(e,!0),S.redirect(r)):"emails_do_not_match"===e.err_msg&&this.inlineGoogleLoginErrors&&!this.pairing?this.handleEmailsDoNotMatch(e):"tfa_required"===e.err_msg?this.redirectToPath(e,"/verify_code"):"enable_twofactor_required"===e.err_msg?this.redirectToPath(e,"/twofactor"):"not_verified"===e.err_msg?this.redirectToPath(e,"/show_password_form"):"email_not_verified"===e.err_msg?(r=c.intl.formatMessage({id:"S6RuBm",defaultMessage:"Before you can sign in, youâ€™ll need to verify your account with Google {email}"},{email:e.profile.email}),u.Notify.error(new a.HTML("<span>"+r+"</span>"),30)):(e.localized_error&&u.Notify.error(e.localized_error),"google_login_not_allowed"!==e.err_msg&&"sso_required"!==e.err_msg||this.fillInEmail(e.profile.email)))},p.prototype.appleLoginCallback=function(e){var t,r;e.success?(u.Notify.success(c.intl.formatMessage({id:"ZJmJez",defaultMessage:"Sign in successful! Your browser will be redirected in a few seconds."})),n.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success"}}),t=d.getFedrampRedirectUrlIfApplicable(e.is_fedramp_user||!1,this.cont||"/h"),S.redirect(t)):(n.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error"}}),"no_email_in_response"===e.err_msg?(r=c.intl.formatMessage({id:"oFA/9f",defaultMessage:"Sign in failed. If youâ€™d like to sign in with Apple again, <a>see how in our help center</a>. You could also sign in with your Dropbox account email and password."},{a:function(e){return'<a href="/help/accounts-billing/settings-sign-in/apple-sign-in-error">'+e+"</a>"}}),u.Notify.error(new a.HTML("<span>"+r+"</span>"),30)):"emails_do_not_match"===e.err_msg?(r=c.intl.formatMessage({id:"8cKJMG",defaultMessage:"We couldnâ€™t find a Dropbox account matching the email {email}. <a1>Sign up for a new account</a1> or <a2>get help signing in</a2> to an existing account."},{a2:function(e){return'<a href="/help/accounts-billing/settings-sign-in/sign-in-with-apple?_tk=sia_nomatch_help_web">'+e+"</a>"},a1:function(e){return'<a href="/individual/plans-comparison?_tk=sia_nomatch_plan_web">'+e+"</a>"},email:e.profile.email}),u.Notify.error(new a.HTML("<span>"+r+"</span>"),30)):"tfa_required"===e.err_msg?this.redirectToPath(e,"/verify_code"):"enable_twofactor_required"===e.err_msg?this.redirectToPath(e,"/twofactor"):"requires_password_on_first_link"===e.err_msg?this.redirectToPath(e,"/show_password_form"):e.localized_error&&u.Notify.error(e.localized_error))},p.prototype.handleEmailsDoNotMatch=function(e){e=this.getThirdPartyAuthUrl(e,!1);this.$googleAuthContainer.find(".third-party-signup-link").attr("href",e),this.$googleAuthContainer.find(".google-login-error").removeClass("u-l-dn")},p.prototype.getThirdPartyAuthUrl=function(e,t){t={fname:e.profile.given_name,lname:e.profile.family_name,email:e.profile.email,picture_url:e.profile.picture_url,refresh_token:e.refresh_token,email_sig:e.email_sig,automatic_redirect:t.toString(),cont:this.cont};this.signupTag&&(t.signup_tag=this.signupTag),this.signupEndpoint&&(t.signup_endpoint=this.signupEndpoint);t=r.setWebRegisterLoggingData(t);return String(new y.URI({path:"/third_party_signup"}).updateQuery(t))},p.prototype.fillInEmail=function(e){this.$loginForm.find("input[name='login_email']").val(e),this.$loginForm.find("input[name='login_email']").trigger("input"),this.setFocusToPassword()},p.prototype.redirectToPath=function(e,t){e=new y.URI({path:t}).updateQuery({cont:this.cont,remember_me:e.remember_me.toString(),pair_user:e.pair_user.toString()});S.redirect(e.toString())},p.prototype.beforeSubmit=function(){var t=this;if(null===this.encryption_options){var e=new Error("Must define encryption options to submit form");return i.reportException({err:e,severity:"critical",tags:["legacy-login-form"]}),Promise.reject(e)}var r=this.encryption_options,o=this.$loginForm.find("input[name='login_password']").val();return this.wrapPassword.then(function(e){return e(o,r).then(function(e){t.loginController.add_additional_data({login_password:"",encrypted_password:e})})}).catch(function(e){throw i.reportException({err:e,severity:"critical",tags:["legacy-login-form"]}),e})},p.prototype.showSso=function(e){this.$loginForm.find("input[name='login_password']").val(""),this.$loginForm.addClass("sso-required"),this.$rebrandLoginSubContainer.addClass("sso-required"),e&&(this.$loginForm.addClass("sso-optional"),this.$rebrandLoginSubContainer.addClass("sso-optional"))},p.prototype.hideSso=function(e){if(void 0===e&&(e=!1),this.$loginForm.removeClass("sso-required sso-optional"),this.$rebrandLoginSubContainer.removeClass("sso-required sso-optional"),e)try{this.$loginForm.find("input[name='login_password']").focus()}catch(e){}},p.prototype.browserSupportsU2f=function(e){return l.canUseAuthenticator(e)},p.prototype.showLogin=function(){this.$twoFactorForm.hide(),this.$loginForm.show(),this.$loginForm.find("input[name='login_password']").val(""),this.$googleAuthContainer.show()},p.prototype.setupTwoFactor=function(e){var t;!e.u2f_challenge||void 0!==(t=this.parseU2fChallenge(e.u2f_challenge))&&(this.$twoFactorForm=this.$twoFactorSeckeyForm,this.twoFactorController=this.twoFactorSeckeyController,this.signU2fChallenge(t)),e.last_two_digits?(this.$allTwoFactorForms.addClass("hide-authenticator"),this.$allTwoFactorForms.addClass("hide-other-authentication"),this.$twoFactorPhoneForm.find(".last-two-digits").text(e.last_two_digits)):e.use_email_2fa?(this.$allTwoFactorForms.addClass("hide-sms-info"),this.$allTwoFactorForms.addClass("hide-authenticator"),this.$twoFactorPhoneForm.find(".2fa-code-sent-location").text(c.intl.formatMessage({id:"FuPzY9",defaultMessage:"We sent a code to {email} and any devices youâ€™ve linked to this account. Enter the code to continue."},{email:e.email})),this.$twoFactorPhoneForm.addClass("hide-recovery-url"),this.$twoFactorPhoneForm.addClass("hide-remember-me")):(this.$allTwoFactorForms.addClass("hide-sms"),this.$allTwoFactorForms.addClass("hide-other-authentication")),this.$twoFactorForm.find("input[name='remember_me']").val(e.remember_me),e.remember_me&&this.$twoFactorForm.find("a[class='twofactor_recovery_url']").attr("href",function(e,t){return y.URI.parse(t).updateQuery({remember_me:"true"}).toString()}),this.showTwoFactor()},p.prototype.showTwoFactor=function(){this.$loginForm.hide(),this.$googleAuthContainer.hide(),this.$twoFactorForm.show(),this.setFocusToTwofactor()},p.prototype.loginSuccess=function(e,t){switch(t.status){case"OK":return this.finishLogin(t);case"DEVICE_LIMIT":return S.redirect(new y.URI({path:t.device_limit_url,query:{nonce:t.nonce||""}}));case"TWOFACTOR":return this.setupTwoFactor(t);case"TWOFACTOR_REQUIRED":case"TOS_SIGNATURE_REQUIRED":return S.redirect(t.cont);case"LOGIN_VIA_EMAIL_REQUIRED":var r=t.email,r=new y.URI({path:t.cont}).updateQuery({email:r});return S.redirect(r.toString());case"SSO":return S.unsafeRedirect(t.sso_url);case"RATELIMIT":return this.fillLoginError(c.intl.formatMessage({id:"7k/CMy",defaultMessage:"Youâ€™ve tried to log in too many times. Please try again in a few minutes."}));case"ERROR":r=t.html_response?new a.HTML(t.message):t.message;return u.Notify.error(r),this.loginController._clear_pending(!0);case"PASSWORD_EXPIRED":return this.fillLoginError(c.intl.formatMessage({id:"3EEu7s",defaultMessage:"The password of the account associated with this email has expired. Please login to this account and update its password before pairing."}));case"EXPIRED":return S.redirect(t.cont);default:return u.Notify.error(c.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))}},p.prototype.twoFactorSuccess=function(e,t){switch(t.status){case"OK":return this.$twoFactorSeckeyForm.find(".seckey-loading-status").toggle(),this.finishLogin(t);case"EXPIRED":case"INVALID_CREDENTIALS":case"REQUIRES_ROLE":return this.switchFromTwoFactorToLoginError(t.message);case"ERROR":return u.Notify.error(t.message);default:return u.Notify.error(c.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))}},p.prototype.switchFromTwoFactorToLoginError=function(e){this.twoFactorController._clear_pending(!0),this.loginController._clear_pending(!0),this.showLogin(),this.fillLoginError(e),this.setFocusToPassword()},p.prototype.resendCodeSuccess=function(e){switch(e){case"OK":return u.Notify.success(c.intl.formatMessage({id:"vdqTup",defaultMessage:"We sent you a code. It may take a few minutes to arrive."}));case"RATELIMIT":return this.fillTwoFactorError(c.intl.formatMessage({id:"7k/CMy",defaultMessage:"Youâ€™ve tried to log in too many times. Please try again in a few minutes."}));case"UNREACHABLE":return this.fillTwoFactorError(c.intl.formatMessage({id:"G6HUee",defaultMessage:"We couldnâ€™t reach your phone number. Are you sure itâ€™s correct?"}));case"EXPIRED":return this.fillTwoFactorError(c.intl.formatMessage({id:"l5AyQn",defaultMessage:"Sorry, your phone code has expired. Please log in again."}));case"BADCARRIER":return this.fillTwoFactorError(c.intl.formatMessage({id:"ffjRA4",defaultMessage:"Unfortunately, your carrier isnâ€™t supported at this time."}));case"INVALIDNUMBER":return this.fillTwoFactorError(c.intl.formatMessage({id:"1P05hM",defaultMessage:"That isnâ€™t a valid phone number."}));case"NOTAMOBILE":return this.fillTwoFactorError(c.intl.formatMessage({id:"aI/ARD",defaultMessage:"That phone number doesnâ€™t appear to be a valid mobile number."}));default:return u.Notify.error(c.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))}},p.prototype.resendCode=function(){return n.WebRequest({url:"/twofactor_resend",data:{backup:this.$twoFactorForm.find("input[name='backup']").val(),mobile_push:this.$twoFactorForm.find("input[name='mobile_push']").val()},success:this.resendCodeSuccess.bind(this),error:function(){return u.Notify.error(c.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))}}),!1},p.prototype.usePhoneInstead=function(){return this.$twoFactorSeckeyForm.hide(),this.$twoFactorPhoneForm.show(),this.$twoFactorForm=this.$twoFactorPhoneForm,this.$twoFactorPhoneForm.hasClass("hide-authenticator")&&this.resendCode(),this.setFocusToTwofactor(),!1},p.prototype.retryU2fChallenge=function(){var t=this;return n.WebRequest({url:"/account/twofactor/u2f_start_authentication",success:function(e){t.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions").toggle();e=t.parseU2fChallenge(e);void 0!==e&&t.signU2fChallenge(e)},error:function(){u.Notify.error(c.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))}}),!1},p.prototype.parseU2fChallenge=function(e){for(var t=JSON.parse(e),r={challenge_id:t.challenge_id},o=0,n=Object.keys(l.PROTOCOLS);o<n.length;o++){var i=n[o];r[i]=t[i]&&JSON.parse(t[i])}if(this.browserSupportsU2f(r))return r},p.prototype.signU2fChallenge=function(e){var t=this;l.sign(e).catch(function(e){return{error:e.toString()}}).then(function(e){t.$twoFactorSeckeyForm.find(".text-input-input").val(JSON.stringify(e)),t.$twoFactorSeckeyForm.submit()})},p.prototype.loginViaEmailStart=function(){var o=this;return E.default.clear_errors(this.$loginForm),n.WebRequest({url:"/ajax_login_via_email_start",data:{login_email:this.$loginForm.find("input[name='login_email']").val(),remember_me:this.isRememberMeChecked()},success:function(){u.Notify.success(c.intl.formatMessage({id:"ycHIQI",defaultMessage:"We emailed you a sign in link. Please check your inbox."}))},error:function(e,t,r){return E.default.fill_errors(o.$loginForm,JSON.parse(r))}}),!1},p.prototype.fillLoginError=function(e){E.default.fill_errors(this.$loginForm,{login_email:{message_text:e}})},p.prototype.fillTwoFactorError=function(e){E.default.fill_errors(this.$twoFactorForm,{code:{message_text:e}})},p.prototype.finishLogin=function(e){var t=this.$loginForm.find("input[type='hidden'][name=refresh_token]").val(),r=this.$loginForm.find("input[type='hidden'][name=email_sig]").val();t&&r&&n.WebRequest({url:"/profile_services/link_google_service_with_user",subject_user:e.id,data:{service:o.default.GOOGLE,refresh_token:t,email_sig:r}});r=this.multiLogin?p.MULTI_LOGIN_SUCCESS:p.LOGIN_SUCCESS;this.$loginForm.trigger(r,e);e=d.getFedrampRedirectUrlIfApplicable(e.is_fedramp_user,this.cont);e&&this.canRedirect&&S.redirect(e)},p.LOGIN_SUCCESS="db:login:success",p.MULTI_LOGIN_SUCCESS="db:multilogin:success",p);function p(t,e,r,o,n,i,s,a,c,u,l,d,p){var h=this;void 0===o&&(o=!1),void 0===n&&(n=!0),void 0===i&&(i=!1),void 0===s&&(s=null),void 0===a&&(a=null),void 0===c&&(c=!0),void 0===u&&(u=!0),void 0===l&&(l=!1),void 0===d&&(d=!1),void 0===p&&(p=null),this.loginType=e,this.inlineGoogleLoginErrors=i,this.signupTag=s,this.signupEndpoint=a,this.canRedirect=c,this.keepUrlFragment=u,this.useCurrentUri=l,this.multiLogin="multi"===this.loginType,this.pairing="pairing"===this.loginType,this.encryption_options=p,this.$loginForm=t.find(".login-form"),this.$rebrandLoginSubContainer=t.find(".login-form-container--subcontainer"),this.$googleAuthContainer=t.find(".login-form-container__google-div"),this.$appleAuthContainer=t.find(".login-form-container__apple-div"),this.$allTwoFactorForms=t.find(".two-factor-form"),this.$twoFactorPhoneForm=t.find(".two-factor-form.2fa-phone-form"),this.$twoFactorSeckeyForm=t.find(".two-factor-form.2fa-seckey-form"),this.$loginViaEmailForm=t.find(".login-via-email-link"),this.$twoFactorForm=this.$twoFactorPhoneForm,o||new Promise(function(e,t){_(["modules/clean/unity/features/web_destiny_ui"],e,t)}).then(f.__importStar).then(function(e){new e.default(t).maybe_show_web_destiny()}),this.wrapPassword=new Promise(function(e,t){_(["modules/clean/security/passwords"],e,t)}).then(f.__importStar).then(function(e){return e.wrapPassword}),this.loginController=new E.default(this.$loginForm,this.beforeSubmit.bind(this),{should_submit_once:!0}),m.loadCaptcha(this.loginController,this.$loginForm,"login_email","LOGIN",d),this.$loginForm.on(E.default.SUCCESS_EVENT,this.loginSuccess.bind(this)),this.$loginForm.on(E.default.ERROR_EVENT,function(e,t){return h.$loginForm.find(".login-via-email-blade-link").click(h.loginViaEmailStart.bind(h))});d=y.URI.parse(this.$loginForm.find("input[name='cont']").val());this.useCurrentUri&&(d=y.URI.parse(S.get_href())),this.keepUrlFragment&&d.setFragment(window.location.hash.substr(1)),this.cont=d.toString(),this.twoFactorPhoneController=new E.default(this.$twoFactorPhoneForm,function(){return null},{should_submit_once:!0}),this.twoFactorSeckeyController=new E.default(this.$twoFactorSeckeyForm,function(){return null},{should_submit_once:!0}),this.twoFactorController=this.twoFactorPhoneController,this.$twoFactorPhoneForm.on(E.default.SUCCESS_EVENT,this.twoFactorSuccess.bind(this)),this.$twoFactorSeckeyForm.on(E.default.SUCCESS_EVENT,this.twoFactorSuccess.bind(this)),this.$twoFactorSeckeyForm.on(E.default.ERROR_EVENT,function(e,t){return h.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions .error-msg").text(t.u2f.message_text),h.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions").toggle()}),this.$twoFactorPhoneForm.find(".resend-two-factor-code").click(this.resendCode.bind(this)),this.$twoFactorSeckeyForm.find(".two-factor-use-phone-instead").click(this.usePhoneInstead.bind(this)),this.$twoFactorSeckeyForm.find(".two-factor-seckey-retry").click(this.retryU2fChallenge.bind(this)),null!=this.$loginViaEmailForm&&this.$loginViaEmailForm.click(this.loginViaEmailStart.bind(this)),this.$googleAuthContainer.find(".auth-google").click(this.googleLogin.bind(this)),this.$googleAuthContainer.find(".auth-google").prop("disabled",!1),this.$appleAuthContainer.find(".auth-apple").click(this.appleLogin.bind(this)),this.$appleAuthContainer.find(".auth-apple").prop("disabled",!1);d=this.$twoFactorSeckeyForm.find("input[name='u2f_challenge']").val();!d||void 0!==(d=this.parseU2fChallenge(d))&&this.signU2fChallenge(d),this.$loginForm.find(".sso-optout a").click(function(){return h.hideSso(!0)}),this.$loginForm.find(".login-button").attr("disabled",null),this.$loginForm.find(".login-button.disabled-button").prop("disabled",!0),n&&t.find(".login-need-help a").click(function(e){e.preventDefault();var t=g.default(e.target).attr("href"),e=encodeURIComponent(h.$loginForm.find("input[name='login_email']").val());return S.redirect(t+"?email_from_login="+e)}),this.setFocusToPassword(),new w.SsoLoginChecks(this.$loginForm.find("input[name='login_email']"),this.showSso.bind(this),this.hideSso.bind(this))}e.default=t}),define("modules/clean/sso_login_checks",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SsoLoginChecks=void 0,n=r.__importStar(n);i.initClass=function(){this._sso_check_in_flight={},this._sso_check_cache={}},i.prototype._trigger_check_sso_state=function(){var e=this.$email_input.val();return this.check_sso_state(e)},i.prototype.check_sso_state=function(t){var r=this,e=t.trim();if(!e.match(/^[^@\s]+@[^@\s]+\.[A-Za-z]{2,}$/))return this.hide_sso_fn();var o=e.toLowerCase();return o in i._sso_check_cache?this._handle_sso_state(i._sso_check_cache[o]):i._sso_check_in_flight[o]?void 0:(i._sso_check_in_flight[o]=!0,n.WebRequest({url:"/sso_state",data:{email:e},success:function(e){return e=JSON.parse(e),delete i._sso_check_in_flight[o],i._sso_check_cache[o]=e.user_sso_state,r.should_trigger_check&&r.$email_input.val()!==t?r._trigger_check_sso_state():r._handle_sso_state(e.user_sso_state)},error:function(){return delete i._sso_check_in_flight[o],r.hide_sso_fn()}}))},i.prototype._handle_sso_state=function(e){return"required"===e?this.show_sso_fn(!1):"optional"===e?this.show_sso_fn(!0):this.hide_sso_fn()},r=i;function i(e,t,r,o){void 0===o&&(o=!0),this._trigger_check_sso_state=this._trigger_check_sso_state.bind(this),this.check_sso_state=this.check_sso_state.bind(this),this.$email_input=e,this.show_sso_fn=t,this.hide_sso_fn=r,this.should_trigger_check=o,this.should_trigger_check&&(this._trigger_check_sso_state(),this.$email_input.on("input keyup change",this._trigger_check_sso_state))}(t.SsoLoginChecks=r).initClass()}),define("modules/clean/web_register_logging_data",["require","exports","tslib","modules/core/browser","modules/core/transport/query_string_helpers"],function(e,t,r,o,n){"use strict";function i(){return{signupUrl:o.get_href(),signupReferrer:document.referrer,trackingParams:n.getTrackingParamsAsJSON()}}Object.defineProperty(t,"__esModule",{value:!0}),t.setWebRegisterLoggingData=t.getWebRegisterLoggingData=void 0,o=r.__importStar(o),t.getWebRegisterLoggingData=i,t.setWebRegisterLoggingData=function(e){void 0===e&&(e={});var t=i(),t={signup_url:t.signupUrl,signup_referrer:t.signupReferrer,tracking_params:t.trackingParams};return r.__assign(r.__assign({},e),t)}}),define("modules/clean/react/fedramp/fedramp_util",["require","exports","modules/core/uri"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFedrampRedirectUrlIfApplicable=void 0,t.getFedrampRedirectUrlIfApplicable=function(e,t){return e?String(new r.URI({path:"/fedramp_message"}).updateQuery({cont:t})):t}}),define("prod_assets_web_modules/u2f-api",["./common/_commonjsHelpers"],function(e){"use strict";var a,c=c||{},u=c;c.EXTENSION_ID="kmendfapggjehodndflmmgagdbamhnfd",c.MessageTypes={U2F_REGISTER_REQUEST:"u2f_register_request",U2F_REGISTER_RESPONSE:"u2f_register_response",U2F_SIGN_REQUEST:"u2f_sign_request",U2F_SIGN_RESPONSE:"u2f_sign_response",U2F_GET_API_VERSION_REQUEST:"u2f_get_api_version_request",U2F_GET_API_VERSION_RESPONSE:"u2f_get_api_version_response"},c.ErrorCodes={OK:0,OTHER_ERROR:1,BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5},c.getMessagePort=function(e){var t;"undefined"!=typeof chrome&&chrome.runtime?(t={type:c.MessageTypes.U2F_SIGN_REQUEST,signRequests:[]},chrome.runtime.sendMessage(c.EXTENSION_ID,t,function(){chrome.runtime.lastError?c.getIframePort_(e):c.getChromeRuntimePort_(e)})):c.isAndroidChrome_()?c.getAuthenticatorPort_(e):c.isIosChrome_()?c.getIosPort_(e):c.getIframePort_(e)},c.isAndroidChrome_=function(){var e=navigator.userAgent;return-1!=e.indexOf("Chrome")&&-1!=e.indexOf("Android")},c.isIosChrome_=function(){return-1<["iPhone","iPad","iPod"].indexOf(navigator.platform)},c.getChromeRuntimePort_=function(e){var t=chrome.runtime.connect(c.EXTENSION_ID,{includeTlsChannelId:!0});setTimeout(function(){e(new c.WrappedChromeRuntimePort_(t))},0)},c.getAuthenticatorPort_=function(e){setTimeout(function(){e(new c.WrappedAuthenticatorPort_)},0)},c.getIosPort_=function(e){setTimeout(function(){e(new c.WrappedIosPort_)},0)},c.WrappedChromeRuntimePort_=function(e){this.port_=e},c.formatSignRequest_=function(e,t,r,o,n){if(void 0===a||a<1.1){for(var i=[],s=0;s<r.length;s++)i[s]={version:r[s].version,challenge:t,keyHandle:r[s].keyHandle,appId:e};return{type:c.MessageTypes.U2F_SIGN_REQUEST,signRequests:i,timeoutSeconds:o,requestId:n}}return{type:c.MessageTypes.U2F_SIGN_REQUEST,appId:e,challenge:t,registeredKeys:r,timeoutSeconds:o,requestId:n}},c.formatRegisterRequest_=function(e,t,r,o,n){if(void 0===a||a<1.1){for(var i=0;i<r.length;i++)r[i].appId=e;for(var s=[],i=0;i<t.length;i++)s[i]={version:t[i].version,challenge:r[0],keyHandle:t[i].keyHandle,appId:e};return{type:c.MessageTypes.U2F_REGISTER_REQUEST,signRequests:s,registerRequests:r,timeoutSeconds:o,requestId:n}}return{type:c.MessageTypes.U2F_REGISTER_REQUEST,appId:e,registerRequests:r,registeredKeys:t,timeoutSeconds:o,requestId:n}},c.WrappedChromeRuntimePort_.prototype.postMessage=function(e){this.port_.postMessage(e)},c.WrappedChromeRuntimePort_.prototype.addEventListener=function(e,t){e=e.toLowerCase();"message"==e||"onmessage"==e?this.port_.onMessage.addListener(function(e){t({data:e})}):console.error("WrappedChromeRuntimePort only supports onMessage")},c.WrappedAuthenticatorPort_=function(){this.requestId_=-1,this.requestObject_=null},c.WrappedAuthenticatorPort_.prototype.postMessage=function(e){e=c.WrappedAuthenticatorPort_.INTENT_URL_BASE_+";S.request="+encodeURIComponent(JSON.stringify(e))+";end";document.location=e},c.WrappedAuthenticatorPort_.prototype.getPortType=function(){return"WrappedAuthenticatorPort_"},c.WrappedAuthenticatorPort_.prototype.addEventListener=function(e,t){"message"==e.toLowerCase()?window.addEventListener("message",this.onRequestUpdate_.bind(this,t),!1):console.error("WrappedAuthenticatorPort only supports message")},c.WrappedAuthenticatorPort_.prototype.onRequestUpdate_=function(e,t){var r=JSON.parse(t.data);r.intentURL,r.errorCode;t=null;e({data:t=r.hasOwnProperty("data")?JSON.parse(r.data):t})},c.WrappedAuthenticatorPort_.INTENT_URL_BASE_="intent:#Intent;action=com.google.android.apps.authenticator.AUTHENTICATE",c.WrappedIosPort_=function(){},c.WrappedIosPort_.prototype.postMessage=function(e){e=JSON.stringify(e),e="u2f://auth?"+encodeURI(e);location.replace(e)},c.WrappedIosPort_.prototype.getPortType=function(){return"WrappedIosPort_"},c.WrappedIosPort_.prototype.addEventListener=function(e,t){"message"!==e.toLowerCase()&&console.error("WrappedIosPort only supports message")},c.getIframePort_=function(t){var e="chrome-extension://"+c.EXTENSION_ID,r=document.createElement("iframe");r.src=e+"/u2f-comms.html",r.setAttribute("style","display:none"),document.body.appendChild(r);function o(e){"ready"==e.data?(n.port1.removeEventListener("message",o),t(n.port1)):console.error('First event on iframe port was not "ready"')}var n=new MessageChannel;n.port1.addEventListener("message",o),n.port1.start(),r.addEventListener("load",function(){r.contentWindow.postMessage("init",e,[n.port2])})},c.EXTENSION_TIMEOUT_SEC=30,c.port_=null,c.waitingForPort_=[],c.reqCounter_=0,c.callbackMap_={},c.getPortSingleton_=function(e){c.port_?e(c.port_):(0==c.waitingForPort_.length&&c.getMessagePort(function(e){for(c.port_=e,c.port_.addEventListener("message",c.responseHandler_);c.waitingForPort_.length;)c.waitingForPort_.shift()(c.port_)}),c.waitingForPort_.push(e))},c.responseHandler_=function(e){var t=e.data,r=t.requestId;r&&c.callbackMap_[r]?(e=c.callbackMap_[r],delete c.callbackMap_[r],e(t.responseData)):console.error("Unknown or missing requestId in response.")},c.isSupported=function(t){var r=!1;function o(e){r||(r=!0,t(e))}c.getApiVersion(function(e){a=void 0===e.js_api_version?0:e.js_api_version,o(!0)}),setTimeout(o.bind(null,!1),500)},c.sign=function(t,r,o,n,i){void 0===a?c.getApiVersion(function(e){a=void 0===e.js_api_version?0:e.js_api_version,console.log("Extension JS API Version: ",a),c.sendSignRequest(t,r,o,n,i)}):c.sendSignRequest(t,r,o,n,i)},c.sendSignRequest=function(o,n,i,s,a){c.getPortSingleton_(function(e){var t=++c.reqCounter_;c.callbackMap_[t]=s;var r=void 0!==a?a:c.EXTENSION_TIMEOUT_SEC,t=c.formatSignRequest_(o,n,i,r,t);e.postMessage(t)})},c.register=function(t,r,o,n,i){void 0===a?c.getApiVersion(function(e){a=void 0===e.js_api_version?0:e.js_api_version,console.log("Extension JS API Version: ",a),c.sendRegisterRequest(t,r,o,n,i)}):c.sendRegisterRequest(t,r,o,n,i)},c.sendRegisterRequest=function(o,n,i,s,a){c.getPortSingleton_(function(e){var t=++c.reqCounter_;c.callbackMap_[t]=s;var r=void 0!==a?a:c.EXTENSION_TIMEOUT_SEC,t=c.formatRegisterRequest_(o,i,n,r,t);e.postMessage(t)})},c.getApiVersion=function(o,n){c.getPortSingleton_(function(e){if(e.getPortType){var t;switch(e.getPortType()){case"WrappedIosPort_":case"WrappedAuthenticatorPort_":t=1.1;break;default:t=0}o({js_api_version:t})}else{var r=++c.reqCounter_;c.callbackMap_[r]=o;r={type:c.MessageTypes.U2F_GET_API_VERSION_REQUEST,timeoutSeconds:void 0!==n?n:c.EXTENSION_TIMEOUT_SEC,requestId:r};e.postMessage(r)}})};var t=e.createCommonjsModule(function(e,o){Object.defineProperty(o,"__esModule",{value:!0});var n="undefined"!=typeof navigator&&!!navigator.userAgent,i=n&&navigator.userAgent.match(/Safari\//)&&!navigator.userAgent.match(/Chrome\//),s=n&&navigator.userAgent.match(/Edge\/1[2345]/),t=null;function r(){return t=t||new Promise(function(t,e){function r(){t({u2f:null})}return!n||i?r():void 0!==window.u2f&&"function"==typeof window.u2f.sign?t({u2f:window.u2f}):s||"http:"===location.protocol||"undefined"==typeof MessageChannel?r():void u.isSupported(function(e){e?t({u2f:u}):r()})})}function a(e,t){var r=null!=t?t.errorCode:1,t=o.ErrorNames[""+r],e=new Error(e);return e.metaData={type:t,code:r},e}function c(e){if(!e.u2f){if("http:"===location.protocol)throw new Error("U2F isn't supported over http, only https");throw new Error("U2F not supported")}}o.ErrorCodes={OK:0,OTHER_ERROR:1,BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5},o.ErrorNames={0:"OK",1:"OTHER_ERROR",2:"BAD_REQUEST",3:"CONFIGURATION_UNSUPPORTED",4:"DEVICE_INELIGIBLE",5:"TIMEOUT"},o.isSupported=function(){return r().then(function(e){return!!e.u2f})},o.ensureSupport=function(){return r().then(c)},o.register=function(n,i,s){return Array.isArray(n)||(n=[n]),"number"==typeof i&&void 0===s&&(s=i,i=null),i=i||[],r().then(function(e){c(e);var o=e.u2f;return new Promise(function(t,r){var e=n[0].appId;o.register(e,n,i,function(e){e.errorCode?r(a("Registration failed",e)):(delete e.errorCode,t(e))},s)})})},o.sign=function(i,s){return Array.isArray(i)||(i=[i]),r().then(function(e){c(e);var n=e.u2f;return new Promise(function(t,r){var e=i[0].appId,o=i[0].challenge;n.sign(e,o,i,function(e){e.errorCode?r(a("Sign failed",e)):(delete e.errorCode,t(e))},s)})})}}),r=e.createCommonjsModule(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),function(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}(t),r.default=t});return e.getDefaultExportFromCjs(r)});
