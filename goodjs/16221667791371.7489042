define(function(){"use strict";var i={itemWrapperSelector:".lb-item-wrapper",itemWrapperIdPrefix:"lb-item-expander-wrapper-",itemWrapperIdSelectorPrefix:"#lb-item-expander-wrapper-",accordionSelector:".lb-item-expander-accordion",accordionClass:"lb-item-expander-accordion",accordionIdPrefix:"lb-item-expander-accordion-",accordionIdSelectorPrefix:"#lb-item-expander-accordion-",contentSelector:".lb-item-expander-content",contentIdPrefix:"lb-item-expander-content-",contentIdSelectorPrefix:"#lb-item-expander-content-",iconHeightBuffer:80,itemExpanderRowClass:"lb-item-expander-row",itemExpanderRowIdPrefix:"lb-item-expander-row-",itemExpanderRowIdSelectorPrefix:"#lb-item-expander-row-",triggerSelector:".lb-trigger",triangleSelector:".lb-triangle",triangleGridSizeSelector:"> .lb-triangle",triangleOffset:8,activeClass:"lb-active"},o=0;function e(t){this.$elem=$(t),this.options=$.extend({},i,this.$elem.data()),this.containersToAccordions={},this.activeAccordions={},this.openedOnce=!1,this.$itemWrappers=this.$elem.find(this.options.itemWrapperSelector),this.options.accordionIdPrefix+=o,this.options.accordionIdSelectorPrefix+=o,this.options.contentIdPrefix+=o,this.options.contentIdSelectorPrefix+=o,this.options.itemExpanderRowIdPrefix+=o,this.options.itemExpanderRowIdSelectorPrefix+=o,this.options.itemWrapperIdPrefix+=o,this.options.itemWrapperIdSelectorPrefix+=o,o++,this.checkExpanderLayoutType(),this.bindResizeHandler(),this.closeAllContent(),this.createContentAccordions(),this.moveContentContainers(),this.createAccordionTriggerArrows(),this.scrollHandler=this.bindScrollHandler(),this.bindClickHandler();var e=this;setTimeout(function(){e.openFirstItemOnce()},500)}return e.prototype={checkExpanderLayoutType:function(){if($(this.$itemWrappers[0]).find(this.options.triggerSelector).outerWidth()!==this.$elem.width())return this.isAccordion=!1,void(this.isInOrFromGrid=!0);this.isAccordion=!0},moveContentContainers:function(){for(var t=0,e=this.$itemWrappers.length,i=0,o=Math.round(this.$elem.width()/$(this.$itemWrappers[0]).find(this.options.triggerSelector)[0].offsetWidth),r=0;r<e;r++)if(i===o){for(var s=t;s<r;s++)$(this.options.accordionIdSelectorPrefix+(r-1)).append($(this.options.contentIdSelectorPrefix+s)),$(this.options.itemExpanderRowIdSelectorPrefix+(r-1)).append($(this.options.itemWrapperIdSelectorPrefix+s)),$(this.options.itemExpanderRowIdSelectorPrefix+(r-1)).append($(this.options.accordionIdSelectorPrefix+s)),this.containersToAccordions[s]=r-1;this.iconEqualHeights($(this.options.itemExpanderRowIdSelectorPrefix+(r-1))),t=r,i=1}else i++;for(var n=t;n<e;n++)$(this.options.accordionIdSelectorPrefix+(e-1)).append($(this.options.contentIdSelectorPrefix+n)),$(this.options.itemExpanderRowIdSelectorPrefix+(e-1)).append($(this.options.itemWrapperIdSelectorPrefix+n)),$(this.options.itemExpanderRowIdSelectorPrefix+(e-1)).append($(this.options.accordionIdSelectorPrefix+n)),this.containersToAccordions[n]=e-1,this.iconEqualHeights($(this.options.itemExpanderRowIdSelectorPrefix+(e-1)))},createContentAccordions:function(){for(var t=0,e=this.$itemWrappers.length;t<e;t++){var i=$(this.$itemWrappers[t]);i.attr("data-id",t),i.attr("id",this.options.itemWrapperIdPrefix+t),i.find(this.options.contentSelector).attr("id",this.options.contentIdPrefix+t),$('<div class="'+this.options.accordionClass+'" id="'+this.options.accordionIdPrefix+t+'" />').insertAfter(i),$('<div class="'+this.options.itemExpanderRowClass+'" id="'+this.options.itemExpanderRowIdPrefix+t+'" />').insertAfter(i)}},openItem:function(t){this.openedOnce=!0,$(window).off("scroll.aws_item-expander_open",this.scrollHandler);var e=t.closest(this.options.triggerSelector),i=t.closest(this.options.itemWrapperSelector).attr("data-id"),o=this.containersToAccordions[i],t=$(this.options.contentIdSelectorPrefix+i),i=$(this.options.accordionIdSelectorPrefix+o);!this.isAccordion&&this.activeAccordions.hasOwnProperty(o)?(this.$elem.find(this.options.contentSelector).removeClass(this.options.activeClass),this.$elem.find(this.options.triggerSelector).removeClass(this.options.activeClass),t.addClass(this.options.activeClass),i.outerHeight(t.outerHeight())):this.isAccordion&&this.activeAccordions.hasOwnProperty(o)?(e.removeClass(this.options.activeClass),this.$elem.find(this.options.contentSelector).removeClass(this.options.activeClass),this.closeAllContent()):(this.closeAllContent(),this.isAccordion&&e.addClass(this.options.activeClass),t.addClass(this.options.activeClass),i.show().outerHeight(t.outerHeight()),this.activeAccordions={},this.activeAccordions[o]=!0),this.isAccordion||this.setTriggerArrow(e,i)},setTriggerArrow:function(t,e){t=t.position().left+t.outerWidth()/2-this.options.triangleOffset,e=e.position().top-this.options.triangleOffset;this.$elem.find(this.options.triangleGridSizeSelector).css({top:e,left:t}).show()},createAccordionTriggerArrows:function(){var t=this.$elem.find(this.options.triangleSelector);this.$elem.find(this.options.triggerSelector).each(function(){t.clone().appendTo(this)})},closeAllContent:function(){this.activeAccordions={},this.$elem.find(this.options.accordionSelector).hide().css("height",0),this.$elem.find(this.options.contentSelector).removeClass(this.options.activeClass),this.$elem.find(this.options.triggerSelector).removeClass(this.options.activeClass),this.isAccordion||this.$elem.find(this.options.triangleSelector).hide()},openFirstItemOnce:function(){var t;this.openedOnce||this.isAccordion||!this.isInViewport(this.$elem)||(t=this.$elem.find(this.options.triggerSelector).first(),this.openItem(t),this.setActiveTrigger(t))},setActiveTrigger:function(t){t=t.closest(this.options.triggerSelector);this.isAccordion||t.hasClass(this.options.activeClass)||t.addClass(this.options.activeClass)},bindClickHandler:function(){var e=this;this.$elem.on("click.aws_item-expander_open",this.options.triggerSelector+":not([href])",function(t){e.openItem($(t.target)),e.setActiveTrigger($(t.target)),e.isAccordion&&$("html, body").animate({scrollTop:$(this).offset().top},200)})},bindResizeHandler:function(){var e=this,i=0;$(window).on("resize.aws_item-expander_close-all",function(){var t=++i;setTimeout(function(){t===i&&(e.checkExpanderLayoutType(),e.isInOrFromGrid&&e.closeAllContent(),e.isAccordion&&(e.isInOrFromGrid=!1),e.moveContentContainers())},40)})},bindScrollHandler:function(){function t(){var t=++o;setTimeout(function(){t===o&&i.openFirstItemOnce()},e)}var e=40,i=this,o=0;return $(window).on("scroll.aws_item-expander_open",t),t},iconEqualHeights:function(t){var e=this,i=0;t.find(e.options.triggerSelector).each(function(){var t=$(this).find("span").outerHeight(),t=e.options.iconHeightBuffer+t;i=Math.max(i,t),$(this).css("height",i)})},isInViewport:function(t){var e=$(window),i=t.offset().top,o=t.outerHeight(),r=i+o,s=e.scrollTop(),t=s+e.height(),e=i+80*o/100,o=r-80*o/100;return s<=e&&e<=t&&s<=i&&i<=t||s<=o&&o<=t&&s<=r&&r<=t||i<=s&&t<=r}},Libra.Comp.register({name:"item-expander-cortex",initFct:function(t){new e(t)},initTime:"documentReady"}),e});
