define(["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(c,e,r,n){var l=e.init("externalLink");c.widget("cnet.externalLink",c.fly.base,{options:{appendViewguid:!0,externalLinkSelector:"a[data-component=externalLink]"},viewguid:null,commerceClickPlaceholder:"___COM_CLICK_ID___",_create:function(){this._setup(),this.viewguid=n.guid,this.isCommerce=this.$element.attr("href").includes(this.commerceClickPlaceholder),this.options.appendViewguid&&this.viewguid&&this.$element.attr("href",this.$element.attr("href").replace("___VIEW_GUID___",this.viewguid)),this._setupEvents(),window.externalLink=!0},_setupEvents:function(){var a=this;this.$element.on("mousedown",function(e){if(0==e.button||1==e.button||2==e.button){l.log("External link clicked.");try{var t,i;a._setCommerceClickId(),n.tracking.data.commerceClickId&&c(this).attr("href").includes(a.commerceClickPlaceholder)?(c(this).attr("href",c(this).attr("href").replace(a.commerceClickPlaceholder,n.tracking.data.commerceClickId.replaceAll("-",""))),t=c(this).parent()[0].classList.value,i={articleId:n.tracking.data.articleId||"",commerceClickId:n.tracking.data.commerceClickId||"",dwLinkTag:"transformed-regular-link",eventTarget:(t?"."+t.replaceAll(" ",".")+" ":"")+a.options.externalLinkSelector,eventObject:e,formatType:"LINK",pageId:n.tracking.data.articleId||"",text:c(this).text()},r.trackLead(i)):r.trackExternalLink({clickGenericText:"trackExternalLink"}),setTimeout(c.proxy(function(){n.tracking.data.commerceClickId&&c(this).attr("href",c(this).attr("href").replace(n.tracking.data.commerceClickId.replaceAll("-",""),a.commerceClickPlaceholder))},this),500)}catch(e){l.log("Unable to parse tracking url",e)}}})},_setCommerceClickId:function(){var e=window.uuid();utag_data.commerceClickId=e,n.tracking.data.commerceClickId=e}})});
