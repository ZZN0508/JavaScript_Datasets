!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tmgrefresh=t():e.tmgrefresh=t()}(this,function(){return o={"../node_modules/jwt-decode/lib/atob.js":function(e,t){function a(e){this.message=e}(a.prototype=new Error).name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,n,r=0,i=0,c="";n=t.charAt(i++);~n&&(o=r%4?64*o+n:n,r++%4)&&(c+=String.fromCharCode(255&o>>(-2*r&6))))n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return c}},"../node_modules/jwt-decode/lib/base64_url_decode.js":function(e,t,o){var n=o("../node_modules/jwt-decode/lib/atob.js");e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(n(t).replace(/(.)/g,function(e,t){t=t.charCodeAt(0).toString(16).toUpperCase();return"%"+(t=t.length<2?"0"+t:t)}))}catch(e){return n(t)}}},"../node_modules/jwt-decode/lib/index.js":function(e,t,o){"use strict";var n=o("../node_modules/jwt-decode/lib/base64_url_decode.js");function r(e){this.message=e}(r.prototype=new Error).name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new r("Invalid token specified");t=!0===(t=t||{}).header?0:1;try{return JSON.parse(n(e.split(".")[t]))}catch(e){throw new r("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=r},"./src/index.js":function(e,t,o){"use strict";o.r(t);var t=o("../node_modules/jwt-decode/lib/index.js"),i=o.n(t);function c(t){var e="",o=document.cookie.split("; ").filter(function(e){return 0===e.indexOf(t)})[0];return e=o?o.substring((t+"=").length):e}function a(e,t,o){var n=[];n.push(e+"="+t),n.push("path=/"),n.push("expires="+o),n.push("domain=telegraph.co.uk"),n.push("SameSite=None;Secure"),document.cookie=n.join(";")}function s(e,t){var o=c("tmg_p13n"),n=JSON.parse(o.replace(/(\w+)\s*:/g,'"$1":')),r=n.pId,i=e&&e.profile,o="subscribed"===i.readerType||"subscriber"===i.readerType,e=t.allowWinback;i?(n.readerType=i.readerType,n.subscriber=""+o,n.allowWinback=e?""+e:"false",r=r,!t||t.subscriber===o||window.fetch&&window.fetch("https://api.telegraph.co.uk/commerce/accounts/"+r+"/status",{mode:"cors",method:"DELETE",cache:"no-cache",headers:{ddgFlow:"transformation_refresh",ddgAction:"invalidate_cache"}}).catch(console.error),o?n.subscriptionType=t.subscriptionType:n.subscriptionType&&delete n.subscriptionType,t=JSON.stringify(n).replace(/"(\w+)"\s*:/g,"$1:"),(n=new Date).setTime(n.getTime()+94608e7),a("tmg_p13n",t,n.toGMTString()),window.fetch&&window.fetch("https://api.telegraph.co.uk/userstore/cookies",{credentials:"include",mode:"cors",method:"POST",cache:"no-cache"}).then(function(){},function(){})):console.error("no user data")}function n(e,t){var o=t||864e5,t=window&&window.localStorage&&window.localStorage.getItem(e);if(t){t=new Date(t);if((new Date).getTime()-t.getTime()<o)return}return window&&window.localStorage&&window.localStorage.setItem(e,(new Date).toUTCString()),1}(o=c("tmg_refresh"))?((t=c("_utp"))&&n("_utprefreshdate",864e5)||!t&&n("no_utprefreshdate",6e5))&&window.fetch&&window.fetch("https://api.telegraph.co.uk/identity/tokens",{mode:"cors",method:"POST",cache:"no-cache",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",ddgFlow:"transformation_refresh",ddgAction:"autologin"},body:JSON.stringify({grant_type:"refresh_token",client_id:"tcuk",remember_me:!0,refresh_token:o})}).then(function(e){201===e.status?e.json().then(function(e){var t,o,n,r=e.id_token;t=i()(r),(r=c("tmg_p13n"))&&(r=JSON.parse(r.replace(/(\w+)\s*:/g,'"$1":')).pId,o=t,n=s,window.fetch&&window.fetch("https://api.telegraph.co.uk/commerce/accounts/"+r+"/status",{mode:"cors",method:"GET",cache:"no-cache",headers:{ddgFlow:"transformation_refresh",ddgAction:"refresh_p13n"}}).then(function(e){return e.json()}).then(function(e){n&&n(o,e)}).catch(console.error)),e.piano_id_access_token&&(r=new Date(1e3*e.piano_id_access_token_expires_in),a("_utp",e.piano_id_access_token,r.toUTCString()),window&&window.localStorage&&window.localStorage.setItem("_utprefreshdate",(new Date).toUTCString()))}):console.warn(e)}).catch(function(e){console.log(e)}):console.log("No tmg_refresh")}},n={},r.m=o,r.c=n,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/index.js");function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var o,n});
