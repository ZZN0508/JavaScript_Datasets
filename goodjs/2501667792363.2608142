"undefined"!=typeof window&&function(p,h){"use strict";var v,T,s,u,a,S,c,w,F,A,r,e,C,P,E,R,y,N,Y,b,o,M,l,x,n,d,g,m;function D(e){for(var t,r,n,o,i,a,s,u=navigator.userAgent,c=navigator.appVersion,l=v.timing,d=l.navigationStart,g=0,m=0,f={log:{version:"1.2",creator:{name:"YAFT",version:"0.1.0"},browser:{name:u,version:c},pages:[{startedDateTime:new Date(d).toISOString(),id:"Page_1",title:h.location.href,pageTimings:{onContentLoad:l.domInteractive-d,onLoad:l.loadEventStart-d}}],entries:[],comment:""}},p=0;p<e.length;p+=1)r=e[p],t=new Date(Math.round(d+r.start)),n=Math.round(r.dnsDuration),o=Math.round(r.tcpDuration),s=Math.round(r.sslDuration),i=Math.round(r.responseStart-r.requestStart),a=Math.round(r.responseDuration),g=Math.round(r.duration)-n-o-i-a,m=Math.round(r.duration),g<0&&(m-=g,g=0),r={pageref:"Page_1",startedDateTime:t.toISOString(),time:m,request:{method:"GET",url:r.url,httpVersion:"HTTP/1.1",cookies:[],headers:[],queryString:[],headersSize:-1,bodySize:-1},response:{status:"200",statusText:"OK",httpVersion:"HTTP/1.0",cookies:[],headers:[],content:{size:-1,compression:0,mimeType:""},redirectURL:"",headersSize:-1,bodySize:-1},cache:{},timings:{blocked:-1,dns:n,connect:o,send:i,ssl:s,wait:g,receive:a}},f.log.entries.push(r);return f}function L(){var e,t,r,n,o,i,a=[],s=[];for(a.push((n=v.timing,o=v.getEntries("resource")[0],{url:h.location.href,start:0,transferSize:void 0!==o.transferSize?o.transferSize:-1,duration:n.responseEnd-n.navigationStart,durationFromNStart:n.responseEnd-n.navigationStart,redirectStart:0===n.redirectStart?0:n.redirectStart-n.navigationStart,redirectDuration:n.redirectEnd-n.redirectStart,appCacheStart:0,appCacheDuration:0,dnsStart:n.domainLookupStart-n.navigationStart,dnsDuration:n.domainLookupEnd-n.domainLookupStart,tcpStart:n.connectStart-n.navigationStart,tcpDuration:n.connectEnd-n.connectStart,sslStart:0<n.secureConnectionStart?n.secureConnectionStart-n.connectStart:0,sslDuration:0<n.secureConnectionStart?n.connectEnd-n.secureConnectionStart:-1,requestStart:n.requestStart-n.navigationStart,requestDuration:n.responseStart-n.requestStart,responseStart:n.responseStart-n.navigationStart,responseDuration:n.responseEnd-n.responseStart})),s=v.getEntriesByType("resource"),e=0;e<s.length;e+=1)"document"!==s[e].name&&a.push(O(s[e]));if((r=document.getElementsByTagName("iframe"))&&r.length){for(t=0;t<r.length;t+=1)try{for(s=r[t].contentWindow.performance.getEntriesByType("resource"),i=r[t].contentWindow.performance.timing.navigationStart-v.timing.navigationStart,e=0;e<s.length;e+=1)"document"!==s[e].name&&a.push(O(s[e],i))}catch(e){}a.sort(function(e,t){return e.start-t.start})}return a}function O(e,t){return{url:e.name,start:e.startTime+(t=!(t&&0<t)?0:t),duration:e.duration,transferSize:void 0!==e.transferSize?e.transferSize:-1,durationFromNStart:0<e.duration?e.duration+e.startTime+t:e.startTime+t,redirectStart:e.redirectStart+t,redirectDuration:e.redirectEnd-e.redirectStart,appCacheStart:0,appCacheDuration:0,dnsStart:e.domainLookupStart+t,dnsDuration:e.domainLookupEnd-e.domainLookupStart,tcpStart:e.connectStart+t,tcpDuration:e.connectEnd-e.connectStart,sslStart:0<e.secureConnectionStart?e.secureConnectionStart-e.connectStart:0,sslDuration:0<e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:-1,requestStart:e.requestStart+t,requestDuration:e.responseStart-e.requestStart,responseStart:e.responseStart+t,responseDuration:0===e.responseStart?0:e.responseEnd-e.responseStart}}function I(){return{win:p,doc:h,docElem:e,viewportWidth:e.clientWidth<p.innerWidth?p.innerWidth:e.clientWidth,viewportHeight:e.clientHeight<p.innerHeight?p.innerHeight:e.clientHeight,getScrollXY:function(){return{x:p.scrollX||p.pageXOffset,y:p.scrollY||p.pageYOffset}},getViewportArea:function(){return this.viewportWidth*this.viewportHeight},getElementBounds:function(e){var t=e,e=this.getScrollXY();return(t=function e(t){var r,n={};for(r in t)"object"==typeof t[r]&&null!==t[r]?n[r]=e(t[r]):n[r]=t[r];return n}(t.getBoundingClientRect())).top=t.top+e.y,t.bottom=t.bottom+e.y,t.left=t.left+e.x,t.right=t.right+e.x,t},isInViewport:function(e,t){var r=this.getElementBounds(e);return r.top<this.viewportHeight&&r.left<this.viewportWidth&&0<=r.bottom&&0<=r.right&&this.isVisible(e,t)},isVisible:function(e,t){var r=!0,n=e;if((r=r&&0<n.offsetWidth&&0<n.offsetHeight)&&!t)for(;"BODY"!==n.tagName&&r;)r=r&&"hidden"!==p.getComputedStyle(n).visibility,n=n.parentElement;return r},getElementCoverage:function(e){var t,r,n=this.getElementBounds(e);return(n=100*(e=(t=n.right<0?0:n.right>this.viewportWidth?0<=n.left?this.viewportWidth-n.left:this.viewportWidth:n.left<0&&0<n.right?n.right:n.width)*(r=n.bottom<0?0:n.bottom>this.viewportHeight?0<=n.top?this.viewportHeight-n.top:this.viewportHeight:n.top<0&&0<n.bottom?n.bottom:n.height))/this.getViewportArea())<1&&(n=Math.ceil(n)),{x:t,y:r,elCoverage:e,elCoveragePerc:n}}}}function q(e,t,r){var n,o,i,a,s,u,c=!1,l=[];for(e=e||[],t&&!r?l=t:!t&&r?l=r:t&&r&&(l=t.concat(r)),l&&l.length&&l.length,n=0,s=e.length;n<s;n+=1)for(i=e[n],o=(a=h.querySelectorAll(YAFT.getModuleSelector(i,C.usePrefixRegex))).length-1;0<=o;o--)u=YAFT.getModuleName(a[o]),c=!1,(c=-1!==l.indexOf(u)?!0:c)||Y[u]||(a[o].modName=u,Y[u]=a[o]);return Y}function B(e,t){var r,n;for(n in e)e.hasOwnProperty(n)&&(o[n]||(r=i(e[n]),t&&!r.isAft2Module||(o[n]=r)));return o}function i(e,t){var r,n,o,i,a=!1,s=function(e,t){for(var r=!1;t.parentNode;){if(t.parentNode.id&&-1!==e.indexOf(t.parentNode.id)){r=!0;break}t=t.parentNode}return r}(C.modulesAft2Container,e),u=C.customReportModules&&-1!==C.customReportModules.indexOf(e.modName),c=[],l=v.now(),l=s?l-M:l,d=M?x:C.useNativeStartRender?P||YAFT.getStartRenderTime():S?v.timing.domContentLoadedEventStart-A:0,g=u?l:d,m=e.querySelectorAll(C.whiteListedContainerElements.join()),f=m.length;if(t)a=!0,d=t.modStart||d,g=t.modEnd||g,M&&(M<d?d-=M:d=0,M<g?g-=M:g=0);else if(0<M&&!s)g=d=0;else if(u)a=!0;else{if((o=YAFT.getElemResourceUrl(e))&&(i=v.getEntriesByName(o))&&i.length&&0<i.length&&T.isInViewport(e)&&c.push(O(i[0])),m&&0<f)for(r=0;r<f;r+=1)n=m[r],(o=YAFT.getElemResourceUrl(n))&&(i=v.getEntriesByName(o))&&i.length&&0<i.length&&T.isInViewport(n)&&c.push(O(i[0]));if(0<(f=c.length))for(r=0;r<f;r+=1)0<M&&s&&(c[r].start-=M,c[r].durationFromNStart-=M,c[r].start<=0&&(c[r].start=d),c[r].durationFromNStart<=0&&(c[r].durationFromNStart=g)),c[r].start>d&&(d=c[r].start),c[r].durationFromNStart>g&&(g=c[r].durationFromNStart)}return u=T.getElementCoverage(e),{isCustom:a,isAft2Module:s,start:d,loadTime:g,name:e.modName,resources:c,inViewPort:a?T.isInViewport(e,!0):T.isInViewport(e,!1),coverageWidth:u.x,coverageHeight:u.y,coverageArea:u.elCoverage,coveragePercentage:u.elCoveragePerc}}function k(e){var t,r,n=0;for(t in e)e.hasOwnProperty(t)&&(r=e[t].coveragePercentage,e[t].inViewPort&&0<Math.round(r)&&(n+=r));return n}function z(e){for(var t=e.length,r=0;r<t;r+=1)if(C.useNormalizeCoverage){if(Math.round(e[r])===Math.round(R))return 100*r}else if(Math.round(e[r])===Math.round(E))return 100*r;return 0}function V(e){for(var t,r=0,n=v.now()-M,o=Math.floor(n/100),i=new Array(o),a=0,s=0;s<o;s+=1)i[s]=0;for(t in s=0,e)e.hasOwnProperty(t)&&e[t].inViewPort&&0<Math.round(e[t].coveragePercentage)&&(C.useNormalizeCoverage&&(e[t].normCoveragePercentage=e[t].coveragePercentage/E*100,a+=e[t].normCoveragePercentage),0<=e[t].loadTime&&(i[s=Math.round(e[t].loadTime/100)]+=C.useNormalizeCoverage?e[t].normCoveragePercentage:e[t].coveragePercentage));for(C.useNormalizeCoverage?r+=a-i[0]:r+=E-i[0],s=1;s<o;s+=1)i[s]=i[s-1]+i[s],C.useNormalizeCoverage?r+=a-i[s]:r+=E-i[s];return{aft:r,aftIntervals:i,normTotalCoveragePercentage:a}}function t(){m.push(v.now()),g&&m.length<300&&(u=p.requestAnimationFrame(t))}function f(e,t){var r,n,o,i,a,s=YAFT.getPageLoadTime(),u=YAFT.getDomContentLoaded(),c=YAFT.getDomElementsCount(),l=YAFT.getTTFB(),d=YAFT.getDomInteractive(),g={},m=[],f=[];if(P=YAFT.getStartRenderTime(),(N=L())&&N.length&&0<N.length){if(C.preProcess&&"function"==typeof C.preProcess&&C.preProcess(),C.plugins)for(i=0;i<C.plugins.length;i+=1)window["yaft_"+C.plugins[i].name]&&window["yaft_"+C.plugins[i].name].execute?C.plugins[i].isPre?(m.push(C.plugins[i]),YAFT.logToConsole("YAFT plugin "+C.plugins[i].name+" will be executed before the callback")):(f.push(C.plugins[i]),YAFT.logToConsole("YAFT plugin "+C.plugins[i].name+" will be executed after the callback")):YAFT.logToConsole("YAFT plugin "+C.plugins[i].name+" not found or it does not have execute method");for(T=T||I(),q(C.modules,C.modulesExclude,C.modulesAft2Container),B(Y),o=YAFT.getFinalModulesReport(),E=k(o),n=V(o),R=n.normTotalCoveragePercentage,(a=N.slice(0)).sort(function(e,t){return t.duration-e.duration}),a=function(e){var t={},r=0,n=0,o=YAFT.getPageLoadTime(),i=0,a=0;for(t.count=e.length,r=0;r<t.count;r+=1)e[r].start<=o&&(i+=1),e[r].duration<=0&&(n+=1,e[r].start<=o&&(a+=1));return t.cached=n,t.nonCached=t.count-n,t.onloadCount=i,t.onloadCached=a,t.onloadNonCached=i-a,t}(y=a),b=z(n.aftIntervals),C.generateHAR&&(g=D(N)),r={aft:n.aft,pageLoadTime:s,startRender:P,domInteractive:d,domContentLoaded:u,ttfb:l,event:e,modulesReport:o,totalCoveragePercentage:E,normTotalCoveragePercentage:R,domElementsCount:c,resources:N,har:g,costlyResources:y,httpRequests:a,visuallyComplete:b},i=0;i<m.length;i+=1)try{window["yaft_"+m[i].name].execute(m[i].config,r)}catch(e){YAFT.logToConsole("YAFT plugin "+m[i].name+" failed to execute"),YAFT.logToConsole(e)}for(t&&(YAFT.logToConsole(r),YAFT.logToConsole(n.aftIntervals),t(r)),YAFT.data.push(r),i=0;i<f.length;i+=1)try{window["yaft_"+f[i].name].execute(f[i].config,r)}catch(e){YAFT.logToConsole("YAFT plugin "+f[i].name+" failed to execute"),YAFT.logToConsole(e)}!0===w&&C.canShowVisualReport&&p.YAFT_REPORT&&p.YAFT_REPORT.drawReport&&p.YAFT_REPORT.drawReport(r,n.aftIntervals),F&&C.canShowPerfBar&&p.YAFT_PERFBAR.drawReport&&p.YAFT_PERFBAR.drawReport(r)}else t(null,"No timings available")}function W(){return p.performance||p.webkitPerformance||p.msPerformance||p.mozPerformance||p.Performance}void 0===p.YAFT&&(F=!(w=c=S=a=!1),A=(new Date).getTime(),r=!1,e=h.documentElement,C={usePrefixRegex:!0,useNormalizeCoverage:!0,canShowVisualReport:!0,canShowPerfBar:!1,useNativeStartRender:!0,useNativeStartRenderMeaningful:!1,generateHAR:!1,maxWaitTime:3e3,modules:[],modulesExclude:[],modulesAft2Container:[],customReportModules:[],includeOnlyAft2:!1,plugins:[],whiteListedContainerElements:["div","section","ul","ol","li","header","img","a","video","figure","span","picture"],customStartRender:!1,preProcess:!1,getAccurateFirstPaint:!0,fpsMinSampleCount:15,fpsMissLimit:18,preferDataModNameOverId:!1},y=[],N={},Y={},d=n=x=l=M=b=R=E=P=0,g=!(o={}),m=[],(v=W())&&v.timing&&(A=v.timing.navigationStart,v.now=v.now||v.webkitNow||v.msNow||v.mozNow||void 0,v.now&&(void 0===v.getEntriesByType&&void 0===v.webkitGetEntriesByType||void 0===v.getEntriesByName&&void 0===v.webkitGetEntriesByName||(S=!0),p.requestAnimationFrame&&p.cancelAnimationFrame&&(c=!0))),p.YAFT={data:[],triggerPerf:function(e,t){if(!r&&a){if(r=!0,!S)return t(null,"Nav or resource timing or both are not available"),!1;C.maxWaitTime&&0<C.maxWaitTime?n=setTimeout(function(){f(e,t)},C.maxWaitTime):f(e,t)}},triggerCustomTiming:function(e,t,r){if(!S)return!1;var n;YAFT.isInitialized()&&(T=T||I(),(n=h.querySelector(YAFT.getModuleSelector(e,!1)))&&(e=YAFT.getModuleName(n),n.modName=e,-1===C.modulesExclude.indexOf(e)&&(n=(e=Y[e]=n).modName,o[n]=i(e,{modStart:t,modEnd:r}))))},getFinalModulesReport:function(){return o},reset:function(){r=!(a=!0),Y=[],o={}},perfExists:function(){return S},isInitialized:function(){return a},getConfig:function(){return C},updateConfig:function(e){for(var t in e)C.hasOwnProperty(t)&&e.hasOwnProperty(t)&&void 0!==C[t]&&void 0!==e[t]&&(C[t]=e[t])},getPerformance:W,init:function(e,t){if(this.reset(),!S)return t(null,"Nav or resource timing or both are not available"),!1;this.getQueryStrings().showaft&&(w=!0),"0"===this.getQueryStrings().perfbar&&(F=!1),this.updateConfig(e),v.timing.loadEventStart>v.timing.navigationStart?YAFT.triggerPerf("deferred",t):p.addEventListener?(p.addEventListener("load",function(){YAFT.triggerPerf("load",t)},!1),p.addEventListener("unload",function(){YAFT.triggerPerf("unload",t)},!1)):p.attachEvent&&(p.attachEvent("onload",function(){YAFT.triggerPerf("load",t)}),p.attachEvent("onunload",function(){YAFT.triggerPerf("unload",t)}))},AFT2:{start:function(){if(Y={},o={},l=0,!S||!a)return!1;!0===w&&C.canShowVisualReport&&p.YAFT_REPORT&&p.YAFT_REPORT.removeReport&&(p.YAFT_REPORT.removeExtras(),p.YAFT_REPORT.removeReport()),n&&clearTimeout(n),d&&clearTimeout(d);try{v.clearResourceTimings?v.clearResourceTimings():v.webkitClearResourceTimings&&v.webkitClearResourceTimings()}catch(e){}M=v.now()},setAFT2StartRender:function(){if(!S||!a)return!1;0===l&&(l=v.now())},getAFT2StartRender:function(){return l},end:function(e){var t,r,n,o,i={};if(!S||!a)return e(null,"Nav or resource timing or both are not available or YAFT is not initialized"),!1;l=l||v.now(),x=l-M,C.maxWaitTime&&0<C.maxWaitTime&&(d=setTimeout(function(){T=T||I(),N=L(),C.preProcess&&"function"==typeof C.preProcess&&C.preProcess(),o=YAFT.getDomElementsCount(),q(C.modules,C.modulesExclude,C.modulesAft2Container),B(Y,C.includeOnlyAft2),n=YAFT.getFinalModulesReport(),E=k(n),r=V(n),R=r.normTotalCoveragePercentage,b=z(r.aftIntervals),C.generateHAR&&(i=D(N)),t={aft:r.aft,startRender:x,event:"aft2",modulesReport:n,totalCoveragePercentage:E,normTotalCoveragePercentage:R,domElementsCount:o,resources:N,har:i,visuallyComplete:b},e&&e(t),YAFT.data.push(t),!0===w&&C.canShowVisualReport&&p.YAFT_REPORT&&p.YAFT_REPORT.drawReport&&p.YAFT_REPORT.drawReport(t,r.aftIntervals)},C.maxWaitTime))}},FPS:{start:function(e){if(!c)return!1;g=!1,u&&p.cancelAnimationFrame(u),s=e,m.length=0,g=!0,u=p.requestAnimationFrame(t)},stop:function(e,t){var r,n,o,i,a;return g=!1,c?(u&&p.cancelAnimationFrame(u),s!==e?(t&&t("FPS stop action cannot be different than start action"),!1):(o=0,i=m.length,a={median:NaN,worse:NaN,avgFps:NaN,stdev:NaN,miss:NaN,sample:NaN},0===i||i<=C.fpsMinSampleCount||(a.sample=i,n=(m[i-1]-m[0])/(i-1),a.avgFps=Math.round(1e3/n),60<a.avgFps&&(a.avgFps=60),(i=m.map(function(e,t){if(0===t)return NaN;t=e-m[t-1];return t>C.fpsMissLimit&&o++,t})).shift(),a.miss=o,a.stdev=(r=n,n=(n=i.map(function(e){e-=r;return e*e})).reduce(function(e,t){return e+t},0)/n.length,Math.sqrt(n)),i.sort(function(e,t){return e-t}),a.worse=i[i.length-1],n=Math.floor(i.length/2),i.length%2?a.median=i[n]:a.median=(i[n-1]+i[n])/2),(a=a).action=e,a.avgFps?(t&&t(null,a),YAFT.logToConsole(a),a):(t&&t("FPS is not available"),!1))):(t&&t("FPS is not available for this browser"),!1)}},getDomElementsCount:function(){return h.getElementsByTagName("*").length},getTTFB:function(){return S?v.timing.responseStart-A:0},getPageLoadTime:function(){return S?v.timing.loadEventStart-A:0},getDomContentLoaded:function(){return S?v.timing.domContentLoadedEventStart-A:0},getStartRenderTime:function(){var e,t,r,n,o;if(!S)return 0;if(C.customStartRender&&"function"==typeof C.customStartRender)return C.customStartRender();if(e=this.getDomContentLoaded(),(n=p.performance.getEntriesByType("paint"))&&n.length&&0<n.length){if(C.useNativeStartRenderMeaningful)for(o=0;o<n.length;o+=1)if("first-contentful-paint"===n[o].name){i=n[o].startTime;break}if(void 0===i)for(o=0;o<n.length;o+=1)if("first-paint"===n[o].name){i=n[o].startTime;break}}if(void 0===i&&("msFirstPaint"in p.performance.timing?i=p.performance.timing.msFirstPaint-A:"chrome"in p&&"loadTimes"in p.chrome&&p.chrome.loadTimes&&"firstPaintTime"in(t=p.chrome.loadTimes())&&0<t.firstPaintTime&&(r=t.startLoadTime,"requestTime"in t&&0<t.requestTime&&(r=t.requestTime),t.firstPaintTime>=r&&(i=1e3*(t.firstPaintTime-r)))),!0===C.getAccurateFirstPaint&&(void 0===i||i<0||12e4<i)){for(var i=p.performance.timing.responseStart-A,a={},s=h.getElementsByTagName("head")[0].children,u=0;u<s.length;u++){var c=s[u];"SCRIPT"===c.tagName&&c.src&&!c.async&&(a[c.src]=!0),"LINK"===c.tagName&&"stylesheet"===c.rel&&c.href&&(a[c.href]=!0)}for(var l,d=p.performance.getEntriesByType("resource"),g=!1,m=0;m<d.length;m++)g||!a[d[m].name]||"script"!==d[m].initiatorType&&"link"!==d[m].initiatorType?g=!0:(l=d[m].responseEnd,(void 0===i||i<l)&&(i=l))}return void 0===i||i<0||12e4<i&&e<i?e:i},getDomInteractive:function(){return S?v.timing.domInteractive-A:0},getNow:function(){return S?v.now():0},getQueryStrings:function(){if(this.qParams)return this.qParams;for(var e,t={},r=p.location.search.slice(1).split("&"),n=0,o=r.length||0,n=0;n<o;n+=1)t[(e=r[n].split("="))[0]]=e[1]||"";return this.qParams=t},getViewport:function(){return T},getVersion:function(){return"0.3.27"},logToConsole:function(e){S&&w&&console&&console.log&&console.log(e)},getModuleSelector:function(e,t){for(var r=[],n=t?"^":"",t=t?"*":"",o=0,i=C.whiteListedContainerElements.length;o<i;o++)r.push(C.whiteListedContainerElements[o]+"[id"+n+'="'+e+'"]');return r.push(t+"[data-yaft-module"+n+'="'+e+'"]'),r.join(",")},getModuleName:function(e){return C.preferDataModNameOverId?e.getAttribute("data-yaft-module")||e.id||void 0:e.id||e.getAttribute("data-yaft-module")||void 0},getElemResourceUrl:function(e){var t="",r=[];return"VIDEO"===e.nodeName||(e.src?t=e.src:(e=e.currentStyle||window.getComputedStyle(e,!1))&&e.backgroundImage&&(r=e.backgroundImage.match(/url\((["']{0,1})([^'"]+)\1\)$/))&&3===r.length&&(t=r[2])),t}})}(window,document),"undefined"!=typeof module&&module.exports&&("undefined"!=typeof window?module.exports=window.YAFT:module.exports=!1);
