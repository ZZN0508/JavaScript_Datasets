"use strict";var _createClass=function(){function t(e,s){for(var i,t=0;t<s.length;t++)(i=s[t]).enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var JssoCrosswalk=function(){function i(e,s){_classCallCheck(this,i),this.channel=e,this.platform=s,this.ssoBaseUrl="https://jsso.indiatimes.com/sso/crossapp/identity/web/",this.socialappBaseUrl="https://socialappsintegrator.indiatimes.com/socialsite/crossapp/web/",this.sdkVersion="0.5.3",this.csrfToken=this.getCookie("jsso_crosswalk_csrfToken_"+this.channel),this.ssec=this.getCookie("jsso_crosswalk_ssec_"+this.channel),this.tksec=this.getCookie("jsso_crosswalk_tksec_"+this.channel),this.csut=this.getCookie("csut"),this.gdpr=this.getCookie("gdpr"),this.UNAUTHORIZED_ACCESS_RESPONSE={code:404,message:"UNAUTHORIZED_ACCESS",status:"FAILURE",data:null},this.CONNECTION_ERROR_RESPONSE={code:503,message:"CONNECTION_ERROR",status:"FAILURE",data:null},this.CONNECTION_TIMEOUT_RESPONSE={code:504,message:"CONNECTION_TIMEOUT",status:"FAILURE",data:null},this.APP_CONNECTION_TIMEOUT_RESPONSE={code:505,message:"TRUECALLER_LOGIN_FAILURE",status:"FAILURE",data:null},this.INVALID_MOBILE={code:402,message:"INVALID_MOBILE",status:"FAILURE",data:null},this.INVALID_EMAIL={code:403,message:"INVALID_EMAIL",status:"FAILURE",data:null},this.INVALID_REQUEST={code:413,message:"INVALID_REQUEST",status:"FAILURE",data:null},this.INVALID_PASSWORD={code:417,message:"INVALID_PASSWORD",status:"FAILURE",data:null};s=this.getChannelCookies();""!=s.login&&""==s.daily&&this.getValidLoggedInUser()}return _createClass(i,[{key:"asyncJssoCall",value:function(e,s,i){this.asyncCall(this.ssoBaseUrl+e,s,i)}},{key:"asyncSocialappCall",value:function(e,s,i){this.asyncCall(this.socialappBaseUrl+e,s,i)}},{key:"asyncCall",value:function(e,s,i){var t=new XMLHttpRequest;t.open("POST",e),t.timeout=3e4,t.withCredentials=!0,t.setRequestHeader("content-type","application/json"),t.setRequestHeader("channel",this.channel),t.setRequestHeader("platform",this.platform),t.setRequestHeader("sdkVersion",this.sdkVersion),t.setRequestHeader("IsJssoCrosswalk","true"),t.setRequestHeader("csrfToken",this.csrfToken),t.setRequestHeader("ssec",this.ssec),t.setRequestHeader("tksec",this.tksec),t.setRequestHeader("csut",this.csut),t.setRequestHeader("gdpr",this.gdpr),t.responseType="json",t.onload=function(){var e=t.response;return(e="string"==typeof e?JSON.parse(e):e)&&e.code?404==e.code?(this.deleteChannelCookies(),void(i&&i(e))):(t.getResponseHeader("csrfToken")&&(this.csrfToken=t.getResponseHeader("csrfToken")),t.getResponseHeader("ssec")&&(this.ssec=t.getResponseHeader("ssec")),t.getResponseHeader("tksec")&&(this.tksec=t.getResponseHeader("tksec")),t.getResponseHeader("csut")&&(this.csut=t.getResponseHeader("csut")),t.getResponseHeader("gdpr")&&(this.gdpr=t.getResponseHeader("gdpr")),i?i(e):void 0):(this.deleteChannelCookies(),void(i&&i(this.UNAUTHORIZED_ACCESS_RESPONSE)))}.bind(this),t.onerror=function(){if(i)return i(this.CONNECTION_ERROR_RESPONSE)}.bind(this),t.ontimeout=function(){if(i)return i(this.CONNECTION_TIMEOUT_RESPONSE)}.bind(this),t.send(JSON.stringify(s))}},{key:"getValidLoggedInUser",value:function(s){this.asyncJssoCall("loggedInUser",{},function(e){if(200==e.code&&this.createChannelCookies(),s)return s(e)}.bind(this))}},{key:"checkUserExists",value:function(e,s){this.asyncJssoCall("checkUserExists",{identifier:e},s)}},{key:"registerUser",value:function(e,s,i,t,o,a,n,l,r,c,d,h){return o||a?o&&!this.isValidEmail(o)?h(this.INVALID_EMAIL):a&&!this.isValidMobile(a)?h(this.INVALID_MOBILE):this.isValidPassword(n)?void this.asyncJssoCall("registerUser",{firstName:e,lastName:s,gender:i,dob:t,email:o,mobile:a,password:n,isSendOffer:l,termsAccepted:r,shareDataAllowed:c,timespointsPolicy:d},h):h(this.INVALID_PASSWORD):h(this.INVALID_REQUEST)}},{key:"registerUserRecaptcha",value:function(e,s,i,t,o,a,n,l,r,c,d,h,u){return o||a?o&&!this.isValidEmail(o)?u(this.INVALID_EMAIL):a&&!this.isValidMobile(a)?u(this.INVALID_MOBILE):this.isValidPassword(n)?void this.asyncJssoCall("registerUserRecaptcha",{firstName:e,lastName:s,gender:i,dob:t,email:o,mobile:a,password:n,isSendOffer:l,recaptcha:r,termsAccepted:c,shareDataAllowed:d,timespointsPolicy:h},u):u(this.INVALID_PASSWORD):u(this.INVALID_REQUEST)}},{key:"resendMobileSignUpOtp",value:function(e,s,i){return this.isValidMobile(e)?void this.asyncJssoCall("resendSignUpOtp",{mobile:e,ssoid:s},i):i(this.INVALID_MOBILE)}},{key:"resendEmailSignUpOtp",value:function(e,s,i){return this.isValidEmail(e)?void this.asyncJssoCall("resendSignUpOtp",{email:e,ssoid:s},i):i(this.INVALID_EMAIL)}},{key:"verifyMobileSignUp",value:function(e,s,i,t){return this.isValidMobile(e)?void this.asyncJssoCall("verifySignUpOTP",{mobile:e,ssoid:s,otp:i},function(e){if(200==e.code&&this.createChannelCookies(),t)return t(e)}.bind(this)):t(this.INVALID_MOBILE)}},{key:"verifyEmailSignUp",value:function(e,s,i,t){return this.isValidEmail(e)?void this.asyncJssoCall("verifySignUpOTP",{email:e,ssoid:s,otp:i},function(e){if(200==e.code&&this.createChannelCookies(),t)return t(e)}.bind(this)):t(this.INVALID_EMAIL)}},{key:"verifyMobileLogin",value:function(e,s,i){return this.isValidMobile(e)?void this.asyncJssoCall("verifyLoginOtpPassword",{mobile:e,password:s},function(e){if(200==e.code&&this.createChannelCookies(),i)return i(e)}.bind(this)):i(this.INVALID_MOBILE)}},{key:"verifyEmailLogin",value:function(e,s,i){return this.isValidEmail(e)?void this.asyncJssoCall("verifyLoginOtpPassword",{email:e,password:s},function(e){if(200==e.code&&this.createChannelCookies(),i)return i(e)}.bind(this)):i(this.INVALID_EMAIL)}},{key:"facebookLogin",value:function(e,s,i){this.asyncSocialappCall("facebookLogin",{code:e,facebookRedirectUri:s},function(e){if(200==e.code&&this.createChannelCookies(),i)return i(e)}.bind(this))}},{key:"googleplusLogin",value:function(e,s,i){this.asyncSocialappCall("googleplusLogin",{code:e,googleplusRedirectUri:s},function(e){if(200==e.code&&this.createChannelCookies(),i)return i(e)}.bind(this))}},{key:"linkedinLogin",value:function(e,s,i){this.asyncSocialappCall("linkedinLogin",{code:e,linkedinRedirectUri:s},function(e){if(200==e.code&&this.createChannelCookies(),i)return i(e)}.bind(this))}},{key:"getUserProfile",value:function(e){this.asyncJssoCall("getUserProfile",{},e)}},{key:"getUserDetails",value:function(e){this.asyncJssoCall("getUserDetails",{},e)}},{key:"getMobileLoginOtp",value:function(e,s){return this.isValidMobile(e)?void this.asyncJssoCall("getLoginOtp",{mobile:e},s):s(this.INVALID_MOBILE)}},{key:"getEmailLoginOtp",value:function(e,s){return this.isValidEmail(e)?void this.asyncJssoCall("getLoginOtp",{email:e},s):s(this.INVALID_EMAIL)}},{key:"updateUserProfile",value:function(e,s,i,t,o,a,n,l){this.asyncJssoCall("updateUserProfile",{firstName:e,lastName:s,gender:i,dob:t,city:o,termsAccepted:a,shareDataAllowed:n},l)}},{key:"getMobileForgotPasswordOtp",value:function(e,s){return this.isValidMobile(e)?void this.asyncJssoCall("getForgotPasswordOtp",{mobile:e},s):s(this.INVALID_MOBILE)}},{key:"getEmailForgotPasswordOtp",value:function(e,s){return this.isValidEmail(e)?void this.asyncJssoCall("getForgotPasswordOtp",{email:e},s):s(this.INVALID_EMAIL)}},{key:"verifyMobileForgotPassword",value:function(e,s,i,t,o){return this.isValidMobile(e)?this.isValidPassword(i)?void this.asyncJssoCall("verifyForgotPassword",{mobile:e,otp:s,password:i,confirmPassword:t},o):o(this.INVALID_PASSWORD):o(this.INVALID_MOBILE)}},{key:"verifyEmailForgotPassword",value:function(e,s,i,t,o){return this.isValidEmail(e)?this.isValidPassword(i)?void this.asyncJssoCall("verifyForgotPassword",{email:e,otp:s,password:i,confirmPassword:t},o):o(this.INVALID_PASSWORD):o(this.INVALID_EMAIL)}},{key:"loginMobileForgotPassword",value:function(e,s,i,t,o){return this.isValidMobile(e)?this.isValidPassword(i)?void this.asyncJssoCall("loginForgotPassword",{mobile:e,otp:s,password:i,confirmPassword:t},function(e){if(200==e.code&&this.createChannelCookies(),o)return o(e)}.bind(this)):o(this.INVALID_PASSWORD):o(this.INVALID_MOBILE)}},{key:"loginEmailForgotPassword",value:function(e,s,i,t,o){return this.isValidEmail(e)?this.isValidPassword(i)?void this.asyncJssoCall("loginForgotPassword",{email:e,otp:s,password:i,confirmPassword:t},function(e){if(200==e.code&&this.createChannelCookies(),o)return o(e)}.bind(this)):o(this.INVALID_PASSWORD):o(this.INVALID_EMAIL)}},{key:"signOutUser",value:function(s){this.asyncJssoCall("signOutUser",{},function(e){if(this.deleteChannelCookies(),s)return s(e)}.bind(this))}},{key:"updateMobile",value:function(e,s){return this.isValidMobile(e)?void this.asyncJssoCall("updateMobile",{mobile:e},s):s(this.INVALID_MOBILE)}},{key:"verifyMobile",value:function(e,s,i){return this.isValidMobile(e)?void this.asyncJssoCall("verifyMobile",{mobile:e,otp:s},i):i(this.INVALID_MOBILE)}},{key:"addAlternateEmail",value:function(e,s){return this.isValidEmail(e)?void this.asyncJssoCall("addAlternateEmail",{email:e},s):s(this.INVALID_EMAIL)}},{key:"verifyAlternateEmail",value:function(e,s,i){return this.isValidEmail(e)?void this.asyncJssoCall("verifyAlternateEmail",{email:e,otp:s},i):i(this.INVALID_EMAIL)}},{key:"linkFacebook",value:function(e,s,i){this.asyncJssoCall("linkSocial",{oauthSiteId:"facebook",oauthCode:e,redirectUri:s},i)}},{key:"linkGoogleplus",value:function(e,s,i){this.asyncJssoCall("linkSocial",{oauthSiteId:"googleplus",oauthCode:e,redirectUri:s},i)}},{key:"linkLinkedin",value:function(e,s,i){this.asyncJssoCall("linkSocial",{oauthSiteId:"linkedin",oauthCode:e,redirectUri:s},i)}},{key:"delinkSocial",value:function(e,s){this.asyncJssoCall("delinkSocial",{oauthSiteId:e},s)}},{key:"setPassword",value:function(e,s,i){return this.isValidPassword(e)?void this.asyncJssoCall("setPassword",{newPassword:e,confirmPassword:s},i):i(this.INVALID_PASSWORD)}},{key:"changePassword",value:function(e,s,i,t){return this.isValidPassword(s)?void this.asyncJssoCall("changePassword",{oldPassword:e,newPassword:s,confirmPassword:i},t):t(this.INVALID_PASSWORD)}},{key:"changePrimaryEmail",value:function(e,s){return this.isValidEmail(e)?void this.asyncJssoCall("changePrimaryEmail",{emailId:e},s):s(this.INVALID_EMAIL)}},{key:"facebookLoginAccessToken",value:function(e,s,i){this.asyncSocialappCall("facebookLogin",{accessToken:e,facebookRedirectUri:s},function(e){if(200==e.code&&this.createChannelCookies(),i)return i(e)}.bind(this))}},{key:"linkFacebookAccessToken",value:function(e,s,i){this.asyncJssoCall("linkSocial",{oauthSiteId:"facebook",accessToken:e,redirectUri:s},i)}},{key:"socialImageUpload",value:function(e,s){this.asyncJssoCall("socialImageUpload",{oauthSiteId:e},s)}},{key:"updateProfilePic",value:function(e,s){var i=this.ssoBaseUrl+"uploadProfilePic",t=new FormData(this);t.append("datafile",e);var o=new XMLHttpRequest;o.open("POST",i),o.timeout=3e4,o.withCredentials=!0,o.setRequestHeader("channel",this.channel),o.setRequestHeader("platform",this.platform),o.setRequestHeader("sdkVersion",this.sdkVersion),o.setRequestHeader("IsJssoCrosswalk","true"),o.setRequestHeader("csrfToken",this.csrfToken),o.setRequestHeader("ssec",this.ssec),o.setRequestHeader("tksec",this.tksec),o.responseType="json",o.onload=function(){var e=o.response;return(e="string"==typeof e?JSON.parse(e):e)&&e.code?404==e.code?(this.deleteChannelCookies(),void(s&&s(e))):(o.getResponseHeader("csrfToken")&&(this.csrfToken=o.getResponseHeader("csrfToken")),o.getResponseHeader("ssec")&&(this.ssec=o.getResponseHeader("ssec")),o.getResponseHeader("tksec")&&(this.tksec=o.getResponseHeader("tksec")),s?s(e):void 0):(this.deleteChannelCookies(),void(s&&s(this.UNAUTHORIZED_ACCESS_RESPONSE)))}.bind(this),o.onerror=function(){if(s)return s(this.CONNECTION_ERROR_RESPONSE)}.bind(this),o.ontimeout=function(){if(s)return s(this.CONNECTION_TIMEOUT_RESPONSE)}.bind(this),o.send(t)}},{key:"registerOnlyMobile",value:function(e,s,i,t,o,a,n,l){return t?this.isValidMobile(t)?void this.asyncJssoCall("registerOnlyMobile",{firstName:e,lastName:s,gender:i,mobile:t,termsAccepted:o,shareDataAllowed:a,timespointsPolicy:n},l):l(this.INVALID_MOBILE):l(this.INVALID_REQUEST)}},{key:"truecallerLogin",value:function(e,s){return e?this.isValidMobile(e)?void this.asyncJssoCall("truecallerLogin",{mobile:e},s):s(this.INVALID_MOBILE):s(this.INVALID_REQUEST)}},{key:"truecallerVerify",value:function(e,s){return e?void this.asyncJssoCall("truecallerVerify",{requestId:e},function(e){if(200==e.code&&this.createChannelCookies(),s)return s(e)}.bind(this)):s(this.INVALID_REQUEST)}},{key:"addAlternateEmailTrap",value:function(e,s,i,t){return this.isValidEmail(e)?void this.asyncJssoCall("addAlternateEmailIdTrap",{email:e,password:s,alterEmail:i},t):t(this.INVALID_EMAIL)}},{key:"verifyAlternateEmailTrap",value:function(e,s,i,t,o){return this.isValidEmail(e)?void this.asyncJssoCall("verifyAlternateEmailIdTrap",{email:e,password:s,alterEmail:i,otp:t},o):o(this.INVALID_EMAIL)}},{key:"addAlternateMobileTrap",value:function(e,s,i,t){return this.isValidEmail(e)?void this.asyncJssoCall("addAlternateEmailIdTrap",{email:e,password:s,alterMobile:i},t):t(this.INVALID_EMAIL)}},{key:"verifyAlternateMobileTrap",value:function(e,s,i,t,o){return this.isValidEmail(e)?void this.asyncJssoCall("verifyAlternateMobileTrap",{email:e,password:s,alterMobile:i,otp:t},o):o(this.INVALID_EMAIL)}},{key:"deleteAccount",value:function(e,s){this.asyncJssoCall("deleteUser",{password:e},s)}},{key:"getChannelDetails",value:function(e,s,i){this.asyncJssoCall("channelDetails",{channel:e,ru:s},i)}},{key:"gpOneTapLogin",value:function(e,s){this.asyncJssoCall("gpOneTap",{token:e},function(e){if(200==e.code&&this.createChannelCookies(),s)return s(e)}.bind(this))}},{key:"subscriberLogin",value:function(e,s){this.asyncJssoCall("subscriberLogin",{token:e},function(e){if(200==e.code&&this.createChannelCookies(),s)return s(e)}.bind(this))}},{key:"verifyMobileLoginGdpr",value:function(e,s,i,t,o,a){return this.isValidMobile(e)?void this.asyncJssoCall("verifyLoginOtpPasswordGdpr",{mobile:e,password:s,termsAccepted:i,shareDataAllowed:t,timespointsPolicy:o},function(e){if(200==e.code&&this.createChannelCookies(),a)return a(e)}.bind(this)):a(this.INVALID_MOBILE)}},{key:"verifyEmailLoginGdpr",value:function(e,s,i,t,o,a){return this.isValidEmail(e)?void this.asyncJssoCall("verifyLoginOtpPasswordGdpr",{email:e,password:s,termsAccepted:i,shareDataAllowed:t,timespointsPolicy:o},function(e){if(200==e.code&&this.createChannelCookies(),a)return a(e)}.bind(this)):a(this.INVALID_EMAIL)}},{key:"updateUserPermissions",value:function(e,s,i,t){this.asyncJssoCall("updateUserPermissions",{termsAccepted:e,shareDataAllowed:s,timespointsPolicy:i},function(e){if(200==e.code&&this.createChannelCookies(),t)return t(e)}.bind(this))}},{key:"truecallerOneTapLogin",value:function(i,t){return 1!=i.valueOf()&&0!=i.valueOf()?t(this.INVALID_REQUEST):void this.asyncJssoCall("truecallerOneTapLogin",{},function(e){var s=this;if(200==e.code){if(window.location.href="truecallersdk://truesdk/web_verify?requestNonce="+e.data.requestId+"&partnerKey=Mfn40c8470b1f53324b99aa45ac47738ad539&partnerName="+e.data.channelName+"&lang=en&title=signIn&skipOption=skip",0==i.valueOf()&&t)return t(e);setTimeout(function(){if(document.hasFocus()){if(t)return t(s.APP_CONNECTION_TIMEOUT_RESPONSE)}else if(t)return t(e)},800)}}.bind(this))}},{key:"createChannelCookies",value:function(){var e=new Date,s=new Date(e);s.setHours(24,0,0,0),this.createCookie("jsso_crosswalk_login_"+this.channel,"true",2592e6),this.createCookie("jsso_crosswalk_daily_"+this.channel,"true",s-e),this.createCookie("jsso_crosswalk_csrfToken_"+this.channel,this.csrfToken,2592e6),this.createCookie("jsso_crosswalk_ssec_"+this.channel,this.ssec,2592e6),this.createCookie("jsso_crosswalk_tksec_"+this.channel,this.tksec,2592e6),this.createCookie("csut",this.csut,2592e6),this.createCookie("gdpr",this.gdpr,2592e6)}},{key:"getChannelCookies",value:function(){return{login:this.getCookie("jsso_crosswalk_login_"+this.channel),daily:this.getCookie("jsso_crosswalk_daily_"+this.channel)}}},{key:"deleteChannelCookies",value:function(){this.deleteCookieByName("jsso_crosswalk_login_"+this.channel),this.deleteCookieByName("jsso_crosswalk_daily_"+this.channel),this.deleteCookieByName("jsso_crosswalk_csrfToken_"+this.channel),this.deleteCookieByName("jsso_crosswalk_ssec_"+this.channel),this.deleteCookieByName("jsso_crosswalk_tksec_"+this.channel),this.deleteCookieByName("csut"),this.deleteCookieByName("gdpr")}},{key:"getCookie",value:function(e){for(var s,i=e+"=",t=decodeURIComponent(document.cookie).split(";"),o=0;o<t.length;o++){for(s=t[o];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(i))return s.substring(i.length,s.length)}return""}},{key:"deleteCookieByName",value:function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/"}},{key:"createCookie",value:function(e,s,i){var t=new Date,i=t.getTime()+i;t.setTime(i),document.cookie=e+"="+s+"; expires="+t.toGMTString()+"; path=/"}},{key:"isValidEmail",value:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+([^<>()\[\]\\,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test((e+"").toLowerCase())}},{key:"isValidMobile",value:function(e){return/^(((\+?\(91\))|0|((00|\+)?91))-?)?[6-9]\d{9}$/.test(e+"")}},{key:"isValidPassword",value:function(e){return!((e+="").length<6||14<e.length)&&(/.*[a-z]+.*/.test(e)&&/.*[!@#$%^&*()]+.*/.test(e)&&/.*[0-9]+.*/.test(e))}}]),i}();
