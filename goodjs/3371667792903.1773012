YUI.add("af-applet",function(g,r){"use strict";var l=g.Af,e=l.Utils,a=g.Lang,p=g.Object,c=g.Array,t=l.Config,d=l.Bootstrap,f="container",v="guid",o="model",s="type",n="footer",u="header",w="edit",i="main",h=t.isDev(),V=a.isFunction,_=e.objectGetValue,m=e.objectMerge,y=e.perfStart,A=e.perfStop;function M(e){if(!e)return e;e=e.split("-");return(e=c.map(e,function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(".")}function C(e){g.EventTarget.prototype.constructor.call(this),this.initializer(e)}g.extend(C,l.CompositeView,{views:{main:{region:i},settings:{region:w},remove:{region:w},moreinfo:{region:w},header:{region:u},footer:{region:n}},regions:{main:{view:i},header:{view:u},footer:{view:n},edit:{defer:!0,view:"settings"}},allowRegionLateBind:!1,initializer:function(i){var n=this;n.guid=i.guid,n.type=i.type,n.clientId=g.guid("appletClientId_"),n.container=g.one(i.container),n._destroyed=!1,n.views=m(n.views,i.views),n.regions=m(n.regions,i.regions),p.each(n.regions,function(e,t){var i=n.getRegion(t);i||n.createRegion(t,e.selector)}),n._bootstrapMV(function(e){try{if(e)return;var t=i.type+":aptShowViews";y(t),p.each(n.regions,function(e,t){var i;e&&e.view&&((t=n.getRegion(t))&&(i=a.isString(e.view)?n.getView(e.view):e.view)&&t.showView(i))}),A(t)}catch(e){if(h)throw e;l.Beacon.error(r,{},{code:"appbstrap",message:e.stack||e.message,appletType:n.type})}}),n._eventHandlers=[],n._eventHandlers.push(n.after("*:showmessage",function(e){l.Message.show(n.get(f),e.showmessage)}))},destroy:function(){var e=this,t=e.get(o);e.destroyViews(),e._regions=e._views=e.views=e.regions=null,t&&(e.set(o,null,{silent:!0}),t.destroy()),c.each(e._eventHandlers,function(e){e&&e.detach()}),e._eventHandlers=null,e._destroyed=!0,e.fireEvent("appletdestroyed"),e.detachAll()},createView:function(e){var t,i=this,n=i.views[e],r=l.AppletDom.classes().view_container_prefix+e;return(!n||!n.region||i.getRegion(n.region))&&(t=i._getViewClass(e))?((n=g.merge({applet:i,name:e,guid:i.get(v),type:i.get(s),model:i.get(o),container:i.get(f).one("div."+r)},d.getViewMeta(i.get(v),e).config)).container||(n.container=g.Node.create('<div class="'+r+'"/>')),(n=new t(n)).addTarget(i),i.setView(e,n),n):null},fireEvent:function(e){this.fire(e,{applet:{guid:this.get(v),type:this.get(s),clientId:this.clientId}})},getViews:function(){return this._views},get:function(e){return this[e]},set:function(e,t){this[e]=t},regionForView:function(e){e=this.views&&this.views[e];return e?e.region:null},_bootstrapMV:function(i){var n=this,e=n.get(f),t={batch:a.isValue(e.getData("applet-defer"))};e.one(".App-Toolbar_v2")&&(t.extraMods=["af-applet-editview","af-applet-settingsview"]),d.load(n.get(v),t,function(e){var t;e?i(e):n._destroyed?i("applet was destroyed"):(t=n.get(s),y(e=t+":aptCreateModel"),n._createModel(),A(e),y(e=t+":aptCreateViews"),n._createViews(),A(e),i())})},_createModel:function(){var e=this._getModelClass();this.set(o,new e({guid:this.get(v),type:this.get(s)}))},_createViews:function(){var a=this,o=a.get(f),e=d.getMeta(a.get(v)).views,s=l.AppletDom.classes().view_container_prefix;p.each(e,function(e,t){var i;(e=g.merge(a.views[t],e)).isActiveView&&e.region&&(i=a.regions[e.region])&&(i.view=t)}),p.each(a.regions,function(e,t){var i,n=e.view,r=["js-applet-view-container"];(i=o.one("div[data-region="+(t=t)+"]"))&&(t!==n&&r.push(s+t),c.forEach(r,function(e){var t=i.one("div."+e);t&&t.replaceClass(e,s+n)})),e.defer||(e=e.view&&a.createView(e.view))&&e.render()})},_getModelClass:function(){var e=d.getModelClass(this.get(v),"applet_model");return V(e)?e:(e=_(g,M(this.get(s))+"AppletModel"),V(e)?e:l.AppletModel)},_getViewClass:function(e){var t=this.get(v),i=d.getViewClass(t,e);if(V(i))return i;if(i=_(g,M(this.get(s))+M(e)+"View"),V(i))return i;if(t=d.getViewMeta(t,e),0===p.size(t)){if(e===n)return null;if(e===u)return null}return i=_(g.Af,"Applet"+M(e)+"View"),V(i)?i:this.views[e]&&this.views[e].region===w?g.Af.AppletEditView:l.AppletView}}),g.EventTarget&&g.augment(C,g.EventTarget,!0,null,{emitFacade:!0,prefix:"AfApplet"}),g.namespace("Af").Applet=C},"@VERSION@",{requires:["af-applet-dom","af-applet-model","af-applet-headerview","af-bootstrap","af-compositeview","af-config","af-utils","array-extras","event-custom","node","stencil-tooltip"]});
