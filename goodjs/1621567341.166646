const MAX_PERCENTAGE=100,ACTION_START="start",ACTION_STOP="stop",BACKWARD_TRACKING="backward 15",CLOSE_TAB_TRACKING="close tab",FIVE_SECOND_TRACKING="five second play",FORWARD_TRACKING="forward 15",NEXT_TRACK_TRACKING="next track",PAUSE_TRACKING="pause",PLAY_TRACKING="play",PLAY_COUNT_TRACKING="play count",PLAY_BEFORE_LOAD="play before load",PERCENT_25_TIME="25-percent-time",PERCENT_50_TIME="50-percent-time",PERCENT_75_TIME="75-percent-time",PERCENT_100_TIME="100-percent-time";var audioCurrentTime,audioDuration,audioPercentage,audioTitle,authorUserId,currentEpisode,durationPlayed,dataIndex,episodeId,fiveSecondInterval,fiveSecondTimer,fiveSecondTracking,isFirstPlay,isPlaying,isProgressBarClicked,isSafari,isSavePlayingCount,isSavePlayingCountInitial,isUnloadEventFired,isUpdatingListeningProgress,newStartTime,playerObject,programName,sentDurationPlayed,timeInterval,totalDurationPlayed,totalEpisode,trackingPlayerSource=window.location.origin;function copyTextToClipboard(e){var t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}function createCookie(e,t,i){var a,n=new Date;n.setTime(n.getTime()+60*i*1e3),a="; expires="+n.toGMTString(),document.cookie=e+"="+t+a+"; path=/"}function executeOnClose(){void 0===episodeId||isUnloadEventFired||(isUnloadEventFired=!0,updateDurationPlayed(),sendCompletionRate(),updateListeningProgress(episodeId,!0),sendGeneralEventTracking("close tab",sentDurationPlayed))}function initAudioProperties(){resetPlayer(),currentEpisode=episodes[dataIndex],audioCurrentTime=newStartTime=currentEpisode.current_time,audioTitle=currentEpisode.title,authorUserId=currentEpisode.user_id,episodeId=currentEpisode.id,programName=currentEpisode.program_title}function initDefaultValue(){audioCurrentTime=0,audioTitle="",currentEpisode=null,urationPlayed=0,dataIndex=-1,fiveSecondTimer=0,fiveSecondTracking=!1,isFirstPlay=!0,isPlaying=!1,isProgressBarClicked=!1,isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),isSavePlayingCount=!1,isSavePlayingCountInitial=!1,isUnloadEventFired=!1,isUpdatingListeningProgress=!1,newStartTime=0,sentDurationPlayed=0,totalDurationPlayed=0,totalEpisode=0}function initMarquee(){if(0<$(".jsPodcastWidget").length&&0<$(".jsPodcastWidget").outerWidth()){var e=$(".jsPodcastWidgetDuration").outerWidth();if($(".jsPodcastWidget").hasClass("is-web"))var t=$(".jsPodcastWidget").outerWidth()-45-35-30;else if($(".jsPodcastWidget").hasClass("is-wap"))t=$(".jsPodcastWidget").outerWidth()-40-40;$(".jsPodcastWidgetFlex").css("width",t+"px"),$(".jsAudioLink").css("width",""),$(".jsAudioContainer").css("width","");var i=$(".jsAudioTitle .jsAudioLink").first().width();if($(".jsAudioContainer").width()<=i)if(1<$(".jsAudioLink").length){$(".jsAudioContainer").removeClass("is-running");var a=$(".jsAudioTitle .jsAudioLink").first();$(".jsAudioTitle").empty(),a.prependTo(".jsAudioTitle"),$(".jsAudioContainer").width(i),initMarquee()}else $(".jsAudioContainer").width(i+25),$(".jsAudioLink").width(i+25),$(".jsAudioContainer").addClass("is-running"),$(".jsAudioLink").clone().prependTo(".jsAudioTitle");else if(1<$(".jsAudioLink").length){$(".jsAudioContainer").removeClass("is-running");a=$(".jsAudioTitle .jsAudioLink").first();$(".jsAudioTitle").empty(),a.prependTo(".jsAudioTitle"),$(".jsAudioContainer").width(i)}var n=t-e;$(".jsPodcastWidgetTitleEllipsis").css("width",n-5+"px")}}function initMoreEpisode(){if($(".jsMore").click((function(){var e=$(".c-episodes__list").length;$(this).siblings(".c-episodes__container").toggleClass("jsReveal"),$(this).toggleClass("Clicked"),$(this).hasClass("Clicked")?($(this).find(".jsLessText").show(),$(this).find(".jsMoreText").hide(),$(".jsEpList").find(".hide").addClass("reveal"),e<3&&$(".jsReveal").css("height","auto")):($(this).find(".jsLessText").hide(),$(this).find(".jsMoreText").show(),$(".jsEpList").find(".hide.reveal").removeClass("reveal"),e<3&&$(".jsWapCont").css("height","0"))})),$(".jsBtnShare").click((function(e){e.stopPropagation(),$(".jsContentShare").toggleClass("is-show")})),$(document).on("click",(function(e){$(e.target).closest(".jsContentShare").length||$(".jsContentShare").removeClass("is-show")})),$(".c-episodes__list").length<3&&$(".jsEpList").css("height","auto"),$(document).on("click",".jsPodcastWidgetButtonExpand",(function(){$(this).find("i").toggleClass("fa-chevron-down fa-chevron-up"),$(".jsPodcastWidgetEpisodeList").slideToggle()})),$(window).on("resize",(function(){initMarquee()})),initMarquee(),0<$(".l-wrap").find(".c-inpost").length&&0<$(".jsAudioTitle").length){var e=$(".jsAudioTitle")[0].scrollWidth;$(".jsAudioWrap").width()<e&&($(".jsAudioWrap").addClass("marquee"),$(".jsAudioLink").clone().prependTo(".jsAudioTitle"))}}function positionEpisode(e){var t,i=totalEpisode-2;if(totalEpisode<=3)return!1;t=e<=1?0:e>=i?i-1:e-1,$(".c-episodes__container").animate({scrollTop:33*t},"fast")}function resetPlayer(){timeInterval=clearInterval(timeInterval),fiveSecondInterval=clearInterval(fiveSecondInterval),audioCurrentTime=0,durationPlayed=0,fiveSecondTimer=0,newStartTime=0,sentDurationPlayed=0,totalDurationPlayed=0,fiveSecondTracking=!1,isSavePlayingCountInitial=!1,isSavePlayingCount=!1}function resizeWidgetPodcast(){var e={height:$(".l-wrap").outerHeight()+"px",div_id:"podcast_native",class:"podcast"};window.parent.postMessage(JSON.stringify(e),"*")}function readCookie(e){for(var t=e+"=",i=document.cookie.split(";"),a=0;a<i.length;a++)for(var n=i[a];" "==n.charAt(0);)if(0==(n=n.substring(1,n.length)).indexOf(t))return n.substring(t.length,n.length);return null}function savePlayingCount(){var e="podcast-played-"+episodeId+userId,t=readCookie(e);if(isSavePlayingCount||t)return!1;isSavePlayingCount=!0;var i=$("#token-"+episodeId),a=i.val();$.post("/ajax/save_playing_count",{episode_id:episodeId,token:a},(function(t){isSavePlayingCount=!1,""!=t.token&&i.val(t.token),""!=t.total_play_text?createCookie(e,"true",1):savePlayingCount()}))}function savePlayingCountInitial(){var e="podcast-played-initial-"+episodeId+userId,t=readCookie(e);if(isSavePlayingCountInitial||t)return!1;isSavePlayingCountInitial=!0;var i=$("#token-"+episodeId),a=i.val();$.post("/ajax/save_playing_count_initial",{episode_id:episodeId,token:a},(function(t){isSavePlayingCountInitial=!1,""!=t.token&&(i.val(t.token),sendGeneralEventTracking("play count",sentDurationPlayed)),""!=t.total_play_text?createCookie(e,"true",1):savePlayingCountInitial()}))}function sendCompletionRate(){var e=Math.ceil(totalDurationPlayed/playerObject.video.duration*100);e>100&&(e=100),e>=25&&e<50?sendCompletionRateTracking(PERCENT_25_TIME,sentDurationPlayed):e>=50&&e<75?sendCompletionRateTracking(PERCENT_50_TIME,sentDurationPlayed):e>=75&&e<100?sendCompletionRateTracking(PERCENT_75_TIME,sentDurationPlayed):100==e&&sendCompletionRateTracking(PERCENT_100_TIME,Math.ceil(playerObject.video.duration))}function sendCompletionRateTracking(e,t){sendEventTracking(e,currentEpisode.title,currentEpisode.program_title,totalDurationPlayed,t)}function sendEventTracking(e,t,i,a,n){if(e!==PLAY_BEFORE_LOAD&&void 0===playerObject.video.sources)return!1;var r={};if(("next track"==e&&dataIndex<totalEpisode-1||"close tab"==e||"pause"==e)&&(r.durationPlayed=parseInt(a)),"close tab"===e){var o=Math.round(totalDurationPlayed/Math.round(audioDuration)*100);r.percentageFinished=o}var d=t;["backward 15","forward 15","next track","pause","play","close tab"].includes(e)&&(d=Math.round(n));var s={event:"trackEvent","eventDetails.category":category,"eventDetails.action":e,"eventDetails.label":d,"eventDetails.value":parseInt(n),audioTitle:t,audioId:episodeId,programName:i,author:authorUserId,playerSource:trackingPlayerSource,playerMedium:playerMedium,playerDetail:currentEpisode.thread_id,userID:isNaN(Number(userId))?userId:parseInt(Number(userId))};if(s=Object.assign(s,r),dataLayer.push(s),!(0===Object.getOwnPropertyNames(r).length)){var l={};for(index in r)l[index]=void 0;dataLayer.push(l)}}function sendGeneralEventTracking(e,t){sendEventTracking(e,currentEpisode.title,currentEpisode.program_title,t,audioCurrentTime)}function setProgressBarValue(e){e=Math.round(e),$(".c-progress__wrap").find(".jsProgressBar").css("width",e+"%"),$(".jsPlayerIndicator").css("width",e+"%")}function startPlayingButton(){$(".iconPlay").addClass("fa-pause"),$(".iconPlay").removeClass("fa-play")}function stopPlayingButton(){$(".iconPlay").addClass("fa-play"),$(".iconPlay").removeClass("fa-pause")}function updateDurationPlayed(){(durationPlayed=audioCurrentTime-newStartTime)<=0&&(durationPlayed=0),totalDurationPlayed+=durationPlayed,sentDurationPlayed+=durationPlayed,newStartTime=audioCurrentTime}function updateIntervalFiveSecond(){11!=++fiveSecondTimer||isSavePlayingCountInitial||savePlayingCountInitial(),55!=fiveSecondTimer||isSavePlayingCount||savePlayingCount(),55!=fiveSecondTimer||fiveSecondTracking||(sendGeneralEventTracking("five second play",sentDurationPlayed),fiveSecondTracking=!0,clearInterval(fiveSecondInterval),fiveSecondTimer=0)}function updateListeningProgress(e,t){if(!isLogin||isUpdatingListeningProgress)return!1;var i="/update_listening_progress";if(isUpdatingListeningProgress=!0,t&&void 0!==navigator.sendBeacon){var a=new FormData;a.append("episode_id",e),a.append("time",audioCurrentTime),a.append("time_percentage",audioPercentage),isUpdatingListeningProgress=!1,navigator.sendBeacon(i,a)}else $.ajax({type:"POST",url:i,data:{episode_id:e,time:audioCurrentTime,time_percentage:audioPercentage}}).done((function(e){isUpdatingListeningProgress=!1}))}function initPlayer(){totalEpisode=episodes.length;var e={live:!1,splash:!0,audioOnly:!0,clip:{sources:[]}};if(isSafari){e.clip.hlsjs={safari:!0}}function t(){if(audioCurrentTime=Math.round(playerObject.video.time),audioDuration=playerObject.video.duration,setProgressBarValue(audioPercentage=playerObject.video.time/audioDuration*100),playerObject.finished){var e=episodes[dataIndex].duration_seconds-playerObject.video.time;(e=Math.max(0,e))>0&&(audioCurrentTime=playerObject.video.time+e),i("stop"),audioPercentage=100,audioDuration=Math.ceil(audioDuration),episodes[dataIndex].time_percentage=100,episodes[dataIndex].current_time=episodes[dataIndex].duration_seconds,$(".jsCurrentTime").html(a(episodes[dataIndex].current_time)),$(".jsLeftTime").html("00:00"),updateDurationPlayed(),sendCompletionRate(),audioCurrentTime=episodes[dataIndex].current_time,updateListeningProgress(episodeId),totalEpisode>1&&totalEpisode-1>dataIndex&&(sendGeneralEventTracking("next track",sentDurationPlayed),resetPlayer(),dataIndex++,initAudioProperties(),sendGeneralEventTracking(PLAY_BEFORE_LOAD,sentDurationPlayed),playerObject.load(n(currentEpisode.source),r),$(".c-episodes__list").removeClass("reveal").removeClass("active"),$(".c-episodes__container").find("[data-index='"+dataIndex+"']").addClass("reveal active"),$(".jsAudioLink").html(currentEpisode.title),positionEpisode(dataIndex))}else{var t=a(audioCurrentTime),o=audioDuration-audioCurrentTime,d=a(Math.round(o));$(".jsCurrentTime").html(t),$(".jsLeftTime").html(d)}}function i(e){"start"==e?(timeInterval=setInterval(t,100),fiveSecondTracking||(fiveSecondInterval=setInterval(updateIntervalFiveSecond,100)),isPlaying=!0,startPlayingButton()):"stop"==e&&(timeInterval=clearInterval(timeInterval),fiveSecondTracking||(fiveSecondInterval=clearInterval(fiveSecondInterval)),isPlaying=!1,stopPlayingButton())}function a(e){var t=Math.floor(e/60)||0,i=e-60*t||0;return("00"+t).slice(-2)+":"+("00"+i).slice(-2)}function n(e){var t=[];return"string"==typeof e?t.push({type:"audio/mpeg",src:e}):void 0!==e.playlist?t.push({type:"application/x-mpegurl",src:e.playlist}):void 0!==e.mp3&&t.push({type:"audio/mp3",src:e.mp3}),t}function r(e,a,n){if(timeInterval)return!1;i("start"),episodes[dataIndex].current_time>=n.duration?(audioCurrentTime=0,episodes[dataIndex].current_time=0,episodes[dataIndex].time_percentage=0):audioCurrentTime=episodes[dataIndex].current_time,newStartTime=audioCurrentTime,audioPercentage=audioCurrentTime/n.duration*100,playerObject.seek(audioCurrentTime,t)}playerObject=flowplayer("#hidden-player",e),$(".jsPlayButton").click((function(){isFirstPlay&&$.isEmptyObject(playerObject.video)?(isFirstPlay=!1,dataIndex=0,initAudioProperties(),sendGeneralEventTracking(PLAY_BEFORE_LOAD,sentDurationPlayed),playerObject.load(n(currentEpisode.source),r),positionEpisode(dataIndex)):isPlaying?(episodes[dataIndex].current_time=audioCurrentTime,episodes[dataIndex].time_percentage=audioPercentage,i("stop"),updateDurationPlayed(),sendGeneralEventTracking("pause",sentDurationPlayed),updateListeningProgress(episodeId),playerObject.pause(),sentDurationPlayed=0):timeInterval||(100==episodes[dataIndex].time_percentage?(resetPlayer(),episodes[dataIndex].current_time=0,sendGeneralEventTracking(PLAY_BEFORE_LOAD,sentDurationPlayed),playerObject.load(n(currentEpisode.source),r)):(audioCurrentTime=episodes[dataIndex].current_time,i("start"),playerObject.play()),updateDurationPlayed(),sendGeneralEventTracking("play",sentDurationPlayed))})),$(".c-progress__wrap").click((function(e){if(!isProgressBarClicked){isProgressBarClicked=!0;var i=$(".c-progress__wrap").width(),a=e.pageX-$(this).offset().left;a=a/i*100;var n=playerObject.video.duration/100*a;totalDurationPlayed+=durationPlayed=audioCurrentTime-newStartTime,sentDurationPlayed+=durationPlayed,newStartTime=n,playerObject.seek(n,(function(){isProgressBarClicked=!1,t()}))}})),$(".jsSkipForwardButton").click((function(){if(void 0!==episodeId&&playerObject.ready&&!playerObject.finished){updateDurationPlayed(),sendGeneralEventTracking("forward 15",sentDurationPlayed);var e=Math.round(audioCurrentTime)+15;e>=playerObject.video.duration?(audioPercentage=100,newStartTime=Math.floor(playerObject.video.duration),audioCurrentTime=newStartTime,playerObject.seek(audioCurrentTime,t)):(newStartTime=e,playerObject.seek(e,t)),episodes[dataIndex].current_time=newStartTime,episodes[dataIndex].time_percentage=newStartTime/playerObject.video.duration*100}})),$(".jsSkipPreviousButton").click((function(){if(void 0!==episodeId&&playerObject.ready){updateDurationPlayed(),sendGeneralEventTracking("backward 15",sentDurationPlayed);var e=Math.round(audioCurrentTime)-15;e<0?(newStartTime=0,audioCurrentTime=0,audioPercentage=0,playerObject.seek(0,t)):(newStartTime=e,playerObject.seek(e,t)),episodes[dataIndex].current_time=newStartTime,episodes[dataIndex].time_percentage=newStartTime/playerObject.video.duration*100}})),$(".jsPlayLink").click((function(){var e=$(this).attr("data-index");isFirstPlay=!1,dataIndex<0?(dataIndex=e,initAudioProperties(),sendGeneralEventTracking(PLAY_BEFORE_LOAD,sentDurationPlayed),playerObject.load(n(currentEpisode.source),r),$(".c-episodes__list").removeClass("reveal").removeClass("active"),$(".c-episodes__container").find("[data-index='"+dataIndex+"']").addClass("reveal active"),$(".jsAudioLink").html(currentEpisode.title),positionEpisode(dataIndex)):e==dataIndex?$(".jsPlayButton").trigger("click"):(i("stop"),playerObject.stop(),episodes[dataIndex].current_time=audioCurrentTime,episodes[dataIndex].time_percentage=audioPercentage,updateDurationPlayed(),sendCompletionRate(),updateListeningProgress(episodeId),sendGeneralEventTracking("close tab",sentDurationPlayed),resetPlayer(),dataIndex=e,initAudioProperties(),sendGeneralEventTracking(PLAY_BEFORE_LOAD,sentDurationPlayed),playerObject.load(n(currentEpisode.source),r),$(".c-episodes__list").removeClass("reveal").removeClass("active"),$(".c-episodes__container").find("[data-index='"+dataIndex+"']").addClass("reveal active"),$(".jsAudioLink").html(currentEpisode.title),positionEpisode(dataIndex))})),$(".jsVolumeBtn").click((function(){if(!playerObject.ready)return!1;playerObject.mute(),playerObject.muted?$(".jsVolumeIcon").css("color","red"):$(".jsVolumeIcon").css("color","#1998ed")}))}window.dataLayer=window.dataLayer||[],window.onbeforeunload=window.onunload=function(e){executeOnClose()},$(document).ready((function(){initDefaultValue(),initPlayer(),initMarquee(),initMoreEpisode(),resizeWidgetPodcast(),$(".c-episodes__container").find("[data-index='0']").addClass("reveal active"),$(".jsMore").on("click",(function(){resizeWidgetPodcast(),positionEpisode(dataIndex)})),document.referrer&&(trackingPlayerSource=document.referrer.match(/:\/\/(.[^/]+)/)[1])}));