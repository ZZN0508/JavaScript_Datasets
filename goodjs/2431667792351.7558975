"use strict";window.wafer&&window.wafer.ready(function(){window.wafer.on("fetch:success",function(e){var t=e.elem;t&&(t.classList&&(t.classList.contains("collections-view-more")&&(document.documentElement.classList.remove("Reader-closed"),document.documentElement.classList.add("Reader-open"),window.wafer.base.lock(document.getElementById("MainView")),window.scrollTo(0,0)),t.classList.contains("stream-batch-fetch"))&&((e=window.rapidPageConfig&&window.rapidPageConfig.rapidConfig&&window.rapidPageConfig.rapidConfig.spaceid)&&(window._comscore=window._comscore||[],window._comscore.push({c1:2,c2:"7241469",c5:e,c7:document.location.href,c14:window.YAHOO&&window.YAHOO.comscore&&window.YAHOO.comscore.c14||-1}),window.COMSCORE&&window.COMSCORE.purge())),(t=t.getAttribute("data-wf-url"))&&-1<t.indexOf("StandAloneVideo")&&(t="/p.gif?info=trendingvideofetch&bucket="+(window.rapidPageConfig&&window.rapidPageConfig.rapidConfig||{}).test_id,window.wafer.utils.fireBeacon(t)))});var a,t,i,e,n,r,o,s,l,c,d,u,m,f,w,g,p,y,L,h,A,v,b,E,q=null,S=null,k=null,T=[],N=document.querySelectorAll(".stream-items"),C=document.querySelector(".stream-ad-fetch"),I=window.innerWidth||document.documentElement.clientWidth,O=window.wafer&&window.wafer.utils,R=document.querySelector(".stream-category-filter"),U=document.getElementById("Main"),D=document.getElementById("stream-filter-adpill-upsell-module"),B=!!window.localStorage.streamFilterLoginTooltipLastInteracted,M=!1,P="",_=0;R&&(o=function(){if(!p())return!1;var e=Date.now();return void 0===window.localStorage.streamFilterLoginTooltipLastInteracted||e>=window.localStorage.streamFilterLoginTooltipLastInteracted+6048e5},l=!(s=function(e,t,i){return function(){!e||B&&(!c||_<a)||(0<R.offsetTop?(e.classList.contains("D(n)")&&l&&o()&&L(),e.style.position="fixed",e.style.top=i.classList.contains("ybar-hide-navigation")?"150px":"184px",e.style.left=t,e.classList.add("sticky-active")):(e.style.position="",e.style.bottom="",e.style.top="",e.style.left="",e.classList.remove("sticky-active")))}}),(c=document.getElementById("streamFilterMaxFilterClicks"))&&(a=Number(c.getAttribute("value"))),d=document.getElementById("stream-category-form"),u=document.getElementById("stream-filter-ad-pill"),m=document.querySelector(".stream-filter-last-category-tooltip"),f=R.querySelector(".stream-category-filter-btn-fwd"),w=R.querySelector(".stream-category-filter-btn-back"),g=function(e){var t;M||(e?(t=document.querySelector(".stream-filter-tooltip"))&&t.classList.add("D(n)"):(t=document.querySelector(".stream-filter-tooltip-close"))&&t.click(),M=!0)},p=function(){return P=P||document.getElementById("stream-filter-login-tooltip")},y=function(e){var t;B||(t=p())&&(t.classList.add("D(n)"),e&&(B=!!window.localStorage.streamFilterLoginTooltipLastInteracted))},L=function(e){!o()&&!0!==e||(g(!0),(e=p())&&e.classList.remove("D(n)"))},h=function(){document.querySelector(".stream-filter-last-category-tooltip").classList.add("D(n)"),m.classList.remove("tooltip-pointer-right")},A=function(){g(),h();var e=Math.ceil(100*d.scrollLeft/(d.scrollWidth-d.clientWidth));f.style.color=100<=e?"#ccc":"#7e1fff",0===e&&(w.style.display="none"),0<e&&(w.style.display="block",w.classList.remove("D(n)"))},v=function(){D&&(D.classList.add("D(n)"),D.classList.remove("tooltip-pointer-right"))},b=function(e,t){var i,a;t&&U&&((i=document.querySelector(e))&&(a=0,(t=t.offsetLeft-d.scrollLeft-64+t.offsetWidth/2)+(e="#stream-filter-adpill-upsell-module"===e?490:318)>U.offsetWidth&&(a=e-100,i.classList.add("tooltip-pointer-right")),i.style.left=t-a+"px",i.classList.remove("D(n)")))},E=[],(o()||c)&&(t=p(),i=document.getElementById("atomic"),n=(e=document.querySelector(".stream-with-filters")).getClientRects(),r=Math.abs(.5*e.offsetWidth+n[0].left),"function"==typeof requestAnimationFrame?window.wafer.on("scroll",function(){var e=r-document.documentElement.scrollLeft+"px";requestAnimationFrame(s(t,e,i))}):window.wafer.on("scroll",window.wafer.utils.throttle(s(t,r,i)),16)),R&&d&&(R.addEventListener("click",function(e){var t,i=e.target;i&&"BUTTON"===i.tagName?(i.classList.contains("stream-category-filter-btn-fwd")&&(d.scrollLeft+=500),i.classList.contains("stream-category-filter-btn-back")&&(d.scrollLeft-=500),setTimeout(function(){A()},500),y(!0),h(),g()):i&&i.classList&&i.classList.contains("stream-cat-adpill-input")?D&&D.classList.contains("D(n)")?u&&b("#stream-filter-adpill-upsell-module",u.parentNode):v():i&&i.classList&&i.classList.contains("stream-cat-input")&&(_++,i.parentNode.setAttribute("aria-selected",i.checked),c&&a<_?(e.preventDefault(),L(!0),t=i.getAttribute("data-display-name"),window.rapidInstance.beaconClick("strm",t,0,{elm:"filter-prevented",itc:1})):(t=d.querySelectorAll(".stream-cat-input:checked"))&&t.length<=0?(e.preventDefault(),setTimeout(function(){var e=d.querySelectorAll(".stream-cat-input:checked")[0],e=e&&e.getAttribute("id");(e=e&&e)&&(E.forEach(function(e){clearTimeout(e)}),(e=d&&d.querySelector("#"+e))&&b(".stream-filter-last-category-tooltip",e.parentNode),E.push(setTimeout(h,1e4))),y(!1)},0)):(i&&i.type&&"checkbox"===i.type.toLowerCase()&&(e=i.getAttribute("data-display-name"),window.rapidInstance.beaconClick("strm",e,0,{elm:i.checked?"filter-include":"filter-exclude",itc:1})),h()))}),d.addEventListener("scroll",function(e){window.requestAnimationFrame(function(){A(),v()})}),d.addEventListener("customValidate",function(e){var t=0<(d&&d.querySelectorAll(".stream-cat-input:checked").length),t=new CustomEvent("customValidateStatus",{detail:{success:t}});d&&d.dispatchEvent(t)},!1),d.addEventListener("keydown",function(e){var t=e.target;e&&"Enter"===e.key&&t&&t.classList.contains("stream-filter-display-name")&&((t=document.getElementById(t.getAttribute("data-cat-input-id")))&&t.click())}),window.wafer.on("fetch:success",function(e){var t;e.elem&&e.elem.classList.contains("stream-tab-contents")&&(g(),e=((t=document.querySelector(".alternatenewsstream"))&&t.offsetTop+t.offsetParent.offsetTop+20||0)+20,t&&window.scrollY>e&&window.scrollTo(0,e-147),0<R.offsetTop&&L(),l=!0,(N=t.querySelectorAll(".stream-items"))&&N.length&&z())}),setTimeout(function(){b(".stream-filter-tooltip",R.querySelector(".stream-filter-point-tooltip-here"))},0)),u&&(F=u.classList&&u.classList.contains("stream-cat-input")?"filter-exclude":"filter-include",window.rapidInstance&&window.rapidInstance.beaconLinkViews([{_links:[{elm:F,itc:"1",slk:"Ads"}],sec:"strm"}])));var V,x,H,W,j,F,Y,$,J={};function z(){N.forEach(function(o){var e;o.addEventListener("animationend",function(e){var t=e&&e.target;e&&t&&("hideStreamItem"===e.animationName||"fadeOutAdConfirm"===e.animationName)&&(t.classList.contains("ad-feedback-options")||(t=t.classList.contains("give-feedback-screen")?window.wafer.utils.findAncestor(t,"stream-item"):t).parentNode&&(window.wafer.base.destroy(t),t.parentNode.removeChild(t)))}),o.addEventListener("click",function(e){var t=e.target;t.classList.contains("userintent-undo")&&(t=t.getAttribute("data-wf-toggle-target"),!(t=o.querySelector(t))||(t=t.getAttribute("data-uuid"))&&J[t]&&clearTimeout(J[t])),function(e){-1<window.location.href.indexOf("functest=1")&&e.preventDefault();var t=e.target;if(O&&t){var i=O.findAncestor(t,"js-content-viewer");if(i){var a=O.findAncestor(i,"stream-cluster-item")||O.findAncestor(i,"js-stream-content");if(a){var n=a.getAttribute("data-uuid");if(n){t=a&&a.getAttribute("data-parent-uuid");if(q=t&&document.querySelector('li[data-uuid="'+t+'"]')||a,(k=q&&q.getElementsByClassName("stream-related-drawer")[0])&&!q.classList.contains("show-drawer")){i={config:{leadItemUuid:t||n},ctrl:"StreamRelated",m_id:"tdv2-wafer-stream",m_mode:"json"},t={dedupUuids:function(){for(var e=Array.prototype.slice.call(document.getElementsByClassName("stream-uuid-list")),t=0;t<e.length;t++){var i=e[t],a=i.text;i.classList.remove("stream-uuid-list");try{var n=JSON.parse(a);n&&Array.isArray(n.uuidList)&&T.length+n.uuidList.length<=250&&(T=T.concat(n.uuidList))}catch(e){}}return{dedupUuids:T}}().dedupUuids.join(","),uuid:n},n=k.getAttribute("data-cfg");if(n){a=a.getAttribute("data-cposy"),a=isNaN(a)?null:parseInt(a,10);try{var r=JSON.parse(n);r&&r.i13n&&(S=r.i13n),null!==a&&(r.i13n.cposy=a),i.config=Object.assign(i.config,r)}catch(e){}}r=k.getAttribute("data-bucket");r&&(i.bucket=r),i.config.ncpParams=i.config.ncpParams||{},i.config.ncpParams.query=i.config.ncpParams.query||{},i.config.ncpParams.query=Object.assign(t,i.config.ncpParams.query);t=window.wafer.base.state.drawer,t=t&&t.adsToken;t&&(i.config.ncpParams.query.geminiDedupeToken=t),k.setAttribute("data-wf-body",JSON.stringify(i)),k.classList.remove("wafer-fetch-error","wafer-fetch-complete"),k.classList.add("wafer-fetch"),window.wafer.base.sync(k.parentNode)}}}}}}(e)}),C&&window.wafer.base&&window.wafer.utils&&(e=C.getAttribute("data-wf-url"),t=C.getAttribute("data-wf-state-body"),window.wafer.utils.fetchWithCache(e,{body:t,cache:0}).then(function(e){if(e&&e.html){C.innerHTML=e.html;var t=C.querySelectorAll(".stream-ad"),e=C.getElementsByClassName("wafer-state")[0],i=o.querySelectorAll(".stream-ad-placeholder");if(t&&i)for(var a=t.length,n=i.length,r=0;r<n&&r<a;r++)i[r].replaceWith(t[r]);C.innerHTML="",e&&C.appendChild(e),window.wafer.base.sync(o)}}));var t=o.querySelectorAll(".js-sponsored-moments-dwell-time, .js-sponsored-moments-dwell-time-mon");t.length&&(t.forEach(function(e){e.classList&&e.classList.contains("js-reserve-moments")&&(window.DARLA?function e(t){var i=Math.floor(16*I/9),a=t.querySelector("#defaultRESERVEMOMENTS"),n=a&&a.getAttribute("data-html");n&&(a=window.DARLA.prefetched(),window.DARLA.inProgress()||a&&0!==a.length?setTimeout(function(){e(t)},500):(window.DARLA.addPos({dest:"defaultRESERVEMOMENTS",flex:{h:{min:i},w:{min:I}},h:i,id:"RESERVEMOMENTS",supports:{"exp-ovr":1,"exp-push":1,"resize-to":1},w:I}),i=new window.DARLA.Response("RESERVEMOMENTS",{}),n=unescape(n),i.add("RESERVEMOMENTS",n),window.DARLA.render(i)))}(e):e.style.display="none")}),(t=t[0].querySelector(".js-panorama-scroll-view"))&&0===t.scrollLeft&&(t.scrollLeft=(t.scrollWidth-I)/2))})}N&&N.length&&(z(),V=document.getElementById("scrollable-smad"),x=document.getElementById("scrollable-video"),H=window.innerHeight||document.documentElement.clientHeight,W={},j=function(e){return e=e&&(e=(e=(e=(e=(e=e.replace(/\$\(V_AUTOPLAYED\)/,!1)).replace(/\$\(V_PLAYER_WIDTH\)/,V.clientHeight)).replace(/\$\(V_PLAYER_HEIGHT\)/,V.clientWidth)).replace(/\$\(V_SKIP_AVAIL\)/,!1)).replace(/\$\(V_EXPANDED\)/,!1)).replace(/\$\(V_AUD_INFO\)/,2)},V&&(F=V.getBoundingClientRect(),Y=F.top-H,$=F.bottom-Y,W.startActionUrl=V.getAttribute("data-video-quartile-start"),W.quartileActionUrl25=V.getAttribute("data-video-quartile-25"),W.quartileActionUrl50=V.getAttribute("data-video-quartile-50"),W.quartileActionUrl75=V.getAttribute("data-video-quartile-75"),W.quartileActionUrl100=V.getAttribute("data-video-quartile-100")),V&&x&&window.addEventListener("scroll",window.wafer.utils.throttle(function(){var e=x&&x.duration,t=V.getBoundingClientRect();t.top<H&&0<t.bottom&&(x.currentTime=(window.pageYOffset-Y)*e/$,t=(H-t.top)/H*100,100<=(t=5*Math.ceil(t/5))&&W.quartileActionUrl100?(window.wafer.utils.fireBeacon(j(W.quartileActionUrl100),{useNavigator:!1}),W.quartileActionUrl100=null):75<=t&&W.quartileActionUrl75?(window.wafer.utils.fireBeacon(j(W.quartileActionUrl75),{useNavigator:!1}),W.quartileActionUrl75=null):50<=t&&W.quartileActionUrl50?(window.wafer.utils.fireBeacon(j(W.quartileActionUrl50),{useNavigator:!1}),W.quartileActionUrl50=null):25<=t&&W.quartileActionUrl25?(window.wafer.utils.fireBeacon(j(W.quartileActionUrl25),{useNavigator:!1}),W.quartileActionUrl25=null):5<=t&&W.startActionUrl&&(window.wafer.utils.fireBeacon(j(W.startActionUrl),{useNavigator:!1}),W.startActionUrl=null))},16))),window.addEventListener("viewerClosed",function(){var e,t;q&&!q.classList.contains("show-drawer")&&((e=k&&!!k.getElementsByClassName("stream-realted-list")[0])&&(q.classList.add("drawer-beacon"),t=q,setTimeout(function(){t.classList.add("show-drawer")},10)),e&&S&&window.rapidInstance&&window.rapidInstance.beaconClick("strm","youmaylike",0,Object.assign(S,{_p:0,cnt_tpc:S.categoryLabel,g:q.getAttribute("data-uuid"),grpt:"storyCluster",itc:1,pkgt:"youmaylike"})),S="",q=k=null)}),window.wafer.on("toggle:change",function(e){var a,t;e&&e.meta&&e.elem&&(t=e.elem,a=t.getAttribute("data-wf-toggle-target"),"userintent-hidestrmitem"===e.meta.className&&"add"===e.meta.action&&N&&N.length?N.forEach(function(e){var t,i;a&&e&&((e=(t=e.querySelector(a))&&t.getAttribute("data-uuid"))&&(J[e]=setTimeout((i=t,function(){i.classList.contains("userintent-disliked-anim")||i.classList.add("userintent-disliked-anim")}),8e3)))}):"show-drawer"===e.meta.className?N&&N.length&&N.forEach(function(e){var e=e.querySelector(a),t=e&&e.getElementsByClassName("drawer-fetch-target")[0];setTimeout(function(){t&&(t.innerHTML="")},300)}):"userintent-show"===e.meta.className&&t?(t=window.wafer.utils.findAncestor(t,"stream-item"))&&("add"===e.meta.action?(t.classList.add("userintent-show-reason"),window.rapidInstance&&window.rapidInstance.reevaluateModulesViewability(t)):"remove"===e.meta.action&&t.classList.remove("userintent-show-reason")):e.elem&&e.elem.classList.contains("stream-filter-login-tooltip-close")&&(window.localStorage.streamFilterLoginTooltipLastInteracted=Date.now()))})});
