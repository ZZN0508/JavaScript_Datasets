define(["jquery","jquery.autoGrowInput"],(function(t){t.fn.okTags=function(e){if(e=t.extend(!0,{listClass:"tags it vl_it vl_tags",inputClass:"tag_it",inputWrapperClass:"tag_it_w",focusClass:"__focus",direction:"ltr",placeholder:"",tabindex:"2",breakKeyCodes:[32,13,44,59],textRemoveLinkTitle:"Remove from list.",onFocus:function(){},onBlur:function(){}},e||{}),!(this.length<=0)){var a=this.attr("dir");a&&a.length>0&&(e.direction=a);var n=new RegExp("^(.+)\\[[0-9]*\\]$","i"),i=this.eq(0).attr("name").match(n);if(i&&2==i.length){i=i[1];var o=t("<div/>",{class:e.listClass}),s=0;this.each((function(){var a=t(this),r=a.val(),l=a.attr("name").match(n);if(l&&2==l.length&&l[1].length>0&&r.length>0){var d=t("<div/>",{class:"tag tag__old"}).appendTo(o);t("<span/>",{dir:e.direction,text:r}).appendTo(d);var c=t("<div/>",{class:"tag_del_w"}).appendTo(d);t("<span/>",{class:"tag_del ic12_close-nh ic12",title:e.textRemoveLinkTitle}).appendTo(c),t("<input/>",{type:"hidden",name:i+"[]",value:r}).appendTo(d),s++}})),o.insertAfter(this.last()),this.remove();var r=t("<div/>",{class:e.inputWrapperClass}).css("width",s?"auto":"100%").appendTo(o),l=t("<input/>",{type:"text",value:"",class:e.inputClass,style:e.tagInputStyle,dir:e.direction,tabindex:e.tabindex,maxlength:"25",placeholder:s?"":e.placeholder}).css("width",s?"auto":"100%").appendTo(r);return o.on("click",(function(){l.focus()})).on("click",".tag_del",(function(e){e.preventDefault(),e.stopPropagation();var a=t(this).parent().parent(),n=a.text();a.remove(),l.trigger("removedTag",n),l.focus()})),l.autoGrowInput(e).on("addedNewTag",(function(){o.find(".tag__old").length&&(l.attr("placeholder","").css("width","auto"),r.css("width","auto"))})).on("removedTag",(function(){o.find(".tag__old").length||(l.attr("placeholder",e.placeholder).css("width","100%"),r.css("width","100%"))})).on("transformToTag",(function(){var a,n=t(this),s=n.val();if(a=(a=s).toLowerCase(),o.find(".tag__old input:hidden[value]").filter((function(){return this.value.toLowerCase()==a})).length<=0){var r=t("<div/>",{class:"tag tag__old"});t("<span/>",{dir:e.direction,text:s}).appendTo(r);var l=t("<div/>",{class:"tag_del_w"}).appendTo(r);t("<span/>",{class:"tag_del ic12_close-nh ic12",title:e.textRemoveLinkTitle}).appendTo(l),t("<input/>",{type:"hidden",name:i+"[]",value:s}).appendTo(r),n.parent().before(r),n.trigger("addedNewTag",s)}n.val("")})).on("keydown",(function(e){var a=e.keyCode>0?e.keyCode:e.which,n=t(this),i=n.val().length;if(8==a&&i<=0){e.preventDefault();var s=o.find(".tag__old").last();if(s.length){var r=s.text();s.remove(),l.trigger("removedTag",r)}}else 9==a&&i>0&&(e.preventDefault(),n.trigger("transformToTag"))})).on("keypress",(function(a){var n=a.keyCode>0?a.keyCode:a.which,i=t(this);t.inArray(n,e.breakKeyCodes)>-1&&(a.preventDefault(),i.val().length>0&&i.trigger("transformToTag"))})).on("paste",(function(e){var a=t(this);"paste"==e.type&&setTimeout((function(){for(var t=a.val().split(/[\s,;]+/),e=0,n=t.length;e<n;e++)t[e]&&a.val(t[e]).trigger("transformToTag")}),10)})).on("blur",(function(){var a=t(this);a.val().length>0&&a.trigger("transformToTag"),o.removeClass(e.focusClass),e.onBlur()})).on("focus",(function(){o.addClass(e.focusClass),e.onFocus()})),o}}}}));