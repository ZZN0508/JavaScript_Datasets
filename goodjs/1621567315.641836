define("lofty/util/messenger/2.0/messenger",["jquery","util/misc/2.0"],function(t,e){function n(t,e,n){var i="";if(arguments.length<2?i="target error - target and name are both requied":"object"!=typeof t?i="target error - target itself must be window object":"string"!=typeof e&&(i="target error - target name must be string type"),i)throw new Error(i);this.target=t,this.name=e,this.prefix=n}function i(t,e){this.targets={},this.name=t,this.listenFunc=[],this.prefix=(e||o)+"",this.initListen()}var r="|",o="[PROJECT_NAME]",s="postMessage"in window;return n.prototype.send=s?function(t){this.target.postMessage(this.prefix+r+t,"*")}:function(t){var e=window.navigator[this.prefix+this.name];if("function"!=typeof e)throw new Error("target callback function is not defined");e(this.prefix+r+t,window)},i.prototype.addTarget=function(t,e){var i=new n(t,e,this.prefix);this.targets[e]=i},i.prototype.removeTarget=function(t){delete this.targets[t]},i.prototype.clearAllTarget=function(){this.targets={}},i.prototype.initListen=function(){var t=this,n=function(n){var i;if("object"==typeof n&&n.data){if(i=n.data,!e.isAliDomain(n.origin))throw new Error("invalid message origin")}else i=n;var o=t.prefix+r;if(i&&"string"==typeof i&&0===i.indexOf(o)){i=i.slice(o.length);for(var s=0;s<t.listenFunc.length;s++)t.listenFunc[s](i)}};s?"addEventListener"in document?window.addEventListener("message",n,!1):"attachEvent"in document&&window.attachEvent("onmessage",n):window.navigator[this.prefix+this.name]=n},i.prototype.listen=function(t){this.listenFunc.push(t)},i.prototype.clear=function(){this.listenFunc=[]},i.prototype.send=function(t,e){var n,i=this.targets;if(1==arguments.length){e=t;for(n in i)i.hasOwnProperty(n)&&i[n].send(e)}else{if(2!=arguments.length)throw new Error("params are lost.");if("undefined"==typeof t||""==t)throw new Error("target are invalid.");i[t].send(e)}},i});;