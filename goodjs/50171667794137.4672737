define(function(e,a){"use strict";var y={businessFlagServiceUrl:"{contextRoot}/services/proxy/current/businessLandingPageGetAccountRelationshipDetails"},L=e("jquery");a.HeaderController=function(e,d,u,g,p,a,h,b,f,r,n,o,t,v,m){e.addCustomJS();var P=a,I=h,w=this;y.businessFlagServiceUrl=y.businessFlagServiceUrl.replace("{contextRoot}",p.root);a=localStorage.getItem("showMegaMenuOverlay");localStorage.removeItem("showMegaMenuOverlay"),"true"==a&&gadgets.pubsub.publish("afterLogoutPopup"),w.displayFlag=!0,1==b$.portal.isLogin&&(w.profilePicture=r.profilePicture,gadgets.pubsub.subscribe("userImage",function(e){r.profilePicture.setPic=e.profileImage,w.profilePicture.setPic=r.profilePicture.setPic,r.profilePicture.isDefaultImage=!1,""===w.profilePicture.setPic&&(r.profilePicture.isDefaultImage=!0),d.$apply()}),w.userId=sessionStorage.getItem("custId"),w.appID=sessionStorage.getItem("AppId"),w.shortName=sessionStorage.getItem("shortName"),"RS"==w.appID&&null!=w.shortName&&(w.shortNameLen=w.shortName.length,w.shortNameLen<=29?w.userShortName=w.shortName:(a=w.shortName.substring(0,27),w.userShortName=a+"..")),"LN"!=w.appID&&"CC"!=w.appID||(w.userShortName=sessionStorage.getItem("custId"),w.shortNameLen=w.userShortName.length,w.shortNameLen<=29?w.userShortName=w.userShortName:(s=w.userShortName.substring(0,27),w.userShortName=s+"..")),void 0===window.headerProfileCall&&(r.setProfile().then(function(e){e.customerProfile.thumbnail?(r.profilePicture.setPic=e.customerProfile.thumbnail,r.profilePicture.isDefaultImage=!1):r.profilePicture.isDefaultImage=!0}).catch(function(e){r.profilePicture.isDefaultImage=!0}),window.headerProfileCall=!0),o=(s=o.location.pathname.split("/"))[s.length-2],s=s[s.length-1],"my-profile"==o||"my-mailbox"==s?angular.element(t[0].getElementById("userProfile")).addClass("user-dtl2"):angular.element(t[0].getElementById("userProfile")).addClass("user-dtl"));function i(e){return void 0!==e}d.toggleMenu=function(){d.showMenu=!d.showMenu,0<d.animationHook.length&&(d.showMenu?d.animationClass=d.animationPrepend+d.defaultAnimationClass:d.animationClass=d.animationPrepend+d.animationHook)},d.updateSize=function(e){d.navSticky&&d.elementHeight!==e.height&&(d.elementHeight=e.height,setTimeout(function(){var e=["absolute","fixed"].indexOf(L(".navbar",g.body).css("position"))<0;P.publish("launchpad-retail.offsetTopCorrection",{isStatic:e,offsetTopCorrection:d.elementHeight})},10))};var s=L(window).width()+17;d.isReq=!0,1==b$.portal.isLogin&&(s<767&&(L(".logged-in header .main-header .header-menu .navbar-collapse").css("display","none"),d.isReq=!1),!i(t=L("header .main-header .navbar .header-menu .navbar-collapse .nav.navbar-nav.lp-navbar-advanced-root.normal-main-header li:first-child a").attr("href"))||i(s=t.substring(t.lastIndexOf("/")+1))&&"dashboard"!==s&&(t=t+"/dashboard",L("header .main-header .navbar .header-menu .navbar-collapse .nav.navbar-nav.lp-navbar-advanced-root.normal-main-header li:first-child a").attr("href",t),L(".middle-menu-bar .navbar-collapse .nav.navbar-nav .level-1.sub-section-0 a").attr("href",t))),P.subscribe("logoutSession",function(e){1==e.ckStatus?n.goLogout(e.redirectUrl):n.goLogout("#")}),d.toggleLauncherMenu=function(){P.publish("launchpad-retail.toggleLauncherMenu")},L(g.body).find('a[data-uuid="'+p.page.id+'"]').parents("li").addClass("active"),gadgets.pubsub.subscribe("POPUP_TITLE",function(e){window.innerWidth<=500?(L(".popup-title-heading").text(e.popUpTitle),L(".hdfc-logo-icon, .secondary-logo-image").addClass("hide"),L(".popup-title-heading").removeClass("hide").css({color:"white","font-size":"18px",padding:"11px"}),gadgets.pubsub.publish("showPopupTitle",!0)):gadgets.pubsub.publish("showPopupTitle",!1)}),function(){d.showPageTitle=!1,d.navSticky=g.getPreference("navSticky"),d.containerType=g.getPreference("containerType"),d.scrollSetting="lp-"+g.getPreference("scrollSetting")+"-scroll"||"lp-normal-scroll",d.showPageTitle=I.parseBoolean(g.getPreference("showPageTitle"));var e,a=b$.portal.portalModel.serverURL,r=p.userId,n=g.getPreference("iconClickable"),o=g.getPreference("urlType"),t=g.getPreference("miniLogoImage"),i=g.getPreference("miniLogoLink"),s=g.getPreference("urlToBeOpenIn"),l=g.getPreference("overlayType"),c=b$.portal.urlRedirect;if(r=""!=r&&void 0!==r,""==t||"undefined"==t?L(".navbar.navbar-inverse .navbar-header .secondaryLogo").css("display","none"):d.miniLogoImage=a+"/content/bbp/repositories/723fb80a-2dde-42a3-9793-7ae1be57c87f/?path="+t,n)if("url"==o)e=-1==i.indexOf("http")?(L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("href",c+i),c+i):(L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("href",i),i);else switch(l){case"tndc":L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("value","Terms and Conditions");break;case"htgs":L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("value","How To Get Started");break;case"fndc":L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("value","Fees and Charges");break;case"fdbk":L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("value","Feedback");break;case"dwnldapp":L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("value","Download App");break;default:L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("value","Terms and Conditions")}else L(".navbar.navbar-inverse .navbar-header .secondaryLogo").css("pointer-events","none");if(r)L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("target","_blank");else switch(s){case"sameTab":L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("target","_self");break;case"newTab":L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("target","_blank");break;case"newWindow":L(".navbar.navbar-inverse .navbar-header .secondaryLogo").click(function(){return window.open(e,"","width=auto,height=auto"),!1});break;default:L(".navbar.navbar-inverse .navbar-header .secondaryLogo").attr("target","_self")}s=g.getPreference("logoUrl");L(".navbar-brand.hidden-xs.cursor-pointer.first-ul-li-logo-url.exclude-me").attr("href",s),d.logoUrl=I.resolvePortalPlaceholders(g.getPreference("logoURL"))||"",d.mobileLogoUrl=I.resolvePortalPlaceholders(g.getPreference("mobileLogoURL"))||"",d.launcherIcon=g.getPreference("launcherIcon")||"arrow-left",d.animationHook=g.getPreference("navigationIconAnimationHook")||"arrow",d.showNotificationsBadge=I.parseBoolean(g.getPreference("showNotificationsBadge")),d.locales=g.getPreference("locales"),d.slickRequired=g.getPreference("slickNeed"),"required"==d.slickRequired&&angular.element(".web-portal").addClass("slick-header-active"),d.showMenu=!0,d.activePage="",d.activeContext="",d.elementHeight=0,d.animationPrepend="animation-",d.defaultAnimationClass="none",d.animationClass=d.animationPrepend+d.defaultAnimationClass,d.showProfileInfo=h.parseBoolean(g.getPreference("showProfileInfo")),d.showProfileInfo&&(d.profileTitle=g.getPreference("profileTitle"),d.profileTitleLink=b$.portal.urlRedirect+"/"+g.getPreference("profileTitleLink"),p.userId?(d.profileInfo={preferredName:p.userId},d.profileInfo.profileImgBg=g.getPreference("profileImgBg")||"#CCC",b.get().then(function(e){e=e.data;I.assign(d.profileInfo,e),d.profileInfo.preferredName=e.preferredName||h.capitalize(e.firstName||p.userId)})):d.signinLink=g.getPreference("signinLink")),d.logout=function(){f.logOut()},d.myProfileClick=function(a,e){e.preventDefault(),sessionStorage.setItem("linkClicked",!0),w.appID=sessionStorage.getItem("AppId");var r;sessionStorage.getItem("decryptedValue");"RS"==w.appID?(r=v.defer(),e={url:y.businessFlagServiceUrl,method:"GET"},m.makeCall(e).then(function(e){(e=e.data.businessAccountRelationshipDetails).isSuccess=!0,e&&e.rc&&e.rc.returncode&&"0"!==e.rc.returncode&&(e.isSuccess=!1,r.resolve(e)),r.resolve(e)}).catch(function(e){console.log(e),e.isSuccess=!1,r.resolve(e)}),r.promise.then(function(e){e.isSuccess?(e=e.relationshipCodeFlag,localStorage.setItem("businessTabFlag",e)):localStorage.setItem("businessTabFlag",!1),window.location.assign(a)})):(localStorage.setItem("businessTabFlag",!1),window.location.assign(a));gadgets.pubsub.publish("nbGap",{count:0,eventCategory:"headerMenu",eventAction:"linkClick",eventLabel:"profileName"})};s=L(window).width()+17;d.isReq=!0,1==b$.portal.isLogin&&s<767&&(d.isReq=!1),d.buttons={logo:"logo",icon:"icon"},d.scrollSettingsEnum={normal:"lp-normal-scroll",transparency:"lp-transparency-scroll","hide-show":"lp-hide-show-scroll"},P.subscribe("launchpad-retail.activeContextChanged",function(e){u(function(){d.activeContext=0<e.newActiveContext.length?e.newActiveContext:d.activePage},25)}),d.navSticky&&P.publish("launchpad-retail.stickyNavBar")}()}});
