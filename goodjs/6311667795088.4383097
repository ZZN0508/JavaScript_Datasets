_borschik("CdfAb")&&(window.MOUSE_TRACKING=function(){var m=$(window),T=$(document),S=$.extend({ATTENTION_MIN_DURATION:1e3,ATTENTION_MAX_INTERRUPT:6e4,VIEWPORT_CHANGE_TIMEOUT:500,REQID_CHECK_INTERVAL:1e3,ALIVE_PACKET_ENABLED:!0,ALIVE_PACKET_INTERVAL:3e3,SENDER_MAX_REQUEST_COUNT:60,SENDER_MAX_PACKET_SIZE:1e3,SENDER_REQUEST_INTERVAL:1e4,SENDER_REQUEST_CACHE_TIMEOUT:3e4,COORDINATES_SCALE:1,MOUSEMOVE_LOG:1},window.MOUSE_TRACKING_SETTINGS||{});function b(t){return function(){try{return t.apply(this,arguments)}catch(t){t.message="Mouse tracking: "+t.message,window.logSerpJsError(t)}}}function I(t,e){return window.setTimeout(b(t),e)}function A(t,e){return window.setInterval(b(t),e)}m.one("load",b(function(){function o(){return(new Date).getTime()}var t=o();function u(){return Math.round((o()-t)/50)}function a(t,e){t.push(255&e)}function h(t,e){for(e=Math.max(0,0|e);127<e;)t.push(127&e|128),e>>=7;t.push(e)}function s(t,e){if(e){for(var n,i=!1,r=0,s=e.length;r<s;r++){var o=e.charCodeAt(r);o<128?t.push(o):i=!0}i&&((n=new Error("Mouse tracking: baobabId must be US-ASCII")).additional={baobabId:e},window.logSerpJsError(n)),t.push(0)}else window.logSerpJsError("Mouse tracking: empty baobabId in encodeASCIIString")}function i(t){try{return window.BEM&&BEM.blocks["i-global"].param(t)}catch(t){return""}}function c(t){return Math.floor(t*S.COORDINATES_SCALE)}function e(t){var e=[];return a(e,t),h(e,u()),e}function n(t){$.extend(this,t||{}),this._active=!0,this._timeLast=this.timeStart,this.mouseMove(this.serpItem,this.timeStart)}var d={attention:function(t,e,n){var i=[];return a(i,110),h(i,t),h(i,e),s(i,n),i},serpItem:function(t,e,n){var i=[],r=(t=$(t)).offset();return s(i,e),h(i,n),h(i,c(r.left)),h(i,c(r.top)),h(i,c(t.outerWidth())),h(i,c(t.outerHeight())),i},serpItems:function(t,e,n){var i=[];a(i,108),h(i,u()),h(i,t),h(i,e),h(i,n.length);for(var r=0,s=n.length;r<s;r++){var o=n[r][1];o?$.merge(i,d.serpItem(n[r][0],o,n[r][2])):(o=n[r][0],window.logSerpJsError("Mouse tracking: element with empty blockId {cid:"+o.getAttribute("data-cid")+", log-node:"+o.getAttribute("data-log-node")+"}"))}return i},viewport:function(t){var e=[];return a(e,103),h(e,u()),h(e,c(t[0])),h(e,c(t[1])),h(e,c(t[2])),h(e,c(t[3])),e},mouseClick:function(t,e,n,i){var r=[];return a(r,109),h(r,u()),h(r,c(t)),h(r,c(e)),s(r,n),h(r,i),r},alive:function(){return e(105)},windowFocus:function(){return e(107)},windowBlur:function(){return e(106)}};n.prototype={grabberDom:null,sender:null,serpItem:null,timeStart:0,mouseMove:function(t,e){return this.serpItem&&t===this.serpItem&&50*(e-this._timeLast)<S.ATTENTION_MAX_INTERRUPT?(this._timeLast=e,!0):(this.close(),!1)},close:function(){var t,e;this._active&&(this._active=!1,void 0!==this._timeLast&&void 0!==this.timeStart&&this.serpItem&&this.sender)&&(50*(t=this._timeLast-this.timeStart)>S.ATTENTION_MIN_DURATION&&((e=this.serpItem.getAttribute("data-log-node"))&&this.sender.enqueue(d.attention,[this.timeStart,t,e])))}};function r(t){this.sender=t,this._pageTimestamp=o(),this.updateDom(),A(this.updateDom.bind(this),S.REQID_CHECK_INTERVAL)}r.prototype={reqid:"",updateDom:$.throttle(function(){var t=i("reqid");this.reqid!==t&&(this.reqid=t,this._grabDOM(),this.grabViewport())}),_grabDOM:function(){this.elements=this._getElements();var t=this.elements.toArray().map(function(t){return[t,t.getAttribute("data-log-node"),0]},this);0<t.length&&this.sender.enqueue(d.serpItems,[50,this._pageTimestamp,t])},_getElements:function(){return $(".serp-list .distr-default-search, .serp-item[data-log-node], .misspell")},grabViewport:$.throttle(function(){var t=[m.scrollLeft(),m.scrollTop(),m.width(),m.height()];this.sender.enqueue(d.viewport,[t])},10)};function l(){this._ls=null;try{this._ls=localStorage}catch(t){}}l.prototype={set:function(t,e){if(this.isEnabled())try{!e||$.isArray(e)&&!e.length?this.remove(t):this._ls.setItem(this._getLsKey(t),JSON.stringify(e))}catch(t){}},get:function(t){if(this.isEnabled())try{return JSON.parse(this._ls.getItem(this._getLsKey(t)))}catch(t){}return null},remove:function(t){if(this.isEnabled())try{this._ls.removeItem(this._getLsKey(t))}catch(t){}},isEnabled:function(){return this._ls&&"object"==typeof this._ls&&"object"==typeof JSON},_getLsKey:function(t){return"_mt__"+t}};function E(t){$.extend(this,t||{}),this._started=!1,this._countRequestSent=this.countRequestSentInit||0,this._packetQueue=this.packetQueueInit||[]}var _={abc:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%-_",encode:function(t){for(var e,n=_.abc,i=t.length,r=[],s=i-i%3,o=0;o<s;o+=3)e=(t[o]<<16)+(t[o+1]<<8)+t[o+2],r.push(n[e>>18&63],n[e>>12&63],n[e>>6&63],n[63&e]);switch(i-s){case 1:e=t[s]<<4,r.push(n[e>>6&63],n[63&e],n[64],n[64]);break;case 2:e=(t[s]<<10)+(t[1+s]<<2),r.push(n[e>>12&63],n[e>>6&63],n[63&e],n[64])}return r.join("")}};E.prototype={requestsTimeout:S.SENDER_REQUEST_INTERVAL,reqid:"",countRequestSentInit:0,packetQueueInit:null,enqueue:function(t,e){if(this.reqid&&this.hasQuota()&&this._packetQueue.length<S.SENDER_MAX_PACKET_SIZE){e=t.apply(this,e);if(e)return this._packetQueue.push.apply(this._packetQueue,e),this._dumpToStorage(),this.start(),!0}return!1},flush:function(){var t;this.reqid&&(t=this._packetQueue.splice(0,S.SENDER_MAX_PACKET_SIZE),t=_.encode(t),window.b(null,{nodeId:Ya.SerpContext.clckId,event:"tech",type:"mousetracking",data:{no:this._countRequestSent+1,blob:t},logHref:i("retpath")}),this._dumpToStorage(),this._countRequestSent++)},start:function(){var t;this._started||(this._started=!0,I(function(){t.flush(),t._started=!1,t.hasQuota()&&0<t._packetQueue.length&&t.start()},(t=this).requestsTimeout))},hasQuota:function(){return this._countRequestSent<S.SENDER_MAX_REQUEST_COUNT},_dumpToStorage:$.throttle(function(){var t,e;this.storage&&this.storage.isEnabled()&&(t=this.storage.get("data")||{},0<this._packetQueue.length?(e=this._packetQueue.slice(0,S.SENDER_MAX_PACKET_SIZE),t[this.reqid]=[e,o(),this._countRequestSent]):delete t[this.reqid],this.storage.set("data",t))},10)};function g(){this._senders={},this.storage=new l,this.sendAllFromStorage(),I(this.sendAllFromStorage.bind(this),S.SENDER_REQUEST_CACHE_TIMEOUT)}g.prototype={enqueue:function(t,e){var n=i("reqid");return!!n&&("object"!=typeof this._senders[n]&&(this._senders[n]=new E({reqid:n,storage:this.storage})),this._senders[n].enqueue(t,e))},sendAllFromStorage:function(){var t,s;this.storage&&this.storage.isEnabled()&&(t=this.storage.get("data")||{},s={},this.storage.set("data",{}),$.each(t,function(t,e){var n,i,r;$.isArray(e)&&(n=e[0],r=e[1],i=e[2],(r=o()-r)<0||i<0||i>=S.SENDER_MAX_REQUEST_COUNT||!$.isArray(n)||n.length<1||(r>S.SENDER_REQUEST_CACHE_TIMEOUT?new E({reqid:t,requestsTimeout:0,countRequestSentInit:i,packetQueueInit:n}).flush():(e[0]=n.slice(0,S.SENDER_MAX_PACKET_SIZE),s[t]=e)))}),this.storage.set("data",s))}};function f(){this.grabberAttention=null,this.sender=new g,this.grabberDom=new r(this.sender),S.ALIVE_PACKET_ENABLED&&A(function(){this.sender.enqueue(d.alive)}.bind(this),S.ALIVE_PACKET_INTERVAL)}f.prototype={onMouseMove:function(t){var e=$(t).closest(this.grabberDom.elements).first(),t=u();e&&0<e.length?this.grabberAttention&&this.grabberAttention.mouseMove(e[0],t)||(this.grabberAttention=new n({serpItem:e[0],timeStart:t,sender:this.sender,grabberDom:this.grabberDom})):(this.grabberAttention&&this.grabberAttention.close(),this.grabberAttention=null)},onMouseClick:function(t,e,n,i){var r=$(t).closest(this.grabberDom.elements).first(),t=Ya.SerpContext.clckId;0<r.length&&(t=r.attr("data-log-node")),this.sender.enqueue(d.mouseClick,[e,n,t,i])},onWindowFocus:function(){this.sender.enqueue(d.windowFocus)},onWindowBlur:function(){this.sender.enqueue(d.windowBlur)}};var p=new f;S.MOUSEMOVE_LOG&&T.on("mousemove",$.throttle(b(function(t){p.onMouseMove(t.target)}),10)),T.on("click",b(function(t){p.onMouseClick(t.target,t.pageX,t.pageY,t.which)})),m.on("scroll resize",$.debounce(b(function(){p.grabberDom.grabViewport()}),S.VIEWPORT_CHANGE_TIMEOUT)).on("focus",b(function(){p.onWindowFocus()})).on("blur",b(function(){p.onWindowBlur()}))}))},window.$&&$.throttle&&window.BEM&&window.w?MOUSE_TRACKING():window.Ya&&Ya.define?Ya.define("mouse-tracking",["jquery","BEM"],MOUSE_TRACKING):function(){var t;window.logSerpJsError&&((t=new Error("Mouse tracking requires global $ and BEM, or Ya.define")).additional={scripts:function(){for(var t=[],e=document.getElementsByTagName("script"),n=0;n<e.length;n++){var i=e[n],r=i.src,s=i.id,i={};r&&(i.src=r),s&&(i.id=s),t.push(i)}return t}()},logSerpJsError(t))}());
