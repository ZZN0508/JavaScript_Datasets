!function(i){"use strict";function a(e,t){this.init(e,t)}a.prototype={constructor:a,init:function(e,t){var n,o;this.$element=i(e),this.options=i.extend({},i.fn.modalmanager.defaults,this.$element.data(),"object"==typeof t&&t),this.stack=[],this.backdropCount=0,this.options.resize&&(o=this,i(window).on("resize.modal",function(){n&&clearTimeout(n),n=setTimeout(function(){for(var e=0;e<o.stack.length;e++)o.stack[e].isShown&&o.stack[e].layout()},10)}))},createModal:function(e,t){i(e).modal(i.extend({manager:this},t))},appendModal:function(n){this.stack.push(n);var o=this;n.$element.on("show.modalmanager",c(function(e){function t(){n.isShown=!0;var t=i.support.transition&&n.$element.hasClass("fade");o.$element.toggleClass("modal-open",o.hasOpenModal()).toggleClass("page-overflow",i(window).height()<o.$element.height()),n.$parent=n.$element.parent(),n.$container=o.createContainer(n),n.$element.appendTo(n.$container),o.backdrop(n,function(){n.$element.show(),t&&n.$element[0].offsetWidth,n.layout(),n.$element.addClass("in").attr("aria-hidden",!1);function e(){o.setFocus(),n.$element.trigger("shown")}t?n.$element.one(i.support.transition.end,e):e()})}n.options.replace?o.replace(t):t()})),n.$element.on("hidden.modalmanager",c(function(e){o.backdrop(n),n.$backdrop&&i.support.transition&&n.$element.hasClass("fade")?n.$backdrop.one(i.support.transition.end,function(){o.destroyModal(n)}):o.destroyModal(n)})),n.$element.on("destroy.modalmanager",c(function(e){o.removeModal(n)}))},destroyModal:function(e){e.destroy();var t=this.hasOpenModal();this.$element.toggleClass("modal-open",t),t||this.$element.removeClass("page-overflow"),this.removeContainer(e),this.setFocus()},hasOpenModal:function(){for(var e=0;e<this.stack.length;e++)if(this.stack[e].isShown)return!0;return!1},setFocus:function(){for(var e,t=0;t<this.stack.length;t++)this.stack[t].isShown&&(e=this.stack[t]);e&&e.focus()},removeModal:function(e){e.$element.off(".modalmanager"),e.$backdrop&&this.removeBackdrop(e),this.stack.splice(this.getIndexOfModal(e),1)},getModalAt:function(e){return this.stack[e]},getIndexOfModal:function(e){for(var t=0;t<this.stack.length;t++)if(e===this.stack[t])return t},replace:function(e){for(var t,n=0;n<this.stack.length;n++)this.stack[n].isShown&&(t=this.stack[n]);t?(this.$backdropHandle=t.$backdrop,t.$backdrop=null,e&&t.$element.one("hidden",c(i.proxy(e,this))),t.hide()):e&&e()},removeBackdrop:function(e){e.$backdrop.remove(),e.$backdrop=null},createBackdrop:function(e){var t;return this.$backdropHandle?((t=this.$backdropHandle).off(".modalmanager"),this.$backdropHandle=null,this.isLoading&&this.removeSpinner()):t=i('<div class="modal-backdrop '+e+'" />').appendTo(this.$element),t},removeContainer:function(e){e.$container.remove(),e.$container=null},createContainer:function(t){var e=i('<div class="modal-scrollable">').css("z-index",d("modal",t?this.getIndexOfModal(t):this.stack.length)).appendTo(this.$element);return t&&"static"!=t.options.backdrop?e.on("click.modal",c(function(e){t.hide()})):t&&e.on("click.modal",c(function(e){t.attention()})),e},backdrop:function(e,t){var n,o=e.$element.hasClass("fade")?"fade":"",a=e.options.backdrop&&this.backdropCount<this.options.backdropLimit;e.isShown&&a?(a=i.support.transition&&o&&!this.$backdropHandle,e.$backdrop=this.createBackdrop(o),e.$backdrop.css("z-index",d("backdrop",this.getIndexOfModal(e))),a&&e.$backdrop[0].offsetWidth,e.$backdrop.addClass("in"),this.backdropCount+=1,a?e.$backdrop.one(i.support.transition.end,t):t()):!e.isShown&&e.$backdrop?(e.$backdrop.removeClass("in"),--this.backdropCount,n=this,i.support.transition&&e.$element.hasClass("fade")?e.$backdrop.one(i.support.transition.end,function(){n.removeBackdrop(e)}):n.removeBackdrop(e)):t&&t()},removeSpinner:function(){this.$spinner&&this.$spinner.remove(),this.$spinner=null,this.isLoading=!1},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove(),this.$backdropHandle=null,this.removeSpinner()},loading:function(e){var t,n;e=e||function(){},this.$element.toggleClass("modal-open",!this.isLoading||this.hasOpenModal()).toggleClass("page-overflow",i(window).height()<this.$element.height()),this.isLoading?this.isLoading&&this.$backdropHandle?(this.$backdropHandle.removeClass("in"),t=this,i.support.transition?this.$backdropHandle.one(i.support.transition.end,function(){t.removeLoading()}):t.removeLoading()):e&&e(this.isLoading):(this.$backdropHandle=this.createBackdrop("fade"),this.$backdropHandle[0].offsetWidth,this.$backdropHandle.css("z-index",d("backdrop",this.stack.length)).addClass("in"),n=i(this.options.spinner).css("z-index",d("modal",this.stack.length)).appendTo(this.$element).addClass("in"),this.$spinner=i(this.createContainer()).append(n).on("click.modalmanager",i.proxy(this.loading,this)),this.isLoading=!0,i.support.transition?this.$backdropHandle.one(i.support.transition.end,e):e())}};var s,r,d=(r={},function(e,t){var n,o;return void 0===s&&(n=i('<div class="modal hide" />').appendTo("body"),o=i('<div class="modal-backdrop hide" />').appendTo("body"),r.modal=+n.css("z-index"),r.backdrop=+o.css("z-index"),s=r.modal-r.backdrop,n.remove(),o.remove(),o=n=null),r[e]+s*t});function c(t){return function(e){if(this===e.target)return t.apply(this,arguments)}}i.fn.modalmanager=function(n,o){return this.each(function(){var e=i(this),t=e.data("modalmanager");t||e.data("modalmanager",t=new a(this,n)),"string"==typeof n&&t[n].apply(t,[].concat(o))})},i.fn.modalmanager.defaults={backdropLimit:999,resize:!0,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>'},i.fn.modalmanager.Constructor=a}(jQuery);
