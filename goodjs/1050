define(["OK/logger","OK/utils/utils"],function(c,l){"use strict";var d,g="GoSearch",t=document.getElementById("hook_Cfg_CurrentUser"),h=t?OK.util.parseJSON(t.innerHTML):null;function e(t){var s,e=this.getAttribute("data-gid"),i=this.getAttribute("data-query"),a=this.getAttribute("data-state"),r=this.getAttribute("data-tip"),u="1"===this.getAttribute("data-close-layers"),o={"st.cmd":a},n=this.getAttribute("data-url");i&&(o.query=i,e&&(o["st.groupId"]=e),d&&d.xhr.abort(),d=l.ajax({url:"/",data:o}).fail(function(){c.success(g,"fail")}).done(function(t,e,i){l.updateBlockModelCallback(t,e,i),s=parseInt(i.getResponseHeader("X-ScT")||"0",10),isNaN(s)&&(s=0),window.scrollTo(0,s),n&&OK.historyManager.pushState(n),r&&OK.hookModel.setHookContent("TipBlock",""),u&&OK.Layers.unregisterAll()}),e=OK.hookModel.getNearestBlockHookId(this),c.success(g,"query",a+(e?"_"+e:"")),h&&h.uid&&(o=~~(h.uid%256/64),c.success(g,"query."+o,a+(e?"_"+e:"")),r&&c.success(g,"tip."+r+"."+o,a+(e?"_"+e:""))),t.preventDefault())}return{activate:function(t){t.addEventListener("click",e)},deactivate:function(t){t.removeEventListener("click",e)}}});
