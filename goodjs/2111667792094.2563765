!function(){var t=navigator.platform.toUpperCase(),a=-1!==t.indexOf("MAC"),r=$("#kw"),n=$("#form").parent(),s={1:"æŠ±æ­‰ï¼Œæ‚¨ä¸Šä¼ çš„æ–‡ä»¶ä¸æ˜¯å›¾ç‰‡æ ¼å¼",2:"å›¾ç‰‡ä¸Šä¼ å¤±è´¥",3:"æŠ±æ­‰ï¼Œæ‚¨ä¸Šä¼ çš„æ–‡ä»¶å¤ªå¤§"},o=null,u={getEnv:function(){if(bds&&bds.comm){if(bds.comm.ishome&&bds.comm.newindex)return"newindex";if(bds.comm.ishome)return"index";if(/^\/imgsearch/.test(location.pathname))return"imgresult"}return"result"},supportVoice:function(){return window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.AudioContext=window.AudioContext||window.webkitAudioContext,!!(navigator.getUserMedia&&window.URL&&window.AudioContext&&window.Worker&&swfobject.hasFlashPlayerVersion("11.1.0"))},parseQuery:function(){for(var t=window.location.search.substr(1),e={},a=t.substring(t.indexOf("?")+1,t.length).split("&"),n=0;n<a.length;n++){var o=a[n].split("=");o[0]&&(e[o[0]]=decodeURIComponent(o[1]))}return e},getQuery:function(t){t=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(t);return null!=t?t[2]:null},isURL:function(t){return/^(((http[s]?:\/\/)|(ftp:\/\/))?([\w-]+\.)+(com|edu|gov|int|mil|net|org|biz|info|pro|name|museum|coop|aero|xxx|idv|al|dz|af|ar|ae|aw|om|az|eg|et|ie|ee|ad|ao|ai|ag|at|au|mo|bb|pg|bs|pk|py|ps|bh|pa|br|by|bm|bg|mp|bj|be|is|pr|ba|pl|bo|bz|bw|bt|bf|bi|bv|kp|gq|dk|de|tl|tp|tg|dm|do|ru|ec|er|fr|fo|pf|gf|tf|va|ph|fj|fi|cv|fk|gm|cg|cd|co|cr|gg|gd|gl|ge|cu|gp|gu|gy|kz|ht|kr|nl|an|hm|hn|ki|dj|kg|gn|gw|ca|gh|ga|kh|cz|zw|cm|qa|ky|km|ci|kw|cc|hr|ke|ck|lv|ls|la|lb|lt|lr|ly|li|re|lu|rw|ro|mg|im|mv|mt|mw|my|ml|mk|mh|mq|yt|mu|mr|us|um|as|vi|mn|ms|bd|pe|fm|mm|md|ma|mc|mz|mx|nr|np|ni|ne|ng|nu|no|nf|na|za|zq|aq|gs|eu|pw|pn|pt|jp|se|ch|sv|ws|yu|sl|sn|cy|sc|sa|cx|st|sh|kn|lc|sm|pm|vc|lk|sk|si|sj|sz|sd|sr|sb|so|tj|tw|th|tz|to|tc|tt|tn|tv|tr|tm|tk|wf|vu|gt|ve|bn|ug|ua|uy|uz|es|eh|gr|hk|sg|nc|nz|hu|sy|jm|am|ac|ye|iq|ir|il|it|in|id|uk|vg|io|jo|vn|zm|je|td|gi|cl|cf|cn)(:\d+)?(\/[^\s]*)?)$/.test(t)},blobtoBase64:function(t,e){var a=new FileReader;a.onload=function(){e(this.result)},a.onerror=function(){e()},a.readAsDataURL(t)},compressImg:function(n){function o(t){var e=t.width,a=t.height;(800<e||800<a)&&(e/=o=Math.max(e/800,a/800),a/=o);var n=document.createElement("canvas");n.width=e,n.height=a;var o=n.getContext("2d");return o.fillRect(0,0,n.width,n.height),o.drawImage(t,0,0,e,a),function(t,e,a){e=e||"",a=a||512;for(var n=atob(t),o=[],s=n.length,i=0;i<s;i+=a){for(var r=n.slice(i,i+a),u=new Array(r.length),l=0;l<r.length;l++)u[l]=r.charCodeAt(l);var c=new Uint8Array(u);o.push(c)}return new Blob(o,{type:e})}(n.toDataURL("image/jpeg",1).replace(/^.*?,/,""),"image/jpeg")}var t,e,a,s=new $.Deferred,i=n.size;return t=n,e=function(t,e){var a=new Image;a.onload=function(){i<102400&&a.width<800&&a.height<800||(n=o(a)),s.resolve(n)},a.src=e},(a=new FileReader).onload=function(){var t=this.result.split("base64,")[1];e(t,this.result)},a.onerror=function(){e()},a.readAsDataURL(t),s.promise()},sendLog:function(t){var e=location.href.match(/sign=(\w{32})\b/),e=e&&e[1]||"";t.sign=e,t.fm="inlo",t.rsv_imageclick&&(t.rsv_imageclick=u.getEnv()+"_"+t.rsv_imageclick),window.soutu_mixsearch&&(t.rsv_imagemix=1),window.ns_c(t)},loadScript:function(t){var e=document.createElement("script");e.async=!0,e.setAttribute("charset","UTF-8"),e.src=t,document.getElementsByTagName("head")[0].appendChild(e)}},i=function(){return'<span class="soutu-btn"></span>'},l=function(){return'<span class="soutu-hover-tip" style="display: none;">æŒ‰å›¾ç‰‡æœç´¢</span>'},c=function(){return'<div class="soutu-layer new-pmd"><div class="soutu-url"><span class="soutu-url-wrap"><input id="soutu-url-kw" class="soutu-url-kw" maxlength="255" autocomplete="off" placeholder="åœ¨æ­¤å¤„ç²˜è´´å›¾ç‰‡ç½‘å€"/></span><span class="soutu-url-btn soutu-url-btn-old"><i class="soutu-icon soutu-url-btn-icon"></i></span><span class="soutu-url-btn soutu-url-btn-new">ç™¾åº¦ä¸€ä¸‹</span><span class="soutu-url-error">è¯·è¾“å…¥æ­£ç¡®çš„å›¾ç‰‡ç½‘å€</span></div><div class="soutu-state-normal"><div class="soutu-drop"><span class="soutu-drop-tip">æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ</span><i class="soutu-icon soutu-drop-icon"></i></div><div class="upload-wrap"><input type="file" class="upload-pic" value="ä¸Šä¼ å›¾ç‰‡"/><i class="soutu-icon upload-icon"></i><span class="upload-text upload-text-old">æœ¬åœ°ä¸Šä¼ å›¾ç‰‡</span><span class="upload-text upload-text-new">é€‰æ‹©æ–‡ä»¶</span></div></div><a class="soutu-icon soutu-close soutu-close-old" href="javascript:void(0);"></a><a class="soutu-close c-icon soutu-close-new" href="javascript:void(0);">&#xe610;</a></div>'},d=function(){return['<div class="soutu-state-waiting soutu-waiting">',"<p>æ­£åœ¨åŠ è½½å›¾ç‰‡...</p>","</div>"].join("")},p=function(t,e){e=1===e||3===e;return'<div class="soutu-state-error soutu-error'+(e?" soutu-error-hastip":"")+'"><p class="soutu-error-main"><i class="c-icon c-gap-right-small soutu-error-icon">&#xe622;</i>'+t+'ï¼Œè¯·<a href="javascript:void(0)" class="soutu-error-upload">é‡æ–°ä¸Šä¼ </a></p>'+(e?'<p class="soutu-error-tip">ä»…æ”¯æŒ10Mä»¥ä¸‹jpgï¼Œjpegï¼Œpngï¼Œbmpï¼Œgifæ ¼å¼å›¾ç‰‡</p>':"")+"</div>"},g=function(t){return['<div class="soutu-state-newtabtip soutu-newtab">','<div class="soutu-newtab-cont">','<div class="soutu-newtab-img" style="background-image:url('+t.imgUrl+')">',"</div>",'<div class="soutu-newtab-text">',"<p>"+t.text+"</p>","<span></span>","</div>","</div>",'<a class="soutu-newtab-link" href="'+t.url+'" target="_blank">æŸ¥çœ‹æœç´¢ç»“æžœ</a>',"</div>"].join("")},f=function(){var t,a,e,n,o,s,i;"imgresult"===u.getEnv()&&(t=$("#form"),(a=t.find(".soutu-input-image")).length&&(e=!0,n=u.parseQuery(),o=t.find("input[type=hidden]"),s=o.clone(),t.attr("action","/imgsearch"),o.remove(),delete n.wd,t.append('<input type="hidden" name="sign" value="'+n.sign+'">'),i=function(){a.remove(),a.off("click.soutu"),a.removeClass("soutu-input-image-active"),r.off(".soutu"),r.attr("placeholder","").removeClass("soutu-input"),e=!1,t.find("input[type=hidden]").remove(),t.append(s),t.attr("action","/s")},a.on("click.soutu",function(){i(),u.sendLog({rsv_imageclick:"del_thumb_by_click"})}),r.on("keydown",function(t){var e=r.val();return 8!==t.which||e.length?void(e.length<=1&&a.hasClass("soutu-input-image-active")&&a.removeClass("soutu-input-image-active")):void(a.hasClass("soutu-input-image-active")?(i(),u.sendLog({rsv_imageclick:"del_thumb_by_return"})):a.addClass("soutu-input-image-active"))}),r.on("focus.soutu",function(){a.show()}),r.on("click",function(){u.sendLog(e?{rsv_imageclick:"click_input_thumb"}:{rsv_imageclick:"click_input"})}),r.on("blur.soutu",function(){a.removeClass("soutu-input-image-active")}),$("#su").on("click.soutu",function(){var t=r.val();return e&&!t.length?(u.sendLog({rsv_imageclick:"search_only_thumb"}),location.href="/imgsearch?"+$.param({sign:n.sign,wd:n.sign.substr(5,16)}),!1):void 0}),t.on("submit",function(){u.sendLog(e?{rsv_imageclick:"search_image_and_text"}:{rsv_imageclick:"search_only_text"})})))},e={init:function(){var t=this;t.canDrop="ondrop"in document.body;var e=$('<link rel="stylesheet" href="https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/static/protocol/https/soutu/css/soutu_new2_ae491b7.css" type="text/css" data-for="result"/>');"newindex"===u.getEnv()?e.insertBefore(n.parent()):e.appendTo("head"),t.$graphIcon=$(i()).prependTo(r.parent()),t.$hoverTip=$(l()).appendTo(r.parent()),n.addClass(a?"soutu-env-mac":"soutu-env-nomac").addClass("soutu-env-"+u.getEnv()),t.state="init",f(),t.listenIcon()},listenIcon:function(){var e=this;e.$graphIcon.on("click",function(t){t.stopPropagation(),t.preventDefault(),e.show(),e.log({rsv_imageclick:"camerabtn"}),e.antispam()}),e.$graphIcon.hover(function(){clearTimeout(o),e.$hoverTip.show()},function(){o=setTimeout(function(){e.$hoverTip.hide()},200)}),$(document).on("dragstart.soutu",function(t){var e,a=t.originalEvent.dataTransfer,n=t.target||t.srcElement,t=n.nodeName.toLowerCase();if("img"===t){e=n.src;try{a.setData("text/plain",e)}catch(t){a.setData("Text",e)}}else if("a"===t){n=$(n).children("img");if(n.length){e=n[0].src;try{a.setData("text/plain",e)}catch(t){a.setData("Text",e)}}}}),r.on("drop.soutu",function(t){t.originalEvent.dataTransfer&&t.originalEvent.dataTransfer.files&&t.originalEvent.dataTransfer.files.length&&(t.stopPropagation(),t.preventDefault(),e.$graphIcon.trigger("click"),e.handleDrop(t),e.log({rsv_imageclick:"iptdrop"}))}).on("dragover.soutu",function(){var t=window.bds&&bds.se&&bds.se.upn&&bds.se.upn.cookieset||[];return!(t[0]&&1===t[0].v)}),$(window).one("index_off",function(){n.removeClass("soutu-env-newindex"),n.removeClass("soutu-no-skin")})},show:function(){var t=this;t.$layer||t.addLayer();var e=t.$layer;t.setState("normal"),e.show(),t.$graphIcon.hide(),t.$hoverTip&&t.$hoverTip.hide(),$("#form .bdsug").hide(),1!==window.pageState||n.hasClass("soutu-env-result")||n.addClass("soutu-env-result"),"newindex"===u.getEnv()&&(n.addClass("soutu-env-newindex"),window.s_session&&0!=!!s_session.userSkinName?e.removeClass("soutu-no-skin"):e.addClass("soutu-no-skin")),n.addClass("soutu-env-new")},close:function(){var t=this;t.$layer.hide(),t.$graphIcon.show(),t.setState("normal"),t.$urlErrorTip.hide(),t.$urlInput.val("")},addLayer:function(){var t=this,e=t.$layer=$(c()).prependTo($("#form"));t.$urlInput=e.find("#soutu-url-kw").on("focus",function(){e.find(".soutu-url-layer").addClass("focus")}).on("blur",function(){e.find(".soutu-url-layer").removeClass("focus")}),"newindex"===u.getEnv()&&$(".s-lite").not(".hide-icon").length&&e.find(".soutu-url-btn").css("width","103px"),t.$dropArea=e.find(".soutu-drop"),t.$urlErrorTip=e.find(".soutu-url-error"),t.$urlSearchBtn=e.find(".soutu-url-btn"),t.panelHidden=!1,t.listenLayer()},handleDrop:function(e){var a,t=this;if(t.$dropArea.removeClass("drag-over"),(n=e.originalEvent.dataTransfer?e.originalEvent.dataTransfer.files:n)&&0!==n.length){var n=n[0];t.uptype="drag",t.upload(n,"PC_UPLOAD_SEARCH_MOVE")}else{try{a=e.originalEvent.dataTransfer.getData("text/plain")||e.originalEvent.dataTransfer.getData("text/uri-list")}catch(t){a=e.originalEvent.dataTransfer.getData("Text")||e.originalEvent.dataTransfer.getData("URL")}a?t.handleURL(a):t.setState("error")}},listenLayer:function(){var n=this,t=n.$layer;n.$urlInput.on("focus",function(){t.find(".soutu-url-panel").addClass("focus")}).on("blur",function(){t.find(".soutu-url-panel").removeClass("focus")}).on("keydown",function(t){var e=t.keyCode;return"none"!==n.$urlErrorTip.css("display")&&n.$urlErrorTip.hide(),13===e?(n.handleURL(this.value),t.stopPropagation(),t.preventDefault(),!1):void 0}),n.$urlSearchBtn.on("click",function(){var t=n.$urlInput.val();n.handleURL(t)}),n.$layer.find(".upload-pic").on("change",function(){var t=this.files[0];t&&(n.uptype="upload",n.upload(t,"PC_UPLOAD_SEARCH_FILE"))}),n.$layer.find(".upload-pic").on("click",function(){n.log({rsv_imageclick:"uploadbtn"})}),n.$dropArea.on("dragover",function(t){n.$dropArea.addClass("drag-over"),t.stopPropagation(),t.preventDefault()}).on("dragleave",function(t){n.$dropArea.removeClass("drag-over"),t.stopPropagation(),t.preventDefault()}).on("drop",function(t){t.stopPropagation(),t.preventDefault(),n.handleDrop(t)}),n.$layer.find(".soutu-close").on("click",function(){n.close(!0),n.log({rsv_imageclick:"close"})}),n.$layer.on("click",".soutu-error-upload",function(t){t.stopPropagation(),t.preventDefault(),n.setState("normal")}),$(document).on("click",function(t){var e=t.target,a=!0;do{if((e=e.parentNode)===n.$layer[0]||e===n.$graphIcon[0]){a=!1;break}}while(e.parentNode);a&&n.close()})},setNormal:function(){this.$layer.find(".soutu-state-normal").show(),this.$layer.find(".upload-pic").val("")},setWaiting:function(){this.$layer.append(d());var e=[[0,40],[20,20],[40,0]],s=["rgb(55,137,250)","rgb(99,99,99)","rgb(235,67,70)"];this.$layer.find(".b").each(function(a,n){var o=0;$(n).css({"background-color":s[a]}),function t(){$(n).animate({left:e[a][o%2]},{duration:800,easing:"swing",progress:function(t,e){.5<=e&&$(n).css({"background-color":s[(o+a)%3]})},complete:function(){t()}}),o++}()})},setError:function(t){var e=t.msg||s[2];this.$layer.append(p(e,t.status))},setNewTabTip:function(t){var e=this.$layer.find(".soutu-state-newtabtip");e.length&&e.remove(),e=$(g(t)),this.$layer.append(e),u.sendLog({rsv_imageclick:"tipForNewTab"})},setState:function(t,e){var a=this;a.state=t,a.$layer.find(".soutu-state-normal").hide(),a.$layer.find(".soutu-state-error").remove(),a.$layer.find(".soutu-state-waiting").remove(),a.$layer.find(".soutu-state-newtabtip").remove(),a.$urlErrorTip.hide(),a["set"+(t=t.charAt(0).toUpperCase()+t.substring(1))].apply(a,[e||{}])},handleURL:function(t){u.isURL(t)?(this.$urlInput.val(t),this.setState("normal"),this.$urlErrorTip.hide(),this.uploadUrl(t),this.log({rsv_imageclick:"searchurl-success"})):(this.setState("normal"),this.$urlErrorTip.show(),this.log({rsv_imageclick:"searchurl-error"}))},openResutlPage:function(e){var a,t,n=this;"_blank"===$("#form").attr("target")?(a="å›¾ç‰‡ä¸Šä¼ å®Œæ¯•ï¼Œæ ¹æ®æ‚¨çš„æœç´¢ä¹ æƒ¯ï¼Œ<br/>å°†æ‰“å¼€æ–°çª—å£å±•ç¤ºæœç´¢ç»“æžœ",(t=window.player)&&t.config&&t.config.play.on&&(a="æ‚¨æ­£åœ¨å¬éŸ³ä¹ï¼Œä¸ºäº†ä¸æ‰“æ‰°æ‚¨ç»§ç»­å¬éŸ³ä¹ï¼Œ<br/>å°†æ‰“å¼€æ–°çª—å£æŸ¥çœ‹æœç´¢ç»“æžœ"),$.isString(n.uploadObj)?n.setState("newTabTip",{text:a,imgUrl:n.uploadObj,url:e}):u.blobtoBase64(n.uploadObj,function(t){n.setState("newTabTip",{text:a,imgUrl:t,url:e})})):(location.href=e,n.close())},validate:function(t){var e=t.name.split(".").pop().toLowerCase();return t.type&&e&&-1!==$.inArray(e,["jpg","jpeg","png","bmp","gif","webp"])?10485760<t.size?3:0:1},doAjax:function(t){var e=this;"waiting"!==this.state&&this.setState("waiting"),$.ajax({url:"//graph.baidu.com/upload",type:"POST",data:t,processData:!1,contentType:!1,success:function(t){e.uploadComplete(t)},error:function(){e.setState("error")},always:function(){}})},uploadUrl:function(t){this.uploadObj=t,this.log({rsv_imageclick:"uploadurl"}),this.upload(t,"PC_UPLOAD_SEARCH_URL")},upload:function(t,e){var a=this,n=0===window.pageState?'{"page_from": "searchIndex"}':' {"page_from": "searchResult"}';if("PC_UPLOAD_SEARCH_URL"!==e){a.uploadObj=t,a.$urlInput.val("");var o=a.validate(t);if(o)return void a.setState("error",{msg:s[o],status:o});a.log({rsv_imageclick:"uploadfile"})}a.setState("waiting");o=new FormData;o.append("image",t),o.append("tn","pc"),o.append("from","pc"),o.append("image_source",e),o.append("range",n),o.append("sdkParams",a.shituSdkParams||""),a.doAjax(o)},uploadComplete:function(t){0===t.status?setTimeout(function(){window.location.href=t.data.url},30):this.setState("error")},antispam:function(){var e=this;e.shituSdkParams||(window.__abbaidu_2033_subidgetf=function(){return"www_pc"},window.__abbaidu_2033_cb=function(t){e.shituSdkParams=t},u.loadScript("https://dlswbr.baidu.com/heicha/mw/abclite-2033-s.js"))},log:u.sendLog};e.init(),"function"==typeof define&&define("soutu/js/tu",["require"],function(){return e})}();
