(self.AMP=self.AMP||[]).push({n:"amp-ad-exit",ev:"0.1",l:!0,v:"2106030132000",m:0,f:function(e,t){"use strict";var n,o="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if(!function(t){for(var e=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],n=0;n<e.length;++n){var r=e[n];if(r&&r.Math==Math)return}!function(){throw Error("Cannot find global object")}()}(this),"function"==typeof Symbol&&Symbol("x"),"function"==typeof Object.setPrototypeOf)m=Object.setPrototypeOf;else{t:{var r={};try{r.__proto__={a:!0},n=r.a;break t}catch(t){}n=!1}m=n?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var i=m;function a(t,e){if(t.prototype=o(e.prototype),t.prototype.constructor=t,i)i(t,e);else for(var n in e){var r;"prototype"!=n&&(Object.defineProperties?(r=Object.getOwnPropertyDescriptor(e,n))&&Object.defineProperty(t,n,r):t[n]=e[n])}t.W=e.prototype}var p=Object.prototype.toString;function s(t,e){this.name=t,this.type=e}function l(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}s.prototype.filter=function(){},s.prototype.onLayoutMeasure=function(){};var c=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function f(t,e){e=e=void 0===e?"":e;try{return decodeURIComponent(t)}catch(t){return e}}function u(t){var e=Object.create(null);if(!t)return e;for(;r=c.exec(t);){var n=f(r[1],r[1]),r=r[2]?f(r[2].replace(/\+/g," "),r[2]):"";e[n]=r}return e}var h="";var m=self.AMP_CONFIG||{},v=("string"==typeof m.cdnProxyRegex?new RegExp(m.cdnProxyRegex):m.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function d(t){!self.document||!self.document.head||self.location&&v.test(self.location.origin)||(t=self.document.head.querySelector('meta[name="'+t+'"]'))&&t.getAttribute("content")}m.cdnUrl||d("runtime-host"),m.geoApiUrl||d("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var g,y=self.__AMP_LOG;function b(){if(!y.user)throw Error("failed to call initLogConstructor");return y.user}function _(){if(y.dev)return y.dev;throw Error("failed to call initLogConstructor")}function A(t,e,n,r){b().assert(t,e,n,r,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}function E(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}function S(t){return t=t.nodeType?w(E((t.ownerDocument||t).defaultView),"ampdoc").getAmpDoc(t):t}function O(t){return(t=S(t)).isSingleDoc()?t.win:t}function w(t,e){return P(t,e),(t=M(t)[e]).obj||(t.obj=new t.ctor(t.context),t.context=null,t.resolve&&t.resolve(t.obj)),t.obj}function x(t){var e,n,r=(r=M(t)["host-exit"])?r.promise||(w(t,"host-exit"),r.promise=Promise.resolve(r.obj)):null;return r||((t=M(t))["host-exit"]=(e=new l,n=e.promise,r=e.reject,e=e.resolve,n.catch(function(){}),{obj:null,promise:n,resolve:e,reject:r,context:null,ctor:null}),t["host-exit"].promise)}function M(t){return t.__AMP_SERVICES||(t.__AMP_SERVICES={})}function P(t,e){return(t=t.__AMP_SERVICES&&t.__AMP_SERVICES[e])&&t.ctor}function j(t,e,n){try{var r=t.open(e,n,void 0)}catch(t){_().error("DOM","Failed to open url on target: ",n,t)}var o;(n=!(n=r||"_top"==n)?!(0<(o="number"!=typeof o?0:o)+8)&&-1!=="".indexOf("noopener",o):n)||t.open(e,"_top")}function T(t,e){function n(e){try{return o(e)}catch(t){var n;throw null==(e=(n=self).__AMP_REPORT_ERROR)||e.call(n,t),t}}var r=t,o=e,i=function(){if(void 0!==g)return g;g=!1;try{var t={get capture(){g=!0}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return g}();return r.addEventListener("message",n,!!i&&void 0),function(){null==r||r.removeEventListener("message",n,!!i&&void 0),n=r=o=null}}function I(e){if("string"!=typeof(t=e)||0!=t.indexOf("amp-")||-1==t.indexOf("{"))return null;var t=e.indexOf("{");return function(t,e){try{return JSON.parse(t)}catch(t){return null==e||e(t),null}}(e.substr(t),function(t){return _().error("MESSAGING","Failed to parse message: "+e,t)})}var C,R,L={bg:"https://tpc.googlesyndication.com/b4a/b4a-runner.html",moat:"https://z.moatads.com/ampanalytics093284/iframe.html"};function k(t){if(A("object"==typeof t),t.filters){var e,n=t.filters,r=["clickDelay","clickLocation","inactiveElement"];for(e in n)A("object"==typeof n[e],"Filter specification '%s' is malformed",e),A(-1!=r.indexOf(n[e].type),"Supported filters: "+r.join(", "))}else t.filters={};if(t.transport)for(var o in n=t.transport)A("beacon"==o||"image"==o,"Unknown transport option: '"+o+"'"),A("boolean"==typeof n[o]);else t.transport={};for(var i in A("object"==typeof(o=t.targets),"'targets' must be an object"),o)!function(t,e,n){if(A("string"==typeof e.finalUrl,"finalUrl of target '%s' must be a string",t),e.filters&&e.filters.forEach(function(t){A(n.filters[t],"filter '%s' not defined",t)}),e.vars)for(var r in t=/^_[a-zA-Z0-9_-]+$/,e.vars)A(t.test(r),"'%s' must match the pattern '%s'",r,t)}(i,o[i],t);return t}function D(t){return b().assertString(L[t],"Unknown or invalid vendor "+t+", note that vendor must use transport: iframe")}function N(t,e,n){s.call(this,t,e.type),A("clickDelay"==e.type&&"number"==typeof e.delay&&0<e.delay,"Invalid ClickDelay spec"),this.spec=e,this.intervalStart=Date.now(),e.startTimingEvent&&(n.performance&&n.performance.timing?null==n.performance.timing[e.startTimingEvent]?_().warn("amp-ad-exit","Invalid performance timing event type "+e.startTimingEvent+", falling back to now"):this.intervalStart=n.performance.timing[e.startTimingEvent]:_().warn("amp-ad-exit","Browser does not support performance timing, falling back to now"))}function U(t){return{type:"clickDelay",delay:1e3,startTimingEvent:t}}function F(t,e,n){s.call(this,t,e.type),A(!("clickLocation"!=e.type||void 0!==e.left&&"number"!=typeof e.left||void 0!==e.right&&"number"!=typeof e.right||void 0!==e.top&&"number"!=typeof e.top||void 0!==e.bottom&&"number"!=typeof e.bottom||void 0!==e.relativeTo&&"string"!=typeof e.relativeTo),"Invaid ClickLocation spec"),this.S=e.left||0,this.T=e.right||0,this.V=e.top||0,this.P=e.bottom||0,this.J=e.relativeTo,this.M=n,this.h={top:0,right:0,bottom:0,left:0}}function G(t,e){s.call(this,t,e.type),A("inactiveElement"==e.type&&"string"==typeof e.selector,"Invalid InactiveElementspec"),this.U=e.selector}function V(t,e,n){switch(e.type){case"clickDelay":return new N(t,e,n.win);case"clickLocation":return new F(t,e,n);case"inactiveElement":return new G(t,e)}}function B(){this.R=100,this.H=this.K=0,this.B=Object.create(null)}function H(t){C||(C=self.document.createElement("a"),R=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new B));var e,n=R,r=C;return t=n&&n.has(t)?n.get(t):(r.href=t,r.protocol||(r.href=r.href),"/"!==(e={href:r.href,protocol:r.protocol,host:r.host,hostname:r.hostname,port:"0"==r.port?"":r.port,pathname:r.pathname,search:r.search,hash:r.hash,origin:null}).pathname[0]&&(e.pathname="/"+e.pathname),("http:"==e.protocol&&80==e.port||"https:"==e.protocol&&443==e.port)&&(e.port="",e.host=e.hostname),e.origin=r.origin&&"null"!=r.origin?r.origin:"data:"!=e.protocol&&e.host?e.protocol+"//"+e.host:e.href,n&&n.put(t,e),e)}function J(t){return(t=e.BaseElement.call(this,t)||this).L={},t.N={},t.C=[],t.D={beacon:!0,image:!0},t.G={},t.registerAction("exit",t.exit.bind(t)),t.registerAction("setVariable",t.setVariable.bind(t),1),t.O={},t.F=null,t.A=null,t.I={},t}function K(t,n){return t.every(function(t){var e=t.filter(n);return b().info("amp-ad-exit","Filter '"+t.name+"': "+(e?"pass":"fail")),e})}function X(r){var t,e,n;"inabox"!=(n=self,(e=n.__AMP_MODE||(e=u(n.location.originalHash||n.location.hash),h=h||(n.AMP_CONFIG&&n.AMP_CONFIG.v?n.AMP_CONFIG.v:"012106030132000"),t=u(n.location.originalHash||n.location.hash),t=!(!["1","actions","amp","amp4ads","amp4email"].includes(t.development)&&!n.AMP_DEV_MODE),n.__AMP_MODE={localDev:!1,development:t,examiner:"2"==e.development,esm:!1,geoOverride:e["amp-geo"],minified:!0,test:!1,log:e.log,version:"2106030132000",rtvVersion:h})).runtime)&&(r.A=r.A||function(t,e){try{t:{var n=(t.ownerDocument||t).defaultView,r=e||E(n);if(n&&n!=r&&E(n)==r)try{var o=n.frameElement;break t}catch(t){}o=null}var i=o.parentElement;if("AMP-AD"==i.nodeName)return String(i.getResourceId())}catch(t){}return null}(r.element,E(r.win)),r.A?r.F=T(r.getAmpDoc().win,function(t){var e,n;!r.I[t.origin]||(e=I(t.data))&&"iframe-transport-response"==e.type&&(t=t.origin,A(e.message,"Received empty response from 3p analytics frame"),A(e.creativeId,"Received malformed message from 3p analytics frame: creativeId missing"),A(e.vendor,"Received malformed message from 3p analytics frame: vendor missing"),A((n=H(D(e.vendor)))&&n.origin==t,"Invalid origin for vendor "+e.vendor+": "+t),e.creativeId==r.A&&(r.O[e.vendor]=e.message))}):b().warn("amp-ad-exit","No friendly parent amp-ad element was found for amp-ad-exit; not in inabox case."))}Object.assign({},L,{bg:"https://tpc.googlesyndication.com/b4a/experimental/b4a-runner.html"}),a(N,s),N.prototype.filter=function(){return Date.now()-this.intervalStart>=this.spec.delay},a(F,s),F.prototype.filter=function(t){return t.clientX>=this.h.left&&t.clientX<=this.h.right&&t.clientY>=this.h.top&&t.clientY<=this.h.bottom},F.prototype.onLayoutMeasure=function(){var n=this;this.M.getVsync().measure(function(){var t,e=n.M.win;n.J?(A(t=e.document.querySelector(n.J),"relativeTo element "+n.J+" not found."),t=t.getBoundingClientRect(),n.h.left=t.left,n.h.top=t.top,n.h.bottom=t.bottom,n.h.right=t.right):(n.h.left=0,n.h.top=0,n.h.bottom=e.innerHeight,n.h.right=e.innerWidth),n.h.left+=n.S,n.h.top+=n.V,n.h.right-=n.T,n.h.bottom-=n.P})},a(G,s),G.prototype.filter=function(t){var e=(t=t.target).matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector;return!(e&&e.call(t,this.U))},B.prototype.has=function(t){return!!this.B[t]},B.prototype.get=function(t){t=this.B[t];if(t)return t.access=++this.H,t.payload},B.prototype.put=function(t,e){if(this.has(t)||this.K++,this.B[t]={payload:e,access:this.H},!(this.K<=this.R)){t=this.B;var n,r=this.H+1;for(n in t){var o,i=t[n].access;i<r&&(r=i,o=n)}void 0!==o&&(delete t[o],this.K--)}},a(J,e.BaseElement),(m=J.prototype).exit=function(t){var e,n=this,r=t.args,o=t.event;A("variable"in r!="target"in r,"One and only one of 'target' and 'variable' must be specified"),"variable"in r?(A(e=!(e=this.N[r.variable])?r.default:e,"Variable target not found, variable:'"+r.variable+"', default:'"+r.default+"'"),delete r.default):e=r.target;var i,t=this.L[e];A(t,"Exit target not found: '"+e+"'"),A(o,"Unexpected null event"),o.preventDefault(),K(this.C,o)&&K(t.filters,o)&&(o=function(n,r,t,e){var o={CLICK_X:function(){return t.clientX},CLICK_Y:function(){return t.clientY}},i=function(t){return P(t=O(t=S(t)),"url-replace")?w(t,"url-replace"):null}(n.element),a={RANDOM:!0,CLICK_X:!0,CLICK_Y:!0};if(e.vars){var s,l={};for(s in e.vars)l.j=s,"_"==l.j[0]&&(l.o=e.vars[l.j],l.o&&(o[l.j]=function(e){return function(){if(e.o.iframeTransportSignal){var t=i.expandStringSync(e.o.iframeTransportSignal,{IFRAME_TRANSPORT_SIGNAL:function(t,e){if(!t||!e)return"";t=n.O[t];return t&&e in t?t[e]:void 0}});if(e.o.iframeTransportSignal=="IFRAME_TRANSPORT_SIGNAL"+t)_().error("amp-ad-exit","Invalid IFRAME_TRANSPORT_SIGNAL format:"+t+" (perhaps there is a space after a comma?)");else if(""!=t)return t}return e.j in r?r[e.j]:e.o.defaultValue}}(l),a[l.j]=!0)),l={o:l.o,j:l.j}}return function(t){return i.expandUrlSync(t,o,a)}}(this,r,o,t),t.trackingUrls&&t.trackingUrls.map(o).forEach(function(t){b().fine("amp-ad-exit","pinging "+t),n.D.beacon&&n.win.navigator.sendBeacon&&n.win.navigator.sendBeacon(t,"")||!n.D.image||(n.win.document.createElement("img").src=t)}),i=o(t.finalUrl),S(this.getAmpDoc()).getHeadNode().querySelector("script[host-service]")?x(O(this.getAmpDoc())).then(function(t){return t.openUrl(i)}).catch(function(t){_().fine("amp-ad-exit","ExitServiceError - fallback="+t.fallback),t.fallback&&j(n.win,i,"_blank")}):j(this.win,i,t.behaviors&&t.behaviors.clickTarget&&"_top"==t.behaviors.clickTarget?"_top":"_blank"))},m.setVariable=function(t){t=t.args,A(this.L[t.target],"Exit target not found: '"+t.target+"'"),this.N[t.name]=t.target},m.buildCallback=function(){var e=this;this.element.setAttribute("aria-hidden","true"),this.C.push(V("minDelay",U(),this)),this.C.push(V("carouselBtns",{type:"inactiveElement",selector:".amp-carousel-button"},this));var t=this.element.children;A(1==t.length,"The tag should contain exactly one <script> child."),A("SCRIPT"==(t=t[0]).tagName&&t.hasAttribute("type")&&"APPLICATION/JSON"==t.getAttribute("type").toUpperCase(),'The amp-ad-exit config should be inside a <script> tag with type="application/json"');try{var n,r,o,i=k(JSON.parse(t.textContent));for(r in"[object Object]"===p.call(i.options)&&"string"==typeof i.options.startTimingEvent&&(n=i.options.startTimingEvent,this.C.splice(0,1,V("minDelay",U(i.options.startTimingEvent),this))),i.filters){var a=i.filters[r];"clickDelay"==a.type&&(a.startTimingEvent=a.startTimingEvent||n),this.G[r]=V(r,a,this)}for(o in i.targets){var s,l,c,f,u=i.targets[o];for(s in this.L[o]={finalUrl:u.finalUrl,trackingUrls:u.trackingUrls||[],vars:u.vars||{},filters:(u.filters||[]).map(function(t){return e.G[t]}).filter(Boolean),behaviors:u.behaviors||{}},u.vars)u.vars[s].iframeTransportSignal&&(!(l=u.vars[s].iframeTransportSignal.match(/IFRAME_TRANSPORT_SIGNAL\(([^,]+)/))||l.length<2||(f=H(D(c=l[1])).origin,this.I[f]=this.I[f]||c))}this.D.beacon=!1!==i.transport.beacon,this.D.image=!1!==i.transport.image}catch(t){throw this.user().error("amp-ad-exit","Invalid JSON config",t),t}X(this)},m.resumeCallback=function(){X(this)},m.unlayoutCallback=function(){return this.F&&(this.F(),this.F=null),e.BaseElement.prototype.unlayoutCallback.call(this)},m.isLayoutSupported=function(){return!0},m.onLayoutMeasure=function(){for(var t in this.G)this.G[t].onLayoutMeasure()},self.AMP.registerElement("amp-ad-exit",J)}});
