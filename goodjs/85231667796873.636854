define(["webmd-xdm/1/webmd-xdm","newsletter/1/authmodule"],function(n,d){return{authModule:d,urlSubscribe:"https://www"+webmd.url.getEnv()+".webmd.com/api/reg/regapi.svc/secure/json2/subscribe2",urlUnsubscribe:"https://member"+webmd.url.getEnv()+".webmd.com/api/reg/regapi.svc/secure/json2/unsub",urlGetPromo:"/api/reg/regapi.svc/secure/jsonp/getnlappmapping",urlGetPromoImg:window.image_server_url+"/webmd/consumer_assets/site_images/registration/images/newsletterpromo/",urlAddChild:"https://member"+webmd.url.getEnv()+".webmd.com/api/reg/regapi.svc/secure/cds/addchild",urlUpdateChild:"https://member"+webmd.url.getEnv()+".webmd.com/api/reg/regapi.svc/secure/cds/updatechild",urlDeleteChild:"https://member"+webmd.url.getEnv()+".webmd.com/api/reg/regapi.svc/secure/cds/deletechild",urlGetChildren:"https://member"+webmd.url.getEnv()+".webmd.com/api/reg/regapi.svc/secure/cds/children",urlSubscribe2:"https://member"+webmd.url.getEnv()+".webmd.com/api/reg/regapi.svc/secure/json2/subscribe2",timeout:15e3,names:{11:"Allergies and Asthma",12:"Arthritis",13:"Breast Cancer",14:"Cancer",16:"Cholesterol Management",17:"Chronic Pain",18:"Diabetes",19:"Emotional Wellness",22:"Digestive Health",24:"Heart Health",26:"Men's Health",25:"Hypertension",27:"Multiple Sclerosis",28:"Parenting and Children's Health",29:"Rheumatoid Arthritis",35:"Women's Health",36:"WebMD Daily",40:"Healthy Bones",44:"Depression",45:"Fibromyalgia",60:"Alzheimer's",61:"Cold and Flu",62:"Menopause",63:"Oral Health",66:"ADD/ADHD",74:"COPD",77:"Healthy Cats",78:"Healthy Dogs",82:"Alternative Health",84:"Pregnancy and Baby",97:"Eye Health",261:"Your Health Insurance Guide",882:"Migraines",960:"Food & Fitness",962:"Good Health",1006:"Navigating Type 2 Diabetes",1166:"Coronavirus Update"},promoDefault:{image:"default.png",url:webmd.url.addLifecycleAndEnv("https://www.webmd.com/"),description:"Always safe &amp; secure, sign up with WebMD today and take advantage of a full suite of tools and services designed to help you on your journey to becoming a healthier you.",button:"Sign Up Now",appid:1,isMobile:!1},subscribe:function(e){var t={},r=this,s=new $.Deferred,o=s.promise();if(void 0===(e=$.extend({timeout:r.timeout},e)).id)throw"Missing newsletter id";if(!e.email)throw"Missing email address";return $.isArray(e.id)&&(e.id=e.id.join(",")),t.NLRequest={},t.NLRequest.NLIDS=e.id,t.Email=e.email,e.OptOutDefaultNewsletters&&(t.NLRequest.OptOutDefaultNewsletters=e.OptOutDefaultNewsletters),e.privacy&&(t.PPAccept=1),e.vendor&&(t.Vendor=e.vendor),e.publisher&&(t.publisher=e.publisher),e.campaign&&(t.campaign=e.campaign),clearTimeout(void 0),setTimeout(function(){s.reject(o,"timeout","Newsletter service timed out.")},e.timeout),n.receiverUrl=webmd.url.addLifecycleAndEnv("https://www.webmd.com/xdm-oo"),o=n.call({service:"regapi/subscribe2",data:JSON.stringify(t),headers:d.generate()}).done(function(e){var t,i;"success"===e.stat?webmd.cookie.exists("WBMD_AUTH")||webmd.cookie.exists("WBMD_SAUTH")||(t=webmd.object.get("subscriberKey",e),i=webmd.object.get("hash",e),webmd.cookie.set("REG_UUID",i,{expires:36500,domain:webmd.url.getSLD()}),r.cookieSet(t)):-52===e.code?s.reject(o,"readonly","Newsletter service is in readonly mode"):s.reject(o,"error","Newsletter service returned an error")}).fail(function(){webmd.debug("Service Failed!"),wmdPageLink("reg-error_l-nl")})},subscribe2:function(e){var t={},r=this,s=new $.Deferred,o=s.promise();if(!(e=$.extend({timeout:r.timeout},e)).Email)throw"Missing email address";if(e.NLRequest){if(t.NLRequest={},void 0===e.NLRequest.NLIDS)throw"Missing newsletter id";t.NLRequest.NLIDS=$.isArray(e.NLRequest.NLIDS)?e.NLRequest.NLIDS.join(","):e.NLRequest.NLIDS}if(e.CDSRequest){if(t.CDSRequest={},!e.CDSRequest.dob)throw"Missing birthdate";e.CDSRequest.firstname&&(t.CDSRequest.firstname=e.CDSRequest.firstname),e.CDSRequest.name&&(t.CDSRequest.name=e.CDSRequest.name),t.CDSRequest.dob=e.CDSRequest.dob,t.CDSRequest.gender=e.CDSRequest.gender||2}return t.Email=e.Email,clearTimeout(void 0),setTimeout(function(){s.reject(o,"timeout","Newsletter service timed out.")},e.timeout),webmd.debug("service.unsubscribe settings: ",e),n.receiverUrl=webmd.url.addLifecycleAndEnv("https://www.webmd.com/xdm-oo"),o=n.call({service:"regapi/subscribe2",data:JSON.stringify(t),headers:d.generate()}).done(function(e){var t,i;"success"===e.stat?webmd.cookie.exists("WBMD_AUTH")||webmd.cookie.exists("WBMD_SAUTH")||(t=webmd.object.get("subscriberKey",e),i=webmd.object.get("hash",e),webmd.cookie.set("REG_UUID",i,{expires:36500,domain:webmd.url.getSLD()}),r.cookieSet(t),3===e.code&&(wmdPageLink("reg-success_l-nl"),webmd.debug("service.subscribe: New, light user registration"))):-52===e.code?s.reject(o,"readonly","Newsletter service is in readonly mode"):s.reject(o,"error","Newsletter service returned an error")}).fail(function(){webmd.debug("Service Failed!"),wmdPageLink("reg-error_l-nl")})},cookieSet:function(e){var t=new Date;t.setTime(t.getTime()+23328e6),t=";expires="+t.toUTCString(),_dom=document.domain.split("."),c_domain=webmd.url.getSLD(),document.cookie="WBMD_MB9="+e+"; path=/ ;domain="+c_domain+t},unsubscribe:function(e){var t,i,r=new $.Deferred,s=r.promise();if(void 0===(e=$.extend({timeout:this.timeout},e)).nlids)throw"Missing newsletter id";if(!e.email)throw"Missing email address";$.isArray(e.nlids)||(e.nlids=JSON.parse("["+e.nlids+"]")),t={nlids:e.nlids,email:e.email},clearTimeout(void 0),i=setTimeout(function(){r.reject(s,"timeout","Newsletter service timed out.")},e.timeout),webmd.debug("service.unsubscribe settings: ",e);e=d.generate();return $.ajax(this.urlUnsubscribe,{type:"post",data:JSON.stringify(t),contentType:"application/json",headers:e,success:function(e){clearTimeout(i),r.resolve(e)},error:function(e,t,i){r.reject(e,t,i)}}),s},getPromo:function(e){var t={},s=new $.Deferred,i=s.promise();if((e=$.extend({mobile:!1,timeout:this.timeout},e)).cdsPromo){if(void 0===e.dob)throw"Missing Child date of birth"}else{if(void 0===e.id)throw"Missing newsletter id";$.isArray(e.id)||(e.id=[e.id]),t.nls=e.id.join(",")}e.mobile&&(t.mobile=1),e.dob&&(t.dob=e.dob);e=d.generate();return $.ajax(this.urlGetPromo,{method:"get",data:t,headers:e,success:function(t){function e(e){return webmd.object.get("d.data.nlAppMapping."+e,t)||""}var i=!1,r=e("appIdField");-1==r&&(i=!(r="")),(i={image:e("sourceIdField")+".png",url:e("retURLField"),description:e("valuePropField"),button:webmd.cookie.exists("WBMD_AUTH")&&!1===i?"Get Started":e("driverLanguageField"),appid:r,isMobile:i}).url||(i={}),s.resolve(i)},error:function(e,t,i){s.reject(e,t,i)}}),i},gotoPromo:function(t){t.isMobile?window.location=t.url:require(["registration/1/regOverlay"],function(e){e.show({appid:t.appid,mode:"signup",returl:t.url,formValues:{email:t.email}})},function(){window.location=t.url})},addChild:function(e){var t={},i=this;if(void 0===(e=$.extend({timeout:i.timeout},e)).email&&!webmd.cookie.exists("WBMD_AUTH"))throw"Missing email address";if(!e.dob)throw"Missing birthdate";if(e.firstname&&(t.firstname=e.firstname),e.token&&(t.token=e.token),e.name&&(t.name=e.name),t.email=e.email,t.dob=e.dob,t.gender=e.gender||2,e.vendor&&(t.vendor=e.vendor),e.publisher&&(t.publisher=e.publisher),e.campaign&&(t.campaign=e.campaign),!e.privacy_policy_accept)throw"Privacy Policy must be accepted";return t.privacy_policy_accept=1,n.receiverUrl=webmd.url.addLifecycleAndEnv("https://www.webmd.com/xdm-oo"),n.call({service:"regapi/cds/addchild",data:JSON.stringify(t),headers:d.generate()}).done(function(e){"success"!==e.d.stat||webmd.cookie.exists("WBMD_AUTH")||webmd.cookie.exists("WBMD_SAUTH")||null!=(e=webmd.object.get("subscriberKey",e.d))&&i.cookieSet(e)}).fail(function(){webmd.debug("Service Failed!")})},updateChild:function(e){var r,t,i,s={};if(!(e=$.extend({timeout:this.timeout},e)).id||void 0===e.id)throw"id is required";if(!e.dob)throw"Missing birthdate";e.name&&(s.name=e.name),e.gender&&(s.gender=e.gender),r=new $.Deferred,t=r.promise(),e=$.extend({timeout:this.timeout},e),clearTimeout(void 0),i=setTimeout(function(){r.reject(t,"timeout","Newsletter service timed out.")},e.timeout),s.id=e.id,s.dob=e.dob,e.token&&(s.token=e.token);e=d.generate();return $.ajax(this.urlUpdateChild,{type:"post",data:JSON.stringify(s),contentType:"application/json",headers:e,success:function(e){clearTimeout(i),r.resolve(e)},error:function(e,t,i){r.reject(e,t,i)}}),t},deleteChild:function(e){var r,t,i={};if(!(e=$.extend({timeout:this.timeout},e)).id||void 0===e.id)throw"id is required";e.token&&(i.token=e.token),i.id=e.id,r=new $.Deferred,t=r.promise(),e=$.extend({timeout:this.timeout},e),clearTimeout(void 0);var s=setTimeout(function(){r.reject(t,"timeout","Newsletter service timed out.")},e.timeout),e=d.generate();return $.ajax(this.urlDeleteChild,{type:"post",data:JSON.stringify(i),contentType:"application/json",headers:e,success:function(e){clearTimeout(s),r.resolve(e)},error:function(e,t,i){r.reject(e,t,i)}}),t},getChildren:function(e){var t=this.urlGetChildren;return e&&e.guid&&(t=t+"?token="+e.guid),$.getJSON(t)},getName:function(e){return this.names[e]||""}}});
