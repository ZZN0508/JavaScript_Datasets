var Passport={_nickName:"",_pid:null,getNickName:function(){return this._nickName||(this._nickName=this._getCookie("nickname")),this._nickName},getPid:function(){return this._pid||(this._pid=this._getCookie("pid")),this._pid},_getCookie:function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));if(t){var a;try{a=decodeURIComponent(t[2])}catch(n){a=unescape(t[2]),console.log("error of get cookie -> ",n)}return a}return null},getElById:function(e){return document.getElementById(e)},init:function(){var e=this.getElById("NavLoginUserDiv");if(e&&this.getPid()){var t=this.getElById("NavLoginDiv");t&&(t.style.display="none"),e.style.display="block";var a=this.getElById("NavNickName");a&&(a.innerHTML=this.getNickName()),this.loadUnReadMsgCount()}},loadUnReadMsgCount:function(){var e=this;this.jsonpRequest({url:"http://my.39.net/post.ashx",data:{action:"jsonpmsgcount"},dataType:"jsonp",callback:"callback",success:function(t){t.Data>0?e.addClass(e.getElById("NavUnread"),"unread"):e.removeClass(e.getElById("NavUnread"),"unread")},error:function(){}})},jsonpRequest:function(e){if(e=e||{},!e.url||!e.callback)throw new Error("参数不合法");var t=("jsonp_"+Math.random()).replace(".",""),a=document.getElementsByTagName("head")[0];e.data[e.callback]=t;var n=this.formatParams(e.data),s=document.createElement("script");a.appendChild(s),window[t]=function(n){a.removeChild(s),clearTimeout(s.timer),window[t]=null,e.success&&e.success(n)},s.src=e.url+"?"+n,e.time&&(s.timer=setTimeout(function(){window[t]=null,a.removeChild(s),e.fail&&e.fail({message:"超时"})},time))},formatParams:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(this.hasClass(e,t)){var a=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(a," ")}}};Passport.init();