define("modules/clean/profile_services/auth_callback_handler",["require","exports","tslib","modules/core/browser","modules/core/notify","modules/core/uri","modules/clean/deprecated_ajax/ajax_jquery","modules/core/i18n"],function(e,t,r,f,m,h,i,v){"use strict";function O(e,t,r){e.trigger(t,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.handleCalendarLinkResponse=t.handleLoginResponse=t.handleRegisterResponse=void 0,f=r.__importStar(f),i=r.__importStar(i),t.handleRegisterResponse=function(e,t,r,i,n){var s,o,a,l,c,_,u,d,p,g;e.success&&e.user_id?n?n({display_name:e.profile.name,id:e.user_id,email:e.profile.email}):(p=t.loginCont||"/",f.redirect(p)):e.success?(i&&i(),o={emailSig:e.email_sig,refreshToken:e.refresh_token,profile:e.profile},a=t,l=r,_=(c=o.profile).given_name,u=c.family_name,d=c.email,n=c.picture_url,p=a.registerCont,i=a.signupTag,c=a.k,g={cont:p,eh:a.eh,email:d,email_sig:o.emailSig,fname:_,k:c,lname:u,picture_url:n,refresh_token:o.refreshToken,show_marketing_opt_in:a.showMarketingOptIn,signup_endpoint:a.signupEndpoint,signup_referrer:a.signupReferrer,signup_tag:i,signup_url:a.signupUrl,tracking_params:a.trackingParams},i=Object.keys(g).reduce(function(e,t){var r=g[t];return void 0!==r&&(e[t]=String(r)),e},{}),l&&O(l.form,l.newAccount,i),a.canRedirect?f.redirect(new h.URI({path:"/third_party_signup",query:i}).toString()):a.inlineRedirect&&a.inlineRedirect(g)):(e={errMsg:e.err_msg,rememberMe:e.remember_me,pairUser:e.pair_user,profile:e.profile,emailSig:e.email_sig,refreshToken:e.refresh_token},t=t.loginCont||"/",r=r,"tfa_required"===e.errMsg?(s={cont:t},null!=e.pairUser&&(s.pair_user=e.pairUser.toString()),null!=e.rememberMe&&(s.remember_me=e.rememberMe.toString()),f.redirect(new h.URI({path:"/verify_code",query:s}).toString())):"sso_required"===e.errMsg?(s={email:e.profile.email,cont:t},f.redirect(new h.URI({path:"/login",query:s}).toString())):"user_exists"===e.errMsg?(r&&O(r.form,r.userExists,{focus:"input[name=login_password]",prefill:{".login-email":e.profile.email,"input[type='hidden'][name=refresh_token]":e.refreshToken,"input[type='hidden'][name=email_sig]":e.emailSig}}),m.Notify.error(v.intl.formatMessage({id:"RAxZa6",defaultMessage:"This email address is already taken. Please sign in."}))):"user_already_invited_to_team"===e.errMsg?m.Notify.error(v.intl.formatMessage({id:"uE2zpB",defaultMessage:"Contact your admin to resend your invite."})):"email_not_verified"===e.errMsg?m.Notify.error(v.intl.formatMessage({id:"S6RuBm",defaultMessage:"Before you can sign in, youâ€™ll need to verify your account with Google {email}"},{email:e.profile.email})):m.Notify.error(v.intl.formatMessage({id:"/5Xr9S",defaultMessage:"Unable to link to Google. Please refresh the page to try again."})))},t.handleLoginResponse=function(e,t){var r;e.success?(m.Notify.success(v.intl.formatMessage({id:"pnPTCp",defaultMessage:"Log in successful!"})),i.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success",value:"success"}}),t.onSuccess(),t.redirectOnSuccess&&f.redirect(t.cont)):(i.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error",value:e.err_msg}}),"access_denied"===e.err_msg?m.Notify.error(v.intl.formatMessage({id:"4F3Rmj",defaultMessage:"You need to accept Googleâ€™s request in order to log in."})):"emails_do_not_match"===e.err_msg?m.Notify.error(v.intl.formatMessage({id:"9ZZYrU",defaultMessage:"We couldnâ€™t find a Dropbox account matching that email."})):"google_login_not_allowed"===e.err_msg?m.Notify.error(v.intl.formatMessage({id:"hf0hON",defaultMessage:"Google sign in is disabled. Sign in with your Dropbox password or ask your Dropbox admin for help."})):"sso_required"===e.err_msg?m.Notify.error(v.intl.formatMessage({id:"/izp8x",defaultMessage:"Your team has single sign-on. Sign in with your Dropbox password or ask your Dropbox admin for help."})):"tfa_required"===e.err_msg?(r=new h.URI({path:"/verify_code",query:{cont:t.cont,remember_me:String(e.remember_me),pair_user:String(e.pair_user)}}).toString(),f.redirect(r)):"disabled_account"===e.err_msg?m.Notify.error(v.intl.formatMessage({id:"ZKpC55",defaultMessage:"This account is disabled."})):"invalid_pair_target"===e.err_msg?m.Notify.error(v.intl.formatMessage({id:"b47mh4",defaultMessage:"That account canâ€™t be paired. Paired account must be a personal account."})):"already_paired"===e.err_msg?m.Notify.error(v.intl.formatMessage({id:"vbDuY9",defaultMessage:"That account is already paired to another account."})):"error_pairing"===e.err_msg?m.Notify.error(v.intl.formatMessage({id:"AH4JT6",defaultMessage:"There was an error pairing."})):"not_verified"===e.err_msg?(r=new h.URI({path:"/show_password_form",query:{cont:t.cont,remember_me:String(e.remember_me),pair_user:String(e.pair_user)}}).toString(),f.redirect(r)):"emails_do_not_match_redirect"===e.err_msg?f.redirect(new h.URI({path:"/third_party_signup",query:{email_sig:e.email_sig,email:e.profile.email,fname:e.profile.given_name,lname:e.profile.family_name,refresh_token:e.refresh_token,cont:t.cont}})):m.Notify.error(v.intl.formatMessage({id:"ELzCWG",defaultMessage:"We couldnâ€™t log you in with Google. Try again?"})))},t.handleCalendarLinkResponse=function(e,t){e.success?(m.Notify.success(v.intl.formatMessage({id:"r1Kfvk",defaultMessage:"Successfully connected your Google Calendar"})),t.onSuccess()):m.Notify.error(v.intl.formatMessage({id:"aWO5m4",defaultMessage:"Couldnâ€™t connect your Google Calendar"}))}}),define("modules/clean/profile_services/popup_handler",["require","exports","tslib","lodash"],function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeAuthCompleteListener=t.addAuthCompleteListener=void 0,i=r.__importStar(i);var n={};t.addAuthCompleteListener=function(r){function e(e){var t;try{t=JSON.parse(e.data)}catch(e){return}t&&"db:profile_service:auth_complete"===t.type&&r(t.payload)}var t=i.uniqueId();return window.addEventListener("message",e),n[t]=e,t},t.removeAuthCompleteListener=function(e){var t=n[e];t&&(delete n[e],window.removeEventListener("message",t))}}),define("modules/clean/profile_services/profile_services_constants",["require","exports","modules/core/exception","modules/core/i18n"],function(e,t,i,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceRequestType=t.ServiceResponseType=void 0,(s=t.ServiceResponseType||(t.ServiceResponseType={})).APPLE="APPLE",s.GOOGLE="GOOGLE",(s=t.ServiceRequestType||(t.ServiceRequestType={}))[s.CONTACTS=0]="CONTACTS",s[s.PROFILE=1]="PROFILE",s[s.PHOTO=2]="PHOTO",s[s.EMAIL=3]="EMAIL",s[s.CALENDAR=4]="CALENDAR",s[s.DOCUMENTS=5]="DOCUMENTS",s[s.CHAT=6]="CHAT",s[s.READ_FILES=7]="READ_FILES",s[s.DIRECTORY_MEMBERS=8]="DIRECTORY_MEMBERS",(n=t.ServiceRequestType||(t.ServiceRequestType={})).to_api_v2=function(e){switch(e){case n.CONTACTS:return{".tag":"contacts"};case n.PROFILE:return{".tag":"profile"};case n.PHOTO:return{".tag":"photo"};case n.EMAIL:return{".tag":"email"};case n.CALENDAR:return{".tag":"calendar"};case n.DOCUMENTS:return{".tag":"documents"};case n.CHAT:return{".tag":"chat"};case n.READ_FILES:return{".tag":"read_files"};case n.DIRECTORY_MEMBERS:return{".tag":"directory_members"};default:return i.assert(!1,"Should never get ServiceRequestType.to_api_v2 with request type: "+n[e])}};var s={GOOGLE:"1",YAHOO:"2",FACEBOOK:"3",TWITTER:"4",YAHOO_LEGACY:"5",MOBILE:"6",OUTLOOK:"7",SLACK:"8",DOCUSIGN:"9",ZOOM:"10",SLACK_DROPBOX:"11",TRELLO:"12",APPLE:"13",HELLOSIGN:"14",CANVAS:"15",ZOOM_APP:"16",NEVER_CONNECTED:0,WAS_CONNECTED:1,IS_CONNECTED:2,VARIOUS:"-1",NONE:"-2",services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK,this.TWITTER,this.YAHOO_LEGACY,this.OUTLOOK,this.SLACK,this.DOCUSIGN,this.ZOOM,this.SLACK_DROPBOX,this.TRELLO,this.APPLE,this.HELLOSIGN,this.ZOOM_APP]},service_data:{apple:{action:null,permissions:"",landing_page_id:null,learn_more_page:null,img:"/static/images/index/apple-logo-color.svg",friendly_name:"Apple",order:1},google:{action:"link_contacts",permissions:r.intl.formatMessage({id:"sN1hXL",defaultMessage:"Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/images/index/google-logo-color-vflpJqkMT.svg",friendly_name:"Google",order:3},outlook:{action:"link_contacts",permissions:r.intl.formatMessage({id:"Tgwos1",defaultMessage:"Calendar and Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/images/thirdparty/outlook_icon-vflzzt-G0.svg",friendly_name:"Outlook",order:4},slack:{action:"link_contacts",permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:null,learn_more_page:null,img:"/static/images/thirdparty/slack_icon_transparent-vfljNpDIm.svg",friendly_name:"Slack",order:Number.MAX_VALUE},slack_dropbox:{action:"link_read_files",permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:"dropbox_slack",learn_more_page:"https://www.dropbox.com/help/desktop-web/slack",img:"/static/images/thirdparty/slack_icon_transparent-vfljNpDIm.svg",friendly_name:"Slack",order:5},zoom:{action:"link_contacts",permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:"zoom",learn_more_page:"https://www.dropbox.com/help/desktop-web/zoom",img:"/static/images/thirdparty/zoom_icon_squircle-vfl-znF5M.svg",friendly_name:"Zoom",order:8},zoom_app:{action:null,permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:"zoom_app",learn_more_page:null,img:"/static/images/thirdparty/zoom_icon_squircle-vfl-znF5M.svg",friendly_name:"Dropbox Spaces Zoom App",order:8},trello:{action:"link_contacts",permissions:r.intl.formatMessage({id:"iiiHMO",defaultMessage:"Project management"}),landing_page_id:"trello",learn_more_page:"https://www.dropbox.com/landing/trello",img:"/static/images/thirdparty/trello_icon-vfl-FetdA.svg",friendly_name:"Trello",order:6},yahoo:{action:null,permissions:r.intl.formatMessage({id:"sN1hXL",defaultMessage:"Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/images/thirdparty/yahoo_icon-vflqXkWjv.svg",friendly_name:"Yahoo! Mail",order:7},yahoo_legacy:{action:null,permissions:r.intl.formatMessage({id:"sN1hXL",defaultMessage:"Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/images/thirdparty/yahoo_icon-vflqXkWjv.svg",friendly_name:"Yahoo! Mail",order:Number.MAX_VALUE},facebook:{action:null,permissions:r.intl.formatMessage({id:"sN1hXL",defaultMessage:"Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/images/thirdparty/facebook_icon-vflbyEm0k.svg",friendly_name:"Facebook",order:2},hellosign:{action:null,permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:null,learn_more_page:null,img:"/static/images/thirdparty/hellosign_icon-vflSwegks.svg",friendly_name:"HelloSign",order:9},canvas:{action:"link_contacts",permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:null,learn_more_page:"https://help.dropbox.com/installs-integrations/third-party/canvas",img:"/static/images/thirdparty/canvas_icon.svg",friendly_name:"Canvas",order:10}},gated_service_data:{profile_card_v2:{google:{action:"link_calendar",permissions:r.intl.formatMessage({id:"Tgwos1",defaultMessage:"Calendar and Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/images/index/google-logo-color-vflpJqkMT.svg",friendly_name:"Google",order:1}}},get_gated_service_data:function(e,t){e=e[".tag"];if(t&&t in this.gated_service_data){t=this.gated_service_data[t];if(e in t)return t[e]}},get_service_data:function(e,t){var r=e[".tag"];if(t=void 0===t?null:t){t=this.get_gated_service_data(e,t);if(t)return t}return r in this.service_data?this.service_data[r]:i.assert(!1,"Should never get ProfileServicesConstants.get_service_data with service: "+r)},importable_contact_services:function(){return[this.GOOGLE]},to_img_legacy:function(e){switch(e){case this.GOOGLE:return["/static/images/contacts/import_icon_gmail-vflFQwVYO.png","/static/images/contacts/import_icon_gmail@2x-vflO2fTFE.png"];case this.YAHOO:case this.YAHOO_LEGACY:return["/static/images/contacts/import_icon_yahoo-vfl5E728M.png","/static/images/contacts/import_icon_yahoo@2x-vflnVdi5R.png"];case this.FACEBOOK:return["/static/images/contacts/import_icon_facebook-vfluFbt1j.png","/static/images/contacts/import_icon_facebook@2x-vfl7Zk5rR.png"];case this.OUTLOOK:return["/static/images/contacts/import_icon_outlook-vflF1_UKs.png","/static/images/contacts/import_icon_outlook@2x-vflVjRgD3.png"];case this.SLACK:case this.SLACK_DROPBOX:return["/static/images/thirdparty/slack_icon-vflKvKltK.svg","/static/images/thirdparty/slack_icon-vflKvKltK.svg"];case this.ZOOM:case this.ZOOM_APP:return["/static/images/thirdparty/zoom_icon-vflft17yG.svg","/static/images/thirdparty/zoom_icon-vflft17yG.svg"];case this.TRELLO:return["/static/images/thirdparty/trello_icon-vfl-FetdA.svg","/static/images/thirdparty/trello_icon-vfl-FetdA.svg"];case this.HELLOSIGN:return["/static/images/thirdparty/hellosign_icon-vflSwegks.svg","/static/images/thirdparty/hellosign_icon-vflSwegks.svg"];case this.CANVAS:return["/static/images/thirdparty/canvas_icon.svg","/static/images/thirdparty/canvas_icon.svg"];default:return i.assert(!1,"Should never get ProfileServicesConstants.to_img_legacy with service: "+e)}},to_name:function(e){if(e===this.VARIOUS)return r.intl.formatMessage({id:"hK3Vsp",defaultMessage:"Email"});e=this.to_api_service_type(e);return this.get_service_data(e).friendly_name},logging_identifiers:function(e){switch(e){case this.GOOGLE:return"google";case this.YAHOO:return"yahoo";case this.FACEBOOK:return"facebook";case this.VARIOUS:return"email";case this.YAHOO_LEGACY:return"yahoo_legacy";case this.OUTLOOK:return r.intl.formatMessage({id:"DVWR1j",defaultMessage:"outlook"});case this.SLACK:return r.intl.formatMessage({id:"D/5sPh",defaultMessage:"slack"});case this.DOCUSIGN:return"docusign";case this.ZOOM:return"zoom";case this.ZOOM_APP:return"zoom_app";case this.SLACK_DROPBOX:return"slack_dropbox";case this.TRELLO:return"trello";case this.APPLE:return"apple";case this.HELLOSIGN:return"hellosign";case this.CANVAS:return"canvas";default:return i.assert(!1,"Should never get ProfileServicesConstants.logging_identifiers with service: "+e)}},to_api_service_type:function(e){switch(e){case this.GOOGLE:return{".tag":"google"};case this.YAHOO:return{".tag":"yahoo"};case this.FACEBOOK:return{".tag":"facebook"};case this.OUTLOOK:return{".tag":"outlook"};case this.SLACK:return{".tag":"slack"};case this.ZOOM:return{".tag":"zoom"};case this.ZOOM_APP:return{".tag":"zoom_app"};case this.SLACK_DROPBOX:return{".tag":"slack_dropbox"};case this.TRELLO:return{".tag":"trello"};case this.APPLE:return{".tag":"apple"};case this.HELLOSIGN:return{".tag":"hellosign"};case this.CANVAS:return{".tag":"canvas"};default:return i.assert(!1,"Should never get ProfileServicesConstants.to_api_service_type with service: "+e),{".tag":"other"}}},from_api_service_type:function(e){switch(e[".tag"]){case"google":return this.GOOGLE;case"yahoo":return this.YAHOO;case"facebook":return this.FACEBOOK;case"outlook":return this.OUTLOOK;case"slack":return this.SLACK;case"zoom":return this.ZOOM;case"zoom_app":return this.ZOOM_APP;case"slack_dropbox":return this.SLACK_DROPBOX;case"trello":return this.TRELLO;case"apple":return this.APPLE;case"hellosign":return this.HELLOSIGN;case"canvas":return this.CANVAS}return i.assert(!1,"Should never get ProfileServicesConstants.from_api_service_type with service: "+e),this.VARIOUS},from_api_to_name:function(e){return this.to_name(this.from_api_service_type(e))},from_api_to_img:function(e){return this.get_service_data(e).img},oauth_window_dimensions:function(e){var t=600,r=600;return e===this.ZOOM?t=770:e===this.APPLE?t=700:e===this.CANVAS&&(t=700,r=500),{width:t,height:r}}};t.default=s}),define("modules/clean/profile_services/profile_services_link",["require","exports","tslib","jquery","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/uri","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/analytics","modules/clean/profile_services/popup_handler","modules/clean/profile_services/profile_services_constants","modules/clean/viewer","modules/constants/login_and_register","modules/clean/react/snackbar","modules/core/browser"],function(e,t,r,s,a,_,i,l,o,n,c,u,d,m,p,g){"use strict";var h;Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileServicesLinkingHandler=t.LinkedProfileServices=t.is_profile_services_action=t.AuthWindowOption=void 0,s=r.__importDefault(s),a=r.__importStar(a),o=r.__importStar(o),u=r.__importDefault(u),m=r.__importStar(m),(r=h=t.AuthWindowOption||(t.AuthWindowOption={})).HIDDEN_IFRAME="hidden_iframe",r.POP_UP="pop_up",r.REDIRECT="redirect",t.is_profile_services_action=function(e){return"link_directory_members"===e||"link_calendar"===e||"link_contacts"===e||"link_target_user"===e||"link_read_files"===e||"link_history"===e||"login_user"===e||"create_user"===e};var f=(v.get_linked_profile_services_for_user=function(e,t){void 0===t&&(t=null),_.assert(null!==e,"No user_id: LinkedProfileServices.get_linked_profile_services_for_user()");var r=this._LINKED_PROFILE_SERVICES[e];return void 0!==r?r.get_or_update_connected_state(!1,t):(r=new v(e,t),this._LINKED_PROFILE_SERVICES[e]=r),r},v.prototype.get_or_update_connected_state=function(e,i){var n=this;void 0===e&&(e=!1),void 0===i&&(i=null),this.is_updated&&!e?null!==i&&i(this):o.BackgroundRequest({url:"/profile_services/connected_services",subject_user:this.user_id,dataType:"json",success:function(e,t,r){n.connectedServices=e,n.is_updated=!0,null!==i&&i(n)}})},v.prototype.connected_accounts_for_service=function(e){return this.connectedServices[e]?s.default.map(this.connectedServices[e],function(e){return e.source_id}):[]},v.prototype.has_connected_services=function(){for(var e=0,t=u.default.services();e<t.length;e++){var r=t[e];if(this.service_is_connected(r))return!0}return!1},v.prototype.has_unconnected_services=function(e){for(var t=0,r=(e=void 0===e?!1:e)?u.default.importable_contact_services():u.default.services();t<r.length;t++){var i=r[t];if(i!==u.default.YAHOO_LEGACY&&!this.service_is_connected(i))return!0}return!1},v.prototype.service_is_connected=function(e){if(_.assert(-1!==u.default.services().indexOf(e),"Not a valid profile service"),null==this.connectedServices[e])return!1;for(var t=0,r=this.connectedServices[e];t<r.length;t++)if(r[t].connection_state===u.default.IS_CONNECTED)return!0;return!1},v.prototype.service_was_connected=function(e){if(_.assert(-1!==u.default.services().indexOf(e),"Not a valid profile service"),null==this.connectedServices[e])return!1;for(var t=0,r=this.connectedServices[e];t<r.length;t++)if(r[t].connection_state===u.default.WAS_CONNECTED)return!0;return!1},v.prototype.register_for_service_changes=function(e,t){return this.serviceChangeCallbacks[e]=t},v._LINKED_PROFILE_SERVICES={},v);function v(e,t){var r=this;void 0===t&&(t=null),this._update_on_auth_event=function(e){if(e.user_id===r.user_id)for(var t in r.is_updated=!1,r.get_or_update_connected_state(!0),r.serviceChangeCallbacks)r.serviceChangeCallbacks.hasOwnProperty(t)&&r.serviceChangeCallbacks[t](r)},_.assert(null!==e,"No user id provided"),this.user_id=e,this.connectedServices={},this.is_updated=!1,this.get_or_update_connected_state(!0,t),this.serviceChangeCallbacks={},c.addAuthCompleteListener(this._update_on_auth_event),s.default(document).on("db:profile_service:deauth_complete",this._update_on_auth_event)}t.LinkedProfileServices=f;O.show_import_notifications=function(e){e.success?(n.TeamsWebActionsLogger.log("import_contacts_complete",{provider:u.default.logging_identifiers(e.provider),path:a.get_uri().getPath()}),p.Snackbar.complete(i.intl.formatMessage({id:"JxBPfw",defaultMessage:"Successfully connected {service_name}"},{service_name:u.default.to_name(e.provider)}),"profile-services-link")):null!==e.err_msg?p.Snackbar.fail(e.err_msg,"profile-services-link"):p.Snackbar.fail(i.intl.formatMessage({id:"J+0ZxM",defaultMessage:"Could not complete connection, try again later"}),"profile-services-link")},O.prototype._close_popup_window=function(){null!=this._popup_window&&(this._popup_window.close(),this._popup_window=null)},O.prototype._wait_for_auth_complete=function(o){var a=this;return new Promise(function(t,e){var r=null;a._close_popup_window();var i=null,n=c.addAuthCompleteListener(function(e){if(!(i=e).settings_config_pending)return c.removeAuthCompleteListener(n),null!=r&&clearInterval(r),a._close_popup_window(),t(e)}),s=o();if(null==s)return e("window_not_created");a._popup_window=s,r=setInterval(function(){if(!0===s.closed)return i?t(i):(e("window_closed"),c.removeAuthCompleteListener(n),void clearInterval(r))},1e3)})},O.prototype._window_open_features=function(e){var e=u.default.oauth_window_dimensions(e),t={width:e.width,height:e.height,resizable:1,scrollbars:1};return Object.keys(t).map(function(e){return e+"="+t[e]}).join(",")},O.prototype._post_redirect_to_url=function(r,e,t,i,n){var s=this;void 0===n&&(n=!1);var i=i?"/profile_services/redirect_to_identity_provider":r===u.default.CANVAS?"/canvas/select_domain":"/profile_services/start_auth_flow",o=new l.URI({path:i,query:e}).toString();return n?Promise.resolve({success:!0,provider:"",user_id:null,profile:{service_id:"",name:"",given_name:"",family_name:"",email:"",picture_url:"",additional_emails:[],verified_email:!1,organization:""},email_sig:"",refresh_token:"",err_msg:null,localized_error:null,login_info:"",verified_profile_email:!1,should_update_account_photo:!1,remember_me:!1,pair_user:!1,display_name:"",granted_request_types:[],missing_request_types:[],external_service_id:"",dbx_auth:o}):t===h.HIDDEN_IFRAME?this._wait_for_auth_complete(function(){var e=document.createElement("iframe");return e.src=o,e.style.display="none",e.style.width="0",e.style.height="0",document.body.appendChild(e),e.contentWindow}):t===h.POP_UP?this._wait_for_auth_complete(function(){var e=u.default.to_name(r),t=s._window_open_features(r);return window.open(o,e,t)}):(a.redirect(o),Promise.reject("redirected"))},O.prototype._redirect_to_identity_provider=function(e,t,r,i,n,s,o,a,l,c){void 0===i&&(i=null),void 0===n&&(n=h.POP_UP),void 0===s&&(s=null),void 0===c&&(c=!1),_.assert(null!==e,"No service provided to auth_service_with_user");l={service:e,is_popup:(n===h.POP_UP).toString(),action:t,prompt_select:"true",token:m.REDIRECT_WINDOW_TOKEN,extra_state_parameters:o,extra_permissions:void 0!==a?JSON.stringify(a):void 0,login_hint:l};null!==r&&(l.user_id=r.toString()),l.referrer=i,null==s?l.is_desktop="false":"desktop"===s.kind?(l.is_desktop="true",l.host_nonce=s.host_nonce,l.login_hint=s.login_hint):(l.is_desktop="false",l.remember_me=s.remember_me.toString(),l.cont=s.cont,l.pair_user=s.pair_user.toString());l=S(l);return this._post_redirect_to_url(e,l,n,!1,c)},O.prototype.auth_service_with_user_with_landing_page=function(e,t){void 0===t&&(t=void 0);var r=u.default.get_service_data(e).landing_page_id;return null!=r?this._wait_for_auth_complete(function(){return g.open_tab("/landing/"+r+"?return_to_opener=true",!0)}):null!=t?t():Promise.reject("no_landing_page")},O.prototype.auth_service_with_user=function(e,t,r,i,n,s,o,a,l){void 0===r&&(r=null),this.auth_service_with_user_promise(e,t,i=void 0===i?null:i,n=void 0===n?"link_contacts":n,s,o,a,l).then(r)},O.prototype.auth_service_with_user_promise=function(e,t,r,i,n,s,o,a,l){return void 0===r&&(r=null),void 0===i&&(i="link_contacts"),void 0===l&&(l=!1),y(t),this._redirect_to_identity_provider(e,i,t,r,void 0!==n?n:h.POP_UP,null,s,o,a,l)},O.prototype.auth_service_with_specified_user=function(e,t,r,i){this.auth_service_with_user_promise(e,t,i,"link_target_user").then(r)},O.prototype.auth_service_create_user_if_needed=function(e,t,r,i,n){void 0===t&&(t=null),void 0===i&&(i=h.POP_UP),this._redirect_to_identity_provider(e,"create_user",null,r=void 0===r?null:r,i,n=void 0===n?null:n).then(t)},O.prototype.auth_service_login_desktop=function(e,t,r,i){this._redirect_to_identity_provider(e,"login_user",null,null,h.POP_UP,{kind:"desktop",host_nonce:r,login_hint:i=void 0===i?null:i}).then(t)},O.prototype.auth_service_login_web=function(e,t,r,i,n,s,o){this._redirect_to_identity_provider(e,"login_user",null,r,i,{kind:"web",remember_me:n,cont:s,pair_user:o}).then(t)},O.prototype.auth_service_link_calendar=function(e,t,r,i){return y(t),this._redirect_to_identity_provider(e,"link_calendar",t,i,h.POP_UP).then(r)},O.prototype.continue_auth_flow=function(e){var t=e.user_id,r=e.service,i=e.action,n=e.referrer,s=e.cont,o=e.is_popup,a=e.pair_user,l=e.is_desktop,c=e.is_android,_=e.remember_me,u=e.host_nonce,d=e.login_hint,p=e.prompt_select,g=e.pkce_challenge,f=e.extra_state_parameters,e={service:r,action:"link_contacts",prompt_select:"true",token:m.REDIRECT_WINDOW_TOKEN};e.action=i,null!=t&&(e.user_id=t.toString()),e.cont=s,e.referrer=n,null!=o&&(e.is_popup=o.toString()),null!=a&&(e.pair_user=a.toString()),null!=l&&(e.is_desktop=l.toString()),null!=c&&(e.is_android=c.toString()),null!=_&&(e.remember_me=_.toString()),e.host_nonce=u,e.login_hint=d,null!=p&&(e.prompt_select=p.toString()),null!=g&&(e.pkce_challenge=g),e.extra_state_parameters=f;e=S(e);return this._post_redirect_to_url(r,e,h.REDIRECT,!0)},O.prototype.deauth_service=function(t,e,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var n=parseInt(e,10);_.assert(-1!==u.default.services().indexOf(t),"Not a valid profile service"),_.assert(null!==n,"No user_id provided"),f.get_linked_profile_services_for_user(n,function(e){e.service_is_connected(t)||null===i?(null!==r&&_.assert(-1!==e.connected_accounts_for_service(t).indexOf(r),"Service is not currently connected"),o.WebRequest({url:"/profile_services/unlink",subject_user:n,data:{service:t,source_id:r},success:function(e,t,r){return s.default(document).trigger(s.default.Event("db:profile_service:deauth_complete",{user_id:n})),"function"==typeof i?i(!0):void 0},error:function(e,t,r){return"function"==typeof i?i(!1):void 0}})):i(!0)})},r=O;function O(){this._popup_window=null}function y(e){_.assert(null!==e,"No user_id provided to auth_service_with_user");var t=d.Viewer.get_viewer().get_user_by_id(e);_.assert(null!==t,"No user for user_id "+e)}function S(r){var i={};return Object.keys(r).forEach(function(e){var t=r[e];null!=t&&(i[e]=t)}),i}t.ProfileServicesLinkingHandler=r}),define("modules/clean/react/paging_list",["require","exports","tslib","classnames","react","react-dom","react-dom-factories","lodash"],function(e,t,r,i,n,s,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importDefault(i),n=r.__importDefault(n),s=r.__importStar(s),o=r.__importDefault(o),a=r.__importStar(a);var l,r=(l=n.default.Component,r.__extends(c,l),c.prototype.componentWillReceiveProps=function(e){var t=this._constrainFrom(this.state.from,e.children.length),e=this._constrainSize(this.state.size,e.children,t);return this.setState({from:t,size:e})},c.prototype.componentDidMount=function(){return window.addEventListener("resize",this.updateFrame),s.findDOMNode(this).addEventListener("scroll",this.updateFrame),this.updateFrame()},c.prototype.shouldComponentUpdate=function(e,t){return!a.isEqual(e,this.props)||!a.isEqual(t,this.state)},c.prototype.componentDidUpdate=function(){return this.updateFrame()},c.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateFrame),s.findDOMNode(this).removeEventListener("scroll",this.updateFrame)},c.prototype.render=function(){var e=this.props.listHeight,t=this._getSpaceBefore(this.props.children.length),e={position:"relative",height:e?Math.min(e,t):t},t=this._getSpaceBefore(this.state.from),t=this.props.useTranslate3d?"translate3d(0px, "+t+"px, 0)":"translate(0px, "+t+"px)",t={MsTransform:t,WebkitTransform:t,transform:t};return o.default.div({className:i.default("paging-list",this.props.customClass),ref:"container"},o.default.div({style:e,ref:"scroller"},o.default.ul({style:t},this._renderItems())))},c.displayName="PagingList",c.defaultProps={threshold:100,useTranslate3d:!1},c);function c(){var n=null!==l&&l.apply(this,arguments)||this;return n._getScroll=function(){var e=s.findDOMNode(n.refs.scroller).getBoundingClientRect().top;return s.findDOMNode(n.refs.container).getBoundingClientRect().top-e},n._setScroll=function(e){return s.findDOMNode(n.refs.container).scrollTop+=e-n._getScroll()},n._getViewportSize=function(){return s.findDOMNode(n.refs.container).clientHeight},n._getStartAndEnd=function(){var e=Math.max(0,n._getScroll()-n.props.threshold);return{start:e,end:e+n._getViewportSize()+2*n.props.threshold}},n.updateFrame=function(){var e=n._getStartAndEnd(),t=e.start,r=e.end,i=n.props.itemSize,e=n._constrainFrom(Math.floor(t/i),n.props.children.length),i=n._constrainSize(Math.ceil((r-t)/i)+1,n.props.children,e);return n.setState({from:e,size:i})},n._getSpaceBefore=function(e){return e*n.props.itemSize},n._constrainFrom=function(e,t){return e?Math.max(Math.min(e,t-1),0):0},n._constrainSize=function(e,t,r){var i=t.length,t=n.props.pageSize;return Math.min(Math.max(e,t),i-r)},n.scrollTo=function(e){return n._setScroll(n._getSpaceBefore(e))},n.scrollAround=function(e){var t=n._getScroll(),e=n._getSpaceBefore(e);if(e<t)return n._setScroll(e);e=e-n._getViewportSize()+n.props.itemSize;return t<e?n._setScroll(e):void 0},n._renderItems=function(){var e=n.state.from+n.state.size-1;return n.props.children.slice(n.state.from,+e+1||void 0)},n.state={from:0,size:n._constrainSize(n.props.pageSize,n.props.children,0)},n}t.default=r});
