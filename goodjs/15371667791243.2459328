!function(i,e,d){"use strict";function t(e,t){function i(e){e.naturalWidth<=1&&e.naturalHeight<=1&&(h(e).attr("src",o),h(e).attr("srcset",""))}var o="https://r.r10s.jp/com/js/d/common/images/no-image.png?_ex="+t;h("#ashiatoRecoExistItemDisplay img").each(function(){-1===n.indexOf(this)&&(n.push(this),this.complete?i(this):h(this).one("load",function(){i(this)}).one("error",function(){h(this).attr("src",o),h(this).attr("srcset","")}))})}function s(){t(0,"122x122"),t(0,"130x130")}var h,n;e!==d&&(e.noConflict(),(h=e).RJS_Helpers&&h().RJS_Slideshow&&(n=[],(new function(){var g=this;h.extend(g,{settings:{common:{noready:[0,"Int","^[0-1]$"],pagespeed:[100,"Range","0,9999"],opacityspeed:[100,"Range","0,9999"],autoslidetime:[2,"Range","1,99"],autoslideflag:["next","Str","^(next|prev)$"],autoslide:[0,"Int","^[0-1]$"],autoresize:[1,"Int","^[0-1]$"],impvar:["","Str","^[a-zA-Z0-9_]{3,64}$"],impdisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],impnodisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],verticalmode:[0,"Int","^[1]$"],ajaxtimer:[3,"Range","1,99"],recothreshold:[5,"Int","^[1-9]$"],rankingshuffle:[1,"Int","^[0-1]$"],requestwait:[500,"Range","1,9999"],checkinterval:[100,"Range","1,9999"],genrefilter:["551169","Str","^[0-9,]{1,69}$"],showonnodata:[0,"Int"]},ashiato:{imagesize:["80x80","Str","^[1-9][0-9]{1,2}[x:][1-9][0-9]{1,2}"],omitname:[26,"Range","0,100"],maxitem:[1,"Int","^[1-9]$"],url:["","Str","^(https?:)?//(?:[a-zA-Z0-9_\\-]+\\.)+rakuten\\.co\\.jp\\/[a-zA-Z0-9_&=\\?\\-\\.%:\\/]+$"],sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"]},reco:{imagesize:["80x80","Str","^[1-9][0-9]{1,2}[x:][1-9][0-9]{1,2}"],omitname:[26,"Range","0,100"],maxitem:[3,"Int","^[1-9]$"],url:["","Str","^(https?:)?//(?:[a-zA-Z0-9_\\-]+\\.)+rakuten\\.co\\.jp\\/[a-zA-Z0-9_&=\\?\\-\\.%:\\/]+$"],sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"],placement:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"]},ranking:{url:["","Str","^(https?:)?//(?:[a-zA-Z0-9_\\-]+\\.)+rakuten\\.co\\.jp\\/[a-zA-Z0-9_&=\\?\\-\\.%:\\/]+$"],genrelayer:[2,"Int","^[1-9]$"],sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"]}},eobj:{common:{config:h("#ashiatoRecoCommonConfig"),existItem:h("#ashiatoRecoExistItemDisplay"),altContents:h("#ashiatoRecoAlteredContents"),recoSlider:h("#ashiatoRecoRecoSlider"),loading:h("#ashiatoRecoLoading")},ashiato:{config:h("#ashiatoRecoAshiatoConfig"),prevButton:h("#ashiatoRecoCheckPrevButton"),nextButton:h("#ashiatoRecoCheckNextButton"),proto:h("#prototypeAshiatoRecoAshiatoItem"),itemsDisplay:h("#ashiatoRecoAshiatoItemDisplay")},reco:{config:h("#ashiatoRecoRecoConfig"),prevButton:h("#ashiatoRecoPrevButton"),nextButton:h("#ashiatoRecoNextButton"),proto:h("#prototypeAshiatoRecoRecoItem"),itemsDisplay:h("#ashiatoRecoRecoItemsDisplay"),altContents:h("#ashiatoRecoRecoAlteredContents")},ranking:{config:h("#ashiatoRecoRankingConfig")}},status:{error:!1,isTimeout:!1},props:{ashiato:{items:[],proto:{html:"",height:0,width:0,identifiers:{itemurl:["",/\#ITEMURL\#/g,""],imageele:['<img src="#ITEMIMGURL#" alt="#ITEMIMGALT#" title="#ITEMIMGTITLE#">',/\#ITEMIMGELE\#/g,""],imageurl:["",/\#ITEMIMGURL\#/g,""],imagealt:["",/\#ITEMIMGALT\#/g,""],imagetitle:["",/\#ITEMIMGTITLE\#/g,""],itemname:["",/\#ITEMNAME\#/g,""],itemprice:["",/\#ITEMPRICE\#/g,""]}}},reco:{items:[],visitedPages:[],proto:{html:"",height:0,width:0,identifiers:{itemurl:["",/\#ITEMURL\#/g,""],imageele:['<img src="#ITEMIMGURL#" alt="#ITEMIMGALT#" title="#ITEMIMGTITLE#">',/\#ITEMIMGELE\#/g,""],imageurl:["",/\#ITEMIMGURL\#/g,""],imagealt:["",/\#ITEMIMGALT\#/g,""],imagetitle:["",/\#ITEMIMGTITLE\#/g,""],itemname:["",/\#ITEMNAME\#/g,""],itemprice:["",/\#ITEMPRICE\#/g,""]}}},currentAshiatoIndex:!1,requestPermission:!0,requestPermissionTimer:null,checkWaitInterval:null,initialized:!1},initialize:function(){g.loadSettings()?1==g.settings.noReady?g.begin():h(document).ready(function(){g.begin()}):g.displayDefaultContents()},loadSettings:function(){return g.eobj.ashiato.proto.hide(),g.eobj.reco.proto.hide(),g.settings.common=h.RJS_Helpers.readAttr(g.eobj.common.config,g.settings.common),g.settings.ashiato=h.RJS_Helpers.readAttr(g.eobj.ashiato.config,g.settings.ashiato),g.settings.reco=h.RJS_Helpers.readAttr(g.eobj.reco.config,g.settings.reco),g.settings.ranking=h.RJS_Helpers.readAttr(g.eobj.ranking.config,g.settings.ranking),h.extend(g.settings.ashiato,g.settings.common,g.settings.ashiato),h.extend(g.settings.reco,g.settings.common,g.settings.reco),g.settings.ashiato.autoslide=0,g.settings.ashiato.maxitem=1,g.settings.reco.autoslide=0,!(""==g.settings.ashiato.url||512<g.settings.ashiato.url.length||""==g.settings.reco.url||512<g.settings.reco.url.length||""==g.settings.ranking.url||512<g.settings.ranking.url.length||0===g.eobj.ashiato.proto.length||0===g.eobj.reco.proto.length||(g.settings.common.autoslidetime*=1e3,g.settings.common.ajaxtimer*=1e3,g.eobj.common.config.remove(),g.eobj.ashiato.config.remove(),g.eobj.reco.config.remove(),0))},displayDefaultContents:function(e){g.eobj.ashiato.proto.remove(),g.eobj.reco.proto.remove(),g.eobj.common.altContents.show(),g.eobj.common.existItem.remove(),e&&g.regImpressionCode(e)},displayRecoDefaultContents:function(){g.eobj.common.loading.hide(),g.eobj.common.recoSlider.hide(),g.eobj.reco.altContents.show()},displayRecoLoading:function(){g.eobj.reco.altContents.hide(),g.eobj.common.altContents.hide(),g.eobj.common.recoSlider.hide(),g.eobj.common.existItem.show(),g.eobj.common.loading.show()},begin:function(){g.getAshiatoData()},getAshiatoData:function(){var i;g.status.isTimeout=!1;try{i=setTimeout(function(){g.status.isTimeout=!0,g.displayDefaultContents()},g.settings.common.ajaxtimer),h.ajax({url:g.settings.ashiato.url,cache:!1,dataType:"jsonp",scriptCharset:"euc-jp",timeout:g.settings.common.ajaxtimer,success:function(e){!function(e){if(g.status.isTimeout)return g.displayDefaultContents();if(clearTimeout(i),e.code===d||e.num===d)return g.displayDefaultContents();if("0"!=e.code)return"1"!=e.code&&"8"!=e.code||g.regImpressionCode(g.settings.common.impnodisp),g.displayDefaultContents();if(e.items.length<1)return g.displayDefaultContents(g.settings.common.impnodisp);for(var t=0;t<e.items.length;t++)/^https?:\/\/item.rakuten.co.jp/.test(e.items[t].itemurlfull)&&g.props.ashiato.items.push({itemname:g.editItemname(e.items[t].itemname,g.settings.ashiato.omitname),itemprice:g.editItemprice(e.items[t].itemprice),itemurl:g.editItemurl(e.items[t].itemurlfull,g.settings.ashiato.sid),imageele:"",imageurl:""!=e.items[t].imageurl?g.editImageurl(e.items[t].imageurl,g.settings.ashiato.imagesize):e.items[t].imageurl64,imagealt:g.editItemname(e.items[t].itemname,g.settings.ashiato.omitname),imagetitle:g.editItemname(e.items[t].itemname,g.settings.ashiato.omitname),mngnumber:e.items[t].mngnumber,shopurl:e.items[t].shopurl,itemid:e.items[t].itemid,shopid:e.items[t].shopid,genreidlist:e.items[t].genreidlist});0===g.eobj.ashiato.proto.length?g.displayDefaultContents():(g.props.ashiato.proto.width=g.eobj.ashiato.proto.outerWidth(),g.props.ashiato.proto.height=g.eobj.ashiato.proto.outerHeight(),g.props.ashiato.proto.html=g.eobj.ashiato.proto.html(),""==g.props.ashiato.proto.html?g.displayDefaultContents():(g.eobj.ashiato.proto.remove(),g.eobj.ashiato.itemsDisplay.RJS_Slideshow(g,{settings:g.settings.ashiato,itemPrototype:g.props.ashiato.proto,eobj:g.eobj.ashiato,items:g.props.ashiato.items,events:{beforeFirstRender:function(e,t){t.eobj.ashiato.itemsDisplay.show()},afterSlide:function(e,t){t.props.reco.visitedPages=[],t.getCachedRecoData(e)||t.getRecoData(e)}}}),g.getRecoData(0),s()))}(e)},error:function(e,t,i){g.displayDefaultContents()}})}catch(e){return g.displayDefaultContents(),!1}return!0},getCachedRecoData:function(e){if(!1===e||0==g.props.reco.items.length)return!1;var t=g.props.reco.items[e];return t!=d&&0!=t.length&&(g.displayRecoLoading(),g.displayRecoData(e),!0)},getRecoData:function(o){if(g.displayRecoLoading(),!g.props.requestPermission)return clearInterval(g.props.checkWaitInterval),void(g.props.checkWaitInterval=setInterval(function(){g.props.requestPermission&&(clearInterval(g.props.checkWaitInterval),g.getRecoData(o))},g.settings.common.checkinterval));g.status.isTimeout=!1;try{var e,t,u=setTimeout(function(){g.status.isTimeout=!0,g.getRankingData(o)},g.settings.common.ajaxtimer),i=g.props.ashiato.items[o],s=g.settings.reco.url,n=i.shopid+"_"+i.itemid;g.settings.reco.placement?((t=new URL(s+g.settings.reco.placement)).searchParams.append("id",n),s=t.toString()):e={item_id:n},h.ajax({url:s,cache:!1,dataType:"jsonp",data:e,scriptCharset:"euc-jp",timeout:g.settings.common.ajaxtimer,success:function(e){!function(e,t){var i,o,s,n,a=[],r={},m=[],c=g.props.ashiato.items[t];if(!g.status.isTimeout&&(clearTimeout(u),e.status!==d)){var p,l=g.settings.reco.placement?(p=e.reco_count,e.reco):(p=e.item_count,e.item);if(p!==d&&("Success"==e.status||"NotFound"==e.status)){for(s=0,o=l.length;s<o;s++)i=l[s],n=g.editItemurl(i.item_url,g.settings.reco.sid),e.tracking_tag&&(n=h.RJS_Helpers.urlParameter(n,{rtg:e.tracking_tag},!1)),m.push(i.shop_id+"/"+i.item_id),a.push({itemname:g.editItemname(i.item_name,g.settings.reco.omitname),itemurl:n,imageele:"",imageurl:g.editImageurl(i.image_url_80,g.settings.reco.imagesize),imagealt:g.editItemname(i.item_name,g.settings.reco.omitname),imagetitle:g.editItemname(i.item_name,g.settings.reco.omitname),itemprice:g.editItemprice(i.item_price)});return r.pData={itemid:[c.shopid+"/"+c.itemid],ritemid:m},e.tracking_tag&&(r.pData.rtg=e.tracking_tag),g.settings.reco.placement?r.pData.rpl=g.settings.reco.placement:(c=h.RJS_Helpers.urlParameter(g.settings.reco.url))&&c.sid&&(r.pData.rpl=c.sid),g.props.reco.items[t]=a,!(p<g.settings.common.recothreshold)&&g.displayRecoData(t,r)}}}(e,o)&&g.getRankingData(o)},error:function(e,t,i){g.getRankingData(o)}})}catch(e){return g.getRankingData(o),!1}return!0},getRankingData:function(t){var r;g.status.isTimeout=!1;try{var e,i=g.props.ashiato.items[t].genreidlist.replace(/^\//,"").split("/"),o=g.settings.common.genrefilter.split(",");for(e in o)if(-1!=h.inArray(o[e],i))return g.props.initialized=!0,0<g.props.reco.items[t].length?g.displayRecoData(t):g.displayRecoDefaultContents(),g.props.requestPermission=!1,g.props.requestPermissionTimer=setTimeout(function(){g.props.requestPermission=!0},g.settings.common.requestwait),!1;(i=i[g.settings.ranking.genrelayer])===d&&(i=0),r=setTimeout(function(){g.status.isTimeout=!0,g.props.initialized||g.settings.common.showonnodata?g.displayRecoDefaultContents():g.displayDefaultContents()},g.settings.common.ajaxtimer),h.ajax({url:g.settings.ranking.url,cache:!0,dataType:"jsonp",data:{gid:i},jsonpCallback:"jsonp0123456789012",scriptCharset:"euc-jp",timeout:g.settings.common.ajaxtimer,success:function(e){!function(e,t){if(!g.status.isTimeout&&(clearTimeout(r),e.status!==d&&e.num!==d&&("Success"==e.status||"GenreNotFound"==e.status))){if(e.num<g.settings.common.recothreshold)return g.regImpressionCode(g.settings.common.impnodisp),0;for(var i=g.props.ashiato.items[t],o=[],s=0;s<e.items.length;s++){var n=(/R2=([^\&]+)/.exec(e.items[s].itemurl)||[])[1],a=!0;n===d&&/^https?:\/\/item.rakuten.co.jp/.test(e.items[s].itemurl)&&(a=!1,n=e.items[s].itemurl),n!==d&&(g.endsWith(n,i.shopurl+"/"+i.mngnumber+"/")||o.push({itemname:g.editItemname(e.items[s].itemname,g.settings.reco.omitname),itemurl:g.editItemurl(e.items[s].itemurl,g.settings.ranking.sid,a),imageele:"",imageurl:g.editImageurl(e.items[s].imageurl64,g.settings.reco.imagesize),imagealt:g.editItemname(e.items[s].itemname,g.settings.reco.omitname),imagetitle:g.editItemname(e.items[s].itemname,g.settings.reco.omitname),itemprice:g.editItemprice(e.items[s].price)}))}return o.length<g.settings.common.recothreshold?(g.regImpressionCode(g.settings.common.impnodisp),0):(1===g.settings.common.rankingshuffle&&(o=g.shuffle(o)),g.props.reco.items[t]==d&&(g.props.reco.items[t]=[]),g.props.reco.items[t]=h.merge(g.props.reco.items[t],o),g.displayRecoData(t))}}(e,t)&&(g.props.initialized||g.settings.common.showonnodata?g.displayRecoDefaultContents():g.displayDefaultContents())},error:function(e,t,i){g.props.initialized||g.settings.common.showonnodata?g.displayRecoDefaultContents():g.displayDefaultContents()}})}catch(t){return g.props.initialized||g.settings.common.showonnodata?g.displayRecoDefaultContents():g.displayDefaultContents(),!1}return!0},displayRecoData:function(e,i){function o(e){var t;i&&-1===h.inArray(e,g.props.reco.visitedPages)&&((t=h.extend({},i)).pData.rpp=e,g.sendToRAT(t),g.props.reco.visitedPages.push(e))}return 0!==g.eobj.reco.proto.length&&(g.props.reco.proto.width=g.eobj.reco.proto.outerWidth(),g.props.reco.proto.height=g.eobj.reco.proto.outerHeight(),g.props.reco.proto.html=g.eobj.reco.proto.html(),""!=g.props.reco.proto.html&&(g.eobj.reco.proto.hide(),g.eobj.reco.itemsDisplay.empty(),g.eobj.reco.prevButton.find("a").unbind("click"),g.eobj.reco.nextButton.find("a").unbind("click"),g.eobj.reco.altContents.hide(),g.eobj.common.loading.hide(),g.eobj.common.recoSlider.show(),g.regImpressionCode(g.settings.common.impdisp),g.eobj.reco.itemsDisplay.RJS_Slideshow(g,{settings:g.settings.reco,itemPrototype:g.props.reco.proto,eobj:g.eobj.reco,items:g.props.reco.items[e],events:{beforeFirstRender:function(e,t){t.props.initialized=!0,t.eobj.reco.itemsDisplay.show()},afterFirstRender:function(e,t){var i=t.eobj.reco.itemsDisplay.children().first().find(">div").length;t.props.requestPermission=!1,t.props.requestPermissionTimer=setTimeout(function(){t.props.requestPermission=!0},t.settings.common.requestwait),o("[0, "+i+"]")},afterSlide:function(e,t){o("["+e+", "+(e+t.eobj.reco.itemsDisplay.children().first().find(">div").length)+"]"),s()}}}),s(),!0))},regImpressionCode:function(e){return i[g.settings.common.impvar]===d||""==e?"":i[g.settings.common.impvar]=e},sendToRAT:function(e){var t={accountId:470,options:["url","ua"],pData:{sid:"ichiba",evn:"reco"}};e&&(t=h.extend(!0,{},t,e)),h(document).ready(function(){i.RAT&&"function"==typeof RAT.addCustomEvent&&i.RAT.addCustomEvent(t)})},shuffle:function(e){for(var t=Array.apply(null,e),i=t.length;i;){var o=Math.floor(Math.random()*i),s=t[--i];t[i]=t[o],t[o]=s}return t},endsWith:function(e,t){var i=e.length-t.length;return 0<=i&&e.lastIndexOf(t)===i},editItemname:function(e,t){return e=h.RJS_Helpers.omitStr(e,t,"…"),e=!h.browser.msie?e.split("").join(String.fromCharCode(8203)):e},editItemprice:function(e){return""!=e&&e!==d?String(e).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):e},editImageurl:function(e,t){return e=""!=e?h.RJS_Helpers.urlParameter(e,{_ex:t.replace(":","x"),fitin:t.replace("x",":")}):e},editItemurl:function(e,t,i){return e=""!=t?i?h.RJS_Helpers.urlR2Parameter(e,{"s-id":t},!1):h.RJS_Helpers.urlParameter(e,{"s-id":t},!1):e}})}).initialize()))}(this,window.jQuery);
