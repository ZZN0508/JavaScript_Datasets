define(["require","exports"],function(t,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.getVariant=v.addConfig=v.parseJWTToDict=v.addMatchedVariantsToEvent=v.addConfigsFromDOM=v.resetMetaTagConfigQueryCount=v.DROPBOX_VARIANTS_ISSUER=v.ADOBE_TARGET_FEATURE_CONFIG_DATA_ATTRIBUTE=v.ADOBE_TARGET_MATCHER_CONFIG_DATA_ATTRIBUTE=void 0,v.ADOBE_TARGET_MATCHER_CONFIG_DATA_ATTRIBUTE="data-uxa-matcher-configs",v.ADOBE_TARGET_FEATURE_CONFIG_DATA_ATTRIBUTE="data-uxa-variant-tokens",v.DROPBOX_VARIANTS_ISSUER="https://dropbox.com/ux_analytics";var n=0;v.resetMetaTagConfigQueryCount=function(){n=0},v.addConfigsFromDOM=function(t){var e=function(n,a){var r=[],t=document.head.querySelectorAll("meta["+n+"]");return t?(Array.prototype.forEach.call(t,function(t){try{var e=t.getAttribute(n);if(!e)return;a?r.push.apply(r,JSON.parse(e)):r.push(e)}catch(t){}}),r):[]};(t=void 0===t?!1:t)&&1<n||!t&&n||(n++,t=e(v.ADOBE_TARGET_MATCHER_CONFIG_DATA_ATTRIBUTE,!0),e=e(v.ADOBE_TARGET_FEATURE_CONFIG_DATA_ATTRIBUTE,!1),t.length&&e.length&&a({variant_tokens:e.join(","),matchers:t}))},v.addMatchedVariantsToEvent=function(t){var e,n,a;if("undefined"!=typeof self&&self){v.addConfigsFromDOM();var r,i,o,s=self._DBX_UX_variants_configStore,_={};if(t&&s&&s.matchers&&t.eventName&&(e=s.matchers[t.eventName]))for(var f in e)s.assignments&&e.hasOwnProperty(f)&&(i=e[f],(o=s.assignments[i.feature_name])&&void 0===_[o.variantToken]&&(n=i.like,a=t,void 0===n||function(t,e){if(void 0===t)return!0;var n,a=t;for(n in a)if(String(e[n])!==String(a[n]))return!1;return!0}(n.extra,a.extra))&&(t.extra||(t.extra={}),r=o.variantToken,f=void 0,(i=t.extra)[f=r.startsWith("adobetarget")?"adobe_target_variants":"variants"]?i[f]+=","+r:i[f]=r,_[o.variantToken]=!0))}};function i(t,e){function n(t){return decodeURIComponent(escape(t))}var a=t.split(".").map(function(t){return atob(t.split("_").join("/").split("-").join("+"))}),r=a[0],t=a[1];if(a[2]&&"JWT"===JSON.parse(n(r)).typ){t=JSON.parse(n(t)),e=t[e];if(t.iss===v.DROPBOX_VARIANTS_ISSUER)return e}}v.parseJWTToDict=function(t){for(var e={},n=0,a=i(t,"variants").split(",");n<a.length;n++){var r=a[n].split(":");2===r.length&&(e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]))}return e};var g=function(_){return(_.startsWith("adobetarget:")?function(){for(var t=[],e=0,n=_.split(",");e<n.length;e++){var a=n[e];try{var r=a.split(":"),i=r[0],o=r[1],s=r[2];t.push([i+":"+decodeURIComponent(o),decodeURIComponent(s)])}catch(t){continue}}return t}:function(){for(var t=[],e=0,n=i(_,"variants").split(",");e<n.length;e++){var a=n[e].split(":");2===a.length&&t.push(a.map(decodeURIComponent))}return t})()};function a(t){if(t){self._DBX_UX_variants_configStore=self._DBX_UX_variants_configStore||{};var e=self._DBX_UX_variants_configStore,n=t.variant_tokens,t=t.matchers;if(n)for(var a=0,r=n.split(",");a<r.length;a++){var i=r[a],o=g(i);if(o)for(var s=0,_=o;s<_.length;s++){var f=_[s],v=f[0],f=f[1];e.assignments=e.assignments||{},e.assignments[v]={variant:f,variantToken:i}}}if(t)for(var T=0,c=t;T<c.length;T++){var u=c[T];e.matchers=e.matchers||{};var d=u.event_name;e.matchers[d]=e.matchers[d]||{};var A={feature_name:u.feature_name,event_name:d,is_pre_tti:u.is_pre_tti,like:u.like},u=JSON.stringify(A);e.matchers[d][u]=A}}}v.addConfig=a,v.getVariant=function(t){var e=self._DBX_UX_variants_configStore;return(e&&e.assignments&&e.assignments[t]||{}).variant||"OFF"}});
