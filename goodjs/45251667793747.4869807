(this.$WP=this.$WP||[]).push(["HZtvHO",(e,t)=>{"use strict";var P,M,i,R,L,C,x,a,N,V,w,D,F,U,G,q,W,r,b,g,I,n,o,_,k,f,T,y,h,O,j,A,X,Q;function B(e,t){if(null==e)return{};for(var a,r={},i=Object.keys(e),n=0;n<i.length;n++)a=i[n],0<=t.indexOf(a)||(r[a]=e[a]);return r}var H=(e,t)=>{if(!t)return e;var a=(null==(r=e.paginatedTrips)?void 0:r.trips)||[],r=(null==(r=t.paginatedTrips)?void 0:r.trips)||[];return{paginatedTrips:e.paginatedTrips?{trips:[...a,...r],hasMore:!(null==(r=t.paginatedTrips)||!r.hasMore),__typename:e.paginatedTrips.__typename}:t.paginatedTrips,savedTrips:e.savedTrips}},z=e=>{return{__typename:e.__typename,id:e.id||0,title:e.title||void 0,status:e.status||void 0,photoId:e.photoId||void 0,photo:e.photo||{},route:{url:e.route&&e.route.url||void 0},actionPermissions:{canAddItem:!(null==(e=e.actionPermissions)||!e.canAddItem)}}},Z=e=>{var a,{saveObject:r,overlayState:i,validateTripName:n,lastSavedItem:o,trackingContext:l,trackingSource:s}=e,c=B(e,["saveObject","overlayState","validateTripName","lastSavedItem","trackingContext","trackingSource"]),[t,d]=P.useState(!0),{fetching:u,error:p,data:v,hasMore:m,loadMore:T}=(r=>{var a=(e,t)=>{if(!e||!t)return"invalidateAndRefetch";var a=r["originalObject"];return a&&t===a.type&&e===String(a.id)||t===r.type&&e===String(r.id)?"invalidateAndRefetch":"validate"},e=P.useContext(V)["userId"],t={offset:0,limit:10,userId:e||"",reference:C(r),loadSavedTrips:!0},[i,n]=f({query:y,variables:t,combineData:H,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:()=>"invalidateAndRefetch",cloneTrip:()=>"invalidateAndRefetch",tripsDelete:()=>"invalidateAndRefetch",addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>a(e,t),moveTripItem:({variables:{reference:e}})=>a(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveItem:({variables:{reference:e}})=>a(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>a(null==e?void 0:e.id,null==e?void 0:e.type)}}),o=G("trips_skip_check_whitelist_public_trips"),[e]=O({query:h,variables:{},pause:o}),l=(null==(t=i.data)||null==(s=t.paginatedTrips)?void 0:s.trips)||[],t=l.slice().filter(Boolean).map(z),s=!(null==(s=i.data)||null==(c=s.paginatedTrips)||!c.hasMore),c=(null==(c=i.data)?void 0:c.savedTrips)||[],c=new Set(c.map(e=>null==e?void 0:e.id).filter(Boolean)),d=o||(null==(o=e.data)||null==(d=o.authzInfo)?void 0:d.canMakePublicTrip);return{fetching:i.fetching||e.fetching,error:!!i.error,data:{tripList:t,saveSet:c,canMakePublicTrip:d},hasMore:s,loadMore:s?()=>n({offset:(null==l?void 0:l.length)||0,loadSavedTrips:!1}):()=>Promise.resolve()}})(r);u?a=P.createElement(I,{size:"large"}):p&&(a=P.createElement(k,{refetch:T})),P.useEffect(()=>{u||d(!1)},[]);var[E]=M({source:s||"trips",trackingContext:l,pageAsContext:!0,withSaveSession:!0}),S=()=>{c.onClose(),d(!0)},e=j[i](r.type),e=P.createElement(g,{iconName:G("trips_heart_icon")?"heart":"suitcase",displayType:"LEFT_ALIGN_GRAY"},e);return P.createElement(_,{element:"bundleSave"===r.type?"copyTripModal":"saveTripModal"},P.createElement(b,{header:e,closeIconColor:"BLACK",bodyProps:{isFullBleed:!0},onClose:S},a&&t?P.createElement("div",{className:"_1ZX8j9so"},a):(()=>{var e=o?x(o):void 0,t=()=>P.createElement("div",{className:"_2VvuVGxR"},P.createElement(A,{gate:()=>Promise.resolve(),object:r,onMount:()=>{u||p||E({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{c.statCallback("ADD","NEW",e,!0,!0),S()},onError:c.onError,canMakePublicTrip:v.canMakePublicTrip,validateTripName:n,trackingContext:l,trackingSource:s}));switch(i){case"DEFAULT":return 0===v.tripList.length?t():P.createElement(Q,{tripList:v.tripList,savedSet:v.saveSet,tripListBottom:a,onPaginate:T,hasMore:m,saveObject:r,onMount:()=>{c.preventInteractionInMountedComponents||E({elementClick:{element:"stat"}})},onCreateTrip:()=>{c.onCreateTripClicked&&c.onCreateTripClicked()},tripAction:"SAVE",onRemovedFromTrip:(e,t,a)=>{c.statCallback("REMOVE","EXISTING",e,t,a),S()},onSavedToTrip:(e,t,a)=>{c.statCallback("ADD","EXISTING",e,t,a),S()},onError:c.onError,trackingContext:l,trackingSource:s});case"CREATE":return t();case"SELECT":return e?P.createElement(Q,{tripList:v.tripList,savedSet:v.saveSet,tripListBottom:a,onPaginate:T,hasMore:m,saveObject:e,onMount:()=>{E({elementClick:{element:"stat"}})},onCreateTrip:()=>{c.onSelectCreateTripClicked&&c.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:(e,t,a)=>{c.statCallback("MOVE","EXISTING",e,t,a),S()},onRemovedFromTrip:(e,t,a)=>{c.statCallback("REMOVE","EXISTING",e,t,a),S()},onError:c.onError,trackingContext:l,trackingSource:s}):"";case"SELECT_CREATE":return o?P.createElement("div",{className:"_2VvuVGxR"},P.createElement(X,{gate:()=>Promise.resolve(),item:o,onMovedToCreatedTrip:e=>{c.statCallback("MOVE","NEW",e,!0,!0),S()},canMakePublicTrip:v.canMakePublicTrip})):t();default:return""}})()))},J=(e,t)=>{switch(t.type){case"setOverlayState":return Object.assign({},e,{overlayState:t.state});case"afterSave":return Object.assign({},e,{overlayState:"DEFAULT",preventInteractionInMountedComponents:!0});default:throw new Error}},l=e=>{var{logInteraction:a,object:t,active:r,preventInteractionPropagation:i,trackingContext:n,trackingSource:o,resaveTrip:l,saveObject:s,saveStatus:c,updateLastTripId:d,initialOverlayState:u}=e,p=B(e,["allowPopStatModal","logInteraction","puid","object","active","preventInteractionPropagation","trackingContext","trackingSource","resaveTrip","saveObject","saveStatus","updateLastTripId","onClose","initialOverlayState"]),v=P.useContext(V)["userId"],{launchViewTripToast:m,launchRemoveFromTripToast:T,launchErrorTripToast:E}=N(),S=q()["getTripErrorMessage"],C=W("SAVE_TO_TRIP_INTENT"),b=W("SAVE_TO_TRIP"),g=W({type:"CREATE_TRIP",payload:{user_id:v||""}}),I=P.useContext(R),[_,k]=P.useReducer(J,{overlayState:u||"DEFAULT",preventInteractionInMountedComponents:!1}),f=P.useRef(!0);P.useEffect(()=>()=>{f.current=!1},[]);var y=p["onComplete"],h=P.useCallback(e=>{y&&y(e),I.resetSession()},[y,I]),O=P.useCallback((e,t)=>{e&&!t?(m(e,"SAVED",()=>{a({elementClick:{element:"saved_viewTrip"}})}),h(!0)):t&&(E(t),h(!1)),f.current&&k({type:"setOverlayState",state:"DEFAULT"}),a({elementClick:{element:"unsave_undo"}})},[m,h,E,a]),j=P.useCallback(e=>{T(e,s,O)},[T,O,s]),e=P.useCallback(e=>{E(e)},[E]),[u,A]=P.useState(!1),p=P.useCallback(()=>{A(!0),I.resetSession()},[I]),M=P.useCallback((e,t)=>{"CREATED"===t&&(b(),g()),f.current&&k({type:"afterSave"}),m(e,t,()=>{a({elementClick:{element:"saved_viewTrip"}})}),d(e.id),h(!0)},[b,m,h,d,g,a]);return!u&&P.createElement("div",{className:"stat_wrapper",onClick:e=>{e.stopPropagation(),e.preventDefault(),!i&&v&&a({elementClick:{element:"item_save",tripId:null==l?void 0:l.id}}),r||C()}},P.createElement(Z,{saveObject:s,overlayState:_.overlayState,lastSavedItem:null==(c=c.result)?void 0:c.tripItem,trackingContext:n,trackingSource:o,onCreateTripClicked:()=>{f.current&&k({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:()=>{f.current&&k({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:p,onError:e,preventInteractionInMountedComponents:_.preventInteractionInMountedComponents,statCallback:(e,t,a,r,i)=>{"REMOVE"===e?(j(a),h(i)):"NEW"===t?M(a,"CREATED"):r&&M(a,"SAVED")},validateTripName:e=>{if("bundleSave"===s.type&&e.trim().toLowerCase()===t.title.trim().toLowerCase())return S("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})}}))},K=e=>G("trips_bookmark")?P.createElement(i,null,P.createElement(r,null,P.createElement(l,e))):null,Y=["Profile","HomeFeed","Trips","Home"],E=e=>{var t=e["children"],a=B(e,["children"]),r=P.useMemo(()=>a.saveObject||x(a.object,!0),[a.saveObject,a.object]),e=(e=>{var t=P.useMemo(()=>e.saveObject||x(e.object,!0),[e.saveObject,e.object]),{resaveTrip:a,onComplete:r,allowPopStatModal:i}=e,{isNativeWebview:n,tripId:o}=e,l=B(e,["isNativeWebview","tripId"]),{launchAutoSavedToTripToast:s,launchErrorTripToast:c}=N(),[d]=P.useContext(w),u=d["page"],p=P.useMemo(()=>({source:e.trackingSource||"trips",saveObject:t,trackingContext:e.trackingContext,withSaveSession:!0,pageAsContext:!0}),[e.trackingContext,e.trackingSource,t]),[v,m]=M(p),T=P.useContext(R),[E,S,C]=D(o,t,e.active),b=null==t?void 0:t.id,g=null==t?void 0:t.type,I=P.useCallback(e=>{c(e)},[c]),_=P.useCallback(()=>{v({elementClick:{element:"ITEM_SAVE_LOGIN",context:u&&L(u)||void 0,puid:m,saveType:g,detailId:b?""+b:"",tripId:null==a?void 0:a.id,sessionType:"SAVE",sessionUuid:T.sessionUuid,sessionOrder:T.sessionOrder}})},[v,u,m,a,b,g,T.sessionOrder,T.sessionUuid]),k=P.useCallback(()=>{v({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:u&&L(u)||void 0,puid:m,saveType:g,detailId:b?""+b:"",tripId:null==a?void 0:a.id,sessionType:"SAVE",sessionUuid:T.sessionUuid,sessionOrder:T.sessionOrder}})},[v,u,m,a,b,g,T.sessionOrder,T.sessionUuid]),o=P.useMemo(()=>({pid:u&&Y.includes(d.page)?40439:39766,flow:n?"NATIVE_LOGIN":"SAVES_COMBINED",onLogin:_,onSuccess:k,isFullWidthMobile:!0}),[_,k,u,d.page,n]),f=F(o),y=P.useRef(!1),h=U(()=>t?P.createElement(K,Object.assign({},l,{logInteraction:v,puid:m,saveObject:t,saveStatus:E,updateLastTripId:C})):null)["open"],O=U(()=>t?P.createElement(K,Object.assign({},l,{initialOverlayState:"SELECT",logInteraction:v,puid:m,saveObject:t,saveStatus:E,updateLastTripId:C})):null)["open"],j=P.useMemo(()=>d.params.popStat||!1,[d.params]),A=P.useCallback(()=>!!i&&j&&G("trips_pop_stat_modal"),[i,j]);return P.useEffect(()=>{A()&&!y.current&&(y.current=!0,v({elementClick:{element:"autoPopStat"}}),f().then(h))},[v,f,h,A]),P.useCallback(()=>{f().then(()=>S()).then(([e,t])=>{null!==e||null!==t?t?I({query:"ADD_ITEM_TO_TRIP",tripsError:t}):e&&(s(e,()=>{O(),v({elementClick:{element:"quickSave_change"}})}),v({modalSuccess:{element:"quickSave",tripId:null==a?void 0:a.id,context:u&&L(u)||void 0,saveType:g,detailId:b?""+b:""}}),r&&r(!0)):h()})},[h,O,s,v,f,r,I,S,u,a,b,g])})(a);return r?P.createElement(i,null,t(e)):null},s=e=>{var t,a,r,{queryObject:i,children:n}=e,o=B(e,["queryObject","children"]),[l,s]=P.useState(null!=(e=o.object)&&null!=(t=e.object)&&t.socialStatistics?!(null==(t=o.object)||null==(a=t.object)||null==(r=a.socialStatistics)||!r.isSaved):!(null==(r=o.object)||null==(d=r.socialStatistics)||!d.isSaved)),c=(e,t)=>{if(!e||!t)return"invalidateAndRefetch";var a=i["originalObject"];return a&&t===a.type&&e===String(a.id)||t===i.type&&e===String(i.id)?"invalidateAndRefetch":"validate"},d=P.useContext(V)["userId"],u=d?null!=(u=o.object)&&u.socialStatistics?"afterInvalidation":"immediately":"never",[{fetching:p,data:v,error:m}]=T({query:i.query,variables:i.variables,executeWhen:u},{addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>c(e,t),tripsRemoveItem:({variables:{reference:e}})=>c(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>c(e.id,null==e?void 0:e.type)});return P.useEffect(()=>{var e,t;p||m||(t=v&&v.savesObjects&&v.savesObjects[0])&&({id:e,socialStatistics:t={}}=t,(t=(e===i.id||String(e)===i.id)&&!!t.isSaved)!==l&&s(t))},[p,v,m]),P.createElement(E,Object.assign({active:l},o),e=>n(e,l,p))},c=e=>{if(!G("trips_bookmark"))return null;var t=e.saveObject||x(e.object,!0);if(!t)return console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null;t=a(t);return t?P.createElement(s,Object.assign({},e,{queryObject:t})):(console.error("Unsupported saves object was passed to QueriedTripFlowSelector"),null)};return[()=>{j=Object.freeze({DEFAULT:e=>"bundleSave"!==e?P.createElement(n,{id:"stat_modal_save_to_trip_v2"}):P.createElement(n,{id:"save_all_items_modal_header"}),CREATE:()=>P.createElement(n,{id:"stat_modal_create_a_trip_v2"}),SELECT:()=>P.createElement(n,{id:"select_trip_header"}),SELECT_CREATE:()=>P.createElement(n,{id:"stat_modal_create_a_trip_v2"})}),A=o.component.onUsage(()=>t("neHaXV"),"CreateTripWithAddItemModal",P.createElement("div",{className:"_1ZX8j9so"},P.createElement(I,{size:"large"}))),X=o.component.onUsage(()=>t("neHaXV"),"CreateTripWithMoveItemModal",P.createElement("div",{className:"_1ZX8j9so"},P.createElement(I,{size:"large"}))),Q=o.component.onUsage(()=>t("pBQaod"),"SaveToTripContent",P.createElement("div",{className:"_1ZX8j9so"},P.createElement(I,{size:"large"}))),l.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1},c.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1},e({QueriedTripFlowSelector:c,TripFlowSelector:E})},[e=>P=e,e=>(M=e.useTripInteraction,i=e.SaveSessionProvider,R=e.SaveSessionTrackingContext,L=e.getInteractionsContext),e=>(C=e.toReference,x=e.toSavesObject,a=e.objectStatisticQuery),e=>N=e.default,e=>(V=e.Visitor,w=e.Route),e=>D=e.useAutosave,e=>F=e.useSocialLoginGate,e=>U=e.useVDOMPortal,e=>G=e.featureIsEnabled,e=>q=e.useLocalizeTripError,e=>W=e.usePixelCallback,e=>r=e.ToastProvider,e=>b=e.default,e=>g=e.TitleBar,e=>I=e.LoadingSpinner,e=>n=e.default,e=>o=e,e=>_=e.TripsImpression,e=>k=e.default,e=>(f=e.usePaginatedQuery,T=e.useInvalidatableQuery),e=>(y=e.TripDetailStatQuery,h=e.GetUserAuthZInfo),e=>O=e.useQuery]]},["cDcdfi","U-DhDC","eFKnUp","PiTJFd","2R4xv2","fTyhRT","JFHNGL","vq6MSq","-i3PJS","9I0t-6","jb_4W2","Q7TAd7","O8LbtK","6nM-E7","V08PS7","0DsHEV","pLbCP4","c_rvp5","LFeTN6","OnmvvE","RXx5aI","5X2em-"]]);
