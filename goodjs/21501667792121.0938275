!function(){try{!function(a,b){window.getVPAIDAd=function(){try{if(E.ad)return E.ad;var e=function(){E.Util=n(),E.Queue=l(),E.VpaidAd=o(),E.MoatTag=s(),r();var e=E.Util.parseQS();if(e&&!E.Util.isEmptyObject(e)){var t,i={};for(t in E.qs=e)i[t]=e[t];return i.wrapperType="js",new E.MoatTag(E.qs.pcode,i),new E.VpaidAd}E.Util.fireError("Unable to parse qs params")}();return E.ad=e}catch(e){E.Util.fireError("Error during MoatWrapper init",!0)}};var E={ad:null,version:"2.0",startTime:(new a).getTime(),rand:b.floor(b.random()*b.pow(10,8)),playerProvidedEventCallbacks:{},HCP:{},DispatchedQuartiles:{AdVideoStart:!1,AdVideoFirstQuartile:!1,AdVideoMidpoint:!1,AdVideoThirdQuartile:!1,AdVideoComplete:!1},VPAIDevents:{AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdRemainingTimeChange:"AdRemainingTimeChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",AdProgress:"AdProgress"},VPAIDmethods:{resizeAd:"resizeAd",startAd:"startAd",stopAd:"stopAd",pauseAd:"pauseAd",resumeAd:"resumeAd",expandAd:"expandAd",collapseAd:"collapseAd",skipAd:"skipAd"},AssetTypeMapping:{unknown:"-",asset:"1",vast:"2",vpaid:"3"}},n=function(){var s={safeCallbacks:{},findMoatScript:function(){for(var e=/moatwrapper/,t=document.getElementsByTagName("script"),i=t.length-1;0<=i;i--){var n=t[i];if(e.test(n.src))return n}},parseQS:function(){var e={},t=s.findMoatScript();if(!t)return!1;for(var i=t.src.split("#")[1].split("&"),n=i.length-1;0<=n;n--){var r=i[n].split("=");e[r[0]]=decodeURIComponent(r.slice(1).join("="))}return e.vast&&(e.vast=s.expandCachebuster(e.vast)),e},getScrUrls:function(){var e,t,i=E&&E.qs,n=[],r=new RegExp(/^scr\d{1,}/);if(!i)return n;for(t in i)0===t.search(r)&&"string"==typeof(e=i[t])&&n.push(e);return n},getParentNode:function(e){return e.parentNode||e.parentElement||!1},getElementNodeTree:function(e){if(!e)return!1;for(var t="number"==typeof cap?cap:50,i=[e],n=!1,r=0;r<t&&(n=s.getParentNode(e))&&1===n;r++)e=n,i.push(e)},getSafeNode:function(e){if(!e)return!1;if("OBJECT"!==e.nodeName&&"EMBED"!==e.nodeName)return e;for(var t=s.getElementNodeTree(e),i=!1,n=0;n<t.length;n++){var r=t[n];if(r&&"OBJECT"!==r.nodeName&&"EMBED"!==r.nodeName){i=r;break}}return i},hasChildNodes:function(e){return e&&e.childNodes&&0<e.childNodes.length},addTagSafely:function(e,t){if(!e||!t)return!1;var i=s.getSafeNode(t);return!!i&&(s.hasChildNodes(i)?(t=i.childNodes[b.max(0,i.childNodes.length-1)]||null,i.insertBefore(e,t)):i.appendChild(e),i)},addScriptToDOM:function(e,t,i){if("string"!=typeof e||!t||!document)return!1;i=i||document.createElement("script");i.type="text/javascript";t=s.addTagSafely(i,t);return!!t&&(i.src=e,t)},isANumber:function(e){return"number"==typeof e&&!isNaN(e)},expandCachebuster:function(e){return e.replace("[MOAT_CB]",""+(new a).getTime())},createXMLcompanionNode:function(e){if(!e||0===e.length)return"";for(var t,i,n,r,s,a,o=document.implementation.createDocument(null,"CompanionAds",null),l=e.length-1;0<=l;l--){if(t=e[l],(i=o.createElementNS("","Companion")).setAttributeNS("","width",t.width),i.setAttributeNS("","height",t.height),(n=o.createElementNS("","StaticResource")).setAttributeNS("","type",t.type),n.appendChild(o.createCDATASection(t.staticResource)),i.appendChild(n),t.companionClickThroughURLTemplate&&((n=o.createElementNS("","CompanionClickThrough")).appendChild(o.createCDATASection(t.companionClickThroughURLTemplate)),i.appendChild(n)),t.trackingEvents&&t.trackingEvents.creativeView){for(var d=o.createElementNS("","TrackingEvents"),u=(r=t.trackingEvents.creativeView).length-1;0<=u;u--)s=r[u],(a=o.createElementNS("","Tracking")).setAttributeNS("","event","creativeView"),a.appendChild(o.createCDATASection(s)),d.appendChild(a);i.appendChild(d)}o.documentElement.appendChild(i)}return(new XMLSerializer).serializeToString(o)},emptyObj:{},isArray:function(e){try{return"[object Array]"===s.emptyObj.toString.call(e)}catch(e){return!1}},indexOf:function(e,t){if(!e)return-1;if(s.isArray(e)){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}return"string"!=typeof e||!t&&"string"==typeof t?-1:e.indexOf(t)},arrayContains:function(e,t){return-1!==s.indexOf(e,t)},isFunction:function(e){try{return"[object Function]"===s.emptyObj.toString.call(e)}catch(e){return!1}},isEmptyObject:function(e){try{for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}catch(e){return!1}},isNumber:function(e){try{return"[object Number]"===s.emptyObj.toString.call(e)}catch(e){return!1}},getQueryString:function(e){var t,i,n=[];for(t in e)e.hasOwnProperty(t)&&(i=e[t],i=t+"="+encodeURIComponent(i),n.push(i));return n.join("&")},getHash:function(e,t){var i=new a;return function(e){var t=0;if(e.length<1)return t;for(var i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return b.abs(t)}(e+=t+[i.getFullYear(),("0"+(i.getMonth()+1)).slice(-2),("0"+i.getDate()).slice(-2)].join("-"))},timeouts:[],loops:{},fireError:function(e,t){var i,n;try{i=E.qs.level1+"%3A"+E.qs.level2+"%3A"+E.qs.level3+"%3A"+E.qs.level4}catch(e){i="data%3Adata%3Adata%3Adata"}try{r=(r=E.qs.vast||E.qs.asset).replace(/gdpr_consent=[^&]*&?/i,"")}catch(e){r="-"}try{n=E.moatTag?E.moatTag.pcode:E.PARTNER_CODE}catch(e){n="-"}try{s=E.AssetTypeMapping[E.underlyingTagType]}catch(e){s=E.AssetTypeMapping.unknown}var r="//px.moatads.com/pixel.gif?e=24&d="+i+"&i="+encodeURIComponent("TRADEDESKVIDEO1")+"&rp=1&gw="+n+"&ac=1&k="+encodeURIComponent(e)+"&ar="+encodeURIComponent("5103f31-clean")+"&iw="+encodeURIComponent("eb0ec0b")+"&j="+encodeURIComponent(document.referrer)+"&zMoatVast="+encodeURIComponent(r)+"&dMoatUTT="+s+"&dMoatIT="+!!t+"&cs="+(new a).getTime(),s=new Image;t&&(s.onload=function(){E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdError,args:[e]})}),s.src=r},makeSafe:function(e,i,n){var r=!1;return function(){try{return i?n?e.apply(n,arguments):e.apply(this,arguments):e.apply(null,arguments)}catch(e){var t;r||(E.HCP.hadMSE=!0,t=e.name+" in makeSafe: "+e.message+", stack="+e.stack,r=!0,E.Util.fireError(t,!0))}}},setSafeTimeout:function(e,t){var i;return e=s.makeSafe(e),window&&window.setTimeout&&(i=window.setTimeout(e,t),s.timeouts.push(i)),i},setSafeLoop:function(e,t,i){var n;s.isFunction(e)&&s.isArray(t)&&s.isNumber(i)&&(n=(new a).getTime()+"",s.loops[n]&&window.clearTimeout(s.loops[n].tid),s.loops[n]={},s.loops[n].callback=s.makeSafe(e,t),s.loops[n].interval=i,s.loops[n].tid=s.setSafeTimeout(s.runLoop(n),i))},runLoop:function(t){return function(){if(!s.loops||!s.loops[t])return!1;var e=s.loops[t].callback.call(null);if("boolean"==typeof e&&!1===e)return window.clearTimeout(s.loops[t].tid),s.loops[t]=!1;s.loops[t].tid=s.setSafeTimeout(s.runLoop(t),s.loops[t].interval),t=null}},objectToQueryString:function(e){var t,i,n=[];for(t in e)e.hasOwnProperty(t)&&(i=e[t],i=t+"="+encodeURIComponent(i),n.push(i));return n.join("&")},addListener:function(e,t,i,n){var r=this.makeSafe(i),i=e.addEventListener?{name:"addEventListener",evtPrefix:""}:{name:"attachEvent",evtPrefix:"on"};if(e&&i.name&&e[i.name])try{e[i.name](i.evtPrefix+t,r,!1)}catch(e){}!1!==n&&(s.safeCallbacks[t+n]=r)},removeListener:function(e,t,i,n){var r=t+n;if(!e)return delete s.safeCallbacks[r],!1;try{e.removeEventListener,e.detachEvent}catch(e){return delete s.safeCallbacks[r],!1}i=!1!==n?s.safeCallbacks[r]:i,n=e.removeEventListener?{name:"removeEventListener",evtPrefix:""}:{name:"detachEvent",evtPrefix:"on"};try{e[n.name](n.evtPrefix+t,i,!1)}catch(e){}delete s.safeCallbacks[r]},getVastUrl:function(){var t;try{t=(t=E.qs.vast||E.qs.asset).replace(/gdpr_consent=[^&]*&?/i,"")}catch(e){t="-"}return t},sendHealthCheckPixel:function(e,t){var i,n,r;t&&E.Util.arrayContains(["WrapperFound","AdStarted","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdStopped","AdSkipped"],t)&&(E.DispatchedQuartiles.hasOwnProperty(t)?!1===E.DispatchedQuartiles[t]&&(E.DispatchedQuartiles[t]=!0):(r="VPAID_HC",n={},i=encodeURIComponent(e.pcode)||"-",e=E.Util.getVastUrl(),n.e={WrapperFound:17,AdStarted:0,AdVideoStart:29,AdVideoFirstQuartile:29,AdVideoMidpoint:29,AdVideoThirdQuartile:29,AdVideoComplete:29,AdStopped:28,AdSkipped:33}[t],n.i=r,n.dMoatWVH=encodeURIComponent("TRADEDESKVIDEO1")+"_WRAPPER",n.gw=i,n.d="data:data:data:data",n.de=E.rand,n.t=E.startTime,n.ac=1,n.bq=8,n.ar="5103f31-clean",n.iw="eb0ec0b",n.j=encodeURIComponent(document.referrer),n.ah=(new a).getTime()-E.startTime,E.HCP.moatVideoLoaded&&(n.wvl=1),E.DispatchedQuartiles.AdVideoStart&&(n.wrf=1),E.DispatchedQuartiles.AdVideoFirstQuartile&&(n.wrg=1),E.DispatchedQuartiles.AdVideoMidpoint&&(n.wrh=1),E.DispatchedQuartiles.AdVideoThirdQuartile&&(n.wri=1),E.DispatchedQuartiles.AdVideoComplete&&(n.wrj=1),n.dMoatVAST=e,E.underlyingTagType?n.dMoatUTT=E.AssetTypeMapping[E.underlyingTagType]:n.dMoatUTT=E.AssetTypeMapping.unknown,E.HCP.adIconAvailable&&(n.dMoatIconAvailable=1),E.HCP.adIconRendered&&(n.dMoatIconRendered=1),E.HCP.skipButtonAvailable&&(n.dMoatSkipButtonAvailable=1),E.HCP.skipButtonRendered&&(n.dMoatSkipButtonRendered=1),E.HCP.companionAdAvailable&&(n.dMoatCompanionAdAvailable=1),E.HCP.companionAdRendered&&(n.dMoatCompanionAdRendered=1),E.HCP.hadMSE&&(n.dMoatHadMSE=1),r="//px.moatads.com/pixel.gif?"+(n=(n=this.getQueryString(n)).replace(/\x27/g,"%27"))+"&na="+this.getHash(n,r)+"&cs=0",(new Image).src=r))},getDocAndWinOfEl:function(e){var t,i;try{i=(t=e.ownerDocument)&&(t.defaultView||t.parentWindow)}catch(e){}return{elDoc:t,elWin:i}},isPromise:function(e){return!!e&&"function"==typeof e.then&&"function"==typeof e.catch},isANumber:function(e){return"number"==typeof e&&!isNaN(e)}};return s},r=function(){E.Queue.subscribe("vpaid-events",function(e){var t=e.type,i=e.args;if(E.playerProvidedEventCallbacks[t])for(var n=E.playerProvidedEventCallbacks[t],r=n.length-1;0<=r;r--){var s=n[r],a=s.fn,s=(s=s.listenerScope)||null;try{a.apply(s,i)}catch(e){}}})},s=function(){function e(e,t){(E.moatTag=this).pcode=e,this.ids=t,this.moatapi,this.eventBuffer=[],this.init()}return e.prototype.init=function(){var r=this;E.Util.sendHealthCheckPixel(r.ids,"WrapperFound"),E.Queue.subscribe("moat-tag",function(e){r.initMoatTracking(e.videoElement,e.duration)}),E.Queue.subscribe("vpaid-events",function(e){var t=e.type!==E.VPAIDevents.AdError?E.ad.getAdVolume():-1,t={type:e.type,adVolume:t};if(e.type===E.VPAIDevents.AdDurationChange&&(t.duration=e.args[0],t.confirmed=!0),"moat_DURATION_DEBUG"===e.type){if(!e.args||e.length<2)return;t[e.args[0]]=e.args[1]}if(r.moatapi&&"function"==typeof r.moatapi.dispatchEvent){if(r.eventBuffer&&0<r.eventBuffer.length)for(var i=r.eventBuffer.length-1;0<=i;i--){var n=r.eventBuffer[i];r.moatapi.dispatchEvent(n)}r.eventBuffer=!1,r.moatapi.dispatchEvent(t)}else r.eventBuffer&&r.eventBuffer.push(t);E.Util.sendHealthCheckPixel(r.ids,t.type)}),E.Queue.subscribe("moatapi-events",function(e){r.moatapi&&r.moatapi.adData&&r.moatapi.adData.ids&&!r.moatapi.adData.ids[e.property]?r.moatapi.adData.ids[e.property]=e.value:r.ids&&!r.ids[e.property]&&(r.ids[e.property]=e.value)}),E.Queue.subscribe("moatvideo-events",function(e){e.type&&"AdClicked"===e.type&&E.underlyingAsset&&E.underlyingAsset.onAdClickHandler&&E.underlyingAsset.onAdClickHandler()})},e.prototype.initMoatTracking=function(e,t){var i=document.createElement("script"),n=[],r={vidIntType:"2",vidIntVersion:"6.1",adData:{ids:this.ids,duration:t},dispatchEvent:function(e){this.sendEvent?(n&&(n.push(e),e=n,n=!1),this.sendEvent(e)):n&&n.push(e)},publishToWrapper:function(e){E.Queue.publish("moatvideo-events",e)}},s="_moatApi"+b.floor(1e8*b.random()),t=E.Util.getDocAndWinOfEl(e),t=(t.elDoc,t.elWin);if(!t)return!1;this.moatapi=t[s]=r,i.type="text/javascript",e&&e.insertBefore(i,e.childNodes[0]||null),i.src="https://z.moatads.com/"+this.pcode+"/moatvideo.js"+("#"+s)},e},o=function(){function e(){this._width,this._height,this._viewMode,this._desiredBitrate,this._creativeData,this._environmentVars,this._slot,this._videoSlot,this._domElToTrack,this._hasIcons=!1,this._adStopped}return e.prototype={initAd:E.Util.makeSafe(function(e,t,i,n,r,s){var a,o;this._width=e,this._height=t,this._viewMode=i||"normal",this._desiredBitrate=n,this._creativeData=r,this._environmentVars=s,this._slot=s.slot,this._videoSlot=s.videoSlot,"string"==typeof this._videoSlot.nodeName&&"number"==typeof this._videoSlot.nodeType?this._domElToTrack=this._videoSlot:this._domElToTrack=this._slot,E&&E.moatTag&&E.moatTag.ids&&this._domElToTrack&&(t="number"==typeof this._domElToTrack.offsetHeight?this._domElToTrack.offsetHeight:"-",e="number"==typeof this._domElToTrack.offsetWidth?this._domElToTrack.offsetHeight:"-",E.moatTag.ids.origSize=e+"x"+t),this._domElToTrack&&this._domElToTrack.parentNode&&this._domElToTrack.parentNode.id&&"fw-pdk-plugin-video-display-base"==this._domElToTrack.parentNode.id&&(a=this._domElToTrack.offsetHeight,o=this._domElToTrack.offsetWidth,("number"==typeof a&&!isNaN(a)&&0==a||"number"==typeof o&&!isNaN(o)&&0==o)&&this._height&&this._width&&this._domElToTrack.style&&(this._domElToTrack.style.height=this._height+"px",this._domElToTrack.style.width=this._width+"px")),E.qs.vast,E.qs.asset,E.qs.vast?(E.VastLoader=c(),(new E.VastLoader).request(E.qs.vast),E.underlyingTagType="vast"):E.qs.asset?(E.VideoPlayer=U(),a=new E.VideoPlayer,E.underlyingAsset=a,o=[{fileURL:E.qs.asset,mimeType:"video/mp4",height:this._height,width:this._width,bitrate:this._desiredBitrate}],E.underlyingTagType="asset",a.init(o,!1,E.qs.clickTag,!1)):E.Util.fireError("Problem retrieving video file from underlying tag/asset",!0)},!0),collapseAd:E.Util.makeSafe(function(){E.underlyingAsset&&E.underlyingAsset.collapseAd()},!0),constructor:E.Util.makeSafe(constructor,!0),expandAd:E.Util.makeSafe(function(){E.underlyingAsset&&E.underlyingAsset.expandAd()},!0),getAdCompanions:E.Util.makeSafe(function(){if(E.underlyingAsset)return E.underlyingAsset.getAdCompanions()},!0),getAdDuration:E.Util.makeSafe(function(){return E.underlyingAsset?E.underlyingAsset.getAdDuration():-2},!0),getAdExpanded:E.Util.makeSafe(function(){if(E.underlyingAsset)return E.underlyingAsset.getAdExpanded()},!0),getAdHeight:E.Util.makeSafe(function(){if(E.underlyingAsset)return E.underlyingAsset.getAdHeight()},!0),getAdIcons:E.Util.makeSafe(function(){if(E.underlyingAsset)return E.underlyingAsset.getAdIcons()||E.ad._hasIcons},!0),getAdLinear:E.Util.makeSafe(function(){if(E.underlyingAsset)return E.underlyingAsset.getAdLinear()},!0),getAdRemainingTime:E.Util.makeSafe(function(){return E.underlyingAsset?E.underlyingAsset.getAdRemainingTime():-2},!0),getAdSkippableState:E.Util.makeSafe(function(){if(E.underlyingAsset)return E.underlyingAsset.getAdSkippableState()},!0),getAdVolume:E.Util.makeSafe(function(){return E.underlyingAsset?E.underlyingAsset.getAdVolume():1},!0),getAdWidth:E.Util.makeSafe(function(){if(E.underlyingAsset)return E.underlyingAsset.getAdWidth()},!0),handshakeVersion:E.Util.makeSafe(function(e){return E.version},!0),pauseAd:E.Util.makeSafe(function(){E.underlyingAsset&&E.underlyingAsset.pauseAd()},!0),resizeAd:E.Util.makeSafe(function(e,t,i){E.underlyingAsset&&E.underlyingAsset.resizeAd(e,t,i)},!0),resumeAd:E.Util.makeSafe(function(){E.underlyingAsset&&E.underlyingAsset.resumeAd()},!0),setAdVolume:E.Util.makeSafe(function(e){!1===isNaN(e)&0<=e&&e<=1&&E.underlyingAsset&&E.underlyingAsset.setAdVolume(e)},!0),skipAd:E.Util.makeSafe(function(){E.underlyingAsset&&E.underlyingAsset.skipAd()},!0),startAd:E.Util.makeSafe(function(){E.underlyingAsset&&E.underlyingAsset.startAd()},!0),stopAd:E.Util.makeSafe(function(){!0!==this._adStopped&&E.underlyingAsset&&(E.underlyingAsset.stopAd(),this._adStopped=!0)},!0),subscribe:E.Util.makeSafe(function(e,t,i){var n=E.playerProvidedEventCallbacks;n[t]?n[t].push({fn:e,listenerScope:i}):n[t]=[{fn:e,listenerScope:i}]},!0),unsubscribe:E.Util.makeSafe(function(e,t){var i=E.playerProvidedEventCallbacks[t];if(i&&i.length)for(var n=i.length-1;0<=n;n--)e===i[n].fn&&i.splice(n,1)},!0)},e},l=function(){var s={"vpaid-events":[],"moat-tag":[],"internal-events":[],"skip-button":[],"moatapi-events":[],"brandsafety::ready":[],"moatvideo-events":[],"wrapper-to-moatvideo-events":[]};return{subscribe:function(e,t){if(s[e]){var i=s[e].push(t)-1;return{remove:function(){delete s[e][i]}}}},publish:function(e,t){if(s[e])for(var i=s[e],n=i.length-1;0<=n;n--){var r=i[n];"function"==typeof r&&r.call(null,t)}}}},d=(e.prototype.init=function(){if(this.icons&&this.icons.length){for(var e=0;e<this.icons.length;e++)this.createIcon(this.icons[e]);this.iconsCreated=!0,E.ad._hasIcons=!0}},e.prototype.createIconContainer=function(e){var t=document.createElement("DIV");return t.id="icon"+e.program,t.style.width=e.width+"px",t.style.height=e.height+"px",t.style.position="absolute",t.style.left="number"==typeof e.xPosition?e.xPosition+"px":this.calculateLeft(e.xPosition,e.width),t.style.top="number"==typeof e.yPosition?e.yPosition+"px":this.calculateTop(e.yPosition,e.height),t.style.zIndex="2147483647",t},e.prototype.createIconAnchor=function(e){var t=document.createElement("A");return t.href=e,t.target="_blank",t},e.prototype.createIconLogo=function(e){var t=document.createElement("IMG");return t.src=e,t.border="0px",t.style.width="100%",t.style.height="100%",t},e.prototype.createIcon=function(e){var t,i;E.Util.isANumber(e.width)&&E.Util.isANumber(e.height)&&e.staticResource&&(t=this.createIconContainer(e),i=this.createIconLogo(e.staticResource),e.iconClickThroughURLTemplate?((e=this.createIconAnchor(e.iconClickThroughURLTemplate)).appendChild(i),t.appendChild(e)):t.appendChild(i),"VIDEO"===this.playerEl.nodeName?this.playerEl.parentNode&&"function"==typeof this.playerEl.parentNode.insertBefore&&this.playerEl.parentNode.insertBefore(t,this.playerEl.nextSibling):this.playerEl.appendChild(t),E.Util.addListener(t,"click",u,"iconClickListener"+this.iconNodes.length),this.iconNodes.push(t),E.HCP.adIconRendered=!0)},e.prototype.calculateLeft=function(e,t){if("string"==typeof e&&"left"===e.toLowerCase())return"0px";e=this.playerEl.offsetWidth||this.playerEl.clientWidth||0;return Number(e)-Number(t)+"px"},e.prototype.calculateTop=function(e,t){if("string"==typeof e&&"top"===e.toLowerCase())return"0px";e=this.playerEl.offsetHeight||this.playerEl.clientHeight||0;return Number(e)-Number(t)+"px"},e.prototype.adjustIconPostionOnResize=function(){if(null!==this.iconNodes&&0!==this.iconNodes.length)for(var e=0;e<this.iconNodes.length;e++){var t=this.iconNodes[e];"0px"!==t.style.left&&(t.style.left=this.calculateLeft(null,t.style.width.slice(0,-2))),"0px"!==t.style.top&&(t.style.top=this.calculateTop(null,t.style.height.slice(0,-2)))}},e.prototype.vpaidEventSubscription=function(e){switch(e.type){case E.VPAIDevents.AdVideoStart:this.iconsCreated||this.init();break;case E.VPAIDevents.AdSizeChange:this.iconsCreated&&this.adjustIconPostionOnResize();break;case E.VPAIDevents.AdVideoComplete:case E.VPAIDevents.AdStopped:case E.VPAIDevents.AdSkipped:case E.VPAIDevents.AdError:this.cleanUpCalled||this.cleanUp()}},e.prototype.cleanUp=function(){this.subscription.remove();for(var e=0;e<this.iconNodes.length;e++){var t=this.iconNodes[e];E.Util.removeListener(t,"click",u,"iconClickListener"+e);var i=t.parentNode;i&&i.removeChild&&i.removeChild(t)}this.playerEl=null,this.icons=null,this.iconNodes=null,this.cleanUpCalled=!0,E.ad._icons=!1},e);function e(e,t){this.iconNodes=[],this.icons=e,this.playerEl=t,this.iconsCreated=!1,this.cleanUpCalled=!1,this.subscription=E.Queue.subscribe("vpaid-events",this.vpaidEventSubscription.bind(this))}function u(e){return e.stopPropagation(),!1}var w=function(){var v={AdSkipped:"skip",AdStarted:"creativeView",AdVideoStart:"start",AdVideoFirstQuartile:"firstQuartile",AdVideoMidpoint:"midpoint",AdVideoThirdQuartile:"thirdQuartile",AdVideoComplete:"complete",AdUserAcceptInvitation:"acceptInvitation",AdUserMinimize:"collapse",AdUserClose:"close",AdPaused:"pause",AdPlaying:"resume",AdError:"error",AdProgress:"progress"};function g(e,t){return t&&e&&e[t]?e[t]:[]}return ProgressEventDetails=function(e,t,i){this.urls=e,this.format=t,this.value=i},(w=function(e,t,i,n,r,s){this.trackingEvents=e,this.impressionURLs=t,this.scrURLS=E.Util.getScrUrls(),this.errorURLs=i,this.clicktrackingURLs=n,this.customTrackingEvents=s,this.lastVolume=!1,this.surveys=r,this.init()}).prototype.init=function(){var m=this;m.progressEvents=function(e){var t,i={},n=/progress-([0-9]+)/;for(t in e)if(-1<E.Util.indexOf(t,"progress")){var r=t.match(n);if(!r||r.length<2)continue;var s=e[t],r=r[1];-1<E.Util.indexOf(t,"%")?i[t]=new ProgressEventDetails(s,"percentage",parseFloat(r/100)):i[t]=new ProgressEventDetails(s,"number",parseFloat(r))}return i}(this.trackingEvents),E.Queue.subscribe("internal-events",function(e){m.lastVolume=e.volume}),E.Queue.subscribe("vpaid-events",function(e){var t,i=!1;switch(e.type){case E.VPAIDevents.AdImpression:m.handleSurveys(),c=m.impressionURLs,i=!0;break;case E.VPAIDevents.AdVolumeChange:var n=E.underlyingAsset&&E.underlyingAsset.getAdVolume();"number"==typeof m.lastVolume&&"number"==typeof n&&(0===n&&0<m.lastVolume?u="mute":0<n&&0===m.lastVolume&&(u="unmute")),m.lastVolume=n,u&&(c=m.trackingEvents[u]);break;case E.VPAIDevents.AdClickThru:c=m.clicktrackingURLs;break;case E.VPAIDevents.AdError:c=m.errorURLs;break;case E.VPAIDevents.AdProgress:var r,s=[];for(r in m.progressEvents){var a,o,l=m.progressEvents[r],d=e.time;"percentage"==l.format?(a=-2!=E.underlyingAsset.getAdDuration(),o=l.value*E.underlyingAsset.getAdDuration(),a&&o<d&&(s=s.concat(l.urls),delete m.progressEvents[r])):d>l.value&&(s=s.concat(l.urls),delete m.progressEvents[r])}c=s;break;default:var u=v[e.type],c=g(m.trackingEvents,u).concat(g(m.customTrackingEvents,u))}if(c)for(var p=c.length-1;0<=p;p--)if("string"==typeof(t=c[p]))try{(new Image).src=t}catch(e){}if(i)for(var h=m.scrURLS,f=h.length-1;0<=f;f--)E.Util.addScriptToDOM(h[f],E.ad._domElToTrack)})},w.prototype.handleSurveys=function(){if(this.surveys&&E.ad._domElToTrack)for(var e,t=E.ad._domElToTrack,i=this.surveys,n=!1,r=0;r<i.length;r++)if("js"===function(e){var t="";{var i;t=e.type?(i=e.type.split("/"),"javascript"===i[i.length-1]?"js":"pixel"):(e=e.url.match(/([^/&?#]+)(?:$|#|\?)/i),e=e&&2===e.length&&e[1],e=e&&e.split("."),e&&e[e.length-1])}return"js"===t?"js":"pixel"}(e=i[r])){var s,a;if(n||(s=(l=E.Util.getDocAndWinOfEl(t)).elDoc,a=l.elWin,n=!0),!a)continue;var o=s.createElement("script");o.src=e.url,o.type="text/javascript";var l=E.Util.getParentNode(t)||t;l.insertBefore(o,l.childNodes[0]||null)}else(new Image).src=e.url},w},c=function(){function e(){}return e.prototype.request=function(e){var t=this,i=!1;e&&e.match("ad.doubleclick.net")&&(i=!0),DMVAST.client.get(e,{withCredentials:i},E.Util.makeSafe(function(e){e?t.extractStuff(e):E.Util.fireError("no VAST tag response",!0)}))},e.prototype.extractStuff=function(e){var t=["progressive"];if(e&&e.ads&&0!==e.ads.length){var i={linearCreatives:[],companions:[]},n=e.ads[0];n.id&&"null"!==n.id&&E.Queue.publish("moatapi-events",{property:"zMoatAdId",value:n.id});e=n&&n.creatives&&n.creatives[0]&&n.creatives[0].videoClickThroughURLTemplate;e&&E.Queue.publish("moatapi-events",{property:"zMoatClickThrough",value:e});for(var r=n.creatives,s=0;s<r.length;s++){var a=r[s];switch(a.type){case"linear":for(var o={duration:a.duration,adParameters:a.adParameters,trackingEvents:a.trackingEvents,clickthroughURL:a.videoClickThroughURLTemplate,clicktrackingURLs:a.videoClickTrackingURLTemplates,vpaid:[],videos:[],skipoffset:a.skipDelay,icons:a.icons},l=a.mediaFiles,d=0;d<l.length;d++){var u,c,p=l[d];p&&p.fileURL&&(u=p.mimeType.toLowerCase(),c=p.deliveryType.toLowerCase(),"VPAID"!==p.apiFramework||"application/javascript"!==u&&"application/x-javascript"!==u||!E.Util.arrayContains(t,c)||o.vpaid.push(p),E.Util.arrayContains(t,c)&&o.videos.push(p))}i.linearCreatives.push(o),n.creativeId||function(e,t){var i,n;for(n in t)"id"===n.toLowerCase()?e.creativeId=t[n]:"adid"===n.toLowerCase()&&(i=t[n]);e.creativeId?i&&(e.creativeAdId=i):i&&(e.creativeId=i),e.creativeId&&E.Queue.publish("moatapi-events",{property:"zMoatCreativeId",value:e.creativeId}),e.creativeAdId&&E.Queue.publish("moatapi-events",{property:"zMoatCreativeAdId",value:e.creativeAdId})}(n,a.attributes);break;case"companion":for(var h=0;h<a.variations.length;h++)i.companions.push(a.variations[h])}}var f,m,v=i.linearCreatives.length;if(1===v)f=i.linearCreatives[0];else for(s=0;s<v;s++){var g=i.linearCreatives[s];if(0<g.videos.length||0<g.vpaid.length){f=g;break}}if(f||E.Util.fireError("No suitable assets found",!0),f.customTrackingEvents=function(){var e,t=n.extensions,a={};for(e in t)!function e(t){if(void 0!==t.children&&0!==t.children.length)for(var i=t.children,n=0;n<i.length;n++){var r,s;"Tracking"===i[n].name&&(r=i[n].attributes.event,s=i[n].value,a[r]=[s]),e(i[n])}}(t[e]);return a}(),E.TrackerManager=w(),new E.TrackerManager(f.trackingEvents,n.impressionURLTemplates,n.errorURLTemplates,f.clicktrackingURLs,n.surveys,f.customTrackingEvents),0<i.companions.length){E.HCP.companionAdAvailable=!0,E.CompanionLoader=(_.prototype.loadCompanion=function(r,s,c,p,a,e,o,l){var h=this;function d(e,t,i,n,r,s,a,o){o=o||[];for(var l,d="",u=0;u<o.length;u++)d+='<img src="'+o[u]+'" style="display:none" width="1" height="1">';return"StaticResource"===r&&("img"==s&&(l='<img src="'+t+'" width="'+i+'" height="'+n+'">',d+=a?'<a href="'+a+'" target="_blank">'+l+"</a>":l),"swf"==s&&(d+='<object type="application/x-shockwave-flash" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/sho ckwave/cabs/flash/swflash.cab#version=8,0,0,0" width="'+i+'" height="'+n+'" id="companion'+((s=b.floor(1e7*b.random()))-1)+'"><param name="allowScriptAccess" value="always" /><param name= "movie" value="'+t+'" />'+(a?'<param name="FlashVars" value="clickTag='+encodeURIComponent(a)+'" />':"")+'<param name="wmode" value="opaque" /><embed type="application/x-shockwave-flash" src="'+t+'" '+(a?'flashvars="clickTag='+encodeURIComponent(a)+'" ':"")+'wmode="opaque" width="'+i+'" height="'+n+'" id="companion'+s+'"name="companion'+s+'"allowscriptaccess="always" /></object>')),"IFrameResource"===r&&(d+="<iframe style='border:0px; padding:0px; margin:0px;' width='"+i+"' height='"+n+"' frameborder='no' scrolling='no' marginheight='0' marginwidth='0' src='"+t+"'></iframe>"),"HTMLResource"===r&&(d+=t,e&&(i&&(e.style.width=i+"px"),n&&(e.style.height=n+"px"))),E.HCP.companionAdRendered=!0,d}s=h.availableTypesMap[s];var u=!1;function t(){if(u)return!0;try{var e=s,t=function(n,r){var e,d="moatCompanionDiv_"+c+"x"+p;function t(e){var t=[],i=e.getElementById(d);i&&t.push(i);for(var n,r=0,s=h.availableResources.length;r<s;r++){if("StaticResource"==h.availableResources[r])for(var a=0,o=h.availableTypes.length;a<o;a++){var l=e.getElementById(d+"_"+h.availableResources[r]+"_"+h.availableTypes[a]);l&&t.push(l)}else n=e.getElementById(d+"_"+h.availableResources[r]);n&&t.push(n)}return 0<t.length&&t}function i(e){if(!e||0==e.length)return!1;if(1==e.length)return e[0];for(var t=0,i=e.length;t<i;t++)if(r){if(e[t].id===d+"_"+n+"_"+r)return e[t]}else if(e[t].id===d+"_"+n)return e[t];return!1}try{e=i(t(document))||i(t(window.top.document))}catch(e){}if(e)return e;var s=[];try{for(var a=window.frames,o=0,l=a.length;o<l;o++){try{var u=t(a[o].document)}catch(e){}u&&(s=s.concat(u))}}catch(e){}return i(s)||!1}(r,e);if(!t)return!1;if("DIV"!==t.nodeName){var i=t;i.id="";var n=E.Util.getParentNode(i);if(!n)return!1;t=document.createElement("div"),E.Util.addTagSafely(t,n)}else t.id="";t.innerHTML=d(t,a,c,p,r,e,o,l)}catch(e){return!1}return!0}var i,n,f,m=t();return m||(setTimeout(function(){!function e(t,i,n,r){r<=n||t()||(n++,setTimeout(function(){e(t,i,n,r)},i))}(t,500,0,10)},500),n="message",f=function(e){var t,i;u||"string"==typeof e.data&&(i=e.data.match(/^zMoatPlaceholder#([0-9]+)x([0-9]+)$/))&&(t=i[1],i=i[2],t==c&&i==p&&(u=function(e){try{var t=d(null,a,c,p,r,s,o,l);e.postMessage("zMoatAdContent#"+t,"*")}catch(e){return!1}return!0}(e.source)))},(i=window).addEventListener?i.addEventListener(n,f,!1):i.attachEvent("on"+n,f)),m},_);for(var y=new E.CompanionLoader,A=0;A<i.companions.length;A++){var k,T,C=i.companions[A];C.htmlResource?(k="HTMLResource",T=C.htmlResource):C.iframeResource?(k="IFrameResource",T=C.iframeResource):C.staticResource&&(k="StaticResource",T=C.staticResource),y.loadCompanion(k,C.type,C.width,C.height,T,!1,C.companionClickThroughURLTemplate,C.trackingEvents.creativeView)}}if(0<f.vpaid.length)return E.underlyingTagType="vpaid",E.VpaidPlayer=L(),void(m=new E.VpaidPlayer).init(f.vpaid[0],f.adParameters,f.duration,i.companions,f.icons,f.clickthroughURL);0<f.videos.length?(E.Queue.publish("vpaid-events",{type:"moat_DURATION_DEBUG",args:["mediafile","video"]}),E.Queue.publish("vpaid-events",{type:"moat_DURATION_DEBUG",args:["vast-duration",f.duration]}),E.VideoPlayer=U(),m=new E.VideoPlayer,(E.underlyingAsset=m).init(f.videos,f.duration,f.clickthroughURL,i.companions,f.skipoffset,f.icons)):E.Util.fireError("No suitable assets found",!0)}else E.Util.fireError("problem parsing underlying VAST, missing <ad> nodes");function _(){this.availableResources=["StaticResource","IFrameResource","HTMLResource"],this.availableTypesMap={"image/gif":"img","image/jpeg":"img","image/png":"img","application/x-javascript":"js","application/x-shockwave-flash":"swf"},this.availableTypes=["swf","img"]}},e},U=function(){function e(){function e(e){this.skipContainer,this.textContainer,this.iconContainer,this.skipIconUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAALGPC/xhBQAAAKBJREFUOBFjYBgFsBD4////TCBmg/Hx0UB1FUD8CYi7cKoDSoLAMSCWxKkIKgFU8xSkGAh+4VQLkQeTz4CkJU6FQAmg/CuYepzqYAqg9E8gnYZLMVCOZANh5mMNV0oMBBmMEa6UGggyFCVckQ1kwhUuVBcHOQMHoKqXqRYpVE02KBGALWyBQUN0OsQILxwGEpX1sIYXDgNhhUM3NvlhLgYAYuCVi7Jf+AUAAAAASUVORK5CYII=",this.init(e)}this._videoEl,this._adIsStarted,this._firstQuartileTime,this._firstQuartileReached,this._midpointTime,this._midpointReached,this._thirdQuartileTime,this._thirdQuartileReached,this._videoIsCompleted,this._lastViewMode,this._originalSlotCursorStyle,this._originalVideoSlotCursorStyle,this._pauseAdOnClickThru=!0,this._clickthroughURL,this._lastClickTime,this._skipoffset,this._cleanupCalled,this._durationConfirmed=!1,this._adLinear=!0,this._adWidth=E.ad._width,this._adHeight=E.ad._height,this._adExpanded=!1,this._adSkippableState=!1,this._adRemainingTime=-2,this._adDuration=-2,this._adVolume=1,this._adCompanions="",this._adIcons=!1,this._skipButtonModule=(e.prototype.init=function(e){this.createContainer(),this.createTextContainer(),this.createIconContainer(),e.appendChild(this.skipContainer),this.updateButtonTextSubscription=E.Queue.subscribe("skip-button",this.updateButtonText.bind(this)),E.Queue.subscribe("vpaid-events",this.addClickHandler.bind(this)),E.HCP.skipButtonRendered=!0},e.prototype.createContainer=function(){this.skipContainer=document.createElement("div"),this.skipContainer.style.background="rgba(0,0,0,0.8)",this.skipContainer.style.color="#ffffff",this.skipContainer.style.fontSize="11px",this.skipContainer.style.fontFamily="arial,sans-serif",this.skipContainer.style.position="absolute",this.skipContainer.style.textAlign="center",this.skipContainer.style.right="0px",this.skipContainer.style.bottom="10%",this.skipContainer.style.padding="2%",this.skipContainer.style.cursor="default",E.Util.addListener(this.skipContainer,"click",this.stopEventPropagation,"stopEvtPropagationFn")},e.prototype.createTextContainer=function(){this.textContainer=document.createElement("span"),this.textContainer.style.verticalAlign="middle",this.skipContainer.appendChild(this.textContainer)},e.prototype.createIconContainer=function(){this.iconContainer=document.createElement("img"),this.iconContainer.style.display="none",this.iconContainer.style.verticalAlign="middle",this.iconContainer.setAttribute("src",this.skipIconUrl),this.skipContainer.appendChild(this.iconContainer)},e.prototype.updateButtonText=function(e){this.textContainer&&this.iconContainer&&this.skipContainer&&(0<e.timeLeft?this.textContainer.innerHTML="you can skip this ad in "+e.timeLeft:(this.textContainer.innerHTML="Skip Ad",this.textContainer.style.fontSize="18px",this.iconContainer.style.display="inline",this.updateButtonTextSubscription.remove(),this.skipContainer.style.cursor="pointer"))},e.prototype.skipAd=function(){E.underlyingAsset&&E.underlyingAsset.skipAd()},e.prototype.addClickHandler=function(e){e.type===E.VPAIDevents.AdSkippableStateChange&&(E.Util.addListener(this.skipContainer,"click",this.skipAd,"skipClickHandlerFn"),E.Util.removeListener(this.skipContainer,"click",this.stopEventPropagation,"stopEvtPropagationFn"))},e.prototype.stopEventPropagation=function(e){"function"==typeof e.stopPropagation&&e.stopPropagation()},e.prototype.cleanUp=function(){this.updateButtonTextSubscription.remove(),this.skipContainer.parentNode.removeChild(this.skipContainer),this.skipContainer=null,this.textContainer=null,this.iconContainer=null},e),this._skipButtonManager,this._icons,this._iconManager}function r(e){return"string"==typeof e.message&&""!==e.message?e.message:!e.target||!e.target.error||"string"!=typeof e.target.error.message||""===e.target.error.message?"unknown error triggered by player":e.target.error.message}return e.prototype.init=function(e,t,i,n,r,s){this._videoEl=E.ad._videoSlot,this._adDuration=this._adRemainingTime=t,this._mediaFile=this.pickMediaFile(e),this._skipoffset=function(){var e=r;if(E.Util.isANumber(e))return e;e=parseInt(E.qs.skip,10);if(E.Util.isANumber(e))return e;e=parseInt(E.qs.zMoatSkip,10);return E.Util.isANumber(e)?e:null}();t=E&&E.ad&&E.ad._slot,e=E&&E.ad&&E.ad._videoSlot;t&&t.style&&(this._originalSlotCursorStyle=t.style.cursor,t.style.cursor="pointer"),e&&e.style&&(this._originalVideoSlotCursorStyle=e.style.cursor,e.style.cursor="pointer"),void 0!==this._videoEl.volume&&"number"==typeof this._videoEl.volume&&(this._adVolume=this._videoEl.volume),E.Queue.publish("internal-events",{volume:this._adVolume}),this._clickthroughURL=i,this._lastViewMode=E.ad._viewMode,this._adCompanions=E.Util.createXMLcompanionNode(n),this._icons=s,this.onAdClickHandler=this.onAdClick.bind(this),this.onErrorHandler=this.videoErrorHandlerFn,this.createListeners(),"1"===E.qs.noctp&&(this._pauseAdOnClickThru=!1);s=this._videoEl;this.setVideoElSrc(this._mediaFile),s.load(),E.Util.addListener(s,"canplay",this.publishAdLoaded,"publishAdLoadedFn"),this._adDuration&&(this.determineQuartiles(),E.Queue.publish("moat-tag",{videoElement:E.ad._domElToTrack,duration:this._adDuration}))},e.prototype.publishAdLoaded=function(){E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdLoaded}),E.Util.removeListener(E.underlyingAsset._videoEl,"canplay",this.publishAdLoaded,"publishAdLoadedFn")},e.prototype.resizeAd=function(e,t,i,n){var r=(i="string"==typeof i?i.toLowerCase():i)&&"fullscreen"===i,s="number"==typeof e&&"number"==typeof t&&!isNaN(e)&&!isNaN(t),i=!r&&s;!r&&!s||i&&!this._videoEl||(i&&(this._adHeight=t,this._adWidth=e,this._videoEl.width=e,this._videoEl.height=t),n&&E.ad._slot&&(E.ad._slot.style.width=e+"px",E.ad._slot.style.height=t+"px"),E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdSizeChange}))},e.prototype.playVideoEl=function(e){var t=this._videoEl.play();return E.Util.isPromise(t)?t.then(e).catch(this.onErrorHandler):(e(),null)},e.prototype.playVideoElandFireStartEvents=function(){var e=this._videoEl,t=!1,i=!1;function n(){this._adIsStarted||(this._adIsStarted=!0,this._adTimeFrequency=0,this.timer(),E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdStarted}),E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdImpression}),E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdVideoStart}))}function r(){i&&t&&(E.Util.removeListener(e,"playing",s,"videoPlayingHandlerFn"),n())}function s(){t=!0,r()}n=n.bind(this),E.Util.addListener(e,"playing",s,"videoPlayingHandlerFn"),this.playVideoEl(function(){i=!0,r()})},e.prototype.startAd=function(){var e;this._adIsStarted||(E.ad&&E.ad._slot&&((e="function"==typeof window.getComputedStyle&&window.getComputedStyle(E.ad._slot)||E.ad._slot.style||E.ad._slot.currentStyle)&&E.ad._width&&E.ad._height&&("0px"==e.width&&0<E.ad._width||"0px"==e.height&&0<E.ad._height)&&this.resizeAd(E.ad._width,E.ad._height,E.ad._viewMode||"normal",!0)),E.Util.isANumber(this._skipoffset)?(this._skipButtonManager=new this._skipButtonModule(E.ad._slot),E.HCP.skipButtonAvailable=!0):this._skipButtonManager=null,this.playVideoElandFireStartEvents(),this._icons&&this._icons.length&&(this._iconManager=new d(this._icons,E.ad._domElToTrack),this._adIcons=!0,E.HCP.adIconAvailable=!0))},e.prototype.stopAd=function(){this.cleanUp(),E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdStopped})},e.prototype.pauseAd=function(){this._videoEl.paused||(this._videoEl.pause(),E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdPaused}))},e.prototype.resumeAd=function(){this.playVideoEl(function(){E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdPlaying})})},e.prototype.skipAd=function(){this.cleanUp(),E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdSkipped}),E.Util.setSafeTimeout(function(){E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdStopped})},400)},e.prototype.getAdLinear=function(){return this._adLinear},e.prototype.getAdCompanions=function(){return this._adCompanions},e.prototype.getAdExpanded=function(){return this._adExpanded},e.prototype.getAdHeight=function(){return this._adHeight},e.prototype.getAdWidth=function(){return this._adWidth},e.prototype.getAdVolume=function(){var e=1,t=this._videoEl.volume,i=this._adVolume;return this._videoEl.muted?e=0:"number"!=typeof t||isNaN(t)?"number"!=typeof i||isNaN(i)||(e=i):e=t,e},e.prototype.setAdVolume=function(e){this._adVolume=e,"number"==typeof this._videoEl.volume&&(this._videoEl.volume=e),E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdVolumeChange})},e.prototype.getAdRemainingTime=function(){return this._adDuration-this._videoEl.currentTime},e.prototype.getAdDuration=function(){return this._adDuration},e.prototype.getAdIcons=function(){return this._adIcons},e.prototype.getAdSkippableState=function(){return this._adSkippableState},e.prototype.setVideoElSrc=function(e){e&&"string"==typeof e.fileURL&&e.fileURL.length?this._videoEl.src=e.fileURL:E.Util.fireError("Invalid mediaFile or mediaFile fileUrl",!0)},e.prototype.pickMediaFile=function(e){for(var n=this._adWidth*this._adHeight,t=function(e){var t={};t.bitrateRange=e.bitrate<5e3?0:1,t.canPlayType="probably"===this._videoEl.canPlayType(e.mimeType)?0:1;var i=e.width*e.height;return t.sizeDiff=b.abs(n-i),t.bitrate=e.bitrate,t.mediaFile=e,t}.bind(this),i=[],r=0;r<e.length;r++){var s=e[r];""!==this._videoEl.canPlayType(s.mimeType)&&(s=t(s),i.push(s))}return 0===i.length&&E.Util.fireError("There are no valid mediaFiles in underlying VAST tag",!0),i.sort(function(e,t){var i=e.bitrateRange-t.bitrateRange;if(0!=i)return i;i=e.canPlayType-t.canPlayType;if(0!=i)return i;i=e.sizeDiff-t.sizeDiff;return 0!=i?i:t.bitrate-e.bitrate}),i[0].mediaFile},e.prototype.onAdClick=function(){var e=(new a).getTime();void 0!==this._lastClickTime&&e-this._lastClickTime<100||(this._lastClickTime=e,void 0!==this._adIsStarted?this._videoEl.paused?this.resumeAd():(E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdClickThru,args:[this._clickthroughURL,null,!0]}),this._pauseAdOnClickThru&&this.pauseAd()):this.startAd())},e.prototype.videoErrorHandlerFn=function(n){var e=function(){var e=r(n);if("unknown error triggered by player"!==e){var t,i=["request is not allowed by the user agent or the platform in the current context","can only be initiated by a user gesture"];for(t in i)if(E.Util.arrayContains(e,i[t]))return 1}}()?"Autoplay attempted and is not allowed":r(n);E.Util.fireError(e,!0)},e.prototype.createListeners=function(){E.Util.addListener(E.ad._slot,"click",this.onAdClickHandler,"slotClickHandlerFn"),E.Util.addListener(E.ad._videoSlot,"click",this.onAdClickHandler,"videoSlotClickHandlerFn"),E.Util.addListener(this._videoEl,"error",this.onErrorHandler,"videoErrorHandlerFn")},e.prototype.determineQuartiles=function(){var e=this._adDuration/4;this._firstQuartileTime=0+e,this._midpointTime=this._firstQuartileTime+e,this._thirdQuartileTime=this._midpointTime+e},e.prototype.onConfirmDuration=function(e){if(!this._adDuration&&0!==this._adDuration){if(!E.ad._domElToTrack)return E.Util.fireError("no video element to track",!0),!1;E.Queue.publish("moat-tag",{videoElement:E.ad._domElToTrack,duration:e})}this._adDuration=e,this.determineQuartiles(),this._durationConfirmed=!0,E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdDurationChange,args:[e]})},e.prototype.confirmDuration=function(){var e;this._durationConfirmed||"number"==typeof(e=this._videoEl&&this._videoEl.duration)&&!isNaN(e)&&0<e&&this.onConfirmDuration(b.round(e))},e.prototype.timer=function(){var e,t=(e=this,function(){e.confirmDuration(),e._adDuration&&e.progressWatcher()});E.Util.setSafeLoop(t,[],500)},e.prototype.progressWatcher=function(){this._skipButtonManager&&!this._adSkippableState&&this._videoEl.currentTime>this._skipoffset&&(this._adSkippableState=!0,E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdSkippableStateChange})),E.Queue.publish("skip-button",{timeLeft:b.max(b.round(this._skipoffset-this._videoEl.currentTime),0)}),this._adIsStarted&&!this._firstQuartileReached&&this._videoEl.currentTime>this._firstQuartileTime?(this._firstQuartileReached=!0,E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdVideoFirstQuartile})):this._adIsStarted&&this._firstQuartileReached&&!this._midpointReached&&this._videoEl.currentTime>this._midpointTime?(this._midpointReached=!0,E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdVideoMidpoint})):this._adIsStarted&&this._firstQuartileReached&&this._midpointReached&&!this._thirdQuartileReached&&this._videoEl.currentTime>this._thirdQuartileTime?(this._thirdQuartileReached=!0,E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdVideoThirdQuartile})):this._adIsStarted&&this._firstQuartileReached&&this._midpointReached&&this._thirdQuartileReached&&!this._videoIsCompleted&&(this._videoEl.currentTime>=this._adDuration||this._videoEl.ended)&&(this.cleanUp(),this._videoIsCompleted=!0,E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdVideoComplete}),E.Util.setSafeTimeout(function(){E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdStopped})},400)),this._adIsStarted&&!this._videoIsCompleted&&E.Queue.publish("vpaid-events",{type:E.VPAIDevents.AdProgress,time:this._videoEl.currentTime})},e.prototype.cleanUp=function(){this._cleanupCalled||(this._cleanupCalled=!0,E.Util.removeListener(this._videoEl,"playing",function(){},"videoPlayingHandlerFn"),E.Util.removeListener(E.ad._slot,"click",this.onAdClickHandler,"slotClickHandlerFn"),E.Util.removeListener(E.ad._videoSlot,"click",this.onAdClickHandler,"videoSlotClickHandlerFn"),E.Util.removeListener(this._videoEl,"error",this.onErrorHandler,"videoErrorHandlerFn"),E.Util.removeListener(this._videoEl,"canplay",this.publishAdLoaded,"publishAdLoadedFn"),E.ad._slot.style&&(E.ad._slot.style.cursor=this._originalSlotCursorStyle),E.ad._videoSlot.style&&(E.ad._videoSlot.style.cursor=this._originalVideoSlotCursorStyle),this._skipButtonManager&&this._skipButtonManager.cleanUp(),this._adIcons=!1)},e},L=function(){return(L=function(){this._iframe,this._adCompanions,this._lastAdVolume,this._adParameters,this._icons,this._iconManager,this._clickthroughURL}).prototype.init=function(e,t,i,n,r,s){var a,o=b.random()+"";window["moatstartvpaid"+o]=this.startVPAID.bind(this),window["moatstartvpaiderr"+o]=this.handleError.bind(this),e&&e.fileURL&&e.fileURL.match(/^https?:\/\/(s0\.2mdn\.net|imasdk\.googleapis\.com)/)?((a=document.createElement("script")).type="text/javascript",a.onload=function(){window["moatstartvpaid"+o]()},a.onerror=function(){window["moatstartvpaiderr"+o]()},a.src=e.fileURL,E.Util.addTagSafely(a,document.body)):(a=document.createElement("iframe"),(this._iframe=a).style.display="none",document.body.appendChild(a),e='<html><head><body><script>function startVPAID() {window.parent["moatstartvpaid'+o+'"]();};function errVPAID() {window.parent["moatstartvpaiderr'+o+'"]();};<\/script><script onerror="errVPAID();" onload="startVPAID();" src="'+e.fileURL+'"><\/script></body></head></html>',a.contentWindow.moatsrc=e,a.src="javascript:window.moatsrc"),this._adCompanions=n,this._adParameters=t,this._icons=r,this._clickthroughURL=s,E.Queue.publish("moat-tag",{videoElement:E.ad._domElToTrack,duration:i})},L.prototype.handleError=function(){E.Util.fireError("no VPAID response",!0)},L.prototype.wrapGetAdCompanions=function(){var e=this,t=this._vpaid.getAdCompanions;this._vpaid.getAdCompanions=function(){return 0<e._adCompanions.length?E.Util.createXMLcompanionNode(e._adCompanions):t?t.call(e._vpaid):""}},L.prototype.createCallbacks=function(){var t,e={},i=this;for(t in E.VPAIDevents){var n=function(){var e=t;return function(){"AdClickThru"===e&&arguments&&!arguments[0]&&(arguments[0]=i._clickthroughURL),E.Queue.publish("vpaid-events",{type:e,args:arguments})}}();e[t]=n}return e},L.prototype.startVPAID=function(){var r=this,s=!1,a=0,o=r._iframe?r._iframe.contentWindow:window;E.Util.setSafeLoop(function(){if(20<++a||s)return r.handleError(),!1;var e=o.getVPAIDAd&&"function"==typeof o.getVPAIDAd&&o.getVPAIDAd();if(e){r._vpaid=e,s=!0,e.handshakeVersion(E.version);var t,i=r.createCallbacks();for(t in i)e.subscribe(i[t],t);r.wrapGetAdCompanions(),E.underlyingAsset=e;var n={AdParameters:r._adParameters};return e.initAd(E.ad._width,E.ad._height,E.ad._viewMode,E.ad._desiredBitrate,n,E.ad._environmentVars),e.getAdIcons&&e.getAdIcons()||!r._icons||!r._icons.length||(this._iconManager=new d(r._icons,E.ad._domElToTrack),E.HCP.adIconAvailable=!0),function(e){var t;try{t=e.getAdVolume()}catch(e){t=-1}E.Queue.publish("internal-events",{volume:t})}(e),!1}},[],100)},L}}(Date,Math)}catch(e){try{var t=e.name+" in VPAID wrapper global t/c: "+e.message+", stack="+e.stack,i="//px.moatads.com/pixel.gif?e=24&d=data%3Adata%3Adata%3Adata&i="+encodeURIComponent("TRADEDESKVIDEO1")+"&rp=1&gw=thetradedeskvideo910663478306&ac=1&k="+encodeURIComponent(t)+"&ar="+encodeURIComponent("5103f31-clean")+"&iw="+encodeURIComponent("eb0ec0b")+"&j="+encodeURIComponent(document.referrer)+"&cs="+(new Date).getTime();(new Image).src=i}catch(e){}}}(),function(){try{e=function(){return function n(r,s,a){function o(t,e){if(!s[t]){if(!r[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw new Error("Cannot find module '"+t+"'")}i=s[t]={exports:{}};r[t][0].call(i.exports,function(e){return o(r[t][1][e]||e)},i,i.exports,n,r,s,a)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)o(a[e]);return o}({1:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function l(e){return"object"==typeof e&&null!==e}function d(e){return void 0===e}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,r,s,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(d(i=this._events[e]))return!1;if(o(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,r=new Array(n-1),s=1;s<n;s++)r[s-1]=arguments[s];i.apply(this,r)}else if(l(i)){for(n=arguments.length,r=new Array(n-1),s=1;s<n;s++)r[s-1]=arguments[s];for(n=(a=i.slice()).length,s=0;s<n;s++)a[s].apply(this,r)}return!0},n.prototype.on=n.prototype.addListener=function(e,t){if(!o(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?l(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,!l(this._events[e])||this._events[e].warned||(t=d(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<t&&this._events[e].length>t&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){if(!o(t))throw TypeError("listener must be a function");var i=!1;function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var i,n,r,s;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=(i=this._events[e]).length,n=-1,i===t||o(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(l(i)){for(s=r;0<s--;)if(i[s]===t||i[s].listener&&i[s].listener===t){n=s;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(o(i=this._events[e]))this.removeListener(e,i);else for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.listenerCount=function(e,t){return e._events&&e._events[t]?o(e._events[t])?1:e._events[t].length:0}},{}],2:[function(e,t,i){t.exports=function(){this.id=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[],this.surveys=[]}},{}],3:[function(e,t,a){var o,i,n;function r(){}o=e("./parser"),e=e("./util"),r.cappingFreeLunch=0,r.cappingMinimumTimeInterval=0,r.options={withCredentials:!1,timeout:0},r.get=function(e,t,i){var n,r=+new Date,s=a.extend=function(e,t){var i,n;for(i in t)n=t[i],e[i]=n;return e};if(i||("function"==typeof t&&(i=t),n={}),n=s(this.options,t),this.totalCallsTimeout<r?(this.totalCalls=1,this.totalCallsTimeout=36e5+r):this.totalCalls++,this.cappingFreeLunch>=this.totalCalls)i(null);else{if(!(r-this.lastSuccessfullAd<this.cappingMinimumTimeInterval))return o.parse(e,n,function(e){return i(e)});i(null)}},n=e.storage,i=Object.defineProperty,["lastSuccessfullAd","totalCalls","totalCallsTimeout"].forEach(function(t){i(r,t,{get:function(){return n.getItem(t)},set:function(e){return n.setItem(t,e)},configurable:!1,enumerable:!0})}),null==r.totalCalls&&(r.totalCalls=0),null==r.totalCallsTimeout&&(r.totalCallsTimeout=0),t.exports=r},{"./parser":12,"./util":19}],4:[function(e,t,i){t.exports=function(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.companionClickThroughURLTemplate=null,this.trackingEvents={}}},{}],5:[function(e,t,i){function n(e,t){for(var i in t)o.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e}var r,s,a,o={}.hasOwnProperty;function l(){l.__super__.constructor.apply(this,arguments),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[],this.videoCustomClickURLTemplates=[],this.adParameters=null,this.icons=[]}function d(){d.__super__.constructor.apply(this,arguments),this.type="nonlinear",this.variations=[],this.videoClickTrackingURLTemplates=[]}function u(){this.type="companion",this.variations=[],this.videoClickTrackingURLTemplates=[]}n(l,r=function(){this.trackingEvents={}}),s=l,n(d,r),a=d,n(u,r),t.exports={VASTCreativeLinear:s,VASTCreativeNonLinear:a,VASTCreativeCompanion:u}},{}],6:[function(e,t,i){t.exports=function(){this.attributes={},this.children=[]}},{}],7:[function(e,t,i){t.exports=function(e,t){this.name=e,this.value=t,this.attributes={},this.children=[]}},{}],8:[function(e,t,i){t.exports=function(){this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null}},{}],9:[function(e,t,i){t.exports={client:e("./client"),tracker:e("./tracker"),parser:e("./parser"),util:e("./util")}},{"./client":3,"./parser":12,"./tracker":15,"./util":19}],10:[function(e,t,i){t.exports=function(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null}},{}],11:[function(e,t,i){t.exports=function(){this.id=null,this.width=0,this.height=0,this.minSuggestedDuration="00:00:00",this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null}},{}],12:[function(e,t,i){var n,g,o,l,R,S,te,x,ie,ne,N,m,y,r,s,v=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function a(){}n=e("./urlhandler"),m=e("./response"),g=e("./ad"),o=e("./extension"),l=e("./extensionchild"),r=e("./util"),te=e("./creative").VASTCreativeLinear,S=e("./creative").VASTCreativeCompanion,x=e("./creative").VASTCreativeNonLinear,ne=e("./mediafile"),ie=e("./icon"),R=e("./companionad"),N=e("./nonlinear"),y=e("./survey"),e=e("events").EventEmitter,s=[],a.addURLTemplateFilter=function(e){"function"==typeof e&&s.push(e)},a.removeURLTemplateFilter=function(){return s.pop()},a.countURLTemplateFilters=function(){return s.length},a.clearUrlTemplateFilters=function(){return s=[]},a.parse=function(e,t,i){return i||("function"==typeof t&&(i=t),t={}),this._parse(e,null,t,function(e,t){return i(t)})},a.vent=new e,a.track=function(e,t){return this.vent.emit("VAST-error",t),r.track(e,t)},a.on=function(e,t){return this.vent.on(e,t)},a.once=function(e,t){return this.vent.once(e,t)},a._parse=function(c,p,h,f){var e,t,i,T;for(f||("function"==typeof h&&(f=h),h={}),t=0,i=s.length;t<i;t++)e=s[t],c=e(c);return(p=null==p?[]:p).push(c),n.get(c,h,(T=this,function(e,t){var r,A,i,n,k,s,a,o,l,d,u;if(null!=e)return f(e);if(k=new m,null==(null!=t?t.documentElement:void 0)||"VAST"!==t.documentElement.nodeName)return f();for(s=0,o=(d=t.documentElement.childNodes).length;s<o;s++)"Error"===(n=d[s]).nodeName&&k.errorURLTemplates.push(T.parseNodeText(n));for(a=0,l=(u=t.documentElement.childNodes).length;a<l;a++)"Ad"===(n=u[a]).nodeName&&(null!=(r=T.parseAdElement(n))?k.ads.push(r):T.track(k.errorURLTemplates,{ERRORCODE:101}));for(A=function(e){var t,i,n;if(null==e&&(e=!1),k){for(t=0,i=(n=k.ads).length;t<i;t++)if(null!=(r=n[t]).nextWrapperURL)return;return 0===k.ads.length&&(e||T.track(k.errorURLTemplates,{ERRORCODE:303}),k=null),f(null,k)}},i=k.ads.length;i--;)null!=(r=k.ads[i]).nextWrapperURL&&function(y){var e,t;10<=p.length||(t=y.nextWrapperURL,0<=v.call(p,t))?(T.track(y.errorURLTemplates,{ERRORCODE:302}),k.ads.splice(k.ads.indexOf(y),1),A()):(0===y.nextWrapperURL.indexOf("//")?(e=location.protocol,y.nextWrapperURL=""+e+y.nextWrapperURL):-1===y.nextWrapperURL.indexOf("://")&&(e=c.slice(0,c.lastIndexOf("/")),y.nextWrapperURL=e+"/"+y.nextWrapperURL),T._parse(y.nextWrapperURL,p,h,function(e,t){var i,n,r,s,a,o,l,d,u,c,p,h,f,m,v,g=!1;if(null!=e)T.track(y.errorURLTemplates,{ERRORCODE:301}),k.ads.splice(k.ads.indexOf(y),1),g=!0;else if(null==t)T.track(y.errorURLTemplates,{ERRORCODE:303}),k.ads.splice(k.ads.indexOf(y),1),g=!0;else for(k.errorURLTemplates=k.errorURLTemplates.concat(t.errorURLTemplates),r=k.ads.indexOf(y),k.ads.splice(r,1),l=0,d=(f=t.ads).length;l<d;l++){for((a=f[l]).errorURLTemplates=y.errorURLTemplates.concat(a.errorURLTemplates),a.impressionURLTemplates=y.impressionURLTemplates.concat(a.impressionURLTemplates),s=!0,p=0,u=(m=a.creatives).length;p<u;p++){if(i=m[p],null!=y.trackingEvents&&("linear"===i.type||"nonlinear"===i.type))for(h=0,c=(v=Object.keys(y.trackingEvents)).length;h<c;h++)n=v[h],(o=i.trackingEvents)[n]||(o[n]=[]),i.trackingEvents[n]=i.trackingEvents[n].concat(y.trackingEvents[n]);null!=y.videoClickTrackingURLTemplates&&("linear"!==i.type&&"nonlinear"!==i.type||(i.videoClickTrackingURLTemplates=i.videoClickTrackingURLTemplates.concat(y.videoClickTrackingURLTemplates))),y.tempCompanionAd&&"companion"===i.type&&(s=!1)}y.tempCompanionAd&&s&&a.creatives.push(y.tempCompanionAd),k.ads.splice(r,0,a)}return delete y.nextWrapperURL,A(g)}))}(r);return A()}))},a.childByName=function(e,t){for(var i,n,r=0,s=(n=e.childNodes).length;r<s;r++)if((i=n[r]).nodeName===t)return i},a.childsByName=function(e,t){for(var i,n,r=[],s=0,a=(n=e.childNodes).length;s<a;s++)(i=n[s]).nodeName===t&&r.push(i);return r},a.parseAdElement=function(e){for(var t,i,n,r=0,s=(i=e.childNodes).length;r<s;r++)if("Wrapper"===(n=(t=i[r]).nodeName)||"InLine"===n){if(t.setAttribute("id",e.getAttribute("id")),"Wrapper"===t.nodeName)return this.parseWrapperElement(t);if("InLine"===t.nodeName)return this.parseInLineElement(t)}},a.parseWrapperElement=function(e){var t,i,n,r,s,a,o=this.parseInLineElement(e);for(null!=(n=this.childByName(e,"VASTAdTagURI"))?o.nextWrapperURL=this.parseNodeText(n):null!=(n=this.childByName(e,"VASTAdTagURL"))&&(o.nextWrapperURL=this.parseNodeText(this.childByName(n,"URL"))),r=0,s=(a=o.creatives).length;r<s;r++)"linear"!==(t=a[r]).type&&"nonlinear"!==t.type||null!=(i=t)&&(null!=i.trackingEvents&&(o.trackingEvents=i.trackingEvents),null!=i.videoClickTrackingURLTemplates&&(o.videoClickTrackingURLTemplates=i.videoClickTrackingURLTemplates)),"companion"===t.type&&(o.tempCompanionAd=t);if(null!=o.nextWrapperURL)return o},a.parseInLineElement=function(e){var t,i,n,r,s,a,o,l,d,u,c,p,h,f,m,v;for((t=new g).id="function"==typeof e.getAttribute&&e.getAttribute("id"),l=0,c=(f=e.childNodes).length;l<c;l++)switch((a=f[l]).nodeName){case"Error":t.errorURLTemplates.push(this.parseNodeText(a));break;case"Impression":t.impressionURLTemplates.push(this.parseNodeText(a));break;case"Survey":(o=new y).type=a.getAttribute("type"),o.url=this.parseNodeText(a),t.surveys.push(o);break;case"Creatives":for(d=0,p=(m=this.childsByName(a,"Creative")).length;d<p;d++)for(r=m[d],i=this.storeNodeAttributes(r),u=0,h=(v=r.childNodes).length;u<h;u++)switch((s=v[u]).nodeName){case"Linear":(n=this.parseCreativeLinearElement(s))&&(n.attributes=i,t.creatives.push(n));break;case"NonLinearAds":(n=this.parseNonLinear(s))&&(n.attributes=i,t.creatives.push(n));break;case"CompanionAds":(n=this.parseCompanionAd(s))&&(n.attributes=i,t.creatives.push(n))}break;case"Extensions":this.parseExtension(t.extensions,this.childsByName(a,"Extension"))}return t},a.parseChildren=function(e,t){for(var i,n,r,s=[],a=0,o=(r=e.childNodes).length;a<o;a++)"#text"!==(i=r[a]).nodeName?((n=new l(i.nodeName,this.parseNodeText(i))).attributes=this.storeNodeAttributes(i),n?(t.children.push(n),null!=i.childNodes?s.push(this.parseChildren(i,n)):s.push(void 0)):s.push(void 0)):s.push(void 0);return s},a.parseExtension=function(e,t){for(var i,n,r=[],s=0,a=t.length;s<a;s++)i=t[s],(n=new o).attributes=this.storeNodeAttributes(i),this.parseChildren(i,n),r.push(e.push(n));return r},a.storeNodeAttributes=function(e){var t,i,n,r,s={};if(e.attributes)for(i=0,n=(r=e.attributes).length;i<n;i++)s[(t=r[i]).nodeName]=t.nodeValue;return s},a.parseCreativeLinearElement=function(e){var t,i,n,r,s,a,o,l,d,u,c,p,h,f,m,v,g,y,A,k,T,C,_,b,E,w,U,L,R,S,x,N,I,V,D,P,M,B,Q,F,H,O,W,j,q,z,G,X,Y,K,J,Z,$,ee;if((i=new te).duration=this.parseDuration(this.parseNodeText(this.childByName(e,"Duration"))),-1===i.duration&&"Wrapper"!==e.parentNode.parentNode.parentNode.nodeName)return null;if(null==(k=e.getAttribute("skipoffset"))?i.skipDelay=null:"%"===k.charAt(k.length-1)?(f=parseInt(k,10),i.skipDelay=i.duration*(f/100)):i.skipDelay=this.parseDuration(k),null!=(k=this.childByName(e,"VideoClicks"))){for(i.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(k,"ClickThrough")),C=0,w=(W=this.childsByName(k,"ClickTracking")).length;C<w;C++)t=W[C],i.videoClickTrackingURLTemplates.push(this.parseNodeText(t));for(_=0,U=(j=this.childsByName(k,"CustomClick")).length;_<U;_++)n=j[_],i.videoCustomClickURLTemplates.push(this.parseNodeText(n))}for(null!=(k=this.childByName(e,"AdParameters"))&&(i.adParameters=this.parseNodeText(k)),b=0,R=(z=this.childsByName(e,"TrackingEvents")).length;b<R;b++)for(y=z[b],E=0,S=(G=this.childsByName(y,"Tracking")).length;E<S;E++)if(r=(g=G[E]).getAttribute("event"),A=this.parseNodeText(g),null!=r&&null!=A){if("progress"===r){if(!(T=g.getAttribute("offset")))continue;r="%"===T.charAt(T.length-1)?"progress-"+T:"progress-"+Math.round(this.parseDuration(T))}null==(T=i.trackingEvents)[r]&&(T[r]=[]),i.trackingEvents[r].push(A)}for(M=0,x=(X=this.childsByName(e,"MediaFiles")).length;M<x;M++)for(h=X[M],B=0,N=(Y=this.childsByName(h,"MediaFile")).length;B<N;B++)p=Y[B],(c=new ne).id=p.getAttribute("id"),c.fileURL=this.parseNodeText(p),c.deliveryType=p.getAttribute("delivery"),c.codec=p.getAttribute("codec"),c.mimeType=p.getAttribute("type"),c.apiFramework=p.getAttribute("apiFramework"),c.bitrate=parseInt(p.getAttribute("bitrate")||0),c.minBitrate=parseInt(p.getAttribute("minBitrate")||0),c.maxBitrate=parseInt(p.getAttribute("maxBitrate")||0),c.width=parseInt(p.getAttribute("width")||0),c.height=parseInt(p.getAttribute("height")||0),(m=p.getAttribute("scalable"))&&"string"==typeof m&&("true"===(m=m.toLowerCase())?c.scalable=!0:"false"===m&&(c.scalable=!1)),(p=p.getAttribute("maintainAspectRatio"))&&"string"==typeof p&&("true"===(p=p.toLowerCase())?c.maintainAspectRatio=!0:"false"===p&&(c.maintainAspectRatio=!1)),i.mediaFiles.push(c);if(null!=(e=this.childByName(e,"Icons")))for(Q=0,I=(K=this.childsByName(e,"Icon")).length;Q<I;Q++){for(d=K[Q],(a=new ie).program=d.getAttribute("program"),a.height=parseInt(d.getAttribute("height")||0),a.width=parseInt(d.getAttribute("width")||0),a.xPosition=this.parseXPosition(d.getAttribute("xPosition")),a.yPosition=this.parseYPosition(d.getAttribute("yPosition")),a.apiFramework=d.getAttribute("apiFramework"),a.offset=this.parseDuration(d.getAttribute("offset")),a.duration=this.parseDuration(d.getAttribute("duration")),F=0,V=(J=this.childsByName(d,"HTMLResource")).length;F<V;F++)s=J[F],a.type=s.getAttribute("creativeType")||"text/html",a.htmlResource=this.parseNodeText(s);for(H=0,D=(Z=this.childsByName(d,"IFrameResource")).length;H<D;H++)u=Z[H],a.type=u.getAttribute("creativeType")||0,a.iframeResource=this.parseNodeText(u);for(O=0,P=($=this.childsByName(d,"StaticResource")).length;O<P;O++)v=$[O],a.type=v.getAttribute("creativeType")||0,a.staticResource=this.parseNodeText(v);if(null!=(l=this.childByName(d,"IconClicks")))for(a.iconClickThroughURLTemplate=this.parseNodeText(this.childByName(l,"IconClickThrough")),ee=0,L=(q=this.childsByName(l,"IconClickTracking")).length;ee<L;ee++)o=q[ee],a.iconClickTrackingURLTemplates.push(this.parseNodeText(o));a.iconViewTrackingURLTemplate=this.parseNodeText(this.childByName(d,"IconViewTracking")),i.icons.push(a)}return i},a.parseNonLinear=function(e){for(var t,i,n,r,s,a,o,l,d,u,c,p,h,f,m,v,g,y,A,k,T,C,_,b,E,w=new x,U=0,L=(k=this.childsByName(e,"TrackingEvents")).length;U<L;U++)for(o=k[U],u=0,h=(T=this.childsByName(o,"Tracking")).length;u<h;u++)t=(d=T[u]).getAttribute("event"),l=this.parseNodeText(d),null!=t&&null!=l&&(null==(d=w.trackingEvents)[t]&&(d[t]=[]),w.trackingEvents[t].push(l));for(c=0,f=(C=this.childsByName(e,"NonLinear")).length;c<f;c++){for(s=C[c],(r=new N).id=s.getAttribute("id")||null,r.width=s.getAttribute("width"),r.height=s.getAttribute("height"),r.minSuggestedDuration=s.getAttribute("minSuggestedDuration"),r.apiFramework=s.getAttribute("apiFramework"),p=0,m=(_=this.childsByName(s,"HTMLResource")).length;p<m;p++)i=_[p],r.type=i.getAttribute("creativeType")||"text/html",r.htmlResource=this.parseNodeText(i);for(y=0,v=(b=this.childsByName(s,"IFrameResource")).length;y<v;y++)n=b[y],r.type=n.getAttribute("creativeType")||0,r.iframeResource=this.parseNodeText(n);for(A=0,g=(E=this.childsByName(s,"StaticResource")).length;A<g;A++)a=E[A],r.type=a.getAttribute("creativeType")||0,r.staticResource=this.parseNodeText(a);r.nonlinearClickThroughURLTemplate=this.parseNodeText(this.childByName(s,"NonLinearClickThrough")),w.variations.push(r)}return w},a.parseCompanionAd=function(e){for(var t,i,n,r,s,a,o,l,d,u,c,p,h,f,m,v,g,y,A,k,T,C,_,b,E,w=new S,U=0,L=(k=this.childsByName(e,"Companion")).length;U<L;U++){for(i=k[U],(t=new R).id=i.getAttribute("id")||null,t.width=i.getAttribute("width"),t.height=i.getAttribute("height"),u=0,h=(T=this.childsByName(i,"HTMLResource")).length;u<h;u++)r=T[u],t.type=r.getAttribute("creativeType")||"text/html",t.htmlResource=this.parseNodeText(r);for(c=0,f=(C=this.childsByName(i,"IFrameResource")).length;c<f;c++)s=C[c],t.type=s.getAttribute("creativeType")||0,t.iframeResource=this.parseNodeText(s);for(p=0,m=(_=this.childsByName(i,"StaticResource")).length;p<m;p++)a=_[p],t.type=a.getAttribute("creativeType")||0,t.staticResource=this.parseNodeText(a);for(y=0,v=(b=this.childsByName(i,"TrackingEvents")).length;y<v;y++)for(o=b[y],A=0,g=(E=this.childsByName(o,"Tracking")).length;A<g;A++)n=(d=E[A]).getAttribute("event"),l=this.parseNodeText(d),null!=n&&null!=l&&(null==(d=t.trackingEvents)[n]&&(d[n]=[]),t.trackingEvents[n].push(l));t.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(i,"CompanionClickThrough")),t.companionClickTrackingURLTemplate=this.parseNodeText(this.childByName(i,"CompanionClickTracking")),w.variations.push(t)}return w},a.parseDuration=function(e){var t,i;return null==e||3!==(t=e.split(":")).length?-1:(i=t[2].split("."),e=parseInt(i[0]),2===i.length&&(e+=parseFloat("0."+i[1])),i=parseInt(60*t[1]),t=parseInt(60*t[0]*60),isNaN(t||isNaN(i||isNaN(e||3600<i||60<e)))?-1:t+i+e)},a.parseXPosition=function(e){var t;return"left"===(t=e.toLowerCase())||"right"===t?e:parseInt(e||0)},a.parseYPosition=function(e){var t;return"top"===(t=e.toLowerCase())||"bottom"===t?e:parseInt(e||0)},a.parseNodeText=function(e){return e&&(e.textContent||e.text||"").trim()},t.exports=a},{"./ad":2,"./companionad":4,"./creative":5,"./extension":6,"./extensionchild":7,"./icon":8,"./mediafile":10,"./nonlinear":11,"./response":13,"./survey":14,"./urlhandler":16,"./util":19,events:1}],13:[function(e,t,i){t.exports=function(){this.ads=[],this.errorURLTemplates=[]}},{}],14:[function(e,t,i){t.exports=function(){this.type=null,this.url=null}},{}],15:[function(e,t,i){var s,a,n,r={}.hasOwnProperty;function o(e,t){var i,n,r;for(i in this.ad=e,this.creative=t,this.muted=!1,this.impressed=!1,this.skipable=!1,this.skipDelayDefault=-1,this.trackingEvents={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],r=this.creative.trackingEvents)n=r[i],this.trackingEvents[i]=n.slice(0);this.creative instanceof a?(this.setDuration(this.creative.duration),this.skipDelay=this.creative.skipDelay,this.linear=!0,this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates):(this.skipDelay=-1,this.linear=!1),this.on("start",function(){s.lastSuccessfullAd=+new Date})}s=e("./client"),n=e("./util"),a=e("./creative").VASTCreativeLinear,function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(o,e("events").EventEmitter),o.prototype.setDuration=function(e){return this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}},o.prototype.setProgress=function(e){var t,i,n,r,s,a,o,l;if(-1===(r=null===this.skipDelay?this.skipDelayDefault:this.skipDelay)||this.skipable||(e<r?this.emit("skip-countdown",r-e):(this.skipable=!0,this.emit("skip-countdown",0))),this.linear&&0<this.assetDuration){if(i=[],0<e)for(n in i.push("start"),r=Math.round(e/this.assetDuration*100),i.push("progress-"+r+"%"),i.push("progress-"+Math.round(e)),l=this.quartiles)(s=l[n])<=e&&e<=s+1&&i.push(n);for(a=0,o=i.length;a<o;a++)t=i[a],this.track(t,!0);e<this.progress&&this.track("rewind")}return this.progress=e},o.prototype.setMuted=function(e){return this.muted!==e&&this.track(e?"mute":"unmute"),this.muted=e},o.prototype.setPaused=function(e){return this.paused!==e&&this.track(e?"pause":"resume"),this.paused=e},o.prototype.setFullscreen=function(e){return this.fullscreen!==e&&this.track(e?"fullscreen":"exitFullscreen"),this.fullscreen=e},o.prototype.setSkipDelay=function(e){if("number"==typeof e)return this.skipDelay=e},o.prototype.load=function(){if(!this.impressed)return this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView")},o.prototype.errorWithCode=function(e){return this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:e})},o.prototype.complete=function(){return this.track("complete")},o.prototype.close=function(){return this.track(this.linear?"closeLinear":"close")},o.prototype.stop=function(){},o.prototype.skip=function(){return this.track("skip"),this.trackingEvents=[]},o.prototype.click=function(){var e,t;if(null!=(t=this.clickTrackingURLTemplates)&&t.length&&this.trackURLs(this.clickTrackingURLTemplates),null!=this.clickThroughURLTemplate)return this.linear&&(e={CONTENTPLAYHEAD:this.progressFormated()}),e=n.resolveURLTemplates([this.clickThroughURLTemplate],e)[0],this.emit("clickthrough",e)},o.prototype.track=function(e,t){var i,n;null==t&&(t=!1),"closeLinear"===e&&null==this.trackingEvents[e]&&null!=this.trackingEvents.close&&(e="close"),n=this.trackingEvents[e],i=this.emitAlwaysEvents.indexOf(e),null!=n?(this.emit(e,""),this.trackURLs(n)):-1!==i&&this.emit(e,""),!0===t&&(delete this.trackingEvents[e],-1<i&&this.emitAlwaysEvents.splice(i,1))},o.prototype.trackURLs=function(e,t){return null==t&&(t={}),this.linear&&(t.CONTENTPLAYHEAD=this.progressFormated()),n.track(e,t)},o.prototype.progressFormated=function(){var e,t,i;return(t=(t=(i=parseInt(this.progress))/3600).length<2?"0"+t:t)+":"+(e=(e=i/60%60).length<2?"0"+e:e)+":"+(t=(t=i%60).length<2?"0"+e:t)+"."+parseInt(100*(this.progress-i))},t.exports=o},{"./client":3,"./creative":5,"./util":19,events:1}],16:[function(r,e,t){var s,a;function i(){}a=r("./urlhandlers/xmlhttprequest"),s=r("./urlhandlers/flash"),i.get=function(e,t,i){var n;return i||("function"==typeof t&&(i=t),t={}),null!=t.response?i(null,t.response):null!=(n=t.urlhandler)&&n.supported()?t.urlhandler.get(e,t,i):"undefined"==typeof window||null===window?r("./urlhandlers/node").get(e,t,i):a.supported()?a.get(e,t,i):s.supported()?s.get(e,t,i):i()},e.exports=i},{"./urlhandlers/flash":17,"./urlhandlers/xmlhttprequest":18}],17:[function(e,t,i){function n(){}n.xdr=function(){var e;return e=window.XDomainRequest?new XDomainRequest:e},n.supported=function(){return!!this.xdr()},n.get=function(e,t,i){var n,r;return(r="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(r.async=!1,(n=this.xdr()).open("GET",e),n.timeout=t.timeout||0,n.withCredentials=t.withCredentials||!1,n.send(),n.onprogress=function(){},n.onload=function(){return r.loadXML(n.responseText),i(null,r)}):i()},t.exports=n},{}],18:[function(e,t,i){function n(){}n.xhr=function(){var e;if("withCredentials"in(e=new window.XMLHttpRequest))return e},n.supported=function(){return!!this.xhr()},n.get=function(e,t,i){var n;if("https:"===window.location.protocol&&0===e.indexOf("http://"))return i(new Error("Cannot go from HTTPS to HTTP."));try{return(n=this.xhr()).open("GET",e),n.timeout=t.timeout||0,n.withCredentials=t.withCredentials||!1,n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){if(4===n.readyState)return i(null,n.responseXML)},n.send()}catch(e){return i()}},t.exports=n},{}],19:[function(e,t,i){function n(){}n.track=function(e,t){for(var i,n,r,s=[],a=0,o=(n=this.resolveURLTemplates(e,t)).length;a<o;a++)i=n[a],"undefined"!=typeof window&&null!==window&&(r=new Image,s.push(r.src=i));return s},n.resolveURLTemplates=function(e,t){var i,n,r,s,a,o,l,d=[];"CACHEBUSTING"in(t=null==t?{}:t)||(t.CACHEBUSTING=Math.round(1e10*Math.random())),t.random=t.CACHEBUSTING;for(o=0,l=e.length;o<l;o++)if(s=e[o]){for(i in t)a=t[i],n="["+i+"]",r="%%"+i+"%%",s=(s=s.replace(n,a)).replace(r,a);d.push(s)}return d},n.storage=function(){var i,t;try{t="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){t=null}return null!=t&&!function(e){var t;try{if(t="__VASTUtil__",e.setItem(t,t),e.getItem(t)!==t)return 1}catch(e){return 1}}(t)||(i={},t={length:0,getItem:function(e){return i[e]},setItem:function(e,t){i[e]=t,this.length=Object.keys(i).length},removeItem:function(e){delete i[e],this.length=Object.keys(i).length},clear:function(){i={},this.length=0}}),t}(),t.exports=n},{}]},{},[9])(9)},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.DMVAST=e())}catch(e){try{var t=e.name+" in VPAID wrapper global t/c: "+e.message+", stack="+e.stack,i="//px.moatads.com/pixel.gif?e=24&d=data%3Adata%3Adata%3Adata&i="+encodeURIComponent("TRADEDESKVIDEO1")+"&rp=1&gw=thetradedeskvideo910663478306&ac=1&k="+encodeURIComponent(t)+"&ar="+encodeURIComponent("5103f31-clean")+"&iw="+encodeURIComponent("eb0ec0b")+"&j="+encodeURIComponent(document.referrer)+"&cs="+(new Date).getTime();(new Image).src=i}catch(e){}}var e,n}();
