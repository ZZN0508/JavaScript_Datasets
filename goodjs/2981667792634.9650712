YUI.add("io-base",function(f,t){function n(t){var e=this;e._uid="io:"+r++,e._init(t),f.io._map[e._uid]=e}var c=["start","complete","end","success","failure","progress"],l=["status","statusText","responseText","responseXML"],s=f.config.win,r=0;n.prototype={_id:0,_headers:{"X-Requested-With":"XMLHttpRequest"},_timeout:{},_init:function(t){var e,r,n=this;for(n.cfg=t||{},f.augment(n,f.EventTarget),e=0,r=c.length;e<r;++e)n.publish("io:"+c[e],f.merge({broadcast:1},t)),n.publish("io-trn:"+c[e],t)},_create:function(e,t){var n=this,r={id:f.Lang.isNumber(t)?t:n._id++,uid:n._uid},i=e.xdr?e.xdr.use:null,t=e.form&&e.form.upload?"iframe":null;return"native"===i&&(i=f.UA.ie&&!p?"xdr":null,n.setHeader("X-Requested-With")),(r=(t=i||t)?f.merge(f.IO.customTransport(t),r):f.merge(f.IO.defaultTransport(),r)).notify&&(e.notify=function(t,e,r){n.notify(t,e,r)}),t||s&&s.FormData&&e.data instanceof s.FormData&&(r.c.upload.onprogress=function(t){n.progress(r,t,e)},r.c.onload=function(t){n.load(r,t,e)},r.c.onerror=function(t){n.error(r,t,e)},r.upload=!0),r},_destroy:function(t){!s||t.notify||t.xdr||(e&&!t.upload?t.c.onreadystatechange=null:t.upload?(t.c.upload.onprogress=null,t.c.onload=null,t.c.onerror=null):f.UA.ie&&!t.e&&t.c.abort()),t.c=null},_evt:function(t,e,r){var n,i=this,s=r.arguments,o=i.cfg.emitFacade,a="io:"+t,u="io-trn:"+t;this.detach(u),e.e&&(e.c={status:0,statusText:e.e}),n=[o?{id:e.id,data:e.c,cfg:r,arguments:s}:e.id],o||(t===c[0]||t===c[2]||(e.evt?n.push(e.evt):n.push(e.c)),s&&n.push(s)),n.unshift(a),i.fire.apply(i,n),r.on&&(n[0]=u,i.once(u,r.on[t],r.context||f),i.fire.apply(i,n))},start:function(t,e){this._evt(c[0],t,e)},complete:function(t,e){this._evt(c[1],t,e)},end:function(t,e){this._evt(c[2],t,e),this._destroy(t)},success:function(t,e){this._evt(c[3],t,e),this.end(t,e)},failure:function(t,e){this._evt(c[4],t,e),this.end(t,e)},progress:function(t,e,r){t.evt=e,this._evt(c[5],t,r)},load:function(t,e,r){t.evt=e.target,this._evt(c[1],t,r)},error:function(t,e,r){t.evt=e,this._evt(c[4],t,r)},_retry:function(t,e,r){return this._destroy(t),r.xdr.use="flash",this.send(e,r,t.id)},_concat:function(t,e){return t+=(-1===t.indexOf("?")?"?":"&")+e},setHeader:function(t,e){e?this._headers[t]=e:delete this._headers[t]},_setHeaders:function(r,n){n=f.merge(this._headers,n),f.Object.each(n,function(t,e){"disable"!==t&&r.setRequestHeader(e,n[e])})},_startTimeout:function(t,e){var r=this;r._timeout[t.id]=setTimeout(function(){r._abort(t,"timeout")},e)},_clearTimeout:function(t){clearTimeout(this._timeout[t]),delete this._timeout[t]},_result:function(t,e){var r;try{r=t.c.status}catch(t){r=0}200<=r&&r<300||304===r||1223===r?this.success(t,e):this.failure(t,e)},_rS:function(t,e){var r=this;4===t.c.readyState&&(e.timeout&&r._clearTimeout(t.id),setTimeout(function(){r.complete(t,e),r._result(t,e)},0))},_abort:function(t,e){t&&t.c&&(t.e=e,t.c.abort())},send:function(e,r,t){var n,i,s,o,a,u=this,c=e,d={};if(r=r?f.Object(r):{},n=u._create(r,t),i=r.method?r.method.toUpperCase():"GET",t=r.sync,a=r.data,f.Lang.isObject(a)&&!a.nodeType&&!n.upload&&f.QueryString&&f.QueryString.stringify&&(r.data=a=f.QueryString.stringify(a)),r.form){if(r.form.upload)return u.upload(n,e,r);a=u._serialize(r.form,a)}if(a=a||"")switch(i){case"GET":case"HEAD":case"DELETE":c=u._concat(c,a),a="";break;case"POST":case"PUT":r.headers=f.merge({"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},r.headers)}if(n.xdr)return u.xdr(c,n,r);if(n.notify)return n.c.send(n,e,r);t||n.upload||(n.c.onreadystatechange=function(){u._rS(n,r)});try{if(n.c.open(i,c,!t,r.username||null,r.password||null),u._setHeaders(n.c,r.headers||{}),u.start(n,r),r.xdr&&r.xdr.credentials&&p&&(n.c.withCredentials=!0),n.c.send(a),t){for(s=0,o=l.length;s<o;++s)d[l[s]]=n.c[l[s]];return d.getAllResponseHeaders=function(){return n.c.getAllResponseHeaders()},d.getResponseHeader=function(t){return n.c.getResponseHeader(t)},u.complete(n,r),u._result(n,r),d}}catch(t){if(n.xdr)return u._retry(n,e,r);u.complete(n,r),u._result(n,r)}return r.timeout&&u._startTimeout(n,r.timeout),{id:n.id,abort:function(){return!!n.c&&u._abort(n,"abort")},isInProgress:function(){return!!n.c&&n.c.readyState%4},io:u}}},f.io=function(t,e){var r=f.io._map["io:0"]||new n;return r.send.apply(r,[t,e])},f.io.header=function(t,e){(f.io._map["io:0"]||new n).setHeader(t,e)},f.IO=n,f.io._map={};var e=s&&s.XMLHttpRequest,i=s&&s.XDomainRequest,o=s&&s.ActiveXObject,p=e&&"withCredentials"in new XMLHttpRequest;f.mix(f.IO,{_default:"xhr",defaultTransport:function(t){if(!t)return{c:f.IO.transports[f.IO._default](),notify:"xhr"!==f.IO._default};f.IO._default=t},transports:{xhr:function(){return e?new XMLHttpRequest:o?new ActiveXObject("Microsoft.XMLHTTP"):null},xdr:function(){return i?new XDomainRequest:null},iframe:function(){return{}},flash:null,nodejs:null},customTransport:function(t){var e={c:f.IO.transports[t]()};return e["xdr"===t||"flash"===t?"xdr":"notify"]=!0,e}}),f.mix(f.IO.prototype,{notify:function(t,e,r){switch(t){case"timeout":case"abort":case"transport error":e.c={status:0,statusText:t},t="failure";default:this[t].apply(this,[e,r])}}})},"3.12.0",{requires:["event-custom-base","querystring-stringify-simple"]});
