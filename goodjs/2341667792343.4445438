!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("wafer-video",[],t):"object"==typeof exports?exports["wafer-video"]=t():(e.wafer=e.wafer||{},e.wafer.wafers=e.wafer.wafers||{},e.wafer.wafers["wafer-video"]=t())}("undefined"!=typeof self?self:this,function(){return i={"./src/base.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function n(e,t,i){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,t);return void 0!==a?"value"in a?a.value:void 0!==(a=a.get)?a.call(i):void 0:null===(e=Object.getPrototypeOf(e))?void 0:n(e,t,i)}var m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,a=arguments[t];for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},a=function(e,t,i){return t&&p(e.prototype,t),i&&p(e,i),e},o=window.wafer,r=o.constants,s=o.utils,o=o.WaferBaseClass,g=r.ATTR_PREFIX,l=s.bindEvent,d=s.clearTimeout,u=s.each,w=s.findAncestor,c=s.isNodeName,f=s.removeCookie,y=s.setTimeout,v=s.unbindEvent,C=["handleFullscreenClick","handleMuteClick","handleNativeVideoEnd","handleVideoClick","handleVideoMouseEnter","handleVideoMouseLeave"],E=[],a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(b,o),a(b,[{key:"play",value:function(){var e=this._util.player;e&&(e.controls.isPlaying()||e.controls.play(),this._state.playing=!0)}},{key:"pause",value:function(){var e=this._util,t=e.player,i=e.adViewContinuous,e=this._state.adViewed,e=i&&e;t&&(t.controls.isPlaying()&&!e&&t.controls.pause(),this._state.playing=!1)}},{key:"isDocked",value:function(){var e=this._util.player;return!!e&&e.isDocked()}},{key:"unDock",value:function(){var e=this._util.player;e&&(e.controls.pause(),e.undockVideoPlayer())}},{key:"create",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).config,t=void 0===e?{}:e,i=this._util,e=i.type,a=i.playlistTrigger;switch(e){case"yvideo":this._createYVideo(t);break;case"yvideoPlaylist":var n=this._util,o=n.elem,n=n.targetElem;this.addToPlaylistForVideo(n,o),o.classList.add("has-video-"+a,"has-wafer-click");break;default:this._createDefault()}}},{key:"stateDidUpdate",value:function(){}},{key:"destroy",value:function(){var e=this._util,t=e.player,i=e.playlistTrigger,e=e.type;t&&(t.__destroyed=!0),"mouseenter"===i&&this.removeEventListeners(),"yvideo"===e&&this.removeInstanceFromUuidCollection(),n(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"destroy",this).call(this)}},{key:"_createDefault",value:function(){var e,t,i;this._state.created||(e=(t=this._util).elem,i=t.src,this._state.created=!0,i?(e.src=i,this._itemLoaded()):(t=this._util.errorClass,i=this._state.loopCount,c(e,"video")?(u(e.getElementsByTagName("source"),function(e){var t=e.getAttribute("data-wf-src");t&&(e.setAttribute("src",t),e.removeAttribute("data-wf-src"))}),e.load(),this._itemLoaded(),this._addNativeVideoEvents(),i||this.destroy()):e.classList.add(t)))}},{key:"_createYVideo",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).force,a=this._util.player;if(void 0!==i&&i||!a){var n=this._util,o=n.elem,r=n.targetElem,s=void 0;try{s=JSON.parse(o.getAttribute(g+"video-config"))}catch(e){}if(!s)return!1;var i=m({},t.rapidConfig,s.rapidConfig),a=this._util,n=a.autoplay,n=void 0!==n&&n,a=a.videoLoadClassName,s=m({},t,s,{rapidConfig:i}),l=r||document.createElement("div");r||o.classList.add("wafer-video-default");var d,i=s,i=(i.height,i.width,function(e,t){var i,a={};for(i in e)0<=t.indexOf(i)||Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a}(i,["height","width"]));l.classList.add("wafer-yvideo"),a&&l.classList.add.apply(l.classList,a),s.forceDisableFirstAd&&f("yvapF");try{if(this._util.player)try{this._util.player.destroy()}catch(e){}this._util.player=new window.YAHOO.VideoPlatform.VideoPlayer(m({startscreen:{showTitle:!0,showDesc:!0,showProvider:!1,showButton:!0},showControls:!0,fullscreenBtn:!0,replayonlyendscreen:!1,showTitleOnHover:!0,settingscreen:!1,enableFollowButtons:!0,enableSharedMediaStore:!1,energySaverMode:!1,enableLazy:!1,maintain16x9ratio:!0,renderOnServer:!1,videoOnly:!1,useAppDocking:!1,suppressPanelTitle:!1,mediaItem:null,videoManagerOptOut:!1,hidePlaylist:!1,hidePlaylistWhenSmall:!1,loop:!1,startTime:0,fullscreen:!1,mute:!0,ccOnMute:!0,stopBufferingOnPause:!1,preload:!1,watchHistoryEnabled:!1,html5:!0,iframeRender:!1,rapidConfig:{pageParams:{}}},i,{autoplay:!!n})),r||((d=o.getElementsByClassName("wafer-yvideo")[0])&&d.parentNode.removeChild(d),o.appendChild(l)),this._addCustomEndScreen(),this._util.player.__render=function(){e._util.player.render(l),e.addInstanceToUuidCollection(),l.classList.add("wafer-video-rendered"),e._itemLoaded(o)}}catch(e){}}}},{key:"_addCustomEndScreen",value:function(){var e=this._util,t=e.boundary,i=e.elem,e=i.getAttribute(g+"end-scrn-class"),t=e&&t&&w(i,t),e=t&&t.getElementsByClassName(e)[0];this._util.endScreenEl=e}},{key:"_addNativeVideoEvents",value:function(){var e=this._util.elem;this._state.loopCount&&(e.loop=!1,l(e,"ended",this.handleNativeVideoEnd))}},{key:"_itemLoaded",value:function(){var e=this._util,t=e.elem,i=e.targetElem,a=this._util,e=a.selector,a=a.successClass;i||t.classList.remove(e.replace(".","")),t.classList.add(a),t.removeAttribute(g+"src")}},{key:"handleVideoClick",value:function(e){var t,i,a;"yvideoPlaylist"===this._util.type&&(t=(a=this._util).elem,i=a.id,a=a.targetElem,this.handlePlaylistClick(a,t,i))}},{key:"handleMuteClick",value:function(e){e.preventDefault(),"yvideo"===this._util.type&&(this.mute=!this.mute)}},{key:"handleFullscreenClick",value:function(e){var t;e.preventDefault(),"yvideo"===this._util.type&&(t=this._util.player)&&t.controls.setFullscreen(!t.controls.getFullscreen())}},{key:"handleVideoMouseEnter",value:function(e){var a=this;"yvideoPlaylist"===this._util.type&&(d(this._state.mouseTimeout,this),this._state.mouseTimeout=y(function(){var e=a._util,t=e.elem,i=e.id,e=e.targetElem;a._state.playingAsPlaylist||a.handlePlaylistClick(e,t,i)},300,this))}},{key:"handleVideoMouseLeave",value:function(e){"yvideoPlaylist"===this._util.type&&d(this._state.mouseTimeout,this)}},{key:"handleNativeVideoEnd",value:function(e){var t=this._util.elem,i=this._state.loopCount;if(t.setAttribute("data-wf-current-loop-count",this._state.loopCount--),i<=0)return v(t,"ended",this.handleNativeVideoEnd),void this.destroy();t.currentTime=0,t.play()}},{key:"mounted",set:function(e){this._state.mounted=e},get:function(){return this._state.mounted}},{key:"renderInProgress",set:function(e){this._state.renderInProgress=e},get:function(){return this._state.renderInProgress}},{key:"playing",set:function(e){this._state.playing=e}},{key:"playlistItemActive",set:function(e){var t=this._util.elem;if(e)return t.classList.add("wafer-playlist-active"),void(this._state.playingAsPlaylist=!0);this._state.playingAsPlaylist=!1,t.classList.remove("wafer-playlist-active")}},{key:"pausedByUser",set:function(e){this._state.pausedByUser=e}},{key:"mute",set:function(e){var t=this._util,i=t.muteElem,a=t.player,t=this.mute;i&&(t?i.classList.remove("video-is-unmute"):i.classList.add("video-is-unmute")),e!==t&&a&&a.controls.setMute(e)},get:function(){var e=this._util.player;return!!e&&e.controls.getMute()}},{key:"config",get:function(){var e=this._util,t=e.endScreenEl,i=e.id,a=e.player,n=e.trigger,o=e.type,r=e.videoHandle,s=e.adViewContinuous,e=this._state;return{adViewContinuous:s,endScreenEl:t,videoHandle:r,id:i,pausedByUser:e.pausedByUser,player:a,playingAsPlaylist:e.playingAsPlaylist,trigger:n,type:o}}},{key:"viewability",get:function(){return this._state.viewability}},{key:"adViewed",set:function(e){this._state.adViewed=e}},{key:"adPlaying",get:function(){return this._state.adPlaying},set:function(e){this._state.adPlaying=e}}]),b);function b(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=t.errorClass,a=t.selector,n=t.successClass;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,e,{errorClass:i,selector:a,successClass:n},{STATE_ATTRS:E})),r=e.getAttribute(g+"src"),s=e.getAttribute(g+"type")||"default",l=e.getAttribute(g+"trigger")||"viewport",d=e.getAttribute(g+"playlist-trigger")||"click",u=e.getAttribute(g+"boundary"),c=e.getAttribute(g+"autoplay"),f=e.getAttribute(g+"video-handle"),y=e.getAttribute(g+"loop-count"),v=e.getAttribute(g+"id"),p=e.getAttribute(g+"target"),_=e.getAttribute(g+"viewability"),h=e.getAttribute(g+"ad-view-continuous"),t=p&&(u&&w(e,u)||document.body).querySelector(p),p=(p=e.getAttribute(g+"load-class")||"")&&p.split(" ");return o._util=m({},o._util,{autoplay:null==c?0:Number(c),boundary:u,elem:e,errorClass:i,id:v,muteElem:e.getElementsByClassName("wafer-video-mute")[0],player:null,playlistTrigger:d,selector:a,src:r,successClass:n,targetElem:t,trigger:l,type:s,videoHandle:null==f?1:Number(f),videoLoadClassName:p,adViewContinuous:null==h?0:Number(h)}),o._state=m({},o._state,{adPlaying:!1,adViewed:!1,created:!1,mounted:!1,playing:!1,playingAsPlaylist:!1,renderInProgress:!1,retryCount:0,viewability:_&&parseInt(_,10)||50,status:status}),y&&(o._state.loopCount=null==y?0:Number(y),o._state.loopCount&&--o._state.loopCount),C.forEach(function(e){o[e]=o[e].bind(o)}),"mouseenter"===d&&(o.addEventListeners(),o._state.mouseTimeout=null),"yvideoPlaylist"===s&&o.playlistDidMount(t,v),o}function p(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}a.events={click:[["has-video-click","handleVideoClick"],["wafer-video-mute","handleMuteClick"],["wafer-video-fullscreen","handleFullscreenClick"]],mouseenter:[["_self","handleVideoMouseEnter"]],mouseleave:[["_self","handleVideoMouseLeave"]]},t.default=a,e.exports=t.default},"./src/controller.js":function(e,t,i){"use strict";function u(){return e=i("./src/base.js"),f=e&&e.__esModule?e:{default:e};var e}function o(){return y=i("./src/perf.js")}function c(t,i,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"oathPlayer",e=this._state,o=e.elementInstances;(e.playlistMap.get(t)||[]).forEach(function(e){e=(o.get(e)||{}).instance;e&&(e.config.id===i?("fireball"===n&&E.emitWaferEvent("video:mediacurrent",{elem:t,meta:{videoCreatedRetryCount:e._state.retryCount,instance:a,videoData:{id:i}}}),e.playlistItemActive=!0):e.playlistItemActive=!1)})}Object.defineProperty(t,"__esModule",{value:!0});var f,y,a,v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,a=arguments[t];for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},n=function(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),e},d=window.wafer.features.performanceMarkSupported,r=window.wafer.utils,p=r.clearTimeout,_=r.debounce,h=r.elementInView,m=r.findAncestor,g=r.getConfigFromJSONScriptNode,w=r.loadCSSSync,s=r.loadScriptAsync,C=r.setTimeout,E=window.wafer.base,r=window.wafer.controllers.WaferBaseController,b={AD_PLAYBACK_START:"video:adplaybackstart",MEDIA_ITEM_CURRENT:"video:mediacurrent",PLAYBACK_PAUSE:"video:playbackpause",PLAYBACK_START:"video:playbackstart"},P={AD_PLAYBACK_START:"AD",PLAYBACK_START:"CONTENT"},A=Object.keys(b),O=void 0;function l(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}window.__waferYahooVideoUuidCollection=(a=new Map,{add:function(e){var t=e._util.id;t&&(a.has(t)||a.set(t,[]),a.get(t).push(e))},getElemAndPlayer:function(e){return(a.get(e)||[]).map(function(e){e=e._util;return{elem:e.elem,player:e.player}})},remove:function(e){var t,i=e._util.id;i&&(!(t=a.get(i)).length||-1<(e=t.indexOf(e))&&a.get(i).splice(e,1))}});(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(k,r),n(k,[{key:"_handleVideoReady",value:function(e,t){var i=this,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=e.config.player;if(p(this._state.playerReadyTimeoutMap.get(t),this),n.__destroyed)n.destroy();else if(!n.__ready){var o=n.getRootElement,r=this._util.videoConfig,s=e.config.videoHandle,l=(r||{}).autoplay,r=m(n.getVideoElement(),"wafer-yvideo")||o&&o.call(n)||t,o=!1;if(r){if(n._viewportOffset=this._getVideoOffset(r,e.viewability),a<=3){if(!n._viewportOffset)return void C(function(){n.__destroyed||i._handleVideoReady(e,t,++a)},50*a);d&&performance.mark("vp_ready"),o=h(r,n._viewportOffset,E.viewport)}!this._state.activeElem&&!1!==l&&s&&o&&!this._state.paused&&(e.play(),this._state.activeElem=t)}n.__isSlick=t.firstChild.classList.contains("yvideo-slick"),n.__ready=!0,this._state.currentVideoCreationIndex++,e.renderInProgress=!1,e.mounted=!0,this._createNextYvideo(),E.emitWaferEvent("video:ready",{elem:t,meta:{videoCreatedRetryCount:e._state.retryCount,instance:n,isInViewport:o}})}}},{key:"_startPlayerReadyTimer",value:function(e){var t=this;this._state.playerReadyTimeoutMap.set(e,C(function(){t._state.currentVideoCreationIndex++,t._createNextYvideo()},5e3,this))}},{key:"_createNextYvideo",value:function(){var e=this._state.yvideosList[this._state.currentVideoCreationIndex];if(e){var t=this._state.elementInstances.get(e).instance;if(!t.renderInProgress){t.renderInProgress=!0;var i=t.config.player;if(i.__ready)return this._state.currentVideoCreationIndex++,void this._createNextYvideo();this._startPlayerReadyTimer(e),i.__init&&i.__init(e,this,t),this._handleYVideoEvents(e,t),i.__render()}}}},{key:"_handleYVideoEvents",value:function(r,s){var l=this,e=s.config,t=e.endScreenEl,d=e.player,e=e.adViewContinuous,a=window.YAHOO.VideoPlatform.API_Events||window.OATH&&window.OATH.VideoPlatform.Events;A.forEach(function(i){d.on(a[i],function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=P[i];t&&(0,(y||o()).logVideoPlayerMetrics)(t),E.emitWaferEvent(b[i],{elem:r,meta:{videoCreatedRetryCount:s._state.retryCount,instance:d,videoData:e}})})}),d.on(a.PLAYBACK_RESUMED,function(){d.__destroyed||(s.config&&!s.config.pausedByUser&&(l._state.activeElem=r),s.playing=!0,E.emitWaferEvent("video:resumed",{elem:r,meta:{videoCreatedRetryCount:s._state.retryCount,instance:d}}))}),d.on(a.UI_INTERACT,function(e){var t,i,a,n,o=e.srcElement;"startScreen"===o&&"click"===s.config.trigger||(t=!1,a=d.controls.isPlaying(),n=(i=l._state).elementInstances,i=(e=i.dockedElem)&&n.get(e).instance,s.pausedByUser=t="video-click"===o&&!a||"ctrl-pause-btn"===o?!0:t,a?(n=(a=l._state.activeElem)&&n.get(a).instance,a&&a!==r&&n.pause(),l._state.activeElem=r,e&&e!==r&&i.isDocked()&&(i.unDock(),l._state.dockedElem=null)):l._state.activeElem===r&&(l._state.activeElem=null,s.playing=!1),E.emitWaferEvent("video:interacted",{elem:r,meta:{videoCreatedRetryCount:s._state.retryCount,instance:d}}))}),d.on(a.PLAYER_RENDERED,function(){var e=d.playlist;if(e){e=e.getItems();if(e&&!e.length)return}d&&(l._handleVideoReady(s,r),E.emitWaferEvent("video:rendered",{elem:r,meta:{videoCreatedRetryCount:s._state.retryCount,instance:d}}))}),d.on(a.PLAYER_MUTE_CHANGE,function(e){E.emitWaferEvent("video:mutechange",{elem:r,meta:{videoCreatedRetryCount:s._state.retryCount,instance:d}}),l._updateMuteControlForElem(r,e)}),d.on(a.PLAYER_READY,function(){d&&l._handleVideoReady(s,r)}),d.on(a.PLAYER_DOCKED_CHANGE,function(e){var t,i;d.__destroyed||(t=document.body,i=d.getRootElement,(i=m(d.getVideoElement(),"wafer-yvideo")||i&&i.call(d)||r)&&(d._viewportOffset=l._getVideoOffset(i,s.viewability)),e?(l._state.dockedElem=r,(i=l._state.activeElem)&&i!==r&&l._state.elementInstances.get(i).instance.pause(),l._state.activeElem=r,s.config.pausedByUser||d.controls.isPlaying()||l._state.paused||s.play(),t.classList.add("wafer-video-docked")):(l._state.dockedElem=null,t.classList.remove("wafer-video-docked")),E.emitWaferEvent("video:dockChange",{elem:r,meta:{videoCreatedRetryCount:s._state.retryCount,instance:d,isDocked:e,isInViewport:e}}))}),d.on(a.MEDIA_ITEM_CURRENT,function(e){c.call(l,r,e.id,d)}),this._state.isOathPlayer||(d.on(a.PLAYLIST_POSITION_CHANGE,function(){var e=d.playlist.getCurrentItem().id;c.call(l,r,e,d,"fireball")}),d.on(a.PLAYBACK_START,function(i){var e=l._state,a=e.elementInstances,e=e.playlistMap.get(r);e&&e.some(function(e){var t=a.get(e).instance.config,e=t.id;return!t.playingAsPlaylist&&e===i&&(c.call(l,r,i,d,"fireball"),!0)})})),d.on(a.PLAYER_ERROR,function(e){if(r===l._state.activeElem&&(l._state.activeElem=!1),p(l._state.playerReadyTimeoutMap.get(r),l),s._state.retryCount<2){var t=(l._util.videoConfig||{}).config;return l._state.currentVideoCreationIndex--,s.renderInProgress=!1,s._createYVideo(t,{force:!0}),s._state.retryCount++,void l._createNextYvideo()}l._state.currentVideoCreationIndex++,l._createNextYvideo(),d.__destroyed||(d.__isSlick=r.firstChild.classList.contains("yvideo-slick"),E.emitWaferEvent("video:playerError",{elem:r,meta:{videoCreatedRetryCount:s._state.retryCount,data:e,instance:d}}))});var i,n=this._state.isOathPlayer?"vp-state-end-screen":"yvp-state-end-screen";t&&d.on(a.PLAYLIST_COMPLETE,function(){var e=m(d.getVideoElement(),"wafer-yvideo").getElementsByClassName(n)[0];e&&e.insertAdjacentElement("afterend",t)}),d.on(a.AD_BREAK_ITEM_PLAYBACK_STARTED,function(e){s.adPlaying=!0,E.emitWaferEvent("video:adStarted",{elem:r,meta:{videoCreatedRetryCount:s._state.retryCount,instance:d,adData:e}})}),d.on(a.AD_BREAK_ITEM_ENDED,function(e){s.adPlaying=!1,E.emitWaferEvent("video:adEnded",{elem:r,meta:{videoCreatedRetryCount:s._state.retryCount,instance:d,adData:e}})}),e&&(i=d.addEventListener(a.PLAYBACK_PROGRESS,function(e,t){s.adPlaying&&2<=t&&(s.adViewed=!0,d.removeEventListener(a.PLAYBACK_PROGRESS,i))}))}},{key:"_getVideoOffset",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:50,i=e||{},e=i.clientHeight,i=i.clientWidth,i=-parseInt(i,10),t=-parseInt(e*t/100,10);return i||t?{offsetX:i,offsetY:t}:null}},{key:"_updateMuteControlForElem",value:function(e,t){var i=this._state,a=i.elementInstances,i=i.loudElem,a=a.get(e);a&&((a=a.instance)&&(a.mute=t),i!==e&&(this._state.loudElem=e))}},{key:"_loadVideoJS",value:function(a){var n=this;return new Promise(function(t,i){s({src:a},function(e){e?i(new Error("could not load js, src="+a)):((0,(y||o()).logVideoPlayerResourceMetrics)(a),window.YAHOO||(window.YAHOO={}),window.YAHOO.VideoPlatform=window.YAHOO.VideoPlatform||window.OATH.VideoPlatform,n._state.isOathPlayer=window.OATH&&window.OATH.VideoPlatform,n._state.hasYahooVideoPlayer=!0,t())},"YAHOO.VideoPlatform")})}},{key:"handleScroll",value:function(){this._validateWithDebounce()}},{key:"handleResize",value:function(){this._validateWithDebounce()}},{key:"loadDependencies",value:function(){var l=this,d=this._util.videoConfig,e=this._state,u=e.elementInstances,c=e.hasYahooVideoPlayer;return new Promise(function(e,t){if(c)return e();var i=!1,a=!0,n=!1,o=void 0;try{for(var r,s=u.values()[Symbol.iterator]();!(a=(r=s.next()).done);a=!0)if("yvideo"===r.value.instance.config.type){i=!0;break}}catch(e){n=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw o}}if(i){o=window.OATH||window.YAHOO;if(o&&o.VideoPlatform)return window.YAHOO.VideoPlatform=window.YAHOO.VideoPlatform||window.OATH.VideoPlatform,void e();o=d.playerScript||"https://yep.video.yahoo.com/oath/js/1/oath-player.js";if(O)return O;O=l._loadVideoJS(o).then(function(){e()}).catch(function(e){t(e)})}else e()})}},{key:"pause",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"pageVisibility",t=this._state.elementInstances;this._state.paused=!0,this._state.pauseSrc=this._state.pauseSrc||e;var i=!0,a=!1,n=void 0;try{for(var o,r=t.values()[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var s=o.value.instance;"pageVisibility"===e&&!s.mute||s.pause()}}catch(e){a=!0,n=e}finally{try{!i&&r.return&&r.return()}finally{if(a)throw n}}}},{key:"resume",value:function(){var e;this._state.pauseSrc===(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"pageVisibility")&&(e=this._state.activeElem,this._state.pauseSrc=null,this._state.paused=!1,e?(e=this._state.elementInstances.get(e).instance)&&e.play():this.sync())}},{key:"trigger",value:function(e){var t,i,a=this._state.elementInstances.get(e);!a||"yvideoPlaylist"===(t=a.instance).config.type&&(e=(i=t._util).elem,a=i.id,i=i.targetElem,t.handlePlaylistClick(i,e,a))}},{key:"didSync",value:function(){var e=this._state,t=e.elementInstances,e=e.mounted;0===t.size||e||(this._state.mounted=!0)}},{key:"willValidate",value:function(i){var o=this,e=this._state,a=e.activeElem,r=e.elementInstances,t=e.dockedElem,e=this._util.videoConfig||{},s=e.config,e=e.viewportOffset,l=void 0===e?{}:e,d=!1;t?d=!0:!a||((t=(e=r.get(a).instance).config.player)&&t.controls.getFullscreen()||h(a,{offsetX:0,offsetY:-parseInt(a.clientHeight*e.viewability/100,10)},E.viewport))&&(d=!0),this.loadDependencies().then(function(){var a=!1;i.forEach(function(e){var t,i=r.get(e).instance;i.mounted||("yvideo"===(t=i.config.type)||"yvideoPlaylist"===t?(i.create({config:s}),"yvideo"===t&&(i._addedToYvideoList||(o._state.yvideosList.push(e),i._addedToYvideoList=!0,a=!0))):i.mounted=!0)}),a&&o._createNextYvideo()}).then(function(){var e,t,n;d||!1!==(o._util.videoConfig||{}).autoplay&&(a&&(r.get(a).instance.pause(),o._state.activeElem=null),e=void 0===(t=l.offsetX)?0:t,t=l.offsetY,(n=E.viewport).top=void 0===t?0:t,n.left=e,i.some(function(e){var t=r.get(e).instance,i=t.config.type,a=t._util.videoHandle;if("yvideoPlaylist"!==i&&a&&t.mounted&&h(e,{offsetX:0,offsetY:-parseInt(e.clientHeight*t.viewability/100,10)},n))if("default"===i)t.create({config:s});else if(!t.config.pausedByUser)return o._state.activeElem=e,o._state.paused||t.play(),!0;return!1}))}).then(function(){E.emitLog({name:"WaferVideo",elem:null,meta:{videoScriptLoaded:!0}})}).catch(function(e){var t=e.message,e=e.stack;E.emitError({name:"WaferVideo",elem:null,meta:{message:t},stack:e})})}}]),n=k;function k(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.errorClass,i=void 0===t?"wafer-video-error":t,a=e.root,n=void 0===a?document:a,o=e.selector,t=e.successClass,a=void 0===t?"wafer-video-complete":t,t=e.validateDelay,e=void 0===t?25:t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,k);var t=g(document.getElementById("wafer-video-config")),r=t.config;if(r&&window.YAHOO&&window.YAHOO.subscriptions&&window.YAHOO.subscriptions.videoPlayer){var s,l=window.YAHOO.subscriptions.videoPlayer;for(s in r.pluginConfigs=r.pluginConfigs||{},r.pluginConfigs["source-metadata-plugin"]=r.pluginConfigs["source-metadata-plugin"]||{},r.pluginConfigs["source-metadata-plugin"]["media/sapi"]=r.pluginConfigs["source-metadata-plugin"]["media/sapi"]||{},r.pluginConfigs["source-metadata-plugin"]["media/sapi"].qs=r.pluginConfigs["source-metadata-plugin"]["media/sapi"].qs||{},l)l.hasOwnProperty(s)&&(r.pluginConfigs["source-metadata-plugin"]["media/sapi"].qs[s]=l[s])}(f||u()).default.prototype.playlistDidMount=function(e,t){e=d._state.elementInstances.get(e).instance.config.player;e&&(e.playlist.getItemById(t)||e.playlist.addItem(t))},(f||u()).default.prototype.handlePlaylistClick=function(e,t,i){var a=d._state,n=a.elementInstances,o=a.playlistMap,a=n.get(e).instance,n=a.config.player;n.playlist.getItemById(i)||n.playlist.addItem(i),n.playlist.setPositionById(i),a.play(),1<o.get(e).length&&c.call(d,t,i,n)},(f||u()).default.prototype.addToPlaylistForVideo=function(e,t){var i=d._state.playlistMap;i.has(e)||i.set(e,[]),i.get(e).push(t)},(f||u()).default.prototype.addInstanceToUuidCollection=function(){window.__waferYahooVideoUuidCollection.add(this)},(f||u()).default.prototype.removeInstanceFromUuidCollection=function(){window.__waferYahooVideoUuidCollection.remove(this)};var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,{root:n,selector:o,props:{errorClass:i,selector:o,successClass:a},WaferClass:(f||u()).default}));return d._validateWithDebounce=_(function(){d.validate()},e,d),d._util=v({},d._util,{videoConfig:t}),d._state=v({},d._state,{activeElem:null,currentVideoCreationIndex:0,dockedElem:null,hasYahooVideoPlayer:!1,loudElem:null,paused:!1,playerReadyTimeoutMap:new Map,playlistMap:new Map,yvideosList:[]}),w({text:".wafer-video-default.wafer-video:not(.StretchedBox),.wafer-video-default.wafer-video-complete:not(.StretchedBox){position:relative;width:100%;height:100%}.wafer-video-default .wafer-yvideo{position:absolute;top:0;bottom:0;left:0;right:0}"}),d.sync(),d}t.default=n,e.exports=t.default},"./src/entry.js":function(e,t,i){"use strict";var a,n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=new(a||(n=i("./src/controller.js"),a=n&&n.__esModule?n:{default:n})).default({selector:".wafer-video"}),e.exports=t.default},"./src/perf.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],a=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(a=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=window.wafer.features,r=a.performanceMarkSupported,s=a.isSlowBrowser,l=!1;t.logVideoPlayerMetrics=function(a){var n;l||!r||(n=window.rapidInstance)&&n.beaconPerformanceData&&s.then(function(e){var t,i;e||(t={},e=(i=window.performance).now(),"AD"===a?t.vp_adplayback_start=e:t.vp_contentplayback_start=e,t.vp_playback_start=e,(i=i.getEntriesByName("vp_ready"))&&i.length&&(i=o(i,1)[0],t.vp_ready=Math.round(i.startTime+i.duration)),l=!0,n.beaconPerformanceData({perf_usertime:{utm:t}}))})},t.logVideoPlayerResourceMetrics=function(e){var t,i;r&&(t=(i=window).rapidInstance,i=i.videoPlayerResourceMetricsFired,t&&t.beaconPerformanceData&&!i&&(t=window.performance,i={},!e||(e=t.getEntriesByName(e))&&e.length&&(e=o(e,1)[0],i.vp_fetch_duration=e.duration,i.vp_fetch_end_time=e.responseEnd,i.vp_fetch_start=e.startTime),window.videoPlayerResourceMetricsFired=!0,window.rapidInstance.beaconPerformanceData({perf_usertime:{utm:i}})))}}},n={},a.m=i,a.c=n,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="https://s.yimg.com/aaq/wf/",a(a.s="./src/entry.js");function a(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}var i,n});
