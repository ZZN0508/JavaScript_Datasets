YUI.add("flickr-activity-recentByType-OLD-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-activity-recentByType-OLD"]={run:function(o,i){var r=this,n=this._processParams(o);return new e.FlickrPromise({apiResponse:i.callAPI("flickr.activity.recentByType",n),notificationModelRegistry:i.getModelRegistry("notification-OLD-models"),notificationsModelRegistry:i.getModelRegistry("person-notifications-models"),groupInfoModelRegistry:i.getModelRegistry("group-info-models"),groupModelRegistry:i.getModelRegistry("group-models"),personModelRegistry:i.getModelRegistry("person-models"),photoModelRegistry:i.getModelRegistry("photo-models"),contactModelRegistry:i.getModelRegistry("contact-models"),photoEngagementModelRegistry:i.getModelRegistry("photo-engagement-models"),personRelationshipModelRegistry:i.getModelRegistry("person-relationship-models"),photoStatsRegistry:i.getModelRegistry("photo-stats-models"),discussionModelRegistry:i.getModelRegistry("notification-group-discussion-models"),galleryModelRegistry:i.getModelRegistry("notification-gallery-models"),flickrMailModelRegistry:i.getModelRegistry("notification-flickrmail-models"),faveEventModelRegistry:i.getModelRegistry("notification-event-fave-models"),commentEventModelRegistry:i.getModelRegistry("notification-event-comment-models"),followerEventModelRegistry:i.getModelRegistry("notification-event-follower-models"),addedToGalleryEventModelRegistry:i.getModelRegistry("notification-event-added-to-gallery-models"),tagEventModelRegistry:i.getModelRegistry("notification-event-tag-models"),peopleEventModelRegistry:i.getModelRegistry("notification-event-people-models"),photoCommentMentionNotifRegisty:i.getModelRegistry("notification-event-photo-comment-mention-models"),photoGroupInviteNotifRegistry:i.getModelRegistry("notification-event-photo-group-invite-models"),groupNotifModelRegistry:i.getModelRegistry("notification-event-group-models"),noteEventModelRegistry:i.getModelRegistry("notification-event-note-models"),shareEventModelRegistry:i.getModelRegistry("notification-event-share-models"),uploadEventModelRegistry:i.getModelRegistry("notification-event-upload-models"),groupReplyEventModelRegistry:i.getModelRegistry("notification-event-group-reply-models"),friendJoinEventModelRegistry:i.getModelRegistry("notification-event-friend-join-models"),groupTopicNewEventModelRegistry:i.getModelRegistry("notification-event-group-topic-new-models"),flickrMailEventModelRegistry:i.getModelRegistry("notification-event-flickrmail-models"),testimonialEventModelRegistry:i.getModelRegistry("notification-event-testimonial-models"),photoModeratedEventModelRegistry:i.getModelRegistry("notification-event-photo-moderated-models")}).then(function(e){return r._processResponse(e,o,n,i)},e.FetcherErrorLogger(t))},_processParams:function(t){var o,i={extras:["sizes","icon_urls","ignored","rev_ignored","tags","autotags","datecreate"].join(",")+","+e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||30,count:30,page:t.page||1,per_object:50,notification_groups:"default, bot_moderation"};return o=e.merge(i,t.apiParams||{}),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(o),o},_processResponse:function(t,o,i,r){var n,s,l,a=t.apiResponse,d=t.notificationModelRegistry,p=t.notificationsModelRegistry,g=t.photoModelRegistry,c=t.personModelRegistry,y=t.contactModelRegistry,m=t.groupModelRegistry,f=(t.personRelationshipModelRegistry,t.photoEngagementModelRegistry),u=t.photoStatsRegistry,R=t.discussionModelRegistry,M=t.galleryModelRegistry,v=t.flickrMailModelRegistry,h=[];return n={fave:t.faveEventModelRegistry,comment:t.commentEventModelRegistry,contacted:t.followerEventModelRegistry,gallery:t.addedToGalleryEventModelRegistry,tag:t.tagEventModelRegistry,people:t.peopleEventModelRegistry,photo_comment_mention:t.photoCommentMentionNotifRegisty,group_invite:t.photoGroupInviteNotifRegistry,group_user_invite:t.groupNotifModelRegistry,note:t.noteEventModelRegistry,share:t.shareEventModelRegistry,upload:t.uploadEventModelRegistry,reply_reply:t.groupReplyEventModelRegistry,topic_reply:t.groupReplyEventModelRegistry,friend_join:t.friendJoinEventModelRegistry,group_topic_new:t.groupTopicNewEventModelRegistry,flickrmail:t.flickrMailEventModelRegistry,testimonial:t.testimonialEventModelRegistry,photo_bot_moderated:t.photoModeratedEventModelRegistry},a.items.item.forEach(function(t){var o,i,s,a,p=t.activity?t.activity.event:[];if(o={objectType:t.type,seen:!!t.seen,id:e.guid(),events:[],isMuted:!!t.is_muted},"photo"===t.type){var E=e.clone(t);if(E.title){var _=E.title.content||E.title._content;E.title=_}o.object=e.APIHelper.response.parsePhotos({photos:[E],photoModelRegistry:g,personModelRegistry:c,photoEngagementModelRegistry:f,photoStatsModelRegistry:u}).shift()}else"person"===t.type?c.exists(t.id)?o.object=c.proxy(t.id):o.object=c.add(e.APIHelper.response.parsePerson({nsid:t.user,pathAlias:t.pathAlias,username:t.username,realname:t.realname,isAdFree:t.isAdFree,ispro:t.ispro,proBadge:t.proBadge,datecreate:t.datecreate,iconurls:t.iconurls})):"group"===t.type?m.exists(t.id)?o.object=m.proxy(t.id):o.object=m.add(m.parseGroupModel(t.id,t.pathAlias,t)):"discussion"===t.type?((s=e.clone(t)).id=t.group_id,s.title=t.group_name,a=m.exists(t.group_id)?m.proxy(t.group_id):m.add(m.parseGroupModel(t.group_id,t.pathAlias,s)),R.exists(t.id)?o.object=R.proxy(t.id):o.object=R.add(R.parseDiscussionModel(t.id,t.pathAlias,t,a))):"gallery"===t.type?o.object=M.addOrUpdate(M.parseGalleryModel(t)):"flickrmail"===t.type&&(o.object=v.addOrUpdate(v.parseFlickrMailModel(t)));p.forEach(function(s){var a,d,p;if(s.type in n){if("people"===s.type)l={},d=e.APIHelper.response.parseContact({nsid:s.person,username:s.personname}),p=e.APIHelper.response.parseContact({nsid:s.user,username:s.realname}),l.personTagged=y.exists(d.id)?y.proxy(d.id):y.add(d),l.tagger=y.exists(p.id)?y.proxy(p.id):y.add(p);else if("group_invite"===s.type)s.name=s.groupName,s.id=s.groupId,s.iconurls=s.group_iconurls,l=m.exists(s.id)?m.proxy(s.id):m.add(m.parseGroupModel(s.groupId,s.pathAlias,s));else{if("note"===s.type&&!r.flipper.isFlipped("enable-scrappy-notes"))return;if("gallery"===s.type)l={id:s.galleryid,title:s.title,url:"/photos/"+s.owner+"/galleries/"+s.galleryid,iconurls:s.gallery_iconurls};else if("flickrmail"===s.type)l={mail:{id:t.id,title:t.title,url:"/mail/"+t.id},owner:{nsid:t.user,username:t.username,realname:t.realname,iconserver:t.iconserver,iconfarm:t.iconfarm,pathAlias:t.pathalias,iconUrls:t.iconurls}};else if("testimonial"===s.type){var g=c.proxy(r.getViewer().nsid),f=e.URLHelper.generatePersonUrls(g),u=(f.profile,f.profile.slice(0,f.profile.length-1)+"#testimonial"+t.id);l={id:t.id,owner:{nsid:t.user,username:t.username,realname:t.realname,iconserver:t.iconserver,iconfarm:t.iconfarm,pathAlias:t.pathalias,iconUrls:t.iconurls},url:u}}else if("contacted"===s.type)s.iconurls=t.iconurls;else if("upload"===s.type){var R=e.APIHelper.response.parsePhoto(s,t.id);l={title:s.title.content,url:t.url,photo:R,owner:R.owner}}else if("photo_bot_moderated"===s.type){var M=e.APIHelper.response.parsePhoto(t,t.owner);l={photo:M,owner:M.owner}}}if(a=e.APIHelper.response.parseNotificationsEvents[s.type](s,l),a.owner=y.addOrUpdate(a.owner),a.owner.getValue("isMe")&&"group_user_invite"!==s.type)return;i=n[s.type].addOrUpdate(a),o.events.push(i)}}),d.exists(o.id)||h.push(d.add(o))}),s={notifications:h},p.exists(o.id)?p.getValue(o.id,"notifications").addPage({page:i.page,perPage:i.per_page,pageContent:h,totalItems:parseInt(a.items.total||0,10)}):p.add(s),h}}},"@VERSION@",{requires:["flickr-promise","search-helper","querystring-parse-simple"],optional:["url-helper","notification-OLD-models","person-notifications-models","contact-models","photo-models","notification-group-discussion-models","notification-gallery-models","notification-flickrmail-models","notification-event-fave-models","notification-event-comment-models","notification-event-follower-models","notification-event-added-to-gallery-models","notification-event-people-models","notification-event-tag-models","notification-event-photo-comment-mention-models","notification-event-photo-group-invite-models","notification-event-group-models","notification-event-note-models","notification-event-share-models","notification-event-upload-models","notification-event-group-reply-models","notification-event-flickrmail-models","notification-event-testimonial-models","notification-event-photo-moderated-models"]});YUI.add("flickr-notifications-markread-updater",function(r,i){"use strict";r.namespace("ModelUpdaters")["flickr-notifications-markread"]={run:function(e,a){return a.callAPI("flickr.notifications.markread",e).then(null,r.FetcherErrorLogger(i))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-activity-getNotificationsCount-fetcher",function(i,t){"use strict";i.namespace("ModelFetchers")["flickr-activity-getNotificationsCount"]={run:function(e,o){var n=this,s=this._processParams(e);return i.FlickrPromise({apiResponse:o.callAPI("flickr.activity.getNotificationsCount",s),personNotifsModelRegistry:o.getModelRegistry("person-notifications-models")}).then(function(i){return n._processResponse(i,o,s)},i.FetcherErrorLogger(t))},_processParams:function(t){var e=t.notification_groups||"default,hermes_2020,groups_you_admin";return i.merge(t,{notification_groups:e})},_processResponse:function(i,t,e){var o=i.apiResponse,n=i.personNotifsModelRegistry,s=n.getValue(e.id,"unseenNotificationCounts")||{};return n.setValue(e.id,"unseenNotificationCount",o.activity.count),n.setValue(e.id,"unseenNotificationCounts",Object.assign(s,o.activity)),o.activity.count}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-notifications-models","api-helper"]});YUI.add("flickr-activity-muteObject-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-activity-muteObject"]={run:function(r,c){var i=r;return c.callAPI("flickr.activity.muteObjectByType",i).then(null,e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-activity-unmuteObject-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-activity-unmuteObject"]={run:function(r,c){var i=r;return c.callAPI("flickr.activity.unmuteObjectByType",i).then(null,e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("person-notifications-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-people-getInfo"].run(e,this.appContext)},readUnseenNotificationCount:function(e,n){return t.ModelFetchers["flickr-activity-getNotificationsCount"].run(e,n)},updateMutedObjects:function(e,n){return t.ModelUpdaters["flickr-activity-muteObject"].run(e,n)},updateUnmutedObjects:function(e,n){return t.ModelUpdaters["flickr-activity-unmuteObject"].run(e,n)}},remoteReadUnseenNotificationCount:function(t,e,n){return this.setValue(t,"unseenLastFetchedTimestamp",Date.now()),this.remote.readUnseenNotificationCount(e,n)},remoteUpdateMutedObjects:function(t,e,n){var i=this;return this.remote.updateMutedObjects(e,n).then(function(e){return i.setValue(t,"muteChanged",!0),e})},remoteUpdateUnmutedObjects:function(t,e,n){var i=this;return this.remote.updateUnmutedObjects(e,n).then(function(e){return i.setValue(t,"muteChanged",!0),e})},getNotificationsByContinuation:function(e,n){var i=Object.assign(n,{id:e});return t.ListFetchers["flickr-activity-recentByType"].run(i,this.appContext)},attributes:{id:{setter:function(t){return t||this.appContext.getViewer().nsid}},unseenNotificationCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},unseenNotificationCounts:{},unreadFlickrMailCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},unseenLastFetchedTimestamp:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},muteChanged:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},notifications:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-activity-recentByType-OLD"]}},initialNotificationsData:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-activity-recentByType-fetcher","flickr-activity-recentByType-OLD-fetcher","flickr-notifications-markread-updater","flickr-people-getInfo-fetcher","flickr-activity-getNotificationsCount-fetcher","flickr-activity-muteObject-updater","flickr-activity-unmuteObject-updater","attribute-helpers"]});