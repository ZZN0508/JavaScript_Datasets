GDT.initComm=function(){GDTDefine,GDTDefine("gdt:mod/util.js",function(e,t,n){var r,o,i,a,c,l,s,u,d,f,g,m,p,v,h,y,b,w,L,T,x,_={};function I(e){return encodeURIComponent(e)}function E(g,e,m,p,v){var t,h=-1===(g||"").indexOf("?")?"?":"&";cbname=(v=v||{}).callbackName||"callback";var y=v.cbnameKey||"callback",b=cbname+"_gdtjson"+ ++L;for(t in e=e||{})e.hasOwnProperty(t)&&(h+=I(t)+"="+I(e[t])+"&");return v.uniqueName=b,setTimeout(function(){var e,t,n,r,o,i,a,c,l,s,u,d,f;e=g+h+y+"="+b,t=m,n=p,r=v,c=document.createElement("script"),l=document,s=window,u=!1,d=l.head||l.getElementsByTagName("head")[0]||l.body,l=(r=r||{}).charset||"GB2312",f=r.uniqueName,r.timeout&&(a=setTimeout(function(){r.onTimeout(999),i()},r.timeout)),s[f]=function(e){u=!0,t(e)},o=function(e){n&&n(e)},i=function(){u=!0,s[f]=null;try{delete s[f]}catch(e){}a&&(clearTimeout(a),a=null),c.onload=c.onreadystatechange=c.onerror=null,d.removeChild(c),c=null},c.onerror=function(e){o(998),i()},c.onload=c.onreadystatechange=function(e){var t;c&&(t=void 0===(t=c.readyState)||"loaded"===t||"complete"===t,u&&t&&i(),!u&&t&&(o(999),i()))},c.type="text/javascript",c.charset=l,c.async=!0,c.src=e,d.appendChild(c)},1),b}_.emptyFn=function(){},_.userAgent=(p=navigator.userAgent,v=navigator.appVersion,h=/Chrome.(\d+\.\d+)/i,b=o=i=a=c=l=s=u=NaN,w=d=f=g=!(y=/Version.(\d+\.\d+)/i),window.ActiveXObject||-1<v.indexOf("Trident")?(b=9-(-1<v.indexOf("Trident/5.0")?0:1)-(window.XDomainRequest?0:1)-(window.XMLHttpRequest?0:1),-1<v.indexOf("Trident/6.0")&&(b=10),-1<v.indexOf("Trident/7.0")&&(b=11),r=navigator.appMinorVersion,7<b&&r&&-1<r.toLowerCase().indexOf("beta")&&(f=!0)):document.getBoxObjectFor||void 0!==window.mozInnerScreenX?(r=p.match(/(?:Firefox|GranParadiso|Iceweasel|Minefield).(\d+\.\d+)/i),o=parseFloat(r&&r[1]||"3.3",10)):navigator.taintEnabled?window.opera?i=parseFloat(v,10):b=6:(c=(r=p.match(/AppleWebKit.(\d+\.\d+)/i))&&1<r.length?parseFloat(r[1],10):document.evaluate?document.querySelector?525:420:419,((r=v.match(h))||window.chrome)&&(r=r||p.match(h),s=parseFloat(r&&r[1]||"2.0",10)),(r=v.match(y))&&!window.chrome&&(r=r||p.match(y),a=parseFloat(r&&r[1]||"3.3",10)),-1<p.indexOf("AdobeAIR")&&(l=1),-1<p.indexOf("iPad")&&(g=!0),-1<p.indexOf("iPhone")&&(m=!0)),-1<p.indexOf("Windows")?(w=!0,r=p.match(/Windows.+?(\d+\.\d+)/),u=parseFloat(r&&r[1]||"5.1",10)):-1<p.indexOf("Mac OS X")?d=!0:w=!0,{beta:f,firefox:o,ie:b,opera:i,air:l,safari:a,safariV:a,webkit:c,chrome:s,windows:u||w,isiPad:g,isiPhone:m,macs:d}),_.object={getType:function(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},each:function(e,t,n){if("number"==typeof e.length)for(var r=0,o=e.length;r<o;r++)t.call(n,e[r],r);else if("number"==typeof e)for(r=0;r<e;r++)t.call(n,r,r);else for(r in e)t.call(n,e[r],r)}},_.lang={isHashMap:function(e){return"object"==_.object.getType(e)}},_.string={RegExps:{escHTML:{re_amp:/&/g,re_lt:/</g,re_gt:/>/g,re_apos:/\x27/g,re_quot:/\x22/g},escString:{bsls:/\\/g,nl:/\n/g,rt:/\r/g,tab:/\t/g},cut:/[\x00-\xFF]/,getRealLen:{r0:/[^\x00-\xFF]/g,r1:/[\x00-\xFF]/g}},escString:function(e){var t=_.string.RegExps.escString,n=_.string.RegExps.escHTML;return _.string.listReplace(e+"",{"\\\\":t.bsls,"\\n":t.nl,"":t.rt,"\\t":t.tab,"\\'":n.re_apos,'\\"':n.re_quot})},escHTML:function(e){var t=_.string.RegExps.escHTML;return _.string.listReplace(e+"",{"&amp;":t.re_amp,"&lt;":t.re_lt,"&gt;":t.re_gt,"&#039;":t.re_apos,"&quot;":t.re_quot})},restHTML:function(e){_.string.restHTML.__utilDiv||(_.string.restHTML.__utilDiv=document.createElement("div"));var t=_.string.restHTML.__utilDiv;return t.innerHTML=e+"",void 0!==t.innerText?t.innerText:void 0!==t.textContent?t.textContent:void 0!==t.text?t.text:""},listReplace:function(e,t){if(_.lang.isHashMap(t)){for(var n in t)e=_.string.commonReplace(e,t[n],n);return e}return e+""},commonReplace:function(e,t,n){return e.replace(t,n)},cut:function(e,t,n){if(e+="",t-=0,n=n||"",isNaN(t))return e;for(var r=e.length,o=Math.min(Math.floor(t/2),r),i=_.string.getRealLen(e.slice(0,o));o<r&&i<t;o++)i+=1+!_.string.RegExps.cut.test(e.charAt(o));return e.slice(0,t<i?o-1:o)+(o<r?n:"")},getRealLen:function(e,t){if("string"!=typeof e)return 0;if(t){t=e.replace(_.string.RegExps.getRealLen.r1,"");return e.length-t.length+encodeURI(t).length/3}return e.replace(_.string.RegExps.getRealLen.r0,"**").length}},_.dom={getById:function(e){return document.getElementById(e)},getElementsByClassName:function(e,t,n){for(var r,o=new RegExp("(^|\\s)"+e+"(\\s|$)"),t=t||"*",n=n||document,i="*"==t&&n.all?n.all:n.getElementsByTagName(t),a=[],c=i.length,l=0;l<c;l++)r=i[l],o.test(r.className)&&a.push(r);return a},searchChain:function(e,t,n){for(t=t||"parentNode";e&&e.nodeType&&1==e.nodeType;){if(!n||n.call(e,e))return e;e=e[t]}return null},getAncestorBy:function(e,t){return e=_.dom.get(e),_.dom.searchChain(e.parentNode,"parentNode",function(e){return 1==e.nodeType&&(!t||t(e))})},get:function(e){return"string"==typeof e?document.getElementById(e):e},getStyle:function(t,e){if(!(t=_.dom.get(t))||9==t.nodeType)return null;var n=document.defaultView&&document.defaultView.getComputedStyle,r=n?document.defaultView.getComputedStyle(t,""):null;switch(e){case"float":e=n?"cssFloat":"styleFloat";break;case"opacity":if(n)return parseFloat((r||t.style)[e]);var o=100;try{o=t.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(e){try{o=t.filters("alpha").opacity}catch(e){}}return o/100;case"backgroundPositionX":if(n)return(r||t.style)[e="backgroundPosition"].split(" ")[0];break;case"backgroundPositionY":if(n)return(r||t.style)[e="backgroundPosition"].split(" ")[1]}return n?(r||t.style)[e]:t.currentStyle[e]||t.style[e]},setStyle:function(e,t,n){if(!(e=_.dom.get(e))||1!=e.nodeType)return!1;var r,o,i,a=!0,c=(i=document.defaultView)&&i.getComputedStyle,l=/z-?index|font-?weight|opacity|zoom|line-?height/i;for(o in"string"==typeof t&&(i=t,(t={})[i]=n),t)n=t[o],"float"==o?o=c?"cssFloat":"styleFloat":"opacity"==o?c||(o="filter",n=1<=n?"":"alpha(opacity="+Math.round(100*n)+")"):"backgroundPositionX"!=o&&"backgroundPositionY"!=o||(i="X"==o.slice(-1)?"Y":"X",c&&(r=_.dom.getStyle(e,"backgroundPosition"+i),o="backgroundPosition","number"==typeof n&&(n+="px"),n="Y"==i?n+" "+(r||"top"):(r||"left")+" "+n)),a=void 0!==e.style[o]?(e.style[o]=n+("number"!=typeof n||l.test(o)?"":"px"),a&&!0):a&&!1;return a},removeElement:function(e){if(e="string"==typeof e?document.getElementById(e):e)return e.removeNode?e.removeNode(!0):e.parentNode&&e.parentNode.removeChild(e),e=null},getPosition:function(e){var t=_.dom.getXY(e),e=_.dom.getSize(e);return{top:t[1],left:t[0],width:e[0],height:e[1]}},getScrollTop:function(e){e=e||document;return Math.max(e.documentElement.scrollTop,e.body.scrollTop)},getScrollLeft:function(e){e=e||document;return Math.max(e.documentElement.scrollLeft,e.body.scrollLeft)},getXY:function(e,t){var n=0,r=0,o=t||document;if(e)if(o.documentElement.getBoundingClientRect&&e.getBoundingClientRect)var i=e.getBoundingClientRect(),t=e.ownerDocument,o=_.userAgent.ie?2:0,n=i.top-o+_.dom.getScrollTop(t),r=i.left-o+_.dom.getScrollLeft(t);else for(;e.offsetParent;)n+=e.offsetTop,r+=e.offsetLeft,e=e.offsetParent;return[r,n]},getSize:function(e){var t,n,r,o=[0,0];if(e){for(t=0,n=(r=["Left","Right","Top","Bottom"]).length;t<n;t++){var i=r[t];o["Left"==i||"Right"==i?0:1]+=(parseInt(_.dom.getStyle(e,"border"+i+"Width"),10)||0)+(parseInt(_.dom.getStyle(e,"padding"+i),10)||0)}return[e.offsetWidth-o[0],e.offsetHeight-o[1]]}return[-1,-1]}},_.css={insertCSSLink:function(e,t){var n=document,r=(r=n.getElementById(t))&&"LINK"==r.nodeName?r:null,o=n.getElementsByTagName("head")[0];return r||(r=n.createElement("link"),t&&(r.id=t),r.rel="stylesheet",r.rev="stylesheet",r.type="text/css",r.media="screen",o.appendChild(r)),e&&(r.href=e),r.sheet||r},hasClassName:function(e,t){return!(!e||!t)&&(e.classList?e.classList.contains(t):t&&-1<(" "+e.className+" ").indexOf(" "+t+" "))}},_.JSONGetter=(L=0,function(t,e,n,r){var o={onSuccess:null,onError:null,onTimeout:null,timeout:null,send:function(e){E(t,n,o.onSuccess,o.onError,{charset:r,timeout:o.timeout,onTimeout:o.onTimeout,callbackName:e})}};return o}),_.xhr=(T=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,x=function(e,t){var n=null;(n=function(e,t){var n;try{n=e()}catch(e){t({ret:599,msg:"get transport error",status:598,exception:e});return}return n}(function(){var e;return window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new ActiveXObject("Msxml2.XMLHTTP")||new ActiveXObject("Microsoft.XMLHTTP")),e},t))&&e(n,function(){n.onreadystatechange=null,n=null,delete n})},function(i,a,c,l){var s;l=l||{};function u(){s&&(clearTimeout(s),s=null)}x(function(n,t){n.onreadystatechange=function(){var e;4==n.readyState&&(200==n.status?(e=n.responseText,a({ret:0,resp:e,xmlHttp:n})):c({ret:599,msg:"http error",status:n.status}),u(),t())};var e=l.method||"GET";n.open(e,i,!0),T&&(n.withCredentials=!0),l.headers&&_.object.each(l.headers,function(e,t){n.setRequestHeader(t,e)});var r,o=null;"POST"==e&&l.data&&(r=[],_.object.each(l.data,function(e,t){r.push(t+"="+encodeURIComponent(e))}),o=r.join("&")),n.send(o),l.timeout&&(s=setTimeout(function(){l.onTimeout&&l.onTimeout(),u(),t()},l.timeout))},c)}),_.getlocalStorage=function(e){var r=null,t=null;e=e||window;for(var n,o={localStorage:{test:function(){return!!e.localStorage},init:function(){r=e.localStorage},getItem:function(e){return r.getItem(e)},setItem:function(e,t){return r.setItem(e,t)}},userData:{test:function(){return!!e.ActiveXObject},init:function(){(r=e.document.documentElement).addBehavior("#default#userdata")},getItem:function(e){var t=null;try{r.load(e),t=r.getAttribute(e)}catch(e){}return t},setItem:function(e,t){var n=!1;try{r.load(e),r.setAttribute(e,t),n=r.save(e)}catch(e){}return n}}},i=0,a=(n=["localStorage","userData"]).length;i<a;i++){t=o[n[i]];try{if(t.test()){t.init();break}t=null}catch(e){t=null}}return t&&(delete t.test,delete t.init),t},_.cookie={get:function(e){e=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)"),e=document.cookie.match(e);return e?e[1]:""}},_.event={getEvent:function(e){var t,e=window.event||e||null,n=0;if(!e)for(t=arguments.callee;t&&n<10&&(!t.arguments||!(e=t.arguments[0])||void 0===e.button||void 0===e.ctrlKey);)++n,t=t.caller;return e},_eventListDictionary:{},_fnSeqUID:0,_objSeqUID:0,addEvent:function(t,e,n,r){var o,i,a=!1;return t?(t.eventsListUID||(t.eventsListUID="e"+ ++_.event._objSeqUID),(o=_.event._eventListDictionary[t.eventsListUID])||(o=_.event._eventListDictionary[t.eventsListUID]={}),n.__elUID||(n.__elUID="e"+ ++_.event._fnSeqUID+t.eventsListUID),o[e]||(o[e]={}),o[e].handlers||(o[e].handlers={}),"function"!=typeof(i=o[e].handlers)[n.__elUID]&&(o=function(e){return n.apply(t,r?[_.event.getEvent(e)].concat(r):[_.event.getEvent(e)])},(a=t.addEventListener?(t.addEventListener(e,o,!1),!0):!!t.attachEvent&&t.attachEvent("on"+e,o))&&(i[n.__elUID]=o),a)):a},trigger:function(e,t){var n,e=e&&_.event._eventListDictionary[e.eventsListUID],r=e&&e[t]&&e[t].handlers;if(r)try{for(n in r)r[n].call(window,{})}catch(e){_.console.print("UMod.event.trigger error")}},removeEvent:function(e,t,n){var r,o=n,i=!1,a=_.event._eventListDictionary;if(!e||!n)return i;if(e.eventsListUID&&a[e.eventsListUID]&&a[e.eventsListUID][t]&&(a=a[e.eventsListUID][t].handlers)&&a[n.__elUID]&&(o=a[n.__elUID],r=a),e.removeEventListener)e.removeEventListener(t,o,!1),i=!0;else{if(!e.detachEvent)return!1;e.detachEvent("on"+t,o),i=!0}return i&&r&&r[n.__elUID]&&delete r[n.__elUID],i}},n.exports=_})};
