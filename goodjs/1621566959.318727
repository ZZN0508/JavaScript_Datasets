!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.hulk=e():t.hulk=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=17)}([function(t,e,r){var n,o,i;i=function(){function t(t){var e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);if(t[0].match(/^[^/:]+:\/*$/)&&t.length>1){var r=t.shift();t[0]=r+t[0]}t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<t.length;n++){var o=t[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<t.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),e.push(o))}var i=e.join("/"),a=(i=i.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return i=a.shift()+(a.length>0?"?":"")+a.join("&")}return function(){return t("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},t.exports?t.exports=i():void 0===(o="function"==typeof(n=i)?n.call(e,r,e,t):n)||(t.exports=o)},function(t,e,r){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},a=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=u(r(8)),l=u(r(12)),f=r(2),p=function(t){function e(r,n,o,i,a){var s=t.call(this,r)||this;return Object.setPrototypeOf?Object.setPrototypeOf(s,e.prototype):s.__proto__=e.prototype,s.url=n,s.method=o,s.requestBody=i,s.responseStatus=a,s}return o(e,t),e}(Error);e.FetchError=p;e.fRetry=function(t){return function(e,r,n,o){return void 0===n&&(n=!0),a(void 0,void 0,void 0,(function(){var u,d;return s(this,(function(h){return u=l.default(f.trackClientErrors,500),d=function(t){return a(void 0,void 0,void 0,(function(){var a,c,l,f,d,h,y,v,m,b,w,g,_,S,O;return s(this,(function(s){switch(s.label){case 0:return r&&r.method&&"GET"!==r.method.toUpperCase()&&r.headers&&"string"==typeof r.body&&(a=function(t){for(var e=0,r=Object.keys(t);e<r.length;e++){var n=r[e];if("content-type"===n.toLowerCase())return t[n]}return null}(r.headers))&&"application/json"===a.toLowerCase()&&"object"==typeof(c=JSON.parse(r.body))&&(r.body=JSON.stringify(i({__numberOfAttempts:t},c))),l="string"==typeof e?e:e.url,f=r&&r.method||"string"!=typeof e&&e.method||"get",y=(h=JSON).parse,(v=r&&r.body)?[3,3]:(m="string"!=typeof e)?[4,e.clone().text()]:[3,2];case 1:m=s.sent(),s.label=2;case 2:v=m,s.label=3;case 3:d=y.apply(h,[v.toString()])||void 0,s.label=4;case 4:return s.trys.push([4,8,9,10]),[4,fetch(e,i(i({},r),{credentials:(null==r?void 0:r.credentials)||"omit"}))];case 5:return b=s.sent(),(g=o)?[4,o(b)]:[3,7];case 6:g=!s.sent(),s.label=7;case 7:if(w=g,!b.ok||w)throw _=w?"Failed response validation":b.statusText,new p(_,l,f,d,b.status);return[2,b];case 8:if((S=s.sent())instanceof p)throw S;throw new p(S.message||"Unexpected fetch error",l,f,d);case 9:return n&&u(null===(O=null==r?void 0:r.headers)||void 0===O?void 0:O.Authorization),[7];case 10:return[2]}}))}))},[2,c.default(d,t)]}))}))}};var d=e.fRetry({retries:5});e.default=d},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u,c=s(r(3)),l=r(6),f=s(r(0)),p=s(r(1)),d=new c.default("MOL-FE-WEB-PUSH_CLIENT_SUBSCRIPTION_ERRORS",sessionStorage);e.setBaseEndpoint=function(t){return u=t},e.getErrors=function(){return d.get()},e.addError=function(t){var r=l.serializeError(t),n=e.getErrors();(null==n?void 0:n.find((function(t){return JSON.stringify(t)===JSON.stringify(r)})))||d.set(a(n||[],[r]))},e.clear=function(){return d.clear()},e.trackClientErrors=function(t){return o(void 0,void 0,void 0,(function(){var r,o,a,s,c;return i(this,(function(i){switch(i.label){case 0:if(!(r=e.getErrors())||0===r.length)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),o=f.default(u,"analytics/client/error"),a={body:JSON.stringify({errors:r}),headers:{"Content-type":"application/json"},method:"post"},t&&(a.headers=n(n({},a.headers),{Authorization:t})),[4,p.default(o,a,!1)];case 2:if(!(s=i.sent()).ok)throw new Error(s.statusText);return e.clear(),[3,4];case 3:return c=i.sent(),console.error("Track Client Errors",c),[3,4];case 4:return[2]}}))}))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){void 0===e&&(e=localStorage),this.name=t,this.storage=e}return t.prototype.get=function(){try{var t=this.storage.getItem(this.name);if(null!==t)return JSON.parse(t)}catch(t){console.error(t)}return null},t.prototype.set=function(t){try{this.storage.setItem(this.name,JSON.stringify(t))}catch(t){console.error(t)}},t.prototype.clear=function(){try{this.storage.removeItem(this.name)}catch(t){console.error(t)}},t}();e.default=n},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=a(r(13)),u=a(r(1)),c=a(r(7));e.isWebPushSupported=function(){return"serviceWorker"in navigator&&"PushManager"in window};e.needsMigration=function(t,e){return t.options.applicationServerKey instanceof ArrayBuffer&&!s.default(e,new Uint8Array(t.options.applicationServerKey,0))},e.willExpireSoon=function(t){return!!t.expirationTime&&t.expirationTime<Date.now()+6048e5};e.registerPushSubscription=function(t,e,r){var a=e.subscription,s=e.metadata;return o(void 0,void 0,void 0,(function(){var e,o;return i(this,(function(i){return function(t){var e,r;try{e=t.getKey("auth"),r=t.getKey("p256dh")}catch(e){return console.error("Unable to get auth and p256dh keys, subscription "+JSON.stringify(t,null,2)),!1}return null!==e&&null!==r}(a)?(e={metadata:n(n({},s),{browserLanguage:navigator.language,subscribedUrl:location.href}),subscription:a},o={body:JSON.stringify(e),headers:{"Content-type":"application/json"},method:"POST",mode:"cors"},r&&(o.headers=n(n({},o.headers),{Authorization:"ApiKey "+r})),[2,u.default(t,o)]):[2,void 0]}))}))},e.subscribePushNotifications=function(t){var r=t.apiKey,n=t.appServerKey,a=t.metadata,s=t.subscriptionEndpoint,u=t.registration;return o(void 0,void 0,void 0,(function(){var t,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,u.pushManager.subscribe({applicationServerKey:n,userVisibleOnly:!0})];case 1:return t=i.sent(),[4,e.registerPushSubscription(s,{subscription:t,metadata:a},r)];case 2:return i.sent(),[2,t];case 3:throw o=i.sent(),new c.default(o.message,"register",o);case 4:return[2]}}))}))},e.requestPushNotificationPermission=function(){return o(void 0,void 0,void 0,(function(){return i(this,(function(t){return[2,new Promise((function(t,e){var r=Notification.requestPermission((function(e){t(e)}));r instanceof Promise&&r.then(t,e)}))]}))}))},e.requestPushPermissionAndSubscribe=function(t){return o(void 0,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,e.requestPushNotificationPermission()];case 1:return"granted"!==(r=o.sent())?[3,3]:[4,e.subscribePushNotifications(n({},t))];case 2:o.sent(),o.label=3;case 3:return[2,r]}}))}))},e.updatePushSubscription=function(t,e,r){var a=e.subscription,s=e.metadata;return o(void 0,void 0,void 0,(function(){var e,o,l;return i(this,(function(i){switch(i.label){case 0:e={metadata:n(n({},s),{browserLanguage:navigator.language,subscribedUrl:location.href}),subscription:a},o={body:JSON.stringify(e),headers:{"Content-type":"application/json"},method:"PATCH",mode:"cors"},r&&(o.headers=n(n({},o.headers),{Authorization:"ApiKey "+r})),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,u.default(t,o)];case 2:return i.sent(),[3,4];case 3:throw l=i.sent(),new c.default(l.message,"update",l);case 4:return[2]}}))}))},e.replaceSubscription=function(t){var r=t.apiKey,n=t.appServerKey,a=t.metadata,s=t.registration,u=t.subscription,c=t.subscriptionEndpoint;return o(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,u.unsubscribe()];case 1:return t.sent(),[2,e.subscribePushNotifications({apiKey:r,appServerKey:n,metadata:a,registration:s,subscriptionEndpoint:c})]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=new(n(r(3)).default)("MOL-FE-WEB-PUSH_SUBSCRIPTION_STATUS");e.setStatus=function(t,e){o.set({state:t,metadata:e})},e.getStatus=function(){return o.get()},e.clearStatus=function(){return o.clear()}},function(t,e,r){"use strict";class n extends Error{constructor(t){super(n._prepareSuperMessage(t)),Object.defineProperty(this,"name",{value:"NonError",configurable:!0,writable:!0}),Error.captureStackTrace&&Error.captureStackTrace(this,n)}static _prepareSuperMessage(t){try{return JSON.stringify(t)}catch(e){return String(t)}}}const o=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],i=({from:t,seen:e,to_:r,forceEnumerable:n})=>{const a=r||(Array.isArray(t)?[]:{});e.push(t);for(const[r,o]of Object.entries(t))"function"!=typeof o&&(o&&"object"==typeof o?e.includes(t[r])?a[r]="[Circular]":a[r]=i({from:t[r],seen:e.slice(),forceEnumerable:n}):a[r]=o);for(const{property:e,enumerable:r}of o)"string"==typeof t[e]&&Object.defineProperty(a,e,{value:t[e],enumerable:!!n||r,configurable:!0,writable:!0});return a};t.exports={serializeError:t=>"object"==typeof t&&null!==t?i({from:t,seen:[],forceEnumerable:!0}):"function"==typeof t?`[Function: ${t.name||"anonymous"}]`:t,deserializeError:t=>{if(t instanceof Error)return t;if("object"==typeof t&&null!==t&&!Array.isArray(t)){const e=new Error;return i({from:t,seen:[],to_:e}),e}return new n(t)}}},function(t,e,r){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(r,n,o){var i=t.call(this,r)||this;return Object.setPrototypeOf?Object.setPrototypeOf(i,e.prototype):i.__proto__=e.prototype,i.type=n,i.cause=o,i}return o(e,t),e}(Error);e.default=i},function(t,e,r){"use strict";const n=r(9);class o extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,({message:t}=t)):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}}const i=(t,e)=>new Promise((r,i)=>{e={onFailedAttempt:()=>{},retries:10,...e};const a=n.operation(e);a.attempt(async n=>{try{r(await t(n))}catch(t){if(!(t instanceof Error))return void i(new TypeError(`Non-error was thrown: "${t}". You should only throw errors.`));if(t instanceof o)a.stop(),i(t.originalError);else if(t instanceof TypeError)a.stop(),i(t);else{((t,e,r)=>{const n=r.retries-(e-1);t.attemptNumber=e,t.retriesLeft=n})(t,n,e);try{await e.onFailedAttempt(t)}catch(t){return void i(t)}a.retry(t)||i(a.mainError())}}})});t.exports=i,t.exports.default=i,t.exports.AbortError=o},function(t,e,r){t.exports=r(10)},function(t,e,r){var n=r(11);e.operation=function(t){var r=e.timeouts(t);return new n(r,{forever:t&&t.forever,unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<e.retries;o++)n.push(this.createTimeout(o,e));return t&&t.forever&&!n.length&&n.push(this.createTimeout(o,e)),n.sort((function(t,e){return t-e})),n},e.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,n=Math.round(r*e.minTimeout*Math.pow(e.factor,t));return n=Math.min(n,e.maxTimeout)},e.wrap=function(t,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var o in n=[],t)"function"==typeof t[o]&&n.push(o);for(var i=0;i<n.length;i++){var a=n[i],s=t[a];t[a]=function(n){var o=e.operation(r),i=Array.prototype.slice.call(arguments,1),a=i.pop();i.push((function(t){o.retry(t)||(t&&(arguments[0]=o.mainError()),a.apply(this,arguments))})),o.attempt((function(){n.apply(t,i)}))}.bind(t,s),t[a].options=r}}},function(t,e){function r(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,o=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&o.unref(),!0},r.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},r.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,r=0,n=0;n<this._errors.length;n++){var o=this._errors[n],i=o.message,a=(t[i]||0)+1;t[i]=a,a>=r&&(e=o,r=a)}return e}},function(t,e,r){"use strict";function n(t){return"function"==typeof t?t():t}function o(){var t={};return t.promise=new Promise((function(e,r){t.resolve=e,t.reject=r})),t}t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=void 0,a=void 0,s=void 0,u=[];return function(){var l=n(e),f=(new Date).getTime(),p=!i||f-i>l;i=f;for(var d=arguments.length,h=Array(d),y=0;y<d;y++)h[y]=arguments[y];if(p&&r.leading)return r.accumulate?Promise.resolve(t.call(this,[h])).then((function(t){return t[0]})):Promise.resolve(t.call.apply(t,[this].concat(h)));if(a?clearTimeout(s):a=o(),u.push(h),s=setTimeout(c.bind(this),l),r.accumulate){var v=u.length-1;return a.promise.then((function(t){return t[v]}))}return a.promise};function c(){var e=a;clearTimeout(s),Promise.resolve(r.accumulate?t.call(this,u):t.apply(this,u[u.length-1])).then(e.resolve,e.reject),u=[],a=null}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e){if(t.byteLength!==e.byteLength)return!1;for(var r=0;r!==t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){switch(t){case"production":return"https://hulkprod.anm.co.uk/api/web-push-notification";case"integration":return"https://hulkint.anm.co.uk/api/web-push-notification";default:return"/public"}}},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=o(r(7)),a=r(5),s=r(6);r(2);e.default=function(t,e){var r=e.emit,o=e.metadata,u=e.rawAppServerKey;t instanceof i.default&&("register"===t.type?a.setStatus("register_pending",o):"update"===t.type&&a.setStatus("update_pending",o)),r("error",n(n({},s.serializeError(t)),{organisation:o.organisation,rawAppServerKey:u,userAgent:o.userAgent}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=i(r(23));e.default=function(t,e,r){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,a.default(t,e,r)];case 1:return o.sent(),[3,3];case 2:return n=o.sent(),console.error("TrackEvent Error",n),[3,3];case 3:return[2]}}))}))}},function(t,e,r){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},a=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=u(r(0)),l=u(r(18)),f=u(r(19)),p=u(r(21)),d=u(r(26)),h=u(r(14)),y=r(4),v=u(r(28)),m=function(t){function e(e){var r=t.call(this)||this;r.appServerKey=null,r.registration=null;var n=e.environment?h.default(e.environment):e.baseEndpoint||"";return r.options=v.default(i({},e)),r.baseEndpoint=c.default(n,"/v1/organisation",r.options.metadata.organisation),r.subscriptionEndpoint=c.default(r.baseEndpoint,"subscription"),r}return o(e,t),e.isWebPushSupported=function(){return y.isWebPushSupported()},e.prototype.init=function(){return a(this,void 0,void 0,(function(){var t,e,r,n,o=this;return s(this,(function(a){switch(a.label){case 0:return[4,this.getAppServerKey()];case 1:return t=a.sent()||{},e=t.parsed,r=t.raw,n=this,[4,p.default(i(i({},this.options),{appServerKey:e,baseEndpoint:this.baseEndpoint,emit:function(t,e){return o.emit(t,e)},rawAppServerKey:r,subscriptionEndpoint:this.subscriptionEndpoint}))];case 2:return n.registration=a.sent(),[2,this.registration]}}))}))},e.prototype.showPrompt=function(){return a(this,void 0,void 0,(function(){var t,e,r,n=this;return s(this,(function(o){switch(o.label){case 0:return[4,this.getAppServerKey()];case 1:if(t=o.sent()||{},e=t.parsed,r=t.raw,null===this.registration)throw new Error("Init must be called before attempting to call showPrompt");return[2,d.default(this.registration,i(i({},this.options),{appServerKey:e,baseEndpoint:this.baseEndpoint,emit:function(t,e){return n.emit(t,e)},rawAppServerKey:r,subscriptionEndpoint:this.subscriptionEndpoint}))]}}))}))},e.prototype.getAppServerKey=function(t){return void 0===t&&(t=!1),a(this,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return null===this.appServerKey||t?(e=this,[4,f.default(c.default(this.subscriptionEndpoint,"publicKey"),this.options.apiKey)]):[3,2];case 1:e.appServerKey=r.sent(),r.label=2;case 2:return[2,this.appServerKey]}}))}))},e}(l.default);e.Register=m},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.events={},this.logger=t||console}return t.prototype.on=function(t,e){var r=this.events;return(r[t]||(r[t]=[])).push(e),this},t.prototype.removeListener=function(t,e){var r=this.events,n=r[t]||(r[t]=[]);return r[t]=n.filter((function(t){return t!==e})),this},t.prototype.removeAllListeners=function(t){return t?this.events[t]=null:this.events={},this},t.prototype.emit=function(t){for(var e=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=this.events,i=o[t]||(o[t]=[]),a=i.length>0,s=r;try{s=JSON.parse(JSON.stringify(r))}catch(t){}return i.forEach((function(t){try{t.apply(void 0,s)}catch(t){e.logger.error(t,t.stack)}})),a},t}();e.default=n},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=i(r(20)),s=i(r(1));e.default=function(t,e){return n(void 0,void 0,void 0,(function(){var r,i;return o(this,(function(u){switch(u.label){case 0:return r={mode:"cors"},e&&(r.headers={Authorization:"ApiKey "+e}),[4,s.default(t,r,!0,(function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,t.clone().text()];case 1:return[2,""!==e.sent().trim()]}}))}))}))];case 1:return[4,u.sent().text()];case 2:return i=u.sent(),[2,{parsed:a.default(i),raw:i}]}}))}))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){var e,r=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/");e=function(){try{return window.atob(),!0}catch(t){return!1}}()?function(t){var e,r,n,o={},i=0,a=0,s="",u=t.length;for(e=0;e<64;e++)o["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)]=e;for(r=0;r<u;r++)for(i=(i<<6)+(e=o[t.charAt(r)]),a+=6;a>=8;)((n=255&i>>>(a-=8))||u-2>r)&&(s+=String.fromCharCode(n));return s}(r):window.atob(r);for(var n=new Uint8Array(e.length),o=0;o<e.length;++o)n[o]=e.charCodeAt(o);return n}},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=s(r(22)),c=r(4),l=r(5),f=s(r(15)),p=r(2),d=s(r(16)),h=r(24),y=function(t,e,r){return o(void 0,void 0,void 0,(function(){var n,o,a,s,u;return i(this,(function(i){switch(i.label){case 0:n=l.getStatus(),o=t.organisation,a=n&&Array.isArray(n.metadata.crossOrgUserIds)?n.metadata.crossOrgUserIds:[],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,h.getCrossOrgUserIdFromCentral(o)];case 2:return(s=i.sent()||void 0)&&!a.includes(s)&&h.updateCrossOrgUserIdOnOtherOrgs(o,s).catch((function(n){f.default(n,{emit:e,metadata:t,rawAppServerKey:r})})),[2,s];case 3:return u=i.sent(),f.default(u,{emit:e,metadata:t,rawAppServerKey:r}),[3,4];case 4:return[2,a[a.length-1]]}}))}))};e.default=function(t){return o(void 0,void 0,void 0,(function(){var e,r,o,s,h,v,m,b,w,g,_,S,O,E,P,x,k,A,T,j,M,I,K,N,U,C,R,L,J;return i(this,(function(i){switch(i.label){case 0:e=t.apiKey,r=t.appServerKey,o=t.notificationMacros,s=t.emit,h=t.metadata,v=t.baseEndpoint,m=t.swUrl,b=t.subscriptionEndpoint,w=t.rawAppServerKey,g=Array.isArray(h.visitorIds)?h.visitorIds[0]:void 0,_=h.userAgent,i.label=1;case 1:return i.trys.push([1,21,,22]),[4,u.default];case 2:return i.sent(),S=new URLSearchParams(window.location.search),O=S.get("ito"),p.setBaseEndpoint(v),E=l.getStatus(),[4,y(h,s,w)];case 3:return P=i.sent(),x=P?[P]:void 0,h.crossOrgUserIds=x,"push-notification"!==O?[3,5]:(k=S.get("ci"),A=S.get("si"),T=S.get("ai"),k&&A?(j={action:"click",campaignId:k,crossOrgUserId:P,organisation:h.organisation,platform:h.platform,subscriptionId:A,type:"notification",userAgent:_,visitorId:g},T&&(j.assetId=T),s("notification_click",j),[4,d.default(v,n(n({},j),{action:"click_page_load"}),e)]):[3,5]);case 4:i.sent(),i.label=5;case 5:if(!m)return[3,9];i.label=6;case 6:return i.trys.push([6,8,,9]),[4,navigator.serviceWorker.register(m,{scope:"/"})];case 7:return i.sent(),[3,9];case 8:return M=i.sent(),console.error("ServiceWorker registration failed: ",M),[3,9];case 9:return[4,navigator.serviceWorker.ready];case 10:return[4,(I=i.sent()).pushManager.getSubscription()];case 11:return K=i.sent(),N=!!K&&c.needsMigration(K,r),E=l.getStatus(),U={apiKey:e,baseEndpoint:v,crossOrgUserId:P,navigatorPlatform:window.navigator.platform,notificationMacros:o,organisation:h.organisation,permission:Notification.permission,subscription:N?null:K,type:"web-push-sw-init-data",userAgent:h.userAgent,visitorId:g},I.active.postMessage(JSON.stringify(U)),E&&"undecided"===E.state&&"granted"===Notification.permission&&(l.setStatus("register_pending",E.metadata),E=l.getStatus()),E&&"undecided"!==E.state&&E.metadata&&(E.metadata.userAgent!==h.userAgent||E.metadata.profilingAllowed!==h.profilingAllowed||(E.metadata.visitorIds||[]).join(",")!==(h.visitorIds||[]).join(",")||(E.metadata.crossOrgUserIds||[]).join(",")!==(x||[]).join(",")||"push-notification"===O)&&(R=n(n({},E.metadata),{crossOrgUserIds:Array.from(new Set(a(E.metadata.crossOrgUserIds||[],x||[]))),keywords:Array.from(new Set(a(E.metadata.keywords||[],h.keywords||[]))),profilingAllowed:h.profilingAllowed,userAgent:h.userAgent,visitorIds:Array.from(new Set(a(E.metadata.visitorIds||[],h.visitorIds||[])))}),C="ready"===E.state?"update_pending":E.state,l.setStatus(C,R),E=l.getStatus()),K?(R=E?E.metadata:h,N||c.willExpireSoon(K)?[4,c.replaceSubscription({apiKey:e,appServerKey:r,metadata:n(n({},h),{migrated:N,migratedSubscriptionEndpoint:N?K.endpoint:void 0}),registration:I,subscription:K,subscriptionEndpoint:b})]:[3,13]):[3,18];case 12:return i.sent(),[3,17];case 13:return E&&"register_pending"===E.state?[4,c.registerPushSubscription(b,{subscription:K,metadata:R},e)]:[3,15];case 14:return i.sent(),[3,17];case 15:return E&&"update_pending"===E.state||!E?[4,c.updatePushSubscription(b,{subscription:K,metadata:R},e)]:[3,17];case 16:i.sent(),i.label=17;case 17:return l.setStatus("ready",h),[3,20];case 18:return"granted"!==Notification.permission?[3,20]:(L=E?E.metadata:h,[4,c.subscribePushNotifications({apiKey:e,appServerKey:r,metadata:L,registration:I,subscriptionEndpoint:b})]);case 19:i.sent(),l.setStatus("ready",L),i.label=20;case 20:return[2,I];case 21:return J=i.sent(),f.default(J,{emit:s,metadata:h,rawAppServerKey:w}),[3,22];case 22:return[2,null]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(void 0,void 0,void 0,(function(){return o(this,(function(t){return[2,new Promise((function(t){"complete"!==document.readyState?document.addEventListener("readystatechange",(function(){"complete"===document.readyState&&t()})):t()}))]}))}));e.default=i},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=a(r(0)),u=a(r(1));e.default=function(t,e,r){return o(void 0,void 0,void 0,(function(){var o,a,c,l;return i(this,(function(i){return o=e.type,a=e.action,c=s.default(t,"analytics/track",o,a),l={body:JSON.stringify(e),headers:{"Content-type":"application/json"},method:"post",mode:"cors"},r&&(l.headers=n(n({},l.headers),{Authorization:"ApiKey "+r})),[2,u.default(c,l)]}))}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(25);e.API_ROOT_BY_ENV={development:{central:location.protocol+"//"+location.host+"/public/v1/static/latest/mol-fe-web-push-browser-register",metro:location.protocol+"//"+location.host+"/public/v1/static/latest/mol-fe-web-push-browser-register",mol:location.protocol+"//"+location.host+"/public/v1/static/latest/mol-fe-web-push-browser-register",newzit:location.protocol+"//"+location.host+"/public/v1/static/latest/mol-fe-web-push-browser-register"},integration:{central:"https://hulkint.anm.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",metro:"https://test1.metro.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",mol:"https://www.dailymailint.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",newzit:"https://www.newzitint.com/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register"},production:{central:"https://hulkprod.anm.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",metro:"https://metro.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",mol:"https://www.dailymail.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",newzit:"https://www.newzit.com/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register"}};var a={metro:["metro.co.uk"],mol:["www.dailymail.co.uk","a.dailymail.co.uk","b.dailymail.co.uk","c.dailymail.co.uk"],newzit:["www.newzit.com"]},s=["mol","newzit","metro"],u=function(t,e){var r=new URL(e).hostname;if("localhost"===r||r.endsWith("ngrok.io"))return"development";if(!a[t])throw new Error("No hostnames for organisation: "+t);return a[t].includes(r)?"production":"integration"};e.getCrossOrgUserIdFromCentral=function(t){return n(void 0,void 0,void 0,(function(){var r,n,a;return o(this,(function(o){switch(o.label){case 0:return r=u(t,location.href),n=e.API_ROOT_BY_ENV[r].central+"/crossOrgInlinedMin.html?command=getCrossOrgUserId",[4,i.loadIframeAndWaitForMessage(n,"mol-fe-web-push-cross-org-user-id")];case 1:return[2,(a=o.sent())&&a.crossOrgUserId]}}))}))},e.updateCrossOrgUserIdOnOtherOrgs=function(t,r){return n(void 0,void 0,void 0,(function(){var a;return o(this,(function(c){switch(c.label){case 0:return s.includes(t)?(a=u(t,location.href),[4,Promise.all(s.filter((function(e){return e!==t})).map((function(t){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return n=e.API_ROOT_BY_ENV[a][t]+"/crossOrgInlinedMin.html?command=updateCrossOrgUserId&crossOrgUserId="+r+"&environment="+a,[4,i.loadIframeAndWaitForMessage(n,"mol-fe-web-push-cross-org-update")];case 1:return o.sent(),[2]}}))}))})))]):[2];case 1:return c.sent(),[2]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(e,"__esModule",{value:!0});e.loadIframeAndWaitForMessage=function(t,e){return n(void 0,void 0,void 0,(function(){var r;return o(this,(function(n){return r=new URL(t).origin,[2,new Promise((function(n,o){var i,a=null,s=function(t){t.data.scope===e&&t.origin===r&&(window.removeEventListener("message",s),i&&clearTimeout(i),void 0!==t.data.data?n(t.data.data):o(new Error("Invalid data posted back from crossOrg iframe")),a&&a.remove())};window.addEventListener("message",s),(a=document.createElement("iframe")).style.width="0px",a.style.height="0px",a.style.border="none",a.src=t,document.body.appendChild(a),i=window.setTimeout((function(){window.removeEventListener("message",s),o(new Error("crossOrg iframe timed out")),a&&a.remove()}),1e4)}))]}))}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=i(r(27)),s=r(4),u=r(5),c=i(r(16)),l=i(r(15));e.LAST_PROMPT_EPOCH="mol-fe-browser-notifications-last-prompt-epoch";e.default=function(t,r){return n(void 0,void 0,void 0,(function(){var n,i,f,p,d,h,y,v,m,b,w,g,_,S,O,E,P,x,k,A,T,j,M,I;return o(this,(function(o){switch(o.label){case 0:n=r.apiKey,i=r.appServerKey,f=r.emit,p=r.metadata,d=r.baseEndpoint,h=r.subscriptionEndpoint,y=r.promptFrequency,v=r.rawAppServerKey,o.label=1;case 1:return o.trys.push([1,10,,11]),m=p.channels,b=p.crossOrgUserIds,w=p.platform,g=p.subChannels,_=p.userAgent,S=p.visitorIds,O=Array.isArray(S)?S[0]:void 0,E=Array.isArray(b)?b[0]:void 0,P=Array.isArray(m)?m[0]:void 0,x=Array.isArray(g)?g[0]:void 0,function(t){if(!t)return!0;var r=a.default(t);if("number"!=typeof r)throw new TypeError("Prompt frequency must be a valid string like `1d` or `1h`");if(!("localStorage"in window))return!0;var n=JSON.parse(window.localStorage.getItem(e.LAST_PROMPT_EPOCH)||"0");return Date.now()-n>=r}(y)?[3,2]:(f("prompt_discarded",{action:"discarded",channel:P,crossOrgUserId:E,organisation:p.organisation,permission:Notification.permission,platform:w,subChannel:x,type:"prompt",userAgent:_,visitorId:O}),[3,9]);case 2:return"default"!==Notification.permission?[3,6]:(k={action:"impression",channel:P,crossOrgUserId:E,organisation:p.organisation,permission:Notification.permission,platform:w,subChannel:x,type:"prompt",userAgent:_,visitorId:O},f("prompt_impression",k),[4,c.default(d,k,n)]);case 3:return o.sent(),[4,s.requestPushPermissionAndSubscribe({apiKey:n,appServerKey:i,metadata:p,registration:t,subscriptionEndpoint:h})];case 4:return A=o.sent(),T={action:"click",channel:P,crossOrgUserId:E,organisation:p.organisation,permission:A,platform:w,subChannel:x,type:"prompt",userAgent:_,visitorId:O},f("prompt_click",T),[4,c.default(d,T,n)];case 5:o.sent(),"localStorage"in window&&window.localStorage.setItem(e.LAST_PROMPT_EPOCH,JSON.stringify(Date.now())),o.label=6;case 6:return"granted"!==Notification.permission?[3,8]:[4,t.pushManager.getSubscription()];case 7:return j=o.sent(),M={subscription:j,type:"web-push-sw-subscription-ready"},t.active.postMessage(JSON.stringify(M)),u.setStatus("ready",p),[3,9];case 8:"default"===Notification.permission?u.setStatus("undecided",p):u.clearStatus(),o.label=9;case 9:return[3,11];case 10:return I=o.sent(),l.default(I,{emit:f,metadata:p,rawAppServerKey:v}),[3,11];case 11:return[2]}}))}))}},function(t,e){var r=1e3,n=6e4,o=60*n,i=24*o;function a(t,e,r,n){var o=e>=1.5*r;return Math.round(t/r)+" "+n+(o?"s":"")}t.exports=function(t,e){e=e||{};var s=typeof t;if("string"===s&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*i;case"hours":case"hour":case"hrs":case"hr":case"h":return a*o;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===s&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=i)return a(t,e,i,"day");if(e>=o)return a(t,e,o,"hour");if(e>=n)return a(t,e,n,"minute");if(e>=r)return a(t,e,r,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=i)return Math.round(t/i)+"d";if(e>=o)return Math.round(t/o)+"h";if(e>=n)return Math.round(t/n)+"m";if(e>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e){return void 0===e&&(e=0),"string"!=typeof t||0===t.length||e&&e<t.length},o=function(t){return!Array.isArray(t)||t.length&&t.map(n).every(Boolean)},i=["organisation","platform","profilingAllowed","userAgent"];e.default=function(t){var e,r,a,s,u,c,l,f,p,d,h,y,v,m;if(function(t,e){if(null!==t&&"object"===typeof t){var r=Object.keys(t),n=e&&e.map((function(t){return r.includes(t)})).filter(Boolean).length===e.length;return!r.length||!n}return!0}(t.metadata,i))throw new Error("metadata is required and must be object containing the following required fields "+i.join(", ")+".");if(n(null===(e=t.metadata)||void 0===e?void 0:e.organisation))throw new Error("metadata.organisation is required and must be a non empty string.");if(n(null===(r=t.metadata)||void 0===r?void 0:r.platform))throw new Error("metadata.platform is required and must be a non empty string.");if("boolean"!=typeof(null===(a=t.metadata)||void 0===a?void 0:a.profilingAllowed))throw new Error("metadata.profilingAllowed is required and must be a boolean.");if(n(null===(s=t.metadata)||void 0===s?void 0:s.userAgent))throw new Error("metadata.userAgent is required and must be a non empty string.");if(void 0!==t.swUrl&&n(t.swUrl))throw new Error("swUrl is optional but must be non empty string when provided.");if(void 0!==(null===(u=t.metadata)||void 0===u?void 0:u.visitorIds)&&o(null===(c=t.metadata)||void 0===c?void 0:c.visitorIds))throw new Error("metadata.visitorIds is optional but must be a non empty string array.");if(void 0!==(null===(l=t.metadata)||void 0===l?void 0:l.crossOrgUserIds)&&o(null===(f=t.metadata)||void 0===f?void 0:f.crossOrgUserIds))throw new Error("metadata.crossOrgUserIds is optional but must be a non empty string array.");if(void 0!==(null===(p=t.metadata)||void 0===p?void 0:p.keywords)&&o(null===(d=t.metadata)||void 0===d?void 0:d.keywords))throw new Error("metadata.keywords is optional but must be a non empty string array when provided.");if(void 0!==(null===(h=t.metadata)||void 0===h?void 0:h.channels)&&o(null===(y=t.metadata)||void 0===y?void 0:y.channels))throw new Error("metadata.channels is optional but must be a non empty string array when provided.");if(void 0!==(null===(v=t.metadata)||void 0===v?void 0:v.subChannels)&&o(null===(m=t.metadata)||void 0===m?void 0:m.subChannels))throw new Error("metadata.subChannels is optional but must be a non empty string array when provided.");return t}}])}));
//# sourceMappingURL=register.min.js.map