define("modules/clean/metrics/coin",["require","exports","tslib","apex-metrics/index","dropbox/proto/apex_metrics_web/apex_metrics_web","google/protobuf/timestamp","google/protobuf/empty"],function(e,t,p,d,n,m,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.observeCoin=t.APIv2CoinToProtobufCoin=t.protobufCoinToAPIv2Coin=t.newCoinState=void 0,t.newCoinState=function(){return n.apex_metrics_web.ApexMetricsCacheData.CoinState.create({lastFlipTime:null,lastResult:!1,numTimesChecked:0})},t.protobufCoinToAPIv2Coin=function(e){var t=void 0;if(e.stickiness&&e.stickiness.limit)switch(e.stickiness.limit){case"independent":t={".tag":"independent"};break;case"permanent":t={".tag":"permanent"};break;case"nResults":t={".tag":"n_results",n_results:e.stickiness.nResults};break;case"nSeconds":t={".tag":"n_seconds",n_seconds:e.stickiness.nSeconds}}return{fraction:null!==e.fraction?e.fraction:void 0,stickiness:t?{limit:t}:void 0}},t.APIv2CoinToProtobufCoin=function(e){var t=void 0;if(e.stickiness&&e.stickiness.limit)switch(e.stickiness.limit[".tag"]){case"independent":t={independent:i.google.protobuf.Empty.create()};break;case"permanent":t={permanent:i.google.protobuf.Empty.create()};break;case"n_results":t={nResults:e.stickiness.limit.n_results};break;case"n_seconds":t={nSeconds:e.stickiness.limit.n_seconds}}return n.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.create({fraction:e.fraction,stickiness:t?n.apex_metrics_web.RecordNamespace.StickinessV2.create(t):void 0})},t.observeCoin=function(e,t,n){if(!t.stickiness||!t.stickiness.limit)return{nextState:n,result:!1};var i,r,o=Date.now()/1e3,a=n.lastFlipTime,s=void 0===a?m.google.protobuf.Timestamp.create({seconds:0,nanos:0}):a,c=n.lastResult,a=n.numTimesChecked,u=void 0===a?0:a,l=!1;switch(t.stickiness.limit[".tag"]){case"n_results":l=null===u||u%t.stickiness.limit.n_results==0;break;case"n_seconds":if(!s){l=!0;break}l=d.Instant.toMilliseconds({value:(r=s.seconds,"number"!=typeof(i=o)?i.sub(r).toNumber():"number"==typeof r?i-r:r.sub(i).negate().toNumber()),unit:d.TimeUnit.SECONDS})>d.Instant.toMilliseconds({value:t.stickiness.limit.n_seconds,unit:d.TimeUnit.SECONDS});break;case"permanent":l=0===u;break;case"independent":l=!0;break;default:return{nextState:n,result:!1}}if(l){e=e()<(t.fraction||0);return{nextState:{lastFlipTime:m.google.protobuf.Timestamp.create({seconds:o,nanos:0}),lastResult:e,numTimesChecked:u?u+1:1},result:e}}return{nextState:p.__assign(p.__assign({},n),{numTimesChecked:u?u+1:1}),result:!!c}}}),define("modules/clean/metrics/database",["require","exports","tslib"],function(e,l,c){"use strict";function r(e,t,n){function i(e){o.removeEventListener("error",i),n(e)}var r,o=e.result;if(o.addEventListener("error",i),e.transaction.addEventListener("complete",function(){o.removeEventListener("error",i)}),e.transaction.addEventListener("error",function(e){o.removeEventListener("error",i),n(e)}),t.oldVersion<1)try{o.createObjectStore(l.SPAN_STORE,{keyPath:["namespace","tagNames","tagValues"]}).createIndex(l.NAMESPACE_INDEX,"namespace",{unique:!1}),o.createObjectStore(l.CONTROL_VALUE_STORE,{keyPath:"name"})}catch(e){return i(e),0}t.oldVersion<2&&(r=e.transaction.objectStore(l.SPAN_STORE).openCursor()).addEventListener("success",function(e){var t=r.result;if(t){var n,i=!1;for(n in t.value.spans)t.value.spans.hasOwnProperty(n)&&(i=!0,t.value.spans[n]={spanCount:0,samples:t.value.spans[n]});i&&t.update(t.value),t.continue()}})}Object.defineProperty(l,"__esModule",{value:!0}),l.storeIncomingSpans=l.checkAndSetPublishTime=l.getDatabase=l.getNamespaceRange=l.CONTROL_VALUE_LASTPUBLISHTIME=l.CONTROL_VALUE_STORE=l.NAMESPACE_INDEX=l.SPAN_STORE=l.DATABASE_VERSION=void 0,l.DATABASE_VERSION=2,l.SPAN_STORE="spans",l.NAMESPACE_INDEX="namespace",l.CONTROL_VALUE_STORE="controlValues",l.CONTROL_VALUE_LASTPUBLISHTIME="lastPublishTime",l.getNamespaceRange=function(e,r){return new Promise(function(n,t){var i=e.index(l.NAMESPACE_INDEX).getKey(IDBKeyRange.lowerBound(r,!0));i.addEventListener("success",function(e){var t;i.result?(t=i.result[0],n(IDBKeyRange.bound([r],[t],!1,!0))):n(IDBKeyRange.lowerBound([r]))}),i.addEventListener("error",function(e){t(e)})})},l.getDatabase=function(i){return void 0===i&&(i=l.DATABASE_VERSION),c.__awaiter(this,void 0,Promise,function(){var t,n;return c.__generator(this,function(e){switch(e.label){case 0:if(t=null,"undefined"==typeof indexedDB)return[2,t];e.label=1;case 1:return e.trys.push([1,3,,7]),[4,new Promise(function(e,t){var n=indexedDB.open("apexMetrics",i);n.addEventListener("success",function(){e(n.result)}),n.addEventListener("error",function(e){t(e)}),n.addEventListener("upgradeneeded",function(e){try{r(n,e,t)}catch(e){t(e)}})})];case 2:return t=e.sent(),[3,7];case 3:return(n=e.sent()).target&&n.target.error&&n.target.error.name&&"VersionError"===n.target.error.name?[4,new Promise(function(e,t){var n=indexedDB.deleteDatabase("apexMetrics");n.addEventListener("success",function(){return e()}),n.addEventListener("error",function(e){return t(e)})})]:[3,6];case 4:return e.sent(),[4,new Promise(function(e,t){var n=indexedDB.open("apexMetrics",i);n.addEventListener("success",function(){return e(n.result)}),n.addEventListener("error",function(e){return t(e)}),n.addEventListener("upgradeneeded",function(e){try{r(n,e,t)}catch(e){t(e)}})})];case 5:t=e.sent(),e.label=6;case 6:return[3,7];case 7:return[2,t]}})})},l.checkAndSetPublishTime=function(t,a,s){var e=this;return new Promise(function(r,o){return c.__awaiter(e,void 0,void 0,function(){var n,i;return c.__generator(this,function(e){try{n=t.transaction(l.CONTROL_VALUE_STORE,"readwrite").objectStore(l.CONTROL_VALUE_STORE)}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return r(!1),[2];throw e}return(i=n.get(l.CONTROL_VALUE_LASTPUBLISHTIME)).addEventListener("success",function(e){var t=i.result;t&&a-+t.value<s?r(!1):((t=n.put({name:l.CONTROL_VALUE_LASTPUBLISHTIME,value:a})).addEventListener("success",function(){r(!0)}),t.addEventListener("error",function(e){o(e)}))}),i.addEventListener("error",function(e){o(e)}),[2]})})})},l.storeIncomingSpans=function(u,e){return Promise.all(e.map(function(c){return new Promise(function(t,n){var e;try{e=u.transaction(l.SPAN_STORE,"readwrite")}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return void t();throw e}var i=e.objectStore(l.SPAN_STORE);e.addEventListener("complete",function(e){return t()}),e.addEventListener("error",function(e){return n(e)});var r,o=[],a=[];for(r in c.tags)c.tags.hasOwnProperty(r)&&(o.push(r),a.push(c.tags[r]));var s=i.get([c.namespace,o,a]);s.addEventListener("success",function(e){var t=s.result||{namespace:c.namespace,tagNames:o,tagValues:a,spans:{}};t.spans[c.metricName]||(t.spans[c.metricName]={spanCount:0,samples:[]}),t.spans[c.metricName].spanCount++,t.spans[c.metricName].samples=t.spans[c.metricName].samples.concat(c.samples),t.spans[c.metricName].samples.sort(),i.put(t)})})}))}}),define("modules/clean/metrics/filter",["require","exports","tslib","modules/clean/metrics/coin","modules/clean/metrics/database","modules/clean/metrics/serialization"],function(e,t,S,y,T,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpanGroupFilter=t.makeNamespaceMap=void 0,t.makeNamespaceMap=function(e,t){for(var n={},i=0,r=e;i<r.length;i++){var o=r[i],a=o.metric_namespace;n[a]={dropFractionOfHostsPerMetric:o.drop_fraction_of_hosts_per_metric||null,dropPeriodCoin:o.drop_periods?{config:o.drop_periods,state:t.namespaceCoinState&&t.namespaceCoinState[a]&&t.namespaceCoinState[a].dropPeriodCoin||y.newCoinState()}:null,dropSamplesCoin:o.drop_samples?{config:o.drop_samples,state:t.namespaceCoinState&&t.namespaceCoinState[a]&&t.namespaceCoinState[a].dropSamplesCoin||y.newCoinState()}:null}}return n};var n=(i.prototype.extend=function(e,t,n){return new i(this.filterID,this.randomEngine,this.clock,e||this.maxScopes,S.__assign(S.__assign({},this.namespaceMap),t),n)},i.prototype.getState=function(){var e,t={filterID:this.filterID,namespaceCoinState:{}};for(e in this.namespaceMap)this.namespaceMap.hasOwnProperty(e)&&(t.namespaceCoinState[e]={dropPeriodCoin:this.namespaceMap[e].dropPeriodCoin?S.__assign({},this.namespaceMap[e].dropPeriodCoin.state):null,dropSamplesCoin:this.namespaceMap[e].dropSamplesCoin?S.__assign({},this.namespaceMap[e].dropSamplesCoin.state):null});return t},i.prototype.getConfiguredNamespaces=function(){return this.configuredNamespaces},i.prototype.partitionAndSerializeSpans=function(r,u,w,b){return S.__awaiter(this,void 0,Promise,function(){var i=this;return S.__generator(this,function(e){return[2,new Promise(function(t,a){var e,h=[],g=0,v=0;try{e=r.transaction(T.SPAN_STORE,"readwrite")}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return void t(null);throw e}e.addEventListener("complete",function(){return t([h,g,v])}),e.addEventListener("error",function(e){return a(e)});var n,s=e.objectStore(T.SPAN_STORE);try{n=s.index(T.NAMESPACE_INDEX)}catch(e){return void a(e)}var c=n.openKeyCursor(null,"nextunique");c.addEventListener("success",function(){return S.__awaiter(i,void 0,void 0,function(){var l,p,t,d,m,n,i,r,f,_,o=this;return S.__generator(this,function(e){switch(e.label){case 0:if(!(l=c.result))return[2];if(0!==this.maxScopes&&h.length===this.maxScopes)return[2];if(p=l.key,!this.configuredNamespaces.has(p))return l.continue(),[2];r=this.namespaceMap[p]||{},t=r.dropPeriodCoin,d=r.dropSamplesCoin,m=r.dropFractionOfHostsPerMetric,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,T.getNamespaceRange(s,p)];case 2:return n=e.sent(),[3,4];case 3:return i=e.sent(),a(i),[2];case 4:return t&&(r=y.observeCoin(this.randomEngine,t.config,t.state),i=r.result,r=r.nextState,t.state=r,i)?(s.delete(n),l.continue()):(f={metric_namespace:p,timestamp_sec:w,tags:E.formatTags(u),descendants:[]},(_=s.openCursor(n)).addEventListener("success",function(){return S.__awaiter(o,void 0,void 0,function(){var t,n,i,r,o,a,s,c,u=this;return S.__generator(this,function(e){switch(e.label){case 0:if(!(t=_.result))return 0<f.descendants.length&&h.push(f),l.continue(),[2];for(o in n={tags:E.zipTags(t.value.tagNames,t.value.tagValues),metrics:[]},i=t.value.spans,r=[],i)r.push(o);a=0,e.label=1;case 1:return a<r.length?(s=r[a],i.hasOwnProperty(s)?m?[4,function(i,r){return S.__awaiter(this,void 0,Promise,function(){var t,n;return S.__generator(this,function(e){switch(e.label){case 0:return t=null,crypto.subtle&&window.TextEncoder?(n=new TextEncoder,[4,crypto.subtle.digest("SHA-256",n.encode(r))]):[3,2];case 1:n=e.sent(),n=new Uint32Array(n),t=n.reduce(function(e,t){return e^t}),e.label=2;case 2:return null===t?[2,0]:[2,((t^i)>>>0)/4294967296]}})})}(this.filterID,s)]:[3,3]:[3,4]):[3,5];case 2:if(e.sent()<m)return[3,4];e.label=3;case 3:if(c=i[s].samples,0===(c=d?c.filter(function(e){var t=y.observeCoin(u.randomEngine,d.config,d.state),n=t.result,t=t.nextState;return d.state=t,!n}):c).length)return[3,4];b.includes(p)||(g+=i[s].spanCount,v+=c.length),n.metrics.push({name:{value:{".tag":"string_value",string_value:s}},data:{".tag":"numerical_data",samples:c}}),e.label=4;case 4:return a++,[3,1];case 5:return 0<n.metrics.length&&f.descendants.push(n),t.delete(),t.continue(),[2]}})})})),[2]}})})})})]})})},i);function i(e,t,n,i,r,o){this.filterID=e,this.randomEngine=t,this.clock=n,this.maxScopes=i,this.namespaceMap=r,this.configuredNamespaces=o}t.SpanGroupFilter=n}),define("modules/clean/metrics/index",["require","exports","apex-metrics/index","api_v2/noauth_client","modules/clean/metrics/database","modules/clean/metrics/apiv2_sink","modules/clean/metrics/server_view_sink"],function(e,t,n,i,r,o,a){"use strict";function s(){return new n.BrowserPerformanceClock}Object.defineProperty(t,"__esModule",{value:!0}),t.getMetricsReporter=void 0;var i=new i.NoAuthApiV2Client,c=new o.Apiv2MetricsSink(i,s(),o.makeDefaultInitialization(i),o.makeDefaultCacheFactory(),new n.SetTimeoutExecutor(function(){return{value:5*Math.random(),unit:n.TimeUnit.SECONDS}}),Math.random,r.getDatabase),u=new a.ServerViewMetricsSink;t.getMetricsReporter=function(){return void 0!==window._clientBridge?n.MetricsReporterImpl.root(u,s()):n.MetricsReporterImpl.root(c,s())}}),define("modules/clean/metrics/serialization",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zipTags=t.formatTags=void 0,t.formatTags=function(e){var t,n,i=[];for(t in e)e.hasOwnProperty(t)&&(n=e[t],i.push({name:{value:{".tag":"string_value",string_value:t}},value:{value:{".tag":"string_value",string_value:n}}}));return i},t.zipTags=function(e,n){if(e.length!==n.length)throw new Error("Cannot zip values of different dimensions!");return e.map(function(e,t){return{name:{value:{".tag":"string_value",string_value:e}},value:{value:{".tag":"string_value",string_value:n[t]}}}})}}),define("modules/clean/metrics/apiv2_sink",["require","exports","tslib","apex-metrics/index","eventemitter3","modules/clean/metrics/coin","modules/clean/metrics/database","modules/clean/metrics/filter","modules/core/browser_detection","modules/constants/page_load","modules/core/exception","google/protobuf/timestamp","dropbox/proto/apex_metrics_web/apex_metrics_web","proto_utils/unpack"],function(e,u,w,b,c,l,r,s,S,o,p,d,m,f){"use strict";var y;Object.defineProperty(u,"__esModule",{value:!0}),u.Apiv2MetricsSink=u.recordInstrumentation=u.makeDefaultCacheFactory=u._PERSISTENTCACHE_KEY=u.makeDefaultInitialization=u.PublishType=void 0,c=w.__importDefault(c),S=w.__importStar(S),p=w.__importStar(p),(t=y=u.PublishType||(u.PublishType={})).ALLOWED="allowed",t.DENIED="denied";var _={".tag":"trigger_heartbeat"},T={".tag":"trigger_publish"},a={client_version:6,implementation:{".tag":"typescript"}};function E(e,t,n){var i=[];return t.forEach(function(e){return i.push(e)}),{scopes:e,known_namespaces:i,environment:"prod",artifact_name:"dropbox-web",artifact_version:o.REPO_REV,client_metadata:a,trigger:n,os:S.mac?{name:{".tag":"mac"},version:"unknown"}:S.windows?{name:{".tag":"windows"},version:(n=S.windowsInfo).windowsXP||n.windowsXPx64?"XP":n.windowsVista?"Vista":n.windows7?"7":n.windows8?"8":n.windows8_1?"8.1":n.windows10?"10 Unknown":"unknown"}:S.is_android()?{name:{".tag":"android"},version:"unknown"}:S.iOS?{name:{".tag":"ios"},version:"unknown"}:{name:{".tag":"unknown_os"},version:"unknown"}}}function x(n,e,t,i,r,o){function a(e,t){n.createStats({ns:"amp_client",name:e}).record(t)}a("samples_sink/submitted_spans",e),a("samples_sink/submitted_samples",t),a("samples_sink/request/latency",i),a("samples_sink/request/dropped_spans",r),a("samples_sink/request/dropped_samples",o)}u.makeDefaultInitialization=function(c){var e=this;return function(s){return w.__awaiter(e,void 0,void 0,function(){var t,n,i,r,o,a;return w.__generator(this,function(e){switch(e.label){case 0:return t=[],s&&(n=function(){var e=s.getItem(u._PERSISTENTCACHE_KEY);if(null===e)return null;var t,n=Date.now()/1e3,i=[];try{t=f.unpackProto(e,m.apex_metrics_web.ApexMetricsCacheData)}catch(e){return p.reportException({err:e,tags:["js:web:amp-sink","js:web:amp-sink/local-storage"],severity:"non-critical"}),null}if(!t.config||!t.state||!t.timeStored)return p.reportStack("Sink cache was missing data",{tags:["js:web:amp-sink","js:web:amp-sink/local-storage"]}),null;var r=(e=n,n=t.timeStored.seconds,"number"!=typeof e?e.sub(n).toNumber():"number"==typeof n?e-n:n.sub(e).negate().toNumber());if(r<0)return p.reportStack("Sink cache was stored in the future instead of the past",{tags:["js:web:amp-sink","js:web:amp-sink/local-storage"]}),null;e={};return t.config&&(i=t.config.reportingConfigs.map(function(e){return e.metricNamespace}),e.reporting_configs=t.config.reportingConfigs?t.config.reportingConfigs.filter(function(e){return r<e.maxTimeUntilRefreshSeconds}).map(function(e){return{metric_namespace:e.metricNamespace,max_time_until_refresh_seconds:e.maxTimeUntilRefreshSeconds,stop_publication_for_seconds:e.stopPublicationForSeconds,drop_samples:e.dropSamples?l.protobufCoinToAPIv2Coin(e.dropSamples):void 0,drop_periods:e.dropPeriods?l.protobufCoinToAPIv2Coin(e.dropPeriods):void 0,drop_fraction_of_hosts_per_metric:e.dropFractionOfHostsPerMetric,aggregation_interval_seconds:e.aggregationIntervalSeconds}}):[],e.publication_interval_seconds=t.config.publicationIntervalSeconds,e.max_scopes_per_request=t.config.maxScopesPerRequest,e.stop_publication_for_seconds=t.config.stopPublicationForSeconds,e.debug_infos=t.config.debugInfos),{config:e,state:t.state,knownNamespaces:i}}())&&(t=n.knownNamespaces,i=new Set,n.config.reporting_configs.forEach(function(e){return i.add(e.metric_namespace)}),!t.some(function(e){return!i.has(e)}))?[2,n]:(r=new Set,t.forEach(function(e){return r.add(e)}),[4,c.ns("client_metrics").rpc("record",E([],r,_),{})]);case 1:return o=e.sent(),a=Math.floor(4294967296*Math.random())>>>0,[2,{knownNamespaces:t,config:o,state:{filterID:a,namespaceCoinState:{}}}]}})})}},u._PERSISTENTCACHE_KEY="amp-sink-cache",u.makeDefaultCacheFactory=function(){return function(){try{return window.localStorage||null}catch(e){return null}}},u.recordInstrumentation=x;var t=(n.prototype.updateConfiguration=function(e,t){var n=this,i=e.reporting_configs,r=void 0===i?[]:i,o=e.stop_publication_for_seconds,i=e.publication_interval_seconds,a=new Set;r.forEach(function(e){n.knownNamespaces.add(e.metric_namespace),a.add(e.metric_namespace)}),this.updateBlackoutCallback({value:o,unit:b.TimeUnit.SECONDS}),this.updatePublishTimer({value:i,unit:b.TimeUnit.SECONDS}),this.updateSpanGroupFilter(e,t,a),this.cache&&function(e,t,n){try{var i=Math.floor(Date.now()/1e3),r=m.apex_metrics_web.ApexMetricsCacheData.create({config:m.apex_metrics_web.RecordNamespace.RecordResponse.create({reportingConfigs:t.reporting_configs?t.reporting_configs.map(function(e){return m.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.create({metricNamespace:e.metric_namespace,maxTimeUntilRefreshSeconds:e.max_time_until_refresh_seconds,stopPublicationForSeconds:e.stop_publication_for_seconds,dropSamples:e.drop_samples?l.APIv2CoinToProtobufCoin(e.drop_samples):void 0,dropPeriods:e.drop_periods?l.APIv2CoinToProtobufCoin(e.drop_periods):void 0,dropFractionOfHostsPerMetric:e.drop_fraction_of_hosts_per_metric,aggregationIntervalSeconds:e.aggregation_interval_seconds})}):[],publicationIntervalSeconds:t.publication_interval_seconds,maxScopesPerRequest:t.max_scopes_per_request,stopPublicationForSeconds:t.stop_publication_for_seconds,debugInfos:t.debug_infos||[]}),timeStored:d.google.protobuf.Timestamp.create({seconds:i,nanos:0}),state:n});e.setItem(u._PERSISTENTCACHE_KEY,f.packProto(r))}catch(e){}}(this.cache,e,t)},n.prototype.updateSpanGroupFilter=function(e,t,n){for(var i=e.reporting_configs,i=void 0===i?[]:i,e=e.max_scopes_per_request,r=new Set,o=n.values(),a=o.next();!a.done;a=o.next())r.add(a.value);i=s.makeNamespaceMap(i,t);this.spanGroupFilter=this.spanGroupFilter?this.spanGroupFilter.extend(e,i,r):new s.SpanGroupFilter(t.filterID,this.randomEngine,this.clock,e,i,r)},n.prototype.updateBlackoutCallback=function(e){var t=this;0!==e.value?(this.blackoutCallback=function(){return t.blackoutCallback=null,t.eventEmitter.emit("publicationResumed"),!1},this.eventEmitter.emit("publicationPaused"),this.executor.executeEvery(e,this.blackoutCallback)):this.blackoutCallback=null},n.prototype.updatePublishTimer=function(e){var t,n=this,i=e.unit===b.TimeUnit.SECONDS?e.value:b.Instant.toMilliseconds(e)/1e3;0!==e.value?this.publishTimer&&b.Instant.toMilliseconds(this.publishTimer.period)===b.Instant.toMilliseconds(e)||(t={period:e,callback:function(){return n.publishTimer===t&&(n.nextRequest=n.currentRequest.then(function(){return w.__awaiter(n,void 0,void 0,function(){var t,n;return w.__generator(this,function(e){switch(e.label){case 0:return this.nextRequest=null,t=Math.floor(Date.now()/1e3),[4,this.getDB()];case 1:if(!(n=e.sent()))return[2];e.label=2;case 2:return e.trys.push([2,4,,5]),[4,r.checkAndSetPublishTime(n,t,i)];case 3:return e.sent()&&(this.currentRequest=this.send()),[3,5];case 4:return e.sent(),[3,5];case 5:return[2]}})})}),!0)}},this.publishTimer=t,this.executor.executeEvery(this.publishTimer.period,this.publishTimer.callback)):this.publishTimer=null},n.prototype.send=function(){return w.__awaiter(this,void 0,Promise,function(){var t,n,i,r,o,a,s,c,u,l,p,d,m,f,_,h,g,v;return w.__generator(this,function(e){switch(e.label){case 0:if(this.blackoutCallback)return this.eventEmitter.emit("publish",y.DENIED),[2,null];for(t=Math.floor(Date.now()/1e3),a=[[S.chrome,"chrome"],[S.edge,"edge"],[S.mozilla,"firefox"],[S.msie,"msie"],[S.safari,"safari"]],n="other",i=0,r=a;i<r.length;i++)if((o=r[i])[0]){n=o[1];break}return a={browser:n},[4,this.getDB()];case 1:if(!(s=e.sent()))return[2,null];c=[],l=u=0,e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.spanGroupFilter.partitionAndSerializeSpans(s,a,t,["amp_client"])];case 3:return(p=e.sent())&&(c=p[0],u=p[1],l=p[2]),[3,5];case 4:if((p=e.sent())instanceof DOMException&&("InvalidStateError"===p.name||11===p.code))return[2,null];throw p;case 5:if(d=null,!(m=0<c.length))for(f=this.spanGroupFilter.getConfiguredNamespaces(),_=this.knownNamespaces.values(),h=_.next();!h.done;h=_.next())if(!f.has(h.value)){m=!0;break}if(!m)return[3,10];g=E(c,this.knownNamespaces,T),v=this.clock.now(),e.label=6;case 6:return e.trys.push([6,8,,9]),[4,this.client.ns("client_metrics").rpc("record",g,{})];case 7:return d=e.sent(),0!==u&&x(b.MetricsReporterImpl.root(this,this.clock),u,l,b.Instant.toMilliseconds(this.clock.now())-b.Instant.toMilliseconds(v),0,0),[3,9];case 8:return e.sent(),0!==u&&x(b.MetricsReporterImpl.root(this,this.clock),0,0,-1,u,l),[2,null];case 9:this.updateConfiguration(d,this.spanGroupFilter.getState()),e.label=10;case 10:return this.eventEmitter.emit("publish",y.ALLOWED),[2,d]}})})},n.prototype.getDB=function(){return w.__awaiter(this,void 0,Promise,function(){var t;return w.__generator(this,function(e){switch(e.label){case 0:return this.database?[3,2]:[4,(t=this).databaseFactory()];case 1:t.database=e.sent(),e.label=2;case 2:return[2,this.database]}})})},n.prototype.recordSpan=function(e){var t=this;this.knownNamespaces.add(e.namespace),this.bufferedSpans.push(e),this.nextRequest||(this.nextRequest=this.currentRequest.then(function(){return w.__awaiter(t,void 0,void 0,function(){var t;return w.__generator(this,function(e){switch(e.label){case 0:return[4,this.getDB()];case 1:if(!(t=e.sent()))return[2];e.label=2;case 2:return e.trys.push([2,4,,5]),[4,r.storeIncomingSpans(t,this.bufferedSpans)];case 3:case 4:return e.sent(),[3,5];case 5:return this.bufferedSpans=[],this.publishTimer||(this.currentRequest=this.send()),this.nextRequest=null,[2]}})})}))},n);function n(e,t,n,i,r,o,a){var s=this;this.client=e,this.clock=t,this.initializer=n,this.cacheFactory=i,this.executor=r,this.randomEngine=o,this.databaseFactory=a,this.nextRequest=null,this.knownNamespaces=new Set,this.bufferedSpans=[],this.eventEmitter=new c.default,this.cache=this.cacheFactory(),this.currentRequest=this.initializer(this.cache).then(function(e){return e&&s.updateConfiguration(e.config,e.state),s.eventEmitter.emit("initialized"),e.config||null})}u.Apiv2MetricsSink=t}),define("modules/clean/metrics/server_view_sink",["require","exports","tslib"],function(i,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ServerViewMetricsSink=void 0;var t=(n.prototype.recordSpan=function(e){this.spans.push(e),this.bridgeInitialized||this.initializeBridgeSink()},n.prototype.initializeBridgeSink=function(){return r.__awaiter(this,void 0,Promise,function(){var t,n=this;return r.__generator(this,function(e){switch(e.label){case 0:return this.bridgeInitialized=!0,[4,new Promise(function(e,t){i(["modules/clean/server_side_client_view_bridge"],e,t)}).then(r.__importStar)];case 1:return[4,(t=e.sent()).IsBridgeFunctionSupported("reportMetricsV2")];case 2:return e.sent()?(setInterval(function(){0<n.spans.length&&(t.ReportMetrics(n.spans),n.spans=[])},5e3),window.addEventListener("beforeunload",function(){0<n.spans.length&&(console.log("Attempting to send "+n.spans.length+" pending AMP spans"),t.ReportMetrics(n.spans),n.spans=[])})):setInterval(function(){this.spans=[]},6e4),[2]}})})},n);function n(){this.spans=[],this.bridgeInitialized=!1}e.ServerViewMetricsSink=t}),define("modules/clean/perf_tools/resource_utils",["require","exports","tslib","modules/core/browser","modules/clean/js_client_stopwatch","modules/clean/perf_tools/cpu_utils"],function(e,t,n,l,p,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.summarizePerformanceResourceTimings=t.logResourceTiming=t.logResourcesData=void 0,l=n.__importStar(l),r=n.__importStar(r),t.logResourcesData=function(e){var t,n,i;t=e,(i=window.requireContexts)&&(i=r.listExecutionPerfMeasurementsForRequireContexts(i),n=p.JSStopwatch.createDetachedStopwatch("resource_init_timeline",t),i.forEach(function(e){var t=n.startSpan(e.name,{startTime:e.startTime});n.addSpanAnnotation(e.name,"totalTimeNs",Math.round(1e6*e.totalTime).toString(),t),n.endSpan(e.name,{endTime:e.startTime+e.totalTime,spanId:t})}),n.logData()),function(e){var t=l.performance();if(t&&t.getEntriesByType){var n=p.JSStopwatch.createDetachedStopwatch("resource_timeline",e),i={},t=t.getEntriesByType("resource");if(t instanceof Array)for(var r=0,o=t;r<o.length;r++){var a,s,c=o[r],u=function(e){if(d){if(d.href=e.name,d.host.match(/dropboxstatic.com$/)&&d.pathname.match(/^\/static/)){var t=d.pathname,e=t.match(/vfl[a-zA-Z0-9]*\.[a-z]*$/);e&&e.index&&(t=t.substring(0,e.index-1));for(var n=0,i=["/static/js/","/static/"];n<i.length;n++){var r=i[n];t.startsWith(r)&&(t=t.substring(r.length))}return t}return d.host.match(/photos-[0-9]+.dropbox.com$/)&&d.pathname.match(/^\/t\/2/)?"/thumbnail":void 0}}(c);u&&(s=i[u]||0,i[u]=s+1,a=n.startSpan(u=0<s?u+"-"+s:u,{startTime:c.startTime,async:!0}),s=m(c),n.addSpanAnnotation(u,"type",s,a),0===c.transferSize?n.addSpanAnnotation(u,"cached","true",a):void 0===c.transferSize?n.addSpanAnnotation(u,"cached","unknown",a):n.addSpanAnnotation(u,"cached","false",a),c.responseEnd<c.startTime?(n.addSpanAnnotation(u,"negativeSpanLength",(c.responseEnd-c.startTime).toString(),a),n.endSpan(u,{endTime:c.startTime,spanId:a})):n.endSpan(u,{endTime:c.responseEnd,spanId:a}))}n.logData()}}(e)};var d=document&&document.createElement?document.createElement("a"):null;function m(e){var t=e.name,n=e.initiatorType,e=t.lastIndexOf(".");if(0<e){e=t.substring(e);if(-1<[".png",".gif",".jpg",".svg"].indexOf(e))return"img";if(".js"===e)return"script";if(".css"===e)return"css"}return-1===["css","img","script","link"].indexOf(n)?"xmlhttprequest"===n?"ajax":"other":n}t.logResourceTiming=function(t){var e=l.performance();if(e&&e.getEntriesByType){var n=e.getEntriesByType("resource").filter(function(e){return-1!==e.name.indexOf(t)})[0];if(n&&n.responseEnd){e="resource_response_end_"+t;return p.JSStopwatch.create_stopwatch_if_not_exist("resource_timing"),p.JSStopwatch.recordTrace(e,{stopwatchName:"resource_timing",traceTime:n.responseEnd}),n}}},t.summarizePerformanceResourceTimings=function(e,i){void 0===i&&(i=void 0);var r={pre:{},total:{}};if(p.JSStopwatch.create_stopwatch_if_not_exist("resource_timeline"),e instanceof Array)for(var t=0,n=e;t<n.length;t++)!function(t){var n=m(t),e=[];i&&t.responseEnd<=i&&(n in r.pre||(r.pre[n]={count:0,total_time:0,last_transfer_end:0}),e.push(r.pre[n])),n in r.total||(r.total[n]={count:0,total_time:0,last_transfer_end:0}),e.push(r.total[n]),e.forEach(function(e){e.count++,e.total_time+=t.duration,e.last_transfer_end=Math.max(e.last_transfer_end,t.responseEnd),"css"!==n&&"script"!==n&&"img"!==n||void 0===t.transferSize||void 0===t.encodedBodySize||(e.total_size=e.total_size||0,e.transfer_size=e.transfer_size||0,0!==t.transferSize&&(e.transfer_size+=t.encodedBodySize),e.total_size=e.total_size||0,e.total_size+=t.encodedBodySize)})}(n[t]);return r}}),define("modules/clean/perf_tools/cpu_utils",["require","exports","modules/clean/js_client_stopwatch"],function(e,r,o){"use strict";var i,t;function n(e){var t,n,i=[];for(t in e)e.hasOwnProperty(t)&&(n=e[t],i=i.concat(function(e){if(e.require&&e.require.perfMeasurements){var i=0;return e.require.perfMeasurements.map(function(e){var t=e.name,n=e.startTime,e=e.totalTime;return t.endsWith("anon")&&(t+="-"+i++),{jsExecutionType:s(t),name:t,startTime:n,totalTime:e}})}var t=e.module_callback_times;return Object.keys(t).filter(function(e){return t[e].callbackDuration&&t[e].callbackTime}).map(function(e){return{jsExecutionType:s(e),name:e,startTime:t[e].callbackTime,totalTime:t[e].callbackDuration}})}(n)));return i}function a(n){return Object.keys(n).map(function(e){var t=n[e];return{measurement:{jsExecutionType:e.startsWith("dws-processChunk")?i.DWS:i.UNKNOWN,name:e,startTime:t.start,totalTime:t.end-t.start},annotations:t.annotations}})}function s(e){return e.startsWith("execCb.anon")||e.startsWith("overhead.anon")||e.startsWith("execCb.require-tier")||e.startsWith("overhead.require-tier")?i.OTHER:e.startsWith("execCb")||e.startsWith("overhead")?i.MODULE:i.UNKNOWN}Object.defineProperty(r,"__esModule",{value:!0}),r.logCumulativeExecutionTimes=r.cumulativeExecutionTimesBefore=r.listAnnotatedExecutionPerfMeasurementsForEnsemble=r.listExecutionPerfMeasurementsForRequireContexts=r.getAllGlobalExecutionPerfMeasurements=r.ALL_JS_EXECUTION_TYPES=r.JSExecutionType=void 0,(t=i=r.JSExecutionType||(r.JSExecutionType={})).DWS="dws",t.MODULE="module",t.OTHER="other",t.UNKNOWN="unknown",r.ALL_JS_EXECUTION_TYPES=[i.DWS,i.MODULE,i.OTHER,i.UNKNOWN],r.getAllGlobalExecutionPerfMeasurements=function(){var e=[];return window.ensemble&&window.ensemble.getJSStopwatchData&&(e=e.concat(a(window.ensemble.getJSStopwatchData()).map(function(e){return e.measurement}))),e=window.requireContexts?e.concat(n(window.requireContexts)):e},r.listExecutionPerfMeasurementsForRequireContexts=n,r.listAnnotatedExecutionPerfMeasurementsForEnsemble=a,r.cumulativeExecutionTimesBefore=function(e,i){var t,r={};for(t in e)!function(t){var n;e.hasOwnProperty(t)&&(n=e[t],r[t]={},i.forEach(function(e){0<e.startTime&&e.startTime<n&&(r[t][e.jsExecutionType]=r[t][e.jsExecutionType]||0,r[t][e.jsExecutionType]+=e.totalTime)}))}(t);return r},r.logCumulativeExecutionTimes=function(e,n){var t,i=o.JSStopwatch.createDetachedStopwatch("cumulative_cpu_time",e);for(t in n)!function(t){n.hasOwnProperty(t)&&r.ALL_JS_EXECUTION_TYPES.forEach(function(e){i.recordTrace("cpu_before_"+t+"_due_to_"+e,n[t][e]||0)})}(t);i.logData()}}),define("modules/clean/perf_tools/browser_perf_utils",["require","exports","tslib","modules/core/browser","modules/core/xhr","modules/constants/request","modules/clean/js_client_stopwatch","modules/constants/webtiming"],function(e,t,n,s,c,u,l,p){"use strict";function i(e){var t=s.performance();if(t&&t.timing){var n=t.timing,i={navigation_start:n.navigationStart,unload_event_start:n.unloadEventStart,unload_event_end:n.unloadEventEnd,redirect_start:n.redirectStart,redirect_end:n.redirectEnd,fetch_start:n.fetchStart,domain_lookup_start:n.domainLookupStart,domain_lookup_end:n.domainLookupEnd,connect_start:n.connectStart,secure_connect_start:n.secureConnectionStart,connect_end:n.connectEnd,request_start:n.requestStart,response_start:n.responseStart,response_end:n.responseEnd,dom_loading:n.domLoading,dom_interactive:n.domInteractive,dom_content_loaded_event_start:n.domContentLoadedEventStart,dom_content_loded_event_end:n.domContentLoadedEventEnd,dom_complete:n.domComplete,load_event_start:n.loadEventStart,load_event_end:n.loadEventEnd},r={};r.request_id=u.REQUEST_ID,r.referrer=document.referrer;var o,a=l.JSStopwatch.createDetachedStopwatch("browser_perf",e);for(o in i)i.hasOwnProperty(o)&&(r[o]=i[o],i[o]&&a.recordTrace(o,i[o]-n.navigationStart));a.logData(),p.LOG_BROWSER_PERFORMANCE_INFO&&c.sendXhr("/alternate_wtl_browser_performance_info",r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.logBrowserPerformanceInfo=t.logBrowserPerfData=void 0,s=n.__importStar(s),c=n.__importStar(c),u=n.__importStar(u),p=n.__importStar(p),t.logBrowserPerfData=function(e){(function(e){var t=s.performance();if(t&&t.getEntriesByType){var n=l.JSStopwatch.createDetachedStopwatch("performance_marks",e),t=t.getEntriesByType("mark");if(t instanceof Array)for(var i=0,r=t;i<r.length;i++){var o=r[i];n.recordTrace(o.name,o.startTime)}n.logData()}})(e),i(e)},t.logBrowserPerformanceInfo=i}),define("modules/clean/perf_tools/web_timing_logger_types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTimerEvent=t.NavigationType=void 0;var n=(i.getFromNavigation=function(e){switch(e.type){case e.TYPE_NAVIGATE:return i.NAVIGATE;case e.TYPE_RELOAD:return i.RELOAD;case e.TYPE_BACK_FORWARD:return i.BACK_FORWARD}},i.NAVIGATE="navigate",i.RELOAD="reload",i.BACK_FORWARD="back_forward",i);function i(){}t.NavigationType=n;o.allEvents=[],o.APPLICATION_START=new o("application_code_start",1),o.LOAD_END=new o("load_end",2,!0,!1),o.MARK_TIME_TO_VIEW=new o("mark_time_to_view",3,!0,!0,"TTV"),o.FETCHED_DATA_FOR_TTI=new o("fetched_data_required_for_tti",4),o.MARK_TIME_TO_INTERACTIVE=new o("mark_time_to_interactive",5),o.TIME_TO_INTERACTIVE=new o("time_to_interactive",6,!0,!0,"TTI"),n=o;function o(e,t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!0),this.name=e,this.flag=1<<t,this.triggersLogging=n,this.timestampPrefix=r||e,this.ordered=i,o.allEvents.push(this)}t.WebTimerEvent=n}),define("modules/clean/perf_tools/web_timing_utils",["require","exports","tslib","modules/core/browser"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancellableCallback=t.WebTimingUtil=void 0,i=n.__importStar(i);r.generateCorrelationId=function(){return Math.random().toString(36).substring(2)},r.getNow=function(){var e=i.performance();if(e&&e.timing&&e.now){var t=e.timing;return(t.navigationStart||t.fetchStart)+Math.floor(e.now())}return Date.now()},r.newContext=function(e,t){var n;return void 0===t&&(t="unnamed_timer"),{initialized:!1,is_pagelet:!1,is_dws:!1,is_dws2:!1,is_early_ensemble:!1,is_page_restore:!1,log_time_to_view:!1,log_time_to_interactive:!1,ttv_at_dom_interactive:!1,tti_at_dom_interactive:!1,source_type:"web",subtypes:{},tti_exclusion_flow:"",have_logged_web_timing:!1,delayed_tti_for_css:!1,timing_results:null,start_time:!e&&(n=i.performance())&&n.timing?(n=n.timing).navigationStart||n.fetchStart:r.getNow(),time_to_view:null,time_to_interactive:null,correlation_id:r.generateCorrelationId(),timesStagesWereReached:{},context_name:t}},n=r;function r(){}t.WebTimingUtil=n;o.prototype.exec=function(){this.canceled||this.callback()},o.prototype.cancel=function(){this.canceled=!0},o.prototype.isCanceled=function(){return this.canceled},n=o;function o(e){this.canceled=!1,this.callback=e}t.CancellableCallback=n}),define("modules/clean/visibility_logging",["require","exports","modules/clean/js_client_stopwatch","modules/clean/js_basic_stopwatch"],function(e,t,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logVisibilityChangeEvents=t.logPaintPerformance=void 0,t.logPaintPerformance=function(e){var t;window.performance&&window.performance.getEntriesByType&&(0<(t=window.performance.getEntriesByType("paint").map(function(e){return{type:u.TimingDataType.Trace,name:e.name,endTime:e.startTime}})).length&&((e=c.JSStopwatch.createDetachedStopwatch("paint",e)).recordEntries(t),e.logData()))},t.logVisibilityChangeEvents=function(e,t){if(window.performance&&window.performance.getEntriesByType){var n=Number.MAX_VALUE;e.time_to_interactive&&(n=e.time_to_interactive-e.start_time);var i,r,e=window.performance.getEntriesByType("mark").filter(function(e){return e.name.startsWith("VisibilityState.")}).map(function(e){return{visibility:e.name,time:e.startTime}}),o={"VisibilityState.visible":0,"VisibilityState.hidden":0},a=function(e){i&&i.time<n&&(o[i.visibility]=(o[i.visibility]||0)+Math.min(e,n)-i.time)},s=[];for(r in e.forEach(function(e,t){a(e.time),s.push({type:u.TimingDataType.Trace,name:"visibility-change-"+t,endTime:e.time,annotations:{visibility:e.visibility}}),i=0===t?{visibility:e.visibility,time:0}:e}),a(window.performance.now()),o)o.hasOwnProperty(r)&&s.push({type:u.TimingDataType.Trace,name:"total-"+r+"-time",endTime:o[r]});t=c.JSStopwatch.createDetachedStopwatch("visibility",t);t.recordEntries(s),t.logData()}}}),define("modules/clean/web_module_timing",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.add_module=t.get_module_times=void 0,t.get_module_times=function(){var e,t=[];for(e in window.requireContexts){var n,i,r=window.requireContexts[e].module_callback_times;for(n in r)!r.hasOwnProperty(n)||null!=(i=r[n]).loadTime&&(i={load_time:i.loadTime,callback_duration:i.callbackDuration,callback_time:i.callbackTime,name:i.name,url:i.url,parent:i.parent},t.push(i))}return t},t.add_module=function(){}}),define("modules/clean/web_timing_logger",["require","exports","tslib","apex-metrics/index","modules/clean/metrics/index","modules/clean/devtools/panels/performance/perf_hub_actions","modules/clean/event_load","modules/clean/web_module_timing","modules/clean/window_util","modules/clean/perf_tools/resource_utils","modules/clean/perf_tools/web_timing_logger_types","modules/clean/perf_tools/web_timing_utils","modules/clean/js_client_stopwatch","modules/clean/perf_tools/browser_perf_utils","modules/clean/init_react","modules/clean/perf_tools/cpu_utils","modules/clean/js_basic_stopwatch","modules/constants/request","modules/constants/webtiming","modules/constants/page_load","modules/core/browser","modules/core/exception","modules/core/xhr","dropbox/proto/js_init_data/web_timing_logger/web_timing_logger","modules/clean/visibility_logging"],function(n,o,s,h,t,a,i,c,r,g,v,u,w,b,S,y,l,p,d,m,T,f,_,E,x){"use strict";var O;Object.defineProperty(o,"__esModule",{value:!0}),o.log_js_modules_fetched_data_required_for_tti=o.log_js_modules_application_code_start=o.waitForTTI=o.mark_time_to_interactive=o.mark_time_to_view=o.set_tti_exclusion_flow=o.time_since_start=o.start_time=o.reset=o.initialize=o.initialize_module=o.time_to_interactive=o.time_to_view=o.delete_timer=o.get_timer=o.perfHubClassName=void 0,i=s.__importStar(i),r=s.__importStar(r),p=s.__importStar(p),d=s.__importStar(d),m=s.__importStar(m),T=s.__importStar(T),f=s.__importStar(f),_=s.__importStar(_),(B=O=O||{})[B.NEW=1]="NEW",B[B.RUNNING=2]="RUNNING",B[B.ABORTED=3]="ABORTED",B[B.CLOSED=4]="CLOSED",o.perfHubClassName="perf-hub-link-container";var k=["navigation_type","referrer","repo_rev","source_type","active_user_id"],C=["tti_flow","tti_exclusion_flow","is_dws2"];function I(){return"hidden"===window.document.visibilityState}var R,N,A,P,e,D=[[v.WebTimerEvent.APPLICATION_START,v.WebTimerEvent.MARK_TIME_TO_VIEW,v.WebTimerEvent.FETCHED_DATA_FOR_TTI,v.WebTimerEvent.MARK_TIME_TO_INTERACTIVE],[v.WebTimerEvent.TIME_TO_INTERACTIVE]].reverse(),M=1,L=["requirejs_start","ensemble_payload_start","body_start"],j=["craft_fast_prefetch_done","dws_core_externals_loaded","dws_ensemble_init","dws-processChunk-embedded-app-done-1","dws-processChunk-embedded-app-require_config-1","ensemble_init","module_init","last_js_const_end","pagelet_render_on_page_embedded-app","pagelet_css_loaded_embedded-app"],B=(X.prototype.buildBaseParams=function(n,e,i){void 0===i&&(i={});var t=n.start_time,r=n.subtypes||{};n.tti_flow&&(r.tti_flow=n.tti_flow);var o={log_source:e.name,subtypes:JSON.stringify(r),correlation_id:n.correlation_id};n.extra_columns&&Object.keys(n.extra_columns).forEach(function(e){var t=n.extra_columns[e];t&&(o[e]=t)}),Object.keys(i).forEach(function(e){var t=i[e];t&&(o[e]=t)}),p.IS_HTTP2&&(o.is_spdy=!0),n.is_pagelet&&(o.is_pagelet=!0),n.is_dws&&(o.is_dws=!0),n.is_early_ensemble&&(o.is_early_ensemble=!0),o.delayed_tti_for_css=n.delayed_tti_for_css,""!==n.tti_exclusion_flow&&(o.tti_exclusion_flow=n.tti_exclusion_flow);e=n.log_time_to_view&&null!=n.time_to_view?n.time_to_view-t:null,t=n.log_time_to_interactive&&null!=n.time_to_interactive?n.time_to_interactive-t:null,r={navigation_type:n.is_page_restore?v.NavigationType.RELOAD:this.get_navigation_type(),server_request_start_time:p.REQUEST_START_TIME,extra_columns:JSON.stringify(o),subtypes:JSON.stringify(r),source_type:n.source_type,page_load_time:n.end_time-n.start_time,repo_rev:m.REPO_REV};return this.shouldLogJsModuleTimes()&&ae(r),n.log_time_to_view&&(r.time_to_view=e),n.log_time_to_interactive&&(r.time_to_interactive=t),r.url=T.get_href(),0===r.url.indexOf("/dws2/")&&(r.url=r.url.substring("/dws2/".length-1)),r.referrer=document.referrer,r.request_id=n.request_id||p.REQUEST_ID,r.request_tracing_enabled=p.REQUEST_TRACING_ENABLED,window.ensemble&&window.ensemble.viewer&&((t=window.ensemble.viewer.getActiveUser())&&(r.active_user_id=t.userId),r.dws_page_name=window.ensemble.getPageName()),r},X.prototype.get_navigation_type=function(){var e=T.performance();if(e&&e.navigation){e=e.navigation;return v.NavigationType.getFromNavigation(e)}},X.prototype.log=function(e,t,n){void 0===n&&(n=!1);var i=w.JSStopwatch.startSpan("wtl_endpoint",{stopwatchName:"web_timing_logger"});w.JSStopwatch.addSpanAnnotation("wtl_endpoint","navigation_type",t.navigation_type,{stopwatchName:"web_timing_logger",spanId:i});var r=_.sendXhr("/alternate_wtl",t);r.onreadystatechange=function(e){var t;r.readyState===XMLHttpRequest.DONE&&200===r.status&&(w.JSStopwatch.endSpan("wtl_endpoint",{stopwatchName:"web_timing_logger",spanId:i}),t=document.getElementsByClassName(o.perfHubClassName),n&&t.length&&((t=JSON.parse(r.responseText)).status&&a.PerfHubActions.add_web_timing_details(t)))}},X),W=(e=B,s.__extends(Y,e),Y.prototype.shouldLog=function(e){return e.initialized&&!e.have_logged_web_timing&&void 0!==e.end_time&&(!e.log_time_to_view||null!=e.time_to_view)&&(!e.log_time_to_interactive||null!=e.time_to_interactive)},Y.prototype.logTiming=function(e,t){e.have_logged_web_timing=!0;var n=this.buildBaseParams(e,t),t=Q(e,n);return this.log(e,n,!1),t},Y.prototype.get_navigation_type=function(){return"ajax"},Y),U=(P=B,s.__extends($,P),$.prototype.shouldLog=function(e){if(!e.initialized||e.have_logged_web_timing)return!1;var t=T.performance();if(!t||!t.timing)return!1;var n=t.timing,i=e.start_time,t=e.end_time;return!(!i||!t||e.log_time_to_view&&!(e.ttv_at_dom_interactive&&n.domInteractive||null!=e.time_to_view)||e.log_time_to_interactive&&!(e.tti_at_dom_interactive&&n.domInteractive||null!=e.time_to_interactive))},$.prototype.logTiming=function(e,t){var n=T.performance(),i=n.timing,r=y.getAllGlobalExecutionPerfMeasurements(),o=e.timesStagesWereReached["dws_embedded-app_require_config_callback"];void 0===o?o=e.timesStagesWereReached.application_code_start:e.timesStagesWereReached.hasOwnProperty("application_code_start")&&(o=Math.min(o,e.timesStagesWereReached.application_code_start)),w.JSStopwatch.startSpan("process_nav_timing",{stopwatchName:"web_timing_logger"});var a,s,c,u,l,p,d,m,f=this.buildBaseParams(e,t,{}),_=Q(e,f),t=window.ensemble&&window.ensemble.getJSStopwatchData?window.ensemble.getJSStopwatchData():{},o="function"==typeof n.getEntriesByType?g.summarizePerformanceResourceTimings(n.getEntriesByType("resource"),o):{pre:{},total:{}};return f.browser_time=(i.redirectStart||i.fetchStart)-e.start_time,f.redirect_time=i.fetchStart-e.start_time,f.dns_time=i.domainLookupEnd-e.start_time,f.tcp_connect_time=(i.secureConnectionStart||i.requestStart)-e.start_time,f.ssl_connect_time=i.requestStart-e.start_time,f.time_to_first_byte=i.responseStart-e.start_time,f.time_to_last_byte=i.responseEnd-e.start_time,f.dom_load_time=i.domContentLoadedEventEnd-e.start_time,f.idle_cpu_time=e.timing_results?Math.round(e.timing_results.idleCPUTime):void 0,f.total_tracked_cpu_time=e.timing_results?Math.round(e.timing_results.totalTrackedCPUTime):void 0,f.untracked_time_after_first_byte=e.timing_results&&null!=e.timing_results.untrackedTimeAfterFirstByte?Math.round(e.timing_results.untrackedTimeAfterFirstByte):void 0,T.performance().getEntriesByType&&(function(e,t){for(var n in e)e.hasOwnProperty(n)&&(t["resource_"+n+"_count"]=e[n].count,t["resource_"+n+"_avg_time"]=e[n].total_time/e[n].count||1,void 0!==e[n].total_size&&(t["resource_"+n+"_total_size"]=e[n].total_size),void 0!==e[n].transfer_size&&(t["resource_"+n+"_transfer_size"]=e[n].transfer_size))}(o.total,f),function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i,r,o,a,s,c=e[n];for(i in c)c.hasOwnProperty(i)&&(r=c[i].transfer_size,o=c[i].total_size,a=c[i].count,s=c[i].total_time,t.recordTrace(n+"_"+i+"_count",a),t.recordTrace(n+"_"+i+"_total_time",s),void 0!==r&&void 0!==o&&0<o&&(s=r/o,t.recordTrace(n+"_"+i+"_transferred_size",r),t.recordTrace(n+"_"+i+"_total_size",o),t.recordTrace(n+"_percent_"+i+"_transferred",100*s)),t.recordTrace(n+"_last_"+i+"_transfer_end",c[i].last_transfer_end))}t.logData()}(o,w.JSStopwatch.createDetachedStopwatch("resources_percent_transferred",_)),w.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_resources","1",{stopwatchName:"web_timing_logger"})),this.shouldLogJsModuleTimes()&&ae(f),w.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_modules","1",{stopwatchName:"web_timing_logger"}),w.JSStopwatch.endSpan("process_nav_timing",{stopwatchName:"web_timing_logger"}),e.is_pagelet&&0<Object.getOwnPropertyNames(t).length&&function(e,t){var n,i,r,n=(n=_,i=y.listAnnotatedExecutionPerfMeasurementsForEnsemble(t),ie(n=w.JSStopwatch.createDetachedStopwatch("ensemble",n),i.map(function(e){var t=e.measurement,e=e.annotations;return{name:t.name,startTime:t.startTime,endTime:t.startTime+t.totalTime,annotations:e}})),n),o=void 0,a=void 0;for(r in t)t.hasOwnProperty(r)&&(re.includes(r)&&(e.timesStagesWereReached[r]=t[r].start),["ensemble_init","dws_embedded-app_require_config_callback"].includes(r)&&(o=o?Math.min(o,t[r].end):t[r].end),oe.test(r)&&(a=a?Math.max(a,t[r].end):t[r].end));a&&n.recordTrace("last_js_const_end",a),o&&n.recordTrace("module_init",o)}(e,t),b.logBrowserPerfData(_),i=e.timesStagesWereReached,y.logCumulativeExecutionTimes(_,y.cumulativeExecutionTimesBefore(i,r)),this.get_navigation_type()===v.NavigationType.NAVIGATE&&(d=_,m=S.getReactInitData(),ie(w.JSStopwatch.createDetachedStopwatch("init_react",d),m),g.logResourcesData(_)),w.JSStopwatch.log_stored_results(),e.is_page_restore||f.navigation_type!==v.NavigationType.NAVIGATE&&"ajax"!==f.navigation_type||(i=e,r=f,d={is_dws:String(i.is_dws),source_type:String(i.source_type)},m="",i.subtypes.amp_tti_flow?m=i.subtypes.amp_tti_flow:r.dws_page_name&&(m="dws_page_name:"+r.dws_page_name),""!==m&&(d.product=m),r.navigation_type&&(d.navigation_type=r.navigation_type),m=this.metricsReporter.child(d),r=m,(d=f).time_to_interactive&&r.createStats({ns:"web_timing",name:"temp/time-to-interactive"}).recordDuration(d.time_to_interactive,h.TimeUnit.MILLISECONDS),function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i,r,o,a,s,c,u=e[n];for(i in u)u.hasOwnProperty(i)&&(r=(c=u[i]).transfer_size,o=c.total_size,a=c.count,s=c.total_time,c=c.last_transfer_end,t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+i+"/count"}).record(a),t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+i+"/total-time"}).recordDuration(s,h.TimeUnit.MILLISECONDS),t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+i+"/last-transfer-end"}).recordDuration(c,h.TimeUnit.MILLISECONDS),void 0!==r&&void 0!==o&&0<o&&(t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+i+"/transferred-size"}).record(r),t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+i+"/total-size"}).record(o)))}}(o,m),e.is_pagelet&&0<Object.getOwnPropertyNames(t).length&&(c=e,u=m,t=y.listAnnotatedExecutionPerfMeasurementsForEnsemble(t),p=l=void 0,t.forEach(function(e){var t=e.measurement,e=t.startTime+t.totalTime;-1!==j.indexOf(t.name)&&u.createStats({ns:"web_timing",name:"temp/ensemble-timing/"+t.name}).recordDuration(e,h.TimeUnit.MILLISECONDS),re.includes(t.name)&&(c.timesStagesWereReached[t.name]=t.startTime),["ensemble_init","dws_embedded-app_require_config_callback"].includes(t.name)&&(l=l?Math.min(l,e):e),oe.test(t.name)&&(p=p?Math.max(p,e):e)}),void 0!==p&&u.createStats({ns:"web_timing",name:"temp/last-js-const-end"}).recordDuration(p,h.TimeUnit.MILLISECONDS),void 0!==l&&u.createStats({ns:"web_timing",name:"temp/module-init"}).recordDuration(l,h.TimeUnit.MILLISECONDS)),n&&n.getEntriesByType&&(s=m,n.getEntriesByType("mark").filter(function(e){return-1<L.indexOf(e.name)}).forEach(function(e){s.createStats({ns:"web_timing",name:"temp/browser-perf/marks/"+e.name}).recordDuration(e.startTime,h.TimeUnit.MILLISECONDS)}),a=m,(n=void 0===(n=n.getEntriesByType("navigation")[0])?null:n)&&([["temp/browser-perf/navigation/unload-event-start",n.unloadEventStart],["temp/browser-perf/navigation/unload-event-end",n.unloadEventEnd],["temp/browser-perf/navigation/dom-interactive",n.domInteractive],["temp/browser-perf/navigation/dom-content-loaded-event-start",n.domContentLoadedEventStart],["temp/browser-perf/navigation/dom-content-loaded-event-end",n.domContentLoadedEventEnd],["temp/browser-perf/navigation/dom-complete",n.domComplete],["temp/browser-perf/navigation/load-event-start",n.loadEventStart],["temp/browser-perf/navigation/load-event-end",n.loadEventEnd],["temp/browser-perf/navigation/redirect-count",n.redirectCount],["temp/browser-perf/navigation/worker-start",n.workerStart],["temp/browser-perf/navigation/redirect-start",n.redirectStart],["temp/browser-perf/navigation/redirect-end",n.redirectEnd],["temp/browser-perf/navigation/fetch-start",n.fetchStart],["temp/browser-perf/navigation/domain-lookup-start",n.domainLookupStart],["temp/browser-perf/navigation/domain-lookup-end",n.domainLookupEnd],["temp/browser-perf/navigation/connect-start",n.connectStart],["temp/browser-perf/navigation/connect-end",n.connectEnd],["temp/browser-perf/navigation/secure-connect-start",n.secureConnectionStart],["temp/browser-perf/navigation/request-start",n.requestStart],["temp/browser-perf/navigation/response-start",n.responseStart],["temp/browser-perf/navigation/response-end",n.responseEnd],["temp/browser-perf/navigation/transfer-size",n.transferSize]].forEach(function(e){var t=e[0],e=e[1];"number"==typeof e&&a.createStats({ns:"web_timing",name:t}).recordDuration(e,h.TimeUnit.MILLISECONDS)}),[["temp/browser-perf/navigation/encoded-body-size",n.encodedBodySize],["temp/browser-perf/navigation/decoded-body-size",n.decodedBodySize]].forEach(function(e){var t=e[0],e=e[1];"number"==typeof e&&a.createStats({ns:"web_timing",name:t}).record(e)})))),x.logPaintPerformance(_),x.logVisibilityChangeEvents(e,_),e.have_logged_web_timing=!0,this.log(e,f,!0),_},$.prototype.log=function(e,t,n){P.prototype.log.call(this,e,t,n=void 0===n?!1:n)},$),q=(K.prototype.startSpan=function(e){e=new K(e,this.originTs);return this.childSpans.push(e),e},K.prototype.markSpan=function(e,t){e=new K(e,this.originTs,this.startTime);this.childSpans.push(e),e.endSpan(t)},K.prototype.endSpan=function(e){var t=this;this.endTime=void 0!==e?e:u.WebTimingUtil.getNow(),this.childSpans.forEach(function(e){e.hasEnded()||e.endSpan(t.endTime)}),this.endCallback&&this.endCallback(this)},K.prototype.getEndTimeOffsetMS=function(){return void 0!==this.endTime?this.endTime-this.originTs:void 0},K.prototype.hasEnded=function(){return void 0!==this.endTime},K),B=(G.prototype.startSpan=function(e){var t=this,e=new q(e,this.context.start_time,void 0,function(e){t.endSpan(e)});return this.activeSpans.push(e),e},G.prototype.markSpan=function(e,t){var n,i;void 0===t&&(t={}),this.userStopwatch?(i=void 0===t.startTime?0:t.startTime,n=this.timeSinceStart(t.endTime),i=this.userStopwatch.startSpan(e,{startTime:i}),this.userStopwatch.endSpan(e,{spanId:i,endTime:n})):((e=new q(e,this.context.start_time,t.startTime)).endSpan(t.endTime),this.endedSpans.push(e))},G.prototype.endSpan=function(e){var t=this.activeSpans.indexOf(e);0<=t&&(delete this.activeSpans[t],this.userStopwatch?this.recordSpan(e):this.endedSpans.push(e))},G.prototype.recordSpan=function(e){var t=this,n=this.userStopwatch.startSpan(e.spanName,{startTime:e.startTimeOffsetMS});e.childSpans.forEach(function(e){t.recordSpan(e)}),this.userStopwatch.endSpan(e.spanName,{spanId:n,endTime:e.getEndTimeOffsetMS()})},G.prototype.getContextName=function(){return this.context.context_name},G.prototype.applicationStart=function(){this.logEvent(v.WebTimerEvent.APPLICATION_START)},G.prototype.fetchedDataRequiredForTTI=function(){this.logEvent(v.WebTimerEvent.FETCHED_DATA_FOR_TTI)},G.prototype.startTime=function(){return this.context.start_time},G.prototype.timeSinceStart=function(e){return(e||u.WebTimingUtil.getNow())-this.context.start_time},G.prototype.timeToView=function(){return this.context.time_to_view},G.prototype.timeToInteractive=function(){return this.context.time_to_interactive},G.prototype.reportTTIAfterPaint=function(){var e=this,t=new u.CancellableCallback(function(){e.reportTTI()});return window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){t.exec()})}),t},G.prototype.setExtraColumns=function(e){this.context.extra_columns=e},G.prototype.excludeFromTTI=function(e){""!==this.context.tti_exclusion_flow&&(this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+","),this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+e},G.prototype.logEvent=function(e,t){this.logEventInternal(e,!0,t)},G.prototype.logSilentEvent=function(e,t){this.logEventInternal(e,!1,t)},G.prototype.logEventInternal=function(e,t,n){this.loggedEvents|=e.flag,e.ordered&&this.validateEventOrder(e);n=this.timeSinceStart(n);this.context.timesStagesWereReached[e.name]=n,this.timingStopwatch.recordTrace(e.name,n),console.timeStamp&&console.timeStamp(e.timestampPrefix);n=T.performance();n&&"function"==typeof n.mark&&n.mark(e.name),t&&e.triggersLogging&&this.logIfReady(e)},G.prototype.validateEventOrder=function(e){for(var t=0,n=0,i=D;n<i.length;n++){var r=i[n];if(r.includes(e))break;for(var o=0,a=r;o<a.length;o++)t|=a[o].flag}var s,c=t&this.loggedEvents;0<c&&(s=v.WebTimerEvent.allEvents.filter(function(e){return 0<(e.flag&c)}).map(function(e){return e.name}),this.reportSwMisuse("Received "+e.name+" after ["+s.join(",")+"]"))},G.prototype.logIfReady=function(e){this.logger.shouldLog(this.context)&&(this.addEventBasedTiming(),e=this.logger.logTiming(this.context,e),Z(this.timingStopwatch,e),Z(this.userStopwatch,e),this.timingStopwatch.logData(),this.userStopwatch.logData(),this.timerState=O.CLOSED)},G.prototype.addEventBasedTiming=function(){var e=T.performance().timing;this.context.ttv_at_dom_interactive&&(this.context.is_pagelet&&window.ensemble?this.context.time_to_view=window.ensemble.getEmbeddedAppDOMInteractive():this.context.time_to_view=e.domInteractive,this.logSilentEvent(v.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),this.context.tti_at_dom_interactive&&(this.context.time_to_interactive=e.domInteractive,this.logSilentEvent(v.WebTimerEvent.MARK_TIME_TO_INTERACTIVE,this.context.time_to_interactive),this.logSilentEvent(v.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive))},G.prototype.reportSwMisuse=function(e){e="WebTimer: "+e,this.strictAssert?f.assert(!1,e):f.reportStack(e,{severity:f.SEVERITY.NONCRITICAL,tags:["web_timing_logger"]})},G),F=(A=B,s.__extends(H,A),H.prototype.initialize=function(e){this.context.initialized||(this.context.initialized=!0,this.context.log_time_to_view=e.requireTTV,this.context.log_time_to_interactive=e.requireTTI,this.context.tti_flow=e.url,this.timingStopwatch.url=this.context.tti_flow,this.userStopwatch.url=this.context.tti_flow)},H.prototype.start=function(){this.isUsable()&&this.timerState===O.NEW&&(this.context.start_time=u.WebTimingUtil.getNow(),this.timerState=O.RUNNING)},H.prototype.restart=function(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.have_logged_web_timing=!1,this.context.correlation_id=u.WebTimingUtil.generateCorrelationId(),this.context.start_time=u.WebTimingUtil.getNow(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=O.RUNNING,w.JSStopwatch.deleteStopwatch(this.timingStopwatch),this.timingStopwatch=w.JSStopwatch.createDetachedStopwatch("maestro_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id}),w.JSStopwatch.deleteStopwatch(this.userStopwatch),this.userStopwatch=w.JSStopwatch.createDetachedStopwatch("user_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id})},H.prototype.abort=function(){this.timerState!==O.CLOSED&&(this.timerState=O.ABORTED)},H.prototype.markTimeToView=function(){this.isUsable()&&(null==this.context.time_to_view&&(this.context.time_to_view=u.WebTimingUtil.getNow()),this.logEvent(v.WebTimerEvent.MARK_TIME_TO_VIEW))},H.prototype.markTimeToInteractive=function(){this.isUsable()&&(this.logEvent(v.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),I()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())},H.prototype.reportTTI=function(){null==this.context.time_to_interactive&&(this.context.time_to_interactive=u.WebTimingUtil.getNow(),this.logEvent(v.WebTimerEvent.TIME_TO_INTERACTIVE),se(this.id))},H.prototype.end=function(e){this.isUsable()&&(void 0===this.context.end_time&&(this.context.end_time=u.WebTimingUtil.getNow()),this.context.request_id=e,this.timingStopwatch.request_id=e,this.userStopwatch.request_id=e,this.logEvent(v.WebTimerEvent.LOAD_END))},H.prototype.waitForTTI=function(r){var o=this;return new Promise(function(t,e){var n,i;null==o.context.time_to_interactive?(i=function(e){window.removeEventListener("TTI."+o.id,i),clearTimeout(n),t()},window.addEventListener("TTI."+o.id,i),r&&void 0!==r.timeoutMS&&(n=setTimeout(i,r.timeoutMS))):t()})},H.prototype.isUsable=function(){return this.timerState===O.NEW||this.timerState===O.RUNNING},H),V=(N=B,s.__extends(J,N),J.prototype.initialize=function(e){var t,n=this;this.context.initialized||T.performance()&&(this.context.log_time_to_view=e.requireTTV,this.context.log_time_to_interactive=e.requireTTI,this.context.is_pagelet=!!e.is_pagelet,this.context.is_dws=!!e.is_dws,this.context.is_dws2=!!e.is_dws2,this.context.is_early_ensemble=!!e.is_early_ensemble,this.context.is_page_restore=!1,this.context.ttv_at_dom_interactive=!!e.ttv_at_dom_interactive,this.context.tti_at_dom_interactive=!!e.tti_at_dom_interactive,this.context.source_type=null!=e.source_type?e.source_type:"web",this.context.subtypes=null!=e.subtypes?e.subtypes:{},this.context.tti_exclusion_flow=null!=e.tti_exclusion_flow?e.tti_exclusion_flow:"",this.context.have_logged_web_timing=!1,this.context.delayed_tti_for_css=!1,this.context.initialized=!0,e.url&&(this.context.tti_flow=e.url,this.timingStopwatch.url=e.url,this.userStopwatch.url=e.url),this.context.subtypes.tti_flow&&(this.context.tti_flow=this.context.subtypes.tti_flow),t=0,d.LOG_TIMING_DELAY&&(t=600),w.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),i.window_load(function(){setTimeout(function(){return n.end()},t)}),r.onPageRestore(function(e){n.context.is_page_restore=!0;var t=w.JSStopwatch.createDetachedStopwatch("browser_perf",{correlation_id:n.context.correlation_id});t.recordTrace("page_restore"),t.logData()}),!this.context.ttv_at_dom_interactive&&window._timingData&&(null!=window._timingData.ttv&&(this.context.time_to_view=window._timingData.ttv.getTime(),this.logEvent(v.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),null!=window._timingData.tti&&(this.context.time_to_interactive=window._timingData.tti.getTime(),this.logEvent(v.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),se())))},J.prototype.start=function(){this.isUsable()&&this.timerState===O.NEW&&(this.timerState=O.RUNNING)},J.prototype.restart=function(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.correlation_id=u.WebTimingUtil.generateCorrelationId(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=O.RUNNING,this.timingStopwatch=w.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:this.context.correlation_id}),this.userStopwatch=w.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:this.context.correlation_id})},J.prototype.abort=function(){this.timerState!==O.CLOSED&&(this.timerState=O.ABORTED)},J.prototype.markTimeToView=function(){this.isUsable()&&(null!=this.context.time_to_view||this.context.ttv_at_dom_interactive||(window._timingData&&null!=window._timingData.ttv?this.context.time_to_view=window._timingData.ttv.getTime():this.context.time_to_view=u.WebTimingUtil.getNow(),this.logEvent(v.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)))},J.prototype.markTimeToInteractive=function(){var e=this;if(window.ensemble&&window.ensemble.waitingForCss)return this.context.delayed_tti_for_css=!0,void(window.ensemble.mark_tti_callback=function(){e.markTimeToInteractive()});null!=this.context.time_to_interactive||this.context.tti_at_dom_interactive||(this.logEvent(v.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),I()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())},J.prototype.reportTTI=function(){var a=this;null==this.context.time_to_interactive&&(window._timingData&&null!=window._timingData.tti?this.context.time_to_interactive=window._timingData.tti.getTime():this.context.time_to_interactive=u.WebTimingUtil.getNow(),console.timeStamp&&console.timeStamp("TTI"),window.ensemble&&window.ensemble.snapshotTimingProfile&&(this.context.timing_results=window.ensemble.snapshotTimingProfile()||null),window.RUNNING_IN_EDISON?new Promise(function(e,t){n(["modules/clean/edison/edison"],e,t)}).then(s.__importStar).then(function(e){for(var t=e.Edison.getPrefetchCounts(),n={},i=0,r=Object.keys(t);i<r.length;i++){var o=r[i];n[o]=t[o].toString()}a.context.subtypes=s.__assign(s.__assign({},n),a.context.subtypes),a.logEvent(v.WebTimerEvent.TIME_TO_INTERACTIVE,a.context.time_to_interactive),se()}):(this.logEvent(v.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),se()))},J.prototype.end=function(e){this.isUsable()&&void 0===this.context.end_time&&(this.context.end_time=u.WebTimingUtil.getNow(),this.logEvent(v.WebTimerEvent.LOAD_END),this.context.tti_at_dom_interactive&&se())},J.prototype.waitForTTI=function(r){var o=this;return new Promise(function(t,e){if(window.ensemble){if(window.ensemble.ttiMarked)return void t()}else if(null!=o.context.time_to_interactive)return void t();function n(e){window.removeEventListener("TTI",n),clearTimeout(i),t()}var i;window.addEventListener("TTI",n),r&&void 0!==r.timeoutMS&&(i=setTimeout(n,r.timeoutMS))})},J.prototype.isUsable=function(){return this.timerState===O.NEW||this.timerState===O.RUNNING},J),z={};function J(e){e=N.call(this,e,w.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:e.correlation_id}),w.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:e.correlation_id}),!1)||this;return e.logger=new U,e}function H(e){e=A.call(this,e,w.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:e.correlation_id}),w.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:e.correlation_id}),!1)||this;return e.logger=new W,e}function G(e,t,n,i){void 0===i&&(i=!1),this.timerState=O.RUNNING,this.loggedEvents=0,this.activeSpans=[],this.endedSpans=[],this.context=e,this.timingStopwatch=t,this.userStopwatch=n,this.id=M++,this.strictAssert=i}function K(e,t,n,i){this.childSpans=[],this.spanName=e,this.startTime=void 0!==n?n:u.WebTimingUtil.getNow(),this.originTs=t,this.startTimeOffsetMS=this.startTime-t,this.endCallback=i}function $(){var e=P.call(this)||this;return e.metricsReporter=t.getMetricsReporter(),e}function Y(){return e.call(this)||this}function X(){w.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),this.shouldLogJsModuleTimes=function(){return Math.random()<.001}}function Q(e,t){for(var n={},i=0,r=k;i<r.length;i++)(a=t[o=r[i]])&&(n[o]=String(a));for(var o,a,s=e,c=0,u=C;c<u.length;c++)(a=s[o=u[c]])&&(n[o]=String(a));return{correlation_id:e.correlation_id,request_id:t.request_id,annotations:n}}function Z(e,t){if(t.annotations)for(var n in t.annotations){var i;!t.annotations.hasOwnProperty(n)||(i=t.annotations[n])&&e.addAnnotation(n,String(i))}t.correlation_id&&e.addAnnotation(w.ReservedAnnotationKey.CORRELATION_ID.id,t.correlation_id),t.request_id&&e.addAnnotation(w.ReservedAnnotationKey.REQUEST_ID.id,t.request_id),t.url&&e.addAnnotation(w.ReservedAnnotationKey.URL.id,t.url)}function ee(e){return e?(z[t=e]||(z[t]=new F(u.WebTimingUtil.newContext(!0,e))),z[t]):(R||ne(),R);var t}function te(e){void 0===e&&(e={}),ee().initialize({requireTTV:!!e.log_time_to_view,requireTTI:!!e.log_time_to_interactive,is_pagelet:e.is_pagelet,is_dws:e.is_dws,is_dws2:e.is_dws2,is_early_ensemble:e.is_early_ensemble,ttv_at_dom_interactive:e.ttv_at_dom_interactive,tti_at_dom_interactive:e.tti_at_dom_interactive,source_type:e.source_type,subtypes:e.subtypes,tti_exclusion_flow:e.tti_exclusion_flow,url:e.url})}function ne(){R=new V(u.WebTimingUtil.newContext(!1,"default_timer"))}function ie(e,t){e.recordEntries(t.map(function(e){return{type:0!==e.startTime?l.TimingDataType.Span:l.TimingDataType.Trace,name:e.name,startTime:e.startTime,endTime:e.endTime,annotations:e.annotations}})),e.logData()}ne(),o.get_timer=ee,o.delete_timer=function(e){delete z[e]},o.time_to_view=function(){return ee().timeToView()},o.time_to_interactive=function(){return ee().timeToInteractive()},o.initialize_module=te,o.initialize=function(e,t){var n,i=t.dwsOpts;switch(t.sourceType){case E.web_timing_logger.WebTimingLoggerServerContext.SourceType.UNKNOWN:n="unknown";break;case E.web_timing_logger.WebTimingLoggerServerContext.SourceType.MOBILE_WEB:n="mobile";break;case E.web_timing_logger.WebTimingLoggerServerContext.SourceType.DESKTOP_WEB:n="web"}t={is_pagelet:t.isDws,is_dws:t.isDws,is_dws2:null!=i&&i.isDws2,is_early_ensemble:null!=i&&i.isEarlyEnsemble,subtypes:s.__assign(s.__assign({},t.subtypes),{js_preloading:null!=i&&i.jsPreloading?"true":"false"}),source_type:n,url:t.url};te(s.__assign(s.__assign({},t),e))},o.reset=ne,o.start_time=function(){return ee().startTime()},o.time_since_start=function(){return ee().timeSinceStart()},o.set_tti_exclusion_flow=function(e){ee().excludeFromTTI(e)};var re=["ensemble_init","dws_ensemble_init","dws_embedded-app_require_config_callback","dws-processChunk-embedded-app-require_config-1"],oe=new RegExp("dws-processChunk-embedded-app-const_module.*");function ae(e){var t=T.performance();if(t&&t.getEntriesByName){for(var n=[],i=0,r=c.get_module_times();i<r.length;i++){var o=r[i],a=o.url;if(void 0===a&&o.name&&-1===o.name.indexOf("!"))f.reportStack("Module "+o.name+" with invalid map object fetched by requirejs",{severity:f.SEVERITY.NONCRITICAL,tags:["log_js_module_timing"]});else{var s=[];if(0!==(s=a?t.getEntriesByName(a,"resource"):s).length)o.start_time=s[0].startTime+s[0].duration;else{if(!("callback_duration"in o))continue;o.start_time=0}n.push(o)}}e.js_module_times=JSON.stringify(n)}}function se(e){var t;window.ensemble&&window.ensemble.markTTI?window.ensemble.markTTI():(t=document.createEvent("Event"),null!=e?t.initEvent("TTI."+e,!0,!0):t.initEvent("TTI",!0,!0),window.dispatchEvent(t))}o.mark_time_to_view=function(){ee().markTimeToView()},o.mark_time_to_interactive=function(e){void 0===e&&(e={});var t=ee();t.setExtraColumns(e),t.markTimeToInteractive()},o.waitForTTI=function(e){return ee().waitForTTI(e)},o.log_js_modules_application_code_start=function(){ee().applicationStart()},o.log_js_modules_fetched_data_required_for_tti=function(){ee().fetchedDataRequiredForTTI()}}),define("modules/clean/window_util",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onPageRestore=t.onBeforeUnload=void 0,t.onBeforeUnload=function(t){window.addEventListener("beforeunload",function e(){t(),window.removeEventListener("beforeunload",e)})},t.onPageRestore=function(n){window.addEventListener("pageshow",function e(t){t.persisted&&(n(),window.removeEventListener("pageshow",e))})}}),define("modules/clean/js_basic_stopwatch",["require","exports","tslib","modules/core/exception"],function(e,o,a,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.createStopwatch=o.NoopStopwatchInstance=o.JSBasicStopwatchImpl=o.TimingDataType=void 0;var s,c=!(!window.performance||!window.performance.now),n=0;(i=s=o.TimingDataType||(o.TimingDataType={}))[i.Span=1]="Span",i[i.AsyncSpan=2]="AsyncSpan",i[i.Trace=3]="Trace";var u=(l.prototype.reset=function(){this.activeSpans={},this.spanStack=[],this.aggregateSpans={},this._annotations={}},Object.defineProperty(l.prototype,"annotations",{get:function(){return this._annotations},enumerable:!1,configurable:!0}),l.prototype.addAnnotation=function(e,t){this._annotations[e]=t},l.prototype.removeAnnotation=function(e){delete this._annotations[e]},l.prototype.popResolvedSpans=function(){if(this.detached)return{};var e=this.aggregateSpans;return this.aggregateSpans={},e},l.prototype.peekResolvedSpans=function(){return this.detached?{}:this.aggregateSpans},l.newSpanID=function(){var e=String(n);return n++,e},l.resolveTime=function(e){return void 0===e&&(e=window.performance.now()),Math.round(e)},l.prototype._resolveParent=function(e){if(e.type===s.Span){var t=this.spanStack[this.spanStack.length-1];if(t)if(t!==e.name)this._report_sw_misuse("Closing "+t+" while the latest open span is "+e.name+".\n        You are either mixing sync and async spans or closing sync spans out of order.");else{this.spanStack.pop();for(var n="",i=0,r=this.spanStack;i<r.length;i++)n+=r[i]+"#";e.parent=n}else this._report_sw_misuse(e.name+' isn\'t a synchronous span and has to be started with "async:true".')}else e.parent=""},l.prototype.recordTrace=function(e,t){var n=l.resolveTime((t=void 0===t?{}:t).traceTime),i=l.newSpanID(),t={name:e,span_id:i,start_time:0,end_time:n,annotations:a.__assign({},t.annotations),type:s.Trace,parent:""};return this.recordSpan(this.stopwatchTags,t),i},l.prototype.start=function(e,t){void 0===t&&(t={}),e||this._report_sw_misuse("Reporting a span without a name");var n=l.resolveTime(t.startTime);t.async||this.spanStack.push(e);var i=l.newSpanID(),t={name:e,span_id:i,start_time:n||0,annotations:a.__assign({},t.annotations),type:t.async?s.AsyncSpan:s.Span};return e in this.activeSpans||(this.activeSpans[e]=[]),this.activeSpans[e].push(t),i},l.prototype.end=function(e,t){var n=this.findTimerDataIndex(e,(t=void 0===t?{}:t).spanId);if(-1!==n){var i=this.activeSpans[e],r=i[n];i.splice(n,1),this._resolveParent(r);t=l.resolveTime(t.endTime);if(!(t<r.start_time))return r.end_time=t,this.recordSpan(this.stopwatchTags,r),r.span_id;this._report_sw_misuse("span "+e+" has set an endTime earlier than start_time")}},l.prototype.addSpanAnnotation=function(e,t,n,i){i=this.findTimerDataIndex(e,i);-1!==i&&(this.activeSpans[e][i].annotations[t]=n)},l.prototype.attach=function(){this.detached=!1},l.prototype.findTimerDataIndex=function(e,t){if(!(e in this.activeSpans)||0===this.activeSpans[e].length)return this._report_sw_misuse("tried to find "+e+" but that span doesn't exist"),-1;var n=-1,i=this.activeSpans[e];if(void 0===t)n=0;else for(var r=0;r<i.length;r++)if(i[r].span_id===t){n=r;break}return-1===n&&this._report_sw_misuse("tried to find "+e+" with id "+t+" but that span doesn't exist"),n},l.prototype._report_sw_misuse=function(e){e="JSBasicStopwatch "+this.name+": "+e,this.strictAssert?t.assert(!1,e):t.reportStack(e,{severity:t.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},l.prototype.recordSpan=function(e,t){var n=""+t.parent+t.name;n in this.aggregateSpans||(this.aggregateSpans[n]={name:t.name,start_time:t.start_time,total_time:0,num_calls:0,annotations:0<Object.keys(t.annotations).length?t.annotations:void 0,parent:t.parent||"",stopwatch_tags:0<e.length?e:void 0,type:t.type});var i=this.aggregateSpans[n];if(void 0!==t.end_time){if(i.type===s.Trace?(i.total_time=t.end_time-t.start_time,i.num_calls=1):(i.total_time+=t.end_time-t.start_time,i.num_calls+=1),0<Object.keys(t.annotations).length)if(i.annotations)for(var r in t.annotations)t.annotations.hasOwnProperty(r)&&(i.annotations[r]=t.annotations[r]);else i.annotations=t.annotations}else this._report_sw_misuse("Span "+n+" reported with undefined end_time")},l);function l(e,t,n,i,r){void 0===i&&(i=!1),this.name=e,this.strictAssert=t,this.activeSpans={},this.aggregateSpans={},this._annotations=a.__assign({},r),this.spanStack=[],this.stopwatchTags=n||[],this.detached=i}o.JSBasicStopwatchImpl=u;var i=(r.prototype.reset=function(){},r.prototype.attach=function(){},r.prototype.addAnnotation=function(e,t){},r.prototype.removeAnnotation=function(e){},r.prototype.popResolvedSpans=function(){return{}},r.prototype.peekResolvedSpans=function(){return{}},r.prototype.start=function(e,t){},r.prototype.end=function(e,t){},r.prototype.recordTrace=function(e,t){},r.prototype.addSpanAnnotation=function(e,t,n,i){},r);function r(){this.name="",this.annotations={}}o.NoopStopwatchInstance=new i,o.createStopwatch=function(e,t,n,i,r){return void 0===i&&(i=!1),c?new u(e,t,n,i,r):o.NoopStopwatchInstance}}),define("modules/clean/js_client_stopwatch",["require","exports","tslib","modules/core/xhr","modules/clean/js_basic_stopwatch","modules/constants/request","modules/core/browser","modules/core/exception"],function(e,t,n,i,a,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSStopwatch=t.ReservedAnnotationKey=void 0,r=n.__importStar(r),o=n.__importStar(o);var c=(u.REQUEST_ID=new u("dropbox.js_client_stopwatch.request_id"),u.CORRELATION_ID=new u("dropbox.js_client_stopwatch.correlation_id"),u.URL=new u("dropbox.js_client_stopwatch.url"),u);function u(e){this.id=e}t.ReservedAnnotationKey=c;l.prototype.reset=function(){this.globalStopwatches={},this.clientStopwatches={},this.clientStopwatchCounter=1,this.sentInitialData=!1,this.create_stopwatch(this.GLOBAL_SW_NAME),this.intervalId&&clearInterval(this.intervalId),this.intervalId=null},l.prototype.reset_individual_stopwatch=function(e){this.stopwatch_exists(e)?this.globalStopwatches[e].reset():this._report_sw_misuse("tried to reset the stopwatch "+e+" but it does not exist")},l.prototype.stopwatch_exists=function(e){return e in this.globalStopwatches},l.prototype.create_stopwatch=function(e,t){this.stopwatch_exists(e)?this._report_sw_misuse("tried to create a new stopwatch "+e+" but it already exists"):this.globalStopwatches[e]=a.createStopwatch(e,this.strictAssert,t)},l.prototype.createDetachedStopwatch=function(e,t){var n=a.createStopwatch(e,this.strictAssert,(t=void 0===t?{}:t).tags,!0,t.annotations),t=new p(this.clientStopwatchCounter++,e,n,t.request_id,t.correlation_id,t.url);return this.clientStopwatches[t.id]=t},l.prototype.deleteStopwatch=function(e){delete this.clientStopwatches[e.id]},l.prototype.create_stopwatch_if_not_exist=function(e,t){this.stopwatch_exists(e)||this.create_stopwatch(e,t)},l.prototype.getStopwatch=function(e){return this.stopwatch_exists(e)?this.globalStopwatches[e]:(this._report_sw_misuse(e+" doesn't exist"),null)},l.prototype.recordTrace=function(e,t){var n=this.getStopwatch((t=void 0===t?{}:t).stopwatchName||this.GLOBAL_SW_NAME);if(null!=n){t={traceTime:t.traceTime};return n.recordTrace(e,t)}},l.prototype.startSpan=function(e,t){var n=this.getStopwatch((t=void 0===t?{}:t).stopwatchName||this.GLOBAL_SW_NAME);if(null!=n){t={startTime:t.startTime,async:t.async};return n.start(e,t)}},l.prototype.endSpan=function(e,t){var n=this.getStopwatch((t=void 0===t?{}:t).stopwatchName||this.GLOBAL_SW_NAME);if(null!=n)return n.end(e,{spanId:t.spanId,endTime:t.endTime})},l.prototype.addSpanAnnotation=function(e,t,n,i){var r=this.getStopwatch((i=void 0===i?{}:i).stopwatchName||this.GLOBAL_SW_NAME);null!=r&&r.addSpanAnnotation(e,t,n,i.spanId)},l.prototype.log_stored_results=function(){this.sentInitialData?this._report_sw_misuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.flush_current_data(),this.sentInitialData=!0,this.intervalId=setInterval(this.flush_current_data.bind(this),this.flush_interval))},l.prototype._report_sw_misuse=function(e){e="ClientStopwatch: "+e,this.strictAssert?s.assert(!1,e):s.reportStack(e,{severity:s.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},l.prototype.flush_current_data=function(){for(var e in this.globalStopwatches)this.globalStopwatches.hasOwnProperty(e)&&l.logStopwatchData(this.globalStopwatches[e]);for(var e in this.clientStopwatches)this.clientStopwatches.hasOwnProperty(e)&&l.logStopwatchData(this.clientStopwatches[e].stopwatch)},l.logStopwatchData=function(e){var t=e.popResolvedSpans(),n=e.name,i={};if(Object.keys(t).length>l.MAXSPANS){var r,o=0;for(r in i[n]={},t)t.hasOwnProperty(r)&&(i[n][r]=t[r],o===l.MAXSPANS&&(i[n].annotations=e.annotations,l.send_spans(i),o=0,i[n]={}),o++)}else i[n]=t;0!==Object.keys(i[n]).length&&(i[n].annotations=e.annotations,l.send_spans(i))},l.send_spans=function(e){e=JSON.stringify(e),e={request_id:r.REQUEST_ID,url:o.get_href().replace("/dws2",""),aggregated_sw_data:e};i.sendXhr("/log_js_sw_data",e)},l.prototype.print_stopwatches_debug=function(){var e=this.get_debug_data();console.table&&console.groupCollapsed&&console.groupEnd&&e&&0<e.length&&(console.groupCollapsed("Request timeline"),console.table(e),console.groupEnd())},l.prototype.get_debug_data=function(){var e,t=[];for(e in this.globalStopwatches)if(this.globalStopwatches.hasOwnProperty(e)){var n,i,r,o=this.globalStopwatches[e].peekResolvedSpans();for(n in o)o.hasOwnProperty(n)&&(r={stopwatchName:e,spanName:(i=o[n]).name,time:i.start_time+i.total_time},i.type!==a.TimingDataType.AsyncSpan&&i.type!==a.TimingDataType.Span||(r.startTime=i.start_time),i.type===a.TimingDataType.Span&&(r.info="Total time: "+i.total_time+"ms"),t.push(r))}return t.sort(function(e,t){return e.time-t.time}),t},l.MAXSPANS=2e3,n=l;function l(){this.GLOBAL_SW_NAME="GLOBAL_STOPWATCH",this.flush_interval=6e4,this.debugEnabled=!0,this.strictAssert=!1,this.intervalId=null,this.clientStopwatchCounter=1,this.reset()}t.JSStopwatch=new n;var p=(Object.defineProperty(d.prototype,"request_id",{set:function(e){this._request_id=e,this._request_id?this.stopwatch.addAnnotation(c.REQUEST_ID.id,this._request_id):this.stopwatch.removeAnnotation(c.REQUEST_ID.id)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"correlation_id",{set:function(e){this._correlation_id=e,this._correlation_id?this.stopwatch.addAnnotation(c.CORRELATION_ID.id,this._correlation_id):this.stopwatch.removeAnnotation(c.CORRELATION_ID.id)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"url",{set:function(e){this._url=e,this._url?this.stopwatch.addAnnotation(c.URL.id,this._url):this.stopwatch.removeAnnotation(c.URL.id)},enumerable:!1,configurable:!0}),d.prototype.startSpan=function(e,t){return this.stopwatch.start(e,t)},d.prototype.endSpan=function(e,t){return this.stopwatch.end(e,t)},d.prototype.addSpanAnnotation=function(e,t,n,i){this.stopwatch.addSpanAnnotation(e,t,n,i)},d.prototype.recordTrace=function(e,t,n){this.stopwatch.recordTrace(e,{traceTime:t,annotations:n})},d.prototype.recordEntries=function(e){for(var t=0,n=e;t<n.length;t++){var i,r,o=n[t];o.type===a.TimingDataType.Trace?this.recordTrace(o.name,o.endTime,o.annotations):(i=o.startTime||0,r=this.startSpan(o.name,{startTime:Math.min(i,o.endTime),async:o.type===a.TimingDataType.AsyncSpan,annotations:o.annotations}),o.endTime<i&&this.addSpanAnnotation(o.name,"negativeSpanLength",(o.endTime-i).toString(),r),this.endSpan(o.name,{spanId:r,endTime:Math.max(i,o.endTime)}))}},d.prototype.logData=function(){this.sentInitialData?this.reportMisuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.stopwatch.attach(),this.sentInitialData=!0,setTimeout(function(){t.JSStopwatch.flush_current_data()},0))},d.prototype.addAnnotation=function(e,t){this.stopwatch.addAnnotation(e,t)},d.prototype.removeAnnotation=function(e){this.stopwatch.removeAnnotation(e)},d.prototype.reportMisuse=function(e){e="ClientStopwatch: "+e,this.strictAssert?s.assert(!1,e):s.reportStack(e,{severity:s.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},d);function d(e,t,n,i,r,o){this.sentInitialData=!1,this.strictAssert=!1,this.id=e,this.stopwatch=n,this._request_id=i,this._correlation_id=r,this._url=o,this._request_id&&this.stopwatch.addAnnotation(c.REQUEST_ID.id,this._request_id),this._correlation_id&&this.stopwatch.addAnnotation(c.CORRELATION_ID.id,this._correlation_id),this._url&&this.stopwatch.addAnnotation(c.URL.id,this._url)}}),define("apex-metrics/index",["require","exports","tslib","apex-metrics/clock","apex-metrics/executor","apex-metrics/internal","apex-metrics/metrics","apex-metrics/metrics_reporter","apex-metrics/no_op","apex-metrics/types","apex-metrics/validate"],function(e,t,n,i,r,o,a,s,c,u,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(i,t),n.__exportStar(r,t),n.__exportStar(o,t),n.__exportStar(a,t),n.__exportStar(s,t),n.__exportStar(c,t),n.__exportStar(u,t),n.__exportStar(l,t)}),define("apex-metrics/clock",["require","exports","apex-metrics/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserPerformanceClock=void 0;var i=(r.prototype.now=function(){return{value:performance.now(),unit:n.TimeUnit.MILLISECONDS}},r);function r(){}t.BrowserPerformanceClock=i}),define("apex-metrics/executor",["require","exports","apex-metrics/types"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetTimeoutExecutor=void 0;var n=(i.prototype.executeEvery=function(e,t){var n=this,i=o.Instant.toMilliseconds(e),r=o.Instant.toMilliseconds(this.jitterStrategy());setTimeout(function(){t()&&n.executeEvery(e,t)},i+r)},i);function i(e){this.jitterStrategy=e}t.SetTimeoutExecutor=n}),define("apex-metrics/internal",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("apex-metrics/metrics",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("apex-metrics/metrics_reporter",["require","exports","apex-metrics/types","apex-metrics/validate"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsReporterImpl=void 0;var i=(r.root=function(e,t){return new r(e,t)},r.prototype.child=function(e){return new r(this.sink,this.clock,Object.assign(Object.assign({},this.tags),n.validateTags(e)))},r.prototype.createStats=function(e,t){return void 0===t&&(t={}),new a(n.validateMetric(e),Object.assign(Object.assign({},this.tags),n.validateTags(t)),this.sink)},r.prototype.createCounter=function(e,t){return void 0===t&&(t={}),new s(n.validateMetric(e),Object.assign(Object.assign({},this.tags),n.validateTags(t)),this.sink)},r.prototype.createTimer=function(e,t){return void 0===t&&(t={}),new c(n.validateMetric(e),Object.assign(Object.assign({},this.tags),n.validateTags(t)),this.sink,this.clock)},r);function r(e,t,n){void 0===n&&(n={}),this.sink=e,this.clock=t,this.tags=n}t.MetricsReporterImpl=i;var a=(p.prototype.record=function(e){d(e,this.metric,this.tags,this.sink)},p.prototype.recordDuration=function(e,t){d(o.Instant.toMilliseconds({value:e,unit:t}),this.metric,this.tags,this.sink)},p),s=(l.prototype.decrement=function(e){this.value-=e=void 0===e?1:e},l.prototype.increment=function(e){this.value+=e=void 0===e?1:e},l.prototype.reset=function(e){this.value=e=void 0===e?0:e},l.prototype.record=function(){d(this.value,this.metric,this.tags,this.sink),this.reset()},l),c=(u.prototype.record=function(){d(o.Instant.toMilliseconds(this.clock.now())-this.value,this.metric,this.tags,this.sink),this.reset()},u.prototype.reset=function(){this.value=o.Instant.toMilliseconds(this.clock.now())},u);function u(e,t,n,i,r){void 0===r&&(r=0),this.metric=e,this.tags=t,this.sink=n,this.clock=i,this.value=r,this.value=o.Instant.toMilliseconds(this.clock.now())}function l(e,t,n,i){void 0===i&&(i=0),this.metric=e,this.tags=t,this.sink=n,this.value=i}function p(e,t,n){this.metric=e,this.tags=t,this.sink=n}function d(e,t,n,i){i.recordSpan({namespace:t.ns,metricName:t.name,tags:n,samples:[e]})}}),define("apex-metrics/no_op",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoOpExecutor=t.NoOpSink=void 0;var n=(i.prototype.recordSpan=function(){},i);function i(){}t.NoOpSink=n;r.prototype.executeEvery=function(){},n=r;function r(){}t.NoOpExecutor=n}),define("apex-metrics/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Instant=t.TimeUnit=void 0,(n=t.TimeUnit||(t.TimeUnit={}))[n.NANOSECONDS=0]="NANOSECONDS",n[n.MILLISECONDS=1]="MILLISECONDS",n[n.SECONDS=2]="SECONDS",n[n.MINUTES=3]="MINUTES",n[n.HOURS=4]="HOURS",n[n.DAYS=5]="DAYS";var n=(i.toMilliseconds=function(e){switch(e.unit){case t.TimeUnit.NANOSECONDS:return e.value/1e6;case t.TimeUnit.MILLISECONDS:return e.value;case t.TimeUnit.SECONDS:return 1e3*e.value;case t.TimeUnit.MINUTES:return 6e4*e.value;case t.TimeUnit.HOURS:return 36e5*e.value;case t.TimeUnit.DAYS:return 24*e.value*36e5}},i);function i(){}t.Instant=n}),define("apex-metrics/validate",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateMetricName=t.validateNamespace=t.validateTags=t.validateMetric=void 0;var i=new RegExp("^[^0-9a-zA-Z]+"),n=new RegExp("[^0-9a-zA-Z._-]","g"),r=n,o=new RegExp("[^0-9a-zA-Z/._-]","g"),a=n;function s(e){return u(e,"namespace",256,i,r)}function c(e){return u(e,"metric name",256,i,o)}function u(e,t,n,i,r){var o=[];if("string"!=typeof e&&o.push("identifier is not a string"),i&&i.test(e)&&o.push("invalid prefix"),r&&r.test(e)&&o.push("invalid characters"),e.length>n&&o.push("exceeds "+n+" characters"),0===e.length&&o.push("is empty"),0!==o.length)throw new Error(t+" identifier '"+e+"' is invalid: "+o);return e}t.validateMetric=function(e){return{ns:s(e.ns),name:c(e.name)}},t.validateTags=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[u(t,"tag name",256,i,a)]=u(e[t],"tag value",256));return n},t.validateNamespace=s,t.validateMetricName=c}),define("google/protobuf/any",["require","exports","tslib","protobufjs/minimal"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.google=void 0;var o=(i=n.__importStar(i)).Reader,r=i.Writer,a=i.util,s=i.roots.default||(i.roots.default={});t.default=s,t.google=s.google=((i=s.google||{}).protobuf=((t=i.protobuf||{}).Any=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.typeUrl="",t.prototype.value=a.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||r.create(),null!=e.typeUrl&&Object.hasOwnProperty.call(e,"typeUrl")&&t.uint32(10).string(e.typeUrl),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).bytes(e.value),t},t.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new s.google.protobuf.Any;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.typeUrl=e.string();break;case 2:i.value=e.bytes();break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/google.protobuf.Any"},t}(t.Any||{}),t),i)}),define("google/protobuf/empty",["require","exports","tslib","protobufjs/minimal"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.google=void 0;var r=(i=n.__importStar(i)).Reader,o=i.Writer,a=(i.util,i.roots.default||(i.roots.default={}));t.default=a,t.google=a.google=((i=a.google||{}).protobuf=((t=i.protobuf||{}).Empty=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||o.create()},t.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,t=new a.google.protobuf.Empty;e.pos<n;){var i=e.uint32();e.skipType(7&i)}return t},t.getTypeUrl=function(){return"type.googleapis.com/google.protobuf.Empty"},t}(t.Empty||{}),t),i)}),define("google/protobuf/timestamp",["require","exports","tslib","protobufjs/minimal"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.google=void 0;var o=(i=n.__importStar(i)).Reader,r=i.Writer,a=(i.util,i.roots.default||(i.roots.default={}));t.default=a,t.google=a.google=((i=a.google||{}).protobuf=((t=i.protobuf||{}).Timestamp=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.seconds=0,t.prototype.nanos=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||r.create(),null!=e.seconds&&Object.hasOwnProperty.call(e,"seconds")&&t.uint32(8).int64(e.seconds),null!=e.nanos&&Object.hasOwnProperty.call(e,"nanos")&&t.uint32(16).int32(e.nanos),t},t.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new a.google.protobuf.Timestamp;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.seconds=e.int64();break;case 2:i.nanos=e.int32();break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/google.protobuf.Timestamp"},t}(t.Timestamp||{}),t),i)}),define("proto_utils/unpack",["require","exports","google/protobuf/any"],function(e,t,c){"use strict";function r(e){return e.constructor.encode(e).finish()}Object.defineProperty(t,"__esModule",{value:!0}),t.unpackProto=t.packProto=t.wrapInProtoAny=void 0,t.wrapInProtoAny=function(e,t){e={value:r(e)};return null!=t&&(e.typeUrl=t),c.google.protobuf.Any.create(e)},t.packProto=function(e){for(var t=r(e),n="",i=0;i<t.byteLength;i++)n+=String.fromCharCode(t[i]);return btoa(n)},t.unpackProto=function(e,t){for(var n=atob(e),i=n.length,r=new Uint8Array(i),o=0;o<i;o++)r[o]=n.charCodeAt(o);function a(e){try{return t.decode(e)}catch(e){throw new Error("Invalid data while trying to unpack encoded proto: "+e)}}var s;try{s=c.google.protobuf.Any.decode(r)}catch(e){}return s&&s.typeUrl&&s.typeUrl.startsWith("type.googleapis.com/")&&s.value?a(s.value):a(r)}}),define("dropbox/proto/js_init_data/web_timing_logger/web_timing_logger",["require","exports","tslib","protobufjs/minimal"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.web_timing_logger=void 0;var u=(i=n.__importStar(i)).Reader,r=i.Writer,l=i.util,p=i.roots.default||(i.roots.default={});t.default=p,t.web_timing_logger=p.web_timing_logger=((t=p.web_timing_logger||{}).WebTimingLoggerServerContext=function(t){function t(e){if(this.subtypes={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var e,n;return t.prototype.isDws=!1,t.prototype.dwsOpts=null,t.prototype.sourceType=0,t.prototype.subtypes=l.emptyObject,t.prototype.url="",t.create=function(e){return new t(e)},t.encode=function(e,t){if(t=t||r.create(),null!=e.isDws&&Object.hasOwnProperty.call(e,"isDws")&&t.uint32(8).bool(e.isDws),null!=e.dwsOpts&&Object.hasOwnProperty.call(e,"dwsOpts")&&p.web_timing_logger.WebTimingLoggerServerContext.DWSOptions.encode(e.dwsOpts,t.uint32(18).fork()).ldelim(),null!=e.sourceType&&Object.hasOwnProperty.call(e,"sourceType")&&t.uint32(24).int32(e.sourceType),null!=e.subtypes&&Object.hasOwnProperty.call(e,"subtypes"))for(var n=Object.keys(e.subtypes),i=0;i<n.length;++i)t.uint32(34).fork().uint32(10).string(n[i]).uint32(18).string(e.subtypes[n[i]]).ldelim();return null!=e.url&&Object.hasOwnProperty.call(e,"url")&&t.uint32(42).string(e.url),t},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.web_timing_logger.WebTimingLoggerServerContext;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.isDws=e.bool();break;case 2:i.dwsOpts=p.web_timing_logger.WebTimingLoggerServerContext.DWSOptions.decode(e,e.uint32());break;case 3:i.sourceType=e.int32();break;case 4:i.subtypes===l.emptyObject&&(i.subtypes={});for(var o=e.uint32()+e.pos,a="",s="";e.pos<o;){var c=e.uint32();switch(c>>>3){case 1:a=e.string();break;case 2:s=e.string();break;default:e.skipType(7&c)}}i.subtypes[a]=s;break;case 5:i.url=e.string();break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/web_timing_logger.WebTimingLoggerServerContext"},t.DWSOptions=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.isDws2=!1,t.prototype.isEarlyEnsemble=!1,t.prototype.jsPreloading=!1,t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||r.create(),null!=e.isDws2&&Object.hasOwnProperty.call(e,"isDws2")&&t.uint32(8).bool(e.isDws2),null!=e.isEarlyEnsemble&&Object.hasOwnProperty.call(e,"isEarlyEnsemble")&&t.uint32(16).bool(e.isEarlyEnsemble),null!=e.jsPreloading&&Object.hasOwnProperty.call(e,"jsPreloading")&&t.uint32(24).bool(e.jsPreloading),t},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.web_timing_logger.WebTimingLoggerServerContext.DWSOptions;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.isDws2=e.bool();break;case 2:i.isEarlyEnsemble=e.bool();break;case 3:i.jsPreloading=e.bool();break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/web_timing_logger.WebTimingLoggerServerContext.DWSOptions"},t}(t.DWSOptions||{}),t.SourceType=(e={},(n=Object.create(e))[e[0]="UNKNOWN"]=0,n[e[1]="DESKTOP_WEB"]=1,n[e[2]="MOBILE_WEB"]=2,n),t}(t.WebTimingLoggerServerContext||{}),t)}),define("dropbox/proto/apex_metrics_web/apex_metrics_web",["require","exports","tslib","protobufjs/minimal","google/protobuf/empty","google/protobuf/timestamp"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.apex_metrics_web=void 0;var u=(i=n.__importStar(i)).Reader,r=i.Writer,l=i.util,p=i.roots.default||(i.roots.default={});t.default=p,t.apex_metrics_web=p.apex_metrics_web=((t=p.apex_metrics_web||{}).RecordNamespace=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||r.create()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,t=new p.apex_metrics_web.RecordNamespace;e.pos<n;){var i=e.uint32();e.skipType(7&i)}return t},t.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace"},t.MetricReportingConfigV2=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.metricNamespace="",t.prototype.maxTimeUntilRefreshSeconds=0,t.prototype.stopPublicationForSeconds=0,t.prototype.dropSamples=null,t.prototype.dropPeriods=null,t.prototype.dropFractionOfHostsPerMetric=0,t.prototype.aggregationIntervalSeconds=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||r.create(),null!=e.metricNamespace&&Object.hasOwnProperty.call(e,"metricNamespace")&&t.uint32(10).string(e.metricNamespace),null!=e.maxTimeUntilRefreshSeconds&&Object.hasOwnProperty.call(e,"maxTimeUntilRefreshSeconds")&&t.uint32(16).uint32(e.maxTimeUntilRefreshSeconds),null!=e.stopPublicationForSeconds&&Object.hasOwnProperty.call(e,"stopPublicationForSeconds")&&t.uint32(24).uint32(e.stopPublicationForSeconds),null!=e.dropSamples&&Object.hasOwnProperty.call(e,"dropSamples")&&p.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.encode(e.dropSamples,t.uint32(34).fork()).ldelim(),null!=e.dropPeriods&&Object.hasOwnProperty.call(e,"dropPeriods")&&p.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.encode(e.dropPeriods,t.uint32(42).fork()).ldelim(),null!=e.dropFractionOfHostsPerMetric&&Object.hasOwnProperty.call(e,"dropFractionOfHostsPerMetric")&&t.uint32(49).double(e.dropFractionOfHostsPerMetric),null!=e.aggregationIntervalSeconds&&Object.hasOwnProperty.call(e,"aggregationIntervalSeconds")&&t.uint32(56).uint32(e.aggregationIntervalSeconds),t},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.apex_metrics_web.RecordNamespace.MetricReportingConfigV2;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.metricNamespace=e.string();break;case 2:i.maxTimeUntilRefreshSeconds=e.uint32();break;case 3:i.stopPublicationForSeconds=e.uint32();break;case 4:i.dropSamples=p.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.decode(e,e.uint32());break;case 5:i.dropPeriods=p.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.decode(e,e.uint32());break;case 6:i.dropFractionOfHostsPerMetric=e.double();break;case 7:i.aggregationIntervalSeconds=e.uint32();break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.MetricReportingConfigV2"},t}(t.MetricReportingConfigV2||{}),t.StickyBiasedCoinV2=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.fraction=0,t.prototype.stickiness=null,t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||r.create(),null!=e.fraction&&Object.hasOwnProperty.call(e,"fraction")&&t.uint32(9).double(e.fraction),null!=e.stickiness&&Object.hasOwnProperty.call(e,"stickiness")&&p.apex_metrics_web.RecordNamespace.StickinessV2.encode(e.stickiness,t.uint32(18).fork()).ldelim(),t},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.fraction=e.double();break;case 2:i.stickiness=p.apex_metrics_web.RecordNamespace.StickinessV2.decode(e,e.uint32());break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.StickyBiasedCoinV2"},t}(t.StickyBiasedCoinV2||{}),t.StickinessV2=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var e;return t.prototype.independent=null,t.prototype.permanent=null,t.prototype.nResults=0,t.prototype.nSeconds=0,Object.defineProperty(t.prototype,"limit",{get:l.oneOfGetter(e=["independent","permanent","nResults","nSeconds"]),set:l.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||r.create(),null!=e.independent&&Object.hasOwnProperty.call(e,"independent")&&p.google.protobuf.Empty.encode(e.independent,t.uint32(10).fork()).ldelim(),null!=e.permanent&&Object.hasOwnProperty.call(e,"permanent")&&p.google.protobuf.Empty.encode(e.permanent,t.uint32(18).fork()).ldelim(),null!=e.nResults&&Object.hasOwnProperty.call(e,"nResults")&&t.uint32(24).uint32(e.nResults),null!=e.nSeconds&&Object.hasOwnProperty.call(e,"nSeconds")&&t.uint32(37).float(e.nSeconds),t},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.apex_metrics_web.RecordNamespace.StickinessV2;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.independent=p.google.protobuf.Empty.decode(e,e.uint32());break;case 2:i.permanent=p.google.protobuf.Empty.decode(e,e.uint32());break;case 3:i.nResults=e.uint32();break;case 4:i.nSeconds=e.float();break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.StickinessV2"},t}(t.StickinessV2||{}),t.RecordResponse=function(t){function t(e){if(this.reportingConfigs=[],this.debugInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.reportingConfigs=l.emptyArray,t.prototype.publicationIntervalSeconds=0,t.prototype.maxScopesPerRequest=0,t.prototype.stopPublicationForSeconds=0,t.prototype.debugInfos=l.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,t){if(t=t||r.create(),null!=e.reportingConfigs&&e.reportingConfigs.length)for(var n=0;n<e.reportingConfigs.length;++n)p.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.encode(e.reportingConfigs[n],t.uint32(10).fork()).ldelim();if(null!=e.publicationIntervalSeconds&&Object.hasOwnProperty.call(e,"publicationIntervalSeconds")&&t.uint32(24).uint32(e.publicationIntervalSeconds),null!=e.maxScopesPerRequest&&Object.hasOwnProperty.call(e,"maxScopesPerRequest")&&t.uint32(32).uint32(e.maxScopesPerRequest),null!=e.stopPublicationForSeconds&&Object.hasOwnProperty.call(e,"stopPublicationForSeconds")&&t.uint32(40).uint32(e.stopPublicationForSeconds),null!=e.debugInfos&&e.debugInfos.length)for(n=0;n<e.debugInfos.length;++n)t.uint32(50).string(e.debugInfos[n]);return t},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.apex_metrics_web.RecordNamespace.RecordResponse;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.reportingConfigs&&i.reportingConfigs.length||(i.reportingConfigs=[]),i.reportingConfigs.push(p.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.decode(e,e.uint32()));break;case 3:i.publicationIntervalSeconds=e.uint32();break;case 4:i.maxScopesPerRequest=e.uint32();break;case 5:i.stopPublicationForSeconds=e.uint32();break;case 6:i.debugInfos&&i.debugInfos.length||(i.debugInfos=[]),i.debugInfos.push(e.string());break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.RecordResponse"},t}(t.RecordResponse||{}),t}(t.RecordNamespace||{}),t.ApexMetricsCacheData=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.config=null,t.prototype.timeStored=null,t.prototype.state=null,t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||r.create(),null!=e.config&&Object.hasOwnProperty.call(e,"config")&&p.apex_metrics_web.RecordNamespace.RecordResponse.encode(e.config,t.uint32(10).fork()).ldelim(),null!=e.timeStored&&Object.hasOwnProperty.call(e,"timeStored")&&p.google.protobuf.Timestamp.encode(e.timeStored,t.uint32(18).fork()).ldelim(),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&p.apex_metrics_web.ApexMetricsCacheData.FilterState.encode(e.state,t.uint32(26).fork()).ldelim(),t},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.apex_metrics_web.ApexMetricsCacheData;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.config=p.apex_metrics_web.RecordNamespace.RecordResponse.decode(e,e.uint32());break;case 2:i.timeStored=p.google.protobuf.Timestamp.decode(e,e.uint32());break;case 3:i.state=p.apex_metrics_web.ApexMetricsCacheData.FilterState.decode(e,e.uint32());break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData"},t.CoinState=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.lastFlipTime=null,t.prototype.lastResult=!1,t.prototype.numTimesChecked=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||r.create(),null!=e.lastFlipTime&&Object.hasOwnProperty.call(e,"lastFlipTime")&&p.google.protobuf.Timestamp.encode(e.lastFlipTime,t.uint32(10).fork()).ldelim(),null!=e.lastResult&&Object.hasOwnProperty.call(e,"lastResult")&&t.uint32(16).bool(e.lastResult),null!=e.numTimesChecked&&Object.hasOwnProperty.call(e,"numTimesChecked")&&t.uint32(24).uint32(e.numTimesChecked),t},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.apex_metrics_web.ApexMetricsCacheData.CoinState;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.lastFlipTime=p.google.protobuf.Timestamp.decode(e,e.uint32());break;case 2:i.lastResult=e.bool();break;case 3:i.numTimesChecked=e.uint32();break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.CoinState"},t}(t.CoinState||{}),t.NamespaceCoinState=function(t){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.dropPeriodCoin=null,t.prototype.dropSamplesCoin=null,t.create=function(e){return new t(e)},t.encode=function(e,t){return t=t||r.create(),null!=e.dropPeriodCoin&&Object.hasOwnProperty.call(e,"dropPeriodCoin")&&p.apex_metrics_web.ApexMetricsCacheData.CoinState.encode(e.dropPeriodCoin,t.uint32(10).fork()).ldelim(),null!=e.dropSamplesCoin&&Object.hasOwnProperty.call(e,"dropSamplesCoin")&&p.apex_metrics_web.ApexMetricsCacheData.CoinState.encode(e.dropSamplesCoin,t.uint32(18).fork()).ldelim(),t},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.dropPeriodCoin=p.apex_metrics_web.ApexMetricsCacheData.CoinState.decode(e,e.uint32());break;case 2:i.dropSamplesCoin=p.apex_metrics_web.ApexMetricsCacheData.CoinState.decode(e,e.uint32());break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState"},t}(t.NamespaceCoinState||{}),t.FilterState=function(t){function t(e){if(this.namespaceCoinState={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.filterID=0,t.prototype.namespaceCoinState=l.emptyObject,t.create=function(e){return new t(e)},t.encode=function(e,t){if(t=t||r.create(),null!=e.filterID&&Object.hasOwnProperty.call(e,"filterID")&&t.uint32(8).uint32(e.filterID),null!=e.namespaceCoinState&&Object.hasOwnProperty.call(e,"namespaceCoinState"))for(var n=Object.keys(e.namespaceCoinState),i=0;i<n.length;++i)t.uint32(18).fork().uint32(10).string(n[i]),p.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState.encode(e.namespaceCoinState[n[i]],t.uint32(18).fork()).ldelim().ldelim();return t},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.apex_metrics_web.ApexMetricsCacheData.FilterState;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.filterID=e.uint32();break;case 2:i.namespaceCoinState===l.emptyObject&&(i.namespaceCoinState={});for(var o=e.uint32()+e.pos,a="",s=null;e.pos<o;){var c=e.uint32();switch(c>>>3){case 1:a=e.string();break;case 2:s=p.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState.decode(e,e.uint32());break;default:e.skipType(7&c)}}i.namespaceCoinState[a]=s;break;default:e.skipType(7&r)}}return i},t.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.FilterState"},t}(t.FilterState||{}),t}(t.ApexMetricsCacheData||{}),t)}),define("prod_assets_web_modules/protobufjs/minimal",["../common/_commonjsHelpers"],function(_commonjsHelpers){"use strict";var aspromise=asPromise;function asPromise(e,t){for(var n=new Array(arguments.length-1),o=0,i=2,a=!0;i<arguments.length;)n[o++]=arguments[i++];return new Promise(function(i,r){n[o]=function(e){if(a)if(a=!1,e)r(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){a&&(a=!1,r(e))}})}var base64_1=_commonjsHelpers.createCommonjsModule(function(e,t){t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;1<--t%4&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var u=new Array(64),c=new Array(123),n=0;n<64;)c[u[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;t.encode=function(e,t,n){for(var i,r=null,o=[],a=0,s=0;t<n;){var c=e[t++];switch(s){case 0:o[a++]=u[c>>2],i=(3&c)<<4,s=1;break;case 1:o[a++]=u[i|c>>4],i=(15&c)<<2,s=2;break;case 2:o[a++]=u[i|c>>6],o[a++]=u[63&c],s=0}8191<a&&((r=r||[]).push(String.fromCharCode.apply(String,o)),a=0)}return s&&(o[a++]=u[i],o[a++]=61,1===s&&(o[a++]=61)),r?(a&&r.push(String.fromCharCode.apply(String,o.slice(0,a))),r.join("")):String.fromCharCode.apply(String,o.slice(0,a))},t.decode=function(e,t,n){for(var i,r=n,o=0,a=0;a<e.length;){var s=e.charCodeAt(a++);if(61===s&&1<o)break;if(void 0===(s=c[s]))throw Error("invalid encoding");switch(o){case 0:i=s,o=1;break;case 1:t[n++]=i<<2|(48&s)>>4,i=s,o=2;break;case 2:t[n++]=(15&i)<<4|(60&s)>>2,i=s,o=3;break;case 3:t[n++]=(3&i)<<6|s,o=0}}if(1===o)throw Error("invalid encoding");return n-r},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}),eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},EventEmitter.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this},EventEmitter.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this};var float=factory(factory);function factory(e){return"undefined"!=typeof Float32Array?(u=new Float32Array([-0]),l=new Uint8Array(u.buffer),p=128===l[3],e.writeFloatLE=p?f:_,e.writeFloatBE=p?_:f,e.readFloatLE=p?h:g,e.readFloatBE=p?g:h):(e.writeFloatLE=d.bind(null,writeUintLE),e.writeFloatBE=d.bind(null,writeUintBE),e.readFloatLE=m.bind(null,readUintLE),e.readFloatBE=m.bind(null,readUintBE)),"undefined"!=typeof Float64Array?(s=new Float64Array([-0]),c=new Uint8Array(s.buffer),p=128===c[7],e.writeDoubleLE=p?i:r,e.writeDoubleBE=p?r:i,e.readDoubleLE=p?o:a,e.readDoubleBE=p?a:o):(e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0),e.readDoubleLE=n.bind(null,readUintLE,0,4),e.readDoubleBE=n.bind(null,readUintBE,4,0)),e;function t(e,t,n,i,r,o){var a,s,c=i<0?1:0;0===(i=c?-i:i)?(e(0,r,o+t),e(0<1/i?0:2147483648,r,o+n)):isNaN(i)?(e(0,r,o+t),e(2146959360,r,o+n)):17976931348623157e292<i?(e(0,r,o+t),e((c<<31|2146435072)>>>0,r,o+n)):i<22250738585072014e-324?(e((a=i/5e-324)>>>0,r,o+t),e((c<<31|a/4294967296)>>>0,r,o+n)):(1024===(s=Math.floor(Math.log(i)/Math.LN2))&&(s=1023),e(4503599627370496*(a=i*Math.pow(2,-s))>>>0,r,o+t),e((c<<31|s+1023<<20|1048576*a&1048575)>>>0,r,o+n))}function n(e,t,n,i,r){t=e(i,r+t),i=e(i,r+n),r=2*(i>>31)+1,n=i>>>20&2047,t=4294967296*(1048575&i)+t;return 2047==n?t?NaN:1/0*r:0==n?5e-324*r*t:r*Math.pow(2,n-1075)*(t+4503599627370496)}function i(e,t,n){s[0]=e,t[n]=c[0],t[n+1]=c[1],t[n+2]=c[2],t[n+3]=c[3],t[n+4]=c[4],t[n+5]=c[5],t[n+6]=c[6],t[n+7]=c[7]}function r(e,t,n){s[0]=e,t[n]=c[7],t[n+1]=c[6],t[n+2]=c[5],t[n+3]=c[4],t[n+4]=c[3],t[n+5]=c[2],t[n+6]=c[1],t[n+7]=c[0]}function o(e,t){return c[0]=e[t],c[1]=e[t+1],c[2]=e[t+2],c[3]=e[t+3],c[4]=e[t+4],c[5]=e[t+5],c[6]=e[t+6],c[7]=e[t+7],s[0]}function a(e,t){return c[7]=e[t],c[6]=e[t+1],c[5]=e[t+2],c[4]=e[t+3],c[3]=e[t+4],c[2]=e[t+5],c[1]=e[t+6],c[0]=e[t+7],s[0]}var s,c,u,l,p;function d(e,t,n,i){var r=t<0?1:0;0===(t=r?-t:t)?e(0<1/t?0:2147483648,n,i):isNaN(t)?e(2143289344,n,i):e(34028234663852886e22<t?(r<<31|2139095040)>>>0:t<11754943508222875e-54?(r<<31|Math.round(t/1401298464324817e-60))>>>0:(r<<31|(r=Math.floor(Math.log(t)/Math.LN2))+127<<23|8388607&Math.round(t*Math.pow(2,-r)*8388608))>>>0,n,i)}function m(e,t,n){e=e(t,n),t=2*(e>>31)+1,n=e>>>23&255,e&=8388607;return 255==n?e?NaN:1/0*t:0==n?1401298464324817e-60*t*e:t*Math.pow(2,n-150)*(8388608+e)}function f(e,t,n){u[0]=e,t[n]=l[0],t[n+1]=l[1],t[n+2]=l[2],t[n+3]=l[3]}function _(e,t,n){u[0]=e,t[n]=l[3],t[n+1]=l[2],t[n+2]=l[1],t[n+3]=l[0]}function h(e,t){return l[0]=e[t],l[1]=e[t+1],l[2]=e[t+2],l[3]=e[t+3],u[0]}function g(e,t){return l[3]=e[t],l[2]=e[t+1],l[1]=e[t+2],l[0]=e[t+3],u[0]}}function writeUintLE(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function writeUintBE(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8_1=_commonjsHelpers.createCommonjsModule(function(e,t){t.length=function(e){for(var t,n=0,i=0;i<e.length;++i)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:55296==(64512&t)&&56320==(64512&e.charCodeAt(i+1))?(++i,n+=4):n+=3;return n},t.read=function(e,t,n){if(n-t<1)return"";for(var i,r=null,o=[],a=0;t<n;)(i=e[t++])<128?o[a++]=i:191<i&&i<224?o[a++]=(31&i)<<6|63&e[t++]:239<i&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(i>>10),o[a++]=56320+(1023&i)):o[a++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],8191<a&&((r=r||[]).push(String.fromCharCode.apply(String,o)),a=0);return r?(a&&r.push(String.fromCharCode.apply(String,o.slice(0,a))),r.join("")):String.fromCharCode.apply(String,o.slice(0,a))},t.write=function(e,t,n){for(var i,r,o=n,a=0;a<e.length;++a)(i=e.charCodeAt(a))<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(55296==(64512&i)&&56320==(64512&(r=e.charCodeAt(a+1)))?(++a,t[n++]=(i=65536+((1023&i)<<10)+(1023&r))>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128);return n-o}}),pool_1=pool;function pool(t,n,e){var i=e||8192,r=i>>>1,o=null,a=i;return function(e){if(e<1||r<e)return t(e);i<a+e&&(o=t(i),a=0);e=n.call(o,a,a+=e);return 7&a&&(a=1+(7|a)),e}}var minimal=_commonjsHelpers.createCommonjsModule(function(e,t){var i=t;function r(e,t){this.lo=e>>>0,this.hi=t>>>0}i.asPromise=aspromise,i.base64=base64_1,i.EventEmitter=eventemitter,i.float=float,i.inquire=inquire_1,i.utf8=utf8_1,i.pool=pool_1;var o=r.zero=new r(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};r.zeroHash="\0\0\0\0\0\0\0\0";r.fromNumber=function(e){if(0===e)return o;var t=e<0,n=(e=t?-e:e)>>>0,e=(e-n)/4294967296>>>0;return t&&(e=~e>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++e&&(e=0))),new r(n,e)},r.from=function(e){if("number"==typeof e)return r.fromNumber(e);if(i.isString(e)){if(!i.Long)return r.fromNumber(parseInt(e,10));e=i.Long.fromString(e)}return e.low||e.high?new r(e.low>>>0,e.high>>>0):o},r.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,e=~this.hi>>>0;return-(t+4294967296*(e=!t?e+1>>>0:e))}return this.lo+4294967296*this.hi},r.prototype.toLong=function(e){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var n=String.prototype.charCodeAt;function a(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;++r)void 0!==e[i[r]]&&n||(e[i[r]]=t[i[r]]);return e}function s(e){function n(e,t){if(!(this instanceof n))return new n(e,t);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),t&&a(this,t)}return(n.prototype=Object.create(Error.prototype)).constructor=n,Object.defineProperty(n.prototype,"name",{get:function(){return e}}),n.prototype.toString=function(){return this.name+": "+this.message},n}r.fromHash=function(e){return"\0\0\0\0\0\0\0\0"===e?o:new r((n.call(e,0)|n.call(e,1)<<8|n.call(e,2)<<16|n.call(e,3)<<24)>>>0,(n.call(e,4)|n.call(e,5)<<8|n.call(e,6)<<16|n.call(e,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},r.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},r.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0==n?0==t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10},i.LongBits=r,i.isNode=Boolean(void 0!==_commonjsHelpers.commonjsGlobal&&_commonjsHelpers.commonjsGlobal&&_commonjsHelpers.commonjsGlobal.process&&_commonjsHelpers.commonjsGlobal.process.versions&&_commonjsHelpers.commonjsGlobal.process.versions.node),i.global=i.isNode&&_commonjsHelpers.commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||_commonjsHelpers.commonjsGlobal,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},i.isString=function(e){return"string"==typeof e||e instanceof String},i.isObject=function(e){return e&&"object"==typeof e},i.isset=i.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||0<(Array.isArray(n)?n:Object.keys(n)).length)},i.Buffer=function(){try{var e=i.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(e){return"number"==typeof e?i.Buffer?i._Buffer_allocUnsafe(e):new i.Array(e):i.Buffer?i._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(e){return e?i.LongBits.from(e).toHash():i.LongBits.zeroHash},i.longFromHash=function(e,t){e=i.LongBits.fromHash(e);return i.Long?i.Long.fromBits(e.lo,e.hi,t):e.toNumber(Boolean(t))},i.merge=a,i.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},i.newError=s,i.ProtocolError=s("ProtocolError"),i.oneOfGetter=function(e){for(var n={},t=0;t<e.length;++t)n[e[t]]=1;return function(){for(var e=Object.keys(this),t=e.length-1;-1<t;--t)if(1===n[e[t]]&&void 0!==this[e[t]]&&null!==this[e[t]])return e[t]}},i.oneOfSetter=function(n){return function(e){for(var t=0;t<n.length;++t)n[t]!==e&&delete this[n[t]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var n=i.Buffer;n?(i._Buffer_from=n.from!==Uint8Array.from&&n.from||function(e,t){return new n(e,t)},i._Buffer_allocUnsafe=n.allocUnsafe||function(e){return new n(e)}):i._Buffer_from=i._Buffer_allocUnsafe=null}}),writer=Writer,BufferWriter,LongBits=minimal.LongBits,base64=minimal.base64,utf8=minimal.utf8;function Op(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create=function(){return minimal.Buffer?function(){return(Writer.create=function(){return new BufferWriter})()}:function(){return new Writer}};function writeByte(e,t,n){t[n]=255&e}function writeVarint32(e,t,n){for(;127<e;)t[n++]=127&e|128,e>>>=7;t[n]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function writeFixed32(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}Writer.create=create(),Writer.alloc=function(e){return new minimal.Array(e)},minimal.Array!==Array&&(Writer.alloc=minimal.pool(Writer.alloc,minimal.Array.prototype.subarray)),Writer.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Op(e,t,n),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits.fromNumber(e)):this.uint32(e)},Writer.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer.prototype.uint64=function(e){e=LongBits.from(e);return this._push(writeVarint64,e.length(),e)},Writer.prototype.int64=Writer.prototype.uint64,Writer.prototype.sint64=function(e){e=LongBits.from(e).zzEncode();return this._push(writeVarint64,e.length(),e)},Writer.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer.prototype.sfixed32=Writer.prototype.fixed32,Writer.prototype.fixed64=function(e){e=LongBits.from(e);return this._push(writeFixed32,4,e.lo)._push(writeFixed32,4,e.hi)},Writer.prototype.sfixed64=Writer.prototype.fixed64,Writer.prototype.float=function(e){return this._push(minimal.float.writeFloatLE,4,e)},Writer.prototype.double=function(e){return this._push(minimal.float.writeDoubleLE,8,e)};var writeBytes=minimal.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};Writer.prototype.bytes=function(e){var t,n=e.length>>>0;return n?(minimal.isString(e)&&(t=Writer.alloc(n=base64.length(e)),base64.decode(e,t,0),e=t),this.uint32(n)._push(writeBytes,n,e)):this._push(writeByte,1,0)},Writer.prototype.string=function(e){var t=utf8.length(e);return t?this.uint32(t)._push(utf8.write,t,e):this._push(writeByte,1,0)},Writer.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},Writer.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},Writer._configure=function(e){BufferWriter=e,Writer.create=create(),BufferWriter._configure()};var writer_buffer=BufferWriter$1;function BufferWriter$1(){writer.call(this)}function writeStringBuffer(e,t,n){e.length<40?minimal.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}(BufferWriter$1.prototype=Object.create(writer.prototype)).constructor=BufferWriter$1,BufferWriter$1._configure=function(){BufferWriter$1.alloc=minimal._Buffer_allocUnsafe,BufferWriter$1.writeBytesBuffer=minimal.Buffer&&minimal.Buffer.prototype instanceof Uint8Array&&"set"===minimal.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}},BufferWriter$1.prototype.bytes=function(e){var t=(e=minimal.isString(e)?minimal._Buffer_from(e,"base64"):e).length>>>0;return this.uint32(t),t&&this._push(BufferWriter$1.writeBytesBuffer,t,e),this},BufferWriter$1.prototype.string=function(e){var t=minimal.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter$1._configure();var reader=Reader,BufferReader,LongBits$1=minimal.LongBits,utf8$1=minimal.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader(e);throw Error("illegal buffer")},create$1=function(){return minimal.Buffer?function(e){return(Reader.create=function(e){return minimal.Buffer.isBuffer(e)?new BufferReader(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits$1(0,0),t=0;if(!(4<this.len-this.pos)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,4<this.len-this.pos){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits$1(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader.create=create$1(),Reader.prototype._slice=minimal.Array.prototype.subarray||minimal.Array.prototype.slice,Reader.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader.prototype.int32=function(){return 0|this.uint32()},Reader.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader.prototype.bool=function(){return 0!==this.uint32()},Reader.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=minimal.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=minimal.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},Reader.prototype.string=function(){var e=this.bytes();return utf8$1.read(e,0,e.length)},Reader.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader._configure=function(e){BufferReader=e,Reader.create=create$1(),BufferReader._configure();var t=minimal.Long?"toLong":"toNumber";minimal.merge(Reader.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader$1;function BufferReader$1(e){reader.call(this,e)}(BufferReader$1.prototype=Object.create(reader.prototype)).constructor=BufferReader$1,BufferReader$1._configure=function(){minimal.Buffer&&(BufferReader$1.prototype._slice=minimal.Buffer.prototype.slice)},BufferReader$1.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader$1._configure();var service=Service;function Service(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");minimal.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(Service.prototype=Object.create(minimal.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(n,t,i,r,o){if(!r)throw TypeError("request must be specified");var a=this;if(!o)return minimal.asPromise(e,a,n,t,i,r);if(a.rpcImpl)try{return a.rpcImpl(n,t[a.requestDelimited?"encodeDelimited":"encode"](r).finish(),function(e,t){if(e)return a.emit("error",e,n),o(e);if(null!==t){if(!(t instanceof i))try{t=i[a.responseDelimited?"decodeDelimited":"decode"](t)}catch(e){return a.emit("error",e,n),o(e)}return a.emit("data",t,n),o(null,t)}a.end(!0)})}catch(e){return a.emit("error",e,n),void setTimeout(function(){o(e)},0)}else setTimeout(function(){o(Error("already ended"))},0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var rpc_1=_commonjsHelpers.createCommonjsModule(function(e,t){t.Service=service}),roots={},indexMinimal=_commonjsHelpers.createCommonjsModule(function(e,t){var n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=writer,n.BufferWriter=writer_buffer,n.Reader=reader,n.BufferReader=reader_buffer,n.util=minimal,n.rpc=rpc_1,n.roots=roots,n.configure=i,i()}),minimal$1=indexMinimal;return minimal$1});
