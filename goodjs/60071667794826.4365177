define("modules/helpers/nflTokenHelper",["jquery","modules/services/deferredService","modules/helpers/browserHelper","modules/helpers/stringHelper","modules/helpers/dateHelper"],function(o,t,n,r,i){var l,u,a=(l=function(){return localStorage.getItem("deviceInfo")},u=function(){return localStorage.getItem("networkType")},{getClientType:function(){var e="WEB_DESKTOP_DESKTOP";return n.isIOS()&&n.isMobile()?e="WEB_IOS_MOBILE_WEB":n.isIOS()&&n.isTablet()?e="WEB_IOS_TABLET_WEB":n.isAndroid()&&n.isMobile()?e="WEB_ANDROID_MOBILE_WEB":n.isAndroid()&&n.isTablet()&&(e="WEB_ANDROID_TABLET_WEB"),e},getDeviceId:function(){var e=this.getTokenFromLs();return e&&e.rawData&&e.rawData.deviceId?e.rawData.deviceId:r.generateGuid()},isTokenExpired:function(e){return!e||!e.expires||i.getDateByMS(e.expires)<=i.getCurrentDate()||i.getDateByMS(e.expires)>=i.addHours(i.getCurrentDate(),2)},getTokenFromLs:function(){var e=localStorage.getItem("nfl.nflToken");return e?JSON.parse(e):null},getToken:function(e){var n=o.Deferred(),r=a.getTokenFromLs();if(r&&!a.isTokenExpired(r))return n.resolve(r),n.promise();var t=void 0!==e?e:{},r=!o.isEmptyObject(t),e=s(),r=e&&r?c:e&&!r?p:!e&&r?v:g;return o.when(r(t)).done(function(e){n.resolve(e)}).fail(function(){n.resolve(null)}),n.promise()},transformToken:function(e){if(!e||!e.accessToken)return null;var n=r.parseJwt(e.accessToken);return{expires:1e3*e.expiresIn,rawData:o.extend({},e,n)}},storeToken:function(e){e&&localStorage.setItem("nfl.nflToken",JSON.stringify(e))},removeToken:function(){localStorage.removeItem("nfl.nflToken")}});function s(){return localStorage.getItem("authorizationProviderUserId")}function f(){return localStorage.getItem("identityProviderId")}function d(){var e=l();return{ClientType:a.getClientType(),DeviceId:a.getDeviceId(),DeviceInfo:e?btoa(e):null,NetworkType:u(),UserAgent:n.getUserAgent()}}function c(e){var n=o.Deferred(),r=d();return o.extend(r,{AuthorizationProviderUserId:s(),IdentityProviderId:f(),Uid:e?e.UID:null,UidSignature:e?e.UIDSignature:null,SignatureTimestamp:e?parseInt(e.signatureTimestamp):null}),t.postJson("/oauth/nfl/token/full",r).done(function(e){n.resolve(a.transformToken(e))}).fail(function(){n.resolve(null)}),n.promise()}function p(){var n=o.Deferred(),e=d();return o.extend(e,{AuthorizationProviderUserId:s(),IdentityProviderId:f()}),t.postJson("/oauth/nfl/token/mvpd",e).done(function(e){n.resolve(a.transformToken(e))}).fail(function(){n.reject(null)}),n.promise()}function v(e){var n=o.Deferred(),r=d();return o.extend(r,{Uid:e?e.UID:null,UidSignature:e?e.UIDSignature:null,SignatureTimestamp:e?parseInt(e.signatureTimestamp):null}),t.postJson("/oauth/nfl/token/user",r).done(function(e){n.resolve(a.transformToken(e))}).fail(function(){n.reject(null)}),n.promise()}function g(){var n=o.Deferred(),e=d();return t.postJson("/oauth/nfl/token/client",e).done(function(e){n.resolve(a.transformToken(e))}).fail(function(){n.reject(null)}),n.promise()}return a});
