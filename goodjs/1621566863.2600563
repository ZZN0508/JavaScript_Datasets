'use strict';var _createClass=function(){function a(b,d){for(var f,e=0;e<d.length;e++)f=d[e],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,d,e){return d&&a(b.prototype,d),e&&a(b,e),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var JssoCrosswalk=function(){function a(b,d){_classCallCheck(this,a),this.channel=b,this.platform=d,this.ssoBaseUrl='https://jsso.indiatimes.com/sso/crossapp/identity/web/',this.socialappBaseUrl='https://socialappsintegrator.indiatimes.com/socialsite/crossapp/web/',this.sdkVersion='0.5.3',this.csrfToken=this.getCookie('jsso_crosswalk_csrfToken_'+this.channel),this.ssec=this.getCookie('jsso_crosswalk_ssec_'+this.channel),this.tksec=this.getCookie('jsso_crosswalk_tksec_'+this.channel),this.csut=this.getCookie('csut'),this.gdpr=this.getCookie('gdpr'),this.UNAUTHORIZED_ACCESS_RESPONSE={code:404,message:'UNAUTHORIZED_ACCESS',status:'FAILURE',data:null},this.CONNECTION_ERROR_RESPONSE={code:503,message:'CONNECTION_ERROR',status:'FAILURE',data:null},this.CONNECTION_TIMEOUT_RESPONSE={code:504,message:'CONNECTION_TIMEOUT',status:'FAILURE',data:null},this.APP_CONNECTION_TIMEOUT_RESPONSE={code:505,message:'TRUECALLER_LOGIN_FAILURE',status:'FAILURE',data:null},this.INVALID_MOBILE={code:402,message:'INVALID_MOBILE',status:'FAILURE',data:null},this.INVALID_EMAIL={code:403,message:'INVALID_EMAIL',status:'FAILURE',data:null},this.INVALID_REQUEST={code:413,message:'INVALID_REQUEST',status:'FAILURE',data:null},this.INVALID_PASSWORD={code:417,message:'INVALID_PASSWORD',status:'FAILURE',data:null};var e=this.getChannelCookies();''!=e.login&&''==e.daily&&this.getValidLoggedInUser()}return _createClass(a,[{key:'asyncJssoCall',value:function asyncJssoCall(b,d,e){this.asyncCall(this.ssoBaseUrl+b,d,e)}},{key:'asyncSocialappCall',value:function asyncSocialappCall(b,d,e){this.asyncCall(this.socialappBaseUrl+b,d,e)}},{key:'asyncCall',value:function asyncCall(b,d,e){var f=new XMLHttpRequest;f.open('POST',b),f.timeout=3e4,f.withCredentials=!0,f.setRequestHeader('content-type','application/json'),f.setRequestHeader('channel',this.channel),f.setRequestHeader('platform',this.platform),f.setRequestHeader('sdkVersion',this.sdkVersion),f.setRequestHeader('IsJssoCrosswalk','true'),f.setRequestHeader('csrfToken',this.csrfToken),f.setRequestHeader('ssec',this.ssec),f.setRequestHeader('tksec',this.tksec),f.setRequestHeader('csut',this.csut),f.setRequestHeader('gdpr',this.gdpr),f.responseType='json',f.onload=function(){var g=f.response;return('string'==typeof g&&(g=JSON.parse(g)),!g||!g.code)?(this.deleteChannelCookies(),void(e&&e(this.UNAUTHORIZED_ACCESS_RESPONSE))):404==g.code?(this.deleteChannelCookies(),void(e&&e(g))):(f.getResponseHeader('csrfToken')&&(this.csrfToken=f.getResponseHeader('csrfToken')),f.getResponseHeader('ssec')&&(this.ssec=f.getResponseHeader('ssec')),f.getResponseHeader('tksec')&&(this.tksec=f.getResponseHeader('tksec')),f.getResponseHeader('csut')&&(this.csut=f.getResponseHeader('csut')),f.getResponseHeader('gdpr')&&(this.gdpr=f.getResponseHeader('gdpr')),e)?e(g):void 0}.bind(this),f.onerror=function(){if(e)return e(this.CONNECTION_ERROR_RESPONSE)}.bind(this),f.ontimeout=function(){if(e)return e(this.CONNECTION_TIMEOUT_RESPONSE)}.bind(this),f.send(JSON.stringify(d))}},{key:'getValidLoggedInUser',value:function getValidLoggedInUser(b){this.asyncJssoCall('loggedInUser',{},function(d){if(200==d.code&&this.createChannelCookies(),b)return b(d)}.bind(this))}},{key:'checkUserExists',value:function checkUserExists(b,d){this.asyncJssoCall('checkUserExists',{identifier:b},d)}},{key:'registerUser',value:function registerUser(b,d,e,f,g,h,j,k,l,m,n,o){return g||h?g&&!this.isValidEmail(g)?o(this.INVALID_EMAIL):h&&!this.isValidMobile(h)?o(this.INVALID_MOBILE):this.isValidPassword(j)?void this.asyncJssoCall('registerUser',{firstName:b,lastName:d,gender:e,dob:f,email:g,mobile:h,password:j,isSendOffer:k,termsAccepted:l,shareDataAllowed:m,timespointsPolicy:n},o):o(this.INVALID_PASSWORD):o(this.INVALID_REQUEST)}},{key:'registerUserRecaptcha',value:function registerUserRecaptcha(b,d,e,f,g,h,j,k,l,m,n,o,p){return g||h?g&&!this.isValidEmail(g)?p(this.INVALID_EMAIL):h&&!this.isValidMobile(h)?p(this.INVALID_MOBILE):this.isValidPassword(j)?void this.asyncJssoCall('registerUserRecaptcha',{firstName:b,lastName:d,gender:e,dob:f,email:g,mobile:h,password:j,isSendOffer:k,recaptcha:l,termsAccepted:m,shareDataAllowed:n,timespointsPolicy:o},p):p(this.INVALID_PASSWORD):p(this.INVALID_REQUEST)}},{key:'resendMobileSignUpOtp',value:function resendMobileSignUpOtp(b,d,e){return this.isValidMobile(b)?void this.asyncJssoCall('resendSignUpOtp',{mobile:b,ssoid:d},e):e(this.INVALID_MOBILE)}},{key:'resendEmailSignUpOtp',value:function resendEmailSignUpOtp(b,d,e){return this.isValidEmail(b)?void this.asyncJssoCall('resendSignUpOtp',{email:b,ssoid:d},e):e(this.INVALID_EMAIL)}},{key:'verifyMobileSignUp',value:function verifyMobileSignUp(b,d,e,f){return this.isValidMobile(b)?void this.asyncJssoCall('verifySignUpOTP',{mobile:b,ssoid:d,otp:e},function(g){if(200==g.code&&this.createChannelCookies(),f)return f(g)}.bind(this)):f(this.INVALID_MOBILE)}},{key:'verifyEmailSignUp',value:function verifyEmailSignUp(b,d,e,f){return this.isValidEmail(b)?void this.asyncJssoCall('verifySignUpOTP',{email:b,ssoid:d,otp:e},function(g){if(200==g.code&&this.createChannelCookies(),f)return f(g)}.bind(this)):f(this.INVALID_EMAIL)}},{key:'verifyMobileLogin',value:function verifyMobileLogin(b,d,e){return this.isValidMobile(b)?void this.asyncJssoCall('verifyLoginOtpPassword',{mobile:b,password:d},function(f){if(200==f.code&&this.createChannelCookies(),e)return e(f)}.bind(this)):e(this.INVALID_MOBILE)}},{key:'verifyEmailLogin',value:function verifyEmailLogin(b,d,e){return this.isValidEmail(b)?void this.asyncJssoCall('verifyLoginOtpPassword',{email:b,password:d},function(f){if(200==f.code&&this.createChannelCookies(),e)return e(f)}.bind(this)):e(this.INVALID_EMAIL)}},{key:'facebookLogin',value:function facebookLogin(b,d,e){this.asyncSocialappCall('facebookLogin',{code:b,facebookRedirectUri:d},function(f){if(200==f.code&&this.createChannelCookies(),e)return e(f)}.bind(this))}},{key:'googleplusLogin',value:function googleplusLogin(b,d,e){this.asyncSocialappCall('googleplusLogin',{code:b,googleplusRedirectUri:d},function(f){if(200==f.code&&this.createChannelCookies(),e)return e(f)}.bind(this))}},{key:'linkedinLogin',value:function linkedinLogin(b,d,e){this.asyncSocialappCall('linkedinLogin',{code:b,linkedinRedirectUri:d},function(f){if(200==f.code&&this.createChannelCookies(),e)return e(f)}.bind(this))}},{key:'getUserProfile',value:function getUserProfile(b){this.asyncJssoCall('getUserProfile',{},b)}},{key:'getUserDetails',value:function getUserDetails(b){this.asyncJssoCall('getUserDetails',{},b)}},{key:'getMobileLoginOtp',value:function getMobileLoginOtp(b,d){return this.isValidMobile(b)?void this.asyncJssoCall('getLoginOtp',{mobile:b},d):d(this.INVALID_MOBILE)}},{key:'getEmailLoginOtp',value:function getEmailLoginOtp(b,d){return this.isValidEmail(b)?void this.asyncJssoCall('getLoginOtp',{email:b},d):d(this.INVALID_EMAIL)}},{key:'updateUserProfile',value:function updateUserProfile(b,d,e,f,g,h,j,k){this.asyncJssoCall('updateUserProfile',{firstName:b,lastName:d,gender:e,dob:f,city:g,termsAccepted:h,shareDataAllowed:j},k)}},{key:'getMobileForgotPasswordOtp',value:function getMobileForgotPasswordOtp(b,d){return this.isValidMobile(b)?void this.asyncJssoCall('getForgotPasswordOtp',{mobile:b},d):d(this.INVALID_MOBILE)}},{key:'getEmailForgotPasswordOtp',value:function getEmailForgotPasswordOtp(b,d){return this.isValidEmail(b)?void this.asyncJssoCall('getForgotPasswordOtp',{email:b},d):d(this.INVALID_EMAIL)}},{key:'verifyMobileForgotPassword',value:function verifyMobileForgotPassword(b,d,e,f,g){return this.isValidMobile(b)?this.isValidPassword(e)?void this.asyncJssoCall('verifyForgotPassword',{mobile:b,otp:d,password:e,confirmPassword:f},g):g(this.INVALID_PASSWORD):g(this.INVALID_MOBILE)}},{key:'verifyEmailForgotPassword',value:function verifyEmailForgotPassword(b,d,e,f,g){return this.isValidEmail(b)?this.isValidPassword(e)?void this.asyncJssoCall('verifyForgotPassword',{email:b,otp:d,password:e,confirmPassword:f},g):g(this.INVALID_PASSWORD):g(this.INVALID_EMAIL)}},{key:'loginMobileForgotPassword',value:function loginMobileForgotPassword(b,d,e,f,g){return this.isValidMobile(b)?this.isValidPassword(e)?void this.asyncJssoCall('loginForgotPassword',{mobile:b,otp:d,password:e,confirmPassword:f},function(h){if(200==h.code&&this.createChannelCookies(),g)return g(h)}.bind(this)):g(this.INVALID_PASSWORD):g(this.INVALID_MOBILE)}},{key:'loginEmailForgotPassword',value:function loginEmailForgotPassword(b,d,e,f,g){return this.isValidEmail(b)?this.isValidPassword(e)?void this.asyncJssoCall('loginForgotPassword',{email:b,otp:d,password:e,confirmPassword:f},function(h){if(200==h.code&&this.createChannelCookies(),g)return g(h)}.bind(this)):g(this.INVALID_PASSWORD):g(this.INVALID_EMAIL)}},{key:'signOutUser',value:function signOutUser(b){this.asyncJssoCall('signOutUser',{},function(d){if(this.deleteChannelCookies(),b)return b(d)}.bind(this))}},{key:'updateMobile',value:function updateMobile(b,d){return this.isValidMobile(b)?void this.asyncJssoCall('updateMobile',{mobile:b},d):d(this.INVALID_MOBILE)}},{key:'verifyMobile',value:function verifyMobile(b,d,e){return this.isValidMobile(b)?void this.asyncJssoCall('verifyMobile',{mobile:b,otp:d},e):e(this.INVALID_MOBILE)}},{key:'addAlternateEmail',value:function addAlternateEmail(b,d){return this.isValidEmail(b)?void this.asyncJssoCall('addAlternateEmail',{email:b},d):d(this.INVALID_EMAIL)}},{key:'verifyAlternateEmail',value:function verifyAlternateEmail(b,d,e){return this.isValidEmail(b)?void this.asyncJssoCall('verifyAlternateEmail',{email:b,otp:d},e):e(this.INVALID_EMAIL)}},{key:'linkFacebook',value:function linkFacebook(b,d,e){this.asyncJssoCall('linkSocial',{oauthSiteId:'facebook',oauthCode:b,redirectUri:d},e)}},{key:'linkGoogleplus',value:function linkGoogleplus(b,d,e){this.asyncJssoCall('linkSocial',{oauthSiteId:'googleplus',oauthCode:b,redirectUri:d},e)}},{key:'linkLinkedin',value:function linkLinkedin(b,d,e){this.asyncJssoCall('linkSocial',{oauthSiteId:'linkedin',oauthCode:b,redirectUri:d},e)}},{key:'delinkSocial',value:function delinkSocial(b,d){this.asyncJssoCall('delinkSocial',{oauthSiteId:b},d)}},{key:'setPassword',value:function setPassword(b,d,e){return this.isValidPassword(b)?void this.asyncJssoCall('setPassword',{newPassword:b,confirmPassword:d},e):e(this.INVALID_PASSWORD)}},{key:'changePassword',value:function changePassword(b,d,e,f){return this.isValidPassword(d)?void this.asyncJssoCall('changePassword',{oldPassword:b,newPassword:d,confirmPassword:e},f):f(this.INVALID_PASSWORD)}},{key:'changePrimaryEmail',value:function changePrimaryEmail(b,d){return this.isValidEmail(b)?void this.asyncJssoCall('changePrimaryEmail',{emailId:b},d):d(this.INVALID_EMAIL)}},{key:'facebookLoginAccessToken',value:function facebookLoginAccessToken(b,d,e){this.asyncSocialappCall('facebookLogin',{accessToken:b,facebookRedirectUri:d},function(f){if(200==f.code&&this.createChannelCookies(),e)return e(f)}.bind(this))}},{key:'linkFacebookAccessToken',value:function linkFacebookAccessToken(b,d,e){this.asyncJssoCall('linkSocial',{oauthSiteId:'facebook',accessToken:b,redirectUri:d},e)}},{key:'socialImageUpload',value:function socialImageUpload(b,d){this.asyncJssoCall('socialImageUpload',{oauthSiteId:b},d)}},{key:'updateProfilePic',value:function updateProfilePic(b,d){var e=this.ssoBaseUrl+'uploadProfilePic',f=new FormData(this);f.append('datafile',b);var g=new XMLHttpRequest;g.open('POST',e),g.timeout=3e4,g.withCredentials=!0,g.setRequestHeader('channel',this.channel),g.setRequestHeader('platform',this.platform),g.setRequestHeader('sdkVersion',this.sdkVersion),g.setRequestHeader('IsJssoCrosswalk','true'),g.setRequestHeader('csrfToken',this.csrfToken),g.setRequestHeader('ssec',this.ssec),g.setRequestHeader('tksec',this.tksec),g.responseType='json',g.onload=function(){var h=g.response;return('string'==typeof h&&(h=JSON.parse(h)),!h||!h.code)?(this.deleteChannelCookies(),void(d&&d(this.UNAUTHORIZED_ACCESS_RESPONSE))):404==h.code?(this.deleteChannelCookies(),void(d&&d(h))):(g.getResponseHeader('csrfToken')&&(this.csrfToken=g.getResponseHeader('csrfToken')),g.getResponseHeader('ssec')&&(this.ssec=g.getResponseHeader('ssec')),g.getResponseHeader('tksec')&&(this.tksec=g.getResponseHeader('tksec')),d)?d(h):void 0}.bind(this),g.onerror=function(){if(d)return d(this.CONNECTION_ERROR_RESPONSE)}.bind(this),g.ontimeout=function(){if(d)return d(this.CONNECTION_TIMEOUT_RESPONSE)}.bind(this),g.send(f)}},{key:'registerOnlyMobile',value:function registerOnlyMobile(b,d,e,f,g,h,j,k){return f?f&&!this.isValidMobile(f)?k(this.INVALID_MOBILE):void this.asyncJssoCall('registerOnlyMobile',{firstName:b,lastName:d,gender:e,mobile:f,termsAccepted:g,shareDataAllowed:h,timespointsPolicy:j},k):k(this.INVALID_REQUEST)}},{key:'truecallerLogin',value:function truecallerLogin(b,d){return b?b&&!this.isValidMobile(b)?d(this.INVALID_MOBILE):void this.asyncJssoCall('truecallerLogin',{mobile:b},d):d(this.INVALID_REQUEST)}},{key:'truecallerVerify',value:function truecallerVerify(b,d){return b?void this.asyncJssoCall('truecallerVerify',{requestId:b},function(e){if(200==e.code&&this.createChannelCookies(),d)return d(e)}.bind(this)):d(this.INVALID_REQUEST)}},{key:'addAlternateEmailTrap',value:function addAlternateEmailTrap(b,d,e,f){return this.isValidEmail(b)?void this.asyncJssoCall('addAlternateEmailIdTrap',{email:b,password:d,alterEmail:e},f):f(this.INVALID_EMAIL)}},{key:'verifyAlternateEmailTrap',value:function verifyAlternateEmailTrap(b,d,e,f,g){return this.isValidEmail(b)?void this.asyncJssoCall('verifyAlternateEmailIdTrap',{email:b,password:d,alterEmail:e,otp:f},g):g(this.INVALID_EMAIL)}},{key:'addAlternateMobileTrap',value:function addAlternateMobileTrap(b,d,e,f){return this.isValidEmail(b)?void this.asyncJssoCall('addAlternateEmailIdTrap',{email:b,password:d,alterMobile:e},f):f(this.INVALID_EMAIL)}},{key:'verifyAlternateMobileTrap',value:function verifyAlternateMobileTrap(b,d,e,f,g){return this.isValidEmail(b)?void this.asyncJssoCall('verifyAlternateMobileTrap',{email:b,password:d,alterMobile:e,otp:f},g):g(this.INVALID_EMAIL)}},{key:'deleteAccount',value:function deleteAccount(b,d){this.asyncJssoCall('deleteUser',{password:b},d)}},{key:'getChannelDetails',value:function getChannelDetails(b,d,e){this.asyncJssoCall('channelDetails',{channel:b,ru:d},e)}},{key:'gpOneTapLogin',value:function gpOneTapLogin(b,d){this.asyncJssoCall('gpOneTap',{token:b},function(e){if(200==e.code&&this.createChannelCookies(),d)return d(e)}.bind(this))}},{key:'subscriberLogin',value:function subscriberLogin(b,d){this.asyncJssoCall('subscriberLogin',{token:b},function(e){if(200==e.code&&this.createChannelCookies(),d)return d(e)}.bind(this))}},{key:'verifyMobileLoginGdpr',value:function verifyMobileLoginGdpr(b,d,e,f,g,h){return this.isValidMobile(b)?void this.asyncJssoCall('verifyLoginOtpPasswordGdpr',{mobile:b,password:d,termsAccepted:e,shareDataAllowed:f,timespointsPolicy:g},function(j){if(200==j.code&&this.createChannelCookies(),h)return h(j)}.bind(this)):h(this.INVALID_MOBILE)}},{key:'verifyEmailLoginGdpr',value:function verifyEmailLoginGdpr(b,d,e,f,g,h){return this.isValidEmail(b)?void this.asyncJssoCall('verifyLoginOtpPasswordGdpr',{email:b,password:d,termsAccepted:e,shareDataAllowed:f,timespointsPolicy:g},function(j){if(200==j.code&&this.createChannelCookies(),h)return h(j)}.bind(this)):h(this.INVALID_EMAIL)}},{key:'updateUserPermissions',value:function updateUserPermissions(b,d,e,f){this.asyncJssoCall('updateUserPermissions',{termsAccepted:b,shareDataAllowed:d,timespointsPolicy:e},function(g){if(200==g.code&&this.createChannelCookies(),f)return f(g)}.bind(this))}},{key:'truecallerOneTapLogin',value:function truecallerOneTapLogin(b,d){return!0!=b.valueOf()&&!1!=b.valueOf()?d(this.INVALID_REQUEST):void this.asyncJssoCall('truecallerOneTapLogin',{},function(e){var f=this;if(200==e.code){if(window.location.href='truecallersdk://truesdk/web_verify?requestNonce='+e.data.requestId+'&partnerKey=Mfn40c8470b1f53324b99aa45ac47738ad539&partnerName='+e.data.channelName+'&lang=en&title=signIn&skipOption=skip',!1==b.valueOf()&&d)return d(e);setTimeout(function(){if(document.hasFocus()){if(d)return d(f.APP_CONNECTION_TIMEOUT_RESPONSE);}else if(d)return d(e)},800)}}.bind(this))}},{key:'createChannelCookies',value:function createChannelCookies(){var b=new Date,d=new Date(b);d.setHours(24,0,0,0),this.createCookie('jsso_crosswalk_login_'+this.channel,'true',2592000000),this.createCookie('jsso_crosswalk_daily_'+this.channel,'true',d-b),this.createCookie('jsso_crosswalk_csrfToken_'+this.channel,this.csrfToken,2592000000),this.createCookie('jsso_crosswalk_ssec_'+this.channel,this.ssec,2592000000),this.createCookie('jsso_crosswalk_tksec_'+this.channel,this.tksec,2592000000),this.createCookie('csut',this.csut,2592000000),this.createCookie('gdpr',this.gdpr,2592000000)}},{key:'getChannelCookies',value:function getChannelCookies(){var b={login:this.getCookie('jsso_crosswalk_login_'+this.channel),daily:this.getCookie('jsso_crosswalk_daily_'+this.channel)};return b}},{key:'deleteChannelCookies',value:function deleteChannelCookies(){this.deleteCookieByName('jsso_crosswalk_login_'+this.channel),this.deleteCookieByName('jsso_crosswalk_daily_'+this.channel),this.deleteCookieByName('jsso_crosswalk_csrfToken_'+this.channel),this.deleteCookieByName('jsso_crosswalk_ssec_'+this.channel),this.deleteCookieByName('jsso_crosswalk_tksec_'+this.channel),this.deleteCookieByName('csut'),this.deleteCookieByName('gdpr')}},{key:'getCookie',value:function getCookie(b){for(var h,d=b+'=',e=decodeURIComponent(document.cookie),f=e.split(';'),g=0;g<f.length;g++){for(h=f[g];' '==h.charAt(0);)h=h.substring(1);if(0==h.indexOf(d))return h.substring(d.length,h.length)}return''}},{key:'deleteCookieByName',value:function deleteCookieByName(b){document.cookie=b+'=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/'}},{key:'createCookie',value:function createCookie(b,d,e){var f=new Date,g=f.getTime()+e;f.setTime(g),document.cookie=b+'='+d+'; expires='+f.toGMTString()+'; path=/'}},{key:'isValidEmail',value:function isValidEmail(b){var d=/^(([^<>()\[\]\\.,;:\s@"]+([^<>()\[\]\\,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return d.test((b+'').toLowerCase())}},{key:'isValidMobile',value:function isValidMobile(b){var d=/^(((\+?\(91\))|0|((00|\+)?91))-?)?[6-9]\d{9}$/;return d.test(b+'')}},{key:'isValidPassword',value:function isValidPassword(b){b+='';var d=/.*[a-z]+.*/,e=/.*[!@#$%^&*()]+.*/,f=/.*[0-9]+.*/;return 6>b.length||14<b.length?!1:d.test(b)&&e.test(b)&&f.test(b)}}]),a}();