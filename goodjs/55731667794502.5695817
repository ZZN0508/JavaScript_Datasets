"use strict";var registration,blockStatus,fedId,endPoint,userToken,config={apiKey:"AIzaSyBkfPBCetXX8HixFO8K6MSOvOCMmKYCzN0",projectId:"web-push-notification-25bae",messagingSenderId:"653095001445"};firebase.initializeApp(config);const messaging=firebase.messaging();function createCookie(e,o,t){var n,i="";t&&((n=new Date).setTime(n.getTime()+24*t*60*60*1e3),i="; expires="+n.toUTCString()),document.cookie=e+"="+o+i+"; domain=.icicibank.com ; path=/"}Modernizr.localstorage&&localStorage.endPoint&&createCookie("END_POINT",endPoint=localStorage.getItem("endPoint"),30),"denied"===Notification.permission&&localStorage&&(blockStatus=localStorage.getItem("blockStatus"),endPoint=localStorage.getItem("endPoint"),null==blockStatus&&""!=endPoint&&disAllowNotification()),"granted"===Notification.permission&&(fedId=localStorage.getItem("fedId"),endPoint=localStorage.getItem("endPoint"),null==(userToken=localStorage.getItem("userToken"))&&allowNotification(),"undefined"!=typeof FedID&&(null!=fedId?fedId!=FedID?allowNotification():console.log(fedId," Matched with ",FedID):localStorage.setItem("fedId",FedID))),"granted"===Notification.permission||"denied"===Notification.permission?$(".push-popup").remove():$("#push-modal-background, #push-modal-content").addClass("active");var popupCount=localStorage.getItem("NotNowCount");function allowNotification(){var t,n,i;"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js").then(function(){return navigator.serviceWorker.ready}).then(function(e){e.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){i=e.endpoint,messaging.requestPermission().then(function(){return console.log("Notification permission granted."),messaging.getToken()}).then(function(e){var o;n=e,null!=i&&null!=n&&(t=i.split("send/"),e=getBrowserType(),o="","undefined"!=typeof FedID&&(o=FedID),""!=t&&""!=n&&$.ajax({url:"https://www.icicibank.com/notification/ajax-push-notification.page?browserType="+e+"&unsubscribeFlag=''&endPoint="+t[1]+"&fedId="+o+"&userToken="+n,success:function(e){localStorage&&(""!=o&&localStorage.setItem("fedId",o),localStorage.setItem("userToken",n),localStorage.setItem("endPoint",t[1]),localStorage.removeItem("blockStatus"),createCookie("END_POINT",t[1],30)),$(e).filter("#result").html()},error:function(e,o,t){}}))}).catch(function(e){console.log("Unable to get permission to notify.",e)})})}).catch(function(e){console.log("Service Worker error :^(",e)}),$("#push-modal-content,#push-modal-background").remove(),$("#push-modal-close").click(function(){$("#push-modal-background").fadeOut("600"),$("#push-modal-content").fadeOut("400"),$("#push-modal-content,#push-modal-background").toggleClass("active")})}function disAllowNotification(){var e,o;"denied"===Notification.permission&&localStorage&&(e=localStorage.getItem("endPoint"),o=getBrowserType(),""!=e&&""!=o&&$.ajax({url:"https://www.icicibank.com/notification/ajax-push-notification.page?browserType="+o+"&endPoint="+e+"&unsubscribeFlag=yes&fedId=''",success:function(e){localStorage&&(localStorage.setItem("endPoint",""),localStorage.setItem("fedId",""),localStorage.setItem("userToken",""),localStorage.setItem("blockStatus","yes"),createCookie("END_POINT","",-1)),$(e).filter("#result").html()},error:function(e,o,t){}}))}function getBrowserType(){var e=-1!=(navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR"))?"Opera":-1!=navigator.userAgent.indexOf("Chrome")?"Chrome":-1!=navigator.userAgent.indexOf("Safari")?"Safari":-1!=navigator.userAgent.indexOf("Firefox")?"Firefox":-1!=navigator.userAgent.indexOf("MSIE")||1==!!document.documentMode?"IE":"";return e}null!=popupCount&&parseInt(popupCount)%5!=0&&($(".push-popup").remove(),popupCount=parseInt(popupCount)+1,localStorage.setItem("NotNowCount",popupCount)),$(".desktop-only #push-modal-close,.mobile-only #push-modal-close").click(function(){var e;"default"!==Notification.permission&&""!==Notification.permission||localStorage&&(null!=(e=localStorage.getItem("NotNowCount"))?(e=parseInt(e)+1,localStorage.setItem("NotNowCount",e)):localStorage.setItem("NotNowCount","1"))}),messaging.onMessage(function(e){var o,t=e.data.title;const n={body:e.data.body,icon:e.data.icon,image:e.data.image,tag:e.data.tag,requireInteraction:e.data.requireInteraction,badge:e.data.badge};"Notification"in window?"granted"===Notification.permission&&((o=new Notification(t,n)).onclick=function(e){e.preventDefault(),window.open(n.badge,"_blank"),o.close()}):console.log("This browser does not support system notifications")});
