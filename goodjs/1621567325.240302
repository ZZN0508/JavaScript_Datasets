!function(){"use strict";var e={176:function(e){e.exports.get=function(e){if(document.cookie&&document.cookie.length){for(var r,n=document.cookie.split(";"),t={},o=0,i=n.length;o<i;o++)t[(r=n[o].replace(/^(\s|\u00A0)+/g,"").split("="))[0]]=decodeURIComponent(r[1]);return e?t[e]:t}},e.exports.set=function(e,r,n){if(void 0!==e&&void 0!==r){var t=(n=n||{}).expires||{};"number"==typeof n.expires&&(t=new Date).setTime(t.getTime()+24*n.expires*60*60*1e3);var o=e+"="+encodeURIComponent(r);return o+=t.toUTCString?"; expires="+t.toUTCString():"",o+=n.path?"; path="+n.path:"",o+=n.domain?"; domain="+n.domain:"",o+=n.samesite?"; samesite="+n.samesite:"",o+=n.secure?"; secure":"",document.cookie=o,o}},e.exports.remove=function(r,n){return(n=n||{}).expires=-1,e.exports.set(r,"",n)}}},r={};function n(t){if(r[t])return r[t].exports;var o=r[t]={exports:{}};return e[t](o,o.exports,n),o.exports}n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,{a:r}),r},n.d=function(e,r){for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},function(){var e,r,t,o,i={"https://prime.rambler.ru":{key1:"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwTHGbo/ZwQVpkql42H/5tbOYgEVnS1w66lN4vql6TWtYi+TpeTuy9WaRJptIHhO1fKYNRV6QaRw6QJ/lHf5cl9Y8klOU02A5Mnwdq7UKo3z+SB4/cPZWyk0vGHcIE9iDLjUkOAF0bdArYEgujl1ysYMQOdb93VSCPyM2GSZJx7itnHG6melJThTe7TO63rzQHPSkn/z1tLCGcQBF/UoSSbOHDpU+ntBdX7ord/9Q2Lwid0Oy4ISBqzQSxS54SyZHXefYz+e8pD9eCtmiadPd8IU60AYJul/pDqIf4utD+kHeQPWut+abBYt5LMV5Wy4ZoAmdrRuhguNzx9r6G4xxCwIDAQAB",key2:"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzGXeSOMjF1jaD8n3JD5lZpls0f0keRuYFqOmGgvrx9xvq0Man2Eg60TCVihZ3AhWotA0LW0pl3ZSrc1TpuObYBDT3qHB+YXdef4TBU1cI7TzK+GCp5Za+B/N1DOP9dBP71lFXNzYH1KaqQlCHSJPq5yq35QZhdAH780eaPZP0wKsbU1j6ucAu0vYndTgpxx2WmlSdY8yDfD7JZdRyzOqwyTut//LtakzzBS/guN+tTsdUds2hlAb2i/iGOiQlsrioX35x7D0pEyj/7NPY4ABgWTQAFV65OJnbiWG+fqQ6M9XwQrT/UbgeXVslYUkz5NmtGp2FlLl1fOPtLOwXhFswwIDAQAB"},"https://prime-stage01.rambler.ru":{key1:"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2U2M51P4BnHxpH59slie4xLIzxP4xNn7jPk1t4PHmLnaVsC3ytcHEcEF/lK+lBBbtCmrfVxuoXWI64KMyeonrNPscDpFlDhctbwXqsTEXx7KAxX9EUTbqY2JOMgJMgt44IhmUbrkiWdynCAsCKKrCwAIbh5vBorHEjm2eWxDRG8qAzlu0HAAK6Mn8+5cCk3nJKR0lLWj71n44aE4h7QvnG7TT3RYWjFjOLPpeF8/IlHZigecECPox5Ss2ylPDh2u8Gt4BW01T3M09FwamCeh/uzYjqneRZT3o6K7Rp92iXimxjnnw+4QWP9iACIuDQqZLpIQLhMi02E9N+j9+bhCeQIDAQAB",key2:"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEApGPr0ZzcEEJ7/eRK1/neCvduJeicYXsF17vRc8JIS+YWXVScOA6yzML3pnyN+ubnlOGBdpB8n4tb4yiNe8fxzVo+/aWOOcvcrxc5b1L1MvKP/sUIS6L7hi4p6hQGMF+cfVGqYh+iFzpwAZ9qKXVe3XBKc5ym0Pm2fKCIJ7RNMZY6pMZP8HQjpL+rFXrMgPIkkazqUqUMaudKZGmfBBbuSWUfhOyRJIkTakfExn7Thklk7f68n3sde5c1t1ttuWFhi7UcThQ3aoN4BLhuQhT0s2rNvhIdNZd6IoA+DZMIXxKjNLAXeYkcQVtUB47zVhOiAxjD2UkyhfB1o44IvOsY5wIDAQAB"}},a=n.n(i),u=(e=function(r,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])})(r,n)},function(r,n){function t(){this.constructor=r}e(r,n),r.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),s=function(e){function r(r){var n,t=e.call(this)||this;return t.name="ApiError",t.message=r.message.toString().toLowerCase(),t.code=null!==(n=r.code)&&void 0!==n?n:"unknown",t.details=r.details,t}return u(r,e),r}(Error),d=function(){return(Date.now().toString(36)+Math.random().toString(36).slice(2)).slice(0,17)},c=1===function(e){var r,n=null;try{n=JSON.parse(null!==(r=window.localStorage.getItem("primeStageApi"))&&void 0!==r?r:"")}catch(e){}return n}()?"https://prime-stage01.rambler.ru":"https://prime.rambler.ru",l=function(e,r,n,t){var o=new XMLHttpRequest,i=c+"/api/v3/prime/"+r,a=d();n.id=a,"get"===e&&(i+="?"+Object.keys(n).reduce((function(e,r){return e.concat(r+"="+encodeURIComponent(n[r]&&"object"==typeof n[r]?JSON.stringify(n[r]):n[r]))}),[]).join("&")),o.open(e,i,!0),o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){var e=JSON.parse(o.responseText),n=e.success,i=e.error,u=e.result;if(n&&null==i){var d=o.getResponseHeader("x-server-response-signature");return d&&u&&(u.signature=d),void t(null,u)}var c=null==i?"UNKNOW_ERROR":i.type+"_"+i.subtype;t(new s({message:"api failed",code:c,details:{requestId:a,method:r}}))}},o.onerror=function(){t(new s({message:"api does not respond",code:"UNKNOW_ERROR",details:{requestId:a,method:r}}))},o.send("get"===e?null:JSON.stringify(n))},p=l.bind(null,"post"),f=l.bind(null,"get","getActiveAdblockInfo"),m=l.bind(null,"post","createAdblockOrder"),v=n(176),w=function(){return(w=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},y={domain:"."+window.location.hostname.split(".").slice(-2).join("."),path:"/",samesite:"none",secure:!0},g="requestStorageAccess"in document&&"function"==typeof document.requestStorageAccess,h=function(e){return e.split(".").slice(-2).join(".")},b=(r=window.location.hostname,(t=(g?["id.rambler.ru","id.championat.com","idrambler.afisha.ru","rid.eda.ru","id.gazeta.ru","id.lenta.ru","id.moslenta.ru","id.secretmag.ru","id.motor.ru","id.passion.ru","id.wmj.ru","id.letidor.ru","id.ferra.ru","id.quto.ru","id.indicator.ru","id-loyalty.rambler-co.ru","id.eagleplatform.com"].filter((function(e){return h(e)===h(r)})):[])[0])?"https://"+t:"https://id.rambler.ru"),A=function(e){!function(e,r,n){var t=new XMLHttpRequest,o=b+"/api/v3"+e,i="rid"+d();r.id=i,t.open("post",o,!0),t.setRequestHeader("Content-Type","application/json"),t.withCredentials=!0,t.onreadystatechange=function(){var r,o;if(4===t.readyState&&200===t.status){var a=JSON.parse(t.responseText),u=a.success,d=a.error,c=a.result,l=null===(r=null==d?void 0:d.extra)||void 0===r?void 0:r.legacy_error;u&&null==l?n(null,c):n(new s(null!=l?{message:null===(o=l.strerror)||void 0===o?void 0:o.toLowerCase(),code:l.errno,details:{method:e,requestId:i}}:{message:"api failed",code:0,details:{method:e,requestId:i}}))}},t.onerror=function(){n(new s({message:"api does not respond",code:0,details:{method:e,requestId:i}}))},t.send(JSON.stringify(r))}("/session/getRsidx",{},(function(r,n){r?e(r):(function(e){if(e){var r=e;e instanceof Error&&(r={message:e.message},"code"in e&&(r.code=e.code,r.details=e.details));var n=e instanceof Error&&"need session"!==e.message?1/24/30:1/24/12;!function(e,r,n){try{v.set("rchainid",JSON.stringify(r),n)}catch(e){}}(0,r,w(w({},y),{expires:n}))}}(null!=r?r:null==n?void 0:n.result.rccid),e(r,n))}))};window.primeStorage=null!==(o=window.primeStorage)&&void 0!==o?o:{};var I,O,S,k=window.primeStorage;k.timing=null!==(I=k.timing)&&void 0!==I?I:[],k.viewId=null!==(O=k.viewId)&&void 0!==O?O:d(),k.serialId=null!==(S=k.serialId)&&void 0!==S?S:1;var E,P=window.crypto||window.msCrypto,C=(null==P?void 0:P.subtle)||(null==P?void 0:P.webkitSubtle),j=function(e){for(var r=new ArrayBuffer(e.length),n=new Uint8Array(r),t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return r},x=new(function(){function e(){}return Object.defineProperty(e.prototype,"hasMsCrypto",{get:function(){return"msCrypto"in window},enumerable:!1,configurable:!0}),e.prototype.importKey=function(e,r,n,t,o){var i=C.importKey(e,r,n,t,o);return this.hasMsCrypto?new Promise((function(e,r){var n=i;n.addEventListener("complete",(function(r){e(r.target.result)})),n.addEventListener("error",(function(){r(new Error("importing a key failed"))}))})):i},e.prototype.verify=function(e,r,n,t){var o=C.verify(e,r,n,t);return this.hasMsCrypto?new Promise((function(e,r){var n=o;n.addEventListener("complete",(function(r){e(r.target.result)})),n.addEventListener("error",(function(){r(new Error("verification a key failed"))}))})):o},e}()),q=function(e){var r=e.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw new Error("illegal base64url string")}return JSON.parse(decodeURIComponent(escape(window.atob(r))))},B=function(e){var r=e.split("."),n=r[0],t=r[1],o=r[2];return{header:q(n),payload:q(t),signature:o}},T={RS256:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}}},R="undefined"!=typeof window&&(null===(E=window.navigator)||void 0===E?void 0:E.userAgent)||"",D=/iPhone|iPad|iPod/i.test(R),Q=/Android/i.test(R),M=function(){return(M=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},N=a()[c],L=function(){},U=function(){function e(){}return e.prototype.push=function(e){void 0===e&&(e=L),e()},e.prototype.api=function(e,r,n,t){void 0===n&&(n=L),!1!==(null==t?void 0:t.needSessionId)?A((function(t,o){var i;if(null===(i=null==o?void 0:o.result)||void 0===i?void 0:i.token){var a={params:r,sessionId:o.result.token};p(e,a,n)}else n(t)})):p(e,{params:r},n)},e.prototype.getSubscription=function(e,r){var n,t;void 0===r&&(r=L);var o=Date.now(),i=null===(t=null===(n=window.performance)||void 0===n?void 0:n.timing)||void 0===t?void 0:t.navigationStart,a={start:i?o-i:0},u=!1,s=function(e,n){a.overall=Date.now()-o,function(e){clearTimeout(k.timeout),k.timing.push(e),k.timeout=window.setTimeout((function(){!function(e){if("complete"===document.readyState)e();else{var r=function(){e(),window.removeEventListener("load",r)};window.addEventListener("load",r)}}((function(){var e,r=k.timing;if(k.timing=[],Array.isArray(r)&&r.length>0)try{var n=encodeURIComponent(r.sort((function(e,r){return e.start-r.start})).map((function(e){return Object.keys(e).map((function(r){return r+"-"+e[r]})).join("_")})).join("!")),t=null!==(e=k.viewId)&&void 0!==e?e:"",o=k.serialId?k.serialId++:"";(new Image).src=c+"/phtimes?view_id="+t+"&serial="+o+"&data="+n}catch(e){}}))}),2e3)}(a),r(e,n)};if(!0===window.PRIME_SSR_STATUS)return a.ssr=0,void s(null,u);var d=function(e,r){var n;if(e)s(e,u);else if(null==r?void 0:r.signature){var t=Date.now();try{var o=B(r.signature),i=1e3*parseInt(o.payload.ctime,10);if(Date.now()-i>6e5)throw new Error("signature has expired");var d=N[null===(n=o.header)||void 0===n?void 0:n.kid];!function(e,r,n){if("string"==typeof e)if("string"==typeof r){var t=e.split("."),o=t[0],i=t[1],a=t[2];if("string"!=typeof a)return n(new Error("illegal token"));var u=B(e),s=T[u.header.alg];if(s){var d=j(window.atob(r));x.importKey("spki",d,s,!1,["verify"]).then((function(e){var r,n=o+"."+i;return x.verify(s,e,j((r=a,window.atob(r.replace(/-/g,"+").replace(/_/g,"/").replace(/\n/g,"")))),j(n))})).then((function(e){e?n(null,u):n(new Error("invalid signature"))}),(function(e){n(e)}))}else n(new Error("algorithm not found"))}else n(new Error("secret must be a string"));else n(new Error("token must be a string"))}(null==r?void 0:r.signature,d,(function(e,n){u=!!r.adblockInfoList&&r.adblockInfoList.length>0&&o.signature===(null==n?void 0:n.signature),a.verify=Date.now()-t,s(e,u)}))}catch(e){a.verify=Date.now()-t,s(e,u)}}else s(new Error("empty signature"),u)},l=k.cache;if((null==l?void 0:l.referrer)===e.referrer&&Date.now()-(null==l?void 0:l.currentTime)<3e5)return a.cache=0,void d(null,l);var p=Date.now();Array.isArray(k.queue)?k.queue.push((function(e,r){a.wait=Date.now()-p,d(e,r)})):(k.queue=[d],A((function(r,n){var t;if(a.id=Date.now()-p,!(null===(t=null==n?void 0:n.result)||void 0===t?void 0:t.token))return Array.isArray(k.queue)&&k.queue.forEach((function(e){e(r,void 0)})),void delete k.queue;var o={params:e,sessionId:n.result.token},i=Date.now();f(o,(function(r,n){a.prime=Date.now()-i,n&&(n.currentTime=Date.now(),n.referrer=e.referrer,k.cache=n),Array.isArray(k.queue)&&k.queue.forEach((function(e){e(r,n)})),delete k.queue}))})))},e.prototype.createSubscriptionOrder=function(e,r){void 0===r&&(r=L);var n=e.code,t=e.project,o=e.cpsEmail,i=e.cpsPhone,a=e.useForSubscription,u=void 0!==a&&a,d=e.trial,c=void 0===d||d,l=function(e,r){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.indexOf(t)<0&&(n[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(t=Object.getOwnPropertySymbols(e);o<t.length;o++)r.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(n[t[o]]=e[t[o]])}return n}(e,["code","project","cpsEmail","cpsPhone","useForSubscription","trial"]);n?o?A((function(e,a){var d;if(null===(d=null==a?void 0:a.result)||void 0===d?void 0:d.token){var p={params:{code:n,useForSubscription:u,trial:c,paymentCpsEmail:o},sessionId:a.result.token};m(p,(function(e,a){if(e)r(e);else{var u=a.shopId,d=a.scId,c=a.orderNumber,p=a.requestSign,f=a.orderAmount,m=a.discountPrice,v=a.tax,w=a.publicName,y=a.publicDescription,g=a.publicPicture,h=a.useForSubscription,b=["AC","ST"];parseFloat(f)&&!h||b.pop();var A=M({lang:"ru",tabs:b.map((function(e){return{tab:e}}))},l),I={order:{shopId:u,scId:d,orderNumber:c,requestSign:p,cpsEmail:o,orderAmount:f,productName:n,addData:{project:t}},products:[{offer:{name:w,description:y,picture:g,price:m,tax:v,taxValue:0},count:1,total:{price:m,currencyId:"RUB"}}]};i&&(I.order.cpsPhone=i),h&&(I.order.paymentAddParams={rebillingOn:1}),(D||Q)&&(I.order.paymentAddParams=M(M({},I.order.paymentAddParams),{jsonParams:{app2app:!0,"app.osType":D?"ios":"android","app.deepLink":encodeURIComponent(window.location.href)}})),function(e,r,n){window.RamblerPayment=window.RamblerPayment||[],window.RamblerPayment.push((function(){var t=window.RamblerPayment.buildWidget("PaymentPopup",e);void 0!==t&&t.then((function(e){return e.show(),e.initializeOrder(r).then((function(){var r,t=null;e.on("close",(function(){e.destroy(),n(t,r)})),e.on("fail",(function(){t=new Error("payment failed")})),e.on("success",(function(e){r=e}))}))})).catch((function(e){n(e)}))})),function(e,r){var n=document.createElement("script");n.src="https://payment.rambler.ru/widget/sdk.js",n.onload=function(){r(null),document.body&&document.body.removeChild(n)},n.onerror=function(){r(new s({message:"script does not loaded"}))},document.body&&document.body.appendChild(n)}(0,(function(e){e&&n(e)}))}(A,I,(function(e,n){n?r(null,{orderNumber:c}):r(e)}))}}))}else r(e)})):r(new Error("missing `cpsEmail` in params")):r(new Error("missing `code` of product in params"))},e}(),H=function(){if(Array.isArray(window.primeHelper)||!window.primeHelper){var e=window.primeHelper||[];window.primeHelper=new U,e.forEach((function(e){return e()}))}};document.body?H():document.addEventListener("DOMContentLoaded",H,!1)}()}();
//# sourceMappingURL=sdk.js.map