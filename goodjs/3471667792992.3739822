YUI.add("af-applet-load",function(c){"use strict";var s=c.Af.AppletDom,d=c.Af.Utils,m=d.stringParseKV,u="applet-defer";function e(){}e.prototype={name:"applet.load",execute:function(a,p,e){var t;"applet.load"===p.action||"loadapplet"===p.action?(t=p.params.guid?s.getNode(p.params.guid):p.params.node,this.loadApplet(a,t,m(t.getData(u)),p.callback)):"page.init"===p.action&&s.all(c.one("body"),c.bind(function(e){var t=e.getData(u);t&&"custom"!==(t=m(t)).when&&this.loadApplet(a,e,t,p.callback)},this)),e()},replaceAppletContent:function(e,t){var a;e&&t&&t.html&&(a=(a=c.Node.create(t.html)).one("div.js-applet")||a,c.Af.Dom.setHTML(e,a.getHTML()),(t=t.js||t.assets)&&c.Af.Dom.jsAttach(t))},loadApplet:function(a,p,e,o){if(!p)return o&&o("invalid node");var l=this,n=s.getGuid(p),i=s.getType(p),t=m(p.getData("applet-params")),r=c.merge({guid:n,type:i,content_id:"chrome"},t),t={id_param:"guid"};e&&(e.batch&&(t.batch=e.batch),e.timeout&&(t.timeout=e.timeout)),c.Af.Transport.read("applet.content",r,{config:t},function(e,t){return e||!d.objectGetValue(t,"content.chrome.html")?(c.Af.Message.show(p,{level:"error",token:"ERR_LOAD",template:"ape-applet-templates-reload"}),o&&o(e)):(p.removeAttribute("data-"+u),l.replaceAppletContent(p,t.content.chrome),a.execControllers({action:"applet.init",params:{node:p,replace:!0}}),c.use("stencil",function(e){e.Stencil.initAll(p)}),a.fire("appletdeferload",{applet:{guid:n,type:i}}),o&&o(null))})}},c.namespace("Af").AppletLoad=e},"@VERSION@",{requires:["af-applet-dom","af-message","af-transport","ape-applet-templates-reload"]});
