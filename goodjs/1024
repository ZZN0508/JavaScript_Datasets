define(["module","OK/logger","OK/utils/vanilla"],function(e,s,t){"use strict";var n,u={},i=[],r={},o="$Hash$",a=e.config().timeout||3e5;function h(e){var t=u[e];return t&&0!==Object.keys(t).length||!OK.fn.isDebug()||console.error('РџР°РєРµС‚ "'+e+'" РѕС‚СЃСѓС‚СЃС‚РІСѓРµС‚. РќР°РІРµСЂРЅРѕ, РЅРµ СѓРґР°Р»РѕСЃСЊ Р·Р°РіСЂСѓР·РёС‚СЊ'),u[e]}function f(n,e){return u[n]=new c(n,e),function(){for(var e=r[n]||[],t=e.length;t--;)e[t]()}(),h(n)}function c(e,t){this.pkg=e,this.messages=t,this.parsedResources={}}function g(e){this.text=e}function l(e){this.argName=e}function p(e,t){this.argName=e,this.values=t}function d(e,t){this.argName=e,this.values=t}function v(e){return(e=Math.abs(e))%10==1&&e%100!=11?0:2<=e%10&&e%10<=4&&(e%100<10||20<=e%100)?1:2}function w(e){return 1===e?0:1}function b(e){return 0}c.prototype={has:function(e){return this.messages.hasOwnProperty(e)},getLMsg:function(e,t){if(!e&&!t)return this.messages;var n=this.messages[e];if("string"!=typeof n)return s.success("pts.miss",this.pkg,e),this.pkg+"."+e;if(t){var r=this.parsedResources[e];return r||(r=function(e){for(var t=[],n=0;;){var r=function e(t,n,r){var s;if(-1===(s=R(n,r,"|[]")))return-1===(s=R(n,r,"]"))?(t.push(new g(n.substr(r))),n.length):(t.push(new g(n.substr(r,s-r))),s);if(r<s)return t.push(new g(n.substr(r,s-r))),s;if("["===n[s]){if(-1===(s=R(n,r=s+1,":?]")))return r--,t.push(new g(n.substr(r))),n.length;var u=(i=n.substr(r,s-r))?i.replace(/^\s+|\s+$/gm,""):"";if("]"===n[s])return t.push(new l(u)),s+1;var i=n[s],o="?"===i,a=o?{}:[];if("?"!==i&&":"!==i)return s=R(n,r,"]"),t.push(new g(n.substr(r-1,s))),n.length;for(;;){r=s+1;var h,f=[];if(o){if(!((s=R(n,r,"="))>r))return s=R(n,r,"]"),t.push(new g(n.substr(r,s))),n.length;h=n.substr(r,s-r),r=s+1}for(;(s=e(f,n,r))!==n.length&&"|"!==n[s]&&"]"!==n[s];)r==s&&s++,r=s;if(o?a[h]=k(f):a.push(k(f)),s===n.length||"]"===n[s])break}return o?t.push(new d(u,a)):t.push(new p(u,a)),s===n.length?n.length:s+1}return s}(t,e,n);if(r===e.length)break;n===r&&r++,n=r}return k(t)}(n),this.parsedResources[e]=r),r.getResource(t)}return n},subscribe:function(e){var t=this.pkg;r[t]||(r[t]=[]),r[t].push(e)}},g.prototype.getResource=function(){return t.encodeHtml(this.text)},l.prototype.getResource=function(e){e=e[this.argName];return e||0===e?e:""},p.prototype.getResource=function(e){var t=e[this.argName],n=t;"Plural"===this.argName.substr(-"Plural".length)&&(n=m.getIndex(t));n=this.values[n];return n?n.getResource(e):""},d.prototype.getResource=function(e){var t=e[this.argName],t=this.values[t];return t?t.getResource(e):""};var m={ru:v,uk:v,en:w,hy:w,mo:w,ro:w,de:w,uz:b,az:b,kk:b,ka:b,ky:b,tg:b,tr:b,getIndex:function(e){var t=document.body.parentElement.getAttribute("lang");return(m[t]||v)(e)}};function y(e){this.children=e}function k(e){return 0===e.length?new g(""):1===e.length?e[0]:new y(e)}function R(e,t,n){for(var r=t;r<e.length;r++)for(var s=0;s<n.length;s++)if(n[s]===e[r])return r;return-1}function O(){t.ajax({url:"/web-api/upts",headers:{"Content-Type":"application/json"},data:function(){for(var e,t=[],n=0,r=i.length;n<r;n+=1){var s=h(e=i[n]);t.push({pkg:e,hash:s&&s.messages[o]||"0"})}return JSON.stringify(t)}(),dataType:"json"}).then(function(e){for(var t,n=e.response,r=Object.keys(n),s=0,u=r.length;s<u;s+=1)f(t=r[s],n[t])})}function N(e){e&&(-1===i.indexOf(e)&&i.push(e),!n&&0<a&&(n=window.setInterval(O,a)))}if(y.prototype.getResource=function(e){for(var t="",n=0;n<this.children.length;n++)t+=this.children[n].getResource(e);return t},"undefined"!=typeof window&&(window.l10n={getPkg:function(e){return N(e),h(e)}},void 0!==window.inline_resources&&void 0!==window.inline_resources.pts)){for(var x in window.inline_resources.pts)f(x,window.inline_resources.pts[x]),N(x);window.inline_resources.pts={}}return{load:function(t,e,n,r){r.isBuild?n():u.hasOwnProperty(t)?n(h(t)):e(["PTS/"+t],function(e){f(t,e),n(h(t))})}}});
