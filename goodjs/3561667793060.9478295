YUI.add("history-base",function(a,e){function t(){this._init.apply(this,arguments)}function h(e){return"object"===n.type(e)}var n=a.Lang,o=a.Object,c=YUI.namespace("Env.History"),i=a.Array,r=a.config.doc,s=r.documentMode,u=a.config.win,f={merge:!0},l="change",v="add",_="replace";a.augment(t,a.EventTarget,null,null,{emitFacade:!0,prefix:"history",preventable:!1,queueable:!0}),c._state||(c._state={}),t.NAME="historyBase",t.SRC_ADD=v,t.SRC_REPLACE=_,t.html5=!!(u.history&&u.history.pushState&&u.history.replaceState&&("onpopstate"in u||2<=a.UA.gecko)&&(!a.UA.android||2.4<=a.UA.android)),t.nativeHashChange=("onhashchange"in u||"onhashchange"in r)&&(!s||7<s),a.mix(t.prototype,{_init:function(e){e=this._config=e||{},this.force=!!e.force,e=this._initialState=this._initialState||e.initialState||null,this.publish(l,{broadcast:2,defaultFn:this._defChangeFn}),e&&this.replace(e)},add:function(){var e=i(arguments,0,!0);return e.unshift(v),this._change.apply(this,e)},addValue:function(e,t,n){var a={};return a[e]=t,this._change(v,a,n)},get:function(e){var t=c._state,n=h(t);return e?n&&o.owns(t,e)?t[e]:void 0:n?a.mix({},t,!0):t},replace:function(){var e=i(arguments,0,!0);return e.unshift(_),this._change.apply(this,e)},replaceValue:function(e,t,n){var a={};return a[e]=t,this._change(_,a,n)},_change:function(e,t,n){return(n=n?a.merge(f,n):f).merge&&h(t)&&h(c._state)&&(t=a.merge(c._state,t)),this._resolveChanges(e,t,n),this},_fireEvents:function(n,e,t){this.fire(l,{_options:t,changed:e.changed,newVal:e.newState,prevVal:e.prevState,removed:e.removed,src:n}),o.each(e.changed,function(e,t){this._fireChangeEvent(n,t,e)},this),o.each(e.removed,function(e,t){this._fireRemoveEvent(n,t,e)},this)},_fireChangeEvent:function(e,t,n){this.fire(t+"Change",{newVal:n.newVal,prevVal:n.prevVal,src:e})},_fireRemoveEvent:function(e,t,n){this.fire(t+"Remove",{prevVal:n,src:e})},_resolveChanges:function(e,n,t){var a,i={},r=c._state,s={};t=t||{},h(n=n||{})&&h(r)?(o.each(n,function(e,t){var n=r[t];e!==n&&(i[t]={newVal:e,prevVal:n},a=!0)},this),o.each(r,function(e,t){o.owns(n,t)&&null!==n[t]||(delete n[t],s[t]=e,a=!0)},this)):a=n!==r,(a||this.force)&&this._fireEvents(e,{changed:i,newState:n,prevState:r,removed:s},t)},_storeState:function(e,t){c._state=t||{}},_defChangeFn:function(e){this._storeState(e.src,e.newVal,e._options)}},!0),a.HistoryBase=t},"3.12.0",{requires:["event-custom-complex"]});
