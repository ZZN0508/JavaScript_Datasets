!function(e,n){"function"==typeof define&&(define.amd||define.cmd)?define(function(){return n(e)}):n(e,!0)}(this,function(o,e){function c(n,e,i){o.WeixinJSBridge?WeixinJSBridge.invoke(n,r(e),function(e){a(n,e,i)}):d(n,i)}function i(n,i,t){o.WeixinJSBridge?WeixinJSBridge.on(n,function(e){t&&t.trigger&&t.trigger(e),a(n,e,i)}):d(n,t||i)}function r(e){return(e=e||{}).appId=V.appId,e.verifyAppId=V.appId,e.verifySignType="sha1",e.verifyTimestamp=V.timestamp+"",e.verifyNonceStr=V.nonceStr,e.verifySignature=V.signature,e}function a(e,n,i){delete n.err_code,delete n.err_desc,delete n.err_detail;var t=n.errMsg;t||(t=n.err_msg,delete n.err_msg,t=function(e,n){var i=e,t=p[i];t&&(i=t);e="ok";n&&(t=n.indexOf(":"),"access denied"!=(e=(e=(e=-1!=(e=-1!=(e="failed"==(e="confirm"==(e=n.substring(t+1))?"ok":e)?"fail":e).indexOf("failed_")?e.substring(7):e).indexOf("fail_")?e.substring(5):e).replace(/_/g," ")).toLowerCase())&&"no permission to execute"!=e||(e="permission denied"),""==(e="config"==i&&"function not exist"==e?"ok":e)&&(e="fail"));return n=i+":"+e}(e,t),n.errMsg=t),(i=i||{})._complete&&(i._complete(n),delete i._complete),t=n.errMsg||"",V.debug&&!i.isInnerInvoke&&alert(JSON.stringify(n));e=t.indexOf(":");switch(t.substring(e+1)){case"ok":i.success&&i.success(n);break;case"cancel":i.cancel&&i.cancel(n);break;default:i.fail&&i.fail(n)}i.complete&&i.complete(n)}function s(e){if(e){for(var n=0,i=e.length;n<i;++n){var t=e[n],t=u[t];t&&(e[n]=t)}return e}}function d(e,n){var i;!V.debug||n&&n.isInnerInvoke||((i=p[e])&&(e=i),n&&n._complete&&delete n._complete,console.log('"'+e+'",',n||""))}function l(){return(new Date).getTime()}function n(e){S&&(o.WeixinJSBridge?e():t.addEventListener&&t.addEventListener("WeixinJSBridgeReady",e,!1))}if(!o.jWeixin){var u={config:"preVerifyJSAPI",onMenuShareTimeline:"menu:share:timeline",onMenuShareAppMessage:"menu:share:appmessage",onMenuShareQQ:"menu:share:qq",onMenuShareWeibo:"menu:share:weiboApp",onMenuShareQZone:"menu:share:QZone",previewImage:"imagePreview",getLocation:"geoLocation",openProductSpecificView:"openProductViewWithPid",addCard:"batchAddCard",openCard:"batchViewCard",chooseWXPay:"getBrandWCPayRequest"},p=function(){var e,n={};for(e in u)n[u[e]]=e;return n}(),t=o.document,f=t.title,m=navigator.userAgent.toLowerCase(),g=navigator.platform.toLowerCase(),h=!(!g.match("mac")&&!g.match("win")),y=-1!=m.indexOf("wxdebugger"),S=-1!=m.indexOf("micromessenger"),_=-1!=m.indexOf("android"),w=-1!=m.indexOf("iphone")||-1!=m.indexOf("ipad"),I=(m=m.match(/micromessenger\/(\d+\.\d+\.\d+)/)||m.match(/micromessenger\/(\d+\.\d+)/))?m[1]:"",T=!1,v=!1,k={initStartTime:l(),initEndTime:0,preVerifyStartTime:0,preVerifyEndTime:0},M={version:1,appId:"",initTime:0,preVerifyTime:0,networkType:"",preVerifyState:1,systemType:w?1:_?2:-1,clientVersion:I,url:encodeURIComponent(location.href)},V={},x={_completes:[]},b={state:0,data:{}};n(function(){k.initEndTime=l()});var A={config:function(e){d("config",V=e);var t=!1!==V.check;n(function(){if(t)c(u.config,{verifyJsApiList:s(V.jsApiList)},function(){x._complete=function(e){k.preVerifyEndTime=l(),b.state=1,b.data=e},x.success=function(e){M.preVerifyState=0},x.fail=function(e){x._fail?x._fail(e):b.state=-1};var t=x._completes;return t.push(function(){0!=M.preVerifyState&&(h||y||V.debug||I<"6.0.2"||M.systemType<0||T||(T=!0,M.appId=V.appId,M.initTime=k.initEndTime-k.initStartTime,M.preVerifyTime=k.preVerifyEndTime-k.preVerifyStartTime,A.getNetworkType({isInnerInvoke:!0,success:function(e){M.networkType=e.networkType;e="http://open.weixin.qq.com/sdk/report?v="+M.version+"&o="+M.preVerifyState+"&s="+M.systemType+"&c="+M.clientVersion+"&a="+M.appId+"&n="+M.networkType+"&i="+M.initTime+"&p="+M.preVerifyTime+"&u="+M.url;(new Image).src=e}})))}),x.complete=function(e){for(var n=0,i=t.length;n<i;++n)t[n]();x._completes=[]},x}()),k.preVerifyStartTime=l();else{b.state=1;for(var e=x._completes,n=0,i=e.length;n<i;++n)e[n]();x._completes=[]}}),V.beta&&(A.invoke||(A.invoke=function(e,n,i){o.WeixinJSBridge&&WeixinJSBridge.invoke(e,r(n),i)},A.on=function(e,n){o.WeixinJSBridge&&WeixinJSBridge.on(e,n)}))},ready:function(e){0!=b.state?e():(x._completes.push(e),!S&&V.debug&&e())},error:function(e){I<"6.0.2"||v||(v=!0,-1==b.state?e(b.data):x._fail=e)},checkJsApi:function(e){c("checkJsApi",{jsApiList:s(e.jsApiList)},(e._complete=function(e){var n;!_||(n=e.checkResult)&&(e.checkResult=JSON.parse(n)),function(e){var n,i=e.checkResult;for(n in i){var t=p[n];t&&(i[t]=i[n],delete i[n])}}(e)},e))},onMenuShareTimeline:function(e){i(u.onMenuShareTimeline,{complete:function(){c("shareTimeline",{title:e.title||f,desc:e.title||f,img_url:e.imgUrl||"",link:e.link||location.href,type:e.type||"link",data_url:e.dataUrl||""},e)}},e)},onMenuShareAppMessage:function(n){i(u.onMenuShareAppMessage,{complete:function(e){"favorite"===e.scene?c("sendAppMessage",{title:n.title||f,desc:n.desc||"",link:n.link||location.href,img_url:n.imgUrl||"",type:n.type||"link",data_url:n.dataUrl||""}):c("sendAppMessage",{title:n.title||f,desc:n.desc||"",link:n.link||location.href,img_url:n.imgUrl||"",type:n.type||"link",data_url:n.dataUrl||""},n)}},n)},onMenuShareQQ:function(e){i(u.onMenuShareQQ,{complete:function(){c("shareQQ",{title:e.title||f,desc:e.desc||"",img_url:e.imgUrl||"",link:e.link||location.href},e)}},e)},onMenuShareWeibo:function(e){i(u.onMenuShareWeibo,{complete:function(){c("shareWeiboApp",{title:e.title||f,desc:e.desc||"",img_url:e.imgUrl||"",link:e.link||location.href},e)}},e)},onMenuShareQZone:function(e){i(u.onMenuShareQZone,{complete:function(){c("shareQZone",{title:e.title||f,desc:e.desc||"",img_url:e.imgUrl||"",link:e.link||location.href},e)}},e)},startRecord:function(e){c("startRecord",{},e)},stopRecord:function(e){c("stopRecord",{},e)},onVoiceRecordEnd:function(e){i("onVoiceRecordEnd",e)},playVoice:function(e){c("playVoice",{localId:e.localId},e)},pauseVoice:function(e){c("pauseVoice",{localId:e.localId},e)},stopVoice:function(e){c("stopVoice",{localId:e.localId},e)},onVoicePlayEnd:function(e){i("onVoicePlayEnd",e)},uploadVoice:function(e){c("uploadVoice",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},downloadVoice:function(e){c("downloadVoice",{serverId:e.serverId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},translateVoice:function(e){c("translateVoice",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},chooseImage:function(e){c("chooseImage",{scene:"1|2",count:e.count||9,sizeType:e.sizeType||["original","compressed"],sourceType:e.sourceType||["album","camera"]},(e._complete=function(e){if(_){var n=e.localIds;try{n&&(e.localIds=JSON.parse(n))}catch(e){}}},e))},previewImage:function(e){c(u.previewImage,{current:e.current,urls:e.urls},e)},uploadImage:function(e){c("uploadImage",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},downloadImage:function(e){c("downloadImage",{serverId:e.serverId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},getNetworkType:function(e){c("getNetworkType",{},(e._complete=function(e){!function(e){var n=e.errMsg;e.errMsg="getNetworkType:ok";var i=e.subtype;if(delete e.subtype,i)e.networkType=i;else{var i=n.indexOf(":"),t=n.substring(i+1);switch(t){case"wifi":case"edge":case"wwan":e.networkType=t;break;default:e.errMsg="getNetworkType:fail"}}}(e)},e))},openLocation:function(e){c("openLocation",{latitude:e.latitude,longitude:e.longitude,name:e.name||"",address:e.address||"",scale:e.scale||28,infoUrl:e.infoUrl||""},e)},getLocation:function(e){c(u.getLocation,{type:(e=e||{}).type||"wgs84"},(e._complete=function(e){delete e.type},e))},hideOptionMenu:function(e){c("hideOptionMenu",{},e)},showOptionMenu:function(e){c("showOptionMenu",{},e)},closeWindow:function(e){c("closeWindow",{},e=e||{})},hideMenuItems:function(e){c("hideMenuItems",{menuList:e.menuList},e)},showMenuItems:function(e){c("showMenuItems",{menuList:e.menuList},e)},hideAllNonBaseMenuItem:function(e){c("hideAllNonBaseMenuItem",{},e)},showAllNonBaseMenuItem:function(e){c("showAllNonBaseMenuItem",{},e)},scanQRCode:function(e){c("scanQRCode",{needResult:(e=e||{}).needResult||0,scanType:e.scanType||["qrCode","barCode"]},(e._complete=function(e){var n;!w||(n=e.resultStr)&&(n=JSON.parse(n),e.resultStr=n&&n.scan_code&&n.scan_code.scan_result)},e))},openProductSpecificView:function(e){c(u.openProductSpecificView,{pid:e.productId,view_type:e.viewType||0,ext_info:e.extInfo},e)},addCard:function(e){for(var n=e.cardList,i=[],t=0,o=n.length;t<o;++t){var r=n[t],r={card_id:r.cardId,card_ext:r.cardExt};i.push(r)}c(u.addCard,{card_list:i},(e._complete=function(e){var n=e.card_list;if(n){for(var i=0,t=(n=JSON.parse(n)).length;i<t;++i){var o=n[i];o.cardId=o.card_id,o.cardExt=o.card_ext,o.isSuccess=!!o.is_succ,delete o.card_id,delete o.card_ext,delete o.is_succ}e.cardList=n,delete e.card_list}},e))},chooseCard:function(e){c("chooseCard",{app_id:V.appId,location_id:e.shopId||"",sign_type:e.signType||"SHA1",card_id:e.cardId||"",card_type:e.cardType||"",card_sign:e.cardSign,time_stamp:e.timestamp+"",nonce_str:e.nonceStr},(e._complete=function(e){e.cardList=e.choose_card_info,delete e.choose_card_info},e))},openCard:function(e){for(var n=e.cardList,i=[],t=0,o=n.length;t<o;++t){var r=n[t],r={card_id:r.cardId,code:r.code};i.push(r)}c(u.openCard,{card_list:i},e)},chooseWXPay:function(e){c(u.chooseWXPay,{timeStamp:e.timestamp+"",nonceStr:e.nonceStr,package:e.package,paySign:e.paySign,signType:e.signType||"SHA1"},e)}};return e&&(o.wx=o.jWeixin=A),A}});
