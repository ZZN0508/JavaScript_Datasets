YUI.add("flickr-groups-pools-getContext-fetcher",function(g,r){"use strict";g.namespace("ListFetchers")["flickr-groups-pools-getContext"]={run:function(e,o){var t=this;return g.Promise.all([o.callAPI("flickr.groups.pools.getContext",this._processParams(e),!0),o.getModelRegistry("group-pool-models"),o.getModelRegistry("photo-models"),o.getModelRegistry("person-models"),o.getModelRegistry("photo-engagement-models"),o.getModelRegistry("photo-stats-models")]).then(function(o){return t._processResponse(o,e)},function(o){throw 2===o.code&&"Photo not in pool"===o.message&&(o.notInContext=!0),o}).then(null,g.FetcherErrorLogger(r))},_processParams:function(o){var e={photo_id:o.photoId,extras:g.APIHelper.request.getRebootPhotoExtras()+",datecreate",num_prev:o.numNext,num_next:o.numPrev,get_group_info:1};if(o.id)e.group_id=o.id;else{if(!o.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");e.group_path_alias=o.pathAlias}return e},_processResponse:function(o,e){var t=o[0],r=o[1],s=o[2],p=o[3],l=o[4],i=o[5],u=[],n=s.proxy(e.photoId),o=t.prevphotos,t=t.nextphotos,d=g.APIHelper.response.parsePhotos({photos:o.photo,personModelRegistry:p,photoModelRegistry:s,photoEngagementModelRegistry:l,photoStatsModelRegistry:i}),u=g.APIHelper.response.parsePhotos({photos:t.photo,personModelRegistry:p,photoModelRegistry:s,photoEngagementModelRegistry:l,photoStatsModelRegistry:i}),s=r.getValue(e.id,"photoContextList"),l=!!s.hasMinBoundary&&s.hasMinBoundary(),i=!!s.hasMaxBoundary&&s.hasMaxBoundary(),s=s.getList(),a=g.APIHelper.response.addOrReplaceListByContext({model:n,next:d,prev:u.reverse(),current:s,hasMin:l,hasMax:i,numNext:e.numNext,numPrev:e.numPrev});return r.setValue(e.id,"photoContextList",a),{next:d,previous:u.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","photo-engagement-models","photo-stats-models","group-models"]}),YUI.add("flickr-groups-pools-add-creator",function(l,i){"use strict";l.namespace("ModelCreators")["flickr-groups-pools-add"]={run:function(e,o){var t=this,r=this._processParams(e),s=e.registryName||"group-pool-models",p={apiResponse:o.callAPI("flickr.groups.pools.add",r),groupPoolModel:o.getModel(s,e.groupID),photoModel:o.getModel("photo-models",e.photoID),photoGroupsModelRegistry:o.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:o.getModelRegistry("photo-contexts-models")};return e.unfilteredGroupId=r.group_id,"group-pool-models"!==s&&(p.unfilteredGroupPoolModel=o.getModel("group-pool-models",e.unfilteredGroupId)),new l.FlickrPromise(p).then(function(o){return t._processResponse(o,e)},l.FetcherErrorLogger(i))},_processParams:function(o){return{photo_id:o.photoID,group_id:l.Models["group-pool-models"].extractGroupFromCompoundId(o.groupID),detailed_errors:1}},_processResponse:function(o,e){var t=o.apiResponse,r=o.groupPoolModel,s=o.photoModel,p=o.photoGroupsModelRegistry,l=o.photoContextsModelRegistry,o=o.unfilteredGroupPoolModel;if("ok"===t.stat)return r&&!r.hasPhoto(s.getValue("id"))&&r.addPhotoLocal(s),o&&!o.hasPhoto(s.getValue("id"))&&o.addPhotoLocal(s),p.exists(e.photoID)&&!p.getValue(e.photoID,"groups").getFromListByID(e.unfilteredGroupId)&&(p.getValue(e.photoID,"groups").unshift(r),p.setValue(e.photoID,"total",p.getValue(e.photoID,"total")+1)),l.exists(e.photoID)&&!l.getValue(e.photoID,"contexts").getFromListByID(e.unfilteredGroupId)&&(l.setValue(e.photoID,"totalGroups",l.getValue(e.photoID,"totalGroups")+1),l.getValue(e.photoID,"contexts").push(r)),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]}),YUI.add("flickr-groups-pools-remove-deletor",function(i,u){"use strict";i.namespace("ModelDeletors")["flickr-groups-pools-remove"]={run:function(e,t){var o,r,s=this,p=e.registryName||"group-pool-models",l=[];return e.photoID?e.photoIds=[e.photoID]:e.photoIds="string"==typeof e.photoIds?[e.photoIds]:e.photoIds,o=this._processParams(e),r={apiResponse:t.callAPI("flickr.groups.pools.remove",o),groupPoolModelRegistry:t.getModel(p,e.groupID),photoGroupsModelRegistry:t.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:t.getModelRegistry("photo-contexts-models")},e.photoIds.forEach(function(o){l.push(t.getModel("photo-models",o))}),r.photoModels=i.Promise.all(l),e.unfilteredGroupId=o.group_id,"group-pool-models"!==p&&(r.unfilteredGroupPoolModelRegistry=t.getModel("group-pool-models",e.unfilteredGroupId)),new i.FlickrPromise(r).then(function(o){return s._processResponse(o,e)},i.FetcherErrorLogger(u))},_processParams:function(o){return{photo_id:o.photoIds.join(","),group_id:i.Models["group-pool-models"].extractGroupFromCompoundId(o.groupID)}},_processResponse:function(o,e){var t=o.apiResponse,r=o.groupPoolModelRegistry,s=o.photoModels,p=o.photoGroupsModelRegistry,l=o.photoContextsModelRegistry,i=o.unfilteredGroupPoolModelRegistry;if("ok"===t.stat)return s.forEach(function(o){l.exists(o.id)&&l.getValue(o.id,"contexts").getFromListByID(e.unfilteredGroupId)&&(l.setValue(o.id,"totalGroups",l.getValue(o.id,"totalGroups")-1),l.getValue(o.id,"contexts").removeFromList(e.unfilteredGroupId)),p.exists(o.id)&&p.getValue(o.id,"groups").getFromListByID(e.unfilteredGroupId)&&(p.setValue(o.id,"total",p.getValue(o.id,"total")-1),p.getValue(o.id,"groups").removeFromList(e.unfilteredGroupId)),r&&r.hasPhoto(o.getValue("id"))&&r.removePhotoLocal(o),i&&i.hasPhoto(o.getValue("id"))&&i.removePhotoLocal(o)}),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]}),YUI.add("flickr-groups-invite-photo-invite-creator",function(e,t){"use strict";e.namespace("ModelCreators")["flickr-groups-invite-photo-invite"]={run:function(p,l){var o={},i=e.Models["group-pool-models"].extractGroupFromCompoundId(p.groupID);return o.photo_id=p.photoID,o.group_id=i,e.Promise.all([l.callAPI("flickr.groups.invite.photo.invite",o),l.getModel("group-pool-models",i),l.getModelRegistry("photo-group-invitation-models"),l.getModelRegistry("photo-group-invitations-models")]).then(function(o){var e=o[0],t=o[1],r=o[2],s=o[3];if("ok"===e.stat)return e={id:o=[p.photoID,i].join("-"),photoId:p.photoID,groupId:i,invitedBy:l.getViewer().nsid},e=r.exists(o)?r.proxy(o):r.add(e),s.exists(p.photoID)&&!s.getValue(p.photoID,"invitations").getFromListByID(o)&&(s.getValue(p.photoID,"groups").prependToList(t),s.getValue(p.photoID,"invitations").prependToList(e),s.setValue(p.photoID,"total",s.getValue(p.photoID,"total")+1)),t},e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]}),YUI.add("flickr-groups-invite-photo-cancel-deletor",function(t,r){"use strict";t.namespace("ModelDeletors")["flickr-groups-invite-photo-cancel"]={run:function(s,o){var e={},p=t.Models["group-pool-models"].extractGroupFromCompoundId(s.groupID);return e.photo_id=s.photoID,e.group_id=p,t.Promise.all([o.callAPI("flickr.groups.invite.photo.cancel",e),o.getModel("group-pool-models",p),o.getModelRegistry("photo-group-invitation-models"),o.getModelRegistry("photo-group-invitations-models")]).then(function(o){var e=o[0],t=o[1],r=o[2],o=o[3];if("ok"===e.stat)return e=[s.photoID,p].join("-"),o.exists(s.photoID)&&o.getValue(s.photoID,"invitations").getFromListByID(e)&&(o.setValue(s.photoID,"total",o.getValue(s.photoID,"total")-1),o.getValue(s.photoID,"groups").removeFromList(p),o.getValue(s.photoID,"invitations").removeFromList(e)),r.remove(e),t},t.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]}),YUI.add("group-pool-by-person-models",function(t){function e(o){e.superclass.constructor.call(this,o)}t.Models[this.name]=e,t.extend(e,t.Models["group-pool-models"],{name:this.name,attributes:t.merge(t.Models["group-pool-models"].prototype.attributes,{personFilter:{validator:function(o,e){return t.AttributeHelpers.validateString(o)},setter:function(o){return t.AttributeHelpers.coerceString(o)},defaultValue:null}})})},"@VERSION@",{requires:["attribute-helpers","group-pool-models","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor"]});
