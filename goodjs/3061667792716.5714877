YUI.add("tdapi-remotestore",function(a,t){"use strict";var e,u=["resource","operation","params","body"],s="/_td_api",f="read",l=a.Object,g=a.Array,n=a.Lang,o=a.Mjata,p=o.REST.HTTP,i=a.Af.Utils;function h(t){if(t&&t.responseText)try{return a.JSON.parse(t.responseText)}catch(t){return null}return null}function x(t){return n.isArray(t)||n.isObject(t)?a.JSON.stringify(t):t}function m(t,e){var n=[],t=t;return l.each(e.context,function(t,e){n.push(e+"="+encodeURIComponent(t))}),0<n.length&&(t+="?"+n.sort().join("&")),t}e={_constructGetUri:function(t,e,n,o){var c,r=[],i=[],a=o.config.id_param,e=t+"/resource/"+e;return l.each(n,function(t,e){if(e===a)c=encodeURIComponent(t);else try{i.push(e+"="+encodeURIComponent(x(t)))}catch(t){}}),l.each(o.context,function(t,e){"crumb"===e&&!o.config.crumbForGET||r.push(e+"="+encodeURIComponent(x(t)))}),o.config.enableEdgePipeFallback&&(r.push("enable_edgepipe_fallback=1"),r.push("_enable_edgepipe=1")),c&&(e+="/"+a+"/"+c),0<i.length&&(e+=";"+i.sort().join(";")),0<r.length&&(e+="?"+r.sort().join("&")),e},batch:function(t){if(!n.isArray(t)||t.length<=1)return t;var e,o={};return g.each(t,function(t){var e,n;t.context&&t.context.config&&(n=t.context.config.uri||t.context.config.xhr||"",e=t.context.config.batch),n="uri:"+n,e&&(n+=";batch:"+e),o[n]||(o[n]=[]),o[n].push(t)}),(e=l.values(o)).length,t.length,e},single:function(t){if(t){var e,n,o=t.context,c=t.callback||i.noop,r=o.config&&(o.config.uri||o.config.xhr)||s;if(!(f===t.operation||o.context&&o.context.crumb))return c({statusCode:400,statusText:"missing crumb"});(n=t.operation!==f||o.config.post_for_read)||((e=this._constructGetUri(r,t.resource,t.params,o)).length<=2048?r=e:n=!0),n?((n={}).g0=a.mix({},t,!0,u),t.body||delete n.g0.body,n={requests:n,context:o.context},r=m(r,o),t=t.operation===f,p.post(r,{},n,a.merge({unsafeAllowRetry:t},o.config),function(t,e){if(t)return c(t);e=(e=h(e))&&e.g0||{};c(e.err,e.data)})):p.get(r,{},o.config,function(t,e){return t?c(t):void c(null,h(e))})}},multi:function(o){var t,n,e,c=0,r=!0,i={};g.some(o,function(t){return!!(t.context&&t.context.context&&t.context.context.crumb)&&(e=t.context,!0)},this),e&&e.context.crumb?(t=e.config&&(e.config.uri||e.config.xhr)||s,n={requests:{},context:e.context},g.each(o,function(t){var e="g"+c++;n.requests[e]=a.mix({},t,!0,u),(i[e]=t).operation!==f&&(r=!1)}),t=m(t,e),p.post(t,{},n,a.merge({unsafeAllowRetry:r},e.config),function(e,t){var n;e?g.each(o,function(t){t.callback(e)}):(n=h(t),l.each(i,function(t,e){e=n&&n[e]||{};t.callback&&t.callback(e.err||null,e.data||null)}))})):g.each(o,function(t){t.callback({statusCode:400,statusText:"missing crumb"})})}},a.namespace("TDAPI").RemoteStore=o.createStore("Store.TDAPI",{},e)},"@VERSION@",{requires:["mjata-store","mjata-rest-http","json"]});
