(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{470:function(e,n,t){e.exports=function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=17)}([function(e,n){e.exports=t(3)},function(e,n){e.exports=t(1)},function(e,n){e.exports=t(204)},function(e,n){e.exports=t(206)},function(e,n){e.exports=t(181)},function(e,n){e.exports=t(130)},function(e,n){e.exports=t(92)},function(e,n){e.exports=t(469)},function(e,n){e.exports=t(468)},function(e,n){e.exports=t(179)},function(e,n){e.exports=t(205)},function(e,n){e.exports=t(203)},function(e,n){e.exports=t(212)},function(e,n){e.exports=t(180)},function(e,n){e.exports=t(117)},function(e,n){e.exports=t(242)},function(e,n){e.exports=t(213)},function(e,n,t){"use strict";t.r(n);var r,i=t(2),s=t.n(i),o=(t(4),t(3)),l=t.n(o),u=t(6),a=t.n(u),c=t(1),d=t.n(c),f=(t(9),t(10),t(11),t(5),t(12),t(13),t(7)),m=t.n(f),p=t(8),b=t.n(p),w=t(0),v=t.n(w),I=(t(14),t(15),t(16),Math.random().toString(36).slice(2)),h=0,x=0,M=function(){var e=Date.now();return e>x&&(x=e,h=0),"".concat(I,"-").concat(x,"-").concat(h)},E={FIRST_CONNECTION_DELAY:1e3,REJECTION_CODE:1008,GROWTH_FACTOR:1.5,MAX_ATTEMPTS:5},O=E.FIRST_CONNECTION_DELAY,_=!0,g=0,T=function e(n,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E,o=new WebSocket(n),l=function(){_&&(r=setTimeout((function(){i(e(n,t,i,s)),(g+=1)>=s.MAX_ATTEMPTS&&(_=!1),O*=s.GROWTH_FACTOR}),O))};return o.onopen=function(){return clearTimeout(r)},o.onclose=function(e){e.code===s.REJECTION_CODE&&(_=!1),l()},o.onerror=l,o.onmessage=t,o},y=["Spam","SentBox","DraftBox","Trash"],N=function e(){var n=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;b()(this,e),v()(this,"unseenMailsNumber",void 0),v()(this,"isInterrupted",void 0),v()(this,"subscribers",void 0),v()(this,"lastId",void 0),v()(this,"pollIntervalId",void 0),v()(this,"timeoutIntervalId",void 0),v()(this,"ws",void 0),v()(this,"isRms",void 0),v()(this,"load",l()(s.a.mark((function e(){var t,r,i,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.fetchMailboxFolders();case 3:t=e.sent,r=t.mailbox,i=r.unseen_incoming,o=r.rms,l=r.ws,n.isRms=Boolean(o),n.isInterrupted||(n.unseenMailsNumber=i,n.emit(),null===n.timeoutIntervalId&&(n.timeoutIntervalId=setInterval(n.load,o?36e5:3e5)),l&&!n.ws&&(n.connectToWS(),n.clearPollInterval())),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),n.isInterrupted||(n.unseenMailsNumber=0),null===n.pollIntervalId&&(n.pollIntervalId=setInterval(n.load,12e4));case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))),v()(this,"subscribe",(function(e){return n.lastId+=1,n.subscribers[n.lastId]=e,function(){return delete n.subscribers[n.lastId]}})),v()(this,"emit",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.unseenMailsNumber;n.unseenMailsNumber=e,Object.keys(n.subscribers).forEach((function(t){return n.subscribers[t](e)}))})),v()(this,"interrupt",(function(){n.unsubscribe(),n.isInterrupted=!0})),v()(this,"unsubscribe",(function(){n.ws&&n.ws.close(),n.clearPollInterval(),n.clearTimeoutInterval()})),v()(this,"onmessage",(function(e){var t=JSON.parse(e.data).payload;t&&"object"===m()(t)&&y.includes(t.box)||t.dst&&y.includes(t.dst.box)||(n.isRms?n.unseenMailsNumber+=t.unseen_delta?t.unseen_delta:0:n.load(),n.emit(n.unseenMailsNumber))})),v()(this,"connectToWS",(function(){n.ws&&n.ws.close(),n.ws=T("wss://mail.rambler.ru/ws",n.onmessage,(function(e){n.ws=e}))})),v()(this,"clearPollInterval",(function(){null!==n.pollIntervalId&&(clearInterval(n.pollIntervalId),n.pollIntervalId=null)})),v()(this,"clearTimeoutInterval",(function(){null!==n.pollIntervalId&&(clearInterval(n.timeoutIntervalId),n.timeoutIntervalId=null)})),v()(this,"fetchMailboxFolders",l()(s.a.mark((function e(){var n,t,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://mail.rambler.ru/rpc",{method:"POST",credentials:"include",headers:{"x-rambler-mail-client-version":"1.0.0","x-rambler-mail-client-type":"unseen_mails_counter","x-rambler-mail-method":"Rambler::Mail::get_mailbox_folders","content-type":"application/json; charset=utf-8"},body:JSON.stringify({jsonrpc:"2.0",method:"Rambler::Mail::get_mailbox_folders",params:[{create_system_folders:!1}],id:M()})});case 2:return n=e.sent,e.next=5,n.json();case 5:if(t=e.sent,!(r=t.result).error){e.next=9;break}throw new Error;case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})))),this.unseenMailsNumber=t,this.subscribers={},this.lastId=0,this.pollIntervalId=null,this.timeoutIntervalId=null,this.ws=null,this.isInterrupted=!1};n.default=function(e){var n=e.style,t=e.collapseBigNumbers,r=e.renderZero,i=e.className,o=e.renderString,u=e.onChange,f=e.children,m=e.unseenMailsNumber,p=Object(c.useState)(null),b=a()(p,2),w=b[0],v=b[1],I=Object(c.useRef)();Object(c.useEffect)((function(){function e(){return(e=l()(s.a.mark((function e(){var n,t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!window.unseenMailsEmitter,t=!!m,n?window.unseenMailsEmitter=new N(m):t&&window.unseenMailsEmitter.interrupt(),!t){e.next=7;break}window.unseenMailsEmitter.emit(m),e.next=14;break;case 7:if(!n){e.next=10;break}return e.next=10,window.unseenMailsEmitter.load();case 10:I.current=window.unseenMailsEmitter.subscribe(v),v(window.unseenMailsEmitter.unseenMailsNumber),window.ramblerIdHelper=window.ramblerIdHelper||[],window.ramblerIdHelper.push((function(){window.ramblerIdHelper.addListener("login",window.unseenMailsEmitter.load),window.ramblerIdHelper.addListener("oauthlogin",window.unseenMailsEmitter.load)}));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){e.apply(this,arguments)}(),function(){m?(window.unseenMailsEmitter.isInterrupted=!1,window.unseenMailsEmitter.load()):(I.current&&I.current(),window.ramblerIdHelper.push((function(){window.ramblerIdHelper.removeListener("login",window.unseenMailsEmitter.load),window.ramblerIdHelper.removeListener("oauthlogin",window.unseenMailsEmitter.load)})))}}),[]),Object(c.useEffect)((function(){window.unseenMailsEmitter.emit(m)}),[m]),Object(c.useEffect)((function(){u&&null!==w&&u(w)}),[u,w]);var h=m||w;if(null===h)return null;if(Object(c.isValidElement)(f))return d.a.cloneElement(f,{counter:h});if(!r&&0===h)return null;var x=t&&h>99?"99+":"".concat(h);return o?d.a.createElement(d.a.Fragment,null,x):d.a.createElement("span",{className:i||"",style:n},x)}}])}}]);