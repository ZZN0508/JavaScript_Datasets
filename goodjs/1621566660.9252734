define("OK/AbstractShortcutMenu",["OK/utils/dom","OK/utils/vanilla","OK/utils/delegate"],(function(e,t,i){"use strict";var s=null,n=document.createElement("div");function o(){this.holder=null,this.menuElement=null,this.showTimeout=null,this.hideTimeout=null,this.ajaxRequest=null,this.direction="",this.position="center",this._visible=!1,this.inplace=!1,this.detectScrollableContainer=!1,this.menuElementHoverInListenerCalled=!1}return n.id="hook_Block_ShortcutMenu",document.body.appendChild(n),OK.hookModel.captureBlockHook("body",n),n.addEventListener("change",(function(){s&&s.visible()&&s.positingElement()})),o.getActiveInstance=function(){return s},o.setActiveInstance=function(e){s=e},o.getBlockId=function(){return"ShortcutMenu"},o.prototype.getBlock=function(){return this.inplace?this.block:n},o.prototype.getHtml=function(){},o.prototype.initListeners=function(e){this.shortcutMenuDelegate=new i(e),this.shortcutMenuDelegate.on("click",".sc-menu a",this.menuElementLinkClickListener.bind(this)),this.shortcutMenuDelegate.on("click",".sc-menu .js-hide",this.menuElementClickListener.bind(this)),this.shortcutMenuDelegate.on("click",".js-forceHide",function(e,t){this.hideMenu({forceHide:!t.classList.contains("js-supress-forceHide")})}.bind(this)),this.shortcutMenuDelegate.on("mouseenter",this.menuElementHoverInListener.bind(this)),this.shortcutMenuDelegate.on("mouseleave",this.hoverOutListener.bind(this)),OK.device.isTouch&&this.shortcutMenuDelegate.on("touchstart",this.holderTouchStartListener.bind(this))},o.prototype.processHTML=function(i){var s=[];this.inplace?(this.initBlock(),s[0]=this.blockId):s[0]=o.getBlockId();var n=this.getBlock();t.updateBlocks(i,s),this.initListeners(n),this.menuElement=e.firstByClass(n,"sc-menu"),this.positingElement(),this.menuElement.classList.remove("sc-menu__hidden"),this.holder.classList.add("__vis"),o.setActiveInstance(this),this._visible=!0},o.prototype.showMenu=function(){clearTimeout(this.hideTimeout),this.showTimeout=null,this.visible()||(s&&s.hide(),this.processHTML(this.getHtml()),t.trigger(this.holder,"shortcut-menu-show"),this.hideOnScroll&&(this.oneScrollListener={element:this.getClosestScrollable(!0),type:"scroll",handler:this.hoverOutListener.bind(this)},this.oneScrollListener.element.addEventListener("scroll",this.oneScrollListener.handler)))},o.prototype.hideMenu=function(e){this.clearShowTimeout(),this.clearHideTimeout(),t.trigger(this.holder,"shortcut-menu-hide",e),this.menuElement&&(this.menuElement.classList.add("sc-menu__hidden"),OK.hookModel.setHookContent("ShortcutMenu",""),this.menuElement=null),this.holder.classList.remove("__vis"),this.shortcutMenuDelegate&&this.shortcutMenuDelegate.off(),this._visible=!1,this.removeOneTimeListener(this.oneScrollListener),o.setActiveInstance(null)},o.prototype.hide=function(){this.clearShowTimeout(),this.clearHideTimeout(),this.menuElement&&this.hideMenu()},o.prototype.getClosestScrollable=function(t){if(!this.closestScrollable){var i=/(auto|scroll)/,s=e.traverseParents(this.holder,(function(e){var s=window.getComputedStyle(e);return i.test(s.overflow+s.overflowY+s.overflowX)&&(!t||e.scrollHeight>e.clientHeight)}));this.closestScrollable=s||window}return this.closestScrollable},o.prototype.isTopDirection=function(e,t){var i=this.holder.getBoundingClientRect().top;if(this.detectScrollableContainer){var s=this.holder.getBoundingClientRect().height,n=this.getClosestScrollable(),o=i-n.getBoundingClientRect().top,h=n.clientHeight-s,l=n.scrollTop+o+s+t,r=n.scrollHeight;return h/2<o||l>r}return window.innerHeight-e-i<t},o.prototype.isInsideViewportWhileCentered=function(e){var t=this.holder.getBoundingClientRect(),i=t.left,s=window.innerWidth-OK.scrollBar.width;if(this.detectScrollableContainer){var n=this.getClosestScrollable().getBoundingClientRect();i-=n.left,s=n.right}var o=i+(t.width-e)/2;return o>0&&o+e<s},o.prototype.toRightFromHolder=function(e,t){if(this.detectScrollableContainer){var i=this.getClosestScrollable().getBoundingClientRect(),s=this.holder.getBoundingClientRect().left-i.left;return i.width/2>s}return window.innerWidth-OK.scrollBar.width>e.left+t},o.prototype.visible=function(){return this._visible},o.prototype.getOffset=function(e){var t=e.getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset}},o.prototype.positingElement=function(){var t,i=e.outerSize(this.holder,!1,!1),s=this.inplace?{top:0,left:0}:this.getOffset(this.holder),n=e.outerSize(this.holder,!0,!1),o=e.outerSize(this.menuElement,!0,!0),h=this.position;"center"!==h||this.isInsideViewportWhileCentered(o)||(h="auto"),"center"!==h&&"auto"!==h&&this.menuElement.classList.add("__noarrow");var l=e.outerSize(this.menuElement,!1,!0);t="top_force"===this.direction||"bottom_force"===this.direction?"top_force"===this.direction:"top"===this.direction?this.getOffset(this.holder).top-window.pageYOffset-90>l:"bottom"!==this.direction&&this.isTopDirection(i,l);var r,a=s.top,c=[];t?(this.menuElement.classList.add("sc-menu__top"),this.inplace?(r=a+i,c.push("top: auto; bottom: "+Math.round(r)+"px;")):(a-=l,c.push("bottom: auto; top: "+Math.round(a)+"px;"))):(this.menuElement.classList.remove("sc-menu__top"),this.inplace||(a+=i),c.push("bottom: auto; top: "+Math.round(a)+"px;"));var u=Math.round(s.left-(o-n)),d=Math.round(s.left),m=Math.round(s.left+(n-o)/2);switch(h){case"left":c.push("left: "+u+"px;");break;case"right":c.push("left: "+d+"px;");break;case"auto":var p=e.firstByClass(this.menuElement,"entity-shortcut-menu_arw"),g=0,f=p?54:0,v=this.toRightFromHolder(s,o);if(v?(this.menuElement.classList.remove("__right"),this.menuElement.classList.add("__left")):(this.menuElement.classList.add("__right"),this.menuElement.classList.remove("__left")),!f&&(p=e.firstByClass(this.menuElement,"sc-menu_arw"))){var b=p.getBoundingClientRect();if(b.width){var L=this.menuElement.getBoundingClientRect();f=v?2*(b.left-L.left)+b.width:2*(L.left+L.width-(b.left+b.width))+b.width}}n<f&&(g=(f-n)/2),v?c.push("left: "+(d-g)+"px;"):c.push("left: "+(u+g)+"px;");break;default:c.push("left: "+m+"px;")}this.menuElement.setAttribute("style",c.join(""))},o.prototype.ajaxClose=function(e){this.ajaxRequest&&(this.ajaxRequest.xhr.abort(),this.ajaxRequest=null,"function"==typeof e&&e())},o.prototype.hoverInListener=function(e){OK.device.isTouch&&e||(s!==this&&(s&&s.hide(),o.setActiveInstance(this)),this.clearHideTimeout(),this.showTimeout||this.visible()||(this.showTimeout=setTimeout(this.showMenu.bind(this),this.showDelay)))},o.prototype.hoverOutListener=function(){this.clearShowTimeout(),this.ajaxClose(),!this.hideTimeout&&this.visible()&&(this.hideTimeout=setTimeout(function(){this.hideOnBlurElement!==document.activeElement?this.hideMenu():this.hideTimeout=null}.bind(this),this.hideDelay))},o.prototype.menuElementHoverInListener=function(){this.menuElementHoverInListenerCalled=!0,this.hideTimeout&&(this.hideTimeout=clearTimeout(this.hideTimeout))},o.prototype.menuElementLinkClickListener=function(t){e.parent(t.target,"js-doNotHide",this.block)||this.menuElementClickListener()},o.prototype.menuElementClickListener=function(){!0===this.hideTimeout&&(this.hideTimeout=null),this.hoverOutListener()},o.prototype.holderTouchStartListener=function(e){e.stopPropagation()},o.prototype.clearShowTimeout=function(){this.showTimeout&&(this.showTimeout=clearTimeout(this.showTimeout))},o.prototype.clearHideTimeout=function(){this.hideTimeout&&(this.hideTimeout=clearTimeout(this.hideTimeout))},o.prototype.removeOneTimeListener=function(e){e&&(e.element.removeEventListener(e.type,e.handler),e=null)},o})),define("OK/ShortcutMenu",["OK/logger","OK/utils/vanilla","OK/utils/dom","OK/utils/delegate","OK/AbstractShortcutMenu"],(function(e,t,i,s,n){"use strict";function o(e){n.call(this),this.hookId=e,this.stopClick=!0,this.ajaxRequest=null,this.cacheable=!0,this.loaded=!1,this.showOnClick=!0}return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,Object.assign(o.prototype,{activate:function(t){if(this.element=t,this.holder=this.getHolder(),this.blockId=this.element.getAttribute("data-blockid"),this.block=document.getElementById("hook_Block_"+this.blockId),this.inplace=this.element.getAttribute("data-inplace"),this.loaded=this.element.getAttribute("data-loaded"),this.showDelay=parseInt(this.element.getAttribute("data-show"),10)||300,this.hideDelay=parseInt(this.element.getAttribute("data-hide"),10)||100,this.cacheable=!this.element.getAttribute("data-nocache"),this.saveChanges=this.element.getAttribute("data-save-changes"),this.direction=this.element.getAttribute("data-direction"),this.position=this.element.getAttribute("data-position")||"center",this.showOnClick=this.element.getAttribute("data-onClick"),this.isShowImmediately=this.element.getAttribute("data-showImmediately"),this.showImmediatelySelector=this.element.getAttribute("data-showImmediatelySelector"),this.relatedMenu=this.getRelatedMenu(),this.hideOnClick=this.element.getAttribute("data-hideOnClick"),this.hideOnMouseDown=this.element.getAttribute("data-hideOnMouseDown"),this.hideOnScroll=this.element.getAttribute("data-hideOnScroll"),this.hideOnBlurSelector=this.element.getAttribute("data-hideOnBlurSelector"),this.hideOnBlurElement=null,this.detectScrollableContainer=this.element.getAttribute("data-detect-scrollable"),!this.holder)return e.error("asm","noholder"),void e.success("asm","noholder",this.buildParamFingerprint());if(this.handlers={},this.boundAjaxFail=this.ajaxFail.bind(this),this.boundAjaxDone=this.ajaxDone.bind(this),this.holderDelegate=new s(this.holder),OK.device.isTouch){this.holderDelegate.on("touchstart",this.holderTouchStartListener);var n=this.holder.getElementsByTagName("a")[0];n||(n=i.traverseParents(this.holder,(function(e){return"A"===e.tagName.toUpperCase()}),document.body,!0)),n&&(this.linkDelegate=new s(n),this.linkDelegate.on("touchstart",this.touchHandle.bind(this),!0))}this.holderDelegate.on("mouseleave",this.hoverOutListener.bind(this)),this.showOnClick?this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.showMenu):(this.holderDelegate.on("mouseenter",this.hoverInListener.bind(this)),this.hideOnClick&&this.holderDelegate.on("click",this.hoverOutListener.bind(this)),this.hideOnMouseDown&&this.holderDelegate.on("mousedown",this.hoverOutListener.bind(this))),this.inplace&&this.loaded&&this.initListeners(this.getBlock()),this.isShowImmediately&&this.showImmediately(),"1"===t.getAttribute("data-expanded")&&setTimeout(this.showMenu.bind(this),0)},deactivate:function(){this.holder&&(this.ajaxClose(),this.hide(),this.removeOneTimeListener(this.oneClickListener),this.removeOneTimeListener(this.oneScrollListener),this.removeOneTimeListener(this.oneBodyTouchListener),this.removeOneTimeListener(this.oneImmediatelyHandler),this.removeOneTimeListener(this.oneBlurListener),this.holderDelegate.destroy(),this.linkDelegate&&this.linkDelegate.destroy(),this.shortcutMenuDelegate&&this.shortcutMenuDelegate.destroy())},buildParamFingerprint:function(){var e=[this.inplace,this.loaded,this.cacheable,this.showOnClick,this.hideOnClick,this.hideOnScroll],t="";return e.forEach((function(e){t+=(1*!!e).toString()})),t},getHolder:function(){var e=this.element.getAttribute("data-holder");return e?document.getElementById(e):this.element.previousElementSibling},getRelatedMenu:function(){var e,t=this.element.getAttribute("data-related");return t&&(e=OK.hookModel.getHookById(t)).getInstance?e.getInstance():null},getHtml:function(){if(!this.block)return"";var e=this.block.innerHTML;return this.inplace&&this.cacheable||(OK.hookModel.setHookContent(this.blockId,""),this.cacheable&&(this.block.innerHTML=e)),e},initBlock:function(){if(this.element&&!this.block){for(var e=Array.prototype.slice.call(this.element.children),t=null,i=0;i<e.length;i++)if(e[i].classList.contains("posR")){t=e[i];break}if(t)this.block=t;else{var s=document.createElement("div");s.id="hook_Block_"+this.blockId,s.className="posR",this.element.appendChild(s),this.block=s,OK.hookModel.captureBlockHook(this.hookId,s)}}},initListeners:function(e){n.prototype.initListeners.call(this,e),this.hideOnBlurSelector&&(this.hideOnBlurElement=this.block.querySelector(this.hideOnBlurSelector),this.oneBlurListener=this.addOneTimeListener(this.hideOnBlurElement,"blur",this.hoverOutListener.bind(this)))},showMenu:function(){if(clearTimeout(this.hideTimeout),this.showTimeout=null,this.relatedMenu&&this.relatedMenu.hide&&this.relatedMenu.hide(),!this.visible()&&(n.getActiveInstance()&&n.getActiveInstance().hide(),this.showOnClick&&(this.removeOneTimeListener(this.oneClickListener),this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.hideMenu)),this.hideOnScroll&&(this.oneScrollListener=this.addOneTimeListener(this.getClosestScrollable(!0),"scroll",this.hoverOutListener)),this.showTimeout=null,OK.device.isTouch&&(this.oneBodyTouchListener=this.addOneTimeListener(document.body,"touchstart",this.hoverOutListener)),!this.ajaxRequest))if(this.startTime=Date.now(),this.loaded){var i=this.getHtml();this.processHTML(i,void 0,!this.inplace||!this.cacheable),e.success("asm","show","cache")}else{var s=this.element.getAttribute("data-url");this.ajaxRequest=t.ajax({url:s,dataType:"html"}),this.ajaxRequest.then(this.boundAjaxDone,this.boundAjaxFail)}},showImmediately:function(){var e=this;e.showImmediatelySelector&&setTimeout((function(){var t=e.showImmediatelySelector+":hover";e.showImmediatelyElement=i.traverseParents(e.holder,(function(e){return e.matches(t)})),e.showImmediatelyElement.matches(t)&&(e.showMenu(),e.oneImmediatelyHandler=this.addOneTimeListener(e.showImmediatelyElement,"mouseleave",(function(){setTimeout((function(){e.menuElementHoverInListenerCalled||e.hideMenu()}),e.hideDelay)})))}),1)},hideMenu:function(){this.clearShowTimeout(),(this.visible()||this.showOnClick)&&(this.clearHideTimeout(),this.stopClick=!0,this.showOnClick&&(this.removeOneTimeListener(this.oneClickListener),this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.showMenu)),this.ajaxClose((function(){e.success("asm","ajax","to")})),this.menuElement&&(this.menuElement.classList.add("sc-menu__hidden"),this.getHtml(),this.saveChanges&&!this.inplace&&this.loaded&&this.cacheable&&(this.initBlock(),this.block.innerHTML=this.getBlock().innerHTML),OK.hookModel.setHookContent(n.getBlockId(),""),this.menuElement=null),this.holder.classList.remove("__vis"),this.shortcutMenuDelegate&&!this.cacheable&&this.shortcutMenuDelegate.off(),this._visible=!1,n.setActiveInstance(null))},touchHandle:function(e){if(this.stopClick)return e.preventDefault(),e.stopPropagation(),this.stopClick=!1,this.showOnClick||this.hoverInListener(),!1;this.hoverOutListener()},processHTML:function(e,s,o){var h=[];s&&s.getResponseHeader(OK.navigation.HEADER)&&(h=s.getResponseHeader(OK.navigation.HEADER).split(",")),this.inplace?(this.initBlock(),h[0]=this.blockId):h[0]=n.getBlockId();var l=this.getBlock();o&&(t.updateBlocks(e,h),this.initListeners(l)),this.menuElement=i.firstByClass(l,"sc-menu"),this.positingElement(),this.menuElement.classList.remove("sc-menu__hidden"),this.holder.classList.add("__vis"),n.setActiveInstance(this),this._visible=!0},ajaxDone:function(t){e.duration("asm",Date.now()-this.startTime,"ajax");var i=t.response;i&&0!==i.split(OK.navigation.SPLITER)[0].length?(e.success("asm","show","ajax"),this.cacheable&&this.element&&(this.loaded=!0,this.initBlock(),this.block.innerHTML=i.split(OK.navigation.SPLITER)[0]),this.processHTML(i,t.xhr,!0),this.ajaxClose()):e.success("asm","ajax","e")},ajaxFail:function(){this.ajaxClose((function(){e.error("asm","ajax")}))},addOneTimeListener:function(e,t,i){var s=this,n=function t(n){e.removeEventListener(n.type,t),i.call(s,n)};return e.addEventListener(t,n),{element:e,type:t,handler:n}},removeOneTimeListener:function(e){e&&(e.element.removeEventListener(e.type,e.handler),e=null)}}),o})),define("b/shortcutMenuBundle",["OK/AbstractShortcutMenu","OK/ShortcutMenu"],{});