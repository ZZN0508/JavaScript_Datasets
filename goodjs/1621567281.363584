!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("CAAS_AOLCOM",[],t):"object"==typeof exports?exports.CAAS_AOLCOM=t():e.CAAS_AOLCOM=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="http://172.17.0.2:8080/public/assets/",n(n.s=434)}({135:function(e,t,n){"use strict";e.exports={dispatchCustomEvent:function(e,t){var n=document.createEvent("CustomEvent");n.initCustomEvent(e,!1,!1,t),document.dispatchEvent(n)}}},140:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={GEMINI_NO_ADS:"GEMINI: NO ADS RETURNED"},o="https://ads.yap.yahoo.com/nosdk/wj/v1/getAds.do",r={jac:"jac:item",gemini:"gemini:item"},a=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cb";return new Promise((function(i){var o=Date.now(),r=document.createElement("script"),a="_jsonp_"+o,c=[n+"="+a];Object.keys(t).forEach((function(e){c.push(e+"="+t[e])})),e+="?"+c.join("&"),r.src=e,window[a]=function(e){i(new Response(JSON.stringify(e))),r.remove(),delete window[a]},document.body.appendChild(r)}))},c=function(e,t){var n=t.dataset.renderPath,i={ctrl:"DLPagination",m_id:"tdv2-wafer-dl",m_mode:"json",data:[e]},o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)};return fetch(n,o).then((function(e){return e.json()}))},s=function(e,t){try{var n=document.createElement("div");n.innerHTML=t;var i=n.querySelector(".slides .dl__slide");n.innerHTML=i&&i.innerHTML||t,e.nextSibling&&e.parentNode.removeChild(e.nextSibling),e.insertAdjacentElement("beforeend",n),window.wafer&&setTimeout((function(){window.wafer.base.emitWaferEvent("uac:adinjected",{elem:e.parentNode,ad:e,adMarkup:n}),window.wafer.base.sync(e.parentNode)}),10)}catch(e){console.error(e)}};t.default={AD_TYPES:{jac:"jac",gemini:"gemini"},AD_SERVER_ERRORS:i,GEMINI_YAP_URL:o,GEMINI_TOTAL_ADS:10,PLACEMENT_TYPES:r,fetchJSONP:a,fetchGeminiData:function(e){var t=e.apiKey,n=e.adUnitCode,c=e.views,s=void 0===c?[]:c,d={local:"en_us",agentVersion:"205",adTrackingEnabled:!0,totalAds:10,publisherUrl:window.location.href,apiKey:t,adUnitCode:n};return a(o,d).then((function(e){return e.json()})).then((function(e){if(!e||e.error)throw new Error(e);var t=e.ads;if(!t||t.length<=0)throw new Error(i.GEMINI_NO_ADS);var n=Math.floor(Math.random()*t.length),o=void 0!==t[n]?t[n]:t[0];return o.tag=o.tag||{},o.tag.imprTrackingUrl=o.tag.imprTrackingUrl||[],o.tag.imprTrackingUrl=o.tag.imprTrackingUrl.concat(s),o.placementType=r.gemini,o}))},fetchMarkup:c,injectMarkupBesideNode:s,getDataFromIframe:function(e,t){var n=document.createElement("iframe");n.style.display="none",t.appendChild(n),n.contentWindow.document.open(),n.contentWindow.document.write(e),n.contentWindow.document.close();try{return JSON.parse(n.contentWindow.document.getElementsByClassName("ad-code")[0].textContent)}catch(e){return console.error(e),{}}},fetchMarkupAndRender:function(e,t){return c(e,t).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.html;s(t,n)}))}}},434:function(e,t,n){e.exports=n(435)},435:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(436),r=(i=o)&&i.__esModule?i:{default:i};t.default=new r.default({selector:".m-jac-ad"})},436:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,c=e[Symbol.iterator]();!(i=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=u(n(437)),a=u(n(438)),c=u(n(439)),s=u(n(140)),d=n(135);function u(e){return e&&e.__esModule?e:{default:e}}function l(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var f,h=s.default.AD_TYPES,m=["fi_1374016173","fi_ad_leaderboard"],v=c.default,p=["DL1_ATF","DL3_ATF","DL5_ATF","DL10_ATF","DL20_ATF","DL40_ATF","MOBILE-DL5_ATF","MOBILE-DL20_ATF"],g=[9,24,39],y=function(e){if(!e)return console.warn("Element not found:",e);var t=void 0;try{t=JSON.parse(e.dataset.config)}catch(t){return console.error("Error parsing config for",e)}return t.isGeminiAd?a.default.fromElement(e):r.default.fromElement(e)};t.default=(f=window.wafer.utils.loadScriptAsync,function(){function e(t){var n=this,i=t.selector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elems=[].concat(l(document.querySelectorAll(i)))||[],this.initializedAdPositions=new Map,this.adRefreshCounter=0,this.waferModuleAddedQueue=[],window.wafer.ready((function(){n.waferModuleAddedQueue=n.waferModuleAddedQueue.concat([].concat(l(document.querySelectorAll(".dl-jac.wafer-module-complete")))),n.addWaferEvents(),n.processQueue()})),this.ensureJacLibIsLoaded()}return o(e,[{key:"ensureJacLibIsLoaded",value:function(){var e=this;this.jacLibLoaded?this.init():(window.JAC_CONFIG={client:{onReady:function(){e.init()}}},"complete"!==document.readyState||this.jacLibLoaded?window.addEventListener("load",(function(){e.loadJacLib()})):this.loadJacLib())}},{key:"loadJacLib",value:function(){var e=this;return new Promise((function(t,n){e.jacLibLoaded?t():f({src:"https://jill.fc.yahoo.com/v1/client/js"},(function(){t()}),"JAC")}))}},{key:"init",value:function(){this.jac=window.JAC,this.jacConfig=window.__JAC_CONFIG||v,this.ads=this.elems.reduce((function(e,t){var n=r.default.fromElement(t);return n?(e.set(n.getPositionName(),n),e):e}),new Map),this.addEventListeners(),this.setJacConfig(),(0,d.dispatchCustomEvent)("jac:inited",{}),this.processQueue()}},{key:"processQueue",value:function(){if(this.jac)for(;this.waferModuleAddedQueue.length>0;){var e=this.waferModuleAddedQueue.shift();this.handleWaferModuleAdded({elem:e})}}},{key:"addEventListeners",value:function(){var e=this;this.jac.on("FETCH_COMPLETE",(function(t){e.handleAdFetch(t)})),document.addEventListener("jac:refresh",(function(t){e.handleRefreshEvent(t)})),this.jac.on("AD_SIZE_CHANGED",(function(t){e.handleMinHeight(t)})),this.jac.on("FETCH_ERROR",(function(t){var n=t.meta;(n=void 0===n?{}:n).positionNames.forEach((function(t){e.collapseMinHeight(t)}))}))}},{key:"addWaferEvents",value:function(){var e=this;window.wafer.on("module:added",(function(t){e.handleWaferModuleAdded(t)})),window.wafer.on("dl:change",(function(t){e.handleDlChange(t)}))}},{key:"handleMinHeight",value:function(e){var t=e.meta,n=(t=void 0===t?{}:t).height,i=t.positionName;0!==n&&1!==n||this.collapseMinHeight(i)}},{key:"collapseMinHeight",value:function(e){var t=this.ads.get(e);t&&(t.elem.style.minHeight="0px")}},{key:"handleWaferModuleAdded",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.elem,i=void 0===n?{}:n;if(i.classList.contains("dl-jac"))if(this.jac){var o=y(i);if(o)switch(o.adType){case h.jac:this.ads.set(o.getPositionName(),o),this.jac.createPosition(o.getPositionName(),o.getPlacementConfig());break;case h.gemini:default:this.initializedAdPositions.has(o.getPositionId())||(this.initializedAdPositions.set(o.getPositionId(),o),o.renderNatively().catch((function(t){e.initializedAdPositions.delete(o.getPositionId()),console.error(t)})))}else console.error("No Ad Found")}else-1===this.waferModuleAddedQueue.indexOf(i)&&this.waferModuleAddedQueue.push(i)}},{key:"handleAdFetch",value:function(e){var t=this;if(e&&e.meta&&e.meta.positionNames&&!(!e.meta.positionNames.length>0)){var n=e.meta.positionNames;n.forEach((function(n){if(!function(e){return p.indexOf(e)>=0}(n)||t.initializedAdPositions.has(n))console.warn("skipping placement "+n+" as it is either not a DL AD or has already been initialized");else{var i=e.meta.response.positions[n],o=void 0;t.ads.has(n)?(o=t.ads.get(n)).setConfig(i):o=r.default.fromJillResponse(n,i),t.initializedAdPositions.set(n,o),o.renderNatively().catch((function(e){t.initializedAdPositions.delete(n),console.error(e)}))}}))}}},{key:"handleDlChange",value:function(e){var t=e.elem,n=e.meta,o=(n=void 0===n?{}:n).index,r=void 0!==o&&o;if(t.classList.contains("dl")&&r){var a=t.dataset||{},c=a.wfAdRefreshLimit,s=a.wfAdRefreshIndexes,d=a.wfAdRefreshIds,u=3,f=g,h=m;if(c){var v=parseInt(c,10);window.isNaN&&!window.isNaN(v)&&(u=v)}if(s)try{f=JSON.parse(s)}catch(e){}if(d)try{h=JSON.parse(d)}catch(e){}if(!(this.adRefreshCounter>=u||-1===f.indexOf(r))&&this.jac){this.adRefreshCounter+=1;var p=[].concat(l(this.initializedAdPositions)),y=!!document.getElementById("act-labs-holder"),w=h.reduce((function(e,t){for(var n=void 0,o=0;o<p.length;o++){var r=i(p[o],2),a=r[0];if(r[1].getPositionId()===t){n=a;break}}return n&&!(y&&"fi_ad_leaderboard"===t)&&e.push(n),e}),[]);w.length>0&&this.jac.fetch(w)}}}},{key:"handleRefreshEvent",value:function(e){var t=e.detail,n=void 0===t?[]:t;this.jac.fetch(n)}},{key:"setJacConfig",value:function(){var e=this;this.ads.forEach((function(t,n){e.mergePlacecmentConfig(t),e.initializedAdPositions.set(t.getPositionName(),t)})),window.__JAC_CONFIG=this.jacConfig,this.jac.setConfig(window.__JAC_CONFIG)}},{key:"mergePlacecmentConfig",value:function(e){this.jacConfig.service=this.jacConfig.service||{},this.jacConfig.service.positions=this.jacConfig.service.positions||{},this.jacConfig.client=this.jacConfig.client||{},this.jacConfig.client.positions=this.jacConfig.client.positions||{};var t=e.getPositionName();this.jacConfig.service.positions[t]=e.getServiceConfig(),this.jacConfig.client.positions[t]=e.getClientConfig()}},{key:"jacLibLoaded",get:function(){return!!window.JAC}}]),e}())},437:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(140),c=(i=a)&&i.__esModule?i:{default:i};var s=c.default.AD_TYPES,d=c.default.PLACEMENT_TYPES,u=c.default.fetchGeminiData,l=c.default.getDataFromIframe,f=c.default.fetchMarkupAndRender;t.default=function(){function e(t,n,i,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&n&&i&&(this.adType=s.jac,this.positionName=t,this.config=n,this.placement=i||n.client.target,this.elem=o||document.getElementById(i),this.content=r)}return r(e,[{key:"getPositionId",value:function(){return this.placement}},{key:"getPositionName",value:function(){return this.positionName}},{key:"setConfig",value:function(e){var t=e.config,n=void 0===t?{}:t,i=e.content,o=void 0===i?{}:i;this.config=n,this.content=o}},{key:"getPlacementConfig",value:function(){return{service:this.getServiceConfig(),client:this.getClientConfig()}}},{key:"getServiceConfig",value:function(){return this.config.service}},{key:"getClientConfig",value:function(){return this.config.client}},{key:"renderNatively",value:function(){var e=this;if(!this.content)return console.warn("No content for placement "+this.positionName);var t=l(this.content.markup,this.elem);return void 0!==t.adType&&"gemini"===t.adType?u(t).then((function(t){f(t,e.elem)})).catch((function(e){throw e})):f(o({placementType:d.jac},t),this.elem)}}],[{key:"fromElement",value:function(t){if(!t)return console.warn("Element not found:",t);var n=void 0;try{n=JSON.parse(t.dataset.config)}catch(e){return console.error("Error parsing config for",t)}if(0===Object.keys(n).length||!n.name)return null;t.id&&t.id===n.placement||(t.id=n.placement);var i={service:{alias:""+n.magicNumber,sizes:n.sizes},client:{targetElement:n.placement,render:n.render,features:n.features}};return new e(n.name,i,n.placement,t)}},{key:"fromJillResponse",value:function(t,n){if(!t||!n)return console.warn("Position name and config required");var i=n.config,o=void 0===i?{}:i,r=n.content,a=void 0===r?{}:r;return new e(t,o,o.client.targetElement,null,a)}}]),e}()},438:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(140),a=(i=r)&&i.__esModule?i:{default:i};var c=a.default.AD_TYPES,s=a.default.fetchGeminiData,d=a.default.fetchMarkupAndRender;t.default=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&t.adUnitCode&&n&&(this.adType=c.gemini,this.config=t,this.placement=n,this.elem=i||document.getElementById(n))}return o(e,[{key:"getPositionId",value:function(){return this.placement}},{key:"renderNatively",value:function(){var e=this;return s(this.config).then((function(t){d(t,e.elem)})).catch((function(e){throw e}))}}],[{key:"fromElement",value:function(t){if(!t)return console.warn("Element not found:",t);var n=void 0;try{n=JSON.parse(t.dataset.config)}catch(e){return console.error("Error parsing config for",t)}return 0!==Object.keys(n).length&&n.geminiAdUnitCode?(t.id&&t.id===n.placement||(t.id=n.placement),new e({adUnitCode:n.geminiAdUnitCode,apiKey:n.geminiApiKey||"C5VPNN3HH87ZR8M33TBQ"},n.placement,t)):null}}]),e}()},439:function(e,t,n){"use strict";e.exports={service:{adServer:{"1AS":{region:"US",params:{blogname:"aol",pub:"aol",pubmarket:"us",pubsection:"main"}}},debug:!0,site:{name:"AOL",spaceId:"1197803361"},positions:{}},client:{positions:{}}}}})}));
//# sourceMappingURL=jac.js.map