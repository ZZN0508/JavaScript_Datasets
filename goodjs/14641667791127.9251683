function initialise(t){var a,n,c;function u(){try{var e=navigator.mediaSession.metadata.artwork[0].src}catch(t){e=null}return e}async function e(t){try{var e,i;c&&(document.pictureInPictureElement||t)&&(e=u(),i=!1,a.paused&&(i=!0,await a.play()),e&&(c.src=u(),await c.decode(),await n.getContext("2d").drawImage(c,0,0,n.width,n.height),i&&a.pause()))}catch(t){DEBUG_FULL&&console.log("ERROR",t)}}PictureInPicture.prototype.audioPiP=async function(){a||((a=document.createElement("video")).muted=!0,(c=new Image).crossOrigin=!0,n=document.createElement("canvas"),a.srcObject=n.captureStream(),publicApi.pushMediaEventFunctions({setMediaSessionAPIdata:function(){e()},playing:function(){document.pictureInPictureElement&&a.play()},pause:function(){document.pictureInPictureElement&&a.pause()}})),n.width=512,n.height=512,c.height=n.height,c.width=n.width,n.getContext("2d").fillRect(0,0,n.width,n.height),await e(!0),await a.play(),await a.requestPictureInPicture()}}export{initialise};
