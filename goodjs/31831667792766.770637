!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.IMUID=e():t.IMUID=e()}(this,function(){return n={575:function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},913:function(t){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}t.exports=function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}},713:function(t){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},137:function(t,e,i){"use strict";i.d(e,{IMUID:function(){return h}});var e=i(713),n=i.n(e),e=i(575),o=i.n(e),e=i(913),e=i.n(e);function r(t){t=new Error(t);return t.source="ulid",t}var u="0123456789ABCDEFGHJKMNPQRSTVWXYZ",a=u.length,s=Math.pow(2,48)-1;function c(t,e){for(var n,o="";0<t;t--)n=e,n=Math.floor(n()*a),o=u.charAt(n=n===a?a-1:n)+o;return o}function d(t,e){var t=0<arguments.length&&void 0!==t&&t,e=e,n=(e=e||("undefined"!=typeof window?window:null))&&(e.crypto||e.msCrypto);if(n)return function(){var t=new Uint8Array(1);return n.getRandomValues(t),t[0]/255};try{var o=i(788);return function(){return o.randomBytes(1).readUInt8()/255}}catch(t){}if(t){try{console.error("secure crypto unusable, falling back to insecure Math.random()!")}catch(t){}return function(){return Math.random()}}throw r("secure crypto unusable, insecure Math.random not allowed")}function l(e){return e=e||d(),function(t){return function(t,e){if(isNaN(t))throw new Error(t+" must be a number");if(s<t)throw r("cannot encode time greater than "+s);if(t<0)throw r("time must be positive");if(!1===Number.isInteger(t))throw r("time must be an integer");for(var n,o="";0<e;e--)o=u.charAt(n=t%a)+o,t=(t-n)/a;return o}(t=isNaN(t)?Date.now():t,10)+c(16,e)}}l();var f=(e()(p,[{key:"push",value:function(t){window.IMUID.run(t)}}]),p),e=(e()(I,[{key:"run",value:function(t){var e,n,o;"customerId"in t&&"callback"in t?(e=t,(n=this.getCookie(I.VISITOR_COOKIE_NAME)===I.OPTOUT_VALUE)?t.callback({uid:"",vid:"",optouted:n,status:"done",loopbacks:null!==(n=null==e?void 0:e.loopbacks)&&void 0!==n?n:null}):(this.IMUIDs[e.customerId]={},o=this.getVid(),this.getUid({vid:o,seed:e,onLoad:function(t){e.callback({vid:o,uid:t,optouted:!1,status:"done",loopbacks:null!==(t=null==e?void 0:e.loopbacks)&&void 0!==t?t:null})},onTimeout:function(){var t;e.callback({uid:"",vid:"",optouted:!1,status:"timeout",loopbacks:null!==(t=null==e?void 0:e.loopbacks)&&void 0!==t?t:null})}}))):"optout"in t&&(t.optout?this.setCookie(I.VISITOR_COOKIE_NAME,I.OPTOUT_VALUE):this.setCookie(I.VISITOR_COOKIE_NAME,""))}},{key:"get",value:function(t){return this.IMUIDs[t+""].uid}},{key:"getCookie",value:function(t){for(var e=t.length+1,n=document.cookie.split("; "),o="",i=0;i<n.length;i++)if(n[i].substr(0,e)===t+"="){o=n[i].substr(e,n[i].length);break}return o}},{key:"setCookie",value:function(t,e,n,o){n=null!==n&&void 0!==n?n:"."+window.location.hostname,o=void 0===o?"https:"==window.location.protocol:!!o;var i=new Date;i.setTime(i.getTime()+this.msToExpire),document.cookie=t+"="+e+(this.msToExpire?"; expires="+i.toUTCString():"")+"; path=/"+(n?"; domain="+n:"")+(o?"; SameSite=none; Secure;":";")}},{key:"isImid",value:function(t){return"string"==typeof t&&0===t.indexOf(I.IMID_PREFIX)}},{key:"setCustomerUid",value:function(t,e){this.IMUIDs[t].uid=e}},{key:"getVid",value:function(){var t=(t=this.getCookie(I.VISITOR_COOKIE_NAME))||this.ulid();return this.setCookie(I.VISITOR_COOKIE_NAME,t),t}},{key:"getPreferUid",value:function(t,e){return!this.isImid(e)&&t||e}},{key:"fetchData",value:function(t){var e=t.url,n=t.onLoad,o=t.onTimeout,t=t.timeout,t=void 0===t?1e4:t,i=new XMLHttpRequest,r=setTimeout(function(){i.abort(),o&&o()},t);i.onload=function(){clearTimeout(r),n&&n(i.responseText)},i.withCredentials=!0,i.open("GET",e,!0),i.send(null)}},{key:"getUid",value:function(t){var o=this,e=t.vid,i=t.seed,r=t.onLoad,n=t.onTimeout,e="https://".concat(i.SYNC_URL||I.SYNC_URL,"?vid=").concat(e,"&cid=").concat(i.customerId);this.fetchData({url:e,onLoad:function(t){var e=JSON.parse(t).uid,n=i.customerId,t=o.IMUIDs[n].aggrid,e=o.getPreferUid(t,e);o.setCustomerUid(n,e),r(e)},onTimeout:function(){n&&n()},timeout:i.callbackTimeout})}}]),I);function I(){var e=this;o()(this,I),n()(this,"IMUIDs",{}),n()(this,"msToExpire",2592e6),n()(this,"ulid",void 0);var t=d(!0);this.ulid=l(t),window.IMUIDRequest&&window.IMUIDRequest instanceof Array&&(window.IMUIDRequest.forEach(function(t){e.run(t)}),window.IMUIDRequest=new f)}function p(){o()(this,p)}n()(e,"IMID_PREFIX","i"),n()(e,"SYNC_URL","audiencedata.im-apps.net/imuid/get"),n()(e,"VISITOR_COOKIE_NAME","_im_vid"),n()(e,"OPTOUT_VALUE","optout"),Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};var h=window.hasOwnProperty("IMUID")?window.IMUID:new e},788:function(){}},i={},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,{a:e}),e},o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o(137).IMUID;function o(t){if(i[t])return i[t].exports;var e=i[t]={exports:{}};return n[t](e,e.exports,o),e.exports}var n,i});
