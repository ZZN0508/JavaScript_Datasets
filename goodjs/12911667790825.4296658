var amzn_aps_csm=amzn_aps_csm||{};amzn_aps_csm.errors=[],amzn_aps_csm.reportErrors=function(e){var n,t;for("/"!==(e=!1===/^https?:\/\//.test(e)?document.location.protocol+"//"+e:e).substr(e.length-1)&&(e+="/"),n=0;n<amzn_aps_csm.errors.length;n++)t='{"adViewability":[{"error": {"m": "'+amzn_aps_csm.errors[n]+'"}}], "c": "aps_communicator", "api": "RTB", "error": 1}',"https:"===document.location.protocol&&!0===/^http:\/\//.test(e)&&(e=e.replace("http://","https://")),(new Image).src=e+t+"?cb="+Math.round(1e7*Math.random());amzn_aps_csm.errors=[]},function(){function d(e,n){try{return e[n]}catch(e){return""}}var f=/\(?([^\s]*):(\d+):\d+\)?/,g=/.*@(.*):(\d*)/;amzn_aps_csm.constructErrorMessage=function(e,n){if(!e)return{};var t,a,s,r,o,m,i,c,p={m:function(e,n){n=n.m||n.message||"";return n+=e.m&&e.m.message?e.m.message:e.m&&e.m.target&&e.m.target.tagName?"Error handler invoked by "+e.m.target.tagName+" tag":e.m||e.message||"Unknown error"}(e=e.m&&e.m.message?e.m:e,n=n||{}),c:e.c&&""+e.c,s:[],l:e.l||e.line||e.lineno||e.lineNumber,name:e.name,type:e.type},l=0,u=0,_=e.stack||(e.err?e.err.stack:"");if(_&&_.split)for(t=_.split("\n");l<t.length&&p.s.length<20;)(a=t[l++])&&p.s.unshift((o=a)&&o.replace(/^\s+|\s+$/g,""));else for(s=d(e.args||arguments,"callee"),u=l=0;s&&l<20;)r=256,s.skipTrace||(a=s.toString())&&a.substr&&(r=0===u?1024:r,p.s.unshift(a.substr(0,r=1===u?512:r)),u++),s=d(s,"caller"),l++;return!p.f&&0<p.s.length&&((m=p)&&m.s&&(c=0<m.s.length?m.s[0]:"",_=1<m.s.length?m.s[1]:"",(i=(!(i=c?c.match(g):i)||3!==i.length)&&_?_.match(f):i)&&3===i.length&&(m.f=i[1],m.l=i[2]))),p}}(),window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(){function o(e){return n[e]||"\\u"+(e.charCodeAt(0)+65536).toString(16).substr(1)}var m=Object.prototype.toString,i=Array.isArray||function(e){return"[object Array]"===m.call(e)},n={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r"," ":"\\t"},c=/[\\"\u0000-\u001F\u2028\u2029]/g;return function e(n){var t,a,s,r;if(null==n)return"null";if("number"==typeof n)return isFinite(n)?n.toString():"null";if("boolean"==typeof n)return n.toString();if("object"==typeof n){if("function"==typeof n.toJSON)return e(n.toJSON());if(i(n)){for(t="[",a=0;a<n.length;a++)t+=(a?", ":"")+e(n[a]);return t+"]"}if("[object Object]"===m.call(n)){for(r in s=[],n)n.hasOwnProperty(r)&&s.push(e(r)+": "+e(n[r]));return"{"+s.join(", ")+"}"}}return'"'+n.toString().replace(c,o)+'"'}}()}),amzn_aps_csm=amzn_aps_csm||{},amzn_aps_csm.log=function(e){try{-1!==window.location.href.indexOf("csm_debug_mode")&&window.console&&window.console.log(e)}catch(e){e.message&&amzn_aps_csm.errors.push(e.message)}},amzn_aps_csm.loadModules=function(e){var n,t,a;try{for(n=0;n<e.length;n++){if(t=e[n].name,a=e[n].params||[],window.performance&&window.performance.mark&&"function"==typeof window.performance.mark&&window.performance.mark("loadStart"+t),"[object Array]"!==Object.prototype.toString.call(a)&&amzn_aps_csm.log("Params passed in the amzn_aps_csm.loadModules methods must be an array"),amzn_aps_csm[t]){if(void 0===amzn_aps_csm[t].shortName)throw new amzn_aps_csm.invalidModuleException("Module shortName not defined for module "+t+". ");amzn_aps_csm[t].init.apply(amzn_aps_csm[t],a),amzn_aps_csm.log("Initiated "+t+" module")}else amzn_aps_csm.log("Undefined module "+t);window.performance&&window.performance.mark&&"function"==typeof window.performance.mark&&(window.performance.mark("loadEnd"+t),window.performance.measure("lt"+amzn_aps_csm[t].shortName,"loadStart"+t,"loadEnd"+t))}}catch(e){e.message&&amzn_aps_csm.errors.push(e.message)}},amzn_aps_csm.define=function(e){var n,t,a,s,r,o,m,i;try{for(n=function(e){return"string"==typeof e?amzn_aps_csm[e]:e},a=(t=Array.prototype.slice.call(arguments))[0],s=2<t.length?t[1]:[],r=t[t.length-1],o=[],m=0,i=s.length;m<i;m++)o.push(n(s[m]));amzn_aps_csm[a]=r.apply(r,o)}catch(e){e.message&&amzn_aps_csm.errors.push(e.message)}},amzn_aps_csm.invalidModuleException=function(e){this.value=e,this.message="does not conform to the expected format of a module",this.toString=function(){return this.value+this.message}},amzn_aps_csm=amzn_aps_csm||{},amzn_aps_csm.define("eventUtils",[],function(){var s={shortName:"eu",init:function(){amzn_aps_csm.log("Initializing eventUtils"),s.eventHandlers=[]},addEvent:function(e,n,t,a){e.addEventListener?e.addEventListener(n,t,a):e.attachEvent&&e.attachEvent("on"+n,t),s.eventHandlers.push({elem:e,eventName:n,cb:t})},registerPostMessageHandler:function(n){var e=window.addEventListener?"addEventListener":"attachEvent";(0,window[e])("attachEvent"==e?"onmessage":"message",function(e){n(e)},!1)}};return s}),amzn_aps_csm=amzn_aps_csm||{},amzn_aps_csm.define("pixelQueue",[],function(){var e={shortName:"pq",init:function(){},firePixel:function(e,n,t){if(""!==n){"/"!=(n=!1===/^https?:\/\//.test(n)?document.location.protocol+"//"+n:n).substr(n.length-1)&&(n+="/"),"https:"===document.location.protocol&&!0===/^http:\/\//.test(n)&&(n=n.replace("http://","https://"));try{var a=JSON.parse(e);a.ver=amzn_aps_csm.version,e=JSON.stringify(a)}catch(e){}void 0!==t&&""!==t&&(n+=t),(new Image).src=n+e+"?cb="+Math.round(1e7*Math.random())}else amzn_aps_csm.log("instrURL is empty")}};return e}),amzn_aps_csm=amzn_aps_csm||{},function(){for(var e in amzn_aps_csm.loadModules([{name:"eventUtils",params:[]}]),amzn_aps_csm.eventUtils)amzn_aps_csm.eventUtils.hasOwnProperty(e)&&(amzn_aps_csm[e]=amzn_aps_csm.eventUtils[e]);amzn_aps_csm.loadModules([{name:"pixelQueue",params:[]}]),amzn_aps_csm.registerPostMessageHandler(function(e){var n,t,a,s,r,o,m,i,c;if(amzn_aps_csm.log("parent received message!: ",e.data),amzn_aps_csm.log(e.origin),/pixelId/.test(e.data)){for(n=e.source,t=0;n.parent!==top&&t<5;)n=n.parent,t++;for(a={},"object"==typeof apstag&&null!==apstag&&"function"==typeof apstag._getSlotIdToNameMapping&&null!==apstag._getSlotIdToNameMapping()&&(a=apstag._getSlotIdToNameMapping()),s="",r=document.getElementsByTagName("iframe"),o=0;o<r.length;o++)if(r[o].contentWindow===n){for(m=r[o].parentElement;i=m.id,m=m.parentElement,!1===a.hasOwnProperty(i)&&"body"!==m.tagName.toLowerCase(););s=a[i]||i}c=JSON.parse(e.data),e=decodeURIComponent(c.instrURL),c={sn:encodeURIComponent(s),pixelId:c.pixelId},/amazon-adsystem\.com/.test(e)&&amzn_aps_csm.pixelQueue.firePixel(JSON.stringify(c),e,"")}})}();
