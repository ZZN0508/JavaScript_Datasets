!function(){var e,o,a,n,r,s,i,l,c,t,p,d,h,u,_,g,y,m,v,f,T,b,M,C,S,L,k,B,E,w,D,I,P,x,A,R,O,H,V,N,F,Z,U,z,q,K,W,G,Q,j,J,Y,X,$,ee,te,ie,oe,ae,ne,re,se,le,pe,de,ce,he,ue,_e,ge,ye,me,ve,fe,Te,be,Me,Ce,Se,Le,ke,Be,Ee,we,De,Ie,Pe,xe,Ae;try{Ae={L_OverlayEntity_AddMyPlaces:"添加到收藏夹",L_OverlayEntity_SaveAsFavorite:"另存为收藏",L_OverlayEntity_SaveAs:"另存为...",L_OverlayEntity_Save:"保存...",L_OverlayEntity_MoveTo:"移至",L_AddNickNameOption:"添加昵称",L_AddNoteOption:"添加描述",L_EditNickNameOption:"编辑昵称",L_EditNoteOption:"编辑描述",L_DeleteEntityOption:"删除",L_EditEntityOption:"编辑",L_DeleteNickNameOption:"删除昵称",L_DeleteNoteOption:"删除描述",L_EditHomeWorkOption:"编辑",L_HideHomeWorkOption:"不在常规地图上显示",L_DisplayHomeWorkOption:"总是在地图上显示",L_OverlayEntity_AddPushpin:"添加标注",L_OverlayEntity_Directions:"路线",L_OverlayEntity_DirectionsTo:"路线目的地",L_OverlayEntity_DirectionsFrom:"路线出发地",L_OverlayEntity_AddToRoute:"添加到路线",L_OverlayEntity_AddToItineraries:"保存到{0}",L_OverlayEntity_MoveToDay:"移至",L_OverlayEntity_Nearby:"附近",L_OverlayEntity_OpenCard:"显示详情",L_OverlayEntity_OpenNewCard:"打开为新卡",L_TrafficScheduledConstruction_Text:"规划建筑",L_TrafficOtherNews_Text:"其他新闻",L_TrafficCongestion_Text:"拥堵",L_TrafficAccident_Text:"事故",L_TrafficDisabledVehicle_Text:"禁止通行的车辆",L_TrafficRoadHazard_Text:"危险道路",L_TrafficUnScheduledContruction_Text:"无规划建筑",L_TrafficPlannedEvent_Text:"计划的事件",L_TrafficMassTransit_Text:"交通事故",L_TrafficWeather_Text:"天气警报",L_TrafficMiscellaneous_Text:"其他",L_TrafficSeverityMinor_Text:"轻度",L_TrafficSeverityModerate_Text:"中度",L_TrafficSeveritySerious_Text:"严重",L_TrafficSeverityLowImpact_Text:"影响很小",L_TrafficPopupSeverity_Text:"严重程度:",L_TrafficPopupStartTime_Text:"开始时间:",L_TrafficPopupEstEndTime_Text:"预计结束时间:",L_TrafficPopupDescription_Text:"描述:",L_TrafficCurrentCameraImage_Text:"{0} 处的当前交通状况图像",L_TrafficPreviewCameraImage_Text:"{0} 处的交通状况图像的缩略图预览",L_TrafficRecentCamerasTitle:"近期监视的摄像机",L_TrafficPopularCamerasTitle:"常用摄像机",L_TrafficIncidentsTitle:"通知",L_TrafficLegendsTitle:"交通图例",L_TrafficLegendsHeavy:"拥堵",L_TrafficLegendsModerate:"中等",L_TrafficLegendsLight:"畅通",L_TrafficLegendsNoTraffic:"无交通流量",L_TrafficLegendsClosed:"道路已封闭",L_TrafficLegendsSlow:"慢",L_TrafficLegendsFast:"快",L_TrafficModuleMoreLink:"展开",L_TrafficModuleLessLink:"收起",L_TrafficBackButtonText:"返回到摘要",L_TrafficTaskTitle_Text:"交通",L_TrafficsZoomInNotification:"放大以查看更多摄像头",L_TrafficsNoCameraNotification:"抱歉，此区域没有摄像头",L_TrafficsToggleCameras:"相机",L_TrafficCameraDirectionNorth_Text:"摄像头朝北",L_TrafficCameraDirectionSouth_Text:"摄像头朝南",L_TrafficCameraDirectionEast_Text:"摄像头朝东",L_TrafficCameraDirectionWest_Text:"摄像头朝西",L_Traffic_Camera_Tip:"查看照相机：",L_InfoboxCloseToolTip_Text:"关闭",L_TrafficCameraDisclaimer_Text:"驾驶时切勿查看交通摄像头图片。法律规定，只要引擎运行，当事人就被视为正在驾驶车辆。",L_StreetsideNoCoverageInstructions_Text:"点击突出显示的道路可进入 Streetside。",L_NavBarLocateMeToolTip_Text:"定位我的位置",L_NavBarMapSwitcherToolTip_Text:"更改地图样式",L_NavBarRotateCCToolTip_Text:"向左旋转",L_NavBarRotateToolTip_Text:"重置方向",L_NavBarRotateCToolTip_Text:"向右旋转",L_NavBarStreetsideLabel_Text:"街景视图",L_NavBarTrafficLabel_Text:"交通",L_NavBarBirdseyeV2ExitTip_Text:"退出鸟瞰图",L_NavBarBirdseyeV2NotAvailableTip_PrimaryText:"除此之外无可用图像",L_NavBarBirdseyeV2NotAvailableTip_SecondaryText:"平移到其他覆盖区域",L_NavBarBirdseyeV2NotAvailableRotationTip_PrimaryText:"旋转不可用",L_NavBarZoomInToolTip_Text:"放大",L_NavBarZoomOutToolTip_Text:"缩小",L_NavBarCloseRadialMenuToolTip_Text:"关闭",L_NavBarOpenRadialMenuToolTip_Text:"查看鸟瞰图等...",L_StreetsideNoCoverageInMapView_Text:"Streetside 在此处不可用，请按 ESC 退出。",L_StreetsideMobileNoCoverageInMapView_Text:"Streetside 在此处不可用。",L_OverlayEntity_Streetside:"查看街景视图",L_OverlayEntity_BirdseyeV2:"查看俯视图",L_OverlayEntity_Zoom:"放大",L_ScaleBarKilometers_Text:"千米",L_ScaleBarMeters_Text:"米",L_ScaleBarMiles_Text:"英里",L_ScaleBarYards_Text:"码",L_ScaleBarFeet_Text:"英尺",L_LocateMe_ChangeSettings_Text:"手动更改我的位置设置",L_LocateMe_Error_Text_Approximate_Location:"无法检索到您的确切位置，但可能位于这一区域。",L_LocateMe_Error_Text_Setting:"无法检索到您的确切位置。这是您的默认位置设置。",L_StreetsideAutoEntryTooltip_Text:"单击蓝线可进入 Streetside。",L_CurrentMapTypeToolTip_Text:"当前地图类型: {mapStyle}",L_RadialMenuAerialButtonToolTip_Text:"航测图",L_RadialMenuAerialButtonDescription_Text:"从上向下看的详细视图",L_RadialMenuBirdseyeButtonToolTip_Text:"鸟瞰图",L_RadialMenuBirdseyeButtonDescription_Text:"更好角度的空中摄影",L_RadialMenuOrdnanceSurveyButtonToolTip_Text:"地形测量局",L_RadialMenuOrdnanceSurveyButtonDescription_Text:"户外生存地图(仅英国)",L_RadialMenuRoadButtonToolTip_Text:"道路",L_RadialMenuRoadButtonDescription_Text:"标准道路地图",L_RadialMenuStreetsideButtonToolTip_Text:"街景视图",L_RadialMenuStreetsideButtonDescription_Text:"平视考察",L_DropDownMenuLabelToggleButtonToolTip_Text:"标签",L_DropDownMenuLabelToggleButtonDescription_Text:"适用于航测图和鸟瞰图",L_OverlayEntity_AddAPushpin:"添加图钉控件",L_WalkingTime:"步行 {0} 分钟",L_NearbyParkingTitle:"{0} 附近的停车场",L_NearbyParkingError:"抱歉，附近没有找到停车场!",L_CameraImageErrorText:"此摄像头的原始数据当前不可用。请稍后重试。",L_OverlayEntity_Coordinates:"坐标",L_OverlayEntity_Copy_Coordinates:"复制",L_OverlayEntity_Copy_Succeeded:"已复制",L_OverlayEntity_ZoomOut:"缩小",L_OverlayEntity_Measure:"测量距离",L_GeochainWorldText:"世界",L_NavBarMapTypeSwitcherToolTip_Text:"切换到 {0}",L_NavBarTrafficToggleToolTip_TurnOn_Text:"打开流量",L_NavBarTrafficToggleToolTip_TurnOff_Text:"关闭流量",L_DropDownMenuLabelToggleButtonDescription_Text_AerialOnly:"鸟瞰图",L_DropDownMenuLabelToggleButtonDescription_Text_RoadAerial:"公路和卫星图",L_DropDownMenuLabelToggleButtonDescription_Text_RoadAerialBirdseye:"公路、卫星和鸟瞰图",L_NavBarOpenRadialMenuToolTip_NoBirdseye_text:"查看卫星图及更多信息...",L_RadialMenuLabelToggleToolTip_Text:"打开或关闭标签",L_RadialMenuLabelToggleDisabled_Text:"禁用",L_DraggableList_Keyboard_Drag_Start_Hint:"按 Enter 以选择当前行，然后使用向上箭头键和向下箭头键进行重新排序。再次按 Enter 可取消选择",L_DraggableList_Keyboard_Drag_Move_Hint:"使用向上和向下箭头键重新排序。按 Enter 取消选择。",L_DraggableList_Keyboard_Drag_Top_Error_Hint:"已处于顶部位置",L_DraggableList_Keyboard_Drag_Bottom_Error_Hint:"已处于底部位置",L_ZoomInButtonAriaLabel:"当前级别 {0}，放大",L_ZoomOutButtonAriaLabel:"当前级别 {0}，缩小",L_ZoomButtonAriaLabelDisabled:"已禁用",L_CameraCloseAriaLabel:"关闭摄像头弹出窗口",L_RadialMenuRoadDarkButtonToolTip_Text:"夜间",L_RadialMenuRoadDarkButtonDescription_Text:"夜间路线图",L_RadialMenuGrayscaleButtonToolTip_Text:"灰度",L_RadialMenuGrayscaleButtonDescription_Text:"灰度图",L_RadialMenuCanvasDarkButtonToolTip_Text:"深色画布",L_RadialMenuCanvasDarkButtonDescription_Text:"深色图",L_RadialMenuCanvasLightButtonToolTip_Text:"浅色画布",L_RadialMenuCanvasLightButtonDescription_Text:"浅色图",L_GeochainTitle_Text:"展开/折叠 Geochain",RadialMenuBirdseyeV2ButtonDescriptionText:"我们更新了鸟瞰图。{0}",RadialMenuBirdseyeV2ButtonAlternateText:"了解更多",L_NavVarBirdseyeV2TipClose:"关闭",RadialMenuTitle:"地图样式",L_TrafficRemoveAllRecentCamerasLink:"全部移除",L_TrafficRemoveRecentCameraToolTip_Text:"移除位于 {0} 的摄像头",MapsTimeSelect:"选择这个时间",CalendarEmptyDays:"这些日子在本月无效",CalendarNextMonth:"转到 {0}",TrafficCameraAriaLabel:"放大显示 {0} 的摄像头图像",TrafficCameraName:"{0} 处的交通摄像头",TrafficCameraToggleButtonAriaLabel:"显示交通摄像头切换按钮",SpinBoxHoursLabel:"小时",SpinBoxMinutesLabel:"分钟",SpinBoxAmPmLabel:"上午或下午",L_BaseListMapMobile_Toggle_List:"列表",L_BaseListMapMobile_Toggle_Map:"地图",L_MyPlacesButton_Label:"我的地点",ClickToSelect:"选中以选择",ClickToUnselect:"取消选中以取消选择",L_Search_This_Area_Label:"在此区域中搜索",LandmarkDealsMore_Text:"还有 {0} 个",L_TrafficDateTimeFormat:"{0} {1}",L_CmtButtonTooltip:"commutability entrance",SearchBoxSearchGhostText:"Search Bing Maps"},window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("MapDelay",Ae):window.$MicrosoftMaps8.ResourcesObject=Ae;var Re,Oe=window.$MicrosoftMaps8,He=Oe.Internal,Ve=He.TaskData=He.TaskData||{},Ne=Oe.Anchor,Fe=He.BadgeTemplateSelector,Ze=Oe.BasicMapAnimation,Ue=Oe.BasicTemplate,ze=Oe.BitmapImageTemplate,qe=(Oe.BirdseyeV2Crs,He.BirdsEyeV2DialogViewModel,He._BoundsAccumulator),Ke=Oe.BucketPrimitiveTemplateSelector,We=(Oe.ChangeMagnitude,He._Color,He.CommutabilityControl,He._ComponentNames),Ge=He.Control,Qe=He.ControlTemplate,je=Oe.CoreMap,Je=He._BaseMapTemplateSelector,Ye=Oe.Internal._Debug,Xe=(Oe.DefaultTemplateSelector,He.DelayLoadedObject),$e=Oe.GlobalConfig.features.directions,et=He._EntityHelper,tt=He._MapAuthentication,it=He._EntryPoints,ot=He._ExternalPromise,at=He._FeatureNames,nt=Oe.GlobalConfig,rt=He._Gimme,st=He._Helper,lt=Oe.ImageryMapLayer,pt=Oe.Infobox,dt=He._JSEvent,ct=(He._LandmarksDataSource,He._LatLonCrs),ht=Oe.LocationRect,ut=He._LocalStorageCache,_t=He._LoggerConstants,gt=He._LruCache,yt=He.MapHelper,mt=Oe.MapMath,vt=nt.features.mapDelay,ft=Oe.MapTypeId,Tt=(He._MercatorTileId,He._MercatorTileUtility,Oe.MapView),bt=Oe.Location,Mt=Oe.NavigationBarMode,Ct=Oe.NavigationBarOrientation,St=He._Network,Lt=He._ObjectWithId,kt=(He._Observable,He._ObservableCollection),Bt=He._ObservableObject,Et=He.OrderedDictionary,wt=He._Overlay,Dt=He._PerfV2Logger,It=Oe.Point,Pt=Oe.Pushpin,xt=Oe.PrimitiveOverlayHelper,At=Oe.RasterImageryScene,Rt=(Oe.Rectangle,Oe.ResourceManager.MapDelay),Ot=Oe.Polygon,Ht=Oe.SimplePointPrimitive,Vt=(Oe.Size,He.StaticPromise,nt.features.streetside),Nt=nt.features.sharing,Ft=Oe.LabelVisibility,Zt=(Oe.TaskPrimitivesZOrderManager,nt.features.traffic,Oe.VectorImageTemplate),Ut=Oe.VectorMapLayer,zt=He._VectorMath,qt=(Oe.Viewport,Oe.ZoomLevel),Kt=Oe.ZoomAroundLocationAnimator,Wt='<div class="{TemplateBinding isCollapsed Converter=boolToContainerCollapsedClass }" data-tag="geochainContainer" style:display="{TemplateBinding isVisible Converter=boolToDisplay}">    <a class="{TemplateBinding isCollapsed Converter=boolToCollapsedClass }" href="#" role="button" data-tag="geochainCollapse" title="{TemplateBinding resources.L_GeochainTitle_Text}" aria-expanded="{TemplateBinding isCollapsed Converter=boolToExpandedString}" event:click="onCollapseClick" event:focus="onFocus" event:mousedown="stopEvent" event:mouseup="stopEvent" event:touchdown="stopEvent" event:touchup="stopEvent" event:touchend="onCollapseClick" event:contextmenu="stopEvent" />    <span style:display="{TemplateBinding isCollapsed Converter=boolToCollpased}" data-tag="geochainSegmentContainer">        <ItemsControl ItemsSource="{TemplateBinding geochainSegments}" panelTagName="span">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <a class="geochainSegment" data-index="{Binding index}" data-tag="geochainSegment" event:click="onSegmentClick" event:mousedown="stopEvent" event:mouseup="stopEvent" event:touchdown="stopEvent" event:touchup="stopEvent" event:touchend="stopEvent" event:contextmenu="stopEvent">                        <TextBlock Text=\'{Binding displayName}\' />                    </a>                </DataTemplate>            </ItemsControl.ItemTemplate>        </ItemsControl>        <span style:display="{TemplateBinding isLastLocationVisible Converter=boolToDisplay}" data-tag="geochainLastLocationContainer">            <a class="geochainActionButton geochainLastLocation" data-tag="geochainLastLocation" event:click="onLastLocationClick" event:mousedown="stopEvent" event:mouseup="stopEvent" event:touchdown="stopEvent" event:touchup="stopEvent" event:touchend="stopEvent" event:contextmenu="stopEvent" />        </span>    </span></div>',Gt='<div class="infoboxOverlay transitLandmarksToolTip">    <div class="overlayStopName">        <TextBlock Text="{StaticBinding stopName}" />    </div>    <div class="sectionSeparator" data-tag="sectionSeparator"></div>    <div class="overlayRoutesList">        <div class="{StaticBinding showLongList Converter=addNewLines}">            <TextBlock Text="{StaticBinding routeList}" />        </div>    </div></div>',Qt=this&&this.__extends||(xe=function(e,t){return(xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}xe(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),jt=(Qt(Ha,Pe=function(e){this._receiver=e}),Ha.prototype.dispose=function(){this._targetElement&&(this._targetElement.remove_event("click",this._clickHandler).remove_event("keydown",this._keyDownHandler).remove_event("keyup",this._keyUpHandler),this._targetElement=null,this._clickHandler=null,this._keyDownHandler=null,this._keyUpHandler=null),this._bindInteractionEventsHandler&&this._bindInteractionEventsHandler.dispose()},Ha.prototype._bindInteractionEvents=function(){var t=this;this._clickHandler=function(e){return t._onClick(e)},this._keyDownHandler=function(e){return t._onKeyDown(e)},this._keyUpHandler=function(e){return t._onKeyUp(e)},this._targetElement&&this._targetElement.add_event("click",this._clickHandler).add_event("keydown",this._keyDownHandler).add_event("keyup",this._keyUpHandler)},Ha.prototype._setTargetElement=function(e){this._targetElement=e.getRootElement().select(".ms-composite")},Ha.prototype._onClick=function(){var e=rt(window).get_scroll_pos();this._targetElement[0].focus(),nt.isSDK&&window.scrollTo(e.x,e.y)},Ha.prototype._onKeyDown=function(e){var t={timestamp:Date.now(),element:e.target,keyCode:e.keyCode,originalArgs:e};this._receiver.onKeyDown(t)&&e.preventDefault&&e.preventDefault()},Ha.prototype._onKeyUp=function(e){var t={timestamp:Date.now(),element:e.target,keyCode:e.keyCode,originalArgs:e};this._receiver.onKeyUp(t)&&e.preventDefault&&e.preventDefault()},Ha),Jt=(Qt(Oa,Ie=function(e){this.receiver=e}),Oa.prototype.dispose=function(){for(var e in this._registeredJsEvents)st._undefineJSEventForDomEvent(this._rootElement,e,this._registeredJsEvents[e].id),this._registeredJsEvents[e].dispose();st._nullifyClass(this)},Oa.prototype._addLocationToEvent=function(e,t){var i,o=this;Ye.assertNotNull(e,"args"),Ye.assertNotNull(t,"original");var a=e.point,n=this._map.getMode(),n=n&&a&&n.tryPointToLocation(a);switch(n&&(e.location=n),e.primitive=t.primitive,e.hitTarget=t.hitTarget,e.layer=t.layer,i={pointerType:2,identifier:"m",timestamp:Date.now(),element:t.target,button:Oa._getButtonProperty(t),buttonsState:Oa._getButtonsStateProperty(t),point:a,location:n,primitive:t.primitive,hitTarget:t.hitTarget,layer:t.layer,exclusiveHitTest:t.exclusiveHitTest,wheelDelta:e.wheelDelta,originalArgs:t},t.type){case"mouseup":this.receiver.onPointerReleased(i);break;case"mousedown":this.receiver.onPointerPressed(i);break;case"mousemove":this.receiver.onPointerMoved([i]);break;case"mouseenter":case"mouseover":this.receiver.onPointerEntered(i);break;case"mouseleave":case"mouseout":this.receiver.onPointerExited(i);break;case"mousewheel":case"DOMMouseScroll":this.receiver.onPointerWheelChanged(i);break;case"contextmenu":this.receiver.onContextMenuInvoked(i);break;case"touchstart":this._callPointerFunctionForTouchEvents(function(e){o.receiver.onPointerPressed(e)},i,t);break;case"touchend":this._callPointerFunctionForTouchEvents(function(e){o.receiver.onPointerReleased(e)},i,t);break;case"touchmove":this._callPointerFunctionForTouchEvents(function(e){o.receiver.onPointerMoved(e)},i,t);break;case"touchcancel":this._callPointerFunctionForTouchEvents(function(e){o.receiver.onPointerCanceled(e)},i,t);break;case"pointerdown":case"MSPointerDown":t.preventDefault(),this._callPointerFunctionForMsPointerEvent(function(e){o.receiver.onPointerPressed(e)},i,t);break;case"pointerup":case"MSPointerUp":this._callPointerFunctionForMsPointerEvent(function(e){o.receiver.onPointerReleased(e)},i,t);break;case"pointermove":case"MSPointerMove":this._callPointerFunctionForMsPointerEvent(function(e){o.receiver.onPointerMoved([e])},i,t);break;case"pointercancel":case"MSPointerCancel":this._callPointerFunctionForMsPointerEvent(function(e){o.receiver.onPointerCanceled(e)},i,t)}e.preventDefault&&e.preventDefault()},Oa.prototype._callPointerFunctionForTouchEvents=function(e,t,i){var o,a,n=i.changedTouches;if(0<n.length){for(o=[],a=0;a<n.length;a++){var r=n[a],s=rt(t.element&&t.element.parentElement).get_absolute_pos(),l=new It(r.pageX-s.x,r.pageY-s.y),s=this._map.getMode().tryPointToLocation(l),r={pointerType:4,identifier:"t"+r.identifier,timestamp:t.timestamp,element:t.element,button:1,point:l,location:s,primitive:r.primitive,layer:r.layer,exclusiveHitTest:r.exclusiveHitTest,originalArgs:i};"touchmove"!==i.type?e(r):o.push(r)}"touchmove"===i.type&&e(o)}},Oa.prototype._callPointerFunctionForMsPointerEvent=function(e,t,i){var o,a,n=rt(t.element&&t.element.parentElement).get_absolute_pos(),r=new It(i.pageX-n.x,i.pageY-n.y),n=this._map.getMode().tryPointToLocation(r);switch(i.pointerType){case"touch":case 2:o=4,a="t";break;case"pen":case 3:o=3,a="p";break;case"mouse":case 4:o=2,a="m";break;default:o=1,a="u"}t.pointerType=o,t.identifier=a+i.pointerId,t.point=r,t.location=n,e(t)},Oa._getButtonProperty=function(e){var t;switch(e.button){case 0:t=1;break;case 1:t=4;break;case 2:t=2;break;case 3:t=8;break;case 4:t=16;break;case 5:t=32;break;default:t=0}return t},Oa._getButtonsStateProperty=function(e){var t=0,i=rt.Browser,o=e.type,a=e.originalWhich,n=e.originalButtons||e.buttons;return"number"==typeof n?i.is_ie&&-1!=i.ie_version&&i.ie_version<10&&"mousemove"===o||(t=n):i.is_webkit&&("mousemove"===o?1===a?t=1:3===a&&(t=2):"mousedown"===o?t=Oa._getButtonProperty(e):"mouseup"===o&&(t=0)),t},Oa),Yt=(Ra.populatePostCodeLayer=function(e,t,i,o,a){var n=e instanceof je?e:e.getV8Map();n.getCityPolygonManager().then(function(e){e.selectorReady().then(function(){e._populatePostCodeToLayer(n,t,i,function(e){o(e)},a)})})},Ra.handlePostCodePrimitiveHover=function(e,t){var i,o,a="mouseover"===e.eventName,n=e.layer,r=e.primitive;3!==r.geometryType||t?1===r.geometryType&&((o=(i=r.metadata)&&i.polygon)?Ra.handlePostCodePrimitiveHover({eventName:e.eventName,layer:e.layer,primitive:o}):(!(0<=n.getPrimitives().indexOf(r))&&a?(i.primitiveShownOnHover=!0,n.add(r)):!a&&i.primitiveShownOnHover&&(delete i.primitiveShownOnHover,n.remove(r)),r.setState(a?3:2))):((i=r.metadata)&&i.labelPushpin&&((o=i.labelPushpin).entity&&(o.entity.collisionBehavior=a?1:0),!(0<=n.getPrimitives().indexOf(o))&&a?(i.labelShownOnHover=!0,n.add(o)):!a&&i.labelShownOnHover&&(delete i.labelShownOnHover,n.remove(o)),o.setState(a?3:2),o.changed.invoke()),a?(n.bringToTop(r),r.viewState=1):r.viewState=0)},Ra.bindPostCodeLayerHandlers=function(i,e){function p(e){Ra.handlePostCodePrimitiveHover(e,!0)}var d=e instanceof je?e:e.getV8Map(),c=Ra.handlePostCodePrimitiveHover;i.primitiveHoverStarted.isHandlerRegistered(c)||i.primitiveHoverStopped.isHandlerRegistered(c)||(e=d.viewChanged.add(function(){var e=d.getConfig(),o=e.postCodeMinLabelZoom,a=e.postCodeMinPushpinZoom,t=e.postCodeMaxHoverClickZoom,n=d.getMercatorZoomLevel(),r=i.getPrimitives(),s=[],l=[];r.forEach(function(e){var t,i=e.metadata;o<=n?(t=i.labelPushpin,3===e.geometryType&&r.indexOf(t)<0&&s.push(t)):1===e.geometryType&&i&&i.polygon&&l.push(e),n<a&&1===e.geometryType&&i&&!i.polygon&&l.push(e)}),a<=n&&((e=i.metadata&&i.metadata.pushpinPostCodes)&&e.forEach(function(e){r.indexOf(e)<0&&s.push(e)})),i.add(s),l.forEach(function(e){return i.remove(e)}),t<n&&i.primitiveHoverStarted.isHandlerRegistered(c)?(i.primitiveHoverStarted.remove(c),Ra._clearPrimitiveHoverStatus(i),i.primitiveHoverStarted.add(p)):n<=t&&!i.primitiveHoverStarted.isHandlerRegistered(c)&&(i.primitiveHoverStarted.remove(p),i.primitiveHoverStarted.add(c))}),i.addToDisposables(e),i.primitiveHoverStarted.add(c),i.primitiveHoverStopped.add(c))},Ra.prototype.addLayer=function(e,t,i,o){var a=this;this._layer&&this.removeLayer(),this._vdpId=e,this._cityPolygons=null,this._minZoomLevel=t,this._maxZoomLevel=i,this._geoEntityApiHasData=!o,this._geoEntityApiHasData?(this._noBoundaryData=!1,this._container.instanceAsync("GeoDataAPIManager",function(){a._layer=new Ut(a._coreConfig.cityPolygonVectorLayerId+Ra._cityPolygonCount,a,a,a._coreConfig.landmarksLayerZIndex),a._initializeLayer()})):(e=this._coreConfig.cityPolygonUrlFormat.replace("{entityId}",e.toString()),this._landmarksDataSource?(this._landmarksDataSource.updateZoom(t,i),this._initializeLandmarkDatasource()):this._container.instanceAsync("LandmarksDataSource",function(e){a._landmarksDataSource=e,a._initializeLandmarkDatasource()},{vectorTileUrlFormat:e,landmarksMinZoom:t,landmarksMaxZoom:i,landmarksVectorLayerId:this._coreConfig.cityPolygonVectorLayerId,landmarksDataSourceLayersOfInterest:this._coreConfig.cityPolygonDataSourceLayersOfInterest,jsonsoSuffix:this._coreConfig.cityPolygonVectorLayerId}))},Ra.prototype.getPrimitives=function(e,t){var i=this;this._noBoundaryData?this._displayFallbackPois(t):this._geoEntityApiHasData?this._cityPolygons?0<this._cityPolygons.length?t&&t({primitives:this._cityPolygons}):this._displayFallbackPois(t):tt.instance.authenticateClientAndRetrieveSessionId(function(e){Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getEntityDetails(i._vdpId,{lod:1,getEntityMetadata:!1,entityType:null},e,function(e){e.hasGeoPoliticalIssues?i._displayFallbackPois(t):e.results&&0<e.results.length&&e.results[0]?(i._cityPolygons=e.results[0].Polygons,i._completePolygonsBound=ht.fromShapes(i._cityPolygons),i._cityPolygons.forEach(function(e){e.bucket=Je.cityPolygonBucket,e.viewState=2}),e=i._map.getMercatorZoomLevel(),i._minZoomLevel=Math.min(e,i._minZoomLevel),i._validateZoomLevel(),i._noBoundaryData?i._displayFallbackPois(t):t&&t({primitives:i._cityPolygons})):i._geoEntityApiHasData&&(i.removeLayer(),i.addLayer(i._vdpId,i._minZoomLevel,i._maxZoomLevel,!0))},null,function(){i._displayFallbackPois(t)})}):this._dataSource.getPrimitives(e,function(e){i._noBoundaryData?i._displayFallbackPois(t):t&&t(e)})},Ra.prototype.removeLayer=function(){this._layer&&(this._dataSource=null,this._map.getLayers().remove(this._layer),this._layer.dispose(),this._layer=null,this._noBoundaryData=!1)},Ra.prototype.selectorReady=function(){var t=this;return!this._baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(e){return t._baseMapTemplateSelector=e,t._resetTemplateSelector=!1,t._baseMapTemplateSelector.selectorReady()}):this._baseMapTemplateSelector.selectorReady()},Ra.prototype.getTemplates=function(e,t,i){var o,a,n=e,r=null;if(n instanceof Ht)o=this._map.getMercatorZoomLevel(),r=this._baseMapTemplateSelector.getPoiVectorImageTemplate(null,4,o,1,!1,null);else{switch(o=n.taskDisplayState&&n.taskDisplayState.colorIndex||yt._getColorMapping(Ra._defaultTaskColorIndex),a=2,n.viewState){case 1:a=3;break;case 2:a=4}r=this._baseMapTemplateSelector.getCityPolygonTemplates(e.bucket,o,a,t,i)}return r},Ra.prototype.dispose=function(){this._cityPolygons=null,this._landmarksDataSource=null,this.removeLayer(),st._clearDisposables(this._disposables)},Ra.prototype._displayFallbackPois=function(e){this._fallbackPrimitive?e&&e({primitives:[this._fallbackPrimitive]}):e&&e({primitives:[]})},Ra.prototype._initializeLandmarkDatasource=function(){this._dataSource=this._landmarksDataSource.getLayerDataSource(this._coreConfig.cityPolygonVectorLayerId),this.spatialIndex=this._dataSource.spatialIndex,this._layer=new Ut(this._coreConfig.cityPolygonVectorLayerId+Ra._cityPolygonCount,this,this,this._coreConfig.landmarksLayerZIndex),this._initializeLayer()},Ra.prototype._initializeLayer=function(){var e,t=this;Ra._cityPolygonCount++,this._layer.setVisible(!0),this._map.getLayers().insert(this._layer),this._layer.setRenderTarget(2),this._disposables.push(this._layer.getFrameManager().dataLoaded.add(function(e){return t._onDataLoaded(e)})),this._disposables.push(this._layer.getFrameManager().frameSet.add(function(e){return t._onFrameSet(e)})),this._disposables.push(this._map.mapZoomStopped.add(function(e){return t._processZoomStopped(e)})),(e=this._map.getMapOptions()).center&&e.entityName&&(this._fallbackPrimitive=new Ht(e.center,{id:this._vdpId.toString(),title:e.entityName,collisionBehavior:2}),nt.isMapsAnswer&&(this._fallbackPrimitive.entity.title=null),this._fallbackPrimitive.layer=this._layer,this._fallbackPrimitive.bucket=Je.bucketIdForPoi)},Ra.prototype._onDataLoaded=function(){var e,t,i,o;if(!this._noBoundaryData&&this._layer){if(e=this._layer.getFrameManager().getFrameData().getPrimitives(2,!1))for(t=0,i=e.length;t<i;t++)if((o=e[t]).geometry&&(2===o.geometryType||o.geometry.rings&&0<o.geometry.rings.length))return;this._noBoundaryData=!0,this.invalidated.invoke()}},Ra.prototype._onFrameSet=function(){this._validateZoomLevel()},Ra.prototype._processZoomStopped=function(){this._validateZoomLevel(),this.invalidated.invoke()},Ra.prototype._validateZoomLevel=function(){var e,t,i,o=this._map.getMercatorZoomLevel();o>=this._minZoomLevel&&o<=this._maxZoomLevel?(this._noBoundaryData=!1,this._completePolygonsBound&&this._geoEntityApiHasData&&(i=this._map.getMode())&&(t=i.tryLocationToPoint(this._completePolygonsBound.getNorthwest()),e=i.tryLocationToPoint(this._completePolygonsBound.getSoutheast()),i=Math.abs(e.x-t.x),t=Math.abs(e.y-t.y),i/(i=this._map.getViewport()).pixelWidth<Ra._minPolygonWidthHeightRatio&&t/i.pixelHeight<Ra._minPolygonWidthHeightRatio&&(this._noBoundaryData=!0))):o<this._minZoomLevel&&(this._noBoundaryData=!0)},Ra.prototype._populatePostCodeToLayer=function(c,a,n,h,u){var _=this,e=c instanceof je?c:c.getV8Map(),g=e.getMercatorZoomLevel(),e=e.getConfig(),y=e.postCodeMinLabelZoom,m=e.postCodeMinPushpinZoom;Microsoft.Maps.loadModule(["Microsoft.Maps.SpatialDataService","Microsoft.Maps.SpatialMath","Microsoft.Maps.Search"],function(){var r,t,i=n.length,o=0,s=[],l=[],p=new Microsoft.Maps.Search.SearchManager(c),d=c.getBounds();d.buffer(1),r=function(){var e;i<=++o&&(a&&(a.add(s),m<=g&&a.add(l),a.metadata={pushpinPostCodes:l},Ra.bindPostCodeLayerHandlers(a,c)),e=u||m<=g?s.concat(l):s,h&&h(e))},t=function(t){var e,i,o,a,n;t.results&&0<t.results.length&&t.results[0].Name?(e=t.results[0].Name.EntityName)===t.location?(o=null,1<=(i=t.results[0].Polygons).length&&(a=[],i.forEach(function(e){return a.push(e.getLocations())}),o=new Ot(a)),o&&(_._populatePostCodePolygon(o,e,c),s.push(o),(n=o.metadata&&o.metadata.labelPushpin)&&y<=g&&s.push(n)),r()):(n={where:t.location,bounds:d,callback:function(e){_._processPointPostCodeResponse(l,e,t.location),r()},errorCallback:r},p.geocode(n)):r()},tt.instance.authenticateClientAndRetrieveSessionId(function(e){Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getBoundary(n,{entityType:"Postcode1",getAllPolygons:!0},c instanceof je?e:c,t,null,r)})})},Ra.prototype._processPointPostCodeResponse=function(e,t,i){var o,a,n,r,s,l;t.results&&0<t.results.length&&t.results[0].location&&(o=Ra._postCodeThemeColor.replace("{a}","1"),a=t.results[0].location,(l=e.filter(function(e){e=e.getLocation();return bt.areEqual(a,e,!0,1e-6)}))&&0<l.length?(r=(n=l[0]).metadata,s=n.getTitle(),t=r.title+","+i,l=s.split(",").length,n.setOptions({title:3===l?s+",...":4===l?s:t}),r.title=t):((o=new Pt(a,{title:i,color:o})).metadata={title:i},e.push(o)))},Ra._clearPrimitiveHoverStatus=function(e){for(var t,i=e.getPrimitives(),o=0,a=i.length;o<a;o++)if(1===(t=i[o]).viewState){3===t.geometryType&&(t.viewState=0,(t=(t=t.metadata)&&t.labelPushpin)&&t.setState(2));break}},Ra.prototype._populatePostCodePolygon=function(e,t){var i,o=this;e.metadata={title:t},e.viewState=0,e.bucket=Je.xsrPolygonBucketId,e.getTemplates=function(){return o.getTemplates(e,1,1)},i=Microsoft.Maps.SpatialMath.Geometry.centroid(e),(i=new Microsoft.Maps.Pushpin(i,{title:t,icon:"<svg xmlns='http://www.w3.org/2000/svg' width='1' height='1'></svg>",anchor:new It(0,12)})).entity.collisionBehavior=0,i.metadata={title:t,polygon:e},e.metadata.labelPushpin=i},Ra._defaultTaskColorIndex=3,Ra._postCodeThemeColor="rgba(90, 104, 108, {a})",Ra._cityPolygonCount=0,Ra._minPolygonWidthHeightRatio=.1,Ra),Xt=(Aa.taskDataHandlerKey="data-task",Aa.taskProcessDataHandlerKey="data-process",Aa.streetsideDataHandlerKey="data-streetside",Aa.instrumentationDataHandlerKey="data-instrumentation",Aa.callServerInstrumentationDataHandlerKey="data-serverInstrumentation",Aa.photosynthDataHandlerKey="data-photosynth",Aa.shareDataHandlerKey="data-share",Aa.printDataHandlerKey="data-print",Aa.layoutDataHandlerKey="data-layout",Aa.mapViewDataHandlerKey="data-mapview",Aa.birdsEyeV2DialogDataHandlerKey="data-birdseyeV2Dialog",Aa.layerManagerDataHandlerKey="data-managelayer",Aa),$t=(xa.prototype.getGeochain=function(t,e,i,o){var a,n,r=this;if(!(this._map&&(this._map.isDisposed()||nt.disableReverseGeocode)||(e=e||this._map.getMode().tryPointToLocation(yt.getViewportCenter(this._map)),i||(a=this._map.getBounds().bounds,i=ht.fromEdges(a[0],a[3],a[2],a[1])),this._lastCenterPoint&&this._lastBoundingRect&&bt.areEqual(this._lastCenterPoint,e,!0,1e-6)&&ht.areEqual(this._lastBoundingRect,i,1e-6)))){if(this._lastCenterPoint=e,this._lastBoundingRect=i,!o){for(n=0;n<this._currentGeochainRequestIds.length;n++)St.abortRequest(this._currentGeochainRequestIds[n]);this._currentGeochainRequestIds=[]}o?this._reverseGeocoder.reverseGeocodeWithNetworkId(e,function(e){r._geochainReverseGeocoderCallback(e,i,o,t)},Object.keys(xa._geochainEntityTypes),!0,1):this._currentGeochainRequestIds.push(this._reverseGeocoder.reverseGeocodeWithNetworkId(e,function(e){r._geochainReverseGeocoderCallback(e,i,o,t)},Object.keys(xa._geochainEntityTypes),!0,1))}},xa.prototype._getBoundingBox=function(t,i){tt.instance.authenticateClientAndRetrieveSessionId(function(e){e=vt.boundingBoxRequestUrlFormat.replace("{session_key}",e).replace("{culture}",nt.dynamicProperties.market).replace("{query}",t);St.downloadJsonp(e,"geochain",i,function(){},null,null,null,3)})},xa.prototype._geochainReverseGeocoderCallback=function(e,i,o,a){var n,t,r,s,l,p,d=this;if(o||(this._currentGeochainRequestIds=[]),e.success)if(n=this._parseReverseGeocoderResponse(e))for(t=this._generateBoundsQueries(n),r=t.length,0===t.length&&a(this._constructGeochainFromBounds(i,n)),s=0;s<t.length;s++)t[l=s].id&&!this._boundsCache.getItem(t[l].id)?(p=function(e,t){t&&t.authenticationResultCode===xa._validAuthenticationCode&&t.statusCode===xa._validStatusCode&&t.resourceSets&&0<t.resourceSets.length&&t.resourceSets[0].resources&&0<t.resourceSets[0].resources.length&&(t=t.resourceSets[0].resources[0],e&&t.bbox&&d._boundsCache.addItem(e,t.bbox)),0===--r&&(o||(d._currentGeochainRequestIds=[]),a(d._constructGeochainFromBounds(i,n)))}.bind(this,t[l].id),this._getBoundingBox(t[l].query,p)):0===--r&&(o||(this._currentGeochainRequestIds=[]),a(this._constructGeochainFromBounds(i,n)));else a([])},xa.prototype._parseReverseGeocoderResponse=function(e){var t,i,o,a,n=e.results?e.results.length:0;if(0==n)return null;for(t={},i=0;i<n;i++)if(a=e.results[i].address,"Neighborhood"!==e.results[i].entityType){t.country=a.countryRegion,t.countryEntityId=a.countryRegionEntityId,t.state=a.adminDistrict,t.stateEntityId=a.adminDistrictEntityId,t.county=a.adminDistrict2,t.countyEntityId=a.adminDistrict2EntityId,t.city=a.locality,t.cityEntityId=a.localityEntityId,t.street=a.addressLine,t.streetEntityId=a.addressLineEntityId;break}for(o=0;o<n;o++)if(a=e.results[o].address,"Neighborhood"===e.results[o].entityType){t.country=a.countryRegion,t.countryEntityId=a.countryRegionEntityId,t.state=a.adminDistrict,t.stateEntityId=a.adminDistrictEntityId,t.county=a.adminDistrict2,t.countyEntityId=a.adminDistrict2EntityId,t.neighborhood=a.neighborhood,t.neighborhoodEntityId=a.neighborhoodEntityId;break}return t},xa.prototype._generateBoundsQueries=function(e){var t=[],i="";return e.country&&(i+="&countryRegion="+e.country,t.push({query:i,id:e.countryEntityId}),e.state&&(i+="&adminDistrict="+e.state,t.push({query:i,id:e.stateEntityId}),e.county&&e.city&&(i+="&adminDistrict2="+e.county+"&locality="+e.city,t.push({query:i,id:e.cityEntityId})))),t},xa.prototype._constructGeochainFromBounds=function(e,t){var i,o,a,n=this._map.getMode(),n=n&&n.getMapViewForLocationsInView([e.getNorthwest(),e.getSoutheast()]),r=n&&qt.fromLocation(n.cameraLocation,!1),s=[];if("number"!=typeof r||isNaN(r))return s;for(r=Math.ceil(r),i=-1,o=0;o<xa._geochainLevels.length;o++){var l,p=null,d=t[(l=xa._geochainLevels[o])+"EntityId"];if(p=d?this._boundsCache.getItem(d):p){if(this._canFitViewport(p,e)){this._comparableToViewport(p,e)&&(i=o);break}i=o}else if(r<=(p=xa._geochainLevelZoomLimits[l])){if(p<r+2){i=o;break}}else i=o}for(a=0;a<=i;a++)t[l=xa._geochainLevels[a]]&&s.push(new c(t[l],t[l+"EntityId"],a));return s},xa.prototype._comparableToViewport=function(e,t){if(!e||!t)return!1;e=ht.fromEdges(e[2],e[1],e[0],e[3]),t=Math.min(t.width/4,t.height/4);return e.width>=t||e.height>=t},xa.prototype._canFitViewport=function(e,t){if(!e||!t)return!1;e=ht.fromEdges(e[2],e[1],e[0],e[3]);return!(e.width>t.width||e.height>t.height)},xa._validAuthenticationCode="ValidCredentials",xa._validStatusCode=200,xa._validStatusDescription="OK",xa._geochainEntityTypes={Neighborhood:"neighborhood",PopulatedPlace:"city",AdminDivision1:"state",AdminDivision2:"county",CountryRegion:"country"},xa._geochainLevels=["country","state","county","city","neighborhood"],xa._geochainLevelZoomLimits={country:4,state:7,county:10,city:13,neighborhood:15},xa),ei=(Pa.prototype.geocode=function(t,a,i,e,o,n){var r,s={success:!1,statusCode:null,authenticationResultCode:null,statusDescription:null,name:t,results:null};location||a(s),r=e&&e<=Pa._maxNumberOfResults?e:Pa._defaultResultCount,tt.instance.authenticateClientAndRetrieveSessionId(function(e){e=vt.geocodeRequestUrlFormat.replace("{session_key}",e).replace("{query}",encodeURIComponent(t)).replace("{culture}",nt.dynamicProperties.market).replace("{userMapView}",Pa._getBoundsString(i)).replace("{maxResults}",r).replace("{neighborhood}",o?"1":"0").replace("{incl}",n?"ciso2":"");St.downloadJsonp(e,"geocode",function(e){var t,i,o;if(e&&e.authenticationResultCode===Pa._validAuthenticationCode&&e.statusCode===Pa._validStatusCode&&e.statusDescription===Pa._validStatusDescription&&e.resourceSets&&0!==e.resourceSets.length){for(s.success=!0,s.statusCode=Pa._validStatusCode,s.authenticationResultCode=Pa._validAuthenticationCode,s.statusDescription=Pa._validStatusDescription,i=0,o=e.resourceSets.length;i<o;i++)if((t=e.resourceSets[i].resources)&&0!==t.length){s.results=t;break}s.traceId=e.traceId}else e?(s.statusCode=e.statusCode,s.authenticationResultCode=e.authenticationResultCode,s.statusDescription=e.statusDescription,s.errorMessage=e.errorDetails&&0<e.errorDetails.length&&e.errorDetails[0],s.traceId=e.traceId):(s.statusCode=400,s.authenticationResultCode="Unknown",s.statusDescription="Unknown");a(s)},function(){s.authenticationResultCode="Unknown",s.statusCode=404,s.statusDescription="Http Error",a(s)},null,null)})},Pa._getBoundsString=function(e){return e?e.getSouth()+","+e.getWest()+","+e.getNorth()+","+e.getEast():""},Pa._validAuthenticationCode="ValidCredentials",Pa._validStatusCode=200,Pa._validStatusDescription="OK",Pa._defaultResultCount=5,Pa._maxNumberOfResults=20,Pa),ti=(Ia.Invoke="IN",Ia),ii=(Da.prototype.GetCurrentPosition=function(t){var i,o=this;t&&t.callback&&(i={success:!1,statusCode:200,authenticationResultCode:"ValidCredentials",statusDescription:"OK",location:null,addressList:null,results:null,position:null,error:{code:4,message:"Unknown Error"}},this._window.navigator&&this._window.navigator.geolocation?this._fetchingPosition?(i.error.code=5,i.error.message="Try again later",t.callback(i)):(t.timeout=t.timeout||vt.geolocationTimeout,t.maximumAge=t.maximumAge||vt.geolocationMaxAge,t.enableHighAccuracy=!0,this._fetchingPosition=!0,this._window.navigator.geolocation.getCurrentPosition(function(e){i.success=!0,i.position=e,i.location=new bt(e.coords.latitude,e.coords.longitude,e.coords.altitude),i.error=null,o._fetchingPosition=!1,t.performReverseGeocoding?o._reverseGeocoder.reverseGeocode(i.location,function(e){i.addressList=e.success&&e.addressList?[e.addressList[0]]:[],t.callback(i)}):t.callback(i),o._logData(i)},function(e){i.error.code=e.code,i.error.message=e.message,o._fetchingPosition=!1,t.callback(i),o._logData(i)},t)):(i.error.code=6,i.error.message="Geolocation not supported by browser",t.callback(i)))},Da.prototype._logData=function(e){!this._hasLogged&&e&&(e={feature:at.LocateMe,action:ti.Invoke,data:Da._createLogData(e)},ai.invokeHandler(Xt.instrumentationDataHandlerKey,{logData:e}),this._hasLogged=!0)},Da._createLogData=function(e){var t,i=e.success,o="NaN,NaN",a=NaN,n=-1;return i&&e.position&&e.position.coords?(o=(t=e.position.coords).latitude+","+t.longitude,a=t.accuracy):n=e.error.code,{success:i,errorCode:n,clientIP:nt.dynamicProperties.clientIP,reverseIPLocation:nt.dynamicProperties.reverseIPLocation,geolocation:o,geolocationAccuracy:a}},Da);we=Re=Re||{},wa.registerDataHandler=function(t,e){return!(!t||!e||wa._attrDataHandlerList[t]||void 0!==nt&&!nt.isMapsVertical&&!nt.dynamicProperties.mapOverlayInSerpEnabled&&Xt.streetsideDataHandlerKey!==t&&Xt.instrumentationDataHandlerKey!==t)&&("string"==typeof e?wa._container?wa._container.instanceAsync(e,function(e){wa._attrDataHandlerList[t]=e},null):(i=wa._mapping[e])?i.push(t):(i=wa._mapping[e]=[t],wa._references.push({name:e})):wa._attrDataHandlerList[t]=e,!0);var i},wa.registerEventForDataAttribute=function(e,t,i){var o;return!(!e||!t)&&(0!==(o=rt(wa._topLevelTaskContainerSelector)).length&&(wa._eventAttributeList[e]||(wa._eventAttributeList[e]=[]),wa._eventAttributeList[e].push(t),wa._eventHandlers[e]=wa._eventHandlers[e]||st._defineJSEventForDomEvent(o,e,{argBuilder:function(e,t){e.target=t.target,e.type=t.type,e.preventDefault=i&&i.preventDefault&&function(){t.preventDefault()}}}).add(wa._eventHandler),!0))},wa.invokeHandler=function(e,t){var i=wa._attrDataHandlerList[e];i?i.processData(e,t):wa._mapping?wa._invokeHandlerQueue[e]=t:console.log("Invalid handler key : "+e)},wa._processEvent=function(e,t,i){for(var o,a,n,r,s=!1,l=!1;e&&e.length&&!e.get_attr(wa._topLevelTaskContainerAttributeName);){for(a in o=wa._getAttributeListForEvent(e,t))if(n=wa._attrDataHandlerList[a],n){try{r=rt.Internals.parseJSON(o[a]),n.processData(a,r,e,t),l=!0}catch(e){}s=!0}if(s||!i)return s&&l;e=e.parent()}return!1},wa._eventHandler=function(e){if(!e.target||!rt(e.target.parentElement).has_class("ms-composite")){var t=e.type,i=rt(e.target);return wa._processEvent(i,t,!0)&&e.preventDefault&&e.preventDefault(),!1}},wa._getAttributeListForEvent=function(e,t){for(var i,o=wa._eventAttributeList[t],a={},n=0,r=o.length;n<r;n++)(i=e.get_attr(o[n]))&&(a[o[n]]=i);return a},wa._references=[],wa._mapping={},wa._attrDataHandlerList={},wa._eventHandlers={},wa._eventAttributeList={},wa._invokeHandlerQueue={},wa._topLevelTaskContainerSelector="div[data-global]",wa._topLevelTaskContainerAttributeName="data-global",wa._container=null,De=wa,we.GlobalDataEventHandler_Old=De,Ee=Re=Re||{},Ea._reset=function(){var e,t;if(Ea._container){for(Ea._container=null,Ea._dataHandlers={},Ea._invokeHandlerQueue={},e=Object.keys(Ea._eventHandlers),t=0;t<e.length;t++)Ea._eventHandlers[e[t]].dispose();Ea._eventHandlers={}}},Ea.registerDataHandler=function(t,e){return!(!t||!e||Ea._dataHandlers[t]||void 0!==nt&&!nt.isMapsVertical&&!nt.dynamicProperties.mapOverlayInSerpEnabled&&Xt.streetsideDataHandlerKey!==t&&Xt.instrumentationDataHandlerKey!==t)&&("string"==typeof e?((Ea._dynamicDataHandlers[e]||(Ea._dynamicDataHandlers[e]=[])).push(t),Ea._container&&Ea._container.instanceAsync(e,function(e){Ea._dataHandlers[t]=e},null)):(Ea._staticDataHandlers[t]=e,Ea._dataHandlers[t]=e),!0)},Ea.registerEventForDataAttribute=function(e,t,i){return!(!e||!t)&&(Ea._eventAttributeData[e]={attrName:t,options:i},!Ea._container||Ea._registerEvent(e))},Ea._registerEvent=function(e){var t=rt(Ea._topLevelTaskContainerSelector),i=Ea._eventAttributeData[e],o=i.attrName,a=i.options;return 0!==t.length&&((i=Ea._eventAttributeList)[e]||(i[e]=[]),i[e].push(o),Ea._eventHandlers[e]=Ea._eventHandlers[e]||st._defineJSEventForDomEvent(t,e,{argBuilder:function(e,t){e.target=t.target,e.type=t.type,e.preventDefault=a&&a.preventDefault&&function(){t.preventDefault()}}}).add(Ea._eventHandler),!0)},Ea.invokeHandler=function(e,t){var i=Ea._dataHandlers[e];i?i.processData(e,t):Ea._invokeHandlerQueue[e]=t},Ea._processEvent=function(e,t,i){for(var o,a,n,r,s,l,p=!1,d=!1;e&&e.length&&!e.get_attr(Ea._topLevelTaskContainerAttributeName);){for(o=Ea._getAttributeListForEvent(e,t),a=Object.keys(o),n=0;n<a.length;n++)if(r=a[n],s=Ea._dataHandlers[r]){0;try{l=rt.Internals.parseJSON(o[r]),s.processData(r,l,e,t),d=!0}catch(e){}p=!0}if(p||!i)return p&&d;e=e.parent()}return!1},Ea._eventHandler=function(e){if(!e.target||!rt(e.target.parentElement).has_class("ms-composite")){var t=e.type,i=rt(e.target);return Ea._processEvent(i,t,!0)&&e.preventDefault&&e.preventDefault(),!1}},Ea._getAttributeListForEvent=function(e,t){for(var i,o=Ea._eventAttributeList[t],a={},n=0,r=o.length;n<r;n++)(i=e.get_attr(o[n]))&&(a[o[n]]=i);return a},Ea._dynamicDataHandlers={},Ea._staticDataHandlers={},Ea._dataHandlers={},Ea._eventAttributeData={},Ea._eventHandlers={},Ea._eventAttributeList={},Ea._invokeHandlerQueue={},Ea._topLevelTaskContainerSelector="div[data-global]",Ea._topLevelTaskContainerAttributeName="data-global",Ea._container=null,Ee.GlobalDataEventHandler=Ea;var oi,ai=vt.useNewGlobalDataEventHandler?Re.GlobalDataEventHandler:Re.GlobalDataEventHandler_Old,ni=(Ba.prototype.isAvailable=function(e,t,i,o){(e=!e&&o?o.panoramaInfo:e)instanceof ht?this._getClosestBubble(e,Vt.defaultNumberOfBubblesToRequest,t,i):e instanceof bt?(o=this._getBoundingBoxFromMapLocation(e,o),this._getClosestBubble(o,Vt.defaultNumberOfBubblesToRequest,t,i)):"number"==typeof e?this._getBubbleById(e,t,i):e&&"object"==typeof e&&e.id?t&&t(e,[e]):i&&i()},Ba.prototype._getBoundingBoxFromMapLocation=function(e,t){var i=t&&"number"==typeof t.panoramaLookupRadius&&0<t.panoramaLookupRadius?t.panoramaLookupRadius:(t=this._map.getMercatorZoomLevel(),i=Math.pow(2,Vt.maxZoomForSS-t),t=Vt.minLookupsMeters[t-17],isNaN(t)&&(t=Vt.minLookupsMeters[0]),Math.max(i,t)),i=2*mt.metersToDegrees(i);return new ht(e,i,i)},Ba.prototype._getClosestBubble=function(e,t,i,o){var a=this,o=this._bubbleSource.getBubbles(e,t,function(e){return a._handleGetBubblesResponse(e,i)},o);o&&this._handleGetBubblesResponse(o,i)},Ba.prototype._getBubbleById=function(e,t,i){var o=this,i=this._bubbleSource.getBubbleById(e,function(e){return o._handleGetBubblesResponse(e,t)},i);i&&this._handleGetBubblesResponse([i],t)},Ba.prototype._handleGetBubblesResponse=function(e,t){t&&t(e[0],e)},Ba),ri=(Qt(ka,Be=ni),ka.prototype.show=function(e,i){var o=this,t=i&&i.onErrorLoading;this.isAvailable(e,function(t){o._map.getContainer().instanceAsync(nt.isMapsVertical?"StreetsideMode":"SDKStreetsideMode",function(e){return o._prepStreetsideMode(e,t,new bt(t.la,t.lo),i)},{StreetsideModeBootstrapper:o})},t,i)},ka.prototype._prepStreetsideMode=function(t,i,o,a){var n=this,e=this._map.getMode();e&&!e._sivSize?(t.setPreviousMode(e),t.setPreviousMapType(this._map.getMapType()),this._prepAndStartStreetsideMode(t,i,o,a)):this._map.getContainer().instanceAsync("CompositeMapMode",function(e){t.setPreviousMode(e),t.setPreviousMapType(n._map.createMapType(ft.road)),n._prepAndStartStreetsideMode(t,i,o,a)})},ka.prototype._prepAndStartStreetsideMode=function(e,t,i,o){this._map.setMapType(this._map.createMapType(ft.streetside)),"number"!=typeof o.heading&&o.locationToLookAt&&(o.heading=mt.getAngleBetweenTwoLocations(new bt(t.la,t.lo),o.locationToLookAt)),e.setInitialBubble(t,o);var a=o&&o.onSuccessLoading;Vt.zoomInAnimationAllowed&&i&&o&&o.zoomIn?this._zoomInToStreetside(e,a,new bt(t.la,t.lo)):this._startStreetsideMode(e,a)},ka.prototype._zoomInToStreetside=function(t,i,o){var e,a=this;this._animating||(e=Vt.zoomInAnimationTargetZoomLevel-yt.getMercatorZoomLevel(this._map),this._animating=!0,this._animationStartTime=Date.now(),this._animationDuration=Math.ceil(Vt.zoomInAnimationMillisecondsPerZoomLevel*e),this._disposables.push(this._map.viewChanged.add(function(e){return a._onViewChanged(e,t,i,o)}))),window.requestAnimationFrame(function(){return a._zoomIn(t,i,o)})},ka.prototype._zoomIn=function(e,t,i){var o=this._getZoomAnimationValue();yt.zoomAroundLocation(this._map,i,o,!0)},ka.prototype._getZoomAnimationValue=function(){var e=Vt.zoomInAnimationTargetZoomLevel-yt.getMercatorZoomLevel(this._map),t=(Date.now()-this._animationStartTime)/(this._animationDuration/2),t=t<1?-e/2*(Math.sqrt(1-t*t)-1):(t-=2,e/2*(Math.sqrt(1-t*t)+1));return t},ka.prototype._startStreetsideMode=function(e,t){this._map.setMode(e),t&&t()},ka.prototype._onViewChanged=function(e,t,i,o){yt.getMercatorZoomLevel(this._map)>=Vt.zoomInAnimationTargetZoomLevel-ka._targetZoomLevelForAnimationEntryFudgeFactor?(this._animating=!1,this._disposables.pop().dispose(),this._startStreetsideMode(t,i)):this._zoomInToStreetside(t,i,o)},ka._targetZoomLevelForAnimationEntryFudgeFactor=.01,ka),si=(La.directionsTask="DirectionsTask",La.directionsFlipTask="DirectionsFlipTask",La.collectionsTask="CollectionsTask",La.localDetailsTask="LocalDetailsTask",La.localListingTask="LocalListingTask",La.hotelsListingTask="HotelsListingTask",La.houseListingTask="HouseListingTask",La.polygonListingTask="PolygonListingTask",La.restaurantsListingTask="RestaurantsListingTask",La.localSearchTask="LocalSearchTask",La.houseDetailsTask="HouseDetailsTask",La.hotelsDetailsTask="HotelsDetailsTask",La.restaurantDetailsTask="RestaurantDetailsTask",La.feedbackTask="FeedbackTask",La.transitStopTask="TransitStopTask",La.transitLineTask="TransitLineTask",La.trafficFlipTask="TrafficFlipTask",La.trafficTask="TrafficTask",La.nearbyParkingTask="NearbyParkingTask",La.nearbyTransitTask="NearbyTransitTask",La.polygonEntityDetailsTask="PolygonEntityDetailsTask",La.measureMap="MeasureMapTask",La.itineraryDetailsTask="ItineraryDetailsTask",La.itineraryListingsTask="ItineraryListingsTask",La.venueMapDirectoryTask="VenueMapTask",La);(ke=oi=oi||{})[ke.EC=0]="EC",ke[ke.GPL=1]="GPL",ke[ke.PSS=2]="PSS",ke[ke.EMC=3]="EMC",ke[ke.SEW=4]="SEW",ke[ke.FB=5]="FB",ke[ke.TW=6]="TW",ke[ke.GSL=7]="GSL";var li=(Sa.getShortenServiceUrl=function(e){return Nt.shorteningServiceUrl.replace("{path}",encodeURIComponent("~".concat("/",Nt.shellPath,"?",e))).replace("{hostname}",window.location.hostname)},Sa.prototype.getQueryParameters=function(e,i,o,a){var t,n,r,s,l=[],p=0;for(t in e)if(e.hasOwnProperty(t)){if(n=t,!this._featureToTaskMap.hasOwnProperty(n)){if(!this._taskToFeatureMap.hasOwnProperty(n))continue;n=this._taskToFeatureMap[n]}l.push({id:(p++).toString(),featureType:n,data:rt.Internals.stringify(e[t])})}(s={}).v=Nt.currentProtocolVersion.toString(),s.sV=Nt.currentSchemaVersion.toString(),this._referrerFormCodeRegex.lastIndex=0,(r=this._referrerFormCodeRegex.exec(window.location.search))&&1<r.length&&(s.form=r[1]),Ye.getFunctionalTestHooksEnabled()&&(s.testhooks="1"),Nt.enableLandingPageChanges&&(s[Nt.landingPageChangeParameter]="1"),r={queryParameters:s,onSuccess:function(e){var t;i&&(e=(t=JSON.parse(e))&&t.permalink,a&&(a.PSR=e?"pass":"fail",a.PL=t.permalink,Sa.instLog(oi.GPL,a)),e?i&&i(t):o&&o())},onError:function(){a&&(a.PSR="fail",Sa.instLog(oi.GPL,a)),o&&o()}},s="/"+Nt.serviceEndpoint,St.doPost(s,rt.Internals.stringify(l),r)},Sa.prototype.getGeneralPermalink=function(e,i,o,t,a){var n,r,s,l,p=this,d={},c=!1,h=null;e&&((r=e.getMode())&&(n="mode"+r.mapModeType,d[n]=r.getState()),h=r.mapModeType),r=[],s={EP:t||"",FN:[],PSR:"",PL:"",MM:this._getMapModeLoggingType(h)},this._taskManager&&(Nt.enableMultipleCardSharing?(1===this._sharingConfig.currentSchemaVersion?((l=this._taskManager.serialize(!0,this._sharingConfig.currentSchemaVersion,a)).buildBackwardCompatibleUrl=this._requestCompatibilityParams,d.taskFramework=l):2===this._sharingConfig.currentSchemaVersion&&((l=this._taskManager.serialize(!0,this._sharingConfig.currentSchemaVersion,a)).buildBackwardCompatibleUrl=this._requestCompatibilityParams,d.taskFramework={objectStoreId:this._permalinkEntities&&this._permalinkEntities[Sa.osidQueryParamName]?this._permalinkEntities[Sa.osidQueryParamName].partValue:"",data:rt.Internals.stringify(l)}),s.FN=[at.TaskManager],c=!0,new Wi(n&&d[n],l).createShareImage(function(e){e&&(d.shareImage={data:e}),p.getQueryParameters(d,function(e,t){p._onPermalinkCallSuccess(e,i,t)},function(e,t){p._onPermalinkCallFailure(o,e,t)},s)})):(l=this._taskManager.getFocusedStack())&&(l=l.getForegroundTask(),d[l.type]=l.serialize(),r.push(this._getFeatureLoggingCode(l.type)),s.FN=r)),2==h&&(s.FN=[at.Streetside]),c||this.getQueryParameters(d,function(e,t){p._onPermalinkCallSuccess(e,i,t)},function(e,t){p._onPermalinkCallFailure(o,e,t)},s)},Sa.prototype.setRequestCompatibilityParams=function(e){this._requestCompatibilityParams=e},Sa.prototype._onPermalinkCallSuccess=function(e,t,i){function o(e,t){var i=e[t];return i||(e[t]=i={isEnabled:!0}),i}var a,n,r,s,l;if(Nt.enableMultipleCardSharing){this._permalinkEntities={},this._queryConstants="",this._longLinkBase="";var p,d=this._taskManager.getStacks(),c=(this._taskManager.getFocusedStack(),e.permalink);if(c&&2==(a=c.split("?")).length){for(this._longLinkBase=a[0]+"?",n=a[1].split("&"),s=0;s<n.length;s++)if(r=n[s])if(0===r.indexOf("tsts")){if(!(p=d[parseInt(r.slice(4,r.indexOf("=")))]))continue;o(this._permalinkEntities,p.getForegroundTask().id).partValue=r}else 0===r.indexOf("tstt")?(p=d[parseInt(r.slice(4,r.indexOf("=")))],o(this._permalinkEntities,p.getForegroundTask().id).title=r):0===r.indexOf(Sa.osidQueryParamName)?o(this._permalinkEntities,Sa.osidQueryParamName).partValue=r.substring(r.indexOf("=")+1,r.length):0<r.length&&(this._queryConstants+="&"+n[s]);if(this._permalinkEntities[Sa.osidQueryParamName]){for(s=0,l=d.length;s<l;s++)o(this._permalinkEntities,d[s].getForegroundTask().id);this._currentLongLink=c,this._currentPermalinkEntitiesHash=this._getLinkEntitiesHash()}}}t&&t(e,i)},Sa.prototype._onPermalinkCallFailure=function(e,t,i){this._permalinkEntities=null,this._currentPermalinkEntitiesHash=null,this._currentShortLink=null,e&&e(t,i)},Sa.prototype._getParamValueFromUrl=function(e,t){var i,o,a,e=e.split("?");if(2==e.length)for(i=e[1].split("&"),o=0;o<i.length;o++)if((a=i[o])&&0===a.indexOf(t))return a.substring(a.indexOf("=")+1,a.length);return null},Sa.prototype.shorten=function(t,e,i,o){var a,n,r=this;null==this._permalinkEntities&&e&&e("initial permalink hasn't been requested yet."),null==this._currentShortLink||this._currentShortlinkEntitiesHash!=this._getLinkEntitiesHash()||i||o?(a=this._constructCurrentQueryParams(i),o&&-1!=a.toLowerCase().indexOf("form=")&&(a=a.replace(/(form=).*?(&|$)/,"$1"+o+"$2")),(n=Sa.getShortenServiceUrl(a)).length>Sa.maxIeUrlLength&&(this._currentShortLink,this._currentShortlinkEntitiesHash=null,e()),St.downloadJson(n,"permalink",function(e){i||o||(r._currentShortLink=e.d,r._currentShortlinkEntitiesHash=r._getLinkEntitiesHash()),t&&t(e.d,r._longLinkBase+a)},function(){r._currentShortLink,r._currentShortlinkEntitiesHash=null,Sa.instLog(oi.SEW,{SL:n,ERR:6}),e&&e()}),Sa.instLog(oi.GSL,{SL:n})):t&&t(this._currentShortLink)},Sa.prototype.isShorteningAvailable=function(){if(null!==this._permalinkEntities&&Sa.getShortenServiceUrl(this._constructCurrentQueryParams()).length<=Sa.maxIeUrlLength)return!0;return!1},Sa.prototype.getPermalinkParts=function(){return this._permalinkEntities},Sa.prototype.getCurrentLink=function(e,t,i){var o,a,n,r,s,l=this;if(!this._permalinkEntities)throw new Error("initial permalink hasn't been requested yet.");if(2===this._sharingConfig.currentSchemaVersion&&this._currentPermalinkEntitiesHash!==this._getLinkEntitiesHash()){o={},e&&((a=e.getMode())&&(o["mode"+a.mapModeType]=a.getState()));var p=this._taskManager.getStacks(),d={focusedStackIndex:-1,stacks:[],isFocusedStackInCollapsedState:!1},c=this._taskManager.getFocusedStack(),h=void 0,u=p?p.length:0;for(1<u&&(!(e=p[u-1].getForegroundTask())||"CollectionsTask"!==e.type||e.isPublicCollection&&e.isPublicCollection()||(p[u-2].displayState.isHidden=!1,p[u-2].getForegroundTask().displayState.isHidden=!1,p[u-2].getForegroundTask().displayState.activationState=1)),n=0,r=p.length;n<r;n++)s=(h=p[n]).getForegroundTask().id,this._permalinkEntities[s].isEnabled&&(d.stacks.push(h.serialize(!0,this._sharingConfig.currentSchemaVersion)),h===c&&(d.focusedStackIndex=d.stacks.length-1));h&&(-1===d.focusedStackIndex&&(d.focusedStackIndex=d.stacks.length-1),o.taskFramework={objectStoreId:this._permalinkEntities&&this._permalinkEntities[Sa.osidQueryParamName]?this._permalinkEntities[Sa.osidQueryParamName].partValue:"",data:rt.Internals.stringify(d)},new Wi(a&&a.getState(),d).createShareImage(function(e){e&&(o.shareImage={data:e}),l.getQueryParameters(o,function(e){l._onUpdatePermalinkCallback(e,t)},function(){i&&i()})})),h||this.getQueryParameters(o,function(e){l._onUpdatePermalinkCallback(e,t)},function(){i&&i()})}else t(this._longLinkBase+this._constructCurrentQueryParams())},Sa.prototype._onUpdatePermalinkCallback=function(e,t){this._currentPermalinkEntitiesHash=this._getLinkEntitiesHash(),this._currentLongLink=e.permalink,this._permalinkEntities[Sa.osidQueryParamName]&&(this._permalinkEntities[Sa.osidQueryParamName].partValue=this._getParamValueFromUrl(this._currentLongLink,Sa.osidQueryParamName)),t&&t(e.permalink)},Sa.prototype._getLinkEntitiesHash=function(){for(var e="",t=0,i=Object.keys(this._permalinkEntities);t<i.length;t++)this._permalinkEntities[i[t]].isEnabled&&(e+=(""===e?"":"_")+i[t]);return e},Sa.prototype.getPrintParameters=function(){},Sa.prototype.processSharedStates=function(e){var t,i,o,a,n,r,s,l,p;if(e&&(!e||0!=e.length)){for(var d=[],c=[],h=!1,u=0,_=e.length;u<_;u++)if(i=e[u],this._featureToTaskMap.hasOwnProperty(i.featureType)&&"mode2"===this._featureToTaskMap[i.featureType]){h=!0;break}for(t=0,_=e.length;t<_;t++)i=e[t],(o=JSON.parse(i.data))&&(o.disableHistoryPointCreation=!0),h||(i.featureType===this._taskToFeatureMap[si.localDetailsTask]||i.featureType===this._taskToFeatureMap[si.localListingTask]?(this._taskBar&&o&&o.query&&this._taskBar.setSearchTerm(o.query),s=si.localSearchTask,a=!1,o&&(o.entryPoint=it.Permalink,n=i.featureType===this._taskToFeatureMap[si.localDetailsTask]?si.localDetailsTask:i.featureType===this._taskToFeatureMap[si.localListingTask]?si.localListingTask:si.localSearchTask,(r=st._overrideTasktypeBasedOnCategory(n,o))!==n&&(s=r,a=!0)),a?ai.invokeHandler(Xt.taskDataHandlerKey,{type:s,state:o}):ai.invokeHandler(Xt.taskProcessDataHandlerKey,{type:s,requestState:o})):this._featureToTaskMap.hasOwnProperty(i.featureType)&&(h||(i.featureType===this._taskToFeatureMap.taskFramework?(s=o,2==this._sharingConfig.readSchemaVersion&&s.data&&(s=rt.Internals.parseJSON(s.data)),this._taskManager.deserialize(s)):(i.featureType===this._taskToFeatureMap[si.directionsTask]&&(o.entryPoint=4),ai.invokeHandler(Xt.taskDataHandlerKey,{type:this._featureToTaskMap[i.featureType],state:o}))))),d.push(this._getFeatureLoggingCode(this._featureToTaskMap[i.featureType])),c.push(i.data||"");l=this._sharingConfig.formCode,this._referrerFormCodeRegex.lastIndex=0,(p=this._referrerFormCodeRegex.exec(window.location.search))&&1<p.length&&(l=p[1]),Sa.instLog(oi.PSS,{FN:d,PSD:c,RF:l})}},Sa.instLog=function(e,t){e={logData:{feature:at.Share,action:oi[e],data:t},isMapsAction:e!==oi.EC};ai.invokeHandler(Xt.instrumentationDataHandlerKey,e)},Sa.prototype._getFeatureLoggingCode=function(e){switch(e){case si.collectionsTask:return at.Collections;case si.directionsTask:return at.Directions;case si.localDetailsTask:case si.localListingTask:case si.localSearchTask:return at.Search;default:return""}},Sa.prototype._getMapModeLoggingType=function(e){switch(e){case 0:return"CM";case 1:return"OS";case 2:return"SS";default:return""}},Sa.prototype._constructCurrentQueryParams=function(e){var t,i,o,a="",n="",r="",s=null,l=Object.keys(this._permalinkEntities);if(this._permalinkEntities[Sa.osidQueryParamName])a+=(a.length?"&":"")+Sa.osidQueryParamName+"="+this._permalinkEntities[Sa.osidQueryParamName].partValue;else for(t=l.length-1;0<=t;t--)(i=this._permalinkEntities[l[t]]).isEnabled&&(a+="&"+i.partValue+(i.title?"&"+i.title:""),s=s||l[t]);var p=this._taskManager.getFocusedStack(),d=p&&p.getForegroundTask(),c=d&&this._permalinkEntities[d.id],p=null;switch(c&&c.isEnabled?p=c:s&&(p=this._permalinkEntities[s]),d=null,p&&p.partValue&&(2===(c=p.partValue.split("=")).length&&(d=/\d+/i.exec(c[0])[0],n=decodeURIComponent(decodeURIComponent(c[1]))),2===(c=p.title?p.title.split("="):c).length&&(r="&tt="+c[1])),d&&(this._queryConstants=this._queryConstants.replace(/ftst=\d+/i,"ftst="+d)),o=n+r,0<l.length&&(o+=a),o+=this._queryConstants,e){case 1:o=o.replace(/form=[a-z0-9]+/i,"form="+Sa.facebookFormCode);break;case 2:o=o.replace(/form=[a-z0-9]+/i,"form="+Sa.twitterFormCode)}return o},Sa.maxAllowedSharingLinkLength=(Sa.maxIeUrlLength=2083)-128,Sa.osidQueryParamName="osid",Sa.facebookFormCode="LMLTFB",Sa.twitterFormCode="LMLTTW",Sa),pi=(Ca.prototype.register=function(e,t){var i=this;if(!e||!t||this._serializableComponents[e])throw new Error("Invalid or Duplicate Key passed for registration: "+e);return(this._serializableComponents[e]=t).serializableObjectChanged.add(function(e){return i._raiseSerializationChanged(e)}),this._pageLoadStateDictionary&&this._pageLoadStateDictionary[e]&&t.deserialize(this._pageLoadStateDictionary[e]),!0},Ca.prototype.unregister=function(e){if(!e||!this._serializableComponents[e])throw new Error("Invalid key passed for registration: "+e);delete this._serializableComponents[e]},Ca.prototype.getHistoryState=function(){return this._history.getState()},Ca.prototype.doesLocalStorageStateExist=function(){var e,t=this._history.getLocalStorageState();if(!t)return!1;for(e in t)if(t.hasOwnProperty(e))return!0;return!1},Ca.prototype.processLocalStorageState=function(){var e=this._history.getLocalStorageState();e&&this._processStateChange(e)},Ca.prototype.clearLocalStorageState=function(){this._history.clearLocalStorageState()},Ca.prototype._raiseSerializationChanged=function(e){this._ignoreSerializationEvents||this._serializableObjectChanged.invoke(e)},Ca.prototype.setIsCapturing=function(e){this._ignoreSerializationEvents=!e},Ca.prototype.nextHistoryPointReplace=function(){this._nextHistoryPointReplace=!0},Ca.prototype.updateAddressBar=function(e,t){var i=this._window.location;this._currentUrlPath=e,e=i.toString().replace(i.pathname,e),this._historyUrl=e,this._isOnOverlay=st._isLargeMapShownOnSerp(),t&&this._history.replaceState(this._history.getState(),this._historyUrl)},Ca.prototype._processStateChange=function(e){var t,i;for(t in this._ignoreSerializationEvents=!0,this._pageLoadStateDictionary=null,this._reloadPageToHandleUrlChange(),e=e||{},this._serializableComponents)this._serializableComponents.hasOwnProperty(t)&&(i=e[t]||{},this._serializableComponents[t].deserialize(i));this._updateBrowserUrl(),this._ignoreSerializationEvents=!1},Ca.prototype._reloadPageToHandleUrlChange=function(){var e=this._window.location.toString();vt.enableUpdateUrlParams?this._currentUrlPath===this._window.location.pathname||this._isOnOverlay||this._window.location.reload():this._historyUrl===e||this._isOnOverlay||this._window.location.reload()},Ca.prototype._processObjectChange=function(e){var t,i,o;if(!st._isSmallMapShownOnSerp()&&!nt.dynamicProperties.mapsOverlayClosing||e&&e.clearHistory){for(i in this._pageLoadStateDictionary=null,t={},this._serializableComponents)o=this._serializableComponents.hasOwnProperty(i)&&this._serializableComponents[i].serialize(),o&&(t[i]=o);vt.enableUpdateUrlParams&&this._updateUrlWithTaskParams(),e&&e.clearHistory?this._history.clearState():e&&2===e.magnitude?this._nextHistoryPointReplace?(this._nextHistoryPointReplace=!1,this._history.replaceState(t,this._historyUrl)):this._history.pushState(t,this._historyUrl):this._history.replaceState(t,this._historyUrl),this._updateBrowserUrl()}},Ca.prototype._updateBrowserUrl=function(){vt.updateUrlDynamically&&this._requestPermalinkWithRetries({ts:Date.now(),isFullFilled:!1},0)},Ca.prototype._updateUrlWithTaskParams=function(){var e=this._serializableComponents.hasOwnProperty("TaskManager")&&this._serializableComponents.TaskManager;e&&((e=e.getFocusedStack())?(e=e.getTaskUrlParams(),this._historyUrl=this._window.location.origin+"/maps?"+e):this._historyUrl=this._window.location.origin+"/maps?",this._devParams&&(this._historyUrl+=this._devParams))},Ca.prototype._requestPermalinkWithRetries=function(t,e){var i=this;this._permalink&&(this._lastUrlUpdateRequestTS=t,this._permalink.getGeneralPermalink(this._map,function(e){t.ts<i._lastUrlUpdateRequestTS.ts&&i._lastUrlUpdateRequestTS.isFullFilled||(i._history.replaceState(i._history.getState(),e.permalink),i._lastUrlUpdateRequestTS.isFullFilled=!0)},function(){t.ts<i._lastUrlUpdateRequestTS.ts&&i._lastUrlUpdateRequestTS.isFullFilled||e<5&&t.ts>=i._lastUrlUpdateRequestTS.ts&&i._requestPermalinkWithRetries(t,e+1)},"URlUpdate"))},Ca.prototype._setDevParams=function(){var e,t,i,o,a=vt.devParamsList,n="";if(a&&a.length){for(e=0,t=a.length;e<t;e++)i=a[e],(o=st._getUrlParam(window.location,i))&&(n+="&"+i+"="+o);this._devParams=n}},Ca),di=(Ma.prototype.back=function(){throw new Error("Not implemented")},Ma.prototype.forward=function(){throw new Error("Not implemented")},Ma.prototype.go=function(){throw new Error("Not implemented")},Ma.prototype.pushState=function(e){this._ignoreNextHashChange=!0,this._window.location.hash=this._serializeState(e)},Ma.prototype.replaceState=function(e){this._ignoreNextHashChange=!0,this._window.location.replace(this._window.location.href.split("#")[0]+"#"+this._serializeState(e))},Ma.prototype._processHashChange=function(){this._ignoreNextHashChange?this._ignoreNextHashChange=!1:(this._loadState(),this.statechanged.invoke(this.state))},Ma.prototype._loadState=function(){var e,t;this.state=null;try{(e=this._window.location.hash)&&e.length&&(t=rt.Internals.base64Decode(e.substring(1)),this.state=rt.Internals.parseJSON(t))}catch(e){}},Ma.prototype._serializeState=function(e){e=rt.Internals.stringify(e);return rt.Internals.base64Encode(e)},Ma),ci=(ba.prototype.getState=function(){try{var e=this._history.state;return e=e&&!(this._history instanceof di)?e.state:e}catch(e){return Microsoft.Maps.logger&&Microsoft.Maps.logger.logCriticalError(e),null}},ba.prototype.pushState=function(e,t){var i;!nt.isMobile&&(st._isSmallMapShownOnSerp()||nt.dynamicProperties.mapsOverlayClosing)||(this._historyIndex++,!t||this._history instanceof di?this._history.pushState(e,null):(i={state:e,index:this._historyIndex,url:t},this._history.pushState(i,null,t)),this._setLocalStorageMapState(e))},ba.prototype.replaceState=function(e,t){var i;!nt.isMobile&&(st._isSmallMapShownOnSerp()||nt.dynamicProperties.mapsOverlayClosing)||(!t||this._history instanceof di?this._history.replaceState(e,null):(i={state:e,index:this._historyIndex,url:t},this._history.replaceState(i,null,t)),this._setLocalStorageMapState(e))},ba.prototype.clearState=function(){0<this._historyIndex&&this._history.go(-1*this._historyIndex),this._historyIndex=0},ba.prototype.getLocalStorageState=function(){return ut.isEnabled()?JSON.parse(ut.getItem(ba.historyLocalStorageKey)):null},ba.prototype.clearLocalStorageState=function(){this._setLocalStorageMapState({})},ba.prototype._setLocalStorageMapState=function(e){ut.isEnabled()&&ut.setItem(ba.historyLocalStorageKey,JSON.stringify(e))},ba.prototype._invokeStateChanged=function(){if(!nt.dynamicProperties.mapsOverlayClosing){if(!(this._history instanceof di))try{var e=this._history.state;this._historyIndex=e?e.index:0}catch(e){Microsoft.Maps.logger&&Microsoft.Maps.logger.logCriticalError(e),this._historyIndex=0}this.statechanged.invoke(this.getState())}},ba.historyLocalStorageKey="BingMapsState",ba),hi=(Ta.getImageFromCss=function(e){var t=Ta._cachedImages.getItem(e);return t||(t=st._getImageFromCss(e),Ta._cachedImages.addItem(e,t)),t},Ta.prototype.dispose=function(){Ta._cachedImages.clear()},Ta._cachedImages=new gt(10),Ta),ui=(fa.prototype.setOptions=function(e){if(void 0!==e.expansionDeceleration){if(e.expansionDeceleration<=0)throw new Error("The 'expansionDeceleration' argument must be positive");this._options.expansionDeceleration=e.expansionDeceleration}if(void 0!==e.rotationalDeceleration){if(e.rotationalDeceleration<=0)throw new Error("The 'rotationalDeceleration' argument must be positive");this._options.rotationalDeceleration=e.rotationalDeceleration}if(void 0!==e.linearDeceleration){if(e.linearDeceleration<=0)throw new Error("The 'linearDeceleration' argument must be positive");this._options.linearDeceleration=e.linearDeceleration}},fa.prototype.getOptions=function(){return this._options},fa.prototype.start=function(e,t){var i=this;this.stop(),this._currentVelocities={angularVelocity:t.angularVelocity,expansionVelocity:t.expansionVelocity,linearVelocity:t.linearVelocity},this._pointerTrails=e,this._animationId=rt.Effects.Animation.requestAnimationFrame(function(){return i._onTick()})},fa.prototype.stop=function(){this._currentVelocities&&(rt.Effects.Animation.cancelAnimationFrame(this._animationId),this._currentVelocities=null,this._callback&&this._callback(null,this._pointerTrails,null),this._pointerTrails=null)},fa.prototype._onTick=function(){var e,t,i,o,a=this;this._currentVelocities&&(e=zt.getMagnitudeOfVector2D(this._currentVelocities.linearVelocity),i=zt.getAngleOfVector2D(this._currentVelocities.linearVelocity),e-=this._options.linearDeceleration*fa._tickInterval,e=Math.max(e,0),this._currentVelocities.linearVelocity=zt.getVector2DFromMagnitudeAndDirection(e,i),t=Math.abs(this._currentVelocities.angularVelocity),o=0<=this._currentVelocities.angularVelocity?1:-1,t-=this._options.rotationalDeceleration*fa._tickInterval,t=Math.max(t,0),this._currentVelocities.angularVelocity=t*o,i=Math.abs(this._currentVelocities.expansionVelocity),o=0<=this._currentVelocities.expansionVelocity?1:-1,i-=this._options.expansionDeceleration*fa._tickInterval,i=Math.max(i,0),this._currentVelocities.expansionVelocity=i*o,this._callback&&this._callback(this._currentVelocities,this._pointerTrails,fa._tickInterval),e<.001&&t<.001&&i<.001?this.stop():rt.Effects.Animation.requestAnimationFrame(function(){return a._onTick()}))},fa._tickInterval=16,fa),_i=(va.prototype.initialize=function(){var t=this;new Xe(function(e){t._container.instanceAsyncAll([{name:"LandmarksDataSource",args:t._coreConfig},{name:"LandmarksOSDataSource",args:t._coreConfig}],e)}).getObjectAsync(function(e){t._landmarksDataSource=e.LandmarksDataSource,t._landmarksOSDataSource=e.LandmarksOSDataSource,t._layerDataSource=t._landmarksDataSource.getLayerDataSource(t._coreConfig.landmarksVectorLayerId),t._layerOSDataSource=t._landmarksOSDataSource.getLayerDataSource(t._coreConfig.landmarksVectorLayerId);e=t._map.getMapType().id;e!==ft.birdseye&&e!==ft.birdseyeV2&&e!==ft.streetside&&t._setDataSourceLayer(),t.landmarksAllDataSourcePromise.resolve({landmarksDS:t._landmarksDataSource,landmarksOSDS:t._landmarksOSDataSource})}),this._map.mapTypeChanged.add(function(e){t.landmarksAllDataSourcePromise.then(function(){t._layer&&(e.newMapTypeId===ft.ordnanceSurvey?t._layer.setDataSource(t._layerOSDataSource):t._layer.setDataSource(t._layerDataSource))})})},va.prototype._setDataSourceLayer=function(){var t=this;this.landmarksAllDataSourcePromise.then(function(e){t._layer||t._addLayer(e)})},va.prototype._addLayer=function(e){var t=this;this._layer||(this._layer=this._map.getMapType().id===ft.ordnanceSurvey?new Ut(this._coreConfig.landmarksLayerId,this._layerOSDataSource,this,this._coreConfig.landmarksLayerZIndex):new Ut(this._coreConfig.landmarksLayerId,this._layerDataSource,this,this._coreConfig.landmarksLayerZIndex),this._layer.setRenderTarget(1),this._layer.canBeFiltered=!0,e.landmarksOSDS.setLayer(this._layer),e.landmarksDS.setLayer(this._layer),(e=this._map.getLayers()).insert(this._layer),this._layer.setVisible(!0),this._primitiveTapped=this._layer.primitiveTapped.add(function(e){t._onPrimitiveTapped(e)}),this._primitiveHoverStarted=this._layer.primitiveHoverStarted.add(function(e){t._onPrimitiveHoverStarted(e)}),this._primitiveHoverStopped=this._layer.primitiveHoverStopped.add(function(e){t._onPrimitiveHoverStopped(e)}),this._events.push(this._map.mapTypeChanged.add(function(e){t._onMapTypeChanged(e)}),e.changed.add(function(e){t._onMapLayersChanged(e)})),this._layer.overlayEvent=2)},va.prototype._onMapLayersChanged=function(e){var t=!e||e.reset,e=this._layer,e=e&&e.getDataSource();e&&e.invalidated&&t&&e.invalidated.invoke()},va.prototype._onMapTypeChanged=function(e){e.newMapTypeId!==e.oldMapTypeId&&(this._resetTemplateSelector=!0,this._initialized=!1,this.selectorReady(),e=e.newMapTypeId!==ft.birdseye&&e.newMapTypeId!==ft.streetside&&e.newMapTypeId!==ft.birdseyeV2,this._layer.setVisible(e))},va.prototype._removeLayer=function(){this._layer&&(this._map.getLayers().remove(this._layer),this._layer.dispose(),this._layer=null),this.removePrimitiveTapped(),this.removePrimitiveHover(),this._currentInfobox&&this._currentInfobox.dispose(),st._clearDisposables(this._events)},va.prototype.applyFilterOnDataSource=function(e){var t,i,o,a;if(e){for(t=this._map.getBaseLayers(),i=0;i<t.length;i++)(o=t[i])instanceof Ut&&((o=o.getDataSource())&&o.applyFilter&&o.applyFilter(e));this._layer.getDataSource().applyFilter(e),a={logData:{feature:We.Landmarks,action:_t.Activated,data:{FCAT:e.value.toString(),FCT:e.value.length}},isMapsAction:!0},ai.invokeHandler(Xt.instrumentationDataHandlerKey,a)}},va.prototype.resetDataSource=function(){for(var e,t=this._map.getBaseLayers(),i=0;i<t.length;i++)(e=t[i])instanceof Ut&&((e=e.getDataSource())&&e.resetFilter&&e.resetFilter());this._layer.getDataSource().resetFilter()},va.prototype.removePrimitiveTapped=function(){this._primitiveTapped&&(this._primitiveTapped.dispose(),this._primitiveTapped=null)},va.prototype.removePrimitiveHover=function(){this._primitiveHoverStarted&&(this._primitiveHoverStarted.dispose(),this._primitiveHoverStarted=null),this._primitiveHoverStopped&&(this._primitiveHoverStopped.dispose(),this._primitiveHoverStopped=null)},va.prototype.selectorReady=function(){var t=this;return!this._baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(e){t._baseMapTemplateSelector=e,t._resetTemplateSelector=!1;e=e.selectorReady();return e.then(function(){t._initialized=!0}),e}):this._baseMapTemplateSelector.selectorReady()},va.prototype.getMarkupStyle=function(e,t){var i;return i=e&&this._initialized?this._baseMapTemplateSelector.getMarkupStyle(e,t,this._getPoiState(e),5):i},va.prototype._getPoiState=function(e){var t=e.viewState,e=2;return 1===t?e=3:2===t&&(e=4),e},va.prototype.getTemplates=function(e,t){var i=null,o=e.entity&&e.entity.landmarksDealFlag;return e&&this._initialized&&(i=this._baseMapTemplateSelector.getLandmarkVectorImageTemplate(e,this._getPoiState(e),t)),i=o&&this._coreConfig.landmarkDeals?Fe.addBadgeTemplate(i,3):i},va.prototype._selectPoi=function(e,t){var i=et.getTransitJson(e.entity),o=et.getYpid(e.entity);2===t&&(o?(ai.invokeHandler(Xt.taskProcessDataHandlerKey,{type:si.localDetailsTask,requestState:{entryPoint:it.Landmarks,id:o,flippingCard:!1,taskTitle:et.getDisplayName(e.entity)}}),this._log(We.Landmarks,_t.Clicked,e)):!i||(t=JSON.parse(i)).stops&&0<t.stops.length&&(o=null,(i=e.geometry)&&(o=new bt(e.crs.toLatitude(i.bounds[1],i.bounds[0]),e.crs.toLongitude(i.bounds[1],i.bounds[0]))),t={id:t.stops[0].id,title:t.stops[0].name,location:o,activationEntryPoint:1},ai.invokeHandler(Xt.taskDataHandlerKey,{type:si.transitStopTask,state:t}),o={Z:this._map.getMercatorZoomLevel(),TM:e.bucket,S:et.getLabelImportance(e.entity),L:o},ai.invokeHandler(Xt.instrumentationDataHandlerKey,{logData:{feature:"TS",action:"MPC",data:o}})))},va.prototype._getMapBounds=function(){var e=yt.getMapBounds(this._map,!0),t=[];return t.push(e.getNorth()),t.push(e.getWest()),t.push(e.getSouth()),t.push(e.getEast()),t},va.prototype._getRating=function(e,t){for(var t=t&&-1<t.toLowerCase().indexOf("tripadvisor"),i=t?"tartg_f sw_st":"sw_st",o=t?"tartg_hf sw_sth":"sw_sth",a=t?"tartg_e sw_ste":"sw_ste",n='<div><div class="me-b_factrow"><span class="csrc sc_rc1" role= "img" aria-label="Star Rating: '+e+' out of 10." >',r=0;r<10;r+=2)n+='<span class="'+(r<e?r+1<e?i:o:a)+'"></span>';return n+"</span></div></div>"},va.prototype._createInfoboxHtml=function(e){var t=e.ads.length,i=e.ads[0],o=i.category||"",a=parseFloat(e.ads[0].bingRating);return'<div class="infoBoxLink">    <div class="bm_layerInfobox" id="infobox-container">        <div class="infoboxBody clientSide" style="min-width:220px;max-width:320px">            <div class="infoboxHouseImage">                <img class="infoboxBgImg" src="{image}"/>            </div>            <div class="infoboxText" style="padding: 4px 10px;">                <div class="titleLine" style="display: inline-block; line-height: 12px; padding-bottom: 2px;">{title}</div>                <div class="factsLine"style="line-height: 12px;opacity:{categoryOpacity}">{facts}</div>                <div class="factsLine" style="padding-bottom: 0px;opacity:{ratingOpacity}">{morefacts}</div>                <div class="infoboxDealBadge" adsLink="{adsUrl}">{price}</div>                <div class="infoboxDealsMore">{numdeals}</div>            </div>        </div>    </div></div>'.replace("{image}",i.img||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAAAXRSTlMAQObYZgAAAApJREFUeJxjYgAAAAYAAzY3fKgAAAAASUVORK5CYII=").replace("{title}",e.name||"").replace("{facts}",o).replace("{morefacts}",this._getRating(a,i.ratingProvider)).replace("{price}",i.price||"").replace("{adsUrl}",i.cpc||"").replace("{numdeals}",1<t?Rt.LandmarkDealsMore_Text.replace("{0}",t-1):"").replace("{categoryOpacity}",o?"1":"0").replace("{ratingOpacity}",isNaN(a)?"0":"1")},va.prototype._onPrimitiveHoverStarted=function(e){var i=this,o=e.primitive,a=et.getYpid(o.entity,!0),t=et.getTransitJson(o.entity),n=o.entity,r=n.landmarksDealFlag;o.entity&&(a||t||r)&&(o.viewState=1,o.zIndex=2,this._hoverStartTimeStamp=Date.now(),o.entity.changed.invoke(),t&&(t=JSON.parse(t),t=this._buildTransitStaticResources(t),e={overlayTemplate:new Qe(Gt,t),overlayAnchor:new Ne(-e.point.y-10,-e.point.x-10),overlayAlignment:0},xt.showOverlay(this._map,e,o)),a&&r&&this._coreConfig.landmarkDeals&&(r=o.geometry,this._infoboxOptions.location=new bt(o.crs.toLatitude(r.x,r.y),o.crs.toLongitude(r.x,r.y)),this._currentInfobox||(this._currentInfobox=new pt(this._infoboxOptions.location,this._infoboxOptions),this._currentInfobox.setMap(this._map),this._currentInfobox.setPrimitive(o),this._events.push(this._currentInfobox.changed.add(function(e){e&&"htmlContent"===e.name&&i._registerInfoboxClickHandler(i._currentInfobox.getPrimitive())}))),this._coupoiLandmarksDisplayed[a]||(this._infoboxOptions.visible=!0,this._infoboxOptions.htmlContent='    <div class="bm_layerInfobox skaleton">        <div class="infoboxBody clientSide" style="height:80px;width:320px">            <div class="infoboxHouseImage">                <div style="width:80px;height:80px;background-color:lightgray"/></div>        </div>        <div class="infoboxText">            <div style="width: 200px;height:17px;margin-top:-4px; background-color: lightgray"></div>            <div style="width:100px;height:12px;background-color:lightgrey;margin:4px 0px"></div>            <div class="factsLine" style="padding-bottom: 0px;">{morefacts}</div>            <div class="infoboxDealBadge" style="background-color:darkseagreen;width:40px;margin-top:-3px"></div>        </div>    </div>'.replace("{morefacts}",this._getRating(0)),this._currentInfobox.setOptions(this._infoboxOptions)),r=this._coreConfig.landmarkDealsUrl.replace("{ypid}",a),this._landmarkDealRequestId=St.downloadJson(r,"landmarkDeals",function(e,t){i._coupoiLandmarksDisplayed[a]=!0;e=e.Ads;t===a&&(e&&0<e.length?(n.ads=e,i._infoboxOptions.visible=!0,i._infoboxOptions.htmlContent=i._createInfoboxHtml(n),i._currentInfobox.setPrimitive(o),i._currentInfobox.setOptions(i._infoboxOptions)):i._currentInfobox.setOptions({visible:!1}))},null,a,!1,0,null,null,Dt.getLogKeyFromUrl(r))))},va.prototype._onPrimitiveHoverStopped=function(e){var t,i=e.primitive,o=i.entity;o&&(St.abortRequest(this._landmarkDealRequestId),t=et.getYpid(o),e=et.getTransitJson(o),o=i.entity.landmarksDealFlag,(t||e||o)&&(i.viewState=0,i.zIndex=0,this._hoverStartTimeStamp&&Date.now()-this._hoverStartTimeStamp>=va._hoverLoggingThresholdForEventLogging&&this._log(We.Landmarks,_t.Hovered,i,null,Date.now()-this._hoverStartTimeStamp),this._hoverStartTimeStamp=null,i.entity.changed.invoke(),e&&xt.hideOverlay(this._map,i),this._currentInfobox&&this._currentInfobox.getVisible()&&this._currentInfobox.setOptions({visible:!1,closeDelayTime:500})))},va.prototype._onPrimitiveTapped=function(e){var t=e.primitive,e=et.getYpid(t.entity);(t.entity&&e||et.getTransitJson(t.entity))&&this._selectPoi(t,2)},va.prototype._registerInfoboxClickHandler=function(t){var i=this,e=rt(".infoBoxLink");0<e.length&&(e.set_attr("aria-label",Rt.InfoboxListAriaLabel),e.set_style({cursor:"pointer"}),e.add_event("click",function(e){e=e.target&&e.target.getAttribute("adsLink");e&&(i._log(We.LandmarksDeal,_t.Clicked,t,e),window.open(e,"_blank")),t.entity&&(i._selectPoi(t,2),i._currentInfobox.setOptions({visible:!1}))}))},va.prototype.dispose=function(){this._coupoiLandmarksDisplayed=null,this._removeLayer()},va.prototype._buildTransitStaticResources=function(e){var t,i,o,a,n="",r="",s=[],l=0,p=!1;if(e&&e.stops&&e.stops.length&&(r=e.stops[0].name,e.stops[0].routes&&e.stops[0].routes.length)){for(t=e.stops[0].routes,i=0;i<t.length;i++)for(o=0;o<t[i].names.length;o++)5<(a=t[i].names[o]).length&&l++,s.push(a);p=l>=s.length/2,n=s.join(p?"\n":", ")}return{transitLandmark:e,routeList:n,showLongList:p,stopName:r,addNewLines:this._addNewLines}},va.prototype._addNewLines=function(e){return e?"enableNewLines":""},va.prototype._log=function(e,t,i,o,a){var n=et.getYpid(i.entity),r=i.geometry,s=null;r&&(s=new bt(i.crs.toLatitude(r.bounds[1],r.bounds[0]),i.crs.toLongitude(r.bounds[1],r.bounds[0]))),r=null,n&&(r={ID:n,Z:this._map.getMercatorZoomLevel(),L:s,CP:i.entity&&i.entity.landmarksDealFlag?"1":"0"},a&&(r.HD=a),o&&(r.dealsUrl=o)),ai.invokeHandler(Xt.instrumentationDataHandlerKey,{logData:{feature:e,action:t,data:r}})},va._hoverLoggingThresholdForEventLogging=500,va),gi=(ma.prototype.addPrimitive=function(e){this.addPrimitives([e])},ma.prototype.addPrimitives=function(e){for(var t,i=new qe,o=0;o<e.length;o++)t=e[o],this._primitives.push(t),this._observePrimitiveChanges(t),t.geometry&&i.accumulate(t.geometry.bounds,t.crs);this._invokeInvalidatedEvent(i.getBounds())},ma.prototype.removePrimitive=function(e){var t,i=this._primitives.indexOf(e);if(-1===i)throw new Error("The primitive does not exist is this data source.");(t=this._changedEventHandlers[i])&&t.dispose(),this._primitives.splice(i,1),this._changedEventHandlers.splice(i,1),i=new qe,e.geometry&&i.accumulate(e.geometry.bounds,e.crs),this._invokeInvalidatedEvent(i.getBounds())},ma.prototype.clear=function(){this._disposeAllChangedEventHandlers(),this._primitives=[],this._changedEventHandlers=[],this._invokeInvalidatedEvent(null)},ma.prototype.getPrimitives=function(e,t){t({primitives:this._primitives})},ma.prototype.dispose=function(){this._disposeAllChangedEventHandlers(),this._primitives=null,this._changedEventHandlers=null},ma.prototype._disposeAllChangedEventHandlers=function(){for(var e,t=0;t<this._changedEventHandlers.length;t++)(e=this._changedEventHandlers[t])&&e.dispose()},ma.prototype._observePrimitiveChanges=function(e){var t=this,i=e.entitychanged,o=null;i&&(o=i.add(function(){return t._onPrimitiveChanged(e)})),this._changedEventHandlers.push(o)},ma.prototype._onPrimitiveChanged=function(e){var t;e.geometry&&((t=new qe).accumulate(e.geometry.bounds,e.crs),this._invokeInvalidatedEvent(t.getBounds()))},ma.prototype._invokeInvalidatedEvent=function(e){this.invalidated.invoke({dirtyRect:e})},ma),yi=(ya.prototype.clone=function(){return new ya(this.expansion,this.rotation,new It(this.translation.x,this.translation.y))},ya.areEqual=function(e,t){return Ye.assertNotNull(e,"manipulationDelta1"),Ye.assertNotNull(t,"manipulationDelta2"),e.expansion===t.expansion&&e.rotation===t.rotation&&e.translation.x===t.translation.x&&e.translation.y===t.translation.y},ya),mi=(ga.prototype.clear=function(){this._deltaList.splice(0,this._deltaList.length)},ga.prototype.add=function(e){Ye.assertNotNull(e,"manipulationDelta");var t=this._deltaList;t.length&&yi.areEqual(e,t[t.length-1])||t.push(e)},ga.prototype.getLast=function(){return Ye.assert(0<this._deltaList.length,"Cannot call getLast when the trail is empty."),this._deltaList[this._deltaList.length-1]},ga.prototype.getLastExcluding=function(e){Ye.assert(0<this._deltaList.length,"Cannot call getLastExcluding when the trail is empty.");for(var t=this._deltaList.length-1;0<=t&&yi.areEqual(this._deltaList[t],e);)--t;return 0<=t?this._deltaList[t]:null},ga.prototype.getLastN=function(e){return this._deltaList.slice(-e)},ga.prototype.isEmpty=function(){return 0===this._deltaList.length},ga),vi=(_a.prototype.reset=function(){this._activeKeyCodes={}},_a.prototype.processKeyDownEvent=function(e){var t=e.originalArgs;t&&(t.altKey||t.ctrlKey||t.metaKey)||(this._activeKeyCodes[e.keyCode]=!0)},_a.prototype.processKeyUpEvent=function(e){this._activeKeyCodes[e.keyCode]=!1},_a.prototype.isKeyPressed=function(e){return this._activeKeyCodes[e]},_a.prototype.isPanUpRequested=function(){return this._activeKeyCodes[38]&&!this._activeKeyCodes[40]},_a.prototype.isPanDownRequested=function(){return this._activeKeyCodes[40]&&!this._activeKeyCodes[38]},_a.prototype.isPanLeftRequested=function(){return this._activeKeyCodes[37]&&!this._activeKeyCodes[39]},_a.prototype.isPanRightRequested=function(){return this._activeKeyCodes[39]&&!this._activeKeyCodes[37]},_a.prototype.isPanOperationRequested=function(){return this.isPanUpRequested()||this.isPanDownRequested()||this.isPanLeftRequested()||this.isPanRightRequested()},_a.prototype.isZoomInRequested=function(){var e=this._activeKeyCodes,t=e[187]||e[107],e=e[189]||e[109];return t&&!e},_a.prototype.isZoomOutRequested=function(){var e=this._activeKeyCodes,t=e[187]||e[107];return(e[189]||e[109])&&!t},_a.prototype.isZoomOperationRequested=function(){return this.isZoomInRequested()||this.isZoomOutRequested()},_a.prototype.isMapTypeSwitchRequested=function(){var e=this._activeKeyCodes;return e[65]||e[66]||e[69]||e[72]||e[79]||e[82]||e[83]},_a.prototype.isNavigationRequested=function(){return this.isPanOperationRequested()||this.isZoomOperationRequested()},_a),fi=(ua.ActionBubbleChanged="BC",ua.BubbleLocation="BL",ua.BubbleChangedMethod="BCM",ua.BubbleChangedMethodArrow="Arrow",ua.BubbleChangedMethodOverviewMap="OverviewMap",ua.BubbleChangedMethodOverviewMapPoi="OverviewMapPoi",ua.BubbleChangedMethodTapAndHold="TapAndHold",ua.BubbleChangedMethodKeyboard="Keyboard",ua.EntryPoint="EP",ua.EntryPointZoomIn="ZoomIn",ua.EntryPointStreetsideMini="StreetsideMini",ua.EntryPointCoverageMap="CoverageMap",ua.EntryPointDrivingDirections="DrivingDirections",ua.EntryPointLocalDetails="LocalDetails",ua.EntryPointPermalink="Permalink",ua.EntryPointBrowserHistory="BrowserHistory",ua.ExitMethod="EM",ua.ExitMethodEscKey="EscKey",ua.ExitMethodExitButton="ExitButton",ua.ExitMethodExternal="External",ua.NumberBubblesNavigated="NBN",ua.OverviewMapActivated="OM"+_t.Activated,ua.OverviewMapDeactivated="OM"+_t.Deactivated,ua.OriginUser="User",ua.OriginEvent="Event",ua.PhotosynthModeFeatureName="PS",ua.StreetsideModeFeatureName="SS",ua.StreetsideMiniFeatureName="SM",ua.StreetsideErrorAction="E",ua.StreetsideBootstrapError="BE",ua),Ti=(ha.CoverageLayerDisplayTime=fi.StreetsideModeFeatureName+"_CLD",ha.AutoEntryToImmersionTime=fi.StreetsideModeFeatureName+"_AEI",ha.CoverageLayerClickToImmersionTime=fi.StreetsideModeFeatureName+"_CLCI",ha.LocalDetailsClickToImmersionTime=fi.StreetsideModeFeatureName+"_LDCI",ha.DirectionsClickToImmersionTime=fi.StreetsideModeFeatureName+"_DCI",ha.StreetsideMiniClickToImmersionTime=fi.StreetsideModeFeatureName+"_SMCI",ha.ContextMenuClickToImmersionTime=fi.StreetsideModeFeatureName+"_CMCI",ha.PermalinkToImmersionTime=fi.StreetsideModeFeatureName+"_PCI",ha.BrowserHistoryToImmersionTime=fi.StreetsideModeFeatureName+"_BHCI",ha.LaunchToReadyTime=fi.StreetsideModeFeatureName+"_LR",ha.DirectionsIntegrationTime=fi.StreetsideModeFeatureName+"_DI",ha.LocalDetailsIntegrationTime=fi.StreetsideModeFeatureName+"_LDI",ha.UpdateOverviewMapTime=fi.StreetsideModeFeatureName+"_UOM",ha.OpenOverviewMapTime=fi.StreetsideModeFeatureName+"_OOM",ha.CloseOverviewMapTime=fi.StreetsideModeFeatureName+"_COM",ha.Succeeded="s",ha.Failed="f",ha),bi=(ca.prototype.isAttached=function(){return!(null===this._map)},ca.prototype.attach=function(e,t){var i=this;Ye.assert(!this._map,"An event source has already been attached to this behavior."),this._map=e,this._createStreetSideCoverageLayer(),t?(this._streetsideBubblePickerOverlay=t.pickerOverlay,this._attachedTo=t.attachedTo,this._entryPoint=t.entryPoint,this._perfIdentifier=t.perfIdentifier,this._followCursor=t.followCursor,this._insertOverlays(),this._attachKeyHandler(),ca._log(_t.Activated,this._entryPoint)):this._map.getContainer().instanceAsync("StreetsideBubblePickerOverlay",function(e){i._streetsideBubblePickerOverlay=e,i._attachedTo="StreetsideCoverageBehavior",i._entryPoint=fi.EntryPointCoverageMap,i._perfIdentifier=Ti.CoverageLayerClickToImmersionTime,i._followCursor=!0,i._insertOverlays(),i._attachKeyHandler(),ca._log(_t.Activated,i._entryPoint)})},ca.prototype.detach=function(){Ye.assertNotNull(this._map,"No map has been attached to this behavior."),this._streetsideBubblePickerOverlay&&this._streetsideBubblePickerOverlay.showCoverage(!0),this._bubbleLookupInProgress=!1,this._map&&this._map.getOverlays()&&this._map.getOverlays().remove(this._streetsideBubblePickerOverlay),this._imageryMapLayer.setVisible(!1),this._pointerMovedHandler&&this._pointerMovedHandler.dispose(),this._mapViewChangedHandler&&this._mapViewChangedHandler.dispose(),this._mapTappedHandler&&this._mapTappedHandler.dispose(),this._frameRenderedHandler&&this._frameRenderedHandler.dispose(),this._modeChangedHandler&&this._modeChangedHandler.dispose(),this._detachKeyHandler(),this._pointerMovedHandler=null,this._mapViewChangedHandler=null,this._mapTappedHandler=null,this._frameRenderedHandler=null,this._modeChangedHandler=null,this._streetsideBubblePickerOverlay=null,this._attachedTo=null,this._perfIdentifier=null,this._map=null,ca._log(_t.Deactivated,this._entryPoint),this._entryPoint=null},ca.prototype.getAttachedTo=function(){return this._attachedTo},ca.prototype.toggleStreetsideButton=function(e){var t,i;this._map&&(t=rt(".slot.streetside"),i=(i=this._map.getNavigationBar())&&i.getHelper(),t&&0<t.length&&i&&i.isEnabled(t)&&(e&&!i.isSwitchButtonTurnedOn(t)||!e&&i.isSwitchButtonTurnedOn(t))&&i.toggleSwitch(t))},ca.prototype._attachKeyHandler=function(){var t=this;this._keyPressedHandler=function(e){e&&27===e.keyCode&&(t.toggleStreetsideButton(!1),t.detach())},rt(window).add_event("keyup",this._keyPressedHandler)},ca.prototype._detachKeyHandler=function(){rt(window).remove_event("keyup",this._keyPressedHandler),this._keyPressedHandler=null},ca.prototype._insertOverlays=function(){var t=this;this._map.getOverlays().insert(this._streetsideBubblePickerOverlay),this._imageryMapLayer.setVisible(!0),-1===this._map.getLayers().indexOf(this._imageryMapLayer)&&this._map.getLayers().insert(this._imageryMapLayer),this._followCursor||this._streetsideBubblePickerOverlay.setAlignment(this._map.getView().cameraLocation),this._map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(e){return t._finalizeAttach(e)})},ca.prototype._finalizeAttach=function(e){var t=this;this._map&&(this._streetsideModeBootstrapper=e,this._checkIfCoverageIsInView(null),this._followCursor?this._pointerMovedHandler=this._map.pointerMoved.add(function(e){return t._onPointerMoved(e)}):this._mapViewChangedHandler=this._map.viewChanged.add(function(e){return t._onMapViewChanged(e)}),this._mapTappedHandler=this._map.mapTapped.add(function(e){return t._onMapTapped(e)}),this._frameRenderedHandler=this._map.getFrameManager().frameRendered.add(function(e){return t._checkIfCoverageIsInView(e)}),this._modeChangedHandler=this._map.mapModeChanged.add(function(e){return t._onMapModeChanged(e)}),this._mapTypeChangedHandler=this._map.mapTypeChanged.add(function(){return t._onMapTypeChanged()}))},ca.prototype._onMapModeChanged=function(e){2===e.newMode&&this.toggleStreetsideButton(!1),this.detach()},ca.prototype._onMapTypeChanged=function(){this._map&&this._map.getMapType().id===ft.birdseye&&this.detach()},ca.prototype._checkIfCoverageIsInView=function(){var t=this;this._streetsideModeBootstrapper.isAvailable(this._map.getBounds(),function(e){return t._handleIsAvailableResponse(e)},function(){return t._noBubblesFoundInMapView()})},ca.prototype._onPointerMoved=function(e){this._streetsideBubblePickerOverlay.setAlignment(e.location)},ca.prototype._onMapViewChanged=function(){this._streetsideBubblePickerOverlay&&this._streetsideBubblePickerOverlay.setAlignment(this._map.getView().cameraLocation)},ca.prototype._onMapTapped=function(e){var t,i,o=this;!e||e.exclusiveHitTest||this._bubbleLookupInProgress||this._noCoverage||(this._bubbleLookupInProgress=!0,(e=this._map.getMode().tryPointToLocation(e.point))&&(this._streetsideBubblePickerOverlay.showWaiting(),t=this._perfLog.start(this._perfIdentifier),(i=this._map.getMapOptions().streetsideOptions||{}).zoomIn=!0,i.entryPoint=this._entryPoint,i.perfState=t,this._streetsideModeBootstrapper.isAvailable(e,function(e){o._streetsideModeBootstrapper.show(e,i)},function(){return o._noBubblesFound(t)},i)))},ca.prototype._noBubblesFound=function(e){var t=this;this._bubbleLookupInProgress=!1,this._streetsideBubblePickerOverlay&&this._streetsideBubblePickerOverlay.showNoCoverage(Rt.L_StreetsideNoCoverageInstructions_Text),Microsoft.Maps.setTimeout(function(){t._streetsideBubblePickerOverlay&&t._streetsideBubblePickerOverlay.showCoverage()},Vt.cursorSwapDelayTimeInMilliseconds),e&&e.end(Ti.Failed)},ca.prototype._handleIsAvailableResponse=function(e){e?(this._noCoverage=!1,this._streetsideBubblePickerOverlay&&this._streetsideBubblePickerOverlay.showCoverage()):this._noBubblesFoundInMapView()},ca.prototype._noBubblesFoundInMapView=function(){this._noCoverage=!0,this._streetsideBubblePickerOverlay&&this._streetsideBubblePickerOverlay.showNoCoverage(nt.isMobile?Rt.L_StreetsideMobileNoCoverageInMapView_Text:Rt.L_StreetsideNoCoverageInMapView_Text)},ca.prototype._createStreetSideCoverageLayer=function(){var e,t;!this._imageryMapLayer&&this._map&&(this._imageryMapLayer=new lt("Microsoft.Maps.StreetsideCoverage",Vt.coverageLayerZIndex,Vt.coverageLayerOpacity,null,null,2,null,this._map.getMapOptions().enableCORS),e=st._updateTfeUrlDomain(Vt.coverageLayerTileUrlFormat),t=qt.toScale(null,Vt.maxZoomForSS,!0),this._imageryMapLayer.addScene(10,At.createMercatorImageryScene("SSCoverage",e,"",null,this._map),0,360,t))},ca._log=function(e,t){ai.invokeHandler(Xt.instrumentationDataHandlerKey,{logData:{feature:"SSCL",action:e,data:{EP:t}}})},ca._defaultNumberOfBubblesToRequest=10,ca),Mi=(da.ActionName="NC",da.RotateLeft="RotateLeft",da.RotateReset="RotateReset",da.RotateRight="RotateRight",da.MapMode="MapMode",da.ZoomIn="ZoomIn",da.ZoomOut="ZoomOut",da.MyLocation="MyLocation",da.Streetside="Streetside",da.MapTraffic="MapTraffic",da),Ci=(pa.prototype.setNavigationBar=function(e){this._navigationBar=e},pa.prototype.getMap=function(){return this._map},pa.prototype.getMapRoot=function(){return this._mapRoot},pa.ignoreEvent=function(e){e.preventDefault()},pa.prototype.rotateLeft=function(){var e=this._map.getNavigationBar();e&&e.isRotateLeftEnabled()&&(e.enableRotateLeftButton(!1),this._rotate(90),this._log(Mi.RotateLeft))},pa.prototype.rotateRight=function(){var e=this._map.getNavigationBar();e&&e.isRotateRightEnabled()&&(e.enableRotateRightButton(!1),this._rotate(-90),this._log(Mi.RotateRight))},pa.prototype.zoomIn=function(){var e=this._map.getNavigationBar();e&&e.isZoomInButtonEnabled()&&(this._zoomAroundCenterByDelta(1),this._log(Mi.ZoomIn))},pa.prototype.zoomOut=function(){var e=this._map.getNavigationBar();e&&e.isZoomOutButtonEnabled()&&(this._zoomAroundCenterByDelta(-1),this._log(Mi.ZoomOut))},pa.prototype.locateMe=function(){var s=this,e={callback:function(e){var t=!1,i=!1,o=0,a=s._map.getConfig(),n=nt.dynamicProperties,r=null;e.success&&e.location&&e.position&&e.position.coords&&0<=e.position.coords.accuracy&&(t=(o=e.position.coords.accuracy)<=a.locateMeHighAccuracyMeters,(i=t||!n.locationIsPreferenceBased)&&(r=e.location)),r||(n.locationIsPreferenceBased&&n.preferenceBasedLocation?r=bt.parseLatLong(n.preferenceBasedLocation):n.location?r=bt.parseLatLong(n.location):n.reverseIPLocation?r=bt.parseLatLong(n.reverseIPLocation):n.marketLocation&&(r=bt.parseLatLong(n.marketLocation)),Ye.assert(!!r,"Could not find any location")),r&&(s._mePoi.setVisible(t),e=s._map.getActualSize(),n=Math.max(e.width,e.height),e=s._map.getMercatorZoomLevel(),0<o&&0<n&&(e=qt.fromScale(r,6*o/n,!0)),e=Math.max(Math.min(e,pa._locateMeMaxZoom),pa._locateMeMinZoom),t&&s._mePoi.setLocation(r),n=s._map.getView().cameraLocation,e=qt.toLocation(r,e,!0),bt.areEqual(n,e)?t||s._locateMeErrorDialog.show(i):(t||s._map.viewChanged.addOne(function(){s._locateMeErrorDialog.show(i)}),s._map.setView(new Tt(e))))}};this._geoLocationProvider||(this._geoLocationProvider=new ii(window,null)),this._geoLocationProvider.GetCurrentPosition(e),this._log(Mi.MyLocation)},pa.prototype.toggleTraffic=function(e){e.toggle(5),this._log(Mi.MapTraffic)},pa.prototype.streetsideHandler=function(){var e=this;this.getMap().getContainer().instanceAsync("StreetsideModeBootstrapper",function(){ai.invokeHandler(Xt.streetsideDataHandlerKey,{action:"toggleCoverageMap",map:e.getMap()}),e._log(Mi.Streetside)})},pa.prototype.toggleSwitch=function(e){-1===e[0].getAttribute("class").indexOf(pa.selectedClass)?e.add_class(pa.selectedClass):e.remove_class(pa.selectedClass)},pa.prototype.turnSwitchButtonsOff=function(){for(var e=this._getRadialMenuSwitchButtons(),t=0;t<e.length;t++)-1<e[t].getAttribute("class").indexOf(pa.selectedClass)&&e[t].click()},pa.prototype.isSwitchButtonTurnedOn=function(e){return-1!==e[0].getAttribute("class").indexOf(pa.selectedClass)},pa.prototype.invokeMapTypeButtonClicked=function(e){var t=this._navigationBar;t&&t.mapTypeButtonClicked.invoke(e)},pa.prototype._getRadialMenuSwitchButtons=function(){for(var e,t=[],i=this._mapRoot.select(".menu")[0].childNodes,o=0;o<i.length;o++)"switch"===(e=i[o]).getAttribute("data-type")&&t.push(e);return t},pa.prototype.getCurrentZoom=function(){var e=this._map.getView(),t=e.cameraLocation;return qt.fromLocation(new bt(t.latitude,t.longitude,e.cameraLocation.altitude),!0)},pa.prototype.getMapType=function(){return this.getMap().getMapType().id},pa.prototype.setMapType=function(e){(e===ft.birdseye||e===ft.birdseyeV2)&&this._map.getMapOptions().disableBirdseye||(this._map.setMapType(e),this._log(Mi.MapMode))},pa.prototype.dispose=function(){this._disposeMapEvents(),this._windowEventHandler&&rt(window).remove_event("click,touchend,keyup",this._windowEventHandler),st._nullifyClass(this)},pa.prototype._rotate=function(e){for(var t,i,o=this;e<0;)e+=360;t=this._map.getView(),(i=(t.heading+e)%360)!==t.heading&&(this._map.getMapType().id===ft.birdseyeV2?this._isBirdseyeV2Rotating||i%90!=0||(this._isBirdseyeV2Rotating=!0,Oe.BirdseyeV2Manager.getIsBirdseyeV2Available(this._map.getConfig(),t.cameraLocation,i,function(e){e?(o._navigationBar&&o._navigationBar.rotateCompass(i),o._map.setView(new Tt(t.cameraLocation,i),Ze.defaultAnimation)):o.showBirdseyeV2NotAvailableTip(!0),o._isBirdseyeV2Rotating=!1},this._map.getViewport())):(this._navigationBar&&this._navigationBar.rotateCompass(i),this._map.setView(new Tt(t.cameraLocation,i),Ze.defaultAnimation)))},pa.prototype.resetMapHeading=function(e){var t=this,i=this._map.getView();0!==i.heading&&(this._map.getMapType().id===ft.birdseyeV2?this._isBirdseyeV2Rotating||(this._isBirdseyeV2Rotating=!0,Oe.BirdseyeV2Manager.getIsBirdseyeV2Available(this._map.getConfig(),i.cameraLocation,0,function(e){e?(t._navigationBar&&t._navigationBar.setDefaultCompassClass(0),t._map.setView(new Tt(i.cameraLocation,0))):t.showBirdseyeV2NotAvailableTip(!0),t._isBirdseyeV2Rotating=!1},this._map.getViewport())):(this._navigationBar&&this._navigationBar.setDefaultCompassClass(0),this._map.setView(new Tt(i.cameraLocation,0)),e&&this._log(Mi.RotateReset)))},pa.prototype.toggleDropDownMenu=function(){this._mapRoot.select(".NavBar_DropDown, .menu").has_class("opened")?this.hideDropDownMenu():(nt.isMapsVertical||this.isDropDownShowing()||this.checkBirdseyeV2ForDropdown(),this.showDropDownMenu())},pa.prototype.isDropDownShowing=function(){return this._mapRoot.select(".NavBar_DropDown, .menu").has_class("opened")},pa.prototype.showDropDownMenu=function(){var t=this;this._mapRoot.select(".NavBar_Container, .NavBar_MapTypeButtonContainer").add_class("selected").set_attr("aria-expanded","true"),this._navigationBar.getNavigationBarOrientation()!==Ct.horizontal&&this._setRotateButtonVisible(!1),this._mapRoot.select(".NavBar_DropDown, .menu").add_class("opened");var e=this._map.getActualSize().height,i=parseInt(this._mapRoot.select("#MicrosoftNav").get_style("margin-top"))+parseInt(this._mapRoot.select(".NavBar_MapTypeButtonContainerWrapper").get_style("margin-top")),o=this._mapRoot.select("#MapStyleSelector").get_size().height,a=this._mapRoot.select("#RadialMenu");e<=i+a.get_size().height+o&&a.set_style({"max-Height":e-o-i,"overflow-y":"scroll","overflow-x":"hidden"}),nt.isMapsAnswer||nt.isMapsVertical||a.set_style({"margin-top":"0px"}),i=this._mapRoot.select("#navbarLabelToggleInput")[0],a=this.supportLabelToggle(),i.checked=!a||this._map.getLabelController().getIsLabelsEnabled(),this.enableLabelToggleButton(a),this._disposables.push(this._map.contextMenuInvoked.add(function(){return t.hideDropDownMenu()}),this._map.mapZoomStarted.add(function(){return t.hideDropDownMenu()}),this._map.mapPanStarted.add(function(){return t.hideDropDownMenu()}),this._map.mapTapped.add(function(){return t.hideDropDownMenu()})),this._windowEventHandler||(this._windowEventHandler=function(e){return t._onWindowEvent(e)},rt(window).add_event("click,touchend,keyup",this._windowEventHandler)),Microsoft.Maps.setTimeout(function(){t._map.mapRadialMenuChanged.invoke(!0)},200),this._adjustSlotText()},pa.prototype.supportLabelToggle=function(){var e=this._map,t=e.getMapOptions(),i=!0;switch(e.getMapType().id){case ft.ordnanceSurvey:case ft.mercator:i=!1;break;case ft.road:case ft.highContrast:case ft.grayscale:case ft.canvasDark:case ft.canvasLight:case ft.roadDark:i=t.allowHidingLabelsOfRoad}return i},pa.prototype.hideDropDownMenu=function(){this._mapRoot.select(".NavBar_DropDown, .menu").remove_class("opened"),this._mapRoot.select(".NavBar_Container, .NavBar_MapTypeButtonContainer").remove_class("selected").set_attr("aria-expanded","false"),this._mapRoot.select("#RadialMenu").set_style({"max-Height":"","overflow-y":"","overflow-x":""});var e=this._map.getMapType().id;e!==ft.birdseye&&e!==ft.birdseyeV2||this._setRotateButtonVisible(!0),this._map.mapRadialMenuChanged.invoke(!1),this._disposeMapEvents()},pa.prototype.getNavBarOrientation=function(){return this._navigationBar.getNavigationBarOrientation()},pa.prototype.getNavBarMode=function(){return this._navigationBar.getNavigationBarMode()},pa.prototype.isKeyUp=function(e,t){return!(!e||"keyup"!==e.type||!t)&&(e.keyCode||e.which)===t},pa.prototype.setFocusOnMapLayersButton=function(){var e=this;Microsoft.Maps.setTimeout(function(){e._mapRoot.select("#MapStyleSelector")[0].focus()},20)},pa.prototype.setFocusOnRadialMenu=function(){var t=this;Microsoft.Maps.setTimeout(function(){var e=t._mapRoot.select("#RadialMenu"),e=rt(e[0].children&&e[0].children[0]);e&&e[0].focus()},300)},pa.prototype.handleLabelsVisibleOnMapTypeChanged=function(){var e,t=this.supportLabelToggle(),i=!t||this.getLabelVisible();this.getMap().getLabelController().setIsLabelsEnabled(i),(e=this.getMapRoot().select("#navbarLabelToggleInput")[0])&&(e.checked=i,this.enableLabelToggleButton(t))},pa.prototype.checkBirdseyeV2ForDropdown=function(){var e,t=this,i=this._navigationBar.getRootElement().select(".slot.birdseye");i&&(this.setMapTypeButtonDisabled(i,!1),e=this._map.getView(),Oe.BirdseyeV2Manager.getIsBirdseyeV2Available(this._map.getConfig(),e.cameraLocation,0,function(e){e&&t.setMapTypeButtonDisabled(i,!0)},this._map.getViewport()))},pa.prototype.exitBirdseyeV2=function(){var t=this;this._map.getBirdseyeV2Manager().then(function(e){t._birdseyeV2NotAvailableTip&&t._birdseyeV2NotAvailableTip.add_class("bm_birdseyeV2ReminderHidden"),window.clearTimeout(t._birdseyeV2TipAutoFade),t.setMapType(e.previousMapState.mapTypeId||ft.road),t.handleLabelsVisibleOnMapTypeChanged()})},pa.prototype.updateNavBarForBirdseyeV2=function(e){var t=this._navigationBar.getRootElement().select(".NavBar_MapTypeButtonContainer"),i=this._navigationBar.getBirdseyeV2InfoExitControl(),o=i&&i.getBirdseyeV2ExitButton(),i="BirdseyeV2MapTypeButton";this.getNavBarOrientation()===Ct.vertical&&this.getNavBarMode()===Mt.default||(i+="ReducedSize"),e?(this._navigationBar.getRootElement().select(".birdseyeV2Geochain").set_text(""),t.add_class(i),o&&o.updateHandler(!0),this.updateLabelToggleForBirdseyeV2(null,!0)):(t.remove_class(i),o&&o.updateHandler(!1))},pa.prototype.updateLabelToggleForBirdseyeV2=function(e,t){var i,o,a,n="boolean"==typeof e?e:this.getLabelVisible();t&&(i=this.getMap().getView().cameraLocation,o=new ht(new bt(31.461471801529147,135),45,19.03685253618196),e=new ht(new bt(48.378235544143905,146.25),22.5,14.796674949047564),a=" disabled",t=this._navigationBar.getRootElement().select(".be2LabelToggleContainer")[0],o.contains(i)||e.contains(i)?(t.className.indexOf(a)<0&&(t.className+=a),n=!1):t.className=t.className.replace(a,"")),(a=this._navigationBar.getRootElement().select("#be2ToggleInput")[0])&&(a.checked=n)},pa.prototype.showBirdseyeV2NotAvailableTip=function(e){var t,i,o,a,n=this,r="bm_birdseyeV2ReminderHidden";this._birdseyeV2NotAvailableTip?(this._birdseyeV2NotAvailableTip.select(".bm_primaryMessage").set_text(e?Rt.L_NavBarBirdseyeV2NotAvailableRotationTip_PrimaryText:Rt.L_NavBarBirdseyeV2NotAvailableTip_PrimaryText),this._birdseyeV2NotAvailableTip.select(".bm_secondaryMessage").set_text(e?"":Rt.L_NavBarBirdseyeV2NotAvailableTip_SecondaryText),this._birdseyeV2NotAvailableTip.remove_class(r),window.clearTimeout(this._birdseyeV2TipAutoFade)):(t=st._createElement("div").set_attr("class","bm_birdseyeV2NotAvailableTooltips birdseyeV2Tooltips"),this._birdseyeV2NotAvailableTip=t,i=st._createElement("div").set_attr("class","bm_birdseyeV2NotAvailableTooltipsMessage"),(o=st._createElement("div").set_attr("class","bm_primaryMessage")).set_text(e?Rt.L_NavBarBirdseyeV2NotAvailableRotationTip_PrimaryText:Rt.L_NavBarBirdseyeV2NotAvailableTip_PrimaryText),(a=st._createElement("div").set_attr("class","bm_secondaryMessage")).set_text(e?"":Rt.L_NavBarBirdseyeV2NotAvailableTip_SecondaryText),i.append(o).append(a),t.append(i),this._navigationBar.getRootElement().getParent().append(t)),this._birdseyeV2TipAutoFade=Microsoft.Maps.setTimeout(function(){n._birdseyeV2NotAvailableTip.add_class(r)},2e3)},pa.prototype.getIsBirdseyeV2FullControl=function(){var e=this.getNavBarMode();return(e===Mt.default||e===Mt.square)&&this.getNavBarOrientation()===Ct.vertical},pa.prototype.getIsBirdseyeV2ControlNewLayout=function(){return nt.isMapsVertical||nt.isSDK&&this.getNavBarMode()===Mt.square},pa.prototype._adjustSlotText=function(){var e,t;if(this.getMap().getMapOptions().navigationBarMode!=Mt.compact)for(e=this._mapRoot.select("#RadialMenu")[0].children,t=0;t<e.length;t++){var i,o,a=e.item(t),n=a.clientHeight,r=a.getElementsByClassName("pie-label-description")[0],s=r?r.clientHeight:0;0<s&&n/4<s&&(o=(i=a.getElementsByClassName("labelStyle")[0])?rt(i).get_style("visibility"):"hidden",!i||"hidden"===o||0<(a=i?i.clientHeight:0)&&(o=(n-2-(s+a))/2,n=rt(i).get_style("marginTop"),o=((s=Number(n.match("\\d{2}")[0]))-(a=s-o)).toString().split(".")[0],rt(i).set_style({marginTop:Number(o)}),n=rt(r).get_style("marginTop"),o=((s=Number(n.match("\\d{2}")[0]))-a).toString().split(".")[0],rt(r).set_style({marginTop:Number(o)})))}},pa.prototype._disposeMapEvents=function(){st._clearDisposables(this._disposables)},pa.prototype._zoomAroundCenterByDelta=function(e){var t=this._map,i=t.getMode(),o=t.getTargetView(),a=yt.getViewportCenter(t),n=i.tryPointToLocation(a),e=i.getMapViewZoomedAboutLocation(o,n,e,1);t.setView(e,new Kt(t,n,a),1)},pa.prototype._log=function(e){var t=this._map.getView(),t={feature:We.MapControl,action:Mi.ActionName,data:{EL:e,CP:t.cameraLocation,H:t.heading,MM:this._map.getMode().getDisplayName(),MS:this._map.getMapType().displayName}};ai.invokeHandler(Xt.instrumentationDataHandlerKey,{logData:t})},pa.prototype._onMapModeChanged=function(e){2===e.oldMode&&this.streetSideExitEvent.invoke()},pa.prototype._onMapTypeChanged=function(){this._map.getMapType().id===ft.birdseye?(this.enableStreetsideButton(!1),this._getStreetsideButton().remove_class(pa.selectedClass)):this.enableStreetsideButton(!0)},pa.prototype.isStreetsideSupported=function(){return Vt&&Vt.isEnabled},pa.prototype.isStreetsideButtonEnabled=function(){return this._isStreetsideButtonEnabled},pa.prototype.getLabelVisible=function(){return this._isLabelVisible},pa.prototype.setLabelVisible=function(e){this._isLabelVisible=e},pa.prototype.enableStreetsideButton=function(e){var t=this._getStreetsideButton();e?this._isStreetsideButtonEnabled||this.setMapTypeButtonDisabled(t,!0):this._isStreetsideButtonEnabled&&this.setMapTypeButtonDisabled(t,!1),this._isStreetsideButtonEnabled=e},pa.prototype.setMapTypeButtonDisabled=function(e,t){t?(e.remove_class("disabled"),e.set_attr("tabindex","0")):(e.remove_class(pa.selectedClass),e.add_class("disabled"),e.set_attr("tabindex","-1"))},pa.prototype.enableLabelToggleButton=function(e){var t=this._navigationBar.getRootElement().select("#navbarLabelToggleInput").getParent().getParent();e?(t.remove_class("disabled"),t.set_attr("tabindex","0"),t.set_attr("aria-label","")):(t.add_class("disabled"),t.set_attr("tabindex","-1"),t.set_attr("aria-label",Rt.L_RadialMenuLabelToggleDisabled_Text))},pa.prototype.isBirdseyeSupported=function(){var e=nt.features.birdseye;return!(!e||!e.isEnabled)},pa.prototype.enableBirdseyeButton=function(){var e=this._navigationBar.getRootElement();this.isBirdseyeSupported()?(e.select(".NavBar_Container .birdseye").remove_class("disabled"),e.select(".NavBar_Container .birdseye").set_attr("tabindex","0")):(e.select(".NavBar_Container .birdseye").add_class("disabled"),e.select(".NavBar_Container .birdseye").set_attr("tabindex","-1"))},pa.prototype._onWindowEvent=function(e){e instanceof KeyboardEvent&&13!==e.keyCode&&27!==e.keyCode||(27==e.keyCode?(this.isDropDownShowing()&&this.isSwitchButtonTurnedOn(this._getStreetsideButton())&&e.stopImmediatePropagation(),this.hideDropDownMenu()):this.checkHideDropDownMenu(e.target))},pa.prototype.checkHideDropDownMenu=function(e){e&&(this.dropDownMenu||(this.dropDownMenu=this._mapRoot.select("#RadialMenu")[0]),this.mapStyleSelector||(this.mapStyleSelector=this._mapRoot.select("#MapStyleSelector")[0]),this.mapStyleSelector&&this.mapStyleSelector.id!=e.id&&!this.mapStyleSelector.contains(e)&&this.dropDownMenu.id!=e.id&&!this.dropDownMenu.contains(e)&&this.isDropDownShowing()&&this.hideDropDownMenu())},pa.prototype._getStreetsideButton=function(){if(this.streetsideButton)return this.streetsideButton;var e=this._mapRoot.select(".slot.streetside");return 0<e.length&&(this.streetsideButton=e),e},pa.prototype._setRotateButtonVisible=function(e){var t=this._map.getNavigationBar();t&&t.setRotateButtonVisible(e)},pa._locateMeMinZoom=12,pa._locateMeMaxZoom=17,pa.selectedClass="selected",pa),Si=(la.prototype.dispose=function(){st._clearDisposables(this._disposables),clearTimeout(this._hoverDelayTimerId),clearTimeout(this._tapAndHoldTimerId),this._releasePointerCapture()},la.prototype.setOptions=function(e){function t(e,t,i){void 0!==t[e]&&(i[e]=t[e])}var i=this._options;t("disableAllInteractions",e,i),t("enabledInteractionModes",e,i),t("tapThreshold",e,i),t("doubleTapTimeThreshold",e,i),t("autoRepeatDelay",e,i),t("autoRepeatTimeInterval",e,i),t("singlePanDistance",e,i),t("repeatPanDistance",e,i),t("singleZoomDistance",e,i),t("repeatZoomDistance",e,i),t("maximumInitialLinearInertiaSpeed",e,i),t("maximumInitialExpansionInertiaSpeed",e,i),t("maximumInitialAngularInertiaSpeed",e,i)},la.prototype.disableInteractionModes=function(e){var t=this._options;t.enabledInteractionModes=t.enabledInteractionModes&~e},la.prototype.enableInteractionModes=function(e){var t=this._options;t.enabledInteractionModes=t.enabledInteractionModes|e},la.prototype.getOptions=function(){return this._options},la.prototype.setInertiaOptions=function(e){this._inertia.setOptions(e)},la.prototype.getInertiaOptions=function(){return this._inertia.getOptions()},la.prototype.onKeyDown=function(e){var t,i=this;return this._map.keyPressed.invoke(e),!(!this._verifyInteractionsAreEnabled()||this._map.getMapOptions().disableKeyboardInput)&&(this._keyboardState.processKeyDownEvent(e),!(e=0!==(t=this._getActiveKeyboardState(this._keyboardState)))||0!==this._state&&10!==this._state||(this._state=3,32!==t&&8!==t||(this._keyAutoRepeatTimerId=Microsoft.Maps.setTimeout(function(){return i._onKeyAutoRepeatTimer()},this._options.autoRepeatDelay))),e)},la.prototype.onKeyUp=function(e){this._map.keyReleased.invoke(e);var t=this._getActiveKeyboardState(this._keyboardState),i=0!==t;if(i&&3===this._state){switch(this._captureKeyboardNavProperties(),t){case 32:this._raisePanStartedEvent(this._keyboardNavPreviousCenterPoint,this._keyboardNavPreviousCenterLocation),this._applyKeyboardPanOperation(this._options.singlePanDistance,null),this._raisePanStoppedEvent(this._keyboardNavPreviousCenterPoint,this._keyboardNavPreviousCenterLocation);break;case 8:this._applyKeyboardZoomOperation(this._options.singleZoomDistance,1);break;case 1024:this._applyMapTypeSwitchOperation()}this._resetStateToAwaitingInput()}return this._keyboardState.processKeyUpEvent(e),i},la.prototype._getActiveKeyboardState=function(e){var t=0,i=this._map.getMapOptions();return!this._verifyInteractionsAreEnabled()||i.disableKeyboardInput||(!i.disablePanning&&this._isModeEnabled(32)&&e.isPanOperationRequested()?t=32:!i.disableZooming&&this._isModeEnabled(8)&&e.isZoomOperationRequested()?t=8:this._isModeEnabled(1024)&&e.isMapTypeSwitchRequested()&&(t=1024)),t},la.prototype._getMouseEventArgs=function(e,t){var i=t,o=Oe.MouseEventArgs;return i=o?new o(e,this._map,t):i},la.prototype.onPointerEntered=function(e){0!==this._state&&10!==this._state||this._updateHoverState(e),this._map.pointerEntered.invoke(this._getMouseEventArgs("mouseover",e))},la.prototype.onPointerExited=function(e){this._updateHoverState(e),this._map.pointerExited.invoke(this._getMouseEventArgs("mouseout",e))},la.prototype.onPointerMoved=function(e){var t,i,o,a=e[0];if(0===a.buttonsState&&(t=rt.Browser.is_ie&&10===rt.Browser.ie_version,7===this._state||8===this._state||9===this._state&&!t||6===this._state)){a.button=1,a.buttonsState=1;try{this.onPointerReleased(a)}catch(e){throw this._resetStateToAwaitingInput(),e}}else if(this._map.pointerMoved.invoke(this._getMouseEventArgs("mousemove",a)),t=this._activePointers.getItem(a.identifier))switch(i=t.get(0),this._updatePointerTrail(e),this._state){case 1:zt.getEuclideanDistance2D(a.point,i.point)>this._options.tapThreshold&&(i.primitive&&i.primitive.isMoveEnabled&&i.primitive.isMoveEnabled()&&this._isModeEnabled(512)?(this._state=9,this._raisePrimitiveMoveStartedEvent(a.point,a.location,i)):!this._map.getMapOptions().disablePanning&&this._isModeEnabled(16)?(this._state=8,this._raisePanStartedEvent(a.point,a.location),this._panMapToPoint(i.location,a.point,!0)):this._updateHoverState(a));break;case 2:Ye.assert(1<this._activePointers.getCount(),"One or fewer pointers being tracked"),this._state=6,this._manipulationStartPoint=null,clearTimeout(this._tapAndHoldTimerId),o=this._createManipulationEventArgs(a.timestamp),this._raiseManipulationStartedEvent(o);break;case 7:this._raiseBoxZoomContinuedEvent(a.point,a.location);break;case 8:this._panMapToPoint(i.location,a.point,!0),this._raisePanContinuedEvent(a.point,a.location);break;case 9:this._raisePrimitiveMoveContinuedEvent(a.point,a.location,i);break;case 6:o=this._createManipulationEventArgs(a.timestamp),this._raiseManipulationContinuedEvent(o)}else 0!==this._state&&10!==this._state||this._updateHoverState(a)},la.prototype.onPointerPressed=function(e){if(this._verifyInteractionsAreEnabled()&&(e.originalArgs&&!e.originalArgs.isTrusted?this._previousUntrustedEventArgs=e:(this._previousUntrustedEventArgs&&this._previousUntrustedEventArgs.pointerType!==e.pointerType&&this._resetStateToAwaitingInput(),this._previousUntrustedEventArgs=null),this._map.pointerPressed.invoke(this._getMouseEventArgs("mousedown",e)),11===this._state&&this._resetStateToAwaitingInput(),this._isPointerEventTargetingMe(e)&&(0===this._activePointerType||this._activePointerType===e.pointerType)&&this._activePointers.getCount()<=2)){if(this._activePointers.getItem(e.identifier))return 7===this._state&&this._raiseBoxZoomCanceledEvent(),void this._resetStateToAwaitingInput();this._activePointerType=e.pointerType;var t=new zi;t.add(e),this._activePointers.addItem(e.identifier,t),0===this._state?this._allowBoxZoom()&&(4===e.button||e.originalArgs.shiftKey)?(this._state=7,this._raiseBoxZoomStartedEvent(e.point,e.location),this._acquirePointerCapture()):1===e.button&&(this._state=1,4!==e.pointerType&&3!==e.pointerType||this._watchForTapAndHold(),this._acquirePointerCapture(),(this._isPrimitiveTapEnabled(e.primitive,!1)||this._isPrimitiveTapEnabled(e.primitive,!0))&&this._raisePrimitivePointerPressedEvent(e.point,e.location,e)):1!==this._state&&8!==this._state||1!==e.button?7===this._state&&(this._raiseBoxZoomCanceledEvent(),this._resetStateToAwaitingInput()):(this._trimPointers(),this._state=2)}},la.prototype._updatePointerTrail=function(e){for(var t,i=0;i<e.length;i++)(t=this._activePointers.getItem(e[i].identifier))&&t.add(e[i])},la.prototype._processTapEvent=function(e,t){var i=e.primitive;t&&this._clearTapTimeout(),this._isPrimitiveTapEnabled(i,t)?this._raisePrimitiveTappedEvent(e.point,e.location,e,t):(this._raiseMapTappedEvent(e.point,e.location,e,t),!this._map.getMapOptions().disableZooming&&this._isModeEnabled(2)&&t&&yt.zoomAroundLocation(this._map,e.location,1,!0,1,1))},la.prototype._clearTapTimeout=function(){clearTimeout(this._tapTimeoutId),this._tapTimeoutId=null},la.prototype.onPointerReleased=function(e){var t,i,o,a,n,r,s=this;this._map.pointerReleased.invoke(this._getMouseEventArgs("mouseup",e)),(t=this._activePointers.getItem(e.identifier))&&(r=t.get(0),1===this._state&&1===e.button?(zt.getEuclideanDistance2D(e.point,r.point)<=this._options.tapThreshold&&(n=e.timestamp,this._previousTapTimestamp&&(i=n-this._previousTapTimestamp,a=zt.getEuclideanDistance2D(r.point,this._previousTapPressEventArgs.point),o=2===e.pointerType?this._options.tapThreshold:this._options.doubleTapThreshold,a=i<=this._options.doubleTapTimeThreshold&&a<=o),o=r.primitive,(this._isPrimitiveTapEnabled(o,!1)||this._isPrimitiveTapEnabled(o,!0))&&this._raisePrimitivePointerReleasedEvent(r.point,r.location,r),o=nt.isMapsAnswer&&!nt.isMapsVertical,a||!this._coreConfig.delayMapClickEvent&&!o?this._processTapEvent(r,a):this._tapTimeoutId=Microsoft.Maps.setTimeout(function(){return s._processTapEvent(r,!1)},this._options.doubleTapTimeThreshold),this._previousTapTimestamp=n,this._previousTapPressEventArgs=r),this._resetStateToAwaitingInput()):2===this._state&&1===e.button?this._state=1:7===this._state?(e.button===r.button?this._raiseBoxZoomStoppedEvent(e.point,e.location):this._raiseBoxZoomCanceledEvent(),this._resetStateToAwaitingInput()):8===this._state&&1===e.button?(this._raisePanContinuedEvent(e.point,e.location),this._panMapToPoint(r.location,e.point,!0),this._releasePointerCapture(),0!=this._map.getMapOptions().enableInertia?(this._inertia.start([t],{angularVelocity:0,expansionVelocity:0,linearVelocity:this._capLinearVelocity(t.getLastVelocity())}),this._state=11):this._doPostLinearInertiaWork(t)):9===this._state&&1===e.button?(this._raisePrimitiveMoveContinuedEvent(e.point,e.location,r),this._releasePointerCapture(),a=0!=this._map.getMapOptions().enableInertia&&!(10===rt.Browser.ie_version),n=r.primitive.isMoveInertiaEnabled&&r.primitive.isMoveInertiaEnabled(),a&&n?(this._inertia.start([t],{angularVelocity:0,expansionVelocity:0,linearVelocity:this._capLinearVelocity(t.getLastVelocity())}),this._state=11):this._doPostLinearInertiaWork(t)):6===this._state&&1===e.button&&(t=this._createManipulationEventArgs(e.timestamp),this._releasePointerCapture(),this._raiseManipulationStoppedEvent(t),this._resetStateToAwaitingInput()),this._activePointers.removeItem(e.identifier))},la.prototype.onPointerCaptureLost=function(){},la.prototype.onPointerCanceled=function(){this._resetStateToAwaitingInput()},la.prototype._zoomOnPointerWheelChanged=function(e){var t=this._map,i=qt.fromLocation(t.getView().cameraLocation,!0),o=qt.fromLocation(t.getTargetView().cameraLocation,!0)-i,a=e.wheelDelta/2,i=Math.abs(a);!i||.7<Math.abs(o)||0<o&&0<a&&a<o||o<0&&a<0&&o<a||yt.zoomAroundLocation(t,e.location,a/=i,!0,1,1)},la.prototype._filterPointerWheelChanged=function(e,t){return t.wheelDelta=t.wheelDelta/2+e.wheelDelta,t},la.prototype.onPointerWheelChanged=function(e){this._map.pointerWheelChanged.invoke(this._getMouseEventArgs("mousewheel",e)),this._verifyInteractionsAreEnabled()&&this._isModeEnabled(4)&&!this._map.getMapOptions().disableZooming&&(e.originalArgs.preventDefault(),e.originalArgs.stopPropagation(),this._pointerWheelChanged.invoke(e))},la.prototype.onContextMenuInvoked=function(e){this._raiseContextMenuInvokedEvent(e.point,e.location,e),this._resetStateToAwaitingInput()},la.prototype._panMapToPoint=function(e,t,i){var o=this._map.getTargetView(),t=this._map.getMode().getCameraForLocationToPoint(e,t,o.cameraLocation.altitude,0);t&&this._map.setView(new Tt(t,o.heading),null,i?2:1,!i)},la.prototype._panMapToSpecificPoint=function(e,t,i){e=this._map.getMode().tryPointToLocation(e),e=this._map.getMode().getCameraForLocationToPoint(e,t,this._map.getView().cameraLocation.altitude,0),t=this._map.getTargetView();e&&this._map.setView(new Tt(e,t.heading),i,1)},la.prototype._applyManipulationToMap=function(e,t){var i,o,a,n=this._map.getMode(),r=this._map.getMapOptions(),s=zt.getVectorSum2D(e.point,e.cumulative.translation),l=this._manipulationStartLocation,p=0,d=0,c=null,h=this._map.getTargetView(),u=h;if(!r.disableZooming){var _=qt.fromLocation(this._manipulationStartView.cameraLocation,!0),g=qt.fromLocation(this._map.getView().cameraLocation,!0),y=(this._manipulationStartLength+e.cumulative.expansion)/this._manipulationStartLength,p=_+zt.log2(y)-g;if(t&&(c=new Kt(this._map,l,s),d=1,(i=this._previousManipulationDeltaTrail.getLastN(4))&&1<i.length)){for(o=0,a=1;a<i.length;a++)o+=i[a].expansion-i[a-1].expansion;0<o?p+=.5:o<0&&(p-=.5)}}r.disablePanning&&r.disableZooming||(s=r.disablePanning?n.tryLocationToPoint(l):s,u=n.getMapViewZoomedAboutLocationAtPoint(h,l,s,p,d)),e=this._manipulationStartView.heading+e.cumulative.rotation,u.heading=e,this._map.setView(u,c,t?1:2)},la.prototype._updateHoverState=function(e){var t,i,o,a=this,n=e.primitive,r=e.hitTarget;this._isHoverEnabled(n)||(r=n=null),this._previousHoverTarget===r&&this._previousHoverPrimitive===n||(this._changeCursor(n,!!n),this._previousHoverTarget=r,this._previousHoverPrimitive=n,clearTimeout(this._hoverDelayTimerId),i=(t=this._activeHoverArgs)&&t.primitive,o=t&&t.hitTarget,n===i&&r===o||(i&&!i.isDisposed&&this._raisePrimitiveHoverStoppedEvent(e.point,e.location,t),n?this._hoverDelayTimerId=Microsoft.Maps.setTimeout(function(){a._isHoverEnabled(n)?(a._activeHoverArgs=e,a._raisePrimitiveHoverStartedEvent(e.point,e.location,e)):a._activeHoverArgs=null},this._coreConfig.primitivesHoverDelay):this._activeHoverArgs=null))},la.prototype._resetStateToAwaitingInput=function(){this._inertia.stop(),this._state=0,this._activePointers.clear(),this._activePointerType=0,this._previousManipulationDeltaTrail.clear(),this._manipulationStartPoint=null,this._manipulationStartView=null,this._releasePointerCapture(),this._resetKeyboardState(),this._previousUntrustedEventArgs=null},la.prototype._resetKeyboardState=function(){this._keyboardState.reset(),this._keyAutoRepeatTimerId&&(clearTimeout(this._keyAutoRepeatTimerId),this._keyAutoRepeatTimerId=null)},la.prototype._createManipulationEventArgs=function(e){var t=this._activePointers.getAt(0),i=this._activePointers.getAt(1),o=t.get(0),a=i.get(0);this._manipulationStartPoint||(r=this._manipulationStartView=this._map.getView(),this._manipulationStartPoint=zt.getMidpoint2D(o.point,a.point),this._manipulationStartLocation=this._map.getMode().tryPointToLocation(this._manipulationStartPoint,r),this._manipulationStartLength=zt.getEuclideanDistance2D(o.point,a.point),this._manipulationStartAngle=zt.getAngleOfVector2D(zt.getVectorDifference2D(o.point,a.point)));var n=t.getLast(),r=i.getLast(),a=zt.getMidpoint2D(n.point,r.point),t=zt.getEuclideanDistance2D(n.point,r.point),i=zt.getAngleOfVector2D(zt.getVectorDifference2D(n.point,r.point)),n=zt.getVectorDifference2D(a,this._manipulationStartPoint),r=t-this._manipulationStartLength,a=-((i-this._manipulationStartAngle)*zt.degreesPerRadian),t=new yi(r,a,n);this._previousManipulationDeltaTrail.isEmpty()&&(this._previousManipulationDeltaTrail.add(t),this._previousManipulationTimestamp=e),i=this._previousManipulationDeltaTrail.getLastExcluding(t);n=new yi(r-(i=i||t).expansion,a-i.rotation,zt.getVectorDifference2D(n,i.translation)),i=e-this._previousManipulationTimestamp,i=this._calculateManipulationVelocities(n,i),i={point:this._manipulationStartPoint,location:this._map.getMode().tryPointToLocation(this._manipulationStartPoint),primitive:o.primitive,layer:o.layer,exclusiveHitTest:o.exclusiveHitTest,cumulative:t,delta:n,isInertial:!1,velocities:i};return this._previousManipulationDeltaTrail.add(t),this._previousManipulationTimestamp=e,i},la.prototype._allowBoxZoom=function(){var e,t,i=this._map;return!(i.getMapOptions().disableZooming||!this._isModeEnabled(1))&&(t=!0,(e=i.getMapOptions().navigationOptions)&&e.lockCameraAltitude?t=!1:(t=!!(i=i.getMode()).allowBoxZoom,"function"==typeof i.allowBoxZoom&&(t=i.allowBoxZoom())),t)},la.prototype._raiseBoxZoomStartedEvent=function(e,t){this._map.boxZoomStarted.invoke({point:e,location:t})},la.prototype._raiseBoxZoomContinuedEvent=function(e,t){this._map.boxZoomContinued.invoke({point:e,location:t})},la.prototype._raiseBoxZoomStoppedEvent=function(e,t){this._map.boxZoomStopped.invoke({point:e,location:t})},la.prototype._raiseBoxZoomCanceledEvent=function(){this._map.boxZoomCancelled.invoke()},la.prototype._raiseMapTappedEvent=function(e,t,i,o){var a=o?this._map.mapDoubleTapped:this._map.mapTapped,i={point:e,location:t,exclusiveHitTest:i.exclusiveHitTest,originalArgs:i.originalArgs};a.invoke(this._getMouseEventArgs(o?"dblclick":"click",i))},la.prototype._raisePrimitiveHoverStoppedEvent=function(e,t,i){var o=i.primitive,a=i.layer,t={point:e,location:t,primitive:o,hitTarget:i.hitTarget,layer:a,exclusiveHitTest:i.exclusiveHitTest},i=this._getMouseEventArgs("mouseout",t);this._map.primitiveHoverStopped.invoke(t),a&&a.primitiveHoverStopped&&a.primitiveHoverStopped.invoke(i),o&&o.mouseout&&o.mouseout.invoke(i)},la.prototype._raisePrimitiveHoverStartedEvent=function(e,t,i){var o=i.primitive,a=i.layer,t={point:e,location:t,primitive:o,hitTarget:i.hitTarget,layer:a,exclusiveHitTest:i.exclusiveHitTest},i=this._getMouseEventArgs("mouseover",t);this._map.primitiveHoverStarted.invoke(t),a&&a.primitiveHoverStarted&&a.primitiveHoverStarted.invoke(i),o&&o.mouseover&&o.mouseover.invoke(i)},la.prototype._changeCursor=function(e,t){e=e&&e.getCursor?e.getCursor():"pointer";this._map.getRootElement().set_style({cursor:t?e:""})},la.prototype._isPrimitiveTapEnabled=function(e,t){var i=!!e;return t?i&&e.isDoubleTapEnabled&&e.isDoubleTapEnabled()&&this._isModeEnabled(256):i&&e.isTapEnabled&&e.isTapEnabled()&&this._isModeEnabled(128)},la.prototype._raisePrimitivePointerPressedEvent=function(e,t,i){var o=i.primitive,a=i.layer,i=this._getMouseEventArgs("mousedown",{point:e,location:t,primitive:o,hitTarget:i.hitTarget,layer:a,exclusiveHitTest:i.exclusiveHitTest,originalArgs:i.originalArgs});a&&a.primitivePointerPressed&&a.primitivePointerPressed.invoke(i),o&&o.mousedown&&o.mousedown.invoke(i)},la.prototype._raisePrimitivePointerReleasedEvent=function(e,t,i){var o=i.primitive,a=i.layer,i=this._getMouseEventArgs("mouseup",{point:e,location:t,primitive:o,hitTarget:i.hitTarget,layer:a,exclusiveHitTest:i.exclusiveHitTest,originalArgs:i.originalArgs});a&&a.primitivePointerReleased&&a.primitivePointerReleased.invoke(i),o&&o.mouseup&&o.mouseup.invoke(i)},la.prototype._raisePrimitiveTappedEvent=function(e,t,i,o){var a=i.primitive,n=i.layer,t={point:e,location:t,primitive:a,hitTarget:i.hitTarget,layer:n,exclusiveHitTest:i.exclusiveHitTest,originalArgs:i.originalArgs},i=this._getMouseEventArgs(o?"dblclick":"click",t);o?(this._map.primitiveDoubleTapped.invoke(t),n&&n.primitiveDoubleTapped&&n.primitiveDoubleTapped.invoke(i),a&&a.dblclick&&a.dblclick.invoke(i)):(this._map.primitiveTapped.invoke(t),n&&n.primitiveTapped&&n.primitiveTapped.invoke(i),a&&a.click&&a.click.invoke(i))},la.prototype._raisePrimitiveMoveStartedEvent=function(e,t,i){var o=i.primitive,a=i.layer,i={point:e,location:t,primitive:o,layer:a,exclusiveHitTest:i.exclusiveHitTest};o&&o.dragstart&&o.dragstart.invoke(this._getMouseEventArgs("dragstart",i)),this._map.primitiveMoveStarted.invoke(i),a&&a.primitiveMoveStarted&&a.primitiveMoveStarted.invoke(i)},la.prototype._raisePrimitiveMoveContinuedEvent=function(e,t,i){var o=i.primitive,a=i.layer,i={point:e,location:t,primitive:o,layer:a,exclusiveHitTest:i.exclusiveHitTest};this._map.primitiveMoveContinued.invoke(i),a&&a.primitiveMoveContinued&&a.primitiveMoveContinued.invoke(i),o&&o.drag&&o.drag.invoke(this._getMouseEventArgs("drag",i))},la.prototype._raisePrimitiveMoveStoppedEvent=function(e,t,i){var o=i.primitive,a=i.layer,i={point:e,location:t,primitive:o,layer:a,exclusiveHitTest:i.exclusiveHitTest};this._map.primitiveMoveStopped.invoke(i),a&&a.primitiveMoveStopped&&a.primitiveMoveStopped.invoke(i),o&&o.dragend&&o.dragend.invoke(this._getMouseEventArgs("dragend",i))},la._manipulationTargetsPrimitive=function(e){return e.primitive&&e.primitive.isManipulationEnabled&&e.primitive.isManipulationEnabled()},la.prototype._raiseManipulationStartedEvent=function(e){la._manipulationTargetsPrimitive(e)?(this._map.primitiveManipulationStarted.invoke(e),e.layer&&e.layer.primitiveManipulationStarted&&e.layer.primitiveManipulationStarted.invoke(e)):(this._applyManipulationToMap(e),this._map.mapManipulationStarted.invoke(e))},la.prototype._raiseManipulationContinuedEvent=function(e){la._manipulationTargetsPrimitive(e)?(this._map.primitiveManipulationContinued.invoke(e),e.layer&&e.layer.primitiveManipulationContinued&&e.layer.primitiveManipulationContinued.invoke(e)):(this._applyManipulationToMap(e),this._map.mapManipulationContinued.invoke(e))},la.prototype._raiseManipulationStoppedEvent=function(e){la._manipulationTargetsPrimitive(e)?(this._map.primitiveManipulationStopped.invoke(e),e.layer&&e.layer.primitiveManipulationStopped&&e.layer.primitiveManipulationStopped.invoke(e)):(this._applyManipulationToMap(e,!0),this._map.mapManipulationStopped.invoke(e))},la.prototype._raiseContextMenuInvokedEvent=function(e,t,i){var o=i.primitive,a=i.layer,i={point:e,location:t,primitive:o,hitTarget:i.hitTarget,layer:a,exclusiveHitTest:i.exclusiveHitTest,originalArgs:i.originalArgs},i=this._getMouseEventArgs("rightclick",i);this._map.contextMenuInvoked.invoke(i),a&&a.contextMenuInvoked&&a.contextMenuInvoked.invoke(i)},la.prototype._raisePanStartedEvent=function(e,t){this._map.mapPanStarted.invoke({point:e,location:t})},la.prototype._raisePanContinuedEvent=function(e,t){this._map.mapPanContinued.invoke({point:e,location:t})},la.prototype._raisePanStoppedEvent=function(e,t){this._map.mapPanStopped.invoke({point:e,location:t})},la.prototype._inertiaCallback=function(e,t,i){this._map&&!this._map.isDisposed()&&t&&(e?this._processLinearInertia(e,t[0],i):this._doPostLinearInertiaWork(t[0]))},la.prototype._processLinearInertia=function(e,t,i){var o=t.get(0),a=t.getLast(),e=new It(e.linearVelocity.x*i,e.linearVelocity.y*i),i=zt.getVectorSum2D(a.point,e),a=this._map.getMode().tryPointToLocation(i),e=o.primitive;e&&e.isMoveEnabled&&e.isMoveEnabled()?this._raisePrimitiveMoveContinuedEvent(i,a,o):(this._panMapToPoint(o.location,i,!0),this._raisePanContinuedEvent(i,a)),t.add({pointerType:o.pointerType,identifier:o.identifier,point:i,timestamp:Date.now()})},la.prototype._doPostLinearInertiaWork=function(e){var t=e.getLast().point,i=this._map.getMode().tryPointToLocation(t),o=e.get(0),e=o.primitive;e&&e.isMoveEnabled&&e.isMoveEnabled()?this._raisePrimitiveMoveStoppedEvent(t,i,o):(this._panMapToPoint(o.location,t,!1),this._raisePanStoppedEvent(t,i)),this._resetStateToAwaitingInput()},la.prototype._calculateManipulationVelocities=function(e,t){var i=null,o=null,a=null,a=0<t?(i=e.expansion/t,o=e.rotation/t,new It(e.translation.x/t,e.translation.y/t)):new It(o=i=0,0);return{expansionVelocity:i,angularVelocity:o,linearVelocity:a}},la.prototype._isPointerEventTargetingMe=function(e){for(var t,i=e.element,o=!1;i&&!o;)(o=i.className&&-1!==i.className.indexOf("ms-composite")||"ms-composite"===i.getAttribute("data-events-for"))||(i=i.parentElement);if(!o)return!1;for(t=i;t&&!t.classList.contains("MicrosoftMap");)t=t.parentElement;return t===this._mapElement},la.prototype._captureKeyboardNavProperties=function(){var e=this._map.getActualSize()||{width:0,height:0};this._keyboardNavPreviousCenterPoint=new It(e.width/2,e.height/2)},la.prototype._applyKeyboardPanOperation=function(e,t){var i=new It(this._keyboardNavPreviousCenterPoint.x,this._keyboardNavPreviousCenterPoint.y);this._keyboardState.isPanUpRequested()&&(i.y+=e),this._keyboardState.isPanDownRequested()&&(i.y-=e),this._keyboardState.isPanLeftRequested()&&(i.x+=e),this._keyboardState.isPanRightRequested()&&(i.x-=e),this._panMapToSpecificPoint(this._keyboardNavPreviousCenterPoint,i,t),this._keyboardNavPreviousCenterPoint=i,this._keyboardNavPreviousCenterLocation=this._map.getMode().tryPointToLocation(i)},la.prototype._applyKeyboardZoomOperation=function(e,t){var i=0;this._keyboardState.isZoomInRequested()?i=e:this._keyboardState.isZoomOutRequested()&&(i=-e);var o=this._map,a=this._keyboardNavPreviousCenterPoint.clone(),e=yt.getViewportCenterOffset(o);a.x+=e.width,a.y+=e.height,a=o.getMode().tryPointToLocation(a),yt.zoomAroundLocation(o,a,i,!0,1,t)},la.prototype._applyMapTypeSwitchOperation=function(){var t,e,i,o=this._map.getNavigationBar(),a=ft.none,n=this._map.getMapType().id,r=!0;o&&(n=(t=o.getHelper()).getMapType(),r=t.getLabelVisible()),this._keyboardState.isKeyPressed(82)&&n!==ft.road?a=ft.road:this._keyboardState.isKeyPressed(65)||this._keyboardState.isKeyPressed(72)?(a=ft.aerial,r=this._keyboardState.isKeyPressed(72)):this._keyboardState.isKeyPressed(79)||this._keyboardState.isKeyPressed(66)?this._map.getMapOptions().disableBirdseye||(e=nt.isMapsVertical&&!st._isFeatureEnabled("birdseyeV2UI"),a=e?ft.birdseye:ft.birdseyeV2,r=this._keyboardState.isKeyPressed(66)):this._keyboardState.isKeyPressed(83)&&(a=ft.ordnanceSurvey),(e=this._map.createMapType(a)).id==a&&(i=!0,o?(t.isEnabled(o.getRootElement())&&t.hideDropDownMenu(),n!==a?a===ft.birdseyeV2?(o=this._map.getView(),Oe.BirdseyeV2Manager.getIsBirdseyeV2Available(this._map.getConfig(),o.cameraLocation,0,function(e){e?(t.setLabelVisible(!!r),t.setMapType(a),i=t.supportLabelToggle(),t.updateLabelToggleForBirdseyeV2(null,!0)):t.showBirdseyeV2NotAvailableTip(!1)},this._map.getViewport())):(t.setMapType(a),this._aerialBirdsEyeTransitionManager.requestMapType(a),t.setLabelVisible(!!r),i=t.supportLabelToggle()):a===ft.birdseyeV2&&(t.setLabelVisible(!!r),t.updateLabelToggleForBirdseyeV2(null,!0))):a!==ft.birdseyeV2&&(n!==a&&this._map.setMapType(e),this._aerialBirdsEyeTransitionManager.requestMapType(a)),this._map.getLabelController().setIsLabelsEnabled(!i||!!r))},la.prototype._onKeyAutoRepeatTimer=function(){var e=this;3===this._state&&this._keyboardState.isNavigationRequested()&&(this._captureKeyboardNavProperties(),this._keyboardState.isPanOperationRequested()?(this._raisePanStartedEvent(this._keyboardNavPreviousCenterPoint,this._keyboardNavPreviousCenterLocation),this._state=4):this._keyboardState.isZoomOperationRequested()&&(this._state=5),Microsoft.Maps.setTimeout(function(){return e._onKeyRepeatingTimer()},this._options.autoRepeatTimerInterval)),this._keyAutoRepeatTimerId=null},la.prototype._onKeyRepeatingTimer=function(){var e=this;this._verifyInteractionsAreEnabled()&&(!this._map.getMapOptions().disablePanning&&this._isModeEnabled(32)&&4===this._state?this._keyboardState.isPanOperationRequested()?(this._applyKeyboardPanOperation(this._options.repeatPanDistance,null),this._raisePanContinuedEvent(this._keyboardNavPreviousCenterPoint,this._keyboardNavPreviousCenterLocation),Microsoft.Maps.setTimeout(function(){return e._onKeyRepeatingTimer()},this._options.autoRepeatTimerInterval)):(this._raisePanStoppedEvent(this._keyboardNavPreviousCenterPoint,this._keyboardNavPreviousCenterLocation),this._resetStateToAwaitingInput()):!this._map.getMapOptions().disableZooming&&this._isModeEnabled(8)&&5===this._state&&(this._keyboardState.isZoomOperationRequested()?(this._applyKeyboardZoomOperation(this._options.repeatZoomDistance),Microsoft.Maps.setTimeout(function(){return e._onKeyRepeatingTimer()},this._options.autoRepeatTimerInterval)):this._resetStateToAwaitingInput()))},la.prototype._capLinearVelocity=function(e){var t;return(t=zt.getMagnitudeOfVector2D(e))<=this._options.maximumInitialLinearInertiaSpeed?e:(t=this._options.maximumInitialLinearInertiaSpeed,e=zt.getAngleOfVector2D(e),zt.getVector2DFromMagnitudeAndDirection(t,e))},la.prototype._capManipulationVelocities=function(e){var t=this._capLinearVelocity(e.linearVelocity),i=e.expansionVelocity;return Math.abs(i)>this._options.maximumInitialExpansionInertiaSpeed&&(i=this._options.maximumInitialExpansionInertiaSpeed*(0<i?1:-1)),e=e.angularVelocity,{linearVelocity:t,expansionVelocity:i,angularVelocity:e=Math.abs(e)>this._options.maximumInitialAngularInertiaSpeed?this._options.maximumInitialAngularInertiaSpeed*(0<e?1:-1):e}},la.prototype._acquirePointerCapture=function(){rt.Events.capture_mouse(this._mapElement)},la.prototype._releasePointerCapture=function(){rt.Events.release_mouse()},la.prototype._trimPointers=function(){for(var e,t,i=0,o=this._activePointers.getCount();i<o;i++)t=(e=this._activePointers.getAt(i)).getLast(),e.clear(),e.add(t)},la.prototype._verifyInteractionsAreEnabled=function(){return!this._options.disableAllInteractions||(this._resetStateToAwaitingInput(),!1)},la.prototype._isHoverEnabled=function(e){return e&&!e.isDisposed&&e.isHoverEnabled&&e.isHoverEnabled()&&!this._options.disableAllInteractions&&this._isModeEnabled(64)},la.prototype._isModeEnabled=function(e){return!!(this._options.enabledInteractionModes&e)},la.prototype._watchForTapAndHold=function(){var e,t,i=this;Ye.assert(1===this._state,"Must start watch in firstPointerPressed state."),e=this._activePointers.getAt(0),t=e.get(0),Ye.assert(4===t.pointerType||3===t.pointerType,"Watch is only applicable for touch and pen holds."),this._tapAndHoldTimerId=Microsoft.Maps.setTimeout(function(){1===i._state&&i.onContextMenuInvoked(t)},la._tapAndHoldInterval)},la.prototype._updateMapInteractionModes=function(){var e=this._map.getMapOptions();e.disableScrollWheelZoom?this.disableInteractionModes(4):this.enableInteractionModes(4),e.disableKeyboardInput&&(3===this._state||4===this._state||5===this._state?this._resetStateToAwaitingInput():this._resetKeyboardState())},la._tapAndHoldInterval=750,la),Li=(Qt(sa,Le=Bt),sa.prototype.onPrimitivesChanged=function(){this.invalidated.invoke()},sa.prototype.getPrimitives=function(e,t){t&&t({primitives:this.getMapPrimitives()})},sa.prototype.attach=function(e){var t=this;!this.map&&e&&(this.map=e,this.events.push(e.mapTapped.add(function(e){return t._onMapTapped(e)})),this.events.push(e.primitiveTapped.add(function(e){return t._onMapTapped(e)})),this._createLayer())},sa.prototype.dispose=function(){var e,t;if(this.events){for(e=this.events.length,t=0;t<e;t++)this.events[t].dispose();this.events=null}this.layer&&(this.map.getLayers().remove(this.layer),this.layer.dispose(),this.layer=null)},sa.prototype.setCenter=function(e){var t=this.map.getActualSize(),i=new It(t.width/2,t.height/2),o=this.map.getView(),t=o.heading,o=o.cameraLocation.altitude,o=this.map.getMode().getCameraForLocationToPoint(e,i,o,0),t=new Tt(o,t);this.map.setView(t,null,0)},sa.getLocationsForPrimitivesInView=function(e){if(!e)throw"The 'primitives' parameter cannot be null or undefined.";return sa._getLocations(e)},sa.getUniqueId=function(){return"Layer_"+sa._layerIndex++},sa._getLocations=function(e){var t,i,o,a,n,r,s,l,p,d=[];if(e)for(t=e.length,i=0;i<t;i++)if((o=e[i]).geometry)switch(o.geometryType){case 1:a=o.geometry,d.push(new bt(a.y,a.x));break;case 2:for(n=o.geometry,Ye.assert(n.x.length===n.y.length,"x and y values should be of equal length"),l=n.x.length,r=0;r<l;r++)d.push(new bt(n.y[r],n.x[r]));break;case 3:for(var c=o.geometry.rings,h=c.length,u=0;u<h;u++)for(s=c[u],Ye.assert(s.x.length===s.y.length,"x and y values should be of equal length"),l=s.x.length,p=0;p<l;p++)d.push(new bt(s.y[p],s.x[p]));break;default:Ye.assert(!1,"Geometry Type is not defined for the primitive")}return d},sa.prototype._createLayer=function(){var t=this;this.layer=new Ut(sa.getUniqueId(),this,null,sa._zOrder++),this.map.getLayers().insert(this.layer),this.events.push(this.layer.primitiveTapped.add(function(e){t._onLayerTapped(e)}))},sa.prototype._onLayerTapped=function(e){e.primitive&&e.layer&&this.setSelectedPrimitive(e.primitive)},sa.prototype._onMapTapped=function(e){e.primitive!==this.getSelectedPrimitive()&&this.setSelectedPrimitive(null)},sa._zOrder=8e3,sa._layerIndex=1e4,sa),ki=(ra.prototype.serialize=function(){return this._map.getMode().getState()},ra.prototype.deserialize=function(e){var t=this,i=this._map,o=e;0===(o=!o||void 0===o.mode?this._defaultState:o).mode?i.navigationBarLoaded.addOne(function(){return t._initCompositeMode(i,o)},!1,!0):2===o.mode&&this._initStreetsideMode(i,o)},ra.prototype._initialize=function(e){var t=this,i=this._map,o=i.getMode();Ye.assert(!!o,"Initialize called with no map mode"),this._defaultState=i.getMode().getState(),Ye.assert(!!this._defaultState,"Map mode has no state"),this.serializableObjectChanged=new dt,e.register("MapModeStateHistory",this);var e=function(e){return function(){t._isSettingState||t.serializableObjectChanged.invoke({magnitude:e})}},a=e(1),n=e(2);i.mapModeChanged.add(n),i.mapTypeChanged.add(function(e){(e.newMapTypeId===ft.birdseyeV2||e.oldMapTypeId===ft.birdseyeV2?n:a)()}),i.getLabelController().labelsEnabledChanged.add(a),i.viewChanged.addThrottled(a,500)},ra.prototype._initCompositeMode=function(t,i){var o=this;t.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(i.hasRequestedBE?ft.birdseye:ft.aerial),t.getContainer().instanceAsync("CompositeMapMode",function(e){o._isSettingState=!0,t.setMode(e),st._isFeatureEnabled("birdseyeV2UI")||t.setBaseLayers(i.style),e=i.labelVisibility===Ft.visible,t.getNavigationBar().getHelper().setLabelVisible(e),t.getLabelController().setIsLabelsEnabled(e),e=new Tt(bt.cloneFrom(i.centerPoint),i.direction),t.setView(e,null),st._isFeatureEnabled("birdseyeV2UI")&&t.setBaseLayers(i.style),o._isSettingState=!1})},ra.prototype._initStreetsideMode=function(e,o){var a=this;e.getContainer().instanceAsync("StreetsideModeBootstrapper",function(e){function t(){a._isSettingState=!1}var i=o;a._isSettingState=!0,e.show(bt.cloneFrom(i.centerPoint),{heading:i.direction,pitch:i.pitch,overviewMapMode:i.overviewMap,zoomIn:!0,entryPoint:fi.EntryPointBrowserHistory,perfClickToImmersionTimeSource:Ti.BrowserHistoryToImmersionTime,onSuccessLoading:t,onErrorLoading:t})})},ra),Bi=(na.prototype.requestMapType=function(e){var t=this._maxZoomLevel,i=t;e===ft.aerial?i=this._maxZoomLevelAerial:e===ft.birdseye&&(i=this._maxZoomLevelBirdsEye),t!==i&&(this._maxZoomLevel=i,this._handleZoomChange(this._map.getMercatorZoomLevel()),this.changed.invoke())},na.prototype.hasRequestedBirdsEye=function(){return!this._map.getMapOptions().disableBirdseye&&this._maxZoomLevel===this._maxZoomLevelBirdsEye},na.prototype._handleMapType=function(e){var t,i=this,o=this._map.getMapType().id;o===ft.aerial||o===ft.birdseye?(this._activate(),t=this._map.getMercatorZoomLevel(),e?Microsoft.Maps.setTimeout(function(){i._handleZoomChange(t)},0):this._handleZoomChange(t)):this._deactivate()},na.prototype.dispose=function(){this._deactivate(),this._mapTypeChangedHandler&&(this._mapTypeChangedHandler.dispose(),this._mapTypeChangedHandler=null)},na.prototype._activate=function(){var e,t,i=this;this._isActive||(e=this._map,(t=this._handlers=[]).push(e.mapZoomStopped.add(function(e){return i._handleZoomChange(e.zoom)})),t.push(e.viewChanged.add(function(){i._handleZoomChange(yt.getMercatorZoomLevel(e))})),this._isActive=!0)},na.prototype._deactivate=function(){var e,t,i;if(this._isActive){if(e=this._handlers){for(t=0,i=e.length;t<i;t++)e[t].dispose();this._handlers=[]}this._isActive=!1}},na.prototype._handleZoomChange=function(e){this._isActive&&(!this._map.getMapOptions().disableBirdseye&&e>this._maxZoomLevel?this._setMapType(ft.birdseye):this._setMapType(ft.aerial))},na.prototype._setMapType=function(e){this._isActive&&this._map.getMapType().id!==e&&this._map.setBaseLayers(e)},na.DEFAULT_ZOOM_CUT_OFF_FOR_BIRDSEYE_MODE=16,na.DEFAULT_ZOOM_CUT_OFF_FOR_AERIAL_MODE=21,na),Ei=(Qt(aa,Se=Ge),aa.prototype._onMouseEnter=function(){var e=this.getHelper();nt.isMapsVertical||e.isDropDownShowing()||e.checkBirdseyeV2ForDropdown(),e.showDropDownMenu()},aa.prototype._onMouseLeave=function(e){var t=this.getHelper();e.toElement?t.checkHideDropDownMenu(e.toElement):t.hideDropDownMenu()},aa.prototype._onBlur=function(e){this.getHelper().checkHideDropDownMenu(e.relatedTarget)},aa.prototype.boolToVisibility=function(e){return e?"visible":"hidden"},aa.prototype.getChildren=function(){var e,t;if(!this._children)for(e=this.getRootElement()[0].childNodes,this._children=[],t=0;t<e.length;t++)this._children.push(rt(e[t]));return this._children},aa.prototype.onStyleChanged=function(e,t){var i,o=this.getRootElement();if(t&&st._isArray(t))for(i=0;i<t.length;i++)o.set_style&&o.set_style(t[i]);else o.set_style&&o.set_style(t)},aa.prototype._styleConverter=function(e){var t,i,o;if("string"!=typeof e)return e;for(i in t={},e.split(";"))o=i.split(":"),Ye.assert(2===o.length,"Style format is invalid"),t[i[0]]=i[1];return t},aa),wi=(Qt(oa,Ce=Ei),oa.prototype.init=function(e,t,i,o){var a=this;this.id=e,this.className=t,this.setTitle(i),this._onNavBarButtonClick=o,this.setTemplate(new Qe('<a id="{TemplateBinding id}"   class="NavBar_Button"   title="{TemplateBinding title}"   href="#"   role="button"   event:click="onClick"   event:mousedown="stopEvent"   event:mouseup="stopEvent"   event:mouseout="onMouseOut"   event:touchstart="stopEvent"   event:touchmove="stopEvent"   event:touchend="stopEvent"   event:contextmenu="stopEvent"   event:focus="onFocus">    <div class="NavButton_Icon"></div></a>',{onClick:function(e){return a._onClick(e)},onMouseOut:function(){try{a.getRootElement()[0].blur()}catch(e){}},onFocus:function(){return a._onFocus()},stopEvent:function(e){return e.stopPropagation()}}))},oa.prototype._onClick=function(e){e.stopPropagation(),Ci.ignoreEvent(e),this._onNavBarButtonClick&&this._onNavBarButtonClick(e)},oa.prototype._onFocus=function(){this.getHelper().checkHideDropDownMenu(this.getRootElement()[0])},oa.prototype._postInit=function(){this.className&&this.getRootElement().add_class(this.className)},oa),Di=(Qt(ia,Me=wi),ia.prototype.updateHandler=function(e){this._mapRoot||(this._mapRoot=this.getHelper().getMap().getMode().getRootElement()),e?this._mapRoot.add_event(this.keydownEventName,this._keyDownHandler):this._mapRoot.remove_event(this.keydownEventName,this._keyDownHandler)},ia.prototype._escHandler=function(e){27===e.keyCode&&this.getHelper().exitBirdseyeV2()},ia.prototype.dispose=function(){this._mapRoot&&(this._mapRoot.remove_event(this.keydownEventName,this._keyDownHandler),this._mapRoot=null),this._keyDownHandler=void 0,Me.prototype.dispose.call(this)},ia);Qe.registerControl("BirdseyeV2ExitButton",Di),Qt(ta,be=Ei),ta.prototype.refreshTemplate=function(){this._updateControlConfigs(),this.setTemplate(new Qe(this._getSelectorTemplate())),this._instantiateExitButton()},ta.prototype.getBirdseyeV2ExitButton=function(){return this._birdseyeV2ExitButton},ta.prototype.setGeochainManager=function(e){var t,i=this;this._geochainManager=e,this._updateGeochain(),(t=this.getHelper().getMap()).mapTypeChanged.add(function(){i._updateGeochain()}),t.frameManagerLoaded.addOne(function(){i.disposables.push(t.getFrameManager().frameRendered.add(function(){i._updateGeochain()}))},!1,!0)},ta.prototype.dispose=function(){this._birdseyeV2ExitButton&&this._birdseyeV2ExitButton.dispose(),be.prototype.dispose.call(this)},ta.prototype._updateControlConfigs=function(){var e=this.getHelper();this._isFullControl=e&&e.getIsBirdseyeV2FullControl(),this._isNewLayout=e&&e.getIsBirdseyeV2ControlNewLayout()},ta.prototype._updateGeochain=function(){var a=this;this.getHelper().getMap().getMapType().id===ft.birdseyeV2&&this._geochainManager.getGeochain(function(e){for(var t,i=[],o=0;o<e.length;o++)i.push(e[o].displayName);t=i.join(", "),a.getRootElement().select(".birdseyeV2Geochain").set_text(t)})},ta.prototype._instantiateCopyrightElement=function(){var t=this,e=this.getHelper().getMap();this.disposables.push(e.copyrightControlLoaded.addOne(function(e){t._bindCopyrightUpdatedEvent(e)},!1,!0))},ta.prototype._bindCopyrightUpdatedEvent=function(i){var o=this;this.disposables.push(i.copyrightUpdated.add(function(){var e=o.getRootElement().select(".birdseyeV2InfoExitControl.left.top"),t="";0<i.copyrightString.length?(t='<div class="bm_birdseyeV2Attribution">'+i.copyrightString+"</div>",e.set_style({display:""})):e.set_style({display:"none"}),e.set_html(t)}))},ta.prototype._instantiateExitButton=function(){var e,t,i;this._birdseyeV2ExitButton||(this._birdseyeV2ExitButton=new Di(this._navBarControlArgs)),e=this._isFullControl?this.getRootElement().select(".birdseyeV2InfoExitControl.right"):this.getRootElement(),t=this._birdseyeV2ExitButton.getRootElement(),this._isNewLayout?e.append(t):(i=this.getRootElement().select(".be2LabelToggleContainer"),e.insertBefore(t,i))},ta.prototype._getSelectorTemplate=function(){var e,t,i="<BirdseyeV2LabelToggle></BirdseyeV2LabelToggle>",o="be2LabelsEnabled",i=this._isFullControl?(e="birdseyeV2InfoExitControl",t=nt.isMapsVertical?"birdseyeV2WithTaskBar":"",this._isNewLayout?'<div class="'+e+" "+t+" "+o+'">                        <div class="'+e+' top">                            <div class="'+e+' left">                                <div class="'+e+' left top"></div>                                <div class="'+e+' left bottom">                                    <div class="birdseyeV2Geochain"></div>                                </div>                            </div>                            <div class="'+e+' right">                            </div>                        </div>                        <div class="'+e+' label bottom">                            '+i+"                        </div>                    </div>":'<div class="'+e+" "+o+'">                        <div class="'+e+' left">                            <div class="'+e+' left bottom">                                <div class="birdseyeV2Geochain"></div>                            </div>                        </div>                        <div class="'+e+' right">                            '+i+"                        </div>                    </div>"):"<div class='NavBarButton_Container "+o+"'>"+i+"</div>";return i},e=ta,Qt(ea,Te=Ei),ea.prototype._onClick=function(e){var t;Ci.ignoreEvent(e),this._isToggleDisabled()||(e=!(t=this.getRootElement().select("#be2ToggleInput")[0]).checked,t.checked=e,this.getHelper().setLabelVisible(e),this.getHelper().getMap().getLabelController().setIsLabelsEnabled(e))},ea.prototype._isToggleDisabled=function(){return this.getRootElement().has_class("disabled")},Qe.registerControl("BirdseyeV2LabelToggle",ea),Qt($o,fe=Ei),$o.prototype.updateTemplate=function(e,t,i){var o=this;this.setTemplate(new Qe('<div class="slot '+e+'" tabindex="0" role="option" aria-selected="false" event:blur="onBlur" event:click="onClick" event:keyup="onKeyUp" event:touchstart="onClick" event:contextmenu="onContextMenu"><div class="mapTypeIcon" /><div class="pie-label labelStyle">'+t+'</div><div class="pie-label-description labelStyleDescription">'+i+"</div></div>",{onClick:function(e){return o._onMapTypeButtonClick(e)},onKeyUp:function(e){return o._onMapTypeButtonKeyUp(e)},onContextMenu:function(e){return e.stopPropagation()},onBlur:function(e){return o._onBlur(e)}}))},$o.prototype.onClick=function(){},$o.prototype.onKeyUp=function(e){this._onMapTypeButtonClick(e)},$o.prototype.setMapType=function(e){this._mapType=e},$o.prototype._onMapTypeButtonClick=function(e){var t;if(Ci.ignoreEvent(e),t=this.getHelper(),(a=nt.features.birdseyeV2UI)&&a.isEnabled&&this._mapType==ft.birdseye)this.onClick(e);else if(this._mapType!=ft.birdseye||t.isBirdseyeSupported()){if(this._mapType!==ft.streetside&&!this.getRootElement().has_class("disabled")){t.getMapRoot().select("#NavBar_MapTypeText").set_text(this._title);var i=t.getMapRoot().select("#NavBar_MapTypeIcon"),o=i.get_attr("class"),a=!nt.isSDK||t.getNavBarMode()===Mt.square,a=o.replace(a?"NavBar_MapTypeButtonIcon NavBar_MapTypeButtonHeight V8MapStyle":"NavBar_MapTypeButtonIcon NavBar_MapTypeButtonHeight","").trim();switch(i.remove_class(a),this._mapType){case ft.road:i.add_class("selectorIconRoad");break;case ft.aerial:i.add_class("selectorIconAerial");break;case ft.birdseye:i.add_class("selectorIconBirdseye");break;case ft.ordnanceSurvey:i.add_class("selectorIconOrdnanceSurvey")}}t.invokeMapTypeButtonClicked(this._mapType),this.onClick(e),this._switchMapMode()}},$o.prototype._onMapTypeButtonKeyUp=function(e){this.getHelper().isKeyUp(e,13)?this.onKeyUp(e):this.getHelper().isKeyUp(e,27)&&this.getHelper().setFocusOnMapLayersButton()},$o.prototype._switchMapMode=function(){var e,t;this._mapType!==ft.streetside&&(e=this.getRootElement(),(t=this.getHelper()).isEnabled(e)&&(nt.isMobile&&t.hideDropDownMenu(),t.getMapType()!==this._mapType&&(t.setMapType(this._mapType),t.handleLabelsVisibleOnMapTypeChanged())))},Qt(Xo,ve=o=$o),Xo.prototype.onClick=function(){this.getHelper().getMap().getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(ft.aerial)},a=Xo,Qe.registerControl("AerialButton",a),Qt(Yo,me=o),Yo.prototype.onClick=function(){var e=this.getHelper().getMap();nt.isMapsVertical?Yo.birdseyeUIConfig&&Yo.birdseyeUIConfig.isEnabled?ai.invokeHandler(Xt.birdsEyeV2DialogDataHandlerKey):e.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(ft.birdseye):this.getRootElement().has_class("disabled")||(e.setMapType(e.createMapType(ft.birdseyeV2)),this.getHelper().hideDropDownMenu())},n=Yo,Qe.registerControl("BirdseyeButton",n),Qt(Jo,ye=o),Jo.prototype._typeChanged=function(e,t){var i=ft.road,o="road",a=Rt.L_RadialMenuRoadButtonToolTip_Text,n=Rt.L_RadialMenuRoadButtonDescription_Text;switch(t){case"Grayscale":i=ft.grayscale,o="grayscale",a=Rt.L_RadialMenuGrayscaleButtonToolTip_Text,n=Rt.L_RadialMenuGrayscaleButtonDescription_Text;break;case"CanvasDark":i=ft.canvasDark,o="canvasdark",a=Rt.L_RadialMenuCanvasDarkButtonToolTip_Text,n=Rt.L_RadialMenuCanvasDarkButtonDescription_Text;break;case"CanvasLight":i=ft.canvasLight,o="canvaslight",a=Rt.L_RadialMenuCanvasLightButtonToolTip_Text,n=Rt.L_RadialMenuCanvasLightButtonDescription_Text;break;case"OrdnanceSurvey":i=ft.ordnanceSurvey,o="ordnanceSurvey",a=Rt.L_RadialMenuOrdnanceSurveyButtonToolTip_Text,n=Rt.L_RadialMenuOrdnanceSurveyButtonDescription_Text;break;case"RoadDark":i=ft.roadDark,o="night",a=Rt.L_RadialMenuRoadDarkButtonToolTip_Text,n=Rt.L_RadialMenuRoadDarkButtonDescription_Text}this.setMapType(i),this.updateTemplate(o,a,n)},r=Jo,Qe.registerControl("GeneralMapTypeButton",r),Qt(jo,ge=Ei),jo.prototype._onClick=function(e){Ci.ignoreEvent(e),this.getHelper().supportLabelToggle()&&this._toggleLabel()},jo.prototype._onKeyUp=function(e){this.getHelper().supportLabelToggle()&&(this.getHelper().isKeyUp(e,13)?this._toggleLabel():this.getHelper().isKeyUp(e,27)&&this.getHelper().setFocusOnMapLayersButton())},jo.prototype._toggleLabel=function(){var e=this.getRootElement().select("#navbarLabelToggleInput")[0],t=this.getHelper().getMap(),i=!this.getHelper().getLabelVisible();this.getHelper().setLabelVisible(i),e.checked=i,this.getRootElement().set_attr("aria-checked",i+""),e.setAttribute("checked",String(i)),t.getLabelController().setIsLabelsEnabled(i),e=rt(e.parentElement),i?e.remove_class("unchecked"):e.add_class("unchecked"),nt.isMobile&&this.getHelper().hideDropDownMenu()},Qe.registerControl("LabelToggleButton",jo),Qt(Qo,_e=o),Qo.prototype.onClick=function(e){this.getHelper().isStreetsideButtonEnabled()?(this._toggleStreetside(e),nt.isMobile&&this.getHelper().hideDropDownMenu()):e.stopPropagation()},Qo.prototype.onKeyUp=function(e){this.getHelper().invokeMapTypeButtonClicked(ft.streetside),this.onClick(e)},Qo.prototype._toggleStreetside=function(e){var t=this,i=this.getRootElement();this.getHelper().isEnabled(i)&&(this._streetSideExitHandler||(this._streetSideExitHandler=this.getHelper().streetSideExitEvent.add(function(){return t._onStreetSideExit()})),this.getHelper().toggleSwitch(i),-1===i[0].getAttribute("class").indexOf("selected")?i.set_attr("aria-selected","false"):i.set_attr("aria-selected","true"),this.getHelper().streetsideHandler(e))},Qo.prototype._onStreetSideExit=function(){var e=this.getRootElement();this.getHelper().isSwitchButtonTurnedOn(e)&&this.getHelper().toggleSwitch(e)},Qo.prototype.dispose=function(){_e.prototype.dispose.call(this),this._streetSideExitHandler&&this._streetSideExitHandler.dispose()},s=Qo,Qe.registerControl("StreetsideButton",s),Qt(Go,ue=Ei),Go.prototype.getMapTypeButton=function(e){return this._resolveMapTypeButton(e)},Go.prototype._onRendered=function(){var e,t,i,o,a,n=this,r=this.getHelper().getMap();for(this.disposables.push(r.mapTypeChanged.add(function(){n._selectMapTypeButton()})),this.disposables.push(r.getNavigationBar().getAerialBirdsEyeTransitionManager().changed.add(function(){n._selectMapTypeButton()})),e=this.getRootElement().select(".slot"),a=0;a<e.length;a++)rt(e[a]).add_event("keydown",this._keyDownHandler);if((t=this.getRootElement().select(".switchSlot"))&&0<t.length&&rt(t[0]).add_event("keydown",this._keyDownHandler),st._isFeatureEnabled("supportedMaps")){for(this._mapTypeButtonMap={},this._mapTypeButtonCollection=new kt,this.disposables.push(r.getMapTypes().changed.add(function(e){return n._mapTypeCollectionChanged(e)})),this.disposables.push(this._mapTypeButtonCollection.changed.add(function(e){return n._mapTypeButtonCollectionChanged(n.getRootElement(),e)})),i=[],o=r.getMapTypes(),a=0;a<o.length;a++)i.push(o[a]);this._mapTypeCollectionChanged({added:i})}else this._selectMapTypeButton()},Go.prototype._mapTypeButtonCollectionChanged=function(e,t){var i,o;if(t.added)for(e=this.getRootElement(),i=0;i<t.added.length;i++)o=t.added[i],e.insertBefore(o.getRootElement(),e.select(".labelToggle"));else if(t.removed)for(i=0;i<t.removed.length;i++)(o=t.removed[i]).getRootElement().removeFromParent();this._selectMapTypeButton()},Go.prototype._mapTypeCollectionChanged=function(e){var t,i,o,a;if(e.added){for(t=[],o=0;o<e.added.length;o++)i=e.added[o],(i=this._resolveMapTypeButton(i))&&t.push(i);this._mapTypeButtonCollection.insertAll(t)}else if(e.removed)for(o=0;o<e.removed.length;o++)a=e.removed[o],(a=this._resolveMapTypeButton(a))&&this._mapTypeButtonCollection.remove(a)},Go.prototype._resolveMapTypeButton=function(e){var t,i=this._mapTypeButtonMap[e.id];if(!i){switch(t=this._radialMenuControlArgs,e.id){case ft.road:i=new r(t,"Road");break;case ft.ordnanceSurvey:i=new r(t,"OrdnanceSurvey");break;case ft.grayscale:i=new r(t,"Grayscale");break;case ft.canvasDark:i=new r(t,"CanvasDark");break;case ft.canvasLight:i=new r(t,"CanvasLight");break;case ft.roadDark:i=new r(t,"RoadDark");break;case ft.aerial:i=new a(t);break;case ft.birdseye:case ft.birdseyeV2:i=new n(t);break;case ft.streetside:i=new s(t);break;default:e.displayName&&(i=new o(e.id,e.displayName.toLocaleLowerCase(),e.displayName,"",t))}i&&(this._mapTypeButtonMap[e.id]=i)}return i},Go.prototype._selectMapTypeButton=function(){var e,t=this.getHelper(),i=t.getMap().getMapType().id,o=this.getRootElement(),a=null;switch(i){case ft.road:case ft.highContrast:a=o.select(".slot.road");break;case ft.roadDark:a=o.select(".slot.night");break;case ft.aerial:a=o.select(".slot.aerial"),(e=this.getHelper().getMap().getNavigationBar())&&e.getAerialBirdsEyeTransitionManager().hasRequestedBirdsEye()&&(a=o.select(".slot.birdseye"));break;case ft.birdseye:a=o.select(".slot.birdseye"),t.setMapTypeButtonDisabled(o.select(".slot.streetside"),!1);break;case ft.ordnanceSurvey:a=o.select(".slot.ordnanceSurvey");break;case ft.grayscale:a=o.select(".slot.grayscale");break;case ft.canvasDark:a=o.select(".slot.canvasDark");break;case ft.canvasLight:a=o.select(".slot.canvasLight")}nt.isMapsVertical||(t.setMapTypeButtonDisabled(o.select(".slot.birdseye"),!1),t.isDropDownShowing()&&t.checkBirdseyeV2ForDropdown()),a&&this._select(a[0])},Go.prototype._select=function(e){for(var t,i=this.getRootElement()[0],o=0;o<i.children.length;o++)0<=(t=i.children[o]).className.indexOf("streetside")||(t===e?(t.classList.add("selected"),t.setAttribute("aria-selected","true")):(t.classList.remove("selected"),t.setAttribute("aria-selected","false")))},Go.prototype._getTemplate=function(){var e,t=this.getHelper().getMap().getMapOptions(),i='<div id="RadialMenu" class="NavBar_DropDown menu" event:mouseenter="onMouseEnter" event:mouseleave="onMouseLeave" event:mousewheel="onMouseWheel" event:contextmenu="onContextMenu" role="listbox" aria-multiselectable="true" aria-label="'+(t.disableBirdseye?Rt.L_NavBarOpenRadialMenuToolTip_NoBirdseye_text:Rt.L_NavBarOpenRadialMenuToolTip_Text)+'">';return st._isFeatureEnabled("supportedMaps")||(i+='<GeneralMapTypeButton type="Road"/>',nt.features.aerial.isEnabled&&(i+="<AerialButton></AerialButton>"),1!=t.disableBirdseye&&nt.isSDK&&(i+="<BirdseyeButton></BirdseyeButton>"),!t.disableStreetside&&Vt&&Vt.isEnabled&&(i+="<StreetsideButton></StreetsideButton>"),0<=(e=t.supportedMapTypes||[]).indexOf(Microsoft.Maps.MapTypeId.roadDark)&&(i+='<GeneralMapTypeButton type="RoadDark"/>'),0<=e.indexOf(Microsoft.Maps.MapTypeId.grayscale)&&(i+='<GeneralMapTypeButton type="Grayscale"/>'),0<=e.indexOf(Microsoft.Maps.MapTypeId.canvasDark)&&(i+='<GeneralMapTypeButton type="CanvasDark"/>'),0<=e.indexOf(Microsoft.Maps.MapTypeId.canvasLight)&&(i+='<GeneralMapTypeButton type="CanvasLight"/>'),nt.features.ordnanceSurvey.isEnabled&&(t.supportedMapTypes||0<=e.indexOf(Microsoft.Maps.MapTypeId.ordnanceSurvey))&&(i+='<GeneralMapTypeButton type="OrdnanceSurvey"/>')),(i+="<LabelToggleButton></LabelToggleButton>")+"</div>"},Go.prototype._keyDownHandler=function(e){var t;40===e.keyCode?(t=e.target.nextElementSibling)&&t.focus():38!==e.keyCode||(t=e.target.previousElementSibling)&&t.focus()},i=Go,Qe.registerControl("RadialMenu",i),Qt(Wo,he=Ei),Wo.prototype.dispose=function(){rt(window).remove_event("resize",this._resizeHandler),he.prototype.dispose.call(this)},Wo.prototype._onRenderedAfterInit=function(){var e,t=this;this.navigationHelper=this.getHelper(),this._setText(),(e=this.navigationHelper.getMap()).mapTypeChanged.add(function(){return t._setText()}),e.getNavigationBar().getAerialBirdsEyeTransitionManager().changed.add(function(){return t._setText()})},Wo.prototype._setText=function(){var e,t=this.getRootElement(),i=rt("#MapStyleSelector",t[0]),o=rt("#NavBar_MapTypeText",t[0]),a=rt("#NavBar_MapTypeIcon",t[0]),n="",r="";switch(this.navigationHelper.getMapType()){case ft.road:case ft.mercator:case ft.highContrast:n=Rt.L_RadialMenuRoadButtonToolTip_Text,r="selectorIconRoad";break;case ft.roadDark:n=Rt.L_RadialMenuRoadDarkButtonToolTip_Text,r="selectorIconNight";break;case ft.canvasDark:n=Rt.L_RadialMenuCanvasDarkButtonToolTip_Text,r="selectorIconCanvasDark";break;case ft.canvasLight:n=Rt.L_RadialMenuCanvasLightButtonToolTip_Text,r="selectorIconCanvasLight";break;case ft.grayscale:n=Rt.L_RadialMenuGrayscaleButtonToolTip_Text,r="selectorIconGrayscale";break;case ft.aerial:n=Rt.L_RadialMenuAerialButtonToolTip_Text,r="selectorIconAerial",(e=this.navigationHelper.getMap().getNavigationBar())&&e.getAerialBirdsEyeTransitionManager().hasRequestedBirdsEye()&&(n=Rt.L_RadialMenuBirdseyeButtonToolTip_Text,r="selectorIconBirdseye");break;case ft.birdseye:n=Rt.L_RadialMenuBirdseyeButtonToolTip_Text,r="selectorIconBirdseye";break;case ft.ordnanceSurvey:n=Rt.L_RadialMenuOrdnanceSurveyButtonToolTip_Text,r="selectorIconOrdnanceSurvey"}t=a.get_attr("class").replace("NavBar_MapTypeButtonIcon NavBar_MapTypeButtonHeight","").trim();nt.isSDK&&this.navigationHelper.getNavBarMode()!==Mt.square||(t=t.replace("V8MapStyle","").trim()),a.remove_class(t),a.add_class(r),i.set_attr("title",Rt.L_CurrentMapTypeToolTip_Text.replace("{mapStyle}",n)+" - "+this.tooltip),o.set_text(n)},Wo.prototype._onTouchStart=function(){this.navigationHelper.toggleDropDownMenu()},Wo.prototype._onKeyUp=function(e){(this.navigationHelper.isKeyUp(e,13)||this.navigationHelper.isKeyUp(e,40))&&(this.navigationHelper.showDropDownMenu(),this.navigationHelper.setFocusOnRadialMenu())},Wo.prototype._getSelectorTemplate=function(){var e=!nt.isSDK||this.getHelper().getNavBarMode()===Mt.square,t='<div class="'+("NavBar_MapTypeButtonContainerWrapper"+(e?" V8MapStyle":""))+'">'+(e?'<div class="NavBar_MapTypeButtonContainer NavBar_MapTypeButtonHeight NavBar_Delay withBackground V8MapStyle" id="MapStyleSelector" tabindex="0" title="'+this.tooltip+'" role="link" aria-expanded="false" event:click="onClick" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="onMouseOut" event:mouseleave="onMouseLeave" event:touchstart="onTouchStart" event:mouseenter="onMouseEnter" event:keyup="onKeyUp" event:contextmenu="stopEvent">':'<div class="NavBar_MapTypeButtonContainer NavBar_MapTypeButtonHeight NavBar_Delay'+(nt.isMapsVertical?"":" withBackground")+'" id="MapStyleSelector" tabindex="0" title="'+this.tooltip+'" role="button" aria-expanded="false" event:click="onClick" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="onMouseOut" event:mouseleave="onMouseLeave" event:touchstart="onTouchStart" event:mouseenter="onMouseEnter" event:keyup="onKeyUp" event:contextmenu="stopEvent">')+(e?'<div id="NavBar_MapTypeIcon" class="NavBar_MapTypeButtonIcon NavBar_MapTypeButtonHeight V8MapStyle"></div>':'<div id="NavBar_MapTypeIcon" class="NavBar_MapTypeButtonIcon NavBar_MapTypeButtonHeight"></div>')+(e?'<div id="NavBar_MapTypeText" class="NavBar_MapTypeButtonText NavBar_MapTypeButtonHeight V8MapStyle"></div>':'<div id="NavBar_MapTypeText" class="NavBar_MapTypeButtonText NavBar_MapTypeButtonHeight"></div>');return nt.isMapsVertical||(t+=e?"":'<div class="NavBar_MapTypeButtonDropDownIcon NavBar_MapTypeButtonHeight selectorIconDropDown"></div>'),t+"</div></div>"},l=Wo,Qe.registerControl("SelectorControl",l),c=function(e,t,i){this.displayName=e,this.entityId=t,this.index=i},Qt(Ko,ce=Ei),Ko.prototype.boolToCollapsedClass=function(e){return"geochainActionButton "+(("boolean"==typeof e?e:this._storedCollapsedState)?this._geochainUncollapseClass:this._geochainCollapseClass)},Ko.prototype.boolToContainerCollapsedClass=function(e){return"geochainContainer "+(("boolean"==typeof e?e:this._storedCollapsedState)?this._geochainContainerCollapseClass:"")},Ko.prototype.boolToExpandedString=function(e){return e?"false":"true"},Ko.prototype.setNavigationHelper=function(e){this._navigationHelper=e},Ko.prototype._onRenderedAfterInit=function(){function t(){i.getIsVisible()&&"none"!==i.getRootElement().get_style("display")&&!i.getIsCollapsed()&&i._geochainManager.getGeochain(function(e){i.setGeochainSegments(e)})}var i=this;this._map.frameManagerLoaded.addOne(function(e){e.frameRendered.add(t),e.frameRendered.isPreviouslyInvoked&&t()},!1,!0),this._setDarkClass(this._map.getMapType().id),this._map.mapTypeChanged.add(function(e){var t=e.newMapTypeId!==ft.streetside&&e.newMapTypeId!==ft.birdseyeV2;i.setIsVisible(t),i._setDarkClass(e.newMapTypeId)}),this._map.actualSizeChanged.add(function(){return i._setAutoCollapsed()}),this._setAutoCollapsed()},Ko.prototype._setDarkClass=function(e){nt.isMapsVertical||e!==ft.aerial&&e!==ft.birdseye&&e!==ft.roadDark&&e!==ft.birdseyeV2?this.getRootElement().remove_class("dark"):this.getRootElement().add_class("dark")},Ko.prototype._onSegmentClick=function(e){e.preventDefault();e=parseInt(e.currentTarget.getAttribute("data-index")),this.getGeochainSegments()[e]},Ko.prototype._onFocus=function(){this._navigationHelper.checkHideDropDownMenu(this.getRootElement()[0])},Ko.prototype._onLastLocationClick=function(e){e.preventDefault()},Ko.prototype._onCollapseClick=function(e){var t,i=this;e.stopPropagation(),Ci.ignoreEvent(e),(t=this.getIsCollapsed())?(this._geochainManager.getGeochain(function(e){i.setGeochainSegments(e),ut.setItem("geoChainCollapsed","0")}),this._isAutoCollapsed&&(this._autoresizeEnabled=!1,ut.setItem("geoChainAutoresizeEnabled","0"))):(ut.setItem("geoChainCollapsed","1"),this._previouslyCollapsed=!0,this._autoresizeEnabled=!0,ut.setItem("geoChainAutoresizeEnabled","1")),rt(e.target),this.setIsCollapsed(!t)},Ko.prototype._setAutoCollapsed=function(){this._autoresizeEnabled&&(this._map.getActualSize().width<vt.geochainAutosizeMaxWidth?this._isAutoCollapsed||(this._previouslyCollapsed=this.getIsCollapsed(),this.setIsCollapsed(!0),this._isAutoCollapsed=!0):this._isAutoCollapsed&&(this.getIsCollapsed()&&0==this._previouslyCollapsed&&this.setIsCollapsed(!1),this._isAutoCollapsed=!1))},t=Ko,Qe.registerControl("Geochain",t),Qt(qo,de=wi),qo.prototype.setVisible=function(e){de.prototype.setVisible.call(this,e);var t=this.getRootElement(),i="aria-label";e?t.set_attr(i,Rt.L_NavBarLocateMeToolTip_Text):t.remove_attr(i)},p=qo,Qt(zo,pe=Ei),zo.prototype.getGeochainControl=function(){return this._geochain},zo.prototype.setGeochainControl=function(e){this._geochain&&this._geochain.getRootElement().removeFromParent(),this._geochain=e;e=this.getRootElement();e.insertBefore(this._geochain.getRootElement(),this._locateMeButton.getRootElement()),e.add_class(zo.withGeochainClass),this._geochain.setNavigationHelper(this.getHelper())},zo.prototype.setVisible=function(e){pe.prototype.setVisible.call(this,e),this.setLocateMeButtonVisibility(e)},zo.prototype.setGeochainVisibility=function(e){var t;this._geochain&&(this._geochain.getRootElement().set_style({display:this.boolToDisplay(e)}),t=this.getRootElement(),e?t.add_class(zo.withGeochainClass):t.remove_class(zo.withGeochainClass))},zo.prototype.setLocateMeButtonVisibility=function(e){this._locateMeButton&&this._locateMeButton.setVisible(e)},zo.prototype.dispose=function(){this._locateMeButton&&this._locateMeButton.dispose(),this._geochain&&this._geochain.dispose(),pe.prototype.dispose.call(this),st._nullifyClass(this)},zo.withGeochainClass="withGeochain",d=zo,Qe.registerControl("LocateMeControl",d),Uo.prototype.show=function(e){var t,i=this;!this._isVisible&&nt.isMapsVertical&&(this._root||(this._root=this._createRootElement()),t=this._setMessage(e),this._addToDom(),this._root.style.marginLeft=(this._map.getActualSize().width-this._root.offsetWidth)/2+"px",this._map.viewChanged.addOne(function(){return i.hide()}),this._isVisible=!0,(e=this._root.getElementsByTagName("a")[0])&&(rt(e).set_attr("aria-label",t+Rt.L_LocateMe_ChangeSettings_Text),e.focus()))},Uo.prototype.hide=function(){this._isVisible&&(this._removeFromDom(),this._isVisible=!1)},Uo.prototype._addToDom=function(){var e=this._map.getRootElement(),t=e.get_style("position");Ye.assert("absolute"===t||"relative"===t,"expected mapDiv position to be absolute or relative. found "+t),e.append(this._root)},Uo.prototype._removeFromDom=function(){this._root&&this._root.parentNode&&this._root.parentNode.removeChild(this._root)},Uo.prototype._createRootElement=function(){var e=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),t=this._map.getConfig(),e=t.bingSettingsUrl.replace("{origin}",e).replace("{returnUrl}",encodeURIComponent(window.location.href)).replace("{formCode}",t.locateMeFormCode),t=document.createElement("div");return t.innerHTML="<div class='bm_LocateMeErrorDialog'><div data-role='message'></div><div><a href='"+e+"'>"+Rt.L_LocateMe_ChangeSettings_Text+"</a></div></div>",t.firstChild},Uo.prototype._setMessage=function(e){e=e?Rt.L_LocateMe_Error_Text_Approximate_Location:Rt.L_LocateMe_Error_Text_Setting;return rt("[data-role=message]",this._root).set_html(e),e},h=Uo,Qt(Zo,le=wi),Zo.prototype._mapTypeChanged=function(e){var t=e.newMapTypeId===ft.road||e.newMapTypeId===ft.highContrast?Zo._mapTypeToClass[this._secondMapType]:Zo._mapTypeToClass[ft.road];this.getRootElement().remove_class(this._previousClass).add_class(t),this._previousClass=t,e=e.newMapTypeId==ft.road?this._roadText:this._secondMapTypeText,this.setTitle(e),this.getRootElement().set_attr("aria-label",e)},Zo._mapTypeToToolTip={os:"ordnance survey",a:"aerial"},Zo._mapTypeToClass={os:"ordnanceSurvey",a:"aerial",r:"road"},u=Zo,Qe.registerControl("MapTypeSwitcherButton",u);var Ii=(Fo.prototype.setVisible=function(e){e!=this._isVisible&&((this._isVisible=e)?(this._layer||(this._layer=new Ut("MePoi",this,this._selector,8690),this._layer.setRenderTarget(1)),this._map.getLayers().insert(this._layer)):this._layer&&this._map.getLayers().remove(this._layer))},Fo.prototype.setLocation=function(e){this._location.latitude=e.latitude,this._location.longitude=e.longitude,this._primitive=new Ht(e,{id:"MePoi",collisionBehavior:2,poiType:11}),this._primitive.bucket="354",this.invalidated.invoke()},Fo.prototype.getPrimitives=function(e,t){this._primitive?(this._primitive.layer=this._layer,t({primitives:[this._primitive]})):t({primitives:[]})},Fo),Pi=(Qt(No,se=wt),No),xi=(Qt(Vo,re=Ei),Vo.prototype.getAerialBirdsEyeTransitionManager=function(){return this._transitionManager},Vo.prototype.getTrafficButton=function(){return this._trafficButton},Vo.prototype.getLocateMeControl=function(){return this._locateMeControl},Vo.prototype.getBirdseyeV2InfoExitControl=function(){return this._birdseyeV2InfoExitControl},Vo.prototype.getNavigationButtonAtIndex=function(e){return e<0||e>=this.navBarButtons.length?null:this.navBarButtons[e]},Vo.prototype.getNavigationBarOrientation=function(){return this._currentOrientation},Vo.prototype.getNavigationBarMode=function(){return this._currentNavBarMode},Vo.prototype.isSquareStyle=function(){return this._enableSquareStyle},Vo.prototype.getZoomControl=function(){return this._zoomControl},Vo.prototype.setLocateMeButtonVisible=function(e){this._locateMeControl&&this._locateMeControl.setLocateMeButtonVisibility(e)},Vo.prototype.setRotateButtonVisible=function(e){this._rotateControl&&this._setControlDisplay(this._rotateControl,e)},Vo.prototype.setBirdseyeV2InfoExitControlVisible=function(e){this._birdseyeV2InfoExitControl&&(this._setControlDisplay(this._birdseyeV2InfoExitControl,e),(e=this._map.getLabelController())&&this.getHelper().updateLabelToggleForBirdseyeV2(e.getIsLabelsEnabled(),!0))},Vo.prototype.setZoomInButtonVisible=function(e){this._zoomInButton&&this._setControlDisplay(this._zoomInButton,e)},Vo.prototype.setZoomOutButtonVisible=function(e){this._zoomOutButton&&this._setControlDisplay(this._zoomOutButton,e)},Vo.prototype.setMapStyleSelectorControlVisible=function(e){e=this._mapTypeSelectorEnabled&&e,this._mapTypeSwitcherButton&&this._setControlDisplay(this._mapTypeSwitcherButton,e),this._selectorControl&&this._setControlDisplay(this._selectorControl,e)},Vo.prototype.setRadialMenuControlVisible=function(e){this._radialMenu&&this._setControlDisplay(this._radialMenu,e)},Vo.prototype.setDefaultCompassClass=function(e){var t,i;!this._rotateControl||(t="NavBar_heading_"+(e=this.normalizeHeading(e))+"D")!==this._lastHeadingClass&&(i=rt(this._rotateControl.getRotateResetButton().getRootElement()),void 0!==this._lastHeadingClass&&i.remove_class(this._lastHeadingClass),i.add_class(t),this._lastHeading=e,this._lastHeadingClass=t)},Vo.prototype.setNavigationBarOrientation=function(e){this._enableSquareStyle?(this.getRootElement().remove_class("horizontal"),this._currentOrientation=Ct.vertical):this._currentOrientation!=e&&(e==Ct.horizontal?this.getRootElement().add_class("horizontal"):this.getRootElement().remove_class("horizontal"),this._currentOrientation=e)},Vo.prototype.setNavigationBarMode=function(e){if(this._enableSquareStyle=(nt.isMapsAnswer||nt.isMsftPartner)&&!nt.isMapsVertical||nt.isSDK&&this._map.getMapOptions().navigationBarMode===Mt.square,this._currentNavBarMode!=e)switch(this._currentNavBarMode=e,this._resetNavigationBar(),this.getRootElement().remove_class("tiny"),this.getRootElement().remove_class("minified"),this.getRootElement().remove_class("compact"),e){case Mt.minified:this._setMinifiedMode();break;case Mt.compact:this._setCompactMode();break;default:this._setDefaultMode()}},Vo.prototype.setExternalControl=function(e){this._externalControl&&this._externalControl.getRootElement().removeFromParent(),this._externalControl=e,this._appendExternalControl()},Vo.prototype.rotateCompass=function(e){var t,i;e=this.normalizeHeading(e),t=rt(this._rotateControl.getRotateResetButton().getRootElement()),void 0===this._lastHeading&&(this._lastHeading=0),i="NavBar_heading_",i+=0==e?90==this._lastHeading?"0":"360":270==e?0==this._lastHeading?"90C":"270":e,void 0!==this._lastHeadingClass&&t.remove_class(this._lastHeadingClass),t.add_class(i),this._lastHeadingClass=i,this._lastHeading=e},Vo.prototype.isZoomInButtonEnabled=function(){return this._zoomInButton&&this._isControlEnabled(this._zoomInButton)},Vo.prototype.isZoomOutButtonEnabled=function(){return this._zoomInButton&&this._isControlEnabled(this._zoomOutButton)},Vo.prototype.isRotateLeftEnabled=function(){return this._rotateControl&&this._isControlEnabled(this._rotateControl.getRotateLeftButton())},Vo.prototype.isRotateRightEnabled=function(){return this._rotateControl&&this._isControlEnabled(this._rotateControl.getRotateRightButton())},Vo.prototype.enableRotateLeftButton=function(e){var t;this._rotateControl&&(t=this._rotateControl.getRotateLeftButton().getRootElement(),e?t.remove_class(Vo.disabledClass):t.add_class(Vo.disabledClass))},Vo.prototype.enableRotateRightButton=function(e){var t;this._rotateControl&&(t=this._rotateControl.getRotateRightButton().getRootElement(),e?t.remove_class(Vo.disabledClass):t.add_class(Vo.disabledClass))},Vo.prototype.addNavigationButton=function(e){e.getHelper()||e.setHelper(this.getHelper()),this.navBarButtons.push(e),this.getRootElement().append(e.getRootElement())},Vo.prototype.insertNavigationButton=function(e,t){if(e<0||e>=this.navBarButtons.length)return!1;t.getHelper()||t.setHelper(this.getHelper());var i=this.navBarButtons[e];return this.navBarButtons.splice(e,0,t),this.getRootElement().insertBefore(t.getRootElement(),i.getRootElement()),!0},Vo.prototype.removeNavigationButton=function(e){var t=this.navBarButtons.indexOf(e);return 0<=t&&(this.navBarButtons.splice(t,1),e.getRootElement().removeFromParent(),!0)},Vo.prototype.removeNavigationButtonAt=function(e){if(e<0||e>=this.navBarButtons.length)return null;var t=this.navBarButtons[e];return this.navBarButtons.splice(e,1),t.getRootElement().removeFromParent(),t},Vo.prototype.dispose=function(){this._resetNavigationBar(),this._selectorControl&&this._selectorControl.dispose(),this._locateMeControl&&this._locateMeControl.dispose(),this._rotateControl&&this._rotateControl.dispose(),this._radialMenu&&this._radialMenu.dispose(),this._zoomInButton&&this._zoomInButton.dispose(),this._zoomOutButton&&this._zoomOutButton.dispose(),this._trafficButton&&this._trafficButton.dispose(),this._mapTypeSwitcherButton&&this._mapTypeSwitcherButton.dispose(),this._birdseyeV2InfoExitControl&&this._birdseyeV2InfoExitControl.dispose(),re.prototype.dispose.call(this),st._nullifyClass(this)},Vo.prototype._setDarkTheme=function(){this.getRootElement().remove_class("Light").add_class("Dark")},Vo.prototype._setLightTheme=function(){this.getRootElement().remove_class("Dark").add_class("Light")},Vo.prototype.normalizeHeading=function(e){return 0<e&&(e%=360),e<0&&(360==(e=360-Math.abs(e)%360)&&(e=0)),e},Vo.prototype._updateTemplate=function(){var e="NavBar_Container",t=e+" V8MapStyle",i=e;nt.isMapsVertical?i=t:this._enableSquareStyle&&(i=t+" lm_button",nt.isSDK&&(i+=" sdk")),this.setTemplate(new Qe('<div id="MicrosoftNav" class="NavBar_Container Light" ></div>'.replace(e,i)))},Vo.prototype._handleMapType=function(e){var t=this._map.getMapOptions(),i=!("boolean"==typeof t.showDashboard&&!t.showDashboard),o=!1,a=!0,n=!0,r=!1,s=!nt.isMapsVertical&&((nt.isMapsAnswer||nt.isMsftPartner)&&!st._isFeatureEnabled("newNavStyleSerp")||!nt.isMapsAnswer&&!nt.isMsftPartner&&t.navigationBarMode!==Mt.square);switch(e){case ft.birdseye:n=a=!(o=!0),s&&this._setDarkTheme();break;case ft.birdseyeV2:r=!(n=a=!(o=!(i=!1))),s&&this._setDarkTheme();break;case ft.aerial:case ft.canvasDark:case ft.roadDark:s&&this._setDarkTheme();break;default:this._setLightTheme()}this.setLocateMeButtonVisible(i),this.setRotateButtonVisible(o),this.setBirdseyeV2InfoExitControlVisible(r),this.getHelper().enableStreetsideButton(a),n&&this.getHelper().resetMapHeading()},Vo.prototype._handleViewChange=function(e){var t=e.getView().heading;this.setDefaultCompassClass(t),this.enableRotateLeftButton(!0),this.enableRotateRightButton(!0),this._handleZoomChanged(e)},Vo.prototype._handleZoomChanged=function(e){var t;this._zoomInButton&&(t=e.canZoom(1),this._enableZoomControl(this._zoomInButton,t)),this._zoomOutButton&&(e=e.canZoom(-1),this._enableZoomControl(this._zoomOutButton,e))},Vo.prototype._handleMapSizeChanged=function(e){this._handleZoomChanged(e),this._sizeExternalControl()},Vo.prototype._sizeExternalControl=function(){var e,t;this._externalControl&&this._externalControl.setMaxHeight&&(e=this._externalControl.getRootElement().get_absolute_pos(),t=this._map.getRootElement().select(".bm_bottomRightOverlay").get_absolute_pos(),this._externalControl.setMaxHeight(t.y-e.y))},Vo.prototype._isControlEnabled=function(e){return!e.getRootElement().has_class(Vo.disabledClass)},Vo.prototype._enableZoomControl=function(e,t){var i=e.getRootElement(),o=this._map.getMercatorZoomLevel(),o=(e===this._zoomInButton?Rt.L_ZoomInButtonAriaLabel:Rt.L_ZoomOutButtonAriaLabel).replace("{0}",o);t?(this._isControlEnabled(e)||(i.remove_class(Vo.disabledClass),i.set_attr("tabindex","")),i.set_attr("aria-label",o)):(this._isControlEnabled(e)&&(i.add_class(Vo.disabledClass),i.set_attr("tabindex","-1")),i.set_attr("aria-label",o+i.get_attr("title")+" "+Rt.L_ZoomButtonAriaLabelDisabled))},Vo.prototype._setMinifiedMode=function(){var e;this._enableSquareStyle?(this._appendMapTypeSelector(!1),this._appendLocateMeControl(),this._appendZoomButtons(),this.setNavigationBarOrientation(Ct.vertical),this.getRootElement().add_class("minified"),(e=this._map.getActualSize()).height<158?this.getRootElement().add_class("limitHeight"):this.getRootElement().remove_class("limitHeight")):(this.getNavigationBarOrientation()===Ct.horizontal?(this._appendTrafficButton(),this._appendMapTypeSelector(!1),this._appendZoomButtons(),this._appendBirdseyeV2InfoExitControl(),this._appendLocateMeControl()):(this._appendLocateMeControl(),this._appendZoomButtons(),this._appendMapTypeSelector(!1),this._appendTrafficButton()),e=this._map.getActualSize(),this.getRootElement().remove_class("SquareNavControl"),this.getRootElement().add_class(15e4<e.width*e.height?"minified":"tiny"))},Vo.prototype._setCompactMode=function(){this.getNavigationBarOrientation()===Ct.horizontal?(this._appendLocateMeControl(),this._appendRotateControl(),this._appendZoomButtons(),this._appendBirdseyeV2InfoExitControl(),this._appendMapTypeSelector(!0)):(this._appendMapTypeSelector(!0),this._appendBirdseyeV2InfoExitControl(),this._appendZoomButtons(),this._appendRotateControl(),this._appendLocateMeControl()),this._appendExternalControl(),this.getRootElement().add_class("compact")},Vo.prototype._setDefaultMode=function(){nt.isMapsVertical&&(this.getRootElement().add_class("SquareNavControl"),this._setLightTheme()),this.getRootElement().remove_class("limitHeight"),this.getNavigationBarOrientation()===Ct.horizontal?(this._appendRotateControl(),this._appendZoomButtons(),this._appendLocateMeControl(),this._appendBirdseyeV2InfoExitControl(),this._appendMapTypeSelector(!0)):(this._appendMapTypeSelector(!0),this._appendBirdseyeV2InfoExitControl(),this._appendLocateMeControl(),!nt.isMapsVertical||st._isFeatureEnabled("birdseyeV2UI")?(this._appendRotateControl(),this._appendZoomButtons()):(this._appendZoomButtons(),this._appendRotateControl())),this._appendExternalControl()},Vo.prototype._resetNavigationBar=function(){for(this._selectorControl&&this._selectorControl.getRootElement().removeFromParent(),this._locateMeControl&&this._locateMeControl.getRootElement().removeFromParent(),this._rotateControl&&this._rotateControl.getRootElement().removeFromParent(),this._radialMenu&&this._radialMenu.getRootElement().removeFromParent(),this._zoomControl&&this._zoomControl.getRootElement().removeFromParent(),this._externalControl&&this._externalControl.getRootElement().removeFromParent();0<this.navBarButtons.length;)this.removeNavigationButtonAt(0)},Vo.prototype._appendZoomButtons=function(){var e,t=this._map.getMapOptions(),i=t.disableZooming||"boolean"==typeof t.showDashboard&&!t.showDashboard||"boolean"==typeof t.showZoomButtons&&!t.showZoomButtons;if(this._enableSquareStyle||nt.isMapsVertical&&this._currentNavBarMode===Mt.default)return this._zoomControl?(e=this._zoomControl.getRootElement(),this._zoomControl.zoomInButton.appendTo(e),this._zoomControl.zoomOutButton.appendTo(e)):this._zoomControl=new g(this._navBarControlArgs),i||this._appendControl(this._zoomControl),this._zoomInButton=this._zoomControl.zoomInButton,void(this._zoomOutButton=this._zoomControl.zoomOutButton);this._zoomInButton||(this._zoomInButton=new y(this._navBarControlArgs)),this._zoomOutButton||(this._zoomOutButton=new m(this._navBarControlArgs)),t=this._zoomInButton,e=this._zoomOutButton,this.getNavigationBarOrientation()===Ct.horizontal&&(t=this._zoomOutButton,e=this._zoomInButton),this.addNavigationButton(t),this.addNavigationButton(e),i&&(this.setZoomOutButtonVisible(!1),this.setZoomInButtonVisible(!1))},Vo.prototype._appendExternalControl=function(){this._externalControl&&(this.getRootElement().append(this._externalControl.getRootElement()),this._sizeExternalControl())},Vo.prototype._appendLocateMeControl=function(){var t=this,e=this._map.getMapOptions();e.showLocateMeButton&&(this._locateMeControl||(this._locateMeControl=new d(this._navBarControlArgs),!1===e.showBreadcrumb||nt.disableReverseGeocode||this._map.getContainer().instanceAsync("GeochainControl",function(e){t._locateMeControl.setGeochainControl(e)})),this._appendControl(this._locateMeControl),!nt.isMobile&&st._isSmallMapShownOnSerp()||"boolean"==typeof e.showDashboard&&!e.showDashboard?this._locateMeControl.setVisible(!1):this._locateMeControl.setVisible(!0))},Vo.prototype._appendBirdseyeV2InfoExitControl=function(){var t=this;this._birdseyeV2InfoExitControl?this._birdseyeV2InfoExitControl.refreshTemplate():(this._birdseyeV2InfoExitControl=new e(this._navBarControlArgs),this._map.getContainer().instanceAsync("GeochainManager",function(e){t._birdseyeV2InfoExitControl&&t._birdseyeV2InfoExitControl.setGeochainManager(e)})),this._appendControl(this._birdseyeV2InfoExitControl)},Vo.prototype._appendMapTypeSelector=function(e){e?(this._selectorControl||(this._selectorControl=new l(this._navBarControlArgs,this._currentNavBarMode===Mt.compact,this._map.getMapOptions().disableMapTypeSelectorMouseOver),this.disposables.push(this._selectorControl)),this._radialMenu||(this._radialMenu=new i(this._navBarControlArgs)),this._appendControl(this._selectorControl),this._appendControl(this._radialMenu)):(this._mapTypeSwitcherButton||(this._mapTypeSwitcherButton=new u(this._navBarControlArgs)),this.addNavigationButton(this._mapTypeSwitcherButton));var t=this._map.getMapOptions(),e=t.showMapTypeSelector,t=t.showDashboard;("boolean"==typeof e&&!1===e||"boolean"==typeof t&&!1===t)&&this.setMapStyleSelectorControlVisible(!1)},Vo.prototype._appendTrafficButton=function(){var e=this._map.getMapOptions();0!=e.showDashboard&&e.showTrafficButton&&(this._trafficButton||(this._trafficButton=this._createTrafficButton()),this.addNavigationButton(this._trafficButton))},Vo.prototype._appendRotateControl=function(){this._map.getMapOptions().disableBirdseye&&nt.isMapsVertical||(this._rotateControl||(this._rotateControl=new Hi(this._navBarControlArgs)),this._appendControl(this._rotateControl))},Vo.prototype._createTrafficButton=function(){var t=this,i=new _(this._navBarControlArgs);return this._map.getContainer().instanceAsync("TrafficLayerV2",function(e){i.setTrafficLayer(e),t.disposables.push(e)}),i},Vo.prototype._appendControl=function(e){e&&this.getRootElement().append(e.getRootElement())},Vo.prototype._setControlDisplay=function(e,t){e.getRootElement().set_style({display:this.boolToDisplay(t)})},Vo.disabledClass="disabled",Vo);Qe.registerControl("NavigationBar",xi);var Ai=(Qt(Ho,ne=wi),Ho),Ri=(Qt(Oo,ae=wi),Oo),Oi=(Qt(Ro,oe=wi),Ro),Hi=(Qt(Ao,ie=Ei),Ao.prototype.getRotateLeftButton=function(){return this._rotateLeftButton},Ao.prototype.getRotateResetButton=function(){return this._rotateResetButton},Ao.prototype.getRotateRightButton=function(){return this._rotateRightButton},Ao.prototype._updateTopMargin=function(){var e=this.getHelper(),t=e&&e.getMap();t&&e.getIsBirdseyeV2FullControl()&&(e=(t.getActualSize().height-120)/2-(e.getIsBirdseyeV2ControlNewLayout()?0:60),this.getRootElement().set_style({marginTop:e+"px"}))},Ao.prototype.dispose=function(){rt(window).remove_event("resize",this._resizeHandler),this._resizeHandler=null,this._rotateLeftButton&&this._rotateLeftButton.dispose(),this._rotateResetButton&&this._rotateResetButton.dispose(),this._rotateRightButton&&this._rotateRightButton.dispose(),this._rotateLeftButton=null,this._rotateResetButton=null,this._rotateRightButton=null,ie.prototype.dispose.call(this)},Ao);Qe.registerControl("RotateControl",Hi),Qt(xo,te=wi),xo.prototype.setTrafficLayer=function(e){var t=this;this._trafficLayer=e,this._trafficLayer&&(this._showTrafficOnRendered&&e.show(1),this._setTrafficButtonSelected(e.getIsShowing()),this.disposables.push(this._trafficLayer.changed.add(function(e){"isShowing"===e.name&&t._setTrafficButtonSelected(e.newValue)})),this.getRootElement().remove_class("disabled"))},xo.prototype.getTrafficLayer=function(){return this._trafficLayer},xo.prototype._setTrafficButtonSelected=function(e){e?(this.getRootElement().add_class(this._selectedClass),this.setTitle(Rt.L_NavBarTrafficToggleToolTip_TurnOff_Text)):(this.getRootElement().remove_class(this._selectedClass),this.setTitle(Rt.L_NavBarTrafficToggleToolTip_TurnOn_Text))},_=xo,Qt(Po,ee=Ei),g=Po,Qe.registerControl("ZoomControl",g),Qt(Io,$=wi),y=Io,Qe.registerControl("ZoomInButton",y),Qt(Do,X=wi),m=Do,Qe.registerControl("ZoomOutButton",m),Qt(wo,Y=Bt),v=wo,(J=f=f||{})[J.AddEntity=1]="AddEntity",J[J.ViewCollection=2]="ViewCollection",J[J.GetAllCollections=3]="GetAllCollections",J[J.GetAllCollectionNamesAndIds=4]="GetAllCollectionNamesAndIds",J[J.ViewCollectionReadOnly=5]="ViewCollectionReadOnly",J[J.AddCollection=6]="AddCollection",J[J.SetCollectionSharingAccess=7]="SetCollectionSharingAccess",J[J.SetHome=8]="SetHome",J[J.SetWork=9]="SetWork",J[J.AddFavorite=10]="AddFavorite",J[J.GetHomeAndWork=11]="GetHomeAndWork",J[J.GetActiveTasks=12]="GetActiveTasks",J[J.ViewFavorites=15]="ViewFavorites",J[J.ShowTemporaryCollection=17]="ShowTemporaryCollection",J[J.AddToTemporaryCollection=18]="AddToTemporaryCollection",J[J.LoadSharedTemporaryCollection=19]="LoadSharedTemporaryCollection",J[J.UpdateEntity=20]="UpdateEntity",J[J.ProcessCardlessPrimitives=21]="ProcessCardlessPrimitives",Eo.prototype.clear=function(){this.address=null,this.rawAddress=null,this.point=null,this.viaWaypoints=[],this.isViaWaypoint=!1,this.eid=null,this.type=null,this.stype=null,this.filterUrlParam=null,this.name=null,this.waypointSource=0,this.locationIdentifier=null,this.isApproximate=!1,this.asType=0},Eo.prototype.isEmpty=function(){return!this.address&&!this.name&&!this.point},Eo.createObjectFrom=function(e){return new Eo(e.address,e.point,e.name,e.isViaWaypoint,e.viaWaypoints,e.eid,e.type,e.stype,e.filterUrlParam,e.waypointType,e.waypointSource,e.locationIdentifier,e.rawAddress)},Eo.areEqual=function(e,t){return e.address&&e.address===t.address||e.point&&bt.areEqual(e.point,t.point)||e.eid&&e.eid===t.eid},T=Eo,(j=b=b||{})[j.driving=1]="driving",j[j.transit=2]="transit",j[j.walking=3]="walking",j[j.truck=4]="truck",j[j.multimode=5]="multimode",(Q=M=M||{}).avoidCrossing="avoidCrossing",Q.minimizeCrossing="minimizeCrossing",Q.allowedRegions="allowedRegions",(G=C=C||{})[G.arrival=1]="arrival",G[G.departure=2]="departure",G[G.lastAvailable=3]="lastAvailable",G[G.firstAvailable=4]="firstAvailable",(W=S=S||{})[W.miles=1]="miles",W[W.km=2]="km",(K=L=L||{})[K.distance=1]="distance",K[K.time=2]="time",K[K.timeWithTraffic=3]="timeWithTraffic",K[K.transfers=4]="transfers",K[K.money=5]="money";var Vi,Ni=(Bo.getDirectionTaskOptions=function(e,t,i,o,a,n,r,s){var l,a=new T(e,t,o,!1,null,a);return a.waypointType=n,a.waypointSource=this._getWaypointSource(i,r),s&&(l={dateTime:s,timeType:C.arrival}),i=i===it.LocalDetails?3:2,{type:si.directionsTask,state:{waypoints:[a],entryPoint:i,options:l||null}}},Bo.getItineraryItem=function(e,t,i,o,a,n,r){o={Name:e,Id:i,Lat:t.latitude,Lon:t.longitude,StayDuration:"",InterestTypes:[],Image:{Url:o},CategoryId:a};return n&&(o.InterestTypes=n.split(",")),r&&(a=0,n=/(\d*) hours?/g.exec(r),r=/(\d*) minutes?/g.exec(r),n&&2<=n.length&&(a+=60*parseInt(n[1])),r&&2<=r.length&&(a+=parseInt(r[1])),o.StayDurationInMinutes=a),o},Bo.getItineraryAddItemFromSaveOptions=function(e,t,i,o,a,n,r,s){s=Bo.getItineraryItem(e,t,i,o,n,r,s);return{type:si.itineraryDetailsTask,requestState:{action:5,itineraryItem:s,itineraryCollectionId:a}}},Bo.getItineraryAddItemOptions=function(e,t,i,o,a,n,r,s){s=Bo.getItineraryItem(e,t,i,o,n,r,s);return{type:si.itineraryDetailsTask,requestState:{action:1,itineraryItem:s},taskId:a}},Bo.createNewItineraryOption=function(e,t,i,o,a,n,r,s,l,p,d,c){var h,s=Bo.getItineraryItem(e,t,i,o,n,r,s);switch(s.Destination=d&&(d.city||d.stateMunicipality||d.country),s.CategoryName=p,l&&l.length&&(s.EntityTypes=l),s={itineraryItem:s},h="",c){case"TransientLens":h=it.ContextMenu;break;case si.localDetailsTask:h=it.LocalDetails;break;case si.localListingTask:h=it.LocalListing;break;default:h=c}return s.entryPoint=h,{type:si.itineraryDetailsTask,state:s}},Bo.getItineraryDayOptions=function(e,t,i){return{taskId:t,type:si.itineraryDetailsTask,requestState:{action:3,travelEntity:e,day:i}}},Bo.getMyPlacesTaskOptions=function(e,t,i,o,a,n,r,s,l,p){p={action:f.AddEntity,data:{title:e,location:t,address:o=void 0===o?"":o,description:i=void 0===i?"":i,photoUrl:a,categoryId:n,id:r,addressFields:s,metadataString:l,segmentType:p}};return{type:si.collectionsTask,state:p}},Bo.getSaveToCollectionOptions=function(e,t,i,o,a,n,r,s){i={action:f.AddEntity,data:{title:e,location:t,address:n=void 0===n?"":n,description:a=void 0===a?"":a,photoUrl:r,categoryId:s,id:o},collectionId:i};return{type:si.collectionsTask,requestState:i}},Bo._getWaypointSource=function(e,t){return e===it.LocalDetails?t?2:1:e===it.ContextMenu?t?4:3:0},Bo),Fi=(Qt(ko,q=Bt),ko.prototype._createOverlayDataEntityAction=function(e,t,i,o){return o?new v(e,t,i):{text:e,cssClass:t,handler:i,mouseoverHandler:null,showSeparator:!1,showSecText:!1,secText:null}},ko.prototype.getMyPlacesAction=function(e,t,i,o){return this._createOverlayDataEntityAction(i?o?Rt.L_OverlayEntity_MoveTo:Rt.L_OverlayEntity_Save:Rt.L_OverlayEntity_SaveAsFavorite,o?"savefavorite move":"savefavorite",t,e)},ko.prototype.getDirectionsAction=function(e,t){return this._createOverlayDataEntityAction(Rt.L_OverlayEntity_Directions,"directions",t,e)},ko.prototype.getGenericAction=function(e,t,i){return this._createOverlayDataEntityAction(e,t,i,!1)},ko.prototype.getLocalListingAction=function(e,t){return this._createOverlayDataEntityAction(Rt.L_OverlayEntity_OpenCard,"opencard",t,e)},ko.prototype.getLocalDetailsAction=function(e,t){return this._createOverlayDataEntityAction(Rt.L_OverlayEntity_OpenNewCard,"opennewcard",t,e)},ko.prototype.getAddPushpinAction=function(e,t){return this._createOverlayDataEntityAction(Rt.L_OverlayEntity_AddAPushpin,"opencard",t,e)},ko.prototype.getNearbyAction=function(e,t){return this._createOverlayDataEntityAction(Rt.L_OverlayEntity_Nearby,"nearby",t,e)},ko.prototype.getStreetsideAction=function(e,t){return this._createOverlayDataEntityAction(Rt.L_OverlayEntity_Streetside,"streetside",t,e)},ko.prototype.getBirdseyeV2Action=function(e,t){return this._createOverlayDataEntityAction(Rt.L_OverlayEntity_BirdseyeV2,"birdseyeV2",t,e)},ko.prototype.getZoomAction=function(e,t){return this._createOverlayDataEntityAction(Rt.L_OverlayEntity_Zoom,"zoom",t,e)},ko.prototype.getDirectionTaskOptions=function(e,t){var i=this.getDescription()||this.getTitle();return Ni.getDirectionTaskOptions(i,e,t,this.getTitle(),this.id)},ko.prototype.getTravelTaskOptions=function(e){return Ni.getItineraryAddItemOptions(this.getTitle(),e,this.id,this.getImageUrl())},ko.prototype.getMyPlacesTaskOptions=function(e){return Ni.getMyPlacesTaskOptions(this.getTitle(),e,this.getDescription(),this.getAddress(),this.getImageUrl())},ko.prototype.getLocalDetailTaskOptions=function(e){return{type:si.localDetailsTask,state:{id:e}}},ko),Zi=(Qt(Lo,z=wt),Lo),Ui=(So.prototype._onOverlaysUpdated=function(e){var t,i,o,a;if(e.reset)for(t=this._map.getOverlays(),i=null,this._root.clear(),a=0,o=t.length;a<o;a++)i=t[a],this._addOverlay(i);else{if(e.added)for(a=0;a<e.added.length;a++)i=e.added[a],this._addOverlay(i);if(e.removed)for(a=0;a<e.removed.length;a++)i=e.removed[a],this._removeOverlay(i)}},So.prototype._onViewChanged=function(){for(var e=this._map.getOverlays(),t=0,i=e.length;t<i;t++)this._updateOverlay(e[t])},So.prototype._updateOverlay=function(e){var t=e.getAlignment();t instanceof bt&&(t=t,e.setOverlayElement(this._updateOverlayLocation(e.getOverlayElement(),t,e.getAnchor())))},So.prototype._updateOverlayLocation=function(e,t,i){var o=this._map&&this._map.getMode(),o=o&&o.tryLocationToPoint(t);return o&&(t=o.x-(i?i.x:0),i=o.y-(i?i.y:0),e.set_style({position:"absolute",left:t,top:i})),e},So.prototype._addOverlay=function(e){var t=this,i=e.getOverlayElement(),o=e.getAlignment(),a="auto",n="auto",r="auto",s="auto",l=(l=e.getAnchor())||new It(0,0);if(Ye.assertNotNull(i,"overlayElement"),i){if(o instanceof bt)i=this._updateOverlayLocation(i,o,l);else if("number"==typeof o){switch(o){case 1:a=-l.x+"px",r=-l.y+"px";break;case 0:a=-l.x+"px",n=-l.y+"px";break;case 3:s=-l.x+"px",r=-l.y+"px";break;case 2:s=-l.x+"px",n=-l.y+"px"}i.set_style({position:"absolute",left:n,top:a,right:r,bottom:s})}this._root.append(i),e[So._changedEventAttributeKey]=e.changed.add(function(){t._updateOverlay(e)})}},So.prototype._removeOverlay=function(e){e.getOverlayElement().removeFromParent(),e[So._changedEventAttributeKey].dispose()},So.prototype.getRootElement=function(){return this._root},So.prototype.dispose=function(){for(var e=this._disposables.length;e--;)this._disposables.pop().dispose();this._map=null,this._root&&this._root.clear(),this._root=null},So._changedEventAttributeKey="om$changed",So),zi=(Co.prototype.clear=function(){this._argsList=[],this.length=0},Co.prototype.add=function(e){Ye.assertNotNull(e,"args"),this._argsList.push(e),this.length++},Co.prototype.get=function(e){return 0<=e&&e<this.length?this._argsList[e]:void 0},Co.prototype.getLast=function(){return Ye.assert(0<this.length,"Cannot call getLast when the pointer trail is empty."),this._argsList[this.length-1]},Co.prototype.getLastVelocity=function(){var e,t,i,o,a,n,r,s;if(this.length<2)return new It(0,0);for(e=this.getLast(),i=this.length-1;o=(t=this._argsList[--i]).timestamp===e.timestamp,a=t.point.x===e.point.x&&t.point.y===e.point.y,1<=i&&(o||a););return 0==(n=e.timestamp-t.timestamp)?new It(0,0):(r=e.point.x-t.point.x,s=e.point.y-t.point.y,new It(r/n,s/n))},Co),qi=(Qt(Mo,U=Bt),Mo.prototype.getLayers=function(){return this._mapLayers},Mo),Ki=(bo.prototype.reverseGeocode=function(e,t,i,o,a){this.reverseGeocodeWithNetworkId(e,t,i,o,a)},bo.prototype.reverseGeocodeWithNetworkId=function(t,a,i,o,n){var r={success:!1,statusCode:null,authenticationResultCode:null,statusDescription:null,location:t,addressList:null,results:null};return t||a(r),180<t.longitude&&(t.longitude=-360+t.longitude),tt.instance.authenticateClientAndRetrieveSessionId(function(e){e=vt.reverseGeocodeRequestUrlFormat.replace("{session_key}",e).replace("{latitude}",t.latitude.toString()).replace("{longitude}",t.longitude.toString()).replace("{culture}",nt.dynamicProperties.uiLanguage).replace("{includeEntityTypes}",i?i.join(","):"").replace("{neighborhood}",o?"1":"0").replace("{incl}",bo._getIncludeOptionString(n));return St.downloadJsonp(e,"revgeocode",function(e){var t,i,o;if(e&&e.authenticationResultCode===bo._validAuthenticationCode&&e.statusCode===bo._validStatusCode&&e.statusDescription===bo._validStatusDescription&&e.resourceSets&&0!==e.resourceSets.length){for(r.success=!0,r.statusCode=bo._validStatusCode,r.authenticationResultCode=bo._validAuthenticationCode,r.statusDescription=bo._validStatusDescription,i=0,o=e.resourceSets.length;i<o;i++)if((t=e.resourceSets[i].resources)&&0!==t.length){r.addressList=[],r.results=[],t.forEach(function(e){var t=e.address;t&&t.formattedAddress&&(r.addressList.push(t),r.results.push(e))});break}r.traceId=e.traceId}else e?(r.statusCode=e.statusCode,r.authenticationResultCode=e.authenticationResultCode,r.statusDescription=e.statusDescription,r.errorMessage=e.errorDetails&&0<e.errorDetails.length&&e.errorDetails[0],r.traceId=e.traceId):(r.statusCode=400,r.authenticationResultCode="Unknown",r.statusDescription="Unknown");a(r)},function(){r.authenticationResultCode="Unknown",r.statusCode=404,r.statusDescription="Http Error",a(r)},null,null)}),null},bo._getIncludeOptionString=function(e){switch(e){case 0:return"ciso2";case 1:return"entityId";default:return""}},bo._validAuthenticationCode="ValidCredentials",bo._validStatusCode=200,bo._validStatusDescription="OK",bo);(Vi||(Vi={})).createPolylineOptions=function(e,t,i,o,a,n){var r,s,l,p=4,d=6,c=null;return 1===t?l=o===ft.aerial?(s=e?"#61a8f1":"#bdd5f5",e?"#213ad9":"#6d81f6"):(s=e?"#36a8ff":"#edf7ff",e?"#2656e2":"#6d90f6"):2===t&&e?(s=o===ft.aerial?"#61a8f1":"#36a8ff",l=o===ft.aerial?"#213ad9":"#2656e2"):e&&(s="#cacaca",l="#727272"),d=i<=7?(p=4,6):i<=14?(p=6,8):i<=17?(p=7,9):(p=8,10),s&&(a&&(a.isFerry||"Ferry"===a.mode?d=l=null:"Walk"===a.mode||n===b.walking?c=[0,1.5]:$e.trafficColorRouteLine&&e&&("Heavy"===a.mode||"High"===a.mode?l=1===t||2===t?(s="#ed1c24","#880015"):(s="#7c7c7c","#545454"):"Moderate"===a.mode?l=1===t||2===t?(s="#ffbe4b","#be5a00"):(s="#9f9f9f","#686868"):"Low"===a.mode&&(s="#f2d514",l="#ffbe4b"))),a=r={visible:!0},l=l,p=p,d=d,c=c,(s=s)&&(a.strokeStyle=s),l&&(a.secondaryStrokeStyle=l),p&&(a.lineWidth=p),d&&(a.secondaryLineWidth=d),c&&(a.strokeDashArray=c)),r},(Z=k=k||{})[Z.none=0]="none",Z[Z.start=1]="start",Z[Z.middle=2]="middle",Z[Z.via=12]="via",Z[Z.turn=13]="turn",Z[Z.end=10]="end",Z[Z.ferry=3]="ferry",Z[Z.walk=4]="walk",Z[Z.bus=5]="bus",Z[Z.train=6]="train",Z[Z.airline=7]="airline",Z[Z.tube=8]="tube",Z[Z.auto=9]="auto",Z[Z.infopin=15]="infopin",Z[Z.parkAndRide=16]="parkAndRide",Qt(To,F=Lt),To.prototype.getLocations=function(){return this._locations},To.prototype.getIndex=function(){return this._index},To.prototype.getTemplate=function(){return this.isHidden?null:this._template},To.prototype.update=function(){this._changeTemplate(this.isHidden?null:this.createOptions(this._isRouteSelected,this._taskState,this._currentZoomLevel,this._mapType,this._maneuverType,this._routeMode))},To.prototype.createOptions=function(e,t,i,o,a,n){return Vi.createPolylineOptions(e,t,i,o,a,n)},To.prototype.getCurrentZoom=function(){return this._currentZoomLevel},To.prototype.getMapType=function(){return this._mapType},To.prototype.getRouteMode=function(){return this._routeMode},To.prototype.getNumberOfViaPoints=function(){return this._numberOfViaPoints},To.prototype.getManeuverType=function(){return this._maneuverType},To.prototype.isTapEnabled=function(){return!0},To.prototype.isMoveEnabled=function(){return this._isAddingViaAllowed()},To.prototype.isHoverEnabled=function(){return this._isAddingViaAllowed()||!this.isRouteSelected()},To.prototype.changeZoom=function(e){this._currentZoomLevel=e},To.prototype.isRouteSelected=function(){return this._isRouteSelected},To.prototype.setVisibility=function(e){this.isHidden=!e,this.update()},To.prototype.changeRouteSelectionState=function(e){this._isRouteSelected=e},To.prototype.changeCardTaskState=function(e){this._taskState=e},To.prototype.changeMapType=function(e){this._mapType=e},To.prototype._getRoutePolylineOptions=function(e){function t(e){return e&&"string"!=typeof e?e.toRgba():e}var i;return e?{strokeStyle:t(e.strokeColor),lineWidth:e.strokeThickness,secondaryStrokeStyle:t(e.secondaryStrokeColor),secondaryLineWidth:e.secondaryStrokeThickness,strokeDashArray:(i=e.strokeDashArray)?Array.isArray(i)?i:0<(i=i.split(/[, ]+/).map(function(e){return parseInt(e)}).filter(isFinite)).length?i:null:null,visible:e.visible}:null},To.prototype._changeTemplate=function(e){var t;e?((t=this._polylineOptions)&&(e.strokeStyle=t.strokeStyle||e.strokeStyle,e.lineWidth=("number"==typeof t.lineWidth?t:e).lineWidth,e.secondaryStrokeStyle=t.secondaryStrokeStyle||e.secondaryStrokeStyle,e.secondaryLineWidth=("number"==typeof t.secondaryLineWidth?t:e).secondaryLineWidth,e.strokeDashArray=t.strokeDashArray||e.strokeDashArray,e.visible="boolean"==typeof t.visible||e.visible),e.visible?(t=e.strokeStyle+"_"+e.lineWidth+"_"+e.secondaryStrokeStyle+"_"+e.secondaryLineWidth+"_"+e.strokeDashArray,this._template=To._templateCache.getItem(t),this._template||(this._template=new Ue({strokeStyle:e.strokeStyle,lineWidth:e.lineWidth,secondaryStrokeStyle:e.secondaryStrokeStyle,secondaryLineWidth:e.secondaryLineWidth,dashes:e.strokeDashArray,hitTest:1}),To._templateCache.addItem(t,this._template))):this._template=null):this._template=null},To.prototype._isAddingViaAllowed=function(){return!1},To.prototype.getTemplates=function(){return[this._template]},To.prototype._updateLineGeometry=function(){for(var e=this.getLocations(),t=new Array(e.length),i=new Array(e.length),o=i.length;o--;)i[o]=e[o].longitude,t[o]=e[o].latitude;var a=(new qe).accumulateLocations(e),a={generalizable:!0,x:i,y:t,bounds:a&&a.bounds};this.geometry=a},To._templateCache=new gt(512),B=To,fo.prototype.setLocation=function(e){this._location=e,this._updatePointGeometry(this._location)},fo.prototype.getLocation=function(){return this._location},fo.prototype.getManeuverType=function(){return this._maneuverType},fo.prototype.changeZoom=function(e){this.currentZoomLevel=e},fo.prototype.changeRouteSelectionState=function(e){this.isRouteSelected=e},fo.prototype.changeCardTaskState=function(e){this.taskState=e,1===this.taskState?this.setLabel(this._labelText,this._iconText):this.setLabel(null,null)},fo.prototype.getTemplates=function(){return this.isHidden?null:this._templates},fo.prototype.setVisibility=function(e){this.isHidden=!e,this.update(),this.entity.changed.invoke()},fo.prototype.update=function(){this.revision++},fo.prototype.createOptions=function(){return null},fo.prototype.isTapEnabled=function(){return!0},fo.prototype.isHoverEnabled=function(){return this._isInteractive},fo.prototype.isMoveEnabled=function(){return(this.routeMode===b.transit||$e.enableMultiMode&&this.routeMode===b.multimode)&&this._isInteractive?this.pushpinIconType===k.start||this.pushpinIconType===k.end||this.pushpinIconType===k.middle:this._isInteractive},fo.prototype._changeTemplate=function(e){var t,i,o,a,n,r;if(e&&e.length){for(t=[],i=0,o=e.length;i<o;i++)n=null,(a=e[i]).isVectorImage?(r=[a.radius+(a.isSquare?"S":""),a.fillColor,a.borderWidth,a.borderColor,a.innerRadius,a.innerFillColor].join("_"),(n=fo._templateCache.getItem(r))||(n=new Zt(this._createVectorImage(a)),fo._templateCache.addItem(r,n))):(r=(r=a.anchor)?new Ne(r.x,r.y,1):new Ne(Math.ceil(a.width/2),a.height,1),n=new ze(a.icon,1,r)),n&&t.push(n);this._templates=t}else this._templates=null},fo.prototype._updatePointGeometry=function(e){var t=e.latitude,e=e.longitude;this.geometry.x=e,this.geometry.y=t,this.geometry.bounds=[t,e,t,e]},fo.prototype._createVectorImage=function(e){var t={records:[],hotspotX:0,hotspotY:0,hitTest:1},i=t.records;return e.isSquare?(e.borderWidth&&e.borderColor&&i.push(this._squareRecord(e.radius+e.borderWidth,e.borderColor)),e.fillColor&&i.push(this._squareRecord(e.radius,e.fillColor))):(e.fillColor&&i.push(this._ellipseRecord(e.radius,{fillStyle:e.fillColor})),e.borderWidth&&e.borderColor&&i.push(this._ellipseRecord(e.radius,{lineWidth:e.borderWidth,strokeStyle:e.borderColor})),e.hasInnerCircle&&e.innerFillColor&&e.innerRadius&&i.push(this._ellipseRecord(e.innerRadius,{fillStyle:e.innerFillColor}))),t},fo.prototype._squareRecord=function(e,t){return{pointsList:[{x:-e,y:-e},{x:e,y:-e},{x:e,y:e},{x:-e,y:e}],vectorType:0,style:{fillStyle:t}}},fo.prototype._ellipseRecord=function(e,t){return{centerX:0,centerY:0,radiusX:e,radiusY:e,vectorType:2,style:t}},fo._templateCache=new gt(64),fo._index=0,E=fo,(N=w=w||{})[N.BusinessWith4Images=0]="BusinessWith4Images",N[N.BusinessWith2Images=1]="BusinessWith2Images",N[N.BusinessWith1Image=2]="BusinessWith1Image",N[N.AddressWith2Images=3]="AddressWith2Images",N[N.MapWith0Image=4]="MapWith0Image";var Wi=(vo.prototype.createShareImage=function(n){var r=this;tt.instance.authenticateClientAndRetrieveSessionId(function(e){var o,a;r._setTemplateSize(r._template),r._addMapImages(e,r._template),r._imageUrls=r._reformatImageSizes(r._imageUrls,r._imageWidths,r._imageHeights),0===r._imageUrls.length&&n(),(o=document.createElement("canvas")).width=Nt.shareImgWidth,o.height=Nt.shareImgHeight,(a=o.getContext("2d")).fillStyle=Nt.shareImgMarginFill,a.fillRect(0,0,Nt.shareImgWidth,Nt.shareImgHeight),r._loadImages(r._imageUrls,function(e){var t,i;e&&e.length===r._imageUrls.length||n();try{for(t=0;t<e.length;t++)i=e[t],a.drawImage(i,r._imageLeftPositions[t],r._imageTopPositions[t]);n(o.toDataURL("image/jpeg",.8))}catch(e){n()}})})},vo.prototype._setTemplateSize=function(e){var t=Nt.shareImgMargin;switch(e){case w.BusinessWith4Images:this._imageWidths=[250,110-t,240-t,175-t,175-t],this._imageHeights=[315,155,155,160-t,160-t],this._imageLeftPositions=[0,250+t,360+t,250+t,425+t],this._imageTopPositions=[0,0,0,155+t,155+t];break;case w.BusinessWith2Images:case w.AddressWith2Images:this._imageWidths=[420,180-t,180-t],this._imageHeights=[315,160-t,155],this._imageLeftPositions=[0,420+t,420+t],this._imageTopPositions=[0,0,160];break;case w.BusinessWith1Image:this._imageWidths=[600,180],this._imageHeights=[315,90],this._imageLeftPositions=[0,420],this._imageTopPositions=[0,225]}},vo.prototype._addMapImages=function(e,t){var i,o;t!==w.MapWith0Image&&(i={width:0<this._imageWidths.length&&this._imageWidths[0],height:0<this._imageHeights.length&&this._imageHeights[0],centerPoint:this._mapMode&&this._mapMode.centerPoint,zoomLevel:this._mapMode&&this._mapMode.level,pushpins:this._pushpins},t!==w.AddressWith2Images?(o=this._createMapSnippetUrl(e,i))&&this._imageUrls.splice(0,0,o):2<this._imageHeights.length&&2<this._imageWidths.length&&(this._imageUrls=[],(o=this._createMapSnippetUrl(e,i))&&this._imageUrls.push(o),i.width=this._imageWidths[1],i.height=this._imageHeights[1],i.imagerySet="Aerial",(o=this._createMapSnippetUrl(e,i))&&this._imageUrls.push(o),i.width=this._imageWidths[2],i.height=this._imageHeights[2],i.imagerySet="StreetSide",i.query=this._query,(o=this._createMapSnippetUrl(e,i))&&this._imageUrls.push(o)))},vo.prototype._createMapSnippetUrl=function(e,t){var i,o,a,n,r=!1,s=Nt.mapSnippetUrl;if("Aerial"===t.imagerySet)s=s.replace("Road","Aerial");else if("StreetSide"===t.imagerySet&&t.query)s=s.replace("Road","StreetSide"),vo._latlonRegex.test(t.query)?s+="/"+(i=t.query.replace(/ /g,""))+"/"+i+"?":s+="/"+encodeURIComponent(t.query)+"?",r=!0;else if(t.imagerySet&&"Road"!==t.imagerySet)return null;if(!r&&t.route&&t.route.sourcePoint&&t.route.destinationPoint)s+=(t.route.mode,t.route.mode),s+="?wp.0="+t.route.sourcePoint.latitude+","+t.route.sourcePoint.longitude+"&wp.1="+t.route.destinationPoint.latitude+","+t.route.destinationPoint.longitude,r=!0;else if(!r&&"Aerial"!==t.imagerySet&&t.pushpins&&t.pushpins.length&&t.pushpins[0].location){for(s+="?",a=1===t.pushpins.length&&Nt.shareImgDetailPushpinType||Nt.shareImgListPushpinType,n=0;n<t.pushpins.length;n++)(o=t.pushpins[n]).location&&(s+="&pushpin="+o.location.latitude+","+o.location.longitude+";"+(o.type||a));r=!0}else!r&&t.centerPoint&&t.zoomLevel&&(s+="/"+t.centerPoint.latitude+","+t.centerPoint.longitude+"/"+t.zoomLevel+"?",r=!0);return r?(s=(s+="&mapSize={mapWidth},{mapHeight}&key={credentials}").replace("{mapWidth}",t.width.toString()).replace("{mapHeight}",t.height.toString()).replace("{credentials}",e),"Aerial"===t.imagerySet&&(s+="&da=n"),s):null},vo.prototype._cleanImageUrls=function(e){for(var t,i,o=[],a=[],n=0;n<e.length;n++)if((i=(t=e[n]).match(/[?&]id=([^&]*)/gi))&&i.length){if(i=i[0].substr(4),0<=o.indexOf(i))continue;o.push(i),t=t.replace(/http[s]?:\/\/([^\/]*)/,""),a.push(t)}return a},vo.prototype._loadImages=function(e,t){for(var i=[],o=e.length,a=0,n=0;n<o;n++)i.push(new Image),i[n].onload=function(){++a>=o&&t(i)},i[n].onerror=function(){t()},i[n].src=e[n]},vo.prototype._reformatImageSizes=function(e,t,i){var o,a,n;if(e.length!==t.length)return[];for(o=/&w=[0-9]*/i,a=/&h=[0-9]*/i,n=0;n<e.length;n++)e[n]=e[n].replace(o,"&w="+t[n]).replace(a,"&h="+i[n]);return e},vo._latlonRegex=/\d+\.\d*, ?-?\d+\.\d*$/,vo),Gi=(Qt(mo,V=ni),mo.prototype.setOptions=function(e){return!!(e&&(e.containerId&&0<e.containerId.trim().length||e.container)&&e.width&&0<e.width&&e.height&&0<e.height)&&(this._options=e,!0)},mo.prototype.show=function(t,i){var e,o=this;t?(e=this._createOverlay(i),this._addOverlayToMap(e,i),i.heading=i.heading||mt.getAngleBetweenTwoLocations(new bt(t.la,t.lo),i.locationToLookAt),e=this._getMiniOptions(i),this.setOptions(e)?(e=function(e){return o._prepStreetsideMini(e,t,i&&i.onSuccessLoading,i&&i.onErrorLoading)},this._map.getContainer().instanceAsync(this._streetsideMiniInstanceName,e),this._addEventHandlers(t,i)):this._handleError(i&&i.onErrorLoading)):this._noBubbleAction(i)},mo.prototype._handleError=function(e){var t;(t=Microsoft&&Microsoft.Maps?Microsoft.Maps.logger:t)&&t.logObject({feature:fi.StreetsideModeFeatureName,action:fi.StreetsideErrorAction,data:{ET:fi.StreetsideBootstrapError}}),e&&e(),this.hideStreetside()},mo.prototype._noBubbleAction=function(e){this._handleError(e&&e.onErrorLoading)},mo.prototype._getMiniOptions=function(e){e={containerId:ji.id,width:this._overlay.getWidth(),height:this._overlay.getHeight(),cssClasses:["bm_streetsideMiniCircle"],entryPoint:e.entryPoint,heading:e.heading,isInteractive:!1,perfState:e.perfState,perfClickToImmersionTimeSource:e.perfClickToImmersionTimeSource,rotateBubble:!0};return navigator.userAgent.indexOf("Chrome")<0&&0<=navigator.userAgent.indexOf("AppleWebKit")&&0<=navigator.userAgent.indexOf("Safari")&&(e.rotateBubble=!1,e.preferredRenderer="canvas2d"),e},mo.prototype._prepStreetsideMini=function(e,t,i,o){var a=null;(a=this._options.container?this._options.container[0]:document.getElementById(this._options.containerId))?(a.appendChild(e.getRootElement()[0]),this._currentBubble=t,st._renderAllPoiAndLabelsGL()&&this._streetsideMini&&this._streetsideMini.dispose(),(this._streetsideMini=e).loadBubble(t,this._options,i,o)):o&&o()},mo.prototype.hideStreetside=function(){this._streetsideMini&&this._streetsideMini.removeSIVContent(),this._removeEventHandlers()},mo.prototype._createOverlay=function(){return new ji},mo.prototype._addOverlayToMap=function(e,t){this._overlay=e,this._overlay.setAlignment(t.locationToLookAt),this._map.getOverlays().insert(this._overlay)},mo.prototype._addEventHandlers=function(t,i){var o=this;this._overlayTappedHandler=function(e){return o._onOverlayTapped(e,t,i)},this._overlay.getOverlayElement().add_event("click,touchstart",this._overlayTappedHandler),this._mapTappedHandler=this._map.mapTapped.add(function(){return o.hideStreetside()}),this._mapZoomStartedHandler=this._map.mapZoomStarted.add(function(){return o.hideStreetside()}),this._mapContextMenuHandler=this._map.contextMenuInvoked.add(function(){return o.hideStreetside()}),this._mapModeChangedHandler=this._map.mapModeChanged.add(function(){return o.hideStreetside()}),this._primitiveTappedHandler=this._map.primitiveTapped.add(function(){return o.hideStreetside()}),this._hideStreetsideHandler=function(e){return o._onWindowTapped(e)},rt(window).add_event("click,touchstart",this._hideStreetsideHandler)},mo.prototype._removeEventHandlers=function(){this._mapTappedHandler&&this._mapTappedHandler.dispose(),this._mapZoomStartedHandler&&this._mapZoomStartedHandler.dispose(),this._mapContextMenuHandler&&this._mapContextMenuHandler.dispose(),this._mapModeChangedHandler&&this._mapModeChangedHandler.dispose(),this._primitiveTappedHandler&&this._primitiveTappedHandler.dispose(),this._overlay&&(this._map.getOverlays().remove(this._overlay),this._overlay.getOverlayElement().remove_event("click,touchstart",this._overlayTappedHandler),rt(window).remove_event("click,touchstart",this._hideStreetsideHandler))},mo.prototype._onWindowTapped=function(e){e.target&&rt(e.target.parentElement).has_class("ms-composite")||this.hideStreetside()},mo.prototype._onOverlayTapped=function(e,t,i){var o,a,n,r,s=this;t?(o=this._overlay.getWidth()/2,(a=this._overlay.getOverlayElement().get_absolute_pos()).x+=o,a.y+=o,n=new It(e.pageX,e.pageY),e&&e.touches&&1==e.touches.length&&(r=e.touches[0],n=new It("number"==typeof r.clientX?r.clientX:r.pageX,"number"==typeof r.clientY?r.clientY:r.pageY)),zt.pointInCircle(n,a,o)&&(e.stopImmediatePropagation(),i.perfState=this._perfLog&&this._perfLog.start(i.perfClickToImmersionTimeSource),this._map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(e){e.show(t,i),s.hideStreetside()}))):this.hideStreetside()},mo),Qi=(Qt(yo,H=Gi),yo.prototype.showStreetsideIfAvailable=function(i,o,a){var n,r=this;i&&i.locationToLookAt&&i.locationToLookFrom?(n=this._getAppropriateLookLocation(i),this.isAvailable(n,function(e,t){return r._pickAndShowBestPossibleBubble(t,{locationToLookAt:n,directionsStartupOptions:i,entryPoint:fi.EntryPointDrivingDirections,perfClickToImmersionTimeSource:Ti.DirectionsClickToImmersionTime,onSuccessLoading:o,onErrorLoading:a})},a)):a&&a()},yo.prototype._noBubbleAction=function(e){var t=this._createOverlay(e);this._showZoomedMapTile(t,e.locationToLookAt),this._addOverlayToMap(t,e),this._addEventHandlers(null,e),e&&e.onSuccessLoading&&e.onSuccessLoading()},yo.prototype._addEventHandlers=function(e,t){var i=this;H.prototype._addEventHandlers.call(this,e,t),this._mapViewChangedHandler=this._map.viewChanged.add(function(){return i.hideStreetside()})},yo.prototype._removeEventHandlers=function(){H.prototype._removeEventHandlers.call(this),this._mapViewChangedHandler&&this._mapViewChangedHandler.dispose(),this._mapViewChangedHandler=null},yo.prototype._showStreetsideMini=function(t,i,o){var a=this;this._map.getContainer().instanceAsync("StreetsideDirectionsMini",function(e){return a._prepStreetsideMini(e,t,i,o)})},yo.prototype._getMiniOptions=function(e){return{containerId:"directionsStreetsideContainer",width:Vt.directionsViewportWidth,height:Vt.directionsViewportHeight,cssClasses:["bm_streetsideMiniCircle","streetsideDirectionsCircle"],entryPoint:fi.EntryPointDrivingDirections,heading:e.directionsStartupOptions.heading,isInteractive:!1,setViewAnimationMilliseconds:Vt.setViewAnimationMillisecondsForStreetsideMini,perfState:e.directionsStartupOptions.perfState}},yo.prototype._createOverlay=function(e){return new Ji(e.directionsStartupOptions.maneuverType)},yo.prototype._pickAndShowBestPossibleBubble=function(e,t){var i=null;e&&(this.hideStreetside(),i=this._pickBestPossibleBubbleToLookFrom(t.directionsStartupOptions,e)),this.show(i,t)},yo.prototype._getAppropriateLookLocation=function(e){return this._isStartManeuver(e.maneuverType)?e.locationToLookFrom:e.locationToLookAt},yo.prototype._isStartManeuver=function(e){return e===yo._startManeuver},yo.prototype._showZoomedMapTile=function(e,t){var i=this._map.getMapType(),o="aerial";"Road"!==i.displayName&&"RoadVector"!==i.displayName&&(o="road"),t=this._mapTileUrlFormat.replace("{mapStyle}",o).replace("{latitude}",t.latitude.toString()).replace("{longitude}",t.longitude.toString()).replace("{cmnPltParam}",nt.platformCommonParam),e.getOverlayElement().set_style({backgroundImage:"url('"+t+"')"}),e.getOverlayElement().add_class("bm_streetsideMiniCircle streetsideDirectionsCircle")},yo.prototype._pickBestPossibleBubbleToLookFrom=function(e,t){var i,o,a,n=mt.getAngleBetweenTwoLocations(e.locationToLookFrom,e.locationToLookAt);if(e.heading=n,this._isStartManeuver(e.maneuverType))return t[0];for(i=null,o=0,a=t.length;o<a;o++){var r=t[o],s=new bt(r.la,r.lo),l=mt.getAngleBetweenTwoLocations(s,e.locationToLookAt);if(this._anglesAreSimilar(n,l)){if((s=mt.greatCircleDistance(s,e.locationToLookAt))>=Vt.optimalDirectionsBubbleDistanceFromIntersectionInMeters)return i;s>=Vt.minimumDirectionsBubbleDistanceFromIntersectionInMeters&&(i=r)}}return i},yo.prototype._anglesAreSimilar=function(e,t){return zt.getAngleDifference(e,t)<Vt.directionsMaximumAngleDifferenceToConsiderTwoAnglesSimilar},yo._startManeuver="start",yo),ji=(Qt(go,O=wt),go.prototype._addExtraElements=function(){},go.id="streetsideMiniContainer",go.defaultWidth=295,go.defaultHeight=295,go),Ji=(Qt(_o,R=ji),_o.prototype._addExtraElements=function(){var e=st._createElement("div");e.add_class("streetsideDirectionsImage "+this._maneuverType),e.set_attr("id","directionsStreetsideManeuverType"),Ye.addDataTag(e,"DDSSManeuverType"),this._streetsideMiniOverlayDiv.append(e)},_o.id="directionsStreetsideContainer",_o),Yi=(Qt(uo,A=Gi),uo.prototype.hideStreetside=function(){this._localDetailsStartupOptions&&this._localDetailsStartupOptions.sivImageContainer.set_style({display:"none"})},uo.prototype.showStreetsideIfAvailable=function(e,t,i,o,a){var n,r=this;this._localDetailsStartupOptions=t,n={locationToLookAt:e,entryPoint:fi.EntryPointLocalDetails,pitch:t&&t.pitch,heading:t&&t.heading,fov:t&&t.fov,perfState:a,perfClickToImmersionTimeSource:Ti.LocalDetailsClickToImmersionTime,onSuccessLoading:i,onErrorLoading:o},t&&t.bubbleId&&0<t.bubbleId.length&&t.bubbleId!==uo.defaultInvalidBubbleId?this._map.getContainer().instanceAsync("IBubblesSource",function(){return r._getBubbleById(parseInt(t.bubbleId),function(e){return r.show(e,n)},o)}):this._showSSIfAvailableInRadius(t.routablePoint,function(e){r.show(e,n)},function(){r._showSSIfAvailableInRadius(e,function(e){r.show(e,n)},function(){r._handleError(o)})})},uo.prototype.showStreetsideModeForLocalDetails=function(e,t,i,o){var a,n=this;t?(a={locationToLookAt:e,entryPoint:fi.EntryPointLocalDetails,pitch:t.pitch,heading:t.heading,fov:t.fov,perfState:t.perfState,onSuccessLoading:i,onErrorLoading:o},(i=t.bubbleId)&&0<i.length&&i!==uo.defaultInvalidBubbleId?this._showStreetsideModeByBubbleId(i,a):e&&this._showSSIfAvailableInRadius(t.routablePoint,function(e){n._startStreetsideMode(e,a)},function(){n._showSSIfAvailableInRadius(e,function(e){n._startStreetsideMode(e,a)},function(){n._handleError(o)})})):this._handleError(o)},uo.prototype._startStreetsideMode=function(t,i){this._map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(e){e.show(t,i)})},uo.prototype._createOverlay=function(){return null},uo.prototype._addOverlayToMap=function(){this._localDetailsStartupOptions.sivImageContainer.set_style({display:"block"})},uo.prototype._addEventHandlers=function(t,i){var o=this;this._sivContainerTappedHandler=function(e){return o._onSIVContainerTapped(e,t,i)},this._localDetailsStartupOptions.sivImageContainer.add_event("click",this._sivContainerTappedHandler)},uo.prototype._removeEventHandlers=function(){this._localDetailsStartupOptions.sivImageContainer.remove_event("click,touchstart",this._sivContainerTappedHandler)},uo.prototype._getMiniOptions=function(e){var t=this._localDetailsStartupOptions.sivImageContainer;return{container:t,width:t.get_size().width,height:t.get_size().height,entryPoint:fi.EntryPointLocalDetails,pitch:e.pitch,heading:e.heading,fov:e.fov||35.9,isInteractive:!1,perfState:e.perfState}},uo.prototype._showSSIfAvailableInRadius=function(o,a,n){this.isAvailable(o,function(e){var t,i=null!=e;i&&(t=new bt(e.la,e.lo),i=mt.greatCircleDistance(t,o)<=Vt.localDetailsMaximumDistanceInMetersBetweenBubbleAndEntity),i?a(e):n&&n()},n)},uo.prototype._showStreetsideModeByBubbleId=function(t,i){this._map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(e){e.show(parseInt(t),i)})},uo.prototype._onSIVContainerTapped=function(e,t,i){e.preventDefault(),i.perfState=this._perfLog&&this._perfLog.start(i.perfClickToImmersionTimeSource),this._map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(e){e.show(t,i)})},uo.defaultInvalidBubbleId="1234567890",uo),Xi=(ho.prototype.attach=function(e){var t=this;Ye.assert(!this._map,"An event source has already been attached to this behavior."),this._map=e,this._lastMapZoomValue=0,this._disposables.push(this._map.mapZoomStopped.add(function(e){return t._onMapZoomStopped(e)})),this._disposables.push(this._map.viewChanged.add(function(e){return t._onViewChanged(e)})),this._disposables.push(this._map.mapTypeChanged.add(function(e){return t.mapTypeChanged(e)}))},ho.prototype.detach=function(){Ye.assertNotNull(this._map,"No map has been attached to this behavior.");for(var e=this._disposables.length;e--;)this._disposables.pop().dispose();this._map=null,this._lastMapZoomValue=0},ho.prototype._onMapZoomStopped=function(e){this.showCoverageIfNeeded(e.zoom)},ho.prototype._onViewChanged=function(){var e=yt.getMercatorZoomLevel(this._map);0!==Math.abs(e-this._lastMapZoomValue)&&(this._lastMapZoomValue=e,this.showCoverageIfNeeded(e))},ho.prototype.mapTypeChanged=function(){this.showCoverageIfNeeded(yt.getMercatorZoomLevel(this._map))},ho.prototype.showCoverageIfNeeded=function(e){this.showStreetSideOverlay(e)||this.hideStreetSideOverlay()},ho.prototype.showStreetSideOverlay=function(e){var t=this;return!st._isSmallMapShownOnSerp()&&(!!this._shouldAttachCoverageBehavior(e)&&(this._perfLog.start(Ti.AutoEntryToImmersionTime),this._streetsideCoverageBehavior?this._attachCoverageBehaviorIfNotAttached():this._map.getContainer().instanceAsync("StreetsideCoverageBehavior",function(e){t._shouldAttachCoverageBehavior(yt.getMercatorZoomLevel(t._map))&&(t._streetsideCoverageBehavior=e,t._attachCoverageBehaviorIfNotAttached())}),!0))},ho.prototype.hideStreetSideOverlay=function(){this._streetsideCoverageBehavior&&this._streetsideCoverageBehavior.isAttached()&&this._streetsideCoverageBehavior.getAttachedTo()===ho._name&&(this._streetsideCoverageBehavior.toggleStreetsideButton(!1),this._streetsideCoverageBehavior.detach())},ho.prototype._shouldAttachCoverageBehavior=function(e){var t=this._map.getMode();return t&&2!==t.mapModeType&&this._map.getMapType().id!==ft.birdseye&&this._map.getMapType().id!==ft.birdseyeV2&&ho._streetsideAutoEntryZoomLevel<=e},ho.prototype._attachCoverageBehaviorIfNotAttached=function(){this._streetsideCoverageBehavior.isAttached()||(this._streetsideCoverageBehavior.attach(this._map,this._attachOptions),this._streetsideCoverageBehavior.toggleStreetsideButton(!0))},ho._name="StreetsideAutoEntryBehavior",ho._streetsideAutoEntryZoomLevel=19,ho),$i=(Qt(co,x=wt),co.prototype.showNoCoverage=function(){this._tooltipMessageElement.remove_class(co._tooltipShowClassName)},co.prototype.showCoverage=function(e){ut.getItem(co._tooltipShownStorageName)?e&&this._tooltipMessageElement.remove_class(co._tooltipShowClassName):(this._tooltipMessageElement.add_class(co._tooltipShowClassName),ut.setItem(co._tooltipShownStorageName,"1",1))},co.prototype.showWaiting=function(){},co._tooltipShownStorageName="streetsideAutoEntryTooltipShown",co._tooltipShowClassName="streetsideTooltipShow",co._tooltipTimeToRemove=9e3,co),eo=(Qt(po,P=wt),po.prototype.showNoCoverage=function(e){this._noCoverageMessageTextElement.set_text(e),this._doSafeClassSwap(po.streetsideCursorManWaitingClass,po.streetsideCursorManNormalClass,po.streetsideCursorManNoCoverageClass),this._noCoverageMessageElement.add_class(po.streetsideCursorNoCoverageMessageShowClass)},po.prototype.showCoverage=function(){this._doSafeClassSwap(po.streetsideCursorManWaitingClass,po.streetsideCursorManNoCoverageClass,po.streetsideCursorManNormalClass),this._noCoverageMessageElement.remove_class(po.streetsideCursorNoCoverageMessageShowClass)},po.prototype.showWaiting=function(){this._cursorManElement.swap_class(po.streetsideCursorManNormalClass,po.streetsideCursorManWaitingClass)},po.prototype._doSafeClassSwap=function(e,t,i){this._cursorManElement.remove_class(e),this._cursorManElement.remove_class(t),this._cursorManElement.add_class(i)},po.streetsideCursorClass="bm_streetsideCursor",po.streetsideCursorManNormalClass="bm_streetsideCursorManNormal",po.streetsideCursorManNoCoverageClass="bm_streetsideCursorManNoCoverage",po.streetsideCursorManWaitingClass="bm_streetsideCursorManWaiting",po.streetsideCursorNoCoverageMessageClass="bm_streetsideCursorNoCoverageMessage",po.streetsideCursorNoCoverageMessageShowClass="bm_streetsideCursorNoCoverageMessageShow",po),to=(lo.prototype.getLocation=function(){return this._location},lo.prototype.getRoutableLocation=function(){return this._routableLocation},lo.prototype.getBoundingBox=function(){return this._boundingBox},lo.prototype.setBoundingBox=function(e){this._boundingBox=e},lo.prototype.getTitle=function(){return this._title},lo.prototype.setTitle=function(e){this._title=e},lo.prototype.getDescription=function(){return this._description},lo.prototype.setDescription=function(e){this._description=e},lo.prototype.getMenuUrl=function(){return this._menuUrl},lo.prototype.setMenuUrl=function(e){this._menuUrl=e},lo.prototype.getImageUrl=function(){return this._imageUrl},lo.prototype.setImageUrl=function(e){this._imageUrl=e},lo.prototype.getPrimaryCategoryPath=function(e){return!e||this._primaryCategoryPath&&""!==this._primaryCategoryPath?this._primaryCategoryPath:this._segmentTypes&&this._segmentTypes.length&&this._segmentTypes[0]||""},lo.prototype.setPrimaryCategoryPath=function(e){this._primaryCategoryPath=e},lo.prototype.getPrimaryCategoryName=function(){return this._primaryCategoryName},lo.prototype.setPrimaryCategoryName=function(e){this._primaryCategoryName=e},lo.prototype.getSelectedCategoryForIcon=function(){return this._selectedCategoryForIcon},lo.prototype.setSelectedCategoryForIcon=function(e){this._selectedCategoryForIcon=e},lo.prototype.getSearchCategory=function(){return this._searchCategory},lo.prototype.setSearchCategory=function(e){this._searchCategory=e},lo.prototype.getAddress=function(){return this._address},lo.prototype.setVdpId=function(e){this._vdpId=e},lo.prototype.getVdpId=function(){return this._vdpId},lo.prototype.setLocationType=function(e){this._locationType=e},lo.prototype.getLocationType=function(){return this._locationType},lo.prototype.setSegmentTypes=function(e){this._segmentTypes=e},lo.prototype.getSegmentTypes=function(){return this._segmentTypes},lo.prototype.getDateTime=function(){return this._dateTime},lo.prototype.setDateTime=function(e){this._dateTime=e},lo.prototype.getEndDateTime=function(){return this._endDateTime},lo.prototype.setEndDateTime=function(e){this._endDateTime=e},lo.prototype.getUtcOffset=function(){return this._utcOffset},lo.prototype.setUtcOffset=function(e){this._utcOffset=e},lo.prototype.getIsAllDayEvent=function(){return this._isAllDayEvent},lo.prototype.setIsAllDayEvent=function(e){this._isAllDayEvent=e},lo.prototype.setPhone=function(e){this._phone=e},lo.prototype.getPhone=function(){return this._phone},lo.prototype.setWebsite=function(e){this._website=e},lo.prototype.getWebsite=function(){return this._website},lo.prototype.setChainId=function(e){this._chainId=e},lo.prototype.getChainId=function(){return this._chainId},lo.prototype.clone=function(){return lo.cloneFrom(this)},lo.cloneFrom=function(e){var t=new lo(e._title,e._address,e.id,e._location,e._routableLocation,e._menuUrl,e._imageUrl,e.entitySource,e._primaryCategoryPath,e._primaryCategoryName,e._vdpId,e._locationType,e._dateTime,e._endDateTime,e._utcOffset,e._isAllDayEvent,e._segmentTypes,e.isApproximateLocation);return t.setDescription(e._description),t.setBoundingBox(e._boundingBox),t.setSelectedCategoryForIcon(e._selectedCategoryForIcon),t.setPhone(e._phone),t.setWebsite(e._website),t.setChainId(e._chainId),t.htmlElement=e.htmlElement,t.representsTransitStop=e.representsTransitStop,t.isUpHierarchy=e.isUpHierarchy,t.isPermanentlyClosed=e.isPermanentlyClosed,t.poiType=e.poiType,t},lo),io=(Qt(so,I=to),so.prototype.setRouteRequestState=function(e){this._routeRequestState=e},so.prototype.getRouteRequestOptions=function(){return this._routeRequestState&&this._routeRequestState.requestOptions},so.prototype.getIsHome=function(){return this._routeRequestState&&this._routeRequestState.isHome},so.prototype.hasRouteRequestState=function(){return void 0!==this._routeRequestState},so.prototype.getIndependentHotRegions=function(){return this.hasRouteRequestState()},so),oo=(ro.prototype.getTitle=function(){return this._title},ro.prototype.setTitle=function(e){this._title=e},ro.prototype.getDescription=function(){return null},ro.prototype.getMenuUrl=function(){return null},ro.prototype.getAddress=function(){return null},ro.prototype.getSelectedCategoryForIcon=function(){return this._selectedCategoryForIcon},ro.prototype.setSelectedCategoryForIcon=function(e){this._selectedCategoryForIcon=e},ro.prototype.getSearchCategory=function(){return this._searchCategory},ro.prototype.setSearchCategory=function(e){this._searchCategory=e},ro),ao=(Qt(no,D=to),no);Oe.DataHandlerKeys=Xt,Oe.GlobalDataEventHandler=ai,Oe.HomeOrWorkEnabledLocalSearchEntity=io,Oe.ImageFromCssHelper=hi,Oe.ListDataSource=gi,Oe.LocalSearchEntity=to,Oe.NavigationBarOverlay=Pi,Oe.TaskTypes=si,He._HashBasedHistory=di,He._HistoryWrapper=ci,He._OverlayDataEntityAction=v,He._OverlayEntity=Fi,He._OverlayManager=Ui,He.AerialBirdsEyeTransitionManager=Bi,He.BrowserHistoryManager=pi,He.BrowserKeyProvider=jt,He.BrowserPointerProvider=Jt,He.CityPolygonManager=Yt,He.DefaultPrimitiveCriteria=Vi,He.GeochainControl=t,He.GeochainOverlay=Zi,He.Geocoder=ei,He.GeolocationProvider=ii,He.LandmarksManager=_i,He.LocalSearchEntity=to,He.MapInteraction=Si,He.MapInteractionBehavior=Li,He.MapModeStateHistory=ki,He.NavigationBar=xi,He.NavigationHelper=Ci,He.OverlayManager=Ui,He.Permalink=li,He.PrintContent=qi,He.PushpinIconType=k,He.ReverseGeocoder=Ki,He.GeochainManager=$t,He.RoutePolyline=B,He.RoutePushpin=E,He.SharingInstrumentationAction=oi,He.TrafficToggleButton=_,He.TransitLandmarkOverlayTemplate=Gt,He.CameraMiniOverlayTemplate='<div class="infoboxOverlay trafficMiniInfobox">    <TextBlock Text="{Binding primitive.entity.trafficDescription}" /></div>',He._StreetsideAutoEntryBehavior=Xi,He._StreetsideBubblePickerOverlay=eo,He._StreetsideCoverageBehavior=bi,He._StreetsideDirectionsBootstrapper=Qi,He._StreetsideDirectionsOverlay=Ji,He._StreetsideLocalDetailsBootstrapper=Yi,He._StreetsideLoggerConstants=fi,He._StreetsideMiniBootstrapper=Gi,He._StreetsideModeBootstrapper=ri,He._StreetsidePerfConstants=Ti,Ve.CollectionActions=f,Ve.Waypoint=T,Ve.DistanceUnit=S,Ve.Optimize=L,Ve.RecommendationEntity=oo,Ve.TimeTypes=C,Ve.DirectionsMode=b,Ve.TravelAttractionEntity=ao,He._TaskDataHandlerHelper=Ni}catch(e){if(!Oe.logger)throw e;Oe.logger.logCriticalError(e)}function no(e,t,i,o){return D.call(this,e,t,i,o,o)||this}function ro(e,t){this.id=e,this._title=t}function so(e,t,i,o,a,n,r,s,l,p,d,c,h,u,_,g,y,m){return I.call(this,e,t,i,o,a,n,r,s,l,p,d,c,h,u,_,g,y,m)||this}function lo(e,t,i,o,a,n,r,s,l,p,d,c,h,u,_,g,y,m){this._title=e,this._description=t,this._address=t,this.id=i,this._location=o,this._routableLocation=a,this._menuUrl=n,this._imageUrl=r,this.entitySource=s,this._primaryCategoryPath=l||"",this._primaryCategoryName=p||"",this._vdpId=d,this._locationType=c,this._dateTime=h,this._endDateTime=u,this._utcOffset=_,this._isAllDayEvent=g,this._segmentTypes=y,this.isApproximateLocation=m,this.isPaginationReducedPoi=!1}function po(){var e=this,t=st._createElement("div"),i=new bt(0,0),o=new It(5,41),e=P.call(this,t,i,o)||this;return t.set_attr("class",po.streetsideCursorClass),e._cursorManElement=st._createElement("div"),e._cursorManElement.set_attr("class","bm_streetsideCursorMan "+po.streetsideCursorManNormalClass),e._cursorManElement.set_attr("data-tag","Streetside.CursorMan"),t.append(e._cursorManElement),e._noCoverageMessageTextElement=st._createElement("p"),e._noCoverageMessageTextElement.appendText(Rt.L_StreetsideNoCoverageInstructions_Text),e._noCoverageMessageElement=st._createElement("div"),e._noCoverageMessageElement.set_attr("class",po.streetsideCursorNoCoverageMessageClass),e._noCoverageMessageElement.append(e._noCoverageMessageTextElement),t.append(e._noCoverageMessageElement),e}function co(){var e=this,t=st._createElement("div"),i=new bt(0,0),o=new It(0,0);return(e=x.call(this,t,i,o)||this)._cursorElement=st._createElement("div"),e._cursorElement.set_attr("class","streetsideAutoEntryTooltip"),e._cursorElement.set_attr("data-tag","Streetside.AutoEntryTooltip"),t.append(e._cursorElement),e._tooltipMessageTextElement=st._createElement("p"),e._tooltipMessageTextElement.appendText(Rt.L_StreetsideAutoEntryTooltip_Text),e._tooltipMessageElement=st._createElement("div"),e._tooltipMessageElement.set_attr("class",eo.streetsideCursorNoCoverageMessageClass),e._tooltipMessageElement.append(e._tooltipMessageTextElement),t.append(e._tooltipMessageElement),e}function ho(e,t){this._map=null,this._disposables=[],this.attach(e),this._perfLog=t,this._streetsideCoverageBehavior=null,this._attachOptions={pickerOverlay:new $i,attachedTo:ho._name,entryPoint:fi.EntryPointZoomIn,perfIdentifier:Ti.AutoEntryToImmersionTime,followCursor:!1},this.showCoverageIfNeeded(yt.getMercatorZoomLevel(this._map))}function uo(e,t,i){i=A.call(this,e,t,i)||this;return i._sivContainerTappedHandler=null,i._streetsideMiniInstanceName="StreetsideLocalDetailsMini",i}function _o(e){var t=R.call(this,_o.id,Vt.directionsViewportWidth,Vt.directionsViewportHeight)||this;return t._maneuverType=e,t._addExtraElements(),t}function go(e,t,i){var o=this;e=e||go.id,t=t||go.defaultWidth,i=i||go.defaultHeight;var a=new bt(0,0),n=new It(t/2,i/2),r=st._createElement("div");return((o=O.call(this,r,a,n)||this)._streetsideMiniOverlayDiv=r).set_attr("id",e),r.set_style({width:t+"px",height:i+"px"}),r.add_class("bm_streetsideMiniOverlay"),Ye.addDataTag(r,"SSMiniOverlay"),o.defineProperty("width"),o.defineProperty("height"),o.setWidth(t),o.setHeight(i),o}function yo(e,t,i){i=H.call(this,e,t,i)||this;return i._streetsideMiniInstanceName="StreetsideDirectionsMini",i._mapTileUrlFormat=Vt.directionsOverlayMapTileUrlFormat.replace("{width}",Vt.directionsViewportWidth.toString()).replace("{height}",Vt.directionsViewportHeight.toString()),i}function mo(e,t,i){i=V.call(this,e,t,i)||this;return i._streetsideMiniInstanceName="StreetsideMini",i}function vo(e,t){var i,o,a;if(this._imageUrls=[],this._imageWidths=[],this._imageHeights=[],this._imageTopPositions=[],this._imageLeftPositions=[],this._pushpins=[],this._template=w.MapWith0Image,this._mapMode=e,t&&t.stacks&&t.stacks.length){e=t.focusedStackIndex||0,e=t.stacks[e],e=e?e.tasks[e.tasks.length-1]:null;if(e&&("LocalDetails"===e.type||"LocalListing"===e.type||"PolygonEntityDetails"===e.type)&&e.state){switch((i=e.state).imgUrls&&Array.prototype.push.apply(this._imageUrls,e.state.imgUrls),this._imageUrls=this._cleanImageUrls(this._imageUrls),this._imageUrls.length){case 0:this._template=w.MapWith0Image;break;case 1:this._template=w.BusinessWith1Image;break;case 2:case 3:this._template=w.BusinessWith2Images,this._imageUrls=this._imageUrls.slice(0,2);break;default:this._template=w.BusinessWith4Images,this._imageUrls=this._imageUrls.slice(0,4)}if(i.primerPois)for(o=0;o<i.primerPois.length;o++)a=i.primerPois[o].entity,1===i.primerPois.length&&0===this._imageUrls.length&&(this._template=w.AddressWith2Images,this._query=a.subtitle),(a=i.primerPois[o].geometry)&&this._pushpins.push({location:new bt(a.y,a.x)})}}}function fo(e,t,i,o,a,n,r,s,l,p){this.geometryType=1,this.crs=ct.instance,this.geometryType=1,this.geometry={x:0,y:0,bounds:null},this.id="Direction Pin"+fo._index++,this.entity=new Fi(s,null),this.entity.id=this.id,this.entity.collisionBehavior=2,this.revision=0,this.pushpinIconType=t,this._isInteractive=o,this.setLocation(e),this._maneuverType=a,this.taskState=1,this.stopPointIndex=n,this.viaPointIndex=r,this._labelText=s,this._iconText=l,this.setLabel(this._labelText,this._iconText),this.isHidden=p,this.routeMode=i}function To(e,t,i,o,a,n,r,s,l){var p=F.call(this)||this;return p.geometryType=2,p._index=t,p.crs=ct.instance,p.geometryType=2,p._locations=e,p._updateLineGeometry(),p._mapType=i,p._taskState=1,p.subLegIndex=a,p.legIndex=o,p._routeMode=n,p._numberOfViaPoints=r,p._maneuverType=s,p._polylineOptions=p._getRoutePolylineOptions(l),p.isHidden=!1,p}function bo(){}function Mo(e,t,i){var o,a=this,n={};if((a=U.call(this,n)||this)._mapLayers=new kt,n.defineProperty("cssScope"),n.defineProperty("htmlContent"),e&&a.setHtmlContent(e),n.defineProperty("layerIds"),t&&a.setLayerIds(t),i)for(a._mapLayers.clear(),o=0;o<i.length;o++)a._mapLayers.insert(i[o]);return a}function Co(){this._argsList=[],this.length=0}function So(e){var t=this;this._map=e,this._disposables=[],this._root=st._createElement("div").set_style({position:"absolute",width:"100%",height:"100%",pointerEvents:"none"}),this._disposables.push(e.actualSizeChanged.add(function(){return t._onViewChanged()})),this._disposables.push(e.viewChangingAfterPaint.add(function(){return t._onViewChanged()})),this._disposables.push(this._map.getOverlays().changed.add(function(e){return t._onOverlaysUpdated(e)})),this._onOverlaysUpdated({reset:!0})}function Lo(e){var t=this;return e&&(e=e.getRootElement(),t=z.call(this,e,null,null)||this),t}function ko(e,t,i,o,a,n){var r=this,r=q.call(this,a=a||{})||this;return a.defineProperty("title"),a.defineProperty("titleAction"),a.defineProperty("description"),a.defineProperty("actions"),a.defineProperty("address"),a.defineProperty("imageUrl"),a.defineProperty("nickname"),r.setTitle(e),r.setDescription(t),r.setAddress(n||""),i&&r.setTitleAction(i),o&&r.setActions(o),r}function Bo(){}function Eo(e,t,i,o,a,n,r,s,l,p,d,c,h){if(this.address=e,this.point=t,this.viaWaypoints=[],a)for(var u=0;u<a.length;u++)this.viaWaypoints.push(a[u]);this.isViaWaypoint=o,this.eid=n,this.type=r,this.stype=s,this.filterUrlParam=l,this.name=i,this.waypointType=p,this.waypointSource=d||0,this.locationIdentifier=c,this.isApproximate=!e,this.rawAddress=h}function wo(e,t,i){var o=this,a={};return(o=Y.call(this,a)||this).text=e,a.defineProperty("cssClass"),o.setCssClass(t),o.handler=i,o.showSeparator=!1,o.mouseoverHandler=null,o}function Do(e){var t=X.call(this,e)||this;return X.prototype.init.call(t,"ZoomOutButton","NavBar_zoomOut",Rt.L_NavBarZoomOutToolTip_Text,function(){t.getHelper().zoomOut()}),t}function Io(e){var t=$.call(this,e)||this;return $.prototype.init.call(t,"ZoomInButton","NavBar_zoomIn",Rt.L_NavBarZoomInToolTip_Text,function(){t.getHelper().zoomIn()}),t}function Po(e){var t=ee.call(this,e)||this;return t.setTemplate('<div id="ZoomControl" class="NavBar_Zoom NavBar_Button">    <div id="zoom_divider" class="zoom_divider" /></div>'),t.rendered.addOne(function(){(t.zoomInButton=new y(e)).appendTo(t.getRootElement()),(t.zoomOutButton=new m(e)).appendTo(t.getRootElement())}),t}function xo(e,t){var i=te.call(this,e)||this;return i._selectedClass="selected",e&&(i._showTrafficOnRendered=e.showTrafficOnRendered),i._trafficLayer=t,te.prototype.init.call(i,"TrafficToggleButton","NavBar_trafficToggle",Rt.L_NavBarTrafficToggleToolTip_TurnOn_Text,function(){i._trafficLayer&&i.getHelper().toggleTraffic(i._trafficLayer)}),i.rendered.addOne(function(){i._trafficLayer||i.getRootElement().add_class("disabled")}),i}function Ao(e){var t=ie.call(this,e)||this;return t.setTemplate(new Qe('<div id="RotateButtonContainer" class="NavBarButton_Container"></div>')),t.rendered.addOne(function(){(t._rotateLeftButton=new Ai(e)).appendTo(t.getRootElement()),(t._rotateResetButton=new Oi(e)).appendTo(t.getRootElement()),(t._rotateRightButton=new Ri(e)).appendTo(t.getRootElement())}),nt.isMapsVertical&&!st._isFeatureEnabled("birdseyeV2UI")||(t._updateTopMargin(),t._resizeHandler=function(){t._updateTopMargin()},rt(window).add_event("resize",t._resizeHandler)),t}function Ro(e){var t=oe.call(this,e)||this;return oe.prototype.init.call(t,"RotateButton","NavBar_rotate NavBar_heading_0D",Rt.L_NavBarRotateToolTip_Text,function(){return t.getHelper().resetMapHeading(!0)}),t}function Oo(e){var t=ae.call(this,e)||this;return ae.prototype.init.call(t,"RotateRightButton","NavBar_rotateRight",Rt.L_NavBarRotateCToolTip_Text,function(){return t.getHelper().rotateRight()}),t}function Ho(e){var t=ne.call(this,e)||this;return ne.prototype.init.call(t,"RotateLeftButton","NavBar_rotateLeft",Rt.L_NavBarRotateCCToolTip_Text,function(){return t.getHelper().rotateLeft()}),t}function Vo(t,e,i){var o,a=this,n=new Ci(t),r={helper:n,showTrafficOnRendered:!1};if((a=re.call(this,r)||this)._map=t,a._navBarControlArgs=r,n.setNavigationBar(a),a.resources=Rt,a._transitionManager=i,a.navBarButtons=[],a.mapTypeButtonClicked=new dt,!a._map.getMapOptions().serpMultiMapsAccessible)return a._mapTypeSelectorEnabled=!0,a._enableSquareStyle=(nt.isMapsAnswer||nt.isMsftPartner)&&!nt.isMapsVertical||nt.isSDK&&a._map.getMapOptions().navigationBarMode===Mt.square,a._updateTemplate(),a.disposables.push(a._transitionManager,n,t.mapTypeChanged.add(function(e){a._handleMapType(e.newMapTypeId),a._handleZoomChanged(t)}),t.viewChanged.add(function(){t.isPanning()||a._handleViewChange(t)}),t.mapZoomChanged.add(function(){a._handleZoomChanged(t)}),t.actualSizeChanged.add(function(){a._handleMapSizeChanged(t)})),o=a._map.getMapOptions(),a._currentNavBarMode=-1,a._currentOrientation=-1,a.rendered.addOne(function(){a.setNavigationBarOrientation(o.navigationBarOrientation),a.setNavigationBarMode(o.navigationBarMode),a._handleMapType(t.getMapType().id),a._handleViewChange(t),a._handleZoomChanged(t),a.getHelper().enableBirdseyeButton(),e&&!e.enableMapStyleSelector&&(a._mapTypeSelectorEnabled=!1,a.setMapStyleSelectorControlVisible(!1))}),a}function No(e){var t,i=this;return e&&(t=e.getRootElement(),e=new It(0,0),i=se.call(this,t,1,e)||this),i}function Fo(e){this._map=e,this._location=new bt(0,0),this.invalidated=new dt,this._selector=new Ke(e)}function Zo(e){var i=le.call(this,e)||this,e=i.getHelper().getMapType();return i._secondMapType=e!==ft.road&&Zo._mapTypeToToolTip[e]?e:ft.aerial,i._roadText=Rt.L_NavBarMapTypeSwitcherToolTip_Text.replace("{0}",Zo._mapTypeToToolTip[i._secondMapType]),i._secondMapTypeText=Rt.L_NavBarMapTypeSwitcherToolTip_Text.replace("{0}","road"),i._previousClass="road",le.prototype.init.call(i,"MapTypeSwitcherButton","NavBar_mapTypeSwitcher",Rt.L_NavBarMapTypeSwitcherRoadToolTip_Text,function(){var e=i.getHelper().getMapType(),e=e===ft.road||e===ft.highContrast?i._secondMapType:ft.road;i.getHelper().setMapType(e)}),i.rendered.addOne(function(){var e=i.getHelper().getMap(),t=e.getMapType().id;e.mapTypeChanged.add(function(e){return i._mapTypeChanged(e)}),i._mapTypeChanged({oldMapTypeId:t,newMapTypeId:t})}),i}function Uo(e){this._map=e}function zo(e){var t=pe.call(this,e)||this;return t.setTemplate("<div class='bm_LocateMeControl'></div>"),t.rendered.addOne(function(){(t._locateMeButton=new p(e)).appendTo(t.getRootElement()),!nt.isMobile&&st._isSmallMapShownOnSerp()&&t.setVisible(!1)}),t}function qo(e){var t=de.call(this,e)||this;return de.prototype.init.call(t,"LocateMeButton","NavBar_locateMe",Rt.L_NavBarLocateMeToolTip_Text,function(){t.getHelper().locateMe()}),t}function Ko(e,t){var i=ce.call(this)||this;return i._geochainCollapseClass="geochainCollapse",i._geochainUncollapseClass="geochainUncollapse",i._geochainContainerCollapseClass="collapsed",i._storedCollapsedState=!0,i._map=e,i._geochainManager=t,i.resources=Rt,i._storedCollapsedState="1"===ut.getItem("geoChainCollapsed"),i._autoresizeEnabled="0"!==ut.getItem("geoChainAutoresizeEnabled"),i.defineProperty("geochainSegments"),i.defineProperty("isLastLocationVisible",null,null,{defaultValue:!1}),i.defineProperty("isCollapsed",null,null,{defaultValue:i._storedCollapsedState}),i.defineProperty("isVisible",null,null,{defaultValue:!0}),i.setTemplate(new Qe(Wt,{stopEvent:function(e){return e.stopPropagation()},onSegmentClick:function(e){return i._onSegmentClick(e)},onFocus:function(){return i._onFocus()},onLastLocationClick:function(e){return i._onLastLocationClick(e)},onCollapseClick:function(e){return i._onCollapseClick(e)},boolToDisplay:function(e){return i.boolToDisplay(e)},boolToCollpased:function(e){return i.boolToDisplay(!e)},boolToVisibility:function(e){return i.boolToVisibility(e)},boolToContainerCollapsedClass:function(e){return i.boolToContainerCollapsedClass(e)},boolToCollapsedClass:function(e){return i.boolToCollapsedClass(e)},boolToExpandedString:function(e){return i.boolToExpandedString(e)}})),i.rendered.addOne(function(){return i._onRenderedAfterInit()}),i}function Wo(e,t,i){var o=he.call(this,e)||this;return o.isCompact=void 0!==t&&t,o.tooltip=o.getHelper().getMap().getMapOptions().disableBirdseye?Rt.L_NavBarOpenRadialMenuToolTip_NoBirdseye_text:Rt.L_NavBarOpenRadialMenuToolTip_Text,o.setTemplate(new Qe(o._getSelectorTemplate(),{onTouchStart:function(){return o._onTouchStart()},onClick:function(){o._onTouchStart()},onMouseOut:function(){try{o.getRootElement()[0].blur()}catch(e){}},onMouseEnter:function(){i||o._onMouseEnter()},onMouseLeave:function(e){return o._onMouseLeave(e)},onKeyUp:function(e){return o._onKeyUp(e)},stopEvent:function(e){return e.stopPropagation()}})),o._resizeHandler=function(){o._setText()},rt(window).add_event("resize",o._resizeHandler),o.rendered.addOne(function(){return o._onRenderedAfterInit()}),o}function Go(e){var t=ue.call(this,e)||this;return t._radialMenuControlArgs=e,t.setTemplate(new Qe(t._getTemplate(),{onMouseEnter:function(){return t._onMouseEnter()},onMouseLeave:function(e){return t._onMouseLeave(e)},onMouseWheel:function(e){return e.stopPropagation()},onContextMenu:function(e){return e.stopPropagation()}})),t.disposables=[],t.rendered.addOne(function(){return t._onRendered()}),t}function Qo(e){return _e.call(this,ft.streetside,"streetside",Rt.L_RadialMenuStreetsideButtonToolTip_Text,Rt.L_RadialMenuStreetsideButtonDescription_Text,e)||this}function jo(e){var t=ge.call(this,e)||this,i=Rt.L_DropDownMenuLabelToggleButtonToolTip_Text,o=t.getHelper().getMap().getMapOptions(),a=o.allowHidingLabelsOfRoad,e=!o.disableBirdseye,o=Rt.L_DropDownMenuLabelToggleButtonDescription_Text_AerialOnly;return a&&e?o=Rt.L_DropDownMenuLabelToggleButtonDescription_Text_RoadAerialBirdseye:a&&!e?o=Rt.L_DropDownMenuLabelToggleButtonDescription_Text_RoadAerial:!a&&e&&(o=Rt.L_DropDownMenuLabelToggleButtonDescription_Text),o='<div class="switchSlot labelToggle" for="navbarLabelToggleInput" tabindex="0" role="checkbox" aria-checked="true" aria-label="" title="{toggleButtonHoverToolTip}" event:blur="onBlur" event:click="onClick" event:touchstart="onClick" event:keyup="onKeyUp" event:contextmenu="onContextMenu">    <div class="labelToggle_Container labelStyle">        <input id="navbarLabelToggleInput" type="checkbox" class="labelToggle_Input" checked="checked" tabindex="-1" />        <label class="labelStyleSwitch" title="{tooltip}">{tooltip}</label>        <label class="labelToggle_label" helper="{TemplateBinding Helper}" role="button" aria-label="{tooltip}" />    </div></div>'.replace("{toggleButtonHoverToolTip}",Rt.L_RadialMenuLabelToggleToolTip_Text).replace(/{tooltip}/g,i).replace("{description}",o),t.setTemplate(new Qe(o,{onClick:function(e){return t._onClick(e)},onKeyUp:function(e){return t._onKeyUp(e)},onContextMenu:function(e){return e.stopPropagation()},onBlur:function(e){return t._onBlur(e)}})),t}function Jo(e,t){var i=this,o=ft.road,a=Rt.L_RadialMenuRoadButtonToolTip_Text,n=Rt.L_RadialMenuRoadButtonDescription_Text;return(i=ye.call(this,o,"road",a,n,e)||this).defineProperty("type",function(e,t){return i._typeChanged(e,t)},null,{defaultValue:"Road"}),t&&i.setType(t),i}function Yo(e){var t,i,o;return Yo.birdseyeUIConfig=nt.features.birdseyeV2UI,t=!1,i=Rt.L_RadialMenuBirdseyeButtonDescription_Text,Yo.birdseyeUIConfig&&Yo.birdseyeUIConfig.isEnabled&&nt.isMapsVertical&&(o='<span class="descriptionHereText"><TextBlock Text=" '+Rt.RadialMenuBirdseyeV2ButtonAlternateText+' "/></span>',i=(i=Rt.RadialMenuBirdseyeV2ButtonDescriptionText).replace("{0}",o),t=!0),me.call(this,ft.birdseye,"birdseye",Rt.L_RadialMenuBirdseyeButtonToolTip_Text,i,e,t)||this}function Xo(e){return ve.call(this,ft.aerial,"aerial",Rt.L_RadialMenuAerialButtonToolTip_Text,Rt.L_RadialMenuAerialButtonDescription_Text,e)||this}function $o(e,t,i,o,a,n){a=fe.call(this,a)||this;return a._classNameFormat="slot {0}",a._mapType=e,a._title=i,a.updateTemplate(t=n?"NoIcon "+t:t,i,o),a}function ea(e){var t=Te.call(this,e)||this,e='<div class="be2LabelToggleContainer" title="{TemplateBinding Resources.L_RadialMenuLabelToggleToolTip_Text}" event:click="onClick" event:touchstart="onClick">    <div class="be2LabelsTag">{labelToggleTooltip}</div>    <div class="be2LabelToggle switchSlot labelToggle" for="be2ToggleInput">        <div class="labelToggle_Container labelStyle">            <input id="be2ToggleInput" aria-label="{TemplateBinding Resources.L_RadialMenuLabelToggleToolTip_Text}" type="checkbox" class="labelToggle_Input" checked="checked" tabindex="-1" />            <label class="labelToggle_label" role="button" aria-label="{labelToggleTooltip}" />        </div>    </div></div>'.replace(/{labelToggleTooltip}/g,Rt.L_DropDownMenuLabelToggleButtonToolTip_Text);return t.setTemplate(new Qe(e,{onClick:function(e){return t._onClick(e)}})),t}function ta(e){var t=be.call(this,e)||this;return t._updateControlConfigs(),t.setTemplate(new Qe(t._getSelectorTemplate())),t._navBarControlArgs=e,t._instantiateExitButton(),t._instantiateCopyrightElement(),t}function ia(e){var t=Me.call(this,e)||this;return t.keydownEventName="keydown",Me.prototype.init.call(t,"BirdseyeV2ExitButton","birdseyeV2Exit",Rt.L_NavBarBirdseyeV2ExitTip_Text,function(){t.getHelper().exitBirdseyeV2()}),t._keyDownHandler=function(e){t._escHandler(e)},t}function oa(e){var t=Ce.call(this,e)||this;return t.rendered.add(function(){return t._postInit()}),t}function aa(e){var t,i=this,i=Se.call(this,null,e=e||{})||this;return e&&(t=e.helper),i.defineProperty("helper",null,null,{defaultValue:t}),i.defineProperty("style",i.onStyleChanged,i._styleConverter),i.defineProperty("title"),i}function na(e){var t,i,o=this;if(!e)throw new Error("map cannot be null");t=(this._map=e).getMapOptions(),i=this._map.getConfig(),this._maxZoomLevelBirdsEye=t&&t.aerialCutOffZoom?t.aerialCutOffZoom:i&&i.aerialCutOffZoom?i.aerialCutOffZoom:na.DEFAULT_ZOOM_CUT_OFF_FOR_BIRDSEYE_MODE,this._maxZoomLevelAerial=na.DEFAULT_ZOOM_CUT_OFF_FOR_AERIAL_MODE,this._maxZoomLevel=t.mapType===ft.birdseye?this._maxZoomLevelBirdsEye:this._maxZoomLevelAerial,this.changed=new dt,this._mapTypeChangedHandler=e.mapTypeChanged.add(function(){o._handleMapType(!0)}),this._handleMapType(!1)}function ra(e,t){var i=this;this._map=e,t&&(e.getMode()?this._initialize(t):e.mapModeChanged.addOne(function(){i._initialize(t)}))}function sa(){var i=this,e={},i=Le.call(this,e)||this;return e.defineProperty("mapPrimitives",function(e,t){i.onPrimitivesChanged(e,t)}),e.defineProperty("selectedPrimitive"),i.invalidated=new dt,i.events=[],i}function la(e,t,i,o){var a=this;this._map=e,this._mapElement=e.getRootElement()[0],this._aerialBirdsEyeTransitionManager=i,this._options={enabledInteractionModes:65535,tapThreshold:3,doubleTapThreshold:20,doubleTapTimeThreshold:500,autoRepeatDelay:1e3,autoRepeatTimerInterval:32,singlePanDistance:200,repeatPanDistance:20,singleZoomDistance:1,repeatZoomDistance:.05,maximumInitialLinearInertiaSpeed:1.41,maximumInitialExpansionInertiaSpeed:.07,maximumInitialAngularInertiaSpeed:.04},o&&this.setOptions(o),this._keyboardState=new vi,this._activePointers=new Et,this._previousManipulationDeltaTrail=new mi,this._inertia=new ui(function(e,t,i){a._inertiaCallback(e,t,i)}),this._previousTapTimestamp=0,this._coreConfig=t,this._resetStateToAwaitingInput(),this._disposables=[],this._pointerWheelChanged=new dt,this._disposables.push(this._pointerWheelChanged.addThrottled(function(e){return a._zoomOnPointerWheelChanged(e)},75,function(e,t){return a._filterPointerWheelChanged(e,t)})),this._disposables.push(this._map.interactionModeUpdated.add(function(){a._updateMapInteractionModes()})),this._updateMapInteractionModes()}function pa(e){var t=this;this.isEnabled=function(e){return-1===e[0].getAttribute("class").indexOf("disabled")},this._map=e,this._mapRoot=this._map.getRootElement(),this._isStreetsideSupported=this.isStreetsideSupported(),this._isStreetsideButtonEnabled=this._isStreetsideSupported,this._mePoi=new Ii(e),this._locateMeErrorDialog=new h(e),this._disposables=[],this.streetSideExitEvent=new dt,this._disposables.push(this._map.mapModeChanged.add(function(e){return t._onMapModeChanged(e)})),this._isLabelVisible=!0,this._isStreetsideSupported&&this._disposables.push(this._map.mapTypeChanged.add(function(){return t._onMapTypeChanged()}))}function da(){}function ca(e,t){this._map=null,this._noCoverage=!1,this._perfLog=t,this._bubbleLookupInProgress=!1,this._streetsideBubblePickerOverlay=null}function ha(){}function ua(){}function _a(){this.reset()}function ga(){this._deltaList=[]}function ya(e,t,i){this.expansion=e,this.rotation=t,this.translation=i}function ma(e){this._primitives=[],this._changedEventHandlers=[],this.invalidated=new dt,e&&this.addPrimitives(e)}function va(e,t,i){this._events=[],this._map=e,this._container=i,this._coreConfig=t,this.landmarksAllDataSourcePromise=new ot,this._infoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!1,htmlContent:null,location:null,autoAlignment:!0,offset:new It(10,10)},this._coupoiLandmarksDisplayed={}}function fa(e,t){this._callback=e,this._options={expansionDeceleration:8e-4,rotationalDeceleration:8e-4,linearDeceleration:.0023},t&&this.setOptions(t)}function Ta(){}function ba(e){var t=this;this._window=e,this.statechanged=new dt,this._window.history&&this._window.history.pushState?(this._history=this._window.history,rt(this._window).add_event("popstate",function(){return t._invokeStateChanged()})):((e=new di(this._window)).statechanged.add(function(){return t._invokeStateChanged()}),this._history=e),this._initialHistoryCount=this._history.length,this._historyIndex=0}function Ma(e){var t=this;this._window=e,this.length=-1,this.statechanged=new dt,rt(this._window).add_event("hashchange",function(){return t._processHashChange()}),this._loadState()}function Ca(e,t,i){var o=this;this._serializableComponents={},this._window=e,this._map=i,t.instanceAsync("Permalink",function(e){o._permalink=e,o._permalink.setRequestCompatibilityParams(!0)}),this._historyUrl=this._originalUrl=this._window.location.toString(),this._currentUrlPath=this._originalUrlPath=this._window.location.pathname,this._setDevParams(),this._isOnOverlay=st._isLargeMapShownOnSerp(),this._history=new ci(e),this._history.statechanged.add(function(e){return o._processStateChange(e)}),st._isSmallMapShownOnSerp()||(this._pageLoadStateDictionary=this._history.getState()),this._serializableObjectChanged=new dt,this._serializableObjectChanged.addThrottled(function(e){return o._processObjectChange(e)},300,function(e,t){var i=t;return i=!t||2!==t.magnitude?e:i})}function Sa(e,t){var i,o,a,n;for(o in this._taskManager=t,t=nt.features,this._sharingConfig=t.sharing,this._taskBar=e,i=[],this._requestCompatibilityParams=!1,this._sharingConfig.supportedSchemas)i=i.concat(this._sharingConfig.supportedSchemas[o].supportedFeatures),i=i.filter(function(e,t){return i.indexOf(e)==t});for(this._referrerFormCodeRegex=/form=([^&]*)/gi,this._longLinkBase="",this._queryConstants="",a={},n=0;n<i.length;n++)a[i[n]]=!0;this._taskToFeatureMap={},this._featureToTaskMap={},this._featureToTaskMap.taskFramework="taskFramework",this._taskToFeatureMap.taskFramework="taskFramework",this._featureToTaskMap.shareImage="shareImage",this._taskToFeatureMap.shareImage="shareImage",t.localSearch.isEnabled&&a.LocalListing&&(this._taskToFeatureMap[si.localListingTask]="localListing"),t.transit.isEnabled&&(a.TransitStop&&(this._taskToFeatureMap[si.transitStopTask]="transitStop",this._featureToTaskMap.transitStop=si.transitStopTask),a.NearbyTransit&&(this._taskToFeatureMap[si.nearbyTransitTask]="nearbyTransit",this._featureToTaskMap.nearbyTransit=si.nearbyTransitTask),a.TransitLine&&(this._taskToFeatureMap[si.transitLineTask]="transitLine",this._featureToTaskMap.transitLine=si.transitLineTask)),t.localSearch.isEnabled&&a.LocalDetails&&(this._taskToFeatureMap[si.localDetailsTask]="localDetails"),t.collections.isEnabled&&a.Collections&&(this._taskToFeatureMap[si.collectionsTask]="collections",this._featureToTaskMap.collections=si.collectionsTask),t.directions.isEnabled&&a.Directions&&(this._taskToFeatureMap[si.directionsTask]="directions",this._featureToTaskMap.directions=si.directionsTask),t.traffic.isEnabled&&a.Traffic&&(this._taskToFeatureMap[si.trafficTask]="traffic",this._featureToTaskMap.traffic=si.trafficTask),t.travel.isEnabled&&a.ItineraryDetails&&(this._taskToFeatureMap[si.itineraryDetailsTask]="itineraryDetails",this._featureToTaskMap.itineraryDetails=si.itineraryDetailsTask),this._featureToTaskMap.compositeMapMode="mode0",this._taskToFeatureMap.mode0="compositeMapMode",t.streetside.isEnabled&&(this._featureToTaskMap.streetside="mode2",this._taskToFeatureMap.mode2="streetside")}function La(){}function ka(e,t,i){i=Be.call(this,e,t,i)||this;return i._disposables=[],i._animating=!1,i._animationStartTime=0,i._animationDuration=0,i}function Ba(e,t,i){this._map=e,this._perfLog=i,this._bubbleSource=t}function Ea(e){function s(e,t){var i=Ea._invokeHandlerQueue[e];i&&t.processData(e,i)}var t,i,o,a,n,l;if(Ea._reset(),Ea._container=e,(t=Object.keys(Ea._eventAttributeData))&&t.length)for(o=0;o<t.length;o++)Ea._registerEvent(t[o]);if((i=Object.keys(Ea._staticDataHandlers))&&i.length)for(o=0;o<i.length;o++)a=i[o],n=Ea._staticDataHandlers[a],Ea._dataHandlers[a]=n,s(a,n);(l=Object.keys(Ea._dynamicDataHandlers).map(function(e){return{name:e}}))&&l.length?e.instanceAsyncAll(l,function(e){var t,i;if(Ea._container){for(t=0;t<l.length;t++)for(var o=l[t].name,a=Ea._dynamicDataHandlers[o],n=e[o],r=0;r<a.length;r++)i=a[r],Ea._dataHandlers[i]=n,s(i,n);Ea._invokeHandlerQueue={}}}):Ea._invokeHandlerQueue={}}function wa(e){wa._container=e,wa._references&&e.instanceAsyncAll(wa._references,function(e){var t,i;if(wa._references){for(t=0;t<wa._references.length;t++)for(var o=wa._references[t].name,a=wa._mapping[o],n=e[o],r=0;r<a.length;r++)i=a[r],wa._attrDataHandlerList[i]=n,wa._invokeHandlerQueue[i]&&n.processData(i,wa._invokeHandlerQueue[i]);wa._references=null,wa._mapping=null,wa._invokeHandlerQueue=null}})}function Da(e,t){this._window=e,this._reverseGeocoder=t,this._fetchingPosition=!1}function Ia(){}function Pa(){}function xa(e,t){this._worldText=Rt.L_GeochainWorldText,this._boundsCache=new gt(100),this._currentGeochainRequestIds=[],this._map=e,this._reverseGeocoder=t}function Aa(){}function Ra(e,t,i){this._map=e,this._coreConfig=t,this._container=i,this._disposables=[],this._noBoundaryData=!1,this.invalidated=new dt,this._geoEntityApiHasData=!0}function Oa(e,t){var i=Ie.call(this,e)||this;i._registeredJsEvents={},i._map=t;for(var t=function(e,t){return i._addLocationToEvent(e,t)},o={argBuilder:t},a={preventDefault:!0,argBuilder:t},n=i._rootElement=i._map.getRootElement(),r=["mouseup","mouseenter","mouseleave","mousemove","mousewheel","touchstart"],s=["mousedown","contextmenu","touchend","touchmove"],l=0;l<r.length;l++)i._registeredJsEvents[r[l]]=st._defineJSEventForDomEvent(n,r[l],o);for(l=0;l<s.length;l++)i._registeredJsEvents[s[l]]=st._defineJSEventForDomEvent(n,s[l],a);return i}function Ha(e,t){var i=Pe.call(this,e)||this;return i._setTargetElement(t),0<i._targetElement.length?i._bindInteractionEvents():i._bindInteractionEventsHandler=t.modeDOMsMounted.add(function(e){0===e&&(i._setTargetElement(t),i._bindInteractionEvents(),i._bindInteractionEventsHandler.dispose())}),i}}.call(window);
