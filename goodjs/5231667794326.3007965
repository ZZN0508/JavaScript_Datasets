!function(){var e=e||function(){var o,u={},s="theia",i=[];u[s]={IE:/msie/i.test(navigator.userAgent),E:function(e){return"string"==typeof e?document.getElementById(e):e},C:function(e){return"TEXT"==(e=e.toUpperCase())?document.createTextNode(""):"BUFFER"==e?document.createDocumentFragment():document.createElement(e)},log:function(){for(var e,t=arguments,r=t.length,n=[].slice.apply(t,[0,r]),t="error";n[--r];)if(n[r]instanceof Error){e=n.splice(r,1)[0];break}if(e||(e=new Error,t="log"),t=[n,t,(new Date).getTime(),e.message,e.stack],o)try{o.apply(null,t)}catch(e){}else 200<=i.length&&i.shift(),i.push(t)},_regLogFn:function(e){o=e},_clearLogList:function(){return i.splice(0,i.length)}};var r=u[s];return r.register=function(e,t,r){u[r=!r||"string"!=typeof r?s:r]||(u[r]={});for(var n,o=u[r],i=e.split("."),c=o;n=i.shift();)if(i.length)void 0===c[n]&&(c[n]={}),c=c[n];else if(void 0===c[n])try{if(r&&r!==s){if("core.util.listener"===e)return c[n]=u[s].core.util.listener,!0;if("core.util.connect"===e)return c[n]=u[s].core.util.connect,!0}return c[n]=t(o),!0}catch(e){setTimeout(function(){console.log(e)},0)}return!1},r.unRegister=function(e,t){for(var r,t=u[t=!t||"string"!=typeof t?s:t],n=e.split("."),o=t;r=n.shift();)if(n.length){if(void 0===o[r])return!1;o=o[r]}else if(void 0!==o[r])return delete o[r],!0;return!1},r.regShort=function(e,t){if(void 0!==r[e])throw"["+e+"] : short : has been register";r[e]=t},r.shortRegister=function(e,t,r){var n=u[r=!r||"string"!=typeof r?s:r],o=e.split(".");if(!t)return!1;if(n[t])return!1;for(var i,c=n;i=o.shift();)if(o.length){if(void 0===c[i])return!1;c=c[i]}else if(void 0!==c[i])return!n[t]&&(n[t]=c[i],!0);return!1},r.getPKG=function(e){return u[e=!e||"string"!=typeof e?s:e]},r}();e.register("core.util.listener",function(e){return u={},s=[],{register:function(e,t,r){u[e]=u[e]||{},u[e][t]=u[e][t]||[],u[e][t].push(r)},fire:function(e,t,r){var n,o,i;if(u[e]&&u[e][t]&&0<u[e][t].length){for((n=u[e][t]).data_cache=r,o=0,i=n.length;o<i;o++)s.push({channel:e,evt:t,func:n[o],data:r});c()}},remove:function(e,t,r){if(u[e]&&u[e][t])for(var n=0,o=u[e][t].length;n<o;n++)if(u[e][t][n]===r){u[e][t].splice(n,1);break}},list:function(){return u},cache:function(e,t){if(u[e]&&u[e][t])return u[e][t].data_cache}};function c(){if(0!=s.length){clearTimeout(t);var e=s.splice(0,1)[0];try{e.func.apply(e.func,[].concat(e.data))}catch(e){}t=setTimeout(c,25)}}var t,u,s}),e.register("core.obj.parseParam",function(e){return function(e,t,r){var n,o={};for(n in t=t||{},e)o[n]=e[n],null==t[n]||r&&!e.hasOwnProperty(n)||(o[n]=t[n]);return o}}),e.register("core.dom.removeNode",function(t){return function(e){e=t.E(e)||e;try{e.parentNode.removeChild(e)}catch(e){}}}),e.register("core.util.getUniqueKey",function(e){var t=(new Date).getTime().toString(),r=1;return function(){return t+r++}}),e.register("core.func.empty",function(){return function(){}}),e.register("core.str.parseURL",function(e){return function(e){for(var t=["url","scheme","slash","host","port","path","query","hash"],r=/^(?:([A-Za-z]+):(\/{0,3}))?([0-9.\-A-Za-z]+\.[0-9A-Za-z]+)?(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e),n={},o=0,i=t.length;o<i;o+=1)n[t[o]]=r[o]||"";return n}}),e.register("core.arr.isArray",function(e){return function(e){return"[object Array]"===Object.prototype.toString.call(e)}}),e.register("core.str.trim",function(e){return function(e){if("string"!=typeof e)throw"trim need a string as parameter";for(var t=e.length,r=0,n=/(\u3000|\s|\t|\u00A0)/;r<t&&n.test(e.charAt(r));)r+=1;for(;r<t&&n.test(e.charAt(t-1));)--t;return e.slice(r,t)}}),e.register("core.json.queryToJson",function(l){return function(e,t){function r(e){return t?decodeURIComponent(e):e}for(var n,o,i,c=l.core.str.trim(e).split("&"),u={},s=0,a=c.length;s<a;s++)c[s]&&(o=(n=c[s].split("="))[0],i=n[1],n.length<2&&(i=o,o="$nullName"),u[o]?(1!=l.core.arr.isArray(u[o])&&(u[o]=[u[o]]),u[o].push(r(i))):u[o]=r(i));return u}}),e.register("core.json.jsonToQuery",function(r){function c(e,t){return e=r.core.str.trim((e=null==e?"":e).toString()),t?encodeURIComponent(e):e}return function(e,t){var r=[];if("object"==typeof e)for(var n in e)if("$nullName"!==n)if(e[n]instanceof Array)for(var o=0,i=e[n].length;o<i;o++)r.push(n+"="+c(e[n][o],t));else"function"!=typeof e[n]&&r.push(n+"="+c(e[n],t));else r=r.concat(e[n]);return r.length?r.join("&"):""}}),e.register("core.util.URL",function(u){return function(e,t){var n=u.core.obj.parseParam({isEncodeQuery:!1,isEncodeHash:!1},t||{}),r={},o=u.core.str.parseURL(e),i=u.core.json.queryToJson(o.query),c=u.core.json.queryToJson(o.hash);return r.setParam=function(e,t){return i[e]=t,this},r.getParam=function(e){return i[e]},r.setParams=function(e){for(var t in e)r.setParam(t,e[t]);return this},r.setHash=function(e,t){return c[e]=t,this},r.getHash=function(e){return c[e]},r.valueOf=r.toString=function(){var e=[],t=u.core.json.jsonToQuery(i,n.isEncodeQuery),r=u.core.json.jsonToQuery(c,n.isEncodeQuery);return""!=o.scheme&&(e.push(o.scheme+":"),e.push(o.slash)),""!=o.host&&(e.push(o.host),""!=o.port&&(e.push(":"),e.push(o.port))),e.push("/"),e.push(o.path),""!=t&&e.push("?"+t),""!=r&&e.push("#"+r),e.join("")},r}}),e.register("core.io.scriptLoader",function(o){var i={},c={url:"",charset:"UTF-8",timeout:3e4,args:{},onComplete:o.core.func.empty,onTimeout:o.core.func.empty,isEncode:!1,uniqueID:null};return function(e){var t,r=o.core.obj.parseParam(c,e);if(""==r.url)throw"scriptLoader: url is null";var n,e=r.uniqueID||o.core.util.getUniqueKey();return null!=(n=i[e])&&1!=o.IE&&(o.core.dom.removeNode(n),n=null),(n=null==n?i[e]=o.C("script"):n).charset=r.charset,n.id="scriptRequest_script_"+e,n.type="text/javascript",null!=r.onComplete&&(o.IE?n.onreadystatechange=function(){if("loaded"==n.readyState.toLowerCase()||"complete"==n.readyState.toLowerCase()){try{clearTimeout(t),document.getElementsByTagName("head")[0].removeChild(n),n.onreadystatechange=null}catch(e){}r.onComplete()}}:n.onload=function(){try{clearTimeout(t),o.core.dom.removeNode(n)}catch(e){}r.onComplete()}),n.src=o.core.util.URL(r.url,{isEncodeQuery:r.isEncode}).setParams(r.args).toString(),document.getElementsByTagName("head")[0].appendChild(n),0<r.timeout&&(t=setTimeout(function(){try{document.getElementsByTagName("head")[0].removeChild(n)}catch(e){}r.onTimeout()},r.timeout)),n}}),e.register("core.io.jsonp",function(i){return function(e){var t=i.core.obj.parseParam({url:"",charset:"UTF-8",timeout:3e4,args:{},onComplete:null,onTimeout:null,responseName:null,isEncode:!1,varkey:"callback"},e),r=-1,e=t.responseName||"STK_"+i.core.util.getUniqueKey();t.args[t.varkey]=e;var n=t.onComplete,o=t.onTimeout;return window[e]=function(e){2!=r&&null!=n&&(r=1,n(e))},t.onComplete=null,t.onTimeout=function(){1!=r&&null!=o&&(r=2,o())},i.core.io.scriptLoader(t)}}),e.register("common.listener",function(n){var o={},e={define:function(r,e){if(null!=o[r])throw"common.listener.define: 棰戦亾宸茶鍗犵敤";o[r]=e;e={register:function(e,t){if(null==o[r])throw"common.listener.define: 棰戦亾鏈畾涔�";n.core.util.listener.register(r,e,t)},fire:function(e,t){if(null==o[r])throw"commonlistener.define: 棰戦亾鏈畾涔�";n.core.util.listener.fire(r,e,t)},remove:function(e,t){n.core.util.listener.remove(r,e,t)}};return e}};return e}),e.register("common.channel.qrcode_login",function(e){return e.common.listener.define("common.channel.qrcode_login",["qrcode_scanned","qrcode_used","qrcode_timeout","qrcode_exception","login_failure","login_success"])}),e.register("jobs.qrcode_login",function(i){var n,o,c={},u=i.common.channel.qrcode_login,s={entry:"sso",domain:"weibo.com",get_image_timeout:1e4,check_request_timeout:1e4,qrcode_size:180,crossdomain_timeout:3e3,savestate:30},e="https://login.sina.com.cn/sso/qrcode/image",r="https://login.sina.com.cn/sso/qrcode/check",t="https://login.sina.com.cn/sso/login.php",a=0,l=3e3;c.set=function(e){for(var t in e)s[t]=e[t];return c},c.getQRcode=function(t){return f(function(e){t(e)})},c.getQRcodeId=function(){return n},c.start=function(){o=!1,m(++a)},c.cancel=function(){o=!0},c.register=function(e,t){return u.register(e,t),c},c.remove=function(e,t){return u.remove(e,t),c};var f=function(r){return i.core.io.jsonp({url:e,timeout:s.get_image_timeout,args:{entry:s.entry,size:s.qrcode_size},onComplete:function(e){var t;e&&2e7==e.retcode&&((t=e.data).interval&&(l=t.interval),n=t.qrid),r(e)},onTimeout:function(){u.fire("get_image_timeout")},isEncode:!0,varkey:"callback"}),c},m=function(t){function r(e){2e7==e.retcode?d(e):50114002==e.retcode?u.fire("qrcode_scanned",[e]):50114003==e.retcode?u.fire("qrcode_timeout",[e]):50114004==e.retcode?u.fire("qrcode_used",[e]):50114015==e.retcode&&u.fire("qrcode_exception",[e]),50114001!=e.retcode&&50114002!=e.retcode||setTimeout(function(){t<a||o||g(r)},l)}g(r)},g=function(t){i.core.io.jsonp({url:r,timeout:s.check_request_timeout,args:{entry:s.entry,qrid:n},onComplete:function(e){t(e||{retcode:-1})},onTimeout:function(){u.fire("check_timeout")},isEncode:!0,varkey:"callback"})},d=function(e){i.core.io.jsonp({url:t,timeout:s.login_request_timeout,args:{entry:s.entry,returntype:"TEXT",crossdomain:1,cdult:3,domain:s.domain,alt:e.data.alt,savestate:s.savestate},onComplete:function(t){0!=t.retcode?u.fire("login_failure",{retcode:t.retcode,msg:t.reason}):h(t,function(e){!1===e.result?u.fire("login_failure",{retcode:-2,msg:"鐧诲綍澶辫触"}):u.fire("login_success",t)})},onTimeout:function(){u.fire("login_failure",{retcode:-1,msg:"鐧诲綍瓒呮椂"})},isEncode:!0,varkey:"callback"})},h=function(e,t){var r=e.crossDomainUrlList.length;if(0!=r){var n,o=setTimeout(function(){t({result:!(r=-1)})},s.crossdomain_timeout);for(n in e.crossDomainUrlList)"weibo.com"==i.core.str.parseURL(e.crossDomainUrlList[n]).host?i.core.io.scriptLoader({url:e.crossDomainUrlList[n],charset:"UTF-8",args:{action:"login"},onComplete:function(){0==--r&&(clearTimeout(o),t({result:!0}))}}):i.core.io.jsonp({url:e.crossDomainUrlList[n],charset:"UTF-8",args:{action:"login"},onComplete:function(){0==--r&&(clearTimeout(o),t({result:!0}))}})}else t({result:!0})};return c}),function(e){var t=e.jobs.qrcode_login;t.getVersion=function(){return"qrcode_login.js(v1.0.1) 2017-7-10"},t.STK=e,this.SINA_QRCODE_LOGIN=t}.call(this,e)}.call(this);
