!function(e,r){"function"==typeof define&&define.amd?define([],r):"undefined"!=typeof module&&module.exports?module.exports=r():e.tv4=r()}(this,function(){function v(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,function(e){return"%"+e.substring(3)})}function l(e){if(!(this instanceof l))return new l(e);for(var r=e.split("{"),i=[r.shift()],t=[],n=[],a=[];0<r.length;){var o=r.shift(),s=o.split("}")[0],o=o.substring(s.length+1),s=function(e){var r="";y[e.charAt(0)]&&(r=e.charAt(0),e=e.substring(1));var h="",u="",f=!0,c=!1,p=!1;"+"===r?f=!1:"."===r?h=u=".":"/"===r?h=u="/":"#"===r?f=!(u="#"):";"===r?(h=u=";",p=c=!0):"?"===r?(u="?",h="&",c=!0):"&"===r&&(h=u="&",c=!0);for(var t=[],i=e.split(","),d=[],n={},a=0;a<i.length;a++){var o,s=i[a],l=null;-1!==s.indexOf(":")&&(s=(o=s.split(":"))[0],l=parseInt(o[1],10));for(var m={};g[s.charAt(s.length-1)];)m[s.charAt(s.length-1)]=!0,s=s.substring(0,s.length-1);l={truncate:l,name:s,suffices:m};d.push(l),n[s]=l,t.push(s)}return(e=function(e){for(var r="",t=0,i=0;i<d.length;i++){var n=d[i],a=e(n.name);if(null==a||Array.isArray(a)&&0===a.length||"object"==typeof a&&0===Object.keys(a).length)t++;else if(r+=i===t?u:h||",",Array.isArray(a)){c&&(r+=n.name+"=");for(var o=0;o<a.length;o++)0<o&&(r+=n.suffices["*"]&&h||",",n.suffices["*"]&&c&&(r+=n.name+"=")),r+=f?encodeURIComponent(a[o]).replace(/!/g,"%21"):v(a[o])}else if("object"==typeof a){c&&!n.suffices["*"]&&(r+=n.name+"=");var s,l=!0;for(s in a)l||(r+=n.suffices["*"]&&h||","),l=!1,r+=f?encodeURIComponent(s).replace(/!/g,"%21"):v(s),r+=n.suffices["*"]?"=":",",r+=f?encodeURIComponent(a[s]).replace(/!/g,"%21"):v(a[s])}else c&&(r+=n.name,p&&""===a||(r+="=")),null!=n.truncate&&(a=a.substring(0,n.truncate)),r+=f?encodeURIComponent(a).replace(/!/g,"%21"):v(a)}return r}).varNames=t,{prefix:u,substitution:e}}(s);n.push(s.substitution),t.push(s.prefix),i.push(o),a=a.concat(s.substitution.varNames)}this.fill=function(e){for(var r=i[0],t=0;t<n.length;t++)r+=(0,n[t])(e),r+=i[t+1];return r},this.varNames=a,this.template=e}function a(e,r){if(e===r)return 1;if(e&&r&&"object"==typeof e&&"object"==typeof r){if(Array.isArray(e)!==Array.isArray(r))return;if(Array.isArray(e)){if(e.length!==r.length)return;for(var t=0;t<e.length;t++)if(!a(e[t],r[t]))return}else{for(var i in e)if(void 0===r[i]&&void 0!==e[i])return;for(i in r)if(void 0===e[i]&&void 0!==r[i])return;for(i in e)if(!a(e[i],r[i]))return}return 1}}function n(e){e=String(e).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return e?{href:e[0]||"",protocol:e[1]||"",authority:e[2]||"",host:e[3]||"",hostname:e[4]||"",port:e[5]||"",pathname:e[6]||"",search:e[7]||"",hash:e[8]||""}:null}function h(e,r){return r=n(r||""),e=n(e||""),r&&e?(r.protocol||e.protocol)+(r.protocol||r.authority?r:e).authority+(t=r.protocol||r.authority||"/"===r.pathname.charAt(0)?r.pathname:r.pathname?(e.authority&&!e.pathname?"/":"")+e.pathname.slice(0,e.pathname.lastIndexOf("/")+1)+r.pathname:e.pathname,i=[],t.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(e){"/.."===e?i.pop():i.push(e)}),i.join("").replace(/^\//,"/"===t.charAt(0)?"/":""))+(r.protocol||r.authority||r.pathname?r.search:r.search||e.search)+r.hash:null;var t,i}function u(e){return e.split("#")[0]}function f(e,r){if(e&&"object"==typeof e)if(void 0===r?r=e.id:"string"==typeof e.id&&(r=h(r,e.id),e.id=r),Array.isArray(e))for(var t=0;t<e.length;t++)f(e[t],r);else for(var i in"string"==typeof e.$ref&&(e.$ref=h(r,e.$ref)),e)"enum"!==i&&f(e[i],r)}function c(e){var i=R[e=e||"en"];return function(e){var r=i[e.code]||M[e.code];if("string"!=typeof r)return"Unknown error code "+e.code+": "+JSON.stringify(e.messageParams);var t=e.params;return r.replace(/\{([^{}]*)\}/g,function(e,r){r=t[r];return"string"==typeof r||"number"==typeof r?r:e})}}function m(e,r,t,i,n){if(Error.call(this),void 0===e)throw new Error("No error code supplied: "+i);this.message="",this.params=r,this.code=e,this.dataPath=t||"",this.schemaPath=i||"",this.subErrors=n||null;n=new Error(this.message);if(this.stack=n.stack||n.stacktrace,!this.stack)try{throw n}catch(e){this.stack=e.stack||e.stacktrace}}function r(){}var o,s,p,d;Object.keys||(Object.keys=(o=Object.prototype.hasOwnProperty,s=!{toString:null}.propertyIsEnumerable("toString"),d=(p=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var r,t=[];for(r in e)o.call(e,r)&&t.push(r);if(s)for(var i=0;i<d;i++)o.call(e,p[i])&&t.push(p[i]);return t})),Object.create||(Object.create=function(e){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return r.prototype=e,new r}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var r=Object(this),t=r.length>>>0;if(0==t)return-1;var i=0;if(1<arguments.length&&((i=Number(arguments[1]))!=i?i=0:0!==i&&i!==1/0&&i!==-1/0&&(i=(0<i||-1)*Math.floor(Math.abs(i)))),t<=i)return-1;for(var n=0<=i?i:Math.max(t-Math.abs(i),0);n<t;n++)if(n in r&&r[n]===e)return n;return-1}),Object.isFrozen||(Object.isFrozen=function(e){for(var r="tv4_test_frozen_key";e.hasOwnProperty(r);)r+=Math.random();try{return e[r]=!0,delete e[r],!1}catch(e){return!0}});var y={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},g={"*":!0};l.prototype={toString:function(){return this.template},fillFromObject:function(r){return this.fill(function(e){return r[e]})}};function E(e,r,t,i,n){if(this.missing=[],this.missingMap={},this.formatValidators=e?Object.create(e.formatValidators):{},this.schemas=e?Object.create(e.schemas):{},this.collectMultiple=r,this.errors=[],this.handleError=r?this.collectError:this.returnError,i&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),n&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=t||c("en"),"string"==typeof this.errorReporter)throw new Error("debug");if(this.definedKeywords={},e)for(var a in e.definedKeywords)this.definedKeywords[a]=e.definedKeywords[a].slice(0)}E.prototype.defineKeyword=function(e,r){this.definedKeywords[e]=this.definedKeywords[e]||[],this.definedKeywords[e].push(r)},E.prototype.createError=function(e,r,t,i,n,a,o){n=new m(e,r,t,i,n);return n.message=this.errorReporter(n,a,o),n},E.prototype.returnError=function(e){return e},E.prototype.collectError=function(e){return e&&this.errors.push(e),null},E.prototype.prefixErrors=function(e,r,t){for(var i=e;i<this.errors.length;i++)this.errors[i]=this.errors[i].prefixWith(r,t);return this},E.prototype.banUnknownProperties=function(e,r){for(var t in this.unknownPropertyPaths){t=this.createError(_.UNKNOWN_PROPERTY,{path:t},t,"",null,e,r),t=this.handleError(t);if(t)return t}return null},E.prototype.addFormat=function(e,r){if("object"==typeof e){for(var t in e)this.addFormat(t,e[t]);return this}this.formatValidators[e]=r},E.prototype.resolveRefs=function(e,r){if(void 0!==e.$ref){if((r=r||{})[e.$ref])return this.createError(_.CIRCULAR_REFERENCE,{urls:Object.keys(r).join(", ")},"","",null,void 0,e);r[e.$ref]=!0,e=this.getSchema(e.$ref,r)}return e},E.prototype.getSchema=function(e,r){if(void 0!==this.schemas[e])return n=this.schemas[e],this.resolveRefs(n,r);var t=e,i="";if(-1!==e.indexOf("#")&&(i=e.substring(e.indexOf("#")+1),t=e.substring(0,e.indexOf("#"))),"object"==typeof this.schemas[t]){var n=this.schemas[t],i=decodeURIComponent(i);if(""===i)return this.resolveRefs(n,r);if("/"!==i.charAt(0))return;for(var a=i.split("/").slice(1),o=0;o<a.length;o++){var s=a[o].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===n[s]){n=void 0;break}n=n[s]}if(void 0!==n)return this.resolveRefs(n,r)}void 0===this.missing[t]&&(this.missing.push(t),this.missing[t]=t,this.missingMap[t]=t)},E.prototype.searchSchemas=function(e,r){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.searchSchemas(e[t],r);else if(e&&"object"==typeof e)for(var i in"string"==typeof e.id&&function(e,r){if(r.substring(0,e.length)===e){var t=r.substring(e.length);if(0<r.length&&"/"===r.charAt(e.length-1)||"#"===t.charAt(0)||"?"===t.charAt(0))return 1}}(r,e.id)&&void 0===this.schemas[e.id]&&(this.schemas[e.id]=e),e)"enum"!==i&&("object"==typeof e[i]?this.searchSchemas(e[i],r):"$ref"!==i||(i=u(e[i]))&&void 0===this.schemas[i]&&void 0===this.missingMap[i]&&(this.missingMap[i]=i))},E.prototype.addSchema=function(e,r){if("string"!=typeof e||void 0===r){if("object"!=typeof e||"string"!=typeof e.id)return;e=(r=e).id}e===u(e)+"#"&&(e=u(e)),this.schemas[e]=r,delete this.missingMap[e],f(r,e),this.searchSchemas(r,e)},E.prototype.getSchemaMap=function(){var e,r={};for(e in this.schemas)r[e]=this.schemas[e];return r},E.prototype.getSchemaUris=function(e){var r,t=[];for(r in this.schemas)e&&!e.test(r)||t.push(r);return t},E.prototype.getMissingUris=function(e){var r,t=[];for(r in this.missingMap)e&&!e.test(r)||t.push(r);return t},E.prototype.dropSchemas=function(){this.schemas={},this.reset()},E.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},E.prototype.validateAll=function(e,r,t,i,n){var a;if(!(r=this.resolveRefs(r)))return null;if(r instanceof m)return this.errors.push(r),r;var o,s=this.errors.length,l=null,h=null;if(this.checkRecursive&&e&&"object"==typeof e){if(a=!this.scanned.length,e[this.validatedSchemasKey]){var u=e[this.validatedSchemasKey].indexOf(r);if(-1!==u)return this.errors=this.errors.concat(e[this.validationErrorsKey][u]),null}if(Object.isFrozen(e)&&-1!==(o=this.scannedFrozen.indexOf(e))){u=this.scannedFrozenSchemas[o].indexOf(r);if(-1!==u)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[o][u]),null}if(this.scanned.push(e),Object.isFrozen(e))-1===o&&(o=this.scannedFrozen.length,this.scannedFrozen.push(e),this.scannedFrozenSchemas.push([])),l=this.scannedFrozenSchemas[o].length,this.scannedFrozenSchemas[o][l]=r,this.scannedFrozenValidationErrors[o][l]=[];else{if(!e[this.validatedSchemasKey])try{Object.defineProperty(e,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(e,this.validationErrorsKey,{value:[],configurable:!0})}catch(r){e[this.validatedSchemasKey]=[],e[this.validationErrorsKey]=[]}h=e[this.validatedSchemasKey].length,e[this.validatedSchemasKey][h]=r,e[this.validationErrorsKey][h]=[]}}var f=this.errors.length,c=this.validateBasic(e,r,n)||this.validateNumeric(e,r,n)||this.validateString(e,r,n)||this.validateArray(e,r,n)||this.validateObject(e,r,n)||this.validateCombinations(e,r,n)||this.validateHypermedia(e,r,n)||this.validateFormat(e,r,n)||this.validateDefinedKeywords(e,r,n)||null;if(a){for(;this.scanned.length;)delete this.scanned.pop()[this.validatedSchemasKey];this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(c||f!==this.errors.length)for(;t&&t.length||i&&i.length;){var p=t&&t.length?""+t.pop():null,d=i&&i.length?""+i.pop():null,c=c&&c.prefixWith(p,d);this.prefixErrors(f,p,d)}return null!==l?this.scannedFrozenValidationErrors[o][l]=this.errors.slice(s):null!==h&&(e[this.validationErrorsKey][h]=this.errors.slice(s)),this.handleError(c)},E.prototype.validateFormat=function(e,r){if("string"!=typeof r.format||!this.formatValidators[r.format])return null;var t=this.formatValidators[r.format].call(null,e,r);return"string"==typeof t||"number"==typeof t?this.createError(_.FORMAT_CUSTOM,{message:t},"","/format",null,e,r):t&&"object"==typeof t?this.createError(_.FORMAT_CUSTOM,{message:t.message||"?"},t.dataPath||"",t.schemaPath||"/format",null,e,r):null},E.prototype.validateDefinedKeywords=function(e,r,t){for(var i in this.definedKeywords)if(void 0!==r[i])for(var n=this.definedKeywords[i],a=0;a<n.length;a++){var o=(0,n[a])(e,r[i],r,t);if("string"==typeof o||"number"==typeof o)return this.createError(_.KEYWORD_CUSTOM,{key:i,message:o},"","",null,e,r).prefixWith(null,i);if(o&&"object"==typeof o){var s=o.code;if("string"==typeof s){if(!_[s])throw new Error("Undefined error code (use defineError): "+s);s=_[s]}else"number"!=typeof s&&(s=_.KEYWORD_CUSTOM);var l="object"==typeof o.message?o.message:{key:i,message:o.message||"?"},h=o.schemaPath||"/"+i.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(s,l,o.dataPath||null,h,null,e,r)}}return null},E.prototype.validateBasic=function(e,r,t){var i;return(i=this.validateType(e,r,t))||(i=this.validateEnum(e,r,t))?i.prefixWith(null,"type"):null},E.prototype.validateType=function(e,r){if(void 0===r.type)return null;var t=typeof e;null===e?t="null":Array.isArray(e)&&(t="array");var i=r.type;Array.isArray(i)||(i=[i]);for(var n=0;n<i.length;n++){var a=i[n];if(a===t||"integer"===a&&"number"===t&&e%1==0)return null}return this.createError(_.INVALID_TYPE,{type:t,expected:i.join("/")},"","",null,e,r)},E.prototype.validateEnum=function(e,r){if(void 0===r.enum)return null;for(var t=0;t<r.enum.length;t++)if(a(e,r.enum[t]))return null;return this.createError(_.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(e):e},"","",null,e,r)},E.prototype.validateNumeric=function(e,r,t){return this.validateMultipleOf(e,r,t)||this.validateMinMax(e,r,t)||this.validateNaN(e,r,t)||null};var O=Math.pow(2,-51),P=1-O;E.prototype.validateMultipleOf=function(e,r){var t=r.multipleOf||r.divisibleBy;if(void 0===t)return null;if("number"==typeof e){var i=e/t%1;if(O<=i&&i<P)return this.createError(_.NUMBER_MULTIPLE_OF,{value:e,multipleOf:t},"","",null,e,r)}return null},E.prototype.validateMinMax=function(e,r){if("number"!=typeof e)return null;if(void 0!==r.minimum){if(e<r.minimum)return this.createError(_.NUMBER_MINIMUM,{value:e,minimum:r.minimum},"","/minimum",null,e,r);if(r.exclusiveMinimum&&e===r.minimum)return this.createError(_.NUMBER_MINIMUM_EXCLUSIVE,{value:e,minimum:r.minimum},"","/exclusiveMinimum",null,e,r)}if(void 0!==r.maximum){if(e>r.maximum)return this.createError(_.NUMBER_MAXIMUM,{value:e,maximum:r.maximum},"","/maximum",null,e,r);if(r.exclusiveMaximum&&e===r.maximum)return this.createError(_.NUMBER_MAXIMUM_EXCLUSIVE,{value:e,maximum:r.maximum},"","/exclusiveMaximum",null,e,r)}return null},E.prototype.validateNaN=function(e,r){return"number"==typeof e&&(!0===isNaN(e)||e===1/0||e===-1/0)?this.createError(_.NUMBER_NOT_A_NUMBER,{value:e},"","/type",null,e,r):null},E.prototype.validateString=function(e,r,t){return this.validateStringLength(e,r,t)||this.validateStringPattern(e,r,t)||null},E.prototype.validateStringLength=function(e,r){return"string"!=typeof e?null:void 0!==r.minLength&&e.length<r.minLength?this.createError(_.STRING_LENGTH_SHORT,{length:e.length,minimum:r.minLength},"","/minLength",null,e,r):void 0!==r.maxLength&&e.length>r.maxLength?this.createError(_.STRING_LENGTH_LONG,{length:e.length,maximum:r.maxLength},"","/maxLength",null,e,r):null},E.prototype.validateStringPattern=function(e,r){if("string"!=typeof e||"string"!=typeof r.pattern&&!(r.pattern instanceof RegExp))return null;var t,i,n=r.pattern instanceof RegExp?r.pattern:(n="",(i=r.pattern.match(/^\/(.+)\/([img]*)$/))?(t=i[1],n=i[2]):t=r.pattern,new RegExp(t,n));return n.test(e)?null:this.createError(_.STRING_PATTERN,{pattern:r.pattern},"","/pattern",null,e,r)},E.prototype.validateArray=function(e,r,t){return Array.isArray(e)&&(this.validateArrayLength(e,r,t)||this.validateArrayUniqueItems(e,r,t)||this.validateArrayItems(e,r,t))||null},E.prototype.validateArrayLength=function(e,r){var t;return void 0!==r.minItems&&e.length<r.minItems&&(t=this.createError(_.ARRAY_LENGTH_SHORT,{length:e.length,minimum:r.minItems},"","/minItems",null,e,r),this.handleError(t))||void 0!==r.maxItems&&e.length>r.maxItems&&(t=this.createError(_.ARRAY_LENGTH_LONG,{length:e.length,maximum:r.maxItems},"","/maxItems",null,e,r),this.handleError(t))?t:null},E.prototype.validateArrayUniqueItems=function(e,r){if(r.uniqueItems)for(var t=0;t<e.length;t++)for(var i=t+1;i<e.length;i++)if(a(e[t],e[i])){var n=this.createError(_.ARRAY_UNIQUE,{match1:t,match2:i},"","/uniqueItems",null,e,r);if(this.handleError(n))return n}return null},E.prototype.validateArrayItems=function(e,r,t){if(void 0===r.items)return null;var i,n;if(Array.isArray(r.items)){for(n=0;n<e.length;n++)if(n<r.items.length){if(i=this.validateAll(e[n],r.items[n],[n],["items",n],t+"/"+n))return i}else if(void 0!==r.additionalItems)if("boolean"==typeof r.additionalItems){if(!r.additionalItems&&(i=this.createError(_.ARRAY_ADDITIONAL_ITEMS,{},"/"+n,"/additionalItems",null,e,r),this.handleError(i)))return i}else if(i=this.validateAll(e[n],r.additionalItems,[n],["additionalItems"],t+"/"+n))return i}else for(n=0;n<e.length;n++)if(i=this.validateAll(e[n],r.items,[n],["items"],t+"/"+n))return i;return null},E.prototype.validateObject=function(e,r,t){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&(this.validateObjectMinMaxProperties(e,r,t)||this.validateObjectRequiredProperties(e,r,t)||this.validateObjectProperties(e,r,t)||this.validateObjectDependencies(e,r,t))||null},E.prototype.validateObjectMinMaxProperties=function(e,r){var t,i=Object.keys(e);return void 0!==r.minProperties&&i.length<r.minProperties&&(t=this.createError(_.OBJECT_PROPERTIES_MINIMUM,{propertyCount:i.length,minimum:r.minProperties},"","/minProperties",null,e,r),this.handleError(t))||void 0!==r.maxProperties&&i.length>r.maxProperties&&(t=this.createError(_.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:i.length,maximum:r.maxProperties},"","/maxProperties",null,e,r),this.handleError(t))?t:null},E.prototype.validateObjectRequiredProperties=function(e,r){if(void 0!==r.required)for(var t=0;t<r.required.length;t++){var i=r.required[t];if(void 0===e[i]){i=this.createError(_.OBJECT_REQUIRED,{key:i},"","/required/"+t,null,e,r);if(this.handleError(i))return i}}return null},E.prototype.validateObjectProperties=function(e,r,t){var i,n;for(n in e){var a=t+"/"+n.replace(/~/g,"~0").replace(/\//g,"~1"),o=!1;if(void 0!==r.properties&&void 0!==r.properties[n]&&(o=!0,i=this.validateAll(e[n],r.properties[n],[n],["properties",n],a)))return i;if(void 0!==r.patternProperties)for(var s in r.patternProperties)if(new RegExp(s).test(n)&&(o=!0,i=this.validateAll(e[n],r.patternProperties[s],[n],["patternProperties",s],a)))return i;if(o)this.trackUnknownProperties&&(this.knownPropertyPaths[a]=!0,delete this.unknownPropertyPaths[a]);else if(void 0!==r.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[a]=!0,delete this.unknownPropertyPaths[a]),"boolean"==typeof r.additionalProperties){if(!r.additionalProperties&&(i=this.createError(_.OBJECT_ADDITIONAL_PROPERTIES,{key:n},"","/additionalProperties",null,e,r).prefixWith(n,null),this.handleError(i)))return i}else if(i=this.validateAll(e[n],r.additionalProperties,[n],["additionalProperties"],a))return i}else this.trackUnknownProperties&&!this.knownPropertyPaths[a]&&(this.unknownPropertyPaths[a]=!0)}return null},E.prototype.validateObjectDependencies=function(e,r,t){var i;if(void 0!==r.dependencies)for(var n in r.dependencies)if(void 0!==e[n]){var a=r.dependencies[n];if("string"==typeof a){if(void 0===e[a]&&(i=this.createError(_.OBJECT_DEPENDENCY_KEY,{key:n,missing:a},"","",null,e,r).prefixWith(null,n).prefixWith(null,"dependencies"),this.handleError(i)))return i}else if(Array.isArray(a))for(var o=0;o<a.length;o++){var s=a[o];if(void 0===e[s]&&(i=this.createError(_.OBJECT_DEPENDENCY_KEY,{key:n,missing:s},"","/"+o,null,e,r).prefixWith(null,n).prefixWith(null,"dependencies"),this.handleError(i)))return i}else if(i=this.validateAll(e,a,[],["dependencies",n],t))return i}return null},E.prototype.validateCombinations=function(e,r,t){return this.validateAllOf(e,r,t)||this.validateAnyOf(e,r,t)||this.validateOneOf(e,r,t)||this.validateNot(e,r,t)||null},E.prototype.validateAllOf=function(e,r,t){if(void 0===r.allOf)return null;for(var i=0;i<r.allOf.length;i++){var n=r.allOf[i];if(n=this.validateAll(e,n,[],["allOf",i],t))return n}return null},E.prototype.validateAnyOf=function(e,r,t){if(void 0===r.anyOf)return null;var i,n,a=[],o=this.errors.length;this.trackUnknownProperties&&(i=this.unknownPropertyPaths,n=this.knownPropertyPaths);for(var s=!0,l=0;l<r.anyOf.length;l++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var h=r.anyOf[l],u=this.errors.length,h=this.validateAll(e,h,[],["anyOf",l],t);if(null===h&&u===this.errors.length){if(this.errors=this.errors.slice(0,o),this.trackUnknownProperties){for(var f in this.knownPropertyPaths)n[f]=!0,delete i[f];for(var c in this.unknownPropertyPaths)n[c]||(i[c]=!0);s=!1;continue}return null}h&&a.push(h.prefixWith(null,""+l).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=i,this.knownPropertyPaths=n),s?(a=a.concat(this.errors.slice(o)),this.errors=this.errors.slice(0,o),this.createError(_.ANY_OF_MISSING,{},"","/anyOf",a,e,r)):void 0},E.prototype.validateOneOf=function(e,r,t){if(void 0===r.oneOf)return null;var i,n,a=null,o=[],s=this.errors.length;this.trackUnknownProperties&&(i=this.unknownPropertyPaths,n=this.knownPropertyPaths);for(var l=0;l<r.oneOf.length;l++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var h=r.oneOf[l],u=this.errors.length,h=this.validateAll(e,h,[],["oneOf",l],t);if(null===h&&u===this.errors.length){if(null!==a)return this.errors=this.errors.slice(0,s),this.createError(_.ONE_OF_MULTIPLE,{index1:a,index2:l},"","/oneOf",null,e,r);if(a=l,this.trackUnknownProperties){for(var f in this.knownPropertyPaths)n[f]=!0,delete i[f];for(var c in this.unknownPropertyPaths)n[c]||(i[c]=!0)}}else h&&o.push(h)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=i,this.knownPropertyPaths=n),null===a?(o=o.concat(this.errors.slice(s)),this.errors=this.errors.slice(0,s),this.createError(_.ONE_OF_MISSING,{},"","/oneOf",o,e,r)):(this.errors=this.errors.slice(0,s),null)},E.prototype.validateNot=function(e,r,t){if(void 0===r.not)return null;var i,n,a=this.errors.length;this.trackUnknownProperties&&(i=this.unknownPropertyPaths,n=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var o=this.validateAll(e,r.not,null,null,t),t=this.errors.slice(a);return this.errors=this.errors.slice(0,a),this.trackUnknownProperties&&(this.unknownPropertyPaths=i,this.knownPropertyPaths=n),null===o&&0===t.length?this.createError(_.NOT_PASSED,{},"","/not",null,e,r):null},E.prototype.validateHypermedia=function(e,r,t){if(!r.links)return null;for(var i=0;i<r.links.length;i++){var n=r.links[i];if("describedby"===n.rel){for(var a=new l(n.href),o=!0,s=0;s<a.varNames.length;s++)if(!(a.varNames[s]in e)){o=!1;break}if(o){var n=a.fillFromObject(e);if(n=this.validateAll(e,{$ref:n},[],["links",i],t))return n}}}};var e,_={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},A={};for(e in _)A[_[e]]=e;var M={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};((m.prototype=Object.create(Error.prototype)).constructor=m).prototype.name="ValidationError",m.prototype.prefixWith=function(e,r){if(null!==e&&(e=e.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+e+this.dataPath),null!==r&&(r=r.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+r+this.schemaPath),null!==this.subErrors)for(var t=0;t<this.subErrors.length;t++)this.subErrors[t].prefixWith(e,r);return this};var R={},t=function t(e){var o,s,l=new E,r={setErrorReporter:function(e){return"string"==typeof e?this.language(e):(s=e,!0)},addFormat:function(){l.addFormat.apply(l,arguments)},language:function(e){return e?(R[e]||(e=e.split("-")[0]),!!R[e]&&(o=e)):o},addLanguage:function(e,r){for(var t in _)r[t]&&!r[_[t]]&&(r[_[t]]=r[t]);var i=e.split("-")[0];if(R[i])for(t in R[e]=Object.create(R[i]),r)void 0===R[i][t]&&(R[i][t]=r[t]),R[e][t]=r[t];else R[e]=r,R[i]=r;return this},freshApi:function(e){var r=t();return e&&r.language(e),r},validate:function(e,r,t,i){var n=c(o),a=new E(l,!1,s?function(e,r,t){return s(e,r,t)||n(e,r,t)}:n,t,i);return a.addSchema("",r="string"==typeof r?{$ref:r}:r),!(t=a.validateAll(e,r,null,null,""))&&i&&(t=a.banUnknownProperties(e,r)),this.error=t,this.missing=a.missing,this.valid=null===t,this.valid},validateResult:function(){var e={toString:function(){return this.valid?"valid":this.error.message}};return this.validate.apply(e,arguments),e},validateMultiple:function(e,r,t,i){var n=c(o);return(t=new E(l,!0,s?function(e,r,t){return s(e,r,t)||n(e,r,t)}:n,t,i)).addSchema("",r="string"==typeof r?{$ref:r}:r),t.validateAll(e,r,null,null,""),i&&t.banUnknownProperties(e,r),(r={toString:function(){return this.valid?"valid":this.error.message}}).errors=t.errors,r.missing=t.missing,r.valid=0===r.errors.length,r},addSchema:function(){return l.addSchema.apply(l,arguments)},getSchema:function(){return l.getSchema.apply(l,arguments)},getSchemaMap:function(){return l.getSchemaMap.apply(l,arguments)},getSchemaUris:function(){return l.getSchemaUris.apply(l,arguments)},getMissingUris:function(){return l.getMissingUris.apply(l,arguments)},dropSchemas:function(){l.dropSchemas.apply(l,arguments)},defineKeyword:function(){l.defineKeyword.apply(l,arguments)},defineError:function(e,r,t){if("string"!=typeof e||!/^[A-Z]+(_[A-Z]+)*$/.test(e))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof r||r%1!=0||r<1e4)throw new Error("Code number must be an integer > 10000");if(void 0!==_[e])throw new Error("Error already defined: "+e+" as "+_[e]);if(void 0!==A[r])throw new Error("Error code already used: "+A[r]+" as "+r);for(var i in _[e]=r,A[r]=e,M[e]=M[r]=t,R)(i=R[i])[e]&&(i[r]=i[r]||i[e])},reset:function(){l.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:f,resolveUrl:h,getDocumentUri:u,errorCodes:_};return r.language(e||"en"),r}();return t.addLanguage("en-gb",M),t.tv4=t});
