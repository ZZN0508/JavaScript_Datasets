!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],t):t(e.firebase)}(this,function(Ke){"use strict";try{!function(){Ke=Ke&&Ke.hasOwnProperty("default")?Ke.default:Ke;var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function e(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};function h(o,s,a,c){return new(a=a||Promise)(function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,r)}i((c=c.apply(o,s||[])).next())})}function f(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(o,t[1])).done)return s;switch(o=0,(t=s?[0,s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var n="FirebaseError",i=Error.captureStackTrace,s=function(e,t){if(this.code=e,this.message=t,i)i(this,c.prototype.create);else try{throw Error.apply(this,arguments)}catch(e){this.name=n,Object.defineProperty(this,"stack",{get:function(){return e.stack}})}};s.prototype=Object.create(Error.prototype),(s.prototype.constructor=s).prototype.name=n;var a,c=(t.prototype.create=function(e,r){void 0===r&&(r={});var t=this.errors[e],e=this.service+"/"+e,t=void 0===t?"Error":t.replace(this.pattern,function(e,t){var n=r[t];return void 0!==n?n.toString():"<"+t+"?>"});t=this.serviceName+": "+t+" ("+e+").";var n,i=new s(e,t);for(n in r)r.hasOwnProperty(n)&&"_"!==n.slice(-1)&&(i[n]=r[n]);return i},t);function t(e,t,n){this.service=e,this.serviceName=t,this.errors=n,this.pattern=/\{\$([^}]+)}/g}function u(){var e=a.call(this)||this;e.chain_=[],e.buf_=[],e.W_=[],e.pad_=[],e.inbuf_=0,e.total_=0,e.blockSize=64,e.pad_[0]=128;for(var t=1;t<e.blockSize;++t)e.pad_[t]=0;return e.reset(),e}function d(e,t){t=new p(e,t);return t.subscribe.bind(t)}e(u,a=function(){this.blockSize=-1}),u.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},u.prototype.compress_=function(e,t){t=t||0;var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}for(var o,s,a=this.chain_[0],c=this.chain_[1],u=this.chain_[2],h=this.chain_[3],f=this.chain_[4],r=0;r<80;r++)s=r<40?r<20?(o=h^c&(u^h),1518500249):(o=c^u^h,1859775393):r<60?(o=c&u|h&(c|u),2400959708):(o=c^u^h,3395469782),i=(a<<5|a>>>27)+o+f+s+n[r]&4294967295,f=h,h=u,u=4294967295&(c<<30|c>>>2),c=a,a=i;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+f&4294967295},u.prototype.update=function(e,t){if(null!=e){for(var n=(t=void 0===t?e.length:t)-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<t;){if(0==o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}},u.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);for(var r=0,n=0;n<5;n++)for(var i=24;0<=i;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e};var p=(l.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},l.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},l.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},l.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e){if("object"==typeof e&&null!==e)for(var t=0,n=["next","error","complete"];t<n.length;t++){var r=n[t];if(r in e&&"function"==typeof e[r])return 1}}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=b),void 0===r.error&&(r.error=b),void 0===r.complete&&(r.complete=b);n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),n},l.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},l.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},l.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},l.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},l);function l(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}function b(){}var v,g,y="only-available-in-window",w="only-available-in-sw",m="should-be-overriden",k="bad-sender-id",_="incorrect-gcm-sender-id",S="permission-default",T="permission-blocked",P="unsupported-browser",M="notifications-blocked",D="failed-serviceworker-registration",C="sw-registration-expected",O="get-subscription-failed",I="invalid-saved-token",N="sw-reg-redundant",E="token-subscribe-failed",A="token-subscribe-no-token",K="token-subscribe-no-push-set",x="token-unsubscribe-failed",F="token-update-failed",W="token-update-no-token",V="use-sw-before-get-token",U="invalid-delete-token",j="delete-token-not-found",R="delete-scope-not-found",z="bg-handler-function-expected",L="no-window-client-to-msg",G="unable-to-resubscribe",H="no-fcm-token-for-resubscribe",B="failed-to-delete-token",q="no-sw-in-reg",$="bad-scope",Y="bad-vapid-key",J="bad-subscription",Q="bad-token",X="bad-push-set",Z="failed-delete-vapid-key",ee="invalid-public-vapid-key",te="use-public-key-before-get-token",ne="public-vapid-key-decryption-failed",re=((re={})[y]="This method is available in a Window context.",re[w]="This method is available in a service worker context.",re[m]="This method should be overriden by extended classes.",re[k]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",re[S]="The required permissions were not granted and dismissed instead.",re[T]="The required permissions were not granted and blocked instead.",re[P]="This browser doesn't support the API's required to use the firebase SDK.",re[M]="Notifications have been blocked.",re[D]="We are unable to register the default service worker. {$browserErrorMessage}",re[C]="A service worker registration was the expected input.",re[O]="There was an error when trying to get any existing Push Subscriptions.",re[I]="Unable to access details of the saved token.",re[N]="The service worker being used for push was made redundant.",re[E]="A problem occured while subscribing the user to FCM: {$message}",re[A]="FCM returned no token when subscribing the user to push.",re[K]="FCM returned an invalid response when getting an FCM token.",re[x]="A problem occured while unsubscribing the user from FCM: {$message}",re[F]="A problem occured while updating the user from FCM: {$message}",re[W]="FCM returned no token when updating the user to push.",re[V]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",re[U]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",re[j]="The deletion attempt for token could not be performed as the token was not found.",re[R]="The deletion attempt for service worker scope could not be performed as the scope was not found.",re[z]="The input to setBackgroundMessageHandler() must be a function.",re[L]="An attempt was made to message a non-existant window client.",re[G]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}",re[H]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",re[B]="Unable to delete the currently saved token.",re[q]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",re[_]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",re[$]="The service worker scope must be a string with at least one character.",re[Y]="The public VAPID key is not a Uint8Array with 65 bytes.",re[J]="The subscription must be a valid PushSubscription.",re[Q]="The FCM Token used for storage / lookup was not a valid token string.",re[X]="The FCM push set used for storage / lookup was not not a valid push set string.",re[Z]="The VAPID key could not be deleted.",re[ee]="The public VAPID key must be a string.",re[ne]="The public VAPID key did not equal 65 bytes when decrypted.",re),ie=new c("messaging","Messaging",re),oe=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),se="https://fcm.googleapis.com";function ae(e,t){if(null==e||null==t)return!1;if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(var n=new DataView(e),r=new DataView(t),i=0;i<e.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function ce(e){return e=new Uint8Array(e),btoa(String.fromCharCode.apply(null,e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(re=v=v||{}).TYPE_OF_MSG="firebase-messaging-msg-type",re.DATA="firebase-messaging-msg-data",(re=g=g||{}).PUSH_MSG_RECEIVED="push-msg-received",re.NOTIFICATION_CLICKED="notification-clicked";var ue=(he.prototype.getToken=function(o,s,a){return h(this,void 0,void 0,function(){var t,n,r,i;return f(this,function(e){switch(e.label){case 0:t=ce(s.getKey("p256dh")),i=ce(s.getKey("auth")),i="authorized_entity="+o+"&endpoint="+s.endpoint+"&encryption_key="+t+"&encryption_auth="+i,ae(a.buffer,oe.buffer)||(n=ce(a),i+="&application_pub_key="+n),(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),n={method:"POST",headers:n,body:i},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(se+"/fcm/connect/subscribe",n)];case 2:return[4,e.sent().json()];case 3:return r=e.sent(),[3,5];case 4:throw e.sent(),ie.create(E);case 5:if(r.error)throw i=r.error.message,ie.create(E,{message:i});if(!r.token)throw ie.create(A);if(!r.pushSet)throw ie.create(K);return[2,{token:r.token,pushSet:r.pushSet}]}})})},he.prototype.updateToken=function(o,s,a,c,u){return h(this,void 0,void 0,function(){var t,n,r,i;return f(this,function(e){switch(e.label){case 0:t=ce(c.getKey("p256dh")),i=ce(c.getKey("auth")),i="push_set="+a+"&token="+s+"&authorized_entity="+o+"&endpoint="+c.endpoint+"&encryption_key="+t+"&encryption_auth="+i,ae(u.buffer,oe.buffer)||(n=ce(u),i+="&application_pub_key="+n),(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),n={method:"POST",headers:n,body:i},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(se+"/fcm/connect/subscribe",n)];case 2:return[4,e.sent().json()];case 3:return r=e.sent(),[3,5];case 4:throw e.sent(),ie.create(F);case 5:if(r.error)throw i=r.error.message,ie.create(F,{message:i});if(!r.token)throw ie.create(W);return[2,r.token]}})})},he.prototype.deleteToken=function(r,i,o){return h(this,void 0,void 0,function(){var t,n;return f(this,function(e){switch(e.label){case 0:n="authorized_entity="+r+"&token="+i+"&pushSet="+o,(t=new Headers).append("Content-Type","application/x-www-form-urlencoded"),t={method:"POST",headers:t,body:n},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(se+"/fcm/connect/unsubscribe",t)];case 2:return[4,e.sent().json()];case 3:if((n=e.sent()).error)throw n=n.error.message,ie.create(x,{message:n});return[3,5];case 4:throw e.sent(),ie.create(x);case 5:return[2]}})})},he);function he(){}function fe(e){for(var e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}var de="undefined",pe="fcm_token_object_Store";function le(){var o=indexedDB.open(de);o.onerror=function(e){},o.onsuccess=function(e){var n,t,r,i;(n=o.result).objectStoreNames.contains(pe)&&(t=n.transaction(pe).objectStore(pe),r=new ue,(i=t.openCursor()).onerror=function(e){console.warn("Unable to cleanup old IDB.",e)},i.onsuccess=function(){var e,t=i.result;t?(e=t.value,r.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet),t.continue()):(n.close(),indexedDB.deleteDatabase(de))})}}be.prototype.get=function(t){return this.createTransaction(function(e){return e.get(t)})},be.prototype.getIndex=function(t,n){return this.createTransaction(function(e){return e.index(t).get(n)})},be.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},be.prototype.delete=function(t){return this.createTransaction(function(e){return e.delete(t)},"readwrite")},be.prototype.closeDatabase=function(){return h(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:e.sent().close(),this.dbPromise=null,e.label=2;case 2:return[2]}})})},be.prototype.createTransaction=function(o,s){return void 0===s&&(s="readonly"),h(this,void 0,void 0,function(){var r,t,i;return f(this,function(e){switch(e.label){case 0:return[4,this.getDb()];case 1:return t=e.sent(),r=t.transaction(this.objectStoreName,s),t=r.objectStore(this.objectStoreName),[4,(n=o(t),new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}}))];case 2:return i=e.sent(),[2,new Promise(function(e,t){r.oncomplete=function(){e(i)},r.onerror=function(){t(r.error)}})]}var n})})},be.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(e,t){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){e(n.result)},n.onerror=function(){r.dbPromise=null,t(n.error)},n.onupgradeneeded=function(e){return r.onDbUpgrade(n,e)}})),this.dbPromise},re=be;function be(){this.dbPromise=null}var ve,ge=(e(ye,ve=re),ye.prototype.onDbUpgrade=function(e,t){var n=e.result;switch(t.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:le();case 2:var r,i=(r=e.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var e,t,n=i.result;n&&(e=n.value,t=o({},e),e.createTime||(t.createTime=Date.now()),"string"==typeof e.vapidKey&&(t.vapidKey=fe(e.vapidKey)),"string"==typeof e.auth&&(t.auth=fe(e.auth).buffer),"string"==typeof e.auth&&(t.p256dh=fe(e.p256dh).buffer),n.update(t),n.continue())}}},ye.prototype.getTokenDetailsFromToken=function(t){return h(this,void 0,void 0,function(){return f(this,function(e){if(!t)throw ie.create(Q);return we({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},ye.prototype.getTokenDetailsFromSWScope=function(t){return h(this,void 0,void 0,function(){return f(this,function(e){if(!t)throw ie.create($);return we({swScope:t}),[2,this.get(t)]})})},ye.prototype.saveTokenDetails=function(t){return h(this,void 0,void 0,function(){return f(this,function(e){if(!t.swScope)throw ie.create($);if(!t.vapidKey)throw ie.create(Y);if(!t.endpoint||!t.auth||!t.p256dh)throw ie.create(J);if(!t.fcmSenderId)throw ie.create(k);if(!t.fcmToken)throw ie.create(Q);if(!t.fcmPushSet)throw ie.create(X);return we(t),[2,this.put(t)]})})},ye.prototype.deleteToken=function(n){return h(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(ie.create(U))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(t=e.sent()))throw ie.create(j);return[4,this.delete(t.swScope)];case 2:return e.sent(),[2,t]}})})},ye);function ye(){var e=null!==ve&&ve.apply(this,arguments)||this;return e.dbName="fcm_token_details_db",e.dbVersion=3,e.objectStoreName="fcm_token_object_Store",e}function we(e){if(e.fcmToken&&("string"!=typeof e.fcmToken||0===e.fcmToken.length))throw ie.create(Q);if(e.swScope&&("string"!=typeof e.swScope||0===e.swScope.length))throw ie.create($);if(e.vapidKey&&(!(e.vapidKey instanceof Uint8Array)||65!==e.vapidKey.length))throw ie.create(Y);if(e.endpoint&&("string"!=typeof e.endpoint||0===e.endpoint.length))throw ie.create(J);if(e.auth&&!(e.auth instanceof ArrayBuffer))throw ie.create(J);if(e.p256dh&&!(e.p256dh instanceof ArrayBuffer))throw ie.create(J);if(e.fcmSenderId&&("string"!=typeof e.fcmSenderId||0===e.fcmSenderId.length))throw ie.create(k);if(e.fcmPushSet&&("string"!=typeof e.fcmPushSet||0===e.fcmPushSet.length))throw ie.create(X)}var me,ke=(e(Te,me=re),Te.prototype.onDbUpgrade=function(e){e.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},Te.prototype.getVapidFromSWScope=function(n){return h(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:if("string"!=typeof n||0===n.length)throw ie.create($);return[4,this.get(n)];case 1:return[2,(t=e.sent())?t.vapidKey:void 0]}})})},Te.prototype.saveVapidDetails=function(n,r){return h(this,void 0,void 0,function(){var t;return f(this,function(e){if("string"!=typeof n||0===n.length)throw ie.create($);if(null===r||65!==r.length)throw ie.create(Y);return t={swScope:n,vapidKey:r},[2,this.put(t)]})})},Te.prototype.deleteVapidDetails=function(n){return h(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(t=e.sent()))throw ie.create(R);return[4,this.delete(n)];case 2:return e.sent(),[2,t]}})})},Te),_e="messagingSenderId",re=(Se.prototype.getToken=function(){return h(this,void 0,void 0,function(){var t,n,r,i;return f(this,function(e){switch(e.label){case 0:if("denied"===(i=this.getNotificationPermission_()))throw ie.create(M);return"granted"!==i?[2,null]:[4,this.getSWRegistration_()];case 1:return t=e.sent(),[4,this.getPublicVapidKey_()];case 2:return n=e.sent(),[4,this.getPushSubscription(t,n)];case 3:return r=e.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(t.scope)];case 4:return(i=e.sent())?[2,this.manageExistingToken(t,r,n,i)]:[2,this.getNewToken(t,r,n)]}})})},Se.prototype.manageExistingToken=function(t,n,i,r){return h(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return function(e,t){if(t.vapidKey&&ae(i.buffer,t.vapidKey.buffer)){var n=e.endpoint===t.endpoint,r=ae(e.getKey("auth"),t.auth),t=ae(e.getKey("p256dh"),t.p256dh);return n&&r&&t}}(n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,n,i,r)]:[4,this.deleteTokenFromDB(r.fcmToken)];case 1:return e.sent(),[2,this.getNewToken(t,n,i)]}})})},Se.prototype.updateToken=function(i,o,s,a){return h(this,void 0,void 0,function(){var t,n,r;return f(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,a.fcmToken,a.fcmPushSet,o,s)];case 1:return t=e.sent(),n={swScope:i.scope,vapidKey:s,fcmSenderId:this.messagingSenderId,fcmToken:t,fcmPushSet:a.fcmPushSet,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return e.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,s)];case 3:return e.sent(),[2,t];case 4:return r=e.sent(),[4,this.deleteToken(a.fcmToken)];case 5:throw e.sent(),r;case 6:return[2]}})})},Se.prototype.getNewToken=function(r,i,o){return h(this,void 0,void 0,function(){var t,n;return f(this,function(e){switch(e.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,i,o)];case 1:return t=e.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.messagingSenderId,fcmToken:t.token,fcmPushSet:t.pushSet,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return e.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return e.sent(),[2,t.token]}})})},Se.prototype.deleteToken=function(n){return h(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.deleteTokenFromDB(n)];case 1:return e.sent(),[4,this.getSWRegistration_()];case 2:return(t=e.sent())?[4,t.pushManager.getSubscription()]:[3,4];case 3:if(t=e.sent())return[2,t.unsubscribe()];e.label=4;case 4:return[2,!0]}})})},Se.prototype.deleteTokenFromDB=function(n){return h(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return t=e.sent(),[4,this.iidModel.deleteToken(t.fcmSenderId,t.fcmToken,t.fcmPushSet)];case 2:return e.sent(),[2]}})})},Se.prototype.getPushSubscription=function(t,n){return t.pushManager.getSubscription().then(function(e){return e||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},Se.prototype.requestPermission=function(){throw ie.create(y)},Se.prototype.useServiceWorker=function(e){throw ie.create(y)},Se.prototype.usePublicVapidKey=function(e){throw ie.create(y)},Se.prototype.onMessage=function(e,t,n){throw ie.create(y)},Se.prototype.onTokenRefresh=function(e,t,n){throw ie.create(y)},Se.prototype.setBackgroundMessageHandler=function(e){throw ie.create(w)},Se.prototype.delete=function(){return h(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return e.sent(),[2]}})})},Se.prototype.getNotificationPermission_=function(){return Notification.permission},Se.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},Se.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},Se.prototype.getIidModel=function(){return this.iidModel},Se);function Se(e){var t=this;if(!e.options[_e]||"string"!=typeof e.options[_e])throw ie.create(k);this.messagingSenderId=e.options[_e],this.tokenDetailsModel=new ge,this.vapidDetailsModel=new ke,this.iidModel=new ue,this.app=e,this.INTERNAL={delete:function(){return t.delete()}}}function Te(){var e=null!==me&&me.apply(this,arguments)||this;return e.dbName="fcm_vapid_details_db",e.dbVersion=1,e.objectStoreName="fcm_vapid_object_Store",e}var Pe,Me=(e(De,Pe=re),De.prototype.onPush=function(e){e.waitUntil(this.onPush_(e))},De.prototype.onSubChange=function(e){e.waitUntil(this.onSubChange_(e))},De.prototype.onNotificationClick=function(e){e.waitUntil(this.onNotificationClick_(e))},De.prototype.onPush_=function(a){return h(this,void 0,void 0,function(){var t,n,r,i,o,s;return f(this,function(e){switch(e.label){case 0:if(!a.data)return[2];try{t=a.data.json()}catch(e){return[2]}return[4,this.hasVisibleClients_()];case 1:return e.sent()?[2,this.sendMessageToWindowClients_(t)]:(n=this.getNotificationData_(t))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=e.sent(),o=n.actions,s=Notification.maxActions,o&&s&&o.length>s&&console.warn("This browser only supports "+s+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(t)]:[3,5];case 4:return e.sent(),[2];case 5:return[2]}})})},De.prototype.onSubChange_=function(e){return h(this,void 0,void 0,function(){var t,n,r;return f(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=e.sent(),[3,3];case 2:throw r=e.sent(),ie.create(G,{message:r});case 3:return e.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return e.sent(),[3,8];case 5:return n=e.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(r=e.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw e.sent(),n;case 8:return[2]}})})},De.prototype.onNotificationClick_=function(o){return h(this,void 0,void 0,function(){var t,n,r,i;return f(this,function(e){switch(e.label){case 0:return!(o.notification&&o.notification.data&&o.notification.data.FCM_MSG)||o.action?[2]:(o.stopImmediatePropagation(),o.notification.close(),(t=o.notification.data.FCM_MSG).notification&&(n=t.fcmOptions&&t.fcmOptions.link||t.notification.click_action)?[4,this.getWindowClient_(n)]:[2]);case 1:return(r=e.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=e.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=e.sent(),e.label=5;case 5:return r?(delete t.notification,delete t.fcmOptions,i=Oe(g.NOTIFICATION_CLICKED,t),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},De.prototype.getNotificationData_=function(e){if(e&&"object"==typeof e.notification){var t,n=o({},e.notification);return n.data=o({},e.notification.data,((t={}).FCM_MSG=e,t)),n}},De.prototype.setBackgroundMessageHandler=function(e){if(!e||"function"!=typeof e)throw ie.create(z);this.bgMessageHandler=e},De.prototype.getWindowClient_=function(o){return h(this,void 0,void 0,function(){var t,n,r,i;return f(this,function(e){switch(e.label){case 0:return t=new URL(o,self.location.href).href,[4,Ce()];case 1:for(n=e.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===t){r=n[i];break}return[2,r]}})})},De.prototype.attemptToMessageClient_=function(t,n){return h(this,void 0,void 0,function(){return f(this,function(e){if(!t)throw ie.create(L);return t.postMessage(n),[2]})})},De.prototype.hasVisibleClients_=function(){return h(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,Ce()];case 1:return[2,e.sent().some(function(e){return"visible"===e.visibilityState})]}})})},De.prototype.sendMessageToWindowClients_=function(i){return h(this,void 0,void 0,function(){var t,n,r=this;return f(this,function(e){switch(e.label){case 0:return[4,Ce()];case 1:return t=e.sent(),n=Oe(g.PUSH_MSG_RECEIVED,i),[4,Promise.all(t.map(function(e){return r.attemptToMessageClient_(e,n)}))];case 2:return e.sent(),[2]}})})},De.prototype.getSWRegistration_=function(){return h(this,void 0,void 0,function(){return f(this,function(e){return[2,self.registration]})})},De.prototype.getPublicVapidKey_=function(){return h(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=e.sent()))throw ie.create(C);return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(t=e.sent())?[2,oe]:[2,t]}})})},De);function De(e){var t=Pe.call(this,e)||this;return t.bgMessageHandler=null,self.addEventListener("push",function(e){t.onPush(e)}),self.addEventListener("pushsubscriptionchange",function(e){t.onSubChange(e)}),self.addEventListener("notificationclick",function(e){t.onNotificationClick(e)}),t}function Ce(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function Oe(e,t){return(n={})[v.TYPE_OF_MSG]=e,n[v.DATA]=t,n;var n}var Ie,Ne=(e(Ee,Ie=re),Ee.prototype.getToken=function(){return h(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return h(this,void 0,void 0,function(){var t,n;return f(this,function(e){switch(e.label){case 0:if(!(t=document.querySelector('link[rel="manifest"]')))return[2];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(t.href)];case 2:return[4,e.sent().json()];case 3:return n=e.sent(),[3,5];case 4:return e.sent(),[2];case 5:if(!n||!n.gcm_sender_id)return[2];if("103953800507"!==n.gcm_sender_id)throw ie.create(_);return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return e.sent(),[2,Ie.prototype.getToken.call(this)]}})})},Ee.prototype.requestPermission=function(){return h(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?ie.create(T):ie.create(S)}})})},Ee.prototype.useServiceWorker=function(e){if(!(e instanceof ServiceWorkerRegistration))throw ie.create(C);if(null!=this.registrationToUse)throw ie.create(V);this.registrationToUse=e},Ee.prototype.usePublicVapidKey=function(e){if("string"!=typeof e)throw ie.create(ee);if(null!=this.publicVapidKeyToUse)throw ie.create(te);e=fe(e);if(65!==e.length)throw ie.create(ne);this.publicVapidKeyToUse=e},Ee.prototype.onMessage=function(e,t,n){return"function"==typeof e?this.onMessageInternal(e,t,n):this.onMessageInternal(e)},Ee.prototype.onTokenRefresh=function(e,t,n){return"function"==typeof e?this.onTokenRefreshInternal(e,t,n):this.onTokenRefreshInternal(e)},Ee.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(e,t){var n;i?"activated"!==i.state?"redundant"!==i.state?(n=function(){if("activated"===i.state)e(r);else{if("redundant"!==i.state)return;t(ie.create(N))}i.removeEventListener("statechange",n)},i.addEventListener("statechange",n)):t(ie.create(N)):e(r):t(ie.create(q))})},Ee.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(e){throw ie.create(D,{browserErrorMessage:e.message})}).then(function(e){return t.waitForRegistrationToActivate_(e).then(function(){return(t.registrationToUse=e).update(),e})}))},Ee.prototype.getPublicVapidKey_=function(){return h(this,void 0,void 0,function(){return f(this,function(e){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,oe]})})},Ee.prototype.setupSWMessageListener_=function(){var r=this;navigator.serviceWorker.addEventListener("message",function(e){if(e.data&&e.data[v.TYPE_OF_MSG]){var t=e.data;switch(t[v.TYPE_OF_MSG]){case g.PUSH_MSG_RECEIVED:case g.NOTIFICATION_CLICKED:var n=t[v.DATA];r.messageObserver&&r.messageObserver.next(n)}}},!1)},Ee);function Ee(e){var t=Ie.call(this,e)||this;return t.registrationToUse=null,t.publicVapidKeyToUse=null,t.manifestCheckPromise=null,t.messageObserver=null,t.tokenRefreshObserver=null,t.onMessageInternal=d(function(e){t.messageObserver=e}),t.onTokenRefreshInternal=d(function(e){t.tokenRefreshObserver=e}),t.setupSWMessageListener_(),t}function Ae(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}Ke.INTERNAL.registerService("messaging",function(e){if(!Ae())throw ie.create(P);return new(self&&"ServiceWorkerGlobalScope"in self?Me:Ne)(e)},{isSupported:Ae})}.apply(this,arguments)}catch(Ke){throw console.error(Ke),new Error("Cannot instantiate firebase-messaging - be sure to load firebase-app.js first.")}});
