!function(){try{function e(e,t,o,n){this.image=e,this.cacheKey=t,this.tileRegion=o,this.requestedRegion=n||o}var c=window.$MicrosoftMaps8,t=c.Internal,g=(t._BoundsAccumulator,t._Debug),n=(t._Dispatcher,t._WorkDispatcher,t._EventBinding,t._Gimme,t._Helper),h=(t._JSEvent,c.ImageryMapLayer,t._LatLonCrs),a=c.LocationRect,o=t._LruCache,i=c.Location,_=(c.MapMath,t._MercatorCube,c.MercatorCubeCrs,t._MercatorTileUtility,t._Observable,t._ObservableObject,t._Overlay,t._OverlayManager,c.Point),r=(c.Size,t._VectorMath),f=(c.VectorMapLayer,t._Network,t._GeometryGeneralizer,c.BasicTemplate,c.GlobalConfig,v.prototype.getParent=function(){var e=null;return e=1<this.zoom?new v(Math.floor(this.x/2),Math.floor(this.y/2),this.zoom-1,this.pixelWidth,this.pixelHeight):e},v.prototype.toString=function(){return this._stringValue},v.fromQuadKey=function(e,t,o,n){var i,a;void 0===n&&(n=h.instance);for(var r=0,l=0,s=e.length,u=s;0<u;u--)i=1<<u-1,1&(a=e.charCodeAt(s-u)-48)&&(r|=i),2&a&&(l|=i);return new v(r,l,s,t,o,n)},v.areEqual=function(e,t){return e&&t&&e.quadKey===t.quadKey&&e.crs===t.crs},v),p=(I.getLodFromGroundResolution=function(e,t,o){t=156543.04*Math.cos(t*r.radiansPerDegree),e=r.log2(t/e),e=Math.round(e);return Math.max(e-o,1)},I.getTileIdFromLocation=function(e,t,o){t=I.latLongToPixelXY(e,t);return o&&(t.x+=o.x,t.y+=o.y),I.pixelXYToTileXY(t)},I.getMapSize=function(e){return I.tileLength<<e},I.latLongToPixelXY=function(e,t){var o=n._clamp(e.latitude,I.minLatitude,I.maxLatitude),e=(i.normalizeLongitude(e.longitude)+180)/360,o=Math.sin(o*Math.PI/180),o=.5-Math.log((1+o)/(1-o))/(4*Math.PI),t=I.getMapSize(t),e=Math.floor(n._clamp(e*t+.5,0,t-1)),t=Math.floor(n._clamp(o*t+.5,0,t-1));return new _(e,t)},I.pixelXYToTileXY=function(e){var t=Math.floor(e.x/I.tileLength),e=Math.floor(e.y/I.tileLength);return new _(t,e)},I.pixelXYToTile=function(e,t){var o=Math.floor(e.x/I.tileLength),e=Math.floor(e.y/I.tileLength);return new f(o,e,t,I.tileLength,I.tileLength,h.instance)},I.tileXYToPixelXY=function(e){var t=e.x*I.tileLength,e=e.y*I.tileLength;return new _(t,e)},I.tileToPixelXY=function(e){var t=e.x*I.tileLength,e=e.y*I.tileLength;return new _(t,e)},I.pixelXYToLatLong=function(e,t){var o=I.getMapSize(t),t=n._clamp(e.x,0,o-1)/o-.5,o=.5-n._clamp(e.y,0,o-1)/o,o=90-360*Math.atan(Math.exp(2*-o*Math.PI))/Math.PI;return new i(o,360*t)},I.quadKeyToLocationRect=function(e){var t=e.length,o=I.quadKeyToTileXY(e),n=o.x*I.tileLength,i=o.y*I.tileLength,e=n+I.tileLength,o=i+I.tileLength;return a.fromCorners(I.pixelXYToLatLong(new _(n,i),t),I.pixelXYToLatLong(new _(e,o),t))},I.quadKeyToTileXY=function(e){for(var t,o=0,n=0,i=e.length,a=i;0<a;a--)switch(t=1<<a-1,e[i-a]){case"0":break;case"1":o|=t;break;case"2":n|=t;break;case"3":o|=t,n|=t;break;default:throw new Error("Invalid QuadKey digit sequence.")}return new _(o,n)},I.tileLength=256,I.minLatitude=-85.05112878,I.maxLatitude=85.05112878,I.minLongitude=-180,I.maxLongitude=180,I),l=(T.prototype.getRegionsInBounds=function(e,t,o,n){void 0===o&&(o=p.tileLength);t=T._getLodFromScale(t-.001*t,this._lodOffset);return T._getRegionsInternal(e,t,o,n)},T.prototype.getRegions=function(e,t,o,n){void 0===o&&(o=p.tileLength);t=p.getLodFromGroundResolution(t,e.center.latitude,this._lodOffset);return T._getRegionsInternal(e,t,o,n)},T._getLodFromScale=function(e,t){for(var o,n=T._scaleToLod.length,i=0;i<n;i++)if(e<=(o=T._scaleToLod[i]).scale)return Math.max(o.lod-t,1)},T._getRegionsInternal=function(e,t,o,n){var i,a,r;g.assertIsInteger(t,"lod");var l=p.getTileIdFromLocation(e.getNorthwest(),t,new _(1,1)),s=p.getTileIdFromLocation(e.getSoutheast(),t,new _(-1,-1)),u=[],d=p.getMapSize(t)/o,h=l.x<=s.x?s.x-l.x+1:d+s.x-l.x+1;for(e.crossesInternationalDateLine()&&180<=e.width&&l.x===s.x&&(h=d),i=l.x,a=0;a<h;a++){for(i===d&&(i=0),r=l.y;r<=s.y;r++)u.push(new f(i,r,t,o,o,n||c.MercatorCubeCrs.instance));i++}return u},T._scaleToLod=[{scale:.0187,lod:23},{scale:.0373,lod:22},{scale:.0746,lod:21},{scale:.1493,lod:20},{scale:.2986,lod:19},{scale:.5972,lod:18},{scale:1.1943,lod:17},{scale:2.3887,lod:16},{scale:4.7773,lod:15},{scale:9.5546,lod:14},{scale:19.1093,lod:13},{scale:38.2185,lod:12},{scale:76.437,lod:11},{scale:152.8741,lod:10},{scale:305.7481,lod:9},{scale:611.4962,lod:8},{scale:1222.9925,lod:7},{scale:2445.9849,lod:6},{scale:4891.9698,lod:5},{scale:9783.9396,lod:4},{scale:19567.8792,lod:3},{scale:39135.7585,lod:2},{scale:Number.POSITIVE_INFINITY,lod:1}],T),s=(m.addTile=function(e,t){g.assertNotNull(e,"tile"),e&&(t?m._sharedBackgroundCache:m._sharedCache).addItem(e.cacheKey,e)},m.getTile=function(e,t){return!t&&m._sharedCache.getItem(e)||m._sharedBackgroundCache.getItem(e)},m.getBackgroundTile=function(e,t){e=!t&&m._sharedCache.getInternalDictionary()[e]||m._sharedBackgroundCache.getInternalDictionary()[e];return e&&e.item},m._sharedCacheSize=256,m._sharedBackgroundCacheSize=64,m._sharedCache=new o(m._sharedCacheSize),m._sharedBackgroundCache=new o(m._sharedBackgroundCacheSize),m),u=(L.prototype.projectToX=function(e,t){var o=this._getSheetLod(),t=new i(e,t),t=p.latLongToPixelXY(t,o),o=p.tileXYToPixelXY(this._tileXY);return(t.x-o.x)*(L._maxValue/256)},L.prototype.projectToY=function(e,t){var o=this._getSheetLod(),t=new i(e,t),t=p.latLongToPixelXY(t,o),o=p.tileXYToPixelXY(this._tileXY);return(t.y-o.y)*(L._maxValue/256)},L.prototype.toLatitude=function(e,t){var o=this._getSheetLod(),n=new _(this._tileXY.x,this._tileXY.y);return n.x+=e/L._maxValue,n.y+=t/L._maxValue,n=p.tileXYToPixelXY(n),p.pixelXYToLatLong(n,o).latitude},L.prototype.toLongitude=function(e,t){var o=this._getSheetLod(),n=new _(this._tileXY.x,this._tileXY.y);return n.x+=e/L._maxValue,n.y+=t/L._maxValue,n=p.tileXYToPixelXY(n),p.pixelXYToLatLong(n,o).longitude},L.prototype._getSheetLod=function(){return this._quadKey.length},L._maxValue=512,L),d=function(e){this.quadKey=e,this.lod=e.length,this.crs=new u(this),this.bounds=this.crs.bounds},x=(y.prototype.getRegionsInBounds=function(e,t){for(var o,n=[],i=this._pyramidTileSpatialIndex.getRegionsInBounds(e,t),a=0;a<i.length;a++)o=i[a].quadKey,o=new d(o),n.push(o);return n},y.prototype.getRegions=function(e,t){for(var o,n=[],i=this._pyramidTileSpatialIndex.getRegions(e,t),a=0;a<i.length;a++)o=i[a].quadKey,o=new d(o),n.push(o);return n},y);c.PyramidTileId=f,t.PyramidTileSpatialIndex=l,t.SheetId=d,t.SheetCrs=u,t.SheetSpatialIndex=x,t.TileSystemHelper=p,t.RasterTileCache=void 0!==s?s:null,t.RasterTile=void 0!==e?e:null}catch(e){if(!c.logger)throw e;c.logger.logCriticalError(e)}function y(){this._pyramidTileSpatialIndex=new l(1)}function L(e){this._quadKey=e.quadKey,this.id="sheetcrs-"+e.quadKey,this._tileXY=p.quadKeyToTileXY(e.quadKey),this.bounds=e.bounds}function m(){}function T(e){this._lodOffset=e||0}function I(){}function v(e,t,o,n,i,a){var r;void 0===n&&(n=256),void 0===i&&(i=256),void 0===a&&(a=h.instance),g.assertIsInteger(e,"x"),g.assertIsInteger(t,"y"),g.assertIsInteger(o,"zoom"),g.assertIsInteger(n,"width"),g.assertIsInteger(i,"height"),r=1<<o,this.x=e,this.y=t,this.zoom=o,this.pixelWidth=n,this.pixelHeight=i,i=((this.crs=a).bounds[1]-a.bounds[3])/r,r=(a.bounds[2]-a.bounds[0])/r,this.bounds=[a.bounds[0]+r*t,a.bounds[3]+i*e+i,a.bounds[0]+r*t+r,a.bounds[3]+i*e];for(var l="",s=e,u=t,d=0;d<o;d++)l=((1&s)+2*(1&u)).toString()+l,s>>=1,u>>=1;this.quadKey=l,this._stringValue=a.id+"PryamidTile"+l}}.call(window);
