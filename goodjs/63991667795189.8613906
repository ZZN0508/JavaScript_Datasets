!function(){"use strict";var i={selectors:{that:"bb-that",spotlight:".bb-that-spotlight",spotlightActive:"bb-that-spotlight--active",dataEndpoint:"data-spotlight-service"},logs:{invalidTHAT:"THAT was not rendered correctly. ",noEndpoint:"Spotlight retrieval endpoint not set. ",noSpotlight:"There are no spotlights to display at the moment ",parsingError:"There was an error when parsing the spotlight response ",invalidResponse:"There was an error when retrieving the spotlight ",spotlightSeen:"The spotlight has already been seen and closed."},cookieName:"bloomberg.that.spotlight",cookieDuration:1,spotlightEvent:"bloomberg.that.spotlight",endpoint:"",tophat:null,init:function(){this.validateTHAT()&&this.retrieveSpotlight()},validateTHAT:function(){var t=!1;return this.tophat=document.querySelector("div#"+this.selectors.that),this.tophat?(this.endpoint=this.tophat.getAttribute(this.selectors.dataEndpoint),this.endpoint?t=!0:this.log(!0,this.logs.noEndpoint)):this.log(!0,this.logs.invalidTHAT),t},retrieveSpotlight:function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE)if(200===e.status)try{var t=JSON.parse(e.responseText);t.hasOwnProperty("spotlights")&&Array.isArray(t.spotlights)&&0<t.spotlights.length&&i.renderSpotlight(t.spotlights[0])}catch(t){i.log(!0,i.logs.parsingError,t)}else i.log(!0,i.logs.invalidResponse,e.status)},e.open("GET",this.endpoint,!0),e.send()},renderSpotlight:function(t){this.getCookie(this.cookieName)?this.log(!1,this.logs.spotlightSeen):(this.tophat.insertAdjacentHTML("beforeend",t),document.querySelector(this.selectors.spotlight))},bindClose:function(){document.querySelector(this.selectors.spotlightClose).addEventListener("click",function(){i.tophat.removeChild(document.querySelector(i.selectors.spotlight)),i.setCookie(i.cookieName,!0,i.cookieDuration),i.log(!1,i.logs.spotlightClose)})},setCookie:function(t,e,i){var s=new Date;s.setTime(s.getTime()+864e5*i),document.cookie=t+"="+e+";path=/;expires="+s.toUTCString()},getCookie:function(t){t=document.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return t?t[2]:null},deleteCookie:function(t){this.setCookie(t,"",-1)},log:function(t,e,i){t?window.console.error(this.spotlightEvent,{message:e,extra:i}):window.console.log(this.spotlightEvent,{message:e,extra:i})}};document.addEventListener(i.spotlightEvent,function(){i.init()})}(),function(){"use strict";var t={selectors:{container:"#bb-that--container",header:".bb-that-header",jumpContentLink:".skiplink__hide-until-focus",jumpContentLinkFallback:".bb-that__skip-to-content",jumpContentTarget:"#that-jump-content",jumpContentTargetFallback:"#that-jump-content--default",mobileCategories:".bb-that--visible-xs .bb-that-category:not(.bb-that-category--sub) .bb-that-category__title",sitemapClose:".bb-that__close",sitemapLink:".bb-that-header--sitemap-trigger",tabbableHeaderLinks:".bb-that-header__link",tabbableSitemapLinks:'[tabindex="0"]',wrapper:"#bb-that .bb-that:not(.bb-that--static)",spotlight:"bb-that-spotlight"},spotlightEvent:"bloomberg.that.spotlight",containerEl:null,headerEl:null,jumpContentLinkFallback:null,jumpContentTarget:null,openClass:"bb-that--open",sitemapCloseEl:null,sitemapLinkEl:null,sitemapLinkSibEl:null,sitemapOpen:!1,tabbableHeaderLinks:null,tabbableSitemapLinks:null,wrapperEl:null,init:function(){this.wrapperEl=document.querySelector(this.selectors.wrapper),null!==this.wrapperEl&&(this.containerEl=this.wrapperEl.querySelector(this.selectors.container),this.sitemapLinkEl=this.wrapperEl.querySelector(this.selectors.sitemapLink),this.sitemapCloseEl=this.wrapperEl.querySelector(this.selectors.sitemapClose),this.headerEl=this.wrapperEl.querySelector(this.selectors.header),this.sitemapLinkSibEl=this.getNextSibling(this.sitemapLinkEl),this.tabbableHeaderLinks=Array.prototype.slice.call(document.querySelectorAll(this.selectors.tabbableHeaderLinks)),this.tabbableSitemapLinks=Array.prototype.slice.call(this.containerEl.querySelectorAll(this.selectors.tabbableSitemapLinks)),this.jumpContentLink=document.querySelector(this.selectors.jumpContentLink),this.jumpContentLinkFallback=this.wrapperEl.querySelector(this.selectors.jumpContentLinkFallback),this.jumpContentTarget=document.querySelector(this.selectors.jumpContentTarget),null!==this.jumpContentLink&&this.jumpContentLinkFallback.setAttribute("tabindex","-1"),null===this.jumpContentTarget?this.jumpContentTarget=document.querySelector(this.selectors.jumpContentTargetFallback):this.jumpContentLinkFallback.href=this.selectors.jumpContentTarget,this.bindEvents(),this.triggerSpotlight())},bindEvents:function(){var t=this.btnCallback(this.toggleSitemap);this.sitemapLinkEl.addEventListener("click",t,!1),this.sitemapLinkEl.addEventListener("keypress",t,!1);t=this.btnCallback(this.closeSitemap);this.sitemapCloseEl.addEventListener("click",t,!1),this.sitemapCloseEl.addEventListener("keypress",t,!1);t=this.makeCallback(this.onFocused);this.sitemapCloseEl.addEventListener("focusin",t,!1);t=this.makeCallback(this.jumpToContent);this.jumpContentLinkFallback.addEventListener("click",t,!1);t=this.tabCallback(this.tabThroughSitemap);this.containerEl.addEventListener("keydown",t,!1);t=this.tabCallback(this.tabThroughHeader);this.headerEl.addEventListener("keydown",t,!1);var e=this.makeCallback(this.toggleMobileCategory);[].forEach.call(this.wrapperEl.querySelectorAll(this.selectors.mobileCategories),function(t){t.addEventListener("click",e,!1)})},onFocused:function(t){-1===this.tabbableHeaderLinks.indexOf(t.relatedTarget)&&-1===this.tabbableSitemapLinks.indexOf(t.relatedTarget)&&this.tabbableHeaderLinks[this.tabbableHeaderLinks.length-1].focus()},jumpToContent:function(){this.jumpContentTarget.focus()},btnCallback:function(e){var i=this;return function(t){"click"!==t.type&&("keypress"!==t.type||13!==t.keyCode&&32!==t.keyCode)||e.call(i,t)}},tabCallback:function(e){var i=this;return function(t){9!==t.keyCode&&27!==t.keyCode||e.call(i,t)}},makeCallback:function(e){var i=this;return function(t){e.call(i,t)}},toggleClass:function(t){var e=new RegExp("(\\s|^)"+this.openClass+"(\\s|$)");t.className.match(e)?t.className=t.className.replace(e," "):t.className+=" "+this.openClass,document.querySelector("."+this.selectors.spotlight)&&document.querySelector("."+this.selectors.spotlight).classList.toggle(this.selectors.spotlight+"--active")},toggleSitemap:function(t){t.preventDefault(),t.stopImmediatePropagation(),this.sitemapOpen=!this.sitemapOpen,this.sitemapLinkEl.setAttribute("aria-expanded",this.sitemapOpen),this.toggleClass(this.wrapperEl),(this.sitemapOpen?this.containerEl:this.sitemapLinkEl).focus()},tabThroughHeader:function(t){var e;9===t.keyCode&&(e=this.tabbableHeaderLinks.indexOf(t.target),t.shiftKey?this.sitemapOpen&&t.target===this.sitemapLinkSibEl&&(t.preventDefault(),t.stopImmediatePropagation(),this.sitemapCloseEl.focus()):this.sitemapOpen&&t.target===this.sitemapLinkEl?this.containerEl.focus():e===this.tabbableHeaderLinks.length-1&&this.sitemapCloseEl.focus())},tabThroughSitemap:function(t){var e;9===t.keyCode?((e=this.tabbableSitemapLinks.indexOf(t.target))===this.tabbableSitemapLinks.length-1&&!t.shiftKey||0===e&&t.shiftKey)&&(t.preventDefault(),t.stopImmediatePropagation(),(0===e&&t.shiftKey?this.sitemapLinkEl:this.sitemapLinkSibEl).focus()):27===t.keyCode&&this.closeSitemap(t)},closeSitemap:function(t,e){t.preventDefault(),t.stopImmediatePropagation();e=e||this.sitemapLinkEl;this.sitemapOpen&&(this.sitemapOpen=!this.sitemapOpen,this.sitemapLinkEl.setAttribute("aria-expanded",this.sitemapOpen),this.toggleClass(this.wrapperEl),e.focus())},getNextSibling:function(t){for(var e;e=t.nextSibling;)if(1===e.nodeType)return e;return null},toggleMobileCategory:function(t){t.preventDefault(),this.toggleClass(t.target.parentNode)},triggerSpotlight:function(){var t=document.createEvent("Events");t.initEvent(this.spotlightEvent,!0,!0),document.dispatchEvent(t)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t.init()},!1):t.init()}();
