"function"==typeof Rmodules.define&&Rmodules.define(["jQuery","R^1","R.api^1","R.ui^1"],function(m,g){"use strict";function t(){m(".buyagain-recommend-widget-container").each(function(){var t,e,i=m(this),n=i.find(".buyagain-recommend-widget");n.length&&(e=n.find(".buyagain-recommend-settings"),(e={global:g.readSettings(e,o),css:g.readSettings(e.find(".buyagain-recommend-settings-css"),s),recommend:g.readApiSettings(e.find(".buyagain-recommend-settings-recommend"),r)}).updater=g.readSettings(m(e.css.updaterConfigSelector),c),void 0===e.global.mobile&&(e.global.mobile=g.browser.isMobile||g.browser.isIchibaApp),e.global.sid||(g.browser.isIchibaApp?e.global.sid="buyagain_app":e.global.mobile?e.global.sid="buyagain_sp":e.global.sid="buyagain_pc"),e.global.rat||(g.browser.isIchibaApp?e.global.rat="buyagain-app":e.global.mobile?e.global.rat="buyagain-sp":e.global.rat="buyagain-pc"),e.recommend.encoding=g.api.itemRecommendation.Encoding.EUC_JP,t=e,b=b||t.global.waitDom,e=n.find(t.css.itemTemplateSelector).removeClass(t.css.itemTemplateSelector.substring(1)).remove(),I.push({$element:i,$component:n,options:t,$template:e,sentRpps:[]}))})}function l(t,e,i){var n,a=[],o=t.options.global,s=o.maxItems?Math.min(o.maxItems,e.length):e.length;if(o.rat){for(n=0;n<s;n++)a.push(e[n].getShopId()+"/"+e[n].getItemId());t={accountId:o.ratAccId,serviceId:o.ratServiceId,options:["url","ua"],pData:{pgn:o.rat,pgt:o.pageType},cpData:{sid:o.ratSid,ritemid:a,rpl:g.api.itemRecommendation.getTrackingPlacement(t.options.recommend.sid)}},i.tracking_tag&&(t.cpData.rtg=i.tracking_tag),i.rpp&&(t.cpData.rpp=i.rpp),g.sendToRat(t)}}function a(i,n,a){function o(t,e){t=t.getElements(e||0),e=[t[0],t[t.length-1]+1],t=e.join(",");-1===m.inArray(t,i.sentRpps)&&(l(i,n,m.extend({},{rpp:e},a)),i.sentRpps.push(t))}var t=i.$component.find(i.options.css.slideshowSelector),e=function(t,e,i){for(var n,a,o,s,r,m=[],l=t.options.updater["data-pointuprate"]||0,d=t.options.global,c=d.maxItems?Math.min(d.maxItems,e.length):e.length,p=0;p<c;p++)n=e[p],o="",a=g.getTrackingLinks(n.getItemUrl(),d),i.tracking_tag&&(a=g.addUrlParams(a,{rtg:i.tracking_tag})),s=parseInt(n.getItemDiscountValue(),10),(r=n.getItemDiscountType())&&!isNaN(s)&&(r===u?o=l+s+d.pointBackText:r===h&&(o=s+d.discountText)),m.push({"#ITEM_NAME#":g.truncate(n.getItemName(),d.itemNameMaxLength,g.enums.Html.ELLIPSIS).split("").join(g.enums.Html.INV_LINE_SPLIT),"#ITEM_URL#":a,"#ITEM_IMG#":n.getItemImageUrl(d.itemWidth,d.itemHeight),"#ITEM_PRICE#":g.display.formatPrice(n.getItemPrice()),"#ITEM_DISCOUNT_INFO#":o});return{itemWidth:parseInt(t.$template.attr("width"),10)||d.itemWidth,itemTemplate:{html:t.$template.html(),data:m}}}(i,n,a),s=i.options.global,r={hideOnEmpty:i.$component,hideOnMin:s.minItems,imageLazyLoad:"data-src",afterFirstRender:function(t,e){s.pagination?o(t,e):l(i,n,a)}};s.pagination?r.onScrollEnd=function(t,e){o(t,e),d(i)}:(r.noPagination=!0,r.scrollMode=g.ui.Slideshow.ScrollMode.SIMPLE),s.mobile&&(r=m.extend(!0,g.ui.Slideshow.getSpOptions(),r)),new g.ui.Slideshow(t.show(),e,r)}function e(){I.length||t(),m.each(I,function(t,i){var n,e=p+t;i.options&&i.options.global.enabled&&(n=i.$component.find(".title"),g.user.isLogged(i.options.global.userLogin)&&g.onLazyLoad(function(){g.offLazyLoad(e),g.api.itemRecommendation.loadUserBasedRecommendedItems(i.options.recommend).done(function(t,e){n.length&&e.title&&n.html(g.applyTemplate(n.html(),{"#TITLE#":e.title})),a(i,t,e),d(i)})},e,i.$element))})}function d(t){function e(t){t.naturalWidth<=1&&t.naturalHeight<=1&&m(t).attr("src","https://r.r10s.jp/com/js/d/common/images/no-image.png").attr("srcset","")}t.$element.find("img").each(function(){-1===i.indexOf(this)&&(i.push(this),this.complete?e(this):m(this).one("load",function(){e(this)}).one("error",function(){e(this)}))})}var o={enabled:[!0,"bool"],waitDom:[!1,"bool"],itemWidth:[130,"int"],itemHeight:[130,"int"],itemNameMaxLength:[42,"int"],minItems:[2,"int"],maxItems:[void 0,"int"],userLogin:[void 0,"bool"],mobile:[void 0,"bool"],sid:[void 0,"str"],rat:[void 0,"str"],ratAccId:[470,"int"],ratServiceId:[1,"int"],ratSid:["ichiba","str"],pageType:["event","str"],pagination:[!0,"bool"],pointBackText:["%ポイントバック","str"],discountText:["円 OFF","str"]},s={updaterConfigSelector:[".sharedConfig"],slideshowSelector:[".buyagain-recommend-slideshow"],itemTemplateSelector:[".buyagain-recommend-item-template"]},r={sid:[void 0,"str"],genre:[void 0,"int"]},c={"data-pointuprate":[0,"int"]},p="lazilyLoadSlideshow",u="point_back",h="discount",b=!1,I=[],i=[];t(),b?m(e):e()});
