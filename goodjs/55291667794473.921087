!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery||window.Zepto)}(function(h,t){var p,e,u=window,A=h(u),g={threshold:0,failure_limit:0,event:"scroll",effect:"show",effect_params:null,container:u,data_attribute:"original",data_srcset_attribute:"original-srcset",skip_invisible:!0,appear:y,load:y,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:y,no_fake_img_loader:!1,placeholder_data_img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC",placeholder_real_img:"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png"};function y(){}function f(t,e){var a=e._$container==A?("innerHeight"in u?u.innerHeight:A.height())+A.scrollTop():e._$container.offset().top+e._$container.height();return a<=t.offset().top-e.threshold}function _(t,e){var a=e._$container==A?A.scrollTop():e._$container.offset().top;return a>=t.offset().top+e.threshold+t.height()}function m(l,i){var c=0;l.each(function(t,e){var a,r,n=l.eq(t);if(!(n.width()<=0&&n.height()<=0||"none"===n.css("display")))if(i.vertical_only){if(!_(n,i))if(f(n,i)){if(++c>i.failure_limit)return!1}else o()}else if(!(_(n,i)||(a=n,((r=i)._$container==A?h.fn.scrollLeft?A.scrollLeft():u.pageXOffset:r._$container.offset().left)>=a.offset().left+r.threshold+a.width())))if(f(n,i)||(r=n,((a=i)._$container==A?A.width()+(h.fn.scrollLeft?A.scrollLeft():u.pageXOffset):a._$container.offset().left+a._$container.width())<=r.offset().left-a.threshold)){if(++c>i.failure_limit)return!1}else o();function o(){n.trigger("_lazyload_appear"),c=0}})}function w(a){return a.filter(function(t,e){return!a.eq(t)._lazyload_loadStarted})}e=Object.prototype.toString,p=function(t){return e.call(t).replace("[object ","").replace("]","")},h.fn.hasOwnProperty("lazyload")||(h.fn.lazyload=function(c){var t,f,e,a,r,n,o,l,i,_,d=this;function s(){i=0,_=+new Date,l=a.apply(n,o),o=n=null}return h.isPlainObject(c)||(c={}),h.each(g,function(t,e){-1!=h.inArray(t,["threshold","failure_limit","check_appear_throttle_time"])?"String"==p(c[t])?c[t]=parseInt(c[t],10):c[t]=e:"container"==t?(!c.hasOwnProperty(t)||c[t]==u||c[t]==document?c._$container=A:c._$container=h(c[t]),delete c.container):!g.hasOwnProperty(t)||c.hasOwnProperty(t)&&p(c[t])==p(g[t])||(c[t]=e)}),t="scroll"==c.event,e=0==c.check_appear_throttle_time?m:(a=m,r=c.check_appear_throttle_time,_=0,function(){n=this,o=arguments;var t=new Date-_;return i||(r<=t?s():i=setTimeout(s,r-t)),l}),f=t||"scrollstart"==c.event||"scrollstop"==c.event,d.each(function(t,e){var r=this,n=d.eq(t),a=n.attr("src"),t=n.attr("data-"+c.data_attribute),o=c.url_rewriter_fn==y?t:c.url_rewriter_fn.call(r,n,t),l=n.attr("data-"+c.data_srcset_attribute),i=n.is("img");if(1==n._lazyload_loadStarted||a==o)return n._lazyload_loadStarted=!0,void(d=w(d));n._lazyload_loadStarted=!1,i&&!a&&n.one("error",function(){n.attr("src",c.placeholder_real_img)}).attr("src",c.placeholder_data_img),n.one("_lazyload_appear",function(){var t,e=h.isArray(c.effect_params);function a(){t&&n.hide(),i?(l&&n.attr("srcset",l),o&&n.attr("src",o)):n.css("background-image",'url("'+o+'")'),t&&n[c.effect].apply(n,e?c.effect_params:[]),d=w(d)}n._lazyload_loadStarted||(t="show"!=c.effect&&h.fn[c.effect]&&(!c.effect_params||e&&0==c.effect_params.length),c.appear!=y&&c.appear.call(r,n,d.length,c),n._lazyload_loadStarted=!0,c.no_fake_img_loader||l?(c.load!=y&&n.one("load",function(){c.load.call(r,n,d.length,c)}),a()):h("<img />").one("load",function(){a(),c.load!=y&&c.load.call(r,n,d.length,c)}).attr("src",o))}),f||n.on(c.event,function(){n._lazyload_loadStarted||n.trigger("_lazyload_appear")})}),f&&c._$container.on(c.event,function(){e(d,c)}),A.on("resize load",function(){e(d,c)}),h(function(){e(d,c)}),this})});
