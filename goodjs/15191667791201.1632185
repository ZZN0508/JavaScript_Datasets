!function(){"use strict";function s(e,t){t=t||window;for(var n=0;n<this.length;n+=1)e.call(t,this[n],this)}function e(e){var t=new Map;if(e)for(var n=0,r=function(e){if(Array.isArray(e))return e;if(e instanceof Map){var n=[];return e.forEach(function(e,t){n.push([t,e])}),n}if(e instanceof Set||e instanceof NodeList){var t=[];return(e.forEach||s).call(e,function(e){t.push(e)}),t}return[]}(e);n<r.length;n++){var o=r[n],i=o[0],o=o[1];t.set(i,o)}function a(){var n=[];return t.forEach(function(e,t){n.push([t,e])}),n}return t.keys=function(){return a().map(function(e){return e[0]})},t.values=function(){return a().map(function(e){return e[1]})},t.entries=a,t}function r(e){return(e||[]).slice(-1)[0]}!function(e,t){void 0===t&&(t="");var n=this.event&&this.event.type,r="unload"===n||"beforeunload"===n,n=new XMLHttpRequest;n.open("POST",e,!r),n.withCredentials=!0,n.setRequestHeader("Accept","*/*"),"string"==typeof t?(n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.responseType="text"):t instanceof Blob&&t.type&&n.setRequestHeader("Content-Type",t.type);try{n.send(t)}catch(e){return!1}return!0}.bind(window);function o(e,t,n){void 0===t&&(t=null),this.onFulfilled=e=void 0===e?null:e,this.onRejected=t,this.promise=n}var i=Date.now(),t=(d.prototype.getEntriesByName=function(e,t){return t&&"mark"!==t||!this.marks.has(e)?t&&"measure"!==t||!this.measures.has(e)?[]:this.measures.get(e):this.marks.get(e)},d.prototype.mark=function(e){this.marks.has(e)||this.marks.set(e,[]),this.marks.get(e).push({name:e,entryType:"mark",startTime:Date.now(),duration:0,toJSON:function(){}})},d.prototype.measure=function(e,t,n){this.measures.has(e)||this.measures.set(e,[]);t=r(this.marks.get(t)),n=r(this.marks.get(n)),t=t?t.startTime:i,n=n?n.startTime:Date.now();this.measures.get(e).push({name:e,entryType:"measure",startTime:t,duration:n-t,toJSON:function(){}})},d),n=window.performance,a=n.getEntriesByName,c=n.mark,n=n.measure,t=a&&c&&n?window.performance:new t,u=setTimeout;function d(){this.marks=e(),this.measures=e(),console.info("[Evolv] Using Performance API shim")}function l(){}var f=(h.prototype.then=function(e,t){var n=new h(l);return p(this,new o(e,t,n)),n},h.prototype.catch=function(e){return this.then(null,e)},h.prototype.finally=function(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){return n.reject(e)})})},h.resolve=function(t){return new h(function(e){e(t)})},h.reject=function(n){return new h(function(e,t){t(n)})},h.race=function(){throw new Error("Not implemented")},h.all=function(t){return new h(function(o,i){var a=Array.prototype.slice.call(t);if(0===a.length)return o([]);var s=a.length;for(var e=0;e<a.length;e++)!function t(n,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if("function"==typeof r)return r.call(e,function(e){t(n,e)},i),0}a[n]=e,0==--s&&o(a)}catch(e){i(e)}}(e,a[e])})},h.immediateFn=function(e){u(e,0)},h._unhandledRejection=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},h);function h(e){this.handled=!1,this.state=0,this.deferreds=[],v(e,this)}function v(e,t){var n=!1;try{e(function(e){n||(n=!0,m(t,e))},function(e){n||(n=!0,g(t,e))})}catch(e){if(n)return;n=!0,g(t,e)}}function p(n,r){for(;3===n.state;)n=n.value;0!==n.state?(n.handled=!0,f.immediateFn(function(){var e,t=1===n.state?r.onFulfilled:r.onRejected;if(t){try{e=t(n.value)}catch(e){return void g(r.promise,e)}m(r.promise,e)}else(1===n.state?m:g)(r.promise,n.value)})):n.deferreds.push(r)}function m(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof f)return e.state=3,e.value=t,void w(e);if("function"==typeof n)return void v(n.bind(t),e)}e.state=1,e.value=t,w(e)}catch(t){g(e,t)}}function g(e,t){e.state=2,e.value=t,w(e)}function w(e){2===e.state&&0===e.deferreds.length&&f.immediateFn(function(){e.handled||f._unhandledRejection(e.value)});for(var t=0;t<e.deferreds.length;t++)p(e,e.deferreds[t]);e.deferreds=[]}window.evolvShims=window.evolvShims||{},window.evolvShims.performance=t,window.evolvShims.PromiseShim=f}(),function(o){"use strict";[function(){for(var e=document.scripts,t=0;t<e.length;t+=1){var n=e[t].dataset;"evolvWebsite"in n&&!("evolvEnvironment"in n)&&(n.evolvEnvironment=n.evolvWebsite)}}].forEach(function(e){return e()});var n,i=(p.prototype.then=function(e,t){return this.promise.then(e,t)},p.prototype.catch=function(e){return this.promise.catch(e)},p.prototype.finally=function(e){return this.promise.finally(e)},p),s=window.document,r=window.localStorage,a=window.location,c=window.sessionStorage,u=window.addEventListener.bind(window),d=window.removeEventListener.bind(window),l=window.clearTimeout.bind(window),f=window.setTimeout.bind(window),t=(s.createElement.bind(s),s.querySelector.bind(s)),h=(s.querySelectorAll.bind(s),window.decodeURIComponent),v=(e.prototype.emit=function(e,t){var n;this.element&&("function"==typeof CustomEvent?n=new CustomEvent(e,{detail:t}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!1,t),this.element.dispatchEvent(n))},e.prototype.on=function(e,t){this.element&&this.element.addEventListener(e,function(e){t(e.detail)})},e.prototype.off=function(e,t){this.element&&this.element.removeEventListener(e,function(e){t(e.detail)})},new e("script[data-evolv-environment]"));function e(e){this.selector=e,this.element=t(e),this.element||console.warn("Emitter cannot be attached because selector does not match any element")}function p(){var n=this;this.promise=new o.PromiseShim(function(e,t){n.resolve=e,n.reject=t})}function m(t){return void 0===t&&(t="default"),n.runtime.then(function(e){return e.emitEvent(t)})}(n=W=W||{}).version="1.23.5",n.isReady=!1,n.editor=new i,n.runtime=new i,n.scout=new i,n.ready=o.PromiseShim.all([n.runtime,n.scout]).then(function(e){return n.isReady=!0,e}),n.trigger=function(e){if(!n.isReady)throw new Error("The Evolv runtime is not yet ready.");m(e)},n.triggerAsync=m,n.off=function(e,t){return v.off(e,t),window.evolv},n.on=function(e,t){return v.on(e,t),window.evolv},n.scripts={},window.evolv=window.evolv||W,window.ascend=window.ascend||W,function(e,t){void 0===t&&(t="");var n=this.event&&this.event.type,r="unload"===n||"beforeunload"===n,n=new XMLHttpRequest;n.open("POST",e,!r),n.withCredentials=!0,n.setRequestHeader("Accept","*/*"),"string"==typeof t?(n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.responseType="text"):t instanceof Blob&&t.type&&n.setRequestHeader("Content-Type",t.type);try{n.send(t)}catch(e){return!1}return!0}.bind(window);var g=(y.prototype.append=function(e,t){this.entries.push([e,t])},y.prototype.has=function(t){return this.entries.some(function(e){return e[0]===t})},y.prototype.get=function(e){return this.getAll(e)[0]},y.prototype.getAll=function(t){return this.entries.filter(function(e){return e[0]===t}).map(function(e){return e[1]})},y.prototype.forEach=function(e,t){for(var n=0,r=this.entries;n<r.length;n++){var o=r[n],i=o[0],o=o[1];e.call(t,o,i,this)}},y.prototype.toString=function(){var r=this;return this.entries.reduce(function(e,t){var n=t[0],t=t[1];return e.concat(r.encode(n)+"="+r.encode(t))},[]).join("&")},y.prototype.parseToEntries=function(e){for(var t=e.split("&"),n=0;n<t.length;n++){var r=t[n],o=r.indexOf("=");-1<o?this.append(this.decode(r.slice(0,o)),this.decode(r.slice(o+1))):r&&this.append(this.decode(r),"")}},y.prototype.decode=function(e){return e.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/gi,function(e){return decodeURIComponent(e)})},y.prototype.encode=function(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'\(\)~]|%20|%00/g,function(e){return t[e]})},y),w=function(e,t){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function y(e){void 0===e&&(e=""),this.entries=[],e=e.replace(/^\?/,"")||"",this.parseToEntries(e)}function b(e,t){function n(){this.constructor=e}w(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function k(){this.expires=1e4,this.instanceId="",this.pollingRate=500}var E,S,P=function(){return(P=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},x=(b(A,S=Error),A),j=(b(_,E=Error),_),I=(Object.defineProperty(O.prototype,"hasLock",{get:function(){return!!this.lock},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"lock",{get:function(){return this._lock},set:function(e){(this._lock=e)?r.setItem(this.key,JSON.stringify(e)):r.removeItem(this.key)},enumerable:!0,configurable:!0}),O.prototype.acquire=function(){var e=this,t=this.options,n=t.expires,r=t.pollingRate;this.deferred||(this.deferred=new i),l(this.timer);var o=this.getGlobalLock(),t=Date.now();return!o||o.expires<t?(d("storage",this.onStorageChanged),this.lock={expires:Date.now()+n,instanceId:this.options.instanceId},u("storage",this.onLockCommandeered),this.deferred.resolve()):0<r&&(u("storage",this.onStorageChanged),this.timer=f(function(){return e.acquire()},r)),this.deferred},O.prototype.release=function(){d("storage",this.onLockCommandeered),d("storage",this.onStorageChanged),l(this.timer),this.deferred=null,this.hasLock&&(this.lock=null)},O.prototype.getGlobalLock=function(){try{var e=r.getItem(this.key)||"";return JSON.parse(e)}catch(e){return null}},O);function O(e,t){var n=this;this.key=e,this.deferred=null,this.timer=null,this._lock=null,this.onStorageChanged=function(e){e.storageArea===r&&e.key===n.key&&null===e.newValue&&n.acquire()},this.onLockCommandeered=function(e){e.storageArea===r&&e.key===n.key&&null!==e.newValue&&(d("storage",n.onLockCommandeered),n._lock=null,n.deferred&&n.deferred.reject(new j))},this.options=P({},new k,t),u("unload",function(){n.release()})}function _(){return E.call(this,"Deadlock detected that may be caused by this lock not being released.")||this}function A(){return S.call(this,"Configuration not found. The Evolv script tag must specify the 'data-evolv-environment' attribute")||this}function C(){return Math.round(1e8*Math.random())+"_"+Date.now()}Object.defineProperty(function(e){this.value=e}.prototype,"current",{get:function(){return this.value},set:function(e){this.value=e},enumerable:!0,configurable:!0});var R,T={environmentId:"",autoLoad:!0,reconcile:"leave",apiUrl:"https://participants.evolv.ai",sdkUrl:"https://media.evolv.ai/releases/1.23.5/runtime.min.js",editorUrl:"https://media.evolv.ai/releases/1.23.5/editor.js",cookieDomains:[""],editorAdapterUrl:"https://app.ascend.ai/adapter.js"},U=/^(.+?)=(.*)$/;function L(){return(s.cookie?s.cookie.split("; "):[]).reduce(function(e,t){var n=U.exec(t);if(!n)return e;var r,t=h(n[1]),n=h(n[2]);try{r=JSON.parse(n)}catch(e){r=n.replace(/^"(.*)"$/,"$1")}return e.set(t,r),e},new Map)}function F(e,t,n){var r,o=(n=void 0===n?{}:n).domain?"; domain="+n.domain:"",i="; path="+(n.path||"/"),a="";n.millis&&((r=new Date).setTime(r.getTime()+n.millis),a="; expires="+r.toUTCString()),s.cookie=e+"="+t+a+o+i}function q(e){return c.getItem(e)}function D(e,t){c.setItem(e,t)}(W=R=R||{}).CandidateIds="evolv:cids",W.DeviceId="evolv:did",W.SessionId="evolv:sid",W.UserId="evolv:uid";function M(e){this.message="Halting further execution: "+e}function H(r){return new o.PromiseShim(function(e,t){var n=document.createElement("script");n.defer=!0,n.src=r,n.onload=e,n.onerror=t,document.head.appendChild(n)})}function N(e,t){return t=t||e,e="Proxy"in window&&navigator.sendBeacon?t:e,document.body||0<(n=window.navigator.userAgent).indexOf("MSIE ")||0<n.indexOf("Trident/")||0<n.indexOf("Edge/")||!document.querySelector("[src $= '"+e+"']")?H(e):o.PromiseShim.resolve();var n}function $(){return"true"===q("evolv:interactiveMode")}var B="evolv-previewid=([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\\.json)",J="evolv-previewcid=([0-9a-f]+(?:(?:%3a|:)[0-9a-f]+)+)",z="evolvCandidateToken=(([0-9]+)_([0-9]+)_([0-9a-z]+))",V=[{shouldActivate:function(){return 0<=a.hash.indexOf("_ascend_editor=")||null!==q("_ascend_editor")},activate:function(e){return!a.hash||(t=new g(a.hash.substring(1)).get("_ascend_editor"))&&(D("_ascend_editor",atob(t)),a.href=a.href.replace(new RegExp("[#&]_ascend_editor=[^&]*"),"")),e=e,(q("_ascend_editor")?H(e.editorAdapterUrl):o.PromiseShim.resolve()).catch(function(){return o.PromiseShim.reject(new Error("Editor Mode: Error loading adapter"))});var t}},{shouldActivate:$,activate:function(){return o.PromiseShim.resolve()}},{shouldActivate:function(){return 0<=a.search.indexOf("ascend-editor-bridge=true")},activate:function(){return H("https://media.ascend.ai/bridge/editor_bridge.js"),o.PromiseShim.reject(new M("Popout mode"))}},{shouldActivate:function(){return new RegExp(B).test(a.hash)},activate:function(e,t){var n=a.hash.match(new RegExp(B));return n&&(D("evolv-previewid",n[1]),a.href=a.href.replace(new RegExp("#?&?evolv-previewid=([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\\.json)"),""),t.debug("Live Preview mode activated")),o.PromiseShim.reject(new M("Live preview mode"))}},{shouldActivate:function(){return new RegExp(J,"i").test(a.hash)},activate:function(e,t){var n=new RegExp(J,"i"),r=a.hash.match(n);return r&&(n=h(r[1]),r=new RegExp("#?&?evolv-previewcid=([0-9a-f]+(?:(?:%3a|:)[0-9a-f]+)+)","i"),D("evolv-previewcid",n),a.href=a.href.replace(r,""),t.debug("Preview Candidate mode activated")),o.PromiseShim.reject(new M("Preview candidate mode"))}},{shouldActivate:function(e){var t=a.hash.match(new RegExp(z));return t&&e.environmentId===t[4]},activate:function(e,t){var n=a.hash.match(new RegExp(z));return n&&(D("evolvCandidateToken",n[1]),a.href=a.href.replace(new RegExp("#?&?evolvCandidateToken=(([0-9]+)_([0-9]+)_([0-9a-z]+))"),""),t.debug("QA mode activated")),o.PromiseShim.reject(new M("QA mode"))}}],W=(Object.defineProperty(G.prototype,"instanceId",{get:function(){return this._instanceId},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"tracker",{get:function(){return this._tracker},enumerable:!0,configurable:!0}),G.prototype.start=function(){var n=this;return this.started?o.PromiseShim.resolve():V.reduce(function(e,t){return t.shouldActivate(n.config)?e.then(function(){return t.activate(n.config,n.logger)}):e},o.PromiseShim.resolve()).then(function(){return"localStorage"in window&&"sessionStorage"in window&&navigator.cookieEnabled?(n.started=!0,v.emit("initialize",{config:n.config}),n.logger.debug("Started (instance: "+n.instanceId+")"),n.logger.debug("Ready State: "+s.readyState),o.PromiseShim.all([n.loadRuntime()].concat(!n.config.autoLoad||q("_ascend_editor")||$()?[]:[n.loadExecutionPlan()]))):(n.logger.debug("Evolv will not launch"),o.PromiseShim.resolve())}).catch(function(e){e instanceof M?n.logger.info(e.message):n.logger.error(e)})},G.prototype.loadRuntime=function(){var e=this;return N(this.config.sdkUrl,this.config.sdkUrl.replace(/(\.min)?\.js$/,"$1.mjs")).catch(function(){e.logger.warn("Runtime failed to load")})},G.prototype.loadExecutionPlan=function(){return this.logger.info("Reconciliation has been disabled"),this.retrieveExecutionPlan().then(function(){return o.PromiseShim.resolve()})},G.prototype.retrieveExecutionPlan=function(){var e=this,t=new I("evolv:mutex",{instanceId:this.instanceId});return o.PromiseShim.resolve().then(function(){return t.acquire().then(function(){return N(e.getExecutionPlanUrl("browser-cache"))}).catch(function(){e.logger.warn("Execution plan failed to load")}).finally(function(){t.release()})}).then(function(){o.performance.mark("execution-plan-retrieved"),e.logger.debug("Execution plan was retrieved successfully")})},G.prototype.reconcile=function(){var e=this;if(null===r.getItem("evolv:planVersion"))return o.PromiseShim.resolve();var t=C();return N(this.getExecutionPlanUrl(t)).catch(function(){e.logger.debug("Error occurred during reconciliation")})},G.prototype.getExecutionPlanUrl=function(e){var t=this.config.environmentId,n=new g,r=this.getCidLists(),o=r.confirmed,r=r.excluded;return n.append("version",e),n.append("uid",this.tracker.uid),n.append("sid",this.tracker.sid),n.append("did",this.tracker.did),n.append("cids",o),n.append("excl",r),this.tracker.previewId&&n.append("previewid",this.tracker.previewId),this.tracker.previewCid&&n.append("previewcid",this.tracker.previewCid),this.tracker.candidateToken&&(t=this.tracker.candidateToken),this.config.apiUrl+"/v1/"+t+"/execution-plans?"+n},G.prototype.getCidLists=function(){var e=(t=R.CandidateIds,L().get(t)||null);if(!e)return{confirmed:"",excluded:""};var t=function(e){var t=e.l,n=function(e,t){var n={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]]);return n}(e,["l"]);if(!e)return n;for(var r=0,o=Object.keys(n);r<o.length;r++){var i=o[r];n[i]=n[i].map(function(e){return t[e]})}return n}(e),e=t.cf,t=t.f.filter(function(e){return e.startsWith("*:")}).map(function(e){return e.replace(/^\*:/,"")});return{confirmed:e.join(","),excluded:t.join(",")}},new G(function(){for(var e=s.scripts,t=null,n=0;n<e.length;n+=1){var r=e[n].dataset;if("evolvEnvironment"in r){t=r;break}}if(!t)throw new x;var o,i={environmentId:t.evolvEnvironment,autoLoad:"false"!==(i=t.evolvAutoLoad)&&("true"===i||i),apiUrl:t.evolvApiUrl,sdkUrl:t.evolvSdkUrl,editorUrl:t.evolvEditorUrl,cookieDomains:(t.evolvCookieDomains||"").split(/,\s*/)};return Object.freeze(P({},T,(o=i,Object.keys(o).reduce(function(e,t){return void 0!==o[t]&&(e[t]=o[t]),e},{}))))}()));function G(e){var t,n=this;this.logger=function n(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var o="[Evolv]"+r.map(function(e){return"["+e+"]"}).join("");return{debug:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.debug.apply(console,[o,e].concat(t))},error:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.error.apply(console,[o,e].concat(t))},info:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.info.apply(console,[o,e].concat(t))},log:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.log.apply(console,[o,e].concat(t))},warn:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.warn.apply(console,[o,e].concat(t))},clone:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.apply(void 0,r.concat(e))}}}("Scout"),this.started=!1,this._instanceId=C(),this.config=e,this._tracker=function(e){void 0===e&&(e=[]);for(var t=L(),n=t.get(R.UserId)||C(),r=t.get(R.DeviceId)||C(),o=t.get(R.SessionId)||C(),i=0,a=e;i<a.length;i++){var s=a[i];F(R.UserId,n,{domain:s,millis:63072e6}),F(R.DeviceId,r,{domain:s,millis:63072e6}),F(R.SessionId,o,{domain:s,millis:2592e6})}return{uid:n,sid:o,did:r,previewId:q("evolv-previewid"),previewCid:q("evolv-previewcid"),candidateToken:q("evolvCandidateToken")}}(e.cookieDomains),window.evolvPreload&&window.evolvPreload.listeners&&(t=window.evolvPreload.listeners,Object.keys(t).forEach(function(e){v.on(e,t[e])})),u("readystatechange",function(){var e=s.readyState;n.logger.debug("Ready State: "+e),o.performance.mark("ready-state-"+e)})}W.start(),window.evolv.scout.resolve(W)}(window.evolvShims);
