!function(e,t){"function"==typeof define&&define.amd?define("Parallax",["module"],t):"undefined"!=typeof exports?t(module):(t(t={exports:{}}),e.Parallax=t.exports)}(this,function(e){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t){var i="string"==typeof e?(t||document).querySelectorAll(e):e;return Array.prototype.slice.call(i)}function s(e){return void 0===e}function o(o){o=o||{};var a={},h=Array.prototype.slice;return Object.defineProperties(o,{on:{value:function(e,t){return"function"==typeof t&&(a[e]=a[e]||[]).push(t),o},enumerable:!1,writable:!1,configurable:!1},off:{value:function(e,t){if("*"!=e||t)if(t)for(var i,n=a[e],r=0;i=n&&n[r];++r)i==t&&n.splice(r--,1);else delete a[e];else a={};return o},enumerable:!1,writable:!1,configurable:!1},one:{value:function(t,i){return o.on(t,function e(){o.off(t,e),i.apply(o,arguments)})},enumerable:!1,writable:!1,configurable:!1},trigger:{value:function(e){for(var t,i,n=arguments.length-1,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s+1];for(t=h.call(a[e]||[],0),s=0;i=t[s];++s)i.apply(o,r);return a["*"]&&"*"!=e&&o.trigger.apply(o,["*",e].concat(r)),o},enumerable:!1,writable:!1,configurable:!1}}),o}var a,h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},u=(t(p,[{key:"bind",value:function(){var e=this;return window.addEventListener("scroll",function(){return e.scroll()},!0),window.addEventListener("mousewheel",function(){return e.scroll()},!0),window.addEventListener("touchmove",function(){return e.scroll()},!0),window.addEventListener("resize",function(){return e.resize()},!0),window.addEventListener("orientationchange",function(){return e.resize()},!0),window.onload=function(){return e.scroll()},this}},{key:"scroll",value:function(){var e=this;return this.tick||(this.tick=!this.tick,h(function(){return e.update()})),this}},{key:"update",value:function(){return this.trigger("scroll",this.scrollTop),this.tick=!this.tick,this}},{key:"resize",value:function(){var e=this;return this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){return e.trigger("resize",e.size)},20),this}},{key:"scrollTop",get:function(){var e=(window.pageYOffset||document.scrollTop)-(document.clientTop||0);return window.isNaN(e)?0:e}},{key:"height",get:function(){return window.innerHeight}},{key:"width",get:function(){return window.innerWidth}},{key:"size",get:function(){return{width:this.width,height:this.height}}}]),p),l=function(e,t){for(var i=["ms","o","Moz","webkit"],n=i.length;n--;){var r=i[n],r=r?r+t[0].toUpperCase()+t.substr(1):t.toLowerCase()+t.substr(1);if(r in e)return r}return""}(document.createElement("div").style,"transform"),c=((a=document.createElement("div")).style[l]="matrix(1, 0, 0, 1, 0, 0)",/matrix/g.test(a.style.cssText)),f=(t(v,[{key:"load",value:function(){var e=this;return this.img.width&&this.img.height&&this.img.complete?this.onImageLoaded():this.img.onload=function(){return e.onImageLoaded()},this}},{key:"destroy",value:function(){this.img.parentNode.replaceChild(this.initial,this.img),this.off("*")}},{key:"onImageLoaded",value:function(){return this.isLoaded=!0,this.update(),this.img.style.willChange="transform",this.trigger("loaded",this.img),this}},{key:"update",value:function(){var e,t,i=(this.img.naturalWidth||this.img.width)/(this.img.naturalHeight||this.img.height),n=this.size,r=void 0,s=void 0;return(r=n.width/i<=n.height?(s=n.height*i,n.height):(s=n.width,n.width/i))<=n.height+n.height*this.opts.safeHeight&&(s+=s*this.opts.safeHeight,r+=r*this.opts.safeHeight),e=-~~((r-n.height)/2),t=-~~((s-n.width)/2),this.img.width=s,this.img.height=r,this.img.style.top=e+"px",this.img.style.left=t+"px",this}},{key:"draw",value:function(e){var t=e.scrollTop,i=(e.width,e.height),e=this.size,e=~~(((this.offset.top+e.height*this.opts.center+i/2-t)/i-1)*(this.img.height/e.height/2*this.opts.intensity)*10);return this.img.style[l]=c?"matrix(1,0,0,1, 0, "+-e+")":"translate(0, "+-e+"px)",this}},{key:"bounds",get:function(){return this.wrapper.getBoundingClientRect()}},{key:"offset",get:function(){return{top:this.wrapper.offsetTop,left:this.wrapper.offsetLeft}}},{key:"size",get:function(){var e=this.bounds;return{height:0|e.height,width:0|e.width}}}]),v),d=void 0,t=(t(g,[{key:"init",value:function(){if(this.bound)throw"The parallax instance has already been initialized";return this.canvases.length||null===this.selector?(this.imagesLoaded=0,this.bind()):console.warn('No images were found with the selector "'+this.selector+'"'),this}},{key:"bind",value:function(){var n=this;return this._onResize=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.resize.apply(n,t)},this._onScroll=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.scroll.apply(n,t)},d.on("resize",this._onResize),d.on("scroll",this._onScroll),this.canvases.forEach(function(e){e.one("loaded",function(){return n.onCanvasLoaded(e)}),e.load()}),this.bound=!0,this}},{key:"refresh",value:function(){return this.onResize(d.size).onScroll(d.scrollTop),this}},{key:"onCanvasLoaded",value:function(e){return this.trigger("image:loaded",e.img,e),this.imagesLoaded++,e.draw(d),this.imagesLoaded==this.canvases.length&&this.trigger("images:loaded"),this}},{key:"scroll",value:function(e){for(var t=this.opts.offsetYBounds,i=d,n=i.height,r=i.width,s=this.canvases.length;s--;){var o=this.canvases[s],a=o.size.height,h=o.offset;o.isLoaded&&e+d.height+t>h.top&&h.top+a>e-t&&(o.draw({height:n,scrollTop:e,width:r}),this.trigger("draw",o.img))}return this.trigger("update",e),this}},{key:"add",value:function(e){var t=this,e=this.createCanvases(r(e));return this.bound&&e.forEach(function(e){e.one("loaded",function(){return t.onCanvasLoaded(e)}),e.load()}),this.canvases=this.canvases.concat(e),this}},{key:"remove",value:function(e){var i=this;return r(e).forEach(function(e){for(var t=i.canvases.length;t--;)if(e==i.canvases[t].img){i.canvases[t].destroy(),i.canvases.splice(t,1);break}}),this}},{key:"destroy",value:function(){return this.off("*"),this.canvases=[],d.off("resize",this._onResize).off("scroll",this._onScroll),this}},{key:"resize",value:function(e){for(var t=this.canvases.length;t--;){var i=this.canvases[t];if(!i.isLoaded)return;i.update().draw(d)}return this.trigger("resize"),this}},{key:"createCanvases",value:function(e){var i=this;return e.map(function(e){var t=(t=e).dataset||Array.prototype.slice.call(t.attributes).reduce(function(e,t){return/data-/.test(t.name)&&(e[t.name.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})]=t.value),e},{});return new f(e,{intensity:s(t.intensity)?i.opts.intensity:+t.intensity,center:s(t.center)?i.opts.center:+t.center,safeHeight:s(t.safeHeight)?i.opts.safeHeight:+t.safeHeight})})}},{key:"opts",set:function(e){this._defaults={offsetYBounds:50,intensity:30,center:.5,safeHeight:.15},function(e){for(var t,i=arguments,n=1;n<i.length;++n)if(t=i[n])for(var r in t)e[r]=t[r]}(this._defaults,e)},get:function(){return this._defaults}}]),g);function g(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return i(this,g),o(this),this.opts=t,this.selector=e,this.canvases=[],this.bound=!1,null!==e&&this.add(e),d=d||new u,this}function v(e,t){i(this,v),o(this),this.opts=t,this.img=e,this.wrapper=e.parentNode,this.isLoaded=!1,this.initial=e.cloneNode(!0)}function p(){i(this,p),o(this),this.resizeTimer=null,this.tick=!1,this.bind()}e.exports=t});
