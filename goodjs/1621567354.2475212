(this.$WP=this.$WP||[]).push(["HZtvHO",(e,t)=>{"use strict";var a,r,i,n,o,l,s,c,d,u,p,v,m,T,E,S,C,b,g,I,k,_,f,y,h,O,M,A,j,P,R,L,x,N;function w(e,t){if(null==e)return{};var a,r,i={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(i[a]=e[a]);return i}var V=(e,t)=>{var a,r,i;if(!t)return e;var n=(null==(a=e.paginatedTrips)?void 0:a.trips)||[],o=(null==(r=t.paginatedTrips)?void 0:r.trips)||[];return{paginatedTrips:e.paginatedTrips?{trips:[...n,...o],hasMore:!!(null==(i=t.paginatedTrips)?void 0:i.hasMore),__typename:e.paginatedTrips.__typename}:t.paginatedTrips,savedTrips:e.savedTrips}},D=e=>{var t;return{__typename:e.__typename,id:e.id||0,title:e.title||void 0,status:e.status||void 0,photoId:e.photoId||void 0,photo:e.photo||{},route:{url:e.route&&e.route.url||void 0},actionPermissions:{canAddItem:!!(null==(t=e.actionPermissions)?void 0:t.canAddItem)}}},F=e=>{var t,{saveObject:i,overlayState:n,validateTripName:o,lastSavedItem:c,trackingContext:d,trackingSource:p}=e,v=w(e,["saveObject","overlayState","validateTripName","lastSavedItem","trackingContext","trackingSource"]),[m,T]=a.useState(!0),{fetching:S,error:C,data:b,hasMore:_,loadMore:f}=(e=>{var t,r,i,n,o,s,c,d=(t,a)=>{if(!t||!a)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&a===r.type&&t===String(r.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"},{userId:p}=a.useContext(u),v={offset:0,limit:10,userId:p||"",reference:l(e),loadSavedTrips:!0},[m,T]=O({query:A,variables:v,combineData:V,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:()=>"invalidateAndRefetch",cloneTrip:()=>"invalidateAndRefetch",tripsDelete:()=>"invalidateAndRefetch",addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>d(e,t),moveTripItem:({variables:{reference:e}})=>d(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveItem:({variables:{reference:e}})=>d(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>d(null==e?void 0:e.id,null==e?void 0:e.type)}}),S=E("trips_skip_check_whitelist_public_trips"),[C]=P({query:j,variables:{},pause:S}),b=(null==(t=m.data)||null==(r=t.paginatedTrips)?void 0:r.trips)||[],g=b.slice().filter(Boolean).map(D),I=!!(null==(i=m.data)||null==(n=i.paginatedTrips)?void 0:n.hasMore),k=(null==(o=m.data)?void 0:o.savedTrips)||[],_=new Set(k.map(e=>null==e?void 0:e.id).filter(Boolean)),f=I?()=>T({offset:(null==b?void 0:b.length)||0,loadSavedTrips:!1}):()=>Promise.resolve(),y=S||(null==(s=C.data)||null==(c=s.authzInfo)?void 0:c.canMakePublicTrip);return{fetching:m.fetching||C.fetching,error:!!m.error,data:{tripList:g,saveSet:_,canMakePublicTrip:y},hasMore:I,loadMore:f}})(i);S?t=a.createElement(k,{size:"large"}):C&&(t=a.createElement(h,{refetch:f})),a.useEffect(()=>{S||T(!1)},[]);var[M]=r({source:p||"trips",trackingContext:d,pageAsContext:!0,withSaveSession:!0}),F=()=>{v.onClose(),T(!0)},U=R[n](i.type),G=a.createElement(I,{iconName:E("trips_heart_icon")?"heart":"suitcase",displayType:"LEFT_ALIGN_GRAY"},U);return a.createElement(y,{element:"bundleSave"===i.type?"copyTripModal":"saveTripModal"},a.createElement(g,{header:G,closeIconColor:"BLACK",bodyProps:{isFullBleed:!0},onClose:F},t&&m?a.createElement("div",{className:"_1ZX8j9so"},t):(()=>{var e=c?s(c):void 0,r=()=>a.createElement("div",{className:"_2VvuVGxR"},a.createElement(L,{gate:()=>Promise.resolve(),object:i,onMount:()=>{S||C||M({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{v.statCallback("ADD","NEW",e,!0,!0),F()},onError:v.onError,canMakePublicTrip:b.canMakePublicTrip,validateTripName:o,trackingContext:d,trackingSource:p}));switch(n){case"DEFAULT":return 0===b.tripList.length?r():a.createElement(N,{tripList:b.tripList,savedSet:b.saveSet,tripListBottom:t,onPaginate:f,hasMore:_,saveObject:i,onMount:()=>{v.preventInteractionInMountedComponents||M({elementClick:{element:"stat"}})},onCreateTrip:()=>{v.onCreateTripClicked&&v.onCreateTripClicked()},tripAction:"SAVE",onRemovedFromTrip:(e,t,a)=>{v.statCallback("REMOVE","EXISTING",e,t,a),F()},onSavedToTrip:(e,t,a)=>{v.statCallback("ADD","EXISTING",e,t,a),F()},onError:v.onError,trackingContext:d,trackingSource:p});case"CREATE":return r();case"SELECT":return e?a.createElement(N,{tripList:b.tripList,savedSet:b.saveSet,tripListBottom:t,onPaginate:f,hasMore:_,saveObject:e,onMount:()=>{M({elementClick:{element:"stat"}})},onCreateTrip:()=>{v.onSelectCreateTripClicked&&v.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:(e,t,a)=>{v.statCallback("MOVE","EXISTING",e,t,a),F()},onRemovedFromTrip:(e,t,a)=>{v.statCallback("REMOVE","EXISTING",e,t,a),F()},onError:v.onError,trackingContext:d,trackingSource:p}):"";case"SELECT_CREATE":return c?a.createElement("div",{className:"_2VvuVGxR"},a.createElement(x,{gate:()=>Promise.resolve(),item:c,onMovedToCreatedTrip:e=>{v.statCallback("MOVE","NEW",e,!0,!0),F()},canMakePublicTrip:b.canMakePublicTrip})):r();default:return""}})()))},U=(e,t)=>{switch(t.type){case"setOverlayState":return Object.assign({},e,{overlayState:t.state});case"afterSave":return Object.assign({},e,{overlayState:"DEFAULT",preventInteractionInMountedComponents:!0});default:throw new Error}},G=e=>{var t,{logInteraction:r,object:i,active:o,preventInteractionPropagation:l,trackingContext:s,trackingSource:c,resaveTrip:p,saveObject:v,saveStatus:m,updateLastTripId:T,initialOverlayState:E}=e,b=w(e,["allowPopStatModal","logInteraction","puid","object","active","preventInteractionPropagation","trackingContext","trackingSource","resaveTrip","saveObject","saveStatus","updateLastTripId","onClose","initialOverlayState"]),{userId:g}=a.useContext(u),{launchViewTripToast:I,launchRemoveFromTripToast:k,launchErrorTripToast:_}=d(),{getTripErrorMessage:f}=S(),y=C("SAVE_TO_TRIP_INTENT"),h=C("SAVE_TO_TRIP"),O=C({type:"CREATE_TRIP",payload:{user_id:g||""}}),M=a.useContext(n),[A,j]=a.useReducer(U,{overlayState:E||"DEFAULT",preventInteractionInMountedComponents:!1}),P=a.useRef(!0);a.useEffect(()=>()=>{P.current=!1},[]);var{onComplete:R}=b,L=a.useCallback(e=>{R&&R(e),M.resetSession()},[R,M]),x=a.useCallback((e,t)=>{e&&!t?(I(e,"SAVED",()=>{r({elementClick:{element:"saved_viewTrip"}})}),L(!0)):t&&(_(t),L(!1)),P.current&&j({type:"setOverlayState",state:"DEFAULT"}),r({elementClick:{element:"unsave_undo"}})},[I,L,_,r]),N=a.useCallback(e=>{k(e,v,x)},[k,x,v]),V=a.useCallback(e=>{_(e)},[_]),[D,G]=a.useState(!1),W=a.useCallback(()=>{G(!0),M.resetSession()},[M]),X=a.useCallback((e,t)=>{"CREATED"===t&&(h(),O()),P.current&&j({type:"afterSave"}),I(e,t,()=>{r({elementClick:{element:"saved_viewTrip"}})}),T(e.id),L(!0)},[h,I,L,T,O,r]);return!D&&a.createElement("div",{className:"stat_wrapper",onClick:e=>{e.stopPropagation(),e.preventDefault(),!l&&g&&r({elementClick:{element:"item_save",tripId:null==p?void 0:p.id}}),o||y()}},a.createElement(F,{saveObject:v,overlayState:A.overlayState,lastSavedItem:null==(t=m.result)?void 0:t.tripItem,trackingContext:s,trackingSource:c,onCreateTripClicked:()=>{P.current&&j({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:()=>{P.current&&j({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:W,onError:V,preventInteractionInMountedComponents:A.preventInteractionInMountedComponents,statCallback:(e,t,a,r,i)=>{"REMOVE"===e?(N(a),L(i)):"NEW"===t?X(a,"CREATED"):r&&X(a,"SAVED")},validateTripName:e=>{if("bundleSave"===v.type&&e.trim().toLowerCase()===i.title.trim().toLowerCase())return f("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})}}))},W=e=>E("trips_bookmark")?a.createElement(i,null,a.createElement(b,null,a.createElement(G,e))):null,X=["Profile","HomeFeed","Trips","Home"],q=e=>{var{children:t}=e,l=w(e,["children"]),c=a.useMemo(()=>l.saveObject||s(l.object,!0),[l.saveObject,l.object]),u=(e=>{var t=a.useMemo(()=>e.saveObject||s(e.object,!0),[e.saveObject,e.object]),{resaveTrip:i,onComplete:l,allowPopStatModal:c}=e,{isNativeWebview:u}=e,S=w(e,["isNativeWebview"]),{launchAutoSavedToTripToast:C,launchErrorTripToast:b}=d(),[g]=a.useContext(p),{page:I}=g,k=a.useMemo(()=>({source:e.trackingSource||"trips",saveObject:t,trackingContext:e.trackingContext,withSaveSession:!0,pageAsContext:!0}),[e.trackingContext,e.trackingSource,t]),[_,f]=r(k),y=a.useContext(n),[h,O,M]=v(t,e.active),A=null==t?void 0:t.id,j=null==t?void 0:t.type,P=a.useCallback(e=>{b(e)},[b]),R=a.useCallback(()=>{_({elementClick:{element:"ITEM_SAVE_LOGIN",context:I&&o(I)||void 0,puid:f,saveType:j,detailId:A?""+A:"",tripId:null==i?void 0:i.id,sessionType:"SAVE",sessionUuid:y.sessionUuid,sessionOrder:y.sessionOrder}})},[_,I,f,i,A,j,y.sessionOrder,y.sessionUuid]),L=a.useCallback(()=>{_({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:I&&o(I)||void 0,puid:f,saveType:j,detailId:A?""+A:"",tripId:null==i?void 0:i.id,sessionType:"SAVE",sessionUuid:y.sessionUuid,sessionOrder:y.sessionOrder}})},[_,I,f,i,A,j,y.sessionOrder,y.sessionUuid]),x=a.useMemo(()=>({pid:I&&X.includes(g.page)?40439:39766,flow:u?"NATIVE_LOGIN":"SAVES_COMBINED",onLogin:R,onSuccess:L,isFullWidthMobile:!0}),[R,L,I,g.page,u]),N=m(x),V=a.useRef(!1),{open:D}=T(()=>t?a.createElement(W,Object.assign({},S,{logInteraction:_,puid:f,saveObject:t,saveStatus:h,updateLastTripId:M})):null),{open:F}=T(()=>t?a.createElement(W,Object.assign({},S,{initialOverlayState:"SELECT",logInteraction:_,puid:f,saveObject:t,saveStatus:h,updateLastTripId:M})):null),U=a.useMemo(()=>g.params.popStat||!1,[g.params]),G=a.useCallback(()=>!!c&&U&&E("trips_pop_stat_modal"),[c,U]);return a.useEffect(()=>{G()&&!V.current&&(V.current=!0,_({elementClick:{element:"autoPopStat"}}),N().then(D))},[_,N,D,G]),a.useCallback(()=>{N().then(()=>O()).then(([e,t])=>{null!==e||null!==t?t?P({query:"ADD_ITEM_TO_TRIP",tripsError:t}):e&&(C(e,()=>{F(),_({elementClick:{element:"quickSave_change"}})}),_({modalSuccess:{element:"quickSave",tripId:null==i?void 0:i.id,context:I&&o(I)||void 0,saveType:j,detailId:A?""+A:""}}),l&&l(!0)):D()})},[D,F,C,_,N,l,P,O,I,i,A,j])})(l);return c?a.createElement(i,null,t(u)):null},Q=({saveObject:e,object:t,queryObject:r,preventInteractionPropagation:i,trackingContext:n,trackingSource:o,children:l,trip:s,allowPopStatModal:c,onComplete:d,isNativeWebview:p})=>{var v,m,T,E,S,[C,b]=a.useState((null==t||null==(v=t.object)?void 0:v.socialStatistics)?!!(null==t||null==(m=t.object)||null==(T=m.socialStatistics)?void 0:T.isSaved):!!(null==t||null==(E=t.socialStatistics)?void 0:E.isSaved)),g=(e,t)=>{if(!e||!t)return"invalidateAndRefetch";var{originalObject:a}=r;return a&&t===a.type&&e===String(a.id)||t===r.type&&e===String(r.id)?"invalidateAndRefetch":"validate"},{userId:I}=a.useContext(u);S=I?(null==t?void 0:t.socialStatistics)?"afterInvalidation":"immediately":"never";var[{fetching:k,data:_,error:f}]=M({query:r.query,variables:r.variables,executeWhen:S},{addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>g(e,t),tripsRemoveItem:({variables:{reference:e}})=>g(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>g(e.id,null==e?void 0:e.type)});return a.useEffect(()=>{if(!k&&!f){var e=_&&_.savesObjects&&_.savesObjects[0];if(e){var{id:t,socialStatistics:a={}}=e,i=(t===r.id||String(t)===r.id)&&!!a.isSaved;i!==C&&b(i)}}},[k,_,f]),a.createElement(q,{saveObject:e,object:t,active:C,preventInteractionPropagation:i,trackingContext:n,trackingSource:o,resaveTrip:s,allowPopStatModal:c,onComplete:d,isNativeWebview:p},e=>l(e,C,k))},B=e=>{if(!E("trips_bookmark"))return null;var t=e.saveObject||s(e.object,!0);if(!t)return console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null;var r=c(t);return r?a.createElement(Q,Object.assign({},e,{queryObject:r})):(console.error("Unsupported saves object was passed to QueriedTripFlowSelector"),null)};return[()=>{R=Object.freeze({DEFAULT:e=>"bundleSave"!==e?a.createElement(_,{id:"stat_modal_save_to_trip_v2"}):a.createElement(_,{id:"save_all_items_modal_header"}),CREATE:()=>a.createElement(_,{id:"stat_modal_create_a_trip_v2"}),SELECT:()=>a.createElement(_,{id:"select_trip_header"}),SELECT_CREATE:()=>a.createElement(_,{id:"stat_modal_create_a_trip_v2"})}),L=f.component.onUsage(()=>t("neHaXV"),"CreateTripWithAddItemModal",a.createElement("div",{className:"_1ZX8j9so"},a.createElement(k,{size:"large"}))),x=f.component.onUsage(()=>t("neHaXV"),"CreateTripWithMoveItemModal",a.createElement("div",{className:"_1ZX8j9so"},a.createElement(k,{size:"large"}))),N=f.component.onUsage(()=>t("pBQaod"),"SaveToTripContent",a.createElement("div",{className:"_1ZX8j9so"},a.createElement(k,{size:"large"}))),G.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1},B.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1},e({QueriedTripFlowSelector:B,TripFlowSelector:q})},[e=>a=e,e=>(r=e.useTripInteraction,i=e.SaveSessionProvider,n=e.SaveSessionTrackingContext,o=e.getInteractionsContext),e=>(l=e.toReference,s=e.toSavesObject,c=e.objectStatisticQuery),e=>d=e.default,e=>(u=e.Visitor,p=e.Route),e=>v=e.useAutosave,e=>m=e.useSocialLoginGate,e=>T=e.useVDOMPortal,e=>E=e.featureIsEnabled,e=>S=e.useLocalizeTripError,e=>C=e.usePixelCallback,e=>b=e.ToastProvider,e=>g=e.default,e=>I=e.TitleBar,e=>k=e.LoadingSpinner,e=>_=e.default,e=>f=e,e=>y=e.TripsImpression,e=>h=e.default,e=>(O=e.usePaginatedQuery,M=e.useInvalidatableQuery),e=>(A=e.TripDetailStatQuery,j=e.GetUserAuthZInfo),e=>P=e.useQuery]]},["cDcdfi","U-DhDC","eFKnUp","PiTJFd","2R4xv2","fTyhRT","JFHNGL","vq6MSq","-i3PJS","9I0t-6","jb_4W2","Q7TAd7","O8LbtK","6nM-E7","V08PS7","0DsHEV","pLbCP4","c_rvp5","LFeTN6","OnmvvE","RXx5aI","5X2em-"]]);