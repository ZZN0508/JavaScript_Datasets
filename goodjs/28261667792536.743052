!function(){var n,e,s,r,a,h,t,o,d,g,v,l,u,c,p,f,E,m,A,y,S,D,T,I,C,b,R,P,M,O,L,N,k,U,B,w,j,F,G,V,x,H,K,Y,W,z,X,J,Q,Z;function $(t){return(0<t&&t<10?"0":"")+t.toString()}(function(){function d(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function D(t,e){for(var i=-1,s=null==t?0:t.length;++i<s&&!1!==e(t[i],i,t););return t}function s(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(!e(t[i],i,t))return!1;return!0}function i(t,e){for(var i=-1,s=null==t?0:t.length,n=0,r=[];++i<s;){var a=t[i];e(a,i,t)&&(r[n++]=a)}return r}function T(t,e){return!(null==t||!t.length)&&-1<h(t,e,0)}function p(t,e,i){for(var s=-1,n=null==t?0:t.length;++s<n;)if(i(e,t[s]))return!0;return!1}function g(t,e){for(var i=-1,s=null==t?0:t.length,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n}function v(t,e){for(var i=-1,s=e.length,n=t.length;++i<s;)t[n+i]=e[i];return t}function f(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(e(t[i],i,t))return!0;return!1}function n(t,e,i,s){for(var n=t.length,r=i+(s?1:-1);s?r--:++r<n;)if(e(t[r],r,t))return r;return-1}function h(t,e,i){return e==e?function(t,e,i){for(var s=i-1,n=t.length;++s<n;)if(t[s]===e)return s;return-1}(t,e,i):n(t,r,i)}function c(t,e,i,s){for(var n=i-1,r=t.length;++n<r;)if(s(t[n],e))return n;return-1}function r(t){return t!=t}function a(e){return function(t){return null==t?be:t[e]}}function _(e){return function(t){return e(t)}}function E(e,t){return g(t,function(t){return e[t]})}function m(t,e){return t.has(e)}function A(t){return"\\"+ps[t]}function o(t){return ds.test(t)}function y(t){var i=-1,s=Array(t.size);return t.forEach(function(t,e){s[++i]=[e,t]}),s}function t(e,i){return function(t){return e(i(t))}}function S(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function l(t){return(o(t)?function(t){for(var e=os.lastIndex=0;os.test(t);)++e;return e}:_s)(t)}function u(t){return o(t)?t.match(os)||[]:t.split("")}function I(t){if(se(t)&&!bn(t)&&!(t instanceof R)){if(t instanceof b)return t;if(Ss.call(t,"__wrapped__"))return jt(t)}return new b(t)}function C(){}function b(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=be}function R(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=We,this.__views__=[]}function e(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function P(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function M(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function O(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new M;++e<i;)this.add(t[e])}function L(t){t=this.__data__=new P(t);this.size=t.size}function N(t,e){var i,s=bn(t),n=!s&&Cn(t),r=!s&&!n&&Rn(t),a=!s&&!n&&!r&&On(t),o=s||n||r||a,d=o?function(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}(t.length,String):[],l=d.length;for(i in t)!e&&!Ss.call(t,i)||o&&("length"==i||r&&("offset"==i||"parent"==i)||a&&("buffer"==i||"byteLength"==i||"byteOffset"==i)||Rt(i,l))||d.push(i);return d}function k(t,e,i){var s=t[e];Ss.call(t,e)&&Jt(s,i)&&(i!==be||e in t)||B(t,e,i)}function U(t,e){for(var i=t.length;i--;)if(Jt(t[i][0],e))return i;return-1}function B(t,e,i){"__proto__"==e&&ws?ws(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function w(t,e,i){return t==t&&(i!==be&&(t=t<=i?t:i),e!==be&&(t=e<=t?t:e)),t}function j(i,s,n,t,e,r){var a,o=s&Oe,d=s&Le,l=s&Ne;if((a=n?e?n(i,t,e,r):n(i):a)!==be)return a;if(!ie(i))return i;var u,h,c,p=bn(i);if(p){if(t=(g=i).length,v=new g.constructor(t),t&&"string"==typeof g[0]&&Ss.call(g,"index")&&(v.index=g.index,v.input=g.input),a=v,!o)return gt(i,a)}else{var g=gn(i),v=g==ti||g==ei;if(Rn(i))return function(t,e){if(e)return t.slice();e=t.length,e=Ps?Ps(e):new t.constructor(e);return t.copy(e),e}(i,o);if(g==ri||g==qe||v&&!e){if(a=d||v?{}:"function"!=typeof(v=i).constructor||Ot(v)?{}:nn(Ms(v)),!o)return d?(c=u=i,c=(h=a)&&vt(c,fe(c),h),vt(u,pn(u),c)):(u=h=i,c=(c=a)&&vt(u,ve(u),c),vt(h,cn(h),c))}else{if(!hs[g])return e?i:{};a=function(t,e,i){var s=t.constructor;switch(e){case gi:return pt(t);case Qe:case Ze:return new s(+t);case vi:return function(t,e){e=e?pt(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)}(t,i);case fi:case _i:case Ei:case mi:case Ai:case yi:case Si:case Di:case Ti:return function(t,e){e=e?pt(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)}(t,i);case ii:return new s;case si:case ui:return new s(t);case di:return function(t){var e=new t.constructor(t.source,Gi.exec(t));return e.lastIndex=t.lastIndex,e}(t);case li:return new s;case hi:return function(t){return en?Object(en.call(t)):{}}(t)}}(i,g,o)}}o=(r=r||new L).get(i);if(o)return o;if(r.set(i,a),Mn(i))return i.forEach(function(t){a.add(j(t,s,n,t,i,r))}),a;if(Pn(i))return i.forEach(function(t,e){a.set(e,j(t,s,n,e,i,r))}),a;var f=p?be:(l?d?St:yt:d?fe:ve)(i);return D(f||i,function(t,e){f&&(t=i[e=t]),k(a,e,j(t,s,n,e,i,r))}),a}function F(t,s){var n=!0;return ln(t,function(t,e,i){return n=!!s(t,e,i)}),n}function G(t,e,i,s,n){var r=-1,a=t.length;for(i=i||bt,n=n||[];++r<a;){var o=t[r];0<e&&i(o)?1<e?G(o,e-1,i,s,n):v(n,o):s||(n[n.length]=o)}return n}function V(t,e){return t&&un(t,e,ve)}function x(e,t){return i(t,function(t){return te(e[t])})}function H(t,e){for(var i=0,s=(e=ht(e,t)).length;null!=t&&i<s;)t=t[Bt(e[i++])];return i&&i==s?t:be}function K(t,e,i){e=e(t);return bn(t)?e:v(e,i(t))}function Y(t){return null==t?t===be?ci:ni:Bs&&Bs in Object(t)?function(t){var e=Ss.call(t,Bs),i=t[Bs];try{t[Bs]=be;var s=!0}catch(t){}var n=Ts.call(t);return s&&(e?t[Bs]=i:delete t[Bs]),n}(t):Ts.call(t)}function W(t,e){return null!=t&&Ss.call(t,e)}function z(t,e){return null!=t&&e in Object(t)}function q(t,e,i){var s,n;e=ht(e,t),s=t;e=null==(t=(n=e).length<2?s:H(s,ot(n,0,-1)))?t:t[Bt(Vt(e))];return null==e?be:d(e,t,i)}function X(t){return se(t)&&Y(t)==qe}function J(t,e,i,s,n){return t===e||(null==t||null==e||!se(t)&&!se(e)?t!=t&&e!=e:function(t,e,i,s,n,r){var a=bn(t),o=bn(e),d=a?Xe:gn(t),l=o?Xe:gn(e),u=(d=d==qe?ri:d)==ri,o=(l=l==qe?ri:l)==ri,l=d==l;if(l&&Rn(t)){if(!Rn(e))return!1;u=!(a=!0)}if(l&&!u)return r=r||new L,a||On(t)?At(t,e,i,s,n,r):function(t,e,i,s,n,r,a){switch(i){case vi:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case gi:return!(t.byteLength!=e.byteLength||!r(new Rs(t),new Rs(e)));case Qe:case Ze:case si:return Jt(+t,+e);case $e:return t.name==e.name&&t.message==e.message;case di:case ui:return t==e+"";case ii:var o=y;case li:var d=s&ke;if(o=o||S,t.size!=e.size&&!d)return!1;d=a.get(t);if(d)return d==e;s|=Ue,a.set(t,e);o=At(o(t),o(e),s,n,r,a);return a.delete(t),o;case hi:if(en)return en.call(t)==en.call(e)}return!1}(t,e,d,i,s,n,r);if(!(i&ke)){u=u&&Ss.call(t,"__wrapped__"),o=o&&Ss.call(e,"__wrapped__");if(u||o){u=u?t.value():t,o=o?e.value():e;return r=r||new L,n(u,o,i,s,r)}}return!!l&&(r=r||new L,function(t,e,i,s,n,r){var a=i&ke,o=yt(t),d=o.length;if(d!=yt(e).length&&!a)return!1;for(var l=d;l--;){var u=o[l];if(!(a?u in e:Ss.call(e,u)))return!1}var h=r.get(t);if(h&&r.get(e))return h==e;var c=!0;r.set(t,e),r.set(e,t);for(var p=a;++l<d;){u=o[l];var g,v=t[u],f=e[u];if(!((g=s?a?s(f,v,u,e,t,r):s(v,f,u,t,e,r):g)===be?v===f||n(v,f,i,s,r):g)){c=!1;break}p=p||"constructor"==u}{var _;c&&!p&&(_=t.constructor,h=e.constructor,_!=h&&"constructor"in t&&"constructor"in e&&!("function"==typeof _&&_ instanceof _&&"function"==typeof h&&h instanceof h)&&(c=!1))}return r.delete(t),r.delete(e),c}(t,e,i,s,n,r))}(t,e,i,s,J,n))}function Q(t){return ie(t)&&(e=t,!(Ds&&Ds in e))&&(te(t)?bs:Hi).test(wt(t));var e}function Z(t){return"function"==typeof t?t:null==t?Ae:"object"==typeof t?bn(t)?(s=t[0],n=t[1],Mt(s)&&Lt(n)?Nt(Bt(s),n):function(t){var e=pe(t,s);return e===be&&e===n?ge(t,s):J(n,e,ke|Ue)}):1==(i=function(t){for(var e=ve(t),i=e.length;i--;){var s=e[i],n=t[s];e[i]=[s,n,Lt(n)]}return e}(e=t)).length&&i[0][2]?Nt(i[0][0],i[0][1]):function(t){return t===e||function(t,e,i,s){var n=i.length,r=n,a=!s;if(null==t)return!r;for(t=Object(t);n--;){var o=i[n];if(a&&o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++n<r;){var d=(o=i[n])[0],l=t[d],u=o[1];if(a&&o[2]){if(l===be&&!(d in t))return!1}else{var h,c=new L;if(!((h=s?s(l,u,d,t,e,c):h)===be?J(u,l,ke|Ue,s,c):h))return!1}}return!0}(t,e,i)}:Te(t);var e,i,s,n}function $(t){if(!Ot(t))return Vs(t);var e,i=[];for(e in Object(t))Ss.call(t,e)&&"constructor"!=e&&i.push(e);return i}function tt(t){if(!ie(t))return function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}(t);var e,i=Ot(t),s=[];for(e in t)("constructor"!=e||!i&&Ss.call(t,e))&&s.push(e);return s}function et(t,e){return t<e}function it(t,s){var n=-1,r=Qt(t)?Array(t.length):[];return ln(t,function(t,e,i){r[++n]=s(t,e,i)}),r}function st(t,s,i){var n=-1;return s=g(s.length?s:[Ae],_(Dt())),function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(it(t,function(e,t,i){return{criteria:g(s,function(t){return t(e)}),index:++n,value:e}}),function(t,e){return function(t,e,i){for(var s=-1,n=t.criteria,r=e.criteria,a=n.length,o=i.length;++s<a;){var d=function(t,e){if(t!==e){var i=t!==be,s=null===t,n=t==t,r=oe(t),a=e!==be,o=null===e,d=e==e,l=oe(e);if(!o&&!l&&!r&&e<t||r&&a&&d&&!o&&!l||s&&a&&d||!i&&d||!n)return 1;if(!s&&!r&&!l&&t<e||l&&i&&n&&!s&&!r||o&&i&&n||!a&&n||!d)return-1}return 0}(n[s],r[s]);if(d)return o<=s?d:d*("desc"==i[s]?-1:1)}return t.index-e.index}(t,e,i)})}function nt(t,e,i){for(var s=-1,n=e.length,r={};++s<n;){var a=e[s],o=H(t,a);i(o,a)&&function(t,e,i,s){if(!ie(t))return;e=ht(e,t);for(var n=-1,r=e.length,a=r-1,o=t;null!=o&&++n<r;){var d,l=Bt(e[n]),u=i;n!=a&&(d=o[l],(u=s?s(d,l,o):be)===be&&(u=ie(d)?d:Rt(e[n+1])?[]:{})),k(o,l,u),o=o[l]}}(r,ht(a,t),o)}return r}function rt(t,e){var i="";if(!t||e<1||He<e)return i;for(;e%2&&(i+=t),(e=Fs(e/2))&&(t+=t),e;);return i}function at(t,e){return yn(kt(t,e,Ae),t+"")}function ot(t,e,i){var s=-1,n=t.length;(i=n<i?n:i)<0&&(i+=n),n=i<(e=e<0?n<-e?0:n+e:e)?0:i-e>>>0,e>>>=0;for(var r=Array(n);++s<n;)r[s]=t[s+e];return r}function dt(t,s){var n;return ln(t,function(t,e,i){return!(n=s(t,e,i))}),!!n}function lt(t){if("string"==typeof t)return t;if(bn(t))return g(t,lt)+"";if(oe(t))return sn?sn.call(t):"";var e=t+"";return"0"==e&&1/t==-xe?"-0":e}function ut(t,e){var i=t;return function(t,e,i,s){var n=-1,r=null==t?0:t.length;for(s&&r&&(i=t[++n]);++n<r;)i=e(i,t[n],n,t);return i}(e,function(t,e){return e.func.apply(e.thisArg,v([t],e.args))},i=t instanceof R?t.value():i)}function ht(t,e){return bn(t)?t:Mt(t,e)?[t]:Sn(ce(t))}function ct(t,e,i){var s=t.length;return i=i===be?s:i,!e&&s<=i?t:ot(t,e,i)}function pt(t){var e=new t.constructor(t.byteLength);return new Rs(e).set(new Rs(t)),e}function gt(t,e){var i=-1,s=t.length;for(e=e||Array(s);++i<s;)e[i]=t[i];return e}function vt(t,e,i,s){var n=!i;i=i||{};for(var r=-1,a=e.length;++r<a;){var o=e[r],d=s?s(i[o],t[o],o,i,t):be;(n?B:k)(i,o,d=d===be?t[o]:d)}return i}function ft(o){return at(function(t,e){var i=-1,s=e.length,n=1<s?e[s-1]:be,r=2<s?e[2]:be,n=3<o.length&&"function"==typeof n?(s--,n):be;for(r&&Pt(e[0],e[1],r)&&(n=s<3?be:n,s=1),t=Object(t);++i<s;){var a=e[i];a&&o(t,a,i,n)}return t})}function _t(s){return function(){var t=arguments;switch(t.length){case 0:return new s;case 1:return new s(t[0]);case 2:return new s(t[0],t[1]);case 3:return new s(t[0],t[1],t[2]);case 4:return new s(t[0],t[1],t[2],t[3]);case 5:return new s(t[0],t[1],t[2],t[3],t[4]);case 6:return new s(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new s(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var e=nn(s.prototype),i=s.apply(e,t);return ie(i)?i:e}}function Et(o,d,l,u,h,c,p,g,v,f){var _=128&d,E=d&Be,m=d&we,A=d&(16|Fe),y=512&d,S=m?be:_t(o);return function t(){for(var e,i=arguments.length,s=Array(i),n=i;n--;)s[n]=arguments[n];if(A&&(e=t,e=function(t,e){for(var i=t.length,s=0;i--;)t[i]===e&&++s;return s}(s,a=(Ss.call(I,"placeholder")?I:e).placeholder)),u&&(s=function(t,e,i,s){for(var n=-1,r=t.length,a=i.length,o=-1,d=e.length,l=xs(r-a,0),u=Array(d+l),h=!s;++o<d;)u[o]=e[o];for(;++n<a;)(h||n<r)&&(u[i[n]]=t[n]);for(;l--;)u[o++]=t[n++];return u}(s,u,h,A)),c&&(s=function(t,e,i,s){for(var n=-1,r=t.length,a=-1,o=i.length,d=-1,l=e.length,u=xs(r-o,0),h=Array(u+l),c=!s;++n<u;)h[n]=t[n];for(var p=n;++d<l;)h[p+d]=e[d];for(;++a<o;)(c||n<r)&&(h[p+i[a]]=t[n++]);return h}(s,c,p,A)),i-=e,A&&i<f){var r=function(t,e){for(var i=-1,s=t.length,n=0,r=[];++i<s;){var a=t[i];a!==e&&a!==Me||(t[i]=Me,r[n++]=i)}return r}(s,a);return function(t,e,i,s,n,r,a,o,d,l){var u=e&Fe;return e|=u?Ge:Ve,(e&=~(u?Ve:Ge))&je||(e&=~(Be|we)),l=[t,e,n,u?r:be,u?a:be,u?be:r,u?be:a,o,d,l],i=i.apply(be,l),function(t){var e=function(t){for(var e=t.name+"",i=Xs[e],s=Ss.call(Xs,e)?i.length:0;s--;){var n=i[s],r=n.func;if(null==r||r==t)return n.name}return e}(t),i=I[e];return"function"==typeof i&&e in R.prototype&&(t===i||(i=hn(i))&&t===i[0])}(t)&&An(i,l),i.placeholder=s,function(t,e,i){return yn(t,function(t,e){var i=e.length;if(!i)return t;var s=i-1;return e[s]=(1<i?"& ":"")+e[s],e=e.join(2<i?", ":" "),t.replace(Ui,"{\n/* [wrapped with "+e+"] */\n")}(e+="",function(i,s){return D(ze,function(t){var e="_."+t[0];s&t[1]&&!T(i,e)&&i.push(e)}),i.sort()}(function(t){return(t=t.match(Bi))?t[1].split(wi):[]}(e),i)))}(i,t,e)}(o,d,Et,t.placeholder,l,s,r,g,v,f-i)}var a=E?l:this,r=m?a[o]:o,i=s.length;return g?s=function(t,e){for(var i=t.length,s=Hs(e.length,i),n=gt(t);s--;){var r=e[s];t[s]=Rt(r,i)?n[r]:be}return t}(s,g):y&&1<i&&s.reverse(),_&&v<i&&(s.length=v),(r=this&&this!==vs&&this instanceof t?S||_t(r):r).apply(a,s)}}function mt(t,e,i,s){return t===be||Jt(t,As[i])&&!Ss.call(s,i)?e:t}function At(t,e,i,s,n,r){var a=i&ke,o=t.length,d=e.length;if(o!=d&&!(a&&o<d))return!1;d=r.get(t);if(d&&r.get(e))return d==e;var l=-1,u=!0,h=i&Ue?new O:be;for(r.set(t,e),r.set(e,t);++l<o;){var c,p=t[l],g=e[l];if((c=s?a?s(g,p,l,e,t,r):s(p,g,l,t,e,r):c)!==be){if(c)continue;u=!1;break}if(h){if(!f(e,function(t,e){return!m(h,e)&&(p===t||n(p,t,i,s,r))&&h.push(e)})){u=!1;break}}else if(p!==g&&!n(p,g,i,s,r)){u=!1;break}}return r.delete(t),r.delete(e),u}function yt(t){return K(t,ve,cn)}function St(t){return K(t,fe,pn)}function Dt(t,e){var i=(i=I.iteratee||ye)===ye?Z:i;return arguments.length?i(t,e):i}function Tt(t,e){var i,s=t.__data__;return("string"==(t=typeof(i=e))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==i:null===i)?s["string"==typeof e?"string":"hash"]:s.map}function It(t,e){e=e,e=null==(t=t)?be:t[e];return Q(e)?e:be}function Ct(t,e,i){for(var s=-1,n=(e=ht(e,t)).length,r=!1;++s<n;){var a=Bt(e[s]);if(!(r=null!=t&&i(t,a)))break;t=t[a]}return r||++s!=n?r:!!(n=null==t?0:t.length)&&ee(n)&&Rt(a,n)&&(bn(t)||Cn(t))}function bt(t){return bn(t)||Cn(t)||!!(ks&&t&&t[ks])}function Rt(t,e){var i=typeof t;return!!(e=null==e?He:e)&&("number"==i||"symbol"!=i&&Yi.test(t))&&-1<t&&t%1==0&&t<e}function Pt(t,e,i){if(ie(i)){var s=typeof e;return("number"==s?Qt(i)&&Rt(e,i.length):"string"==s&&e in i)&&Jt(i[e],t)}}function Mt(t,e){if(!bn(t)){var i=typeof t;return"number"==i||"symbol"==i||"boolean"==i||null==t||oe(t)||Li.test(t)||!Oi.test(t)||null!=e&&t in Object(e)}}function Ot(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||As)}function Lt(t){return t==t&&!ie(t)}function Nt(e,i){return function(t){return null!=t&&t[e]===i&&(i!==be||e in Object(t))}}function kt(r,a,o){return a=xs(a===be?r.length-1:a,0),function(){for(var t=arguments,e=-1,i=xs(t.length-a,0),s=Array(i);++e<i;)s[e]=t[a+e];for(var e=-1,n=Array(a+1);++e<a;)n[e]=t[e];return n[a]=o(s),d(r,this,n)}}function Ut(i){var s=0,n=0;return function(){var t=Ks(),e=16-(t-n);if(n=t,0<e){if(800<=++s)return arguments[0]}else s=0;return i.apply(be,arguments)}}function Bt(t){if("string"==typeof t||oe(t))return t;var e=t+"";return"0"==e&&1/t==-xe?"-0":e}function wt(t){if(null!=t){try{return ys.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function jt(t){if(t instanceof R)return t.clone();var e=new b(t.__wrapped__,t.__chain__);return e.__actions__=gt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Ft(t,e,i){var s=null==t?0:t.length;if(!s)return-1;i=null==i?0:ue(i);return i<0&&(i=xs(s+i,0)),n(t,Dt(e,3),i)}function Gt(t){return null!=t&&t.length?G(t,1):[]}function Vt(t){var e=null==t?0:t.length;return e?t[e-1]:be}function xt(t,e){return t&&t.length&&e&&e.length?function(t,e,i,s){var n=s?c:h,r=-1,a=e.length,o=t;for(t===e&&(e=gt(e)),i&&(o=g(t,_(i)));++r<a;)for(var d=0,l=e[r],u=i?i(l):l;-1<(d=n(o,u,d,s));)o!==t&&Ns.call(o,d,1),Ns.call(t,d,1);return t}(t,e):t}function Ht(t){return null==t?t:Ys.call(t)}function Kt(t){t=I(t);return t.__chain__=!0,t}function Yt(t,e){return e(t)}function Wt(t,e){return(bn(t)?D:ln)(t,Dt(e,3))}function zt(s,i,t){function n(t){var e=d,i=l;return d=l=be,g=t,h=s.apply(i,e)}function r(t){var e=t-p;return p===be||i<=e||e<0||f&&u<=t-g}function a(){var t,e=vn();if(r(e))return o(e);c=setTimeout(a,(e=i-((t=e)-p),f?Hs(e,u-(t-g)):e))}function o(t){return c=be,_&&d?n(t):(d=l=be,h)}function e(){var t=vn(),e=r(t);if(d=arguments,l=this,p=t,e){if(c===be)return g=e=p,c=setTimeout(a,i),v?n(e):h;if(f)return c=setTimeout(a,i),n(p)}return c===be&&(c=setTimeout(a,i)),h}var d,l,u,h,c,p,g=0,v=!1,f=!1,_=!0;if("function"!=typeof s)throw new TypeError(Re);return i=he(i)||0,ie(t)&&(v=!!t.leading,f="maxWait"in t,u=f?xs(he(t.maxWait)||0,i):u,_="trailing"in t?!!t.trailing:_),e.cancel=function(){c!==be&&clearTimeout(c),g=0,d=p=l=c=be},e.flush=function(){return c===be?h:o(vn())},e}function qt(s,n){if("function"!=typeof s||null!=n&&"function"!=typeof n)throw new TypeError(Re);function r(){var t=arguments,e=n?n.apply(this,t):t[0],i=r.cache;return i.has(e)?i.get(e):(t=s.apply(this,t),r.cache=i.set(e,t)||i,t)}return r.cache=new(qt.Cache||M),r}function Xt(e){if("function"!=typeof e)throw new TypeError(Re);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Jt(t,e){return t===e||t!=t&&e!=e}function Qt(t){return null!=t&&ee(t.length)&&!te(t)}function Zt(t){return se(t)&&Qt(t)}function $t(t){if(!se(t))return!1;var e=Y(t);return e==$e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!re(t)}function te(t){if(!ie(t))return!1;t=Y(t);return t==ti||t==ei||t==Je||t==oi}function ee(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=He}function ie(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function se(t){return null!=t&&"object"==typeof t}function ne(t){return"number"==typeof t||se(t)&&Y(t)==si}function re(t){if(!se(t)||Y(t)!=ri)return!1;t=Ms(t);if(null===t)return!0;t=Ss.call(t,"constructor")&&t.constructor;return"function"==typeof t&&t instanceof t&&ys.call(t)==Is}function ae(t){return"string"==typeof t||!bn(t)&&se(t)&&Y(t)==ui}function oe(t){return"symbol"==typeof t||se(t)&&Y(t)==hi}function de(t){if(!t)return[];if(Qt(t))return(ae(t)?u:gt)(t);if(Us&&t[Us])return function(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}(t[Us]());var e=gn(t);return(e==ii?y:e==li?S:Ee)(t)}function le(t){return t?(t=he(t))===xe||t===-xe?(t<0?-1:1)*Ke:t==t?t:0:0===t?t:0}function ue(t){var e=le(t),t=e%1;return e==e?t?e-t:e:0}function he(t){if("number"==typeof t)return t;if(oe(t))return Ye;if("string"!=typeof(t=ie(t)?ie(e="function"==typeof t.valueOf?t.valueOf():t)?e+"":e:t))return 0===t?t:+t;t=t.replace(ki,"");var e=xi.test(t);return e||Ki.test(t)?gs(t.slice(2),e?2:8):Vi.test(t)?Ye:+t}function ce(t){return null==t?"":lt(t)}function pe(t,e,i){e=null==t?be:H(t,e);return e===be?i:e}function ge(t,e){return null!=t&&Ct(t,e,z)}function ve(t){return(Qt(t)?N:$)(t)}function fe(t){return Qt(t)?N(t,!0):tt(t)}function _e(t,i){if(null==t)return{};var e=g(St(t),function(t){return[t]});return i=Dt(i),nt(t,e,function(t,e){return i(t,e[0])})}function Ee(t){return null==t?[]:E(t,ve(t))}function me(t){return function(){return t}}function Ae(t){return t}function ye(t){return Z("function"==typeof t?t:j(t,Oe))}function Se(s,e,t){var i=ve(e),n=x(e,i);null!=t||ie(e)&&(n.length||!i.length)||(t=e,e=s,s=this,n=x(e,ve(e)));var r=!(ie(t)&&"chain"in t&&!t.chain),a=te(s);return D(n,function(t){var i=e[t];s[t]=i,a&&(s.prototype[t]=function(){var t=this.__chain__;if(r||t){var e=s(this.__wrapped__);return(e.__actions__=gt(this.__actions__)).push({func:i,args:arguments,thisArg:s}),e.__chain__=t,e}return i.apply(s,v([this.value()],arguments))})}),s}function De(){}function Te(t){return Mt(t)?a(Bt(t)):(e=t,function(t){return H(t,e)});var e}function Ie(){return[]}function Ce(){return!1}var be,Re="Expected a function",Pe="__lodash_hash_undefined__",Me="__lodash_placeholder__",Oe=1,Le=2,Ne=4,ke=1,Ue=2,Be=1,we=2,je=4,Fe=8,Ge=32,Ve=64,xe=1/0,He=9007199254740991,Ke=17976931348623157e292,Ye=NaN,We=4294967295,ze=[["ary",128],["bind",Be],["bindKey",we],["curry",Fe],["curryRight",16],["flip",512],["partial",Ge],["partialRight",Ve],["rearg",256]],qe="[object Arguments]",Xe="[object Array]",Je="[object AsyncFunction]",Qe="[object Boolean]",Ze="[object Date]",$e="[object Error]",ti="[object Function]",ei="[object GeneratorFunction]",ii="[object Map]",si="[object Number]",ni="[object Null]",ri="[object Object]",ai="[object Promise]",oi="[object Proxy]",di="[object RegExp]",li="[object Set]",ui="[object String]",hi="[object Symbol]",ci="[object Undefined]",pi="[object WeakMap]",gi="[object ArrayBuffer]",vi="[object DataView]",fi="[object Float32Array]",_i="[object Float64Array]",Ei="[object Int8Array]",mi="[object Int16Array]",Ai="[object Int32Array]",yi="[object Uint8Array]",Si="[object Uint8ClampedArray]",Di="[object Uint16Array]",Ti="[object Uint32Array]",Ii=/\b__p \+= '';/g,Ci=/\b(__p \+=) '' \+/g,bi=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ri=/[&<>"']/g,Pi=RegExp(Ri.source),Mi=/<%=([\s\S]+?)%>/g,Oi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Li=/^\w*$/,Ni=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ki=/^\s+|\s+$/g,Ui=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Bi=/\{\n\/\* \[wrapped with (.+)\] \*/,wi=/,? & /,ji=/\\(\\)?/g,Fi=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Gi=/\w*$/,Vi=/^[-+]0x[0-9a-f]+$/i,xi=/^0b[01]+$/i,Hi=/^\[object .+?Constructor\]$/,Ki=/^0o[0-7]+$/i,Yi=/^(?:0|[1-9]\d*)$/,Wi=/($^)/,zi=/['\n\r\u2028\u2029\\]/g,qi="\\ud800-\\udfff",Xi="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ji="\\ufe0e\\ufe0f",Qi="["+qi+"]",Zi="["+Xi+"]",$i="\\ud83c[\\udffb-\\udfff]",ts="[^"+qi+"]",es="(?:\\ud83c[\\udde6-\\uddff]){2}",is="[\\ud800-\\udbff][\\udc00-\\udfff]",ss="\\u200d",ns="(?:"+Zi+"|"+$i+")"+"?",rs="["+Ji+"]?",as=rs+ns+("(?:"+ss+"(?:"+[ts,es,is].join("|")+")"+rs+ns+")*"),rs="(?:"+[ts+Zi+"?",Zi,es,is,Qi].join("|")+")",os=RegExp($i+"(?="+$i+")|"+rs+as,"g"),ds=RegExp("["+ss+qi+Xi+Ji+"]"),ls=-1,us={};us[fi]=us[_i]=us[Ei]=us[mi]=us[Ai]=us[yi]=us[Si]=us[Di]=us[Ti]=!0,us[qe]=us[Xe]=us[gi]=us[Qe]=us[vi]=us[Ze]=us[$e]=us[ti]=us[ii]=us[si]=us[ri]=us[di]=us[li]=us[ui]=us[pi]=!1;var hs={};hs[qe]=hs[Xe]=hs[gi]=hs[vi]=hs[Qe]=hs[Ze]=hs[fi]=hs[_i]=hs[Ei]=hs[mi]=hs[Ai]=hs[ii]=hs[si]=hs[ri]=hs[di]=hs[li]=hs[ui]=hs[hi]=hs[yi]=hs[Si]=hs[Di]=hs[Ti]=!0,hs[$e]=hs[ti]=hs[pi]=!1;var cs,ps={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},gs=parseInt,ns="object"==typeof global&&global&&global.Object===Object&&global,ts="object"==typeof self&&self&&self.Object===Object&&self,vs=ns||ts||Function("return this")(),Zi="object"==typeof exports&&exports&&!exports.nodeType&&exports,es=Zi&&"object"==typeof module&&module&&!module.nodeType&&module,is=es&&es.exports===Zi,fs=is&&ns.process,Qi=function(){try{return fs&&fs.binding&&fs.binding("util")}catch(t){}}(),$i=Qi&&Qi.isDate,rs=Qi&&Qi.isMap,as=Qi&&Qi.isSet,ss=Qi&&Qi.isTypedArray,_s=a("length"),Es=(cs={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(t){return null==cs?be:cs[t]}),ms=Array.prototype,qi=Function.prototype,As=Object.prototype,Xi=vs["__core-js_shared__"],ys=qi.toString,Ss=As.hasOwnProperty,Ds=(Ji=/[^.]+$/.exec(Xi&&Xi.keys&&Xi.keys.IE_PROTO||""))?"Symbol(src)_1."+Ji:"",Ts=As.toString,Is=ys.call(Object),Cs=vs._,bs=RegExp("^"+ys.call(Ss).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ts=is?vs.Buffer:be,ns=vs.Symbol,Rs=vs.Uint8Array,Ps=ts?ts.allocUnsafe:be,Ms=t(Object.getPrototypeOf,Object),Os=Object.create,Ls=As.propertyIsEnumerable,Ns=ms.splice,ks=ns?ns.isConcatSpreadable:be,Us=ns?ns.iterator:be,Bs=ns?ns.toStringTag:be,ws=function(){try{var t=It(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),js=Math.ceil,Fs=Math.floor,Gs=Object.getOwnPropertySymbols,Qi=ts?ts.isBuffer:be,Vs=t(Object.keys,Object),xs=Math.max,Hs=Math.min,Ks=Date.now,Ys=ms.reverse,qi=It(vs,"DataView"),Ws=It(vs,"Map"),Xi=It(vs,"Promise"),Ji=It(vs,"Set"),is=It(vs,"WeakMap"),zs=It(Object,"create"),qs=is&&new is,Xs={},Js=wt(qi),Qs=wt(Ws),Zs=wt(Xi),$s=wt(Ji),tn=wt(is),ts=ns?ns.prototype:be,en=ts?ts.valueOf:be,sn=ts?ts.toString:be,nn=function(t){if(!ie(t))return{};if(Os)return Os(t);rn.prototype=t;t=new rn;return rn.prototype=be,t};function rn(){}I.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:Mi,variable:"",imports:{_:I}},(I.prototype=C.prototype).constructor=I,(b.prototype=nn(C.prototype)).constructor=b,(R.prototype=nn(C.prototype)).constructor=R,e.prototype.clear=function(){this.__data__=zs?zs(null):{},this.size=0},e.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},e.prototype.get=function(t){var e=this.__data__;if(zs){var i=e[t];return i===Pe?be:i}return Ss.call(e,t)?e[t]:be},e.prototype.has=function(t){var e=this.__data__;return zs?e[t]!==be:Ss.call(e,t)},e.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=zs&&e===be?Pe:e,this},P.prototype.clear=function(){this.__data__=[],this.size=0},P.prototype.delete=function(t){var e=this.__data__;return!((t=U(e,t))<0||(t==e.length-1?e.pop():Ns.call(e,t,1),--this.size,0))},P.prototype.get=function(t){var e=this.__data__;return(t=U(e,t))<0?be:e[t][1]},P.prototype.has=function(t){return-1<U(this.__data__,t)},P.prototype.set=function(t,e){var i=this.__data__,s=U(i,t);return s<0?(++this.size,i.push([t,e])):i[s][1]=e,this},M.prototype.clear=function(){this.size=0,this.__data__={hash:new e,map:new(Ws||P),string:new e}},M.prototype.delete=function(t){return t=Tt(this,t).delete(t),this.size-=t?1:0,t},M.prototype.get=function(t){return Tt(this,t).get(t)},M.prototype.has=function(t){return Tt(this,t).has(t)},M.prototype.set=function(t,e){var i=Tt(this,t),s=i.size;return i.set(t,e),this.size+=i.size==s?0:1,this},O.prototype.add=O.prototype.push=function(t){return this.__data__.set(t,Pe),this},O.prototype.has=function(t){return this.__data__.has(t)},L.prototype.clear=function(){this.__data__=new P,this.size=0},L.prototype.delete=function(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t},L.prototype.get=function(t){return this.__data__.get(t)},L.prototype.has=function(t){return this.__data__.has(t)},L.prototype.set=function(t,e){var i=this.__data__;if(i instanceof P){var s=i.__data__;if(!Ws||s.length<199)return s.push([t,e]),this.size=++i.size,this;i=this.__data__=new M(s)}return i.set(t,e),this.size=i.size,this};var an,on,dn,ln=(on=V,function(t,e){if(null==t)return t;if(!Qt(t))return on(t,e);for(var i=t.length,s=dn?i:-1,n=Object(t);(dn?s--:++s<i)&&!1!==e(n[s],s,n););return t}),un=function(t,e,i){for(var s=-1,n=Object(t),r=i(t),a=r.length;a--;){var o=r[an?a:++s];if(!1===e(n[o],o,n))break}return t},ns=qs?function(t,e){return qs.set(t,e),t}:Ae,ts=ws?function(t,e){return ws(t,"toString",{configurable:!0,enumerable:!1,value:me(e),writable:!0})}:Ae,hn=qs?function(t){return qs.get(t)}:De,cn=Gs?function(e){return null==e?[]:(e=Object(e),i(Gs(e),function(t){return Ls.call(e,t)}))}:Ie,pn=Gs?function(t){for(var e=[];t;)v(e,cn(t)),t=Ms(t);return e}:Ie,gn=Y;(qi&&gn(new qi(new ArrayBuffer(1)))!=vi||Ws&&gn(new Ws)!=ii||Xi&&gn(Xi.resolve())!=ai||Ji&&gn(new Ji)!=li||is&&gn(new is)!=pi)&&(gn=function(t){var e=Y(t),t=e==ri?t.constructor:be,t=t?wt(t):"";if(t)switch(t){case Js:return vi;case Qs:return ii;case Zs:return ai;case $s:return li;case tn:return pi}return e});function vn(){return vs.Date.now()}var fn,_n,En,mn,An=Ut(ns),yn=Ut(ts),Sn=(mn=(En=qt(En=function(t){var n=[];return 46===t.charCodeAt(0)&&n.push(""),t.replace(Ni,function(t,e,i,s){n.push(i?s.replace(ji,"$1"):e||t)}),n},function(t){return 500===mn.size&&mn.clear(),t})).cache,En),Ji=at(xt),is=at(function(t,e){return Zt(t)?function(t,e,i,s){var n=-1,r=T,a=!0,o=t.length,d=[],l=e.length;if(!o)return d;i&&(e=g(e,_(i))),s?(r=p,a=!1):200<=e.length&&(r=m,a=!1,e=new O(e));t:for(;++n<o;){var u=t[n],h=null==i?u:i(u),u=s||0!==u?u:0;if(a&&h==h){for(var c=l;c--;)if(e[c]===h)continue t;d.push(u)}else r(e,h,s)||d.push(u)}return d}(t,e):[]}),ns=(yn(kt(_n=function(e){function t(t){return function(t,e){for(var i=-1,s=e.length,n=Array(s),r=null==t;++i<s;)n[i]=r?be:pe(t,e[i]);return n}(t,e)}var i=e.length,s=i?e[0]:0,n=this.__wrapped__;return!(1<i||this.__actions__.length)&&n instanceof R&&Rt(s)?((n=n.slice(s,+s+(i?1:0))).__actions__.push({func:Yt,args:[t],thisArg:be}),new b(n,this.__chain__).thru(function(t){return i&&!t.length&&t.push(be),t})):this.thru(t)},be,Gt),_n+""),fn=Ft,function(t,e,i){var s,n=Object(t);Qt(t)||(s=Dt(e,3),t=ve(t),e=function(t){return s(n[t],t,n)});i=fn(t,e,i);return-1<i?n[s?t[i]:i]:be}),ts=at(function(t,e){if(null==t)return[];var i=e.length;return 1<i&&Pt(t,e[0],e[1])?e=[]:2<i&&Pt(e[0],e[1],e[2])&&(e=[e[0]]),st(t,G(e,1),[])});qt.Cache=M;var Dn,Tn,In,Cn=X(function(){return arguments}())?X:function(t){return se(t)&&Ss.call(t,"callee")&&!Ls.call(t,"callee")},bn=Array.isArray,Rn=Qi||Ce,$i=$i?_($i):function(t){return se(t)&&Y(t)==Ze},Pn=rs?_(rs):function(t){return se(t)&&gn(t)==ii},Mn=as?_(as):function(t){return se(t)&&gn(t)==li},On=ss?_(ss):function(t){return se(t)&&ee(t.length)&&!!us[Y(t)]},rs=ft(function(t,e){if(Ot(e)||Qt(e))vt(e,ve(e),t);else for(var i in e)Ss.call(e,i)&&k(t,i,e[i])}),as=ft(function(t,e){vt(e,fe(e),t)}),Ln=ft(function(t,e,i,s){vt(e,fe(e),t,s)}),Nn=(Tn="toUpperCase",function(t){var e=o(t=ce(t))?u(t):be,i=e?e[0]:t.charAt(0),t=e?ct(e,1).join(""):t.slice(1);return i[Tn]()+t}),kn=at(function(t,e){try{return d(t,be,e)}catch(t){return $t(t)?t:new Error(t)}}),ss=(Dn=Math["round"],function(t,e){if(t=he(t),e=null==e?0:Hs(ue(e),292)){var i=(ce(t)+"e").split("e");return+((i=(ce(Dn(i[0]+"e"+(+i[1]+e)))+"e").split("e"))[0]+"e"+(+i[1]-e))}return Dn(t)});I.assign=rs,I.assignIn=as,I.assignInWith=Ln,I.chain=Kt,I.compact=function(t){for(var e=-1,i=null==t?0:t.length,s=0,n=[];++e<i;){var r=t[e];r&&(n[s++]=r)}return n},I.constant=me,I.debounce=zt,I.drop=function(t,e,i){var s=null==t?0:t.length;return s?ot(t,(e=i||e===be?1:ue(e))<0?0:e,s):[]},I.flatten=Gt,I.iteratee=ye,I.keys=ve,I.keysIn=fe,I.map=function(t,e){return(bn(t)?g:it)(t,Dt(e,3))},I.memoize=qt,I.mixin=Se,I.negate=Xt,I.omitBy=function(t,e){return _e(t,Xt(Dt(e)))},I.pickBy=_e,I.property=Te,I.pull=Ji,I.pullAll=xt,I.reverse=Ht,I.sortBy=ts,I.tap=function(t,e){return e(t),t},I.throttle=function(t,e,i){var s=!0,n=!0;if("function"!=typeof t)throw new TypeError(Re);return ie(i)&&(s="leading"in i?!!i.leading:s,n="trailing"in i?!!i.trailing:n),zt(t,e,{leading:s,maxWait:e,trailing:n})},I.thru=Yt,I.toArray=de,I.values=Ee,I.without=is,I.extend=as,I.extendWith=Ln,Se(I,I),I.attempt=kn,I.capitalize=function(t){return Nn(ce(t).toLowerCase())},I.clone=function(t){return j(t,Ne)},I.cloneDeep=function(t){return j(t,Oe|Ne)},I.endsWith=function(t,e,i){t=ce(t),e=lt(e);var s=t.length,s=i=i===be?s:w(ue(i),0,s);return 0<=(i-=e.length)&&t.slice(i,s)==e},I.eq=Jt,I.escape=function(t){return(t=ce(t))&&Pi.test(t)?t.replace(Ri,Es):t},I.every=function(t,e,i){return(bn(t)?s:F)(t,Dt(e=i&&Pt(t,e,i)?be:e,3))},I.find=ns,I.findIndex=Ft,I.forEach=Wt,I.forOwn=function(t,e){return t&&V(t,Dt(e,3))},I.get=pe,I.has=function(t,e){return null!=t&&Ct(t,e,W)},I.hasIn=ge,I.identity=Ae,I.includes=function(t,e,i,s){return t=Qt(t)?t:Ee(t),i=i&&!s?ue(i):0,s=t.length,i<0&&(i=xs(s+i,0)),ae(t)?i<=s&&-1<t.indexOf(e,i):!!s&&-1<h(t,e,i)},I.indexOf=function(t,e,i){var s=null==t?0:t.length;return s?(i=null==i?0:ue(i),h(t,e,i=i<0?xs(s+i,0):i)):-1},I.inRange=function(t,e,i){return e=le(e),i===be?(i=e,e=0):i=le(i),(t=t=he(t))>=Hs(e=e,i=i)&&t<xs(e,i)},I.isArguments=Cn,I.isArray=bn,I.isArrayLike=Qt,I.isArrayLikeObject=Zt,I.isBoolean=function(t){return!0===t||!1===t||se(t)&&Y(t)==Qe},I.isBuffer=Rn,I.isDate=$i,I.isEmpty=function(t){if(null==t)return!0;if(Qt(t)&&(bn(t)||"string"==typeof t||"function"==typeof t.splice||Rn(t)||On(t)||Cn(t)))return!t.length;var e,i=gn(t);if(i==ii||i==li)return!t.size;if(Ot(t))return!$(t).length;for(e in t)if(Ss.call(t,e))return!1;return!0},I.isError=$t,I.isFunction=te,I.isLength=ee,I.isMap=Pn,I.isNaN=function(t){return ne(t)&&t!=+t},I.isNull=function(t){return null===t},I.isNumber=ne,I.isObject=ie,I.isObjectLike=se,I.isPlainObject=re,I.isSet=Mn,I.isString=ae,I.isSymbol=oe,I.isTypedArray=On,I.isUndefined=function(t){return t===be},I.last=Vt,I.min=function(t){return t&&t.length?function(t,e,i){for(var s=-1,n=t.length;++s<n;){var r,a,o=t[s],d=e(o);null!=d&&(r===be?d==d&&!oe(d):i(d,r))&&(r=d,a=o)}return a}(t,Ae,et):be},I.stubArray=Ie,I.stubFalse=Ce,I.noConflict=function(){return vs._===this&&(vs._=Cs),this},I.noop=De,I.now=vn,I.padStart=function(t,e,i){t=ce(t);var s=(e=ue(e))?l(t):0;return e&&s<e?(e=e-s,((i=(s=(s=i)===be?" ":lt(s)).length)<2?i?rt(s,e):s:(i=rt(s,js(e/l(s))),o(s)?ct(u(i),0,e).join(""):i.slice(0,e)))+t):t},I.round=ss,I.some=function(t,e,i){return(bn(t)?f:dt)(t,Dt(e=i&&Pt(t,e,i)?be:e,3))},I.startsWith=function(t,e,i){return t=ce(t),i=null==i?0:w(ue(i),0,t.length),e=lt(e),t.slice(i,i+e.length)==e},I.template=function(a,t,e){var i=I.templateSettings;e&&Pt(a,t,e)&&(t=be),a=ce(a),t=Ln({},t,i,mt);var o,d,s=ve(i=Ln({},t.imports,i.imports,mt)),n=E(i,s),l=0,i=t.interpolate||Wi,u="__p += '",i=RegExp((t.escape||Wi).source+"|"+i.source+"|"+(i===Mi?Fi:Wi).source+"|"+(t.evaluate||Wi).source+"|$","g"),r="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++ls+"]")+"\n";if(a.replace(i,function(t,e,i,s,n,r){return i=i||s,u+=a.slice(l,r).replace(zi,A),e&&(o=!0,u+="' +\n__e("+e+") +\n'"),n&&(d=!0,u+="';\n"+n+";\n__p += '"),i&&(u+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),l=r+t.length,t}),u+="';\n",(t=t.variable)||(u="with (obj) {\n"+u+"\n}\n"),u=(d?u.replace(Ii,""):u).replace(Ci,"$1").replace(bi,"$1;"),u="function("+(t||"obj")+") {\n"+(t?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(d?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+u+"return __p\n}",(t=kn(function(){return Function(s,r+"return "+u).apply(be,n)})).source=u,$t(t))throw t;return t},I.toFinite=le,I.toInteger=ue,I.toNumber=he,I.toString=ce,I.upperFirst=Nn,I.each=Wt,Se(I,(In={},V(I,function(t,e){Ss.call(I.prototype,e)||(In[e]=t)}),In),{chain:!1}),I.VERSION="4.17.5",D(["drop","take"],function(i,s){R.prototype[i]=function(t){t=t===be?1:xs(ue(t),0);var e=this.__filtered__&&!s?new R(this):this.clone();return e.__filtered__?e.__takeCount__=Hs(t,e.__takeCount__):e.__views__.push({size:Hs(t,We),type:i+(e.__dir__<0?"Right":"")}),e},R.prototype[i+"Right"]=function(t){return this.reverse()[i](t).reverse()}}),D(["filter","map","takeWhile"],function(t,e){var i=e+1,s=1==i||3==i;R.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Dt(t,3),type:i}),e.__filtered__=e.__filtered__||s,e}}),D(["head","last"],function(t,e){var i="take"+(e?"Right":"");R.prototype[t]=function(){return this[i](1).value()[0]}}),D(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");R.prototype[t]=function(){return this.__filtered__?new R(this):this[i](1)}}),R.prototype.compact=function(){return this.filter(Ae)},R.prototype.find=function(t){return this.filter(t).head()},R.prototype.findLast=function(t){return this.reverse().find(t)},R.prototype.invokeMap=at(function(e,i){return"function"==typeof e?new R(this):this.map(function(t){return q(t,e,i)})}),R.prototype.reject=function(t){return this.filter(Xt(Dt(t)))},R.prototype.slice=function(t,e){t=ue(t);var i=this;return i.__filtered__&&(0<t||e<0)?new R(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),i=e!==be?(e=ue(e))<0?i.dropRight(-e):i.take(e-t):i)},R.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},R.prototype.toArray=function(){return this.take(We)},V(R.prototype,function(l,t){var u=/^(?:filter|find|map|reject)|While$/.test(t),h=/^(?:head|last)$/.test(t),c=I[h?"take"+("last"==t?"Right":""):t],p=h||/^find/.test(t);c&&(I.prototype[t]=function(){function t(t){return t=c.apply(I,v([t],i)),h&&a?t[0]:t}var e=this.__wrapped__,i=h?[1]:arguments,s=e instanceof R,n=i[0],r=s||bn(e);r&&u&&"function"==typeof n&&1!=n.length&&(s=r=!1);var a=this.__chain__,o=!!this.__actions__.length,n=p&&!a,o=s&&!o;if(p||!r)return n&&o?l.apply(this,i):(d=this.thru(t),n?h?d.value()[0]:d.value():d);var e=o?e:new R(this),d=l.apply(e,i);return d.__actions__.push({func:Yt,args:[t],thisArg:be}),new b(d,a)})}),D(["pop","push","shift","sort","splice","unshift"],function(t){var i=ms[t],s=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);I.prototype[t]=function(){var e=arguments;if(!n||this.__chain__)return this[s](function(t){return i.apply(bn(t)?t:[],e)});var t=this.value();return i.apply(bn(t)?t:[],e)}}),V(R.prototype,function(t,e){var i,s=I[e];s&&(i=s.name+"",(Xs[i]||(Xs[i]=[])).push({name:e,func:s}))}),Xs[Et(be,we).name]=[{name:"wrapper",func:be}],R.prototype.clone=function(){var t=new R(this.__wrapped__);return t.__actions__=gt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=gt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=gt(this.__views__),t},R.prototype.reverse=function(){var t;return this.__filtered__?((t=new R(this)).__dir__=-1,t.__filtered__=!0):(t=this.clone()).__dir__*=-1,t},R.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,i=bn(t),s=e<0,n=i?t.length:0,r=function(t,e,i){for(var s=-1,n=i.length;++s<n;){var r=i[s],a=r.size;switch(r.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Hs(e,t+a);break;case"takeRight":t=xs(t,e-a)}}return{start:t,end:e}}(0,n,this.__views__),a=r.start,o=(r=r.end)-a,d=s?r:a-1,l=this.__iteratees__,u=l.length,h=0,c=Hs(o,this.__takeCount__);if(!i||!s&&n==o&&c==o)return ut(t,this.__actions__);var p=[];t:for(;o--&&h<c;){for(var g=-1,v=t[d+=e];++g<u;){var f=l[g],_=f.iteratee,f=f.type,_=_(v);if(2==f)v=_;else if(!_){if(1==f)continue t;break t}}p[h++]=v}return p},I.prototype.chain=function(){return Kt(this)},I.prototype.commit=function(){return new b(this.value(),this.__chain__)},I.prototype.next=function(){this.__values__===be&&(this.__values__=de(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?be:this.__values__[this.__index__++]}},I.prototype.plant=function(t){for(var e,i=this;i instanceof C;){var s=jt(i);s.__index__=0,s.__values__=be,e?n.__wrapped__=s:e=s;var n=s,i=i.__wrapped__}return n.__wrapped__=t,e},I.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof R){t=t;return(t=(t=this.__actions__.length?new R(this):t).reverse()).__actions__.push({func:Yt,args:[Ht],thisArg:be}),new b(t,this.__chain__)}return this.thru(Ht)},I.prototype.toJSON=I.prototype.valueOf=I.prototype.value=function(){return ut(this.__wrapped__,this.__actions__)},I.prototype.first=I.prototype.head,Us&&(I.prototype[Us]=function(){return this}),es?((es.exports=I)._=I,Zi._=I):vs._=I}).call(this),"undefined"!=typeof window&&(Q=this,Z=function(){return i={"./node_modules/eventemitter3/index.js":function(t,e,i){"use strict";function s(){}function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,i,s,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");n=new r(i,s||t,n),e=p?p+e:e;return t._events[e]?t._events[e].fn?t._events[e]=[t._events[e],n]:t._events[e].push(n):(t._events[e]=n,t._eventsCount++),t}function d(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function a(){this._events=new s,this._eventsCount=0}var o=Object.prototype.hasOwnProperty,p="~";Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(p=!1)),a.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)o.call(t,e)&&i.push(p?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var t=p?p+t:t,e=this._events[t];if(!e)return[];if(e.fn)return[e.fn];for(var i=0,s=e.length,n=new Array(s);i<s;i++)n[i]=e[i].fn;return n},a.prototype.listenerCount=function(t){t=p?p+t:t,t=this._events[t];return t?t.fn?1:t.length:0},a.prototype.emit=function(t,e,i,s,n,r){var a=p?p+t:t;if(!this._events[a])return!1;var o,d=this._events[a],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,i),!0;case 4:return d.fn.call(d.context,e,i,s),!0;case 5:return d.fn.call(d.context,e,i,s,n),!0;case 6:return d.fn.call(d.context,e,i,s,n,r),!0}for(c=1,o=new Array(l-1);c<l;c++)o[c-1]=arguments[c];d.fn.apply(d.context,o)}else for(var u,h=d.length,c=0;c<h;c++)switch(d[c].once&&this.removeListener(t,d[c].fn,void 0,!0),l){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,e);break;case 3:d[c].fn.call(d[c].context,e,i);break;case 4:d[c].fn.call(d[c].context,e,i,s);break;default:if(!o)for(u=1,o=new Array(l-1);u<l;u++)o[u-1]=arguments[u];d[c].fn.apply(d[c].context,o)}return!0},a.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,i,s){t=p?p+t:t;if(!this._events[t])return this;if(!e)return d(this,t),this;var n=this._events[t];if(n.fn)n.fn!==e||s&&!n.once||i&&n.context!==i||d(this,t);else{for(var r=0,a=[],o=n.length;r<o;r++)(n[r].fn!==e||s&&!n[r].once||i&&n[r].context!==i)&&a.push(n[r]);a.length?this._events[t]=1===a.length?a[0]:a:d(this,t)}return this},a.prototype.removeAllListeners=function(t){return t?(t=p?p+t:t,this._events[t]&&d(this,t)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=p,t.exports=a.EventEmitter=a},"./node_modules/node-libs-browser/node_modules/events/events.js":function(t,e){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(t){return"function"==typeof t}function l(t){return"object"==typeof t&&null!==t}function u(t){return void 0===t}((t.exports=s).EventEmitter=s).prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},s.prototype.emit=function(t){var e,i,s,n,r,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var o=new Error('Uncaught, unspecified "error" event. ('+e+")");throw o.context=e,o}if(u(i=this._events[t]))return!1;if(d(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),i.apply(this,n)}else if(l(i))for(n=Array.prototype.slice.call(arguments,1),s=(a=i.slice()).length,r=0;r<s;r++)a[r].apply(this,n);return!0},s.prototype.on=s.prototype.addListener=function(t,e){var i;if(!d(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,d(e.listener)?e.listener:e),this._events[t]?l(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,l(this._events[t])&&!this._events[t].warned&&(i=u(this._maxListeners)?s.defaultMaxListeners:this._maxListeners)&&0<i&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},s.prototype.once=function(t,e){function i(){this.removeListener(t,i),s||(s=!0,e.apply(this,arguments))}if(!d(e))throw TypeError("listener must be a function");var s=!1;return i.listener=e,this.on(t,i),this},s.prototype.removeListener=function(t,e){var i,s,n,r;if(!d(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=(i=this._events[t]).length,s=-1,i===e||d(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(l(i)){for(r=n;0<r--;)if(i[r]===e||i[r].listener&&i[r].listener===e){s=r;break}if(s<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},s.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(d(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},s.prototype.listeners=function(t){return this._events&&this._events[t]?d(this._events[t])?[this._events[t]]:this._events[t].slice():[]},s.prototype.listenerCount=function(t){if(this._events){t=this._events[t];if(d(t))return 1;if(t)return t.length}return 0},s.listenerCount=function(t,e){return t.listenerCount(e)}},"./node_modules/url-toolkit/src/url-toolkit.js":function(t,e,i){var s,r,n,a,o;s=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,r=/^([^\/?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,o={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var s=o.parseURL(t);if(!s)throw new Error("Error trying to parse base URL.");return s.path=o.normalizePath(s.path),o.buildURLFromParts(s)}s=o.parseURL(e);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return i.alwaysNormalize?(s.path=o.normalizePath(s.path),o.buildURLFromParts(s)):e;e=o.parseURL(t);if(!e)throw new Error("Error trying to parse base URL.");!e.netLoc&&e.path&&"/"!==e.path[0]&&(n=r.exec(e.path),e.netLoc=n[1],e.path=n[2]),e.netLoc&&!e.path&&(e.path="/");var n,t={scheme:e.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};return s.netLoc||(t.netLoc=e.netLoc,"/"===s.path[0])||(s.path?(n=(n=e.path).substring(0,n.lastIndexOf("/")+1)+s.path,t.path=o.normalizePath(n)):(t.path=e.path,s.params||(t.params=e.params,s.query||(t.query=e.query)))),null===t.path&&(t.path=i.alwaysNormalize?o.normalizePath(s.path):s.path),o.buildURLFromParts(t)},parseURL:function(t){t=s.exec(t);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(n,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=o},"./node_modules/webworkify-webpack/index.js":function(t,e,h){function r(i){function s(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,s),e.l=!0,e.exports}var n={};s.m=i,s.c=n,s.i=function(t){return t},s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/",s.oe=function(t){throw console.error(t),t};var t=s(s.s=ENTRY_MODULE);return t.default||t}function c(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function p(t,e,i){var s={};s[i]=[];var n=e.toString(),e=n.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!e)return s;for(var r,e=e[1],a=new RegExp("(\\\\n|\\W)"+c(e)+v,"g");r=a.exec(n);)"dll-reference"!==r[3]&&s[i].push(r[3]);for(a=new RegExp("\\("+c(e)+'\\("(dll-reference\\s('+g+'))"\\)\\)'+v,"g");r=a.exec(n);)t[r[2]]||(s[i].push(r[1]),t[r[2]]=h(r[1]).m),s[r[2]]=s[r[2]]||[],s[r[2]].push(r[4]);for(var o,d=Object.keys(s),l=0;l<d.length;l++)for(var u=0;u<s[d[l]].length;u++)o=s[d[l]][u],isNaN(+o)||(s[d[l]][u]=+s[d[l]][u]);return s}function a(t,e){for(var i={main:[e]},s={main:[]},n={main:{}};function(i){return Object.keys(i).reduce(function(t,e){return t||0<i[e].length},!1)}(i);)for(var r=Object.keys(i),a=0;a<r.length;a++){var o=r[a],d=i[o].pop();if(n[o]=n[o]||{},!n[o][d]&&t[o][d]){n[o][d]=!0,s[o]=s[o]||[],s[o].push(d);for(var l=p(t,t[o][d],o),u=Object.keys(l),h=0;h<u.length;h++)i[u[h]]=i[u[h]]||[],i[u[h]]=i[u[h]].concat(l[u[h]])}}return s}var g="[\\.|\\-|\\+|\\w|/|@]+",v="\\((/\\*.*?\\*/)?s?.*?("+g+").*?\\)";t.exports=function(t,e){var i={main:h.m},s=(e=e||{}).all?{main:Object.keys(i.main)}:a(i,t),n="";Object.keys(s).filter(function(t){return"main"!==t}).forEach(function(e){for(var t=0;s[e][t];)t++;s[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",n=n+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s[e].map(function(t){return JSON.stringify(t)+": "+i[e][t].toString()}).join(",")+"});\n"});n=n+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s.main.map(function(t){return JSON.stringify(t)+": "+i.main[t].toString()}).join(",")+"}))(self);",t=new window.Blob([n],{type:"text/javascript"});if(e.bare)return t;e=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(t),t=new window.Worker(e);return t.objectURL=e,t}},"./src/config.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/controller/abr-controller.js"),n=i("./src/controller/buffer-controller.js"),r=i("./src/controller/cap-level-controller.js"),a=i("./src/controller/fps-controller.js"),o=i("./src/utils/xhr-loader.js"),d=i("./src/controller/audio-track-controller.js"),l=i("./src/controller/audio-stream-controller.js"),u=i("./src/utils/cues.js"),h=i("./src/controller/timeline-controller.js"),c=i("./src/controller/subtitle-track-controller.js"),p=i("./src/controller/subtitle-stream-controller.js"),g=i("./src/controller/eme-controller.js"),i=i("./src/utils/mediakeys-helper.js");e.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:o.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:s.default,bufferController:n.default,capLevelController:r.default,fpsController:a.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:i.requestMediaKeySystemAccess},e.hlsDefaultConfig.subtitleStreamController=p.SubtitleStreamController,e.hlsDefaultConfig.subtitleTrackController=c.default,e.hlsDefaultConfig.timelineController=h.default,e.hlsDefaultConfig.cueHandler=u,e.hlsDefaultConfig.enableCEA708Captions=!0,e.hlsDefaultConfig.enableWebVTT=!0,e.hlsDefaultConfig.captionsTextTrack1Label="English",e.hlsDefaultConfig.captionsTextTrack1LanguageCode="en",e.hlsDefaultConfig.captionsTextTrack2Label="Spanish",e.hlsDefaultConfig.captionsTextTrack2LanguageCode="es",e.hlsDefaultConfig.audioStreamController=l.default,e.hlsDefaultConfig.audioTrackController=d.default,e.hlsDefaultConfig.emeController=g.default},"./src/controller/abr-controller.js":function(t,d,l){"use strict";!function(n){var s,t=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(d,"__esModule",{value:!0});var i,f=l("./src/events.js"),e=l("./src/event-handler.js"),_=l("./src/utils/buffer-helper.js"),r=l("./src/errors.js"),E=l("./src/utils/logger.js"),a=l("./src/utils/ewma-bandwidth-estimator.js"),m=window.performance,t=(i=e.default,t(o,i),o.prototype.destroy=function(){this.clearTimer(),e.default.prototype.destroy.call(this)},o.prototype.onFragLoading=function(t){var e,i,s,n=t.frag;"main"!==n.type||(this.timer||(this.fragCurrent=n,this.timer=setInterval(this.onCheck,100)),this._bwEstimator)||(i=(e=this.hls).config,s=n.level,n=t=void 0,n=e.levels[s].details.live?(t=i.abrEwmaFastLive,i.abrEwmaSlowLive):(t=i.abrEwmaFastVoD,i.abrEwmaSlowVoD),this._bwEstimator=new a.default(e,n,t,i.abrEwmaDefaultEstimate))},o.prototype._abandonRulesCheck=function(){var t=this.hls,e=t.media,i=this.fragCurrent;if(i){var s=i.loader,n=t.minAutoLevel;if(!s||s.stats&&s.stats.aborted)return E.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var r=s.stats;if(e&&r&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&i.autoLevel&&i.level){var a=m.now()-r.trequest,o=Math.abs(e.playbackRate);if(a>500*i.duration/o){var d=t.levels,l=Math.max(1,r.bw?r.bw/8:1e3*r.loaded/a),u=d[i.level],h=u.realBitrate?Math.max(u.realBitrate,u.bitrate):u.bitrate,u=r.total||Math.max(r.loaded,Math.round(i.duration*h/8)),h=e.currentTime,u=(u-r.loaded)/l,c=(_.BufferHelper.bufferInfo(e,h,t.config.maxBufferHole).end-h)/o;if(c<2*i.duration/o&&c<u){for(var p=void 0,g=void 0,g=i.level-1;n<g;g--){var v=d[g].realBitrate?Math.max(d[g].realBitrate,d[g].bitrate):d[g].bitrate;if((p=i.duration*v/(6.4*l))<c)break}p<u&&(E.logger.warn("loading too slow, abort fragment loading and switch to level "+g+":fragLoadedDelay["+g+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+p.toFixed(1)+"<"+u.toFixed(1)+":"+c.toFixed(1)),t.nextLoadLevel=g,this._bwEstimator.sample(a,r.loaded),s.abort(),this.clearTimer(),t.trigger(f.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:r}))}}}}},o.prototype.onFragLoaded=function(t){var e,i,s=t.frag;"main"===s.type&&n.isFinite(s.sn)&&(this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(s=((e=this.hls.levels[s.level]).loaded?e.loaded.bytes:0)+t.stats.loaded,i=(e.loaded?e.loaded.duration:0)+t.frag.duration,e.loaded={bytes:s,duration:i},e.realBitrate=Math.round(8*s/i)),t.frag.bitrateTest&&((i=t.stats).tparsed=i.tbuffered=i.tload,this.onFragBuffered(t)))},o.prototype.onFragBuffered=function(t){var e=t.stats,i=t.frag;!0===e.aborted||"main"!==i.type||!n.isFinite(i.sn)||i.bitrateTest&&e.tload!==e.tbuffered||(t=e.tparsed-e.trequest,E.logger.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(t,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=t/1e3:this.bitrateTestDelay=0)},o.prototype.onError=function(t){switch(t.details){case r.ErrorDetails.FRAG_LOAD_ERROR:case r.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},o.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Object.defineProperty(o.prototype,"nextAutoLevel",{get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;e=this._nextABRAutoLevel;return e=-1!==t?Math.min(t,e):e},set:function(t){this._nextAutoLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"_nextABRAutoLevel",{get:function(){var t=this.hls,e=t.maxAutoLevel,i=t.levels,s=t.config,n=t.minAutoLevel,r=t.media,a=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,d=r?r.currentTime:0,l=r&&0!==r.playbackRate?Math.abs(r.playbackRate):1,u=this._bwEstimator?this._bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,h=(_.BufferHelper.bufferInfo(r,d,s.maxBufferHole).end-d)/l,c=this._findBestLevel(a,o,u,n,e,h,s.abrBandWidthFactor,s.abrBandWidthUpFactor,i);if(0<=c)return c;E.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");t=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay,r=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;return 0!=h||(l=this.bitrateTestDelay)&&(t=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-l,E.logger.trace("bitrate test took "+Math.round(1e3*l)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*t)+" ms"),r=d=1),c=this._findBestLevel(a,o,u,n,e,h+t,r,d,i),Math.max(c,0)},enumerable:!0,configurable:!0}),o.prototype._findBestLevel=function(t,e,i,s,n,r,a,o,d){for(var l=n;s<=l;l--){var u=d[l];if(u){var h=u.details,c=h?h.totalduration/h.fragments.length:e,p=!!h&&h.live,g=l<=t?a*i:o*i,u=d[l].realBitrate?Math.max(d[l].realBitrate,d[l].bitrate):d[l].bitrate,h=u*c/g;if(E.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(g)+"/"+u+"/"+c+"/"+r+"/"+h),u<g&&(!h||p&&!this.bitrateTestDelay||h<r))return l}}return-1},o);function o(t){var e=i.call(this,t,f.default.FRAG_LOADING,f.default.FRAG_LOADED,f.default.FRAG_BUFFERED,f.default.ERROR)||this;return e.lastLoadedFragLevel=0,e._nextAutoLevel=-1,e.hls=t,e.timer=null,e._bwEstimator=null,e.onCheck=e._abandonRulesCheck.bind(e),e}d.default=t}.call(this,l("./src/polyfills/number.js").Number)},"./src/controller/audio-stream-controller.js":function(t,i,a){"use strict";!function(y){var s,t=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(i,"__esModule",{value:!0});var n,S=a("./src/utils/binary-search.js"),D=a("./src/utils/buffer-helper.js"),u=a("./src/demux/demuxer.js"),T=a("./src/events.js"),d=a("./src/controller/level-helper.js"),r=a("./src/utils/time-ranges.js"),l=a("./src/errors.js"),I=a("./src/utils/logger.js"),C=a("./src/utils/discontinuities.js"),b=a("./src/controller/fragment-tracker.js"),h=a("./src/loader/fragment.js"),R=a("./src/controller/base-stream-controller.js"),P=window.performance,t=(n=R.default,t(e,n),e.prototype.onInitPtsFound=function(t){var e=t.id,i=t.frag.cc,t=t.initPTS;"main"===e&&(this.initPTS[i]=t,this.videoTrackCC=i,I.logger.log("InitPTS for cc: "+i+" found from video track: "+t),this.state===R.State.WAITING_INIT_PTS&&this.tick())},e.prototype.startLoad=function(t){var e;this.tracks?(e=this.lastCurrentTime,this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<e&&-1===t?(I.logger.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=R.State.IDLE):(this.lastCurrentTime=this.startPosition||t,this.state=R.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()):(this.startPosition=t,this.state=R.State.STOPPED)},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){var e;this.state!==t&&(e=this.state,this._state=t,I.logger.log("audio stream:"+e+"->"+t))},enumerable:!0,configurable:!0}),e.prototype.doTick=function(){var t,e,i,s=this.hls,n=s.config;switch(this.state){case R.State.ERROR:case R.State.PAUSED:case R.State.BUFFER_FLUSHING:break;case R.State.STARTING:this.state=R.State.WAITING_TRACK,this.loadedmetadata=!1;break;case R.State.IDLE:var r=this.tracks;if(!r)break;if(!this.media&&(this.startFragRequested||!n.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if(void 0===(t=this.nextLoadPosition))break;var a=this.mediaBuffer||this.media,o=this.videoBuffer||this.media,d=D.BufferHelper.bufferInfo(a,t,n.maxBufferHole),l=D.BufferHelper.bufferInfo(o,t,n.maxBufferHole),u=d.len,h=d.end,c=this.fragPrevious,p=Math.min(n.maxBufferLength,n.maxMaxBufferLength),g=Math.max(p,l.len),v=this.audioSwitch,o=this.trackId;if((u<g||v)&&o<r.length){if(void 0===(i=r[o].details)){this.state=R.State.WAITING_TRACK;break}if(!v&&this._streamEnded(d,i))return this.hls.trigger(T.default.BUFFER_EOS,{type:"audio"}),void(this.state=R.State.ENDED);var p=i.fragments,l=p.length,u=p[0].start,g=p[l-1].start+p[l-1].duration,f=void 0;if(v)if(i.live&&!i.PTSKnown)I.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),h=0;else if(h=t,i.PTSKnown&&t<u){if(!(d.end>u||d.nextStart))return;I.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=u+.05}if(i.initSegment&&!i.initSegment.data)f=i.initSegment;else if(h<=u){if(f=p[0],null!==this.videoTrackCC&&f.cc!==this.videoTrackCC&&(f=C.findFragWithCC(p,this.videoTrackCC)),i.live&&f.loadIdx&&f.loadIdx===this.fragLoadIdx){var _=d.nextStart||u;return I.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(_+.05)),void(this.media.currentTime=_+.05)}}else{var r=void 0,E=n.maxFragLookUpTolerance,d=c?p[c.sn-p[0].sn+1]:void 0,_=function(t){var e=Math.min(E,t.duration);return t.start+t.duration-e<=h?1:t.start-e>h&&t.start?-1:0};(r=h<g?(g-E<h&&(E=0),d&&!_(d)?d:S.default.search(p,_)):p[l-1])&&(u=(f=r).start,c&&f.level===c.level&&f.sn===c.sn&&(f.sn<i.endSN?(f=p[f.sn+1-i.startSN],I.logger.log("SN just loaded, load next one: "+f.sn)):f=null))}f&&(f.encrypted?(I.logger.log("Loading key for "+f.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+o),this.state=R.State.KEY_LOADING,s.trigger(T.default.KEY_LOADING,{frag:f})):(I.logger.log("Loading "+f.sn+", cc: "+f.cc+" of ["+i.startSN+" ,"+i.endSN+"],track "+o+", currentTime:"+t+",bufferEnd:"+h.toFixed(3)),this.fragCurrent=f,!v&&this.fragmentTracker.getState(f)!==b.FragmentState.NOT_LOADED||(this.startFragRequested=!0,y.isFinite(f.sn)&&(this.nextLoadPosition=f.start+f.duration),s.trigger(T.default.FRAG_LOADING,{frag:f}),this.state=R.State.FRAG_LOADING)))}break;case R.State.WAITING_TRACK:(e=this.tracks[this.trackId])&&e.details&&(this.state=R.State.IDLE);break;case R.State.FRAG_LOADING_WAITING_RETRY:var m=P.now(),f=this.retryDate,A=(a=this.media)&&a.seeking;(!f||f<=m||A)&&(I.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=R.State.IDLE);break;case R.State.WAITING_INIT_PTS:m=this.videoTrackCC;if(void 0===this.initPTS[m])break;A=this.waitingFragment;A?m!==(A=A.frag.cc)?(e=this.tracks[this.trackId]).details&&e.details.live&&(I.logger.warn("Waiting fragment CC ("+A+") does not match video track CC ("+m+")"),this.waitingFragment=null,this.state=R.State.IDLE):(this.state=R.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null):this.state=R.State.IDLE;break;case R.State.STOPPED:case R.State.FRAG_LOADING:case R.State.PARSING:case R.State.PARSED:case R.State.ENDED:}},e.prototype.onMediaAttached=function(t){t=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);t=this.config;this.tracks&&t.autoStartLoad&&this.startLoad(t.startPosition)},e.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(I.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onAudioTracksUpdated=function(t){I.logger.log("audio tracks updated"),this.tracks=t.audioTracks},e.prototype.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.state=R.State.PAUSED,this.waitingFragment=null,e?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=R.State.IDLE),this.tick()},e.prototype.onAudioTrackLoaded=function(t){var e=t.details,i=t.id,s=this.tracks[i],n=e.totalduration,t=0;I.logger.log("track "+i+" loaded ["+e.startSN+","+e.endSN+"],duration:"+n),e.live?(n=s.details)&&0<e.fragments.length?(d.mergeDetails(n,e),t=e.fragments[0].start,e.PTSKnown?I.logger.log("live audio playlist sliding:"+t.toFixed(3)):I.logger.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,I.logger.log("live audio playlist - first load, unknown sliding")):e.PTSKnown=!1,s.details=e,this.startFragRequested||(-1===this.startPosition&&(e=e.startTimeOffset,y.isFinite(e)?(I.logger.log("start time offset found in playlist, adjust startPosition to "+e),this.startPosition=e):this.startPosition=0),this.nextLoadPosition=this.startPosition),this.state===R.State.WAITING_TRACK&&(this.state=R.State.IDLE),this.tick()},e.prototype.onKeyLoaded=function(){this.state===R.State.KEY_LOADING&&(this.state=R.State.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e,i,s,n,r,a,o,d=this.fragCurrent,l=t.frag;this.state===R.State.FRAG_LOADING&&d&&"audio"===l.type&&l.level===d.level&&l.sn===d.sn&&(i=(e=(o=this.tracks[this.trackId]).details).totalduration,s=d.level,n=d.sn,r=d.cc,a=this.config.defaultAudioCodec||o.audioCodec||"mp4a.40.2",l=this.stats=t.stats,"initSegment"===n?(this.state=R.State.IDLE,l.tparsed=l.tbuffered=P.now(),e.initSegment.data=t.payload,this.hls.trigger(T.default.FRAG_BUFFERED,{stats:l,frag:d,id:"audio"}),this.tick()):(this.state=R.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new u.default(this.hls,"audio")),o=this.initPTS[r],l=e.initSegment?e.initSegment.data:[],e.initSegment||void 0!==o?(this.pendingBuffering=!0,I.logger.log("Demuxing "+n+" of ["+e.startSN+" ,"+e.endSN+"],track "+s),this.demuxer.push(t.payload,l,a,null,d,i,!1,o)):(I.logger.log("unknown video PTS for continuity counter "+r+", waiting for video PTS before demuxing audio frag "+n+" of ["+e.startSN+" ,"+e.endSN+"],track "+s),this.waitingFragment=t,this.state=R.State.WAITING_INIT_PTS))),this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,i=t.frag;e&&"audio"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===R.State.PARSING&&(i=void 0,(e=t.tracks).video&&delete e.video,(i=e.audio)&&(i.levelCodec=i.codec,i.id=t.id,this.hls.trigger(T.default.BUFFER_CODECS,e),I.logger.log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]"),(i=i.initSegment)&&(i={type:"audio",data:i,parent:"audio",content:"initSegment"},this.audioSwitch?this.pendingData=[i]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(T.default.BUFFER_APPENDING,i))),this.tick()))},e.prototype.onFragParsingData=function(e){var i=this,t=this.fragCurrent,s=e.frag;if(t&&"audio"===e.id&&"audio"===e.type&&s.sn===t.sn&&s.level===t.level&&this.state===R.State.PARSING){var n=this.trackId,r=this.tracks[n],a=this.hls;y.isFinite(e.endPTS)||(e.endPTS=e.startPTS+t.duration,e.endDTS=e.startDTS+t.duration),t.addElementaryStream(h.default.ElementaryStreamTypes.AUDIO),I.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),d.updateFragPTSDTS(r.details,t,e.startPTS,e.endPTS);s=this.audioSwitch,r=this.media,t=!1;s&&r&&(r.readyState?(r=r.currentTime,I.logger.log("switching audio track : currentTime:"+r),r>=e.startPTS&&(I.logger.log("switching audio track : flushing all audio"),this.state=R.State.BUFFER_FLUSHING,a.trigger(T.default.BUFFER_FLUSHING,{startOffset:0,endOffset:y.POSITIVE_INFINITY,type:"audio"}),this.audioSwitch=!(t=!0),a.trigger(T.default.AUDIO_TRACK_SWITCHED,{id:n}))):(this.audioSwitch=!1,a.trigger(T.default.AUDIO_TRACK_SWITCHED,{id:n})));var o=this.pendingData;if(!o)return I.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void a.trigger(T.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&o.push({type:e.type,data:t,parent:"audio",content:"data"})}),!t&&o.length&&(o.forEach(function(t){i.state===R.State.PARSING&&(i.pendingBuffering=!0,i.hls.trigger(T.default.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick()}},e.prototype.onFragParsed=function(t){var e=this.fragCurrent,i=t.frag;e&&"audio"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===R.State.PARSING&&(this.stats.tparsed=P.now(),this.state=R.State.PARSED,this._checkAppendedParsed())},e.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.prototype.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},e.prototype.onBufferAppended=function(t){var e;"audio"===t.parent&&((e=this.state)!==R.State.PARSING&&e!==R.State.PARSED||(this.pendingBuffering=0<t.pending,this._checkAppendedParsed()))},e.prototype._checkAppendedParsed=function(){var t,e,i;this.state!==R.State.PARSED||this.appended&&this.pendingBuffering||(i=this.fragCurrent,t=this.stats,e=this.hls,i&&(this.fragPrevious=i,t.tbuffered=P.now(),e.trigger(T.default.FRAG_BUFFERED,{stats:t,frag:i,id:"audio"}),i=this.mediaBuffer||this.media,I.logger.log("audio buffered : "+r.default.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,e.trigger(T.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=R.State.IDLE),this.tick())},e.prototype.onError=function(t){var e=t.frag;if(!e||"audio"===e.type)switch(t.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:var i,s,n,r=t.frag;if(r&&"audio"!==r.type)break;t.fatal||((i=this.fragLoadError)?i++:i=1,i<=(s=this.config).fragLoadingMaxRetry?(this.fragLoadError=i,n=Math.min(Math.pow(2,i-1)*s.fragLoadingRetryDelay,s.fragLoadingMaxRetryTimeout),I.logger.warn("AudioStreamController: frag loading failed, retry in "+n+" ms"),this.retryDate=P.now()+n,this.state=R.State.FRAG_LOADING_WAITING_RETRY):(I.logger.error("AudioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=R.State.ERROR));break;case l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==R.State.ERROR&&(this.state=t.fatal?R.State.ERROR:R.State.IDLE,I.logger.warn("AudioStreamController: "+t.details+" while loading frag, now switching to "+this.state+" state ..."));break;case l.ErrorDetails.BUFFER_FULL_ERROR:"audio"!==t.parent||this.state!==R.State.PARSING&&this.state!==R.State.PARSED||(i=this.mediaBuffer,n=this.media.currentTime,i&&D.BufferHelper.isBuffered(i,n)&&D.BufferHelper.isBuffered(i,n+.5)?((s=this.config).maxMaxBufferLength>=s.maxBufferLength&&(s.maxMaxBufferLength/=2,I.logger.warn("AudioStreamController: reduce max buffer length to "+s.maxMaxBufferLength+"s")),this.state=R.State.IDLE):(I.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=R.State.BUFFER_FLUSHING,this.hls.trigger(T.default.BUFFER_FLUSHING,{startOffset:0,endOffset:y.POSITIVE_INFINITY,type:"audio"})))}},e.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(I.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(t){e.hls.trigger(T.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=R.State.PARSED):(this.state=R.State.IDLE,this.fragPrevious=null,this.tick())},e);function e(t,e){var i=n.call(this,t,T.default.MEDIA_ATTACHED,T.default.MEDIA_DETACHING,T.default.AUDIO_TRACKS_UPDATED,T.default.AUDIO_TRACK_SWITCHING,T.default.AUDIO_TRACK_LOADED,T.default.KEY_LOADED,T.default.FRAG_LOADED,T.default.FRAG_PARSING_INIT_SEGMENT,T.default.FRAG_PARSING_DATA,T.default.FRAG_PARSED,T.default.ERROR,T.default.BUFFER_RESET,T.default.BUFFER_CREATED,T.default.BUFFER_APPENDED,T.default.BUFFER_FLUSHED,T.default.INIT_PTS_FOUND)||this;return i.fragmentTracker=e,i.config=t.config,i.audioCodecSwap=!1,i._state=R.State.STOPPED,i.initPTS=[],i.waitingFragment=null,i.videoTrackCC=null,i}i.default=t}.call(this,a("./src/polyfills/number.js").Number)},"./src/controller/audio-track-controller.js":function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r,a=i("./src/events.js"),o=i("./src/task-loop.js"),d=i("./src/utils/logger.js"),l=i("./src/errors.js"),n=(r=o.default,n(u,r),u.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},u.prototype.onManifestParsed=function(t){t=this.tracks=t.audioTracks||[];this.hls.trigger(a.default.AUDIO_TRACKS_UPDATED,{audioTracks:t})},u.prototype.onAudioTrackLoaded=function(t){var e;t.id>=this.tracks.length?d.logger.warn("Invalid audio track id:",t.id):(d.logger.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.hasInterval()&&(e=1e3*t.details.targetduration,this.setInterval(e)),!t.details.live&&this.hasInterval()&&this.clearInterval())},u.prototype.onAudioTrackSwitched=function(t){t=this.tracks[t.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},u.prototype.onLevelLoaded=function(t){t=this.hls.levels[t.level];t.audioGroupIds&&(t=t.audioGroupIds[t.urlId],this.audioGroupId!==t&&(this.audioGroupId=t,this._selectInitialAudioTrack()))},u.prototype.onError=function(t){t.type===l.ErrorTypes.NETWORK_ERROR&&(t.fatal&&this.clearInterval(),t.details===l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(d.logger.warn("Network failure on audio-track id:",t.context.id),this._handleLoadError()))},Object.defineProperty(u.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"audioTrack",{get:function(){return this._trackId},set:function(t){this._setAudioTrack(t),this._selectDefaultTrack=!1},enumerable:!0,configurable:!0}),u.prototype._setAudioTrack=function(t){var e,i,s;this._trackId===t&&this.tracks[this._trackId].details?d.logger.debug("Same id as current audio-track passed, and track details available -> no-op"):t<0||t>=this.tracks.length?d.logger.warn("Invalid id passed to audio-track controller"):(e=this.tracks[t],d.logger.log("Now switching to audio-track index "+t),this.clearInterval(),this._trackId=t,i=e.url,s=e.type,t=e.id,this.hls.trigger(a.default.AUDIO_TRACK_SWITCHING,{id:t,type:s,url:i}),this._loadTrackDetailsIfNeeded(e))},u.prototype.doTick=function(){this._updateTrack(this._trackId)},u.prototype._selectInitialAudioTrack=function(){var t,e,i,s,n=this,r=this.tracks;r.length&&(t=this.tracks[this._trackId],e=null,t&&(e=t.name),this._selectDefaultTrack&&((s=r.filter(function(t){return t.default})).length?r=s:d.logger.warn("No default audio tracks defined")),i=!1,(s=function(){r.forEach(function(t){i||n.audioGroupId&&t.groupId!==n.audioGroupId||e&&e!==t.name||(n._setAudioTrack(t.id),i=!0)})})(),i||(e=null,s()),i||(d.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(a.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0})))},u.prototype._needsTrackLoading=function(t){var e=t.details,t=t.url;return!(e&&!e.live||!t)},u.prototype._loadTrackDetailsIfNeeded=function(t){var e;this._needsTrackLoading(t)&&(e=t.url,t=t.id,d.logger.log("loading audio-track playlist for id: "+t),this.hls.trigger(a.default.AUDIO_TRACK_LOADING,{url:e,id:t}))},u.prototype._updateTrack=function(t){t<0||t>=this.tracks.length||(this.clearInterval(),this._trackId=t,d.logger.log("trying to update audio-track "+t),t=this.tracks[t],this._loadTrackDetailsIfNeeded(t))},u.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var t=this._trackId,e=this.tracks[t],i=e.name,s=e.language,e=e.groupId;d.logger.warn("Loading failed on audio track id: "+t+", group-id: "+e+', name/language: "'+i+'" / "'+s+'"');for(var n=t,r=0;r<this.tracks.length;r++)if(!this.trackIdBlacklist[r])if(this.tracks[r].name===i){n=r;break}n!==t?(d.logger.log("Attempting audio-track fallback id:",n,"group-id:",this.tracks[n].groupId),this._setAudioTrack(n)):d.logger.warn('No fallback audio-track found for name/language: "'+i+'" / "'+s+'"')},u);function u(t){t=r.call(this,t,a.default.MANIFEST_LOADING,a.default.MANIFEST_PARSED,a.default.AUDIO_TRACK_LOADED,a.default.AUDIO_TRACK_SWITCHED,a.default.LEVEL_LOADED,a.default.ERROR)||this;return t._trackId=-1,t._selectDefaultTrack=!0,t.tracks=[],t.trackIdBlacklist=Object.create(null),t.audioGroupId=null,t}e.default=n},"./src/controller/base-stream-controller.js":function(t,u,a){"use strict";!function(o){var s,t=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(u,"__esModule",{value:!0});var e=a("./src/task-loop.js"),n=a("./src/controller/fragment-tracker.js"),d=a("./src/utils/buffer-helper.js"),l=a("./src/utils/logger.js");u.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var i,t=(i=e.default,t(r,i),r.prototype.doTick=function(){},r.prototype.startLoad=function(){},r.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=u.State.STOPPED},r.prototype._streamEnded=function(t,e){var i=this.fragCurrent,s=this.fragmentTracker;if(e.live||!i||i.backtracked||i.sn!==e.endSN||t.nextStart)return!1;i=s.getState(i);return i===n.FragmentState.PARTIAL||i===n.FragmentState.OK},r.prototype.onMediaSeeking=function(){var t,e=this.config,i=this.media,s=this.mediaBuffer,n=this.state,r=i?i.currentTime:null,a=d.BufferHelper.bufferInfo(s||i,r,this.config.maxBufferHole);o.isFinite(r)&&l.logger.log("media seeking to "+r.toFixed(3)),n===u.State.FRAG_LOADING?(t=this.fragCurrent,0===a.len&&t&&(s=e.maxFragLookUpTolerance,e=t.start-s,s=t.start+t.duration+s,r<e||s<r?(t.loader&&(l.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=u.State.IDLE):l.logger.log("seeking outside of buffer but within currently loaded fragment range"))):n===u.State.ENDED&&(0===a.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=u.State.IDLE),i&&(this.lastCurrentTime=r),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=r),this.tick()},r.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},r.prototype.onHandlerDestroying=function(){this.stopLoad(),i.prototype.onHandlerDestroying.call(this)},r.prototype.onHandlerDestroyed=function(){this.state=u.State.STOPPED,this.fragmentTracker=null},r);function r(){return null!==i&&i.apply(this,arguments)||this}u.default=t}.call(this,a("./src/polyfills/number.js").Number)},"./src/controller/buffer-controller.js":function(t,o,h){"use strict";!function(s){var n,t=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(o,"__esModule",{value:!0});var e,d=h("./src/events.js"),i=h("./src/event-handler.js"),l=h("./src/utils/logger.js"),u=h("./src/errors.js"),r=h("./src/utils/mediasource-helper.js").getMediaSource(),t=(e=i.default,t(a,e),a.prototype.destroy=function(){i.default.prototype.destroy.call(this)},a.prototype.onLevelPtsUpdated=function(t){var e=t.type,i=this.tracks.audio;if("audio"===e&&i&&"audio/mpeg"===i.container){e=this.sourceBuffer.audio;if(.1<Math.abs(e.timestampOffset-t.start)){i=e.updating;try{e.abort()}catch(t){l.logger.warn("can not abort audio buffer: "+t)}i?this.audioTimestampOffset=t.start:(l.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+t.start),e.timestampOffset=t.start)}}},a.prototype.onManifestParsed=function(t){this.bufferCodecEventsExpected=t.altAudio?2:1,l.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},a.prototype.onMediaAttaching=function(t){var e=this.media=t.media;e&&(t=this.mediaSource=new r,this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),t.addEventListener("sourceopen",this.onmso),t.addEventListener("sourceended",this.onmse),t.addEventListener("sourceclose",this.onmsc),e.src=window.URL.createObjectURL(t),this._objectUrl=e.src)},a.prototype.onMediaDetaching=function(){l.logger.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){l.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):l.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(d.default.MEDIA_DETACHED)},a.prototype.onMediaSourceOpen=function(){l.logger.log("media source opened"),this.hls.trigger(d.default.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},a.prototype.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.pendingTracks,i=Object.keys(e).length;(i&&!t||2===i)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},a.prototype.onMediaSourceClose=function(){l.logger.log("media source closed")},a.prototype.onMediaSourceEnded=function(){l.logger.log("media source ended")},a.prototype.onSBUpdateEnd=function(){this.audioTimestampOffset&&(e=this.sourceBuffer.audio,l.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset),this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t,i=this.parent,e=this.segments.reduce(function(t,e){return e.parent===i?t+1:t},0),s={},n=this.sourceBuffer;for(t in n)s[t]=n[t].buffered;this.hls.trigger(d.default.BUFFER_APPENDED,{parent:i,pending:e,timeRanges:s}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===e&&this.flushLiveBackBuffer()},a.prototype.onSBUpdateError=function(t){l.logger.error("sourceBuffer error:",t),this.hls.trigger(d.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},a.prototype.onBufferReset=function(){var t,e=this.sourceBuffer;for(t in e){var i=e[t];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},a.prototype.onBufferCodecs=function(e){var t,i=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach(function(t){i.pendingTracks[t]=e[t]}),t=this.mediaSource,this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),t&&"open"===t.readyState&&this.checkPendingTracks())},a.prototype.createSourceBuffers=function(t){var e,i=this.sourceBuffer,s=this.mediaSource;for(e in t)if(!i[e]){var n=t[e],r=n.levelCodec||n.codec,a=n.container+";codecs="+r;l.logger.log("creating sourceBuffer("+a+")");try{var o=i[e]=s.addSourceBuffer(a);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe),this.tracks[e]={codec:r,container:n.container},n.buffer=o}catch(t){l.logger.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(d.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:a})}}this.hls.trigger(d.default.BUFFER_CREATED,{tracks:t})},a.prototype.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},a.prototype.onBufferAppendFail=function(t){l.logger.error("sourceBuffer error:",t.event),this.hls.trigger(d.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},a.prototype.onBufferEos=function(t){var e,i=this.sourceBuffer,s=t.type;for(e in i)s&&e!==s||i[e].ended||(i[e].ended=!0,l.logger.log(e+" sourceBuffer now EOS"));this.checkEos()},a.prototype.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(e&&"open"===e.readyState){for(var i in t){i=t[i];if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}l.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){l.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},a.prototype.onBufferFlushing=function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()},a.prototype.flushLiveBackBuffer=function(){if(this._live){var t=this.hls.config.liveBackBufferLength;if(isFinite(t)&&!(t<0))for(var e=this.media.currentTime,i=this.sourceBuffer,s=Object.keys(i),n=e-Math.max(t,this._levelTargetDuration),r=s.length-1;0<=r;r--){var a=s[r],o=i[a].buffered;0<o.length&&n>o.start(0)&&this.removeBufferRange(a,i[a],0,n)}}},a.prototype.onLevelUpdated=function(t){t=t.details;0<t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},a.prototype.updateMediaElementDuration=function(){var t,e=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var i in this.sourceBuffer)if(!0===this.sourceBuffer[i].updating)return;t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(l.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!s.isFinite(t))&&(l.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},a.prototype.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,i=this.sourceBuffer;try{for(var s in i)e+=i[s].buffered.length}catch(t){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(d.default.BUFFER_FLUSHED)}},a.prototype.doAppending=function(){var e=this.hls,i=this.segments,t=this.sourceBuffer;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void l.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending&&(i&&i.length)){var s=i.shift();try{var n=t[s.type];n?n.updating?i.unshift(s):(n.ended=!1,this.parent=s.parent,n.appendBuffer(s.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){l.logger.error("error while trying to append buffer:"+t.message),i.unshift(s);s={type:u.ErrorTypes.MEDIA_ERROR,parent:s.parent};22!==t.code?(this.appendError?this.appendError++:this.appendError=1,s.details=u.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(l.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],s.fatal=!0):s.fatal=!1):(this.segments=[],s.details=u.ErrorDetails.BUFFER_FULL_ERROR,s.fatal=!1),e.trigger(d.default.ERROR,s)}}}},a.prototype.flushBuffer=function(t,e,i){var s,n=this.sourceBuffer;if(Object.keys(n).length){if(l.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var r in n)if(!i||r===i){if((s=n[r]).ended=!1,s.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(r,s,t,e))return this.flushBufferCounter++,!1}}else l.logger.warn("abort flushing too many retries");l.logger.log("buffer flushed")}return!0},a.prototype.removeBufferRange=function(t,e,i,s){try{for(var n=0;n<e.buffered.length;n++){var r=e.buffered.start(n),a=e.buffered.end(n),o=Math.max(r,i),d=Math.min(a,s);if(.5<Math.min(d,a)-o)return l.logger.log("sb remove "+t+" ["+o+","+d+"], of ["+r+","+a+"], pos:"+this.media.currentTime),e.remove(o,d),!0}}catch(t){l.logger.warn("removeBufferRange failed",t)}return!1},a);function a(t){t=e.call(this,t,d.default.MEDIA_ATTACHING,d.default.MEDIA_DETACHING,d.default.MANIFEST_PARSED,d.default.BUFFER_RESET,d.default.BUFFER_APPENDING,d.default.BUFFER_CODECS,d.default.BUFFER_EOS,d.default.BUFFER_FLUSHING,d.default.LEVEL_PTS_UPDATED,d.default.LEVEL_UPDATED)||this;return t._msDuration=null,t._levelDuration=null,t._levelTargetDuration=10,t._live=null,t._objectUrl=null,t.bufferCodecEventsExpected=0,t.onsbue=t.onSBUpdateEnd.bind(t),t.onsbe=t.onSBUpdateError.bind(t),t.pendingTracks={},t.tracks={},t}o.default=t}.call(this,h("./src/polyfills/number.js").Number)},"./src/controller/cap-level-controller.js":function(t,o,d){"use strict";!function(e){var s,t=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(o,"__esModule",{value:!0});var i,n=d("./src/events.js"),r=d("./src/event-handler.js"),t=(i=r.default,t(a,i),a.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},a.prototype.onFpsDropLevelCapping=function(t){a.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},a.prototype.onMediaAttaching=function(t){this.media=t.media instanceof window.HTMLVideoElement?t.media:null},a.prototype.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&t.video&&this._startCapping()},a.prototype.onBufferCodecs=function(t){this.hls.config.capLevelToPlayerSize&&t.video&&this._startCapping()},a.prototype.onLevelsUpdated=function(t){this.levels=t.levels},a.prototype.onMediaDetaching=function(){this._stopCapping()},a.prototype.detectPlayerSize=function(){var t,e;!this.media||(t=this.levels?this.levels.length:0)&&((e=this.hls).autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping)},a.prototype.getMaxLevel=function(i){var s=this;if(!this.levels)return-1;var t=this.levels.filter(function(t,e){return a.isLevelAllowed(e,s.restrictedLevels)&&e<=i});return a.getMaxLevelByMediaSize(t,this.mediaWidth,this.mediaHeight)},a.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=e.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=e.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},Object.defineProperty(a.prototype,"mediaWidth",{get:function(){var t,e=this.media;return e&&(t=e.width||e.clientWidth||e.offsetWidth,t*=a.contentScaleFactor),t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"mediaHeight",{get:function(){var t,e=this.media;return e&&(t=e.height||e.clientHeight||e.offsetHeight,t*=a.contentScaleFactor),t},enumerable:!0,configurable:!0}),Object.defineProperty(a,"contentScaleFactor",{get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t},enumerable:!0,configurable:!0}),a.isLevelAllowed=function(t,e){return-1===(e=void 0===e?[]:e).indexOf(t)},a.getMaxLevelByMediaSize=function(t,e,i){if(!t||!t.length)return-1;for(var s,n,r=t.length-1,a=0;a<t.length;a+=1){var o=t[a];if((o.width>=e||o.height>=i)&&(s=o,!(n=t[a+1])||s.width!==n.width||s.height!==n.height)){r=a;break}}return r},a);function a(t){t=i.call(this,t,n.default.FPS_DROP_LEVEL_CAPPING,n.default.MEDIA_ATTACHING,n.default.MANIFEST_PARSED,n.default.BUFFER_CODECS,n.default.MEDIA_DETACHING)||this;return t.autoLevelCapping=e.POSITIVE_INFINITY,t.firstLevel=null,t.levels=[],t.media=null,t.restrictedLevels=[],t.timer=null,t}o.default=t}.call(this,d("./src/polyfills/number.js").Number)},"./src/controller/eme-controller.js":function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r,a=i("./src/event-handler.js"),o=i("./src/events.js"),d=i("./src/errors.js"),l=i("./src/utils/logger.js"),u=window.XMLHttpRequest,h={WIDEVINE:"com.widevine.alpha",PLAYREADY:"com.microsoft.playready"},c=function(t,e,i){var s={videoCapabilities:[]};return e.forEach(function(t){s.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"'})}),[s]},n=(r=a.default,n(p,r),p.prototype.getLicenseServerUrl=function(t){var e=t===h.WIDEVINE?this._widevineLicenseUrl:null;return e||(l.logger.error('No license server URL configured for key-system "'+t+'"'),this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),e},p.prototype._attemptKeySystemAccess=function(e,t,i){var s=this,i=function(t,e,i){if(t!==h.WIDEVINE)throw Error("Unknown key-system: "+t);return c(e,i)}(e,t,i);i?(l.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,i).then(function(t){s._onMediaKeySystemAccessObtained(e,t)}).catch(function(t){l.logger.error('Failed to obtain key-system "'+e+'" access:',t)})):l.logger.warn("Can not create config for key-system (maybe because platform is not supported):",e)},Object.defineProperty(p.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),p.prototype._onMediaKeySystemAccessObtained=function(e,t){var i=this;l.logger.log('Access for key-system "'+e+'" obtained');var s={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(s),t.createMediaKeys().then(function(t){s.mediaKeys=t,l.logger.log('Media-keys created for key-system "'+e+'"'),i._onMediaKeysCreated()}).catch(function(t){l.logger.error("Failed to create media-keys:",t)})},p.prototype._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},p.prototype._onNewMediaKeySession=function(e){var i=this;l.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(t){i._onKeySessionMessage(e,t.message)},!1)},p.prototype._onKeySessionMessage=function(e,t){l.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){l.logger.log("Received license data, updating key-session"),e.update(t)})},p.prototype._onMediaEncrypted=function(t,e){l.logger.log('Media is encrypted using "'+t+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=t,this._mediaEncryptionInitData=e,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},p.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});l.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},p.prototype._generateRequestWithPreferredKeySession=function(){var t,e,i,s=this,n=this._mediaKeysList[0];if(!n)return l.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});n.mediaKeysSessionInitialized?l.logger.warn("Key-Session already initialized but requested again"):((t=n.mediaKeysSession)||(l.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0})),e=this._mediaEncryptionInitDataType,i=this._mediaEncryptionInitData,l.logger.log('Generating key-session request for "'+e+'" init data type'),n.mediaKeysSessionInitialized=!0,t.generateRequest(e,i).then(function(){l.logger.debug("Key-session generation succeeded")}).catch(function(t){l.logger.error("Error generating key-session request:",t),s.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))},p.prototype._createLicenseXhr=function(t,e,i){var s=new u,n=this._licenseXhrSetup;try{if(n)try{n(s,t)}catch(e){s.open("POST",t,!0),n(s,t)}s.readyState||s.open("POST",t,!0)}catch(t){return l.logger.error("Error setting up key-system license XHR",t),void this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return s.responseType="arraybuffer",s.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,s,t,e,i),s},p.prototype._onLicenseRequestReadyStageChange=function(t,e,i,s){if(4===t.readyState)if(200===t.status)this._requestLicenseFailureCount=0,l.logger.log("License request succeeded"),s(t.response);else{if(l.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),++this._requestLicenseFailureCount<=3){t=3-this._requestLicenseFailureCount+1;return l.logger.warn("Retrying license request, "+t+" attempts left"),void this._requestLicense(i,s)}this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},p.prototype._generateLicenseRequestChallenge=function(t,e){var i;return t.mediaKeySystemDomain===h.PLAYREADY?l.logger.error("PlayReady is not supported (yet)"):t.mediaKeySystemDomain===h.WIDEVINE?i=e:l.logger.error("Unsupported key-system:",t.mediaKeySystemDomain),i},p.prototype._requestLicense=function(t,e){l.logger.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i)return l.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.KEY_SYSTEM_ERROR,details:d.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var s=this.getLicenseServerUrl(i.mediaKeySystemDomain),e=this._createLicenseXhr(s,t,e);l.logger.log("Sending license request to URL: "+s),e.send(this._generateLicenseRequestChallenge(i,t))},p.prototype.onMediaAttached=function(t){var e=this;this._emeEnabled&&(t=t.media,(this._media=t).addEventListener("encrypted",function(t){e._onMediaEncrypted(t.initDataType,t.initData)}))},p.prototype.onManifestParsed=function(t){var e;this._emeEnabled&&(e=t.levels.map(function(t){return t.audioCodec}),t=t.levels.map(function(t){return t.videoCodec}),this._attemptKeySystemAccess(h.WIDEVINE,e,t))},p);function p(t){var e=r.call(this,t,o.default.MEDIA_ATTACHED,o.default.MANIFEST_PARSED)||this;return e._widevineLicenseUrl=t.config.widevineLicenseUrl,e._licenseXhrSetup=t.config.licenseXhrSetup,e._emeEnabled=t.config.emeEnabled,e._requestMediaKeySystemAccess=t.config.requestMediaKeySystemAccessFunc,e._mediaKeysList=[],e._media=null,e._hasSetMediaKeys=!1,e._isMediaEncrypted=!1,e._requestLicenseFailureCount=0,e}e.default=n},"./src/controller/fps-controller.js":function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r,d=i("./src/events.js"),a=i("./src/event-handler.js"),l=i("./src/utils/logger.js"),u=window.performance,n=(r=a.default,n(o,r),o.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},o.prototype.onMediaAttaching=function(t){var e=this.hls.config;e.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof window.HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod))},o.prototype.checkFPS=function(t,e,i){var s,n,r,a,o=u.now();e&&(this.lastTime&&(r=o-this.lastTime,s=i-this.lastDroppedFrames,a=e-this.lastDecodedFrames,n=1e3*s/r,(r=this.hls).trigger(d.default.FPS_DROP,{currentDropped:s,currentDecoded:a,totalDroppedFrames:i}),0<n&&s>r.config.fpsDroppedMonitoringThreshold*a&&(a=r.currentLevel,l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),0<a&&(-1===r.autoLevelCapping||r.autoLevelCapping>=a)&&(r.trigger(d.default.FPS_DROP_LEVEL_CAPPING,{level:--a,droppedLevel:r.currentLevel}),r.autoLevelCapping=a,r.streamController.nextLevelSwitch()))),this.lastTime=o,this.lastDroppedFrames=i,this.lastDecodedFrames=e)},o.prototype.checkFPSInterval=function(){var t,e=this.video;e&&(this.isVideoPlaybackQualityAvailable?(t=e.getVideoPlaybackQuality(),this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)):this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount))},o);function o(t){return r.call(this,t,d.default.MEDIA_ATTACHING)||this}e.default=n},"./src/controller/fragment-finders.js":function(t,e,i){"use strict";!function(r){function n(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0);e=Math.min(e,i.duration+(i.deltaPTS||0));return i.start+i.duration-e<=t?1:i.start-e>t&&i.start?-1:0}function a(t,e,i){e=1e3*Math.min(e,i.duration+(i.deltaPTS||0));return i.endProgramDateTime-e>t}Object.defineProperty(e,"__esModule",{value:!0});var o=i("./src/utils/binary-search.js");e.findFragmentByPDT=function(t,e,i){if(!Array.isArray(t)||!t.length||!r.isFinite(e))return null;if(e<t[0].programDateTime)return null;if(e>=t[t.length-1].endProgramDateTime)return null;i=i||0;for(var s=0;s<t.length;++s){var n=t[s];if(a(e,i,n))return n}return null},e.findFragmentByPTS=function(t,e,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),(t=t?e[t.sn-e[0].sn+1]:null)&&!n(i,s,t)?t:o.default.search(e,n.bind(null,i,s))},e.fragmentWithinToleranceTest=n,e.pdtWithinToleranceTest=a}.call(this,i("./src/polyfills/number.js").Number)},"./src/controller/fragment-tracker.js":function(t,o,d){"use strict";!function(e){var s,t=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(o,"__esModule",{value:!0});var i=d("./src/event-handler.js"),n=d("./src/events.js");o.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var r,t=(r=i.default,t(a,r),a.prototype.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,i.default.prototype.destroy.call(this),r.prototype.destroy.call(this)},a.prototype.getBufferedFrag=function(e,i){var s=this.fragments,t=Object.keys(s).filter(function(t){t=s[t];if(t.body.type!==i)return!1;if(!t.buffered)return!1;t=t.body;return t.startPTS<=e&&e<=t.endPTS});if(0===t.length)return null;t=t.pop();return s[t].body},a.prototype.detectEvictedFragments=function(s,n){var r,a,o=this;Object.keys(this.fragments).forEach(function(t){var e=o.fragments[t];if(!0===e.buffered){t=e.range[s];if(t){r=t.time;for(var i=0;i<r.length;i++)if(a=r[i],!1===o.isTimeBuffered(a.startPTS,a.endPTS,n)){o.removeFragment(e.body);break}}}})},a.prototype.detectPartialFragments=function(i){var s=this,t=this.getFragmentKey(i),n=this.fragments[t];n&&(n.buffered=!0,Object.keys(this.timeRanges).forEach(function(t){var e;i.hasElementaryStream(t)&&(e=s.timeRanges[t],n.range[t]=s.getBufferedTimes(i.startPTS,i.endPTS,e))}))},a.prototype.getBufferedTimes=function(t,e,i){for(var s,n,r=[],a=!1,o=0;o<i.length;o++){if(s=i.start(o)-this.bufferPadding,n=i.end(o)+this.bufferPadding,s<=t&&e<=n){r.push({startPTS:Math.max(t,i.start(o)),endPTS:Math.min(e,i.end(o))});break}if(t<n&&s<e)r.push({startPTS:Math.max(t,i.start(o)),endPTS:Math.min(e,i.end(o))}),a=!0;else if(e<=s)break}return{time:r,partial:a}},a.prototype.getFragmentKey=function(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn},a.prototype.getPartialFragment=function(e){var i,s,n=this,r=null,a=0;return Object.keys(this.fragments).forEach(function(t){t=n.fragments[t];n.isPartial(t)&&(i=t.body.startPTS-n.bufferPadding,s=t.body.endPTS+n.bufferPadding,i<=e&&e<=s&&(s=Math.min(e-i,s-e),a<=s&&(r=t.body,a=s)))}),r},a.prototype.getState=function(t){var e=this.getFragmentKey(t),t=this.fragments[e],e=o.FragmentState.NOT_LOADED;return e=void 0!==t?t.buffered?!0===this.isPartial(t)?o.FragmentState.PARTIAL:o.FragmentState.OK:o.FragmentState.APPENDING:e},a.prototype.isPartial=function(t){return!0===t.buffered&&(void 0!==t.range.video&&!0===t.range.video.partial||void 0!==t.range.audio&&!0===t.range.audio.partial)},a.prototype.isTimeBuffered=function(t,e,i){for(var s,n,r=0;r<i.length;r++){if(s=i.start(r)-this.bufferPadding,n=i.end(r)+this.bufferPadding,s<=t&&e<=n)return!0;if(e<=s)return!1}return!1},a.prototype.onFragLoaded=function(t){t=t.frag;e.isFinite(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},a.prototype.onBufferAppended=function(t){var i=this;this.timeRanges=t.timeRanges,Object.keys(this.timeRanges).forEach(function(t){var e=i.timeRanges[t];i.detectEvictedFragments(t,e)})},a.prototype.onFragBuffered=function(t){this.detectPartialFragments(t.frag)},a.prototype.hasFragment=function(t){t=this.getFragmentKey(t);return void 0!==this.fragments[t]},a.prototype.removeFragment=function(t){t=this.getFragmentKey(t);delete this.fragments[t]},a.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},a);function a(t){var e=r.call(this,t,n.default.BUFFER_APPENDED,n.default.FRAG_BUFFERED,n.default.FRAG_LOADED)||this;return e.bufferPadding=.2,e.fragments=Object.create(null),e.timeRanges=Object.create(null),e.config=t.config,e}o.FragmentTracker=t}.call(this,d("./src/polyfills/number.js").Number)},"./src/controller/gap-controller.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("./src/utils/buffer-helper.js"),o=i("./src/errors.js"),d=i("./src/events.js"),l=i("./src/utils/logger.js"),i=(s.prototype.poll=function(t,e){var i=this.config,s=this.media,n=s.currentTime,r=window.performance.now();if(n!==t)return this.stallReported&&(l.logger.warn("playback not stuck anymore @"+n+", after "+Math.round(r-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);s.ended||!s.buffered.length||2<s.readyState||s.seeking&&a.BufferHelper.isBuffered(s,n)||(t=r-this.stalled,i=a.BufferHelper.bufferInfo(s,n,i.maxBufferHole),this.stalled?(1e3<=t&&this._reportStall(i.len),this._tryFixBufferStall(i,t)):this.stalled=r)},s.prototype._tryFixBufferStall=function(t,e){var i=this.config,s=this.fragmentTracker,n=this.media.currentTime,n=s.getPartialFragment(n);n&&this._trySkipBufferHole(n),.5<t.len&&e>1e3*i.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},s.prototype._reportStall=function(t){var e=this.hls,i=this.media;this.stallReported||(this.stallReported=!0,l.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer"),e.trigger(d.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},s.prototype._trySkipBufferHole=function(t){for(var e=this.hls,i=this.media,s=i.currentTime,n=0,r=0;r<i.buffered.length;r++){var a=i.buffered.start(r);if(n<=s&&s<a)return i.currentTime=Math.max(a,i.currentTime+.1),l.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+i.currentTime),this.stalled=null,void e.trigger(d.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+i.currentTime,frag:t});n=i.buffered.end(r)}},s.prototype._tryNudgeBuffer=function(){var t=this.config,e=this.hls,i=this.media,s=i.currentTime,n=(this.nudgeRetry||0)+1;(this.nudgeRetry=n)<t.nudgeMaxRetry?(n=s+n*t.nudgeOffset,l.logger.log("adjust currentTime from "+s+" to "+n),i.currentTime=n,e.trigger(d.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(l.logger.error("still stuck in high buffer @"+s+" after "+t.nudgeMaxRetry+", raise fatal error"),e.trigger(d.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0}))},s);function s(t,e,i,s){this.config=t,this.media=e,this.fragmentTracker=i,this.hls=s,this.stallReported=!1}e.default=i},"./src/controller/id3-track-controller.js":function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r,a=i("./src/events.js"),o=i("./src/event-handler.js"),h=i("./src/demux/id3.js"),d=i("./src/utils/texttrack-utils.js"),n=(r=o.default,n(l,r),l.prototype.destroy=function(){o.default.prototype.destroy.call(this)},l.prototype.onMediaAttached=function(t){this.media=t.media,this.media},l.prototype.onMediaDetaching=function(){d.clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},l.prototype.getID3Track=function(t){for(var e=0;e<t.length;e++){var i=t[e];if("metadata"===i.kind&&"id3"===i.label)return d.sendAddTrackEvent(i,this.media),i}return this.media.addTextTrack("metadata","id3")},l.prototype.onFragParsingMetadata=function(t){var e=t.frag,i=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var s=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0;n<i.length;n++){var r=h.default.getID3Frames(i[n].data);if(r){var a=i[n].pts,o=n<i.length-1?i[n+1].pts:e.endPTS;a===o&&(o+=1e-4);for(var d=0;d<r.length;d++){var l,u=r[d];h.default.isTimeStampFrame(u)||((l=new s(a,o,"")).value=u,this.id3Track.addCue(l))}}}},l);function l(t){t=r.call(this,t,a.default.MEDIA_ATTACHED,a.default.MEDIA_DETACHING,a.default.FRAG_PARSING_METADATA)||this;return t.id3Track=void 0,t.media=void 0,t}e.default=n},"./src/controller/level-controller.js":function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var l,r,u=i("./src/events.js"),a=i("./src/event-handler.js"),h=i("./src/utils/logger.js"),c=i("./src/errors.js"),p=i("./src/utils/codecs.js"),g=i("./src/controller/level-helper.js"),n=(window.performance,r=a.default,n(o,r),o.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},o.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},o.prototype.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},o.prototype.stopLoad=function(){this.canload=!1},o.prototype.onManifestLoaded=function(t){var e,i=[],s=[],n={},r=null,a=!1,o=!1;if(t.levels.forEach(function(t){var e=t.attrs;t.loadError=0,t.fragmentError=!1,a=a||!!t.videoCodec,o=o||!!t.audioCodec,l&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),(r=n[t.bitrate])?r.url.push(t.url):(t.url=[t.url],t.urlId=0,n[t.bitrate]=t,i.push(t)),e&&(e.AUDIO&&(o=!0,g.addGroupId(r||t,"audio",e.AUDIO)),e.SUBTITLES&&g.addGroupId(r||t,"text",e.SUBTITLES))}),i=(i=a&&o?i.filter(function(t){return!!t.videoCodec}):i).filter(function(t){var e=t.audioCodec,t=t.videoCodec;return(!e||p.isCodecSupportedInMp4(e,"audio"))&&(!t||p.isCodecSupportedInMp4(t,"video"))}),t.audioTracks&&(s=t.audioTracks.filter(function(t){return!t.audioCodec||p.isCodecSupportedInMp4(t.audioCodec,"audio")})).forEach(function(t,e){t.id=e}),0<i.length){e=i[0].bitrate,i.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=i;for(var d=0;d<i.length;d++)if(i[d].bitrate===e){this._firstLevel=d,h.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+e);break}this.hls.trigger(u.default.MANIFEST_PARSED,{levels:i,audioTracks:s,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:a,altAudio:s.some(function(t){return!!t.url})})}else this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(o.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&e[t].details||this.setLevelInternal(t))},enumerable:!0,configurable:!0}),o.prototype.setLevelInternal=function(t){var e,i=this._levels,s=this.hls;0<=t&&t<i.length?(this.clearTimer(),this.currentLevelIndex!==t&&(h.logger.log("switching to level "+t),(e=i[this.currentLevelIndex=t]).level=t,s.trigger(u.default.LEVEL_SWITCHING,e)),(i=(e=i[t]).details)&&!i.live||(i=e.urlId,s.trigger(u.default.LEVEL_LOADING,{url:e.url[i],level:t,id:i}))):s.trigger(u.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},Object.defineProperty(o.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(t){this._firstLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"startLevel",{get:function(){if(void 0!==this._startLevel)return this._startLevel;var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel},set:function(t){this._startLevel=t},enumerable:!0,configurable:!0}),o.prototype.onError=function(t){if(t.fatal)t.type===c.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var e,i=!1,s=!1;switch(t.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:e=t.frag.level,s=!0;break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:e=t.context.level,i=!0;break;case c.ErrorDetails.REMUX_ALLOC_ERROR:e=t.level,i=!0}void 0!==e&&this.recoverLevel(t,e,i,s)}},o.prototype.recoverLevel=function(t,e,i,s){var n=this,r=this.hls.config,a=t.details,o=this._levels[e];if(o.loadError++,o.fragmentError=s,i){if(!(this.levelRetryCount+1<=r.levelLoadingMaxRetry))return h.logger.error("level controller, cannot recover from "+a+" error"),this.currentLevelIndex=null,this.clearTimer(),void(t.fatal=!0);r=Math.min(Math.pow(2,this.levelRetryCount)*r.levelLoadingRetryDelay,r.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return n.loadLevel()},r),t.levelRetry=!0,this.levelRetryCount++,h.logger.warn("level controller, "+a+", retry in "+r+" ms, current retry count is "+this.levelRetryCount)}(i||s)&&(1<(i=o.url.length)&&o.loadError<i?(o.urlId=(o.urlId+1)%i,o.details=void 0,h.logger.warn("level controller, "+a+" for level "+e+": switching to redundant URL-id "+o.urlId)):-1===this.manualLevelIndex?(e=0===e?this._levels.length-1:e-1,h.logger.warn("level controller, "+a+": switch to "+e),this.hls.nextAutoLevel=this.currentLevelIndex=e):s&&(h.logger.warn("level controller, "+a+": reload a fragment"),this.currentLevelIndex=null))},o.prototype.onFragLoaded=function(t){t=t.frag;void 0===t||"main"!==t.type||void 0!==(t=this._levels[t.level])&&(t.fragmentError=!1,t.loadError=0,this.levelRetryCount=0)},o.prototype.onLevelLoaded=function(t){var e=this,i=t.level,s=t.details;i===this.currentLevelIndex&&((i=this._levels[i]).fragmentError||(i.loadError=0,this.levelRetryCount=0),s.live?(t=g.computeReloadInterval(i.details,s,t.stats.trequest),h.logger.log("live playlist, reload in "+Math.round(t)+" ms"),this.timer=setTimeout(function(){return e.loadLevel()},t)):this.clearTimer())},o.prototype.onAudioTrackSwitched=function(t){var e=this.hls.audioTracks[t.id].groupId,i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){for(var s=-1,n=0;n<i.audioGroupIds.length;n++)if(i.audioGroupIds[n]===e){s=n;break}s!==i.urlId&&(i.urlId=s,this.startLoad())}},o.prototype.loadLevel=function(){var t,e,i;h.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload&&"object"==typeof(i=this._levels[this.currentLevelIndex])&&0<i.url.length&&(t=this.currentLevelIndex,e=i.urlId,i=i.url[e],h.logger.log("Attempt loading level index "+t+" with URL-id "+e),this.hls.trigger(u.default.LEVEL_LOADING,{url:i,level:t,id:e}))},Object.defineProperty(o.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)},enumerable:!0,configurable:!0}),o);function o(t){t=r.call(this,t,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.FRAG_LOADED,u.default.ERROR)||this;return t.canload=!1,t.currentLevelIndex=null,t.manualLevelIndex=-1,t.timer=null,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t}e.default=n},"./src/controller/level-helper.js":function(t,e,i){"use strict";!function(u){function h(t,e,i){var s=t[e],n=t[i],t=n.startPTS;u.isFinite(t)?e<i?(s.duration=t-s.start,s.duration<0&&l.logger.warn("negative duration computed for frag "+s.sn+",level "+s.level+", there should be some duration drift between playlist and fragment!")):(n.duration=s.start-t,n.duration<0&&l.logger.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):n.start=e<i?s.start+s.duration:Math.max(s.start-n.duration,0)}function a(t,e,i,s,n,r){var a=i;u.isFinite(e.startPTS)&&(o=Math.abs(e.startPTS-i),u.isFinite(e.deltaPTS)?e.deltaPTS=Math.max(o,e.deltaPTS):e.deltaPTS=o,a=Math.max(i,e.startPTS),i=Math.min(i,e.startPTS),s=Math.max(s,e.endPTS),n=Math.min(n,e.startDTS),r=Math.max(r,e.endDTS));var o=i-e.start;e.start=e.startPTS=i,e.maxStartPTS=a,e.endPTS=s,e.startDTS=n,e.endDTS=r,e.duration=s-i;var d,l,i=e.sn;if(!t||i<t.startSN||i>t.endSN)return 0;for(i=i-t.startSN,(d=t.fragments)[i]=e,l=i;0<l;l--)h(d,l,l-1);for(l=i;l<d.length-1;l++)h(d,l,l+1);return t.PTSKnown=!0,o}function o(t,e,i){if(t&&e)for(var s=Math.max(t.startSN,e.startSN)-e.startSN,n=Math.min(t.endSN,e.endSN)-e.startSN,r=e.startSN-t.startSN,a=s;a<=n;a++){var o=t.fragments[r+a],d=e.fragments[a];if(!o||!d)break;i(o,d,a)}}function d(t,e){var i=e.startSN-t.startSN,s=t.fragments,n=e.fragments;if(!(i<0||i>s.length))for(var r=0;r<n.length;r++)n[r].start+=s[i].start}Object.defineProperty(e,"__esModule",{value:!0});var l=i("./src/utils/logger.js");e.addGroupId=function(t,e,i){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(i);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(i)}},e.updatePTS=h,e.updateFragPTSDTS=a,e.mergeDetails=function(t,i){i.initSegment&&t.initSegment&&(i.initSegment=t.initSegment);var s,n=0;if(o(t,i,function(t,e){n=t.cc-e.cc,u.isFinite(t.startPTS)&&(e.start=e.startPTS=t.startPTS,e.endPTS=t.endPTS,e.duration=t.duration,e.backtracked=t.backtracked,e.dropped=t.dropped,s=e),i.PTSKnown=!0}),i.PTSKnown){if(n){l.logger.log("discontinuity sliding from playlist, take drift into account");for(var e=i.fragments,r=0;r<e.length;r++)e[r].cc+=n}s?a(i,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):d(t,i),i.PTSKnown=t.PTSKnown}},e.mergeSubtitlePlaylists=function(t,e,i){void 0===i&&(i=0);var s=-1;o(t,e,function(t,e,i){e.start=t.start,s=i});var n=e.fragments;if(s<0)n.forEach(function(t){t.start+=i});else for(var r=s+1;r<n.length;r++)n[r].start=n[r-1].start+n[r-1].duration},e.mapFragmentIntersection=o,e.adjustSliding=d,e.computeReloadInterval=function(t,e,i){var s=1e3*(e.averagetargetduration||e.targetduration),n=s/2;return t&&e.endSN===t.endSN&&(s=n),i&&(s=Math.max(n,s-(window.performance.now()-i))),Math.round(s)}}.call(this,i("./src/polyfills/number.js").Number)},"./src/controller/stream-controller.js":function(t,A,y){"use strict";!function(o){var s,t=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(A,"__esModule",{value:!0});var n,h=y("./src/utils/binary-search.js"),d=y("./src/utils/buffer-helper.js"),l=y("./src/demux/demuxer.js"),u=y("./src/events.js"),i=y("./src/controller/fragment-tracker.js"),a=y("./src/loader/fragment.js"),e=y("./src/loader/playlist-loader.js"),c=y("./src/controller/level-helper.js"),r=y("./src/utils/time-ranges.js"),p=y("./src/errors.js"),g=y("./src/utils/logger.js"),v=y("./src/utils/discontinuities.js"),f=y("./src/controller/fragment-finders.js"),_=y("./src/controller/gap-controller.js"),E=y("./src/controller/base-stream-controller.js"),t=(n=E.default,t(m,n),m.prototype.startLoad=function(t){var e,i,s;this.levels?(e=this.lastCurrentTime,i=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(s=i.startLevel)&&(this.bitrateTest=!(s=0)),this.level=i.nextLoadLevel=s,this.loadedmetadata=!1),0<e&&-1===t&&(g.logger.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=E.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()):(this.forceStartLoad=!0,this.state=E.State.STOPPED)},m.prototype.stopLoad=function(){this.forceStartLoad=!1,n.prototype.stopLoad.call(this)},m.prototype.doTick=function(){switch(this.state){case E.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case E.State.IDLE:this._doTickIdle();break;case E.State.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=E.State.IDLE);break;case E.State.FRAG_LOADING_WAITING_RETRY:var e=window.performance.now(),t=this.retryDate;(!t||t<=e||this.media&&this.media.seeking)&&(g.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=E.State.IDLE);break;case E.State.ERROR:case E.State.STOPPED:case E.State.FRAG_LOADING:case E.State.PARSING:case E.State.PARSED:case E.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},m.prototype._doTickIdle=function(){var t=this.hls,e=t.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&e.startFragPrefetch)){var s=this.loadedmetadata?i.currentTime:this.nextLoadPosition,n=t.nextLoadLevel,r=this.levels[n];if(r){var a=r.bitrate,a=a?Math.max(8*e.maxBufferSize/a,e.maxBufferLength):e.maxBufferLength;a=Math.min(a,e.maxMaxBufferLength);i=d.BufferHelper.bufferInfo(this.mediaBuffer||i,s,e.maxBufferHole),e=i.len;if(!(a<=e)){g.logger.trace("buffer length of "+e.toFixed(3)+" is below max of "+a.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=n;r=r.details;if(!r||r.live&&this.levelLastLoaded!==n)this.state=E.State.WAITING_LEVEL;else{if(this._streamEnded(i,r)){n={};return this.altAudio&&(n.type="video"),this.hls.trigger(u.default.BUFFER_EOS,n),void(this.state=E.State.ENDED)}this._fetchPayloadOrEos(s,i,r)}}}}},m.prototype._fetchPayloadOrEos=function(t,e,i){var s=this.fragPrevious,n=this.level,r=i.fragments,a=r.length;if(0!==a){var o,d=r[0].start,l=r[a-1].start+r[a-1].duration,u=e.end;if(i.initSegment&&!i.initSegment.data)o=i.initSegment;else if(i.live){e=this.config.initialLiveManifestSize;if(a<e)return void g.logger.warn("Can not start playback of a level, reason: not enough fragments "+a+" < "+e);if(null===(o=this._ensureFragmentAtLivePoint(i,u,d,l,s,r,a)))return}else u<d&&(o=r[0]);(o=o||this._findFragment(d,s,a,r,u,l,i))&&(o.encrypted?(g.logger.log("Loading key for "+o.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n),this._loadKey(o)):(g.logger.log("Loading "+o.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n+", currentTime:"+t.toFixed(3)+",bufferEnd:"+u.toFixed(3)),this._loadFragment(o)))}},m.prototype._ensureFragmentAtLivePoint=function(t,e,i,s,n,r,a){var o,d=this.hls.config,l=this.media,u=void 0!==d.liveMaxLatencyDuration?d.liveMaxLatencyDuration:d.liveMaxLatencyDurationCount*t.targetduration;return e<Math.max(i-d.maxFragLookUpTolerance,s-u)&&(i=this.liveSyncPosition=this.computeLivePosition(i,t),g.logger.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+i.toFixed(3)),e=i,l&&l.readyState&&l.duration>i&&(l.currentTime=i),this.nextLoadPosition=i),t.PTSKnown&&s<e&&l&&l.readyState?null:(this.startFragRequested&&!t.PTSKnown&&(n&&(t.hasProgramDateTime?(g.logger.log("live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),o=f.findFragmentByPDT(r,n.endProgramDateTime,d.maxFragLookUpTolerance)):((d=n.sn+1)>=t.startSN&&d<=t.endSN&&(t=r[d-t.startSN],n.cc===t.cc&&g.logger.log("live playlist, switching playlist, load frag with next SN: "+(o=t).sn)),o||(o=h.default.search(r,function(t){return n.cc-t.cc}))&&g.logger.log("live playlist, switching playlist, load frag with same CC: "+o.sn))),o||(o=r[Math.min(a-1,Math.round(a/2))],g.logger.log("live playlist, switching playlist, unknown, load middle frag : "+o.sn))),o)},m.prototype._findFragment=function(t,e,i,s,n,r,a){var o,d=this.hls.config;return(r=n<r?(o=n>r-d.maxFragLookUpTolerance?0:d.maxFragLookUpTolerance,f.findFragmentByPTS(e,s,n,o)):s[i-1])&&(n=r.sn-a.startSN,o=e&&r.level===e.level,i=s[n-1],s=s[1+n],e&&r.sn===e.sn&&(o&&!r.backtracked?r.sn<a.endSN?(a=e.deltaPTS)&&a>d.maxBufferHole&&e.dropped&&n?(r=i,g.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):g.logger.log("SN just loaded, load next one: "+(r=s).sn,r):r=null:r.backtracked&&(s&&s.backtracked?(g.logger.warn("Already backtracked from fragment "+s.sn+", will not backtrack to fragment "+r.sn+". Loading fragment "+s.sn),r=s):(g.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),r.dropped=0,i?(r=i).backtracked=!0:n&&(r=null))))),r},m.prototype._loadKey=function(t){this.state=E.State.KEY_LOADING,this.hls.trigger(u.default.KEY_LOADING,{frag:t})},m.prototype._loadFragment=function(t){var e=this.fragmentTracker.getState(t);this.fragCurrent=t,this.startFragRequested=!0,o.isFinite(t.sn)&&!t.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),t.backtracked||e===i.FragmentState.NOT_LOADED||e===i.FragmentState.PARTIAL?(t.autoLevel=this.hls.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.hls.trigger(u.default.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new l.default(this.hls,"main")),this.state=E.State.FRAG_LOADING):e===i.FragmentState.APPENDING&&this._reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t)},Object.defineProperty(m.prototype,"state",{get:function(){return this._state},set:function(t){var e;this.state!==t&&(e=this.state,this._state=t,g.logger.log("main stream:"+e+"->"+t),this.hls.trigger(u.default.STREAM_STATE_TRANSITION,{previousState:e,nextState:t}))},enumerable:!0,configurable:!0}),m.prototype.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,e.default.LevelType.MAIN)},Object.defineProperty(m.prototype,"currentLevel",{get:function(){var t=this.media;if(t){t=this.getBufferedFrag(t.currentTime);if(t)return t.level}return-1},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"nextBufferedFrag",{get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null},enumerable:!0,configurable:!0}),m.prototype.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},Object.defineProperty(m.prototype,"nextLevel",{get:function(){var t=this.nextBufferedFrag;return t?t.level:-1},enumerable:!0,configurable:!0}),m.prototype._checkFragmentChanged=function(){var t,e,i=this.media;i&&i.readyState&&!1===i.seeking&&((t=i.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),d.BufferHelper.isBuffered(i,t)?e=this.getBufferedFrag(t):d.BufferHelper.isBuffered(i,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)&&((t=e)!==this.fragPlaying&&(this.hls.trigger(u.default.FRAG_CHANGED,{frag:t}),e=t.level,this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(u.default.LEVEL_SWITCHED,{level:e}),this.fragPlaying=t))},m.prototype.immediateLevelSwitch=function(){var t;g.logger.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,e=void 0,(t=this.media)?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e);var e=this.fragCurrent;e&&e.loader&&e.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,o.POSITIVE_INFINITY)},m.prototype.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,d.BufferHelper.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},m.prototype.nextLevelSwitch=function(){var t,e,i,s,n=this.media;n&&n.readyState&&(t=e=s=void 0,(e=this.getBufferedFrag(n.currentTime))&&1<e.startPTS&&this.flushMainBuffer(0,e.startPTS-1),s=n.paused?0:(i=this.hls.nextLoadLevel,e=this.levels[i],(i=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*e.bitrate/(1e3*i)+1:0),(t=this.getBufferedFrag(n.currentTime+s))&&(t=this.followingBufferedFrag(t))&&((s=this.fragCurrent)&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(t.maxStartPTS,o.POSITIVE_INFINITY)))},m.prototype.flushMainBuffer=function(t,e){this.state=E.State.BUFFER_FLUSHING;e={startOffset:t,endOffset:e};this.altAudio&&(e.type="video"),this.hls.trigger(u.default.BUFFER_FLUSHING,e)},m.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);t=this.config;this.levels&&t.autoStartLoad&&this.hls.startLoad(t.startPosition),this.gapController=new _.default(t,e,this.fragmentTracker,this.hls)},m.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(g.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},m.prototype.onMediaSeeked=function(){var t=this.media,t=t?t.currentTime:void 0;o.isFinite(t)&&g.logger.log("media seeked to "+t.toFixed(3)),this.tick()},m.prototype.onManifestLoading=function(){g.logger.log("trigger BUFFER_RESET"),this.hls.trigger(u.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},m.prototype.onManifestParsed=function(t){var e,i=!1,s=!1;t.levels.forEach(function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(i=!0),-1!==e.indexOf("mp4a.40.5")&&(s=!0))}),this.audioCodecSwitch=i&&s,this.audioCodecSwitch&&g.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1;t=this.config;(t.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(t.startPosition)},m.prototype.onLevelLoaded=function(t){var e=t.details,i=t.level,s=this.levels[this.levelLastLoaded],n=this.levels[i],r=e.totalduration,a=0;g.logger.log("level "+i+" loaded ["+e.startSN+","+e.endSN+"],duration:"+r),e.live?(t=n.details)&&0<e.fragments.length?(c.mergeDetails(t,e),a=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,t),e.PTSKnown&&o.isFinite(a)?g.logger.log("live playlist sliding:"+a.toFixed(3)):(g.logger.log("live playlist - outdated PTS, unknown sliding"),v.alignStream(this.fragPrevious,s,e))):(g.logger.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,v.alignStream(this.fragPrevious,s,e)):e.PTSKnown=!1,n.details=e,this.levelLastLoaded=i,this.hls.trigger(u.default.LEVEL_UPDATED,{details:e,level:i}),!1===this.startFragRequested&&(-1!==this.startPosition&&-1!==this.lastCurrentTime||(i=e.startTimeOffset,o.isFinite(i)?(i<0&&(g.logger.log("negative start time offset "+i+", count from end of last fragment"),i=a+r+i),g.logger.log("start time offset found in playlist, adjust startPosition to "+i),this.startPosition=i):e.live?(this.startPosition=this.computeLivePosition(a,e),g.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition),this.nextLoadPosition=this.startPosition),this.state===E.State.WAITING_LEVEL&&(this.state=E.State.IDLE),this.tick()},m.prototype.onKeyLoaded=function(){this.state===E.State.KEY_LOADING&&(this.state=E.State.IDLE,this.tick())},m.prototype.onFragLoaded=function(t){var e,i,s=this.fragCurrent,n=this.hls,r=this.levels,a=this.media,o=t.frag;this.state===E.State.FRAG_LOADING&&s&&"main"===o.type&&o.level===s.level&&o.sn===s.sn&&(i=t.stats,r=(e=r[s.level]).details,this.bitrateTest=!1,this.stats=i,g.logger.log("Loaded "+s.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+s.level),o.bitrateTest&&n.nextLoadLevel?(this.state=E.State.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=window.performance.now(),n.trigger(u.default.FRAG_BUFFERED,{stats:i,frag:s,id:"main"}),this.tick()):"initSegment"===o.sn?(this.state=E.State.IDLE,i.tparsed=i.tbuffered=window.performance.now(),r.initSegment.data=t.payload,n.trigger(u.default.FRAG_BUFFERED,{stats:i,frag:s,id:"main"}),this.tick()):(g.logger.log("Parsing "+s.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+s.level+", cc "+s.cc),this.state=E.State.PARSING,this.pendingBuffering=!0,this.appended=!1,o.bitrateTest&&(o.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:o})),i=!(a&&a.seeking)&&(r.PTSKnown||!r.live),o=r.initSegment?r.initSegment.data:[],a=this._getAudioCodec(e),(this.demuxer=this.demuxer||new l.default(this.hls,"main")).push(t.payload,o,a,e.videoCodec,s,r.totalduration,i))),this.fragLoadError=0},m.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,i=t.frag;if(e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===E.State.PARSING){var s=t.tracks,n=void 0,r=void 0;for(n in s.audio&&this.altAudio&&delete s.audio,(r=s.audio)&&(i=this.levels[this.level].audioCodec,e=navigator.userAgent.toLowerCase(),i&&this.audioCodecSwap&&(g.logger.log("swapping playlist audio codec"),i=-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===e.indexOf("firefox")&&(i="mp4a.40.5"),-1!==e.indexOf("android")&&"audio/mpeg"!==r.container&&g.logger.log("Android: force audio codec to "+(i="mp4a.40.2")),r.levelCodec=i,r.id=t.id),(r=s.video)&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=t.id),this.hls.trigger(u.default.BUFFER_CODECS,s),s){r=s[n],g.logger.log("main track:"+n+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var a=r.initSegment;a&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,{type:n,data:a,parent:"main",content:"initSegment"}))}this.tick()}},m.prototype.onFragParsingData=function(e){var i=this,t=this.fragCurrent,s=e.frag;if(t&&"main"===e.id&&s.sn===t.sn&&s.level===t.level&&("audio"!==e.type||!this.altAudio)&&this.state===E.State.PARSING){var n=this.levels[this.level],s=t;if(o.isFinite(e.endPTS)||(e.endPTS=e.startPTS+t.duration,e.endDTS=e.startDTS+t.duration),!0===e.hasAudio&&s.addElementaryStream(a.default.ElementaryStreamTypes.AUDIO),!0===e.hasVideo&&s.addElementaryStream(a.default.ElementaryStreamTypes.VIDEO),g.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(s.dropped=e.dropped,s.dropped)if(s.backtracked)g.logger.warn("Already backtracked on this fragment, appending with the gap",s.sn);else{t=n.details;if(!t||s.sn!==t.startSN)return g.logger.warn("missing video frame(s), backtracking fragment",s.sn),this.fragmentTracker.removeFragment(s),s.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=E.State.IDLE,this.fragPrevious=s,void this.tick();g.logger.warn("missing video frame(s) on first frag, appending with gap",s.sn)}else s.backtracked=!1;var s=c.updateFragPTSDTS(n.details,s,e.startPTS,e.endPTS,e.startDTS,e.endDTS),r=this.hls;r.trigger(u.default.LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:s,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(t){t&&t.length&&i.state===E.State.PARSING&&(i.appended=!0,i.pendingBuffering=!0,r.trigger(u.default.BUFFER_APPENDING,{type:e.type,data:t,parent:"main",content:"data"}))}),this.tick()}},m.prototype.onFragParsed=function(t){var e=this.fragCurrent,i=t.frag;e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===E.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=E.State.PARSED,this._checkAppendedParsed())},m.prototype.onAudioTrackSwitching=function(t){var e,i=!!t.url,t=t.id;i||(this.mediaBuffer!==this.media&&(g.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,(e=this.fragCurrent).loader&&(g.logger.log("switching to main audio track, cancel main fragment load"),e.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=E.State.IDLE),(e=this.hls).trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:o.POSITIVE_INFINITY,type:"audio"}),e.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:t}),this.altAudio=!1)},m.prototype.onAudioTrackSwitched=function(t){var e=t.id,t=!!this.hls.audioTracks[e].url;!t||(e=this.videoBuffer)&&this.mediaBuffer!==e&&(g.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e),this.altAudio=t,this.tick()},m.prototype.onBufferCreated=function(t){var e,i,s,n=t.tracks,r=!1;for(s in n){var a=n[s];"main"===a.id?(e=a,"video"===(i=s)&&(this.videoBuffer=n[s].buffer)):r=!0}r&&e?(g.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=e.buffer):this.mediaBuffer=this.media},m.prototype.onBufferAppended=function(t){var e;"main"===t.parent&&((e=this.state)!==E.State.PARSING&&e!==E.State.PARSED||(this.pendingBuffering=0<t.pending,this._checkAppendedParsed()))},m.prototype._checkAppendedParsed=function(){var t,e;this.state!==E.State.PARSED||this.appended&&this.pendingBuffering||((t=this.fragCurrent)&&(e=this.mediaBuffer||this.media,g.logger.log("main buffered : "+r.default.toString(e.buffered)),this.fragPrevious=t,(e=this.stats).tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*e.total/(e.tbuffered-e.tfirst)),this.hls.trigger(u.default.FRAG_BUFFERED,{stats:e,frag:t,id:"main"}),this.state=E.State.IDLE),this.tick())},m.prototype.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var i,s=!!this.media&&d.BufferHelper.isBuffered(this.media,this.media.currentTime)&&d.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:t.fatal||(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(i=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),g.logger.warn("mediaController: frag loading failed, retry in "+i+" ms"),this.retryDate=window.performance.now()+i,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=E.State.FRAG_LOADING_WAITING_RETRY):(g.logger.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=E.State.ERROR));break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==E.State.ERROR&&(t.fatal?(this.state=E.State.ERROR,g.logger.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==E.State.WAITING_LEVEL||(this.state=E.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==E.State.PARSING&&this.state!==E.State.PARSED||(s?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=E.State.IDLE):(g.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,o.POSITIVE_INFINITY)))}}},m.prototype._reduceMaxBufferLength=function(t){var e=this.config;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,g.logger.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},m.prototype._checkBuffer=function(){var t=this.media;t&&0!==t.readyState&&(t=(this.mediaBuffer||t).buffered,!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t))},m.prototype.onFragLoadEmergencyAborted=function(){this.state=E.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},m.prototype.onBufferFlushed=function(){var t=this.mediaBuffer||this.media;t&&this.fragmentTracker.detectEvictedFragments(a.default.ElementaryStreamTypes.VIDEO,t.buffered),this.state=E.State.IDLE,this.fragPrevious=null},m.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},m.prototype.computeLivePosition=function(t,e){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-i)},m.prototype._seekToStartPos=function(){var t=this.media,e=t.currentTime,i=t.seeking?e:this.startPosition;e!==i&&(g.logger.log("target start position not buffered, seek to buffered.start(0) "+i+" from current time "+e+" "),t.currentTime=i)},m.prototype._getAudioCodec=function(t){t=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&(g.logger.log("swapping playlist audio codec"),t=t&&(-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},Object.defineProperty(m.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t},enumerable:!0,configurable:!0}),m);function m(t,e){var i=n.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.LEVEL_LOADED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_LOAD_EMERGENCY_ABORTED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_SWITCHED,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED)||this;return i.fragmentTracker=e,i.config=t.config,i.audioCodecSwap=!1,i._state=E.State.STOPPED,i.stallReported=!1,i.gapController=null,i}A.default=t}.call(this,y("./src/polyfills/number.js").Number)},"./src/controller/subtitle-stream-controller.js":function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r,l=i("./src/events.js"),u=i("./src/utils/logger.js"),a=i("./src/crypt/decrypter.js"),h=i("./src/utils/buffer-helper.js"),c=i("./src/controller/fragment-finders.js"),p=i("./src/controller/fragment-tracker.js"),g=i("./src/controller/base-stream-controller.js"),o=i("./src/controller/level-helper.js"),d=window.performance,n=(r=g.default,n(v,r),v.prototype.onSubtitleFragProcessed=function(t){var e=t.frag,t=t.success;if(this.fragPrevious=e,this.state=g.State.IDLE,t){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var s,n=e.start,r=0;r<i.length;r++)if(n>=i[r].start&&n<=i[r].end){s=i[r];break}e=e.start+e.duration;s?s.end=e:i.push(s={start:n,end:e})}}},v.prototype.onMediaAttached=function(t){t=t.media;(this.media=t).addEventListener("seeking",this._onMediaSeeking),this.state=g.State.IDLE},v.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=g.State.STOPPED},v.prototype.onError=function(t){t=t.frag;t&&"subtitle"===t.type&&(this.state=g.State.IDLE)},v.prototype.onSubtitleTracksUpdated=function(t){var e=this;u.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=t.subtitleTracks,this.tracks.forEach(function(t){e.tracksBuffered[t.id]=[]})},v.prototype.onSubtitleTrackSwitch=function(t){this.currentTrackId=t.id,this.tracks&&-1!==this.currentTrackId?(t=this.tracks[this.currentTrackId])&&t.details&&this.setInterval(500):this.clearInterval()},v.prototype.onSubtitleTrackLoaded=function(t){var e=t.id,i=t.details,s=this.currentTrackId,n=this.tracks,t=n[s];e>=n.length||e!==s||!t||(i.live&&o.mergeSubtitlePlaylists(t.details,i,this.lastAVStart),t.details=i,this.setInterval(500))},v.prototype.onKeyLoaded=function(){this.state===g.State.KEY_LOADING&&(this.state=g.State.IDLE)},v.prototype.onFragLoaded=function(t){var i,e=this.fragCurrent,s=t.frag.decryptdata,n=t.frag,r=this.hls;this.state===g.State.FRAG_LOADING&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&0<t.payload.byteLength&&s&&s.key&&"AES-128"===s.method&&(i=d.now(),this.decrypter.decrypt(t.payload,s.key.buffer,s.iv.buffer,function(t){var e=d.now();r.trigger(l.default.FRAG_DECRYPTED,{frag:n,payload:t,stats:{tstart:i,tdecrypt:e}})}))},v.prototype.onLevelUpdated=function(t){t=t.details.fragments;this.lastAVStart=t.length?t[0].start:0},v.prototype.doTick=function(){if(this.media)switch(this.state){case g.State.IDLE:var t=this,e=t.config,i=t.currentTrackId,s=t.fragmentTracker,n=t.media,r=t.tracks;if(!r||!r[i]||!r[i].details)break;var a=e.maxBufferHole,o=e.maxFragLookUpTolerance,d=Math.min(e.maxBufferLength,e.maxMaxBufferLength),t=h.BufferHelper.bufferedInfo(this._getBuffered(),n.currentTime,a),e=t.end,n=t.len,a=r[i].details,t=a.fragments,r=t.length,i=t[r-1].start+t[r-1].duration;if(d<n)return;d=void 0,n=this.fragPrevious;(d=e<i?(d=n&&a.hasProgramDateTime?c.findFragmentByPDT(t,n.endProgramDateTime,o):d)||c.findFragmentByPTS(n,t,e,o):t[r-1])&&d.encrypted?(u.logger.log("Loading key for "+d.sn),this.state=g.State.KEY_LOADING,this.hls.trigger(l.default.KEY_LOADING,{frag:d})):d&&s.getState(d)===p.FragmentState.NOT_LOADED&&(this.fragCurrent=d,this.state=g.State.FRAG_LOADING,this.hls.trigger(l.default.FRAG_LOADING,{frag:d}))}else this.state=g.State.IDLE},v.prototype.stopLoad=function(){this.lastAVStart=0,r.prototype.stopLoad.call(this)},v.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},v.prototype.onMediaSeeking=function(){this.fragPrevious=null},v);function v(t,e){var i=r.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.ERROR,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.SUBTITLE_TRACKS_UPDATED,l.default.SUBTITLE_TRACK_SWITCH,l.default.SUBTITLE_TRACK_LOADED,l.default.SUBTITLE_FRAG_PROCESSED,l.default.LEVEL_UPDATED)||this;return i.fragmentTracker=e,i.config=t.config,i.state=g.State.STOPPED,i.tracks=[],i.tracksBuffered=[],i.currentTrackId=-1,i.decrypter=new a.default(t,t.config),i.lastAVStart=0,i._onMediaSeeking=i.onMediaSeeking.bind(i),i}e.SubtitleStreamController=n},"./src/controller/subtitle-track-controller.js":function(t,u,h){"use strict";!function(s){function n(t){for(var e=[],i=0;i<t.length;i++){var s=t[i];"subtitles"===s.kind&&s.label&&e.push(t[i])}return e}var r,t=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(u,"__esModule",{value:!0});var e,a=h("./src/events.js"),i=h("./src/event-handler.js"),o=h("./src/utils/logger.js"),d=h("./src/controller/level-helper.js"),t=(e=i.default,t(l,e),l.prototype.destroy=function(){i.default.prototype.destroy.call(this)},l.prototype.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},l.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},l.prototype.onManifestLoaded=function(t){var e=this,t=t.subtitles||[];this.tracks=t,this.hls.trigger(a.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:t}),t.forEach(function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)})},l.prototype.onSubtitleTrackLoaded=function(t){var e=this,i=t.id,s=t.details,n=this.trackId,r=this.tracks,a=r[n];i>=r.length||i!==n||!a||this.stopped?this._clearReloadTimer():(o.logger.log("subtitle track "+i+" loaded"),s.live?(t=d.computeReloadInterval(a.details,s,t.stats.trequest),o.logger.log("Reloading live subtitle playlist in "+t+"ms"),this.timer=setTimeout(function(){e._loadCurrentTrack()},t)):this._clearReloadTimer())},l.prototype.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},l.prototype.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},Object.defineProperty(l.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(t){this.trackId!==t&&(this._toggleTrackModes(t),this._setSubtitleTrackInternal(t))},enumerable:!0,configurable:!0}),l.prototype._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},l.prototype._loadCurrentTrack=function(){var t=this.trackId,e=this.tracks,i=this.hls,e=e[t];t<0||!e||e.details&&!e.details.live||(o.logger.log("Loading subtitle track "+t),i.trigger(a.default.SUBTITLE_TRACK_LOADING,{url:e.url,id:t}))},l.prototype._toggleTrackModes=function(t){var e=this.media,i=this.subtitleDisplay,s=this.trackId;e&&(e=n(e.textTracks),-1===t?[].slice.call(e).forEach(function(t){t.mode="disabled"}):(s=e[s])&&(s.mode="disabled"),(t=e[t])&&(t.mode=i?"showing":"hidden"))},l.prototype._setSubtitleTrackInternal=function(t){var e=this.hls,i=this.tracks;!s.isFinite(t)||t<-1||t>=i.length||(this.trackId=t,o.logger.log("Switching to subtitle track "+t),e.trigger(a.default.SUBTITLE_TRACK_SWITCH,{id:t}),this._loadCurrentTrack())},l.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,e=n(this.media.textTracks),i=0;i<e.length;i++)if("hidden"===e[i].mode)t=i;else if("showing"===e[i].mode){t=i;break}this.subtitleTrack=t}},l);function l(t){t=e.call(this,t,a.default.MEDIA_ATTACHED,a.default.MEDIA_DETACHING,a.default.MANIFEST_LOADED,a.default.SUBTITLE_TRACK_LOADED)||this;return t.tracks=[],t.trackId=-1,t.media=null,t.stopped=!0,t.subtitleDisplay=!0,t}u.default=t}.call(this,h("./src/polyfills/number.js").Number)},"./src/controller/timeline-controller.js":function(t,c,p){"use strict";!function(r){var s,t=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(c,"__esModule",{value:!0});var n,a=p("./src/events.js"),e=p("./src/event-handler.js"),o=p("./src/utils/cea-608-parser.js"),d=p("./src/utils/output-filter.js"),l=p("./src/utils/webvtt-parser.js"),u=p("./src/utils/logger.js"),h=p("./src/utils/texttrack-utils.js"),t=(n=e.default,t(i,n),i.prototype.addCues=function(t,e,i,s){for(var n,r,a=this.cueRanges,o=!1,d=a.length;d--;){var l=a[d],u=(n=l[0],r=l[1],u=e,Math.min(r,i)-Math.max(n,u));if(0<=u&&(l[0]=Math.min(l[0],e),l[1]=Math.max(l[1],i),o=!0,.5<u/(i-e)))return}o||a.push([e,i]),this.Cues.newCue(this.captionsTracks[t],e,i,s)},i.prototype.onInitPtsFound=function(t){var e=this;"main"===t.id&&(this.initPTS[t.frag.cc]=t.initPTS),this.unparsedVttFrags.length&&(t=this.unparsedVttFrags,this.unparsedVttFrags=[],t.forEach(function(t){e.onFragLoaded(t)}))},i.prototype.getExistingTrack=function(t){var e=this.media;if(e)for(var i=0;i<e.textTracks.length;i++){var s=e.textTracks[i];if(s[t])return s}return null},i.prototype.createCaptionsTrack=function(t){var e=this.captionsProperties[t],i=e.label,s=e.languageCode,n=this.captionsTracks;n[t]||((e=this.getExistingTrack(t))?(n[t]=e,h.clearCurrentCues(n[t]),h.sendAddTrackEvent(n[t],this.media)):(s=this.createTextTrack("captions",i,s))&&(s[t]=!0,n[t]=s))},i.prototype.createTextTrack=function(t,e,i){var s=this.media;if(s)return s.addTextTrack(t,e,i)},i.prototype.destroy=function(){e.default.prototype.destroy.call(this)},i.prototype.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},i.prototype.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){h.clearCurrentCues(e[t]),delete e[t]})},i.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},i.prototype._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var i=0;i<e.length;i++)h.clearCurrentCues(e[i])}},i.prototype.onManifestLoaded=function(t){var o,d=this;this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT&&(this.tracks=t.subtitles||[],o=this.media?this.media.textTracks:[],this.tracks.forEach(function(t,e){var i,s,n;if(e<o.length){for(var r=null,a=0;a<o.length;a++)if(s=o[a],n=t,s&&s.label===n.name&&!s.textTrack1&&!s.textTrack2){r=o[a];break}r&&(i=r)}i=i||d.createTextTrack("subtitles",t.name,t.lang),t.default?i.mode=d.hls.subtitleDisplay?"showing":"hidden":i.mode="disabled",d.textTracks.push(i)}))},i.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},i.prototype.onFragLoaded=function(t){var e=t.frag,i=t.payload;if("main"===e.type){var s,n=e.sn;n===this.lastSn+1||(s=this.cea608Parser)&&s.reset(),this.lastSn=n}else if("subtitle"===e.type)if(i.byteLength){if(!r.isFinite(this.initPTS[e.cc]))return this.unparsedVttFrags.push(t),void(this.initPTS.length&&this.hls.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e}));t=e.decryptdata;null!=t&&null!=t.key&&"AES-128"===t.method||this._parseVTTs(e,i)}else this.hls.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},i.prototype._parseVTTs=function(e,t){var i=this.vttCCs;i[e.cc]||(i[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var n=this.textTracks,r=this.hls;l.default.parse(t,this.initPTS[e.cc],i,e.cc,function(t){var s=n[e.level];"disabled"!==s.mode?(t.forEach(function(e){if(!s.cues.getCueById(e.id))try{s.addCue(e)}catch(t){var i=new window.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,s.addCue(i)}}),r.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})):r.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},function(t){u.logger.log("Failed to parse VTT cue: "+t),r.trigger(a.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},i.prototype.onFragDecrypted=function(t){var e=t.payload,i=t.frag;"subtitle"===i.type&&(r.isFinite(this.initPTS[i.cc])?this._parseVTTs(i,e):this.unparsedVttFrags.push(t))},i.prototype.onFragParsingUserdata=function(t){if(this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var i=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,i)}},i.prototype.extractCea608Data=function(t){for(var e,i,s,n=31&t[0],r=2,a=[],o=0;o<n;o++)e=t[r++],i=127&t[r++],s=127&t[r++],0==i&&0==s||0!=(4&e)&&0==(3&e)&&(a.push(i),a.push(s));return a},i);function i(t){var e,i=n.call(this,t,a.default.MEDIA_ATTACHING,a.default.MEDIA_DETACHING,a.default.FRAG_PARSING_USERDATA,a.default.FRAG_DECRYPTED,a.default.MANIFEST_LOADING,a.default.MANIFEST_LOADED,a.default.FRAG_LOADED,a.default.LEVEL_SWITCHING,a.default.INIT_PTS_FOUND)||this;return i.hls=t,i.config=t.config,i.enabled=!0,i.Cues=t.config.cueHandler,i.textTracks=[],i.tracks=[],i.unparsedVttFrags=[],i.initPTS=[],i.cueRanges=[],i.captionsTracks={},i.captionsProperties={textTrack1:{label:i.config.captionsTextTrack1Label,languageCode:i.config.captionsTextTrack1LanguageCode},textTrack2:{label:i.config.captionsTextTrack2Label,languageCode:i.config.captionsTextTrack2LanguageCode}},i.config.enableCEA708Captions&&(e=new d.default(i,"textTrack1"),t=new d.default(i,"textTrack2"),i.cea608Parser=new o.default(0,e,t)),i}c.default=t}.call(this,p("./src/polyfills/number.js").Number)},"./src/crypt/aes-crypto.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(n.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},n);function n(t,e){this.subtle=t,this.aesIV=e}e.default=s},"./src/crypt/aes-decryptor.js":function(t,e,i){"use strict";function N(t){var e=t.byteLength,i=e&&new DataView(t).getUint8(e-1);return i?t.slice(0,e-i):t}Object.defineProperty(e,"__esModule",{value:!0}),e.removePadding=N;var s=(n.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),i=new Uint32Array(4),s=0;s<4;s++)i[s]=e.getUint32(4*s);return i},n.prototype.initTable=function(){for(var t=this.sBox,e=this.invSBox,i=this.subMix,s=i[0],n=i[1],r=i[2],a=i[3],i=this.invSubMix,o=i[0],d=i[1],l=i[2],u=i[3],h=new Uint32Array(256),c=0,p=0,g=0,g=0;g<256;g++)h[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var v=p^p<<1^p<<2^p<<3^p<<4;t[c]=v=v>>>8^255&v^99;var f=h[e[v]=c],_=h[f],E=h[_],m=257*h[v]^16843008*v;s[c]=m<<24|m>>>8,n[c]=m<<16|m>>>16,r[c]=m<<8|m>>>24,a[c]=m,o[v]=(m=16843009*E^65537*_^257*f^16843008*c)<<24|m>>>8,d[v]=m<<16|m>>>16,l[v]=m<<8|m>>>24,u[v]=m,c?(c=f^h[h[h[E^f]]],p^=h[h[p]]):c=p=1}},n.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),i=!0,s=0;s<e.length&&i;)i=e[s]===this.key[s],s++;if(!i){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);for(var r,a,o,d=this.ksRows=4*(n+6+1),l=this.keySchedule=new Uint32Array(d),u=this.invKeySchedule=new Uint32Array(d),h=this.sBox,c=this.rcon,t=this.invSubMix,p=t[0],g=t[1],v=t[2],f=t[3],_=0;_<d;_++)_<n?a=l[_]=e[_]:(o=a,_%n==0?(o=h[(o=o<<8|o>>>24)>>>24]<<24|h[o>>>16&255]<<16|h[o>>>8&255]<<8|h[255&o],o^=c[_/n|0]<<24):6<n&&_%n==4&&(o=h[o>>>24]<<24|h[o>>>16&255]<<16|h[o>>>8&255]<<8|h[255&o]),l[_]=a=(l[_-n]^o)>>>0);for(r=0;r<d;r++)_=d-r,o=3&r?l[_]:l[_-4],u[r]=r<4||_<=4?o:p[h[o>>>24]]^g[h[o>>>16&255]]^v[h[o>>>8&255]]^f[h[255&o]],u[r]=u[r]>>>0}},n.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},n.prototype.decrypt=function(t,e,i,s){for(var n,r,a,o,d,l,u,h,c,p,g,v,f,_,E=this.keySize+6,m=this.invKeySchedule,A=this.invSBox,y=this.invSubMix,S=y[0],D=y[1],T=y[2],I=y[3],i=this.uint8ArrayToUint32Array_(i),C=i[0],b=i[1],R=i[2],P=i[3],M=new Int32Array(t),O=new Int32Array(M.length),L=this.networkToHostOrderSwap;e<M.length;){for(c=L(M[e]),p=L(M[e+1]),g=L(M[e+2]),v=L(M[e+3]),d=c^m[0],l=v^m[1],u=g^m[2],h=p^m[3],f=4,_=1;_<E;_++)n=S[d>>>24]^D[l>>16&255]^T[u>>8&255]^I[255&h]^m[f],r=S[l>>>24]^D[u>>16&255]^T[h>>8&255]^I[255&d]^m[f+1],a=S[u>>>24]^D[h>>16&255]^T[d>>8&255]^I[255&l]^m[f+2],o=S[h>>>24]^D[d>>16&255]^T[l>>8&255]^I[255&u]^m[f+3],d=n,l=r,u=a,h=o,f+=4;n=A[d>>>24]<<24^A[l>>16&255]<<16^A[u>>8&255]<<8^A[255&h]^m[f],r=A[l>>>24]<<24^A[u>>16&255]<<16^A[h>>8&255]<<8^A[255&d]^m[f+1],a=A[u>>>24]<<24^A[h>>16&255]<<16^A[d>>8&255]<<8^A[255&l]^m[f+2],o=A[h>>>24]<<24^A[d>>16&255]<<16^A[l>>8&255]<<8^A[255&u]^m[f+3],f+=3,O[e]=L(n^C),O[e+1]=L(o^b),O[e+2]=L(a^R),O[e+3]=L(r^P),C=c,b=p,R=g,P=v,e+=4}return s?N(O.buffer):O.buffer},n.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},n);function n(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}e.default=s},"./src/crypt/decrypter.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("./src/crypt/aes-crypto.js"),d=i("./src/crypt/fast-aes-key.js"),l=i("./src/crypt/aes-decryptor.js"),r=i("./src/errors.js"),u=i("./src/utils/logger.js"),a=i("./src/events.js"),n=i("./src/utils/get-self-scope.js").getSelfScope(),i=(s.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},s.prototype.decrypt=function(e,i,s,n){var t,r,a=this;this.disableWebCrypto&&this.config.enableSoftwareAES?(this.logEnabled&&(u.logger.log("JS AES decrypt"),this.logEnabled=!1),(t=this.decryptor)||(this.decryptor=t=new l.default),t.expandKey(i),n(t.decrypt(e,0,s,this.removePKCS7Padding))):(this.logEnabled&&(u.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1),r=this.subtle,this.key!==i&&(this.key=i,this.fastAesKey=new d.default(r,i)),this.fastAesKey.expandKey().then(function(t){new o.default(r,s).decrypt(e,t).catch(function(t){a.onWebCryptoError(t,e,i,s,n)}).then(function(t){n(t)})}).catch(function(t){a.onWebCryptoError(t,e,i,s,n)}))},s.prototype.onWebCryptoError=function(t,e,i,s,n){this.config.enableSoftwareAES?(u.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,i,s,n)):(u.logger.error("decrypting error : "+t.message),this.observer.trigger(a.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},s.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},s);function s(t,e,i){i=(void 0===i?{}:i).removePKCS7Padding,i=void 0===i||i;if(this.logEnabled=!0,this.observer=t,this.config=e,this.removePKCS7Padding=i)try{var s=n.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(t){}this.disableWebCrypto=!this.subtle}e.default=i},"./src/crypt/fast-aes-key.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(n.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},n);function n(t,e){this.subtle=t,this.key=e}e.default=s},"./src/demux/aacdemuxer.js":function(t,i,s){"use strict";!function(g){Object.defineProperty(i,"__esModule",{value:!0});var v=s("./src/demux/adts.js"),f=s("./src/utils/logger.js"),_=s("./src/demux/id3.js"),t=(e.prototype.resetInitSegment=function(t,e,i,s){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:s,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(t){if(!t)return!1;for(var e=(_.default.getID3Data(t,0)||[]).length,i=t.length;e<i;e++)if(v.probe(t,e))return f.logger.log("ADTS sync word found !"),!0;return!1},e.prototype.append=function(t,e,i,s){for(var n=this._audioTrack,r=_.default.getID3Data(t,0)||[],a=_.default.getTimeStamp(r),o=g.isFinite(a)?90*a:9e4*e,d=0,l=o,u=t.length,h=r.length,c=[{pts:l,dts:l,data:r}];h<u-1;)if(v.isHeader(t,h)&&h+5<u){v.initTrackConfig(n,this.observer,t,h,n.manifestCodec);var p=v.appendFrame(n,t,h,o,d);if(!p){f.logger.log("Unable to parse AAC frame");break}h+=p.length,l=p.sample.pts,d++}else _.default.isHeader(t,h)?(r=_.default.getID3Data(t,h),c.push({pts:l,dts:l,data:r}),h+=r.length):h++;this.remuxer.remux(n,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},e,i,s)},e.prototype.destroy=function(){},e);function e(t,e,i){this.observer=t,this.config=i,this.remuxer=e}i.default=t}.call(this,s("./src/polyfills/number.js").Number)},"./src/demux/adts.js":function(t,e,i){"use strict";function r(t,e,i,s){var n,r,a=navigator.userAgent.toLowerCase(),o=s,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=1+((192&e[i+2])>>>6);return(n=(60&e[i+2])>>>2)>d.length-1?void t.trigger(c.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+n}):(t=(1&e[i+2])<<2,t|=(192&e[i+3])>>>6,u.logger.log("manifest codec:"+s+",ADTS data:type:"+l+",sampleingIndex:"+n+"["+d[n]+"Hz],channelConfig:"+t),s=/firefox/i.test(a)?6<=n?(l=5,r=new Array(4),n-3):(l=2,r=new Array(2),n):-1!==a.indexOf("android")?(l=2,r=new Array(2),n):(l=5,r=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&6<=n?n-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(6<=n&&1==t||/vivaldi/i.test(a))||!s&&1==t)&&(l=2,r=new Array(2)),n)),r[0]=l<<3,r[0]|=(14&n)>>1,r[1]|=(1&n)<<7,r[1]|=t<<3,5===l&&(r[1]|=(14&s)>>1,r[2]=(1&s)<<7,r[2]|=8,r[3]=0),{config:r,samplerate:d[n],channelCount:t,codec:"mp4a.40."+l,manifestCodec:o})}function s(t,e){return 255===t[e]&&240==(246&t[e+1])}function o(t,e){return 1&t[e+1]?7:9}function d(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function a(t){return 9216e4/t}function l(t,e,i,s,n){var r=t.length,a=o(t,e),t=d(t,e);if(0<(t-=a)&&e+a+t<=r)return{headerLength:a,frameLength:t,stamp:i+s*n}}Object.defineProperty(e,"__esModule",{value:!0});var u=i("./src/utils/logger.js"),h=i("./src/errors.js"),c=i("./src/events.js");e.getAudioConfig=r,e.isHeaderPattern=s,e.getHeaderLength=o,e.getFullFrameLength=d,e.isHeader=function(t,e){return!!(e+1<t.length&&s(t,e))},e.probe=function(t,e){if(e+1<t.length&&s(t,e)){var i=o(t,e),i=e+(i=e+5<t.length?d(t,e):i);if(i===t.length||i+1<t.length&&s(t,i))return!0}return!1},e.initTrackConfig=function(t,e,i,s,n){t.samplerate||(n=r(e,i,s,n),t.config=n.config,t.samplerate=n.samplerate,t.channelCount=n.channelCount,t.codec=n.codec,t.manifestCodec=n.manifestCodec,u.logger.log("parsed codec:"+t.codec+",rate:"+n.samplerate+",nb channel:"+n.channelCount))},e.getFrameDuration=a,e.parseFrameHeader=l,e.appendFrame=function(t,e,i,s,n){var r=l(e,i,s,n,a(t.samplerate));if(r){s=r.stamp,n=r.headerLength,r=r.frameLength,s={unit:e.subarray(i+n,i+n+r),pts:s,dts:s};return t.samples.push(s),t.len+=r,{sample:s,length:r+n}}}},"./src/demux/demuxer-inline.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v,D=i("./src/events.js"),T=i("./src/errors.js"),f=i("./src/crypt/decrypter.js"),I=i("./src/demux/aacdemuxer.js"),C=i("./src/demux/mp4demuxer.js"),b=i("./src/demux/tsdemuxer.js"),R=i("./src/demux/mp3demuxer.js"),P=i("./src/remux/mp4-remuxer.js"),M=i("./src/remux/passthrough-remuxer.js"),s=i("./src/utils/get-self-scope.js"),i=i("./src/utils/logger.js"),s=s.getSelfScope();try{v=s.performance.now.bind(s.performance)}catch(t){i.logger.debug("Unable to use Performance API on this environment"),v=s.Date.now}n.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},n.prototype.push=function(t,i,s,n,r,a,o,d,l,u,h,c){var e,p,g=this;0<t.byteLength&&null!=i&&null!=i.key&&"AES-128"===i.method?(null==(e=this.decrypter)&&(e=this.decrypter=new f.default(this.observer,this.config)),p=v(),e.decrypt(t,i.key.buffer,i.iv.buffer,function(t){var e=v();g.observer.trigger(D.default.FRAG_DECRYPTED,{stats:{tstart:p,tdecrypt:e}}),g.pushDecrypted(new Uint8Array(t),i,new Uint8Array(s),n,r,a,o,d,l,u,h,c)})):this.pushDecrypted(new Uint8Array(t),i,new Uint8Array(s),n,r,a,o,d,l,u,h,c)},n.prototype.pushDecrypted=function(t,e,i,s,n,r,a,o,d,l,u,h){if(!(y=this.demuxer)||(a||o)&&!this.probe(t)){for(var c=this.observer,p=this.typeSupported,g=this.config,v=[{demux:b.default,remux:P.default},{demux:C.default,remux:M.default},{demux:I.default,remux:P.default},{demux:R.default,remux:P.default}],f=0,_=v.length;f<_;f++){var E=v[f],m=E.demux.probe;if(m(t)){var A=this.remuxer=new E.remux(c,g,p,this.vendor),y=new E.demux(c,A,g,p);this.probe=m;break}}if(!y)return void c.trigger(D.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=y}var S=this.remuxer;(a||o)&&(y.resetInitSegment(i,s,n,l),S.resetInitSegment()),a&&(y.resetTimeStamp(h),S.resetTimeStamp(h)),"function"==typeof y.setDecryptData&&y.setDecryptData(e),y.append(t,r,d,u)},s=n;function n(t,e,i,s){this.observer=t,this.typeSupported=e,this.config=i,this.vendor=s}e.default=s},"./src/demux/demuxer-worker.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("./src/demux/demuxer-inline.js"),o=i("./src/events.js"),d=i("./src/utils/logger.js"),l=i("./node_modules/node-libs-browser/node_modules/events/events.js");e.default=function(s){var n=new l.EventEmitter;n.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];n.emit.apply(n,[t,t].concat(e))},n.off=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];n.removeListener.apply(n,[t].concat(e))};function r(t,e){s.postMessage({event:t,data:e})}s.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":var i=JSON.parse(e.config);s.demuxer=new a.default(n,e.typeSupported,i,e.vendor),d.enableLogs(i.debug),r("init",null);break;case"demux":s.demuxer.push(e.data,e.decryptdata,e.initSegment,e.audioCodec,e.videoCodec,e.timeOffset,e.discontinuity,e.trackSwitch,e.contiguous,e.duration,e.accurateTimeOffset,e.defaultInitPTS)}}),n.on(o.default.FRAG_DECRYPTED,r),n.on(o.default.FRAG_PARSING_INIT_SEGMENT,r),n.on(o.default.FRAG_PARSED,r),n.on(o.default.ERROR,r),n.on(o.default.FRAG_PARSING_METADATA,r),n.on(o.default.FRAG_PARSING_USERDATA,r),n.on(o.default.INIT_PTS_FOUND,r),n.on(o.default.FRAG_PARSING_DATA,function(t,e){var i=[],t={event:t,data:e};e.data1&&(t.data1=e.data1.buffer,i.push(e.data1.buffer),delete e.data1),e.data2&&(t.data2=e.data2.buffer,i.push(e.data2.buffer),delete e.data2),s.postMessage(t,i)})}},"./src/demux/demuxer.js":function(t,s,n){"use strict";!function(g){Object.defineProperty(s,"__esModule",{value:!0});var d=n("./node_modules/webworkify-webpack/index.js"),l=n("./src/events.js"),u=n("./src/demux/demuxer-inline.js"),v=n("./src/utils/logger.js"),h=n("./src/errors.js"),t=n("./src/utils/mediasource-helper.js"),e=n("./src/utils/get-self-scope.js"),c=n("./src/observer.js"),p=e.getSelfScope(),f=t.getMediaSource(),t=(i.prototype.destroy=function(){var t=this.w;t?(t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null):(e=this.demuxer)&&(e.destroy(),this.demuxer=null);var e=this.observer;e&&(e.removeAllListeners(),this.observer=null)},i.prototype.push=function(t,e,i,s,n,r,a,o){var d=this.w,l=g.isFinite(n.startPTS)?n.startPTS:n.start,u=n.decryptdata,h=this.frag,c=!(h&&n.cc===h.cc),p=!(h&&n.level===h.level),h=h&&n.sn===h.sn+1,h=!p&&h;c&&v.logger.log(this.id+":discontinuity detected"),p&&v.logger.log(this.id+":switch detected"),this.frag=n,d?d.postMessage({cmd:"demux",data:t,decryptdata:u,initSegment:e,audioCodec:i,videoCodec:s,timeOffset:l,discontinuity:c,trackSwitch:p,contiguous:h,duration:r,accurateTimeOffset:a,defaultInitPTS:o},t instanceof ArrayBuffer?[t]:[]):(d=this.demuxer)&&d.push(t,u,e,i,s,l,c,p,h,r,a,o)},i.prototype.onWorkerMessage=function(t){var e=t.data,i=this.hls;switch(e.event){case"init":p.URL.revokeObjectURL(this.w.objectURL);break;case l.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data)}},i);function i(i,t){var s=this;this.hls=i,this.id=t;var e=this.observer=new c.Observer,n=i.config,r=function(t,e){(e=e||{}).frag=s.frag,e.id=s.id,i.trigger(t,e)};e.on(l.default.FRAG_DECRYPTED,r),e.on(l.default.FRAG_PARSING_INIT_SEGMENT,r),e.on(l.default.FRAG_PARSING_DATA,r),e.on(l.default.FRAG_PARSED,r),e.on(l.default.ERROR,r),e.on(l.default.FRAG_PARSING_METADATA,r),e.on(l.default.FRAG_PARSING_USERDATA,r),e.on(l.default.INIT_PTS_FOUND,r);var a={mp4:f.isTypeSupported("video/mp4"),mpeg:f.isTypeSupported("audio/mpeg"),mp3:f.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(n.enableWorker&&"undefined"!=typeof Worker){v.logger.log("demuxing in webworker");r=void 0;try{r=this.w=d("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),r.addEventListener("message",this.onwmsg),r.onerror=function(t){i.trigger(l.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},r.postMessage({cmd:"init",typeSupported:a,vendor:o,id:t,config:JSON.stringify(n)})}catch(i){v.logger.warn("Error in worker:",i),v.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),r&&p.URL.revokeObjectURL(r.objectURL),this.demuxer=new u.default(e,a,n,o),this.w=void 0}}else this.demuxer=new u.default(e,a,n,o)}s.default=t}.call(this,n("./src/polyfills/number.js").Number)},"./src/demux/exp-golomb.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),i=(n.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,i=t.byteLength-e,s=new Uint8Array(4),e=Math.min(4,e);if(0===e)throw new Error("no bytes available");s.set(t.subarray(i,i+e)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},n.prototype.skipBits=function(t){var e;this.bitsAvailable>t||(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord()),this.word<<=t,this.bitsAvailable-=t},n.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return 32<t&&s.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,0<this.bitsAvailable?this.word<<=e:0<this.bytesAvailable&&this.loadWord(),0<(e=t-e)&&this.bitsAvailable?i<<e|this.readBits(e):i},n.prototype.skipLZ=function(){for(var t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},n.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},n.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},n.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},n.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},n.prototype.readBoolean=function(){return 1===this.readBits(1)},n.prototype.readUByte=function(){return this.readBits(8)},n.prototype.readUShort=function(){return this.readBits(16)},n.prototype.readUInt=function(){return this.readBits(32)},n.prototype.skipScalingList=function(t){for(var e=8,i=8,s=0;s<t;s++)e=0===(i=0!==i?(e+this.readEG()+256)%256:i)?e:i},n.prototype.readSPS=function(){var t,e,i,s,n=0,r=0,a=0,o=0,d=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),h=this.readBoolean.bind(this),c=this.skipBits.bind(this),p=this.skipEG.bind(this),g=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);if(d(),t=d(),l(5),c(3),d(),g(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var f=u();if(3===f&&c(1),g(),g(),c(1),h())for(i=3!==f?8:12,s=0;s<i;s++)h()&&v(s<6?16:64)}g();var f=u();if(0===f)u();else if(1===f)for(c(1),p(),p(),e=u(),s=0;s<e;s++)p();g(),c(1),f=u(),g=u(),0===(l=l(1))&&c(1),c(1),h()&&(n=u(),r=u(),a=u(),o=u());var _=[1,1];if(h()&&h())switch(d()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(f+1)-2*n-2*r),height:(2-l)*(g+1)*16-(l?2:4)*(a+o),pixelRatio:_}},n.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},n);function n(t){this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}e.default=i},"./src/demux/id3.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(o.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},o.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},o.getID3Data=function(t,e){for(var i=e,s=0;o.isHeader(t,e);)s+=10,s+=o._readSize(t,e+6),o.isFooter(t,e+10)&&(s+=10),e+=s;if(0<s)return t.subarray(i,i+s)},o._readSize=function(t,e){var i=0,i=(127&t[e])<<21;return i|=(127&t[e+1])<<14,(i|=(127&t[e+2])<<7)|127&t[e+3]},o.getTimeStamp=function(t){for(var e=o.getID3Frames(t),i=0;i<e.length;i++){var s=e[i];if(o.isTimeStampFrame(s))return o._readTimeStamp(s)}},o.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},o._getFrameData=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),i=o._readSize(t,4);return{type:e,size:i,data:t.subarray(10,10+i)}},o.getID3Frames=function(t){for(var e=0,i=[];o.isHeader(t,e);){for(var s=o._readSize(t,e+6),n=(e+=10)+s;e+8<n;){var r=o._getFrameData(t.subarray(e)),a=o._decodeFrame(r);a&&i.push(a),e+=r.size+10}o.isFooter(t,e)&&(e+=10)}return i},o._decodeFrame=function(t){return"PRIV"===t.type?o._decodePrivFrame(t):"T"===t.type[0]?o._decodeTextFrame(t):"W"===t.type[0]?o._decodeURLFrame(t):void 0},o._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),t=1&e[3],e=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return e/=45,t&&(e+=47721858.84),Math.round(e)}},o._decodePrivFrame=function(t){if(!(t.size<2)){var e=o._utf8ArrayToStr(t.data,!0),i=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:i.buffer}}},o._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,i=o._utf8ArrayToStr(t.data.subarray(1));e+=i.length+1;e=o._utf8ArrayToStr(t.data.subarray(e));return{key:t.type,info:i,data:e}}e=o._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:e}}},o._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,i=o._utf8ArrayToStr(t.data.subarray(1));e+=i.length+1;e=o._utf8ArrayToStr(t.data.subarray(e));return{key:t.type,info:i,data:e}}e=o._utf8ArrayToStr(t.data);return{key:t.type,data:e}},o._utf8ArrayToStr=function(t,e){void 0===e&&(e=!1);for(var i,s,n,r=t.length,a="",o=0;o<r;){if(0===(i=t[o++])&&e)return a;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:s=t[o++],a+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=t[o++],n=t[o++],a+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&n)<<0)}}return a},o);function o(){}e.utf8ArrayToStr=s._utf8ArrayToStr,e.default=s},"./src/demux/mp3demuxer.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=i("./src/demux/id3.js"),n=i("./src/utils/logger.js"),v=i("./src/demux/mpegaudio.js"),i=(s.prototype.resetInitSegment=function(t,e,i,s){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:s,inputTimeScale:9e4}},s.prototype.resetTimeStamp=function(){},s.probe=function(t){var e,i,s=g.default.getID3Data(t,0);if(s&&void 0!==g.default.getTimeStamp(s))for(e=s.length,i=Math.min(t.length-1,e+100);e<i;e++)if(v.default.probe(t,e))return n.logger.log("MPEG Audio sync word found !"),!0;return!1},s.prototype.append=function(t,e,i,s){for(var n=g.default.getID3Data(t,0),r=g.default.getTimeStamp(n),a=r?90*r:9e4*e,o=n.length,d=t.length,l=0,u=0,h=this._audioTrack,c=[{pts:a,dts:a,data:n}];o<d;)if(v.default.isHeader(t,o)){var p=v.default.appendFrame(h,t,o,a,l);if(!p)break;o+=p.length,u=p.sample.pts,l++}else g.default.isHeader(t,o)?(n=g.default.getID3Data(t,o),c.push({pts:u,dts:u,data:n}),o+=n.length):o++;this.remuxer.remux(h,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},e,i,s)},s.prototype.destroy=function(){},s);function s(t,e,i){this.observer=t,this.config=i,this.remuxer=e}e.default=i},"./src/demux/mp4demuxer.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i("./src/utils/logger.js"),o=i("./src/events.js"),a=Math.pow(2,32)-1,i=(c.prototype.resetTimeStamp=function(t){this.initPTS=t},c.prototype.resetInitSegment=function(t,e,i,s){var n,r;t&&t.byteLength?(null==e&&(e="mp4a.40.5"),null==i&&(i="avc1.42e01e"),r={},(n=this.initData=c.parseInitSegment(t)).audio&&n.video?r.audiovideo={container:"video/mp4",codec:e+","+i,initSegment:s?t:null}:(n.audio&&(r.audio={container:"audio/mp4",codec:e,initSegment:s?t:null}),n.video&&(r.video={container:"video/mp4",codec:i,initSegment:s?t:null})),this.observer.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,{tracks:r})):(e&&(this.audioCodec=e),i&&(this.videoCodec=i))},c.probe=function(t){return 0<c.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length},c.bin2str=function(t){return String.fromCharCode.apply(null,t)},c.readUint16=function(t,e){t.data&&(e+=t.start,t=t.data);e=t[e]<<8|t[e+1];return e<0?65536+e:e},c.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);e=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return e<0?4294967296+e:e},c.writeUint32=function(t,e,i){t.data&&(e+=t.start,t=t.data),t[e]=i>>24,t[e+1]=i>>16&255,t[e+2]=i>>8&255,t[e+3]=255&i},c.findBox=function(t,e){var i,s,n,r,a,o=[];if(t.data?(r=t.start,s=t.end,t=t.data):(r=0,s=t.byteLength),!e.length)return null;for(i=r;i<s;)a=1<(n=c.readUint32(t,i))?i+n:s,c.bin2str(t.subarray(i+4,i+8))===e[0]&&(1===e.length?o.push({data:t,start:i+8,end:a}):(n=c.findBox({data:t,start:i+8,end:a},e.slice(1))).length&&(o=o.concat(n))),i=a;return o},c.parseSegmentIndex=function(t){var e=c.findBox(t,["moov"])[0],e=e?e.end:null,i=0,s=c.findBox(t,["sidx"]);if(!s||!s[0])return null;var n=[],t=(s=s[0]).data[0],i=0===t?8:16,r=c.readUint32(s,i);i+=4;i+=0===t?8:16;var a=s.end+0,o=c.readUint16(s,i+=2);i+=2;for(var d=0;d<o;d++){var l=i,u=c.readUint32(s,l);l+=4;var h=2147483647&u;if(1==(2147483648&u)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");u=c.readUint32(s,l);l+=4,n.push({referenceSize:h,subsegmentDuration:u,info:{duration:u/r,start:a,end:a+h-1}}),a+=h,i=l+=4}return{earliestPresentationTime:0,timescale:r,version:t,referencesCount:o,references:n,moovEndOffset:e}},c.parseInitSegment=function(t){var n=[];return c.findBox(t,["moov","trak"]).forEach(function(t){var e,i,s=c.findBox(t,["tkhd"])[0];s&&(i=s.data[s.start],e=c.readUint32(s,0===i?12:20),(s=c.findBox(t,["mdia","mdhd"])[0])&&(i=s.data[s.start],s=c.readUint32(s,0===i?12:20),!(i=c.findBox(t,["mdia","hdlr"])[0])||(i={soun:"audio",vide:"video"}[c.bin2str(i.data.subarray(i.start+8,i.start+12))])&&((t=c.findBox(t,["mdia","minf","stbl","stsd"])).length&&(t=t[0],t=c.bin2str(t.data.subarray(t.start+12,t.start+16)),r.logger.log("MP4Demuxer:"+i+":"+t+" found")),n[e]={timescale:s,type:i},n[i]={timescale:s,id:e})))}),n},c.getStartDTS=function(i,t){var t=c.findBox(t,["moof","traf"]),t=[].concat.apply([],t.map(function(e){return c.findBox(e,["tfhd"]).map(function(t){var t=c.readUint32(t,4),t=i[t].timescale||9e4;return c.findBox(e,["tfdt"]).map(function(t){var e=t.data[t.start],i=c.readUint32(t,4);return 1===e&&(i*=Math.pow(2,32),i+=c.readUint32(t,8)),i})[0]/t})})),t=Math.min.apply(null,t);return isFinite(t)?t:0},c.offsetStartDTS=function(i,t,n){c.findBox(t,["moof","traf"]).map(function(e){return c.findBox(e,["tfhd"]).map(function(t){var t=c.readUint32(t,4),s=i[t].timescale||9e4;c.findBox(e,["tfdt"]).map(function(t){var e=t.data[t.start],i=c.readUint32(t,4);0===e?c.writeUint32(t,4,i-n*s):(i*=Math.pow(2,32),i+=c.readUint32(t,8),i-=n*s,i=Math.max(i,0),e=Math.floor(i/(1+a)),i=Math.floor(i%(1+a)),c.writeUint32(t,4,e),c.writeUint32(t,8,i))})})})},c.prototype.append=function(t,e,i,s){var n=this.initData;n||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),n=this.initData);var r,a=this.initPTS;void 0===a&&(r=c.getStartDTS(n,t),this.initPTS=a=r-e,this.observer.trigger(o.default.INIT_PTS_FOUND,{initPTS:a})),c.offsetStartDTS(n,t,a),a=c.getStartDTS(n,t),this.remuxer.remux(n.audio,n.video,null,null,a,i,s,t)},c.prototype.destroy=function(){},c);function c(t,e){this.observer=t,this.remuxer=e}e.default=i},"./src/demux/mpegaudio.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,i,s,n){if(!(i+24>e.length)){var r=this.parseHeader(e,i);if(r&&i+r.frameLength<=e.length){n=s+n*(9e4*r.samplesPerFrame/r.sampleRate),n={unit:e.subarray(i,i+r.frameLength),pts:n,dts:n};return t.config=[],t.channelCount=r.channelCount,t.samplerate=r.sampleRate,t.samples.push(n),t.len+=r.frameLength,{sample:n,length:r.frameLength}}}},parseHeader:function(t,e){var i=t[e+1]>>3&3,s=t[e+1]>>1&3,n=t[e+2]>>4&15,r=t[e+2]>>2&3,a=t[e+2]>>1&1;if(1!=i&&0!=n&&15!=n&&3!=r){n=1e3*o.BitratesMap[14*(3==i?3-s:3==s?3:4)+n-1],r=o.SamplingRateMap[3*(3==i?0:2==i?1:2)+r],t=t[e+3]>>6==3?1:2,e=o.SamplesCoefficients[i][s],i=o.BytesInSlot[s],s=8*e*i;return{sampleRate:r,channelCount:t,frameLength:parseInt(e*n/r+a,10)*i,samplesPerFrame:s}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var i=this.parseHeader(t,e),s=4,s=e+(s=i&&i.frameLength?i.frameLength:s);if(s===t.length||s+1<t.length&&this.isHeaderPattern(t,s))return!0}return!1}};e.default=o},"./src/demux/sample-aes.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/crypt/decrypter.js"),i=(s.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},s.prototype.decryptAacSample=function(e,i,s,n){var r=e[i].unit,t=r.subarray(16,r.length-r.length%16),t=t.buffer.slice(t.byteOffset,t.byteOffset+t.length),a=this;this.decryptBuffer(t,function(t){t=new Uint8Array(t),r.set(t,16),n||a.decryptAacSamples(e,i+1,s)})},s.prototype.decryptAacSamples=function(t,e,i){for(;;e++){if(e>=t.length)return void i();if(!(t[e].unit.length<32)){var s=this.decrypter.isSync();if(this.decryptAacSample(t,e,i,s),!s)return}}},s.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,i=new Int8Array(e),s=0,n=32;n<=t.length-16;n+=160,s+=16)i.set(t.subarray(n,n+16),s);return i},s.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var i=0,s=32;s<=t.length-16;s+=160,i+=16)t.set(e.subarray(i,i+16),s);return t},s.prototype.decryptAvcSample=function(e,i,s,n,r,a){var o=this.discardEPB(r.data),t=this.getAvcEncryptedData(o),d=this;this.decryptBuffer(t.buffer,function(t){r.data=d.getAvcDecryptedUnit(o,t),a||d.decryptAvcSamples(e,i,s+1,n)})},s.prototype.decryptAvcSamples=function(t,e,i,s){for(;;e++,i=0){if(e>=t.length)return void s();for(var n=t[e].units;!(i>=n.length);i++){var r=n[i];if(!(r.length<=48||1!==r.type&&5!==r.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(t,e,i,s,r,a),!a)return}}}},s);function s(t,e,i,s){this.decryptdata=i,this.discardEPB=s,this.decrypter=new n.default(t,e,{removePKCS7Padding:!1})}e.default=i},"./src/demux/tsdemuxer.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=i("./src/demux/adts.js"),o=i("./src/demux/mpegaudio.js"),O=i("./src/events.js"),D=i("./src/demux/exp-golomb.js"),s=i("./src/demux/sample-aes.js"),L=i("./src/utils/logger.js"),N=i("./src/errors.js"),n={video:1,audio:2,id3:3,text:4},i=(k.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new s.default(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},k.probe=function(t){t=k._syncOffset(t);return!(t<0||(t&&L.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),0))},k._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),i=0;i<e;){if(71===t[i]&&71===t[i+188]&&71===t[i+376])return i;i++}return-1},k.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:n[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},k.prototype.resetInitSegment=function(t,e,i,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=k.createTrack("video",s),this._audioTrack=k.createTrack("audio",s),this._id3Track=k.createTrack("id3",s),this._txtTrack=k.createTrack("text",s),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=e,this.videoCodec=i,this._duration=s},k.prototype.resetTimeStamp=function(){},k.prototype.append=function(t,e,i,s){var n,r,a,o,d,l=t.length,u=!1;this.contiguous=i;var h=this.pmtParsed,c=this._avcTrack,p=this._audioTrack,g=this._id3Track,v=c.pid,f=p.pid,_=g.pid,E=this._pmtId,m=c.pesData,A=p.pesData,y=g.pesData,S=this._parsePAT,D=this._parsePMT,T=this._parsePES,I=this._parseAVCPES.bind(this),C=this._parseAACPES.bind(this),b=this._parseMPEGPES.bind(this),R=this._parseID3PES.bind(this),P=k._syncOffset(t);for(l-=(l+P)%188,n=P;n<l;n+=188)if(71===t[n]){if(r=!!(64&t[n+1]),a=((31&t[n+1])<<8)+t[n+2],1<(48&t[n+3])>>4){if((o=n+5+t[n+4])===n+188)continue}else o=n+4;switch(a){case v:r&&(m&&(d=T(m))&&void 0!==d.pts&&I(d,!1),m={data:[],size:0}),m&&(m.data.push(t.subarray(o,n+188)),m.size+=n+188-o);break;case f:r&&(A&&(d=T(A))&&void 0!==d.pts&&(p.isAAC?C:b)(d),A={data:[],size:0}),A&&(A.data.push(t.subarray(o,n+188)),A.size+=n+188-o);break;case _:r&&(y&&(d=T(y))&&void 0!==d.pts&&R(d),y={data:[],size:0}),y&&(y.data.push(t.subarray(o,n+188)),y.size+=n+188-o);break;case 0:r&&(o+=t[o]+1),E=this._pmtId=S(t,o);break;case E:r&&(o+=t[o]+1);var M=D(t,o,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(v=M.avc)&&(c.pid=v),0<(f=M.audio)&&(p.pid=f,p.isAAC=M.isAAC),0<(_=M.id3)&&(g.pid=_),u&&!h&&(L.logger.log("reparse from beginning"),u=!1,n=P-188),h=this.pmtParsed=!0;break;case 17:case 8191:break;default:u=!0}}else this.observer.trigger(O.default.ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});m&&(d=T(m))&&void 0!==d.pts?(I(d,!0),c.pesData=null):c.pesData=m,A&&(d=T(A))&&void 0!==d.pts?((p.isAAC?C:b)(d),p.pesData=null):(A&&A.size&&L.logger.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=A),y&&(d=T(y))&&void 0!==d.pts?(R(d),g.pesData=null):g.pesData=y,null==this.sampleAes?this.remuxer.remux(p,c,g,this._txtTrack,e,i,s):this.decryptAndRemux(p,c,g,this._txtTrack,e,i,s)},k.prototype.decryptAndRemux=function(t,e,i,s,n,r,a){var o;t.samples&&t.isAAC?(o=this).sampleAes.decryptAacSamples(t.samples,0,function(){o.decryptAndRemuxAvc(t,e,i,s,n,r,a)}):this.decryptAndRemuxAvc(t,e,i,s,n,r,a)},k.prototype.decryptAndRemuxAvc=function(t,e,i,s,n,r,a){var o;e.samples?(o=this).sampleAes.decryptAvcSamples(e.samples,0,0,function(){o.remuxer.remux(t,e,i,s,n,r,a)}):this.remuxer.remux(t,e,i,s,n,r,a)},k.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},k.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},k.prototype._parsePMT=function(t,e,i,s){var n,r={audio:-1,avc:-1,id3:-1,isAAC:!0},a=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<a;){switch(n=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!s){L.logger.log("unkown stream type:"+t[e]);break}case 15:-1===r.audio&&(r.audio=n);break;case 21:-1===r.id3&&(r.id3=n);break;case 219:if(!s){L.logger.log("unkown stream type:"+t[e]);break}case 27:-1===r.avc&&(r.avc=n);break;case 3:case 4:i?-1===r.audio&&(r.audio=n,r.isAAC=!1):L.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:L.logger.warn("HEVC stream type found, not supported for now");break;default:L.logger.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return r},k.prototype._parsePES=function(t){var e,i,s,n,r,a=0,o=t.data;if(!t||0===t.size)return null;for(;o[0].length<19&&1<o.length;){var d=new Uint8Array(o[0].length+o[1].length);d.set(o[0]),d.set(o[1],o[0].length),o[0]=d,o.splice(1,1)}if(1!==((c=o[0])[0]<<16)+(c[1]<<8)+c[2])return null;if((e=(c[4]<<8)+c[5])&&e>t.size-6)return null;192&(i=c[7])&&(4294967295<(s=536870912*(14&c[9])+4194304*(255&c[10])+16384*(254&c[11])+128*(255&c[12])+(254&c[13])/2)&&(s-=8589934592),64&i?(4294967295<(n=536870912*(14&c[14])+4194304*(255&c[15])+16384*(254&c[16])+128*(255&c[17])+(254&c[18])/2)&&(n-=8589934592),54e5<s-n&&(L.logger.warn(Math.round((s-n)/9e4)+"s delta between PTS and DTS, align them"),s=n)):n=s),i=c[8],t.size-=r=i+9;for(var l=new Uint8Array(t.size),u=0,h=o.length;u<h;u++){var c,p=(c=o[u]).byteLength;if(r){if(p<r){r-=p;continue}c=c.subarray(r),p-=r,r=0}l.set(c,a),a+=p}return e&&(e-=i+3),{data:l,pts:s,dts:n,len:e}},k.prototype.pushAccesUnit=function(t,e){var i,s;t.units.length&&t.frame&&(s=(i=e.samples).length,!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(s||this.contiguous)?(t.id=s,i.push(t)):e.dropped++),t.debug.length&&L.logger.log(t.pts+"/"+t.dts+":"+t.debug)},k.prototype._parseAVCPES=function(p,t){function g(t,e,i,s){return{key:t,pts:e,dts:i,units:[],debug:s}}var v,f,_,E=this,m=this._avcTrack,e=this._parseAVCNALu(p.data),A=this.avcSample,y=!1,S=this.pushAccesUnit.bind(this);p.data=null,A&&e.length&&!m.audFound&&(S(A,m),A=this.avcSample=g(!1,p.pts,p.dts,"")),e.forEach(function(t){switch(t.type){case 1:f=!0,(A=A||(E.avcSample=g(!0,p.pts,p.dts,""))).frame=!0;var e=t.data;y&&4<e.length&&(2!==(l=new D.default(e).readSliceType())&&4!==l&&7!==l&&9!==l||(A.key=!0));break;case 5:f=!0,(A=A||(E.avcSample=g(!0,p.pts,p.dts,""))).key=!0,A.frame=!0;break;case 6:f=!0,(v=new D.default(E.discardEPB(t.data))).readUByte();for(var i=0,s=0,n=!1,r=0;!n&&1<v.bytesAvailable;){for(i=0;i+=r=v.readUByte(),255===r;);for(s=0;s+=r=v.readUByte(),255===r;);if(4===i&&0!==v.bytesAvailable){if(n=!0,181===v.readUByte()&&49===v.readUShort()&&1195456820===v.readUInt()&&3===v.readUByte()){var a=v.readUByte(),o=31&a,d=[a,v.readUByte()];for(_=0;_<o;_++)d.push(v.readUByte()),d.push(v.readUByte()),d.push(v.readUByte());E._insertSampleInOrder(E._txtTrack.samples,{type:3,pts:p.pts,bytes:d})}}else if(s<v.bytesAvailable)for(_=0;_<s;_++)v.readUByte()}break;case 7:if(y=f=!0,!m.sps){var l=(v=new D.default(t.data)).readSPS();m.width=l.width,m.height=l.height,m.pixelRatio=l.pixelRatio,m.sps=[t.data],m.duration=E._duration;var u=t.data.subarray(1,4),h="avc1.";for(_=0;_<3;_++){var c=u[_].toString(16);h+=c=c.length<2?"0"+c:c}m.codec=h}break;case 8:f=!0,m.pps||(m.pps=[t.data]);break;case 9:f=!1,m.audFound=!0,A&&S(A,m),A=E.avcSample=g(!1,p.pts,p.dts,"");break;case 12:f=!1;break;default:f=!1,A&&(A.debug+="unknown NAL "+t.type+" ")}A&&f&&A.units.push(t)}),t&&A&&(S(A,m),this.avcSample=null)},k.prototype._insertSampleInOrder=function(t,e){var i=t.length;if(0<i){if(e.pts>=t[i-1].pts)t.push(e);else for(var s=i-1;0<=s;s--)if(e.pts<t[s].pts){t.splice(s,0,e);break}}else t.push(e)},k.prototype._getLastNalUnit=function(){var t,e,i=this.avcSample;return e=(i=!i||0===i.units.length?(t=this._avcTrack.samples)[t.length-1]:i)?(i=i.units)[i.length-1]:e},k.prototype._parseAVCNALu=function(t){var e,i,s,n,r,a,o=0,d=t.byteLength,l=this._avcTrack,u=l.naluState||0,h=u,c=[],p=-1;for(-1===u&&(n=31&t[p=0],u=0,o=1);o<d;)e=t[o++],u=u?1!==u?e?1===e?(0<=p?(s={data:t.subarray(p,o-u-1),type:n},c.push(s)):(r=this._getLastNalUnit())&&(h&&o<=4-h&&r.state&&(r.data=r.data.subarray(0,r.data.byteLength-h)),0<(i=o-u-1))&&((a=new Uint8Array(r.data.byteLength+i)).set(r.data,0),a.set(t.subarray(0,i),r.data.byteLength),r.data=a),o<d?(n=31&t[p=o],0):-1):0:3:e?0:2:e?0:1;return 0<=p&&0<=u&&(s={data:t.subarray(p,d),type:n,state:u},c.push(s)),0!==c.length||(r=this._getLastNalUnit())&&((a=new Uint8Array(r.data.byteLength+t.byteLength)).set(r.data,0),a.set(t,r.data.byteLength),r.data=a),l.naluState=u,c},k.prototype.discardEPB=function(t){for(var e=t.byteLength,i=[],s=1;s<e-2;)0===t[s]&&0===t[s+1]&&3===t[s+2]?(i.push(s+2),s+=2):s++;if(0===i.length)return t;for(var n=e-i.length,r=new Uint8Array(n),a=0,s=0;s<n;a++,s++)a===i[0]&&(a++,i.shift()),r[s]=t[a];return r},k.prototype._parseAACPES=function(t){var e,i,s,n,r=this._audioTrack,a=t.data,o=t.pts,d=this.aacOverFlow,t=this.aacLastPTS;for(d&&((l=new Uint8Array(d.byteLength+a.byteLength)).set(d,0),l.set(a,d.byteLength),a=l),i=0,n=a.length;i<n-1&&!c.isHeader(a,i);i++);if(i){var l=void 0,u=void 0,u=i<n-1?(l="AAC PES did not start with ADTS header,offset:"+i,!1):(l="no ADTS header found in AAC PES",!0);if(L.logger.warn("parsing error:"+l),this.observer.trigger(O.default.ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.FRAG_PARSING_ERROR,fatal:u,reason:l}),u)return}for(c.initTrackConfig(r,this.observer,a,i,this.audioCodec),e=0,u=c.getFrameDuration(r.samplerate),d&&t&&(u=t+u,1<Math.abs(u-o)&&(L.logger.log("AAC: align PTS for overlapping frames by "+Math.round((u-o)/90)),o=u));i<n;)if(c.isHeader(a,i)&&i+5<n){var h=c.appendFrame(r,a,i,o,e);if(!h)break;i+=h.length,s=h.sample.pts,e++}else i++;d=i<n?a.subarray(i,n):null,this.aacOverFlow=d,this.aacLastPTS=s},k.prototype._parseMPEGPES=function(t){for(var e=t.data,i=e.length,s=0,n=0,r=t.pts;n<i;)if(o.default.isHeader(e,n)){var a=o.default.appendFrame(this._audioTrack,e,n,r,s);if(!a)break;n+=a.length,s++}else n++},k.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},k);function k(t,e,i,s){this.observer=t,this.config=i,this.typeSupported=s,this.remuxer=e,this.sampleAes=null}e.default=i},"./src/errors.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},e.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/event-handler.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/logger.js"),n=i("./src/errors.js"),r=i("./src/events.js"),a={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},i=(o.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},o.prototype.onHandlerDestroying=function(){},o.prototype.onHandlerDestroyed=function(){},o.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},o.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if(a[t])throw new Error("Forbidden event-name: "+t);this.hls.on(t,this.onEvent)},this)},o.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},o.prototype.onEvent=function(t,e){this.onEventGeneric(t,e)},o.prototype.onEventGeneric=function(t,e){try{!function(t,e){var i="on"+t.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,e)}.call(this,t,e).call()}catch(e){s.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.hls.trigger(r.default.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},o);function o(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.hls=t,this.onEvent=this.onEvent.bind(this),this.handledEvents=e,this.useGenericHandler=!0,this.registerListeners()}e.default=i},"./src/events.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},"./src/hls.js":function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var f,r=i("./node_modules/url-toolkit/src/url-toolkit.js"),a=i("./src/errors.js"),_=i("./src/loader/playlist-loader.js"),E=i("./src/loader/fragment-loader.js"),m=i("./src/loader/key-loader.js"),A=i("./src/controller/fragment-tracker.js"),y=i("./src/controller/stream-controller.js"),S=i("./src/controller/level-controller.js"),D=i("./src/controller/id3-track-controller.js"),o=i("./src/is-supported.js"),T=i("./src/utils/logger.js"),d=i("./src/config.js"),l=i("./src/events.js"),i=i("./src/observer.js"),n=(f=i.Observer,n(I,f),Object.defineProperty(I,"version",{get:function(){return"0.12.4"},enumerable:!0,configurable:!0}),I.isSupported=function(){return o.isSupported()},Object.defineProperty(I,"Events",{get:function(){return l.default},enumerable:!0,configurable:!0}),Object.defineProperty(I,"ErrorTypes",{get:function(){return a.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(I,"ErrorDetails",{get:function(){return a.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(I,"DefaultConfig",{get:function(){return I.defaultConfig||d.hlsDefaultConfig},set:function(t){I.defaultConfig=t},enumerable:!0,configurable:!0}),I.prototype.destroy=function(){T.logger.log("destroy"),this.trigger(l.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},I.prototype.attachMedia=function(t){T.logger.log("attachMedia"),this.media=t,this.trigger(l.default.MEDIA_ATTACHING,{media:t})},I.prototype.detachMedia=function(){T.logger.log("detachMedia"),this.trigger(l.default.MEDIA_DETACHING),this.media=null},I.prototype.loadSource=function(t){t=r.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),T.logger.log("loadSource:"+t),this.url=t,this.trigger(l.default.MANIFEST_LOADING,{url:t})},I.prototype.startLoad=function(e){void 0===e&&(e=-1),T.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},I.prototype.stopLoad=function(){T.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},I.prototype.swapAudioCodec=function(){T.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},I.prototype.recoverMediaError=function(){T.logger.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)},Object.defineProperty(I.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(t){T.logger.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(t){T.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(t){T.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){T.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(t){T.logger.log("set startLevel:"+t);-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(t){T.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"minAutoLevel",{get:function(){for(var t=this.levels,e=this.config.minAutoBitrate,i=t?t.length:0,s=0;s<i;s++)if((t[s].realBitrate?Math.max(t[s].realBitrate,t[s].bitrate):t[s].bitrate)>e)return s;return 0},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"maxAutoLevel",{get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"nextAutoLevel",{get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"audioTracks",{get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"audioTrack",{get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"subtitleTracks",{get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"subtitleTrack",{get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"subtitleDisplay",{get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)},enumerable:!0,configurable:!0}),I);function I(t){void 0===t&&(t={});var e,i=f.call(this)||this,s=I.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(e in s)e in t||(t[e]=s[e]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');T.enableLogs(t.debug),i.config=t,i._autoLevelCapping=-1;var n=i.abrController=new t.abrController(i),r=new t.bufferController(i),a=new t.capLevelController(i),o=new t.fpsController(i),d=new _.default(i),l=new E.default(i),u=new m.default(i),h=new D.default(i),c=i.levelController=new S.default(i),p=new A.FragmentTracker(i),g=[c,i.streamController=new y.default(i,p)],c=t.audioStreamController;c&&g.push(new c(i,p)),i.networkControllers=g;var v,o=[d,l,u,n,r,a,o,h,p];return(c=t.audioTrackController)&&(h=new c(i),i.audioTrackController=h,o.push(h)),(c=t.subtitleTrackController)&&(v=new c(i),i.subtitleTrackController=v,g.push(v)),(c=t.emeController)&&(v=new c(i),i.emeController=v,o.push(v)),(c=t.subtitleStreamController)&&g.push(new c(i,p)),(c=t.timelineController)&&o.push(new c(i)),i.coreComponents=o,i}e.default=n},"./src/is-supported.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./src/utils/mediasource-helper.js");e.isSupported=function(){var t=s.getMediaSource(),e=window.SourceBuffer||window.WebKitSourceBuffer,t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!t&&!!e}},"./src/loader/fragment-loader.js":function(t,l,u){"use strict";!function(o){var s,t=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(l,"__esModule",{value:!0});var n,r=u("./src/events.js"),e=u("./src/event-handler.js"),a=u("./src/errors.js"),d=u("./src/utils/logger.js"),t=(n=e.default,t(i,n),i.prototype.destroy=function(){var t,e=this.loaders;for(t in e){var i=e[t];i&&i.destroy()}this.loaders={},n.prototype.destroy.call(this)},i.prototype.onFragLoading=function(t){var e=t.frag,i=e.type,s=this.loaders,n=this.hls.config,r=n.fLoader,a=n.loader;e.loaded=0,(t=s[i])&&(d.logger.warn("abort previous fragment loader for type: "+i),t.abort());var t=s[i]=e.loader=new(n.fLoader?r:a)(n),r={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1},a=e.byteRangeStartOffset,e=e.byteRangeEndOffset;o.isFinite(a)&&o.isFinite(e)&&(r.rangeStart=a,r.rangeEnd=e),e={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},n={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},t.load(r,e,n)},i.prototype.loadsuccess=function(t,e,i,s){void 0===s&&(s=null);t=t.data,i=i.frag;i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(r.default.FRAG_LOADED,{payload:t,frag:i,stats:e,networkDetails:s})},i.prototype.loaderror=function(t,e,i){void 0===i&&(i=null);var s=e.frag,n=s.loader;n&&n.abort(),this.loaders[s.type]=void 0,this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:i})},i.prototype.loadtimeout=function(t,e,i){void 0===i&&(i=null);var s=e.frag,n=s.loader;n&&n.abort(),this.loaders[s.type]=void 0,this.hls.trigger(r.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:i})},i.prototype.loadprogress=function(t,e,i,s){void 0===s&&(s=null);e=e.frag;e.loaded=t.loaded,this.hls.trigger(r.default.FRAG_LOAD_PROGRESS,{frag:e,stats:t,networkDetails:s})},i);function i(t){t=n.call(this,t,r.default.FRAG_LOADING)||this;return t.loaders={},t}l.default=t}.call(this,u("./src/polyfills/number.js").Number)},"./src/loader/fragment.js":function(t,r,a){"use strict";!function(e){Object.defineProperty(r,"__esModule",{value:!0});var t=a("./node_modules/url-toolkit/src/url-toolkit.js"),s=a("./src/loader/level-key.js"),i=(Object.defineProperty(n,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=t.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var t,e,i=[];return this.rawByteRange&&(1===(t=this.rawByteRange.split("@",2)).length?(e=this.lastByteRangeEndOffset,i[0]=e||0):i[0]=parseInt(t[1]),i[1]=parseInt(t[0])+i[0],this._byteRange=i),i},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endProgramDateTime",{get:function(){if(!e.isFinite(this.programDateTime))return null;var t=e.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),n.prototype.addElementaryStream=function(t){this._elementaryStreams[t]=!0},n.prototype.hasElementaryStream=function(t){return!0===this._elementaryStreams[t]},n.prototype.createInitializationVector=function(t){for(var e=new Uint8Array(16),i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e},n.prototype.fragmentDecryptdataFromLevelkey=function(t,e){var i=t;return t&&t.method&&t.uri&&!t.iv&&((i=new s.default).method=t.method,i.baseuri=t.baseuri,i.reluri=t.reluri,i.iv=this.createInitializationVector(e)),i},n);function n(){var t;this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=((t={})[n.ElementaryStreamTypes.AUDIO]=!1,t[n.ElementaryStreamTypes.VIDEO]=!1,t)}r.default=i}.call(this,a("./src/polyfills/number.js").Number)},"./src/loader/key-loader.js":function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r,o=i("./src/events.js"),a=i("./src/event-handler.js"),d=i("./src/errors.js"),l=i("./src/utils/logger.js"),n=(r=a.default,n(u,r),u.prototype.destroy=function(){for(var t in this.loaders){t=this.loaders[t];t&&t.destroy()}this.loaders={},a.default.prototype.destroy.call(this)},u.prototype.onKeyLoading=function(t){var e,i=t.frag,s=i.type,n=this.loaders[s],r=i.decryptdata,a=r.uri;a!==this.decrypturl||null===this.decryptkey?(e=this.hls.config,n&&(l.logger.warn("abort previous key loader for type:"+s),n.abort()),i.loader=this.loaders[s]=new e.loader(e),this.decrypturl=a,this.decryptkey=null,s=n=t=void 0,t={url:a,frag:i,responseType:"arraybuffer"},n={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:e.fragLoadingRetryDelay,maxRetryDelay:e.fragLoadingMaxRetryTimeout},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},i.loader.load(t,n,s)):this.decryptkey&&(r.key=this.decryptkey,this.hls.trigger(o.default.KEY_LOADED,{frag:i}))},u.prototype.loadsuccess=function(t,e,i){i=i.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(t.data),i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(o.default.KEY_LOADED,{frag:i})},u.prototype.loaderror=function(t,e){var i=e.frag,s=i.loader;s&&s.abort(),this.loaders[e.type]=void 0,this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:t})},u.prototype.loadtimeout=function(t,e){var i=e.frag,s=i.loader;s&&s.abort(),this.loaders[e.type]=void 0,this.hls.trigger(o.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},u);function u(t){t=r.call(this,t,o.default.KEY_LOADING)||this;return t.loaders={},t.decryptkey=null,t.decrypturl=null,t}e.default=n},"./src/loader/level-key.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("./node_modules/url-toolkit/src/url-toolkit.js"),i=(Object.defineProperty(n.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=s.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,configurable:!0}),n);function n(){this.method=null,this.key=null,this.iv=null,this._uri=null}e.default=i},"./src/loader/level.js":function(t,s,e){"use strict";!function(t){Object.defineProperty(s,"__esModule",{value:!0});var e=(Object.defineProperty(i.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!t.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),i);function i(t){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=t,this.version=null}s.default=e}.call(this,e("./src/polyfills/number.js").Number)},"./src/loader/m3u8-parser.js":function(t,e,s){"use strict";!function(T){Object.defineProperty(e,"__esModule",{value:!0});var i=s("./node_modules/url-toolkit/src/url-toolkit.js"),I=s("./src/loader/fragment.js"),C=s("./src/loader/level.js"),b=s("./src/loader/level-key.js"),R=s("./src/utils/attr-list.js"),P=s("./src/utils/logger.js"),a=s("./src/utils/codecs.js"),o=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,d=/#EXT-X-MEDIA:(.*)/g,M=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),O=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,L=/\.(mp4|m4s|m4v|m4a)$/i,t=(l.findGroup=function(t,e){if(!t)return null;for(var i=null,s=0;s<t.length;s++){var n=t[s];n.id===e&&(i=n)}return i},l.convertAVC1ToAVCOTI=function(t){var e,i=t.split(".");return 2<i.length?(e=i.shift()+".",e+=parseInt(i.shift()).toString(16),e+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):e=t,e},l.resolve=function(t,e){return i.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},l.parseMasterPlaylist=function(t,e){var i=[];for(o.lastIndex=0;null!=(r=o.exec(t));){var s={},n=s.attrs=new R.default(r[1]);s.url=l.resolve(r[2],e);var r=n.decimalResolution("RESOLUTION");r&&(s.width=r.width,s.height=r.height),s.bitrate=n.decimalInteger("AVERAGE-BANDWIDTH")||n.decimalInteger("BANDWIDTH"),s.name=n.NAME,function(s,n){["video","audio"].forEach(function(e){var t,i=s.filter(function(t){return a.isCodecType(t,e)});i.length&&(t=i.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}),n[e+"Codec"]=(0<t.length?t:i)[0],s=s.filter(function(t){return-1===i.indexOf(t)}))}),n.unknownCodecs=s}([].concat((n.CODECS||"").split(/[ ,]+/)),s),s.videoCodec&&-1!==s.videoCodec.indexOf("avc1")&&(s.videoCodec=l.convertAVC1ToAVCOTI(s.videoCodec)),i.push(s)}return i},l.parseMasterPlaylistMedia=function(t,e,i,s){void 0===s&&(s=[]);var n=[],r=0;for(d.lastIndex=0;null!==(o=d.exec(t));){var a={},o=new R.default(o[1]);o.TYPE===i&&(a.groupId=o["GROUP-ID"],a.name=o.NAME,a.type=i,a.default="YES"===o.DEFAULT,a.autoselect="YES"===o.AUTOSELECT,a.forced="YES"===o.FORCED,o.URI&&(a.url=l.resolve(o.URI,e)),a.lang=o.LANGUAGE,a.name||(a.name=a.lang),s.length&&(o=l.findGroup(s,a.groupId),a.audioCodec=(o||s[0]).codec),a.id=r++,n.push(a))}return n},l.parseLevelPlaylist=function(t,e,i,s,n){var r,a,o=0,d=0,l=new C.default(e),u=new b.default,h=0,c=null,p=new I.default,g=null;for(M.lastIndex=0;null!==(r=M.exec(t));){var v,f=r[1];if(f){p.duration=parseFloat(f);var _=(" "+r[2]).slice(1);p.title=_||null,p.tagList.push(_?["INF",f,_]:["INF",f])}else if(r[3])T.isFinite(p.duration)&&(_=o++,p.type=s,p.start=d,p.levelkey=u,p.sn=_,p.level=i,p.cc=h,p.urlId=n,p.baseurl=e,p.relurl=(" "+r[3]).slice(1),f=c,(_=p).rawProgramDateTime?_.programDateTime=Date.parse(_.rawProgramDateTime):f&&f.programDateTime&&(_.programDateTime=f.endProgramDateTime),T.isFinite(_.programDateTime)||(_.programDateTime=null,_.rawProgramDateTime=null),l.fragments.push(p),d+=(c=p).duration,p=new I.default);else if(r[4])p.rawByteRange=(" "+r[4]).slice(1),c&&(v=c.byteRangeEndOffset)&&(p.lastByteRangeEndOffset=v);else if(r[5])p.rawProgramDateTime=(" "+r[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),null===g&&(g=l.fragments.length);else{for(r=r[0].match(O),a=1;a<r.length&&void 0===r[a];a++);var E=(" "+r[a+1]).slice(1),m=(" "+r[a+2]).slice(1);switch(r[a]){case"#":p.tagList.push(m?[E,m]:[E]);break;case"PLAYLIST-TYPE":l.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":o=l.startSN=parseInt(E);break;case"TARGETDURATION":l.targetduration=parseFloat(E);break;case"VERSION":l.version=parseInt(E);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":h++,p.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":h=parseInt(E);break;case"KEY":var A=new R.default(E),y=A.enumeratedString("METHOD"),S=A.URI,A=A.hexadecimalInteger("IV");y&&(u=new b.default,S&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(y)&&(u.method=y,u.baseuri=e,u.reluri=S,u.key=null,u.iv=A));break;case"START":var D=new R.default(E).decimalFloatingPoint("TIME-OFFSET");T.isFinite(D)&&(l.startTimeOffset=D);break;case"MAP":D=new R.default(E);p.relurl=D.URI,p.rawByteRange=D.BYTERANGE,p.baseurl=e,p.level=i,p.type=s,p.sn="initSegment",l.initSegment=p,(p=new I.default).rawProgramDateTime=l.initSegment.rawProgramDateTime;break;default:P.logger.warn("line parsed but not handled: "+r)}}}return(p=c)&&!p.relurl&&(l.fragments.pop(),d-=p.duration),l.totalduration=d,l.averagetargetduration=d/l.fragments.length,l.endSN=o-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=h,!l.initSegment&&l.fragments.length&&l.fragments.every(function(t){return L.test(t.relurl)})&&(P.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(p=new I.default).relurl=l.fragments[0].relurl,p.baseurl=e,p.level=i,p.type=s,p.sn="initSegment",l.initSegment=p,l.needSidxRanges=!0),g&&function(t,e){for(var i=t[e],s=e-1;0<=s;s--){var n=t[s];n.programDateTime=i.programDateTime-1e3*n.duration,i=n}}(l.fragments,g),l},l);function l(){}e.default=t}.call(this,s("./src/polyfills/number.js").Number)},"./src/loader/playlist-loader.js":function(t,a,d){"use strict";!function(c){var s,t=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(a,"__esModule",{value:!0});var e,p=d("./src/events.js"),i=d("./src/event-handler.js"),o=d("./src/errors.js"),u=d("./src/utils/logger.js"),n=d("./src/demux/mp4demuxer.js"),g=d("./src/loader/m3u8-parser.js"),v=window.performance,f={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},r={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},t=(e=i.default,t(_,e),Object.defineProperty(_,"ContextType",{get:function(){return f},enumerable:!0,configurable:!0}),Object.defineProperty(_,"LevelType",{get:function(){return r},enumerable:!0,configurable:!0}),_.canHaveQualityLevels=function(t){return t!==f.AUDIO_TRACK&&t!==f.SUBTITLE_TRACK},_.mapContextToLevelType=function(t){switch(t.type){case f.AUDIO_TRACK:return r.AUDIO;case f.SUBTITLE_TRACK:return r.SUBTITLE;default:return r.MAIN}},_.getResponseUrl=function(t,e){t=t.url;return t=void 0===t||0===t.indexOf("data:")?e.url:t},_.prototype.createInternalLoader=function(t){var e=this.hls.config,i=e.pLoader,s=e.loader,e=new(i||s)(e);return t.loader=e,this.loaders[t.type]=e},_.prototype.getInternalLoader=function(t){return this.loaders[t.type]},_.prototype.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},_.prototype.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},_.prototype.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},_.prototype.onManifestLoading=function(t){this.load(t.url,{type:f.MANIFEST,level:0,id:null})},_.prototype.onLevelLoading=function(t){this.load(t.url,{type:f.LEVEL,level:t.level,id:t.id})},_.prototype.onAudioTrackLoading=function(t){this.load(t.url,{type:f.AUDIO_TRACK,level:null,id:t.id})},_.prototype.onSubtitleTrackLoading=function(t){this.load(t.url,{type:f.SUBTITLE_TRACK,level:null,id:t.id})},_.prototype.load=function(t,e){var i=this.hls.config;u.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var s,n,r,a,o=this.getInternalLoader(e);if(o){var d=o.context;if(d&&d.url===t)return u.logger.trace("playlist request ongoing"),!1;u.logger.warn("aborting previous loader for type: "+e.type),o.abort()}switch(e.type){case f.MANIFEST:s=i.manifestLoadingMaxRetry,n=i.manifestLoadingTimeOut,r=i.manifestLoadingRetryDelay,a=i.manifestLoadingMaxRetryTimeout;break;case f.LEVEL:s=0,n=i.levelLoadingTimeOut;break;default:s=i.levelLoadingMaxRetry,n=i.levelLoadingTimeOut,r=i.levelLoadingRetryDelay,a=i.levelLoadingMaxRetryTimeout}o=this.createInternalLoader(e),e.url=t,e.responseType=e.responseType||"";var l={timeout:n,maxRetry:s,retryDelay:r,maxRetryDelay:a},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return u.logger.debug("Calling internal loader delegate for URL: "+t),o.load(e,l,d),!0},_.prototype.loadsuccess=function(t,e,i,s){if(void 0===s&&(s=null),i.isSidxRequest)return this._handleSidxRequest(t,i),void this._handlePlaylistLoaded(t,e,i,s);this.resetInternalLoader(i.type);var n=t.data;e.tload=v.now(),0===n.indexOf("#EXTM3U")?0<n.indexOf("#EXTINF:")||0<n.indexOf("#EXT-X-TARGETDURATION:")?this._handleTrackOrLevelPlaylist(t,e,i,s):this._handleMasterPlaylist(t,e,i,s):this._handleManifestParsingError(t,i,"no EXTM3U delimiter",s)},_.prototype.loaderror=function(t,e,i){this._handleNetworkError(e,i=void 0===i?null:i,!1,t)},_.prototype.loadtimeout=function(t,e,i){this._handleNetworkError(e,i=void 0===i?null:i,!0)},_.prototype._handleMasterPlaylist=function(t,e,i,s){var n,r,a=this.hls,o=t.data,d=_.getResponseUrl(t,i),l=g.default.parseMasterPlaylist(o,d);l.length?(n=l.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),n=g.default.parseMasterPlaylistMedia(o,d,"AUDIO",n),o=g.default.parseMasterPlaylistMedia(o,d,"SUBTITLES"),n.length&&(r=!1,n.forEach(function(t){t.url||(r=!0)}),!1===r&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(u.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main"}))),a.trigger(p.default.MANIFEST_LOADED,{levels:l,audioTracks:n,subtitles:o,url:d,stats:e,networkDetails:s})):this._handleManifestParsingError(t,i,"no level found in manifest",s)},_.prototype._handleTrackOrLevelPlaylist=function(t,e,i,s){var n=this.hls,r=i.id,a=i.level,o=i.type,d=_.getResponseUrl(t,i),l=c.isFinite(r)?r:0,u=c.isFinite(a)?a:l,h=_.mapContextToLevelType(i),l=g.default.parseLevelPlaylist(t.data,d,u,h,l);l.tload=e.tload,o===f.MANIFEST&&n.trigger(p.default.MANIFEST_LOADED,{levels:[{url:d,details:l}],audioTracks:[],url:d,stats:e,networkDetails:s}),e.tparsed=v.now(),l.needSidxRanges?(d=l.initSegment.url,this.load(d,{isSidxRequest:!0,type:o,level:a,levelDetails:l,id:r,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})):(i.levelDetails=l,this._handlePlaylistLoaded(t,e,i,s))},_.prototype._handleSidxRequest=function(t,e){var i,s=n.default.parseSegmentIndex(new Uint8Array(t.data));s&&(t=s.references,i=e.levelDetails,t.forEach(function(t,e){t=t.info,e=i.fragments[e];0===e.byteRange.length&&(e.rawByteRange=String(1+t.end-t.start)+"@"+String(t.start))}),i.initSegment.rawByteRange=String(s.moovEndOffset)+"@0")},_.prototype._handleManifestParsingError=function(t,e,i,s){this.hls.trigger(p.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:t.url,reason:i,networkDetails:s})},_.prototype._handleNetworkError=function(t,e,i,s){void 0===i&&(i=!1),void 0===s&&(s=null),u.logger.info("A network error occured while loading a "+t.type+"-type playlist");var n,r,a=this.getInternalLoader(t);switch(t.type){case f.MANIFEST:n=i?o.ErrorDetails.MANIFEST_LOAD_TIMEOUT:o.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case f.LEVEL:n=i?o.ErrorDetails.LEVEL_LOAD_TIMEOUT:o.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case f.AUDIO_TRACK:n=i?o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;default:r=!1}a&&(a.abort(),this.resetInternalLoader(t.type));e={type:o.ErrorTypes.NETWORK_ERROR,details:n,fatal:r,url:a.url,loader:a,context:t,networkDetails:e};s&&(e.response=s),this.hls.trigger(p.default.ERROR,e)},_.prototype._handlePlaylistLoaded=function(t,e,i,s){var n=i.type,r=i.level,a=i.id,o=i.levelDetails;if(o.targetduration)if(_.canHaveQualityLevels(i.type))this.hls.trigger(p.default.LEVEL_LOADED,{details:o,level:r||0,id:a||0,stats:e,networkDetails:s});else switch(n){case f.AUDIO_TRACK:this.hls.trigger(p.default.AUDIO_TRACK_LOADED,{details:o,id:a,stats:e,networkDetails:s});break;case f.SUBTITLE_TRACK:this.hls.trigger(p.default.SUBTITLE_TRACK_LOADED,{details:o,id:a,stats:e,networkDetails:s})}else this._handleManifestParsingError(t,i,"invalid target duration",s)},_);function _(t){t=e.call(this,t,p.default.MANIFEST_LOADING,p.default.LEVEL_LOADING,p.default.AUDIO_TRACK_LOADING,p.default.SUBTITLE_TRACK_LOADING)||this;return t.loaders={},t}a.default=t}.call(this,d("./src/polyfills/number.js").Number)},"./src/observer.js":function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r,i=i("./node_modules/eventemitter3/index.js"),n=(r=i.EventEmitter,n(a,r),a.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.emit.apply(this,[t,t].concat(e))},a);function a(){return null!==r&&r.apply(this,arguments)||this}e.Observer=n},"./src/polyfills/number.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i=i("./src/utils/get-self-scope.js").getSelfScope().Number;(e.Number=i).isFinite=i.isFinite||function(t){return"number"==typeof t&&isFinite(t)}},"./src/remux/aac-helper.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(n.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},n);function n(){}e.default=s},"./src/remux/mp4-generator.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Math.pow(2,32)-1,s=(h.init=function(){for(var t in h.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})h.types.hasOwnProperty(t)&&(h.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);h.HDLR_TYPES={video:e,audio:i};var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);h.STTS=h.STSC=h.STCO=n,h.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),h.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),h.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),h.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);e=new Uint8Array([105,115,111,109]),i=new Uint8Array([97,118,99,49]),n=new Uint8Array([0,0,0,1]);h.FTYP=h.box(h.types.ftyp,e,n,e,i),h.DINF=h.box(h.types.dinf,h.box(h.types.dref,s))},h.box=function(t){for(var e,i=Array.prototype.slice.call(arguments,1),s=8,n=i.length,r=n;n--;)s+=i[n].byteLength;for((e=new Uint8Array(s))[0]=s>>24&255,e[1]=s>>16&255,e[2]=s>>8&255,e[3]=255&s,e.set(t,4),n=0,s=8;n<r;n++)e.set(i[n],s),s+=i[n].byteLength;return e},h.hdlr=function(t){return h.box(h.types.hdlr,h.HDLR_TYPES[t])},h.mdat=function(t){return h.box(h.types.mdat,t)},h.mdhd=function(t,e){e*=t;var i=Math.floor(e/(1+r)),e=Math.floor(e%(1+r));return h.box(h.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},h.mdia=function(t){return h.box(h.types.mdia,h.mdhd(t.timescale,t.duration),h.hdlr(t.type),h.minf(t))},h.mfhd=function(t){return h.box(h.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},h.minf=function(t){return"audio"===t.type?h.box(h.types.minf,h.box(h.types.smhd,h.SMHD),h.DINF,h.stbl(t)):h.box(h.types.minf,h.box(h.types.vmhd,h.VMHD),h.DINF,h.stbl(t))},h.moof=function(t,e,i){return h.box(h.types.moof,h.mfhd(t),h.traf(i,e))},h.moov=function(t){for(var e=t.length,i=[];e--;)i[e]=h.trak(t[e]);return h.box.apply(null,[h.types.moov,h.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(h.mvex(t)))},h.mvex=function(t){for(var e=t.length,i=[];e--;)i[e]=h.trex(t[e]);return h.box.apply(null,[h.types.mvex].concat(i))},h.mvhd=function(t,e){e*=t;var i=Math.floor(e/(1+r)),e=Math.floor(e%(1+r)),e=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return h.box(h.types.mvhd,e)},h.sdtp=function(t){for(var e,i=t.samples||[],s=new Uint8Array(4+i.length),n=0;n<i.length;n++)e=i[n].flags,s[n+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return h.box(h.types.sdtp,s)},h.stbl=function(t){return h.box(h.types.stbl,h.stsd(t),h.box(h.types.stts,h.STTS),h.box(h.types.stsc,h.STSC),h.box(h.types.stsz,h.STSZ),h.box(h.types.stco,h.STCO))},h.avc1=function(t){for(var e,i,s=[],n=[],r=0;r<t.sps.length;r++)i=(e=t.sps[r]).byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(e));for(r=0;r<t.pps.length;r++)i=(e=t.pps[r]).byteLength,n.push(i>>>8&255),n.push(255&i),n=n.concat(Array.prototype.slice.call(e));var a=h.box(h.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|t.sps.length].concat(s).concat([t.pps.length]).concat(n))),o=t.width,d=t.height,l=t.pixelRatio[0],u=t.pixelRatio[1];return h.box(h.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,h.box(h.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),h.box(h.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,u>>24,u>>16&255,u>>8&255,255&u])))},h.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},h.mp4a=function(t){var e=t.samplerate;return h.box(h.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),h.box(h.types.esds,h.esds(t)))},h.mp3=function(t){var e=t.samplerate;return h.box(h.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},h.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?h.box(h.types.stsd,h.STSD,h.mp4a(t)):h.box(h.types.stsd,h.STSD,h.mp3(t)):h.box(h.types.stsd,h.STSD,h.avc1(t))},h.tkhd=function(t){var e=t.id,i=t.duration*t.timescale,s=t.width,n=t.height,t=Math.floor(i/(1+r)),i=Math.floor(i%(1+r));return h.box(h.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,n>>8&255,255&n,0,0]))},h.traf=function(t,e){var i=h.sdtp(t),s=t.id,n=Math.floor(e/(1+r)),e=Math.floor(e%(1+r));return h.box(h.types.traf,h.box(h.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),h.box(h.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,e>>24,e>>16&255,e>>8&255,255&e])),h.trun(t,i.length+16+20+8+16+8+8),i)},h.trak=function(t){return t.duration=t.duration||4294967295,h.box(h.types.trak,h.tkhd(t),h.mdia(t))},h.trex=function(t){t=t.id;return h.box(h.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},h.trun=function(t,e){var i,s,n,r,a,o=t.samples||[],d=o.length,t=12+16*d,l=new Uint8Array(t);for(l.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,(e+=8+t)>>>24&255,e>>>16&255,e>>>8&255,255&e],0),i=0;i<d;i++)s=(a=o[i]).duration,n=a.size,r=a.flags,a=a.cts,l.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r.isLeading<<2|r.dependsOn,r.isDependedOn<<6|r.hasRedundancy<<4|r.paddingValue<<1|r.isNonSync,61440&r.degradPrio,15&r.degradPrio,a>>>24&255,a>>>16&255,a>>>8&255,255&a],12+16*i);return h.box(h.types.trun,l)},h.initSegment=function(t){h.types||h.init();var e=h.moov(t),t=new Uint8Array(h.FTYP.byteLength+e.byteLength);return t.set(h.FTYP),t.set(e,h.FTYP.byteLength),t},h);function h(){}e.default=s},"./src/remux/mp4-remuxer.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w=i("./src/remux/aac-helper.js"),j=i("./src/remux/mp4-generator.js"),F=i("./src/events.js"),G=i("./src/errors.js"),V=i("./src/utils/logger.js"),i=(s.prototype.destroy=function(){},s.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},s.prototype.resetInitSegment=function(){this.ISGenerated=!1},s.prototype.remux=function(t,e,i,s,n,r,a){var o,d,l,u,h;this.ISGenerated||this.generateIS(t,e,n),this.ISGenerated&&(h=t.samples.length,o=e.samples.length,l=d=n,h&&o&&(u=(t.samples[0].pts-e.samples[0].pts)/e.inputTimeScale,d+=Math.max(0,u),l+=Math.max(0,-u)),h?(t.timescale||(V.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,n)),u=this.remuxAudio(t,d,r,a),o&&(h=void 0,u&&(h=u.endPTS-u.startPTS),e.timescale||(V.logger.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,n)),this.remuxVideo(e,l,r,h,a))):!o||(a=this.remuxVideo(e,l,r,0,a))&&t.codec&&this.remuxEmptyAudio(t,d,r,a)),i.samples.length&&this.remuxID3(i,n),s.samples.length&&this.remuxText(s,n),this.observer.trigger(F.default.FRAG_PARSED)},s.prototype.generateIS=function(t,e,i){var s,n,r=this.observer,a=t.samples,o=e.samples,d=this.typeSupported,l="audio/mp4",u={},h={tracks:u},c=void 0===this._initPTS;c&&(s=n=1/0),t.config&&a.length&&(t.timescale=t.samplerate,V.logger.log("audio sampling rate : "+t.samplerate),t.isAAC||(d.mpeg?(l="audio/mpeg",t.codec=""):d.mp3&&(t.codec="mp3")),u.audio={container:l,codec:t.codec,initSegment:!t.isAAC&&d.mpeg?new Uint8Array:j.default.initSegment([t]),metadata:{channelCount:t.channelCount}},c&&(s=n=a[0].pts-t.inputTimeScale*i)),e.sps&&e.pps&&o.length&&(t=e.inputTimeScale,e.timescale=t,u.video={container:"video/mp4",codec:e.codec,initSegment:j.default.initSegment([e]),metadata:{width:e.width,height:e.height}},c&&(s=Math.min(s,o[0].pts-t*i),n=Math.min(n,o[0].dts-t*i),this.observer.trigger(F.default.INIT_PTS_FOUND,{initPTS:s}))),Object.keys(u).length?(r.trigger(F.default.FRAG_PARSING_INIT_SEGMENT,h),this.ISGenerated=!0,c&&(this._initPTS=s,this._initDTS=n)):r.trigger(F.default.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},s.prototype.remuxVideo=function(t,e,i,s,n){var r,a,o=8,d=t.timescale,l=t.samples,u=[],h=l.length,c=this._PTSNormalize,p=this._initPTS,g=this.nextAvcDts,v=this.isSafari;if(0!==h){v&&(i|=l.length&&g&&(n&&Math.abs(e-g/d)<.1||Math.abs(l[0].pts-g-p)<d/5)),i||(g=e*d),l.forEach(function(t){t.pts=c(t.pts-p,g),t.dts=c(t.dts-p,g)}),l.sort(function(t,e){var i=t.dts-e.dts,s=t.pts-e.pts;return i||s||t.id-e.id});var f=l.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(f<0){V.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(f/90)+" ms to overcome this issue");for(var _=0;_<l.length;_++)l[_].dts+=f}var n=l[0],E=Math.max(n.dts,0),m=Math.max(n.pts,0),e=Math.round((E-g)/90);i&&e&&(1<e?V.logger.log("AVC:"+e+" ms hole between fragments detected,filling it"):e<-1&&V.logger.log("AVC:"+-e+" ms overlapping between fragments detected"),E=g,l[0].dts=E,m=Math.max(m-e,g),l[0].pts=m,V.logger.log("Video/PTS/DTS adjusted: "+Math.round(m/90)+"/"+Math.round(E/90)+",delta:"+e+" ms")),n=l[l.length-1],i=Math.max(n.dts,0),e=Math.max(n.pts,0,i),v&&(r=Math.round((i-E)/(l.length-1)));for(var A=0,y=0,_=0;_<h;_++){for(var S=l[_],D=S.units,T=D.length,I=0,C=0;C<T;C++)I+=D[C].data.length;y+=I,A+=T,S.length=I,S.dts=v?E+_*r:Math.max(S.dts,E),S.pts=Math.max(S.pts,S.dts)}n=y+4*A+8;try{a=new Uint8Array(n)}catch(t){return void this.observer.trigger(F.default.ERROR,{type:G.ErrorTypes.MUX_ERROR,details:G.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:n,reason:"fail allocating video mdat "+n})}var b=new DataView(a.buffer);b.setUint32(0,n),a.set(j.default.types.mdat,4);for(_=0;_<h;_++){for(var R,P,M=l[_],O=M.units,L=0,N=void 0,C=0,T=O.length;C<T;C++){var k=O[C],U=k.data,k=k.data.byteLength;b.setUint32(o,k),o+=4,a.set(U,o),o+=k,L+=4+k}N=v?Math.max(0,r*Math.round((M.pts-M.dts)/r)):(_<h-1?r=l[_+1].dts-M.dts:(P=this.config,R=M.dts-l[0<_?_-1:_].dts,P.stretchShortVideoTrack?(P=P.maxBufferHole,Math.floor(P*d)<(P=(s?m+s*d:this.nextAudioPts)-M.pts)?((r=P-R)<0&&(r=R),V.logger.log("It is approximately "+P/90+" ms to the next segment; using duration "+r/90+" ms for the last video frame.")):r=R):r=R),Math.round(M.pts-M.dts)),u.push({size:L,duration:r,cts:N,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:M.key?2:1,isNonSync:M.key?0:1}})}this.nextAvcDts=i+r;var B,i=t.dropped;t.len=0,t.nbNalu=0,t.dropped=0,u.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")&&((B=u[0].flags).dependsOn=2,B.isNonSync=0),t.samples=u,B=j.default.moof(t.sequenceNumber++,E,t),t.samples=[];i={data1:B,data2:a,startPTS:m/d,endPTS:(e+r)/d,startDTS:E/d,endDTS:this.nextAvcDts/d,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:i};return this.observer.trigger(F.default.FRAG_PARSING_DATA,i),i}},s.prototype.remuxAudio=function(t,e,i,s){var n,r,a,o,d=t.inputTimeScale,l=t.timescale,u=d/l,h=(t.isAAC?1024:1152)*u,c=this._PTSNormalize,p=this._initPTS,g=!t.isAAC&&this.typeSupported.mpeg,v=t.samples,f=[],_=this.nextAudioPts;if(i|=v.length&&_&&(s&&Math.abs(e-_/d)<.1||Math.abs(v[0].pts-_-p)<20*h),v.forEach(function(t){t.pts=t.dts=c(t.pts-p,e*d)}),0!==(v=v.filter(function(t){return 0<=t.pts})).length){if(i||(_=s?e*d:v[0].pts),t.isAAC)for(var E=this.config.maxAudioFramesDrift,m=0,A=_;m<v.length;){var y=v[m],S=(O=y.pts)-A,D=Math.abs(1e3*S/d);if(S<=-E*h)V.logger.warn("Dropping 1 audio frame @ "+(A/d).toFixed(3)+"s due to "+Math.round(D)+" ms overlap."),v.splice(m,1),t.len-=y.unit.length;else if(E*h<=S&&D<1e4&&A){var T=Math.round(S/h);V.logger.warn("Injecting "+T+" audio frame @ "+(A/d).toFixed(3)+"s due to "+Math.round(1e3*S/d)+" ms gap.");for(var I=0;I<T;I++){var C,b=Math.max(A,0);(C=w.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(V.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),C=y.unit.subarray()),v.splice(m,0,{unit:C,pts:b,dts:b}),t.len+=C.length,A+=h,m++}y.pts=y.dts=A,A+=h,m++}else Math.abs(S),y.pts=y.dts=A,A+=h,m++}for(var I=0,R=v.length;I<R;I++){var P=v[I],M=P.unit,O=P.pts;if(void 0!==o)n.duration=Math.round((O-o)/u);else{var L=Math.round(1e3*(O-_)/d),N=0;if(i&&t.isAAC&&L){if(0<L&&L<1e4)N=Math.round((O-_)/h),V.logger.log(L+" ms hole between AAC samples detected,filling it"),0<N&&(C=(C=w.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||M.subarray(),t.len+=N*C.length);else if(L<-12){V.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(_/d).toFixed(3)+"s/"+(O/d).toFixed(3)+"s/"+-L+"ms"),t.len-=M.byteLength;continue}O=_}if(a=O,!(0<t.len))return;var L=g?t.len:t.len+8,k=g?0:8;try{r=new Uint8Array(L)}catch(t){return void this.observer.trigger(F.default.ERROR,{type:G.ErrorTypes.MUX_ERROR,details:G.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:L,reason:"fail allocating audio mdat "+L})}g||(new DataView(r.buffer).setUint32(0,L),r.set(j.default.types.mdat,4));for(m=0;m<N;m++)(C=w.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(V.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),C=M.subarray()),r.set(C,k),k+=C.byteLength,n={size:C.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},f.push(n)}r.set(M,k);L=M.byteLength;k+=L,f.push(n={size:L,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}}),o=O}var U=0,B=f.length;if(2<=B&&(U=f[B-2].duration,n.duration=U),B){this.nextAudioPts=_=o+u*U,t.len=0,t.samples=f,l=g?new Uint8Array:j.default.moof(t.sequenceNumber++,a/u,t),t.samples=[];s=a/d,U=_/d,B={data1:l,data2:r,startPTS:s,endPTS:U,startDTS:s,endDTS:U,type:"audio",hasAudio:!0,hasVideo:!1,nb:B};return this.observer.trigger(F.default.FRAG_PARSING_DATA,B),B}return null}},s.prototype.remuxEmptyAudio=function(t,e,i,s){var n=t.inputTimeScale,r=t.samplerate||n,a=this.nextAudioPts,o=(void 0!==a?a:s.startDTS*n)+this._initDTS,s=s.endDTS*n+this._initDTS,d=1024*(n/r),l=Math.ceil((s-o)/d),u=w.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(V.logger.warn("remux empty Audio"),u){for(var h=[],c=0;c<l;c++){var p=o+c*d;h.push({unit:u,pts:p,dts:p}),t.len+=u.length}t.samples=h,this.remuxAudio(t,e,i)}else V.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},s.prototype.remuxID3=function(t){var e,i=t.samples.length,s=t.inputTimeScale,n=this._initPTS,r=this._initDTS;if(i){for(var a=0;a<i;a++)(e=t.samples[a]).pts=(e.pts-n)/s,e.dts=(e.dts-r)/s;this.observer.trigger(F.default.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[]},s.prototype.remuxText=function(t){t.samples.sort(function(t,e){return t.pts-e.pts});var e,i=t.samples.length,s=t.inputTimeScale,n=this._initPTS;if(i){for(var r=0;r<i;r++)(e=t.samples[r]).pts=(e.pts-n)/s;this.observer.trigger(F.default.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]},s.prototype._PTSNormalize=function(t,e){var i;if(void 0===e)return t;for(i=e<t?-8589934592:8589934592;4294967296<Math.abs(t-e);)t+=i;return t},s);function s(t,e,i,s){this.observer=t,this.config=e,this.typeSupported=i;i=navigator.userAgent;this.isSafari=s&&-1<s.indexOf("Apple")&&i&&!i.match("CriOS"),this.ISGenerated=!1}e.default=i},"./src/remux/passthrough-remuxer.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=i("./src/events.js"),i=(s.prototype.destroy=function(){},s.prototype.resetTimeStamp=function(){},s.prototype.resetInitSegment=function(){},s.prototype.remux=function(t,e,i,s,n,r,a,o){var d=this.observer,l="";t&&(l+="audio"),e&&(l+="video"),d.trigger(u.default.FRAG_PARSING_DATA,{data1:o,startPTS:n,startDTS:n,type:l,hasAudio:!!t,hasVideo:!!e,nb:1,dropped:0}),d.trigger(u.default.FRAG_PARSED)},s);function s(t){this.observer=t}e.default=i},"./src/task-loop.js":function(t,e,i){"use strict";var s,n=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r,i=i("./src/event-handler.js"),n=(r=i.default,n(a,r),a.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},a.prototype.hasInterval=function(){return!!this._tickInterval},a.prototype.hasNextTick=function(){return!!this._tickTimer},a.prototype.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,t),!0)},a.prototype.clearInterval=function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),!(this._tickInterval=null))},a.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),!(this._tickTimer=null))},a.prototype.tick=function(){1==++this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},a.prototype.doTick=function(){},a);function a(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];t=r.apply(this,[t].concat(e))||this;return t._tickInterval=null,t._tickTimer=null,t._tickCallCount=0,t._boundTick=t.tick.bind(t),t}e.default=n},"./src/utils/attr-list.js":function(t,r,e){"use strict";!function(e){Object.defineProperty(r,"__esModule",{value:!0});var i=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,t=(s.prototype.decimalInteger=function(t){t=parseInt(this[t],10);return t>e.MAX_SAFE_INTEGER?1/0:t},s.prototype.hexadecimalInteger=function(t){if(this[t]){for(var e=(1&(e=(this[t]||"0x").slice(2)).length?"0":"")+e,i=new Uint8Array(e.length/2),s=0;s<e.length/2;s++)i[s]=parseInt(e.slice(2*s,2*s+2),16);return i}return null},s.prototype.hexadecimalIntegerAsNumber=function(t){t=parseInt(this[t],16);return t>e.MAX_SAFE_INTEGER?1/0:t},s.prototype.decimalFloatingPoint=function(t){return parseFloat(this[t])},s.prototype.enumeratedString=function(t){return this[t]},s.prototype.decimalResolution=function(t){t=i.exec(this[t]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},s.parseAttrList=function(t){var e,i={};for(n.lastIndex=0;null!==(e=n.exec(t));){var s=e[2];0===s.indexOf('"')&&s.lastIndexOf('"')===s.length-1&&(s=s.slice(1,-1)),i[e[1]]=s}return i},s);function s(t){for(var e in t="string"==typeof t?s.parseAttrList(t):t)t.hasOwnProperty(e)&&(this[e]=t[e])}r.default=t}.call(this,e("./src/polyfills/number.js").Number)},"./src/utils/binary-search.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={search:function(t,e){for(var i=0,s=t.length-1,n=null,r=null;i<=s;){var a=e(r=t[n=(i+s)/2|0]);if(0<a)i=1+n;else{if(!(a<0))return r;s=n-1}}return null}}},"./src/utils/buffer-helper.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(n.isBuffered=function(t,e){try{if(t)for(var i=t.buffered,s=0;s<i.length;s++)if(e>=i.start(s)&&e<=i.end(s))return!0}catch(t){}return!1},n.bufferInfo=function(t,e,i){try{if(t){for(var s=t.buffered,n=[],r=void 0,r=0;r<s.length;r++)n.push({start:s.start(r),end:s.end(r)});return this.bufferedInfo(n,e,i)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},n.bufferedInfo=function(t,e,i){var s,n,r,a,o,d=[];for(t.sort(function(t,e){return t.start-e.start||e.end-t.end}),o=0;o<t.length;o++){var l,u=d.length;u?(l=d[u-1].end,t[o].start-l<i?t[o].end>l&&(d[u-1].end=t[o].end):d.push(t[o])):d.push(t[o])}for(s=o=0,n=r=e;o<d.length;o++){var h=d[o].start,c=d[o].end;if(h<=e+i&&e<c)n=h,s=(r=c)-e;else if(e+i<h){a=h;break}}return{len:s,start:n,end:r,nextStart:a}},n);function n(){}e.BufferHelper=s},"./src/utils/cea-608-parser.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function a(t){var e=t;return s.hasOwnProperty(t)&&(e=s[t]),String.fromCharCode(e)}function o(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].toString(16));return e}var s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},r={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},l={25:2,26:4,29:6,30:8,31:10,27:13,28:15},u=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],h={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){this.verboseFilter[t],this.verboseLevel}},c=(D.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},D.prototype.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],i=0;i<e.length;i++){var s=e[i];t.hasOwnProperty(s)&&(this[s]=t[s])}},D.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},D.prototype.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},D.prototype.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},D.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},D),p=(S.prototype.reset=function(){this.uchar=" ",this.penState.reset()},S.prototype.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},S.prototype.setPenState=function(t){this.penState.copy(t)},S.prototype.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},S.prototype.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},S.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},S),g=(y.prototype.equals=function(t){for(var e=!0,i=0;i<100;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e},y.prototype.copy=function(t){for(var e=0;e<100;e++)this.chars[e].copy(t.chars[e])},y.prototype.isEmpty=function(){for(var t=!0,e=0;e<100;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},y.prototype.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(h.log("ERROR","Negative cursor position "+this.pos),this.pos=0):100<this.pos&&(h.log("ERROR","Too large cursor position "+this.pos),this.pos=100)},y.prototype.moveCursor=function(t){var e=this.pos+t;if(1<t)for(var i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)},y.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},y.prototype.insertChar=function(t){144<=t&&this.backSpace();var e=a(t);100<=this.pos?h.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},y.prototype.clearFromPos=function(t){for(var e=t;e<100;e++)this.chars[e].reset()},y.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},y.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},y.prototype.getTextString=function(){for(var t=[],e=!0,i=0;i<100;i++){var s=this.chars[i].uchar;" "!==s&&(e=!1),t.push(s)}return e?"":t.join("")},y.prototype.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},y),v=(A.prototype.reset=function(){for(var t=0;t<15;t++)this.rows[t].clear();this.currRow=14},A.prototype.equals=function(t){for(var e=!0,i=0;i<15;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e},A.prototype.copy=function(t){for(var e=0;e<15;e++)this.rows[e].copy(t.rows[e])},A.prototype.isEmpty=function(){for(var t=!0,e=0;e<15;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},A.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},A.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},A.prototype.insertChar=function(t){this.rows[this.currRow].insertChar(t)},A.prototype.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},A.prototype.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},A.prototype.setCursor=function(t){h.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},A.prototype.setPAC=function(t){h.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var i=0;i<15;i++)this.rows[i].clear();var s=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var r=n.rows[s].cueStartTime;if(r&&r<h.time)for(i=0;i<this.nrRollUpRows;i++)this.rows[e-this.nrRollUpRows+i+1].copy(n.rows[s+i])}}this.currRow=e;var a=this.rows[this.currRow];null!==t.indent&&(r=t.indent,r=Math.max(r-1,0),a.setCursor(t.indent),t.color=a.chars[r].penState.foreground);t={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(t)},A.prototype.setBkgData=function(t){h.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},A.prototype.setRollUpRows=function(t){this.nrRollUpRows=t},A.prototype.rollUp=function(){var t;null!==this.nrRollUpRows?(h.log("TEXT",this.getDisplayText()),t=this.currRow+1-this.nrRollUpRows,(t=this.rows.splice(t,1)[0]).clear(),this.rows.splice(this.currRow,0,t),h.log("INFO","Rolling up")):h.log("DEBUG","roll_up but nrRollUpRows not set yet")},A.prototype.getDisplayText=function(t){t=t||!1;for(var e=[],i="",s=0;s<15;s++){var n=this.rows[s].getTextString();n&&(t?e.push("Row "+(s+1)+": '"+n+"'"):e.push(n.trim()))}return i=0<e.length?t?"["+e.join(" | ")+"]":e.join("\n"):i},A.prototype.getTextAndFormat=function(){return this.rows},A),f=(m.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},m.prototype.getHandler=function(){return this.outputFilter},m.prototype.setHandler=function(t){this.outputFilter=t},m.prototype.setPAC=function(t){this.writeScreen.setPAC(t)},m.prototype.setBkgData=function(t){this.writeScreen.setBkgData(t)},m.prototype.setMode=function(t){t!==this.mode&&(this.mode=t,h.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},m.prototype.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";h.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(h.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},m.prototype.ccRCL=function(){h.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},m.prototype.ccBS=function(){h.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},m.prototype.ccAOF=function(){},m.prototype.ccAON=function(){},m.prototype.ccDER=function(){h.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},m.prototype.ccRU=function(t){h.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},m.prototype.ccFON=function(){h.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},m.prototype.ccRDC=function(){h.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},m.prototype.ccTR=function(){h.log("INFO","TR"),this.setMode("MODE_TEXT")},m.prototype.ccRTD=function(){h.log("INFO","RTD"),this.setMode("MODE_TEXT")},m.prototype.ccEDM=function(){h.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},m.prototype.ccCR=function(){h.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},m.prototype.ccENM=function(){h.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},m.prototype.ccEOC=function(){var t;h.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode&&(t=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,h.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())),this.outputDataUpdate(!0)},m.prototype.ccTO=function(t){h.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},m.prototype.ccMIDROW=function(t){var e={flash:!1};e.underline=t%2==1,e.italics=46<=t,e.italics?e.foreground="white":(t=Math.floor(t/2)-16,e.foreground=["white","green","blue","cyan","red","yellow","magenta"][t]),h.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},m.prototype.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=h.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},m.prototype.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},m),_=(E.prototype.getHandler=function(t){return this.channels[t].getHandler()},E.prototype.setHandler=function(t,e){this.channels[t].setHandler(e)},E.prototype.addData=function(t,e){var i,s,n,r=!1;this.lastTime=t,h.setTime(t);for(var a=0;a<e.length;a+=2)s=127&e[a],n=127&e[a+1],0!=s||0!=n?(h.log("DATA","["+o([e[a],e[a+1]])+"] -> ("+o([s,n])+")"),!(i=(i=(i=(i=this.parseCmd(s,n))||this.parseMidrow(s,n))||this.parsePAC(s,n))||this.parseBackgroundAttributes(s,n))&&(r=this.parseChars(s,n))&&(this.currChNr&&0<=this.currChNr?this.channels[this.currChNr-1].insertChars(r):h.log("WARNING","No channel found yet. TEXT-MODE?")),i?this.dataCounters.cmd+=2:r?this.dataCounters.char+=2:(this.dataCounters.other+=2,h.log("WARNING","Couldn't parse cleaned data "+o([s,n])+" orig: "+o([e[a],e[a+1]])))):this.dataCounters.padding+=2},E.prototype.parseCmd=function(t,e){var i=null;if(!((20===t||28===t)&&32<=e&&e<=47)&&!((23===t||31===t)&&33<=e&&e<=35))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,h.log("DEBUG","Repeated command ("+o([t,e])+") is dropped"),!0;var s=this.channels[(i=20===t||23===t?1:2)-1];return 20===t||28===t?32===e?s.ccRCL():33===e?s.ccBS():34===e?s.ccAOF():35===e?s.ccAON():36===e?s.ccDER():37===e?s.ccRU(2):38===e?s.ccRU(3):39===e?s.ccRU(4):40===e?s.ccFON():41===e?s.ccRDC():42===e?s.ccTR():43===e?s.ccRTD():44===e?s.ccEDM():45===e?s.ccCR():46===e?s.ccENM():47===e&&s.ccEOC():s.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},E.prototype.parseMidrow=function(t,e){var i;return(17===t||25===t)&&32<=e&&e<=47&&((i=17===t?1:2)!==this.currChNr?(h.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(e),h.log("DEBUG","MIDROW ("+o([t,e])+")"),!0))},E.prototype.parsePAC=function(t,e){if(!((17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127)&&!((16===t||24===t)&&64<=e&&e<=95))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,!(this.lastCmdB=null);var i=t<=23?1:2,s=this.interpretPAC((64<=e&&e<=95?1==i?n:d:1==i?r:l)[t],e);return this.channels[i-1].setPAC(s),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},E.prototype.interpretPAC=function(t,e){var i=e,t={color:null,italics:!1,indent:null,underline:!1,row:t};return t.underline=1==(1&(i=95<e?e-96:e-64)),i<=13?t.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(t.italics=!0,t.color="white"):t.indent=4*Math.floor((i-16)/2),t},E.prototype.parseChars=function(t,e){var i,s=null,n=null,r=null;return 17<=(r=25<=t?(s=2,t-8):(s=1,t))&&r<=19?(i=e,h.log("INFO","Special char '"+a(i=17===r?e+80:18===r?e+112:e+144)+"' in channel "+s),n=[i]):32<=t&&t<=127&&(n=0===e?[t]:[t,e]),n&&(e=o(n),h.log("DEBUG","Char codes =  "+e.join(",")),this.lastCmdA=null,this.lastCmdB=null),n},E.prototype.parseBackgroundAttributes=function(t,e){var i,s;return!(!((16===t||24===t)&&32<=e&&e<=47)&&!((23===t||31===t)&&45<=e&&e<=47)||(i={},16===t||24===t?(s=Math.floor((e-32)/2),i.background=u[s],e%2==1&&(i.background=i.background+"_semi")):45===e?i.background="transparent":(i.foreground="black",47===e&&(i.underline=!0)),this.channels[(t<24?1:2)-1].setBkgData(i),this.lastCmdA=null,this.lastCmdB=null))},E.prototype.reset=function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},E.prototype.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)},E);function E(t,e,i){this.field=t||1,this.outputs=[e,i],this.channels=[new f(1,e),new f(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}function m(t,e){this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new v,this.nonDisplayedMemory=new v,this.lastOutputScreen=new v,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}function A(){this.rows=[];for(var t=0;t<15;t++)this.rows.push(new g);this.currRow=14,this.nrRollUpRows=null,this.reset()}function y(){this.chars=[];for(var t=0;t<100;t++)this.chars.push(new p);this.pos=0,this.currPenState=new c}function S(t,e,i,s,n,r){this.uchar=t||" ",this.penState=new c(e,i,s,n,r)}function D(t,e,i,s,n){this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=s||"black",this.flash=n||!1}e.default=_},"./src/utils/codecs.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};e.isCodecType=function(t,e){return!!(e=s[e])&&!0===e[t.slice(0,4)]},e.isCodecSupportedInMp4=function(t,e){return window.MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}},"./src/utils/cues.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=i("./src/utils/vttparser.js");e.newCue=function(t,e,i,s){for(var n,r,a,o,d,l=window.VTTCue||window.TextTrackCue,u=0;u<s.rows.length;u++)if(a=!0,o=0,d="",!(n=s.rows[u]).isEmpty()){for(var h=0;h<n.chars.length;h++)n.chars[h].uchar.match(/\s/)&&a?o++:(d+=n.chars[h].uchar,a=!1);(n.cueStartTime=e)===i&&(i+=1e-4),r=new l(e,i,c.fixLineBreaks(d.trim())),16<=o?o--:o++,navigator.userAgent.match(/Firefox\//)?r.line=u+1:r.line=7<u?u-2:u+1,r.align="left",r.position=Math.max(0,Math.min(100,o/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(r)}}},"./src/utils/discontinuities.js":function(t,e,h){"use strict";!function(s){function i(t,e){for(var i=null,s=0;s<t.length;s+=1){var n=t[s];if(n&&n.cc===e){i=n;break}}return i}function n(t,e,i){var s=!1;return s=e&&e.details&&i&&(i.endCC>i.startCC||t&&t.cc<i.startCC)?!0:s}function r(t,e){t=t.fragments,e=e.fragments;if(e.length&&t.length){e=i(t,e[0].cc);return e&&e.startPTS?e:void u.logger.log("No frag in previous level to align on")}u.logger.log("No fragments to align")}function a(i,t){t.fragments.forEach(function(t){var e;t&&(e=t.start+i,t.start=t.startPTS=e,t.endPTS=e+t.duration)}),t.PTSKnown=!0}function o(t,e,i){!n(t,i,e)||(i=r(i.details,e))&&(u.logger.log("Adjusting PTS using last level due to CC increase within current level"),a(i.start,e))}function d(t,e){var i;e&&e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime&&(i=e.fragments[0].programDateTime,e=(t.fragments[0].programDateTime-i)/1e3+e.fragments[0].start,s.isFinite(e)&&(u.logger.log("adjusting PTS using programDateTime delta, sliding:"+e.toFixed(3)),a(e,t)))}Object.defineProperty(e,"__esModule",{value:!0});var l=h("./src/utils/binary-search.js"),u=h("./src/utils/logger.js");e.findFirstFragWithCC=i,e.findFragWithCC=function(t,e){return l.default.search(t,function(t){return t.cc<e?1:t.cc>e?-1:0})},e.shouldAlignOnDiscontinuities=n,e.findDiscontinuousReferenceFrag=r,e.adjustPts=a,e.alignStream=function(t,e,i){o(t,i,e),!i.PTSKnown&&e&&d(i,e.details)},e.alignDiscontinuities=o,e.alignPDT=d}.call(this,h("./src/polyfills/number.js").Number)},"./src/utils/ewma-bandwidth-estimator.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("./src/utils/ewma.js"),i=(s.prototype.sample=function(t,e){e=8e3*e/(t=Math.max(t,this.minDelayMs_)),t/=1e3;this.fast_.sample(t,e),this.slow_.sample(t,e)},s.prototype.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},s.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},s.prototype.destroy=function(){},s);function s(t,e,i,s){this.hls=t,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new n.default(e),this.fast_=new n.default(i)}e.default=i},"./src/utils/ewma.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(n.prototype.sample=function(t,e){var i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t},n.prototype.getTotalWeight=function(){return this.totalWeight_},n.prototype.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},n);function n(t){this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}e.default=s},"./src/utils/get-self-scope.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getSelfScope=function(){return"undefined"==typeof window?self:window}},"./src/utils/logger.js":function(t,e,i){"use strict";function s(){}function n(n){var r=o.console[n];return r?function(){for(var t,e,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];i[0]&&(i[0]=(t=n,e=i[0],"["+t+"] > "+e)),r.apply(o.console,i)}:s}Object.defineProperty(e,"__esModule",{value:!0});var i=i("./src/utils/get-self-scope.js"),r={trace:s,debug:s,log:s,warn:s,info:s,error:s},a=r,o=i.getSelfScope();e.enableLogs=function(t){if(!0===t||"object"==typeof t){!function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];t.forEach(function(t){a[t]=e[t]?e[t].bind(e):n(t)})}(t,"debug","log","info","warn","error");try{a.log()}catch(t){a=r}}else a=r},e.logger=a},"./src/utils/mediakeys-helper.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;e.requestMediaKeySystemAccess=s},"./src/utils/mediasource-helper.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getMediaSource=function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}},"./src/utils/output-filter.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(n.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},n.prototype.newCue=function(t,e,i){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},n);function n(t,e){this.timelineController=t,this.trackName=e,this.startTime=null,this.endTime=null,this.screen=null}e.default=s},"./src/utils/texttrack-utils.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sendAddTrackEvent=function(t,e){var i=null;try{i=new window.Event("addtrack")}catch(t){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=t,e.dispatchEvent(i)},e.clearCurrentCues=function(t){if(t&&t.cues)for(;0<t.cues.length;)t.removeCue(t.cues[0])}},"./src/utils/time-ranges.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={toString:function(t){for(var e="",i=t.length,s=0;s<i;s++)e+="["+t.start(s).toFixed(3)+","+t.end(s).toFixed(3)+"]";return e}}},"./src/utils/vttcue.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function A(t){return"string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()}function y(t){for(var e=1;e<arguments.length;e++){var i,s=arguments[e];for(i in s)t[i]=s[i]}return t}function t(t,e,i){var s=this,n=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),r={};n?s=document.createElement("custom"):r.enumerable=!0,s.hasBeenReset=!1;var a="",o=!1,d=t,l=e,u=i,h=null,c="",p=!0,g="auto",v="start",f=50,_="middle",E=50,m="middle";if(Object.defineProperty(s,"id",y({},r,{get:function(){return a},set:function(t){a=""+t}})),Object.defineProperty(s,"pauseOnExit",y({},r,{get:function(){return o},set:function(t){o=!!t}})),Object.defineProperty(s,"startTime",y({},r,{get:function(){return d},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",y({},r,{get:function(){return l},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");l=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",y({},r,{get:function(){return u},set:function(t){u=""+t,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",y({},r,{get:function(){return h},set:function(t){h=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",y({},r,{get:function(){return c},set:function(t){t="string"==typeof(t=t)&&!!S[t.toLowerCase()]&&t.toLowerCase();if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");c=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",y({},r,{get:function(){return p},set:function(t){p=!!t,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",y({},r,{get:function(){return g},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",y({},r,{get:function(){return v},set:function(t){t=A(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",y({},r,{get:function(){return f},set:function(t){if(t<0||100<t)throw new Error("Position must be between 0 and 100.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",y({},r,{get:function(){return _},set:function(t){t=A(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",y({},r,{get:function(){return E},set:function(t){if(t<0||100<t)throw new Error("Size must be between 0 and 100.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",y({},r,{get:function(){return m},set:function(t){t=A(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),s.displayState=void 0,n)return s}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var S={"":!0,lr:!0,rl:!0},e={start:!0,middle:!0,end:!0,left:!0,right:!0};return t.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},t}()},"./src/utils/vttparser.js":function(t,e,i){"use strict";function s(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new n,this.regionList=[]}function l(){this.values=Object.create(null)}function u(t,e,i,s){var n,r,a=s?t.split(s):[t];for(n in a)"string"!=typeof a[n]||2===(r=a[n].split(i)).length&&e(r[0],r[1])}function o(i,t,r){function e(){var t,t=(t=(t=i).match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/))?t[3]?e(t[1],t[2],t[3].replace(":",""),t[4]):59<t[1]?e(t[1],t[2],0,t[4]):e(0,t[1],t[2],t[4]):null;function e(t,e,i,s){return 3600*(0|t)+60*(0|e)+(0|i)+(0|s)/1e3}if(null===t)throw new Error("Malformed timestamp: "+d);return i=i.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){i=i.replace(/^\s+/,"")}var n,a,o,d=i;if(s(),t.startTime=e(),s(),"--\x3e"!==i.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+d);i=i.substr(3),s(),t.endTime=e(),s(),n=i,a=t,o=new l,u(n,function(t,e){switch(t){case"region":for(var i=r.length-1;0<=i;i--)if(r[i].id===e){o.set(t,r[i].region);break}break;case"vertical":o.alt(t,e,["rl","lr"]);break;case"line":var s=e.split(","),n=s[0];o.integer(t,n),o.percent(t,n)&&o.set("snapToLines",!1),o.alt(t,n,["auto"]),2===s.length&&o.alt("lineAlign",s[1],["start",p,"end"]);break;case"position":s=e.split(","),o.percent(t,s[0]),2===s.length&&o.alt("positionAlign",s[1],["start",p,"end","line-left","line-right","auto"]);break;case"size":o.percent(t,e);break;case"align":o.alt(t,e,["start",p,"end","left","right"])}},/:/,/\s/),a.region=o.get("region",null),a.vertical=o.get("vertical",""),"auto"===(n=o.get("line","auto"))&&-1===c.line&&(n=-1),a.line=n,a.lineAlign=o.get("lineAlign","start"),a.snapToLines=o.get("snapToLines",!0),a.size=o.get("size",100),a.align=o.get("align",p),"auto"===(n=o.get("position","auto"))&&50===c.position&&(n="start"===a.align||"left"===a.align?0:"end"===a.align||"right"===a.align?100:50),a.position=n}function d(t){return t.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(e,"__esModule",{value:!0});function n(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}}var h=i("./src/utils/vttcue.js");l.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,i){for(var s=0;s<i.length;++s)if(e===i[s]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(e=parseFloat(e))&&e<=100)&&(this.set(t,e),!0)}};var c=new h.default(0,0,0),p="middle"===c.align?"middle":"center";e.fixLineBreaks=d,s.prototype={parse:function(t){function e(){for(var t=0,e=d(e=s.buffer);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var i=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,s.buffer=e.substr(t),i}var s=this;t&&(s.buffer+=s.decoder.decode(t,{stream:!0}));try{var i=void 0;if("INITIAL"===s.state){if(!/\r\n|\n/.test(s.buffer))return this;var n=(i=e()).match(/^(Ã¯Â»Â¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");s.state="HEADER"}for(var r=!1;s.buffer;){if(!/\r\n|\n/.test(s.buffer))return this;switch(r?r=!1:i=e(),s.state){case"HEADER":/:/.test(i)?u(i,function(t,e){},/:/):i||(s.state="ID");continue;case"NOTE":i||(s.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){s.state="NOTE";break}if(!i)continue;if(s.cue=new h.default(0,0,""),s.state="CUE",-1===i.indexOf("--\x3e")){s.cue.id=i;continue}case"CUE":try{o(i,s.cue,s.regionList)}catch(t){s.cue=null,s.state="BADCUE";continue}s.state="CUETEXT";continue;case"CUETEXT":var a=-1!==i.indexOf("--\x3e");if(!i||a&&(r=!0)){s.oncue&&s.oncue(s.cue),s.cue=null,s.state="ID";continue}s.cue.text&&(s.cue.text+="\n"),s.cue.text+=i;continue;case"BADCUE":i||(s.state="ID");continue}}}catch(t){"CUETEXT"===s.state&&s.cue&&s.oncue&&s.oncue(s.cue),s.cue=null,s.state="INITIAL"===s.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),!this.cue&&"HEADER"!==this.state||(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return this.onflush&&this.onflush(),this}},e.default=s},"./src/utils/webvtt-parser.js":function(t,e,i){"use strict";!function(v){Object.defineProperty(e,"__esModule",{value:!0});function f(t,e,i){return t.substr(i||0,e.length)===e}function n(t){for(var e=5381,i=t.length;i;)e=33*e^t.charCodeAt(--i);return(e>>>0).toString()}var _=i("./src/utils/vttparser.js"),E=i("./src/demux/id3.js"),t={parse:function(t,r,a,o,e,i){var d,t=E.utf8ArrayToStr(new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),l="00:00.000",u=0,h=0,c=0,s=[],p=!0,g=new _.default;g.oncue=function(t){var e=a[o],i=a.ccOffset;e&&e.new&&(void 0!==h?i=a.ccOffset=e.start:function(t,e,i){var s=t[e],n=t[s.prevCC];if(!n||!n.new&&s.new)return t.ccOffset=t.presentationOffset=s.start,s.new=!1;for(;n&&n.new;)t.ccOffset+=s.start-n.start,s.new=!1,n=t[(s=n).prevCC];t.presentationOffset=i}(a,o,c)),c&&(i=c-a.presentationOffset),t.startTime+=i-h,t.endTime+=i-h,t.id=n(t.startTime.toString())+n(t.endTime.toString())+n(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),0<t.endTime&&s.push(t)},g.onparsingerror=function(t){d=t},g.onflush=function(){d&&i?i(d):e(s)},t.forEach(function(e){if(p){if(f(e,"X-TIMESTAMP-MAP=")){p=!1,e.substr(16).split(",").forEach(function(t){f(t,"LOCAL:")?l=t.substr(6):f(t,"MPEGTS:")&&(u=parseInt(t.substr(7)))});try{r+(9e4*a[o].start||0)<0&&(r+=8589934592),u-=r,t=l,i=parseInt(t.substr(-3)),s=parseInt(t.substr(-6,2)),n=parseInt(t.substr(-9,2)),t=9<t.length?parseInt(t.substr(0,t.indexOf(":"))):0,h=(v.isFinite(i)&&v.isFinite(s)&&v.isFinite(n)&&v.isFinite(t)?(i+=1e3*s,(i+=6e4*n)+36e5*t):-1)/1e3,c=u/9e4,-1===h&&(d=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){d=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(p=!1)}var t,i,s,n;g.parse(e+"\n")}),g.flush()}};e.default=t}.call(this,i("./src/polyfills/number.js").Number)},"./src/utils/xhr-loader.js":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("./src/utils/logger.js"),d=window.performance,n=window.XMLHttpRequest,i=(s.prototype.destroy=function(){this.abort(),this.loader=null},s.prototype.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},s.prototype.load=function(t,e,i){this.context=t,this.config=e,this.callbacks=i,this.stats={trequest:d.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},s.prototype.loadInternal=function(){var t=this.context,e=this.loader=new n,i=this.stats;i.tfirst=0,i.loaded=0;var s=this.xhrSetup;try{if(s)try{s(e,t.url)}catch(i){e.open("GET",t.url,!0),s(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(i){return void this.callbacks.onError({code:e.status,text:i.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},s.prototype.readystatechange=function(t){var e,i=t.currentTarget,s=i.readyState,n=this.stats,r=this.context,a=this.config;!n.aborted&&2<=s&&(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=Math.max(d.now(),n.trequest)),4===s?200<=(e=i.status)&&e<300?(n.tload=Math.max(n.tfirst,d.now()),s=t=void 0,s="arraybuffer"===r.responseType?(t=i.response).byteLength:(t=i.responseText).length,n.loaded=n.total=s,t={url:i.responseURL,data:t},this.callbacks.onSuccess(t,n,r,i)):n.retry>=a.maxRetry||400<=e&&e<499?(o.logger.error(e+" while loading "+r.url),this.callbacks.onError({code:e,text:i.statusText},r,i)):(o.logger.warn(e+" while loading "+r.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),n.retry++):this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),a.timeout))},s.prototype.loadtimeout=function(){o.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},s.prototype.loadprogress=function(t){var e=t.currentTarget,i=this.stats;i.loaded=t.loaded,t.lengthComputable&&(i.total=t.total);t=this.callbacks.onProgress;t&&t(i,this.context,null,e)},s);function s(t){t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}e.default=i}},s={},n.m=i,n.c=s,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s="./src/hls.js").default;function n(t){if(s[t])return s[t].exports;var e=s[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var i,s},"object"==typeof exports&&"object"==typeof module?module.exports=Z():"object"==typeof exports?exports.Hls=Z():Q.Hls=Z()),function(s){"use strict";function u(t,e){e=e||0;return d[t[e++]]+d[t[e++]]+d[t[e++]]+d[t[e++]]+"-"+d[t[e++]]+d[t[e++]]+"-"+d[t[e++]]+d[t[e++]]+"-"+d[t[e++]]+d[t[e++]]+"-"+d[t[e++]]+d[t[e++]]+d[t[e++]]+d[t[e++]]+d[t[e++]]+d[t[e++]]}function t(t,e,i){var s=e&&i||0;"string"==typeof t&&(e="binary"===t?new o(16):null,t=null);var n=(t=t||{}).random||(t.rng||a)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e)for(var r=0;r<16;r++)e[s+r]=n[r];return e||u(n)}var a,n,e,r,i;s&&function(){var i,t=s.crypto||s.msCrypto;if(!a&&t&&t.getRandomValues)try{var e=new Uint8Array(16);r=a=function(){return t.getRandomValues(e),e},a()}catch(t){}a||(i=new Array(16),n=a=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()"))}();for(var o="function"==typeof Buffer?Buffer:Array,d=[],l={},h=0;h<256;h++)d[h]=(h+256).toString(16).substr(1),l[d[h]]=h;var c=a(),p=[1|c[0],c[1],c[2],c[3],c[4],c[5]],g=16383&(c[6]<<8|c[7]),v=0,f=0,_=t;_.v1=function(t,e,i){var s=e&&i||0,n=e||[],r=null!=(t=t||{}).clockseq?t.clockseq:g,a=null!=t.msecs?t.msecs:(new Date).getTime(),o=null!=t.nsecs?t.nsecs:f+1;if((i=a-v+(o-f)/1e4)<0&&null==t.clockseq&&(r=r+1&16383),1e4<=(o=(i<0||v<a)&&null==t.nsecs?0:o))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=a,g=r,o=(1e4*(268435455&(a+=122192928e5))+(f=o))%4294967296,n[s++]=o>>>24&255,n[s++]=o>>>16&255,n[s++]=o>>>8&255,n[s++]=255&o,a=a/4294967296*1e4&268435455,n[s++]=a>>>8&255,n[s++]=255&a,n[s++]=a>>>24&15|16,n[s++]=a>>>16&255,n[s++]=r>>>8|128,n[s++]=255&r;for(var d=t.node||p,l=0;l<6;l++)n[s+l]=d[l];return e||u(n)},_.v4=t,_.parse=function(t,e,i){var s=e&&i||0,n=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){n<16&&(e[s+n++]=l[t])});n<16;)e[s+n++]=0;return e},_.unparse=u,_.BufferClass=o,_._rng=a,_._mathRNG=n,_._nodeRNG=e,_._whatwgRNG=r,"undefined"!=typeof module&&module.exports?module.exports=_:(i=s.uuid,_.noConflict=function(){return s.uuid=i,_},s.uuid=_)}("undefined"!=typeof window?window:null),function(){function r(t){var e=t.__resizeTriggers__,i=e.firstElementChild,t=e.lastElementChild,e=i.firstElementChild;t.scrollLeft=t.scrollWidth,t.scrollTop=t.scrollHeight,e.style.width=i.offsetWidth+1+"px",e.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight}function a(e){var i=this;r(this),this.__resizeRAF__&&s(this.__resizeRAF__),this.__resizeRAF__=t(function(){var t;(t=i).offsetWidth==t.__resizeLast__.width&&t.offsetHeight==t.__resizeLast__.height||(i.__resizeLast__.width=i.offsetWidth,i.__resizeLast__.height=i.offsetHeight,i.__resizeListeners__.forEach(function(t){t.call(i,e)}))})}var e,i,o=document.attachEvent,d=!1;if(!o){var t=(i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)},function(t){return i(t)}),s=(e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout,function(t){return e(t)}),n=!1,l="",u="animationstart",h="Webkit Moz O ms".split(" "),c="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),p=document.createElement("fakeelement");if(!1===(n=void 0!==p.style.animationName?!0:n))for(var g=0;g<h.length;g++)if(void 0!==p.style[h[g]+"AnimationName"]){l="-"+h[g].toLowerCase()+"-",u=c[g],n=!0;break}var v="resizeanim",f="@"+l+"keyframes "+v+" { from { opacity: 0; } to { opacity: 0; } } ",_=l+"animation: 1ms "+v+"; "}window.addResizeListener=function(e,t){var i,s,n;o?e.attachEvent("onresize",t):(e.__resizeTriggers__||("static"==getComputedStyle(e).position&&(e.style.position="relative"),d||(i=(f||"")+".resize-triggers { "+(_||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',s=document.head||document.getElementsByTagName("head")[0],(n=document.createElement("style")).type="text/css",n.styleSheet?n.styleSheet.cssText=i:n.appendChild(document.createTextNode(i)),s.appendChild(n),d=!0),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=document.createElement("div")).className="resize-triggers",e.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',e.appendChild(e.__resizeTriggers__),r(e),e.addEventListener("scroll",a,!0),u&&e.__resizeTriggers__.addEventListener(u,function(t){t.animationName==v&&r(e)})),e.__resizeListeners__.push(t))},window.removeResizeListener=function(t,e){o?t.detachEvent("onresize",e):(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),t.__resizeListeners__.length||(t.removeEventListener("scroll",a),t.__resizeTriggers__=!t.removeChild(t.__resizeTriggers__)))}}(),Q=this,Z=function(){"use strict";function c(t,e){var i,s=document.createElement(t||"div");for(i in e)s[i]=e[i];return s}function h(t){for(var e=1,i=arguments.length;e<i;e++)t.appendChild(arguments[e]);return t}function s(t,e){var i,s,n=t.style;if(void 0!==n[e=e.charAt(0).toUpperCase()+e.slice(1)])return e;for(s=0;s<r.length;s++)if(void 0!==n[i=r[s]+e])return i}function p(t,e){for(var i in e)t.style[s(t,i)||i]=e[i];return t}function e(t){for(var e=1;e<arguments.length;e++){var i,s=arguments[e];for(i in s)void 0===t[i]&&(t[i]=s[i])}return t}function g(t,e){return"string"==typeof t?t:t[e%t.length]}function i(t){this.opts=e(t||{},i.defaults,n)}var v,f,t,r=["webkit","Moz","ms","O"],_={},n={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};function l(t,e){return c("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',e)}return i.defaults={},e(i.prototype,{spin:function(t){this.stop();var i,s,n,r,a,o,d,l=this,u=l.opts,h=l.el=c(null,{className:u.className});return p(h,{position:u.position,width:0,zIndex:u.zIndex,left:u.left,top:u.top}),t&&t.insertBefore(h,t.firstChild||null),h.setAttribute("role","progressbar"),l.lines(h,l.opts),v||(s=0,n=(u.lines-1)*(1-u.direction)/2,r=u.fps,a=r/u.speed,o=(1-u.opacity)/(a*u.trail/100),d=a/u.lines,function t(){s++;for(var e=0;e<u.lines;e++)i=Math.max(1-(s+(u.lines-e)*d)%a*o,u.opacity),l.opacity(h,e*u.direction+n,i,u);l.timeout=l.el&&setTimeout(t,~~(1e3/r))}()),l},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=void 0),this},lines:function(t,i){function e(t,e){return p(c(),{position:"absolute",width:i.scale*(i.length+i.width)+"px",height:i.scale*i.width+"px",background:t,boxShadow:e,transformOrigin:"left",transform:"rotate("+~~(360/i.lines*l+i.rotate)+"deg) translate("+i.scale*i.radius+"px,0)",borderRadius:(i.corners*i.scale*i.width>>1)+"px"})}for(var s,n,r,a,o,d,l=0,u=(i.lines-1)*(1-i.direction)/2;l<i.lines;l++)o=p(c(),{position:"absolute",top:1+~(i.scale*i.width/2)+"px",transform:i.hwaccel?"translate3d(0,0,0)":"",opacity:i.opacity,animation:v&&(s=i.opacity,n=i.trail,r=u+l*i.direction,a=i.lines,d=o=void 0,o=["opacity",n,~~(100*s),r,a].join("-"),d=.01+r/a*100,r=Math.max(1-(1-s)/n*(100-d),s),a=v.substring(0,v.indexOf("Animation")).toLowerCase(),_[o]||(f.insertRule("@"+(a&&"-"+a+"-"||"")+"keyframes "+o+"{0%{opacity:"+r+"}"+d+"%{opacity:"+s+"}"+(.01+d)+"%{opacity:1}"+(d+n)%100+"%{opacity:"+s+"}100%{opacity:"+r+"}}",f.cssRules.length),_[o]=1),o+" "+1/i.speed+"s linear infinite")}),i.shadow&&h(o,p(e("#000","0 0 4px #000"),{top:"2px"})),h(t,h(o,e(g(i.color,l),"0 0 1px rgba(0,0,0,.1)")));return t},opacity:function(t,e,i){e<t.childNodes.length&&(t.childNodes[e].style.opacity=i)}}),"undefined"!=typeof document&&(t=c("style",{type:"text/css"}),h(document.getElementsByTagName("head")[0],t),f=t.sheet||t.styleSheet,!s(t=p(c("group"),{behavior:"url(#default#VML)"}),"transform")&&t.adj?(f.addRule(".spin-vml","behavior:url(#default#VML)"),i.prototype.lines=function(t,s){function n(){return p(l("group",{coordsize:a+" "+a,coordorigin:-r+" "+-r}),{width:a,height:a})}function e(t,e,i){h(d,h(p(n(),{rotation:360/s.lines*t+"deg",left:~~e}),h(p(l("roundrect",{arcsize:s.corners}),{width:r,height:s.scale*s.width,left:s.scale*s.radius,top:-s.scale*s.width>>1,filter:i}),l("fill",{color:g(s.color,t),opacity:s.opacity}),l("stroke",{opacity:0}))))}var i,r=s.scale*(s.length+s.width),a=2*s.scale*r,o=-(s.width+s.length)*s.scale*2+"px",d=p(n(),{position:"absolute",top:o,left:o});if(s.shadow)for(i=1;i<=s.lines;i++)e(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=s.lines;i++)e(i);return h(t,d)},i.prototype.opacity=function(t,e,i,s){t=t.firstChild;s=s.shadow&&s.lines||0,t&&e+s<t.childNodes.length&&((t=(t=(t=t.childNodes[e+s])&&t.firstChild)&&t.firstChild)&&(t.opacity=i))}):v=s(t,"animation")),i},"object"==typeof module&&module.exports?module.exports=Z():Q.Spinner=Z(),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_BUFFERING:"onAdBuffering",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",AD_VOLUME_CHANGE:"onAdVolumeChange",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:"onCdnUpdated",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYBACK_LIBRARY_LOADED:"onPlaybackLibraryLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},ErrorCode:{1001:"1200",1002:"",1003:"",2e3:"1000",2001:"1101",2002:"1100",2003:"1106",2004:"2004",2005:"2000",3e3:"3400",3001:"3100",3002:"3001",3003:"3200",3004:"3101",3005:"",3006:"3002",3007:"3102",3008:"3202",3009:"3401",3011:"3300",3012:"3301",3013:"",4e3:"4000",4001:"4300"},mapErrorCode:function(t){return uvpjs.ErrorCode[t]||t},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},tracking:{AKAMAI:"AkamaiQOSPluginJS",CONVIVA:"ConvivaQOSPluginJS",COMSCORE:"ComScore_ss",MUX:"MuxQOSPluginJS",NIELSEN:"NielsenTracking_SDK",HEARTBEAT:"SiteCatalyst",OZTAM:"OzTam"},getVideoManager:function(){return uvpjs.VideoManager.getInstance()},register:function(t){for(var e,i=t.split("."),s=window,n=i.length,r=0;r<n;r++)void 0===s[e=i[r]]&&(s[e]={}),s=s[e];return s},getClass:function(t){var e,i,s,n,r,a;if("string"!=typeof t)return t;for(e=t.split("."),i=window,s=e.length,n="",r=0;r<s;r++){if(n+=a=e[r],void 0===i[a])throw new Error("uvpjs.getClass(): "+n+" is undefined.");r<s-1&&(n+="."),i=i[a]}return i},getObject:function(t){return uvpjs.getClass(t)}},function(){var o=!1,d=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(t){function e(){!o&&this.init&&this.init.apply(this,arguments)}var i,s,n,r,a=this.prototype;for(r in o=!0,s=new this,o=!1,i=function(i,s){return function(){var t,e=this._super;return this._super=a[i],t=s.apply(this,arguments),this._super=e,t}},t)t.hasOwnProperty(r)&&(n=t[r],s[r]="function"==typeof n&&"function"==typeof a[r]&&d.test(n)?i(r,n):n);return((e.prototype=s).constructor=e).subClass=arguments.callee,e}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),uvpjs.register("uvpjs").b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA==",function(){"use strict";uvpjs.register("uvpjs").util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(t){return t&&this.xhrMessages[t]||"XHR status: "+t},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(t){var e=document.createElement("a");return e.href=t,{host:e.hostname,pathname:e.pathname,protocol:e.protocol,search:e.search}},objFromQueryStr:function(t){for(var e,t="string"==typeof t?t:"",i=(-1<t.indexOf("?")?t.split("?")[1]:t).split("&"),s={},n=0,r=i.length;n<r;n++)s[(e=i[n].split("="))[0]]=e[1];return s},queryStrFromObj:function(t,e){var i,s="",n=!1;for(i in t)s+=(n?"&":"")+i+"="+(e?encodeURIComponent(t[i]):t[i]),n=!0;return s},uid8:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()},getUserStatusForQuery:function(t){var e="";switch(t){case"anon":e="sb=0";break;case"reg;sub;pay":e="sb=1";break;case"reg":e="sb=2";break;case"reg;sub;susp":e="sb=3";break;case"reg;sub;exsub":e="sb=4";break;case"reg;sub;trial":e="sb=5";break;default:if(-1<t.indexOf("|")){var i,s,n,r="",a=t.split(","),o=a.length;for(a.sort(),n=0;n<o;n++)2==(s=a[n].split("|")).length&&(i=s[0],s=s[1],r!=i?(0<e.length&&(e+="&"),e+=i+"="+s):e+=","+s,r=i)}}return e=""==e?"sb=0":e},firstInt:function(){for(var t,e=arguments.length,i=0;i<e;i++)if(t=arguments[i],parseInt(t)===t)return t},inRange:function(t,e,i){return"number"==typeof t&&e<=t&&t<=i},isEmpty:function(t){return null==t||Array.isArray(t)&&0===t.length||"object"==typeof t&&0===Object.keys(t).length||"string"==typeof t&&""===t},isPlainObject:function(t){return t&&"object"==typeof t&&t.constructor===Object},isFunction:function(t){return"function"==typeof t},isDefinedString:function(t){return!!(t&&"string"==typeof t&&0<t.length)},isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},isDefined:function(t){return void 0!==t},isFlagTrue:function(t){return!0===t||"true"===t||1===t||"1"===t},getDefinedString:function(){for(var t,e=arguments.length,i=0;i<e;i++)if(this.isDefinedString(t=arguments[i]))return t;return""},supportsLocalStorage:function(){var t;if(null===this.isLocalStorageSupported)try{localStorage.setItem("test","1"),t=localStorage.getItem("test"),this.isLocalStorageSupported="1"===t,localStorage.removeItem("test")}catch(t){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElement:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild},createStyleSheet:function(t,e){for(var i,s,n,r,a,o,d,l=document.styleSheets,u=l.length,h=function(){d||(t(n),d=!0)},c=0;c<u;c++){n=l[c];try{if((n.href&&n.href.replace(/http(s)?:/,""))===e)return void h()}catch(t){}}i="string"==typeof e&&""!==e,s=uvpjs.mediaCapabilities.isFirefox(),(n=document.createElement(!i||s?"style":"link")).setAttribute("type","text/css"),n.appendChild(document.createTextNode("")),i&&(n.setAttribute("rel","stylesheet"),n.setAttribute("href",e),n.textContent='@import "'+e+'"'),"function"==typeof t&&(n.onload=h,n.addEventListener&&n.addEventListener("load",h,!1),n.onreadystatechange=function(){"loaded"!==(r=n.readyState)&&"complete"!==r||(link.onreadystatechange=null,h())},a=setInterval(function(){document.styleSheets.length>u&&(h(),clearInterval(a))},10),s&&(o=setInterval(function(){try{n.sheet.cssRules,clearInterval(o),h()}catch(t){}},10)),document.getElementsByTagName("head")[0].appendChild(n))},addCSSObject:function(t,e,i,s){var n,r=uvpjs.util,a="#"+e.id+" "+(s||"");for(n in i)r.addCSSRule(t,a,n,i[n])},addCSSRule:function(t,e,i,s){var n=uvpjs.mediaCapabilities,r="string"==typeof s&&s.match(/NaN(%|px)/);if(t&&t.sheet)if(!r||n.isAndroid()&&n.isChrome()||(s="0"),n=((r=t.sheet).rules||r.cssRules).length,s=i+":"+s+";",r.insertRule)try{r.insertRule(e+"{"+s+"}",n)}catch(t){console.warn("Unable to add CSS rule: "+t.message)}else r.addRule&&r.addRule(e,s,n)},addCSSRules:function(t,e,i){for(var s,n=i.length;n--;)s=i[n],uvpjs.util.addCSSRule(t,e,s.name,s.value)},copyObjectWithKeyMap:function(t){var i=t,s=null;return this.from=function(t){return s=t,this},this.to=function(t){if(!(i&&s&&t))return t;for(var e in i)i.hasOwnProperty(e)&&s.hasOwnProperty(e)&&null!==s[e]&&(t[i[e]]=s[e]);return t},this}}}(),function(t){var f=uvpjs._,u=/\{mediaReferenceId}/g,h=/PARTNER/g,c=/\{ptype}/g,p=/\{VGUID}/g,g=/%7Bptype%7D/g,v=/%7BVGUID%7D/g,r=/;/g;t.adUtil={MOAT_PARTNER_CODE:"cbsiimajsint708425247896",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(t,e,i,s){var n,r=uvpjs.util,a="cust_params",o=t.split("?"),d=o[1],l=-1<t.indexOf("%7Bptype%7D"),t=-1<t.indexOf("{ptype}"),s=this.getAdParams(e,i,s),d=d.replace(u,s.vid).replace(h,s.partner);return l&&(d=d.replace(v,s.vguid).replace(g,s.ptype)),t&&(d=d.replace(p,s.vguid).replace(c,s.ptype)),t=r.objFromQueryStr(d),this.isExcludedFromVpaid(e)&&delete t.pp,(d=t[a])&&(n=r.objFromQueryStr(decodeURIComponent(d)),delete t[a]),d=s[a],delete s[a],delete s.partner,delete s.vguid,delete s.ptype,t=f.assign(s,t),n=f.assign(d,n||{}),0<=decodeURIComponent(t.iu).indexOf("/8264/")&&e.isMuteAtPlayStart&&!e.userHasUnmuted&&(t.sz="640x483"),this.removeEmpty(t),this.removeEmpty(n),t=r.queryStrFromObj(t,!1),n=r.queryStrFromObj(n,!1),t+="&"+a+"="+encodeURIComponent(n),o[0]+"?"+t},getAdParams:function(t,e,i){var s,n=t.dwPageParams,r=this.getDwViewGuid(t),a=this.getPpidValue(t),o=t.contentVideoState,d=encodeURIComponent(t.sessionOptions.partner),l=n.pagetype||"",u=this.getUserStatusKey(t.getSessionOption("userStatus")),h=""!==o.contPlayState&&!uvpjs.util.isFlagTrue(i)?"1":"0",c=t.getSessionOption("isEmbedded")?"1":"0",p=this.getHost("1"==c,t),n=o.pid,g={cust_params:{}},i=uvpjs.Configuration.env,v=t.getAdCallParams(),e=e?this.getVideoDfpId(t):"";for(s in g.vid=e,g.partner=d,g.ptype=l,g.vguid=r,g.cust_params.vguid=r,g.cust_params.embed=c,p&&(g.cust_params.host=p),this.populateCustParamsWithAdSessionValues(g.cust_params,n),0<o.podsToSkip.length&&(g.cust_params.resume=1,g.cust_params.skippod=o.podsToSkip),u)g.cust_params[s]=u[s];if(a&&(g.ppid=a,g.cust_params.ppid=a),"cbs"===d&&(g.cust_params.cpSession=h,g.cust_params.cpPre=h,g.cust_params.sub=f.isEmpty(t.sessionOptions.userId)?"":t.sessionOptions.userId),v&&!uvpjs.util.isEmpty(v.standardParams))for(s in v.standardParams)g[s]=v.standardParams[s];if(v&&!uvpjs.util.isEmpty(v.customParams))for(s in v.customParams)g.cust_params[s]=v.customParams[s];return this.isExcludedFromVpaid(t)?g.pp="ssai":"local"!==i&&"dev"!==i||(g.pp="vpaid_js"),g},getVideoDfpId:function(t){return uvpjs.util.isEmpty(t.contentVideoState.dfpMediaId)?t.contentVideoState.cmsRefGuid:t.contentVideoState.dfpMediaId},isExcludedFromVpaid:function(t){return"AA Original"===t.contentVideoState.contentType},getDwViewGuid:function(t){t=t.dwPageParams;return t&&t.viewguid||t.pguid||""},extractAdInfo:function(t,e){var i=e===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma";return uvpjs.util.isEmpty(t)||!e?(e||console.error("No 'context' arg supplied"),null):((e={adId:t.getAdId(),adSystem:t.getAdSystem(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId()}).adPodInfo=this.extractPodInfo(t.getAdPodInfo()),t=this[i](t),f.assign(e,t))},extractAdStateData:function(t,e,i){var s=t.getAdPodInfo(),n=s.getPodIndex(),r=s.getAdPosition(),a=t.getDuration(),o=i?"mid":0===n?"pre":1<=n?"mid":-1===n?"post":"",d=("mid"!=o?o+"_0":"mid_"+n)+"_"+r,s=e===this.context.IMA,i=s?this.extractIdInfo(t):null,n=this.getAdStateBlank();return n.adPosition=r,n.adBitrate=t.getVastMediaBitrate?t.getVastMediaBitrate():NaN,n.adServerName=s?this.context.IMA:this.context.DAI,n.adVideoTitle=t.getTitle(),n.duration=a,n.adType=o,n.adClipID=d,n.wrapperAdId=s&&i.wrapperAdId||"",n.adVideoId=s?i.wrapperAdId||i.adId:t.getAdId(),n.creativeId=s?i.wrapperCreativeId||i.creativeId:t.getCreativeId(),e===this.context.DAI&&(n.sourceWidth=t.getVastMediaWidth(),n.sourceHeight=t.getVastMediaHeight()),n},getAdStateBlank:function(){return{adPosition:null,adServerName:null,adVideoTitle:null,duration:null,adType:null,adClipID:null,wrapperAdId:null,adVideoId:null,creativeId:null}},extractIdInfo:function(t){var e=t.getWrapperAdIds(),i=t.getWrapperCreativeIds(),s=Array.isArray(e)&&e.length||0,n=Array.isArray(i)&&i.length||0,r=null,a=null,o=t.getAdId()||"",t=t.getCreativeId()||"";return s&&(1<s&&(r=e[1]),o=e[0]),n&&(1<n&&(a=i[1]),t=i[0]),{adId:o,wrapperAdId:r,creativeId:t,wrapperCreativeId:a}},getHost:function(t,e){var i;return t?(e=e.getSessionOption("referrer"))&&(i=uvpjs.util.parseUrl(e).host):i=window.location.hostname,i&&""!==i?i:null},getUserStatusKey:function(t){for(var e,i=uvpjs.util.getUserStatusForQuery(t).split("&"),s=i.length,n={};s--;)n[(e=i[s].split("="))[0]]=e[1];return n},trackAd:function(t){var e=t.model,i=t.context,s=e.getAdVideoState(),n=i===this.context.IMA,i=i===this.context.DAI;return n||i?(n=e.dwPageParams.pagetype||"",i={level1:"",level2:"",level3:s.adVideoId,level4:s.creativeId,slicer1:"vaw-can",slicer2:e.sessionOptions.partner,slicer3:n,moatVASTSystem:s.adServerName,moatVASTAdID:s.wrapperAdId},""!==(e=this.getDwViewGuid(e))&&(i.zMoatVGUID=e),""!==n&&(i.zMoatPT=n),this.initMoatTracking(t.adVideoContainer,i,s.duration,this.MOAT_PARTNER_CODE,null)):void console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(t){var e=this.getVpaidEventForEvent(t.eventName,t.context);e&&t.trackingHandle.dispatchEvent({type:e,adVolume:t.volume})},checkForAdBlocker:function(t){t=t.getSessionOption("adBlockerCallback");return t&&t()},populateCustParamsWithAdSessionValues:function(t,e){var i,s,n;if("function"==typeof window.getVideoAdSessionValues&&"string"==typeof(i=window.getVideoAdSessionValues(e))&&""!==i)for(n in i=i.replace(r,"&"),s=uvpjs.util.objFromQueryStr(i))t[n]=s[n]},removeEmpty:function(t){for(var e in t)null!==t[e]&&""!==t[e]||delete t[e]},extractAdInfoIma:function(t){return{contentType:t.getContentType(),isLinear:t.isLinear()}},extractAdInfoDai:function(t){return{advertiserName:t.getAdvertiserName(),description:t.getDescription(),duration:t.getDuration(),title:t.getTitle()}},extractPodInfo:function(t){return t?{adPosition:t.getAdPosition(),podIndex:t.getPodIndex(),timeOffset:t.getTimeOffset(),totalAds:t.getTotalAds()}:null},getPpidValue:function(t){t=t.getSessionOption("userPPID");return uvpjs.util.isDefinedString(t)?t:null},initMoatTracking:function(t,e,i,s,n){var r,a,o=document.createElement("script"),d=[];e={adData:{ids:e,duration:i,url:n},dispatchEvent:function(t){this.sendEvent?(d&&(d.push(t),t=d,d=!1),this.sendEvent(t)):d.push(t)}},n="_moatApi"+Math.floor(1e8*Math.random());try{a=(r=t.ownerDocument).defaultView||r.parentWindow}catch(t){a=window}return a[n]=e,o.type="text/javascript",t&&t.insertBefore(o,t.childNodes[0]||null),o.src="https://z.moatads.com/"+s+"/moatvideo.js#"+n,e},getVpaidEventForEvent:function(t,e){t=this.moatEventMapping[e][t];return uvpjs.util.isEmpty(t)?null:this.vpaidEvents[t]}}}(uvpjs.register("uvpjs")),function(){"use strict";uvpjs.Configuration={env:"prod",hostname:"",name:"UVPJS",version:"3.1.5",date:"05/06/21 4:16:11 PM (GMT+0000)",path:"/a/video-player/uvpjs-rv/3.1.5/",playerName:"video-player"}}(),uvpjs.register("uvpjs").AutoplayDetectionService=uvpjs.Class.subClass({init:function(t){this.mc=t.mediaCapabilities,this.completeCallback=t.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=t.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setInfo:function(t,e){this.mc.setAutoplayInfo({supportsUnmutedAutoplay:t,supportsMutedAutoplay:e})},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(t,e){this.killVid(),this.setInfo(t,e),setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var t;this.vidEl=t=this.createVideoElement(!1),t.load(),void 0===(t=t.play())?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):t.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var t;this.killVid(),this.checkForEarlySafari()?this.finishCheck(!1,!1):(this.vidEl=t=this.createVideoElement(!0),t.load(),t.play().then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1)))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var t=this.mc.getBrowserName()===this.mc.SAFARI,e=this.mc.isDesktop(),i=t&&e?this.mc.getBrowserVersion():null,t=i&&i.split("."),e=t?11===parseInt(t[0])&&0===parseInt(t[1]):null;return null!==i&&e&&(!t[2]||parseInt(t[2])<3)},detectMobileCapabilities:function(){var t=this.isAutoplayEligibleAndroid()||this.isAutoplayEligibleIos();this.finishCheck(!1,t)},isAutoplayEligibleAndroid:function(){return this.mc.isAndroid()&&this.mc.isChrome()&&this.isChromeAutoplayEligible()},isAutoplayEligibleIos:function(){var t=this.mc.isIOSTen(),e=t&&this.mc.isSafari(),t=t&&!e&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return e||t},isChromeAutoplayEligible:function(){return 54<=parseInt(this.mc.getBrowserMajorVersion())},createVideoElement:function(t){var e=document.createElement("video");return t&&(e.muted=!0,e.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(e,!0),e.volume=.005,e.style.width="100%",e.style.height="100%",e.src=this.testVidPath,this.testDom.appendChild(e),e},createTestDom:function(){var t=document.createElement("div"),e=t.style;return e.position="absolute",e.top="-1000px",e.left="-1000px",e.width="320px",e.height="180px",document.body.appendChild(t),t}}),uvpjs.MediaCapabilities=function(){var s,t,n,r,a,i,o,d,l,e,u,h,c,p=uvpjs._,g=uuid.noConflict(),v=!1,f={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",SHAKA:"SHAKA",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLACEHOLDER_M3U8_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLACEHOLDER_MP4_URL:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",MP4_BLANK_FILE:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLATFORM_OUTLET_ACCOUNT_ID:"dJ5BDC",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"http://can.cbs.com/thunder/player/videoManifest.php?assetType=HLS&authn=",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",FIREFOX_IOS:"FxiOS",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",FACEBOOK_IOS:"Facebook Browser iOS",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null,trackingAvailability:null},apDetectionService:null,_detectEnvironment:function(t,e){var i=this.systemInfo;return typeof t===this.STRING?s=t:s=navigator.userAgent||null,r=document.createElement(this.VIDEO),a=document.createElement(this.AUDIO),typeof e===this.BOOLEAN&&0,_(),y(),k(),v="https:"===location.protocol,i.browser=this.getBrowserName(),i.version=parseInt(this.getBrowserMajorVersion()),i.isMobile=this.isMobile(),i.isDesktop=this.isDesktop(),i.os=this.getOS()+"; ver. "+this.getOSVersion(),i.supportsMse=this.hasMediaSourceSupport(),i.isHlsjsEligible=this.canPlayHLSJS(),i.supportsNativeHls=this.canPlayNativeHLS(),i.supportsMp4=this.canPlayH264(),i.supportsDash=this.canPlayDASH(),this.canUseDataUrl()||(this.PLACEHOLDER_MP4_URL=this.MP4_BLANK_FILE),this},canUseDataUrl:function(){return!1},determineAutoplayCapabilities:function(t){var e;null===this.systemInfo.supportsUnmutedAutoplay?(e=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,t()}.bind(this),this.apDetectionService=new uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:e,testVidPath:this.PLACEHOLDER_MP4_URL})):t()},setTrackingInfo:function(t){var e,i,s=uvpjs.tracking,n={};for(i in s)e=s[i],n[i]=!!t[e];this.systemInfo.trackingAvailability=n},setAutoplayInfo:function(t){this.systemInfo.supportsUnmutedAutoplay=t.supportsUnmutedAutoplay,this.systemInfo.supportsMutedAutoplay=t.supportsMutedAutoplay},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSessionId:function(){return g.v1().replace(/-/g,"")},checkBrowserName:function(t){return typeof t===this.STRING&&this.getBrowserName()===t},canPlayHTML5Video:function(){var t=document.createElement(this.VIDEO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var t=document.createElement(this.AUDIO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION},getBrowserName:function(){return u||"unknown"},getBrowserVersion:function(){return h||-1},getBrowserMajorVersion:function(){return c||-1},getBrowserVendorPrefix:function(){return this.isFirefox()?"moz":this.isWebKit()?"webkit":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(t,e){if(typeof e===this.OBJECT){var i=e.exec(this.getUserAgent()),s="",e="";if(i&&typeof i===this.OBJECT&&i.length&&1<i.length)return(s=i[1]||"").indexOf(".")?"object"==typeof(i=s.split("."))&&i.length&&0<i.length&&(e=i[0]):e=s,u=t,h=s,c=e,!0}return!1},hasTealium:function(){return p.has(window,"utag")||p.has(window,"utag_data")},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)||this.checkBrowserName(this.FIREFOX_IOS)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(t){return typeof t===this.STRING&&(this._detectEnvironment(t),!0)},getUserAgent:function(){return s},getMimeTypesObj:function(){return t||(t=typeof navigator===this.OBJECT&&navigator.mimeTypes&&0<navigator.mimeTypes.length?navigator.mimeTypes:t)},getMimeTypes:function(){if(typeof n===this.OBJECT)return n;var t={length:0},e=this.getMimeTypesObj();if(typeof e===this.OBJECT){for(var i=0;i<this.length;i++){var s=e[i].enabledPlugin&&e[i].enabledPlugin.name?e[i].enabledPlugin.name:"";t[e[i].type]={type:e[i].type,description:e[i].description,suffixes:e[i].suffixes,enabledPlugin:e[i].enabledPlugin,enabledPluginName:s},t.length++}return n=t}},getPlatform:function(){return typeof o===this.STRING?o:null},getOS:function(){return typeof d===this.STRING?d:null},getOSVersion:function(){return typeof l===this.STRING?l:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return 0<=this.getUserAgent().toLowerCase().indexOf(this.CHROMEOS.toLowerCase())},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof e===this.BOOLEAN?e:e=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return S()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP2p:function(){return this.canPlayHLSJS()&&!this.isIE()&&!this.isEdge()},hasMediaSourceSupport:function(){var t,e;return null===this.hasMse&&(t=window.MediaSource||window.WebKitMediaSource,e=window.SourceBuffer||window.WebKitSourceBuffer,t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove,this.hasMse=!(!t||!e)),this.hasMse},canPlayHLSJS:function(t){var e=this.isMobile(),i=!!S(),s=this.hasMediaSourceSupport(),n=this.isFirefox()||this.isChrome(),r=this.isIE()&&11<=this.getBrowserMajorVersion()||this.isEdge(),a=this.isOpera()&&30<=this.getBrowserMajorVersion(),o=this.isPlaystation();return!(!s||!i||o||e&&!this.canPlayHlsjsAndriod(t))&&(!!t||n||r||a)},canPlayHlsjsAndriod:function(t){var e=this.getUserAgent();return!!(0<=e.indexOf("Android")&&5<=parseFloat(e.slice(e.indexOf("Android")+8))&&t)},canPlayNativeHLSAudio:function(){return D()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return S()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return S()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return S()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(t,e){return S()&&this.canPlayMediaType(this.VIDEO,t,e||!1)},canPlayAudioType:function(t,e){return S()&&this.canPlayMediaType(this.AUDIO,t,e||!1)},canPlayMediaType:function(t,e,i){t=t===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return i=1==i,!(typeof t!==this.OBJECT||typeof t.canPlayType!==this.FUNCTION||!(i&&t.canPlayType(e)===this.PROBABLY||!i&&""!==t.canPlayType(e)))},canPlayType:function(t,e){e=1==e;var i=/audio\//.test(t)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return!(typeof i!==this.OBJECT||typeof i.canPlayType!==this.FUNCTION||!(e&&i.canPlayType(t)===this.PROBABLY||!e&&""!==i.canPlayType(t)))},nativeCanPlayType:function(t,e){t=t===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof t===this.OBJECT&&typeof t.canPlayType===this.FUNCTION&&t.canPlayType(e)||null},canPlayDASHType:function(t){if(typeof t!==this.STRING||t.length<1)return null;var e=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(t)&&this.hasMSE()&&e.isTypeSupported(t)},canPlayDASH264:function(t){return t=typeof t===this.STRING?t:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(t)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},requiresSeparateTagsForIMA:function(){var t=this.getUserAgent();return t&&!(this.isChromecast()||this.isIOS()||-1<t.indexOf("Android 2.")||-1<t.indexOf("Android 4.0")||-1<t.indexOf("Android 4.1"))},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(t){return!(t&&this.supportsAutoplay()||this.isChromecast()||this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutoplay:function(){return this.supportsMutedAutoplay()},supportsIntelligentMobileAutoplay:function(){return this.isIOSTen()&&this.isIPhone()},requiresInlinePlayAttribute:function(t){return t&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(t){return!t&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(t,e){var i=this.getInlinePlayAttribute(),s=i&&i.name;e&&i?i&&t.setAttribute(s,i.value):!e&&s&&t.removeAttribute(s)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignToken:function(){return this.isSafari()?"middle":"center"},isIOSTen:function(){return this.isIOS()&&10<=parseInt(this.getBrowserVersion())},getPreferredPlaceholderURL:function(){return this.isIOS()?this.PLACEHOLDER_M3U8_URL:this.PLACEHOLDER_MP4_URL},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var t="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return t&&!t.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof google},getStandaloneMode:function(){return navigator.standalone||null},hasNativeFullscreen:function(){return!uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var t,e;return void 0===this._hasFullscreenApiSupport&&(this.isIOS()?this._hasFullscreenApiSupport=!1:(t=document.createElement("div"),e=uvpjs.util,this._hasFullscreenApiSupport=!!(e.isFunction(t.requestFullscreen)||e.isFunction(t.webkitRequestFullscreen)||e.isFunction(t.mozRequestFullScreen)||e.isFunction(t.msRequestFullscreen)))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(t){var e=document,e=this.supportsFullscreenApi()&&(e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled);return e=!e?t&&t.webkitSupportsFullscreen:e},getDevice:function(){return i||null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var t=this.isIOS();return!t||10<=parseInt(this.getBrowserVersion())},supportsCaptionsCSS:function(){return!this.isFirefox()&&!this.isIE()&&!this.isEdge()},supportsVolume:function(){return!this.isIOS()},isTouch:function(){return"ontouchstart"in window||navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(t){return/\.m3u|assetType=hls/i.test(t)},isDashUrl:function(t){return/\.mpd/i.test(t)},isSecure:function(){return v},setUrlProtocol:function(t){return v?t.replace("http:","https:"):t},getDrmType:function(t){var e="none";return t.enabled&&((this.isIOS()||this.isSafari())&&null!==t.fairplay.appCertURL?e="Fairplay":(this.isIE()||this.isEdge())&&null!==t.dash.playreadyURL?e="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==t.dash.widevineURL&&(e="Widevine")),e}},_=function(){var t=new RegExp(/\s(\([^)]+\))/).exec(f.getUserAgent());t&&t.length&&1<t.length&&(t=t[1].replace(/_/gi,"."),m(t)||A(t)||E(t)||C(t))},E=function(t){return(-1!==t.indexOf(f.LINUX)||-1!==t.indexOf(f.ANDROID))&&(o=f.LINUX,-1!==t.indexOf(f.ANDROID)&&(t=new RegExp(/\ Android\ ([^\s]+);/).exec(t),i=f.ANDROID,d=f.ANDROID,l=t&&t[1]?t[1]:""),!0)},m=function(t){if(-1!==t.indexOf(f.MAC))return o=f.MAC,i=f.DESKTOP,-1!==t.indexOf(f.OSX)&&(t=new RegExp(/Mac\ OS\ X\ ([\d\.]+)/).exec(t),d=f.OSX,l=t&&t[1]?t[1]:null),!0;if(-1===t.indexOf("like Mac OS X"))return!1;o=f.MAC,d=f.IOS;var e=/\sOS\s([^\s]*)\s/.exec(t);if(e&&e[1]&&(l=e[1]),/\(iPhone;/.test(t))i=f.IPHONE;else if(/\(iPad;/.test(t))i=f.IPAD;else{if(!/\(iPod;/.test(t))return!1;i=f.IPOD}return!0},A=function(t){var e=new RegExp(/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/);if((t=e.exec(f.getUserAgent()))&&t[2])return o=f.WINDOWS,d=f.WINDOWS_PHONE,l=t[2],i=f.PHONE,!0;if((t=(e=new RegExp(/Windows\ NT\ ([^\s]+)[;\)]/)).exec(f.getUserAgent()))&&t[1]){o=f.WINDOWS,d=f.WINDOWS;t=t[1];return 6==t?d=f.WINDOWS_VISTA:6.1==t?(d=f.WINDOWS7,l=7):6.2==t?(d=f.WINDOWS8,l=8):10==parseInt(t)&&(d=f.WINDOWS10,l=t),i=f.DESKTOP,!0}return!1},y=function(){return!!(T()||b()||R()||P()||M()||O()||L()||I()||N())},S=function(){return r},D=function(){return a},T=function(){var t=/Chrome\/(\S+)/,e=/CriOS\/(\S+)/,i=f.getUserAgent(),s=e.test(i);return!(!t.test(i)&&!s||/(Opera|OPR)/.test(i)||/Edge/.test(i)||/CrKey/.test(i)||(f.setBrowserVersion(f.CHROME,s?e:t),0))},I=function(){var t=/Playstation (\S+)/i;return!!t.test(f.getUserAgent())&&(f.setBrowserVersion(f.PLAYSTATION,t),!0)},C=function(){return null!=f.getUserAgent()&&-1<f.getUserAgent().indexOf(f.CHROMECAST_USER_AGENT)&&(o=f.LINUX,i=f.CHROMECAST,d=f.ANDROID,!0)},b=function(){var t=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,e=/\ Edge\/([^\s]+)/,i=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return t.test(f.getUserAgent())?(f.setBrowserVersion(f.IE,t),!0):e.test(f.getUserAgent())?(f.setBrowserVersion(f.EDGE,e),!0):!!i.test(f.getUserAgent())&&(f.setBrowserVersion(f.IE,i),!0)},R=function(){var t=/Firefox\/(\S+)/,e=/FxiOS\/(\S+)/,i=f.getUserAgent(),s=e.test(i),i=!s&&t.test(i)?f.FIREFOX:s?f.FIREFOX_IOS:null;return!!i&&(f.setBrowserVersion(i,s?e:t),!0)},P=function(){var t=/Version\/(\S+).*Safari\//,e=t.test(f.getUserAgent()),i=d===f.ANDROID?f.ANDROID:f.SAFARI;return!!e&&(f.setBrowserVersion(i,t),!0)},M=function(){var t=new RegExp(/Opera|OPR\/(\S+)/).exec(f.getUserAgent());if(t){t=-1!==t.indexOf("Opera Mini/")||-1!==t.indexOf("Opera Mobi")?f.OPERA_MOBILE:f.OPERA;return f.setBrowserVersion(t,/Opera|OPR\/(\S+)/),!0}return!1},O=function(){return!!/Silk/i.test(f.getUserAgent())&&(f.setBrowserVersion(f.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},L=function(){return!!/Android/.test(f.getUserAgent())&&(u=f.ANDROID_BROWSER,!0)},N=function(){var t=f.getUserAgent();if(!/FBAN/.test(t))return!1;var e,i,e=(t=(e=t).match(/\[(.*)\]/),e=null,i={},(e=t&&0<t.length?t[1]:e).split(";").forEach(function(t){t=t.split("/");0<t.length&&(i[t[0]]=t[1])}),i);return e.FBSN&&(d=e.FBSN),e.FBSV&&(l=e.FBSV),!(!e.FBAN||!/iOS/i.test(e.FBAN)||(u=f.FACEBOOK_IOS,0))},k=function(){var t,e,i=S(),s=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullscreen","fullscreenElement","fullscreenError"],n=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"],r=null;f.isIOS()?r=n:i.requestFullscreen?r=s:i.webkitRequestFullscreen?r=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:i.mozRequestFullScreen?r=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:i.msRequestFullscreen?f.getBrowserVersion()<12?r=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(r=s.slice())[5]=null:f.isAndroid()&&(r=n),e=r,(t=f)._fullscreenEventName=e?e[0]:null,t._fullscreenEnterEventName=e?e[1]:null,t._fullscreenExitEventName=e?e[2]:null,t._enterFullscreenMethodName=e?e[3]:null,t._exitFullscreenMethodName=e?e[4]:null,t._isFullscreenPropertyName=e?e[5]:null,t._fullscreenElementName=e?e[6]:null,t._fullscreenErrorEventName=e?e[7]:null};return f},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",SDK_LOAD_MANAGER:"SdkLoadManager",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",VPF_SHAKA:"VPF_SHAKA",SHAKA_LIB:"SHAKA_LIB"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(t){var e=uvpjs._,i=uvpjs.mediaCapabilities;this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,e.isObject(t)?(this.cookie=this._getCookie(),this.CDO=t,this.isEnabled=!0===this.cookie.enabled||this._isEnabled(),this.showAll=!0===this.cookie.showAll||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=!0===this.cookie.showTimestamps||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=!0===this.cookie.showClockTime||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=i.isChrome()||i.isFirefox()||i.isSafari(),this.setSessionStartTime()):this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.")},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(t,e,i){this.debugCount++;var s,n,r=uvpjs._;(this.isEnabled||r.isUndefined(this.CDO))&&(r.isString(t)&&r.isString(e)&&!r.isUndefined(i)?(this.showAll||r.isUndefined(this.CDO)||this.isParamEnabled(e)||!0===this.cookie[e])&&(s=this.showTimestamps?"["+this._timestamp()+"] ":"",n=r.drop(arguments,3),n=r.isEmpty(n)?"":n,this.supportsFormatting?console[t]("%s%cUVPJS %c%s%c %s",s,";font-weight:bold;",";text-decoration:underline;",e,";text-decoration:none;",i,n):console[t]("%sUVPJS %s %s",s,e,i,n)):console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+i,e))},isParamEnabled:function(t){return!0===this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,t)},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&!0===this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)},_timestamp:function(){var t=uvpjs._,e=new Date-this.adjustedStartTime,i=e%1e3,s=(e=(e-i)/1e3)%60,n=(e=(e-s)/60)%60,e=(e=(e-n)/60)%24-this.adjustedTimezone;return t.padStart(e,2,"0")+":"+t.padStart(n,2,"0")+":"+t.padStart(s,2,"0")+"."+t.padStart(i,3,"0")},_getCookie:function(){var t=this._readCookie(this.COOKIE_NAME),e={};if(!t)return e;uvpjs.log(this.DEBUG_ID,"_getCookie cookie",t);try{e=JSON.parse(t)}catch(t){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",t)}return uvpjs.log(this.DEBUG_ID,"_getCookie obj",e),e},_readCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0,n=i.length;s<n;s++){for(var r=i[s];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(e))return r.substring(e.length,r.length)}return null}},Z=uvpjs.register("uvpjs"),J=Z._,Z.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(t){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",t),this.mc=null,this._createControls=t.createControls,this._createAds=t.createAds,this._useInlinePlayAttribute=t.useInlinePlayAttribute,this._useMutedAttribute=t.useMutedAttribute,this._DOMReadyCB=t.callback,this._useAutoplayAttribute=t.useAutoplayAttribute,this._userAgent=null,this.adClickElement=null,this.dom=X(),this.dom.outer.id=t.containerID},initialize:function(){uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var t=this.dom.video.el;t&&t instanceof HTMLElement&&(t.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),t.removeEventListener(this.PLAY,this._handleEvent,!1),t.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return J.clone(this.dom)},createAdClickElement:function(){var t,e={position:"absolute","z-index":100,padding:"4px 6px",height:"16px","text-align":"center","line-height":"16px","font-size":"12px",color:"#000",background:"#dedede",top:0,right:0,display:"none"};for(t in this.adClickElement=document.createElement("div"),e)this.adClickElement.style[t]=e[t];this.adClickElement.innerHTML="<span>Learn More</span>",this.dom.outer.el.appendChild(this.adClickElement)},showAdContainer:function(t){this.dom.ad.el&&(this.dom.ad.el.style.display=t?"block":"none")},showAdClickElement:function(t){this.adClickElement&&(this.adClickElement.style.display=t?"inline-block":"none")},getAdClickElement:function(){return this.adClickElement||this.createAdClickElement(),this.adClickElement},_disableVideoContextMenu:function(){var t=this.dom.video.el;t.addEventListener?t.addEventListener("contextmenu",function(t){t.preventDefault()},!1):t.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){var t=this.dom;t.outer.el=document.getElementById(t.outer.id),J.isNull(this.dom.outer.el)?this.debug&&uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",t.outer.id):(t.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),t.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),t.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),t.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),t.content.el=this._getOrCreateElement("content"),t.outer.el.insertBefore(t.content.el,t.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),t.ad.el=this._getOrCreateElement("ad"),t.outer.el.insertBefore(t.ad.el,t.content.el.nextSibling)),this._createControls?(t.controls.el=this._getOrCreateElement("controls"),t.outer.el.appendChild(t.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._DOMReadyCB())},_createVideoElement:function(){var t=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),e=document.querySelectorAll(t);if(!(e instanceof NodeList&&e[0]instanceof HTMLElement&&e[0].id))return t=[this.dom.outer.id,this.dom.video.id].join(" "),(e=document.querySelectorAll(t))instanceof NodeList&&e[0]instanceof HTMLElement?e[0].id?void 0:(e[0].id=this.dom.video.id,void this.dom.content.el.appendChild(e[0])):(t=this._getOrCreateElement("video"),this._checkVideoTagAttributes(t),this.dom.content.el.appendChild(t),void(this.dom.video.el=t));this._checkVideoTagAttributes(e)},_createPlaceholderContent:function(){var t=this.dom.video.el;uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||J.isNull(this._userAgent)&&this.mc.isIPhone()?t.innerHTML='<source src="'+this.dom.video.url+'">':t.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),t.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),t.addEventListener(this.CAN_PLAY,this._handleEvent,!1),t.addEventListener(this.PLAY,this._handleEvent,!1),t.addEventListener(this.PAUSE,this._handleEvent,!1),t.style.width="100%",this._DOMReadyCB()},_handleEvent:function(t){var e=this.dom.video.el;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent",t),!J.isNull(e)){var i=this._useSeparateTags?e.getElementsByTagName("source")[0]:e;if(!J.isNull(i)){if(t.type===this.LOADED_METADATA&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,t.target),e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===i.src.indexOf(this.dom.video.url))return e.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeEventListener(this.PLAY,this._handleEvent,!1),void e.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",t.type),t.type){case this.CAN_PLAY:e.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),e.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:e.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(e.removeEventListener(this.PLAY,this._handleEvent,!1),e.pause(),!J.isFunction(this.dom.video.callback)){this.debug&&uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:e.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_checkVideoTagAttributes:function(t){this._useMutedAttribute&&t.setAttribute("muted","muted"),this._useAutoplayAttribute&&t.setAttribute("autoplay","autoplay"),this.mc.setVideoForInlinePlay(t,this._useInlinePlayAttribute)},_addInlineStyles:function(){var t;this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds&&((t=this.dom.ad.el).style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0")},_getIdByPrefix:function(t){if(!J.isNull(t))return uvpjs.domConstants[t]+this.dom.outer.id},_getOrCreateElement:function(t){var e=this.dom[t],t=document.getElementById(e.id);return J.isNull(t)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Creating element <"+e.type+' id="'+e.id+'">.'),(t=document.createElement(e.type)).id=e.id),t}}),X=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}},function(t){var r=t._;t.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,dfpMediaId:null,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,ozTamMediaId:null,ozTamOptOut:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,uvpc:null,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null,licenseURL:null,header:{}},dash:{widevineURL:null,playreadyURL:null,widevine:{url:null,header:{}},playready:{url:null,header:{}}}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,averageDroppedFPS:0,audioInfo:{},bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adBitrate:0,adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.errorRecovery=null,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(t,e,i,s){r.isString(t)&&r.isObject(e)&&r.isObject(i)?(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+t),this.vidContId=t,this.cviMgr=e,this.CDO=i,this.sessionOptions=s,this.eventsMgr=e.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),this.mergeCDOData()):this.debug&&uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN")},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&r.isNumber(t.payload.newState)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+t.payload.newState),(t=t.payload.newState)!==uvpjs.mediaCapabilities.EMPTY&&t!==uvpjs.mediaCapabilities.LOADING&&t!==uvpjs.mediaCapabilities.STOPPED&&t!==uvpjs.mediaCapabilities.PLAYING&&t!==uvpjs.mediaCapabilities.PAUSED&&t!==uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=t,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState))},onVideoProgress:function(t){var e=t.payload;t.target===this.vidContId&&(this.isCurrVideoAd=e.isAd,this.playbackState=e.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=e.currentTime,this.adPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.adPlaybackState.duration=e.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=e.playbackStarted,this.adPlaybackState.playbackComplete=e.playbackComplete,this.adPlaybackState.sourceBitrate=e.sourceBitrate,this.adPlaybackState.playbackBitrate=e.playbackBitrate,this.adPlaybackState.errorInfo=e.errorInfo,this.adPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=e.currentTime,this.contentPlaybackState.absoluteStreamTime=e.absoluteStreamTime||e.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=e.playbackStarted,this.contentPlaybackState.playbackComplete=e.playbackComplete,this.contentPlaybackState.sourceBitrate=e.sourceBitrate,this.contentPlaybackState.playbackBitrate=e.playbackBitrate,this.contentPlaybackState.videoFramerate=e.videoFramerate,this.contentPlaybackState.isSeeking=e.isSeeking,this.contentPlaybackState.isHDStreamLive=e.isHDStreamLive,this.contentPlaybackState.isPlayingLive=e.isPlayingLive,this.contentPlaybackState.currentContentSegment=e.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=e.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=e.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=e.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=e.lastPercentageCompleted,this.contentPlaybackState.bufferLength=e.bufferLength,this.contentPlaybackState.switchingMode=!0===this.useDynamicSwitching?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=e.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&r.isNumber(t.payload.vol)&&(this.volume=t.payload.vol,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&(this.isFullscreen=t.payload.isFs)},onContextMetadata:function(t){r.isPlainObject(t)&&t.target===this.vidContId&&r.isPlainObject(t.target.contextMetadata)},onResourceStart:function(t){this.resetAdPlaybackState(),this.resetContentPlaybackState()},resetAdPlaybackState:function(){r.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){r.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoState:function(){r.assign(this.contentVideoState,this.contentVideoStateDefaults)},getAdCallParams:function(){return this.CDO.getAdCallParams()},setAdCallParams:function(t){this.CDO.setAdCallParams(t)},isId3HandlingRequired:function(){return this.getConfiguredId3OwnerIds()||this.isNielsenTrackingEnabled()},getConfiguredId3OwnerIds:function(){var t=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof t&&t.length?t:null},isNielsenTrackingEnabled:function(){return!0===this.getModule("NielsenTracking_SDK").enabled},getValueForKey:function(t){var e=void 0;return e=t&&r.isString(t)&&this.hasOwnProperty(t)&&!r.isFunction(this[t])?this[t]:e},getModule:function(t){if(r.isString(t))return this.CDO.getModule(t)},getModuleParam:function(t,e){if(r.isString(t)&&r.isString(e))return this.CDO.getModuleParam(t,e)},getModules:function(){return this.CDO.getModules()},copyModules:function(t){this.CDO.copyModules(t)},isModuleEnabled:function(t){return!(!t||!r.isString(t))&&this.CDO.isModuleEnabled(t)},isModuleSet:function(t){return!uvpjs.util.isEmpty(t)&&this.CDO.isModuleSet(t)},getSessionOption:function(t){return t?this.sessionOptions[t]:null},getClass:function(t){if(r.isString(t))return this.CDO.getClass(t)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(t,e){return this.CDO.getClassProperty(t,e)},getClassListItems:function(t){return this.CDO.getClassListItems(t)},getClassListItemProperty:function(t,e,i){return this.CDO.getClassListItemProperty(t,e,i)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoState:function(){return this.isCurrVideoAd?this.getAdVideoState():this.getContentVideoState()},getContentVideoState:function(){var t={};return r.assign(t,this.contentVideoState),t},getAdVideoState:function(){var t={};return r.assign(t,this.adVideoState),t},getContentPlaybackState:function(){var t={};return r.assign(t,this.contentPlaybackState),t},getAdPlaybackState:function(){return r.assign({},this.adPlaybackState)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInfo:function(t){this.contentVideoState.abrInfo=t,this.contentPlaybackState.abrInfo=t},setAdVideoState:function(t){this.adVideoState=r.assign({},this.adVideoStateDefaults,t||{})},setContentVideoStateItems:function(t){this._addItemsToInstanceObj("contentVideoState",t)},setContentPlaybackStateItems:function(t){this._addItemsToInstanceObj("contentPlaybackState",t)},setAdVideoStateItems:function(t){this._addItemsToInstanceObj("adVideoState",t)},setAdPlaybackStateItems:function(t){this._addItemsToInstanceObj("adPlaybackState",t)},setNonDefaultContentVideoStateItems:function(t){this.setContentVideoStateItems(this._removeDefaults(t,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(t){this.setAdVideoStateItems(this._removeDefaults(t,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},getVideoPlaybackCDOProperty:function(t){var e=this.VIDEO_PLAYBACK_SETTINGS,i=this.isModuleEnabled(e),t=this.getModuleParam(e,t);if(i&&t)return t},setAbrStartBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.START_BITRATE);void 0!==t&&this.setStartBitrate(t)},setAbrMinBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MIN_BITRATE);void 0!==t&&this.setMinBitrate(t)},setAbrMaxBitrateFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.MAX_BITRATE);void 0!==t&&this.setMaxBitrate(t)},setLiveSyncDurationCountFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.LIVE_SYNC_DURATION_COUNT);void 0!==t&&this.setLiveSyncDurationCount(t)},setCapLevelToPlayerSizeFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.CAP_LEVEL_TO_PLAYER_SIZE);void 0!==t&&this.setCapLevelToPlayerSize(t)},setDashJSFastSwitchABRFromCDO:function(){var t=this.getVideoPlaybackCDOProperty(this.DASHJS_FAST_SWITCH_ABR);void 0!==t&&this.setDashJSFastSwitchABR(t)},setStartBitrate:function(t){this.startBitrate=t,this.setContentPlaybackStateItems({startBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(t){this.minBitrate=t,this.setContentPlaybackStateItems({minBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(t){this.maxBitrate=t,this.setContentPlaybackStateItems({maxBitrate:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(t){this.liveSyncDurationCount=t,this.setContentPlaybackStateItems({liveSyncDurationCount:t}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(t){this.capLevelToPlayerSize=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(t){this.enableDashJSFastSwitchABR=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setAudioTrackInfo:function(t){this.contentPlaybackState.audioInfo=t},getAudioTrackInfo:function(){return this.contentPlaybackState.audioInfo},setErrorRecovery:function(t){this.errorRecovery=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set errorRecovery to : ",this.errorRecovery)},setUseDynamicSwitching:function(t){this.useDynamicSwitching=t,this.debug&&uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var i=this;r.forOwn(this.sessionOptions,function(t,e){if(r.isString(t))return r.has(i.contentVideoState,e)?void(i.contentVideoState[e]=t):r.has(i.adVideoState,e)?void(i.adVideoState[e]=t):void 0}),this.debug&&(uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(i,s){return r.omitBy(i,function(t,e){return i[e]===s[e]})},_addItemsToInstanceObj:function(t,e){var i,s,n;if(i=this[t])if(r.isObject(e))for(s in this.debug,i)n=e[s],!e.hasOwnProperty(s)||r.isUndefined(n)||r.isFunction(n)||(i[s]=n);else this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",e);else this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+t)}})}(uvpjs.register("uvpjs")),Z=uvpjs.register("uvpjs"),z=Z._,Z.CodeLoader=uvpjs.Class.subClass({init:function(){this.debug=uvpjs.debug,this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,clearTimeout(this.timeoutHandle),this.timeoutHandle=null},loadScript:function(t,e,i){var s,n;for(this.debug&&uvpjs.log(this.DEBUG_ID,"loadScript urls",t),this.scriptsLoadedCB=e,this.timeout=i||this.REQUEST_TIMEOUT,z.isString(t)&&this.urls.push(t),z.isArray(t)&&(this.urls=t),n=this.urls.length,s=0;s<n;s++)this._getScript(this.urls[s])},_getScript:function(e){this.debug&&uvpjs.log(this.DEBUG_ID,"_getScript url",e);function i(t,e){z.isFunction(s._onScriptLoaded)&&!s._onScriptLoaded.done?(s.urls=z.without(s.urls,t),s._onScriptLoaded({url:t,error:e})):s.debug&&uvpjs.warn(s.DEBUG_ID,"_getScript _doCallback callback not a function or already called.")}var s=this,t=document.createElement("script");t.src=this._setUrlProtocol(e),t.async=!0,t.onreadystatechange=t.onload=function(){t.readyState&&!/loaded|complete/.test(t.readyState)||i(e)},t.onerror=function(t){uvpjs.error(s.DEBUG_ID,"_getScript "+t.target.src+" is not accessible."),i(e,t)},document.querySelector("head").appendChild(t),this.timeoutHandle=setTimeout(function(t){-1===z.indexOf(s.urls,t)||(this.debug&&uvpjs.warn(s.DEBUG_ID,"_getScript request timeout"),i(t,"timeout"))}.bind(this,e),this.timeout)},_onScriptLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var e=z.isEmpty(this.urls);this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),e&&z.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(t))},createCORSRequest:function(t,e){var i=new XMLHttpRequest;return e=this._setUrlProtocol(e),"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(t,e):i=!1,i},loadXHR:function(t,e,i,s){var n;if(t=this._setUrlProtocol(t),!1===(n=this.createCORSRequest("GET",t)))return uvpjs.warn(this.DEBUG_ID,"loadXHR CORS not supported for url = "+t),void i(n);s&&!uvpjs.util.isEmpty(s)&&(n.responseType=s),n.timeout=this.REQUEST_TIMEOUT,n.onload=function(){(z.inRange(n.status,200,400)?e:i)(n)},n.onerror=function(){i(n)},n.ontimeout=function(){i(n)},n.send()},loadXML:function(t,e,i){this.loadXHR(t,e,i,"document")},loadArrayBuffer:function(t,e,i){this.loadXHR(t,e,i,"arraybuffer")}}),Z=uvpjs.register("uvpjs"),W=Z._,Z.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t){var e=t.vidContId;if(!t.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=uvpjs.debug,this.vidContId=e,this.eventsMgr=t.eventsMgr,this.cviModel=new uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=t.readyCallback,this.cachedOptions={suppressFacadePlay:t.suppressFacadePlay,deferLoadingCaptions:t.playerOptions.deferLoadingCaptions},this.cviModel.initialize(e,this,t.CDO,t.playerOptions),this.initialPlaybackInfo={},setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContainers:function(t){if(!this.RPM)throw new Error("Must be called after cviMgr init completes");this.RPM.setContainers(t)},setAdCallParams:function(t){this.cviModel.setAdCallParams(t)},setInitialPlaybackType:function(t,e){this.initialPlaybackInfo.isAutoplay=t,this.initialPlaybackInfo.isMuteAtPlayStart=e},setContextMetadata:function(t){this.cviModel.contentVideoState.contextMetadata=t||null},setPlaybackInfoOnModel:function(){this.cviModel.isAutoplay=this.initialPlaybackInfo.isAutoplay,this.cviModel.isMuteAtPlayStart=this.initialPlaybackInfo.isMuteAtPlayStart},finishInit:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var i=this.cachedOptions;this.RPM=new uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:i.suppressFacadePlay,p2pClient:t||null,multiCdnClient:e||null,deferLoadingCaptions:i.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:i.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(t){var e=this.cviModel.getSessionOption("adBlockerCallback"),i=!(!e||!e()),s=this.eventsMgr.eventTypes,n=uvpjs.ErrorInfo,e=window.google&&google.ima;this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+i),i&&this.eventsMgr.dispatchEvent(s.AD_BLOCKED,{errorInfo:new n({eventType:s.AD_BLOCKED,errorCode:n.errorCodes.AD_BLOCKING_DETECTED,message:n.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),i||e?e&&(W.isEmpty(this.imaAdDisplayContainer)?(this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(t),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer),(t=this.adsLoader.getSettings()).setAutoPlayAdBreaks(!0),t.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)):this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed")):this.eventsMgr.dispatchEvent(s.PLAYER_START_ERROR,{errorInfo:new n({eventType:s.PLAYER_START_ERROR,errorCode:n.errorCodes.IMA_SDK_MISSING,message:n.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId)},_createIMAAdDisplayContainer:function(t){var e;return this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId).getElementsByTagName("video")[0],e=new google.ima.AdDisplayContainer(this.adVideoDiv,e,t),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",t),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",e),e},onAdsManagerLoaded:function(t){var e=uvpjs.util,i=e.isEmpty(this.RPM),s=e.isEmpty(this.RPM.currRP),e=this.RPM.currRP.getProviderType()!==uvpjs.mediaCapabilities.RP_IMA;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",t),i||s||e)return e="CVI mgr: onAdsManagerLoaded; ",e+=i?"no RPM found":s?"no current RP found":"RP not of type RP_IMA",this.debug&&uvpjs.log(this.DEBUG_ID,e),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+e,isFatal:!1})},this.vidContId);this.RPM.currRP.onAdsManagerLoaded(t)},onAdError:function(t){var e=!W.isEmpty(this.RPM)&&this.RPM,i=e&&!W.isEmpty(e.currRP)&&e.currRP;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",t),!e||!i)return this.debug&&uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId);"function"==typeof i.handleAdsLoaderError&&i.handleAdsLoaderError(t)},destroyIMAAdsLoader:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),this.RPM.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(t){void 0===t&&(t={}),this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,t,this.vidContId)},seekToRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRequest = "+t),W.isNaN(t)?this.debug&&uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+t):(-1===t&&this.seekToLiveRequest(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:t},this.vidContId))},seekToLiveRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",t),W.isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:t},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",t),W.isString(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:t},this.vidContId)},showCaptionsRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{language:t},this.vidContId)},setCaptionLanguage:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SET_CAPTIONS_LANG,{language:t},this.vidContId)},hideCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},getCaptionInfo:function(){return this.captionsMgr.getCaptionInfo()},setCaptionsStyleRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",t),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(t):this.captionsMgr.setStyles(t)},setCaptionsCuePropertyRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",t,e),this.captionsMgr.setCueProperty(t,e)},getCaptionsStyleRequest:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},getAudioTrackInfo:function(){return this.cviModel.getAudioTrackInfo()},setAudioTrack:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_AUDIO_TRACK,{id:t})},resizeRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+t+"  height = "+e),!W.isNaN(t)&&!W.isNaN(e)&&0<=t&&0<=e&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:t,height:e},this.vidContId)},fullscreenRequest:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",t),W.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:t},this.vidContId)},setUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:t},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){return this.cviModel.getContentVideoState()},getAdVideoData:function(){return this.cviModel.getAdVideoState()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.cviModel.sessionId},setPageContextMetadata:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",t),W.isPlainObject(t)},setNativeControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",t),W.isBoolean(t)&&(this.cviModel.nativeControls=t)},createPauseAdRetriever:function(){var t=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),e={eventsMgr:this.eventsMgr,adCallUrl:t,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};return t?uvpjs.PauseAdRetriever?void(this.pauseAdRetriever=new uvpjs.PauseAdRetriever(e)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path.")):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+t))},checkForPauseAd:function(){var t=this.cviModel.isModuleEnabled("PauseAd"),e=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/PauseAdRetriever.js";t&&(uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(new uvpjs.CodeLoader).loadScript(e,this.createPauseAdRetriever.bind(this)))}}),(Z=uvpjs.register("uvpjs")).ErrorInfo=uvpjs.Class.subClass({init:function(t){t=t||{};this.errorCode=t.errorCode||null,this.eventType=t.eventType||null,this.isFatal=!!t.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=t.message||null,this.adInfo=t.adInfo||null,this.serverCode=t.serverCode||null,this.hlsjsErrorCode=null}}),Z.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},Z.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."},Z=uvpjs.register("uvpjs"),K=Z._,Y=Math.random(),Z.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(t){this.debug=uvpjs.debug,t&&t===Y?(this.timerCBOs=[],this.registeredEventsTable={},this._startUVPJSClock(this.uvpjsClockInterval)):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance().")},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],uvpjs.EventsManager.destroyInstance()},addEventListener:function(t,e){var i,s;t&&K.isString(t)&&e&&K.isFunction(e)?!1!==(s=this._returnValidEvtTypeAndNameSpace(t))?(i=s[0],s=s[1],this.registeredEventsTable[i]||(this.registeredEventsTable[i]={}),this.registeredEventsTable[i][s]?this.debug&&uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",i," ns = ",s):(this.debug&&uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",i," ns = ",s),this.registeredEventsTable[i][s]=e)):this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+t},this.internalNS):this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(t){if(!t||!K.isString(t))return this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",t),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var e,i=this._returnValidEvtTypeAndNameSpace(t);!1!==i?(e=i[0],i=i[1],this.registeredEventsTable[e]&&this.registeredEventsTable[e][i]?(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",t),delete this.registeredEventsTable[e][i]):this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",t)):this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",t)},dispatchEvent:function(t,e,i){var s={};if(t&&K.isString(t))if(K.isUndefined(e)||K.isPlainObject(e))if(K.isUndefined(i)||K.isString(i)){var n=this.registeredEventsTable[t];if(n)for(var r in K.isUndefined(e)&&(e={}),K.isUndefined(i)&&(i=""),s.type=t,s.payload=e,s.target=i,n)n.hasOwnProperty(r)&&n[r](s)}else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+t+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS)},_returnValidEvtTypeAndNameSpace:function(t){var e=[],i=t.split(".");if(i.length<2)return!1;t=i[0];i.shift();i=i.join("_");return!(!this._validateEventType(t)||-1<i.indexOf("undefined"))&&(e[0]=t,e[1]=i,e)},_validateEventType:function(t){var e,i=!1,s=this.eventTypes;for(e in s)if(s.hasOwnProperty(e)&&s[e]===t){i=!0;break}return i},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(t){this.sessionStartTime=Date.now(),(this.sessionMilliseconds=0)!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),t)},destroyUVPJSClock:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(t,e,i,s){this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",e);var n={};t&&K.isNumber(t)&&e&&K.isString(e)&&i&&K.isFunction(i)&&(!s||K.isNumber(s)||!(1<=s||-1===s))?(n={freq:t=t<this.uvpjsClockInterval?this.uvpjsClockInterval:t,ns:e=e.split(".").join("_"),cb:i,rptCnt:-1,nextTime:Date.now()+t},s&&(n.rptCnt=s),this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",t),this.timerCBOs.push(n)):this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeTimedEventCallback:function(t,e){var i,s;if(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",t+" ns = "+e),t&&K.isNumber(t)&&e&&K.isString(e))for(e=e.split(".").join("_"),i=this.timerCBOs.length;i--;)(s=this.timerCBOs[i]).freq===t&&s.ns===e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",s.freq+" CBO.ns = "+s.ns),this.timerCBOs.splice(i,1));else this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},uvpClockTick:function(){this.sessionMilliseconds=Date.now()-this.sessionStartTime;for(var t,e=Date.now(),i=this.timerCBOs.length-1;0<=i;i--)e>=(t=this.timerCBOs[i]).nextTime&&(t.cb(),t.nextTime=e+t.freq,-1!==t.rptCnt&&(t.rptCnt=t.rptCnt-1,0===t.rptCnt&&this.timerCBOs.splice(i,1)))},eventTypes:{SWITCH_AUDIO_TRACK:"switchAudioTrack",FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLAYBACK_LIBRARY_LOADED:uvpjs.EventType.PLAYBACK_LIBRARY_LOADED,PLAYER_INIT:uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_LOADED:uvpjs.EventType.AD_LOADED,AD_REQUEST:uvpjs.EventType.AD_REQUEST,AD_RESPONSE:uvpjs.EventType.AD_RESPONSE,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_SKIPPED:uvpjs.EventType.AD_SKIPPED,AD_CLICK:uvpjs.EventType.AD_CLICK,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,AD_BLOCKED:uvpjs.EventType.AD_BLOCKED,AD_BUFFERING:uvpjs.EventType.AD_BUFFERING,AD_VOLUME_CHANGE:uvpjs.EventType.AD_VOLUME_CHANGE,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:uvpjs.EventType.CDN_UPDATED,CAPTIONS_ERROR:"onCaptionsError",SET_CAPTIONS_LANG:"onSetCaptionLang",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),Z.EventsManager._instance=null,Z.EventsManager.destroyInstance=function(){this._instance=null},Z.EventsManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.EventsManager(Y)),this._instance},Z=uvpjs.register("uvpjs"),H="www.nielsen.com",Z.AbstractId3Parser=uvpjs.Class.subClass({init:function(t){this.findNielsen=t.findNielsen,this.dataCallback=t.dataCallback,this.ownerIds=this.assembleOwnerIds(t.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},parse:function(t){throw new Error("Abstract method parse() must be implemented in subclass")},setLengths:function(t){for(var e=t.length,i=[];e--;)i[e]=t[e].length;return i},assembleOwnerIds:function(t,e){var i,s,n=[];if("string"==typeof t)for(s=(i=t.split(",")).length;s--;)n.push(i[s].trim());return e&&-1===n.indexOf(H)&&n.push(H),n}}),uvpjs.register("uvpjs").FrameId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(t){for(var e=t.length,i=0;i<e;i++)t[i].data&&this.findId3(t[i])},findId3:function(t){var e,i,s,n=0,r=t.data;n+=3,"ID3"===this.readStr(r,0,3)&&(n+=3,e=127&r[n++],i=127&r[n++],s=127&r[n++],n=127&r[+n],this.findId3PrivateFrame(t,10,10+((e<<21)+(i<<14)+(s<<7)+n)))},findId3PrivateFrame:function(t,e,i){for(var s,n=t.data;e+8<=i;)s=this.readStr(n,e,4),e+=4,n[e++],n[e++],n[e++],n[e++],n[e++],n[e++],"PRIV"===s&&this.parseFrame(t,e)},parseFrame:function(t,e){for(var i,s,n=this.idLengths,r=this.totalIds,a=t.data;r--;)if(s=n[r],(i=this.readStr(a,e,s))===this.ownerIds[r]){e+=s,s="www.nielsen.com"===i?this.parseNielsen(i,a,e):this.readStr(a,++e,a.length),this.dataCallback({name:i,data:s,pts:t.pts});break}},parseNielsen:function(t,e,i){i=t+this.readStr(e,i,e.length-(i+2));return 249===i.length?i:null},readStr:function(t,e,i){for(var s="",n=e||0,r=e+i;s+=String.fromCharCode(t[n++]),n<r;);return s}}),uvpjs.register("uvpjs").TrackId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(t){if(1===t.length){var e=t[0];if("PRIV"===e.value.key)for(var i=0;i<this.ownerIds.length;i++){var s=this.ownerIds[i];-1!==e.value.info.indexOf(s)&&this.dataCallback({name:s,data:"www.nielsen.com"===s?e.value.info:String.fromCharCode.apply(null,new Uint8Array(e.value.data)),pts:e.startTime})}}}}),(x=uvpjs.register("uvpjs")).SdkLoadManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.SDK_LOAD_MANAGER,initCallback:null,cdo:null,historyItems:{},getHistory:function(){var t,e={};for(t in this.historyItems)e[t]=this.historyItems[t];return e},sdkModules:{AkamaiQOSPluginJS:{isDefined:function(){return void 0!==window.AkaHTML5MediaAnalytics},getPath:function(t){var e="//79423.analytics.edgesuite.net/js/csma.js",e=t&&t.getModuleParam("AkamaiQOSPluginJS","libpath")||e;return uvpjs.mediaCapabilities.isSecure()?[e.replace("edgesuite","edgekey")]:[e]}},ConvivaQOSPluginJS:{isDefined:function(){return void 0!==window.Conviva},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js"]}},ComScore_ss:{isDefined:function(){return void 0!==window.ns_&&void 0!==window.ns_.ReducedRequirementsStreamingAnalytics},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js"]}},MuxQOSPluginJS:{isDefined:function(){return void 0!==window.mux},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/mux.js"]}},NielsenTracking_SDK:{isDefined:function(){return void 0!==window.NOLCMB},getPath:function(){return["//cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js"]}},SiteCatalyst:{isDefined:function(){return!("undefined"==typeof ADB||"undefined"===x._.get(ADB,"va.Heartbeat"))},getPath:function(t){var e=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",i=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js";return t.sessionOptions.usesTealium?[i]:[e,i]}},OzTam:{isDefined:function(){return void 0!==window.OzTAMService},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/oztam-service.js"]}}},init:function(t,e){var i=[],s=t.getModules(),n=uvpjs.util;if(this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",t),this.cdo=t,this.initCallback=e,n.isEmpty(s))this.invokeCallbackWithHistory();else{t.getModule("MuxQOSPluginJS")||s.push({name:"MuxQOSPluginJS",enabled:"true"});for(var r=s.length;r--;){var a,o,d=s[r],l=d.name,u=this.sdkModules[d.name];if(d.enabled&&u)if(u.isDefined())this.addToHistory({name:d.name,loaded:!0});else for(o=(a=u.getPath(t)).length;o--;)i.push({name:l,path:a[o]})}n.isEmpty(i)?this.invokeCallbackWithHistory():this.bulkLoad(i)}},invokeCallbackWithHistory:function(){var t=this.initCallback,e=this.getHistory();setTimeout(function(){t(e)},1)},bulkLoad:function(t){var s=t,n=[],i=(this.handleAllLoadResults,function(t,e,i){n.push({name:t,result:i}),e.destroy(),0===s.length?this.handleAllLoadResults(n):r()}),r=function(){var t=s.shift(),e=new uvpjs.CodeLoader;e.loadScript(t.path,i.bind(this,t.name,e))}.bind(this);r()},handleAllLoadResults:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"handleAllLoadResults",t);for(var e=t.length;e--;){var i=t[e];i.result.error&&uvpjs.warn(this.DEBUG_ID,"Tracking  SDK load error: "+i.result.error),this.addToHistory({name:i.name,loaded:!i.result.error})}this.initCallback(this.getHistory())},addToHistory:function(t){t.name?!1!==this.historyItems[t.name]&&(this.historyItems[t.name]=!t.error&&t.loaded):this.debug&&uvpjs.warn(this.DEBUG_ID,"module name not found",t)},destroy:function(){this.initCallback=null,this.cdo=null,this.historyItems=null}}),Z=uvpjs.register("uvpjs"),V=Z._,Z.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(t){this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=t.p2pClient||null,this.multiCdnClient=t.multiCdnClient||null,this.mc=uvpjs.mediaCapabilities,this.suppressFacadePlay=t.suppressFacadePlay,this.deferLoadingCaptions=t.deferLoadingCaptions,this.playlistPaused=!1,V.isEmpty(t)||this.initialize(t.vidContId,t.cviMgr)},initialize:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",t),V.isString(t)&&V.isObject(e)?(this.vidContId=t,this.cviMgr=e,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,this._addEventListeners()):this.debug&&uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS")},setContainers:function(t){this.containers=t},setCaptionStyle:function(t){uvpjs.util.isEmpty(this.currRP)||this.currRP.setCaptionStyle(t)},onResourceLoadRequest:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",t.payload.rcObj),this.playlistPaused=!1,t=this._createResourceProvider(t.payload.rcObj),this.rscProviders.unshift(t),this.playlistInterruptionCleanup())},onResourceAddRequest:function(t){if(t.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",t.payload.rcObjs);for(var e,i=t.payload.rcObjs,s=i.length,n=0;n<s;n++)e=this._createResourceProvider(i[n]),this.rscProviders.push(e);V.isEmpty(this.currRP)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(t){if(t.target===this.vidContId){for(var e,i=t.payload.rcObjs,s=i.length,n=this.rscProviders,r=this.usedRPs,a=!1,o=!uvpjs.util.isEmpty(this.currRP);s--;)e=i[s],this.removeFromList(e,n),this.removeFromList(e,r),o&&!a&&(a=this.isMatchingResource(e,this.currRP.rco.rcoSeed));a&&this.advancePlaylist()}},removeFromList:function(t,e){for(var i=e.length;i--;)this.isMatchingResource(t,e[i].rco.rcoSeed)&&e.splice(i,1)},isMatchingResource:function(t,e){var i=uvpjs.util;return t.type===e.type&&(!i.isEmpty(t.pid)&&t.pid===e.pid||!i.isEmpty(t.assetURL)&&t.assetURL===e.assetURL||!i.isEmpty(t.selectorCall)&&t.selectorCall===e.selectorCall)},onResourcePlaylistPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),t.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(t){t.target===this.vidContId&&this.playlistPaused&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,V.isEmpty(this.currRP)&&0<this.rscProviders.length&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(t){t.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),V.isEmpty(this.currRP)||V.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(t)},forceDynamicMidrollPodEnd:function(){!V.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),V.isEmpty(this.currRP)||V.isNull(this.currRP.rco)?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(t){var e,i={rco:t,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient};switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",t),t.type){case this.mc.RP_URL:e=new uvpjs.RP_URL(i);break;case this.mc.RP_PLATFORM:e=new uvpjs.RP_Platform(i);break;case this.mc.RP_DAI:e=new(t.useSsb()?uvpjs.DaiSsbResourceProvider:uvpjs.DaiResourceProvider)(i);break;case this.mc.RP_IMA:e=new uvpjs.RP_IMA(i);break;case this.mc.RP_MDIALOG:e=new uvpjs.RP_Mdialog(i)}return e},_loadNextRP:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),V.isEmpty(this.currRP)||V.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),0<this.rscProviders.length&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),!V.isObject(this.currRP))return this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.advancePlaylist();this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay)},rpDataLoadErrorCB:function(t){this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",t.message),this.eventsMgr.dispatchEvent(t.eventType,{errorInfo:t},this.vidContId),this.advancePlaylist()},resourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:t},this.vidContId)},resourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",t),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:t,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),0<this.rscProviders.length&&!V.isEmpty(this.currRP)&&V.isNull(this.currRP.rco)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}}),Z=uvpjs.register("uvpjs"),G=Z._,Z.VideoControlInterface=uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr=null,this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.useBrowserNativeControls=!1,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1,this.autoplayRestrictionChecked=!1,this.contentStartReceived=!1},initialize:function(t,e,i,s,n){var r=!0===n.skin;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId =",t),G.isString(t)&&G.isObject(e)&&G.isObject(i)&&G.isFunction(s)?(this.vidContId=t,this.namespace=".vci_"+t,this.eventsMgr=e,this.CDO=i,this.vciReadyCB=s,this._usesIMA=n.usesIMA,this._loadSkinFlag=r,this._isPreviewBtnInternallyManaged=r,this._isUnmutedAutoplay=n.enableUnmutedAutoplay,this._isMutedAutoplay=n.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),this.useBrowserNativeControls=!!n.useBrowserControls,this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager({vidContId:t,eventsMgr:e,CDO:i,playerOptions:n,suppressFacadePlay:this.checkNativeAutoplay(n.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,n)})):this.debug&&uvpjs.log(this.DEBUG_ID,"-")},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(t){var e={skin:!0===t.skin,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:t.customCSS,enableReplay:t.enableReplay,previewImage:t.previewImage,themeName:t.themeName,controls:t.controls,template:t.template};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.useBrowserNativeControls&&this.CVI_Mgr.setNativeControls(!0),this.DOMMgr=new uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:t.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(t.enableNativeMobileAutoplay),callback:this.onDOMReady.bind(this,e)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(uvpjs.EventType.AD_LOADED+this.namespace,this.onAdLoaded.bind(this)),this.addEventListener(uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(uvpjs.EventType.AD_END+this.namespace,this.onAdEnd.bind(this)),this.addEventListener(uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(uvpjs.EventType.CONTENT_START+this.namespace,this.onContentStart.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.hAdClick.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(uvpjs.EventType.AD_POD_END+this.namespace)},onAdLoaded:function(t){},onAdStart:function(t){t=t.payload.adData;this.DOMMgr.showAdContainer(!0),this.autoplayRestrictionChecked||this.checkAutoplayRestriction(t),t.isCustomClickTrackingUsed&&this.DOMMgr.showAdClickElement(!0)},onAdEnd:function(t){this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},onContentStart:function(){this.contentStartReceived=!0,this.isWaitingForFirstTouch=!1,this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},hAdClick:function(){var t,e;this.handleFirstGesture(),this.skinMgr&&(t=this.skinMgr,e=this.mc.PAUSED,setTimeout(function(){t.setPlaystate(e)},200))},setAdCallParams:function(t){this.CVI_Mgr.setAdCallParams(t)},checkAutoplayRestriction:function(t){this.autoplayRestrictionChecked=!0,this.contentStartReceived||"pre"!==t.adType||"ima"!==t.adServerName||!this._isMutedAutoplay||this.mc.isSingleVideoIma()||this.mc.supportsUnmutedAutoplay()||this.isPreparedForAutoplay||(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(t){this.eventsMgr.dispatchEvent(uvpjs.EventType.FIRST_GESTURE,t,this.vidContId)},prepForRestrictedAutoplay:function(t){var e=this.dom.video.el,i=function(){this.isPreparedForAutoplay=!0,e.removeEventListener("play",i,!1),e.muted=!1,t&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this);this.debug&&uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),e.src=this.mc.getPreferredPlaceholderURL(),e.addEventListener("play",i,!1),e.muted=!0,e.load();var s=e.play();void 0!==s&&s.then(Function.prototype).catch(function(t){console.warn("UVPJS:VCI.prepForRestrictedAutoplay: priming Promise rejected.")})},handleFirstGesture:function(t){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:t||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(t){this.dom=this.DOMMgr.getDOM(),this.useBrowserNativeControls?(this.CVI_Mgr.setNativeControls(!0),this.dom.video.el.setAttribute("controls","controls")):addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&!0===this.CDO.getSessionOption("enableDiagnosticWindow")&&(this.diagnostic=new uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),this.useBrowserNativeControls||!this._loadSkinFlag?this.onVCIReady():this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:t})},checkNativeAutoplay:function(t){return t&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady"),this._vciReadySent||(this._autoPlay||!this._isPreviewBtnInternallyManaged||this._previewButtonDone?(this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses(this.DOMMgr.getAdClickElement())),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId))},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",t),G.isString(t)?this.CVI_Mgr.loadDynamicAdCall(t):this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)")},forceDynamicMidrollPodEnd:function(){this.CVI_Mgr.forceDynamicMidrollPodEnd()},onPreviewButton:function(t){return uvpjs.log(this.DEBUG_ID,"onPreviewButton"),uvpjs.util.isFunction(t)?(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone?(uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=t,void this.playBlankVideo()):(uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),void t())):void(this.debug&&uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function."))},canOverrideUserGesture:function(){return!this.playRequiresUserGesture||this.playRequiresUserGesture&&this._playBlankVideoDone},overrideUserGesture:function(t){var e;if(!0!==t&&!this.canOverrideUserGesture())return e=uvpjs.ErrorInfo,void(t=this.eventsMgr).dispatchEvent(t.eventTypes.PLAYER_START_ERROR,{errorInfo:new e({eventType:t.eventTypes.PLAYER_START_ERROR,errorCode:e.errorCodes.USER_GESTURE_REQUIRED,message:e.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId);this.onPreviewButton(this.onVCIReady.bind(this))},addEventListener:function(t,e){t&&G.isString(t)&&G.isFunction(e)?this.eventsMgr.addEventListener(t,e):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId)},removeEventListener:function(t){t&&G.isString(t)?this.eventsMgr.removeEventListener(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,t),void this.playBlankVideo();t=this.createResourceConfig(t),G.isObject(t)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:t},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)},addResourcesToPlaylist:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",t),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,t),void this.playBlankVideo();if(G.isArray(t)&&0<t.length){var e,i,s=[];for(e in t)i=this.createResourceConfig(t[e]),G.isObject(i)?s.push(i):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);0<s.length&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:s},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(t){var e,i,s,n="",r=!1,a=t.type===this.mc.RP_IMA,o=!1,d=null;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",t),(s=this.prevalidateRcObj(t)).error)return n="Resource configuration error: "+s.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(n,null),!1;switch(t.type){case this.mc.RP_URL:e=uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:e=uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(n="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",r=!0),o=!0,e=uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:e=uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:o=!t.useSsb,e=uvpjs.DaiRco;break;default:n="VCI createResourceConfig "+("Unknown resource type "+t.type)+"; this.vidContId = "+this.vidContId,r=!0}return r?(this.dispatchStartError(n,null),!1):(this.rcoIdIndex++,s=(i=new e(t,this.rcoIdIndex+"_"+this.vidContId,this.vidContId)).getValidationInfo(),o&&this.checkForAdBlocker()?(!0===s.missingSDK&&(d=a?"IMA":"DAI"),this.dispatchAdBlocked(d,!0),!1):s.error?(n="VCI error initializing RCO: "+s.message,d=uvpjs.ErrorInfo.errorCodes,!0===s.missingSDK?(d=a?d.IMA_SDK_MISSING:d.DAI_SDK_MISSING,this.dispatchStartError(n,d)):this.dispatchStartError(n,null),!1):(this._replayRco=t,i))},prevalidateRcObj:function(t){var e=uvpjs.util,i="",s=!1;return e.isPlainObject(t)?e.isDefinedString(t.type)||(i="Invalid resource type encountered",s=!0):(i="Invalid resource config object format",s=!0),{error:s,message:i}},dispatchStartError:function(t,e){this.debug&&uvpjs.error(this.DEBUG_ID,t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:e||uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+t,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(t,e){t=t?" (Missing "+t+" SDK)":"";this.debug&&uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+t,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+t,isFatal:!!e})},this.vidContId)},checkForAdBlocker:function(){return uvpjs.adUtil.checkForAdBlocker(this.CVI_Mgr.cviModel)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(t){G.isArray(t)&&0<t.length&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:t},this.vidContId)},destroyPlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(t){void 0===t&&(t={}),this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest(t)},replayVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",t),isNaN(t)||this.CVI_Mgr.seekToRequest(t)},seekToLive:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",t),G.isEmpty(this.skinMgr)||G.isEmpty(t)||this.skinMgr.disableButton(t)},enableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",t),G.isEmpty(this.skinMgr)||G.isEmpty(t)||this.skinMgr.enableButton(t)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(t){G.isNaN(t)||this.CVI_Mgr.volumeChangeRequest(t)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",t),G.isString(t)&&this.CVI_Mgr.loadCaptionsRequest(t)},showCaptions:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest(t)},setCaptionLanguage:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionLanguage to "+t),this.CVI_Mgr.setCaptionLanguage(t)},getCaptionInfo:function(){return this.CVI_Mgr.getCaptionInfo()},hideCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},showDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},getAudioTrackInfo:function(){return this.CVI_Mgr.getAudioTrackInfo()},setAudioTrack:function(t){this.CVI_Mgr.setAudioTrack(t)},usesDiagnosticWindow:function(){return!!this.diagnostic},setCaptionsStyle:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",t),this.CVI_Mgr.setCaptionsStyleRequest(t)},setCaptionsStyleProperty:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",t,e),this.CVI_Mgr.setCaptionsStyleRequest([{name:t,value:e}])},getCaptionsStyle:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",t,e),this.CVI_Mgr.setCaptionsCuePropertyRequest(t,e)},setSize:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setSize  width = "+t+"  height = "+e),G.isNumber(t)||G.isNumber(e)||this.CVI_Mgr.resizeRequest(t,e)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",t),!G.isEmpty(t)&&(G.isArray(t)&&0<t.length||uvpjs.util.isDefinedString(t))&&this.CVI_Mgr.setUserGesture(t)},setQosMetadata:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",t),this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",e),G.isEmpty(t)||G.isEmpty(e)||!G.isArray(t)||(this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:t,paramsObj:e},this.vidContId))},fullscreen:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",t),G.isBoolean(t)&&this.CVI_Mgr.fullscreenRequest(t)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(t){t&&G.isPlainObject(t)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:t},this.vidContId))},forceTrackSessionEnd:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FORCE_TRACK_SESSION_END,{},this.vidContId)},removeNativeControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",t),G.isBoolean(t)&&this.CVI_Mgr.setNativeControls(t)},useDynamicSwitching:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",t),G.isBoolean(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:t},this.vidContId)},switchUp:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(t){t&&"number"==typeof t?(this.debug&&uvpjs.log(this.DEBUG_ID,"switch to bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",t)},switchTo:function(t){var e=null!=t&&"string"==typeof t&&-1!=="up,down".indexOf(t),i=null!=t&&"number"==typeof t&&!isNaN(t);e||i?(this.debug&&uvpjs.log(this.DEBUG_ID,"Switch To:",t),i?this.switchBitrateTo(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:t},this.vidContId)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",t,e,i,typeof t)},setMinimumBitrateAllowed:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},setMaximumBitrateAllowed:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:t},this.vidContId)},pauseAdRequest:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:t||null,height:e||null},this.vidContId)},_dispatchResizeEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:t},this.vidContId)},liveSegmentStart:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_START;this.eventsMgr.dispatchEvent(e,{liveSegmentData:t},this.vidContId)},liveSegmentEnd:function(t){var e=this.eventsMgr.eventTypes.LIVE_SEGMENT_END;this.eventsMgr.dispatchEvent(e,{liveSegmentData:t},this.vidContId)}}),Z=uvpjs.register("uvpjs"),j=Math.random(),F=Z._,Z.VideoManager=uvpjs.Class.subClass({init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,uvpjs.VideoManager._instance?console.warn("UVPJS: An instance of VideoManager has already been created."):((uvpjs.VideoManager._instance=this).initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,this.eventsMgr=null,this.configMgr=null,this.autoplayChecked=!1)},destroy:function(){for(var t in this.VCIs)this.destroyVideoPlayer(t);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,this.sdkLoadMgr=null,uvpjs.VideoManager.destroyInstance()},initialize:function(t,e,i){var s=uvpjs.Configuration,n=uvpjs.VideoManager._instance,r=uvpjs.DebugManager,a=this.validateParams(t,e,i),o=a.message,i=a.isValid;if(!o||(console[i?"warn":"error"](o),!i&&a.errorCb&&a.errorCb(o),i)){if(n){if(n.isInitializing())return void n.addInitCallback(e);if(n.isReady())return void(uvpjs.util.isFunction(e)&&e(this.mc.systemInfo))}console.log([s.name,s.version,s.date].join(" ")),uvpjs.log=r.log.bind(r),uvpjs.warn=r.warn.bind(r),uvpjs.error=r.error.bind(r),r.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!t.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(e),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize options = ",t),this.eventsMgr=uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=uvpjs.ConfigManager.getInstance(t,this.onCongfigMgrReady.bind(this))}},validateParams:function(t,e,i){var s=uvpjs.util,n=null,r=!1,a="VideoManager.initialize()",i=s.isFunction(i)?i:null;return t&&F.isPlainObject(t)||(n=a+" was invoked with invalid session options.",r=!0),s.isFunction(e)||(n=a+": A success callback function is required.",r=!0),i||(n=a+" did not receive a valid error callback function.",r=!1),{errorCb:i,message:n,isValid:!r}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(t){var e=this.successCallbacks.length;if(uvpjs.util.isFunction(t)){for(;e--;)if(this.successCallbacks[e]===t)return;this.successCallbacks.push(t)}},onCongfigMgrReady:function(t){F.isObject(t)?(this.CDO=t,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager(),this.sdkLoadMgr=new uvpjs.SdkLoadManager(this.CDO,this.onSdkLoadManagerReady.bind(this))):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS)},onSdkLoadManagerReady:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onSdkLoadManagerReady",t),uvpjs.mediaCapabilities.setTrackingInfo(t),this.autoplayChecked||(this.autoplayChecked=!0,this.checkAutoplay())},checkForForcedHlsjs:function(t){var e=t.isModuleEnabled("VideoPlaybackSettings")&&t.getModuleParam("VideoPlaybackSettings","forceHlsjs"),i="string"==typeof e,t=i&&e.toLowerCase();!e||uvpjs.util.isEmpty(e)||!0!==e&&1!==e&&(!i||"1"!==t&&"y"!==t&&"yes"!==t)||((t=this.mc.canPlayHLSJS(!0))&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=t)},checkAutoplay:function(){uvpjs.mediaCapabilities.determineAutoplayCapabilities(this.onAutoplayCheckComplete.bind(this))},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return!0===this.useNativeAutoplay||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO),uvpjs.debug=uvpjs.DebugManager.isEnabled},addEventListener:function(t,e){if(this.eventsMgr)return t&&F.isString(t)&&F.isFunction(e)?void this.eventsMgr.addEventListener(t,e):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(t){t&&F.isString(t)?this.eventsMgr.removeEventListener(t):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS)},getVideoPlayers:function(){var t,e={};for(t in this.VCIs)e[t]=this.VCIs[t];return e},createVideoPlayer:function(t,e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),F.isString(t)&&F.isFunction(e)&&(!i||F.isPlainObject(i))?(e=[t,e],i&&e.push(i),this.createMultipleVideoPlayers([e])):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS)},destroyVideoPlayer:function(t){return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),F.isString(t)?F.isEmpty(this.VCIs)||!this.VCIs[t]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+t},this.internalNS),!1):(this.VCIs[t].destroy(),delete this.VCIs[t]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayInfo:function(){return this.mc?this.mc.getAutoplayInfo():{supportsMutedAutoplay:null,supportsUnmutedAutoplay:null}},createMultipleVideoPlayers:function(t){var e,i,s,n,r,a,o;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!F.isEmpty(this.VCIs)),F.isArray(t)){for(s=t.length,i=0;i<s;i++)if(r=(n=t[i])[0],a=n[1],o=n[2],n.length<2||!F.isString(r)||!F.isFunction(a)||!F.isUndefined(o)&&!F.isPlainObject(o))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),i=0;i<s;i++)r=(n=t[i])[0],a=n[1],o=n[2]||{},this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",r),o=this.CDO.getSessionOptions(o),e=this.validateAutoplay(o),!1===this._allowConcurrentPlayback&&e&&(this._disableAutoplay&&(o.enableMutedAutoplay=!1,o.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),e=new uvpjs.VideoControlInterface,(this.VCIs[r]=e).initialize(r,this.eventsMgr,this.CDO,a,o);this.debug&&(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS)},validateAutoplay:function(t){var e=t.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),i=!!(t.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||e);return e&&(t.enableMutedAutoplay=!1),i||(t.enableMutedAutoplay=!1,t.enableUnmutedAutoplay=!1),i},overrideSessionOptions:function(t){t&&F.isPlainObject(t)&&this.CDO.overrideSessionOptions(t)},onVideoProgress:function(t){this._allowConcurrentPlayback||!F.isPlainObject(t)||F.isUndefined(t.target)||F.isUndefined(t.payload)||F.isUndefined(t.payload.playbackState)||t.payload.playbackState!==this.mc.PLAYING||(t=t.target,F.isEmpty(this.currActiveVCI)&&!F.isUndefined(this.VCIs[t])&&(this.currActiveVCI=this.VCIs[t]),t===this.currActiveVCI.vidContId||F.isUndefined(this.VCIs[t])||(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",t),this.VCIs[t].pauseVideo({autoPause:!0})))},onVideoPlaybackInitiated:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",t),this._allowConcurrentPlayback||!F.isPlainObject(t)||F.isUndefined(t.target)||(t=t.target,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),F.isEmpty(this.VCIs)||F.isUndefined(this.VCIs[t])||this.currActiveVCI&&this.currActiveVCI.vidContId===t||(this.currActiveVCI=this.VCIs[t],this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI)))},uvpjsError:function(t){t?this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ",t.payload.msg):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(t){t?this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: ",t.payload.msg):this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),Z.VideoManager._instance=null,Z.VideoManager.destroyInstance=function(){this._instance=null},Z.VideoManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.VideoManager(j)),this._instance},Z=uvpjs.register("uvpjs"),w=Z._,Z.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CONFIG_MODULE_NAME:"ClosedCaptions",BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(t){var e=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,t&&(this._cviModel=t.cviModel,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this.useNativeBrowserControls=!!this._cviModel.getSessionOption("useBrowserControls"),this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=D(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=e.getCaptionsLineOffset(),this._lineAlign=e.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=t.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._disabled=!1,this.subtitleLanguage="en",this.subtitleMasterList=null,this.ccDisplayRequested=!1,this.isAndroidOnHlsjs=uvpjs.mediaCapabilities.canPlayHlsjsAndriod(this._cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._removeEventListeners()},_finalizeInit:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=t,this.isAndroidOnHlsjs||this._ccEl||this._createCaptionsElement()},showCaptions:function(t){if(this._deferLoadingCaptions&&!this._hasCaptions())return this._loadCaptionsUrl(this._captionsUrl),void this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this));this.setCaptionLanguage(t),this.ccDisplayRequested=!0,!this._getActiveTrack()&&uvpjs.mediaCapabilities.isIOS()&&this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),this._toggleVisibility(t,"showing")},setCaptionLanguage:function(t){var e=t.payload.language;uvpjs.util.isDefinedString(e)&&((t=this._getActiveTrack())&&t.language===this.subtitleLanguage&&this.subtitleLanguage!==e&&this._clearCaptionTrack(t),this.clearCcElInnerHtml(),this.subtitleLanguage=e)},getCaptionInfo:function(){for(var t=[],e=this.subtitleMasterList||this._getTextTracks(),i=this._getActiveTrack(),s=0;s<e.length;s++){var n=e[s];enabled=i&&i.language===n.language||!1,t.push({language:n.language,label:n.label,kind:n.kind,enabled:enabled})}return 0<e.length&&(this.subtitleMasterList=t),this.subtitleMasterList},hideCaptions:function(t){this.ccDisplayRequested=!1,this._toggleVisibility(t,"hidden")},getStyles:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:w.clone(this.styles)},setStyles:function(t){var e,i,s=this._pageStyles,n=t.length;if(!this._disabled){for(this.debug&&uvpjs.log(this.DEBUG_ID,"setStyles",t);n--;)i=t[n],e=k(i.name),i=i.value,s[e]=i;this._updateStylesObject(s),this._applyStyles(),this._setPosition(s["text-position"]||null)}},setCueProperty:function(t,e){var i;this._disabled||(i=this._getActiveTrack(),t&&e&&i&&this._supportsVTTCue?(this.debug&&uvpjs.log(this.DEBUG_ID,"setCueProperty",i,t,e),this._props[t]=isNaN(e)?e:Number(e)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",t,e))},_addEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace;this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners"),t.addEventListener(e.CONTAINER_RESIZE+i,this._onContainerResize.bind(this)),t.addEventListener(e.CONTROL_LOAD_CAPTIONS+i,this._onControlLoadCaptions.bind(this)),t.addEventListener(e.CONTENT_DATA_LOADED+i,this._onContentDataLoaded.bind(this)),t.addEventListener(e.CONTROL_SHOW_CAPTIONS+i,this.showCaptions.bind(this)),t.addEventListener(e.CONTROL_HIDE_CAPTIONS+i,this.hideCaptions.bind(this)),t.addEventListener(e.SET_CAPTIONS_LANG+i,this.setCaptionLanguage.bind(this)),t.addEventListener(e.CONTENT_FACADE_CREATED+i,this._onContentFacadeCreated.bind(this)),t.addEventListener(e.RESOURCE_END+i,this._onVideoComplete.bind(this)),t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this)),t.addEventListener(e.AD_START+i,this._onAdStart.bind(this))},_removeEventListeners:function(){var t=this._eventsMgr,e=t.eventTypes,i=this._namespace;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),t.removeEventListener(e.CONTAINER_RESIZE+i),t.removeEventListener(e.CONTROL_LOAD_CAPTIONS+i),t.removeEventListener(e.CONTENT_DATA_LOADED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.SET_CAPTIONS_LANG+i),t.removeEventListener(e.CONTENT_FACADE_CREATED+i),t.removeEventListener(e.RESOURCE_END+i),t.removeEventListener(e.VIDEO_PROGRESS+i),t.removeEventListener(e.AD_START+i)},_createTrackElement:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement",t);var e=document.createElement("track");e.default=!0,e.kind="captions",e.label="English",e.srclang="en",e.id=this._trackId,e.src=t,this._videoEl.appendChild(e)},_createCaptionsElement:function(){var t=uvpjs.util,e=this._styleEl,i=document.createElement("div"),s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);i.id=this._captionsId,this.debug&&uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),s?(s.appendChild(i),this._ccEl=i,t.addCSSObject(e,i,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),t.addCSSObject(e,i,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),t.addCSSObject(e,i,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container.")},_dispatchCaptionsError:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",t),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:t},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this.adjustVttCuesLinePosition(),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(t){t.target===this._containerId&&this._setRect()},_onAdStart:function(t){this.clearCcElInnerHtml()},clearCcElInnerHtml:function(){this._ccEl&&(this._ccEl.innerHTML="")},_onVideoComplete:function(t){var e=t.target,t=this._videoEl;e===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoComplete",e),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,t&&t.removeEventListener("loadeddata",this._onLoadedData),t&&t.removeEventListener("timeupdate",this._onTimeUpdate),(t=this._getTextTracks())&&(t.onaddtrack=null),(t=this._getActiveTrack())instanceof window.TextTrack&&R(t)&&(t.mode="disabled",t.oncuechange=null),this._trackCount++)},_onContentDataLoaded:function(t){var e=uvpjs.util,i=t.target,s=t.payload.vidState,t=s.closedCaptionPath;s.isLive,i===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",i),this._videoEl=document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,(i=this._getTextTracks())&&(i.onaddtrack=this._onAddTrack),this._styleSelector=this._getStyleSelector(),e.isDefinedString(t)&&(this._captionsUrl=t))},_onLoadedData:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadedData",t),this._checkForLiveCaptions()},_onTimeUpdate:function(t){!this.hasDispatchedCaptionsReady&&this._getActiveTrack()&&this._dispatchCaptionsReady(),this._setActiveCueProps(t)},_onControlLoadCaptions:function(t){var e;t.target===this._containerId&&(e=t.payload.url,w.isString(e)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",t.target),this._loadCaptionsUrl(e)))},_onContentFacadeCreated:function(t){t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",t.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(t){var e=t.responseText;this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",t);try{var e=(e=e.replace(/\n/g,"")).substr(e.indexOf("<?xml")),i=(new DOMParser).parseFromString(e,"text/xml");this._xmlToCues(i)}catch(t){i="Error parsing closed captions XML.";this._dispatchCaptionsError(i),this.debug&&uvpjs.error(this.DEBUG_ID,i,t)}},_onLoadError:function(t){var t=t.status,e="Unknown error";switch(t){case 404:e="File not found";break;case 500:e="Server error";break;case 0:e="Request aborted"}this._dispatchCaptionsError(e+=" "+t),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError",e)},_onAddTrack:function(t){var e=t.track;e.id=this._trackId,this.useNativeBrowserControls||this._syncCCTrackMode(e,!1),R(e)&&(this._finalizeTrackElement(),this._finalizeLiveCaptions()),this.debug&&uvpjs.log(this.DEBUG_ID,"_onAddTrack",t)},_syncCCTrackMode:function(t,e){if(t)return e?void(t.mode="disabled"):void(this.useNativeBrowserControls||uvpjs.mediaCapabilities.isIOS()?this._cviModel.isFullscreen&&(t.mode="showing"):"hidden"!==t.mode&&(t.mode="hidden"))},_onVideoProgress:function(t){var e;if(t.target===this._containerId){var i=this._getActiveTrack();if(this.isAndroidOnHlsjs||this._syncCCTrackMode(i,!1),this._hasCaptions())if(this._liveCaptionsInitalized)if(i&&i.activeCues&&(e=i.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);e--;)1<t.payload.currentTime-i.activeCues[e].endTime&&this.showCcContainer(!1);else this.showCcContainer(!1);else this._checkForLiveCaptions();else this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1)}},_finalizeLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!t||!this._liveCaptionsInitalized){try{t||this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(t){this.debug&&uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",t),this._dispatchCaptionsError(t)}t&&(this._liveCaptionsInitalized=!0),this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){var t=this._getActiveTrack(),e=this._onTimeUpdate;this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),t&&(t.oncuechange=e)||this._videoEl.addEventListener("timeupdate",e)},_finalizeStyles:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var t=w.get(this._captionsJson,"tt.head.styling.style");t=w.isArray(t)?t[0]:t,this.debug&&uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",t),t?this._inlineStyles={backgroundColor:t["tts:backgroundColor"],color:t["tts:color"],fontFamily:t["tts:fontFamily"],fontSize:t["tts:fontSize"],fontStyle:t["tts:fontStyle"],fontWeight:t["tts:fontWeight"],textAlign:t["tts:textAlign"],textDecoration:t["tts:textDecoration"]}:this.debug&&uvpjs.log(this.DEBUG_ID,"No styling found in XML file.")},_applyStyles:function(){var t,e,i,s=uvpjs.util,n=this.styles,r=this._styleSelector,a=[];for(e in this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles styles",n),n){switch(i=n[e],t=!1,e){case"background-opacity":case"font-opacity":t=!0;break;case"text-position":t=!0,this._setPosition(i);break;case"background-color":i=S(i,n["background-opacity"]);break;case"color":case"font-color":e="color",i=S(i,n["font-opacity"]);break;case"text-edge-style":e="text-shadow",i=U(i)}t||(P(e,i)?a.push({name:e,value:i}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",e,i))}this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",r,a),s.addCSSRules(this._styleEl,r,a)},_updateStylesObject:function(t){var e,i,s;for(e in t){if(!(i=t[e])||!e)return;(s=k(e))in this.styles?("font-size"===s&&(i=T(i)),this.styles[s]=i):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",s)}},_hasCaptions:function(){return R(this._getActiveTrack())},_loadOrDeferCaptions:function(t){this._deferLoadingCaptions?this._dispatchCaptionsReady():this._loadCaptionsUrl(t)},_loadCaptionsUrl:function(t){var e=uvpjs.util.isDefinedString(t),i=e&&-1!==t.indexOf(".vtt");e&&!this._cviModel.contentVideoState.isFlash&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=document.getElementById(this._videoId),i?this._createTrackElement(t):(new uvpjs.CodeLoader).loadXHR(t,this._onLoadComplete.bind(this),this._onLoadError.bind(this)))},_checkForLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),this._hasCaptions()?(this._finalizeTrackElement(),this._finalizeLiveCaptions()):this.debug&&uvpjs.log(this.DEBUG_ID,"No captions track to finalize.")},_clearAllCaptionTracks:function(){var t=this._getTextTracks(),e=t&&t.length||0;for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",t);e--;)this._clearCaptionTrack(t[e]);this.clearCcElInnerHtml()},_clearCaptionTrack:function(t){var e,i;if(R(t)){for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",t),i=(e=t&&t.cues)&&e.length||0;i--;)t.removeCue(e[i]);this._syncCCTrackMode(t,!0),t.cues=null}},_toggleVisibility:function(t,e){t.target===this._containerId&&this._hasCaptions()&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_toggleVisibility",e),this.showCcContainer("hidden"!==e))},showCcContainer:function(t){this.isAndroidOnHlsjs?this._getActiveTrack().mode=t?"showing":"hidden":this._ccEl&&(t?this._ccEl.style.display="block":(this._ccEl.style.display="none",this._ccEl.innerHTML=""))},_getTextTracks:function(){return this._videoEl&&this._videoEl.textTracks},_getActiveTrack:function(){for(var t,e,i=this._getTextTracks(),s=i&&i.length||0,n=0;n<s;n++)if((e=(t=i[n])&&t.cues)&&e.length&&R(t))return t},enableCaptionsTracks:function(){for(var t,e=this._getTextTracks(),i=e&&e.length||0;i--;)t=e[i],R(t)&&(t.mode="hidden")},_getTrackById:function(t){var e=this._getTextTracks();return e&&e.getTrackById(t||this._trackId)},_getActiveCues:function(){var t=this._getActiveTrack();return t&&t.activeCues},_getAllCues:function(){var t=this._getActiveTrack();return t&&t.cues},_getStyleSelector:function(){return"#"+this._captionsId+" ."+this.CAPTIONS_TEXT_CLASSNAME},_setCDOParams:function(){var e,i,t=this._cviModel.getModule(this.CONFIG_MODULE_NAME),s={};return this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams module",t),t?!0!==t.enabled?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled.")):w.isEmpty(t.params)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty.")):(w.each(t.params,function(t){e=t.name,i=t.value,e&&i&&(k(e),s[e]=i)}),this.debug&&uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(s,null,2)),void(this._configStyles=s)):void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found."))},_setPosition:function(t){t=-1<["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"].indexOf(t)?t:"bottom-center-floated";this._setPositionCSS(t)},_setPositionCSS:function(t){var e,i=uvpjs.util,s=this._styleEl,n=this._ccEl,r=n&&n.style.marginBottom,a=parseInt(this.BASE_CONTROLS_HEIGHT);s&&n&&(t=(e=t.split("-"))[0],e=e[1],r="inherit"===r?0:parseInt(r),r=isNaN(r)?a+"px":(a<r?10:a-r)+"px",e={top:{top:"10px",middle:"50%",bottom:"auto"}[t],bottom:{top:"auto",middle:"auto",bottom:r}[t],"text-align":e,transform:"initial"},"middle"===t&&(e.transform="translateY(-50%)"),i.addCSSObject(s,n,e,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var t=this.styles;t&&this._setPosition(t["text-position"])},_setRect:function(){function t(){w.assign(h.style,r),c&&(w.assign(c.style,r),this._checkBottomPosition())}var e,i,s,n,r,a,o,d,l,u,h=this._videoEl,c=this._ccEl,p=h&&h.parentNode;h&&p&&(l=h.videoHeight,(u=h.videoWidth)&&l&&(i=h.getBoundingClientRect(),e=p.getBoundingClientRect(),s=i.height,n=i.width,d=e.height-i.height,o=e.width-i.width,u=(l=s/n/(l/u))<1||0!==o&&0===d,(r=(l=1<l||0===o&&0!==d)?{height:"auto","max-height":"100%",width:"100%",margin:0}:u?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0})&&t.call(this),i=h.getBoundingClientRect(),d=(e=p.getBoundingClientRect()).height-i.height,o=e.width-i.width,l?r={margin:"inherit","margin-top":a=d/2+"px","margin-bottom":a}:u&&(r={margin:"inherit","margin-left":a=o/2+"px","margin-right":a}),c&&(r["font-size"]=this._calculateFontSize(i.width)),r&&t.call(this)))},_calculateFontSize:function(t){var e;try{e=t/parseInt(this.BASE_VIDEO_WIDTH)*parseInt(this.BASE_FONT_SIZE),e=Math.max(e,parseInt(this.MIN_FONT_SIZE))}catch(t){console.error(t)}return e&&e+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(t){t=t&&t.target,t=t&&t.activeCues||this._getActiveCues();this._setCueProps(t)},adjustVttCuesLinePosition:function(){if(this.isAndroidOnHlsjs){var t=this._getAllCues();if(t&&0<t.length){this._syncCCTrackMode(this._getActiveTrack(),!1);for(var e=0;e<t.length;e++){var i=t[e];!i||"auto"!==i.line&&-1!==i.line&&-2!==i.line||(i.line=-3)}}}},_setCueProps:function(t){this._addCuesToCaptionsElement(t)},_xmlToCues:function(t){var e,i,s,n,r,a,o,d,l,u,t=B(t);if(this._captionsJson=t,this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",t),!w.isEmpty(t)&&w.isPlainObject(t))if(i=w.get(t,"tt.body.div.p"),this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",i),w.isUndefined(i)||w.isEmpty(i))this.debug&&uvpjs.warn(this.DEBUG_ID,"No cues found in XML file.");else if(e=this._supportsVTTCue?window.VTTCue:window.TextTrackCue){for((n=this._videoEl.addTextTrack("captions","English","en")).id=this._trackId,l=i.length,o=0;o<l;o++)if(a=i[o],s=i[d=o+1],r=a.text,!w.isEmpty(r)){for(r=(r=(r=r.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3")).replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3")).replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),u=I(r),a._lineCountPrev=a._lineCountPrev||0,a._lineCountNext=a._lineCountNext||0;(s&&s.begin)===a.begin;)s._lineCountPrev=u+a._lineCountNext,a._lineCountNext+=I(s.text),s=i[++d];(r=new e(C(a.begin),C(a.end),r))._lineCount=u,r._lineCountPrev=a._lineCountPrev,r._lineCountNext=a._lineCountNext,r._metadata=a.metadata,r=O.call(this,r),n.addCue(r)}this._finalizeCaptions()}else this.debug&&uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions.")},_addCuesToCaptionsElement:function(t){var e,i,s=uvpjs.util,n=this._ccEl,r='<div class="{{cntrClass}}">{{spans}}</div>',a="",o=t&&t.length;if(o){for(e=0;e<o;e++)i=t[e].text,s.isDefinedString(i)&&(a+='<span class="{{txtClass}}">'+(i=i.replace(/(\r\n|\n|\r)/g,"<br/>"))+"</span>",e+1!==o&&(a+="<br/>"));r=(r=(r=r.replace("{{spans}}",a)).replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME)).replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),n&&(n.innerHTML=r)}}}),S=function(t,e){var i=L(t)||b(t)||b(M(t));return i&&e?N(i.r,i.g,i.b,e):t},D=function(){return{"background-opacity":"1","background-color":"#000000","font-color":"#FFFFFF","font-family":"Arial, sans-serif","font-opacity":"1","font-size":"100%","font-weight":"normal","line-height":"1","text-position":"default","text-decoration":"none","text-edge-style":"none"}},T=function(t){var e="100%";return-1<t.indexOf("px")?(e=t.replace("px",""),e=100*(e/=18)+"%"):-1<t.indexOf("%")&&(e=t),e},I=function(t){return t&&(t.match(/\n/g)||[]).length+1},C=function(t){var e;if(!w.isNull(t)&&!w.isUndefined(t))return e=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},t=t.split(":"),e(60*Number(t[0])*60+60*Number(t[1])+Number(t[2]),2)},b=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,s){return e+e+i+i+s+s});t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},R=function(t){return t instanceof window.TextTrack&&("captions"===t.kind||"subtitles"===t.kind)},P=function(t,e){if(t&&e)return w.get(window,"CSS.supports")?window.CSS.supports(t,e):"string"==typeof document.createElement("div").style[t]},O=function(t){var e,i=t._metadata;if(i){t.snapToLines=!0,e=Math.round(i.cccol/35*100),t.position=e;try{t.align=e<45?"start":55<e?"end":this._lineAlign}catch(e){t.align="center"}t.positionAlign=e<45?"line-left":55<e?"line-right":"center",t.line=i.ccrow-17+this._lineOffset,t._defaults={line:t.line,position:t.position,align:t.align,positionAlign:t.positionAlign}}return t},M=function(t){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[t.toLowerCase()]},L=function(t){if(-1!==t.indexOf("rgba"))return{r:(t=t.substr(5,t.length).split(","))[0],g:t[1],b:t[2]}},k=function(t){if(w.isString(t)&&!w.isEmpty(t))return t.replace(/([A-Z])/g,"-$1").toLowerCase()},N=function(t,e,i,s){return"rgba("+[t,e,i,s].join(",")+")"},U=function(t){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[t]||"none"},B=function(t){var i={};if(1===t.nodeType&&0<t.attributes.length)for(var e=0,s=t.attributes.length;e<s;e++){var n=t.attributes.item(e);i[n.nodeName]=n.nodeValue}else 3===t.nodeType&&(i=t.nodeValue);if("p"===t.nodeName&&(i.text="",w.each(t.childNodes,function(t){var e;"metadata"!==t.nodeName&&(e=(new XMLSerializer).serializeToString(t),1===t.nodeType&&(i.text+="br"===t.tagName?"\n":e),3===t.nodeType&&(i.text+=e))})),t.hasChildNodes())for(var r=0,a=t.childNodes.length;r<a;r++){var o,d=t.childNodes.item(r),l=d.nodeName;void 0!==i[l]?(void 0===i[l].push&&(o=i[l],i[l]=[],i[l].push(o)),i[l].push(B(d))):i[l]=B(d)}return i},function(t){"use strict";var n=t._;t.ConfigDataObject=uvpjs.Class.subClass({debug:!0,adCallParams:{standardParams:null,customParams:null},sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,useBrowserControls:!1,enableDiagnosticWindow:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",controls:null,template:null,allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown",minBitrate:-1,maxBitrate:-1,startBitrate:-1,liveSyncDurationCount:-1,errorRecovery:null},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=document.referrer),this.initialize(t)},initialize:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",t),this.overrideSessionOptions(t)},destroy:function(){this.modules=null,this.classes=null},getAdCallParams:function(){return this.adCallParams},setAdCallParams:function(t){if(!uvpjs.util.isEmpty(t.standardParams)&&null===this.adCallParams.standardParams)for(var e in this.adCallParams.standardParams={},t.standardParams)this.adCallParams.standardParams[e]=t.standardParams[e];if(!uvpjs.util.isEmpty(t.customParams)&&null===this.adCallParams.customParams)for(e in this.adCallParams.customParams={},t.customParams)this.adCallParams.customParams[e]=t.customParams[e]},overrideSessionOptions:function(t){t=this.getSessionOptions(t);t&&n.isPlainObject(t)?this.sessionOptions=t:this.debug&&uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type.")},getSessionOption:function(t){return this.sessionOptions[t]||null},getSessionOptions:function(t){var e,i,s=n.clone(this.sessionOptions);if(!t||!n.isPlainObject(t))return s;if((e=t.skinConfig)&&!n.isEmpty(e))for(i in uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object."),e)s.hasOwnProperty(i)&&(s[i]=e[i]);for(i in s)t.hasOwnProperty(i)&&(s[i]=t[i]);return s},getModule:function(t){return s(this.modules,t)},getModules:function(){return this.modules},getModuleParam:function(t,e){t=s(this.modules,t),e=s(t.params,e);if(e&&e.hasOwnProperty("value"))return e.value},setModule:function(t){e(this.modules,t,"name",this.DEBUG_ID)},isModuleEnabled:function(t){var e=this.getModule(t);return e?(this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+t+":",e.enabled),e.enabled):(this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled module not found: "+t),!1)},isModuleSet:function(t){return!!this.getModule(t)},getClass:function(t){return s(this.classes,t)},getClasses:function(){return this.classes},getClassProperty:function(t,e){t=s(this.classes,t),t=a.call(this,t,"properties",this.DEBUG_ID),e=s(t,e);return a.call(this,e,"value",this.DEBUG_ID)},getClassListItems:function(t){t=s(this.classes,t);return a.call(this,t,"list",this.DEBUG_ID)},getClassListItemProperty:function(t,e,i){t=this.getClassListItems(t),e=r(t,e),e=a.call(this,e,"properties",this.DEBUG_ID),i=s(e,i);return a.call(this,i,"value",this.DEBUG_ID)},setClass:function(t){e(this.classes,t,"name",this.DEBUG_ID)},isCAN:function(){return n.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()},copyModules:function(t){for(var e=t.length;e--;)for(var i=t[e],s=this.modules.length;s--;)if(this.modules[s].name===i.name){this.modules[s]=i;break}}});function i(t,e,i){for(var s in t)if(t[s][e]==i)return t[s];return!1}var s=function(t,e){return i(t,"name",e)},r=function(t,e){return i(t,"id",e)},a=function(t,e,i){return t?t.hasOwnProperty(e)?t[e]:(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty no item property:",t,e),!1):(this.debug&&uvpjs.warn(i,"ConfigDataObject findItemProperty item not found:",t),!1)},e=function(t,e,i,s){for(var n in t)if(t[n][i]==e[i])return this.debug&&uvpjs.log(s,"ConfigDataObject _addItemToArray updating existing item",e),void(t[n]=e);this.debug&&uvpjs.log(s,"ConfigDataObject _addItemToArray creating item",e),t.push(e)}}(uvpjs.register("uvpjs")),function(t){var i=t._,s=Math.random();t.ConfigManager=uvpjs.Class.subClass({init:function(t,e,i){this.debug=uvpjs.debug,t&&t===s?(this.initCallback=i,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init sessionOptions =",e),this.CDO=new uvpjs.ConfigDataObject(e),this.debug&&uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.debug&&uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance().")},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(this.configSources.length){var t=this.configSources.shift();if(null!=t)switch(t.constructor){case String:if(""===t)break;return void(new uvpjs.CodeLoader).loadXHR(t,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=t.concat(this.configSources);break;case Object:this.updateCDO(t)}this.loadConfig()}else i.isFunction(this.initCallback)&&this.initCallback(this.CDO)},onLoadComplete:function(t){var e,i=t.responseText,t=t.getResponseHeader("Content-Type");-1<t.indexOf("application/json")?e=JSON.parse(i):-1<t.indexOf("text/xml")||-1<t.indexOf("application/xml")?(i=(new DOMParser).parseFromString(i,"text/xml"),e=this.xmlToCDO(i)):this.debug&&uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",t),e&&this.updateCDO(e),this.loadConfig()},onLoadError:function(t){var e="unknown error";0===t.status&&(e="request timeout"),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError error =",e,t),this.loadConfig()},updateCDO:function(e){i.isEmpty(e)?this.debug&&uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty"):["classes","modules"].map(function(t){e.hasOwnProperty(t)&&(this.CDO[t]=n(this.CDO[t],e[t]))},this)},xmlToCDO:function(t){function l(t){return"y"===t}var e={},u=h(t);return u.hasOwnProperty("player-config")&&(u=u["player-config"]),e.modules=function(){var t,e,i=[];if(u.modules){for(var s in t=c(u.modules.module)){var n=t[s],r={name:n.name,category:n.category,enabled:l(n.enabled),params:[]};if(t[s].hasOwnProperty("params")){var a,o=c(n.params.param);for(a in o){var d=o[a];d.name&&("y"!==(e=d.value)&&"n"!==e||(d.value=l(d.value)),r.params.push(d))}}n.category,i.push(r)}return i}}(),e.classes=function(){var t,e=c(u.classes),i=[];for(t in e){var s=e[t];if((s=s.hasOwnProperty("classDef")?s.classDef:s).name){var n={name:s.name,className:s.className,properties:[],list:[]};if(s.hasOwnProperty("list")){var r,a=c(s.list.listitem);for(r in a){var o=a[r];o.id&&(o.hasOwnProperty("properties")&&(o.properties=o.properties.property),n.list.push(o))}}s.hasOwnProperty("properties")&&(n.properties=s.properties.property),i.push(n)}}return i}(),e},getCDO:function(){return this.CDO}}),t.ConfigManager._instance=null,t.ConfigManager.destroyInstance=function(){this._instance=null},t.ConfigManager.getInstance=function(t,e){return this._instance||(this._instance=new uvpjs.ConfigManager(s,t,e)),this._instance};var n=function(t,e){for(var i in e){var s,n=!1;for(s in t)if(t[s].name===e[i].name){n=!0;break}n||t.push(e[i])}return t},h=function(t){var e={};if(1===t.nodeType&&0<t.attributes.length)for(var i=t.attributes.length,s=0;s<i;s++){var n=t.attributes.item(s);e[n.nodeName]=n.nodeValue}if(t.hasChildNodes()){i=t.childNodes.length;for(var r=0;r<i;r++){var a,o=t.childNodes.item(r),d=o.nodeName;3!==o.nodeType&&(void 0!==e[d]?(void 0===e[d].push&&(a=e[d],e[d]=[],e[d].push(a)),e[d].push(h(o))):e[d]=h(o))}}return e},c=function(t){if(void 0!==t&&t.constructor!==String)return t=t.constructor===Object?[t]:t}}(uvpjs.register("uvpjs")),function(t){"use strict";var s=null,n=null,a=t._;t.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold",STARTING_BITRATE_ABOVE_MAX_ALLOWED:"Unable to set start bitrate above maximun bitrate allowed threshold, lowering to max threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},errorRecovery:{networkRetryAttempts:10,mediaRetryAttempts:3,MSG_NETWORK_ERROR:"fatal network error encountered - ",MSG_MEDIA_ERROR:"fatal media error encountered - ",MSG_TRYING_TO_RECOVER_PREFIX:"trying to recover",MSG_MAX_ATTEMPS_REACHED_PREFIX:"recovery attempts exceeded maximum : "},responseHeaders:{MULTI_CDN:"x-cdn"},CDN_GEO_BLOCKED_HTTP_STATUS_CODE:{AKAMAI:464},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.multiCDNEnabled=!0,this.hasPlaybackStarted=!1,this.isMobile=!1},initialize:function(t){var e=t.resourceProvider,i=e.vidContId;this.resourceProvider=e,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=i,this.assetURL=t.assetURL,this.vidContentId=this.PREFIX_CONTENT+i,this.internalNS="."+i+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+i),this.deferLoadingCaptions=t.deferLoadingCaptions,this._updateVolumeSettings(t),e.createWatermark()&&!t.suppressWatermark&&(s=new uvpjs.Watermark({containerId:i,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),e.is360()&&!t.suppress360&&(n=new uvpjs.Kaleidoscope360({containerId:i,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),!0!==t.suppressCreatedEvent&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){a.isEmpty(this.resourceProvider)?this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed."):(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),s&&(s.destroy(),s=null),n&&(n.destroy(),n=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,this.hasPlaybackStarted=!1)},_updateVolumeSettings:function(t){var e=(t=t||{}).volume,i=!0===t.isMuted,s=this.videoTagRef;this.debug&&uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",t),uvpjs.util.inRange(e,0,1)&&s.volume!==e&&(s.volume=e),"isMuted"in t&&s.muted!==i&&this.muteVideo(i)},_addHTML5Events:function(){var t,e=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(t in this.debug&&uvpjs.log(this.DEBUG_ID,"_addHTML5Events"),e)"CLICK"!==t&&"TOUCH_END"!==t&&this.videoTagRef.addEventListener(e[t],this,!1);this.videoTagRef.addEventListener(e[i],this,!1)},_removeHTML5Events:function(){var t,e=this.eventTypes.HTML5,i=this.supportsTouchEvents?"TOUCH_END":"CLICK";for(t in this.debug&&uvpjs.log(this.DEBUG_ID,"_removeHTML5Events"),e)"CLICK"!==t&&"TOUCH_END"!==t&&this.videoTagRef.removeEventListener(e[t],this,!1);this.videoTagRef.removeEventListener(e[i],this,!1)},handleEvent:function(t){var e=this.eventTypes.HTML5;if(this.videoTagRef)switch(t.type){case e.ABORT:break;case e.CAN_PLAY:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(e.CAN_PLAY,this,!1);break;case e.CAN_PLAY_THROUGH:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(e.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.CLICK:case e.DURATION_CHANGE:break;case e.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case e.ENDED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case e.ERROR:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(t.target.error);break;case e.LOAD_START:if(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),a.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"));if(uvpjs.mediaCapabilities.isIOS())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!"));break;case e.LOADED_METADATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case e.LOADED_DATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case e.PAUSE:this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case e.PLAY:break;case e.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case e.PROGRESS:this.videoLoading();break;case e.RATE_CHANGE:break;case e.SEEKING:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",t);break;case e.SEEKED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",t),this.seeked(t.target.currentTime);break;case e.STALLED:case e.SUSPEND:break;case e.TIME_UPDATE:this.timeUpdated();break;case e.VOL_CHANGE:this.volumeChanged();break;case e.WAITING:}},seeked:function(t){var e=this.videoTagRef.paused,i=uvpjs.mediaCapabilities;this.playbackStateChange(e?i.PAUSED:i.PLAYING),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:t,paused:e,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:t})},videoLoading:function(){var t;try{t=this.videoTagRef.buffered.end(0)||0}catch(e){t=0}var e={bufferLength:t,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(e)},volumeChanged:function(){var t=this.videoTagRef.volume;!a.isNumber(t)||t<0?t=0:1<t&&(t=1),this.resourceProvider.facadeVolumeChange(t)},timeUpdated:function(){var t=this.videoTagRef.currentTime;"number"==typeof t&&this.resourceProvider.facadeTimeUpdate(t)},error:function(t){var e=uvpjs.ErrorInfo.messages,i=uvpjs.ErrorInfo.errorCodes,s=e.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,n=i.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,r=!0;if(t)switch(t.code){case t.MEDIA_ERR_ABORTED:r=!1,s=e.MEDIA_ERR_ABORTED,n=i.MEDIA_ERR_ABORTED;break;case t.MEDIA_ERR_NETWORK:s=e.MEDIA_ERR_NETWORK,n=i.MEDIA_ERR_NETWORK;break;case t.MEDIA_ERR_DECODE:s=e.MEDIA_ERR_DECODE,n=i.MEDIA_ERR_DECODE;break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:s=e.MEDIA_ERR_SRC_NOT_SUPPORTED,n=i.MEDIA_ERR_SRC_NOT_SUPPORTED}this.debug&&uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+s),a.isEmpty(this.resourceProvider)?this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return."):this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:n,message:s,isFatal:r}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="visible")},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var t;this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo"),void 0!==(t=this.videoTagRef.play())&&t.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this)))},handlePlayPromiseRejection:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+t.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(t.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"seekTo",t),isNaN(t)||this.videoTagRef&&0<=t&&t<this.videoTagRef.duration&&(this.videoTagRef.currentTime=t)},seekToLive:function(){var t;this.isHDStreamLive()||this.debug&&uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef&&(t=this.videoTagRef.seekable&&0<this.videoTagRef.seekable.length&&this.videoTagRef.seekable.end(0),!isNaN(t)&&t>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=t))},toggleMute:function(){var t;this.videoTagRef&&(t=!this.videoTagRef.muted,this.muteVideo(t))},setFullscreenState:function(t){},loadVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(t){t=!1!==t;this.videoTagRef&&((this.videoTagRef.muted=t)&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),t||this.videoTagRef.removeAttribute("muted"))},unMuteVideo:function(){this.muteVideo(!1)},getVolume:function(){return this.videoTagRef&&this.videoTagRef.volume||0},setVolume:function(t){this.videoTagRef&&0<=t&&t<=1&&(this.videoTagRef.volume=t)},getDuration:function(){var t=0;return t=this.videoTagRef&&(t=this.videoTagRef.duration)===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&0<this.videoTagRef.seekable.length?this.videoTagRef.seekable.end(0):t},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(t){this.isAbrStreamingSupported()&&"boolean"==typeof t||!this.debug||uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},setMaxBitrateAllowed:function(t){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(t,e,i){if(0<t.length){var s=t.length,n=t[0].hasOwnProperty("bitrate")?"bitrate":"bandwidth";if(e>=t[s-1][n])return s-1;for(;s--;)if(e>=t[s][n])return i?s+1:s}return 0},addSessionIdAndTicketToURL:function(t,e,i){if(!t)return t;function s(t){return-1!==t.indexOf("?")?"&":"?"}return e&&-1===t.indexOf("SessionId=")&&(t+=s(t)+"SessionId="+e),i&&-1===t.indexOf("Ticket=")&&(t+=s(t)+"Ticket="+i),t},processResponseHeader:function(t,e){e===this.responseHeaders.MULTI_CDN&&this.resourceProvider.getContentVideoStateCdn()!==t&&this.resourceProvider.setContentVideoStateCdn(t)},getCdnNameAtStartup:function(t){return""},videoDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},removeEvents:function(){},setSize:function(t,e){},getBuffered:function(){var t=this.videoTagRef,e=t&&t.buffered,i=0,t=0;return e&&0<e.length&&(i=e.start&&e.start(0),t=e.end&&e.end(0)),0<(i=t-i)&&i||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkState:function(){if(this.videoTagRef)return this.videoTagRef.networkState},manageNativeControls:function(t){var e;this.videoTagRef&&(e=this.videoTagRef.hasAttribute(this.CONTROLS),t&&!e?this.videoTagRef.setAttribute("controls",this.CONTROLS):!t&&e&&this.videoTagRef.removeAttribute(this.CONTROLS))},playbackStateChange:function(t){t!==this.playbackState&&(this.playbackState=t,this.debug&&uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+t),a.isEmpty(this.resourceProvider)?this.debug&&uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"):this.resourceProvider.facadePlaybackStateChange(t))},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var t=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!a.isUndefined(t),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,t=this.resourceProvider.getAssetURL()),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",t),t},normalizeAudioTrackInfo:function(t,e){if(t){for(var i=[],s=0;s<t.length;s++){var n=t[s];this.checkCodecForWeb(n)&&i.push({index:s,id:n.id,type:n.type||n.kind,codec:n.codec||"n/a",label:e===uvpjs.mediaCapabilities.DASHJS?n.lang:n.label||n.name})}return i}},checkCodecForWeb:function(t){return!t.codec||-1!==t.codec.indexOf("mp4a")}})}(uvpjs.register("uvpjs")),function(t){"use strict";var s="www.nielsen.com";t.VPF_Flash=uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(t){for(var e in t)this.initOptions[e]=t[e];t.suppress360=!0,t.suppressCreatedEvent=!0,this._super(t),this.swfService=t.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.dispatchCreated()},destroy:function(){for(var t in this.windowLabels)window[this.windowLabels[t]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVideo:function(){this.isPaused=!0,this.player.pauseVideo()},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(t){this.player&&this.player.setVolume(t)},seekTo:function(t){this.player&&this.player.seekTo(t)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVideo:function(){this.player&&(this.player.style.visibility="visible",this.player.unMute())},setFullscreenState:function(t){this.swfService.resetSize()},loadCaptions:function(t){this.captionsUrl=uvpjs.util.isEmpty(t)?null:t,this.captionsUrl&&(this.deferLoadingCaptions||(this.hasCaptions=!0,this.player.loadCaptions(t)))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl&&(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0),this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(t){for(var e,i,s,n=Array.isArray(t)&&t.length||0,r=uvpjs.util,a=uvpjs.VPF_Flash.styleTransform;n--;)e=t[n],s=a[i=this.dashToCamel(e.name)]?a[i](e.value):e.value,r.isEmpty(e.value)||this.player.setStyleAttribute(i,s)},setId3Options:function(t){this.id3Options=t},getAbrInfo:function(){return this.bitrateInfo.abrInfo||null},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLive:function(){return this.currFlashVideoState.isPlayingLive||!1},getDroppedFramesCount:function(){return-1},getCurrentBandwidth:function(){return-1},getFacadeState:function(){return{currentBitrate:this.currFlashVideoState.sourceBitrate,abrInfo:this.bitrateInfo.abrInfo}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(t){this.player.enableDynamicStreaming(!1===t?"false":"true")},switchToBitrate:function(t){t=this.findClosestBitrate(t);-1!==t.index&&this.player.switchStreamingIndex(t.index)},setMinBitrateAllowed:function(t){t=this.findClosestBitrate(t);-1!==t.index&&(this.bitrateInfo.min=t.bitrate,this.player.setMinimumStreamingIndex(t.index))},setMaxBitrateAllowed:function(t){t=this.findClosestBitrate(t);-1!==t.index&&(this.bitrateInfo.max=t.bitrate,this.player.setMaximumStreamingIndex(t.index))},switchUp:function(){var t=this.currFlashVideoState.playbackBitrate,e=this.findClosestBitrate(t),t=-1!==e.index&&this.bitrateInfo.bitrates.length;-1!==e.index&&e.index<t-1&&this.player.switchStreamingIndex(e.index+1)},switchDown:function(){var t=this.currFlashVideoState.playbackBitrate,t=this.findClosestBitrate(t);-1!==t.index&&0<t.index&&this.player.switchStreamingIndex(t.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var t=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return t?this.bitrateInfo.bitrates[t-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitrate:function(){return this.currFlashVideoState.sourceBitrate||-1},findClosestBitrate:function(t){for(var e,i=this.bitrateInfo.bitrates,s=i?i.length:0,n={bitrate:0,delta:1/0,index:-1};s--;)(e=Math.abs(t-i[s]))<n.delta&&(n.bitrate=i[s],n.index=s,n.delta=e);return n},hContentEvent:function(t){var e=uvpjs.VPF_Flash.uvpFlashEvent.content;switch(t){case e.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case e.CONTENT_END:}},hPlaybackEvent:function(t,e){var i,s=uvpjs.VPF_Flash.uvpFlashEvent.playback;switch(t){case s.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+e);break;case s.VIDEO_PROGRESS:this.processCvioPayload(e);break;case s.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(e);break;case s.VIDEO_ERROR:this.processCvioPayload(e),this.dispatchError();break;case s.VIDEO_DONE:this.processCvioPayload(e),uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case s.VIDEO_TRANSITION_COMPLETE:i=this.parsePayload(e),this.resourceProvider.facadeVideoTransitionComplete(i.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break;case s.VIDEO_TRANSITION_START:i=this.parsePayload(e),this.pendingSwitchMode=0<=i.reason.toLowerCase().indexOf("manual")?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(i.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({eventType:uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(t){var e,i,t=this.parsePayload(t,"ContentVIO");if(t){for(e in i=t.ContentVIO)this.currFlashVideoState[e]=this.getCvioValue(i[e]);null===this.bitrateInfo.bitrates&&0<i.currentTime&&this.captureBitrateInfo()}},setStartBitrate:function(){this.hasSetStartBitrate=!0},captureBitrateInfo:function(){for(var t=[],e=[],i=this.player.getContentBitrateInfo(),s="string"==typeof i&&i.split(","),n=Array.isArray(s)?s.length:0;n--;)t[n]=+s[n],e[n]={bitrate:+s[n]};this.bitrateInfo.bitrates=t,this.bitrateInfo.abrInfo=e},processCuepointPayload:function(t){var e=this.parsePayload(t,"Cuepoint"),i=this.id3Options,t={pts:null};!e||!i.dataCallback||0<=e.text.indexOf("syncbak.cc")||(t.name=i.findNielsen&&-1<e.text.indexOf(s)?s:e.name,t.data=e.text,i.dataCallback(t))},getCvioValue:function(t){var e,i,s,n;return"boolean"==typeof t||"number"==typeof t?t:"string"==typeof t?(i=!(e="NaN"===t||"null"===t||""===t)&&"true"===t.toLowerCase(),s=!e&&!i&&"false"===t.toLowerCase(),n=!e&&!i&&!s&&parseInt(t),n=isNaN(n)?t:n,e?-1:!!i||!s&&n):void 0},parsePayload:function(t,e){var i=null;if(0!==t.indexOf("{")&&0!==t.indexOf("["))return t;try{i=JSON.parse(t)}catch(t){return this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to parse "+e+"as JSON; "+t.message),null}return i},addUvpFlashEventListeners:function(){var t,e,i,s,n,r,a,o,d=uvpjs.VPF_Flash.uvpFlashEvent,l={};for(i in d)for(n in e=d[i])s=e[n],l[s]=(r=this,a=i,o=s,r["h"+(a.charAt(0).toUpperCase()+a.substr(1))+"Event"].bind(r,o));for(i in t=this.windowLabels=uvpjs.UvpSwfService.setWindowMethods(l))this.player.addEventJSCallback(i,t[i])},loadVideo:function(){var t={cdn:uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(t.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,t)},initializeCaptionStyles:function(){var t,e={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"};for(t in e)this.player.setStyleAttribute(t,e[t])},dashToCamel:function(t){return t.replace(/(-\w)/g,function(t){return t[1].toUpperCase()})}}),t.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},t.VPF_Flash.styleTransform={_opacity:function(t){return 100*+t},backgroundOpacity:function(t){return uvpjs.VPF_Flash.styleTransform._opacity(t)},fontOpacity:function(t){return uvpjs.VPF_Flash.styleTransform._opacity(t)},fontSize:function(t){t=t.substr(0,t.indexOf("%"));return Math.round(14*(.01*+t))}}}(uvpjs.register("uvpjs")),Z=uvpjs.register("uvpjs"),y=Z._,Z.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.hVideoEvent=this.onVideoEvent.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(t){this.debug&&(uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",t.resourceProvider.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",t)),this._super(t),t.drm.enabled&&(this.fairplayDRM=new uvpjs.FairPlayDRM({drm:t.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),uvpjs.util.isEmpty(t.startTime)||(this.startTime=Math.floor(t.startTime)),this.addEvents(),this.setSource(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",t)},handleEvent:function(t){var e=this.eventTypes.HTML5;this.videoTagRef&&(this._super(t),t.type===e.LOADED_METADATA&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null))},handleFairPlayError:function(t,e){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:t,message:e,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(t){console.log("Error caught at setSource: ",t)}this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onVideoEvent:function(t){t.type===this.eventTypes.HTML5.CAN_PLAY&&(this.videoTagRef.removeEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.updateAudioTracksInfo())},switchAudioTrack:function(t){this.videoTagRef.audioTracks?(this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+t),this.videoTagRef.audioTracks[t].enabled=!0,this.updateAudioTracksInfo()):this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switching is not supported on this user agent")},updateAudioTracksInfo:function(){var t=this.normalizeAudioTrackInfo(this.videoTagRef.audioTracks,uvpjs.mediaCapabilities.HTML5);t&&(t={tracks:t,track:t[t=this.getCurrentEnabledAudioTrackIndex(this.videoTagRef.audioTracks)],index:t},this.resourceProvider.facadeSetAudioTrackInfo(t))},getCurrentEnabledAudioTrackIndex:function(t){for(var e=t.length;e--;)if(t[e].enabled)return e;return e},onAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(this.activeMetadataTrack=t.track),t.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},onCueChange:function(t){t&&t.target&&t.target.activeCues&&1<=t.target.activeCues.length&&("metadata"===t.target.kind?this.resourceProvider.facadeId3Data(t.target.activeCues):"captions"!==t.target.kind&&"subtitles"!==t.target.kind||(t.target.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),this.resourceProvider.facadeSetCaptionReady()))},showCaptions:function(t){if(uvpjs.util.isDefinedString(t)){for(var e=this.videoTagRef.textTracks,i=!1,s=0,n=e.length;s<n;s++){var r=e[s];r.language===t?(i=!0,r.mode="hidden"):r.mode="disabled"}i||(uvpjs.log(this.DEBUG_ID,"Language string was supplied but nothing matched in the stream. Enabling the first track in the list as best effort",e,t),e[0].mode="hidden")}},removeEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeState:function(){return this.facadeState||{}},getStreamType:function(){return uvpjs.mediaCapabilities.isSafari()?"HLS":"MP4"},onStalledEvent:function(t){var e;y.isEmpty(this.resourceProvider)||y.isEmpty(this.resourceProvider.cviModel)?this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",t):(e=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",t,e))}}),uvpjs.register("uvpjs").VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"prod"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=uvpjs.debug,this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"HLS.js version: "+Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isHdStreamLive=!1,this.id3HandlingEnabled=!1,this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0,this.levelDetails=null,this.isMobile=uvpjs.mediaCapabilities.isMobile(),this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:this.onRequest.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onAudioEvent=this.onAudioEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroy");for(var t=this.videoTagRef.textTracks,e=0;e<t.length;e++){var i=t[e];"captions"!==i.kind&&"subtitles"!==i.kind||(i.textTrack1&&(i.textTrack1=!1),i.textTrack2&&(i.textTrack2=!1))}this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null,this.levelDetails=null},initialize:function(t){return this._super(t),this.id3HandlingEnabled=t.enableId3Handling,"number"==typeof t.liveSyncDurationCount&&0<t.liveSyncDurationCount&&(this.libConfig.liveSyncDurationCount=t.liveSyncDurationCount),!0===t.capLevelToPlayerSize&&(this.libConfig.capLevelToPlayerSize=t.capLevelToPlayerSize),this.isMobile&&(this.libConfig.maxBufferLength=20,this.libConfig.maxMaxBufferLength=60,this.libConfig.liveBackBufferLength=30),uvpjs.util.isEmpty(t.hlsjsLoader)||(this.debug&&uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=t.hlsjsLoader),this.player=new Hls(this.libConfig),this.addEvents(),"number"==typeof t.startBitrate&&-1<t.startBitrate&&(this.startBitrate=t.startBitrate),"number"==typeof t.maxBitrate&&-1<t.maxBitrate&&(this.maxBitrate=t.maxBitrate),"number"==typeof t.minBitrate&&-1<t.minBitrate&&(this.minBitrate=t.minBitrate),t.startTime&&(this.startTime=Math.round(t.startTime)),t.errorRecovery&&this.setErrorRecoveryOverrides(t.errorRecovery),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef),this.player},seekToLive:function(){this.player&&this._isHdStreamLive?this.seekTo(this.getLiveEdgeOffset()):uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+isHDStreamLive)},isAbrStreamingSupported:function(){return this.bitrateList?0<this.bitrateList.length:this._super()},useDynamicSwitching:function(t){this._super(),this.player?this.player.nextLevel=t?-1:this.player.currentLevel:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchAudioTrack:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+t),this.player.audioTrack=t},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(t){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,t,!1))},switchToIndex:function(t){var e;this.isAbrStreamingSupported()?(0<this.getMinBitrateAllowed()&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&0<this.getMaxBitrateAllowed()&&this.setMaxBitrateAllowed(-1),e=-1!==this.player.autoLevelCapping?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):NaN,e=isNaN(e)?this.bitrateList.length-1:e,0<=t&&t<=e?this.player.nextLevel=t:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",e," : Index=",t)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},showCaptions:function(){0<this.player.subtitleTracks.length&&(this.player.subtitleTrack=0)},getStartBitrate:function(){var t=this.player;return this.startBitrate||this.minBitrate||t&&t.levels&&t.levels[0]&&t.levels[0].bitrate||-1},setStartBitrate:function(t){this.player?(t<this.getMinBitrateAllowed()&&(t=this.getMinBitrateAllowed(),this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED)),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,t,!1)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){if(this.player){var t=this.player.minAutoLevel;return this.bitrateList?this.bitrateList[t].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMinBitrateAllowed:function(t){var e;this.player?(this.player.config.minAutoBitrate=t-1,e=this.getIndexForBitrate(this.bitrateList,t,!0),this.player.currentLevel<e&&(this.player.nextAutoLevel=e),uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",t)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){if(this.player){var t=this.player.maxAutoLevel;return void 0!==t?this.bitrateList[t].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMaxBitrateAllowed:function(t){if(!this.player)return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super();this.player.autoLevelCapping=-1===t?t:this.getIndexForBitrate(this.bitrateList,t,!1),uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",t)},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var t=-1;return t=this.bitrateList&&this.bitrateList[this.player.currentLevel]?this.bitrateList[this.player.currentLevel].bitrate:t},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var t,e;if(this.player)return(e=(t=this.player.media).getVideoPlaybackQuality)&&"function"==typeof e?e.call(t).droppedVideoFrames:t.webkitDroppedFrameCount||0},getAverageDroppedFPS:function(){return this.getDroppedFramesCount()/this.getDuration()},getCappedAbrInfo:function(){var t=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,e=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(e,t)},getFacadeState:function(){this.videoTagRef&&0<this.videoTagRef.textTracks.length&&void 0!==this.videoTagRef.textTracks[0]&&this.player&&-1===this.player.subtitleTrack&&this.showCaptions();var t={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(t.abrInfo=this.bitrateList,t.currentAbr=this.bitrateList[this.player.currentLevel],t.cappedAbrInfo=this.getCappedAbrInfo(),t.startBitrate=this.getStartBitrate(),t.currentBitrate=this.getCurrentBitrate(),t.minBitrate=this.getMinBitrateAllowed(),t.maxBitrate=this.getMaxBitrateAllowed()),t},getStreamType:function(){return"HLS"},isPlayingLive:function(){var t,e=!1;return this._isHdStreamLive&&this.levelDetails&&0<=this.videoTagRef.currentTime&&(t=Math.floor(this.getLiveEdgeOffset()),e=Math.ceil(this.videoTagRef.currentTime)>=t),e},getLiveEdgeOffset:function(){var t=Number.POSITIVE_INFINITY;return t=this._isHdStreamLive&&this.levelDetails&&0<this.videoTagRef.duration?this.videoTagRef.duration-this.player.config.liveSyncDurationCount*this.levelDetails.targetduration:t},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var t=Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,s=this.onAudioEvent,n=this.onFragmentEvent;this.player.on(t.MEDIA_ATTACHING,e,!1),this.player.on(t.MEDIA_ATTACHED,e,!1),this.player.on(t.MEDIA_DETACHING,e,!1),this.player.on(t.MANIFEST_PARSED,e,!1),this.player.on(t.MANIFEST_LOADED,e,!1),this.player.on(t.MANIFEST_LOADING,e,!1),this.player.on(t.FPS_DROP,e,!1),this.player.on(t.SUBTITLE_TRACKS_UPDATED,e,!1),this.player.on(t.LEVEL_SWITCHING,i,!1),this.player.on(t.LEVEL_SWITCHED,i,!1),this.player.on(t.LEVEL_LOADING,i,!1),this.player.on(t.LEVEL_LOADED,i,!1),this.player.on(t.LEVEL_UPDATED,i,!1),this.player.on(t.LEVEL_PTS_UPDATED,i,!1),this.player.on(t.AUDIO_TRACKS_UPDATED,s,!1),this.player.on(t.AUDIO_TRACK_SWITCHED,s,!1),this.player.on(t.FRAG_LOADING,n,!1),this.player.on(t.FRAG_LOAD_PROGRESS,n,!1),this.player.on(t.FRAG_LOADED,n,!1),this.player.on(t.FRAG_PARSED,n,!1),this.player.on(t.FRAG_BUFFERED,n,!1),this.player.on(t.FRAG_CHANGED,n,!1),this.player.on(t.FRAG_PARSING_DATA,n,!1),this.id3HandlingEnabled&&this.player.on(t.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(t.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var t=Hls.Events,e=this.onLibraryEvent,i=this.onLevelEvent,s=this.onAudioEvent,n=this.onFragmentEvent;this.player.off(t.MEDIA_ATTACHING,e),this.player.off(t.MEDIA_ATTACHED,e),this.player.off(t.MEDIA_DETACHING,e),this.player.off(t.MANIFEST_PARSED,e),this.player.off(t.MANIFEST_LOADED,e),this.player.off(t.MANIFEST_LOADING,e),this.player.off(t.FPS_DROP,e),this.player.off(t.SUBTITLE_TRACKS_UPDATED,e),this.player.off(t.LEVEL_SWITCHING,i),this.player.off(t.LEVEL_SWITCHED,i),this.player.off(t.LEVEL_LOADING,i),this.player.off(t.LEVEL_LOADED,i),this.player.off(t.LEVEL_UPDATED,i),this.player.off(t.LEVEL_PTS_UPDATED,i),this.player.off(t.AUDIO_TRACKS_UPDATED,s,!1),this.player.off(t.AUDIO_TRACK_SWITCHED,s,!1),this.player.off(t.FRAG_LOADING,n),this.player.off(t.FRAG_LOAD_PROGRESS,n),this.player.off(t.FRAG_LOADED,n),this.player.off(t.FRAG_PARSED,n),this.player.off(t.FRAG_BUFFERED,n),this.player.off(t.FRAG_CHANGED,n),this.player.off(t.FRAG_PARSING_DATA,n),this.id3HandlingEnabled&&this.player.off(t.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(t.ERROR,this.onError)},handleManifestData:function(t){this.bitrateList=this.player.levels;for(var e,i=t.levels,s=i.length,n=[];s--;)e=i[s],n.unshift({name:e.name||null,rate:e.bitrate,width:e.width,height:e.height});n.sort(function(t,e){t=t.rate,e=e.rate;return t<e?-1:e<t?1:0}),this.resourceProvider.facadeMetadataParsed({abrInfo:n})},onRequest:function(i,s){this.withCredentials=this.withCredentials||-1<s.indexOf("akamaihd")&&-1<s.indexOf("csmil"),i.withCredentials=this.withCredentials;!this.multiCDNEnabled&&-1===s.indexOf(".m3u8")||i.addEventListener("readystatechange",function(t){var e;-1!==s.indexOf(".ts")&&i.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.multiCDNEnabled&&(e=i.getAllResponseHeaders(),this.multiCDNEnabled=-1!==e.indexOf(this.responseHeaders.MULTI_CDN),e=this.multiCDNEnabled?i.getResponseHeader(this.responseHeaders.MULTI_CDN.toUpperCase()):this.getCdnNameAtStartup(s),this.processResponseHeader(e,this.responseHeaders.MULTI_CDN))}.bind(this))},onLibraryEvent:function(t,e){this.debug&&uvpjs.log(this.LIB_DEBUG_ID,t,e);var i=Hls.Events;switch(t){case i.MEDIA_ATTACHING:case i.MEDIA_ATTACHED:case i.MEDIA_DETACHING:case i.MANIFEST_LOADING:break;case i.MANIFEST_PARSED:this.handleManifestData(e);break;case i.FPS_DROP:break;case i.MANIFEST_LOADED:-1<this.maxBitrate&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),-1<this.minBitrate&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),-1<this.startBitrate&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime);break;case i.SUBTITLE_TRACKS_UPDATED:this.player.subtitleDisplay=!1}},onLevelEvent:function(t,e){this.debug&&uvpjs.log(this.LEVEL_DEBUG_ID,t,e);var i=Hls.Events;switch(t){case i.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(e.details);break;case i.LEVEL_LOADING:break;case i.LEVEL_UPDATED:e.details&&(this.levelDetails=e.details,this._isHdStreamLive=e.details.live);break;case i.LEVEL_PTS_UPDATED:break;case i.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[e.level].bitrate);break;case i.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[e.level].bitrate)}},onAudioEvent:function(t,e){t!==Hls.Events.AUDIO_TRACKS_UPDATED&&t!==Hls.Events.AUDIO_TRACK_SWITCHED||(t={tracks:t=this.normalizeAudioTrackInfo(this.player.audioTracks,this.mc.HLSJS),track:t[this.player.audioTrack],index:this.player.audioTrack},this.resourceProvider.facadeSetAudioTrackInfo(t),this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switched "+t.track.id))},onFragmentEvent:function(t,e){var i,s=Hls.Events;switch(t){case s.FRAG_LOAD_PROGRESS:break;case s.FRAG_PARSING_DATA:"video"===e.type&&(this._playbackFramerate=e.nb/(e.endPTS-e.startPTS));break;case s.FRAG_LOADED:i=8e3*(i=e.stats).loaded/Number(window.performance.now()-i.trequest),this._currentBandwidth=i,this._currentMaxBandwidth=Math.max(i,this._currentMaxBandwidth),this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0;break;case s.FRAG_CHANGED:}},onID3Event:function(t,e){this.resourceProvider.facadeId3Data(e.samples)},onError:function(t,e){var i=!1,s=[Hls.ErrorDetails.MANIFEST_LOAD_ERROR,Hls.ErrorDetails.MANIFEST_PARSING_ERROR];if(e.fatal&&-1===s.indexOf(e.details))switch(this.debug&&uvpjs.error(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal),e.type){case Hls.ErrorTypes.NETWORK_ERROR:(i=this.networkErrorRecoveryCount<this.errorRecovery.networkRetryAttempts)&&(this.networkErrorRecoveryCount++,this.player.startLoad(this.startTime)),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(i).network());break;case Hls.ErrorTypes.MEDIA_ERROR:i=this.tryRecoveryFromMediaError()}else e.details===Hls.ErrorDetails.BUFFER_APPENDING_ERROR?this.mc.isFirefox()&&parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"Handling Firefox buffer appending error.",e.type,e.details,"isFatal: "+e.fatal),i=this.tryRecoveryFromMediaError(),setTimeout(function(){this.player.startLoad(),this.player.media.play()}.bind(this),100)):this.debug&&uvpjs.warn(this.DEBUG_ID,t,e.type,e.details,"isFatal: "+e.fatal);i||(e.response&&e.response.code&&e.response.code===this.CDN_GEO_BLOCKED_HTTP_STATUS_CODE.AKAMAI?(this.resourceProvider.facadeError(this.getErrorInfoForType(uvpjs.ErrorInfo.errorCodes.RESOURCE_GEOBLOCKED,e.details,e.fatal)),this.debug&&uvpjs.warn(this.DEBUG_ID,uvpjs.ErrorInfo.messages.RESOURCE_GEOBLOCKED)):this.resourceProvider.facadeError(this.getErrorInfoForType(e.type,e.details,e.fatal)))},tryRecoveryFromMediaError:function(){var t=this.mediaErrorRecoveryCount<this.errorRecovery.mediaRetryAttempts;return t&&(this.mediaErrorRecoveryCount++,this.player.recoverMediaError()),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(t).media()),t},getErrorMsg:function(t){var e=t?this.errorRecovery.MSG_TRYING_TO_RECOVER_PREFIX:this.errorRecovery.MSG_MAX_ATTEMPS_REACHED_PREFIX,i=" attempt : ";return{network:function(){return i+=this.networkErrorRecoveryCount+"/"+this.errorRecovery.networkRetryAttempts,this.errorRecovery.MSG_NETWORK_ERROR+e+i}.bind(this),media:function(){return i+=this.mediaErrorRecoveryCount+"/"+this.errorRecovery.mediaRetryAttempts,this.errorRecovery.MSG_MEDIA_ERROR+e+i}.bind(this)}},getErrorInfoForType:function(t,e,i){var s=uvpjs.ErrorInfo,n=Hls.ErrorTypes,r=uvpjs.ErrorInfo.errorCodes;switch(t){case n.NETWORK_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_NETWORK_ERROR,message:s.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",e),isFatal:i});case n.MEDIA_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_MEDIA_ERROR,message:s.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",e),isFatal:i});case n.MUX_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_MUX_ERROR,message:s.messages.HLSJS_MUX_ERROR.replace("{INFO}",e),isFatal:i});case n.OTHER_ERROR:return new s({errorCode:r.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:r.HLSJS_OTHER_ERROR,message:s.messages.HLSJS_OTHER_ERROR.replace("{INFO}",e),isFatal:i});case r.RESOURCE_GEOBLOCKED:return new s({errorCode:r.RESOURCE_GEOBLOCKED,hlsjsErrorCode:r.HLSJS_OTHER_ERROR,message:s.messages.RESOURCE_GEOBLOCKED,isFatal:i})}},setErrorRecoveryOverrides:function(e){["network","media"].forEach(function(t){e[t]&&e[t].attempts&&"number"==typeof e[t].attempts&&(this.errorRecovery[t+"RetryAttempts"]=e[t].attempts)}.bind(this))}}),function(){"use strict";function a(t){if(!isNaN(t))return t<1048576?(t/1024).toFixed(2)+"k":t<1073741824?(t/1048576).toFixed(2)+"M":(t/1073741824).toFixed(2)+"G"}uvpjs.register("uvpjs").Diagnostic=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(t){var e,i=uvpjs.Configuration;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),t&&(e=t.videoEl,this._videoEl=e,this._containerEl=t.containerEl,this._eventsMgr=t.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":i.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),this._diagEl&&this._contentEl?(this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,this._params=null):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window.")},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=t,this._createDiag(),this._addEventListeners()},_createDiag:function(){var t,e,i=uvpjs.util,s=this._styleEl,n=this._contentEl;this._template,this._params,n&&((t=document.createElement("div")).id=this._diagnosticId,n.insertBefore(t,n.firstChild),(e=uvpjs.util.htmlToElement("<span>x</span>")).addEventListener("click",this._handleCloseButton.bind(this),!0),t.appendChild(e),n=document.createElement("table"),t.appendChild(n),i.addCSSObject(s,t,{background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),i.addCSSObject(s,t,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),i.addCSSObject(s,t,{color:"#fff"},"span:hover"),i.addCSSObject(s,t,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),i.addCSSObject(s,t,{background:"transparent"},"table td"),i.addCSSObject(s,t,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),i.addCSSObject(s,t,{width:"60px"},"table td:last-child"),this._diagEl=t,this._diagTableEl=n,this._hideDiagBtn=e)},_removeDiag:function(){var t=this._diagEl,e=this._hideDiagBtn;e&&e.removeEventListener("click",this._handleCloseButton.bind(this)),t&&t.remove()},_hideDiag:function(){var t=this._diagEl,e=this._eventsMgr;t&&(t.style.display="none"),e.dispatchEvent(e.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var t=this._diagEl;t&&(t.style.display="block")},_toggleDiag:function(){var t=this._diagEl;if(t)return"block"===t.style.display?void this._hideDiag():void this._showDiag()},_handleCloseButton:function(){var t=this._eventsMgr;this.debug&&uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),t.dispatchEvent(t.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;this._containerEl,e&&t?(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),e.addEventListener(i.VIDEO_PROGRESS+t,this._onVideoProgress.bind(this)),e.addEventListener(i.VIDEO_STATE_CHANGE+t,this._onVideoStateChange.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_START+t,this._onVideoTransitionStart.bind(this)),e.addEventListener(i.VIDEO_TRANSITION_COMPLETE+t,this._onVideoTransitionComplete.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;this._containerEl,e&&t?(e.removeEventListener(i.VIDEO_PROGRESS+t),e.removeEventListener(i.VIDEO_STATE_CHANGE+t),e.removeEventListener(i.VIDEO_TRANSITION_START+t),e.removeEventListener(i.VIDEO_TRANSITION_COMPLETE+t)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners.")},_updateTableHtml:function(){var t,e,i="",s=this._params;for(t in s)null!==(e=s[t])&&void 0!==e&&(i+="<tr><td>"+t+"</td><td>"+e+"</td></tr>");this._diagTableEl.innerHTML=i},_onVideoProgress:function(t){var e=t.payload,i=e.facadeState,s=this._params,n=i.minABRLevel,r=i.maxABRLevel;t.target===this._containerId&&(s["stream type"]=e.streamType,s.duration=e.duration,s["current time"]=e.currentTime.toFixed(2),s["buffer length"]=e.bufferLength.toFixed(2),s["total dropped frames"]=0<=e.droppedFrames&&e.droppedFrames||null,s["average dropped (fps)"]=0<=e.averageDroppedFPS&&e.averageDroppedFPS.toFixed(2)||null,s["playback framerate (fps)"]=0<=e.playbackFramerate&&e.playbackFramerate.toFixed(2)||null,s["current bandwidth (B/s)"]=0<=e.currentBandwidth&&a(e.currentBandwidth)||null,s["switching mode"]=e.switchingMode,s["current index bitrate (B/s)"]=a(i.currentAbr&&i.currentAbr.bitrate),s["start index bitrate (B/s)"]=a(i.startBitrate),void 0!==n&&void 0!==r&&(s["available indexes"]=n+" to "+r),this._updateTableHtml())},_onVideoStateChange:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(i["playback state"]=e.newState,this._updateTableHtml())},_onVideoTransitionStart:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",e),i["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(t){var e=t.payload,i=this._params;t.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",e),i["transition state"]="complete",this._updateTableHtml())}})}(),function(){"use strict";uvpjs.register("uvpjs").Watermark=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(t){var e;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){this._imgEl&&this._contentEl?(this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._imgEl=null):this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove watermark.")},_createImage:function(){var t;this._contentEl&&((t=document.createElement("img")).id=this._watermarkId,t.src=this.IMAGE,t.style.position="absolute",t.style.display="none",this._imgEl=t,this._contentEl.appendChild(t))},_removeImage:function(){var t=this._imgEl;t&&t.parentNode&&t.parentNode.removeChild(t)},_ensureImage:function(){document.getElementById(this._watermarkId)||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var t=this._imgEl;t&&(t.style.display="none")},_showImage:function(){var t=this._imgEl;t&&(t.style.display="block")},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.addEventListener(i.AD_START+t,this._hideImage.bind(this)),e.addEventListener(i.CONTENT_START+t,this._showImage.bind(this)),e.addEventListener(i.CONTENT_END+t,this._hideImage.bind(this)),e.addEventListener(i.CONTAINER_RESIZE+t,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),e.addTimedEventCallback(e.HALF_SECOND,t,this._ensureImage.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.removeEventListener(i.AD_START+t),e.removeEventListener(i.CONTENT_START+t),e.removeEventListener(i.CONTENT_END+t),e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeTimedEventCallback(this.TIMER_INTERVAL,t),this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(t){t.target===this._containerId&&this._setPosition()},_setPosition:function(){var t,e,i,s,n,r,a,o,d,l,u,h=this._contentEl,c=this._videoEl;(t=this._imgEl)&&c&&h&&(n=c.videoHeight,(l=c.videoWidth)&&n&&(e=this.OFFSET,s=this.SIZE,a=c.getBoundingClientRect(),r=h.getBoundingClientRect(),i=a.height,c=a.width,h=r.bottom-a.bottom,a=r.right-a.right,l=1<i/c/(l=n/l)?(o=(i-c*l)/2,d=0,u=c*s+"px","auto"):(o=0,d=(c-i/l)/2,u="auto",i*s*(this.RATIO/l)+"px"),t.style.width=u,t.style.height=l,t.style.bottom=o+h+e+"px",t.style.right=d+a+e+"px"))}})}(),function(){"use strict";uvpjs.register("uvpjs").Kaleidoscope360=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(t){var e;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),t&&(e=t.videoEl,this._videoEl=e,this._eventsMgr=t.eventsMgr,this._containerId=t.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=e.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){this._360El&&this._kaleidoscopeViewer?(this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,this._360El=null):this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360.")},_loadKaleidoscope:function(t){return"function"!=typeof t?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),window.Kaleidoscope&&window.Kaleidoscope.Video?void this.pluginLoadedCB():(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB)))},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.addEventListener(i.CONTAINER_RESIZE+t,this._handleContainerResize.bind(this)),e.addEventListener(i.CONTENT_START+t,this._startKaleidoscopeRender.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners.")},_removeEventListeners:function(){var t=this._namespace,e=this._eventsMgr,i=e.eventTypes;e&&t?(e.removeEventListener(i.CONTAINER_RESIZE+t),e.removeEventListener(i.CONTENT_START+t)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners.")}})}(),uvpjs.register("uvpjs").ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(t,e,i){this.debug=uvpjs.debug,this.validationInfo=null,this.id=e,this.vidContId=i,this.rcoSeed={},this.initialize(t)},initialize:function(t){this.validationInfo=this.validateUserRco(t),this.validationInfo&&(this.rcoSeed=t,this.populateSelf(t))},getContextMetadata:function(){return this.contextMetadata||null},populateSelf:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},has:function(t){return!uvpjs.util.isEmpty(this[t])},getValidationInfo:function(){return this.validationInfo},validateUserRco:function(t){return{error:!1,message:""}}}),uvpjs.register("uvpjs").RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t),t=uvpjs.util.isDefinedString(t.assetURL);return{error:e.error||!t,message:e.error?e.message:"Invalid assetURL"}}}),uvpjs.register("uvpjs").DaiRco=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,dfpMediaId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(t,e,i)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGuid:function(t){this.cmsRefGuid=t,this.daiParams.daiVideoId=t},canMakePlatformCall:function(t){var e=uvpjs.util.isDefinedString(t),t=this.has("selectorCall")&&this.selectorCall||e&&t;return!!t&&(-1<t.indexOf("$PID$")?this.has("pid"):!(-1<t.indexOf("$GUID$"))||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){var t=this.daiParams.dfpMediaId,e=this.daiParams.daiVideoId,i=t||e||!this.has("cmsRefGuid")?null:this.cmsRefGuid;return t||e||i},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(t){var e=window.google&&google.ima&&google.ima.dai,i=this.validateDaiConfig(t),s=this._super(t);return{error:!((t.useSsb||e)&&i&&!s.error),missingSDK:!e,message:s.error?s.message:e?i?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing."}},populateSelf:function(t){var e,i;for(e in t)i=t.hasOwnProperty(e),i&&void 0!==this.daiParams[e]?this.daiParams[e]=t[e]:i&&(this[e]=t[e]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(t){var e=uvpjs.util,i=!e.isEmpty(t.adTagParameters),s=!e.isEmpty(t.contentSourceId),n=!e.isEmpty(t.assetKey);return t.useSsb||n||i&&s?t.useSsb?!e.isEmpty(t.assetURL):n||i&&s:(this.debug&&uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),i&&s)},checkCustomAdTagParams:function(){var t=uvpjs.util,e=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null;e&&"string"!=typeof e&&t.isPlainObject(e)&&(e=t.queryStrFromObj(e),this.daiParams.adTagParameters.cust_params=encodeURIComponent(e))}}),uvpjs.register("uvpjs").RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=window.google&&google.ima,t=this._super(t);return{error:!(e&&!t.error),missingSDK:!e,message:t.error?t.message:"IMA SDK is missing."}}}),uvpjs.register("uvpjs").RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=this._super(t);return{error:e.error||!uvpjs.util.isDefinedString(t.assetURL),message:e.err?e.message:"Invalid assetURL"}}}),uvpjs.register("uvpjs").RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(t,e,i){this._super(t,e,i)},validateUserRco:function(t){var e=uvpjs.util,i=e.isDefinedString(t.pid),s=!i&&e.isDefinedString(t.cmsRefGuid)&&!e.isDefinedString(t.assetURL),n=this._super(t);return{error:!(!n.error&&(i||s||e.isDefinedString(t.selectorCall))),message:n.error?n.message:"Supplied RCO is not valid for type rp_platform"}}}),function(t){"use strict";function i(){if(!F&&document.getElementsByTagName("body")[0]){try{var t,e=f("span");e.style.display="none",(t=L.getElementsByTagName("body")[0].appendChild(e)).parentNode.removeChild(t),e=t=null}catch(t){return}F=!0;for(var i=U.length,s=0;s<i;s++)U[s]()}}function e(t){F?t():U[U.length]=t}function a(){var t=B.length;if(0<t)for(var e=0;e<t;e++){var i=B[e].id,s=B[e].callbackFn,n={success:!1,id:i};if(0<H.pv[0]){var r=v(i);if(r)if(!D(B[e].swfVersion)||H.wk&&H.wk<312)if(B[e].expressInstall&&m()){var a={};a.data=B[e].expressInstall,a.width=r.getAttribute("width")||"0",a.height=r.getAttribute("height")||"0",r.getAttribute("class")&&(a.styleclass=r.getAttribute("class")),r.getAttribute("align")&&(a.align=r.getAttribute("align"));for(var o={},d=r.getElementsByTagName("param"),l=d.length,u=0;u<l;u++)"movie"!=d[u].getAttribute("name").toLowerCase()&&(o[d[u].getAttribute("name")]=d[u].getAttribute("value"));A(a,o,i,s)}else(function(t){{var e;H.ie&&4!=t.readyState?(t.style.display="none",e=f("div"),t.parentNode.insertBefore(e,t),e.parentNode.replaceChild(c(t),e),p(t)):t.parentNode.replaceChild(c(t),t)}})(r),s&&s(n);else T(i,!0),s&&(n.success=!0,n.ref=h(i),n.id=i,s(n))}else T(i,!0),s&&((i=h(i))&&typeof i.SetVariable!=I&&(n.success=!0,n.ref=i,n.id=i.id),s(n))}}function h(t){var e=null,t=v(t);return e=t&&"OBJECT"===t.nodeName.toUpperCase()?typeof t.SetVariable===I&&t.getElementsByTagName(C)[0]||t:e}function m(){return!G&&D("6.0.65")&&(H.win||H.mac)&&!(H.wk&&H.wk<312)}function A(t,e,i,s){var n=v(i);i=S(i),u=s||null,g={success:!(G=!0),id:i},n&&(l="OBJECT"==n.nodeName.toUpperCase()?(o=c(n),null):(o=n,i),t.id=P,(typeof t.width==I||!/%$/.test(t.width)&&d(t.width)<310)&&(t.width="310"),(typeof t.height==I||!/%$/.test(t.height)&&d(t.height)<137)&&(t.height="137"),s=H.ie?"ActiveX":"PlugIn",s="MMredirectURL="+encodeURIComponent(O.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+s+"&MMdoctitle="+encodeURIComponent(L.title.slice(0,47)+" - Flash Player Installation"),typeof e.flashvars!=I?e.flashvars+="&"+s:e.flashvars=s,H.ie&&4!=n.readyState&&((s=f("div")).setAttribute("id",i+="SWFObjectNew"),n.parentNode.insertBefore(s,n),n.style.display="none",p(n)),y(t,e,i))}function c(t){var e=f("div");if(H.win&&H.ie)e.innerHTML=t.innerHTML;else{t=t.getElementsByTagName(C)[0];if(t){var i=t.childNodes;if(i)for(var s=i.length,n=0;n<s;n++)1==i[n].nodeType&&"PARAM"==i[n].nodeName||8==i[n].nodeType||e.appendChild(i[n].cloneNode(!0))}}return e}function y(t,e,i){var s,n,r,a,o,d,l,u=v(i);if(i=S(i),H.wk&&H.wk<312)return s;if(u){var h,c,p,g=f(H.ie?"div":C);for(p in typeof t.id==I&&(t.id=i),e)e.hasOwnProperty(p)&&"movie"!==p.toLowerCase()&&(a=g,o=p,d=e[p],l=void 0,l=f("param"),l.setAttribute("name",o),l.setAttribute("value",d),a.appendChild(l));for(h in H.ie&&(n=t.data,r=g.innerHTML,(i=f("div")).innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+n+"'>"+r+"</object>",g=i.firstChild),t)t.hasOwnProperty(h)&&(c=h.toLowerCase(),"styleclass"===c?g.setAttribute("class",t[h]):"classid"!==c&&"data"!==c&&g.setAttribute(h,t[h]));H.ie?w[w.length]=t.id:(g.setAttribute("type",R),g.setAttribute("data",t.data)),u.parentNode.replaceChild(g,u),s=g}return s}function p(t){var i=v(t);i&&"OBJECT"==i.nodeName.toUpperCase()&&(H.ie?(i.style.display="none",function t(){if(4==i.readyState){for(var e in i)"function"==typeof i[e]&&(i[e]=null);i.parentNode.removeChild(i)}else setTimeout(t,10)}()):i.parentNode.removeChild(i))}function s(t){return t&&t.nodeType&&1===t.nodeType}function S(t){return s(t)?t.id:t}function v(t){if(s(t))return t;var e=null;try{e=L.getElementById(t)}catch(t){}return e}function f(t){return L.createElement(t)}function d(t){return parseInt(t,10)}function D(t){var e=H.pv,t=(t+="").split(".");return t[0]=d(t[0]),t[1]=d(t[1])||0,t[2]=d(t[2])||0,e[0]>t[0]||e[0]==t[0]&&e[1]>t[1]||e[0]==t[0]&&e[1]==t[1]&&e[2]>=t[2]}function n(t,e,i,s){var n=L.getElementsByTagName("head")[0];n&&(i="string"==typeof i?i:"screen",s&&(E=_=null),_&&E==i||((s=f("style")).setAttribute("type","text/css"),s.setAttribute("media",i),_=n.appendChild(s),H.ie&&typeof L.styleSheets!=I&&0<L.styleSheets.length&&(_=L.styleSheets[L.styleSheets.length-1]),E=i),_&&(typeof _.addRule!=I?_.addRule(t,e):typeof L.createTextNode!=I&&_.appendChild(L.createTextNode(t+" {"+e+"}"))))}function T(t,e){var i;V&&(i=e?"visible":"hidden",e=v(t),F&&e?e.style.visibility=i:"string"==typeof t&&n("#"+t,"visibility:"+i))}function r(t){return null!=/[\\\"<>\.;]/.exec(t)&&typeof encodeURIComponent!=I?encodeURIComponent(t):t}var o,l,u,g,_,E,I,C,b,R,P,M,O,L,N,k,U,B,w,j,F,G,V,x,H;t.UvpSwfService=uvpjs.Class.subClass({init:function(t){this.debugId=t.debugId,this.debug=uvpjs.debug,this.containerId=t.containerId,this.dom=t.contentVideoDom,this.playerDom=t.playerDom,this.callback=t.readyCallback,this.id3OwnerIds=t.id3OwnerIds||"",this.capLevelToPlayerSize=t.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,setTimeout(this.initialize.bind(this),1)},destroy:function(){for(var t in this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype,this.windowLabels)window[this.windowLabels[t]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSize:function(){clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=setTimeout(this.setSize.bind(this),40)},setSize:function(){var t=this.getContainerSize(),e=t.width,t=t.height;this.swf&&this.swf.setSize(e,t,0,0)},playerReadyHandler:function(){clearTimeout(this.initTimeoutHandle),this.swf=(-1!==navigator.appName.indexOf("Microsoft")?window:document)[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(t){},startTimer:function(){this.initTimeoutHandle=setTimeout(function(){this.callback(null,this.svcC.error.PLAYER_INIT_TIMEOUT)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(t){t.success?this.startTimer():this.callback(null,this.svcC.error.EMBED_FAILED)},embed:function(t){var e=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,t,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:e.jsReady,playerReady:e.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var t,e,i=this.dom;this.svcC.hasFlash()?(this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),(t=document.createElement("div")).id=this.swfName,(e=i.querySelector("video")).style.display="none",i.style.height="100%",this.playerDom.style.height="100%",i.insertBefore(t,e),this.embed(t)):this.callback(null,this.svcC.error.FLASH_NOT_DETECTED)}}),t.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"//vidtech.cbsinteractive.com/uvpjs/uvpjsf/js_falback.swf",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},t.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},t.UvpSwfService.hasFlash=function(){var t=this.swfobject.getFlashPlayerVersion().major;return!uvpjs.util.isEmpty(t)&&0<parseInt(t)},t.UvpSwfService.setWindowMethods=function(t){var e,i,s,n=uvpjs.util;for(e in t)i=t[e],s="f_"+n.uid8(),window[s]=i,t[e]=s;return t},t.UvpSwfService.swfobject=(I="undefined",C="object",b="Shockwave Flash",R="application/x-shockwave-flash",P="SWFObjectExprInst",M="onreadystatechange",O=window,L=document,N=navigator,k=!1,U=[],B=[],w=[],x=!(V=!(G=F=!(j=[]))),(H=function(){var t=typeof L.getElementById!=I&&typeof L.getElementsByTagName!=I&&typeof L.createElement!=I,e=N.userAgent.toLowerCase(),i=N.platform.toLowerCase(),s=/win/.test(i||e),n=/mac/.test(i||e),r=!!/webkit/.test(e)&&parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),a="Microsoft Internet Explorer"===N.appName,i=[0,0,0],e=null;if(typeof N.plugins!=I&&typeof N.plugins[b]==C)(e=N.plugins[b].description)&&typeof N.mimeTypes!=I&&N.mimeTypes[R]&&N.mimeTypes[R].enabledPlugin&&(a=!(k=!0),e=e.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),i[0]=d(e.replace(/^(.*)\..*$/,"$1")),i[1]=d(e.replace(/^.*\.(.*)\s.*$/,"$1")),i[2]=/[a-zA-Z]/.test(e)?d(e.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof O.ActiveXObject!=I)try{var o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");o&&(e=o.GetVariable("$version"))&&(a=!0,i=[d((e=e.split(" ")[1].split(","))[0]),d(e[1]),d(e[2])])}catch(t){}return{w3:t,pv:i,wk:r,ie:a,win:s,mac:n}}()).w3&&((typeof L.readyState!=I&&("complete"===L.readyState||"interactive"===L.readyState)||typeof L.readyState==I&&(L.getElementsByTagName("body")[0]||L.body))&&i(),F||(typeof L.addEventListener!=I&&L.addEventListener("DOMContentLoaded",i,!1),H.ie&&(L.attachEvent(M,function t(){"complete"==L.readyState&&(L.detachEvent(M,t),i())}),O==top&&function e(){if(!F){try{L.documentElement.doScroll("left")}catch(t){return void setTimeout(e,0)}i()}}()),H.wk&&function t(){if(!F)return/loaded|complete/.test(L.readyState)?void i():void setTimeout(t,0)}())),U[0]=function(){(k?function(){var i=L.getElementsByTagName("body")[0],s=f(C);s.setAttribute("style","visibility: hidden;"),s.setAttribute("type",R);var n,r=i.appendChild(s);r?(n=0,function t(){if(typeof r.GetVariable!=I)try{var e=r.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),H.pv=[d(e[0]),d(e[1]),d(e[2])])}catch(t){H.pv=[8,0,0]}else if(n<10)return n++,void setTimeout(t,10);i.removeChild(s),r=null,a()}()):a()}:a)()},H.ie&&window.attachEvent("onunload",function(){for(var t=j.length,e=0;e<t;e++)j[e][0].detachEvent(j[e][1],j[e][2]);for(var i,s,n=w.length,r=0;r<n;r++)p(w[r]);for(i in H)H[i]=null;for(s in H=null,swfobject)swfobject[s]=null;swfobject=null}),{registerObject:function(t,e,i,s){var n;H.w3&&t&&e?((n={}).id=t,n.swfVersion=e,n.expressInstall=i,n.callbackFn=s,B[B.length]=n,T(t,!1)):s&&s({success:!1,id:t})},getObjectById:function(t){if(H.w3)return h(t)},embedSWF:function(o,d,l,u,h,c,p,g,v,f){var _=S(d),E={success:!1,id:_};H.w3&&!(H.wk&&H.wk<312)&&o&&d&&l&&u&&h?(T(_,!1),e(function(){l+="",u+="";var t={};if(v&&typeof v===C)for(var e in v)t[e]=v[e];t.data=o,t.width=l,t.height=u;var i,s={};if(g&&typeof g===C)for(var n in g)s[n]=g[n];if(p&&typeof p===C)for(var r in p)p.hasOwnProperty(r)&&(i=x?encodeURIComponent(r):r,r=x?encodeURIComponent(p[r]):p[r],typeof s.flashvars!=I?s.flashvars+="&"+i+"="+r:s.flashvars=i+"="+r);if(D(h)){var a=y(t,s,d);t.id==_&&T(_,!0),E.success=!0,E.ref=a,E.id=a.id}else{if(c&&m())return t.data=c,void A(t,s,d,f);T(_,!0)}f&&f(E)})):f&&f(E)},switchOffAutoHideShow:function(){V=!1},enableUriEncoding:function(t){x=typeof t===I||t},ua:H,getFlashPlayerVersion:function(){return{major:H.pv[0],minor:H.pv[1],release:H.pv[2]}},hasFlashPlayerVersion:D,createSWF:function(t,e,i){return H.w3?y(t,e,i):void 0},showExpressInstall:function(t,e,i,s){H.w3&&m()&&A(t,e,i,s)},removeSWF:function(t){H.w3&&p(t)},createCSS:function(t,e,i,s){H.w3&&n(t,e,i,s)},addDomLoadEvent:e,addLoadEvent:function(t){var e,i,s,n;typeof O.addEventListener!=I?O.addEventListener("load",t,!1):typeof L.addEventListener!=I?L.addEventListener("load",t,!1):typeof O.attachEvent!=I?(s="onload",n=t,(i=O).attachEvent(s,n),j[j.length]=[i,s,n]):"function"==typeof O.onload?(e=O.onload,O.onload=function(){e(),t()}):O.onload=t},getQueryParamValue:function(t){var e=L.location.search||L.location.hash;if(e){if(/\?/.test(e)&&(e=e.split("?")[1]),null==t)return r(e);for(var i=e.split("&"),s=0;s<i.length;s++)if(i[s].substring(0,i[s].indexOf("="))==t)return r(i[s].substring(i[s].indexOf("=")+1))}return""},expressInstallCallback:function(){var t;G&&((t=v(P))&&o&&(t.parentNode.replaceChild(o,t),l&&(T(l,!0),H.ie&&(o.style.display="block")),u&&u(g)),G=!1)},version:"2.3"})}(uvpjs.register("uvpjs")),Z=uvpjs.register("uvpjs"),A=Z._,Z.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this.vidContId="",this.containers=t.containers,this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=t.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=t.p2pClient,this.multiCdnClient=t.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(t.rco,t.cviMgr,t.vidContId)},initialize:function(t,e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",t),this.rco=t,this.vidContId=i,this.cviMgr=e,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",(e=this.cviModel.contentVideoState).sendResumeEvent=!1,e.startTime=0,e.elapsedTime=0,e.showPreroll=!0,e.playedChapterTime=0,e.previousSessionId="",this.contentDataProxy=new uvpjs.ContentDataProxy({cviModel:this.cviModel,eventsManager:this.eventsMgr}),A.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var t=this.eventsMgr;this._removeTimers(),t.addTimedEventCallback(t.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),t.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionStyle:function(t){this._hasFacade()&&this.facade.setCaptionStyle&&this.facade.setCaptionStyle(t)},_removeTimers:function(){var t=this.eventsMgr;t.removeTimedEventCallback(t.TENTH_SECOND,this.internalNS),t.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var t=this.rco&&this.rco.rcoSeed;this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(t)},cleanUpObjects:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProxy:function(){this.contentDataProxy&&this.contentDataProxy.destroy(),this.contentDataProxy=null},loadVideoAndBeginPlayback:function(t){var e=this.cviModel;this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),e.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),e.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),e.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=t,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(t){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.uvpSwfService=new uvpjs.UvpSwfService({capLevelToPlayerSize:!0===this.rco.capLevelToPlayerSize,debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,t)})):this.finishLoadVideoAndBeginPlayback(t),this.prepForCaptionEvents()},handleContainerResize:function(){this.cviModel.contentVideoState.isFlash?this.uvpSwfService.resetSize():uvpjs.util.isFunction(this.facade.containerResize)&&this.facade.containerResize()},handleUvpFlashPlayerLoaded:function(t,e,i){var s=uvpjs.ErrorInfo;if(i)return i=new s({errorCode:s.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+i,isFatal:!0}),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:i},this.vidContId);setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,t),2)},handleCdnDecision:function(t,e){this.setNewAssetUrlAndCdn(e),this.doFlashCheck(t)},shouldUseFlash:function(){var t=this.mc.systemInfo,e=this.cviModel.getSessionOption("preventFlashPlayback"),i=t.supportsNativeHls||t.isHlsjsEligible,s=!e&&t.isDesktop&&uvpjs.UvpSwfService.hasFlash(),e=this.mc.isHlsUrl(this._getAssetUrl()),t=uvpjs.Configuration.env;return!("local"!==t&&"dev"!==t&&"stage"!==t||!window.forceFlash||!s)||e&&!i&&s},prepForCaptionEvents:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY,t.SET_CAPTIONS_LANG],i=e.length;i--;)this.eventsMgr.addEventListener(e[i]+this.internalNS,this.hCaptionEventForUvp.bind(this))},removeCaptionEventListeners:function(){for(var t=this.eventsMgr.eventTypes,e=[t.CONTROL_HIDE_CAPTIONS,t.CONTROL_SHOW_CAPTIONS,t.CAPTIONS_READY,t.SET_CAPTIONS_LANG],i=e.length;i--;)this.eventsMgr.removeEventListener(e[i]+this.internalNS)},hCaptionEventForUvp:function(t){var e=this.eventsMgr.eventTypes;if(this._hasFacade()&&t.target===this.vidContId)switch(t.type){case e.CAPTIONS_READY:uvpjs.util.isFunction(this.facade.loadCaptions)&&this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case e.CONTROL_SHOW_CAPTIONS:uvpjs.util.isFunction(this.facade.showCaptions)&&this.facade.showCaptions(t.payload.language);break;case e.CONTROL_HIDE_CAPTIONS:uvpjs.util.isFunction(this.facade.hideCaptions)&&this.facade.hideCaptions();break;case e.SET_CAPTIONS_LANG:uvpjs.util.isFunction(this.facade.setCaptionLanguage)&&this.facade.setCaptionLanguage(t.payload.language)}},finishLoadVideoAndBeginPlayback:function(t){var e=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),e.incrementMedNum(),this.createFacade(),e=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(e),!0!==this.suppressFacadePlay&&(this.facade.showVideo(),this.facade.playVideo()),e===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(t){var e=t&&t.providers||null,i=e&&e[0]?e[0]:null,t=i&&i.host||null,e=i&&i.provider||null;t&&(i=this._getAssetUrl(),t!==(i=uvpjs.util.parseUrl(i)).host&&(i=i.protocol+"//"+t+i.pathname+i.search,this.cviModel.contentVideoState.assetURL=i)),e&&this.setContentVideoStateCdn(e)},setContentVideoStateCdn:function(t){this.cviModel.contentVideoState.cdn=t,this.debug&&uvpjs.log(this.DEBUG_ID,"CDN has been updated: ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CDN_UPDATED,{cdn:t},this.vidContId)},getContentVideoStateCdn:function(t){return this.cviModel.contentVideoState.cdn},setModelRcoOverrides:function(){var t=function(t){var e=i.getSessionOption(t);return"boolean"==typeof e?e:void 0!==i.getVideoPlaybackCDOProperty(t)&&i.getVideoPlaybackCDOProperty(t)},e=function(t){var e=i.getSessionOption(t);return"number"==typeof e&&0<=e?e:void 0!==i.getVideoPlaybackCDOProperty(t)?Number(i.getVideoPlaybackCDOProperty(t)):-1},i=this.cviModel,s=e(i.START_BITRATE),n=e(i.MIN_BITRATE),r=e(i.MAX_BITRATE),a=e(i.LIVE_SYNC_DURATION_COUNT),o=t(i.CAP_LEVEL_TO_PLAYER_SIZE),d=t(i.DASHJS_FAST_SWITCH_ABR),l=i.getSessionOption("useDynamicSwitching"),u=i.getSessionOption("errorRecovery"),h=Number(this.rco.startBitrate)||-1,c=Number(this.rco.minBitrate)||-1,p=Number(this.rco.maxBitrate)||-1,g=Number(this.rco.liveSyncDurationCount)||-1,v=this.rco.capLevelToPlayerSize,f=this.rco.enableDashJSFastSwitchABR,e=(this.rco.useDynamicSwitching,this.rco.useDynamicSwitching),t=this.rco.errorRecovery;-1<h?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",h),i.setStartBitrate(h)):i.setStartBitrate(s),-1<c?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",c),i.setMinBitrate(c)):i.setMinBitrate(n),-1<p?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",p),i.setMaxBitrate(p)):i.setMaxBitrate(r),-1<g?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",g),i.setLiveSyncDurationCount(g)):i.setLiveSyncDurationCount(a),"boolean"==typeof v?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",v),i.setCapLevelToPlayerSize(v)):i.setCapLevelToPlayerSize(o),"boolean"==typeof f?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",f),i.setDashJSFastSwitchABR(f)):i.setDashJSFastSwitchABR(d),"boolean"==typeof e?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",e),i.setUseDynamicSwitching(e)):i.setUseDynamicSwitching(l),"object"==typeof t?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override session options errorRecovery value with RCO value:",t),i.setErrorRecovery(t)):i.setErrorRecovery(u)},createId3Parser:function(t){this.id3EventQueue=[];var e={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(t){case this.mc.HLSJS:this.id3Parser=new uvpjs.FrameId3Parser(e);break;case this.mc.HTML5:this.id3Parser=new uvpjs.TrackId3Parser(e);break;case this.mc.FLASH_HLS:e.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(e)}},handleId3Metadata:function(t){this.id3EventQueue&&this.id3EventQueue.push(t)},checkId3Events:function(t){for(var e,i=this.id3EventQueue,s=i&&i.length||0;s--;)t>=(e=i[s]).pts&&(this.dispatchCuepointEvent(e),this.id3EventQueue.splice(s,1))},dispatchCuepointEvent:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,t,this.vidContId)},createFacade:function(){var t=this.cviModel,e=t.getContentVideoState(),i=this._getAssetUrl(),e={enableId3Handling:this.id3HandlingEnabled,assetURL:i,isMuted:t.isMuted,resourceProvider:this,startTime:e.startTime,startBitrate:t.startBitrate,maxBitrate:t.maxBitrate,minBitrate:t.minBitrate,useDynamicSwitching:t.useDynamicSwitching,liveSyncDurationCount:t.liveSyncDurationCount,volume:t.volume,capLevelToPlayerSize:t.capLevelToPlayerSize,enableDashJSFastSwitchABR:t.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,errorRecovery:t.errorRecovery,drm:e.drm};this.debug&&uvpjs.log(this.DEBUG_ID,"createFacade",e),this.facade=this.getFacade(i),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(e.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(e.swfService=this.uvpSwfService);e=this.facade.initialize(e);!e||this.facade.facadeType!==this.mc.HLSJS&&this.facade.facadeType!==this.mc.DASHJS||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_LIBRARY_LOADED,{player:e,facadeType:this.facade.facadeType},this.vidContId),this.facade.manageNativeControls(t.nativeControls)},destroyFacade:function(){var t=this._hasFacade()&&"function"==typeof this.facade.destroy;this.debug&&uvpjs.log(this.DEBUG_ID,"destroyFacade"),t?(this.facade.destroy(),this.facade={}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up.")},muteContentForAdPlay:function(t){var e=this.cviModel,i=this.facade;this._hasFacade()&&(!1!==t?i.muteVideo():e.isMuted||i.unMuteVideo())},getModule:function(t){return this.cviModel.getModule(t)},getModuleParam:function(t,e){return this.cviModel.getModuleParam(t,e)},createWatermark:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var t=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:t},this.vidContId)},dispatchContentEnd:function(){var t=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:t},this.vidContId)},dispatchSeekDone:function(){var t=this.eventsMgr;t.dispatchEvent(t.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var t=this.cviModel&&this.cviModel.contentPlaybackState.fatalError;this.eventsMgr&&(this.debug&&uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+(t?"Fatal ERROR encountered":"")),t||this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId))},dispatchVideoStateChange:function(t){isNaN(t)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:t,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+t,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataParsed:function(t){t&&t.abrInfo&&this.cviModel.setAbrInfo(t.abrInfo)},facadeProgress:function(t){!uvpjs.util.isEmpty(t)&&"object"==typeof t&&t.currentTime&&t.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:t.currentTime}),this.setModelDuration(parseInt(t.duration)))},facadeDurationChanged:function(t){uvpjs.util.isEmpty(t)||"object"!=typeof t||t.duration},setModelDuration:function(t){0<t&&this.cviModel.contentVideoState.duration!==t&&(this.cviModel.setContentVideoStateItems({duration:t}),this.cviModel.setContentPlaybackStateItems({duration:t}))},facadeDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeSeeked",t),this._seekFromTime?(this._seekToTime=t.seekToTime,this.dispatchSeekDone()):this.debug&&uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE.")},facadeError:function(t){var e,i,s=uvpjs.util,n=this.RPM&&this.RPM.currRP,r=this.eventsMgr,a=this.cviModel,o=!s.isEmpty(a),d=t.isFatal;this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+t.message),o&&d&&(e=(i=this.cviModel.getContentVideoState()).playbackStarted,i=s.isDefinedString(i.overrideAssetURL),!e&&i&&!this._overrideAssetUrlFailure)?this._handleOverrideAssetURLError(t):(o||this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),s.isEmpty(r)?this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(s=t.eventType||r.eventTypes.VIDEO_PLAYBACK_ERROR,t.eventType=s,r.dispatchEvent(s,{errorInfo:t},this.vidContId)),d&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),o&&(a.contentPlaybackState.fatalError=!0),n&&n.rco&&n.rco.type===uvpjs.mediaCapabilities.RP_IMA?n.imaContentComplete():(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp())))},facadePlaybackStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+t),this.dispatchVideoStateChange(t)},facadeVideoLevelLoaded:function(t){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:t},this.vidContId)},facadeVideoTransitionStart:function(t,e){e=e||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+t+" mode = "+e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:t,mode:e},this.vidContId)},facadeVideoTransitionComplete:function(t,e){e=e||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+t+" mode = "+e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:t,mode:e},this.vidContId)},facadeSetCaptionReady:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},facadeSetAudioTrackInfo:function(t){this.cviModel.setAudioTrackInfo(t)},facadeId3Data:function(t){this.id3Parser&&this.id3Parser.parse(t)},facadeMinimumBitrateAllowedChanged:function(t){this.cviModel.setMinBitrate(t)},facadeMaximumBitrateAllowedChanged:function(t){this.cviModel.setMaxBitrate(t)},getFacade:function(t){var e,i=this.mc.STREAMING,t=t||this._getAssetUrl(),s=this.mc.isHlsUrl(t),n=this.mc.isDashUrl(t),t=this.cviModel.contentVideoState.isFlash;if(this.debug&&uvpjs.log(this.DEBUG_ID,"getFacade"),(t||s||n)&&this._setDeliveryType(i),!t&&s)this.mc.canPlayHLSJS()&&(e=new uvpjs.VPF_HLSJS);else if(!t&&n)if(uvpjs.VPF_DASHJS)e=new uvpjs.VPF_DASHJS;else{if(!uvpjs.VPF_SHAKA)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS or Shaka Facade not available. - make sure you are using the correct .min file"));e=new uvpjs.VPF_SHAKA}else t&&(e=new uvpjs.VPF_Flash);return e||new uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",s),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,t.addEventListener(e.CONTROL_SEEK+i,this.onVideoSeekTo.bind(this)),t.addEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i,this.onVideoSeekToLive.bind(this)),t.addEventListener(e.CONTROL_PAUSE+i,this.onPauseVideo.bind(this)),t.addEventListener(e.CONTROL_PLAY+i,this.onPlayVideo.bind(this)),t.addEventListener(e.CONTROL_MUTE+i,this.onMuteVideo.bind(this)),t.addEventListener(e.CONTROL_UNMUTE+i,this.onUnMuteVideo.bind(this)),t.addEventListener(e.CONTROL_VOLUME_SET+i,this.onChangeVideoVolume.bind(this)),t.addEventListener(e.CONTROL_FULLSCREEN+i,this.onFullscreen.bind(this)),t.addEventListener(e.SWITCH_REQUEST+i,this.onSwitchRequest.bind(this)),t.addEventListener(e.USE_DYNAMIC_SWITCHING+i,this.onUseDynamicSwitching.bind(this)),t.addEventListener(e.MAXIMUM_BITRATE_ALLOWED+i,this.onMaximumBitrateAllowed.bind(this)),t.addEventListener(e.MINIMUM_BITRATE_ALLOWED+i,this.onMinimumBitrateAllowed.bind(this)),t.addEventListener(e.CONTAINER_RESIZE+i,this.handleContainerResize.bind(this)),t.addEventListener(e.SWITCH_AUDIO_TRACK+i,this.onSwitchAudioTrack.bind(this)))},_removeUVPEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS,s=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",s),t.removeEventListener(e.CONTROL_SEEK+i),t.removeEventListener(e.CONTROL_SEEK_TO_LIVE_POINT+i),t.removeEventListener(e.CONTROL_PAUSE+i),t.removeEventListener(e.CONTROL_PLAY+i),t.removeEventListener(e.CONTROL_MUTE+i),t.removeEventListener(e.CONTROL_UNMUTE+i),t.removeEventListener(e.CONTROL_VOLUME_SET+i),t.removeEventListener(e.SWITCH_REQUEST+i),t.removeEventListener(e.USE_DYNAMIC_SWITCHING+i),t.removeEventListener(e.MAXIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.MINIMUM_BITRATE_ALLOWED+i),t.removeEventListener(e.CONTROL_SHOW_CAPTIONS+i),t.removeEventListener(e.CONTROL_HIDE_CAPTIONS+i),t.removeEventListener(e.CAPTIONS_READY+i),t.removeEventListener(e.CONTAINER_RESIZE+i),t.removeEventListener(e.SWITCH_AUDIO_TRACK+i)},_getAssetUrl:function(t){var e=uvpjs.util,i=t||this.cviModel.getContentVideoState(),t=i.overrideAssetURL,e=e.isDefinedString(t)&&!this._overrideAssetUrlFailure,i=e?t:i.assetURL;return this.debug&&uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+e+")",i),i},_setDeliveryType:function(t){this.cviModel.setContentVideoStateItems({deliveryType:t})},_handleOverrideAssetURLError:function(t){var e=uvpjs.ErrorInfo,i=this.eventsMgr,s=i.eventTypes.VIDEO_START_ERROR,n=e.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&uvpjs.warn(this.DEBUG_ID,n+" Error using overrideAssetURL; will use assetURL."),t.eventType=s,t.message=n,t.isFatal=!1,t.errorCode=e.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,i.dispatchEvent(s,{errorInfo:t},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(t){var e=t&&t.target,t=t&&t.payload,i=t&&t.bitrate,s=this.cviModel,n=this.facade;if(e===this.vidContId&&i&&this._hasFacade())switch(typeof i){case"string":if("up"===i)s.setUseDynamicSwitching(!1),n.switchUp();else if("down"===i)s.setUseDynamicSwitching(!1),n.switchDown();else{if(i=Number(i),isNaN(i))return;s.setUseDynamicSwitching(!1),n.switchToBitrate(i)}break;case"number":s.setUseDynamicSwitching(!1),n.switchToBitrate(i);break;default:this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",i)}},onSwitchAudioTrack:function(t){uvpjs.util.isFunction(this.facade.switchAudioTrack)&&this.facade.switchAudioTrack(t.payload.id)},onUseDynamicSwitching:function(t){t&&t.target===this.vidContId&&t.payload&&(t=t.payload.data,this.cviModel.setUseDynamicSwitching(t),this._hasFacade()&&(this.facade.useDynamicSwitching(t),t&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate))),this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",t))},onMinimumBitrateAllowed:function(t){var e=t.payload,i=e&&e.bitrate,e=this.facade;t.target===this.vidContId&&(i&&"number"==typeof i?(this.cviModel.setMinBitrate(i),this._hasFacade()&&e.setMinBitrateAllowed(i)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i))},onMaximumBitrateAllowed:function(t){var e=t.payload,i=e&&e.bitrate,e=this.facade;t.target===this.vidContId&&(i&&"number"==typeof i?(this.cviModel.setMaxBitrate(i),this._hasFacade()&&e.setMaxBitrateAllowed(i)):this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+i,typeof i))},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.cviModel.contentVideoState.duration,t=this.cviModel.contentPlaybackState.currentTime,i=this.facade;"number"==typeof s&&e===this.vidContId&&(s<0||n<s?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s):(this._seekFromTime=this._seekFromTime||t,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&i.seekTo(s)))},onVideoSeekToLive:function(){var t=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&t.seekToLive()},facadeVolumeChange:function(t){!A.isNaN(t)&&A.isNumber(t)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:t},this.vidContId)},facadeLoading:function(t){t&&(t.bufferLength||t.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,{data:t},this.vidContId)},facadeTimeUpdate:function(t){this.cviModel.setContentPlaybackStateItems({currentTime:t})},onFullscreen:function(t){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(t.payload.isFs)},onPauseVideo:function(t){var e=t&&t.target,t=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",e),e===this.vidContId&&this._hasFacade()&&t.pauseVideo()},onPlayVideo:function(t){var e=t&&t.target,t=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",e),e===this.vidContId&&this._hasFacade()&&t.playVideo()},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.vol,n=uvpjs.util.inRange(s,0,1),t=this.cviModel.isMuted,i=this.facade;e===this.vidContId&&n&&!t&&this._hasFacade()&&i.setVolume(s)},onMuteVideo:function(t){var e=t&&t.target,t=this.facade;e===this.vidContId&&this._hasFacade()&&t.muteVideo()},onUnMuteVideo:function(t){var e=t&&t.target,t=this.facade;e===this.vidContId&&this._hasFacade()&&t.unMuteVideo()},onUVPJSTimerTick:function(){var t;this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING&&(t={},this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),t=this.cviModel.getContentVideoState(),!A.isEmpty(this.cviModel.sessionOptions.userId)&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:t},this.vidContId))),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1),t=this.getVideoProgressPayload(),this.setModelDuration(t.duration),this.id3HandlingEnabled&&this.checkId3Events(t.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t,this.vidContId))},checkBuffering:function(t){var e=this.cviModel?this.cviModel.contentPlaybackState:null;e&&e.playbackStarted&&e.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(e=t||e.currentTime||0,!this.bufferingDetected&&e<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&e>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=e)},getVideoProgressPayload:function(){var t={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:(this.cviModel.getCurrentVideoState(),this.facade.getDuration()),errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(t),t},setFacadeStateOnProgressPayload:function(t){var e=this.facade,i=this._hasFacade()&&e.getFacadeState();if(!i)return t;t.facadeState=i,t.averageDroppedFPS=e.getAverageDroppedFPS(),t.bufferLength=e.getBuffered()||0,t.currentTime=e.getCurrentTime()||0,t.currentBandwidth=e.getCurrentBandwidth(),t.currentMaxBandwidth=e.getCurrentMaxBandwidth(),t.droppedFrames=e.getDroppedFramesCount(),t.playbackFramerate=e.getPlaybackFramerate(),t.playbackState=e.getPlaybackState(),t.streamType=e.getStreamType(),t.isHDStreamLive=e.isHDStreamLive(),t.isPlayingLive=e.isPlayingLive(),t.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual"},setLocalStorageItems:function(){uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",this.rco.pid),localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var t=this.cviModel.contentVideoState,e=localStorage.getItem("UVPJS.resumePid")||null,i=localStorage.getItem("UVPJS.resumeContentTime")||null,s=localStorage.getItem("UVPJS.resumeEpochTime")||null,n=localStorage.getItem("UVPJS.resumeSessionId")||null;uvpjs.util.supportsLocalStorage()&&(e&&(t.resumePid=e),i&&(t.resumeContentTime=i),s&&(t.resumeEpochTime=s),n&&(t.resumeSessionId=n))},clearLocalStorageItems:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",""),localStorage.setItem("UVPJS.resumeContentTime",0),localStorage.setItem("UVPJS.resumeEpochTime",0),localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelState:function(){var t=this.cviModel;t&&(t.resetAdVideoState(),t.resetContentVideoState())},_hasFacade:function(){return!uvpjs.util.isEmpty(this.facade)}}),function(t){var e=t._,i="pubads.g.doubleclick.net",s="ad.doubleclick.net",n="request.php",r="Request.jsp";t.ContentDataProxy=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(t){this.debug=uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=t||{},this.startErrorName=uvpjs.EventType.VIDEO_START_ERROR,this.cviModel=this.opts.cviModel,this.eventsMgr=this.opts.eventsManager,this.cviModel.contentVideoStateDefaults&&this.populateDefaults(this.cviModel.contentVideoStateDefaults),this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptions:function(t){for(var e in t)this.opts[e]=t[e]},getModel:function(){return this.mdl},getProperty:function(t){return this.mdl[t]},setProperty:function(t,e){this.mdl[t]=e},loadData:function(t,e){var i,s="callback=uvpHandleJsonpResult",n=e||this.opts.queryParams,r=!1,a=!uvpjs.util.isEmpty(n);if(this.opts.url=t,this.opts.queryParams=e,a)for(i in t+=t.indexOf("?")<0?"?":"&",n)t+=(r?"&":"")+i+"="+n[i],r=!0;t.indexOf(s)<0&&(t+=(t.indexOf("?")<0?"?":"&")+s),this.selectorCall=t,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var t=new uvpjs.CodeLoader;this.callAttempts++,this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),t.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalError:function(t){"function"==typeof this.opts.errorCallback&&this.opts.errorCallback(t)},signalSuccess:function(){"function"==typeof this.opts.successCallback&&this.opts.successCallback()},parseSmilXML:function(t){var e,i,s,n,r,a,o,d=t.getElementsByTagName("ref"),l=null,u=d[0],h=!1,c=this.mdl,p=u&&this.checkForPlatformError(u);if(this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",t),p&&p.error)return p;if(null===(e=(t.getElementsByTagName("switch")[0]||t).getElementsByTagName("video"))[0])return{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(c.chapterTimesString="",u)for(i=0,s=d.length;i<s;i++)a=(n=d[i]).attributes.src.nodeValue,this.isAdCallURL(a)?(h||(c.imaAdCall=a),h=!0):l||(l=n,c.assetURL=l.getAttribute("src"),o=n.getElementsByTagName("param")),null!==n.getAttribute("clipEnd")&&(c.chapterTimesString+=n.getAttribute("clipEnd")+",");for(i=0,s=e.length;i<s&&(a=(r=e[i]).attributes.src.nodeValue,l||(l=r,c.assetURL=l.getAttribute("src"),o=r.getElementsByTagName("param"),null!==r.getAttribute("clipEnd")));i++)null!==r.getAttribute("clipEnd")&&(c.chapterTimesString+=r.getAttribute("clipEnd")+",");return u=o&&this.extractParams(o)||{},this.populateModelFromContentNodeAndParams(l,u),{error:!1}},populateModelFromContentNodeAndParams:function(t,e){var i,s=this.mdl,n=uvpjs.mediaCapabilities,r={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},a={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},o="true";for(q in r)s[q]=t.getAttribute(r[q])||"";for(q in a)s[q]=e[a[q]]||"";s.mediaId=this.getMediaId(e),s.duration=this.getDuration(t),s.sourceOwner=this.getSourceOwner(e),s.cmsRefGuid=t.getAttribute("guid")||t.getAttribute("vid")||"",s.isEmbedable=e.Embeddable===o,s.isLive=e.IsLive===o,s.episodeFlag=e.EpisodeFlag===o,s.useWatermark=e.WatermarkPlayback===o,0<s.chapterTimesString.length?(o=(i=s.chapterTimesString).length-1,i.lastIndexOf(",")===o&&(s.chapterTimesString=i.substring(0,o)),s.chapterStartTimes=this.convertChapterTimesToSeconds(s.chapterTimesString)):s.chapterStartTimes=[],-1<s.assetURL.indexOf(n.M3U)?(s.cdn="",s.fileType=n.M3U):-1<s.assetURL.indexOf(n.MP3)?s.fileType=n.MP3:s.fileType=n.MP4;n=this.cviModel.getVideoPlaybackCDOProperty("matchPageUrlProtocol")||!1;n&&(s.assetURL=s.assetURL.replace(/^\w*:/,"")),this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy mdl",s,n)},handleData:function(t){var e=t.responseText,t=uvpjs.util,e=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1),e=this.isValidJsonStr(e)&&JSON.parse(e)||null,t=t.isEmpty(e)?null:e.metafile,e=t&&new DOMParser,t=e&&e.parseFromString(t,"application/xml"),t=t&&this.parseSmilXML(t);if(this.callAttempts=0,t){if(t.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+t.errorInfo.message),void this.signalError(t.errorInfo);this.defineProperties(),this.signalSuccess()}else this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError())},isValidJsonStr:function(t){return"string"==typeof t&&("{"===t.charAt(0)&&"}"===t.charAt(t.length-1)||"["===t.charAt(0)&&"]"===t.charAt(t.length-1))},handleError:function(t){var e,i="ContentDataProxy Error: Unable to load url "+uvpjs.util.getErrorMessageForXHRStatus(t.status);this.debug&&uvpjs.error(this.DEBUG_ID,i,this.selectorCall),this.shouldRetryCall(t)?(e=this.callDelays[this.callAttempts],1<=this.callAttempts&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+e,isFatal:!1})}),setTimeout(this.makeSelectorCall.bind(this),e)):(this.callAttempts=0,this.signalError(new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:i+" URL: "+this.selectorCall,isFatal:!0,serverCode:t.status})))},shouldRetryCall:function(t){t=t.status;return-1<this.selectorCall.indexOf("link.theplatform")&&this.callAttempts<this.retryLimit&&500!==t&&404!==t&&403!==t&&0!==t},defineProperties:function(){},checkForPlatformError:function(t){t=t&&this.parseSmilRefNodeForException(t);return t?{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(t),serverCode:t.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(t){var e=t.responseCode||"n/a",i="; PID: "+(this.opts.pid||"n/a")+"; ",s=this.opts&&this.opts.cmsRefGuid+"; "||"",n=t.abstract?t.abstract+" ":"";return"Platform Error; code: "+e+i+s+(t.exception||"Resource Unavailable.")+" "+n},populateDefaults:function(t){uvpjs.util.isEmpty(t)||e.assign(this.mdl,t)},parseSmilRefNodeForException:function(t){var e,i=t.getElementsByTagName("param"),s={};if(i&&i.length){for(e=i.length;e--;)s[i[e].getAttribute("name")]=i[e].getAttribute("value");if("true"===s.isException)return s.abstract=t.getAttribute("abstract")||"",s}return null},extractParams:function(t){var e,i,s,n={};if(uvpjs.util.isEmpty(t))return n;for(s=t.length;s--;)e=(i=t[s]).getAttribute("name"),i=i.getAttribute("value"),e&&i&&(n[e]=i);return n},isAdCallURL:function(t){return-1<t.indexOf(s)||-1<t.indexOf(i)||-1<t.indexOf(n)||-1<t.indexOf(r)},getMediaId:function(t){var e,i,s,n="",t=t.trackingData;if(uvpjs.util.isEmpty(t))return"";for(i=0,s=(e=t.split("|")).length;i<s;i++)-1<e[i].indexOf("cid=")&&(n=e[i].split("=")[1]);return n},getSourceOwner:function(t){var e=t.Source;return uvpjs.util.isEmpty(e)&&"true"===t.WatermarkPlayback?"Entertainment":e||""},getDuration:function(t){t=parseInt(t.getAttribute("dur"))||0;return 0<t?.001*t:t},convertChapterTimesToSeconds:function(t){for(var e=[],i=t.split(","),s=i.length;s--;)e.unshift(function(t){var e=parseInt;switch((t=i[s].split(":")).length){case 1:return e(t[0]);case 2:return 60*e(t[0])+e(t[1]);case 3:return 3600*e(t[0])+60*e(t[1])+e(t[2])}}(i[s]));return e}})}(uvpjs.register("uvpjs")),Z=uvpjs.register("uvpjs"),m=Z._,Z.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_URL},initialize:function(t,e,i){this._super(t,e,i)},loadData:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),m.isFunction(t)&&m.isFunction(e)?(this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,this.dataLoadErrorCB=e,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS)},loadVideoAndBeginPlayback:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(t)}}),uvpjs.register("uvpjs").RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,init:function(t){this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_PLATFORM},loadData:function(t,e){var i=this.getSelectorCall(),s=i.url||null,n=null;if(i.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+i.message),void("function"==typeof e&&e(new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+i.message,isFatal:!0})));this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=t,uvpjs.util.isDefinedString(this.rco.sig)&&(n={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:e}),this.contentDataProxy.loadData(s,n)},loadVideoAndBeginPlayback:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(t)},getSelectorCall:function(){var t,e,i,s=this.rco,n=s.has("selectorCall")&&s.selectorCall||null;if(!n){if(e=(n=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"))&&-1<n.indexOf("$PID$"),i=n&&-1<n.indexOf("$GUID$"),t=s.has("pid")&&s.pid||null,s=s.has("cmsRefGuid")&&s.cmsRefGuid||null,(i=!e&&!i)||!t&&!s)return{error:!0,message:"Config error: "+(i?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(e?"pid":"cmsRefGuid"))};n=(n=n.replace(e?/\$PID\$/g:/\$GUID\$/g,e?t:s)).replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:n}},onDataProxyComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var t=uvpjs.util;t.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),t.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var t,e,i,s,n,r,a=this.cviModel.contentVideoState,o=this.contentDataProxy,d=this.rco;this.populateContentVideoStateFromLocalStorage(),n=Date.now()-+a.resumeEpochTime,o.setProperty("resumePid",a.resumePid),o.setProperty("resumeEpochTime",+a.resumeEpochTime),o.setProperty("resumeSessionId",a.resumeSessionId),o.setProperty("resumeContentTime",+a.resumeContentTime),o.setProperty("playedChapterTime",+a.playedChapterTime),o.setProperty("showPreroll",a.showPreroll),o.setProperty("sendResumeEvent",!1),o.getProperty("episodeFlag")&&!0!==a.isLive&&(r=o.getProperty("duration"),i=!(s=!uvpjs.util.isEmpty(d.globalResumeTime)&&0<d.globalResumeTime&&0<r&&20<r-d.globalResumeTime)&&d.pid===a.resumePid,s||i?(this.debug&&uvpjs.log(this.DEBUG_ID,"Local"),e=s?d.globalResumeTime:+a.resumeContentTime||0,t=!s&&n||0,a=!s&&n>this.ONE_HOUR_MS,n=s?this.cviModel.sessionId:"",s=this.getPlayedChapterTimeForContentResume(e),o.setProperty("sendResumeEvent",!0),o.setProperty("startTime",e),o.setProperty("elapsedTime",t),o.setProperty("showPreroll",a),o.setProperty("playedChapterTime",s),o.setProperty("previousSessionId",n),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(i?"local":"global")+"Resume"],startTime:e},this.vidContId)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(t){var e,i=0,s=this.contentDataProxy.getProperty("chapterStartTimes"),n=s.length||0;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",s),n)for(;n--;)if((e=s[n])<=t){4<=t-e?i=e:(this.contentDataProxy.setProperty("startTime",t-4),0<n&&(i=s[n-1]));break}return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",i),i}}),Z=uvpjs.register("uvpjs"),E=Z._,Z.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(t,e,i){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",i),this._super(t,e,i)},loadData:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),E.isFunction(t)?(this.dataLoadedCB=t,this.dataLoadErrorCB=e,this.dataLoadedCB()):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS)}}),function(t){"use strict";var o=t._;t.RP_IMA=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_BITRATE_THRESHOLD:2500,AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,trueXInteractionIds:{CHOICE_CARD_LOADED:"TrueXChoiceCardLoaded",OPT_IN:"TrueXUserOptIn",OPT_OUT:"TrueXUserOptOut",TIME_OUT:"TrueXUserTimeOut",CREDIT:"TrueXCredit",CLOSED_AFTER_CREDIT:"TrueXClosedAfterCredit",CLOSED_BEFORE_CREDIT:"TrueXClosedBeforeCredit"},init:function(t){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1},this.stuckAdCheckDisabled=!1,this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_IMA},initialize:function(t,e,i){this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",google.ima.VERSION),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",t),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",i)),this.playbackState=this.mc.EMPTY,this.vidContId=i,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=t,this.isContentScenario=!1,this._super(t,e,i),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(e=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(e.eventType,{errorInfo:e},i)):(i=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=i.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(t,e){switch(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),this.mc.isChromecast()||this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:t();break;case this.PLATFORM:this._super(t,e);break;case this.CONTENT_AND_AD_CALL:t()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel,s=uvpjs.util.isDefinedString(e.adCall)?e.adCall:null,n=this.imaScenario===this.PLATFORM,n=s||(n?this.imaAdCall:null);this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(i.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(n)):(i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(e),i.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,n)):this.doFlashCheck(n))},finishLoadVideoAndBeginPlayback:function(t){var e="",i=uvpjs.adUtil,s=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,s.incrementMedNum(),this.isContentScenario=!0),t?(e=i.populateImaAdCallValues(t,s,this.isContentScenario),this.viewGuid=i.getDwViewGuid(s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",e)):this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(e)},dispatchContentStart:function(){this.resetTrueXStatus(),this.stuckAdCheckDisabled=!1,this._super()},requestAdsManagerOrResume:function(t){o.isString(t)&&!o.isEmpty(t)?this._requestAdsManager(t):this._onContentResumeRequested()},setImaAdUrl:function(){var t=this.checkForAdCallOverride();t?(this.contentDataProxy.setProperty("imaAdCall",t),this.imaAdCall=t):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var t=this.cviModel.getModule(this.AD_SETTINGS),e=null!=t&&1==t.enabled,i=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),t=null;return e&&!o.isUndefined(i)&&(t=i),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(t||"null")),t},manageLocalAndGlobalResume:function(){this._super(),this.contentDataProxy.setProperty("podsToSkip",this.getPodsToSkip())},getPodsToSkip:function(){var t,e="",i=this.contentDataProxy,s=i.getProperty("chapterStartTimes");return i.getProperty("showPreroll")||(e="1"),0<s.length&&0<=(t=s.indexOf(i.getProperty("playedChapterTime")))&&(t+=2,e=0<e.length?e+","+String(t):String(t)),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",e),e},getUnknownImaScenarioError:function(){return new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},processInteractionEvent:function(t){var e=t&&t.id,t=this.trueXInteractionIds;switch(e){case t.CLOSED_BEFORE_CREDIT:case t.CHOICE_CARD_LOADED:this.resetTrueXStatus(),this.trueXStatus.choicePending=!0;break;case t.OPT_IN:this.trueXStatus.choicePending=!1,this.trueXStatus.inProgress=!0;break;case t.OPT_OUT:case t.TIME_OUT:this.resetTrueXStatus();break;case t.CREDIT:this.trueXStatus.discardBreakOnComplete=!0}this.stuckAdCheckDisabled=this.trueXStatus.choicePending||this.trueXStatus.inProgress},resetTrueXStatus:function(){this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1}},assembleAdPodInfo:function(t){var e=this.getAdPodInfo(t),i=e.podIndex;if(this.currAdPod=this.APM.getAdPodById(0===i?"pre":-1===i?"post":"mid_"+i),void 0===this.currAdPod)return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA: currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(t)}),adCallUrl:this.adCallUrl},this.vidContId),!1;t=this.currAdPod;return t.adCount=e.totalAds,t.podDuration=e.maxDuration,t.isBumper=e.isBumper,t.imaPodIndex=e.podIndex,t.timeOffset=e.timeOffset,t.totalAds=e.totalAds,t.imaAdPostion=e.adPosition,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Ad Pod encountered; podIdx = ",i,this.currAdPod),!0},getAdPodInfo:function(t,e){t=t.getAdPodInfo(),e=e||{};return e.adPosition=t.getAdPosition(),e.isBumper=t.getIsBumper(),e.maxDuration=t.getMaxDuration(),e.podIndex=t.getPodIndex(),e.timeOffset=t.getTimeOffset(),e.totalAds=t.getTotalAds(),e},assembleAdInfo:function(t){return{adId:t.getAdId(),adPodInfo:this.getAdPodInfo(t),adSystem:t.getAdSystem(),advertiserName:t.getAdvertiserName(),apiFramework:t.getApiFramework(),contentType:t.getContentType(),creativeAdId:t.getCreativeAdId(),creativeId:t.getCreativeId(),dealId:t.getDealId(),description:t.getDescription(),duration:t.getDuration(),height:t.getHeight(),mediaUrl:t.getMediaUrl(),minSuggestedDuration:t.getMinSuggestedDuration(),skipTimeOffset:t.getSkipTimeOffset(),surveyUrl:t.getSurveyUrl(),title:t.getTitle(),traffickingParams:t.getTraffickingParameters(),traffickingParametersString:t.getTraffickingParametersString(),uiElements:t.getUiElements(),universalAdIdRegistry:t.getUniversalAdIdRegistry(),universalAdIdValue:t.getUniversalAdIdValue(),vastMediaHeight:t.getVastMediaHeight(),vastMediaWidth:t.getVastMediaWidth(),vastMediaBitrate:t.getVastMediaBitrate(),width:t.getWidth(),wrapperAdIds:t.getWrapperAdIds(),wrapperAdSystems:t.getWrapperAdSystems(),wrapperCreativeIds:t.getWrapperCreativeIds(),isLinear:t.isLinear()}},onAdEvent:function(t){var e=t.getAdData(),i=t.getAd(),s=google.ima.AdEvent.Type;if(t.type!==s.INTERACTION){if(!this.trueXStatus.choicePending)switch(!0===this.cviModel.isCurrVideoAd&&this.trackAdEvent(t.type),t.type){case s.LOADED:if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",i),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(t)}),!this.adPodInProgress){if(!this.assembleAdPodInfo(i))return void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.adPodInProgress=!0,(this.APM.isMidRoll(this.currAdPod)||0<this.dynamicMidRollPodCount)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}this._populateAdVideoState(i,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this._dispatchAdLoaded(this.assembleAdInfo(i));break;case s.STARTED:var n=i.getContentType();this.ad=i,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=i.getDuration(),this._populateAdVideoState(i,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(t)}),this.cviModel.mergeCDOData(),"application/javascript"!==n&&"application/x-shockwave-flash"!==n||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===n&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(i),this.trackAdEvent(s.STARTED),(n=i.getAdPodInfo())&&(a=n.getTotalAds()),this._dispatchAdStart(a),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case s.AD_BUFFERING:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.AD_BUFFERING"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BUFFERING,{},this.vidContId);break;case s.FIRST_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case s.MIDPOINT:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case s.THIRD_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case s.COMPLETE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd(),this.trueXStatus.discardBreakOnComplete&&(this.resetTrueXStatus(),this.adsManager.discardAdBreak());break;case s.ALL_ADS_COMPLETED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||o.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case s.CLICK:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),(r=this.cviModel.getAdVideoState()).paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:r},this.vidContId);break;case s.PAUSED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case s.RESUMED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case s.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case s.SKIPPED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,r=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:r,adCallUrl:this.adCallUrl},this.vidContId),uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case s.LOG:var r,n=e&&e.adError,a=(uvpjs.ErrorInfo,null===i);this.eventsMgr.eventTypes.AD_ERROR,!n&&a?(r=this.cviModel.getSessionOption("adBlockerCallback"))&&"function"==typeof r&&r()&&this.dispatchAdBlockedEvent():this.dispatchAdErrorEvent(n,i,"Unknown error - IMA.AdEvent.Type.LOG "),this.checkForAdBlocker(),a&&!n&&-1<this.savedSeekToTime&&this.resumeContentPlay();break;case s.VOLUME_CHANGED:this._dispatchAdVolumeChange();break;default:return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",s))}}else this.processInteractionEvent(e)},_populateAdVideoState:function(t,e){var i,s;if(o.isObject(t)){if(s=uvpjs.adUtil.extractAdStateData(t,uvpjs.adUtil.context.IMA),e)for(i in e)s[i]=e[i];this.cviModel.setAdVideoState(s),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())}else this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN")},_requestAdsManager:function(t){var e=this.cviModel;if(this.checkForAdBlocker(),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",t),this.adStartEventReceived=!1,this.adCallUrl=t,uvpjs.util.isEmpty(this.adsLoader))return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.resumeContentPlay();var i=new google.ima.AdsRequest;i.adTagUrl=t,this._updateAdSize(),i.linearAdSlotWidth=this.containerWidth,i.linearAdSlotHeight=this.containerHeight,i.nonLinearAdSlotWidth=this.containerWidth,i.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof i.setAdWillAutoPlay&&(i.setAdWillAutoPlay(e.isAutoplay),i.setAdWillPlayMuted(e.isMuteAtPlayStart&&!e.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(i)},onAdsManagerLoaded:function(t){var e,i=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,s=uvpjs.util;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",t),this._dispatchAdResponse(),s.isEmpty(this.RPM)||s.isEmpty(this.RPM.currRP)||s.isEmpty(this.cviModel))return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),void(null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null));this.renderSettings=new google.ima.AdsRenderingSettings;var s=this.renderSettings;s.bitrate=this.getAdPlaybackBitrate(),s.restoreCustomPlaybackStateOnAdBreakComplete=!1,s.enablePreloading=!1,s.loadVideoTimeout=this._returnIMATimeout(),s=this.adsManager=t.getAdsManager(i,s),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",s.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",s.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",s.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(e=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",e)),this.imaCuePoints=this.adsManager.getCuePoints(),o.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,e,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",e),this.APM.initialize(this.vidContId,e,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),e=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,e),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds()},getAdPlaybackBitrate:function(){var t=this.cviModel.contentPlaybackState.facadeState.currentBitrate,e=900;return e=!uvpjs.util.isEmpty(t)&&0<t?Math.min(t/1e3,this.AD_BITRATE_THRESHOLD):e},startAds:function(){var e,i,s=null,n=null;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(t){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),e=(i=uvpjs.ErrorInfo).messages.NO_AD_CONTENT,t&&"function"==typeof t.getMessage&&(e+=": "+t.getMessage(),s=t.getErrorCode(),n=t.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new i({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:i.errorCodes.IMA_AD_ERROR,message:e,imaErrorCode:s,imaVastErrorCode:n,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoTag:function(){return this.adsManager&&this.adsManager.isCustomPlaybackUsed()},_onContentPauseRequested:function(){var t,e;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),o.isEmpty(this.facade)||(e=this.cviModel.contentVideoState.isLive,(t=this.imaUsesContentVideoTag())||this.facade.hideVideo(),e&&!t?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),t&&(this.savedSeekToTime=e?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!o.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners())),o.isEmpty(this.APM)||!this.APM.isPostRoll(this.currAdPod)){if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),!this.adStartEventReceived)return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),o.isEmpty(this.facade))this.debug&&uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!o.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),-1<this.savedSeekToTime){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}}else this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN")},facadePlaybackStateChange:function(t){this.seekPending&&t===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(t)},_updateIMAPlaybackState:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",t),t!==this.playbackState&&(this.playbackState=t,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(t){var e=this.cviModel.getAdVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:t||1,adData:e,isDynamicAdCall:this.dynamicAdSessionInProgress,currAdPod:this.currAdPod,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(t){var e;this.uvpjsAdStartOpened&&((e=this.cviModel.getAdVideoState()).skipped=!0===t,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:e,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(t){var e="function"==typeof t.getAdData?t.getAdData():{},t="function"==typeof t.getAd?t.getAd():{};return("function"==typeof t.getMediaUrl?t.getMediaUrl():e.mediaUrl)||null},_dispatchAdLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl,adData:this.cviModel.getAdVideoState(),imaAdData:t},this.vidContId)},_dispatchAdRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},_dispatchAdVolumeChange:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdVolumeChange dispatch AD_VOLUME_CHANGE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_VOLUME_CHANGE,{volume:this.adsManager.getVolume()},this.vidContId)},handleAdPodEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(t,e){t&&(this.containerWidth=t),e&&(this.containerHeight=e),this.mc.isChromecast()||(t=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),e=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),t===this.containerWidth&&e===this.containerHeight||(this.containerWidth=t,this.containerHeight=e,this.adsManager&&(e=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,e))))},_updateCurrentAdTime:function(){var t;this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY&&(t=this.adsManager.getRemainingTime(),this._checkForStuckAd(t)?this.adsManager.discardAdBreak():(this.currImaAdTime=Math.floor(this.duration-t),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime})))},_checkForStuckAd:function(t){if(this.stuckAdCheckDisabled)return!1;if(null===this.previousRemainingTime)return this.previousRemainingTime=t,!1;var e=this.previousRemainingTime-t;if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+e),0==e?(this.stuckIntervals++,this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals!==this.STUCK_AD_NUM_INTERVALS)return this.previousRemainingTime=t,!1;e="Ad playback stuck for "+this.stuckIntervals+" intervals.",t=new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:e,isFatal:!1,adInfo:this.extractAdInfo(this.ad)});return this.debug&&uvpjs.error(this.STUCK_AD_DEBUG_ID,e,t),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:t,adCallUrl:this.adCallUrl},this.vidContId),!0},_startRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(t){var e=t&&t.getAd&&t.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(t.getError(),e),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(t){this.dispatchAdErrorEvent(t.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(t){return uvpjs.adUtil.extractAdInfo(t,uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(t,e,i){var s,n=null,r=null,a=null,o=uvpjs.ErrorInfo,d=uvpjs.util.isFunction;t&&d(t.getMessage)&&(n=t.getMessage(),n+=" imaErrorCode: "+(r=t.getErrorCode()||"n/a")+"; vastErrorCode: "+(a=t.getVastErrorCode()||"n/a")),t&&d(t.getInnerError)&&(s=t.getInnerError())&&(n||(n=""),n+=" Inner error: "+(d(s.getMessage)?s.getMessage():s.message||"n/a")+"; inner error code: "+(d(s.getErrorCode)?s.getErrorCode():"n/a")),this.debug&&uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+n),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new o({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:o.errorCodes.IMA_AD_ERROR,message:o.messages.IMA_AD_ERROR_EVENT_RECEIVED+((n=i?i+" "+n:n)||" Unspecified IMA ad error."),isFatal:!1,imaErrorCode:r,imaVastErrorCode:a,adInfo:this.extractAdInfo(e)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),o.isEmpty(this.facade))return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA();this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),this.facade.playVideo()},cleanUpRP_IMA:function(){var t;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),this.isRP_IMACleanedUp||(t=this.rco.rcoSeed,this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(t))},_cleanUpContentVideoFacade:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),this.destroyFacade()},loadDynamicAdCall:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",t),null===this.adsManager?(this.dynamicMidRollPodCount++,t=uvpjs.adUtil.populateImaAdCallValues(t,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=t,this._requestAdsManager(t)):this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call")},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),o.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(t)))},onPlayVideo:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),o.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(t)))},onVideoSeekTo:function(t){var e,i=this.cviModel.contentPlaybackState.currentTime;return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",t),t.target!==this.vidContId||o.isEmpty(this.facade)||!this.canSeek(t&&t.payload)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN")):o.isEmpty(this.APM)||!this.APM.hasMidRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(t)):(e=t.payload.seekTime,this._seekFromTime=i,i=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(e):e,e=this.APM.returnPrecedingUnplayedAdPod(i),void(o.isEmpty(e)||e.hasPlayed?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(t)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",e.startTime),this.savedSeekToTime=i,e.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=e.startTime)))},canSeek:function(t){return void 0!==t.seekTime&&null!==t.seekTime&&0<=t.seekTime&&t.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(t){return t},onChangeVideoVolume:function(t){o.has(t,"target")&&t.target===this.vidContId&&!this.cviModel.isMuted&&0<=t.payload.vol&&t.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(t.payload.vol):this._super(t))},onMuteVideo:function(t){o.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},onUnMuteVideo:function(t){o.has(t,"target")&&t.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(t)))},_createBoundAdEventHandlers:function(){this._onContentPauseRequested=this._onContentPauseRequested.bind(this),this._onContentResumeRequested=this._onContentResumeRequested.bind(this),this.onAdError=this.onAdError.bind(this),this.onAdEvent=this.onAdEvent.bind(this)},_addAdsManagerEventListeners:function(){var t,e=this.adsManager,i=google.ima.AdEvent.Type;this._createBoundAdEventHandlers(),t=this.onAdEvent,e.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.addEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.addEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.addEventListener(i.LOADED,t),e.addEventListener(i.STARTED,t),e.addEventListener(i.AD_BUFFERING,t),e.addEventListener(i.FIRST_QUARTILE,t),e.addEventListener(i.MIDPOINT,t),e.addEventListener(i.THIRD_QUARTILE,t),e.addEventListener(i.COMPLETE,t),e.addEventListener(i.ALL_ADS_COMPLETED,t),e.addEventListener(i.CLICK,t),e.addEventListener(i.PAUSED,t),e.addEventListener(i.RESUMED,t),e.addEventListener(i.USER_CLOSE,t),e.addEventListener(i.SKIPPED,t),e.addEventListener(i.LOG,t),e.addEventListener(i.VOLUME_CHANGED,t),e.addEventListener(i.VOLUME_MUTED,t),e.addEventListener(i.INTERACTION,t)},_removeAdsManagerEventListeners:function(){var t=this.onAdEvent,e=this.adsManager,i=google.ima.AdEvent.Type;e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),e.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),e.removeEventListener(i.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),e.removeEventListener(i.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),e.removeEventListener(i.LOADED,t),e.removeEventListener(i.STARTED,t),e.removeEventListener(i.AD_BUFFERING,t),e.removeEventListener(i.FIRST_QUARTILE,t),e.removeEventListener(i.MIDPOINT,t),e.removeEventListener(i.THIRD_QUARTILE,t),e.removeEventListener(i.COMPLETE,t),e.removeEventListener(i.ALL_ADS_COMPLETED,t),e.removeEventListener(i.CLICK,t),e.removeEventListener(i.PAUSED,t),e.removeEventListener(i.RESUMED,t),e.removeEventListener(i.USER_CLOSE,t),e.removeEventListener(i.SKIPPED,t),e.removeEventListener(i.LOG,t),e.removeEventListener(i.VOLUME_CHANGED,t),e.removeEventListener(i.VOLUME_MUTED,t))},onUVPJSTimerTick:function(){var t,e,i=uvpjs.util,s=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,n=!i.isEmpty(this.adsManager),r=!i.isEmpty(this.facade);if(!n||(i=this.getAdPlaybackBitrate())!==this.renderSettings.bitrate&&(this.renderSettings.bitrate=i,this.adsManager.updateAdsRenderingSettings(this.renderSettings)),s&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,-1<this.contentPlayheadTracker.pendingSeekTime?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:r?(e=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=e):this.contentPlayheadTracker.currentTime=0),!this.adPodInProgress)return s=(n=n&&s&&(this.cviModel.sessionOptions.adBlockerCallback||null))&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),n&&(t=(new Date).getTime())&&(this.lastAdBlockCheckTime<t||s)&&(this.lastAdBlockCheckTime=t+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),void this._super();this.id3HandlingEnabled&&r&&this.checkId3Events(e),this.playbackState===this.mc.PLAYING&&(e=this.createAdVideoProgressPayload(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,e,this.vidContId))},_checkForCloseToMidrollPod:function(t){var e,i,s,n=this.APM.getMidRollPods();if(t<=0)return!1;for(e=n.length;e--;)if(0<(i=(s=n[e]).startTime-t)&&i<1&&!s.hasPlayed&&!s.hasBeenChecked)return s.hasBeenChecked=!0;return!1},createAdVideoProgressPayload:function(){return{isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}}},_determineIMAScenario:function(t){var e=uvpjs.util,i=this._getAssetUrl(t),s=e.isDefinedString(t.pid),n=e.isDefinedString(t.cmsRefGuid),r=e.isDefinedString(t.selectorCall),a=e.isDefinedString(t.assetURL);return s||n&&!a||r?this.PLATFORM:e.isDefinedString(i)?this.CONTENT_AND_AD_CALL:e.isDefinedString(t.adCall)?this.AD_CALL_ONLY:(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var t=uvpjs.adUtil.checkForAdBlocker(this.cviModel);return t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),t},_checkForContentPreload:function(){var t=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,e=this.adsManager.isCustomPlaybackUsed(),e=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!e;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&t&&5<this.duration&&e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var t=-1,e=this.cviModel.getModule(this.AD_SETTINGS),e=e&&e.enabled&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return e&&(t=0<(t=parseInt(e))?1e3*t:-1),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+t),t},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(uvpjs.register("uvpjs")),function(t){"use strict";var a,o=(t._,["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"]),d=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"];t.DaiResourceProvider=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(t){this.debug=uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this.pendingSeekTime=null,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,e,i){var s=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+i),n=s.getElementsByTagName("video")[0];a=a||google.ima.dai.api,this.debug&&this.log("DAI RP init'ing, IMA version = "+google.ima.VERSION),this.streamManager=new a.StreamManager(n),this.adClickElement=this.createAdClickElement(n),this.streamManager.setClickElement(this.adClickElement),this._super(t,e,i),this.resetAdStates(),this.contentVideoDiv=s,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(t,e){var i=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(i)?this._super(t,e):(this.dataLoadedCB=t,this.onDataProxyComplete())},onDataProxyComplete:function(){var t=this.contentDataProxy.getProperty("cmsRefGuid");uvpjs.util.isEmpty(t)||this.rco.getVideoId()||this.rco.setCmsRefGuid(t),this._super()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel,s=this.contentDataProxy.getModel();if(this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),i.setNonDefaultContentVideoStateItems(s),i.setContentVideoStateItems(e),i.mergeCDOData(),this.killDataProxy(),!(i=this.assembleResourceDefinition()))return this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0);this.cviMgr.setPlaybackInfoOnModel(),this.requestStream(i)},requestStream:function(t){var e=!uvpjs.util.isEmpty(t.assetKey),i=new(e?a.LiveStreamRequest:a.VODStreamRequest);i.apiKey=t.apiKey||null,i.adTagParameters=t.adTagParameters,e?(i.assetKey=t.assetKey,i.attemptPreroll=!0,this.isLiveStream=!0,this.id3HandlingEnabled=!0):(i.contentSourceId=t.contentSourceId,i.videoId=t.videoId),this.streamManager.requestStream(i)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(t){t=t.getStreamData().url;if(!uvpjs.util.isDefinedString(t))return this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),void this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=t,this.cviModel.contentVideoState.isLive=this.isLiveStream,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo())},hStreamInitialized:function(t){this.daiStreamId=t.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(t){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(t){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null,this.pendingSeekTime&&(this._hasFacade()&&this.facade.seekTo(this.pendingSeekTime),this.pendingSeekTime=null)},hCuePointsChanged:function(t){this.currAdPod=this.getNewPod(t.getStreamData().cuepoints)},hAdStarted:function(t){var e=t.getAd();this.resetAdStates(),!this.currAdPod&&this.isLiveStream&&(this.currAdPod={played:!0}),this.updateAdModel(e),this.currAd=e,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.trackAdEvent(t.type),this.dispatchAdPodStart()),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(t){var e,i=t.type,s=a.StreamEvent.Type,n=null;switch(i){case s.FIRST_QUARTILE:n=25;break;case s.MIDPOINT:n=50;break;case s.THIRD_QUARTILE:n=75;break;case s.AD_PROGRESS:(e=(e=(e=t.getStreamData())&&e.adProgressData)&&this.createAdProgressPayload(e))&&this.dispatchVideoProgress(e)}n&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=n,this.dispatchAdQuartile(n))},hStreamError:function(t){t=t.getStreamData(),t=t&&t.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+t,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,t||"Unknown DAI stream error.",uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(t){},hStreamEvent:function(t){this.isAdPlaying()&&this.trackAdEvent(t.type),this[this.hMap[t.type]](t)},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.facade,r=this._hasFacade(),t=n.getDuration(),i=this.facade.getCurrentTime();"number"==typeof s&&e===this.vidContId&&((s=this.streamManager.streamTimeForContentTime(s))<0||t<s?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s):((t=this.getSkippedPod(s))&&(this.pendingSeekTime=s,s=t.startTime-1),this._seekFromTime=this._seekFromTime||i,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),r&&n.seekTo(s)))},getSkippedPod:function(t){var e,i,s,n=[];for(e in this.adPods)n.push(this.adPods[e].startTime);for(n.sort(function(t,e){return t-e}),i=n.length;i--;)if((s=n[i])<t)return(s=this.adPods["t_"+s]).hasPlayed?null:s;return null},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodEnd:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_LOADED,{adData:t}),this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,s){this.dispatch(t,{errorInfo:new uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:!0===s,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(t){var e,i,s=null,n=t&&t.length;for(n&&!this.adPods&&this.createAdPods(t);n--;)e=t[n],i=this.adPods["t_"+e.start],s||i.hasPlayed===e.played||(s=i),i.hasPlayed=e.played;return s},createAdPods:function(t){var e,i,s,n,r,a=0,o=[],d=t.length;for(this.adPods={},i=0;i<d;i++)e=t[i],r=i,s=1<d&&r===d-1?"post":0===r?"pre":"mid",n=e.start,o.push(n),this.adPods["t_"+n]={startTime:n,hasPlayed:!1,adPodId:s+("mid"==s?"_"+a++:"_0"),adCount:0,podDuration:e.end-n};this.cviModel.contentVideoState.chapterStartTimes=o},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(t){var e=t.getAdPodInfo();this.populateAdVideoState(t),e&&this.currAdPod&&(this.currAdPod.adCount=e.getTotalAds(),this.currAdPod.podDuration=e.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(t){t=uvpjs.adUtil.extractAdStateData(t,uvpjs.adUtil.context.DAI,this.isLiveStream);t.adBitrate=this.cviModel.getContentPlaybackState().facadeState.currentBitrate,this.cviModel.setAdVideoState(t)},createAdProgressPayload:function(t){var e=this.getVideoProgressPayload(),i=t.currentTime;return e.isAd=!0,e.duration=t.duration,e.currentTime=i,e.absoluteStreamTime=this.facade.getCurrentTime(),e.lastSecondCompleted=Math.floor(i),e.lastPercentageCompleted=this.currAdPercentComplete,e},extractAdInfo:function(t){return uvpjs.adUtil.extractAdInfo(t,uvpjs.adUtil.context.DAI)},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(t){this.adTrackingHandle&&t!=a.StreamEvent.Type.AD_PROGRESS&&this.facade&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:t,context:uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||this.isLiveStream||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var t,e;this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying()&&(e=this.facade.getCurrentTime(),this.checkForAdBlocker(e,!1),t=this.streamManager.contentTimeForStreamTime(e),!this.contentStartOpen&&(0<t||this.isLiveStream)&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(t),e=this.createVideoProgressPayload(t,e),this.dispatchVideoProgress(e))},createVideoProgressPayload:function(t,e){var i=this.getVideoProgressPayload();return i.currentTime=t,i.absoluteStreamTime=e,i.duration=this.contentDuration||-1,i},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(t,e){var i=t-this.lastAdBlockCheckTime>this.adBlockCheckInterval,e=e||i,i=e&&uvpjs.adUtil.checkForAdBlocker(this.cviModel);return e&&(this.lastAdBlockCheckTime=t),i&&(this.debug&&uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!i},assembleResourceDefinition:function(){var t=this.rco.getAdTagParameters(),e=this.rco.getVideoId(),i=this.rco.getContentSourceId(),s=this.rco.getAssetKey();return s&&t||t&&e&&i?{adTagParameters:t,videoId:e||null,contentSourceId:i||null,assetKey:s||null}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(t){for(var e,i="add"===t?"addEventListener":"removeEventListener",s="addEventListener"==i,n=a.StreamEvent.Type,r=o.length;r--;)e=n[o[r]],s&&(this.hMap[e]=d[r]),s||delete this.hMap[e],this.streamManager[i](e,this.hStreamEvent)},createAdClickElement:function(t){var e,i,s,n=t.nextSibling;if(n&&"uvpjsDaiContainer"===n.getAttribute("data-role"))return n;for(i in(n=document.createElement("div")).setAttribute("data-role","uvpjsDaiContainer"),s=n.style,e={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1})s[i]=e[i];return t.insertAdjacentElement("afterend",n),n},onPauseVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onPlayVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onChangeVideoVolume:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.vol,n=uvpjs.util.inRange(s,0,1),i=this.cviModel.isMuted;e===this.vidContId&&n&&!i&&this._hasFacade()&&(this.facade.setVolume(s),this.isAdPlaying()&&this.trackAdEvent(t.type))},onMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},onUnMuteVideo:function(t){(t&&t.target)===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying()&&this.trackAdEvent(t.type))},facadeId3Data:function(t){var e;this.streamManager&&(e=function(t){this.streamManager.processMetadata("ID3",t.data,t.pts)}.bind(this),t&&t.forEach(e))},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){this.contentDuration=this.streamManager.contentTimeForStreamTime(t.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},showAdClickEl:function(t){this.adClickElement&&(this.adClickElement.style.display=!1!==t?"block":"none")},log:function(t,e,i){uvpjs[i||"log"](this.DEBUG_ID,t,e||"")}})}(uvpjs.register("uvpjs")),function(t){"use strict";var i={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};t.DaiSsbResourceProvider=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(t){this.debug=uvpjs.debug,this.isLiveStream=!1,this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(t),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(t,e,i){this._super(t,e,i),this.contentVideoDiv=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+i),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(t){t()},loadVideoAndBeginPlayback:function(t){var e=this.rco,i=this.cviModel;this.suppressFacadePlayOnLoad=!0===t,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),i.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),i.setContentVideoStateItems(e),i.mergeCDOData(),this.killDataProxy(),this.contentDuration=i.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),(i=this.assembleAssetUrl(e))?(this.cviModel.contentVideoState.assetURL=i,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(e.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),this.suppressFacadePlayOnLoad||this.facade.playVideo()):this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0)},assembleAssetUrl:function(t){var e=t.assetURL,i=uvpjs.util;return i.isEmpty(e)?null:-1<e.indexOf("?")?e:(t=(t=t.getAdTagParameters())?i.queryStrFromObj(t):null,i.isEmpty(t)?e:e+"?"+t)},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(t){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(t),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispatch:function(t,e){this.eventsMgr.dispatchEvent(t,e,this.vidContId)},dispatchContentDataLoaded:function(){var t=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:t})},dispatchAdPodStart:function(t){t=this.getPrerollPod(t);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:t})},dispatchAdPodEnd:function(){var t=this.getPrerollPod();t.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:t})},dispatchAdStart:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:t})},dispatchAdEnd:function(){var t=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:t})},dispatchAdQuartile:function(t){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:t})},dispatchVideoProgress:function(t){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,t)},dispatchError:function(t,e,i,s){this.dispatch(t,{errorInfo:new uvpjs.ErrorInfo({eventType:t,errorCode:i,message:e,isFatal:!0===s,adInfo:null})})},getPrerollPod:function(t){return this.adPod||(this.adPod={startTime:t,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var t=this.cviModel;t.resetAdPlaybackState(),t.resetAdVideoState(),t.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var t=uvpjs.adUtil.getAdStateBlank();t.adServerName="dai_ssb",t.duration=this.getPrerollAdDuration(),t.adClipID="pre_0",t.adPosition=1,t.adType="pre",this.cviModel.setAdVideoState(t)},getPrerollAdDuration:function(){var t=this.getAbsoluteDuration();return 0<t&&0<this.contentDuration?t-this.contentDuration:-1},getAbsoluteDuration:function(){return this.absoluteDuration||(this.absoluteDuration=this.facade.getDuration()),this.absoluteDuration},createAdProgressPayload:function(){var t,e,i=this.getVideoProgressPayload(),s=this.facade.getCurrentTime(),n=this.getPrerollAdDuration(),r=Math.floor(s/n*100);switch(r){case 25:t=this.quartiles[25],e=25;break;case 50:t=this.quartiles[50],e=50;break;case 75:t=this.quartiles[75],e=75}return e&&!t&&this.dispatchAdQuartile(e),e&&(this.quartiles[String(e)]=1),i.isAd=!0,i.duration=n,i.currentTime=s,i.absoluteStreamTime=this.facade.getCurrentTime(),i.lastSecondCompleted=Math.floor(s),i.lastPercentageCompleted=r,i},startContent:function(){this.contentStartOpen||(this.contentStartOpen=!0,this.dispatchContentStart())},onUVPJSTimerTick:function(){var t=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,e=this.isAdPlaying(),i=this.contentStartOpen,s=t&&this.facade.getCurrentTime();t&&(t=e?this.createAdProgressPayload():i?this.createVideoProgressPayload():null,1<s&&!i&&!e&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+s),this.contentStartTime=s,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(s),t&&this.dispatchVideoProgress(t))},createVideoProgressPayload:function(){var t=this.getVideoProgressPayload(),e=this.facade.getCurrentTime(),i=e-this.contentStartTime;return t.currentTime=i,t.absoluteStreamTime=e,t.duration=this.contentDuration||-1,t},checkBuffering:function(t){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(t){var e=t&&t.target,i=t&&t.payload,s=i&&i.seekTime,n=this.facade,r=this._hasFacade(),a=r&&(this.absoluteDuration||n.getDuration()),t=this.getPrerollAdDuration(),i=this.facade.getCurrentTime();"number"==typeof s&&e===this.vidContId&&a&&((s+=0<t?t:0)<0||a<s?this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+s):(this._seekFromTime=this._seekFromTime||i,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:s,seekFromTime:this._seekFromTime},null,2)),r&&n.seekTo(s)))},facadeProgress:function(t){},facadeTimeUpdate:function(t){},facadeDurationChanged:function(t){this.absoluteDuration||(this.absoluteDuration=t.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.hCueChange=this.hCueChange.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){var t=this.vidEl.textTracks;t.removeEventListener("addtrack",this.hAddTextTrack,!1);for(var e=0,i=t.length;e<i;e++)t[e].removeEventListener("cuechange",this.hCueChange,!1)},hAddTextTrack:function(t){t.track&&"metadata"===t.track.kind&&(t.track.addEventListener("cuechange",this.hCueChange,!1),t.track.mode="hidden")},hCueChange:function(t){t.target&&t.target.activeCues&&1==t.target.activeCues.length&&this.handleId3Cue(t.target.activeCues[0])},handleId3Cue:function(t){var e=t.value;"TXXX"===e.key&&(e=""!==e.info?e.info:e.data,(e=i[e])&&this[e](t.startTime))},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},log:function(t,e,i){uvpjs[i||"log"](this.DEBUG_ID,t,e||"")}})}(uvpjs.register("uvpjs")),function(t){"use strict";t.P2pClient=uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var t=uvpjs.P2pClient.clientMap[this.clientName];return t&&t.getHlsjsLoader&&(t.getHlsjsLoader()||null)}}),t.P2pClient.debugId=uvpjs.DebugManager.configParams.P2P_CLIENT,t.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLoad:function(){return null!==this.getHlsjsLoader()},getHlsjsLoader:function(){return window.peer5&&window.peer5.HlsJsLoader||null},getApi:function(){return window.peer5},loadScripts:function(t,e){var i;this.getHlsjsLoader()?t():e.apiKey?(i=this.loadHlsLoader.bind(this,t),uvpjs.VideoDeliveryPluginService.load(this.sdkPath+e.apiKey,i,2e3)):t(!0)},loadHlsLoader:function(t,e){if(e)return uvpjs.debug&&uvpjs.log(uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",e),void t(!0);uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,t,2e3)}}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.MultiCdnClient=uvpjs.Class.subClass({init:function(t){this.clientName=t.clientName||null,this.requiredParams=t.requiredParams||null,this.url=uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destroy:function(){this.decisionCallback=Function.prototype,this.requiredParams=null},getDecision:function(t){this.inFlight||(this.inFlight=!0,this.decisionCallback=t,this.timeoutHandle=setTimeout(this.abortOnTimeout.bind(this),2e3),(new uvpjs.CodeLoader).loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeout:function(){this.aborted=!0,this.decisionCallback(null)},handleDecision:function(t){clearTimeout(this.timeoutHandle),this.aborted||this.decisionCallback(t.response),this.reset()},handleError:function(){clearTimeout(this.timeoutHandle),this.aborted||this.decisionCallback(null),this.reset()},reset:function(){this.inFlight=!1,this.aborted=!1}}),t.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(t){return t&&t.customerId&&t.appId?this.decisionUrl.replace("{customerId}",t.customerId).replace("{appId}",t.appId):null},validateScriptLoad:function(){return!0},loadScripts:function(t){t()}}}}(uvpjs.register("uvpjs")),function(t){"use strict";t.VideoDeliveryPluginService=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(t,e){var i=uvpjs.VideoDeliveryPluginService.clientType;this.model=e,this.callback=t,this.staticSvc=uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(i.P2P),this.multiCdnClientOptions=this.getClientOptions(i.MULTI_CDN)},destroy:function(){this.model=null,this.callback=Function.prototype,this.p2pClientOptions=null,this.multiCdnClientOptions=null},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var t=null,e=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(t=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(e=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(t,e))},handleMcdnReady:function(t){var e=this.multiCdnClientOptions;!t&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,e.clientName)||(e.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+e.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var t=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,t.clientName,this.handleMcdnReady.bind(this),t.requiredParams)},handleP2pReady:function(t,e){var i=this.p2pClientOptions;!e&&this.validateScriptLoad(this.staticSvc.clientType.P2P,i.clientName)||(i.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+i.clientName)),t?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var t=this.p2pClientOptions,e=this.multiCdnClientOptions.canUse;t.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,t.clientName,this.handleP2pReady.bind(this,e),t.requiredParams):e?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(t,e,i,s){e=this.getClientObject(t,e);e||i(!0),e.loadScripts(i,s)},validateScriptLoad:function(t,e){e=this.getClientObject(t,e);return e&&e.validateScriptLoad()||!1},createClient:function(t,e){return new t(e)},getClientOptions:function(t){var e,i,s,n,r,a,o,d,l,u=this.model,h=this.getSupportedClients(t),c={canUse:!1,clientName:null};if(t===this.staticSvc.clientType.P2P&&!uvpjs.mediaCapabilities.canUseP2p())return c;for(e in h)if(i=e,s=h[i],(d=s&&s.uvpcModuleName)&&u.isModuleEnabled(d)){for(r=(n=s.requiredParams)&&n.length||0,o={},l=!0;r--;){if(a=u.getModuleParam(d,n[r]),uvpjs.util.isEmpty(a)){l=!1;break}o[n[r]]=a}return{canUse:l,clientName:i,requiredParams:o}}return c},getSupportedClients:function(t){var e,i,s={},n=t.clientMap;if(!n)return s;for(e in n)i=n[e],s[e]={uvpcModuleName:i.uvpcModuleName,requiredParams:i.requires};return s},getClientObject:function(t,e){return t.clientMap[e]||null}});t=t.VideoDeliveryPluginService;t.clientType={P2P:uvpjs.P2pClient,MULTI_CDN:uvpjs.MultiCdnClient},t.load=function(t,e,i){(new uvpjs.CodeLoader).loadScript(t,e,i)}}(uvpjs.register("uvpjs")),Z=uvpjs.register("uvpjs"),f="loadedmetadata",Z.FullscreenManager=uvpjs.Class.subClass({init:function(t){var e=uvpjs.util,i=t||{},t=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,i.videoElement&&i.container?(this.videoEl=i.videoElement,this.container=i.container,this.fullscreenChangeCallback=e.isFunction(i.fullscreenChangeCallback)&&i.fullscreenChangeCallback,this.readyCallback=e.isFunction(i.readyCallback)&&i.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=t.getEnterFullscreenMethodName(),this.exitMethod=t.getExitFullscreenMethodName(),this.fsElementName=t.getFullScreenElementName(),this.isFullscreenProperty=t.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),this.initialize()):uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.")},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailable:function(){return uvpjs.mediaCapabilities.isFullscreenAvailable(this.videoEl)},isFullscreen:function(){return!!(this.hasFsApiSupport?document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(t){var e=this.isFullscreen();t.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(e)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener(f,this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var t=document[this.exitMethod]?document:this.videoEl[this.exitMethod]?this.videoEl:null;return t&&uvpjs.util.isFunction(t[this.exitMethod])?t:null},validateEntryAndExitMethods:function(){var t=this.fsElement&&this.fsElement[this.enterMethod],e=this.exitScope&&this.exitScope[this.exitMethod],i=uvpjs.util;this.hasValidEntryMethod=i.isFunction(t),this.hasValidExitMethod=i.isFunction(e)},initialize:function(){var t,e=uvpjs.mediaCapabilities;this.hasFsApiSupport=e.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(t=e.getFullscreenEventName(),(e.isFirefox()||e.isIE()?document:this.container).addEventListener(t,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,t=e.getFullscreenEnterEventName(),e=e.getFullscreenExitEventName(),this.fsElement.addEventListener(t,this.hFullScreenEvent,!1),this.fsElement.addEventListener(e,this.hFullScreenEvent,!1),this.enterEvt=t,this.exitEvt=e),this.validateEntryAndExitMethods(),this.hasValidEntryMethod?(this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener(f,this.hMetadataLoaded,!1),this.debug&&uvpjs.log("Fullscreen management init'd; info: ",this.getInfo())):this.debug&&uvpjs.log("Fullscreen determined not available",this.getInfo())}}),Z.FullscreenManager.hasFullscreenSupport=function(){return!!uvpjs.mediaCapabilities.getEnterFullscreenMethodName()},function(t){"use strict";var i,s,n,r,E=t._;t.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"lib/css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]}],diagnosticMenuCfg:{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.vci=t.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=t.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._ccEnabledByUser=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this.isAndroidOnHlsjs=this.mc.canPlayHlsjsAndriod(this.vci.CVI_Mgr.cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this.controlsVisible=!1,this.ignoreVideoStateChange=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(t.skinConfig)},destroy:function(){function t(){}this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=t,this._replayCB=t,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(t){var e=uvpjs.util,i=uvpjs.Configuration.hostname+uvpjs.Configuration.path,s=this._containerId,n=t.customCSS;this._namespace="."+s+".skin",this._autoPlay=t.isMutedAutoplay||t.isUnmutedAutoplay,this._isMutedAutoplay=t.isMutedAutoplay,this._previewImage=t.previewImage,this._enableReplay=t.enableReplay,this._themeName=t.themeName,this._controls=t.controls,this._template=t.template,this._canFullscreen=uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=e.isDefinedString(n)&&n||i+this.DEFAULT_SKIN_PATH,this.vci.usesDiagnosticWindow()&&this.settingsMenu.push(this.diagnosticMenuCfg),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(t)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},setPlaystate:function(t){this._playbackState=t,this._updatePlaybackStateUI(this._playbackState)},disableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",t),E.includes(this._disabledButtons,t)||this._disabledButtons.push(t),this._disableButton(t)},enableButton:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",t),E.pull(this._disabledButtons,t),this._enableButton(t)},_handleFullscreenMgrReady:function(t){t&&this._enableButton(this.css.FULLSCREEN_BTN)},_handleFullscreenChange:function(t){var e=this.fullscreenMgr.usesFullscreenApi();this._hide(this.css.VOLUME_SLIDER),t?(this.vci.fullscreen(!0),e&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!0)):(this.vci.fullscreen(!1),e&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!1,!0))},_disableButton:function(t){var e=this._queryByElementName(t);this.debug&&uvpjs.log(this.DEBUG_ID,"_disableButton",t),this._disable(t),e&&e.setAttribute("disabled","disabled")},_enableButton:function(t){var e=this._queryByElementName(t);this.debug&&uvpjs.log(this.DEBUG_ID,"_enableButton",t),E.includes(this._disabledButtons,t)||(this._enable(t),e&&e.removeAttribute("disabled"))},_addUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=uvpjs.EventType;t.addEventListener(i.AD_START+e,this._onAdStart.bind(this)),t.addEventListener(i.AD_END+e,this._onAdEnd.bind(this)),this._isIOS||t.addEventListener(i.CAPTIONS_READY+e,this._onCaptionsReady.bind(this)),t.addEventListener(i.CONTENT_START+e,this._onContentStart.bind(this)),t.addEventListener(i.CONTENT_END+e,this._onContentEnd.bind(this)),t.addEventListener(i.VIDEO_PROGRESS+e,this._onVideoProgress.bind(this)),t.addEventListener(i.VIDEO_STATE_CHANGE+e,this._onVideoStateChange.bind(this)),t.addEventListener(i.VIDEO_LOADING+e,this._onVideoLoading.bind(this)),t.addEventListener(i.CONTROL_MUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.CONTROL_UNMUTE+e,this._onControlMuteUnmute.bind(this)),t.addEventListener(i.RESOURCE_START+e,this._onResourceStart.bind(this)),t.addEventListener(i.RESOURCE_END+e,this._onResourceEnd.bind(this)),t.addEventListener(i.CONTAINER_RESIZE+e,this._onUVPJSResize.bind(this)),t.addEventListener(i.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+e,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var t=this.vci,e=this._namespace,i=uvpjs.EventType;t&&t instanceof uvpjs.VideoControlInterface&&(t.removeEventListener(i.AD_START+e),t.removeEventListener(i.AD_END+e),this._isIOS||t.removeEventListener(i.CAPTIONS_READY+e),t.removeEventListener(i.CONTENT_START+e),t.removeEventListener(i.CONTENT_END+e),t.removeEventListener(i.VIDEO_PROGRESS+e),t.removeEventListener(i.VIDEO_STATE_CHANGE+e),t.removeEventListener(i.VIDEO_LOADING+e),t.removeEventListener(i.CONTROL_MUTE+e),t.removeEventListener(i.CONTROL_UNMUTE+e),t.removeEventListener(i.RESOURCE_END+e),t.removeEventListener(i.CONTAINER_RESIZE+e))},_addUIEventListeners:function(){for(var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this.css,s=this.shouldTrapTaps(),n=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],r=n.length;r--;)"_onClosedCaptionBtnClick"===n[r]&&this._isIOS||(this[n[r]]=this[n[r]].bind(this));var a=this._onUVPJSGestureEvent,o=this._hNonTap,d=this._onProgressSliderEvent,l=this._onVolumeSliderEvent,u=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",o),e.addEventListener("mouseenter",a,!0),e.addEventListener("mouseleave",a,!0),e.addEventListener("mousemove",a,!0),e.addEventListener("mousedown",a,!1),e.addEventListener("mouseup",a,!1),e.addEventListener("click",a,!1),e.addEventListener("touchstart",a,!0),e.addEventListener("touchend",a,!0),this._previewBtn=this._queryByElementName(i.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",o),this._isTouch||this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(i.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),this._isTouch||this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(i.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(i.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(i.PROGRESS_SLIDER),this._progressSlider.addEventListener(t,d,!1),this._progressSlider.addEventListener("mousedown",d,!1),this._progressSlider.addEventListener("mouseup",d,!1),this._progressSlider.addEventListener("touchstart",d,!0),this._progressSlider.addEventListener("touchend",d,!0),this._volumeSlider=this._queryByElementName(i.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(t,l,!1),this._volumeSlider.addEventListener("mouseover",l,!1),this._volumeSlider.addEventListener("mouseout",l,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(i.LARGE_PLAY_BTN),s||this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(i.PLAYSTATE_BTN),s||this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(i.VOLUME_BTN),s||this._volumeBtn.addEventListener("click",u,!1),this._volumeBtn.addEventListener("mouseover",u,!1),this._volumeBtn.addEventListener("mouseout",u,!1),this._isIOS||(this._ccBtn=this._queryByElementName(i.CLOSED_CAPTION_BTN),s||this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1)),this._settingsBtn=this._queryByElementName(i.SETTINGS_BTN),s||this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,i.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(i.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){var t=this.mc.isIE()?"change":"input",e=this._containerEl,i=this._hNonTap,s=this._onUVPJSGestureEvent,n=this._onProgressSliderEvent,r=this._onVolumeSliderEvent,a=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",i,!1),e.removeEventListener("mouseenter",s,!0),e.removeEventListener("mouseleave",s,!0),e.removeEventListener("mousemove",s,!0),e.removeEventListener("mousedown",s,!1),e.removeEventListener("mouseup",s,!1),e.removeEventListener("click",s,!1),e.removeEventListener("touchstart",s,!0),e.removeEventListener("touchend",s,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",i,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(t,n,!1),this._progressSlider.removeEventListener("mousedown",n,!1),this._progressSlider.removeEventListener("mouseup",n,!1),this._progressSlider.removeEventListener("touchstart",n,!0),this._progressSlider.removeEventListener("touchend",n,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(t,r,!1),this._volumeSlider.removeEventListener("mouseover",r,!1),this._volumeSlider.removeEventListener("mouseout",r,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",a,!1),this._volumeBtn.removeEventListener("mouseover",a,!1),this._volumeBtn.removeEventListener("mouseout",a,!1)),this._isIOS||this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToDom:function(){var t=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));uvpjs.util.createStyleSheet(t,this._cssPath)},_haveControlsLoaded:function(){this.debug&&(uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var t,e=!0;for(t in this._controlList)this._checkControlOnDOM(this._controlList[t])||(e=!1);return e},_waitForControls:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_waitForControls."),setTimeout(function(){if(!(100<++this._waitCount))return this._haveControlsLoaded()?void t.call(this):void this._waitForControls(t)}.bind(this),50)},_clearMouseMoveInterval:function(t){t=this._getClassName(t,this.ACTIVE_MODIFIER);this._intervals&&-1!==this._intervals[t]&&(clearInterval(this._intervals[t]),this._intervals[t]=-1)},_clearIntervals:function(){var t,e=this._intervals;for(t in e)-1!==e[t]&&(clearInterval(e[t]),e[t]=-1)},_setupDom:function(){var t=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),i(this._containerEl,this.PRIMARY_BLOCK),i(this._contentEl,this._getClassName(t.CONTENT)),i(this._controlsEl,this._getClassName(t.CONTROLS)),this.debug&&uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&i(this._adEl,this._getClassName(t.AD)),this._hide(t.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(t.BUFFERING_FRAME),this._hide(t.LARGE_PLAY_BTN),this._hide(t.CONTROL_BAR),this._hide(t.PROGRESS),this._hide(t.VOLUME_SLIDER),this._show(t.CONTROLS),this._hide(t.BUFFERING_FRAME),this._hide(t.SETTINGS_MENU),this._hide(t.PREVIEW_BTN),this._hide(t.REPLAY_BTN),!0!==this._autoPlay&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContainers:function(){this._containerEl.style.visibility="visible",this._contentEl.style.visibility="visible",this._videoEl.style.visibility="visible",this._controlsEl.style.visibility="visible"},_appendControlList:function(t){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t]=t},_setupControlsContainer:function(){var t=JSON.parse(JSON.stringify(this._controls))||[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(t),this._isIOS&&(this._controlsEl.querySelector(".uvpjs__btn-volume").style.right="45px",this._controlsEl.querySelector(".uvpjs__time").style.right="83px")},_generateSettingsMenu:function(t,e){function i(t,e){var i={};if(!1!==t.enabled)return void 0===t.value?(i.el="SETTINGS_MENU_ITEM",i.type="button",i.label=t.label,i.target=e):(i.el="SETTINGS_MENU_INPUT",i.type="menu",i.label=t.label||t.value,i.value=t.value,i.property=e&&E.last(e.split(":")),i.selected=(e=(t=i).value,!(((t=(t=t.property)&&h[t])&&t.toLowerCase())!==(e&&e.toLowerCase())))),i}for(var s,n,r,a,o,d,l=this._queryByElementName(this.css.SETTINGS_MENU),u=this._getClassName(this.css.SETTINGS_MENU_ITEM),h=E.assign({},this._menuSelections,this._getCaptionsStyle()),c=document.createRange(),p=uvpjs.util,g=[],v=this.shouldTrapTaps(),f=t&&t.length,_=0;_<f;_++)r=e,(a=(o=t[_]).name)&&(r=p.isDefinedString(e)&&[e,a].join(":")||a),g.push(i(o,r));for(e&&((d=i(this._findMenuItem(e),r=e.split(":").slice(0,-1).join(":"))).cls=u+"--back",g.unshift(d)),c.selectNodeContents(l),c.deleteContents(),l.insertAdjacentHTML("beforeend",this._templateToHTML(g)),s=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),n=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),_=s&&s.length;_--;)v||s[_].addEventListener("click",this._onSettingsMenuBtnClick);for(_=n&&n.length;_--;)v||n[_].addEventListener("click",this._onSettingsMenuInputClick)},_removeMenuEventListeners:function(){for(var t=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),e=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),i=t&&t.length;i--;)t[i].removeEventListener("click",this._onSettingsMenuBtnClick);for(i=e&&e.length;i--;)e[i].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(t){var i={items:this.settingsMenu};if(E.isEmpty(t))return i;var s=this,t=t.split(":");return E(t).each(function(e){s.debug&&uvpjs.log(s.DEBUG_ID,"_findMenuItem key",e),i=E.find(i.items,function(t){return t.name===e})}),i},_createAdLearnMoreButton:function(){},_setupPreview:function(){var t=uvpjs.util,e=this.css.PREVIEW_BTN,i=this._previewImage,s=this._queryByElementName(e);uvpjs.log(this.DEBUG_ID,"_setupPreview",i),t.isDefinedString(i)&&(s.style.backgroundImage="url('"+i+"')"),this._show(e)},_setupReplay:function(){var t=uvpjs.util,e=this.css,i=e.REPLAY_BTN,s=this._previewImage,n=this._queryByElementName(i);this.debug&&uvpjs.log(this.DEBUG_ID,"_setupReplay"),t.isDefinedString(s)&&(n.style.backgroundImage="url('"+s+"')"),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.BUFFERING_FRAME),this._show(e.CONTROLS),this._hide(e.CONTROL_BAR),this._hide(e.PROGRESS),this._show(i),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var t=this._getClassName(this.css.BUFFERING_FRAME);new Spinner({lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:t,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(this._controlsEl)},_disableInactiveButtons:function(){this._isIOS||this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(t){var e=this.css;this._containerId===t.target&&(this.ignoreVideoStateChange=this.shouldIgnoreStateChange(t.payload.isDynamicAdCall),this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._disableButton(e.SETTINGS_BTN),this._disableButton(e.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._hasHidden(this.css.CONTROL_BAR)||this._show(e.PROGRESS),this._hasActive(e.CLOSED_CAPTION_BTN)&&!this._isIOS&&this.vci.hideCaptions(),t.payload.adData.isCustomClickTrackingUsed||this._disable(e.LARGE_PLAY_BTN))},shouldIgnoreStateChange:function(t){return this.vci.getContentVideoData().isLive&&!!t},_onAdEnd:function(t){this._containerId===t.target&&(this.ignoreVideoStateChange=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,t.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(t){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",t),this._captionsLoaded=!0,this._enableCaptions(),this.isAndroidOnHlsjs||this._enableButton(this.css.SETTINGS_BTN))},_onCaptionsUnavailable:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",t),this._isIOS||this._disableCaptions()},_onContentStart:function(t){var e=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart",t),this._containerId===t.target&&(this._isWaitingForFirstTouch=!1,this.ignoreVideoStateChange=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),this._isLive()||this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(e.VOLUME_BTN),this._captionsLoaded&&this._enableButton(e.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(e.LARGE_PLAY_BTN)),this._isLive()?(this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER),this._hide(e.PROGRESS)):this._isStreaming()&&(this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._hasHidden(this.css.CONTROL_BAR)||this._show(e.PROGRESS)),!this._isIOS&&this._hasActive(e.CLOSED_CAPTION_BTN)&&this.vci.showCaptions())},_onContentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===t.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider(),this._disableProgress(),this._hide(this.css.PROGRESS))},_onControlMuteUnmute:function(t){var e="controlMute"===t.type;this._containerId===t.target&&this._updateVolumeUI(this._volumeSlider.value,e)},_onDiagCloseButton:function(t){this._containerId===t.target&&(uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",t),this._menuSelections.debug=null)},_onResourceStart:function(t){(t&&t.target)===this._containerId&&(uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(t){var e=t.target,i=0===t.payload.playlistLength;this._containerId===e&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",t),this._hide(this.css.CONTROLS),this._enableReplay&&i&&this._setupReplay(),this._captionsLoaded&&(this._captionsLoaded=!1,this._disableCaptions()),this._resetProgressSlider())},_onVideoProgress:function(t){var e=t.payload,i=e.playbackState,s=this.vci.getVolume(),n=this.css.TIME_DURATION,r=this.css.TIME_CURRENT,a=!1;this._containerId===t.target&&(s!==Number(this._volumeSlider.value)&&this._updateVolumeUI(s),i!==this._playbackState&&(this._playbackState=i,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(e),i!==this.mc.PLAYING||this._isSliding||e.duration!==1/0&&(s=this._queryByElementName(n),i=this._queryByElementName(r),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&3600<=e.duration&&(this.durationChecked=a=!0):(this.durationChecked=!0,3600<=e.duration&&(a=!0)),a&&(i.parentNode.style.width="100px"),s.innerHTML=this._formatTimestampByType(n,e.duration),i.innerHTML=this._formatTimestampByType(r,e.currentTime),this._updateProgressUI(e)),this.isMonitoringMuting&&this.checkMute())},_onVideoLoading:function(t){E.has(t,"target")&&this._containerId===t.target&&E.isObject(t)&&E.has(t,"payload.data")&&this._updateProgressLoad(t.payload.data)},_onVideoStateChange:function(t){var e;this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",t),E.isObject(t)&&this._containerId===t.target&&E.isObject(t.payload)&&E.isNumber(parseInt(t.payload.newState))&&(!this.ignoreVideoStateChange||e===this.mc.PAUSED||e===this.mc.PLAYING)&&((e=t.payload.newState)!==this._playbackState&&(this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)),e===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1))},monitorMuting:function(t,e,i){null!==t&&(this.isMonitoringMuting=t),e&&clearInterval(this.muteMonitorIntervalId),i&&(this.muteMonitorIntervalId=setInterval(this.checkMute.bind(this),300))},checkMute:function(){var t=this._videoEl&&this._videoEl.muted;this.currVolumeInfo&&t!==this.currVolumeInfo.muted&&((this.currVolumeInfo.muted=t)?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(t){var e=!1;switch(t.type){case"mouseenter":this._onUVPJSMouseEnter(t);break;case"mouseleave":this._onUVPJSMouseLeave(t);break;case"mousemove":this._onUVPJSMouseMove(t);break;case"mousedown":this._onUVPJSMouseDown(t);break;case"mouseup":this._onUVPJSMouseUp(t);break;case"click":this._showControlBar(t),e=!0;break;case"touchstart":this._onUVPJSTouchStart(t);break;case"touchend":this._onUVPJSTouchEnd(t),e=!0}!this._hasFirstTouch&&e&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(t)))},_getTargetInfo:function(t){t=t.target;return{isVolumeButton:-1!==t.className.indexOf(this.css.VOLUME_BTN),isPlayPauseToggle:-1!==t.className.indexOf(this.css.PLAYSTATE_BTN)}},_onProgressSliderEvent:function(t){switch(t.type){case"input":case"change":this._onProgressSliderChange(t);break;case"touchstart":case"mousedown":this._onProgressSliderStart(t);break;case"touchend":case"mouseup":this._onProgressSliderEnd(t)}},_onVolumeSliderEvent:function(t){switch(t.type){case"input":case"change":this._onVolumeSliderChange(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onVolumeBtnEvent:function(t){switch(t.type){case"click":case"touchend":this._onVolumeBtnClick(t);break;case"mouseover":this._showVolumeSlider(t);break;case"mouseout":this._hideVolumeSlider(t)}},_onUVPJSMouseEnter:function(t){t.stopPropagation(),this._containerEl===t.target&&(this._hasPaused()||this._showControlBar(t))},_onUVPJSMouseDown:function(t){t.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(t){var e=this.vci.getCurrentPlaybackState().playbackState;return this.debug&&uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),t.target.getAttribute("disabled")?(t.stopPropagation(),void t.preventDefault()):(this._touchStartTime=t.timeStamp,this._previewCallbackDone?void(this._hasDisabled(this.css.CONTROLS)||e!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),t.target===this._progressSlider&&(e=1-(t.target.clientWidth-t.layerX)/t.target.clientWidth,this._onProgressSliderChange(t,e)))):void(this.debug&&uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet.")))},_onUVPJSTouchEnd:function(t){var e,i,s=this.css,n=this._isTap(t.timeStamp),r=[s.CLOSED_CAPTION_BTN,s.VOLUME_BTN,s.PLAYSTATE_BTN,s.SETTINGS_BTN,s.SETTINGS_MENU,s.SETTINGS_MENU_ITEM,s.SETTINGS_MENU_INPUT,s.LARGE_PLAY_BTN,s.FULLSCREEN_BTN],a=r.length,o=t.target.className;if(t.target.getAttribute("disabled"))return t.stopPropagation(),void t.preventDefault();if(!this._hasDisabled(s.CONTROLS)){for(;a--&&!(i=i||-1<o.indexOf(r[a])););if(this.shouldTrapTaps()&&i&&a<r.length-1)return t.stopPropagation(),t.preventDefault(),void this.handleTap(r[a],t);(n=!(i||this._isTouchActive&&n))&&t.preventDefault(),n&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),n=e||n?this.HIDE_DELAY:0,e&&clearTimeout(e),e=setTimeout(function(){this._hasPaused()||(e=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER))}.bind(this),n)}},handleTap:function(t,e){var i=this.css;if(!this._queryByElementName(t).hasAttribute("disabled"))switch(t){case i.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(e);break;case i.VOLUME_BTN:this._onVolumeBtnEvent(e);break;case i.PLAYSTATE_BTN:case i.LARGE_PLAY_BTN:this._onPlayToggle(e);break;case i.SETTINGS_BTN:this._onSettingsBtnClick(e);break;case i.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(e);break;case i.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(e)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(t){t.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(t){var e=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[e]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[e]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(t){this._isMouseActive||(this._clearMouseMoveInterval(t),this._removeModifier(t,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(t){t.stopPropagation(),this._containerEl===t.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(t){t.target===this._containerId&&this._determineBreakpoint()},_determineBreakpoint:function(){var t=this._containerEl.offsetWidth;t>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),t<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),t<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),t<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),t<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(t){var e=this.vci.getPlayerMuted();this._hasDisabled(this.css.VOLUME_BTN)||(e?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(t){var e=parseFloat(t.target.value),t=this.vci.getPlayerMuted();t&&0<e&&this.vci.unMute(),this.vci.setVolume(e),this._updateVolumeUI(e,t)},_onFullscreenBtnClick:function(t){t.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),t.stopPropagation(),t.preventDefault(),this.ignoreVideoStateChange&&this._isLive())this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo());else{t=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",t),t===this.mc.PAUSED||t===this.mc.EMPTY||t===this.mc.LOADING)return this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),void this.vci.playVideo();t!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo())}},_onPreviewBtn:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),!this._isTouch||this._isTap(t.timeStamp)?(t.stopPropagation(),this.vci.onPreviewButton(this._skinReadyCB.bind(this))):this.debug&&uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback.")},_hNonTap:function(){this._touchStartTime=null},_onReplayBtn:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),t.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0),this._isTouch||this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),t.stopPropagation();t=this.css.CLOSED_CAPTION_BTN,t=this._hasActive(t);if(this._ccEnabledByUser=!t,t)return this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.vci.hideCaptions();this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition()},_onSettingsBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),t.stopPropagation();var e=this.css.SETTINGS_MENU,t=this._hasHidden(e);if(uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",t),t)return this._addModifier(e,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(e);this._removeModifier(e,this.ACTIVE_MODIFIER),this._hide(e)},_onSettingsMenuBtnClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",t);var e=t.target.getAttribute("data-target");this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",e),t.target.parentNode.setAttribute("data-target",e);t=this._findMenuItem(e);this._generateSettingsMenu(t.items,e)},_onSettingsMenuInputClick:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",t);var e=t.target.parentNode.getAttribute("data-target");switch(e&&e.split(":")[0]){case"cc":this._onSettingsCaptionsChange(t);break;case"controls":this._onSettingsControlsChange(t);break;case"debug":this._onSettingsDiagWindowChange(t)}},_onSettingsCaptionsChange:function(t){var e=t.target,i=e.parentNode,s=e.getAttribute("data-property"),t=e.getAttribute("data-value").toLowerCase();this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",s,t),E(i.children).each(function(t){t.setAttribute("data-selected","false")}.bind(this)),e.setAttribute("data-selected","true"),"text-position"!==s?this.vci.setCaptionsStyleProperty(s,t):this._setCCPosition(t)},_onSettingsControlsChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",t);var e=t.target,i=e.getAttribute("data-property"),s=e.getAttribute("data-value").toLowerCase(),t="#"+this._containerId+" ";if("background-opacity"===i){i="background-color",e=this._queryByElementName(this.css.CONTROL_BAR),e=getComputedStyle(e).getPropertyValue(i);if(-1===e.indexOf("rgba"))return;s=e.split(",").slice(0,-1).join(",")+", "+s+")",this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",s),t+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(t,i,s)},_onSettingsDiagWindowChange:function(t){var e=t.target,i=e.getAttribute("data-property"),s=e.getAttribute("data-value"),n=!("true"===e.getAttribute("data-selected"));this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",t),this._menuSelections[i]=s,e.setAttribute("data-selected",n),n?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(t){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",t),this.vci.setCaptionsStyle(t))},_setCaptionsStyleProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",t,e),this.vci.setCaptionsStyleProperty(t,e))},_setCueProperty:function(t,e){!this._isIOS&&this._captionsLoaded&&this._videoEl.textTracks&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCueProperty",t,e),this.vci.setCaptionsCueProperty(t,e))},_setCCPosition:function(t){var e="text-position";!this._isIOS&&this._captionsLoaded&&(t=t||this._getCaptionsStyle()[e],this.debug&&uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",e,t),this.vci.setCaptionsStyleProperty(e,t))},_showControlBar:function(t){var e=this.vci.getCurrentPlaybackState().playbackState,i=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&e!==this.mc.EMPTY&&(E.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[i.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(i.CONTROL_BAR),this.controlsVisible=!0,this._show(i.PROGRESS))},_hideMenu:function(t){this._hasHidden(this.css.SETTINGS_MENU)||-1<t.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(t){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=E.debounce(function(){this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch?this._hideControlBar.hide.cancel():(this.controlsVisible=!1,this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS))},t||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(t){var e,i=this.css;this._hasDisabled(i.VOLUME_BTN)||this._hasDisabled(i.CONTROLS)||(this._hasActive(i.SETTINGS_MENU)&&this._hide(i.SETTINGS_MENU),this._setDataAttribute(this._containerEl,i.VOLUME_SLIDER,!0),this._addModifier(i.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(i.VOLUME_SLIDER),(this.mc.isFirefox()||this.mc.isEdge())&&(e=this._controlsEl.querySelector(".uvpjs__volume-slider"))&&e.setAttribute("style","bottom: 62px"))},_hideVolumeSlider:function(t){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableCaptions:function(){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._ccEnabledByUser&&(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions()))},_disableCaptions:function(){this._isIOS||(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this._disableButton(this.css.CLOSED_CAPTION_BTN),this._disableButton(this.css.SETTINGS_BTN))},_enableSettingsBtn:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn"),E.some(this.settingsMenu,"enabled")&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(t,e){var i,s=uvpjs.util,n=this._containerEl;!0===this.vci.getPlayerMuted()?i="mute":.85<t?i="full":s.inRange(t,.5,.85)?i="high":s.inRange(t,.15,.5)?i="medium":s.inRange(t,0,.15)&&(i="low"),this._volumeSlider.value=t||this._videoEl.volume,this._setDataAttribute(n,"volume-level",i),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,t)},_onProgressSliderChange:function(t,e){var i=this.vci.getContentVideoData(),s=this.vci.getCurrentPlaybackState(),n=this.css.TIME_CURRENT,r=this._queryByElementName(n),e=1<(e=e||this._progressSlider.value)?1:e<0?0:e,i=Math.ceil(e*i.duration*1e4)/1e4,s=Math.abs((s.currentTime-i)/i);this._updateProgressSlider(e),r.innerHTML=this._formatTimestampByType(n,i),this._hasActive(this.css.PROGRESS_SLIDER)||s<=.02||this.vci.seekTo(i)},_onProgressMouseOver:function(t){t.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(t){t.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(t){var e=this.css;if(this._hasAd()||this._hasDisabled(e.PROGRESS))return t.stopPropagation(),void t.preventDefault();this._addModifier(e.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!0},_onProgressSliderEnd:function(t){if(this._hasAd()||this._hasDisabled(this.css.PROGRESS))return t.stopPropagation(),void t.preventDefault();this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,this._onProgressSliderChange(t)},_resetProgressSlider:function(){this._updateProgressSlider&&this._updateProgressSlider(0)},_updateProgressLoad:function(t){this._isLive()||(t=Math.ceil(t.bufferLength/t.duration*1e4)/1e4,E.isNaN(t)||t==1/0||t<=0||(this._downloaded=t,this._hasAd()||(this._queryByElementName(this.css.PROGRESS_LOADED).value=this._downloaded)))},_updatePlaybackStateUI:function(t){var e=this.css;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",t),t){case this.mc.PLAYING:this._show(e.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(e.LARGE_PLAY_BTN),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.controlsVisible&&!this._isLive()&&this._show(e.PROGRESS);break;case this.mc.PAUSED:this._show(e.CONTROLS),this.controlsVisible&&this._showControlBar(),this._hide(e.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(e.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(e.CONTROLS);break;case this.mc.BUFFERING:case this.mc.LOADING:this._show(e.CONTROLS),this._hide(e.PREVIEW_BTN),this._hide(e.REPLAY_BTN),this._hide(e.LARGE_PLAY_BTN),this._show(e.BUFFERING_FRAME)}},_updateProgressUI:function(t){t=Math.ceil(t.currentTime/t.duration*1e4)/1e4;this._updateProgressSlider(t)},_updateSliderUI:function(t,e,i){var s,n,r=this,a={};E.isUndefined(this._vendorPrefix)||E.isUndefined(t)||(a.id="#"+this._containerId,a.cls=r._getClass(e),a.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[r._vendorPrefix],this._isMSEdge&&(a.pseudo=""),a.add=function(t,e,i){E.isUndefined(this.pseudo)||(i=this.id+(e||"")+" "+this.cls+(i||"")+this.pseudo,r._addCSSRule(i,"background-size",100*t+"% 100%"))},a.before=function(t,e){var i=r._getClass(r.PRIMARY_BLOCK);e&&(i+=r._getClass(r.PRIMARY_BLOCK,e)),this.add(t,i,null)},a.after=function(t,e){this.add(t,null,e)},e!==r.css.VOLUME_SLIDER?(s=i*t.offsetWidth,n=(.5-i)*t.offsetHeight,e=s/t.offsetWidth,n=(s+n)/t.offsetWidth,t.value=i,t=r._hasAd(),a.before(e,t?r.AD_MODIFIER:null),this._isTouch&&a.before(n,r.TOUCH_MODIFIER)):a.add(i))},_checkControlOnDOM:function(t){t=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+t;return!!this._controlCache[t]},_getClassName:function(t,e){var i=this.PRIMARY_BLOCK;return t!==this.PRIMARY_BLOCK&&(i+=this.BLOCK_ELEMENT_DELIMITER+t),e&&(i+=this.ELEMENT_MODIFIER_DELIMITER+e),i},_getClass:function(t,e){return this.CLASS_SELECTOR_PREFIX+this._getClassName(t,e)},_queryByClassName:function(t){var e;if(this._containerId)return e=this.ID_SELECTOR_PREFIX+this._containerId,t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),(t=this._controlCache[e]||document.querySelector(e))&&(this._controlCache[e]=t),t},_queryAllByClassName:function(t){var e=this.ID_SELECTOR_PREFIX+this._containerId;return t!==this.PRIMARY_BLOCK&&(e+=" "+this.CLASS_SELECTOR_PREFIX+t),document.querySelectorAll(e)},_queryByElementName:function(t){return this._queryByClassName(this._getClassName(t))},_queryAllByElementName:function(t){return this._queryAllByClassName(this._getClassName(t))},_show:function(t){var e,i,s;t!==this.css.PROGRESS||this._isLive()||(i=(e=this._queryByElementName(t)).querySelector("input"),s=e.querySelector("progress"),e&&(e.style.display="block"),i&&(i.style.display="block"),s&&(s.style.display="block")),this._removeModifier(t,this.HIDDEN_MODIFIER)},_hide:function(t){var e,i,s;t===this.css.PROGRESS&&(i=(e=this._queryByElementName(t)).querySelector("input"),s=e.querySelector("progress"),e&&(e.style.display="none"),i&&(i.style.display="none"),s&&(s.style.display="none")),this._addModifier(t,this.HIDDEN_MODIFIER)},_enable:function(t){this._removeModifier(t,this.DISABLED_MODIFIER)},_disable:function(t){this._addModifier(t,this.DISABLED_MODIFIER)},_enableMenuItem:function(t){var e;t&&(e=this._findMenuItem(t))&&(e.enabled=!0)},_hasHidden:function(t){return this._hasModifier(t,this.HIDDEN_MODIFIER)},_hasActive:function(t){return this._hasModifier(t,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(t){return this._hasModifier(t,this.DISABLED_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){return this.vci.getContentVideoData().isLive&&this._isStreaming()},_isPlaying:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.PLAYING},_isStreaming:function(){var t=this.vci.getContentVideoData();return t.deliveryType&&t.deliveryType===this.mc.STREAMING},_hasModifier:function(t,e){E.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));e=this._getClassName(t,e),t=this._queryByElementName(t);return!!t&&s(t,e)},_addModifier:function(t,e){E.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));e=this._getClassName(t,e),t=this._queryByElementName(t);t&&i(t,e)},_removeModifier:function(t,e){var i=this._queryByElementName(t);E.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER)),e=this._getClassName(t,e),i&&n(i,e)},_toggleModifier:function(t,e){E.isArray(e)&&(e=e.join(this.MODIFIER_DELIMETER));e=this._getClassName(t,e),t=this._queryByElementName(t);t&&r(t,e)},_setDataAttribute:function(t,e,i){t.setAttribute("data-"+e,i)},_removeDataAttribute:function(t,e){t.removeAttribute("data-"+e)},_formatTimestamp:function(t){var e;return uvpjs.util.isEmpty(t)||t===1/0?this.NULL_TIME:(isNaN(t)&&(t=0),(e=new Date(null)).setSeconds(Math.round(t)),e=e.toISOString(),3600<=t?e.substr(11,8):e.substr(14,5))},_formatTimestampByType:function(t,e){if(void 0===e||e<0){if(t===this.css.TIME_DURATION)return this.NULL_TIME;if(t===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(e)},_addCSSRule:function(t,e,i){var s=this._styleEl.sheet,n=s.cssRules.length,r=this._cssRules[t];if(!E.isUndefined(r)){s=s.rules||s.cssRules;if(0<s.length&&s[r])return void(s[r].style[e]=i)}this._cssRules[t]=n,uvpjs.util.addCSSRule(this._styleEl,t,e,i)},_setStyleSheet:function(e){var i=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||uvpjs.util.createStyleSheet(function(t){this._styleEl=t,i||"function"!=typeof e||(this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),i=!0,e())}.bind(this))},_templateToHTML:function(t){if(E.isArray(t)&&!E.isEmpty(t)){var s=function(t){return this._getClassName(this.css[t]||t)}.bind(this),n=JSON.parse(JSON.stringify(this._template))||{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'},r=this._isIOS;return function e(t){var i="";return E(t).each(function(t){t&&("CLOSED_CAPTION_BTN"!==t.el&&"SETTINGS_BTN"!==t.el||!r)&&(t.cls=E.isUndefined(t.cls)?s(t.el):[t.cls,s(t.el)].join(" "),t.children&&(t.children=e(t.children)),i+=E.template(n[t.type],{variable:"o"})(t))}),i}(t)}},_getCaptionsStyle:function(){return this.vci.getCaptionsStyle()},_isTap:function(t){return!!this._touchStartTime&&t-this._touchStartTime<this.TAP_THRESHOLD}}),s=function(t,e){return!E.isNull(t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)")))},i=function(t,e){s(t,e)||(t.className=(t.className+=" "+e).trim())},n=function(t,e){t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ").trim()},r=function(t,e){(s(t,e)?n:i)(t,e)}}(uvpjs.register("uvpjs")),Z=uvpjs.register("uvpjs"),p=Z._,Z.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(t,e,i,s){this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",t),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",e),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",i)),p.isArray(e)?(this.vidContId=t,this._generateAdPods(e,i,s)):this.debug&&uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN")},_generateAdPods:function(t,e,i){function s(t,e,i){return{hasBeenChecked:!1,startTime:i||0,hasPlayed:!1,adPodId:t,adCount:0,podDuration:0,adCallURL:e}}var n,r,a,o=e.length;for(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",t),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",e)),this.adPods={},0<o&&(-1<e.indexOf(0)&&(this.adPods[this.PRE]=s(this.PRE+"_0",i)),-1<e.indexOf(-1)&&(this.adPods[this.POST]=s(this.POST+"_0",i))),n=0;n<o;n++)r=0===e[0]?n:n+1,a=e[n],isNaN(a)||0===a||-1===a||(this.adPods[this.MID_+r]=s(this.MID_+r,i,a));this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",t),p.isString(t)){t=this.adPods[t];return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",t),t}},getAdPods:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var t=Object.keys(this.adPods).length;return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",t),t},getMidRollPods:function(){var t,e=[];if(!this.midRollPods){for(t in e=[],this.adPods)0<=t.indexOf(this.MID)&&e.push(this.adPods[t]);this.midRollPods=e}return this.midRollPods},isPreRoll:function(t){return!p.isUndefined(t.adPodId)&&-1<t.adPodId.indexOf(this.PRE)},isMidRoll:function(t){return!p.isUndefined(t.adPodId)&&-1<t.adPodId.indexOf(this.MID)},isPostRoll:function(t){return!p.isUndefined(t.adPodId)&&-1<t.adPodId.indexOf(this.POST)},hasMidRoll:function(){for(var t in this.adPods)if(-1<t.indexOf(this.MID))return!0;return!1},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(t){var e,i,s,n=null,r="No eligible ad pod found.";for(s in this.adPods)this.adPods.hasOwnProperty(s)&&(e=this.adPods[s],this.isPreRoll(e)||this.isPostRoll(e)||e.startTime<=t&&(!n||t-e.startTime<t-n.startTime)&&(n=e));return n&&(i=n.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",r="Found Ad pod; adPodId = "+n.adPodId+"; "+i),this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+t+";  "+r),n}}),l=uvpjs.register("uvpjs"),c=l._,l.TrackingManager=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,PLAYER_NAME_ONLY:uvpjs.Configuration.name,PLAYER_VERSION_ONLY:uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",OZTAM_MODULE_NAME:"OzTam",DATAZOOM_MODULE_NAME:"Datazoom",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},_hasAgentInit:!1,init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this.resourceStartTime=0,this.contextMetadata={},this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=uvpjs.mediaCapabilities,t&&this.initialize(t.vidContId,t.cviMgr)},destroy:function(){for(var t,e=this.agents.length;e--;)this.agents[e]&&"function"==typeof this.agents[e].destroy&&this.agents[e].destroy(),this.agents.splice(e,1);for(t in this.eventCBs)this.eventsMgr.removeEventListener(t+this.internalNS+".agent"),delete this.eventsMgr[t];for(t in this.progressEvents)delete this.progressEvents[t];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this.contextMetadata=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize"),c.isString(t)&&c.isObject(e)&&(this.vidContId=t,this.eventsMgr=e.getEventsMgr(),this.cviModel=e.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._addTrackingEventListeners())},hasTrackingConfigOverrides:function(t){return null!==t&&t.hasOwnProperty("trackingConfigOverrides")&&null!==t.trackingConfigOverrides},getAgentConfig:function(t,e){for(var i=null,s=t.length;0<s--;){var n=t[s];if(n.name===e){i=n;break}}return i},_overrideUvpc:function(){var t=this.cviModel;if(this.hasTrackingConfigOverrides(t)){for(var e=t.getModules().slice(0),i=e.length;0<i--;){var s=e[i],s=this.getAgentConfig(t.trackingConfigOverrides,s.name);null!==s&&(e[i]=s)}this.agentConfigs=e}else this.agentConfigs=t.getModules().slice(0)},isTrackingAgentEnabled:function(t){var e,i=this.getAgentConfig(this.agentConfigs,t),s=this.mc.systemInfo.trackingAvailability,n=!1;for(e in uvpjs.tracking)if(uvpjs.tracking[e]===t&&s[e]){n=!0;break}return this.debug&&i&&i.enabled&&!n&&uvpjs.warn(this.DEBUG_ID,"Agent enabled in the config but sdk did not load",i,s),null!==i&&i.enabled&&n},_createAgentsArray:function(t){var e,i,s,n;this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),i=t||this.cviModel,this.debug&&uvpjs.log(this.DEBUG_ID,"agentConfigs",this.agentConfigs),s=i.isModuleEnabled.bind(i),n=i.isModuleSet.bind(i),t=this.getPlayerName(),i={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr,playerName:t,playerVersion:this.PLAYER_VERSION_ONLY},this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),i.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,e=new uvpjs.AdobeHeartbeatAgent(i),this.agents.push(e)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),i.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,e=new uvpjs.AkamaiAnalyticsAgent(i),this.agents.push(e)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),i.moduleName=this.COMSCORE_SS_MODULE_NAME,i.playerName=this.getPlayerName("|","_"),e=new uvpjs.ComScoreAgent(i),this.agents.push(e)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),i.moduleName=this.CONVIVA_MODULE_NAME,e=new uvpjs.ConvivaAgent(i),this.agents.push(e)),((t=s(this.DW_MODULE_NAME))||s(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),i.moduleName=t?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,i.playerName=this.getPlayerName(";"),e=new uvpjs.DWAgent(i),this.agents.push(e)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),i.moduleName=this.NIELSEN_MODULE_NAME,e=new uvpjs.NielsenAgent(i),this.agents.push(e)),n(this.MUX_MODULE_NAME)&&!this.isTrackingAgentEnabled(this.MUX_MODULE_NAME)?this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC"):(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent"),o=this.cviModel.getModuleParam.bind(this.cviModel,this.MUX_MODULE_NAME),i.moduleName=this.MUX_MODULE_NAME,i.playerName=this.PLAYER_NAME_ONLY,i.playerVersion=this.PLAYER_VERSION_ONLY,i.useDefaultProperty=!o("propertyKey"),e=new uvpjs.MuxAgent(i),this.agents.push(e));var r=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(r&&r.params&&0<r.params.length)for(var a=r.params.length;0<a--;)this.beaconEndPoint[r.params[a].name]=r.params[a].value;this.isTrackingAgentEnabled(this.OZTAM_MODULE_NAME)&&(i.moduleName=this.OZTAM_MODULE_NAME,e=new uvpjs.OzTamAgent(i),this.agents.push(e));var o=this.getAgentConfig(this.agentConfigs,this.DATAZOOM_MODULE_NAME);o&&o.enabled&&(i.moduleName=this.DATAZOOM_MODULE_NAME,e=new uvpjs.DatazoomAgent(i),this.agents.push(e))},_addTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.addEventListener(e.CONTEXT_METADATA+i,this._onContextMetadata.bind(this)),t.addEventListener(e.VIDEO_STATE_CHANGE+i,this._onVideoStateChange.bind(this)),t.addEventListener(e.VIDEO_PROGRESS+i,this._onVideoProgress.bind(this)),t.addEventListener(e.RESOURCE_START+i,this._onResourceStart.bind(this)),t.addEventListener(e.PLAYBACK_DURATION_RESUME+i,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var t=this.eventsMgr,e=t.eventTypes,i=this.internalNS;t.removeEventListener(e.VIDEO_PROGRESS+i),t.removeEventListener(e.AD_QUARTILE+i),t.removeEventListener(e.RESOURCE_START+i)},_initializeAgents:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_initializeAgents",this.agents),c.isEmpty(this.agents))this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled.");else{for(var t=this.agents.length;t--;)this.agents[t].initialize();this._addAgentEventListeners()}},fireTrackingPixel:function(t){var e=document.createElement("img");e.setAttribute("src",t),e.setAttribute("width","1"),e.setAttribute("height","1"),e.setAttribute("border","0"),e.style.position="absolute",e.style.bottom="0",e.style.right="0",this._beaconElement.appendChild(e)},registerEventCallbacks:function(t){if(c.isPlainObject(t)&&!c.isEmpty(t))for(var e in t)this.eventCBs[e]=this.eventCBs[e]||[],this.eventCBs[e].push(t[e])},registerProgressEvents:function(t){if(c.isPlainObject(t)&&!c.isEmpty(t))for(var e in t)this.debug&&uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",e),this.progressEvents[e]=this.progressEvents[e]||[],this.progressEvents[e].push(t[e])},getContentPlayhead:function(){var t=this.cviModel.contentPlaybackState.currentTime;return parseInt(t)},getPlayerName:function(t,e){var i=this.PLAYER_NAME;return c.isEmpty(i)?"UVPJS":(t&&(i=i.replace("_",t)),i=e?i.replace(/\./g,e):i)},getAdLength:function(){return this._adLength=u(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=u(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var t in this.eventCBs)this.eventsMgr.addEventListener(t+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(t){if(t.target===this.vidContId){var e=this.eventCBs[t.type];if(!c.isEmpty(e))for(var i=e.length,s=0;s<i;s++)e[s](t)}},_onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata},_onVideoStateChange:function(t){var e,i;t.payload.newState!==this.mc.LOADING||this._hasAgentInit||(i=this.cviModel.cviMgr.RPM.currRP,t=this.cviModel.cviMgr.RPM.rscProviders,i&&i.rco&&i.rco.uvpc?e=i.rco.uvpc:t&&0<t.length&&(e=t[0].rco.uvpc),e&&e.modules&&this.cviModel.copyModules(e.modules),this._overrideUvpc(),this._createAgentsArray(),this._initializeAgents(),this._hasAgentInit=!0)},_onResourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"_onResourceStart",t),this.resourceStartTime=new Date,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(t){var e,s=this.progressEvents[t];if(!c.isEmpty(s))for(e=s.length,i=0;i<e;i++)s[i]()},_onPlaybackDurationResume:function(t){var e=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),i=this.cviModel.getContentVideoState(),i={ts:Math.floor(Date.now()/1e3),contentid:i.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:e("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:i.isPaidContent,affiliate:i.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},i=(new l.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(i).devMode(this.debug).buildUrl();this.fireTrackingPixel(i)},_onVideoProgress:function(t){var e=t.payload,i=Math.floor(e.currentTime),t=e.duration;if(i&&t&&!e.isAd&&!(this._lastContentSecondCompleted>=i)){if((this._lastContentSecondCompleted=i)%15==0&&i<=60||i%60==0){if(this._contentTimeFired[i])return;this._contentTimeFired[i]=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",i),this._onProgressEvent(this.progressEvents.TIMED)}e.isPlayingLive||t<=10||((t=Math.floor(i/t*100))!==this.percentDone&&(this.percentDone=t),c.inRange(t,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),c.inRange(t,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),75<=t&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),u=function(t,e){e=0<e?Math.floor(1e3*e):0;return uvpjs.util.inRange(t,e-1e3,e+1e3)?t:e},uvpjs.register("uvpjs").TrackingAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,vo:null,sdkEvent:null,hasSdk:!1,hasResourceStart:!1,hasContentStart:!1,isPaused:!1,isBuffering:!1,isSeekDone:!1,trackQosEvent:!1,trackContentStartEvent:!1,contextMetadata:{},initTime:null,init:function(t){this.options=t,this.initTime=new Date,this.contextMetadata=t.trackingMgr.contextMetadata||{}},initialize:function(){var t=this.options.eventsMgr.eventTypes,e={};e[t.RESOURCE_START]=this.onResourceStart.bind(this),e[t.CONTENT_START]=this.onContentStart.bind(this),e[t.VIDEO_STATE_CHANGE]=this.onVideoStateChange.bind(this),e[t.CONTROL_SEEK]=this.onSeekStart.bind(this),e[t.SEEK_DONE]=this.onSeekDone.bind(this),e[t.RESOURCE_END]=this.onResourceEnd.bind(this),e[t.CONTEXT_METADATA]=this.onContextMetadata.bind(this),e[t.CDN_UPDATED]=this.onCdnUpdated.bind(this),e[t.AD_POD_START]=this.onAdPodStart.bind(this),e[t.AD_POD_END]=this.onAdPodEnd.bind(this),e[t.AD_START]=this.onAdStart.bind(this),e[t.AD_CLICK]=this.onAdClick.bind(this),e[t.AD_END]=this.onAdEnd.bind(this),e[t.VIDEO_TRANSITION_START]=this.onVideoTransition.bind(this),e[t.VIDEO_PROGRESS]=this.onVideoProgress.bind(this),e[t.USER_GESTURE]=this.onUserGesture.bind(this),e[t.FORCE_TRACK_SESSION_END]=this.onForceTrackSessionEnd.bind(this),this.options.trackingMgr.registerEventCallbacks(e),(e={})[(t=this.options.trackingMgr.progressEvents).FIRST_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.FIRST_QUARTILE),e[t.MID_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.MID_QUARTILE),e[t.THIRD_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.THIRD_QUARTILE),this.options.trackingMgr.registerProgressEvents(e)},onResourceStart:function(t){this.hasResourceStart||(this.sendTrackEvent(this.sdkEvent.SESSION_START,this.vo.getSessionStartInfo()),this.hasResourceStart=!0)},onContentStart:function(t){this.trackContentStartEvent=!0,this.hasContentStart&&this.isPaused&&(this.sendTrackEvent(this.sdkEvent.PLAY_RESUME),this.isPaused=!1)},onQuartileProgress:function(t){this.sendTrackEvent(t,this.vo.getQuartileInfo())},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.sendTrackEvent(this.sdkEvent.PAUSE));break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.sendTrackEvent(this.sdkEvent.BUFFER_START));break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME)),this.isBuffering&&(this.isBuffering=!1,this.sendTrackEvent(this.sdkEvent.BUFFER_COMPLETE),this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))}},onSeekStart:function(t){this.sendTrackEvent(this.sdkEvent.SEEK_START,this.vo.getSeekInfo())},onSeekDone:function(t){this.sendTrackEvent(this.sdkEvent.SEEK_COMPLETE,this.vo.getSeekInfo()),this.isSeekDone=!0},onResourceEnd:function(t){this.hasContentStart&&this.vo.isCompletedMarker()&&(this.sendTrackEvent(this.sdkEvent.CONTENT_COMPLETE,this.vo.getContentCompleteInfo()),this.sendTrackEvent(this.sdkEvent.SESSION_END),this.hasResourceStart=!1,this.hasContentStart=!1)},onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata},onCdnUpdated:function(t){this.sendTrackEvent(this.sdkEvent.CDN_UPDATED,{cdn:t.payload.cdn})},onAdPodStart:function(t){this.sendTrackEvent(this.sdkEvent.AD_BREAK_START,this.vo.getAdBreakInfo())},onAdPodEnd:function(t){this.sendTrackEvent(this.sdkEvent.AD_BREAK_COMPLETE)},onAdStart:function(t){this.sendTrackEvent(this.sdkEvent.AD_START,this.vo.getAdItemInfo())},onAdClick:function(t){this.sendTrackEvent(this.sdkEvent.AD_CLICK)},onAdEnd:function(t){this.sendTrackEvent(this.sdkEvent.AD_COMPLETE)},onVideoTransition:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"bitrate",t.payload.bitrate),this.trackQosEvent=!0},onVideoProgress:function(t){this.trackQosEvent&&(this.trackQosEvent=!1,this.sendTrackEvent(this.sdkEvent.QOS,this.vo.getQosInfo())),this.trackContentStartEvent&&(this.trackContentStartEvent=!1,this.hasContentStart||(this.sendTrackEvent(this.sdkEvent.CONTENT_START,this.vo.getContentStartInfo()),this.hasContentStart=!0)),this.isSeekDone&&(this.isSeekDone=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))},onUserGesture:function(t){0<t.payload.startTime&&(this.options.resumeTime=t.payload.startTime)},onForceTrackSessionEnd:function(t){this.onResourceEnd(t)},destroy:function(){this.vo.destroy(),this.DEBUG_ID=null,this.options=null,this.initTime=null,this.vo=null,this.contextMetadata=null}}),function(t){"use strict";var d,n,r,a,o,l=t._;t.AdobeHeartbeatAgent=uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",SEGMENT_OWNER_PARAM_NAME:"id3SegmentOwner",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",LIVE_CONTENT_LENGTH:86400,init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this._segmentOwner=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata=this.trackingMgr.contextMetadata||{},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this._startUpTime=0,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._segmentOwner=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),l.isUndefined(this._visitorData.marketingCloudOrgId)?this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."):this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(t,e){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),l.isFunction(t)){e=(e||this.cviModel).sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,t()}.bind(this),this._usesTealium=e.usesTealium;e=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];if(this._usesTealium&&(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),e=l.without(e,this.scriptPaths.APP_MEASUREMENT)),a()&&!this.isPluginLoaded)return this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(e,this.pluginLoadedCB);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),this.pluginLoadedCB()}else this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!")},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var t=this._qosObject;return d.createQoSObject(t.bitrate,t.startupTime,t.fps,t.droppedFrames)},getCurrentPlaybackTime:function(){return this._videoInfo?this._videoInfo.playhead:0},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),e=t(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),i=t(this.TRACKING_SERVER_PARAM_NAME);this._segmentOwner=t(this.SEGMENT_OWNER_PARAM_NAME),this.mc.isSecure()&&(l.isString(i)&&0!==i.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(i=this.TRACKING_SERVER_SSL_PREFIX+i),l.isString(e)&&(e=e.replace("heartbeats.omtrdc.net","cbsinteractive.hb.omtrdc.net"))),this._appMeasurementData={account:t(this.ACCOUNT_PARAM_NAME),charSet:t(this.CHAR_SET_PARAM_NAME),trackingServer:i},this._heartbeatData={publisher:t(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:e},this._visitorData={marketingCloudOrgId:t(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:i},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var i=this.cviModel.sessionOptions;this._usesTealium=i.usesTealium;l.each({ftag:"ftag",netwk:"Network"},function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",t,e);e=i[e];l.isNull(e)||l.isUndefined(e)||l.isEmpty(e)||(this._sessionMetadata[t]=e)}.bind(this)),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_POD_END]=this._onAdPodEnd.bind(this),e[t.AD_CLICK]=this._onAdClick.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),e[t.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),e[t.PLAYER_LOADED]=this._updateVideoInfo.bind(this),e[t.RESOURCE_START]=this._updateVideoInfo.bind(this),e[t.VIDEO_RESUME]=this._updateVideoInfo.bind(this),e[t.VIDEO_DONE]=this._updateVideoInfo.bind(this),e[t.VIDEO_CUEPOINT]=this._onVideoCuePoint.bind(this),this._contextMetadataCBSetup||(e[t.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(e)},_setupContextMetadataEventCallback:function(){var t={};t[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(t),this._contextMetadataCBSetup=!0},_initializePlugin:function(){function t(t){this._agent=t}var e,i,s;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),a())this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded.");else if(this._mediaHeartbeat)this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used.");else{if(d=ADB.va.MediaHeartbeat,n=ADB.va.MediaHeartbeatConfig,r=ADB.va.MediaHeartbeatDelegate,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!o(this._s)&&!this._waitForTealium)return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),void this._getTealium();if(this._usesTealium)e=this._s,this.debug&&uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof Visitor)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof AppMeasurement)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(i=this._appMeasurementData.account,l.isString(i)&&l.isEmpty(i))return this._setupContextMetadataEventCallback(),void(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));try{try{this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent new Visitor"),s=new Visitor(this._visitorData.marketingCloudOrgId)}catch(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Visitor.getInstance",s),s=Visitor.getInstance(this._visitorData.marketingCloudOrgId)}}catch(t){this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed.")}s.trackingServer=this._visitorData.trackingServer,s.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),(e=new AppMeasurement(i)).visitor=s,e.account=i,e.trackingServer=this._appMeasurementData.trackingServer,e.pageName=this._appMeasurementData.pageName,e.charSet=this._appMeasurementData.charSet,e.visitorID=this._appMeasurementData.visitorID}l.isNull(e)?this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed."):((i=new n).trackingServer=this._heartbeatData.trackingServer,i.playerName=this._playerName,i.channel=this._heartbeatData.channel,i.debugLogging=this._heartbeatDebug,i.appVersion=this.SDK_VERSION,i.ssl=this.mc.isSecure(),i.ovp="",this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",i),l.extend(t.prototype,r.prototype),t.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},t.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new d(new t(this),i,e),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad())}},_getTealium:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),o(this._s)||this._waitForTealium?void(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.")):(this._getTealiumTimer||(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),l.has(window,"s")&&o(window.s)?(this._s=window.s,this._waitForTealium=!0,void this._initializePlugin()):(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),void setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL)))},_onTealiumTimeout:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(t,e){if(l.isNull(this._mediaHeartbeat))this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined");else switch(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",t),t){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(d.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(d.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(d.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(d.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(d.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(d.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(d.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(d.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(d.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(d.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(d.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(e)}},_getContentVideoMetadata:function(){var t,e,i=this.cviModel.getContentVideoState(),s=this._contextMetadata,n=this._sessionMetadata,r={};for(t in s)s.hasOwnProperty(t)&&(r[t]=s[t]);for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);if(i.contextMetadata)for(t in e=i.contextMetadata)e.hasOwnProperty(t)&&(r[t]=e[t]);return r.tl=i.videoTitle,r.mediaAutoPlay=this.cviModel.isAutoplay.toString(),r.mediaMuted=this.cviModel.isMuteAtPlayStart.toString(),r.mediaIsPaidContent=i.isPaidContent.toString(),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",r),r},_onContextMetadata:function(t){var e,i=t.payload.contextMetadata;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",t),l.isEmpty(i)||(this._contextMetadata=i,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),l.isEmpty(i[this.PAGE_REPORT_SUITE_ID_KEY]),e=i[this.PAGE_SITE_ACCOUNT_KEY],l.isEmpty(e))||(i=l.isEmpty(this._appMeasurementData.account),this._appMeasurementData.account=e,i&&(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+e),this._initializePlugin()))},_setVideoLoad:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat,this._startUpTime),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:this._startUpTime,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(t){var e,i,s=t.chapterStartTimes,n=s&&s.length||0,r=parseInt(t.currentContentSegment);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",t),i=(e=(r=isNaN(r)?1:r)<0?0:r-1)<=0?0:s[e],t=(n=n<1+e?t.duration:s[1+e])-i,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",n,i),(i={name:""}).length=isNaN(t)?0:t,i.position=r,i.startTime=s[e],this._chapterObject=d.createChapterObject(i.name,i.position,i.length,i.startTime),this._chapterInfo=i,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(t){var e,i,s;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",t),"pre"===(t=(i=(s=t.payload.adData).adClipID.split("_"))[0])?e=1:"mid"===t?e=parseInt(i[1])+1:"post"===t&&(e=this.cviModel.getNumberOfAdPods()),(t={}).name=l.isEmpty(s.adVideoTitle)?"na":s.adVideoTitle,t.position=e,t.playerName=this._playerName,t.startTime=this.getCurrentPlaybackTime(),(e={}).id=l.isEmpty(s.adVideoId)?l.isEmpty(s.adVatId)?"na":s.adVatId:s.adVideoId,e.name=t.name,e.length=s.duration,e.position=s.adPosition,this._adObject=d.createAdObject(e.name,e.id,e.position,e.length),this._adBreakObject=d.createAdBreakObject(t.name,t.position,t.startTime),this._adInfo=e,this._adBreakInfo=t,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(t){var e=this.HEARTBEAT_AD_COMPLETE;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(e)},_onAdClick:function(t){t=!0===t.payload.adData.paused;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),t&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(t){t=t.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",t),this._contentStarted=!0,this._startUpTime=Math.abs(new Date-this.trackingMgr.resourceStartTime)/1e3,this._sendInitialPlay(),0<t.chapterStartTimes.length&&(this._setChapterInfo(t),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(t){t=t.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",t),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&0<t.chapterStartTimes.length&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(t){var e=this._videoInfo,i=this._contentStarted&&e&&Math.ceil(e.playhead)>=.95*e.length,e=this.cviModel.getContentVideoState().isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",i),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,!e&&i&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(t){var e=t.payload.newState,i=this.mc.isMobile()&&this.mc.isIOS()&&this.cviModel.isFullscreen;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",e),this._videoLoaded&&(this._isBuffering||e!==this.mc.BUFFERING?this._isBuffering&&e!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),e===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),i&&e===this.mc.PAUSED&&this._onControlPause(t))},_updateVideoInfo:function(){var t,e=this.cviModel.getCurrentPlaybackState(),i=this.cviModel.getContentVideoState(),s=d.StreamType,n=i.duration,r=i.isLive,a=i.episodeFlag,o={};l.isEmpty(i.cmsRefGuid)?l.isEmpty(i.mediaId)?l.isEmpty(i.pid)?l.isEmpty(i.assetURL)?o.id="na":o.id=i.assetURL:o.id=i.pid:o.id=i.mediaId:o.id=i.cmsRefGuid,o.name=i.videoTitle,o.playerName=this._playerName,o.length=r?this.LIVE_CONTENT_LENGTH:isNaN(n)?0:n,o.playhead=e.currentTime,r?t=s.LIVE:(t=s.VOD,t+=":"+(a?this.FULL_EPISODES:this.CLIPS)),o.streamType=t,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",d),this._mediaObject=d.createMediaObject(o.name,o.id,o.length,o.streamType),this._videoInfo=o,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(t){var e=t&&t.facadeState,t=this._qosObject;e&&t&&(t.bitrate=e.currentBitrate||0,t.droppedFrames=e.droppedFrames||0,t.fps=e.playbackFramerate||0)},_updatePlayhead:function(t){t=t.payload;this._videoInfo&&t&&(t.isAd||(this._updateQosObj(t),this._videoInfo.playhead=t.currentTime))},_sendInitialPlay:function(){this._videoLoaded||this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)},_onVideoCuePoint:function(t){var e;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoCuePoint",t),this._isSegmentOwner(t.payload)&&0<(e=(e=t.payload.data).split("|")).length&&this._segmentStart({segmentId:e[0],segmentTitle:e[1]})},_segmentStart:function(t){var e;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _segmentStart",t),t.segmentId&&(this._mediaHeartbeat.trackComplete(),this._mediaHeartbeat.trackSessionEnd(),this._mediaObject.data["a.videoId"]=t.segmentId,this._mediaObject.data["a.name"]=t.segmentTitle,(e=this._getContentVideoMetadata()).tl=t.segmentTitle,this._mediaHeartbeat.trackSessionStart(this._mediaObject,e),this._mediaHeartbeat.trackPlay())},_isSegmentOwner:function(t){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _isOwner",this._segmentOwner),t.data&&-1<t.data.indexOf("|")&&t.name===this._segmentOwner}}),a=function(){return"undefined"==typeof ADB||"undefined"===l.get(ADB,"va.Heartbeat")},o=function(t){return l.isObject(t)&&!l.isEmpty(t)&&l.isFunction(t.isReadyToTrack)}}(uvpjs.register("uvpjs")),t=uvpjs.register("uvpjs"),d=t._,g="*null",v={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"},t.ComScoreAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.streamingTag=null,this._isAd=!1,this._mc=null},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null,this._mc=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._mc=uvpjs.mediaCapabilities,this._loadConfigData(),this._initializePlugin()},_loadConfigData:function(){var t=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:t("c2")||"3005086",ns_st_pu:t("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.RESOURCE_START]=this._onResourceStart.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),e[t.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){o()?this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."):this._setupEventCallbacks()},_createStreamingTag:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",t),this.streamingTag=new ns_.ReducedRequirementsStreamingAnalytics(t)},_getContentMetadata:function(){var t,e,i=this.cviModel.getContentVideoState(),s=(this.cviModel.getContentPlaybackState(),uvpjs.util),n=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),r=this.cviModel.getContentVideoState().isLive,a=parseInt(i.episodeNumber),o=parseInt(i.seasonNumber),d=(i.seriesTitle,i.videoTitle),l=d&&d.split("-")[1],u=!isNaN(a),h=!isNaN(o),c=null!==i.contextMetadata&&i.contextMetadata.comscore_c4,d=d;u&&h&&(t=$(a),d+="--"+(e=$(o))+t);var p={ns_st_ci:s.getDefinedString(i.cmsRefGuid,i.mediaId,"0"),ns_st_cl:r?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[v.publisherBrand],ns_st_pr:s.getDefinedString(i.seriesTitle,i.videoTitle),ns_st_ep:l,ns_st_sn:h&&e||g,ns_st_en:u&&t||g,ns_st_ge:i.category||g,ns_st_ia:r?1:0,ns_st_ddt:g,ns_st_tdt:g,ns_st_st:n("c4")||g,ns_st_ce:i.episodeFlag?1:0,c3:n("c3")||this._playerName,c4:c||n("c4")||g,c6:n("c6")||d};return["ns_st_ge","ns_st_st","ns_st_pu","ns_ap_an","ns_st_ddt","ns_st_tdt"].forEach(function(t){var e=n(t);e&&(p[t]=e)}),p},_onAdStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",t),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",t),this._isAd=!1,this._trackStop()},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",t);t=ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?t.Live:t.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",t),this._trackStop()},_onControlPlay:function(t){return this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",t),this.streamingTag?this._isAd?void this._trackAdPlay():void this._trackContentPlay():void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized"))},_onControlPause:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",t),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",t),this.streamingTag=null},_onLiveSegmentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",t),this._isLiveEvent(t)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=t.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",t),this._trackStop()},_onVideoProgress:function(t){this._shouldTrackPlayStart&&(this._trackContentPlay(),this._shouldTrackPlayStart=!1)},_onVideoStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange",t);var e=t.payload.newState;this._mc.isMobile()&&this._mc.isIOS()&&this.cviModel.isFullscreen&&(e===this._mc.PAUSED?this._onControlPause(t):e===this._mc.PLAYING&&this._onControlPlay(t))},_trackAdPlay:function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this._adMetadata,this._adType)},_trackContentPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=t.util.copyObjectWithKeyMap(v).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(t){return this.cviModel.getContentVideoState().isLive&&t.payload&&t.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof t.payload.liveSegmentData},_isSameLiveStation:function(t){return t.stationTitle===this._contentMetadata[v.stationTitle]},_getAdType:function(){var t=ns_.ReducedRequirementsStreamingAnalytics.AdType,e=this.cviModel.getAdVideoState().adClipID.split("_")[0],e="pre"===e?t.LinearOnDemandPreRoll:"mid"===e?t.LinearOnDemandMidRoll:t.LinearOnDemandPostRoll;return e=this.cviModel.getContentVideoState().isLive?t.LinearLive:e}}),o=function(){return"undefined"==typeof ns_||d.isUndefined(ns_.ReducedRequirementsStreamingAnalytics)},function(t){"use strict";t.ConvivaAgent=uvpjs.Class.subClass({init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",t),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.hasConvivaAdSession=!1,this.hasConvivaAdPaused=!1,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.isSeekPending=!1,this.isSeekDone=!1,this.currAdPodInfo=null,this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.adPodInProgress=!1,this.startEvents={ad:0,content:0},this.podCount=0,this.adEventHandlerMap=null,this.contextMetadata=this.trackingMgr.contextMetadata||{}},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null,this.contextMetadata=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this._initializePlugin()},_initializePlugin:function(){var t,e;void 0!==window.Conviva?(t=this.eventTypes,(e=this.adEventHandlerMap={})[t.AD_POD_START]=this.hPodStart.bind(this),e[t.AD_POD_END]=this.hPodEnd.bind(this),e[t.AD_LOADED]=this.hAdLoaded.bind(this),e[t.AD_START]=this.hAdStart.bind(this),e[t.AD_END]=this.hAdEnd.bind(this),e[t.AD_ERROR]=this.hAdError.bind(this),e[t.AD_BUFFERING]=this.hAdBuffering.bind(this),this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient&&(this._setupEventCallbacks(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client.")))):this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: Conviva SDK not properly loaded.")},_getAdType:function(t){var e="string"==typeof t?t.toLowerCase():null,i=Conviva.Client.AdPosition,t=uvpjs.ConvivaAgent.adPositions;return!e||0<=e.indexOf(t.PRE)?i.PREROLL:0<=e.indexOf(t.MID)?i.MIDROLL:0<=e.indexOf(t.POST)?i.POSTROLL:void 0},_getArgsForStartAd:function(t){var e=Conviva.Client.AdStream,i=Conviva.Client.AdPlayer,s="ima"==t.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(t.adType),stream:s?e.SEPARATE:e.CONTENT,player:s?i.SEPARATE:i.CONTENT}},_onAdEvent:function(t){var e=t.type;this.startEvents.content=0,this.hasConvivaSession||e===this.eventTypes.AD_ERROR||this._createConvivaSession(),this.adEventHandlerMap[e](t.payload,t)},hPodStart:function(t,e){this.podCount++,this._onContentPaused(e),this.currAdPodInfo=this._buildAdPodInfo(t.adPod),this.adPodInProgress=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo);t=this._getArgsForStartAd(t);this.convivaClient.detachPlayer(this.convivaSessionKey),this.convivaClient.adStart(t.key,t.stream,t.player,t.pos),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad Start",t),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_START",this.currAdPodInfo)},hAdLoaded:function(t,e){t=this._buildAdInfo(t);this.hasConvivaAdSession&&this._killConvivaAdSession(),this.convivaAdSessionKey=this.convivaClient.createAdSession(this.convivaSessionKey,t),this.convivaAdPlayerStateManager=this.convivaClient.getPlayerStateManager(),this._attachPlayerToAdSession(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_LOADED, created Ad Session with key:",this.convivaAdSessionKey)},hAdStart:function(t,e){this.adPodInProgress&&this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.startEvents.ad=1,this.convivaAdPlayerStateManager.setBitrateKbps(this.cviModel.getAdVideoState().adBitrate),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING))},hAdEnd:function(t,e){this.startEvents.ad=0,this._killConvivaAdSession()},hPodEnd:function(t,e){var i=this.currAdPodInfo||{},s=this.convivaSessionKey;this.adPodInProgress=!1,uvpjs.util.isEmpty(s)||s===Conviva.Client.NO_SESSION_KEY?this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad end - no session key"):(this.convivaClient.adEnd(this.convivaSessionKey),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_END")),this._sendCustomEvent("Conviva.PodEnd",i),this.currAdPodInfo=null,this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_END")},hAdError:function(t,e){t=t.errorInfo;this.hasConvivaAdSession?(this._sendError(t.errorCode,Conviva.Client.ErrorSeverity.FATAL,!0),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: actionable ad error",t)):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: non-actionable ad error",t)},hAdBuffering:function(t,e){this.hasConvivaAdSession?(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_BUFFERING")):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad buffering - no session key")},_onContentEvent:function(t){var e=!1;this.startEvents.ad=0,t.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),this.hasConvivaSession||this._createConvivaSession(),e=!0):t.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,this.hasContentStarted=e=!0,this._killConvivaAdSession()),e&&(this.adPodInProgress=!1,this.currAdPodInfo=null)},_onContentPaused:function(t){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED)},_onContentPlaying:function(t){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING)},_onContentBuffering:function(t){this.isSeekPending||this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING)},_onControlSeek:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onControlSeek",t),this.convivaPlayerStateManager.setPlayerSeekStart(Math.floor(1e3*t.payload.seekTime))),this.isSeekPending=!0},_onSeekDone:function(t){this.isSeekPending&&this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onSeekDone",t),this.convivaPlayerStateManager.setPlayerSeekEnd()),this.isSeekPending=!1,this.isSeekDone=!0},_onVideoProgress:function(t){this.isSeekDone&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent play after seek",t),this._onContentPlaying(t),this.isSeekDone=!1)},_onVideoEvent:function(t){var e=this.eventTypes;switch(t.type){case e.VIDEO_STATE_CHANGE:var i=t.payload.newState,s=this._getMediaCapabilities();this.hasConvivaAdSession?i===s.PLAYING&&this.hasConvivaAdPaused?this._onAdResume(t):i===s.PAUSED&&this._onAdPaused(t):this.hasConvivaSession&&(i===s.PLAYING?this._onContentPlaying(t):i===s.PAUSED?this._onContentPaused(t):i===s.BUFFERING&&this.hasContentStarted&&this._onContentBuffering(t));break;case e.VIDEO_TRANSITION_COMPLETE:case e.VIDEO_DONE:this._onVideoTransition(t);break;case e.RESOURCE_END:this._killConvivaSession()}},_onCdnUpdated:function(t){var e=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY,i=new Conviva.ContentMetadata;i.defaultResource=this._validateStr(t.payload.cdn,""),this.convivaClient.updateContentMetadata(e,i)},_onError:function(t){t=t.payload.errorInfo;t.isFatal?(this.hasConvivaSession||this._createConvivaSession(),this._sendError(t.errorCode,Conviva.Client.ErrorSeverity.FATAL,!1),this._killConvivaAdSession(),this._killConvivaSession()):this._sendError(t.errorCode,Conviva.Client.ErrorSeverity.WARNING,!1)},_attachPlayerToAdSession:function(){this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY?(this.convivaClient.attachPlayer(this.convivaAdSessionKey,this.convivaAdPlayerStateManager),this.hasConvivaAdSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad session created; attaching player",this.convivaAdSessionKey)):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent AdSession creation failed"),this.hasConvivaAdSession=!1)},_onAdPaused:function(t){this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdPaused PAUSED"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED),this.hasConvivaAdPaused=!0)},_onAdResume:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdResume",t),this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING),this.hasConvivaAdPaused=!1)},_onVideoTransition:function(t){t=t.payload.bitrate;this.hasConvivaSession&&this.convivaPlayerStateManager&&(0<t&&(t*=.001),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onVideoTransition",t),this.convivaPlayerStateManager.setBitrateKbps(t))},_onContextMetadata:function(t){this.contextMetadata=t.payload.contextMetadata||{}},_createConvivaSession:function(){var t,e;this.convivaClient&&(e=this.cviModel,this._getMediaCapabilities(),Conviva.PlayerStateManager.PlayerState,t={userId:e.getSessionOption("userId"),userPPID:e.getSessionOption("userPPID"),userStatus:e.getSessionOption("userStatus")},e=new Conviva.ContentMetadata,this._setContentMetadata(e,t),this.convivaSessionKey=this.convivaClient.createSession(e),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.hasConvivaSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created"))},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&(this.convivaPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager)),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.adPodInProgress=!1,this.currAdPodInfo=null,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed"))},_killConvivaAdSession:function(){this.hasConvivaAdSession&&this.convivaClient&&this.convivaAdSessionKey&&this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _killConvivaAdSession"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaAdPlayerStateManager),this.convivaClient.cleanupSession(this.convivaAdSessionKey),this.convivaAdPlayerStateManager=null,this.hasConvivaAdSession=!1)},_sendCustomEvent:function(t,e){var i=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY;this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _sendCustomEvent",t,e),this.convivaClient&&this.convivaClient.sendCustomEvent(i,t,e)},_sendError:function(t,e,i){var s;this.hasConvivaSession&&(s="",t=uvpjs.mapErrorCode(t).toString(),!0===i?(s=" AD",this.convivaClient.reportError(this.convivaAdSessionKey,t,e)):this.convivaPlayerStateManager.sendError(t,e),this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sent"+s+" ERROR: "+t))},_setConvivaPlayerState:function(t){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _setConvivaPlayerState",t),this.convivaPlayerStateManager.setPlayerState(t))},_setContentMetadata:function(t,e){var i=this.cviModel,s=Conviva.ContentMetadata.StreamType,n=i.contentVideoState,r=n.defaultBitrate;t.applicationName=this.playerName,t.assetName=this._validateStr(n.videoTitle,"N/A"),t.defaultBitrateKbps=r&&0<r?r:700,t.defaultResource=this._validateStr(n.cdn,""),t.duration=n.duration,t.streamType=n.isLive?s.LIVE:s.VOD,t.streamUrl=this._validateStr(n.assetURL,"N/A"),t.viewerId=this._validateStr(e.userId,"N/A"),t.custom={accessType:this._validateStr(e.userStatus,"anon"),contentId:this._validateStr(n.cmsRefGuid,"N/A"),contentType:n.isLive?"Live":"VOD",isEpisode:n.episodeFlag?"true":"false",Partner_ID:this._validateStr(i.getSessionOption("partner"),"N/A"),Player_Version:uvpjs.Configuration.version,seriesTitle:this._validateStr(n.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._getEpisodeTitle(n),appRegion:this._validateStr(i.sessionOptions.userCountry,"us"),app:uvpjs.Configuration.name,appVersion:uvpjs.Configuration.name+" "+uvpjs.Configuration.version,drm:n.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(n.drm),showId:this.contextMetadata.showId&&this._validateStr(this.contextMetadata.showId.toString(),""),connectionType:this._validateStr(i.sessionOptions.userConnectionType,"unknown")}},_getEpisodeTitle:function(t){if(t.isLive)return t.videoTitle||t.episodeTitle;t=this._validateStr(t.episodeTitle,t.videoTitle);return(t=-1<t.search(/\w+.*-.*\w+/)?t.split("-")[1]:t).replace(/^\s+|\s+$/g,"")},_getWinDimension:function(){var t=this.cviModel.contentVideoState.sourceWidth,e=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(t=window.screen.width),window.screen.height&&(e=window.screen.height)),t+"x"+e},_createConvivaClient:function(){var t=this._getConvivaClientSettings();return t?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new Conviva.Client(t,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var t,e=this.moduleParams;return this._isValidStr(e.customerKey)&&this._isValidStr(e.serviceUrl)?((t=new Conviva.ClientSettings(e.customerKey)).heartbeatInterval=e.heartbeatInterval||this.defaultHeartbeatInterval,t.gatewayUrl=e.serviceUrl,t):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(t){var e="development"===uvpjs.Configuration.env,i=Conviva.SystemSettings.LogLevel;t.allowUncaughtExceptions=e,t.logLevel=e?i.WARNING:i.NONE},_createConvivaSystemFactory:function(){var t=new Conviva.SystemInterface(new uvpjs.ConvivaHtml5Time,new uvpjs.ConvivaHtml5Timer,new uvpjs.ConvivaHtml5Http,new uvpjs.ConvivaHtml5Storage,new uvpjs.ConvivaHtml5Metadata,new uvpjs.ConvivaHtml5Logging),e=new Conviva.SystemSettings;return this._setConvivaSystemProps(e),new Conviva.SystemFactory(t,e)},_buildAdPodInfo:function(t){var e,i={};return uvpjs.ConvivaAgent.adPositions,t?(void 0!==t.podDuration&&(i.podDuration=String(t.podDuration)),t.adPodId&&(e=(e=t.adPodId.split("_")[0].toLowerCase()).charAt(0).toUpperCase()+e.slice(1),t=String(t.imaPodIndex+1),i.podPosition=e+"-roll",i.podIndex=this.podCount,i.absoluteIndex=t),i):null},_buildAdInfo:function(t){var e=new Conviva.ContentMetadata,i=t.adData,s=t.imaAdData||{},n=this.cviModel.getSessionOption("partner");if(!t)return null;e.adTitle="("+i.adVideoId+")"+i.adVideoTitle,e.assetName=e.adTitle,e.adClipId=this._validateStr(i.adClipID,"N/A"),e.Partner_ID=this._validateStr(n,"N/A"),e.adServerName=this._validateStr(i.adServerName,"N/A"),e.streamUrl=this._validateStr(i.adAssetUrl,"N/A"),e.duration=i.duration,e.streamType=Conviva.ContentMetadata.StreamType.VOD;n=i.adType;return e.custom={"c3.ad.technology":"Client Side","c3.ad.id":s.adId||i.adVideoId,"c3.ad.system":s.adSystem||i.adServerName,"c3.ad.position":n.charAt(0).toUpperCase()+n.substr(1)+"roll","c3.ad.mediaFileApiFramework":s.apiFramework,"c3.ad.sequence":(s.adPodInfo||i).adPosition,"c3.ad.creativeId":s.creativeId||i.creativeId,"c3.ad.advertiser":s.advertiserName},this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _buildAdInfo",e),e},_isValidStr:function(t){return uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_isDynamicStreaming:function(t){t=t.split("?");return"mp4"===t[0].substr(t[0].lastIndexOf(".")+1)?"false":"true"},_getMediaCapabilities:function(){return uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var t,e=this.cviModel.getModule(this.moduleName).params,i=e.length,s={};i--;)s[(t=e[i]).name]=t.value;this.moduleParams=s},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onAdEvent.bind(this),s=this._onContentEvent.bind(this),n=this._onVideoEvent.bind(this),r=this._onError.bind(this);e[t.AD_POD_START]=i,e[t.AD_LOADED]=i,e[t.AD_START]=i,e[t.AD_END]=i,e[t.AD_POD_END]=i,e[t.AD_ERROR]=i,e[t.AD_BUFFERING]=i,e[t.CONTENT_DATA_LOADED]=s,e[t.CONTENT_START]=s,e[t.CONTENT_END]=s,e[t.VIDEO_STATE_CHANGE]=n,e[t.VIDEO_TRANSITION_COMPLETE]=n,e[t.VIDEO_DONE]=n,e[t.RESOURCE_END]=n,e[t.PLAYER_START_ERROR]=r,e[t.VIDEO_START_ERROR]=r,e[t.VIDEO_PLAYBACK_ERROR]=r,e[t.CDN_UPDATED]=this._onCdnUpdated.bind(this),e[t.VIDEO_TRANSITION_START]=this._onVideoTransition.bind(this),e[t.CONTROL_SEEK]=this._onControlSeek.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e),window.addEventListener("beforeunload",function(){this.hasConvivaAdSession&&this._killConvivaAdSession(),this._killConvivaSession()}.bind(this),!1)}}),t.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(uvpjs.register("uvpjs")),function(e){"use strict";e.NielsenAgent=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},adType:{LINEAR:"1",DYNAMIC:"2"},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===uvpjs.Configuration.env&&this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent init",t),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this._initializePlugin()},_initializeParams:function(){var t,e,i,s=this.cviModel,n=this._metadata,r=s.sessionOptions.partner,a=s.getModule(this._moduleName).params,o=a.length,d={};for(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");o--;)""!==(t=a[o]).value&&(d[t.name]=t.value);switch(this._nolggGlobalParams={nsdkv:"511",apn:this._playerName,sfcode:d[this.NIELSEN_SFCODE_PARAM_NAME],apid:d[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:d[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},r){case"chow":e="us-700144",i="c06";break;case"tvcom":e="us-200330",i="c03";break;case"cbs":case"can":e="us-700144",i="c01";break;case"cbssports":case"cbssports_test":e="us-201669",i="c02";break;case"news":e="us-700144",i="c03";break;case"gamespot":e="us-200330",i="c13";break;case"cnettv":e="us-200330",i="c05";break;default:e="us-700144",i="c01"}n.ci=d.clientid||e,n.c6=d.vcid||i,n.iag_sid=d.iag_sid,n.iag_tfid=d.iag_tfid,n.channelName=d.channelName,n.segB=d.segB||"",this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",d,n)},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_POD_START]=this._onAdPodStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),e[t.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){t()?this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded."):(window.NOLBUNDLE&&"function"==typeof window.NOLBUNDLE.nlsQ?this._gg=window.NOLBUNDLE.nlsQ(this._nolggGlobalParams.apid,"_gg"+(new Date).getTime()):(this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams)),this._setupEventCallbacks())},_notifySDK:function(t,e){this._isDisabled()||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",t,e),this._gg.ggPM(t,e))},_onContentDataLoaded:function(t){var e,i,s,n,r,a,o,d=uvpjs.mediaCapabilities.isMobile(),l=this._metadata;t.payload&&(s=0<(e=t.payload.vidState).chapterStartTimes.length?"lf":"sf",n=e.episodeNumber,r=e.seasonNumber,a=e.seriesTitle,o=e.videoTitle,i=e.duration,t=[o,r,n,s].join("|"),""===r&&(r="0"),""===n&&(n="0"),e.isAffiliateFeed&&(l.tv="true"),!e.isLive&&-1!==i||(i=this.NIELSEN_LIVE_VIDEO_DURATION),l.pc=l.ci+l.c6+l.cmsRefGuid,l.c10="plt,"+(d?"MBL":"DSK"),l.sd=i,l.dur=i,l.cg=a,l.tl=t,l.videotype="content",l.guid=e.cmsRefGuid,l.seriestitle=a,l.episodetitle=o,l.isfullepisode=e.episodeFlag?"y":"n",l.crossId1=e.mediaId,l.iag_pgm=o,l.iag_epi=t,l.iag_pd=location.hostname,l.iag_fp=s,l.iag_cte="na",l.iag_oad="na",l.iag_seg=1,this._metadata.adloadtype=e.isLive?this.adType.LINEAR:this.adType.DYNAMIC,this._isRcoTypeDai()&&(this._metadata.adloadtype=this.adType.DYNAMIC),this._metadata.adModel=this._metadata.adloadtype,this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",l))},_onAdStart:function(t){var e,i,s,n,r=this.cviModel.getContentVideoState(),a=t.payload;a&&(this._metadata.hasAds=1,this._adDisplayed=!0,n=uvpjs._.clone(this._metadata),e=(i=(s=a.adData).adClipID.split("_"))[0],t=this.cviModel.getNumberOfAdPods(),a="post"===e?t:++i[1],r=["dav0",r.videoTitle,r.seasonNumber,r.episodeNumber].join("-"),a=[t,a,this._numAdsInPod,i[2]].join("_"),i=s.adVatId,s=s.adVideoUrl,""!==i&&(s+="|"+i),n.videotype=e+"roll",n.iag_cte=s,n.iag_pod=a,n.iag_apt="na",n.tl=r,n.c3="st,a","pre"===e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",n),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,n))},_onAdPodStart:function(t){t=t.payload;t&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",t.adPod.adCount),this._numAdsInPod=t.adPod.adCount)},_onAdEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(t){var e=t.payload;this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),e&&(this._metadata.iag_seg&&this._metadata.iag_seg++,0<(t=t.payload.contentData).duration&&Math.abs(t.duration-this._lastContentSecond)<=5?this._notifySDK(this.events.END,this._lastContentSecond):this._notifySDK(this.events.STOP,this._lastContentSecond))},_onControlPlay:function(t){this._adDisplayed||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(t){var e,t=t.payload;if(t&&!((e=Math.floor(t.currentTime))<0)){if(t.isAd){if(this._lastAdSecond===e)return;this._lastAdSecond=e}else{if(this._lastContentSecond===e)return;this._lastContentSecond=e}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,e)}},_onVideoCuepoint:function(t){var e=t.payload,t=e.data;e.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&t&&"string"==typeof t&&this._notifySDK(this.events.SEND_ID3,t)},_hasAds:function(){var t=this.cviModel.getNumberOfAdPods();return-1===t?2:0===t?0:1},_isDisabled:function(){var t=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===t||!0===t},_isRcoTypeDai:function(){var t=this.cviModel.cviMgr.RPM.currRP;return!(null==t)&&t.rco.type===e.mediaCapabilities.RP_DAI}});var t=function(){return void 0===window.NOLCMB}}(uvpjs.register("uvpjs")),Z=uvpjs.register("uvpjs"),h=Z._,Z.DWAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"//dw.cbsi.com/levt/video/e.gif?",RESUME_BEACON_URL:"//dw.cbsi.com/levt/beacon/e.gif?",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this._playerName=t.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var t=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),t.componentid=this.trackingMgr.componentid,t.device=this._getDevice(),t.mapp=this._playerName,t.part=this.cviModel.getSessionOption("partner"),t.playertime=0,t.siteid=this.trackingMgr.DEFAULT_SITEID,t.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var t=this.cviModel,e=t.getSessionOption("cms"),i=t.getContentVideoState(),s=t.getCurrentPlaybackState(),n=uvpjs.mediaCapabilities,r=this._tags.content,a=this._tags.ad,o=this.trackingMgr;a.adastid=e===o.PLATFORM_CMS?"43":"0",!uvpjs.util.isEmpty(r.medastid)&&0!==r.medastid&&"0"!==r.medastid||(i.isLive?i.isAffiliateFeed?r.medastid="cbsnews"===t.getSessionOption("playerId")?"601":"600":s.isHDStreamLive||n.isChromecast()?r.medastid="601":r.medastid="0":r.medastid=e===o.PLATFORM_CMS?"595":"0",this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",r.medastid,a.adastid))},_loadConfigParams:function(){for(var t,e,i,s=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),n=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],r=n.length;r--;)t=this._getTagType(e=n[r]),i=s(e),h.isUndefined(t)||h.isEmpty(i)||(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",e,i),this._tags[t][e]=i);this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var t,e,i,s=window.DW&&window.DW.pageParams||{};for(t in this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams"),s)s.hasOwnProperty(t)&&(i=s[t],h.isEmpty(i)||(this._pageParams[t]=i,e=this._getTagType(t),h.isUndefined(e)||(this._tags[e][t]=i)));this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var t=this.eventsMgr.eventTypes,e={};e[t.AD_BLOCKED]=this._onAdBlocked.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.AD_ERROR]=this._onAdError.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.SEEK_DONE]=this._onSeekDone.bind(this),e[t.USER_GESTURE]=this._onUserGesture.bind(this),e[t.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(e),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var t=this.trackingMgr.progressEvents,e={};e[t.FIRST_QUARTILE]=this._onProgressEvent.bind(this,t.FIRST_QUARTILE),e[t.MID_QUARTILE]=this._onProgressEvent.bind(this,t.MID_QUARTILE),e[t.THIRD_QUARTILE]=this._onProgressEvent.bind(this,t.THIRD_QUARTILE),e[t.TIMED]=this._onProgressEvent.bind(this,t.TIMED),this.trackingMgr.registerProgressEvents(e)},_sendDWEvent:function(t){var e=this._tags.content,i=e.event,s=i===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),e.gestval=uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:a(this._gestval),i!==this.events.INIT&&(e.playertime=this._getPlayerTime()),e.ts=+new Date,s+=r(e),t&&(s+="&"+r(this._tags.ad)),this.trackingMgr.fireTrackingPixel(s),this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",s),this._gestval={},e.gestval="",e.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var t=window.location,e=uvpjs.mediaCapabilities,i=e.isMobile()?"mobile%20web":"desktop%20web",s=this.cviModel.getSessionOption("userStatus"),n=this.cviModel.getSessionOption("userId"),r=this._tags.content,a=this._pageParams;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,r.event=this.events.INIT,r.mso=this.trackingMgr.mso,r.pageurl=t.href,r.srchost=t.host,r.ursuid=n,r.v16=a.viewguid,r.v17=a.topic,r.v18=a.topicbrcrm,r.v19=a.pagetype,r.v20=a.assetguid,r.v21=e.isChromecast()?"chromecast":i,r.v23=a.rsid,r.v25=h.isEmpty(s)?"anon":s,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(t){var e=this.trackingMgr.progressEvents,i=this._tags.content,s=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",t),t)switch(t){case e.FIRST_QUARTILE:s.pct=25;break;case e.MID_QUARTILE:s.pct=50;break;case e.THIRD_QUARTILE:s.pct=75}i.event=this.events.PLAY,this._sendDWEvent(),delete s.pct}},_onAdBlocked:function(t){this._tags.ad,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(t){var e=this._tags.ad,i=t.payload.adData,s=i.adClipID.split("_");this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",t),this._setCMSDependentValues(),this._setStartTags(t),this._updateTimeTags(),e.adid=h.isEmpty(i.adVideoId)?"999":i.adVideoId,e.adnum=this.cviModel.adNum,e.adtime=0,e.adtitle=i.adVideoTitle,e.adtype=i.isLinear?1:2,e.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),e.adbreak="",e.adpos=s[0],e.adpod=s[1],e.adpodpos=s[2],this._sendDWEvent(!0)},_onAdQuartile:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",t),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(t){var e=t.payload.adData;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",t),this._tags.content.event=this.events.END,this._tags.ad.adtime=e.duration,this._sendDWEvent(!0)},_onAdError:function(t){var e=t.payload.errorInfo.errorCode;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",t),e===uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(t){var e=this.cviModel,i=e.getContentVideoState(),s=this._tags.content,n=this._gestval;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",t),s.event=this.events.START,s.codec=i.fileType,s.distntwrk=e.getSessionOption("netwk"),s.playersz=this._getPlayerSize(),s.sdlvrytype=this._getStreamType(),s.v22=i.cmsRefGuid,s.medid=i.mediaId,s.medlength=this.trackingMgr.getContentLength()/1e3,s.mednum=e.medNum,s.medrls=i.pid,s.medtitle=i.videoTitle,s.contsessid=i.previousSessionId,h.isEmpty(i.contPlayState)||(n.autoplay=i.contPlayState),n.paywall=i.isPaidContent?"1":"0",n.caption_available=i.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",t),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(t),this._sendDWEvent()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var t=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(t.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),t.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(t){var e=t&&t.payload,i=e&&e.seekFromTime,s=e&&e.seekToTime,t=s-i,e=this._tags.content;e.eventdur=Math.floor(Math.abs(t)),e.event=0<t?this.events.FORWARD:this.events.REWIND,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:i,seekToTime:s,seekDuration:t,event:e.event,eventdur:e.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(t){var e,i,s,n,r=this._tags.content,a=this._gestval,o=t.payload.gestureInfo,d=(n=this.cviModel.contentVideoState).elapsedTime,l="",u=uvpjs.Type.Gesture;if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",t),"string"!=typeof o||-1!==o.indexOf("event=")){if(h.isArray(o)){if(o.length<1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");l=o[0]}if(n=this.cviModel.contentVideoState,"string"==typeof o)t=(s=/event=([^&]*)(?:&gestval=(.*))?/.exec(o))[1],s=s[2],r.event=t,r.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr=void 0===s?"":s;else if(l===u.GLOBAL_RESUME||l===u.LOCAL_RESUME)a.prevcomponentid=n.previousSessionId,a.eventdur=0<d?Math.round(d/1e3):0,a.paywall=n.isPaidContent?"1":"0",r.event=this.events.RESUME,r.medtime=n.resumeContentTime;else if(l===u.CONT_CANCEL)a.action=this.events.PROMPT;else switch(r.medtime=this.cviModel.contentPlaybackState.currentTime,l){case u.RELATED_OVERLAY:r.event=u.RELATED_OVERLAY;break;case u.RELATED_CLICK_GESTURE:2<=o.length&&(a.related_pid=o[1]),r.event=u.RELATED_CLICK_GESTURE;break;case u.SHARE_OVERLAY:r.event=u.SHARE_OVERLAY;break;case u.SHARE_NETWORK_GESTURE:2<=o.length&&(a.network=o[1]),r.event=u.SHARE_NETWORK_GESTURE;break;case u.SEND_GESTURE:2<=o.length&&(e=(i=o[1].split(",")).shift(),i=i.join(","),a.sender=e,a.recipient=i),r.event=u.SEND_GESTURE;break;case u.EMBED_GESTURE:r.event=u.EMBED_GESTURE;break;case u.LINK_GESTURE:r.event=u.LINK_GESTURE;break;case u.REPLAY_GESTURE:r.event=u.REPLAY_GESTURE;break;case u.END_CARD_OVERLAY:r.event=u.END_CARD_OVERLAY;break;case u.ERROR_OVERLAY:r.event=u.ERROR_OVERLAY;break;case u.RECOMMEND_NOW:3<=o.length?(a.mediaid=o[1],a.pid=o[2]):(a.mediaid="",a.pid=""),r.event=u.RECOMMEND_NOW;break;case u.RECOMMEND_NEXT:3<=o.length?(a.mediaid=o[1],a.pid=o[2]):(a.mediaid="",a.pid=""),r.event=u.RECOMMEND_NEXT;break;case u.RECOMMEND_CLOSE:r.event=u.RECOMMEND_CLOSE;break;default:return void uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",l)}this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",r),uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",a)),this._sendDWEvent()}else uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.")},_updateTimeTags:function(){this._tags.content.medtime=this.trackingMgr.getContentPlayhead()},_getTagType:function(t){return h.has(this._tags.ad,t)?"ad":h.has(this._tags.content,t)?"content":void 0},_getStreamType:function(){var t=this.cviModel.getContentVideoState(),e=uvpjs.mediaCapabilities,i=t.deliveryType,t=t.isLive;return i===e.STREAMING?t?5:4:i===e.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var t=this._agentStartTime,t=h.isDate(t)&&parseInt((new Date-t)/1e3)||0;return this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",t),t},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsObj:function(){return{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},_getDevice:function(){var t=uvpjs.mediaCapabilities,e=window.screen,e={type:(t.getDevice()||"").toLowerCase(),os:(t.getOS()||"").toLowerCase(),ver:t.getOSVersion(),screensz:[e.width,e.height].join("x")};return a(e)},_getPlayerSize:function(){var t=this.cviModel.getContentVideoState();return[t.sourceWidth,t.sourceHeight].join("x")}}),s=function(t,e,i){var s,n,r=[];for(s in t)t.hasOwnProperty(s)&&(n=h.isUndefined(t[s])?"":encodeURIComponent(t[s]),r.push([s,n].join(e)));return r.join(i)},r=function(t){return s(t,"=","&")},a=function(t){return s(t,":",";")},(Z=uvpjs.register("uvpjs"))._,Z.AkamaiAnalyticsAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,CONFIG_FILE_PATH:"//ma61-r.analytics.edgekey.net/config/beacon-16339.xml?enableGenericAPI=1",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(t){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=t.trackingMgr,this.cviModel=t.cviModel,this.eventsMgr=t.eventsMgr,this._moduleName=t.moduleName,this.buffering=!1,this.akamaiPlugin=null},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this.buffering=!1,this.akamaiPlugin=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this._initializePlugin()},_setupEventCallbacks:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var t=this.eventsMgr.eventTypes,e={};e[t.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),e[t.AD_START]=this._onAdStart.bind(this),e[t.AD_END]=this._onAdEnd.bind(this),e[t.CONTENT_START]=this._onContentStart.bind(this),e[t.AD_QUARTILE]=this._onAdQuartile.bind(this),e[t.CONTENT_END]=this._onContentEnd.bind(this),e[t.CONTROL_PLAY]=this._onControlPlay.bind(this),e[t.CONTROL_PAUSE]=this._onControlPause.bind(this),e[t.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),e[t.RESOURCE_END]=this._onResourceEnd.bind(this),e[t.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(e)},_initializePlugin:function(){var t={};this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),e()?this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded."):(t.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,t.streamHeadPosition=this.getStreamHeadPosition.bind(this),t.streamLength=this.getStreamLength.bind(this),t.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new AkaHTML5MediaAnalytics(t),this._setupEventCallbacks())},setAdMetaData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var t=this.cviModel.adVideoState,e={};e.adTitle=t.adVideoTitle,e.adDuration=t.duration,e.id=t.adVideoId,e.adPartnerId=this.cviModel.sessionOptions.partner,e.adServer=t.adServerName,this.akamaiPlugin.handleAdLoaded(e)},setContentMetaData:function(){var t=this.cviModel,e=t.sessionOptions,i=this.akamaiPlugin,s=t.getContentVideoState(),n=t.getContentPlaybackState();this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),i.setData("viewerId",t.getModuleParam(this._moduleName,"viewerID")),i.setData("partnerId",e.partner),i.setData("playerId",this.trackingMgr.getPlayerName("|")),i.setData("Host",e.host),i.setData("Referrer",e.referrer),i.setData("title",s.title),i.setData("category",s.category),i.setData("subCategory",s.sourceOwner),i.setData("show",s.title),i.setData("contentLength",1e3*n.duration)},getStreamHeadPosition:function(){return this.cviModel.contentPlaybackState.currentTime},getStreamLength:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",t),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(t){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",t.payload),this.akamaiPlugin&&t.payload)switch(t.payload.percent){case 25:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentEnd")},_onControlPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",t),this.akamaiPlugin&&((t=t.payload.newState)!==uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),t===uvpjs.mediaCapabilities.PLAYING&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd()))},_onResourceEnd:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",t),this.akamaiPlugin&&this.akamaiPlugin.handlePlayEnd("Play.End.Detected")},_onQosMetadata:function(t){var e,i;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",t),this.akamaiPlugin&&-1!==t.payload.vendorArray.indexOf(uvpjs.Type.QOSVendor.AKAMAI))for(e in i=t.payload.paramsObj)this.akamaiPlugin.setData(e,i[e])}}),e=function(){return"undefined"==typeof AkaHTML5MediaAnalytics},function(t){"use strict";var i=t._;t.MuxAgent=uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"ec83cce4c209447a2af3d62f2",init:function(t){this.cviModel=t.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",t),this.trackingMgr=t.trackingMgr,this.eventTypes=t.eventsMgr&&t.eventsMgr.eventTypes||null,this.moduleName=t.moduleName,this.playerName=t.playerName,this.playerVersion=t.playerVersion,this.useDefaultProperty=t.useDefaultProperty,this.moduleParams=null,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.muxHLSJSMonitoring=!1,this.muxDashJSMonitoring=!1,this.muxShakaMonitoring=!1,this.mc=uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&(this.muxHLSJSMonitoring?(this.muxHLSJSMonitoring=!1,this.muxMonitor.removeHLSJS()):this.muxDashJSMonitoring?(this.muxDashJSMonitoring=!1,this.muxMonitor.removeDashJS()):this.muxShakaMonitoring,this.muxMonitor.destroy()),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this._initializePlugin()},_isDebugEnabled:function(){if(!this.cviModel)return uvpjs.debug;var t=this._gatherModuleParams(uvpjs.DebugManager.CONFIG_MODULE_NAME);return!!t&&!0===t[uvpjs.DebugManager.configParams.MUX_DEBUG]},_initializePlugin:function(){console.log("[MUX] _initializePlugin"),void 0!==window.mux?this.cviModel&&this._setupEventCallbacks():this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded.")},_createMuxMonitor:function(){this.videoElement=document.getElementById("video_"+this.vidContId);var t=this.cviModel,e=this.moduleParams,t=i.assign({page_type:"",viewer_user_id:t.getSessionOption("userId"),experiment_name:e&&!uvpjs.util.isEmpty(e.experimentName)?e.experimentName:"",sub_property_id:!1!==this.useDefaultProperty||uvpjs.util.isEmpty(e.subPropertyId)?t.getSessionOption("partner"):e.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:t.initTime},this._getMuxVideoData());return this.useDefaultProperty?t.property_key=this.MUX_DEFAULT_PROPERTY_KEY:t.property_key=e.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:t}),this.videoElement.mux},_getMuxVideoData:function(){var t=this.cviModel.contentVideoState;return{video_id:this._validateStr(t.cmsRefGuid,""),video_title:this._validateStr(t.videoTitle,""),video_series:this._validateStr(t.seriesTitle,""),video_producer:"",video_content_type:t.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:t.duration,video_stream_type:t.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(t.cdn,""),video_source_url:this._validateStr(t.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidStr:function(t){return uvpjs.util.isDefinedString(t)},_validateStr:function(t,e){return this._isValidStr(t)?t:e},_onContentEvent:function(t){t.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onPlaybackLibraryLoaded:function(t){if(this.muxMonitor)switch(t.payload.facadeType){case this.mc.HLSJS:this.muxHLSJSMonitoring||(this.muxHLSJSMonitoring=!0,this.muxMonitor.addHLSJS({hlsjs:t.payload.player,Hls:window.Hls}));break;case this.mc.DASHJS:this.muxDashJSMonitoring||(this.muxDashJSMonitoring=!0,this.muxMonitor.addDashJS({dashjs:t.payload.player}));break;case this.mc.SHAKA:this.muxShakaMonitoring}},_onError:function(t){t=t.payload.errorInfo;t&&t.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:t.errorCode,player_error_message:t.message}))},_gatherModuleParams:function(t){var e,i=this.cviModel.getModule(t).params,s={};if(!i)return null;for(var n=i.length;n--;)s[(e=i[n]).name]=e.value;return s},_setupEventCallbacks:function(){var t=this.eventTypes,e={},i=this._onContentEvent.bind(this),s=this._onPlaybackLibraryLoaded.bind(this),n=this._onError.bind(this),r=this._onAdEvent.bind(this);e[t.CONTENT_DATA_LOADED]=i,e[t.PLAYBACK_LIBRARY_LOADED]=s,e[t.PLAYER_START_ERROR]=n,e[t.VIDEO_START_ERROR]=n,e[t.VIDEO_PLAYBACK_ERROR]=n,e[t.AD_ERROR]=n,e[t.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=r,e[t.AD_PLUGIN_CONTENT_RESUME_REQUEST]=r,e[t.AD_LOADED]=r,e[t.AD_START]=r,e[t.VIDEO_STATE_CHANGE]=r,e[t.AD_SKIPPED]=r,e[t.AD_END]=r,e[t.AD_ERROR]=r,e[t.AD_REQUEST]=r,e[t.AD_RESPONSE]=r,e[t.AD_QUARTILE]=r,this.trackingMgr.registerEventCallbacks(e)},_getMuxAdData:function(t){var e=(t.payload.adData||t.payload).adAssetUrl;return{ad_tag_url:t.payload.adCallUrl,ad_asset_url:e}},_dispatchMuxAdEvent:function(t,e){t&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),(e=e||{ad_tag_url:"",ad_asset_url:""}).ad_tag_url||(e.ad_tag_url=""),e.ad_asset_url||(e.ad_asset_url=""),window.mux.emit(this.videoElement,t,e))},_dispatchMuxEvent:function(t){window.mux.emit(this.videoElement,t)},_onAdEvent:function(t){var e=this.eventTypes,i=this.MUX_AD_EVENTS,s=this.MUX_EVENTS;switch(t.type){case e.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(s.PAUSE),this._dispatchMuxAdEvent(i.AD_BREAK_START);break;case e.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(i.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(s.PLAY),this._dispatchMuxEvent(s.PLAYING));break;case e.AD_LOADED:this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(t));break;case e.AD_START:this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(t));break;case e.VIDEO_STATE_CHANGE:if(!t.payload.isAd)return;var n=t.payload.newState,r=t.payload.currentState;n===this.mc.PAUSED?this._dispatchMuxAdEvent(i.AD_PAUSE,this._getMuxAdData(t)):r==this.mc.PAUSED&&n===this.mc.PLAYING&&(this._dispatchMuxAdEvent(i.AD_PLAY,this._getMuxAdData(t)),this._dispatchMuxAdEvent(i.AD_PLAYING,this._getMuxAdData(t)));break;case e.AD_SKIPPED:case e.AD_END:this._dispatchMuxAdEvent(i.AD_ENDED,this._getMuxAdData(t));break;case e.AD_ERROR:this._dispatchMuxAdEvent(i.AD_ERROR,this._getMuxAdData(t));break;case e.AD_REQUEST:this._dispatchMuxAdEvent(i.AD_REQUEST,this._getMuxAdData(t));break;case e.AD_RESPONSE:this._dispatchMuxAdEvent(i.AD_RESPONSE,this._getMuxAdData(t));break;case e.AD_QUARTILE:switch(t.payload.percent){case 25:this._dispatchMuxAdEvent(i.AD_FIRST_QUARTILE,this._getMuxAdData(t));break;case 50:this._dispatchMuxAdEvent(i.AD_MIDPOINT,this._getMuxAdData(t));break;case 75:this._dispatchMuxAdEvent(i.AD_THIRD_QUARTILE,this._getMuxAdData(t))}}}})}(uvpjs.register("uvpjs")),uvpjs.register("uvpjs").OzTamAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,ozTamService:null,ozTamVo:null,mediaInfo:null,isStopped:!1,resumeTime:-1,init:function(t){this.options=t,this.ozTamVo=new uvpjs.OzTamVo(this);t=this.ozTamVo.getConfig();this.ozTamService=new OzTAMService(t.publisherId,t.vendorVersion,t.productionMode,t.verboseLogging,t.useHTTPS),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService",t,this.ozTamService)},initialize:function(){var t=this.options.eventsMgr.eventTypes,e=this.onVideoEvent.bind(this),i={};i[t.RESOURCE_START]=e,i[t.CONTENT_START]=e,i[t.CONTROL_SEEK]=e,i[t.SEEK_DONE]=e,i[t.CONTENT_END]=e,i[t.VIDEO_STATE_CHANGE]=e,i[t.VIDEO_PROGRESS]=e,i[t.USER_GESTURE]=e,this.options.trackingMgr.registerEventCallbacks(i)},onVideoEvent:function(t){var e=this.options.eventsMgr.eventTypes;if(this.ozTamVo.isOzTamOptOut())this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService Opt-out");else switch(t.type){case e.RESOURCE_START:this.onResourceStart(t);break;case e.CONTENT_START:this.onContentStart(t);break;case e.CONTROL_SEEK:this.onSeekStart(t);break;case e.SEEK_DONE:this.onSeekDone(t);break;case e.CONTENT_END:this.onContentEnd(t);break;case e.VIDEO_STATE_CHANGE:this.onVideoStateChange(t);break;case e.VIDEO_PROGRESS:this.onVideoProgress(t);break;case e.USER_GESTURE:this.onUserGesture(t)}},onResourceStart:function(t){this.mediaInfo=this.ozTamVo.getMediaInfo(),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.startSession",this.mediaInfo),this.ozTamService.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},onContentStart:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.beginPlayback"),this.mediaInfo.properties=this.ozTamVo.getPropertyDictionary(),this.ozTamService.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.mediaInfo.properties,this.mediaInfo.mediaType)},onSeekStart:function(t){this.ozTamService.seekBegin()},onSeekDone:function(t){this.ozTamService.seekComplete(),this.isStopped=!0},onContentEnd:function(t){this.ozTamService.complete()},onVideoStateChange:function(t){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(t.payload.newState){case uvpjs.mediaCapabilities.PAUSED:case uvpjs.mediaCapabilities.BUFFERING:this.isStopped||(this.isStopped=!0,this.ozTamService.haltProgress())}},onVideoProgress:function(t){this.isStopped&&(this.isStopped=!1,this.ozTamService.resumeProgress())},onUserGesture:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"startTime",t.payload.startTime),0<t.payload.startTime&&(this.resumeTime=t.payload.startTime)},destroy:function(){this.ozTamVo.destroy(),this.DEBUG_ID=null,this.options=null,this.ozTamService=null,this.ozTamVo=null,this.mediaInfo=null}}),uvpjs.register("uvpjs").DatazoomAgent=uvpjs.TrackingAgent.subClass({metadata:{},init:function(t){this._super(t),this.vo=new uvpjs.DatazoomVo(this),this.sdkEvent=this.vo.Event,this.metadata={},(new uvpjs.CodeLoader).loadScript(this.vo.sdkUrl,this.onSdkReady.bind(this))},onSdkReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent SDK Ready"),this.hasSdk="function"==typeof window.setDatazoomMetadata},sendTrackEvent:function(t,e){if(this.hasSdk){for(var i in this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent "+t),e=e||{})this.metadata[i]=e[i];switch(t){case"content_start":window.setDatazoomMetadata(this.format(this.metadata));break;case"cdn_updated":window.generateDatazoomEvent("CDNChange",this.format(e));break;case"content_complete":this.metadata={}}}},format:function(t){var e,i,s=[];for(e in t)t.hasOwnProperty(e)&&t[e]&&"object"!=typeof t[e]&&((i={})[e]=t[e],s.push(i));return this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent",s),s}}),uvpjs.register("uvpjs").DataModelVo=uvpjs.Class.subClass({agent:null,channelName:null,apiKey:null,contentInfo:{},getApiKey:function(){return this.apiKey},getPersistentData:function(t){var e,i=this.agent.options.cviModel,s=i&&i.getContentVideoState(),n=this.agent.contextMetadata;for(e in(t=t||{}).sessionId=i&&i.sessionId,t.contentAssetId=s&&(s.cmsRefGuid||s.mediaId)||"",t.playheadTime=t.playheadTime||this.getPlayhead(),t.playerTime=this.getPlayerElapsedTime(),n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t},getSessionStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState,n=e.isLive?-1:isNaN(i)?0:i,i=this.getDrmInfo(e.drm);return this.getPersistentData({adAssetId:t.adVideoState.adClipID,adPodId:t.adVideoState.adVideoId||t.adVideoState.adVatId,adType:t.adVideoState.adType,allowConcurrentPlayback:t.sessionOptions.allowConcurrentPlayback,bitrate:s.currentBitrate,channel:this.channelName,cdn:e.cdn,cms:t.sessionOptions.cms,currentIndex:1,"drm.dash.playreadyURL":i.playreadyURL,"drm.dash.widevineURL":i.widevineURL,"drm.enabled":i.enabled,"drm.fairplay.appCertURL":i.appCertURL,"drm.ticket":i.ticket,drmType:this.agent.options.trackingMgr.mc.getDrmType(e.drm),enableMutedAutoplay:t.sessionOptions.enableMutedAutoplay,enableNativeMobileAutoplay:t.sessionOptions.enableNativeMobileAutoplay,enableReplay:t.sessionOptions.enableReplay,enableUnmutedAutoplay:t.sessionOptions.enableUnmutedAutoplay,framerate:s.playbackFramerate,fullScreen:t.isFullscreen,isAutoplay:t.isAutoplay,isMultiCDN:t.cviMgr.RPM.currRP.facade.multiCDNEnabled,isMuteAtPlayStart:t.isMuteAtPlayStart,isMuted:e.isMuted,isSslRequired:-1<window.location.href.search(/^https/),length:n,livestream:e.isLive,liveSyncDurationCount:t.sessionOptions.liveSyncDurationCount,maxBitrate:t.maxBitrate,method:"",minBitrate:t.minBitrate,pageProvidesTealium:t.sessionOptions.usesTealium,pagetype:t.dwPageParams.pagetype,partner:t.sessionOptions.partner,pguid:t.dwPageParams.pguid,playerName:this.agent.options.playerName,quality:"",sound:t.volume,startTime:e.startTime,streamType:e.isLive?"Live":"VOD",title:e.videoTitle,totalLength:n,usesIMA:t.sessionOptions.usesIMA,userConnectionType:t.sessionOptions.userConnectionType,userCountry:t.sessionOptions.userCountry,userIsp:t.sessionOptions.userISP,userPpid:t.sessionOptions.userPPID,userStatus:t.sessionOptions.userStatus,videoPlayer:this.agent.options.playerName})},getContentStartInfo:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=e.duration,s=t.contentPlaybackState.facadeState,i=e.isLive?-1:isNaN(i)?0:i;return this.contentInfo={assetUrl:e.assetURL,assetId:e.cmsRefGuid||e.mediaId,category:e.category,channel:this.channelName,chapterStartTimes:e.chapterStartTimes.join(","),closedCaptionPath:e.closedCaptionPath,cms:t.sessionOptions.cms,cmsRefGuid:e.cmsRefGuid,dfpMediaId:e.dfpMediaId,duration:i,episodeAbstract:e.episodeAbstract,episodeFlag:e.episodeFlag,episode:e.episodeNumber,excludeNielsenTracking:e.excludeNielsenTracking,fileType:e.fileType,genre:e.category,indexPosition:t.contentPlaybackState.currentContentSegment,is360:e.is360,isAffiliateFeed:e.isAffiliateFeed,isEmbedable:e.isEmbedable,isPaidContent:e.isPaidContent,mediaId:e.mediaId,overrideAssetURL:e.overrideAssetURL,program:e.videoTitle.split("-")[0],pguid:t.dwPageParams.pguid,playbackBitrate:s.currentBitrate,playheadTime:this.getContentStartPlayhead(),season:e.seasonNumber,seriesTitle:e.seriesTitle,showPreroll:e.showPreroll,startTime:e.startTime,useWatermark:e.useWatermark,title:e.videoTitle,totalLength:i},this.getPersistentData(this.contentInfo)},getContentCompleteInfo:function(){var t=this.agent.options.cviModel;return this.contentInfo.playbackBitrate=t.contentPlaybackState.facadeState.currentBitrate,this.getPersistentData(this.contentInfo)},getQuartileInfo:function(){return this.agent.options.cviModel.getContentVideoState(),this.getPersistentData()},getQosInfo:function(){var t=this.agent.options.cviModel,e=t.contentPlaybackState,t=t.contentPlaybackState.facadeState;return this.getPersistentData({averageDroppedFPS:e.averageDroppedFPS,bufferLength:e.bufferLength,currentContentSegment:e.currentContentSegment,currentMaxBandwidth:e.currentMaxBandwidth,currentTime:this.getPlayhead(),currentBitrate:t.currentBitrate,droppedFPS:t.droppedFPS,droppedFrames:t.droppedFrames,playbackFramerate:t.playbackFramerate})},getAdBreakInfo:function(){var t=this.agent.options.cviModel,e=t.adVideoState,i=e.adClipID.split("_"),s=1;return"post"===e.adType?s=t.getNumberOfAdPods():"mid"===e.adType&&(s=parseInt(i[1])+1),this.getPersistentData({indexPosition:s,startTime:this.getPlayhead(),title:e.adVideoTitle})},getAdItemInfo:function(){var t=this.agent.options.cviModel.adVideoState;return this.getPersistentData({adCallUrl:t.assetURL||t.adAssetUrl||t.adVideoUrl,adParams:t.adParameters,assetId:t.adVideoId||t.adVatId,indexPosition:t.adPosition,isCustomClickTrackingUsed:t.isCustomClickTrackingUsed,title:t.adVideoTitle,totalLength:t.duration})},getSeekInfo:function(){return this.getPersistentData({seekPosition:this.getPlayhead()})},getPlayhead:function(){return Math.floor(this.agent.options.cviModel.getCurrentPlaybackState().currentTime)},getContentStartPlayhead:function(){var t=this.getPlayhead();return this.agent.options.resumeTime&&0<this.agent.options.resumeTime&&(t=this.agent.options.resumeTime,this.agent.options.resumeTime=-1),t},getPlayerElapsedTime:function(){return parseInt((new Date-this.agent.initTime)/1e3)},getDrmInfo:function(t){return{playreadyURL:t.dash&&t.dash.playreadyURL?t.dash.playreadyURL:"",widevineURL:t.dash&&t.dash.widevineURL?t.dash.widevineURL:"",appCertURL:t.fairplay&&t.fairplay.appCertURL?t.fairplay.appCertURL:"",enabled:t.enabled||!1,ticket:t.ticket||""}},isCompletedMarker:function(){var t=this.agent.options.cviModel.getContentVideoState();return!t.isLive&&this.getPlayhead()>=.95*t.duration},destroy:function(){this.Event=null,this.agent=null,this.channelName=null,this.apiKey=null}}),uvpjs.register("uvpjs").DatazoomVo=uvpjs.DataModelVo.subClass({Event:{SESSION_START:"session_start",CONTENT_START:"content_start",CONTENT_COMPLETE:"content_complete",CDN_UPDATED:"cdn_updated",PAUSE:"pause",STOP:"stop",BUFFER_START:"buffer_start",BUFFER_COMPLETE:"buffer_complete",SEEK_START:"seek_start",SEEK_COMPLETE:"seek_complete",PLAY_RESUME:"resume",SESSION_END:"session_end",AD_BREAK_START:"ad_break_start",AD_BREAK_COMPLETE:"ad_break_end",AD_START:"ad_start",AD_COMPLETE:"ad_end",AD_CLICK:"ad_click",QOS:"qos",FIRST_QUARTILE:"first_quartile",MID_QUARTILE:"mid_quartile",THIRD_QUARTILE:"third_quartile"},sdkUrl:"//platform.datazoom.io/beacon/v1/config?configuration_id=",init:function(t){this.agent=t;t=this.agent.options;this.getModuleParam=t.cviModel.getModuleParam.bind(t.cviModel,t.trackingMgr.DATAZOOM_MODULE_NAME),this.sdkUrl+=this.getModuleParam("configId")}}),uvpjs.register("uvpjs").OzTamVo=uvpjs.Class.subClass({agent:null,init:function(t){this.agent=t;t=this.agent.options;this.getModuleParam=t.cviModel.getModuleParam.bind(t.cviModel,t.trackingMgr.OZTAM_MODULE_NAME)},getConfig:function(){return{publisherId:this.getModuleParam("publisherId"),vendorVersion:this.getVendorVersion(),productionMode:!this.agent.debug,verboseLogging:this.agent.debug,useHTTPS:-1<top.location.href.search(/^https/)}},getVendorVersion:function(){return[this.getModuleParam("platform"),uvpjs.mediaCapabilities.isMobile()?"Mobile-Web":"Desktop-Web",this.agent.options.playerVersion].join("_")},getMediaInfo:function(){var e=this.agent.options.cviModel,t=e.getContentVideoState(),i=t.duration,s=function(){var t=e.getCurrentPlaybackState().currentTime;return 0<this.agent.resumeTime&&(t=this.agent.resumeTime,this.agent.resumeTime=-1),t}.bind(this);return{mediaId:t.ozTamMediaId||t.cmsRefGuid||t.mediaId,url:t.assetURL,mediaDuration:t.isLive?-1:isNaN(i)?0:i,mediaType:t.isLive?"live":"vod",mediaPositionFunction:function(){return s()}}},getPropertyDictionary:function(){var t=this.agent.options.cviModel,e=t.getContentVideoState(),i=t.getSessionOption("userId"),s=this.agent.ozTamService,t={};return e.ozTamMediaId&&(t[s.PROP_ALT_MEDIA_ID]=e.cmsRefGuid||e.mediaId),i&&(t[s.PROP_DEMO1]=i),t},isOzTamOptOut:function(){var t=this.agent.options.cviModel.getContentVideoState();return t.hasOwnProperty("ozTamOptOut")&&t.ozTamOptOut},getValue:function(t){return t.toString().replace(/^\s|\s$/gm,"")||""},destroy:function(){this.agent=null}}),function(e){function i(t){return-1<(t=t.replace(/\s/g,"")).search(/^\/\//)?t:"//"+t}var s={prodUrl:"//sparrow.cbs.com",stageUrl:"//stage-sparrow.cbs.com",path:"/streamer/v1.0/ingest/beacon.json"},n=!1,r=null,a=null;e.BeaconBuilder=uvpjs.Class.subClass({concurrencyBeacon:function(t){return a=s,t&&t.prodUrl&&t.stageUrl&&(a.prodUrl=i(t.prodUrl),a.stageUrl=i(t.stageUrl)),this},queryParams:function(t){return r=e.util.queryStrFromObj(t,!1),this},devMode:function(t){return n=t,this},buildUrl:function(){return null===a?"Unable to build url.":(n?a.stageUrl:a.prodUrl)+a.path+(null===r?"":"?"+r)}})}(uvpjs.register("uvpjs")),Z=uvpjs.register("uvpjs"),n=Z._,Z.FairPlayDRM=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.FAIRPLAY_DRM,DRM_VENDORS:{IRDETO:"irdeto",DRMTODAY:"drmtoday"},KEY_SYSTEMS:{FPS_1_0:"com.apple.fps.1_0"},init:function(t){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=t.drm,this.videoTagRef=t.videoTagRef,this.eventTypes=t.eventTypes,this.errorCallback=t.errorCallback,this.drmVendor=null,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this.loadAppCert(),this.addEvents()},destroy:function(){this.removeEvents(),this.drm=null,this.videoTagRef=null,this.eventTypes=null,this.errorCallback=null,this.appCertData=null,this.initData=null},addEvents:function(){this.onWebKitNeedKeyBound=this.onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1)},removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1),this.onWebKitNeedKeyBound=null},initializeFairPlayCDM:function(){var t=this.getLicenseServerUrl(this.initData),e=this.getId(t);if(this.drmVendor=this.getDRMVendor(t),e){if(!this.videoTagRef.webkitKeys){var i=this.KEY_SYSTEMS.FPS_1_0;if(!WebKitMediaKeys.isTypeSupported(i,"video/mp4"))return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED,null);this.videoTagRef.webkitSetMediaKeys(new WebKitMediaKeys(i))}this.videoTagRef.webkitKeys?(i=this.concatInitDataIdAndCertificate(this.initData,e,this.appCertData),(i=this.videoTagRef.webkitKeys.createSession("video/mp4",i))?(i.contentId=e,i.addEventListener("webkitkeymessage",this.onLicenseRequestReady.bind(this,t),!1),i.addEventListener("webkitkeyadded",this.onKeyAdded.bind(this),!1),i.addEventListener("webkitkeyerror",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR),!1)):this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION,null)):this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS,null)}else this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID,null)},loadAppCert:function(){n.isEmpty(this.drm.fairplay.appCertURL)||(new uvpjs.CodeLoader).loadArrayBuffer(this.drm.fairplay.appCertURL,this.onAppCertLoaded.bind(this),this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD))},onAppCertLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Application certificate has loaded successfully!",t),this.appCertData=new Uint8Array(t.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this.initializeFairPlayCDM()},onWebKitNeedKey:function(t){this.webKitNeedKeyCalled=!0,this.initData=t.initData,this.appCertLoaded&&this.initializeFairPlayCDM()},concatInitDataIdAndCertificate:function(t,e,i){"string"==typeof e&&(e=this.stringToArray(e));var s=0,n=new ArrayBuffer(t.byteLength+4+e.byteLength+4+i.byteLength),r=new DataView(n);new Uint8Array(n,0,t.byteLength).set(t),s+=t.byteLength,r.setUint32(s,e.byteLength,!0),s+=4;t=new Uint8Array(n,s,e.byteLength);return t.set(e),s+=t.byteLength,r.setUint32(s,i.byteLength,!0),s+=4,new Uint8Array(n,s,i.byteLength).set(i),new Uint8Array(n,0,n.byteLength)},onLicenseRequestReady:function(t,e){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM ready to load license request - url: "+t,e);var i=new XMLHttpRequest;i.session=e.target,i.addEventListener("load",this.onLicenseRequestLoaded.bind(this),!1),i.addEventListener("error",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST),!1),i.open("POST",t,!0),this.drmVendor===this.DRM_VENDORS.IRDETO?i.responseType="arraybuffer":this.drmVendor===this.DRM_VENDORS.DRMTODAY&&(i.responseType="text");e="spc="+encodeURIComponent(this.base64EncodeUint8Array(e.message))+"&"+i.session.contentId;(i=this.setRequestHeaders(i)).send(e)},onLicenseRequestLoaded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM license request has loaded!",t);var e=t.target,i=e.session,s=null;n.inRange(e.status,200,400)||this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE,t),this.drmVendor===this.DRM_VENDORS.DRMTODAY?s=this.base64DecodeUint8Array(e.responseText):this.drmVendor===this.DRM_VENDORS.IRDETO&&(s=new Uint8Array(e.response)),i.update(s)},onError:function(t,e){this.debug&&uvpjs.error(this.DEBUG_ID,t,e),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,t)},onKeyAdded:function(t){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM key was added successfully!",t)},getLicenseServerUrl:function(t){var e=null,e=n.isEmpty(this.drm.fairplay.licenseURL)?"https://"+String.fromCharCode.apply(null,new Uint16Array(t.buffer)).split("://")[1]:this.drm.fairplay.licenseURL;return this.appendDRMQueryParams(e)},appendDRMQueryParams:function(t){var e=-1===t.indexOf("?")?"?":"&";return this.drm.sessionId&&(t+=e+"SessionId="+this.drm.sessionId),this.drm.ticket&&(t+="&Ticket="+this.drm.ticket),t},getDRMVendor:function(t){var e=null;return-1!==t.indexOf(this.DRM_VENDORS.DRMTODAY)?e=this.DRM_VENDORS.DRMTODAY:-1!==t.indexOf(this.DRM_VENDORS.IRDETO)&&(e=this.DRM_VENDORS.IRDETO),e},setRequestHeaders:function(t){if(t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!n.isEmpty(this.drm.fairplay.header)){var e,i=this.drm.fairplay.header;for(e in i)t.setRequestHeader(e,i[e])}return t},getId:function(t){t=uvpjs.util.objFromQueryStr(t);return t.ContentId||t.contentId||t.assetId||null},base64EncodeUint8Array:function(t){t=String.fromCharCode.apply(null,t);return btoa(t)},base64DecodeUint8Array:function(t){var e=window.atob(t),s=e.length,n=new Uint8Array(new ArrayBuffer(s));for(i=0;i<s;i++)n[i]=e.charCodeAt(i);return n},stringToArray:function(t){for(var e=new ArrayBuffer(2*t.length),i=new Uint16Array(e),s=0,n=t.length;s<n;s++)i[s]=t.charCodeAt(s);return i}})}();
