!function(){try{var e=window.$MicrosoftMaps8,t=e.Internal,d=(t._CurveColorHelper,t._Debug),l=(t._Dispatcher,t._Gimme),f=t._Helper,i=(t._ObservableObject,e.Point,e.Size),s=(e.GlobalConfig,this&&this.__extends||(_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)})),n=(p.getLineHeight=function(t){var e,i=p._lineHeights[t];return i||((e=(e=p._scratchElement)||(p._scratchElement=f._createElement("div").appendTo(document.body).appendText("X").set_style({visibility:"hidden",position:"fixed",left:"100%",top:"100%","line-height":"100%"}))).set_style({font:t}),i=p._lineHeights[t]=e.get_native_prop("offsetHeight")),i},p.prototype.setGlobalAlpha=function(t){this._context.globalAlpha=t},p.prototype.getGlobalAlpha=function(){return this._context.globalAlpha},p.prototype.save=function(){this._context.save()},p.prototype.restore=function(t){this._context.restore(),!1!==t&&(this._font=null,this._style=this._resetStyle)},p.prototype.getDataURL=function(){return this._canvasElem.toDataURL()},p.prototype.setSize=function(t,e,i){i=i?1:this.getDevicePixelRatio(!0);this._canvasElem.width=t*i,this._canvasElem.height=e*i,this._canvasElem.style.width=t+"px",this._canvasElem.style.height=e+"px",this._context.scale(i,i)},p.prototype.getSize=function(){return new i(this._canvasElem.width,this._canvasElem.height)},p.prototype.clear=function(t,e,i,s,n){var o;e=e||0,i=i||0,s=s||this._canvasElem.width,n=n||this._canvasElem.height,t?(o=this._context.fillStyle,this._context.fillStyle=t,this._context.fillRect(e,i,s,n),this._context.fillStyle=o):this._context.clearRect(e,i,s,n)},p.prototype.setFont=function(t){t!==this._font&&(this._context.font=t,this._font=t)},p.prototype.translate=function(t,e){this._context.translate(t,e)},p.prototype.setStyle=function(t,e){var i;this._style=t,e=e||1,this._context.fillStyle=this._style.fillStyle||"transparent",this._context.strokeStyle=this._style.strokeStyle||"transparent",this._context.lineWidth=Math.round(this._style.lineWidth*f._getFinite(this._style.lineWidthScale,1)*e)||0,this._context.lineCap=this._style.lineCap||"round",this._context.lineJoin=this._style.lineJoin||"round",this._context.setLineDash&&(this._context.setLineDash(p.prepareLineDashes(this._style.dashes,this._context.lineWidth,!0)),this._context.lineDashOffset=Math.round((this._style.dashOffset||0)*this._context.lineWidth)),(i=this._style.fillImage)&&"number"!=typeof i&&(this._context.fillStyle=this._context.createPattern(i,"repeat")),this._style.font&&(t="center",e="middle",1===(i=this._style.horizontalAlignment)?t="left":2===i&&(t="right"),0===(i=this._style.verticalAlignment)?e="bottom":2===i&&(e="hanging"),this._context.textAlign=t,this._context.textBaseline=e),this._context.shadowColor=this._style.shadowColor||"transparent",this._context.shadowBlur=this._style.shadowBlur||0,this._style.shadowOffset&&(this._context.shadowOffsetX=this._style.shadowOffset.x||0,this._context.shadowOffsetY=this._style.shadowOffset.y||0)},p.prototype.getStyle=function(){return this._style},p.prototype.setPrimitive=function(){},p.prototype.hasPrimitives=function(){return!1},p.prototype.setLayer=function(){},p.prototype.getHitTestingData=function(){return null},p.prototype.flush=function(){var t=this._context.shadowColor;this._needsFill&&(this._context.fill(),this._context.shadowColor="transparent"),this._needsStroke&&0<this._style.lineWidth&&0<f._getFinite(this._style.lineWidthScale,1)&&this._context.stroke(),this._needsStroke=this._needsFill=!1,this._context.shadowColor=t,this._context.beginPath()},p.prototype.stroke=function(){var t,e,i,s=this._style,n=s.secondaryLineWidth,o=f._getFinite(s.secondaryLineWidthScale,1);0<n&&0<o&&(e=(t=this._context).strokeStyle,i=t.lineWidth,n*=o,t.setLineDash&&(t.setLineDash(p.prepareLineDashes(s.dashes,n,!0)),t.lineDashOffset=Math.round((this._style.dashOffset||0)*n)),t.strokeStyle=s.secondaryStrokeStyle,t.lineWidth=n,t.stroke(),t.strokeStyle=e,t.lineWidth=i),this._needsStroke=!0},p.prototype.fill=function(){this._needsFill=!0},p.prototype.getImageData=function(t,e,i,s){return this._context.getImageData(t,e,i,s)},p.prototype.getRawContext=function(){return this._context},p.prototype.getRootElement=function(){return this._canvas},p.prototype.getDevicePixelRatio=function(t){return this._devicePixelRatio&&!t||(this._devicePixelRatio=this._rasterDPIScale||window.devicePixelRatio||1),this._devicePixelRatio},p.prototype.putImageData=function(t,e,i,s,n,o,a){"number"==typeof s?this._context.putImageData(t,e,i,s,n,o,a):this._context.putImageData(t,e,i)},p.prototype.drawImage=function(t,e,i,s,n,o,a,r,h,l){var c,_;d.assertNotNull(t,"image"),c=this._context.globalAlpha,o&&(this._context.globalAlpha=o);try{_=this.getDevicePixelRatio(),s&&n&&"number"==typeof a&&"number"==typeof r&&h&&l?this._context.drawImage(t,a,r,h/_,l/_,e||0,i||0,s/_,n/_):s&&n?this._context.drawImage(t,e||0,i||0,s/_,n/_):this._context.drawImage(t,e||0,i||0)}catch(t){}this._context.globalAlpha=c},p.prototype.drawEllipse=function(t,e,i,s){i===s?this._context.arc(t,e,i,0,2*Math.PI,!1):(s=s/.75,this._context.beginPath(),this._context.moveTo(t-i,e),this._context.bezierCurveTo(t-i,e+s,t+i,e+s,t+i,e),this._context.bezierCurveTo(t+i,e-s,t-i,e-s,t-i,e))},p.prototype.lineTo=function(t,e,i,s){var n=this._style.dashes;!this._context.setLineDash&&n&&0<n.length?this._dashedLineTo(t,e,i||0,s||0,n):this._context.lineTo(t,e)},p.prototype.moveTo=function(t,e){this._context.moveTo(t,e)},p.prototype.dispose=function(){this._canvas&&(this._canvas.removeFromParent(),this._canvas.clear(),this._canvas=null),this._canvasElem=null,this._context=null},p.prepareLineDashes=function(t,e,i){var s,n=[];if(t&&0<t.length)for(n=t.slice(0),s=0;s<n.length;s++)n[s]=i?Math.round(n[s]*e):n[s]*e;return n},p.prototype._dashedLineTo=function(t,e,i,s,n){var o,a,r,h,l,c,_;d.assert(n.length%2==0,"Dashes count is odd number"),o=t-i,a=e-s,.005<Math.abs(o)&&(r=a/o);for(var p=new Array(n.length),y=new Array(n.length),u=this._style.lineWidth*f._getFinite(this._style.lineWidthScale,1),g=0;g<n.length;g++){if(c=Math.round(n[g]*u),d.assert(0<c,"Dash length is not positive"),c<1){this._context.lineTo(t,e);break}Math.abs(o)<=.005||200<Math.abs(r)?(p[g]=0,y[g]=0<a?c:-c):Math.abs(r)<.005?(p[g]=0<o?c:-c,y[g]=0):(p[g]=Math.sqrt(c*c/(1+r*r)),o<0&&(p[g]=-p[g]),y[g]=r*p[g])}for(h=Math.sqrt(o*o+a*a),l=!0,g=0;0<h;)(c=n[g%n.length]*u)<h?(i+=p[_=g++%n.length],s+=y[_]):(i=t,s=e),l?this._context.lineTo(i,s):this._context.moveTo(i,s),h-=c,l=!l},p._lineHeights={},p),o=(s(h,c=n),h.prototype.setSize=function(t,e){c.prototype.setSize.call(this,t,e,!0),f._disableSmoothing(this.getRawContext())},h.prototype.stroke=function(){this.getRawContext().stroke()},h.prototype.fill=function(){this.getRawContext().fill()},h.prototype.setPrimitive=function(t){var e,i;t&&(this._currentPrimitiveIndex=this._primitives.length,e=h.decimalToColorString(this._currentLayerIndex,this._currentPrimitiveIndex),(i=this.getRawContext()).fillStyle=i.strokeStyle=e,i.beginPath(),this._primitives.push(t))},h.prototype.hasPrimitives=function(){return!0},h.prototype.setLayer=function(t){d.assertNotNull(t,"layer");var e=t.getId(),i=this._layerIdToIndex[e];i||(this._layers.push(t),this._layerIdToIndex[e]=i=this._layers.length),this._currentLayerIndex=i},h.prototype.getHitTestingData=function(){var t=this.getSize();return new a(this._primitives,this._layers,this.getRawContext().getImageData(0,0,t.width,t.height))},h.prototype.clear=function(){this._primitives=[],this._layers=[],this._layerIdToIndex={},c.prototype.clear.call(this)},h.prototype.drawImage=function(t,e,i,s,n){d.assertNotNull(t,"image"),s=s||t.naturalWidth||t.width,n=n||t.naturalHeight||t.height,this.getRawContext().fillRect(e||0,i||0,s,n)},h.prototype.setStyle=function(t){t.lineWidth&&(this.getRawContext().lineWidth=t.lineWidth+2)},h.decimalToColorString=function(t,e){var i;return d.assert(0<t,"layers is empty"),i=(t-1).toString(16).toUpperCase(),d.assert(i.length<=2,"Hit testing layers number exceeds #FF"),t=1===i.length?"#0"+i+"0000":"#"+i+"0000",i=e.toString(16).toUpperCase(),d.assert(i.length<=4,"Hit testing primitives number exceeds #00FFFF"),t.substring(0,t.length-i.length)+i},h),a=(r.prototype.setResultToArgs=function(t,e,i){var s,n,o,a,r,h;if(d.assertNotNull(i,"args"),t=Math.round(t),e=Math.round(e),!((s=this.getResultIndex(t,e))<0)&&(n=s>>16,(o=65535&s)<this._primitives.length&&n<this._layers.length)){if(l.Browser.is_webkit)return i.primitive=this._primitives[o],void(i.layer=this._layers[n]);for(a=0,r=e-1;r<=e+1;r++)for(h=t-1;h<=t+1;h++)if((h!==t||r!==e)&&this.getResultIndex(h,r)===s&&1<++a)return i.primitive=this._primitives[o],void(i.layer=this._layers[n])}},r.prototype.getResultIndex=function(t,e){var i,s,n=-1;return r.isPointWithinBoundary(t,e,this._imageData.width,this._imageData.height)&&this._imageData&&this._imageData.data&&(0<=(i=4*(this._imageData.width*e+t))&&i+3<this._imageData.data.length)&&(s=this._imageData.data[i],e=this._imageData.data[i+1],t=this._imageData.data[i+2],255===this._imageData.data[i+3]&&(n=(s<<16)+(e<<8)+t)),n},r.isPointWithinBoundary=function(t,e,i,s){return 0<=t&&t<i&&0<=e&&e<s},r);t.CanvasDrawingContext=n,t.HitTestingCanvasDrawingContext=o,t.HitTestingData=a}catch(t){if(!e.logger)throw t;e.logger.logCriticalError(t)}function r(t,e,i){this._primitives=t||[],this._layers=e||[],this._imageData=i}function h(t){t=c.call(this,t)||this;return f._disableSmoothing(t.getRawContext()),t._primitives=[],t._layers=[],t._layerIdToIndex={},t}var c,_;function p(t,e,i){if(this.arrowDrawAccumulator=0,t&&"Singleton"===t.substr(t.length-9))return p[t]=p[t]||new p;this._rasterDPIScale=i,this._canvas=e||f._createElement("canvas"),this._canvasElem=this._canvas[0],this._context=this._canvasElem.getContext("2d"),this._style=this._resetStyle={fillStyle:this._context.fillStyle,strokeStyle:this._context.strokeStyle,lineWidth:this._context.lineWidth}}}.call(window);
