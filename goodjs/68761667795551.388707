const ACTION_START="start",ACTION_STOP="stop",CLOSE_TAB_TRACKING="close tab",FIVE_SECOND_TRACKING="five second play",NEXT_TRACK_TRACKING="next track",PAUSE_TRACKING="pause",PLAY_TRACKING="play",PLAY_COUNT_TRACKING="play count",PLAY_BEFORE_LOAD="play before load",PERCENT_25_TIME="25-percent-time",PERCENT_50_TIME="50-percent-time",PERCENT_75_TIME="75-percent-time",PERCENT_100_TIME="100-percent-time",MAX_PERCENTAGE=100;var audioCurrentTime,audioDuration,audioPercentage,currentEpisode,dataIndex,documentReady,fiveSecondInterval,fiveSecondTimer,isCloseBrowser,isFirstPlay,isPlayedAudio,isPlaying,isProgressBarClicked,isSafari,isSavePlayingCount,isUnloadEventFired,isUpdatingListeningProgress,messageData,newStartTime,playCommandFromEmbed,seekTime,sentDurationPlayed,timeInterval,totalDurationPlayed,threadId,trackedFiveSecond,trackedPlayCountInitial,trackingPlayerSource,trackingPlayerDetail,trackingPlayerMedium,utmAnalytics;function addSource(e){var t=[];return"string"==typeof e?t.push({type:"audio/mpeg",src:e}):void 0!==e.playlist?t.push({type:"application/x-mpegurl",src:e.playlist}):void 0!==e.mp3&&t.push({type:"audio/mp3",src:e.mp3}),t}function executeOnClose(){void 0===playerObject.video.sources||isUnloadEventFired||(isUnloadEventFired=isCloseBrowser=!0,setTimeInterval("stop"),updateDurationPlayed(),sendCompletionRate(),updateListeningProgress(),sendGeneralEventTracking("close tab"),resetPlayer())}function formatTime(e,t){var i,a,n;return"mm:ss"==(t=void 0===t?"mm:ss":t)?(n=e-60*(a=Math.floor(e/60)||0)||0,i=("00"+a).slice(-2)+":"+("00"+n).slice(-2)):"ss"==t&&(e=e.split(":"),i=60*(a=parseInt(e[0]))+(n=parseInt(e[1]))),i}function getPercentageFinished(){var e=Math.round(audioDuration);return Math.round(100*totalDurationPlayed/e)}function initAudioProperties(){clearInterval(timeInterval),clearInterval(fiveSecondInterval),totalDurationPlayed=sentDurationPlayed=fiveSecondTimer=0,trackedPlayCountInitial=trackedFiveSecond=!1,"header"==trackingPlayerMedium&&(trackingPlayerDetail="position "+(parseInt(dataIndex)+1)),currentEpisode=episodes[dataIndex],audioCurrentTime=currentEpisode.current_time,newStartTime=audioCurrentTime,100!=Math.ceil(currentEpisode.time_percentage)&&0!=audioCurrentTime||resetAudioTime(),$(".jsProgramTitle").html(currentEpisode.program_title),$(".jsAudioLink").html(currentEpisode.title);var e=currentEpisode.episode_url+"?"+utmAnalytics;$(".jsAudioLink").attr("href",e)}function initButtonClickListener(){$(".jsPlayButton").click(function(){var e=new Date((new Date).getTime()+6e5);isFirstPlay&&$.isEmptyObject(playerObject.video)?(isFirstPlay=!1,(dataIndex=0)<seekTime&&(episodes[dataIndex].current_time=seekTime),initAudioProperties(),setDetailToCookies(e),Cookies.set("podcast_play_status","play",{domain:kaskusDomain,expires:e,secure:!0}),sendGeneralEventTracking(PLAY_BEFORE_LOAD),playerObject.load(addSource(currentEpisode.source),seekToCurrentTime),positionEpisode()):isPlaying?(episodes[dataIndex].current_time=audioCurrentTime,episodes[dataIndex].time_percentage=audioPercentage,setTimeInterval("stop"),updateDurationPlayed(),sendGeneralEventTracking("pause"),Cookies.set("podcast_play_status","pause",{domain:kaskusDomain,expires:e,secure:!0}),updateListeningProgress(),playerObject.pause(),sentDurationPlayed=0):timeInterval||(100==episodes[dataIndex].time_percentage?resetPlayer():audioCurrentTime=episodes[dataIndex].current_time,updateDurationPlayed(),sendGeneralEventTracking("play"),Cookies.set("podcast_play_status","play",{domain:kaskusDomain,expires:e,secure:!0}),setDetailToCookies(e),setTimeInterval("start"),playerObject.play()),startElement(dataIndex),window.parent.postMessage({command:"show_global_widget",userInteraction:!0},"*")}),$(".jsPlayLink").click(function(){var e=new Date((new Date).getTime()+6e5),t=$(this).attr("data-index");isFirstPlay=!1,trackingPlayerMedium="header",void 0===dataIndex?(resetAllElement(),dataIndex=t,initAudioProperties(),setDetailToCookies(e),Cookies.set("podcast_play_status","play",{domain:kaskusDomain,expires:e,secure:!0}),sendGeneralEventTracking(PLAY_BEFORE_LOAD),playerObject.load(addSource(currentEpisode.source),seekToCurrentTime),positionEpisode(),startElement(dataIndex)):t==dataIndex?$(".jsPlayButton").trigger("click"):(episodes[dataIndex].current_time=audioCurrentTime,episodes[dataIndex].time_percentage=audioPercentage,setTimeInterval("stop"),updateDurationPlayed(),sendCompletionRate(),updateListeningProgress(),sendGeneralEventTracking("close tab"),resetPlayer(),resetAllElement(),dataIndex=t,initAudioProperties(),setDetailToCookies(e),Cookies.set("podcast_play_status","play",{domain:kaskusDomain,expires:e,secure:!0}),sendGeneralEventTracking(PLAY_BEFORE_LOAD),playerObject.load(addSource(currentEpisode.source),seekToCurrentTime),startElement(dataIndex),positionEpisode(dataIndex),setEmbedPlayIcon(isPlaying),window.parent.postMessage({command:"show_global_widget",userInteraction:!0},"*"))}),$(".c-progress__wrap").click(function(e){var t;isProgressBarClicked||(isProgressBarClicked=!0,t=$(this).width(),e=(e=e.pageX-$(this).offset().left)/t*100,e=playerObject.video.duration/100*e,durationPlayed=audioCurrentTime-newStartTime,totalDurationPlayed+=durationPlayed,sentDurationPlayed+=durationPlayed,newStartTime=e,playerObject.seek(e,function(){isProgressBarClicked=!1,updateAudioTime()}))}),$(".jsVolumeBtn").click(function(){return!!playerObject.ready&&(playerObject.mute(),void(playerObject.muted?$(".jsVolumeIcon").css("color","red"):$(".jsVolumeIcon").css("color","#1998ed")))}),$(".jsPodcastWidgetButtonExpand").click(function(){var e={command:"expand_global_widget",episodeListHeight:$(".jsPodcastWidgetEpisodeList").outerHeight()};window.parent.postMessage(e,"*")})}function initMarquee(){var e,t,i,a;0<$(".jsPodcastWidget").length&&0<$(".jsPodcastWidget").outerWidth()&&(a=$(".jsPodcastWidgetDuration").outerWidth(),$(".jsPodcastWidget").hasClass("is-web")?e=$(".jsPodcastWidget").outerWidth()-45-35-30:$(".jsPodcastWidget").hasClass("is-wap")&&(e=$(".jsPodcastWidget").outerWidth()-40-40),$(".jsPodcastWidgetFlex").css("width",e+"px"),$(".jsAudioLink").css("width",""),$(".jsAudioContainer").css("width",""),t=$(".jsAudioTitle .jsAudioLink").first().width(),$(".jsAudioContainer").width()<=t?1<$(".jsAudioLink").length?($(".jsAudioContainer").removeClass("is-running"),i=$(".jsAudioTitle .jsAudioLink").first(),$(".jsAudioTitle").empty(),i.prependTo(".jsAudioTitle"),$(".jsAudioContainer").width(t),initMarquee()):($(".jsAudioContainer").width(t+25),$(".jsAudioLink").width(t+25),$(".jsAudioContainer").addClass("is-running"),$(".jsAudioLink").clone().prependTo(".jsAudioTitle")):1<$(".jsAudioLink").length&&($(".jsAudioContainer").removeClass("is-running"),i=$(".jsAudioTitle .jsAudioLink").first(),$(".jsAudioTitle").empty(),i.prependTo(".jsAudioTitle"),$(".jsAudioContainer").width(t)),a=e-a,$(".jsPodcastWidgetTitleEllipsis").css("width",a-5+"px"))}function initMoreEpisode(){var e;$(".jsMore").click(function(){var e=$(".c-episodes__list").length;$(this).siblings(".c-episodes__container").toggleClass("jsReveal"),$(this).toggleClass("Clicked"),$(this).hasClass("Clicked")?($(this).find(".jsLessText").show(),$(this).find(".jsMoreText").hide(),$(".jsEpList").find(".hide").addClass("reveal"),e<3&&$(".jsReveal").css("height","auto")):($(this).find(".jsLessText").hide(),$(this).find(".jsMoreText").show(),$(".jsEpList").find(".hide.reveal").removeClass("reveal"),e<3&&$(".jsWapCont").css("height","0"))}),$(".jsBtnShare").click(function(e){e.stopPropagation(),$(".jsContentShare").toggleClass("is-show")}),$(document).on("click",function(e){$(e.target).closest(".jsContentShare").length||$(".jsContentShare").removeClass("is-show")}),$(".c-episodes__list").length<3&&$(".jsEpList").css("height","auto"),$(document).on("click",".jsPodcastWidgetButtonExpand",function(){$(this).find("i").toggleClass("fa-chevron-down fa-chevron-up"),$(".jsPodcastWidgetEpisodeList").slideToggle()}),$(window).on("resize",function(){initMarquee()}),initMarquee(),0<$(".l-wrap").find(".c-inpost").length&&0<$(".jsAudioTitle").length&&(e=$(".jsAudioTitle")[0].scrollWidth,$(".jsAudioWrap").width()<e&&($(".jsAudioWrap").addClass("marquee"),$(".jsAudioLink").clone().prependTo(".jsAudioTitle")))}function initPlayer(){totalEpisode=episodes.length;var e={live:!1,splash:!0,audioOnly:!0,clip:{sources:[]}};!isAutoPlay||isFromThread||isSafari||(e.autoplay=!0),isSafari&&(e.clip.hlsjs={safari:!0}),playerObject=flowplayer("#hidden-player",e)}function next(){dataIndex++,currentEpisode=episodes[dataIndex],initAudioProperties();var e=new Date((new Date).getTime()+6e5);setDetailToCookies(e),Cookies.set("podcast_play_status","initial play",{domain:kaskusDomain,expires:e,secure:!0}),sendGeneralEventTracking(PLAY_BEFORE_LOAD),playerObject.load(addSource(currentEpisode.source),seekToCurrentTime),startElement(dataIndex),positionEpisode(dataIndex),setEmbedPlayIcon(isPlaying),window.parent.postMessage({command:"show_global_widget",userInteraction:!0},"*"),$(".c-episodes__list").removeClass("reveal").removeClass("active"),$(".c-episodes__container").find("[data-index='"+dataIndex+"']").addClass("reveal active")}function positionEpisode(){var e=totalEpisode-2;if(totalEpisode<=3)return!1;e=dataIndex<=1?0:e<=dataIndex?e-1:dataIndex-1,$(".c-episodes__container").animate({scrollTop:33*e},"fast")}function resetAllElement(){$(".jsEpisodeItem").each(function(e){$(this).find(".jsVolume").hide(),$(this).find(".jsPlay").show(),$(this).find(".episodeTitle").removeClass("C(c-blue)")})}function resetAudioTime(){newStartTime=audioCurrentTime=0,episodes[dataIndex].current_time=0,episodes[dataIndex].time_percentage=0}function resetPlayer(){timeInterval=clearInterval(timeInterval),fiveSecondInterval=clearInterval(fiveSecondInterval),totalDurationPlayed=sentDurationPlayed=fiveSecondTimer=audioCurrentTime=0,trackedPlayCountInitial=trackedFiveSecond=isSavePlayingCount=!1}function resizeGlobalWidget(){var e={height:$(".l-wrap").outerHeight()+"px",div_id:"podcast_native",class:"podcast"};window.parent.postMessage(JSON.stringify(e),"*")}function savePlayingCount(t=!1){var i="podcast-played-"+currentEpisode.id+userId,a=new Date((new Date).getTime()+6e5),e=Cookies.get(i+"_initial"),n=Cookies.get(i),s="/ajax/save_playing_count";if(isSavePlayingCount||t&&e||!t&&n)return!1;t&&(s+="_initial"),isSavePlayingCount=!0;n=$("#token-"+currentEpisode.id).val();$.post(s,{episode_id:currentEpisode.id,token:n},function(e){isSavePlayingCount=!1,""!=e.token&&$("#token-"+currentEpisode.id).val(e.token),""!=e.total_play_text?(t?(Cookies.set(i+"_initial","true",{domain:kaskusDomain,expires:a,secure:!0}),sendGeneralEventTracking("play count")):Cookies.set(i,"true",{domain:kaskusDomain,expires:a,secure:!0}),episodes[dataIndex].total_play=e.total_play):savePlayingCount(t)})}function seekToCurrentTime(e,t,i){if(timeInterval)return!1;setTimeInterval("start");var a=Math.round(i.duration);episodes[dataIndex].current_time>=a?(audioCurrentTime=0,episodes[dataIndex].current_time=0,episodes[dataIndex].time_percentage=0):audioCurrentTime=episodes[dataIndex].current_time,audioPercentage=(newStartTime=audioCurrentTime)/i.duration*100,playerObject.seek(audioCurrentTime,updateAudioTime)}function sendCompletionRate(){var e=Math.ceil(totalDurationPlayed/playerObject.video.duration*100);25<=(e=100<e?100:e)&&e<50?sendCompletionRateTracking(PERCENT_25_TIME,sentDurationPlayed):50<=e&&e<75?sendCompletionRateTracking(PERCENT_50_TIME,sentDurationPlayed):75<=e&&e<100?sendCompletionRateTracking(PERCENT_75_TIME,sentDurationPlayed):100==e&&sendCompletionRateTracking(PERCENT_100_TIME,sentDurationPlayed)}function sendCompletionRateTracking(e,t){sendEventTracking(e,currentEpisode.title,currentEpisode.program_title,totalDurationPlayed,t)}function sendEventTracking(e,t,i,a,n){if(e!=PLAY_BEFORE_LOAD&&void 0===playerObject.video.sources)return!1;i=episodes[dataIndex].program_title;var s={};("next track"==e&&dataIndex<totalEpisode-1||"close tab"==e||"pause"==e)&&(s.durationPlayed=parseInt(a)),"close tab"==e&&(s.percentageFinished=Math.round(totalDurationPlayed/Math.round(audioDuration)*100));a=t;["next track","pause","play","close tab"].includes(e)&&(a=Math.round(n));i={event:"trackEvent","eventDetails.category":category,"eventDetails.action":e,"eventDetails.label":a,"eventDetails.value":parseInt(n),audioTitle:t,audioId:currentEpisode.id,programName:i,author:currentEpisode.user_id,userID:isNaN(Number(userId))?userId:parseInt(Number(userId)),playerSource:trackingPlayerSource,playerMedium:trackingPlayerMedium,playerDetail:trackingPlayerDetail},i=Object.assign(i,s);if(dataLayer.push(i),0!==Object.getOwnPropertyNames(s).length){var o={};for(index in s)o[index]=void 0;dataLayer.push(o)}}function sendGeneralEventTracking(e){sendEventTracking(e,currentEpisode.title,currentEpisode.program_title,sentDurationPlayed,audioCurrentTime)}function setDetailToCookies(e){Cookies.set("podcast_program",programId,{domain:kaskusDomain,expires:e,secure:!0}),Cookies.set("podcast_episode",currentEpisode.id,{domain:kaskusDomain,expires:e,secure:!0}),Cookies.set("podcast_author",currentEpisode.author,{domain:kaskusDomain,expires:e,secure:!0}),Cookies.set("podcast_is_episode",is_episode,{domain:kaskusDomain,expires:e,secure:!0}),Cookies.set("podcast_is_program",is_program,{domain:kaskusDomain,expires:e,secure:!0})}function setEmbedPlayIcon(e){isFromThread&&void 0!==messageData&&(e={command:"toggle_embed_play_icon",threadFrameId:messageData.threadFrameId,flag:e},window.parent.postMessage(e,"*"))}function setPlayInTabCookies(e){var t=new Date((new Date).getTime()+6e5);Cookies.set("podcast_play_in_tab",e,{domain:kaskusDomain,expires:t,secure:!0})}function setTimeInterval(e){switch(e){case"start":timeInterval=setInterval(updateAudioTime,100),trackedFiveSecond||(fiveSecondInterval=setInterval(updateFiveSecondTrack,100)),setPlayInTabCookies(!0),startPlayingButton(),isPlayedAudio=isPlaying=!0;break;case"stop":timeInterval=clearInterval(timeInterval),trackedFiveSecond||(fiveSecondInterval=clearInterval(fiveSecondInterval)),setPlayInTabCookies(!1),stopPlayingButton(),isPlaying=!1}setEmbedPlayIcon(isPlaying)}function startElement(e){e=$("body").find('[data-index="'+e+'"]');e.find(".jsPlay").hide(),e.find(".jsVolume").show(),e.find(".episodeTitle").addClass("C(c-blue)")}function startPlayingButton(){$(".iconPlay").removeClass("fa-play"),$(".iconPlay").addClass("fa-pause")}function stopPlayingButton(){$(".iconPlay").removeClass("fa-pause"),$(".iconPlay").addClass("fa-play")}function updateAudioTime(){audioCurrentTime=Math.round(playerObject.video.time),audioDuration=Math.ceil(playerObject.video.duration),audioPercentage=playerObject.video.time/audioDuration*100,$(".c-progress__wrap").find(".jsProgressBar").css("width",audioPercentage+"%"),$(".jsPlayerIndicator").css("width",audioPercentage+"%");var e,t=new Date((new Date).getTime()+6e5);Cookies.set("podcast_current_time",audioCurrentTime,{domain:kaskusDomain,expires:t,secure:!0}),playerObject.finished?(e=episodes[dataIndex].duration_seconds-playerObject.video.time,0<(e=Math.max(0,e))&&(audioCurrentTime=playerObject.video.time+e),setTimeInterval("stop"),audioPercentage=100,audioDuration=Math.ceil(audioDuration),episodes[dataIndex].current_time=episodes[dataIndex].duration_seconds,episodes[dataIndex].time_percentage=100,$(".jsCurrentTime").html(formatTime(episodes[dataIndex].current_time)),$(".jsLeftTime").html("00:00"),updateDurationPlayed(),sendCompletionRate(),audioCurrentTime=episodes[dataIndex].current_time,updateListeningProgress(),1<totalEpisode&&totalEpisode-1>dataIndex&&(sendGeneralEventTracking("next track"),resetAllElement(),resetPlayer(),next())):(t=formatTime(audioCurrentTime),e=audioDuration-audioCurrentTime,e=formatTime(Math.round(e)),$(".jsCurrentTime").html(t),$(".jsLeftTime").html(e))}function updateDurationPlayed(){durationPlayed=audioCurrentTime-newStartTime,totalDurationPlayed+=durationPlayed,sentDurationPlayed+=durationPlayed,newStartTime=audioCurrentTime}function updateFiveSecondTrack(){fiveSecondTimer++,trackedPlayCountInitial||isSavePlayingCount||11!=fiveSecondTimer||savePlayingCount(trackedPlayCountInitial=!0),trackedFiveSecond||55!=fiveSecondTimer||(clearInterval(fiveSecondInterval),trackedFiveSecond=!0,fiveSecondTimer=0,sendGeneralEventTracking("five second play",currentEpisode.program_title),isSavePlayingCount||savePlayingCount(!1))}function updateListeningProgress(){if(!isLogin||isUpdatingListeningProgress)return!1;var e,t=Math.floor(audioPercentage);isCloseBrowser&&void 0!==navigator.sendBeacon?((e=new FormData).append("episode_id",currentEpisode.id),e.append("time",audioCurrentTime),e.append("time_percentage",t),navigator.sendBeacon("/update_listening_progress",e)):(isUpdatingListeningProgress=!0,$.ajax({type:"POST",url:"/update_listening_progress",data:{episode_id:currentEpisode.id,time:audioCurrentTime,time_percentage:t}}).done(function(e){isUpdatingListeningProgress=!1}))}function controlGlobalWidget(e){e.origin!=kaskusOrigin&&e.origin!=kaskusWapOrigin||(messageData=e.data,isFromThread&&(threadId=messageData.threadDetail,trackingPlayerDetail=threadId,trackingPlayerMedium="thread"),"hit_play_button"==messageData.command&&isFromThread&&(0<messageData.seek&&(seekTime=messageData.seek),documentReady?$(".jsPlayButton").click():playCommandFromEmbed=!0))}$(document).ready(function(){var e,t;documentReady=!1,fiveSecondTimer=0,isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),trackedPlayCountInitial=trackedFiveSecond=playCommandFromEmbed=isUpdatingListeningProgress=isUnloadEventFired=isSavePlayingCount=isProgressBarClicked=isPlayedAudio=!(isFirstPlay=!(isCloseBrowser=!1)),trackingPlayerMedium="header",trackingPlayerSource=window.location.origin,document.referrer&&(trackingPlayerSource=document.referrer.match(/:\/\/(.[^/]+)/)[1]),initPlayer(),initButtonClickListener(),initMarquee(),initMoreEpisode(),0<seekTime&&!isAutoPlay&&is_episode&&(episodes[0].current_time=seekTime,audioDuration=formatTime(episodes[0].duration,"ss"),e=seekTime/audioDuration*100,t=formatTime(seekTime),i=audioDuration-seekTime,i=formatTime(Math.round(i)),$(".c-progress__wrap").find(".jsProgressBar").css("width",e+"%"),$(".jsPlayerIndicator").css("width",e+"%"),$(".jsCurrentTime").html(t),$(".jsLeftTime").html(i));var i=Cookies.get("podcast_play_in_tab");void 0===i&&(i="false"),!isAutoPlay||isFromThread||isSafari||"true"==i||($(".jsPlayButton").trigger("click"),window.parent.postMessage({command:"show_global_widget",userInteraction:!0},"*")),$(".c-episodes__container").find("[data-index='0']").addClass("reveal active"),$(".jsMore").on("click",function(){resizeWidgetPodcast(),positionEpisode(dataIndex)}),playCommandFromEmbed&&(isFromThread&&(trackingPlayerDetail=threadId,trackingPlayerMedium="thread"),$(".jsPlayButton").click()),documentReady=!0}),window.onbeforeunload=window.onunload=function(e){executeOnClose()},window.addEventListener("message",controlGlobalWidget,!1);
