!function(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=r,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=82)}([function(e,t,r){void 0===(t=function(){"use strict";var t=Math.floor,r=Math.random,h={browserInfo:void 0,debugLevel:0,debugCount:0,debugMax:30,ELEMENT_DEBUG:"debug",ELEMENT_MESSAGES:"messages",ELEMENT_ERRORS:"errors",parseJSON:function(e,t,r){if("object"==typeof e)return e;try{return JSON.parse(e,t)}catch(t){h.error("Error:"+t+" parsing from json: "+e,r)}},stringifyJSON:function(e,t,r,n){if(h.isString(e))return e;try{return JSON.stringify(e,t,r)}catch(t){h.error("Error:"+t+" stringifying to json: "+e,n)}},encodeURIComponent:function(e,t){if(h.isString(e))return decodeURIComponent(e)===e?encodeURIComponent(e):e;h.error("Error: could not uri encode: "+e+"(must be of type string)",t)},getElement:function(e){return document.getElementById(e)||(h.debug("DOM element not found "+e),{value:void 0,checked:void 0,enabled:void 0,textContent:void 0,options:{length:0},style:{},innerHTML:"",src:"",classList:"",click:function(){return null},show:function(){return null},hide:function(){return null},removeChild:function(){return null}})},print:function(e){h._log(e,"messages")},success:function(e){h._log(e,"messages","green")},warning:function(e){h._log(e,"messages","orange")},error:function(e,t){t=t||1,h._log(e,h.ELEMENT_MESSAGES,"red"),h._log(e,h.ELEMENT_ERRORS,"red",t)},debug:function(e){0!==h.debugLevel&&h._log(e,h.ELEMENT_DEBUG)},_log:function(e,t,r,n){switch(h.isObject(e)&&(e=h.stringifyJSON(e,null," ")),r){case"green":e="Success: "+e;break;case"orange":e="Warning: "+e;break;case"red":e="Error: "+e;break;default:r=""}r?console.log("%c"+e,"color:"+r):console.log(e);var i=document.getElementById(t);if(i&&(t===h.ELEMENT_DEBUG&&h.debugCount>h.debugMax&&(i.removeChild(i.firstChild),h.debugCount++),i.innerHTML+="<span"+(r?' style="color:'+r+';">':">")+e+"</span><br>"),1<n)throw new Error(e)},isBool:function(e){return!0===e||!1===e},isIntString:function(e){return h.isString(e)&&h.isInt(Number(e))},isNumber:function(e){return Number(e)===e&&isFinite(e)},isIntInRange:function(e,t,r){return h.isNumber(e)&&t<=e&&e<=r},isInt:function(e){return e===Number(e)&&e%1==0},isUint:function(e){return e===Number(e)&&e%1==0&&0<=e},isString:function(e){return"string"==typeof e||e instanceof String},isFunction:function(e){return"function"==typeof e},isObject:function(e){return!!e&&e.constructor!==Array&&("object"==typeof e||e instanceof Object)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isEmpty:function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},getRandomUint:function(e){return e=h.isUint(e)?e:10,t(r()*e)},getRandomString:function(e,t){var r;switch(e){case 0:r="0123456789";break;case 1:r="0123456789abcdefghijklmnopqrstuvwxyz";break;case 2:r="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";break;default:r="0123456789abcdefghijklmnopqrstuvwxyz"}for(var n="",i=h.getRandomUint,o=h.isUint(t)?t:6,s=r.length,a=0;a<o;a++)n+=r[i(s)];return n},getTime:function(){return(new Date).toISOString()},getKeyByValue:function(t,r){if(h.isObject(t))return Object.keys(t).filter(function(e){return t[e]===r})[0]},enumContainsValue:function(e,t){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&e[r]===t)return!0;return!1},enumToString:function(e){var t,r,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r=e[t],h.isFunction(r)||n.push(e[t]));return n.join()},getVersionText:function(e,t,r){t="Your browser: "+e+" v."+t;return r&&(t+=" (mobile)"),t},getSupportText:function(e,t,r,n){t=h.getVersionText(e,t,r),r="";return 0<n&&(r=t+" is not supported.",1<n&&(r=t+" is not fully supported. ",r+="You may try to use it, but it may show issues. Please report any issues to https://webrtc.live.")),r},createBrowserInfo:function(){var e="";screen.width&&(e+=(screen.width||"")+" x "+(screen.height||""));var t,r=navigator.appVersion,n=navigator.userAgent,i=navigator.appName,o=""+parseFloat(r),s=parseInt(r,10);-1!==(a=n.indexOf("Opera"))&&(i="Opera",o=n.substring(a+6),-1!==(a=n.indexOf("Version"))&&(o=n.substring(a+8))),-1!==(a=n.indexOf("OPR/"))?(i="Opera",o=n.substring(a+4)):-1!==(a=n.indexOf("MSIE"))?(i="Microsoft Internet Explorer",o=n.substring(a+5)):"Netscape"===i&&-1!==(a=n.indexOf("Trident/"))?(i="Microsoft Internet Explorer",o=n.substring(a+8),-1!==(a=n.indexOf("rv:"))&&(o=n.substring(a+3))):"Netscape"===i&&-1!==(a=n.indexOf("Edge/"))?(i="Microsoft Edge",o=n.substring(a+5)):-1!==(a=n.indexOf("Chrome"))?(i="Chrome",o=n.substring(a+7)):-1!==(a=n.indexOf("Safari"))?(i="Safari",o=n.substring(a+7),-1!==(a=n.indexOf("Version"))&&(o=n.substring(a+8)),-1!==n.indexOf("CriOS")&&(i="Chrome")):-1!==(a=n.indexOf("Firefox"))?(i="Firefox",o=n.substring(a+8)):(t=n.lastIndexOf(" ")+1)<(a=n.lastIndexOf("/"))&&(i=n.substring(t,a),o=n.substring(a+1),i.toLowerCase()===i.toUpperCase()&&(i=navigator.appName)),-1!==(a=(o=-1!==(a=(o=-1!==(a=o.indexOf(";"))?o.substring(0,a):o).indexOf(" "))?o.substring(0,a):o).indexOf(")"))&&(o=o.substring(0,a)),s=parseInt(""+o,10),isNaN(s)&&(o=""+parseFloat(r),s=parseInt(r,10));var a=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(r),s=navigator.cookieEnabled;void 0!==navigator.cookieEnabled||s||(document.cookie="testcookie",s=-1!==document.cookie.indexOf("testcookie"));for(var c="Unknown",d=[{os:"Windows XP",regex:/(Windows NT 5.1|Windows XP)/},{os:"Windows Server 2003",regex:/Windows NT 5.2/},{os:"Windows Vista",regex:/Windows NT 6.0/},{os:"Windows 7",regex:/(Windows 7|Windows NT 6.1)/},{os:"Windows 8.1",regex:/(Windows 8.1|Windows NT 6.3)/},{os:"Windows 8",regex:/(Windows 8|Windows NT 6.2)/},{os:"Windows NT 4.0",regex:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{os:"Windows ME",regex:/Windows ME/},{os:"Android",regex:/Android/},{os:"Open BSD",regex:/OpenBSD/},{os:"Sun OS",regex:/SunOS/},{os:"Linux",regex:/(Linux|X11)/},{os:"iOS",regex:/(iPhone|iPad|iPod)/},{os:"Mac OS X",regex:/Mac OS X/},{os:"Mac OS",regex:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{os:"QNX",regex:/QNX/},{os:"UNIX",regex:/UNIX/},{os:"BeOS",regex:/BeOS/},{os:"OS/2",regex:/OS\/2/},{os:"Search Bot",regex:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],u=0,l=d.length;u<l;++u)if(d[u].regex.test(n)){c=d[u].os;break}var p="Unknown";switch(/Windows/.test(c)&&(p=(/Windows (.*)/.exec(c)||[])[1],c="Windows"),c){case"Mac OS X":p=(/Mac OS X (10[\.\_\d]+)/.exec(n)||[])[1];break;case"Android":p=(/Android ([\.\_\d]+)/.exec(n)||[])[1];break;case"iOS":p=(p=/OS (\d+)_(\d+)_?(\d+)?/.exec(r)||[])[1]+"."+p[2]+"."+(0|p[3])}h.browserInfo={screenSize:e,browser:i,browserVersion:o,mobile:a,os:c,osVersion:p,cookiesEnabled:s}}};return h.createBrowserInfo(),h}.apply(t,[]))||(e.exports=t)},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){var r=[r(0),r(6),r(3),r(46),r(87)];void 0===(r=function(n,i,o,s,a){"use strict";var c=n.getTime,d=n.stringifyJSON,r=n.isObject,u=n.isNumber,l=n.isIntInRange,p=n.isString,h=n.isEmpty,f=0,g={_console:{loggers:[],level:i.LOG_LEVEL.INFO},_graylog:{loggers:[],credentials:{accountId:"",accountKey:""},baseUrl:"https://glog1.nanocosmos.de/gelf/"},_globalPrefix:"nanowebrtc",setConfig:function(e){if(console.log(c()+": ["+g._globalPrefix+"][LoggerController] - setConfig("+d(e)+")"),!r(e)||h(e))throw o.TypeNotValidError("config","Object");var t;if(r(e.console)&&(u(e.console.level)&&l(e.console.level,i.LOG_LEVEL.DISABLED,i.LOG_LEVEL.VERBOSE)?g._console.level=e.console.level:(t=o.ValueNotValidError("config.console.level","0|1|2|3|4"),console.error(c()+": ["+g._globalPrefix+"][LoggerController] - setConfig(): "+d(t))),g._console.loggers.forEach(function(e){e._level=g._console.level})),r(e.graylog)){if(!r(e.graylog.credentials)||h(e.graylog.credentials))throw o.TypeNotValidError("config.graylog.credentials","Object");if(!p(e.graylog.credentials.accountId))throw o.TypeNotValidError("config.graylog.credentials.accountId","String");if(0==e.graylog.credentials.accountId.length)throw o.ValueNotValidError("config.graylog.credentials.accountId","1..n characters");if(!p(e.graylog.credentials.accountKey))throw o.TypeNotValidError("config.graylog.credentials.accountKey","String");if(0==e.graylog.credentials.accountKey.length)throw o.TypeNotValidError("config.graylog.credentials.accountKey","1..n characters");g._graylog.credentials.accountId=""+e.graylog.credentials.accountId,g._graylog.credentials.accountKey=""+e.graylog.credentials.accountKey,g._graylog.loggers.forEach(function(e){e._credentials.accountId=g._graylog.credentials.accountId,e._credentials.accountKey=g._graylog.credentials.accountKey})}},create:function(e,t){if(n.enumContainsValue(i.LOGGER_TYPE,t)){var r=void 0;return f++,t===i.LOGGER_TYPE.GRAYLOG?(r=new a(g._globalPrefix,g._console.level,g._graylog.baseUrl,g._graylog.credentials.accountId,g._graylog.credentials.accountKey,f),g._graylog.loggers.push(r)):(r=new s(g._globalPrefix,e,g._console.level,f),g._console.loggers.push(r)),r}t=o.EnumValueNotValidError(t,i.LOGGER_TYPE);console.log(c()+": ["+g._globalPrefix+"][LoggerController] - create(): "+d(t))},delete:function(e){for(var t,r,n=!1,i=0;i<g._console.loggers.length;i++)if(t=g._console.loggers[i],e._id===t._id){g._console.loggers.splice(i,1),n=!0;break}if(n)return n;for(var o=0;o<g._graylog.loggers.length;o++)if(r=g._graylog.loggers[o],e._id===r._id){g._graylog.loggers.splice(o,1),n=!0;break}return n}};return g}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(0)];void 0===(r=function(e){"use strict";function i(e,t,r,n){this.name=e,this.type="NanoError",this.code=t,this.message=r,this.userinfo=n,this.toJSON=function(){return{error:{name:this.name,type:this.type,code:this.errorCode,message:this.message,userinfo:this.userinfo}}}}var r=e.enumToString,e=function(){};return e.GeneralError=function(e){return new i("GeneralError",1e3,e)},e.TypeNotValidError=function(e,t){return new i("TypeNotValidError",1001,'"'+e+'" type not valid',{value:e,expected_type:t})},e.ValueNotValidError=function(e,t){return new i("ValueNotValidError",1002,'"'+e+'" value not valid',{value:e,expected_value:t})},e.EnumValueNotValidError=function(e,t){return new i("EnumValueNotValidError",1003,'"'+e+'" enum value not valid',{value:e,expected_values:r(t)})},e.ObjectNotExistError=function(e,t){return new i("ObjectNotExistError",1004,'"'+e+'" object not exist',{value:e,expected_type:t})},e.FunctionNotDefinedError=function(e){return new i("FunctionNotDefinedError",1005,'"'+e+'" function not defined',{func:e})},e.OperationNotAllowedError=function(e,t){return new i("OperationNotAllowedError",1006,"Operation not allowed, reason: "+t)},e.RequestError=function(e,t){return new i("RequestError",2e3,"",{status:e,statusText:t})},e.WebSocketError=function(e,t){return new i("WebSocketError",3e3,e,{server:t})},e.WrongStateError=function(e){return new i("WrongStateError",3001,"Wrong state",{state:e})},e.CreateWebSocketError=function(e,t){return new i("CreateWebSocketError",3002,e,{server:t})},e.SignInError=function(e){return new i("SignInError",4e3,"Sign in failed",{reason:e})},e.NotSignedInError=function(){return new i("NotSignedInError",4001,"Session not signed in")},e.StartBroadcastError=function(e){return new i("StartBroadcastError",5001,"Starting broadcast failed",{reason:e})},e.BroadcastError=function(e){return new i("BroadcastError",5002,"Broadcast failed",{reason:e})},e.StopBroadcastError=function(e){return new i("StopBroadcastError",5003,"Stopping broadcast failed",{reason:e})},e.DeviceBlockedError=function(e,t){return new i("DeviceBlockedError",6e3,"Media stream received, but no "+(e?e+" ":"")+"data from device"+(t?' "'+t+'". ':". ")+"Device could be in use from another application",{kind:e,label:t})},e.MediaStreamTrackError=function(){return new i("MediaStreamTrackError",6001,"Media stream received, but no tracks",{})},e.MediaStreamNotFoundError=function(){return new i("MediaStreamNotFoundError",6002,"Media stream not found",{})},e.MediaStreamNotRemovedError=function(){return new i("MediaStreamNotRemovedError",6003,"Media stream not removed",{})},e.DevicesNotFoundError=function(){return new i("DevicesNotFoundError",6004,'Devices not set for "getUserMedia"',{})},e.GetUserMediaError=function(e,t){var r=e&&e.constraint?e.constraint:void 0,n=e&&e.name&&!r?e.name:r?"OverconstrainedError":"GetUserMediaError",e=e&&e.message?e.message:"Failed to get user / display media.";return new i(n,6005,e,{constraint:r,retry:t})},e.EnumerateDevicesError=function(e){var t=e&&e.name?e.name:"EnumerateDevicesError",e=e&&e.message?e.message:"Failed to enumerate devices.";return new i(t,6006,e,{})},e.GetDisplayMediaError=function(e,t){return new i(e,6008,t=t||'Failed to call "getDisplayMedia".',{})},e.ServerError=function(e){return new i("ServerError",7e3,"An error has occurred on server side",{reason:e})},e.composeEvent=function(e,t){var r="",n=void 0,i="",o=void 0;switch(e.name){case"GeneralError":r="GeneralError",i=e.message||"General error";break;case"TypeNotValidError":r="TypeNotValidError",i=e.message;break;case"ValueNotValidError":r="ValueNotValidError",i=e.message;break;case"EnumValueNotValidError":r="EnumValueNotValidError",i=e.message;break;case"ObjectNotExistError":r="ObjectNotExistError",i=e.message;break;case"FunctionNotDefinedError":e.userinfo&&e.userinfo.func&&(-1!==e.userinfo.func.indexOf("getUserMedia")?r="GetUserMediaError":-1!==e.userinfo.func.indexOf("getDisplayMedia")?r="GetDisplayMediaError":-1!==e.userinfo.func.indexOf("enumerateDevices")&&(r="EnumerateDevicesError"),i=e.userinfo.func+" not defined");break;case"RequestError":r="RequestError",i=e.message;break;case"WebSocketError":r="RequestError";break;case"WrongStateError":r="WrongStateError",i=e.message;break;case"SignInError":r="SignInError",i=e.message;break;case"NotSignedInError":r="NotSignedInError",i=e.message;break;case"StartBroadcastError":r="StartBroadcastError",i=e.message;break;case"BroadcastError":r="BroadcastError",i=e.message;break;case"StopBroadcastError":r="StopBroadcastError",i=e.message;break;case"DeviceBlockedError":case"MediaStreamTrackError":r="MediaStreamError",i=e.message;break;case"MediaStreamNotFoundError":r="NoStreamError",i="No stream is available for the device.";break;case"MediaStreamNotRemovedError":r="MediaStreamNotRemovedError",i=e.message;break;case"DevicesNotFoundError":r="NoDeviceError",i='No device is available for "getUserMedia".';break;case"GetUserMediaError":case"PermissionDenied":case"NotAllowedError":case"NotReadableError":case"NotFoundError":case"OverconstrainedError":case"AbortError":case"GetMediaError":case"NoDeviceError":case"NoStreamError":r=e.name,i=e.message,n=e.userinfo.constraint,o=e.userinfo.retry;break;case"EnumerateDevicesError":r="EnumerateDevicesError",i=e.message;break;case"ServerError":r="ServerError",i=e.message;break;case"WebrtcServerError":r="WebrtcServerError",i=e.message;break;default:r=e.name||"UnknownError",i=e.message||"Unknown error."}var s={};return s.name=t||e.name,s.data={error:r+": "+i,message:i,text:i,constraint:n,errorType:r,retry:o},s.error={name:e.name,type:e.type,code:e.code,message:e.message,text:e.message,userinfo:e.userinfo},s},e}.apply(t,r))||(e.exports=r)},function(e,t,r){var n=r(12),i=r(114),o=r(115),s=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":(s&&s in Object(e)?i:o)(e)}},function(s,e,a){var c;!function(){"use strict";function e(){}var t=e.prototype,r=this,n=r.EventEmitter;function o(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function i(e){return function(){return this[e].apply(this,arguments)}}t.getListeners=function(e){var t,r,n=this._getEvents();if(e instanceof RegExp)for(r in t={},n)n.hasOwnProperty(r)&&e.test(r)&&(t[r]=n[r]);else t=n[e]||(n[e]=[]);return t},t.flattenListeners=function(e){for(var t=[],r=0;r<e.length;r+=1)t.push(e[r].listener);return t},t.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&((t={})[e]=r),t||r},t.addListener=function(e,t){var r,n=this.getListenersAsObject(e),i="object"==typeof t;for(r in n)n.hasOwnProperty(r)&&-1===o(n[r],t)&&n[r].push(i?t:{listener:t,once:!1});return this},t.on=i("addListener"),t.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},t.once=i("addOnceListener"),t.defineEvent=function(e){return this.getListeners(e),this},t.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},t.removeListener=function(e,t){var r,n,i=this.getListenersAsObject(e);for(n in i)i.hasOwnProperty(n)&&-1!==(r=o(i[n],t))&&i[n].splice(r,1);return this},t.off=i("removeListener"),t.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},t.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},t.manipulateListeners=function(e,t,r){var n,i,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=r.length;n--;)o.call(this,t,r[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?o:s).call(this,n,i);return this},t.removeEvent=function(e){var t,r=typeof e,n=this._getEvents();if("string"==r)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},t.removeAllListeners=i("removeEvent"),t.emitEvent=function(e,t){var r,n,i,o,s=this.getListenersAsObject(e);for(o in s)if(s.hasOwnProperty(o))for(i=(r=s[o].slice(0)).length;i--;)!0===(n=r[i]).once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},t.trigger=i("emitEvent"),t.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},t.emitSimple=function(e,t,r){return this.emitEvent(e,[{name:e||"AnonymousEvent",data:t||{},error:r||{}}])},t.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},t._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},t._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return r.EventEmitter=n,e},void 0===(c=function(){return e}.call(r,a,r,s))||(s.exports=c)}.call(this)},function(e,t,r){void 0===(t=function(){"use strict";return{STREAM_NOMEDIASTREAM:1,STREAM_ACTIVE:2,STREAM_INACTIVE:3,STREAM_ENDED:4,MEDIA_SOURCES:{CAMERA:"camera",SCREEN:"screen"},ELEMENT_TYPES:{VIDEO:"video",AUDIO:"audio"},LOGGER_TYPE:{CONSOLE:"console",GRAYLOG:"graylog"},LOG_LEVEL:{DISABLED:0,ERROR:1,WARNING:2,INFO:3,VERBOSE:4},BROADCAST_STATE:{IDLE:1,INITIALIZED:2,STARTED:3,SIGNALING:4,CONNECTED:5,BROADCASTING:6,RECONNECTING:7,DISCONNECTED:8,FAILED:9,STOPPED:10},CHATPEER_STATE:{IDLE:1,INITIALIZED:2,SIGNALING:3,SIGNALLING_DONE:4,CALLING:5,NEGOTIATION_NEEDED:7,DISCONNECTED:8,FAILED:9,STOPPED:10},SCREEN_CAPTURE_BROWSER:{CHROME:"chrome",FIREFOX:"firefox",SAFARI:"safari"},EVENT_NAMES:{webcast:["SignInSuccess","SignInError","ServerError","SignOutSuccess","SignOutError","SetConfigError","ReceivedServerStats","ReceivedWebRTCStats","StartBroadcastSuccess","StartBroadcastError","BroadcastStatus","BroadcastError","StopBroadcastSuccess","StopBroadcastError","Error","ReceivedDeviceList","GetDevicesError","SetVideoDeviceError","SetAudioDeviceError","GetSelectedVideoDeviceError","GetSelectedAudioDeviceError","GetSelectedDeviceError","StartPreviewSuccess","StartPreviewError","StopPreviewSuccess","StopPreviewError","MuteDeviceError","StreamTrackEnded"],chat:["EnterRoomSuccess","EnterRoomError","LeaveRoomSuccess","LeaveRoomError","InvokeCall","HangUpCall","AnswerCall","DeclineCall","PeerListUpdated","CallIncoming","CallDeclined","CallActive","RemoteStreamError"]}}}.apply(t,[]))||(e.exports=t)},function(e,t,r){var n=r(52),r="object"==typeof self&&self&&self.Object===Object&&self,r=n||r||Function("return this")();e.exports=r},function(e,t){var r=Array.isArray;e.exports=r},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){var n=r(51),i=r(117);e.exports=function(e,t){t=i(e,t);return n(t)?t:void 0}},function(e,t,r){var n=r(146),i=r(34),o=r(147),s=r(148),a=r(149),c=r(4),d=r(54),u=d(n),l=d(i),p=d(o),h=d(s),f=d(a),r=c;(n&&"[object DataView]"!=r(new n(new ArrayBuffer(1)))||i&&"[object Map]"!=r(new i)||o&&"[object Promise]"!=r(o.resolve())||s&&"[object Set]"!=r(new s)||a&&"[object WeakMap]"!=r(new a))&&(r=function(e){var t=c(e),e="[object Object]"==t?e.constructor:void 0,e=e?d(e):"";if(e)switch(e){case u:return"[object DataView]";case l:return"[object Map]";case p:return"[object Promise]";case h:return"[object Set]";case f:return"[object WeakMap]"}return t}),e.exports=r},function(e,t,r){r=r(7).Symbol;e.exports=r},function(e,t,r){var n=r(58),i=r(60),o=r(16);e.exports=function(e){return(o(e)?n:i)(e)}},function(e,t){e.exports=function(t){return function(e){return t(e)}}},function(e,o,s){!function(e){var t=s(52),r=o&&!o.nodeType&&o,n=r&&"object"==typeof e&&e&&!e.nodeType&&e,i=n&&n.exports===r&&t.process,t=function(){try{return n&&n.require&&n.require("util").types||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=t}.call(this,s(36)(e))},function(e,t,r){var n=r(24),i=r(37);e.exports=function(e){return null!=e&&i(e.length)&&!n(e)}},function(e,t,r){var d=r(56),u=r(57);e.exports=function(e,t,r,n){var i=!r;r=r||{};for(var o=-1,s=t.length;++o<s;){var a=t[o],c=n?n(r[a],e[a],a,r,e):void 0;void 0===c&&(c=e[a]),(i?u:d)(r,a,c)}return r}},function(e,o,s){!function(e){var t=s(7),r=s(59),n=o&&!o.nodeType&&o,i=n&&"object"==typeof e&&e&&!e.nodeType&&e,t=i&&i.exports===n?t.Buffer:void 0,r=(t?t.isBuffer:void 0)||r;e.exports=r}.call(this,s(36)(e))},function(e,t,r){var r=[r(5),r(86),r(31),r(0),r(3),r(2)];void 0===(r=function(e,t,n,r,i,o){"use strict";var s=r.stringifyJSON,a=r.isObject,c=r.isString,d={IDLE:1,SIGNED_IN:2,SIGNED_OUT:3,RECONNECTING:4,FAILED:5};function u(){e.call(this),this._sessionId=void 0,this._serverUrl=void 0,this._state=d.IDLE,this._logger=o.create("Session","console"),this._websocketClient=new t}var l=u.prototype=Object.create(e.prototype);return l.isSignedIn=function(){return this._state===d.SIGNED_IN},l.signIn=function(e){if(this._logger.verbose("signIn("+s(e)+")"),this.isSignedIn())return Promise.reject(i.SignInError("Already signed in"));if(!a(e))return Promise.reject(i.TypeNotValidError("data","Object"));if(!e.server||!c(e.server))return Promise.reject(i.TypeNotValidError("data.serverUrl","String"));if(e.bintuApiKey&&!c(e.bintuApiKey))return Promise.reject(i.TypeNotValidError("data.bintuApiKey","String"));if(e.token&&!c(e.token))return Promise.reject(i.TypeNotValidError("data.token","String"));if(e.jwt&&!c(e.jwt))return Promise.reject(i.TypeNotValidError("data.jwt","String"));this._serverUrl=e.server;var t={user_name:"defaultUserName",room:"defaultRoom"};e.bintuApiKey&&(t.bintu_api_key=e.bintuApiKey),e.token&&(t.token=e.token),e.jwt&&(t.jwt=e.jwt),t.api_version=n.webrtc.release_version;var r=this;return this._websocketClient.connect(this._serverUrl,this._onMessage.bind(this)).then(function(){return r._websocketClient.sendMessage("sign_in",t)}).then(function(e){return r._logger.verbose("signIn(): Signed in: "+s(e)),r._sessionId=e.session_id,r._setState(d.SIGNED_IN),{data:{server:r._serverUrl,userId:e.user_id,iceServers:e.ice_servers||void 0}}}).catch(function(e){return r._logger.error("signIn(): "+s(e)),"CreateWebSocketError"!==e.name&&r._websocketClient.close(),Promise.reject(e)})},l.signOut=function(){if(this._logger.verbose("signOut(), sessionId"+this._sessionId),!this.isSignedIn())return Promise.reject(i.NotSignedInError());var t=this;return this._websocketClient.sendMessage("sign_out",{session_id:this._sessionId}).then(function(e){return t._logger.verbose("signOut(): "+e),t.removeAllListeners(),t._sessionId=void 0,t._setState(d.SIGNED_OUT),t._websocketClient.close(),e}).catch(function(e){return t._logger.error("signOut(): "+e),t._websocketClient.close(),t._sessionId=void 0,Promise.reject(e)})},l.echo=function(e){return this._websocketClient.sendMessage("echo",{session_id:this._sessionId,message:e})},l.sendSignalingMessage=function(e){if(this._logger.verbose("sendSignalingMessage("+s(e)+")"),!this.isSignedIn())return Promise.reject(i.NotSignedInError());var t=this;return this._checkPeerMessage(e).then(function(){return t._websocketClient.sendMessage("signaling_message",e)}).catch(function(e){return t._logger.error("sendSignalingMessage(): "+s(e)),Promise.reject(e)})},l.enterRoom=function(e){return this._logger.verbose("enterRoom("+s(e)+"), sessionId: "+this._sessionId),this.isSignedIn()?a(e)?c(e.roomName)?c(e.userName)?this._checkRoomName(e.roomName)?this._websocketClient.sendMessage("enter_room",{session_id:this._sessionId,room_name:e.roomName,user_name:e.userName}):Promise.reject(i.ValueNotValidError("data.room","Alphanumeric characters / underscore (_) / dash (-) / dot (.)")):Promise.reject(i.TypeNotValidError("data.userName","String")):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},l.leaveRoom=function(e){return this._logger.verbose("leaveRoom("+s(e)+"), sessionId: "+this._sessionId),this.isSignedIn()?a(e)?c(e.roomName)?this._websocketClient.sendMessage("leave_room",{session_id:this._sessionId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},l.callUser=function(e){return this._logger.verbose("callUser("+s(e)+")"),this.isSignedIn()?a(e)?c(e.userId)?c(e.roomName)?this._websocketClient.sendMessage("call_user",{session_id:this._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data.userId","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},l.answerCall=function(e){return this._logger.verbose("answerCall("+s(e)+")"),this.isSignedIn()?a(e)?c(e.userId)?c(e.roomName)?this._websocketClient.sendMessage("answer_call",{session_id:this._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data.userId","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},l.declineCall=function(e){return this._logger.verbose("declineCall("+s(e)+")"),this.isSignedIn()?a(e)?c(e.userId)?c(e.roomName)?this._websocketClient.sendMessage("decline_call",{session_id:this._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data.userId","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},l.hangUpCall=function(e){return this._logger.verbose("hangUpCall("+s(e)+")"),this.isSignedIn()?this._websocketClient.sendMessage("hangup_call",{session_id:this._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.NotSignedInError())},l.startBroadcast=function(e){if(this._logger.verbose("startBroadcast("+s(e)+")"),!this.isSignedIn())return Promise.reject(i.NotSignedInError());if(!a(e))return Promise.reject(i.TypeNotValidError("broadcastParams","Object"));e.session_id=this._sessionId;var t=this;return this._websocketClient.sendMessage("start_broadcast",e).catch(function(e){t._logger.error("startBroadcast(): "+s(e));e=e.error;return"WebrtcServerError"===e.name&&(e.type="NanoError"),Promise.reject(e)})},l.stopBroadcast=function(e){if(this._logger.verbose("stopBroadcast("+s(e)+")"),!this.isSignedIn())return Promise.reject(i.NotSignedInError());if(!a(e))return Promise.reject(i.TypeNotValidError("data","Object"));if(!c(e.sender_peer))return Promise.reject(i.TypeNotValidError("data.sender_peer","String"));if(!c(e.receiver_peer))return Promise.reject(i.TypeNotValidError("data.receiver_peer","String"));var t=this;return this._checkPeerMessage(e).then(t._websocketClient.sendMessage("stop_broadcast",{session_id:t._sessionId,sender_peer:e.sender_peer,receiver_peer:e.receiver_peer})).catch(function(e){return t._logger.error("stopBroadcast(): "+s(e)),Promise.reject(e)})},l.sendMetaData=function(e){if(this._logger.verbose("sendMetaData("+s(e)+")"),!this.isSignedIn())return Promise.reject(i.NotSignedInError());var t=this;return this._checkPeerMessage(e).then(t._websocketClient.sendMessage("send_metadata",e)).catch(function(e){return t._logger.error("sendMetaData(): "+s(e)),Promise.reject(e)})},l.status=function(){if(this._logger.verbose("status()"),!this.isSignedIn())return Promise.reject(i.NotSignedInError());var t=this;return this._websocketClient.sendMessage("status",{}).catch(function(e){return t._logger.error("status(): "+s(e)),Promise.reject(e)})},l._onMessage=function(e){var t;if(this._logger.verbose("_onMessage("+JSON.stringify(e)+")"),e){if(e.receiver_peer)return t=e.receiver_peer,void this.emit("receiver_peer_"+t,e);switch(e.type){case"room_update":case"call_incoming":case"call_declined":case"start_as_caller":case"hang_up":return this.emit("RoomMessage",e);case"close":this._state!==d.SIGNED_OUT&&(this.emit("SessionMessage",{type:"close",reason:"disconnect"}),this._setState(d.IDLE));break;default:this._logger.warning("_onMessage(): Unhandled message received: "+e)}}},l._setState=function(e){var t;this._logger.verbose("_setState("+e+")"),e!==this._state&&(t=this._state,this._state=e,t="_setState(): State: "+r.getKeyByValue(d,t)+" -> "+r.getKeyByValue(d,this._state),this._logger.verbose(t))},l._checkPeerMessage=function(e){return this._logger.verbose("_checkPeerMessage("+s(e)+")"),a(e)?e.sender_peer?e.receiver_peer?Promise.resolve():Promise.reject(i.TypeNotValidError("message.receiver_peer","String")):Promise.reject(i.TypeNotValidError("message.sender_peer","String")):Promise.reject(i.TypeNotValidError("message","Object"))},l._checkRoomName=function(e){return/^([a-zA-Z0-9_\-.]{1,})$/gm.test(e)},u}.apply(t,r))||(e.exports=r)},function(e,t,r){var f=r(33),g=r(130),m=r(56),v=r(132),_=r(138),S=r(141),b=r(62),y=r(142),C=r(144),E=r(66),T=r(145),P=r(11),w=r(150),R=r(151),I=r(156),x=r(8),O=r(18),D=r(69),N=r(9),M=r(70),k=r(13),j="[object Arguments]",A="[object Function]",L="[object Object]",U={};U[j]=U["[object Array]"]=U["[object ArrayBuffer]"]=U["[object DataView]"]=U["[object Boolean]"]=U["[object Date]"]=U["[object Float32Array]"]=U["[object Float64Array]"]=U["[object Int8Array]"]=U["[object Int16Array]"]=U["[object Int32Array]"]=U["[object Map]"]=U["[object Number]"]=U[L]=U["[object RegExp]"]=U["[object Set]"]=U["[object String]"]=U["[object Symbol]"]=U["[object Uint8Array]"]=U["[object Uint8ClampedArray]"]=U["[object Uint16Array]"]=U["[object Uint32Array]"]=!0,U["[object Error]"]=U[A]=U["[object WeakMap]"]=!1,e.exports=function r(n,i,o,e,t,s){var a,c=1&i,d=2&i,u=4&i;if(void 0!==(a=o?t?o(n,e,t,s):o(n):a))return a;if(!N(n))return n;var l=x(n);if(l){if(a=w(n),!c)return b(n,a)}else{var p=P(n),e=p==A||"[object GeneratorFunction]"==p;if(O(n))return S(n,c);if(p==L||p==j||e&&!t){if(a=d||e?{}:I(n),!c)return d?C(n,_(a,n)):y(n,v(a,n))}else{if(!U[p])return t?n:{};a=R(n,p,c)}}c=(s=s||new f).get(n);if(c)return c;s.set(n,a),M(n)?n.forEach(function(e){a.add(r(e,i,o,e,n,s))}):D(n)&&n.forEach(function(e,t){a.set(t,r(e,i,o,t,n,s))});var d=u?d?T:E:d?keysIn:k,h=l?void 0:d(n);return g(h||n,function(e,t){h&&(e=n[t=e]),m(a,t,r(e,i,o,t,n,s))}),a}},function(e,t,r){var n=r(103),i=r(104),o=r(105),s=r(106),r=r(107);function a(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}a.prototype.clear=n,a.prototype.delete=i,a.prototype.get=o,a.prototype.has=s,a.prototype.set=r,e.exports=a},function(e,t,r){var n=r(23);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,r){var n=r(4),i=r(9);e.exports=function(e){if(!i(e))return!1;e=n(e);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(e,t,r){r=r(10)(Object,"create");e.exports=r},function(e,t,r){var n=r(126);e.exports=function(e,t){e=e.__data__;return n(t)?e["string"==typeof t?"string":"hash"]:e.map}},function(e,t,r){var n=r(136),i=r(14),r=r(15),r=r&&r.isTypedArray,n=r?i(r):n;e.exports=n},function(e,t){var r=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||r)}},function(e,t,r){var n=r(42);e.exports=function(r){return function(e,t){return"string"==typeof e&&"string"==typeof t||(e=n(e),t=n(t)),r(e,t)}}},function(e,t,r){var n=r(75);e.exports=function(e){var t=n(e),e=t%1;return t==t?e?t-e:t:0}},function(e,t,r){void 0===(t=function(){"use strict";return JSON.parse(JSON.stringify({webrtc:{release_version:"5.9.2"}}))}.apply(t,[]))||(e.exports=t)},function(e,t,r){var r=[r(6),r(0),r(93),r(3),r(5),r(2)];void 0===(r=function(n,t,i,p,r,o){"use strict";var h=t.stringifyJSON,s=t.isObject,d=t.isBool,a=t.isFunction;function c(e){r.call(this),this._medias={local:[],remote:[]},this._constraints={},this._error=void 0,this._deviceController=e,this._logger=o.create("MediaController","console")}var e=c.prototype=Object.create(r.prototype);return c.getSupportedConstraints=function(){var e;return e=navigator.mediaDevices||navigator.mediaDevices.getSupportedConstraints?navigator.mediaDevices.getSupportedConstraints():e},e.getMediaForDevices=function(e,s){this._logger.verbose("getMediaForDevices("+h(e)+", "+s+")");var a="getMediaForDevices(): ",t=void 0,c=this;return new Promise(function(i,o){return c._verifyDevicesExistence(e).then(function(){return t=e.videoinput.videoDeviceConfig?e.videoinput.videoDeviceConfig.source:d(e.videoinput)?n.MEDIA_SOURCES.CAMERA:void 0,c._verifySourceValidity(t)}).then(function(){return c._deviceController.composeConstraints(e)}).then(function(e){return c._constraints=e,c._getMedia(t,e)}).then(function(r){var n=r.data.stream;c._error=void 0,c._reenumerateDevices(s).then(function(e){if(n)return c._deviceController.updateSelected(n,s),i({stream:r,devices:e});var t=c._deviceController._selected.videoinput,e=c._deviceController._selected.audioinput;if(!1!==t||!1!==e){t=p.MediaStreamNotFoundError(),e=p.composeEvent(t);return c._logger.error(a+JSON.stringify(t)),o(e)}})}).catch(function(e){var t=p.composeEvent(e);return c._logger.error(a+JSON.stringify(e)),o(t)})})},e._addLocalMedia=function(e){this._logger.verbose("_addLocalMedia(): "+h(e));try{var t=new i(e)}catch(e){var r=p.composeEvent(e);return this._logger.error("_addLocalMedia(): "+JSON.stringify(e)),Promise.reject(r)}r=t.kind;return this._medias[r].push(t),Promise.resolve(t)},e.addRemoteMedia=function(e){this._logger.verbose("addRemoteMedia("+e+")");try{var t=new i(e)}catch(e){var r=p.composeEvent(e);return this._logger.error("addRemoteMedia(): "+JSON.stringify(e)),Promise.reject(r)}r=t.kind;return this._medias[r].push(t),this._setupMedia(t)},e.removeMedia=function(e){this._logger.verbose("removeMedia("+e+")");for(var t=this.getLocalMedias(),r=0;r<t.length;r++){var n=t[r];n.stream.id===e&&(n.unbind(),t.splice(r,1))}for(var i=this.getRemoteMedias(),r=0;r<i.length;r++){var o=i[r];o.stream.id===e&&(o.unbind(),i.splice(r,1))}},e.removeRemoteMedias=function(){this._logger.verbose("removeRemoteMedias()");for(var e=this._medias.remote,t=0;t<e.length;t++)e[t].unbind(),e.splice(t,1);if(0==e.length)return Promise.resolve({data:{}});var r=p.MediaStreamNotRemovedError();return this._logger.error("removeRemoteMedias(): "+JSON.stringify(r)),Promise.reject(r)},e.removeLocalMedias=function(){this._logger.verbose("removeLocalMedias()");for(var e=this._medias.local,t=0;t<e.length;t++)e[t].unbind(),e.splice(t,1);if(0==e.length)return Promise.resolve({data:{stream:null}});var r=p.MediaStreamNotRemovedError(),n=p.composeEvent(r);return this._logger.error("removeLocalMedias(): "+JSON.stringify(r)),Promise.reject(n)},e.getLocalMedias=function(){return this._logger.verbose("getLocalMedias()"),this._medias.local},e.applyAudioConstraints=function(r){var e="applyAudioConstraints(): ";this._logger.verbose(e+h(r));var n=c.getSupportedConstraints(),t=this.getLocalMedias()[0],i={},o=[];return Object.getOwnPropertyNames(r).forEach(function(e,t){n[e]&&!0===n[e]?i[e]=r[e]:o.push(e)}),0!==o.length&&this._logger.warning(e+"constraint(s) not supported: "+JSON.stringify(o)),t.applyAudioConstraints(i)},e.getRemoteMedias=function(){return this._logger.verbose("getRemoteMedias()"),this._medias.remote},e.muteVideoTracks=function(e){this._logger.verbose("muteVideoTracks("+e+")"),this._muteTracks("videoinput",e)},e.muteAudioTracks=function(e){this._logger.verbose("muteAudioTracks("+e+")"),this._muteTracks("audioinput",e)},e.muteTracks=function(e){this._logger.verbose("muteTracks("+h(e)+")");var t="muteTracks(): ";if(s(e))return void 0===e.kind||"videoinput"!==e.kind&&"audioinput"!==e.kind?(r=p.ValueNotValidError("config.kind","video/audio"),this._logger.error(t+JSON.stringify(r)),Promise.reject(r)):void 0!==e.mute&&d(e.mute)?(this._muteTracks(e.kind,e.mute),Promise.resolve({data:{}})):(r=p.TypeNotValidError("config.mute","Boolean"),this._logger.error(t+JSON.stringify(r)),Promise.reject(r));var r=p.TypeNotValidError("config","Object");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)},e._getMedia=function(e,t){this._logger.verbose("_getMedia("+e+", "+h(t)+")");var r=this;return this._verifySourceValidity(e).then(function(){return r._getReadyForMedia()}).then(function(){return e===n.MEDIA_SOURCES.CAMERA?r._getUserMedia(t):e===n.MEDIA_SOURCES.SCREEN?r._getDisplayMedia(t):void 0}).then(function(e){return r._addLocalMedia(e)}).then(function(e){return e.bind(r),r._setupMedia(e)}).catch(function(e){var t="_getMedia(): "+JSON.stringify(e);return r._logger.error(t),Promise.reject(e)})},e._getUserMedia=function(t){this._logger.verbose("_getUserMedia("+h(t)+")");var n="_getUserMedia(): ",i=this;return this._verifyGetUserMediaExistence().then(function(e){return e.getUserMedia(t)}).then(function(e){return Promise.resolve({stream:e,kind:"local"})}).catch(function(e){if(!e){var t=p.ObjectNotExistError("error","Error");return i._logger.error(n+JSON.stringify(t)),Promise.reject(t)}if("NanoError"===e.type)return i._logger.error(n+JSON.stringify(e)),Promise.reject(e);var r=!i._error||i._error&&"OverconstrainedError"!==i._error.name,t=p.GetUserMediaError(e,r);return i._error=t,i._logger.error(n+JSON.stringify(t)),Promise.reject(t)})},e._getDisplayMedia=function(r){this._logger.verbose("_getDisplayMedia("+h(r)+")");var n="_getDisplayMedia(): ",i="Chrome"===t.browserInfo.browser,o=this;return this._verifyGetDisplayMediaExistence().then(function(e){return e.getDisplayMedia({video:r.video,audio:!i&&r.audio})}).then(function(t){return i&&r.audio?o._getUserMedia({video:!1,audio:r.audio}).then(function(e){return o._addAudioToStream(e,t)}):t}).then(function(e){return Promise.resolve({stream:e,kind:"local"})}).catch(function(e){if(e)return"NanoError"===e.type?(o._logger.error(n+JSON.stringify(e)),Promise.reject(e)):(t=p.GetUserMediaError(e),o._logger.error(n+JSON.stringify(t)),Promise.reject(t));var t=p.ObjectNotExistError("error","Error");return o._logger.error(n+JSON.stringify(t)),Promise.reject(t)})},e._getReadyForMedia=function(){this._logger.verbose("_getReadyForMedia()");var e=this.getLocalMedias()[0];return e&&this.removeMedia(e.stream.id),Promise.resolve()},e._setupMedia=function(d){this._logger.verbose("_setupMedia("+h(d)+")");var u="_setupMedia(): ",l=this;return new Promise(function(t,r){var e=d.getVideoTracks(),n=d.getAudioTracks();if(!e&&!n)return c=p.MediaStreamTrackError(),l._logger.error(u+JSON.stringify(c)),r(c);for(var i=[].concat(e).concat(n),o=!0,s=0;s<i.length;s++){var a=i[s];if(a.readyState&&(!o||"live"!==a.readyState)){var o=!1,c=p.DeviceBlockedError(a.kind,a.label);return l._logger.error(u+JSON.stringify(c)),r(c)}}l._composeMetadata(d).then(function(e){return t(e)}).catch(function(e){return l._logger.error(u+JSON.stringify(e)),r(e)})})},e._muteTracks=function(e,t){this._logger.verbose("_muteTracks("+e+", "+t+")");var r=this.getLocalMedias()[0];r&&r.muteTracks(e,t)},e._composeMetadata=function(e){this._logger.verbose("_composeMetadata("+h(e)+")");var t="_composeMetadata(): ";if(!e){var r=p.ObjectNotExistError("media","Media");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}var n=e.metadata;if(!n)return r=p.ObjectNotExistError("metadata","Metadata"),this._logger.error(t+JSON.stringify(r)),Promise.reject(r);var i=e.hasVideoTracks()||e.metadata.hasVideo,o=e.hasAudioTracks()||e.metadata.hasAudio,s=e.getVideoTracksSettings(),a=e.getAudioTracksSettings(),c=(s||e.metadata).width,t=(s||e.metadata).height,r=s?Object.prototype.hasOwnProperty.call(s,"frameRate")?s.frameRate:(Object.prototype.hasOwnProperty.call(s,"framerate")?s:e.metadata).framerate:e.metadata.framerate;return n.hasVideo=i,n.hasAudio=o,n.width=c,n.height=t,n.framerate=Math.round(r),Promise.resolve({data:{stream:e.stream,metadata:n,constraints:this._constraints,settings:{audio:a||{},video:s||{}}}})},e._addAudioToStream=function(e,t){this._logger.verbose("_addAudioToStream("+h(e)+", "+h(t)+")");var r="_addAudioToStream(): ";if(!e){var n=p.ObjectNotExistError("audio","MediaStream");return this._logger.error(r+JSON.stringify(n)),Promise.reject(n)}if(!t)return n=p.ObjectNotExistError("streamInfo","MediaStream"),this._logger.error(r+JSON.stringify(n)),Promise.reject(n);e=e.stream.getAudioTracks()[0];return t.addTrack(e),Promise.resolve(t)},e._reenumerateDevices=function(e){return this._logger.verbose("_reenumerateDevices("+e+")"),this._deviceController.shouldReenumerate(e)?this._deviceController.enumerateDevices():Promise.resolve()},e._verifyDevicesExistence=function(e){this._logger.verbose("_verifyDevicesExistence("+h(e)+")");var t="_verifyDevicesExistence(): ";if(e)return e.videoinput||e.audioinput?Promise.resolve():(r=p.DevicesNotFoundError(),this._logger.error(t+JSON.stringify(r)),Promise.reject(r));var r=p.ObjectNotExistError("devices","Array");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)},e._verifySourceValidity=function(e){if(this._logger.verbose("_verifySourceValidity("+e+")"),t.enumContainsValue(n.MEDIA_SOURCES,e))return Promise.resolve();e=p.EnumValueNotValidError(e,n.MEDIA_SOURCES);return this._logger.error("_verifySourceValidity(): "+JSON.stringify(e)),Promise.reject(e)},e._verifyGetUserMediaExistence=function(){this._logger.verbose("_verifyGetUserMediaExistence()");var e=navigator.mediaDevices;if(e&&a(e.getUserMedia))return Promise.resolve(e);e=p.FunctionNotDefinedError("getUserMedia");return this._logger.error("_verifyGetUserMediaExistence(): "+JSON.stringify(e)),Promise.reject(e)},e._verifyGetDisplayMediaExistence=function(){this._logger.verbose("_verifyGetDisplayMediaExistence()");var e=navigator.mediaDevices;if(e&&a(e.getDisplayMedia))return Promise.resolve(e);e=p.FunctionNotDefinedError("getDisplayMedia");return this._logger.error("_verifyGetDisplayMediaExistence(): "+JSON.stringify(e)),Promise.reject(e)},e._onTrackEnded=function(e){this._logger.verbose("_onTrackEnded("+h(e)+")"),this._logger.info("StreamTrackEnded"),this.emit("StreamTrackEnded",{track:e.target.kind,type:e.type,device:e.target.label})},c}.apply(t,r))||(e.exports=r)},function(e,t,r){var n=r(21),i=r(108),o=r(109),s=r(110),a=r(111),r=r(112);function c(e){e=this.__data__=new n(e);this.size=e.size}c.prototype.clear=i,c.prototype.delete=o,c.prototype.get=s,c.prototype.has=a,c.prototype.set=r,e.exports=c},function(e,t,r){r=r(10)(r(7),"Map");e.exports=r},function(e,t,r){var n=r(134),i=r(1),r=Object.prototype,o=r.hasOwnProperty,s=r.propertyIsEnumerable,n=n(function(){return arguments}())?n:function(e){return i(e)&&o.call(e,"callee")&&!s.call(e,"callee")};e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=function(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=9007199254740991}},function(e,t,r){var n=r(58),i=r(139),o=r(16);e.exports=function(e){return o(e)?n(e,!0):i(e)}},function(e,t,r){var n=r(143),r=r(63),i=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,r=o?function(t){return null==t?[]:(t=Object(t),n(o(t),function(e){return i.call(t,e)}))}:r;e.exports=r},function(e,t,r){r=r(61)(Object.getPrototypeOf,Object);e.exports=r},function(e,t,r){var n=r(68);e.exports=function(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}},function(e,t,r){var n=r(9),i=r(43),o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,d=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(i(e))return NaN;if(n(e)&&(t="function"==typeof e.valueOf?e.valueOf():e,e=n(t)?t+"":t),"string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var t=a.test(e);return t||c.test(e)?d(e.slice(2),t?2:8):s.test(e)?NaN:+e}},function(e,t,r){var n=r(4),i=r(1);e.exports=function(e){return"symbol"==typeof e||i(e)&&"[object Symbol]"==n(e)}},function(e,t,r){var n=r(4),i=r(40),o=r(1),s=Function.prototype,r=Object.prototype,a=s.toString,c=r.hasOwnProperty,d=a.call(Object);e.exports=function(e){if(!o(e)||"[object Object]"!=n(e))return!1;e=i(e);if(null===e)return!0;e=c.call(e,"constructor")&&e.constructor;return"function"==typeof e&&e instanceof e&&a.call(e)==d}},function(e,t,r){var s=r(177),a=r(1);e.exports=function e(t,r,n,i,o){return t===r||(null==t||null==r||!a(t)&&!a(r)?t!=t&&r!=r:s(t,r,n,i,e,o))}},function(e,t,r){var r=[r(0),r(6)];void 0===(r=function(i,o){"use strict";var s=i.getTime;return function(e,t,r,n){this._globalPrefix=e,this._label=t,this._level=r,this._id=n,this.error=function(e){this._log(e,o.LOG_LEVEL.ERROR)},this.warning=function(e){this._log(e,o.LOG_LEVEL.WARNING)},this.info=function(e){this._log(e,o.LOG_LEVEL.INFO)},this.debug=function(e){this._log(e,o.LOG_LEVEL.DEBUG)},this.verbose=function(e){this._log(e,o.LOG_LEVEL.VERBOSE)},this._log=function(e,t){if(this._level>=t)switch(i.isObject(e)&&(e=JSON.stringify(e,null," ")),e=s()+": ["+this._globalPrefix+"]["+this._label+"] - "+e,t){case o.LOG_LEVEL.ERROR:console.error(e);break;case o.LOG_LEVEL.WARNING:console.warn(e);break;case o.LOG_LEVEL.INFO:console.info(e);break;case o.LOG_LEVEL.VERBOSE:console.log(e)}}}}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(88),r(48),r(5),r(3),r(0),r(2),r(49)];void 0===(r=function(i,e,r,o,n,s,t){"use strict";var a=n.parseJSON,c=n.stringifyJSON,d=n.isFunction,u=n.isArray,l={offerToReceiveAudio:!0,offerToReceiveVideo:!0};function p(e,t){r.call(this),this._logger=s.create("PeerConnectionClient","console"),this._logger.verbose("PeerConnectionClient("+c(e)+", "+t+")"),u(e.peerConnectionConfig.iceServers)&&0!==e.peerConnectionConfig.iceServers.length||this._logger.warning("PeerConnectionClient(): params.peerConnectionConfig.iceServers parameter is malformed, must be an array with at least one entry"),this._params=e,this._startTime=t,this._pc=null,this._hasRemoteSdp=!1,this._messageQueue=[],this._isInitiator=!1,this._started=!1,this._closedIceConnectionStateSent=!1,this._sentEndOfRemoteCandidates=!1,this._create()}var h=p.prototype=Object.create(r.prototype);return h.isStarted=function(){return this._started},h.isInitiator=function(){return this._isInitiator},h._create=function(){this._logger.verbose("_create()"),this.close();try{this._pc=new RTCPeerConnection(this._params.peerConnectionConfig,this._params.peerConnectionConstraints),this._bind(),this._logger.verbose("_create(): PeerConnectionCreated")}catch(e){this._onError("CreatePeerConnection",e)}},h.close=function(){this._logger.verbose("close()");var e=this;this._pc?(this._pc.close(),setTimeout(function(){e._closedIceConnectionStateSent||e.emitSimple("IceConnectionStateChange",{state:"closed"}),e._reset(),e._logger.verbose("close(): Peer connection closed"),s.delete(e._logger)},500)):this._logger.verbose("close(): No PeerConnection")},h.addStream=function(e){this._logger.verbose("addStream("+c(e)+")"),this._pc&&this._pc.addStream(e)},h.updateEncodingSettings=function(e,t){this._logger.verbose("updateEncodingSettings("+e+", "+t+")");var r="updateEncoderOptions(): ",n=this;i.setSenderBitrates(this._pc,{video:t||0,audio:e||0}).then(function(){n._logger.info(r+"Sucessfully set bitrates")}).catch(function(e){n._logger.warning(r+"Could not set bitrates "+e)})},h.removeStream=function(e){var t;if(this._logger.verbose("removeStream("+c(e)+")"),this._pc)if(d(this._pc.removeTrack)&&d(this._pc.getSenders))for(var r=e.getTracks(),n=this._pc.getSenders(),i=0,o=n.length;i<o;++i)for(t=0,o=r.length;t<o;++t)n[i].track===r[t]&&this._pc.removeTrack(n[i]);else d(this._pc.removeStream)&&this._pc.removeStream(e)},h.startAsCaller=function(e){var t;this._logger.verbose("startAsCaller("+c(e)+")"),this._pc&&!this._started&&(this._isInitiator=!0,this._started=!0,e=this._buildConstraints(e),this._logger.verbose("startAsCaller(): Sending offer to peer with constraints: \n'"+c(e)),(t=this)._pc.createOffer(e).then(function(e){return t._setLocalDescription(e)}).then(function(e){t.emitSimple("SignalingMessage",e)}).catch(function(e){t._logger.error("startAsCaller(): "+c(e)),t._onError("createOffer",e)}))},h.startAsCallee=function(e){var t,r;if(this._logger.verbose("startAsCallee("+c(e)+")"),this._pc&&!this._started){if(this._isInitiator=!1,this._started=!0,e&&0<e.length)for(t=0,r=e.length;t<r;t++)this.queueSignalingMessage(e[t]);0<this._messageQueue.length&&this._drainMessageQueue()}},h.queueSignalingMessage=function(e){this._logger.verbose("queueSignalingMessage("+c(e)+")");var t=a(e);t&&(this._isInitiator&&"answer"===t.type||!this._isInitiator&&"offer"===t.type?(this._hasRemoteSdp=!0,this._messageQueue.unshift(t)):t.candidate?this._messageQueue.push(t):this._logger.error("queueSignalingMessage(): Unknown message: "+c(e)))},h.setRemoteDescription=function(e){this._logger.verbose("setRemoteDescription("+c(e)+")");var r=this,e=r._adjustRemoteDescription(e);return r._pc.setRemoteDescription(new RTCSessionDescription(e)).then(function(){r._hasRemoteSdp=!0}).then(function(){for(var e=0,t=r._messageQueue.length;e<t;e++)r.addIceCandidate(r._messageQueue[e]),"Microsoft Edge"===n.browserInfo.browser&&setTimeout(function(){r._sentEndOfRemoteCandidates||(r.addIceCandidate(""),r._sentEndOfRemoteCandidates=!0)},3e3);r._messageQueue=[]}).catch(function(e){return r._onError(r,"setRemoteDescription"),r._logger.error("setRemoteDescription(): "+c(e)),Promise.reject(e)})},h.doAnswer=function(){this._logger.verbose("doAnswer()");var t=this,e=this._buildConstraints();return this._logger.verbose("doAnswer(): Sending answer to peer with constraints: "+c(e,null," ")),this._pc.createAnswer(e).then(function(e){return t._setLocalDescription(e)}).catch(function(e){return t._onError("doAnswer",e),Promise.reject(e)})},h.addIceCandidate=function(e){this._logger.verbose("addIceCandidate("+c(e)+")");var t,r="addIceCandidate(): ",n=this;return this._hasRemoteSdp?(e&&""!==e?(t=a(e),t=new RTCIceCandidate({sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate}),this._logger.verbose(r+"Adding ice candidate:"+c(t.toJSON()))):(t=e,this._logger.verbose(r+"(Microsoft Edge only) Adding the end of remote candidates")),this._recordIceCandidate("Remote",t),this._pc.addIceCandidate(t).then(function(){n._logger.verbose(r+"MSG: Remote candidate added successfully")}).catch(function(e){n._logger.error(r+c(e))})):(this._messageQueue.push(e),this._logger.verbose(r+"Queueing candidate, not reveiced remote sdp, yet"),Promise.resolve())},h.getStats=function(t){var e,r,n,i;return this._logger.verbose("getStats("+t+")"),this._pc?t&&"video"!==t&&"audio"!==t?Promise.reject(o.ValueNotValidError("kind","video / audio")):(d(this._pc.getSenders)?(i=this._pc.getSenders().filter(function(e){return!!(n=e.track)&&n.kind&&n.kind===t}))&&i.length&&(e=i[0].track):(i=this._pc.getRemoteStreams())&&i.length&&(r="video"===t?i[0].getVideoTracks():"audio"===t?i[0].getAudioTracks():void 0).length&&(e=r[0]),this._pc.getStats(e)):Promise.reject(new Error("No PeerConnection"))},h._reset=function(){this._logger.verbose("_reset()"),this._unbind(),this._pc=null,this._hasRemoteSdp=!1,this._messageQueue=[],this._isInitiator=!1,this._started=!1},h._bind=function(){this._logger.verbose("_bind()"),this._pc?(this._pc.onicecandidate=this._onIceCandidate.bind(this),this._pc.ontrack=this._onRemoteStreamAdded.bind(this),this._pc.onremovestream=this._onRemoteStreamRemoved.bind(this),this._pc.onsignalingstatechange=this._onSignalingStateChanged.bind(this),this._pc.oniceconnectionstatechange=this._onIceConnectionStateChanged.bind(this),this._pc.onnegotiationneeded=this._onNegotiationNeeded.bind(this)):this._logger.error("_bind(): No PeerConnection")},h._unbind=function(){this._logger.verbose("_unbind()"),this._pc?(this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.onremovestream=null,this._pc.onsignalingstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onnegotiationneeded=null):this._logger.warning("_unbind(): No PeerConnection")},h._setLocalDescription=function(e){this._logger.verbose("_setLocalDescription("+c(e)+")");var t,r="_setLocalDescription(): ",n=this;try{this._params.sdpPatches&&!this._params.sdpPatches.preventReplaceSendReceive&&(e.sdp=this._replaceSendReceive(e.sdp,this._params.send,this._params.receive)),e.sdp=maybePreferVideoReceiveCodec(e.sdp,this._params)}catch(e){return this._logger.verbose(r+e),Promise.reject(e)}return this._pc.setLocalDescription(e).then(function(){return n._logger.verbose(r+"setLocalDescription success"),t={sdp:e.sdp,type:e.type},n._logger.verbose("description after setting: "+c(t)),t}).catch(function(e){n._onError("_setLocalDescription",e)})},h._buildConstraints=function(e){return this._logger.verbose("_buildConstraints("+c(e)+")"),mergeConstraints(e,l)},h._adjustRemoteDescription=function(e){return this._logger.verbose("_adjustRemoteDescription() - before adjusting: "+c(e)),e.sdp=maybePreferVideoReceiveCodec(e.sdp,this._params),e.sdp=maybePreferVideoSendCodec(e.sdp,this._params),this._params.encoding&&("cbp"===this._params.encoding.h264Profile?e.sdp=this._forceBaseline(e.sdp):"high"===this._params.encoding.h264Profile&&(e.sdp=this._forceHigh(e.sdp))),this._params.videoSendBitrate&&(e.sdp=maybeSetVideoSendBitRate(e.sdp,this._params)),this._params.videoSendInitialBitrate&&(e.sdp=maybeSetVideoSendInitialBitRate(e.sdp,this._params)),this._logger.verbose("_adjustRemoteDescription() - after adjusting: "+c(e)+")"),e},h._drainMessageQueue=function(){var e,t;if(this._logger.verbose("_drainMessageQueue()"),this._pc&&this._started&&this._hasRemoteSdp){for(e=0,t=this._messageQueue.length;e<t;e++)this._processSignalingMessage(this._messageQueue[e]);this._messageQueue=[]}},h._processSignalingMessage=function(e){this._logger.verbose("_processSignalingMessage("+c(e)+")");var t,r,n="_processSignalingMessage(): ";if("offer"!==e.type||this._isInitiator)if("answer"===e.type&&this._isInitiator){if(this._logger.verbose(n+"Received answer"),"have-local-offer"!==this._pc.signalingState)return e="MSG: ERROR: remote answer received in unexpected state: "+this._pc.signalingState,void this._logger.verbose(n+e);this._setRemoteSdp(e)}else e.candidate||"candidate"===e.type?(this._logger.verbose(n+"New ice candidate"),t=new RTCIceCandidate({sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}),this._recordIceCandidate("Remote",t),(r=this)._pc.addIceCandidate(t).then(function(){r._logger.verbose(n+"MSG: Remote candidate added successfully")}).catch(function(e){r._onError("addIceCandidate",e)})):this._logger.warning(n+"Unexpected message: "+c(e));else this._logger.verbose(n+"Received offer"),"stable"===this._pc.signalingState?(this._setRemoteSdp(e),this.doAnswer()):(e="ERROR: remote offer received in unexpected state: "+this._pc.signalingState,this._logger.verbose(n+e))},h._onIceCandidate=function(e){this._logger.verbose("_onIceCandidate("+c(e)+")");e=e.candidate;if(!e)return this._logger.verbose("_onIceCandidate(): End of candidates"),void this.emitSimple("EndOfLocalCandidates",{});this._isValidIceCandidate(e)&&(this.emitSimple("SignalingMessage",{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}),this._recordIceCandidate("Local",e))},h._isValidIceCandidate=function(e){this._logger.verbose("_isValidIceCandidate("+c(e)+")");e=e.candidate;return-1===e.indexOf("tcp")&&("relay"!==this._params.peerConnectionConfig.iceTransports||"relay"===iceCandidateType(e))},h._onSignalingStateChanged=function(){if(this._logger.verbose("_onSignalingStateChanged()"),!this._pc)return!1;this._logger.verbose("_onSignalingStateChanged(): Signaling state changed to: "+this._pc.signalingState),this.emitSimple("SignalingStateChanged",{state:this._pc.signalingState})},h._onIceConnectionStateChanged=function(){this._logger.verbose("_onIceConnectionStateChanged()");var e,t="_onIceConnectionStateChanged(): ";if(!this._pc)return!1;"completed"===this._pc.iceConnectionState&&(e=t+"ICE complete time: "+(window.performance.now()-this._startTime).toFixed(0)+"ms",this._logger.verbose(e)),this._logger.verbose(t+"ICE connection state changed to: "+this._pc.iceConnectionState),this.emitSimple("IceConnectionStateChange",{state:this._pc.iceConnectionState}),"closed"===this._pc.iceConnectionState&&(this._closedIceConnectionStateSent=!0)},h._onNegotiationNeeded=function(e){if(this._logger.verbose("_onNegotiationNeeded("+c(e)+")"),!this._pc)return!1;this._logger.verbose("_onNegotiationNeeded(): NegotiationNeeded Event"),this.emitSimple("NegotiationNeeded",e)},h._recordIceCandidate=function(e,t){this._logger.verbose("_recordIceCandidate("+c(e)+", "+c(t)+")"),this._logger.verbose("_recordIceCandidate(): New ICE candidate for "+e),this.emitSimple("NewIceCandidate",{location:e,candidate:t})},h._onRemoteStreamAdded=function(e){this._logger.verbose("_onRemoteStreamAdded("+c(e)+")"),this._logger.verbose("_onRemoteStreamAdded(): Remote stream added to peer connection"),this.emitSimple("RemoteStreamAdded",{stream:e.streams[0]})},h._onRemoteStreamRemoved=function(e){this._logger.verbose("_onRemoteStreamRemoved("+c(e)+")"),this._logger.verbose("_onRemoteStreamRemoved(): Remote stream removed from peer connection"),this.emitSimple("RemoteStreamRemoved",{stream:e.stream})},h._onError=function(e,t){this._logger.error("_onError("+e+", "+t.toString()),this.emitSimple("PeerConnectionError",{tag:e,error:t.toString()})},h._replaceSendReceive=function(e,t,r){this._logger.verbose("_replaceSendReceive("+c(e)+", "+c(t)+", "+c(r)+")");var n="";t&&r?n="a=sendrecv":t?n="a=sendonly":r&&(n="a=recvonly");for(var i,o=e.split("\r\n"),s=0,a=o.length;s<a;s++)-1===(i=o[s]).indexOf("a=sendrecv")&&-1===i.indexOf("a=sendonly")&&-1===i.indexOf("a=recvonly")||(o[s]=n);return o.join("\r\n")},h._forceProfile=function(e,r,n){var i,o,s=e.split("\r\n"),a=this;return s.forEach(function(e,t){-1<e.indexOf(";profile-level-id=")&&2===(o=e.split(";profile-level-id=")).length&&(i=o[1],r.includes(i)?(a._logger.verbose("_forceProfile() : replacing profile: "+i+" with "+n),s[t]=e.split(i).join(n)):a._logger.verbose("_forceProfile() : not replacing profile: "+i))}),s.join("\r\n")},h._forceBaseline=function(e){return this._forceProfile(e,["640032","640c1f","42001f","4d0032","42001f"],"42e01f")},h._forceHigh=function(e){return this._forceProfile(e,["640032","640c1f","42001f","4d0032","42001f","42e01f"],"640c1f")},p}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(89)];void 0===(r=function(e){window.trace=function(e){var t;"\n"===e[e.length-1]&&(e=e.substring(0,e.length-1)),window.performance?(t=(window.performance.now()/1e3).toFixed(3),console.log(t+": "+e)):console.log(e)}}.apply(t,r))||(e.exports=r)},function(e,t,r){e.exports=function n(i,o,s){function a(t,e){if(!o[t]){if(!i[t]){if(0,c)return c(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}r=o[t]={exports:{}};i[t][0].call(r.exports,function(e){return a(i[t][1][e]||e)},r,r.exports,n,i,o,s)}return o[t].exports}for(var c=!1,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,r){"use strict";e=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=e},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=o.log,n=o.detectBrowser(e),i={browserDetails:n,commonShim:u,extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings};switch(n.browser){case"chrome":if(!s||!s.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;r("adapter.js shimming chrome."),(i.browserShim=s).shimGetUserMedia(e),s.shimMediaStream(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimAddTrackRemoveTrack(e),s.shimGetSendersWithDtmf(e),s.shimGetStats(e),s.shimSenderReceiverGetStats(e),s.fixNegotiationNeeded(e),u.shimRTCIceCandidate(e),u.shimConnectionState(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e),u.removeAllowExtmapMixed(e);break;case"firefox":if(!c||!c.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),(i.browserShim=c).shimGetUserMedia(e),c.shimPeerConnection(e),c.shimOnTrack(e),c.shimRemoveStream(e),c.shimSenderGetStats(e),c.shimReceiverGetStats(e),c.shimRTCDataChannel(e),c.shimAddTransceiver(e),c.shimCreateOffer(e),c.shimCreateAnswer(e),u.shimRTCIceCandidate(e),u.shimConnectionState(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e);break;case"edge":if(!a||!a.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),i;r("adapter.js shimming edge."),(i.browserShim=a).shimGetUserMedia(e),a.shimGetDisplayMedia(e),a.shimPeerConnection(e),a.shimReplaceTrack(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e);break;case"safari":if(!d||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),(i.browserShim=d).shimRTCIceServerUrls(e),d.shimCreateOfferLegacy(e),d.shimCallbacksAPI(e),d.shimLocalStreamsAPI(e),d.shimRemoteStreamsAPI(e),d.shimTrackEventTransceiver(e),d.shimGetUserMedia(e),u.shimRTCIceCandidate(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e),u.removeAllowExtmapMixed(e);break;default:r("Unsupported browser!")}return i};var o=n(e("./utils")),s=n(e("./chrome/chrome_shim")),a=n(e("./edge/edge_shim")),c=n(e("./firefox/firefox_shim")),d=n(e("./safari/safari_shim")),u=n(e("./common_shim"));function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(o){var e;"object"!==(void 0===o?"undefined":a(o))||!o.RTCPeerConnection||"ontrack"in o.RTCPeerConnection.prototype?c.wrapPeerConnectionEvent(o,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}):(Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0}),e=o.RTCPeerConnection.prototype.setRemoteDescription,o.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this._ontrackpoly||(this._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(t){var e=o.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===t.track.id}):{track:t.track},r=new Event("track");r.track=t.track,r.receiver=e,r.transceiver={receiver:e},r.streams=[n.stream],i.dispatchEvent(r)}),n.stream.getTracks().forEach(function(t){var e=o.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===t.id}):{track:t},r=new Event("track");r.track=t,r.receiver=e,r.transceiver={receiver:e},r.streams=[n.stream],i.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)})},r.shimGetSendersWithDtmf=function(e){var n,i,t,r,o,s;"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype?(n=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}},e.RTCPeerConnection.prototype.getSenders||(e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()},i=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addTrack=function(e,t){var r=i.apply(this,arguments);return r||(r=n(this,e),this._senders.push(r)),r},t=e.RTCPeerConnection.prototype.removeTrack,e.RTCPeerConnection.prototype.removeTrack=function(e){t.apply(this,arguments);e=this._senders.indexOf(e);-1!==e&&this._senders.splice(e,1)}),r=e.RTCPeerConnection.prototype.addStream,e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(function(e){t._senders.push(n(t,e))})},o=e.RTCPeerConnection.prototype.removeStream,e.RTCPeerConnection.prototype.removeStream=function(e){var r=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(t){var e=r._senders.find(function(e){return e.track===t});e&&r._senders.splice(r._senders.indexOf(e),1)})}):"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&(s=e.RTCPeerConnection.prototype.getSenders,e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=s.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}}))},r.shimGetStats=function(e){var s;e.RTCPeerConnection&&(s=e.RTCPeerConnection.prototype.getStats,e.RTCPeerConnection.prototype.getStats=function(){var r=this,e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],e=e[2];if(0<arguments.length&&"function"==typeof t)return s.apply(this,arguments);if(0===s.length&&(0===arguments.length||"function"!=typeof t))return s.apply(this,[]);var i=function(e){var n={};return e.result().forEach(function(t){var r={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){r[e]=t.stat(e)}),n[r.id]=r}),n},o=function(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))};if(2<=arguments.length)return s.apply(this,[function(e){n(o(i(e)))},t]);return new Promise(function(t,e){s.apply(r,[function(e){t(o(i(e)))},e])}).then(n,e)})},r.shimSenderReceiverGetStats=function(e){var r,t,n,o;"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver&&("getStats"in e.RTCRtpSender.prototype||((r=e.RTCPeerConnection.prototype.getSenders)&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),(t=e.RTCPeerConnection.prototype.addTrack)&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return c.filterStats(e,t.track,!0)})}),"getStats"in e.RTCRtpReceiver.prototype||((n=e.RTCPeerConnection.prototype.getReceivers)&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),c.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return c.filterStats(e,t.track,!1)})}),"getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype&&(o=e.RTCPeerConnection.prototype.getStats,e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,n=void 0,i=void 0;return this.getSenders().forEach(function(e){e.track===t&&(r?i=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(n?i=!0:n=e),e.track===t}),i||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}))},r.shimAddTrackRemoveTrackWithNative=u,r.shimAddTrackRemoveTrack=function(i){if(i.RTCPeerConnection){var e=c.detectBrowser(i);if(i.RTCPeerConnection.prototype.addTrack&&65<=e.version)return u(i);var r=i.RTCPeerConnection.prototype.getLocalStreams;i.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(function(e){return t._reverseStreams[e.id]})};var n=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(e){var t,r=this;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach(function(t){if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[e.id]||(t=new i.MediaStream(e.getTracks()),this._streams[e.id]=t,this._reverseStreams[t.id]=e,e=t),n.apply(this,[e])};var t=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[(this._streams[e.id]||e).id],delete this._streams[e.id]},i.RTCPeerConnection.prototype.addTrack=function(t,e){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};n=this._streams[e.id];return n?(n.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))})):(n=new i.MediaStream([t]),this._streams[e.id]=n,this._reverseStreams[n.id]=e,this.addStream(n)),this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(e){var n=i.RTCPeerConnection.prototype[e],t=d({},e,function(){var t=this,r=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(e){e=a(t,e);r[0].apply(null,[e])},function(e){r[1]&&r[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then(function(e){return a(t,e)})});i.RTCPeerConnection.prototype[e]=t[e]});var o=i.RTCPeerConnection.prototype.setLocalDescription;i.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type&&(arguments[0]=(r=this,n=(e=arguments[0]).sdp,Object.keys(r._reverseStreams||[]).forEach(function(e){var t=r._reverseStreams[e],e=r._streams[t.id];n=n.replace(new RegExp(t.id,"g"),e.id)}),new RTCSessionDescription({type:e.type,sdp:n}))),o.apply(this,arguments);var r,e,n};var s=Object.getOwnPropertyDescriptor(i.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(i.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:a(this,e)}}),i.RTCPeerConnection.prototype.removeTrack=function(t){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(t._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach(function(e){r._streams[e].getTracks().find(function(e){return t.track===e})&&(n=r._streams[e])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}}function a(r,e){var n=e.sdp;return Object.keys(r._reverseStreams||[]).forEach(function(e){var t=r._reverseStreams[e],e=r._streams[t.id];n=n.replace(new RegExp(e.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:n})}},r.shimPeerConnection=function(n){var e,t=c.detectBrowser(n);!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&(t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=n.RTCPeerConnection.prototype[e],r=d({},e,function(){return arguments[0]=new("addIceCandidate"===e?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)});n.RTCPeerConnection.prototype[e]=r[e]}),e=n.RTCPeerConnection.prototype.addIceCandidate,n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})},r.fixNegotiationNeeded=function(e){c.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})};var c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(e){return t._shimmedLocalStreams[e][0]})};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=n.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(r)&&this._shimmedLocalStreams[t.id].push(r):this._shimmedLocalStreams[t.id]=[t,r],r};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(t){if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var t=this.getSenders();i.apply(this,arguments);var n=this.getSenders().filter(function(e){return-1===t.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(n)};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],t.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(r){var n=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},r&&Object.keys(this._shimmedLocalStreams).forEach(function(e){var t=n._shimmedLocalStreams[e].indexOf(r);-1!==t&&n._shimmedLocalStreams[e].splice(t,1),1===n._shimmedLocalStreams[e].length&&delete n._shimmedLocalStreams[e]}),o.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(o,e){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&("function"==typeof e?o.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(function(e){var t=i.video&&i.video.width,r=i.video&&i.video.height,n=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:n||3}},t&&(i.video.mandatory.maxWidth=t),r&&(i.video.mandatory.maxHeight=r),o.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t,s,n,i,r,a=e&&e.navigator;a.mediaDevices&&(t=o.detectBrowser(e),s=function(i){if("object"!==(void 0===i?"undefined":c(i))||i.mandatory||i.optional)return i;var o={};return Object.keys(i).forEach(function(t){var r,n,e;"require"!==t&&"advanced"!==t&&"mediaSource"!==t&&(void 0!==(r="object"===c(i[t])?i[t]:{ideal:i[t]}).exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact),n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t},void 0!==r.ideal&&(o.optional=o.optional||[],e={},"number"==typeof r.ideal?(e[n("min",t)]=r.ideal,o.optional.push(e),(e={})[n("max",t)]=r.ideal):e[n("",t)]=r.ideal,o.optional.push(e)),void 0!==r.exact&&"number"!=typeof r.exact?(o.mandatory=o.mandatory||{},o.mandatory[n("",t)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(o.mandatory=o.mandatory||{},o.mandatory[n(e,t)]=r[e])}))}),i.advanced&&(o.optional=(o.optional||[]).concat(i.advanced)),o},n=function(r,n){if(61<=t.version)return n(r);if((r=JSON.parse(JSON.stringify(r)))&&"object"===c(r.audio)&&((e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])})((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","googAutoGainControl"),e(r.audio,"noiseSuppression","googNoiseSuppression"),r.audio=s(r.audio)),r&&"object"===c(r.video)){var i=(i=r.video.facingMode)&&("object"===(void 0===i?"undefined":c(i))?i:{ideal:i}),e=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||e)){delete r.video.facingMode;var o=void 0;if("environment"===i.exact||"environment"===i.ideal?o=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(o=["front"]),o)return a.mediaDevices.enumerateDevices().then(function(e){var t=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(t){return o.some(function(e){return t.label.toLowerCase().includes(e)})});return(t=!t&&e.length&&o.includes("back")?e[e.length-1]:t)&&(r.video.deviceId=i.exact?{exact:t.deviceId}:{ideal:t.deviceId}),r.video=s(r.video),d("chrome: "+JSON.stringify(r)),n(r)})}r.video=s(r.video)}return d("chrome: "+JSON.stringify(r)),n(r)},i=function(e){return 64<=t.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},a.getUserMedia=function(e,t,r){n(e,function(e){a.webkitGetUserMedia(e,t,function(e){r&&r(i(e))})})}.bind(a),a.mediaDevices.getUserMedia&&(r=a.mediaDevices.getUserMedia.bind(a.mediaDevices),a.mediaDevices.getUserMedia=function(e){return n(e,function(t){return r(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(i(e))})})}))};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js")),d=o.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function(t){var i;!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype||(i=t.RTCIceCandidate,t.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new i(e),r=s.default.parseCandidate(e.candidate),n=Object.assign(t,r);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new i(e)},t.RTCIceCandidate.prototype=i.prototype,n.wrapPeerConnectionEvent(t,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e}))},r.shimMaxMessageSize=function(e){var i,o;e.RTCPeerConnection&&(i=n.detectBrowser(e),"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}}),o=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,t,r,n;return this._sctp=null,"chrome"===i.browser&&76<=i.version&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),function(e){if(!e||!e.sdp)return!1;e=s.default.splitSections(e.sdp);return e.shift(),e.some(function(e){e=s.default.parseMLine(e);return e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")})}(arguments[0])&&(t=function(e){e=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;e=parseInt(e[1],10);return e!=e?-1:e}(arguments[0]),r=t,n=65536,n=n="firefox"===i.browser?i.version<57?-1===r?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637:n,t=function(e,t){var r=65536;"firefox"===i.browser&&57===i.version&&(r=65535);e=s.default.matchPrefix(e.sdp,"a=max-message-size:");return 0<e.length?r=parseInt(e[0].substr(19),10):"firefox"===i.browser&&-1!==t&&(r=2147483637),r}(arguments[0],t),e=void 0,e=0===n&&0===t?Number.POSITIVE_INFINITY:0===n||0===t?Math.max(n,t):Math.min(n,t),t={},Object.defineProperty(t,"maxMessageSize",{get:function(){return e}}),this._sctp=t),o.apply(this,arguments)})},r.shimSendThrowTypeError=function(e){var t;function r(t,r){var n=t.send;t.send=function(){var e=arguments[0],e=e.length||e.size||e.byteLength;if("open"===t.readyState&&r.sctp&&e>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return n.apply(t,arguments)}}e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype&&(t=e.RTCPeerConnection.prototype.createDataChannel,e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},n.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e}))},r.shimConnectionState=function(e){var r;!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype||(r=e.RTCPeerConnection.prototype,Object.defineProperty(r,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var t=r[e];r[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t,r=e.target;return r._lastConnectionState!==r.connectionState&&(r._lastConnectionState=r.connectionState,t=new Event("connectionstatechange",e),r.dispatchEvent(t)),e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}}))},r.removeAllowExtmapMixed=function(e){var t,r;e.RTCPeerConnection&&("chrome"===(t=n.detectBrowser(e)).browser&&71<=t.version||(r=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),r.apply(this,arguments)}))};var r=e("sdp"),s=r&&r.__esModule?r:{default:r},n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimPeerConnection=function(e){var r,t=o.detectBrowser(e);e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)&&(r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled"),Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})),!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=(0,a.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,s.filterIceServers)(e.iceServers,t.version),o.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype},r.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")),s=e("./filtericeservers"),e=e("rtcpeerconnection-shim"),a=e&&e.__esModule?e:{default:e}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&i.deprecated("RTCIceServer.url","RTCIceServer.urls");var r="string"==typeof t,t=(t=r?[t]:t).filter(function(e){if(0===e.indexOf("stun:"))return!1;e=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return e&&!n&&(n=!0)});return delete e.url,e.urls=r?t[0]:t,!!t.length}})};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var e=e&&e.navigator,t=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(e){return t(e).catch(function(e){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}})})}}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(o){var e,i,r,s=a.detectBrowser(o);"object"===(void 0===o?"undefined":n(o))&&(o.RTCPeerConnection||o.mozRTCPeerConnection)&&(!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t,r,n=o.RTCPeerConnection.prototype[e],i=(r=function(){return arguments[0]=new("addIceCandidate"===e?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)},(t=e)in(i={})?Object.defineProperty(i,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[t]=r,i);o.RTCPeerConnection.prototype[e]=i[e]}),s.version<68&&(e=o.RTCPeerConnection.prototype.addIceCandidate,o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?""===arguments[0].candidate?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}),i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=o.RTCPeerConnection.prototype.getStats,o.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],e=e[2];return r.apply(this,[t||null]).then(function(r){if(s.version<53&&!n)try{r.forEach(function(e){e.type=i[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;r.forEach(function(e,t){r.set(t,Object.assign({},e,{type:i[e.type]||e.type}))})}return r}).then(n,e)})},r.shimSenderGetStats=function(e){var r,t;"object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype||((r=e.RTCPeerConnection.prototype.getSenders)&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),(t=e.RTCPeerConnection.prototype.addTrack)&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)})},r.shimReceiverGetStats=function(e){var r;"object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype||((r=e.RTCPeerConnection.prototype.getReceivers)&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),a.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)})},r.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){var r=this;a.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&t.getTracks().includes(e.track)&&r.removeTrack(e)})})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},r.shimAddTransceiver=function(e){var i;"object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||(i=e.RTCPeerConnection.prototype.addTransceiver)&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],t=e&&"sendEncodings"in e;t&&e.sendEncodings.forEach(function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(1<=parseFloat(e.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(0<=parseFloat(e.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0")});var r,n=i.apply(this,arguments);return t&&("encodings"in(t=(r=n.sender).getParameters())||(t.encodings=e.sendEncodings,this.setParametersPromises.push(r.setParameters(t).catch(function(){})))),n})},r.shimCreateOffer=function(e){var r;"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&(r=e.RTCPeerConnection.prototype.createOffer,e.RTCPeerConnection.prototype.createOffer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):r.apply(this,arguments)})},r.shimCreateAnswer=function(e){var r;"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&(r=e.RTCPeerConnection.prototype.createAnswer,e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):r.apply(this,arguments)})};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(e){if(e&&e.video)return!0===e.video?e.video={mediaSource:r}:e.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(e);e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)})}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t,r,n,i,o=c.detectBrowser(e),s=e&&e.navigator,e=e&&e.MediaStreamTrack;s.getUserMedia=function(e,t,r){c.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(e).then(t,r)},55<o.version&&"autoGainControl"in s.mediaDevices.getSupportedConstraints()||(t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},r=s.mediaDevices.getUserMedia.bind(s.mediaDevices),s.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":a(e))&&"object"===a(e.audio)&&(e=JSON.parse(JSON.stringify(e)),t(e.audio,"autoGainControl","mozAutoGainControl"),t(e.audio,"noiseSuppression","mozNoiseSuppression")),r(e)},e&&e.prototype.getSettings&&(n=e.prototype.getSettings,e.prototype.getSettings=function(){var e=n.apply(this,arguments);return t(e,"mozAutoGainControl","autoGainControl"),t(e,"mozNoiseSuppression","noiseSuppression"),e}),e&&e.prototype.applyConstraints&&(i=e.prototype.applyConstraints,e.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":a(e))&&(e=JSON.parse(JSON.stringify(e)),t(e,"autoGainControl","mozAutoGainControl"),t(e,"noiseSuppression","mozNoiseSuppression")),i.apply(this,[e])}))};var c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function(e){var n;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"addStream"in e.RTCPeerConnection.prototype||(n=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addStream=function(t){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(function(e){return n.call(r,e,t)}),t.getVideoTracks().forEach(function(e){return n.call(r,e,t)})},e.RTCPeerConnection.prototype.addTrack=function(e){var t=arguments[1];return t&&(this._localStreams?this._localStreams.includes(t)||this._localStreams.push(t):this._localStreams=[t]),n.apply(this,arguments)}),"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r,n=this._localStreams.indexOf(e);-1!==n&&(this._localStreams.splice(n,1),r=e.getTracks(),this.getSenders().forEach(function(e){r.includes(e.track)&&t.removeTrack(e)}))}))},r.shimRemoteStreamsAPI=function(e){var t;"object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection||("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams||[]}),"onaddstream"in e.RTCPeerConnection.prototype)||(Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var r=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){var t;r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.includes(e)||(r._remoteStreams.push(e),(t=new Event("addstream")).stream=e,r.dispatchEvent(t))})})}}),t=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){var t;r._remoteStreams||(r._remoteStreams=[]),0<=r._remoteStreams.indexOf(e)||(r._remoteStreams.push(e),(t=new Event("addstream")).stream=e,r.dispatchEvent(t))})}),t.apply(r,arguments)})},r.shimCallbacksAPI=function(e){var n,i,o,s,a;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&(e=e.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,o=e.setLocalDescription,s=e.setRemoteDescription,a=e.addIceCandidate,e.createOffer=function(e,t){var r=n.apply(this,[2<=arguments.length?arguments[2]:e]);return t?(r.then(e,t),Promise.resolve()):r},e.createAnswer=function(e,t){var r=i.apply(this,[2<=arguments.length?arguments[2]:e]);return t?(r.then(e,t),Promise.resolve()):r},e.setLocalDescription=function(e,t,r){e=o.apply(this,[e]);return r?(e.then(t,r),Promise.resolve()):e},e.setRemoteDescription=function(e,t,r){e=s.apply(this,[e]);return r?(e.then(t,r),Promise.resolve()):e},e.addIceCandidate=function(e,t,r){e=a.apply(this,[e]);return r?(e.then(t,r),Promise.resolve()):e})},r.shimGetUserMedia=function(e){var t,n=e&&e.navigator;n.mediaDevices&&n.mediaDevices.getUserMedia&&(e=n.mediaDevices,t=e.getUserMedia.bind(e),n.mediaDevices.getUserMedia=function(e){return t(i(e))}),!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(e,t,r){n.mediaDevices.getUserMedia(e).then(t,r)}.bind(n))},r.shimConstraints=i,r.shimRTCIceServerUrls=function(e){var o=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],n=0;n<e.iceServers.length;n++){var i=e.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(s.deprecated("RTCIceServer.url","RTCIceServer.urls"),(i=JSON.parse(JSON.stringify(i))).urls=i.url,delete i.url,r.push(i)):r.push(e.iceServers[n])}e.iceServers=r}return new o(e,t)},e.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":c(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var t;return e&&(void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio),t=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind}),!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo),t=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind}),!1===e.offerToReceiveVideo&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveVideo||t||this.addTransceiver("video")),r.apply(this,arguments)}};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"));function i(e){return e&&void 0!==e.video?Object.assign({},e,{video:s.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=s,r.wrapPeerConnectionEvent=function(e,n,i){var o,s;e.RTCPeerConnection&&(e=e.RTCPeerConnection.prototype,o=e.addEventListener,e.addEventListener=function(e,t){if(e!==n)return o.apply(this,arguments);function r(e){(e=i(e))&&t(e)}return this._eventMap=this._eventMap||{},this._eventMap[t]=r,o.apply(this,[e,r])},s=e.removeEventListener,e.removeEventListener=function(e,t){if(e!==n||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);var r=this._eventMap[t];return delete this._eventMap[t],s.apply(this,[e,r])},Object.defineProperty(e,"on"+n,{get:function(){return this["_on"+n]},set:function(e){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),e&&this.addEventListener(n,this["_on"+n]=e)},enumerable:!0,configurable:!0}))},r.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(i=e)?"adapter.js logging disabled":"adapter.js logging enabled"},r.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},r.log=function(){"object"===("undefined"==typeof window?"undefined":n(window))&&(i||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments))},r.deprecated=function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=s(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=s(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=s(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=s(t.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return r},r.compactObject=function i(o){return a(o)?Object.keys(o).reduce(function(e,t){var r=a(o[t]),n=r?i(o[t]):o[t],r=r&&!Object.keys(n).length;return void 0===n||r?e:Object.assign(e,(e=n,(n=t)in(t={})?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t))},{}):o},r.walkStats=c,r.filterStats=function(r,t,e){var n=e?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return r.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){r.forEach(function(e){e.type===n&&e.trackId===t.id&&c(r,e,i)})}),i};var i=!0,o=!0;function s(e,t,r){t=e.match(t);return t&&t.length>=r&&parseInt(t[r],10)}function a(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),Object.keys(r).forEach(function(e){e.endsWith("Id")?c(t,t.get(r[e]),n):e.endsWith("Ids")&&r[e].forEach(function(e){c(t,t.get(e),n)})}))}},{}],16:[function(e,t,r){"use strict";var D=e("sdp");function s(e,t,r,n,i){t=D.writeRtpDescription(e.kind,t);return t+=D.writeIceParameters(e.iceGatherer.getLocalParameters()),t+=D.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),t+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?t+="a=sendrecv\r\n":e.rtpSender?t+="a=sendonly\r\n":e.rtpReceiver?t+="a=recvonly\r\n":t+="a=inactive\r\n",e.rtpSender&&(i=e.rtpSender._initialTrackId||e.rtpSender.track.id,e.rtpSender._initialTrackId=i,t+="a="+(i="msid:"+(n?n.id:"-")+" "+i+"\r\n"),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+i,e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+i,t+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+D.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+D.localCName+"\r\n"),t}function N(n,i){function o(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]}var s={codecs:[],headerExtensions:[],fecMechanisms:[]};return n.codecs.forEach(function(r){for(var e=0;e<i.codecs.length;e++){var t=i.codecs[e];if(r.name.toLowerCase()===t.name.toLowerCase()&&r.clockRate===t.clockRate&&("rtx"!==r.name.toLowerCase()||!r.parameters||!t.parameters.apt||function(e,t,r,n){r=o(e.parameters.apt,r),n=o(t.parameters.apt,n);return r&&n&&r.name.toLowerCase()===n.name.toLowerCase()}(r,t,n.codecs,i.codecs))){(t=JSON.parse(JSON.stringify(t))).numChannels=Math.min(r.numChannels,t.numChannels),s.codecs.push(t),t.rtcpFeedback=t.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(e){for(var t=0;t<i.headerExtensions.length;t++){var r=i.headerExtensions[t];if(e.uri===r.uri){s.headerExtensions.push(r);break}}}),s}function o(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function M(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function p(e,t){t=new Error(t);return t.name=e,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],t}t.exports=function(I,x){function O(e,t){t.addTrack(e),t.dispatchEvent(new I.MediaStreamTrackEvent("addtrack",{track:e}))}function i(e,t,r,n){var i=new Event("track");i.track=t,i.receiver=r,i.transceiver={receiver:r},i.streams=n,I.setTimeout(function(){e._dispatchEvent("track",i)})}function n(e){var t,n,i,r=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",e=JSON.parse(JSON.stringify(e||{})),this.usingBundle="max-bundle"===e.bundlePolicy,"negotiate"===e.rtcpMuxPolicy)throw p("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(e.rtcpMuxPolicy||(e.rtcpMuxPolicy="require"),e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all"}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced"}if(e.iceServers=(t=e.iceServers||[],n=x,i=!1,(t=JSON.parse(JSON.stringify(t))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof t,t=(t=r?[t]:t).filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||i?0===e.indexOf("stun:")&&14393<=n&&-1===e.indexOf("?transport=udp"):i=!0});return delete e.url,e.urls=r?t[0]:t,!!t.length}})),this._iceGatherers=[],e.iceCandidatePoolSize)for(var s=e.iceCandidatePoolSize;0<s;s--)this._iceGatherers.push(new I.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}));else e.iceCandidatePoolSize=0;this._config=e,this.transceivers=[],this._sdpSessionId=D.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1}return Object.defineProperty(n.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(n.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),n.prototype.onicecandidate=null,n.prototype.onaddstream=null,n.prototype.ontrack=null,n.prototype.onremovestream=null,n.prototype.onsignalingstatechange=null,n.prototype.oniceconnectionstatechange=null,n.prototype.onconnectionstatechange=null,n.prototype.onicegatheringstatechange=null,n.prototype.onnegotiationneeded=null,n.prototype.ondatachannel=null,n.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},n.prototype.getConfiguration=function(){return this._config},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype._createTransceiver=function(e,t){var r=0<this.transceivers.length,e={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};return this.usingBundle&&r?(e.iceTransport=this.transceivers[0].iceTransport,e.dtlsTransport=this.transceivers[0].dtlsTransport):(r=this._createIceAndDtlsTransports(),e.iceTransport=r.iceTransport,e.dtlsTransport=r.dtlsTransport),t||this.transceivers.push(e),e},n.prototype.addTrack=function(t,e){if(this._isClosed)throw p("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw p("InvalidAccessError","Track already exists.");for(var n=0;n<this.transceivers.length;n++)this.transceivers[n].track||this.transceivers[n].kind!==t.kind||(r=this.transceivers[n]);return r=r||this._createTransceiver(t.kind),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(e)&&this.localStreams.push(e),r.track=t,r.stream=e,r.rtpSender=new I.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},n.prototype.addStream=function(t){var n,r=this;15025<=x?t.getTracks().forEach(function(e){r.addTrack(e,t)}):(n=t.clone(),t.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)}))},n.prototype.removeTrack=function(t){if(this._isClosed)throw p("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof I.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var e=this.transceivers.find(function(e){return e.rtpSender===t});if(!e)throw p("InvalidAccessError","Sender was not created by this connection.");var r=e.stream;e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&-1<this.localStreams.indexOf(r)&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},n.prototype.removeStream=function(e){var r=this;e.getTracks().forEach(function(t){var e=r.getSenders().find(function(e){return e.track===t});e&&r.removeTrack(e)})},n.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},n.prototype._createIceGatherer=function(r,e){var n=this;if(e&&0<r)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new I.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[r].bufferedCandidateEvents=[],this.transceivers[r].bufferCandidates=function(e){var t=!e.candidate||0===Object.keys(e.candidate).length;i.state=t?"completed":"gathering",null!==n.transceivers[r].bufferedCandidateEvents&&n.transceivers[r].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[r].bufferCandidates),i},n.prototype._gather=function(i,o){var e,s=this,a=this.transceivers[o].iceGatherer;a.onlocalcandidate||(e=this.transceivers[o].bufferedCandidateEvents,this.transceivers[o].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[o].bufferCandidates),a.onlocalcandidate=function(e){var t,r,n;s.usingBundle&&0<o||((t=new Event("icecandidate")).candidate={sdpMid:i,sdpMLineIndex:o},(e=!(r=e.candidate)||0===Object.keys(r).length)?"new"!==a.state&&"gathering"!==a.state||(a.state="completed"):("new"===a.state&&(a.state="gathering"),r.component=1,r.ufrag=a.getLocalParameters().usernameFragment,n=D.writeCandidate(r),t.candidate=Object.assign(t.candidate,D.parseCandidate(n)),t.candidate.candidate=n,t.candidate.toJSON=function(){return{candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex,usernameFragment:t.candidate.usernameFragment}}),(n=D.getMediaSections(s._localDescription.sdp))[t.candidate.sdpMLineIndex]+=e?"a=end-of-candidates\r\n":"a="+t.candidate.candidate+"\r\n",s._localDescription.sdp=D.getDescription(s._localDescription.sdp)+n.join(""),n=s.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}),"gathering"!==s.iceGatheringState&&(s.iceGatheringState="gathering",s._emitGatheringStateChange()),e||s._dispatchEvent("icecandidate",t),n&&(s._dispatchEvent("icecandidate",new Event("icecandidate")),s.iceGatheringState="complete",s._emitGatheringStateChange()))},I.setTimeout(function(){e.forEach(function(e){a.onlocalcandidate(e)})},0))},n.prototype._createIceAndDtlsTransports=function(){var e=this,t=new I.RTCIceTransport(null);t.onicestatechange=function(){e._updateIceConnectionState(),e._updateConnectionState()};var r=new I.RTCDtlsTransport(t);return r.ondtlsstatechange=function(){e._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:r}},n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);t=this.transceivers[e].iceTransport;t&&(delete t.onicestatechange,delete this.transceivers[e].iceTransport);t=this.transceivers[e].dtlsTransport;t&&(delete t.ondtlsstatechange,delete t.onerror,delete this.transceivers[e].dtlsTransport)},n.prototype._transceive=function(e,t,r){var n=N(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(n.encodings=e.sendEncodingParameters,n.rtcp={cname:D.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(n.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(n)),r&&e.rtpReceiver&&0<n.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&x<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?n.encodings=e.recvEncodingParameters:n.encodings=[{}],n.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(n.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(n.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(n))},n.prototype.setLocalDescription=function(e){var t,d,u,l=this;return-1===["offer","answer"].indexOf(e.type)?Promise.reject(p("TypeError",'Unsupported type "'+e.type+'"')):!o("setLocalDescription",e.type,l.signalingState)||l._isClosed?Promise.reject(p("InvalidStateError","Can not set local "+e.type+" in state "+l.signalingState)):("offer"===e.type?(t=D.splitSections(e.sdp),d=t.shift(),t.forEach(function(e,t){e=D.parseRtpParameters(e);l.transceivers[t].localCapabilities=e}),l.transceivers.forEach(function(e,t){l._gather(e.mid,t)})):"answer"===e.type&&(d=(t=D.splitSections(l._remoteDescription.sdp)).shift(),u=0<D.matchPrefix(d,"a=ice-lite").length,t.forEach(function(e,t){var r,n=l.transceivers[t],i=n.iceGatherer,o=n.iceTransport,s=n.dtlsTransport,a=n.localCapabilities,c=n.remoteCapabilities;D.isRejected(e)&&0===D.matchPrefix(e,"a=bundle-only").length||n.rejected||(r=D.getIceParameters(e,d),e=D.getDtlsParameters(e,d),u&&(e.role="server"),l.usingBundle&&0!==t||(l._gather(n.mid,t),"new"===o.state&&o.start(i,r,u?"controlling":"controlled"),"new"===s.state&&s.start(e)),c=N(a,c),l._transceive(n,0<c.codecs.length,!1))})),l._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?l._updateSignalingState("have-local-offer"):l._updateSignalingState("stable"),Promise.resolve())},n.prototype.setRemoteDescription=function(y){var C=this;if(-1===["offer","answer"].indexOf(y.type))return Promise.reject(p("TypeError",'Unsupported type "'+y.type+'"'));if(!o("setRemoteDescription",y.type,C.signalingState)||C._isClosed)return Promise.reject(p("InvalidStateError","Can not set remote "+y.type+" in state "+C.signalingState));var E={};C.remoteStreams.forEach(function(e){E[e.id]=e});var T=[],e=D.splitSections(y.sdp),P=e.shift(),w=0<D.matchPrefix(P,"a=ice-lite").length,R=0<D.matchPrefix(P,"a=group:BUNDLE ").length;C.usingBundle=R;var t=D.matchPrefix(P,"a=ice-options:")[0];return C.canTrickleIceCandidates=!!t&&0<=t.substr(14).split(" ").indexOf("trickle"),e.forEach(function(e,t){var r,n,i,o,s,a,c,d,u,l,p,h,f=D.splitLines(e),g=D.getKind(e),m=D.isRejected(e)&&0===D.matchPrefix(e,"a=bundle-only").length,v=f[0].substr(2).split(" ")[2],_=D.getDirection(e,P),S=D.parseMsid(e),b=D.getMid(e)||D.generateIdentifier();m||"application"===g&&("DTLS/SCTP"===v||"UDP/DTLS/SCTP"===v)?C.transceivers[t]={mid:b,kind:g,protocol:v,rejected:!0}:(!m&&C.transceivers[t]&&C.transceivers[t].rejected&&(C.transceivers[t]=C._createTransceiver(g,!0)),c=D.parseRtpParameters(e),m||(s=D.getIceParameters(e,P),(a=D.getDtlsParameters(e,P)).role="client"),d=D.parseRtpEncodingParameters(e),u=D.parseRtcpParameters(e),l=0<D.matchPrefix(e,"a=end-of-candidates",P).length,f=D.matchPrefix(e,"a=candidate:").map(function(e){return D.parseCandidate(e)}).filter(function(e){return 1===e.component}),("offer"===y.type||"answer"===y.type)&&!m&&R&&0<t&&C.transceivers[t]&&(C._disposeIceAndDtlsTransports(t),C.transceivers[t].iceGatherer=C.transceivers[0].iceGatherer,C.transceivers[t].iceTransport=C.transceivers[0].iceTransport,C.transceivers[t].dtlsTransport=C.transceivers[0].dtlsTransport,C.transceivers[t].rtpSender&&C.transceivers[t].rtpSender.setTransport(C.transceivers[0].dtlsTransport),C.transceivers[t].rtpReceiver&&C.transceivers[t].rtpReceiver.setTransport(C.transceivers[0].dtlsTransport)),"offer"!==y.type||m?"answer"!==y.type||m||(v=(r=C.transceivers[t]).iceGatherer,e=r.iceTransport,m=r.dtlsTransport,n=r.rtpReceiver,p=r.sendEncodingParameters,i=r.localCapabilities,C.transceivers[t].recvEncodingParameters=d,C.transceivers[t].remoteCapabilities=c,C.transceivers[t].rtcpParameters=u,f.length&&"new"===e.state&&(!w&&!l||R&&0!==t?f.forEach(function(e){M(r.iceTransport,e)}):e.setRemoteCandidates(f)),R&&0!==t||("new"===e.state&&e.start(v,s,"controlling"),"new"===m.state&&m.start(a)),!N(r.localCapabilities,r.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&r.sendEncodingParameters[0].rtx&&delete r.sendEncodingParameters[0].rtx,C._transceive(r,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!n||"sendrecv"!==_&&"sendonly"!==_?delete r.rtpReceiver:(o=n.track,S?(E[S.stream]||(E[S.stream]=new I.MediaStream),O(o,E[S.stream]),T.push([o,n,E[S.stream]])):(E.default||(E.default=new I.MediaStream),O(o,E.default),T.push([o,n,E.default])))):((r=C.transceivers[t]||C._createTransceiver(g)).mid=b,r.iceGatherer||(r.iceGatherer=C._createIceGatherer(t,R)),f.length&&"new"===r.iceTransport.state&&(!l||R&&0!==t?f.forEach(function(e){M(r.iceTransport,e)}):r.iceTransport.setRemoteCandidates(f)),i=I.RTCRtpReceiver.getCapabilities(g),x<15019&&(i.codecs=i.codecs.filter(function(e){return"rtx"!==e.name})),p=r.sendEncodingParameters||[{ssrc:1001*(2*t+2)}],f=!1,"sendrecv"===_||"sendonly"===_?(f=!r.rtpReceiver,n=r.rtpReceiver||new I.RTCRtpReceiver(r.dtlsTransport,g),f&&(o=n.track,(h=!S||"-"!==S.stream?S?(E[S.stream]||(E[S.stream]=new I.MediaStream,Object.defineProperty(E[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(o,"id",{get:function(){return S.track}}),E[S.stream]):(E.default||(E.default=new I.MediaStream),E.default):h)&&(O(o,h),r.associatedRemoteMediaStreams.push(h)),T.push([o,n,h]))):r.rtpReceiver&&r.rtpReceiver.track&&(r.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===r.rtpReceiver.track.id});t&&(t=t,(e=e).removeTrack(t),e.dispatchEvent(new I.MediaStreamTrackEvent("removetrack",{track:t})))}),r.associatedRemoteMediaStreams=[]),r.localCapabilities=i,r.remoteCapabilities=c,r.rtpReceiver=n,r.rtcpParameters=u,r.sendEncodingParameters=p,r.recvEncodingParameters=d,C._transceive(C.transceivers[t],!1,f)))}),void 0===C._dtlsRole&&(C._dtlsRole="offer"===y.type?"active":"passive"),C._remoteDescription={type:y.type,sdp:y.sdp},"offer"===y.type?C._updateSignalingState("have-remote-offer"):C._updateSignalingState("stable"),Object.keys(E).forEach(function(e){var t,n=E[e];n.getTracks().length&&(-1===C.remoteStreams.indexOf(n)&&(C.remoteStreams.push(n),(t=new Event("addstream")).stream=n,I.setTimeout(function(){C._dispatchEvent("addstream",t)})),T.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&i(C,t,r,[n])}))}),T.forEach(function(e){e[2]||i(C,e[0],e[1],[])}),I.setTimeout(function(){C&&C.transceivers&&C.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},n.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(e){this.signalingState=e;e=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",e)},n.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,I.setTimeout(function(){var e;t.needNegotiation&&(t.needNegotiation=!1,e=new Event("negotiationneeded"),t._dispatchEvent("negotiationneeded",e))},0))},n.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState&&(this.iceConnectionState=e,e=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",e))},n.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState&&(this.connectionState=e,e=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",e))},n.prototype.createOffer=function(){var o=this;if(o._isClosed)return Promise.reject(p("InvalidStateError","Can not call createOffer after close"));var t=o.transceivers.filter(function(e){return"audio"===e.kind}).length,r=o.transceivers.filter(function(e){return"video"===e.kind}).length,e=arguments[0];if(e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(t=!0===e.offerToReceiveAudio?1:!1===e.offerToReceiveAudio?0:e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(r=!0===e.offerToReceiveVideo?1:!1===e.offerToReceiveVideo?0:e.offerToReceiveVideo)}for(o.transceivers.forEach(function(e){"audio"===e.kind?--t<0&&(e.wantReceive=!1):"video"===e.kind&&--r<0&&(e.wantReceive=!1)});0<t||0<r;)0<t&&(o._createTransceiver("audio"),t--),0<r&&(o._createTransceiver("video"),r--);var n=D.writeSessionBoilerplate(o._sdpSessionId,o._sdpSessionVersion++);o.transceivers.forEach(function(e,t){var r=e.track,n=e.kind,i=e.mid||D.generateIdentifier();e.mid=i,e.iceGatherer||(e.iceGatherer=o._createIceGatherer(t,o.usingBundle));i=I.RTCRtpSender.getCapabilities(n);x<15019&&(i.codecs=i.codecs.filter(function(e){return"rtx"!==e.name})),i.codecs.forEach(function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1"),e.remoteCapabilities&&e.remoteCapabilities.codecs&&e.remoteCapabilities.codecs.forEach(function(e){t.name.toLowerCase()===e.name.toLowerCase()&&t.clockRate===e.clockRate&&(t.preferredPayloadType=e.payloadType)})}),i.headerExtensions.forEach(function(t){(e.remoteCapabilities&&e.remoteCapabilities.headerExtensions||[]).forEach(function(e){t.uri===e.uri&&(t.id=e.id)})});t=e.sendEncodingParameters||[{ssrc:1001*(2*t+1)}];r&&15019<=x&&"video"===n&&!t[0].rtx&&(t[0].rtx={ssrc:t[0].ssrc+1}),e.wantReceive&&(e.rtpReceiver=new I.RTCRtpReceiver(e.dtlsTransport,n)),e.localCapabilities=i,e.sendEncodingParameters=t}),"max-compat"!==o._config.bundlePolicy&&(n+="a=group:BUNDLE "+o.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n",o.transceivers.forEach(function(e,t){n+=s(e,e.localCapabilities,"offer",e.stream,o._dtlsRole),n+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===o.iceGatheringState||0!==t&&o.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,n+="a="+D.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(n+="a=end-of-candidates\r\n"))});e=new I.RTCSessionDescription({type:"offer",sdp:n});return Promise.resolve(e)},n.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(p("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(p("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var i=D.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(i+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),i+="a=ice-options:trickle\r\n";var o=D.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,t){if(!(o<t+1)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?i+="m=application 0 DTLS/SCTP 5000\r\n":i+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(i+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");e.stream&&("audio"===e.kind?r=e.stream.getAudioTracks()[0]:"video"===e.kind&&(r=e.stream.getVideoTracks()[0]),r&&15019<=x&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var r=N(e.localCapabilities,e.remoteCapabilities);!r.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=s(e,r,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}});var e=new I.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(e)},n.prototype.addIceCandidate=function(a){var c,d=this;return a&&void 0===a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,t){if(!d._remoteDescription)return t(p("InvalidStateError","Can not add ICE candidate without a remote description"));if(a&&""!==a.candidate){var r=a.sdpMLineIndex;if(a.sdpMid)for(var n=0;n<d.transceivers.length;n++)if(d.transceivers[n].mid===a.sdpMid){r=n;break}var i=d.transceivers[r];if(!i)return t(p("OperationError","Can not add ICE candidate"));if(i.rejected)return e();var o=0<Object.keys(a.candidate).length?D.parseCandidate(a.candidate):{};if("tcp"===o.protocol&&(0===o.port||9===o.port))return e();if(o.component&&1!==o.component)return e();if((0===r||0<r&&i.iceTransport!==d.transceivers[0].iceTransport)&&!M(i.iceTransport,o))return t(p("OperationError","Can not add ICE candidate"));t=a.candidate.trim();0===t.indexOf("a=")&&(t=t.substr(2)),(c=D.getMediaSections(d._remoteDescription.sdp))[r]+="a="+(o.type?t:"end-of-candidates")+"\r\n",d._remoteDescription.sdp=D.getDescription(d._remoteDescription.sdp)+c.join("")}else for(var s=0;s<d.transceivers.length&&(d.transceivers[s].rejected||(d.transceivers[s].iceTransport.addRemoteCandidate({}),(c=D.getMediaSections(d._remoteDescription.sdp))[s]+="a=end-of-candidates\r\n",d._remoteDescription.sdp=D.getDescription(d._remoteDescription.sdp)+c.join(""),!d.usingBundle));s++);e()})},n.prototype.getStats=function(t){if(t&&t instanceof I.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw p("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){t[e]&&n.push(t[e].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(e){var t,e=I[e];e&&e.prototype&&e.prototype.getStats&&(t=e.prototype.getStats,e.prototype.getStats=function(){return t.apply(this).then(function(r){var n=new Map;return Object.keys(r).forEach(function(e){var t;r[e].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(t=r[e]).type]||t.type,n.set(e,r[e])}),n})})}),["createOffer","createAnswer"].forEach(function(e){var r=n.prototype[e];n.prototype[e]=function(){var t=arguments;return"function"==typeof t[0]||"function"==typeof t[1]?r.apply(this,[arguments[2]]).then(function(e){"function"==typeof t[0]&&t[0].apply(null,[e])},function(e){"function"==typeof t[1]&&t[1].apply(null,[e])}):r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var r=n.prototype[e];n.prototype[e]=function(){var t=arguments;return"function"==typeof t[1]||"function"==typeof t[2]?r.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)},function(e){"function"==typeof t[2]&&t[2].apply(null,[e])}):r.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=n.prototype[e];n.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),n}},{sdp:17}],17:[function(e,t,r){"use strict";var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier(),d.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},d.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},d.getDescription=function(e){e=d.splitSections(e);return e&&e[0]},d.getMediaSections=function(e){e=d.splitSections(e);return e.shift(),e},d.matchPrefix=function(e,t){return d.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},d.parseCandidate=function(e){for(var t,r={foundation:(t=(0===e.indexOf("a=candidate:")?e.substring(12):e.substring(10)).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},d.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},d.parseIceOptions=function(e){return e.substr(14).split(" ")},d.parseRtpMap=function(e){var t=e.substr(9).split(" "),e={payloadType:parseInt(t.shift(),10)},t=t[0].split("/");return e.name=t[0],e.clockRate=parseInt(t[1],10),e.channels=3===t.length?parseInt(t[2],10):1,e.numChannels=e.channels,e},d.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},d.parseExtmap=function(e){e=e.substr(9).split(" ");return{id:parseInt(e[0],10),direction:0<e[0].indexOf("/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},d.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},d.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},d.writeFmtp=function(t){var r,e="",n=t.payloadType;return void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length&&(r=[],Object.keys(t.parameters).forEach(function(e){t.parameters[e]?r.push(e+"="+t.parameters[e]):r.push(e)}),e+="a=fmtp:"+n+" "+r.join(";")+"\r\n"),e},d.parseRtcpFb=function(e){e=e.substr(e.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},d.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},d.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return-1<n?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},d.parseSsrcGroup=function(e){e=e.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(e){return parseInt(e,10)})}},d.getMid=function(e){e=d.matchPrefix(e,"a=mid:")[0];if(e)return e.substr(6)},d.parseFingerprint=function(e){e=e.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},d.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:d.matchPrefix(e+t,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},d.getIceParameters=function(e,t){e=d.splitLines(e);return{usernameFragment:(e=e.concat(d.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:e.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},d.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},d.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=d.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var i=r[n],o=d.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var s=d.parseRtpMap(o),o=d.matchPrefix(e,"a=fmtp:"+i+" ");switch(s.parameters=o.length?d.parseFmtp(o[0]):{},s.rtcpFeedback=d.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(d.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return d.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(d.parseExtmap(e))}),t},d.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=0<t.codecs.length?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=d.writeRtpMap(e),r+=d.writeFmtp(e),r+=d.writeRtcpFb(e)});var n=0;return t.codecs.forEach(function(e){e.maxptime>n&&(n=e.maxptime)}),0<n&&(r+="a=maxptime:"+n+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=d.writeExtmap(e)}),r},d.parseRtpEncodingParameters=function(e){var t,r=[],n=d.parseRtpParameters(e),i=-1!==n.fecMechanisms.indexOf("RED"),o=-1!==n.fecMechanisms.indexOf("ULPFEC"),s=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),a=0<s.length&&s[0].ssrc,s=d.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});0<s.length&&1<s[0].length&&s[0][0]===a&&(t=s[0][1]),n.codecs.forEach(function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)},a&&t&&(e.rtx={ssrc:t}),r.push(e),i&&((e=JSON.parse(JSON.stringify(e))).fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},r.push(e)))}),0===r.length&&a&&r.push({ssrc:a});var c=d.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=c})),r},d.parseRtcpParameters=function(e){var t={},r=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);r=d.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<r.length,t.compound=0===r.length;e=d.matchPrefix(e,"a=rtcp-mux");return t.mux=0<e.length,t},d.parseMsid=function(e){var t,r=d.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};e=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<e.length?{stream:(t=e[0].value.split(" "))[0],track:t[1]}:void 0},d.parseSctpDescription=function(e){var t,r=d.parseMLine(e),n=d.matchPrefix(e,"a=max-message-size:");0<n.length&&(t=parseInt(n[0].substr(19),10)),isNaN(t)&&(t=65536);n=d.matchPrefix(e,"a=sctp-port:");if(0<n.length)return{port:parseInt(n[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};if(0<d.matchPrefix(e,"a=sctpmap:").length){e=d.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:t}}},d.writeSctpDescription=function(e,t){var r=[],r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"];return void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(e,t,r){t=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||d.generateSessionId())+" "+t+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(e,t,r,n){t=d.writeRtpDescription(e.kind,t);return t+=d.writeIceParameters(e.iceGatherer.getLocalParameters()),t+=d.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),t+="a=mid:"+e.mid+"\r\n",e.direction?t+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?t+="a=sendrecv\r\n":e.rtpSender?t+="a=sendonly\r\n":e.rtpReceiver?t+="a=recvonly\r\n":t+="a=inactive\r\n",e.rtpSender&&(t+="a="+(n="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n"),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+n,e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+n,t+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),t},d.getDirection=function(e,t){for(var r=d.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?d.getDirection(t):"sendrecv"},d.getKind=function(e){return d.splitLines(e)[0].split(" ")[0].substr(2)},d.isRejected=function(e){return"0"===e.split(" ",2)[1]},d.parseMLine=function(e){e=d.splitLines(e)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},d.parseOLine=function(e){e=d.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},d.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=d.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=d)},{}]},{},[1])(1)},function(e,t,r){var r=[r(0),r(5),r(2)];void 0===(r=function(e,t,r){"use strict";var n=e.stringifyJSON,i=e.isObject,h=e.isNumber,f=e.isBool;function o(){t.call(this),this._logger=r.create("RtcStats","console"),this._logger.verbose("RtcStats()"),this.videoTimestampPrev=null,this.videoFramesPrev=null,this.videoBytesPrev=0,this.audioTimestampPrev=null,this.audioBytesPrev=0,this.firstReportTimestamp=0,this.videoSsrcPrev=0,this.frameWidthPrev=void 0,this.frameHeightPrev=void 0,this.resolutionChanged=void 0}e=o.prototype=Object.create(t.prototype);return o.logger=r.create("RtcStats","console"),e.putReport=function(e,t,r){this._logger.verbose("putReport("+n(e)+", "+t+", "+r+")");r=this._filterStats(e,t,r);this.emitSimple("ReceivedWebRTCStats",{results:r})},e._filterStats=function(c,d,u){if(this._logger.verbose("_filterStats("+n(c)+", "+d+")"),i(c)){var l=this,p={};return c.forEach(function(e){var t,r,n,i,o,s,a;d&&"video"!==d||("track"===e.type&&("video"===e.kind||e.id&&-1!==e.id.indexOf("RTCMediaStreamTrack_sender")||f(e.remoteSource)&&!1===e.remoteSource)&&(e.framesPerSecond&&(p.framerate=Math.round(10*e.framesPerSecond)/10),e.frameWidth&&(p.frameWidth=e.frameWidth,p.frameHeight=e.frameHeight,h(l.frameWidthPrev)&&h(l.frameHeightPrev)?l.frameWidthPrev!==e.frameWidth||l.frameHeightPrev!==e.frameHeight?(l.resolutionChanged=1,l.frameWidthPrev=e.frameWidth,l.frameHeightPrev=e.frameHeight):l.resolutionChanged=0:(l.frameWidthPrev=e.frameWidth,l.frameHeightPrev=e.frameHeight,l.resolutionChanged=0))),"outbound-rtp"!==e.type||"video"!==e.mediaType)||(e.codecId&&((a=c.get(e.codecId))?(t=a.mimeType,p.videoCodec=t):p.videoCodec=e.codecId),r=e.timestamp,e.bytesSent&&(n=e.bytesSent,l.videoBytesPrev&&l.videoTimestampPrev&&(i=8*(n-l.videoBytesPrev)/(r-l.videoTimestampPrev),p.videoBitrate=Math.round(i)),l.videoBytesPrev=n),e.framesEncoded&&l.videoTimestampPrev&&(l.videoFramesPrev&&(s=1e3*(e.framesEncoded-l.videoFramesPrev)/(r-l.videoTimestampPrev),p.framerate=Math.round(10*s)/10),l.videoFramesPrev=e.framesEncoded),u&&(p.extended={nackCount:void 0,framesEncoded:void 0,keyFramesEncoded:void 0,totalEncodeTime:void 0,averageEncodeTime:void 0,encodeTimePercentage:void 0,idleTimePercentage:void 0,firCount:void 0,pliCount:void 0,resolutionChanged:void 0,priority:0},p.extended.nackCount=e.nackCount,p.extended.framesEncoded=e.framesEncoded,p.extended.keyFramesEncoded=e.keyFramesEncoded,p.extended.totalEncodeTime=e.totalEncodeTime,h(e.totalEncodeTime)&&h(e.framesEncoded)&&(o=e.totalEncodeTime/e.framesEncoded,p.extended.averageEncodeTime=Math.round(1e3*o)/1e3),l.firstReportTimestamp&&h(e.totalEncodeTime)&&(s=(r-l.firstReportTimestamp)/1e3,s=100-(o=100*e.totalEncodeTime/s),p.extended.encodeTimePercentage=Math.round(1e3*o)/1e3,p.extended.idleTimePercentage=Math.round(1e3*s)/1e3),e.ssrc&&l.videoSsrcPrev!==e.ssrc&&(l.videoSsrcPrev=e.ssrc,l.firstReportTimestamp=e.timestamp),p.extended.firCount=e.firCount,p.extended.pliCount=e.pliCount,p.extended.resolutionChanged=l.resolutionChanged,1===l.resolutionChanged&&(p.extended.priority=1)),l.videoTimestampPrev=r),d&&"audio"!==d||"outbound-rtp"!==e.type||"audio"!==e.mediaType||(e.codecId&&((a=c.get(e.codecId))?(t=a.mimeType,p.audioCodec=t):p.audioCodec=e.codecId),r=e.timestamp,e.bytesSent&&(n=e.bytesSent,l.audioBytesPrev&&l.audioTimestampPrev&&(i=8*(n-l.audioBytesPrev)/(r-l.audioTimestampPrev),p.audioBitrate=Math.round(i)),l.audioBytesPrev=n),l.audioTimestampPrev=r)}),p}},o}.apply(t,r))||(e.exports=r)},function(e,t,r){var n=r(24),i=r(116),o=r(9),s=r(54),a=/^\[object .+?Constructor\]$/,c=Function.prototype,r=Object.prototype,c=c.toString,r=r.hasOwnProperty,d=RegExp("^"+c.call(r).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(n(e)?d:a).test(s(e))}},function(t,e,r){!function(e){e="object"==typeof e&&e&&e.Object===Object&&e;t.exports=e}.call(this,r(113))},function(e,t,r){r=r(7)["__core-js_shared__"];e.exports=r},function(e,t){var r=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,r){var n=r(118),i=r(125),o=r(127),s=r(128),r=r(129);function a(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}a.prototype.clear=n,a.prototype.delete=i,a.prototype.get=o,a.prototype.has=s,a.prototype.set=r,e.exports=a},function(e,t,r){var i=r(57),o=r(23),s=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var n=e[t];s.call(e,t)&&o(n,r)&&(void 0!==r||t in e)||i(e,t,r)}},function(e,t,r){var n=r(131);e.exports=function(e,t,r){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},function(e,t,r){var u=r(133),l=r(35),p=r(8),h=r(18),f=r(135),g=r(27),m=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r,n=p(e),i=!n&&l(e),o=!n&&!i&&h(e),s=!n&&!i&&!o&&g(e),a=n||i||o||s,c=a?u(e.length,String):[],d=c.length;for(r in e)!t&&!m.call(e,r)||a&&("length"==r||o&&("offset"==r||"parent"==r)||s&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||f(r,d))||c.push(r);return c}},function(e,t){e.exports=function(){return!1}},function(e,t,r){var n=r(28),i=r(137),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t,r=[];for(t in Object(e))o.call(e,t)&&"constructor"!=t&&r.push(t);return r}},function(e,t){e.exports=function(t,r){return function(e){return t(r(e))}}},function(e,t){e.exports=function(e,t){var r=-1,n=e.length;for(t=t||Array(n);++r<n;)t[r]=e[r];return t}},function(e,t){e.exports=function(){return[]}},function(e,t,r){var n=r(65),i=r(40),o=r(39),r=r(63),r=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,o(e)),e=i(e);return t}:r;e.exports=r},function(e,t){e.exports=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}},function(e,t,r){var n=r(67),i=r(39),o=r(13);e.exports=function(e){return n(e,o,i)}},function(e,t,r){var n=r(65),i=r(8);e.exports=function(e,t,r){t=t(e);return i(e)?t:n(t,r(e))}},function(e,t,r){r=r(7).Uint8Array;e.exports=r},function(e,t,r){var n=r(158),i=r(14),r=r(15),r=r&&r.isMap,n=r?i(r):n;e.exports=n},function(e,t,r){var n=r(159),i=r(14),r=r(15),r=r&&r.isSet,n=r?i(r):n;e.exports=n},function(e,t,r){var g=r(178),m=r(181),v=r(182);e.exports=function(e,t,r,n,i,o){var s=1&r,a=e.length,c=t.length;if(a!=c&&!(s&&a<c))return!1;c=o.get(e);if(c&&o.get(t))return c==t;var d=-1,u=!0,l=2&r?new g:void 0;for(o.set(e,t),o.set(t,e);++d<a;){var p,h=e[d],f=t[d];if(void 0!==(p=n?s?n(f,h,d,t,e,o):n(h,f,d,e,t,o):p)){if(p)continue;u=!1;break}if(l){if(!m(t,function(e,t){if(!v(l,t)&&(h===e||i(h,e,r,n,o)))return l.push(t)})){u=!1;break}}else if(h!==f&&!i(h,f,r,n,o)){u=!1;break}}return o.delete(e),o.delete(t),u}},function(e,t){e.exports=function(e){var r=-1,n=Array(e.size);return e.forEach(function(e,t){n[++r]=[t,e]}),n}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}},function(e,t,r){var n=r(30);e.exports=function(e){return"number"==typeof e&&e==n(e)}},function(e,t,r){var n=r(42);e.exports=function(e){return e?(e=n(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},function(e,t,r){var h=r(33),f=r(45);e.exports=function(e,t,r,n){var i=r.length,o=i,s=!n;if(null==e)return!o;for(e=Object(e);i--;){var a=r[i];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<o;){var c=(a=r[i])[0],d=e[c],u=a[1];if(s&&a[2]){if(void 0===d&&!(c in e))return!1}else{var l,p=new h;if(!(void 0===(l=n?n(d,u,c,e,t,p):l)?f(u,d,3,n,p):l))return!1}}return!0}},function(e,t,r){var o=r(189),s=r(13);e.exports=function(e){for(var t=s(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,o(i)]}return t}},function(e,t,r){var n=r(4),i=r(1);e.exports=function(e){return"number"==typeof e||i(e)&&"[object Number]"==n(e)}},function(e,t,r){var n=r(4),i=r(8),o=r(1);e.exports=function(e){return"string"==typeof e||!i(e)&&o(e)&&"[object String]"==n(e)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}},function(e,t){e.exports=function(e,t,r){return e==e&&(void 0!==r&&(e=e<=r?e:r),void 0!==t&&(e=t<=e?e:t)),e}},function(e,t,r){var r=[r(83),r(84),r(6),r(0),r(218),r(31)];void 0===(r=function(e,t,r,n,i,o){"use strict";window.nanowebrtc={user:e,userinternal:t,tools:n,const:r,audioprocess:i,version:o.webrtc.release_version,release_description:o.webrtc.release_description}}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(5),r(0),r(6)];void 0===(r=function(r,e,n){"use strict";var t=e.parseJSON,i=e.stringifyJSON;function o(){r.call(this);var e=window.nanowebrtc.userinternal;this._rtcUser=new e;var t=this;n.EVENT_NAMES.webcast.forEach(function(e){t._rtcUser.on(e,function(e){t.emitSimple(e.name,e.data,e.error)})}),n.EVENT_NAMES.chat.forEach(function(e){t._rtcUser.on(e,function(e){t.emit(e.name,e.data)})}),o.browserSupport=e.browserSupport}e=o.prototype=Object.create(r.prototype);return o.browserSupport={supportLevel:-1,supportText:""},o.checkSupport=function(){var e=window.nanowebrtc.userinternal;return o.browserSupport=e.checkSupport(),t(i(o.browserSupport))},e.signIn=function(e){return this._rtcUser.signIn(e)},e.signOut=function(){return this._rtcUser.signOut()},e.isSignedIn=function(){return this._rtcUser.isSignedIn()},e.setConfig=function(e){return this._rtcUser.setConfig(e)},e.setIceServers=function(e){return this._rtcUser.setIceServers(e)},e.checkServer=function(e){return this._rtcUser.checkServer(e)},e.enableStats=function(e,t){return this._rtcUser.enableStats(e,t)},e.startBroadcast=function(e){return this._rtcUser.startBroadcast(e)},e.stopBroadcast=function(){return this._rtcUser.stopBroadcast()},e.sendMetaData=function(e,t){return this._rtcUser.sendMetaData(e,t)},e.enterRoom=function(e){return this._rtcUser.enterRoom(e)},e.leaveRoom=function(){return this._rtcUser.leaveRoom()},e.invokeCall=function(e){return this._rtcUser.invokeCall(e)},e.hangUpCall=function(e){return this._rtcUser.hangUpCall(e)},e.answerCall=function(e){return this._rtcUser.answerCall(e)},e.declineCall=function(e){return this._rtcUser.declineCall(e)},e.addScreenCaptureExtension=function(e){return this._rtcUser.addScreenCaptureExtension(e)},e.isScreenCaptureAvailable=function(){return this._rtcUser.isScreenCaptureAvailable()},e.getDevices=function(){return this._rtcUser.getDevices()},e.setVideoDevice=function(e){return this._rtcUser.setVideoDevice(e)},e.setAudioDevice=function(e){return this._rtcUser.setAudioDevice(e)},e.getSelectedVideoDevice=function(){return this._rtcUser.getSelectedVideoDevice()},e.getSelectedAudioDevice=function(){return this._rtcUser.getSelectedAudioDevice()},e.getSelectedDevice=function(e){return this._rtcUser.getSelectedDevice(e)},e.startPreview=function(e){return this._rtcUser.startPreview(e)},e.stopPreview=function(){return this._rtcUser.stopPreview()},e.muteVideo=function(e){return this._rtcUser.muteVideo(e)},e.muteAudio=function(e){return this._rtcUser.muteAudio(e)},e.muteDevice=function(e){return this._rtcUser.muteDevice(e)},e.injectExternalMediaStream=function(e){return this._rtcUser.injectExternalMediaStream(e)},o}.apply(t,r))||(e.exports=r)},function(e,t,R){var r=[R(85),R(6),R(0),R(5),R(90),R(91),R(32),R(94),R(19),R(95),R(3),R(97),R(2),R(98)];void 0===(r=function(c,a,d,t,r,n,i,o,s,u,l,p,h,f){"use strict";var g=R(100),m=d.getElement,v=d.stringifyJSON,_=d.parseJSON,S=d.isObject,b=d.isArray,y=d.isString,C=d.isBool,E=(d.isNumber,d.isInt),T=d.isEmpty,P={Chrome:{versions:{current:72,minimal:50},mobile:!0},Firefox:{versions:{current:66,minimal:42},mobile:!0},Opera:{versions:{current:60,minimal:40},mobile:!0},"Microsoft Edge":{versions:void 0,mobile:void 0},Safari:{versions:{current:12,minimal:11},mobile:!1}};function w(){t.call(this),this._logger=h.create("RtcUser","console"),this._logger.verbose("RtcUser()"),this._userId=void 0,this._iceServers=[{urls:["stun:stun.l.google.com:19302"]},{urls:["stun:stun.nanocosmos.net:80"],username:"nano",credential:"nano"}],this._iceServersOverride=void 0,this._config={codecs:{videoCodec:"H264"},bitrates:{videoSendInitialBitrate:0,videoSendBitrate:0},sdpPatches:{preventReplaceSendReceive:!1}},this._streamProtected=!1,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._metricsEnabled=!1,this._broadcaster=void 0,this._isBroadcasting=!1,this._audioMixer=new r,this._session=void 0,this._deviceController=new n,this._mediaController=new i(this._deviceController),this._mediaController.on("StreamTrackEnded",this._onStreamTrackEnded.bind(this)),this._screenCaptureExtension=new o;var e=this._screenCaptureExtension.getScreenCaptureName(),e=this._deviceController.addScreenCaptureDevice(e);0<e.length&&(e.updated=!0,this.emitSimple("ReceivedDeviceList",e)),this._videoDeviceConfig={},w.checkSupport()}var e=w.prototype=Object.create(t.prototype);return w.browserSupport={supportLevel:-1,supportText:""},w.logger=h.create("RtcUser","console"),w.checkSupport=function(){w.logger.verbose("checkSupport()");var e=d.browserInfo.browser,t=parseInt(d.browserInfo.browserVersion.split(".")[0],10),r=d.browserInfo.mobile,n=d.getVersionText(e,t,r);w.logger.verbose("checkSupport(): "+n);var i=1,n=P[e];void 0!==n&&(void 0!==n.versions&&void 0!==n.mobile?(i=0,t<n.versions.current&&t>=n.versions.minimal&&(i=2),(t<n.versions.minimal||r&&!1===n.mobile)&&(i=3)):i=3);r=d.getSupportText(e,t,r,i);return 1===i&&w.logger.error("checkSupport(): "+r),w.browserSupport.supportLevel=i,w.browserSupport.supportText=r,w.browserSupport},e.signIn=function(e){e=g.cloneDeep(e);this._logger.verbose("signIn("+v(e)+")");var t="signIn(): ",r=this;if(S(e))return e.userName&&this._logger.warning(t+'"options.userName" parameter is deprecated and will be removed in the WebRTC-Client v.6'),e.room&&(this._logger.warning(t+'"options.room" parameter is deprecated and will be removed in the WebRTC-Client v.6'),/_/.test(e.room)&&(e.room=e.room.replace(/_/g,""),this._logger.warning(t+'"options.room" parameter should not contain underscores (_)'))),e.serverUserName&&this._logger.warning(t+'"options.serverUserName" parameter is deprecated and will be removed in the WebRTC-Client v.6'),e.serverPassword&&this._logger.warning(t+'"options.serverPassword" parameter is deprecated and will be removed in the WebRTC-Client v.6'),p.isWebSocketUrl(e.server)||this._logger.warning(t+'"options.server" parameter is expected to be a String of format: "ws(s)://host[:port]/path[?query]". An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'),e.jwt&&(p.isJWT(e.jwt)||this._logger.warning(t+'"options.jwt" parameter is expected to be a String of format: "Base64-encoded part.Base64-encoded part.Base64-encoded part". An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6')),this.isSignedIn()?Promise.reject(l.SignInError("Already signed in")):(this._session=new s,this._session.on("SessionMessage",r._onSessionMessage.bind(r)),this._session.signIn(e).then(function(e){e.data&&(e.data.iceServers&&(r._iceServers=e.data.iceServers),r._userId=e.data.userId,(e=JSON.parse(JSON.stringify(e))).name="SignInSuccess",delete e.data.iceServers,r._logger.info(t+e.name+": "+v(e)),r.emitSimple(e.name,e.data),r._sendMetrics(e))}).catch(function(e){r._session.removeAllListeners(),"NanoError"!==e.type&&(e=l.GeneralError("Failed to sign in")),r._logger.error(t+v(e));e=l.composeEvent(e,"SignInError");r.emitSimple(e.name,e.data,e.error),r._sendMetrics(e)}));e=l.TypeNotValidError("options","Object");this._logger.error(t+v(e));e=l.composeEvent(e,"SignInError");this.emitSimple(e.name,e.data,e.error),this._sendMetrics(e)},e.signOut=function(){this._logger.verbose("signOut()");var t=this;if(!this.isSignedIn())return Promise.reject(l.NotSignedInError());this._session.signOut().then(function(){return t._destroy()}).then(function(){t._session.removeAllListeners(),t._session=void 0;var e={name:"SignOutSuccess",data:{}};t.emitSimple(e.name,e.data),t._sendMetrics(e)}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to sign out")),t._logger.error("signOut(): "+v(e));e=l.composeEvent(e,"SignOutError");t.emitSimple(e.name,e.data,e.error),t._sendMetrics(e)})},e.isSignedIn=function(){return this._logger.verbose("isSignedIn()"),!!this._session&&this._session.isSignedIn()},e.setConfig=function(e){var t=g.cloneDeep(e);this._logger.verbose("setConfig("+v(t)+")");var r="setConfig(): ";if(S(t)){var n={};if(S(t.metrics)){var i=""+t.metrics.accountId,e=""+t.metrics.accountKey;if(0<i.length&&0<e.length){n.graylog={credentials:{accountId:i,accountKey:e}};e=JSON.parse(JSON.stringify(t.metrics));delete e.accountId,delete e.accountKey;try{this._metricsController=new f(this,e),this._metricsEnabled=!0}catch(o){this._logger.error(r+v(o)),this._metricsEnabled=!1}}}p.isIntInRange(t.logLevel,a.LOG_LEVEL.DISABLED,a.LOG_LEVEL.VERBOSE)&&(n.console={level:t.logLevel}),T(n)||h.setConfig(n),t.codecs&&(y(t.codecs.videoCodec)?this._config.codecs.videoCodec=t.codecs.videoCodec:void 0!==t.codecs.videoCodec&&(o=l.TypeNotValidError("config.bitrates.videoCodec","String"),this._logger.error(r+v(o)),s=l.composeEvent(o,"SetConfigError"),this.emitSimple(s.name,s.data,s.error),this._sendMetrics(s))),t.bitrates&&(E(t.bitrates.videoSendInitialBitrate)?(p.isIntInRange(t.bitrates.videoSendInitialBitrate,0,34e3)||this._logger.warning(r+'"config.bitrates.videoSendInitialBitrate" parameter is expected to be an Integer in range 0 - 34000 kbps. An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6'),this._config.bitrates.videoSendInitialBitrate=t.bitrates.videoSendInitialBitrate):void 0!==t.bitrates.videoSendInitialBitrate&&(o=l.TypeNotValidError("config.bitrates.videoSendInitialBitrate","Number"),this._logger.error(r+v(o)),s=l.composeEvent(o,"SetConfigError"),this.emitSimple(s.name,s.data,s.error),this._sendMetrics(s)),E(t.bitrates.videoSendBitrate)?(p.isIntInRange(t.bitrates.videoSendBitrate,0,34e3)||this._logger.warning(r+'"config.bitrates.videoSendBitrate" parameter is expected to be an Integer in range 0 - 34000 kbps. An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6'),this._config.bitrates.videoSendBitrate=t.bitrates.videoSendBitrate):void 0!==t.bitrates.videoSendBitrate&&(o=l.TypeNotValidError("config.bitrates.videoSendBitrate","Number"),this._logger.error(r+v(o)),s=l.composeEvent(o,"SetConfigError"),this.emitSimple(s.name,s.data,s.error),this._sendMetrics(s)),E(t.bitrates.audioSendBitrate)?(p.isIntInRange(t.bitrates.audioSendBitrate,0,512)||this._logger.warning(r+'"config.bitrates.audioSendBitrate" parameter is expected to be an Integer in range 0 - 512 kbps. An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6'),this._config.bitrates.audioSendBitrate=t.bitrates.audioSendBitrate):void 0!==t.bitrates.audioSendBitrate&&(o=l.TypeNotValidError("config.bitrates.audioSendBitrate","Number"),this._logger.error(r+v(o)),s=l.composeEvent(o,"SetConfigError"),this.emitSimple(s.name,s.data,s.error),this._sendMetrics(s))),t.sdpPatches&&(C(t.sdpPatches.preventReplaceSendReceive)?this._config.sdpPatches.preventReplaceSendReceive=t.sdpPatches.preventReplaceSendReceive:(o=l.TypeNotValidError("config.sdpPatches.preventReplaceSendReceive","Bool"),this._logger.error(r+v(o)),s=l.composeEvent(o,"SetConfigError"),this.emitSimple(s.name,s.data,s.error),this._sendMetrics(s))),t.iceServers&&b(t.iceServers)&&(this._config.iceServers=t.iceServers)}else{var o=l.TypeNotValidError("config","Object");this._logger.error(r+v(o));var s=l.composeEvent(o,"SetConfigError");this.emitSimple(s.name,s.data,s.error)}},e.setIceServers=function(e){e=g.cloneDeep(e);this._logger.verbose("setIceServers("+v(e)+")"),this._logger.warning('"setIceServers()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._iceServersOverride=e},e.checkServer=function(e){this._logger.verbose("checkServer()");var t=this;if(!this.isSignedIn())return Promise.reject(l.NotSignedInError());this._session.status().then(function(e){t.emitSimple("ReceivedServerStats",{stats:_(e.data)||{error:{message:"Could not parse response from server",code:-1,userinfo:null}}})}).catch(function(e){t._logger.error("checkServer: "+v(e))})},e.enableStats=function(e,t){this._logger.verbose("enableStats("+e+", "+t+")"),t<1e3&&this._logger.warning('enableStats(): "interval" parameter is expected to be an Integer higher than or equal to 1 second. An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'),this._statsEnabled=void 0===e||e,this._statsIntervalTime=t||1e3},e.startBroadcast=function(e){var r=g.cloneDeep(e);this._logger.debug("startBroadcast("+v(r)+")");var t="startBroadcast(): ",n=this;if(S(r)){if(!n.isSignedIn())return s=l.NotSignedInError(),this._logger.error(t+v(s)),a=l.composeEvent(s,"StartBroadcastError"),this.emitSimple(a.name,a.data,a.error),void this._sendMetrics(a);if(this._broadcaster)return s=l.WrongStateError("Already broadcasting"),this._logger.error(t+v(s)),a=l.composeEvent(s,"StartBroadcastError"),this.emitSimple(a.name,a.data,a.error),void this._sendMetrics(a);var i=this._mediaController.getLocalMedias()[0];if(!i)return s=l.WrongStateError("No Local Media"),this._logger.error(t+v(s)),a=l.composeEvent(s,"StartBroadcastError"),this.emitSimple(a.name,a.data,a.error),void this._sendMetrics(a);r.encoding&&!T(r.encoding)&&(p.isH264Profile(r.encoding.h264Profile)?(("Chrome"!==d.browserInfo.browser||"Windows"!==d.browserInfo.os||"Chrome"===d.browserInfo.browser&&d.browserInfo.mobile)&&(delete r.encoding.h264Profile,this._logger.warning(t+'"config.encoding.h264Profile" parameter should be set in Chrome desktop for Windows only.')),this._config.encoding=r.encoding):this._logger.warning(t+'"config.encoding.h264Profile" parameter is not a valid H264 codec profile.')),this._broadcaster=new c(this._userId,this._session),this._config.jwt=r.jwt,this._config.extended=this._metricsEnabled,this._broadcaster.setConfig(this._config);e=this._iceServersOverride||this._config.iceServers||this._iceServers;this._broadcaster.setIceServers(e),this._broadcaster.enableStats(this._statsEnabled,this._statsIntervalTime),this._listenToBroadcaster(this._broadcaster);var o=i.stream;this._broadcaster.addStream(o),S(r.transcodingTargets)||(r.transcodingTargets={}),T(r.transcodingTargets)||(p.isRtmpUrl(r.transcodingTargets.output)||this._logger.warning(t+'"config.transcodingTargets.output" parameter is expected to be a String of format: "rtmp(s)://host[:port]/application/[path]". An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'),r.transcodingTargets.audiobitrate&&(p.isIntInRange(r.transcodingTargets.audiobitrate,0,512)||this._logger.warning(t+'Starting from the WebRTC-Client v.6, the "config.transcodingTargets.audiobitrate" parameter will be expected to be an Integer in range 0 - 510 kbps.')),r.transcodingTargets.rtmpconnectinfo&&(p.isObjectOfMaxDepth(r.transcodingTargets.rtmpconnectinfo,1)||this._logger.warning(t+'"config.transcodingTargets.rtmpconnectinfo" parameter is expected to be a flat object (of max depth 1). An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'))),r.jwt&&(p.isJWT(r.jwt)||this._logger.warning(t+'"options.jwt" parameter is expected to be a String of format: "Base64-encoded part.Base64-encoded part.Base64-encoded part". An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'));i=i.metadata;r.transcodingTargets.videowidth=i.width,r.transcodingTargets.videoheight=i.height,this._deviceController.getDevice("videoinput").then(function(e){var t=C(e)?n._videoDeviceConfig:e.videoDeviceConfig;return(!C(e)||C(e)&&!0===e)&&(r.transcodingTargets.targetvideowidth=t.width&&t.width.ideal||0,r.transcodingTargets.targetvideoheight=t.height&&t.height.ideal||0,r.transcodingTargets.source=t.source||"",r.transcodingTargets.ismobile=d.browserInfo.mobile?1:0),n._broadcaster.setTranscodingSettings(r.transcodingTargets),n._broadcaster.start()}).then(function(e){n._streamProtected=!0,n._logger.info(t+"StartBroadcastSuccess: stream name: "+o),e.name="StartBroadcastSuccess",n.emitSimple(e.name,e.data),n._sendMetrics(e)}).catch(function(e){n._isBroadcasting=!1,n._broadcaster.destroy(),n._broadcaster=void 0,n._streamProtected=n._chatRoom&&!!n._chatRoom.getUsersCount()||!1,"NanoError"!==e.type&&(e=l.GeneralError("Failed to start broadcast")),n._logger.error(t+v(e)),a=l.composeEvent(e,"StartBroadcastError"),n.emitSimple(a.name,a.data,a.error),n._sendMetrics(a)})}else{var s=l.TypeNotValidError("config","Object");this._logger.error(t+v(s));var a=l.composeEvent(s,"StartBroadcastError");this.emitSimple(a.name,a.data,a.error)}},e.stopBroadcast=function(){this._logger.verbose("stopBroadcast()");var t="stopBroadcast(): ",r=this,e=r._broadcaster;this._broadcaster=void 0,e?e.stop().catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to stop broadcast")),r._logger.error(t+v(e));e=l.composeEvent(e,"StopBroadcastError");r.emitSimple(e.name,e.data,e.error),r._sendMetrics(e)}).then(function(e){r._isBroadcasting=!1,r._streamProtected=r._chatRoom&&!!r._chatRoom.getUsersCount()||!1,r._logger.info(t+"StopBroadcastSuccess"),e.name="StopBroadcastSuccess",r.emitSimple(e.name,e.data),r._sendMetrics(e)}):(e=l.StopBroadcastError("No broadcast is running"),this._logger.error(t+v(e)),e=l.composeEvent(e),this.emitSimple(e.name,e.data,e.error),this._sendMetrics(e))},e.sendMetaData=function(e,t){t=g.cloneDeep(t);this._logger.verbose("sendMetaData("+e+", "+v(t)+")");var r="sendMetaData(): ",n=this;if(!y(e)){var i=l.TypeNotValidError("handlerName","String");this._logger.error(r+v(i));var o=l.composeEvent(i,"Error");return this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o)}if(p.isMetadataHandler(e)||this._logger.warning(r+'"handlerName" parameter is expected to be a String containg one of the following values: "onMetaData" or "onCuePoint". An error will be thrown on incorrect type/value starting from the WebRTC-Client v.6'),!S(t))return i=l.TypeNotValidError("jsonValues","Object"),this._logger.error(r+v(i)),o=l.composeEvent(i,"Error"),this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o);p.isObjectOfMaxDepth(t,6)||this._logger.warning(r+'"jsonValues" parameter is expected to be an Object of max depth 6. An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'),this._isBroadcasting?this._channels.getBroadcaster().sendMetaData(e,t).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to send metadata")),n._logger.error(r+v(e));e=l.composeEvent(e,"Error");n.emitSimple(e.name,e.data,e.error),n._sendMetrics(e)}):(i=l.WrongStateError("Not broadcasting"),this._logger.error(r+v(i)),o=l.composeEvent(i,"Error"),this.emitSimple(o.name,o.data,o.error),this._sendMetrics(o))},e.enterRoom=function(e){var t=g.cloneDeep(e);this._logger.verbose("enterRoom("+v(t)+")");var r,n=this;if(!n.isSignedIn())return r=l.NotSignedInError(),i=l.composeEvent(r,"EnterRoomError"),void this.emitSimple(i.name,i.data,i.error);if(n._chatRoom)return r=l.WrongStateError("Already in room"),i=l.composeEvent(r,"EnterRoomError"),void this.emitSimple(i.name,i.data,i.error);if(!S(t))return r=l.TypeNotValidError("roomOptions","Object"),i=l.composeEvent(r,"EnterRoomError"),void n.emitSimple(i.name,i.data,i.error);if(!y(t.userName))return r=l.TypeNotValidError("roomOptions.userName","String"),i=l.composeEvent(r,"EnterRoomError"),void n.emitSimple(i.name,i.data,i.error);if(!y(t.room))return r=l.TypeNotValidError("roomOptions.room","String"),i=l.composeEvent(r,"EnterRoomError"),void n.emitSimple(i.name,i.data,i.error);t.userId=n._userId,n._chatRoom=new u(t,n._session,n._mediaController),n._chatRoom.setConfig(n._config);var i=n._iceServersOverride||n._iceServers;n._chatRoom.setIceServers(i),n._chatRoom.on("RoomUpdate",n._onRoomUpdate.bind(n)),n._chatRoom.on("RemoteStreamAdded",n._onRemoteStreamAdded.bind(this)),n._chatRoom.enter().then(function(){n._logger.info("enterRoom(): EnterRoomSuccess: user name: "+t.userName+", room name: "+t.room),n.emitSimple("EnterRoomSuccess",{})}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to enter room"));e=l.composeEvent(e,"EnterRoomError");n.emitSimple(e.name,e.data,e.error),n._chatRoom.removeEvent("RoomUpdate"),n._chatRoom=void 0})},e.leaveRoom=function(){this._logger.verbose("leaveRoom()");var e,t=this;t._chatRoom?(t._chatRoom.removeEvent("RoomUpdate"),t._chatRoom.removeEvent("RemoteStreamAdded"),t._chatRoom.leave().then(function(){t._logger.info("leaveRoom(): LeaveRoomSuccess: user name:"+t._chatRoom._userName+", room name: "+t._chatRoom._roomName),t.emitSimple("LeaveRoomSuccess",{})}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to leave room"));e=l.composeEvent(e,"LeaveRoomError");t.emitSimple(e.name,e.data,e.error)}).then(function(){t._chatRoom=void 0})):(e=l.ObjectNotExistError("_chatRoom","String"),e=l.composeEvent(e,"LeaveRoomError"),t.emitSimple(e.name,e.data,e.error))},e.invokeCall=function(e){this._logger.verbose("invokeCall("+e+")");var t,r,n=this;n._chatRoom?y(e)?n._chatRoom.callUser(e).then(function(){n._logger.info("invokeCall(): Invoke call: remote user id: "+e),n._streamProtected=!0}).catch(function(e){n._streamProtected=!!n._chatRoom.getUsersCount()||n._isBroadcasting,"NanoError"!==e.type&&(e=l.GeneralError("Failed to invoke call"));e=l.composeEvent(e,"InvokeCall");n.emitSimple(e.name,e.data,e.error)}):(t=l.TypeNotValidError("remoteUserId","String"),r=l.composeEvent(t,"InvokeCall"),n.emitSimple(r.name,r.data,r.error)):(t=l.ObjectNotExistError("_chatRoom","String"),r=l.composeEvent(t,"InvokeCall"),n.emitSimple(r.name,r.data,r.error))},e.hangUpCall=function(e){this._logger.verbose("hangUpCall("+e+")");var t,r,n=this;n._chatRoom?y(e)?n._chatRoom.hangUpCall(e).then(function(){n._logger.info("hangUpCall(): Hang up call: remote user id: "+e),n._streamProtected=!!n._chatRoom.getUsersCount()||n._isBroadcasting}).catch(function(e){n._streamProtected=!!n._chatRoom.getUsersCount()||n._isBroadcasting,"NanoError"!==e.type&&(e=l.GeneralError("Failed to hang up call"));e=l.composeEvent(e,"HangUpCall");n.emitSimple(e.name,e.data,e.error)}):(t=l.TypeNotValidError("remoteUserId","String"),r=l.composeEvent(t,"HangUpCall"),n.emitSimple(r.name,r.data,r.error)):(t=l.ObjectNotExistError("_chatRoom","String"),r=l.composeEvent(t,"HangUpCall"),n.emitSimple(r.name,r.data,r.error))},e.answerCall=function(e){this._logger.verbose("answerCall("+e+")");var t,r,n=this;n._chatRoom?y(e)?n._chatRoom.answerCall(e).then(function(){n._logger.info("answerCall(): Answer call: remote user id: "+e),n._streamProtected=!0}).catch(function(e){n._streamProtected=!!n._chatRoom.getUsersCount()||n._isBroadcasting,"NanoError"!==e.type&&(e=l.GeneralError("Failed to answer call")),n._logger.error("answerCall(): "+v(e));e=l.composeEvent(e,"AnswerCall");n.emitSimple(e.name,e.data,e.error)}):(t=l.TypeNotValidError("remoteUserId","String"),r=l.composeEvent(t,"AnswerCall"),n.emitSimple(r.name,r.data,r.error)):(t=l.ObjectNotExistError("_chatRoom","String"),r=l.composeEvent(t,"AnswerCall"),n.emitSimple(r.name,r.data,r.error))},e.declineCall=function(e){this._logger.verbose("declineCall("+e+")");var t,r,n=this;n._chatRoom?y(e)?n._chatRoom.declineCall(e).then(function(){n._logger.info("declineCall(): Decline call: remote user id: "+e)}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to decline call")),n._logger.error("declineCall(): "+v(e));e=l.composeEvent(e,"DeclineCall");n.emitSimple(e.name,e.data,e.error)}):(t=l.TypeNotValidError("remoteUserId","String"),r=l.composeEvent(t,"DeclineCall"),n.emitSimple(r.name,r.data,r.error)):(t=l.ObjectNotExistError("_chatRoom","String"),r=l.composeEvent(t,"DeclineCall"),n.emitSimple(r.name,r.data,r.error))},e.addScreenCaptureExtension=function(e){this._logger.verbose("addScreenCaptureExtension("+e+")");var t=d.browserInfo.browser,r=parseInt(d.browserInfo.browserVersion.split(".")[0],10);"Chrome"===t&&r<72?(e=y(e)?e:"nanoScreenCapture",this._screenCaptureExtension.addChromeExtension(e),0<(e=this._deviceController.addScreenCaptureDevice(e)).length&&(e.updated=!0,this.emitSimple("ReceivedDeviceList",e))):this._logger.warning("addScreenCaptureExtension(): Screen capture extension is only required for Chrome versions < 72")},e.isScreenCaptureAvailable=function(){return this._logger.verbose("isScreenCaptureAvailable()"),!!this._screenCaptureExtension&&this._screenCaptureExtension.isScreenCaptureAvailable()},e.getDevices=function(){this._logger.verbose("getDevices()"),this._deviceController.enumerateDevices().then(this._getDevicesSuccess.bind(this)).catch(this._getDevicesError.bind(this))},e.setVideoDevice=function(e){var t=g.cloneDeep(e);this._logger.verbose("setVideoDevice("+v(t)+")"),this._logger.warning('"setVideoDevice()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._streamProtected?(e=l.WrongStateError("Stream is already in use"),e=l.composeEvent(e,"SetVideoDeviceError"),this.emitSimple(e.name,e.data,e.error)):(t.kind="videoinput",this._deviceController.setDevice(t))},e.setAudioDevice=function(e){var t=g.cloneDeep(e);this._logger.verbose("setAudioDevice("+v(t)+")"),this._logger.warning('"setAudioDevice()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._streamProtected?(e=l.WrongStateError("Stream is already in use"),e=l.composeEvent(e,"SetAudioDeviceError"),this.emitSimple(e.name,e.data,e.error)):(t.kind="audioinput",this._deviceController.setDevice(t))},e.getSelectedVideoDevice=function(){var e;this._logger.verbose("getSelectedVideoDevice()"),this._logger.warning('"getSelectedVideoDevice()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._streamProtected?(e=l.WrongStateError("Stream is already in use"),e=l.composeEvent(e,"GetSelectedVideoDeviceError"),this.emitSimple(e.name,e.data,e.error)):this._deviceController.getDevice("videoinput").then(function(e){return e}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to get device"));e=l.composeEvent(e,"GetSelectedVideoDeviceError");self.emitSimple(e.name,e.data,e.error)})},e.getSelectedAudioDevice=function(){var e;this._logger.verbose("getSelectedAudioDevice()"),this._logger.warning('"getSelectedAudioDevice()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._streamProtected?(e=l.WrongStateError("Stream is already in use"),e=l.composeEvent(e,"GetSelectedAudioDeviceError"),this.emitSimple(e.name,e.data,e.error)):this._deviceController.getDevice("audioinput").then(function(e){return e}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to get device"));e=l.composeEvent(e,"GetSelectedAudioDeviceError");self.emitSimple(e.name,e.data,e.error)})},e.getSelectedDevice=function(e){var t=g.cloneDeep(e);this._logger.verbose("getSelectedDevice("+v(t)+")");var r="getSelectedDevice(): ",n=this;if(this._streamProtected){e=l.WrongStateError("Stream is already in use");this._logger.error(r+v(e));e=l.composeEvent(e,"GetSelectedDeviceError");return this.emitSimple(e.name,e.data,e.error),void this._sendMetrics(e)}p.isDeviceKind(t.kind)||this._logger.warning(r+'"config.kind" parameter is expected to be a String containg one of the following values: "videoinput" or "audioinput". An error will be thrown on incorrect type/value starting from the WebRTC-Client v.6'),this._deviceController.getDevice(t.kind).then(function(e){return n._logger.info(r+"Selected "+("videoinput"===t.kind?"video":"audio")+" device: "+v(e)),e}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to get device")),n._logger.error(r+v(e));e=l.composeEvent(e,"GetSelectedDeviceError");n.emitSimple(e.name,e.data,e.error),n._sendMetrics(e)})},e.startPreview=function(e){e=g.cloneDeep(e);this._logger.verbose("startPreview("+v(e)+")");var r="startPreview(): ",n=this;if(this._streamProtected){var t=l.WrongStateError("Stream is already in use");this._logger.error(r+v(t));var i=l.composeEvent(t,"StartPreviewError");return this.emitSimple(i.name,i.data,i.error),void this._sendMetrics(i)}if(!S(e))return t=l.TypeNotValidError("config","Object"),this._logger.error(r+v(t)),i=l.composeEvent(t,"StartPreviewError"),this.emitSimple(i.name,i.data,i.error),void this._sendMetrics(i);if(!S(e.videoDeviceConfig))return t=l.TypeNotValidError("config.videoDeviceConfig","Object"),this._logger.error(r+v(t)),i=l.composeEvent(t,"StartPreviewError"),this.emitSimple(i.name,i.data,i.error),void this._sendMetrics(i);if(!S(e.audioDeviceConfig))return t=l.TypeNotValidError("config.audioDeviceConfig","Object"),this._logger.error(r+v(t)),i=l.composeEvent(t,"StartPreviewError"),this.emitSimple(i.name,i.data,i.error),void this._sendMetrics(i);if(p.isVideoSource(e.videoDeviceConfig.source)||this._logger.warning(r+'"config.videoDeviceConfig.source" parameter is expected to be a String containg one of the following values: "camera" or "screen". An error will be thrown on incorrect type/value starting from the WebRTC-Client v.6'),e.videoDeviceConfig.width&&(p.isVideoWidth(e.videoDeviceConfig.width)||this._logger.warning(r+'"config.videoDeviceConfig.width" parameter is expected to be an Integer in range 320 - 3840(4K). An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6')),e.videoDeviceConfig.height&&(p.isVideoHeight(e.videoDeviceConfig.height)||this._logger.warning(r+'"config.videoDeviceConfig.height" parameter is expected to be an Integer in range 240 - 2160(4K). An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6')),e.videoDeviceConfig.framerate&&(p.isFramerate(e.videoDeviceConfig.framerate)||this._logger.warning(r+'"config.videoDeviceConfig.framerate" parameter is expected to be an Integer in range 0 - 60 fps. An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6')),p.isDevice(e.videoDeviceConfig.device)||this._logger.warning(r+'"config.videoDeviceConfig.device" parameter is expected to be a Boolean or an Integer. An error will be thrown on incorrect type/value starting from the WebRTC-Client v.6'),e.audioDeviceConfig.autoGainControl&&!C(e.audioDeviceConfig.autoGainControl))return t=l.TypeNotValidError("config.audioDeviceConfig.autoGainControl","Bool"),this._logger.error(r+v(t)),i=l.composeEvent(t,"StartPreviewError"),this.emitSimple(i.name,i.data,i.error),void this._sendMetrics(i);if(e.audioDeviceConfig.echoCancellation&&!C(e.audioDeviceConfig.echoCancellation))return t=l.TypeNotValidError("config.audioDeviceConfig.echoCancellation","Bool"),this._logger.error(r+v(t)),i=l.composeEvent(t,"StartPreviewError"),this.emitSimple(i.name,i.data,i.error),void this._sendMetrics(i);if(e.audioDeviceConfig.noiseSuppression&&!C(e.audioDeviceConfig.noiseSuppression))return t=l.TypeNotValidError("config.audioDeviceConfig.noiseSuppression","Bool"),this._logger.error(r+v(t)),i=l.composeEvent(t,"StartPreviewError"),this.emitSimple(i.name,i.data,i.error),void this._sendMetrics(i);i=e.videoDeviceConfig;i.kind="videoinput";var o=e.audioDeviceConfig;o.kind="audioinput";var s=e.elementId,a=!!e.useWebView;this._videoDeviceConfig.height={ideal:i.height},this._videoDeviceConfig.width={ideal:i.width},this._videoDeviceConfig.source=i.source,this._deviceController.setDevice(i).then(function(e){return n._logger.verbose(r+"Selected video device: "+v(e)),n._deviceController.setDevice(o)}).then(function(e){return n._logger.verbose(r+"Selected audio device: "+v(e)),n._getStream(a,!1)}).then(function(e){var t;e&&e.stream&&e.stream.data&&e.stream.data.stream&&(t=e.stream.data.stream,s&&(m(s).srcObject=t),n._logger.info(r+"StartPreviewSuccess: stream: "+v(e.stream)),e.name="StartPreviewSuccess",e.data=e.stream.data,delete e.stream,n.emitSimple(e.name,e.data),n._sendMetrics(e),e.devices&&(e.name="ReceivedDeviceList",n.emitSimple(e.name,e.devices.data)))}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to start preview")),n._logger.error(r+v(e));e=l.composeEvent(e,"StartPreviewError");n.emitSimple(e.name,e.data,e.error),n._sendMetrics(e)})},e.stopPreview=function(){this._logger.verbose("stopPreview()");var t=this;if(this._streamProtected){var e=l.WrongStateError("Stream is already in use"),e=l.composeEvent(e,"StopPreviewError");return this.emitSimple(e.name,e.data,e.error),void this._sendMetrics(e)}this._mediaController.removeLocalMedias().then(function(e){null===e.data.stream&&(e.name="StopPreviewSuccess",t.emitSimple(e.name,e.data),t._sendMetrics(e))}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to stop preview")),t._logger.error("stopPreview(): "+v(e));e=l.composeEvent(e,"StopPreviewError");t.emitSimple(e.name,e.data,e.error),t._sendMetrics(e)})},e.muteVideo=function(e){this._logger.verbose("muteVideo("+e+")"),this._logger.warning('"muteVideo()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._mediaController.muteVideoTracks(e)},e.muteAudio=function(e){this._logger.verbose("muteAudio("+e+")"),this._logger.warning('"muteAudio()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._mediaController.muteAudioTracks(e)},e.muteDevice=function(e){e=g.cloneDeep(e);this._logger.verbose("muteDevice("+v(e)+")");var t=this;this._mediaController.muteTracks(e).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to mute")),t._logger.error("muteDevice(): "+v(e));e=l.composeEvent(e,"MuteDeviceError");t.emitSimple(e.name,e.data,e.error),t._sendMetrics(e)})},e.injectExternalMediaStream=function(e){e=g.cloneDeep(e);return this._logger.verbose("injectExternalMediaStream("+v(e)+")"),e&&e.stream?d.isArray(e.tracks)&&e.tracks.length?this._streamProtected?Promise.reject(new Error("Cant inject, stream is already beeing used")):-1!==e.tracks.indexOf("audio")?this._mixExternalAudio(e.stream):Promise.reject(new Error('Mixing in tracks other than "audio" is not supported at the moment')):Promise.reject(new Error("Parameter config.tracks must contain an array with track types to be replaced")):Promise.reject(new Error("You need to provide a stream config object"))},e._listenToBroadcaster=function(e){this._logger.verbose("_listenToBroadcaster()"),e.on("BroadcastStatus",this._onBroadcastStatus.bind(this)),e.on("ReceivedWebRTCStats",this._onReceivedWebRTCStats.bind(this))},e._getStream=function(t,r,n){this._logger.verbose("_getStream("+t+", "+r+", "+v(n)+")");var i=this,o={};return Promise.resolve().then(function(){return r?i._deviceController.enumerateDevices():Promise.resolve()}).then(function(e){if(e&&e.data){if(!e.data.updated)return Promise.reject(n);i._getDevicesSuccess(e)}return i._deviceController.getDevice("videoinput")}).then(function(e){return o.videoinput=e,i._deviceController.getDevice("audioinput")}).then(function(e){return o.audioinput=e,i._mediaController.getMediaForDevices(o,t)}).catch(function(e){return"OverconstrainedError"===e.name&&e.userinfo&&"deviceId"===e.userinfo.constraint&&e.userinfo.retry&&!r?i._getStream(t,!0,e):Promise.reject(e)})},e._mixExternalAudio=function(e){if(this._logger.verbose("_mixExternalAudio("+v(e)+")"),!e)return Promise.reject(new Error("No external stream passed"));var r,n,t=this;return Promise.resolve(this._mediaController.getLocalMedias()[0]).then(function(e){if(e&&e[0])return e[0];throw new Error("No local stream")}).then(function(e){if(0<(n=(r=e).getAudioTracks()).length)return t._audioMixer.connect(r,0);throw new Error("Local stream has no audio")}).then(function(){return t._audioMixer.connect(e,1)}).then(function(){return t._audioMixer.getOutputStream()}).then(function(e){var t=n[0],e=e.getAudioTracks()[0];r.removeTrack(t),r.addTrack(e)}).catch(function(e){throw t._logger.error("_mixExternalAudio(): Could not mix audioTracks: "+e),e})},e._sendMetrics=function(e){this._metricsController&&this._metricsController.onEvent(e)},e._destroy=function(){this._logger.verbose("destroy()");var t=this;t._broadcaster&&t._broadcaster.stop().catch(function(e){t._logger.verbose(e)}).then(function(){t._broadcaster=void 0}),t._chatRoom&&t._chatRoom.destroy().catch(function(e){t._logger.verbose("_destroy(): "+v(e))}).then(function(){t._chatRoom=void 0})},e._onBroadcastStatus=function(e){this._logger.verbose("_onBroadcastStatus("+v(e)+")");var t={name:"BroadcastStatus"};switch(e.data.state){case a.BROADCAST_STATE.INITIALIZED:case a.BROADCAST_STATE.STARTED:case a.BROADCAST_STATE.SIGNALING:case a.BROADCAST_STATE.CONNECTED:case a.BROADCAST_STATE.RECONNECTING:case a.BROADCAST_STATE.STOPPED:t.data=e.data;break;case a.BROADCAST_STATE.BROADCASTING:t.data=e.data,this._isBroadcasting=!0;break;case a.BROADCAST_STATE.DISCONNECTED:return t.name="BroadcastError",t.error=l.BroadcastError("Broadcast got disconnected"),this.emitSimple(t.name,t.data,t.error),this._sendMetrics(t),this._isBroadcasting=!1,this._broadcaster.destroy(),void(this._broadcaster=void 0);case a.BROADCAST_STATE.FAILED:return this._isBroadcasting?(t.name="BroadcastError",t.error=l.BroadcastError("Unknown reason")):(t.name="StartBroadcastError",t.error=l.StartBroadcastError("Unknown reason")),this.emitSimple(t.name,t.data,t.error),this._sendMetrics(t),this._isBroadcasting=!1,this._broadcaster.destroy(),void(this._broadcaster=void 0)}this.emitSimple(t.name,t.data,t.error),this._sendMetrics(t)},e._onRemoteStreamAdded=function(e){this._logger.verbose("_onRemoteStreamAdded("+v(e)+")"),e.data.stream&&e.data.stream.id;for(var t=this._mediaController.getRemoteMedias(),r=0;r<t.length;r++){var n=t[r];if(n.stream.id===e.data.stream)return void this.emitSimple("CallActive",{data:n})}e.name="RemoteStreamError",this.emitSimple(e.name,e)},e._onReceivedWebRTCStats=function(e){var t;this._logger.verbose("_onReceivedWebRTCStats("+v(e)+")"),this._metricsController&&(t=JSON.parse(JSON.stringify(e)),this._metricsController.onEvent(t)),e.data&&e.data.results&&e.data.results.extended&&!T(e.data.results.extended)&&delete e.data.results.extended,this.emitSimple(e.name,e.data,e.error)},e._onSessionMessage=function(e){this._logger.verbose("_onSessionMessage("+v(e)+")"),"close"===e.type&&(this._destroy(),"disconnect"===e.reason&&(e=l.ServerError("disconnect"),this._logger.error("_onSessionMessage(): "+v(e)),e=l.composeEvent(e,"ServerError"),this.emitSimple(e.name,e.data,e.error),this._sendMetrics(e)))},e._onRoomUpdate=function(e){switch(this._logger.verbose("_onRoomUpdate("+v(e)+")"),e.type){case"room_update":this._streamProtected=!!this._chatRoom.getUsersCount()||this._isBroadcasting,this.emitSimple("PeerListUpdated",{data:e.data});break;case"call_incoming":this.emitSimple("CallIncoming",{data:e.data});break;case"call_declined":this._streamProtected=!!this._chatRoom.getUsersCount()||this._isBroadcasting,this.emitSimple("CallDeclined",{data:e.data})}},e._onStreamTrackEnded=function(e){this._logger.verbose("_onStreamTrackEnded("+v(e)+")"),this.emitSimple("StreamTrackEnded",{data:e})},e._getDevicesSuccess=function(e){this._logger.info("_getDevicesSuccess("+v(e)+")"),this.emitSimple("ReceivedDeviceList",e.data)},e._getDevicesError=function(e){this._logger.error("_getDevicesError("+v(e)+")"),this.emitSimple("GetDevicesError",e.data,e.error),this._sendMetrics(e)},w}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(19),r(47),r(6),r(5),r(0),r(50),r(3),r(2)];void 0===(r=function(e,o,t,r,n,i,s,a){"use strict";var c=n.isString,d=n.isIntString,u=n.stringifyJSON,l=n.isObject,p=n.isArray,h=n.isFunction,f=t.BROADCAST_STATE;function g(e,t){if(r.call(this),this._logger=a.create("Broadcaster","console"),this._logger.verbose("Broadcaster("+e+")"),d(e)||this._logger.error("Param userId must be an integer"),!t||!h(t.signIn))throw s.TypeNotValidError("session","Session");this._userId=e,this._remoteUserId=e,this._peerId=void 0,this._remotePeerId=void 0,this._remoteUserName="webrtc2H264",this._pcClient=void 0,this._streams=[],this._transcodingSettings={output:null,streamname:null,videobitrate:null,videowidth:null,videoheight:null,targetvideowidth:null,targetvideoheight:null,source:null,ismobile:null,audiobitrate:null,framerate:null,dropframes:null,h264passthrough:1,icecast_audio:null,icecast_event_id:null,rtmpconnectinfo:null},this._startTime=null,this._iceServers=[],this._config={},this._state=f.IDLE,this._sdpAnswerSent=!1,this._messageQueueRemote=[],this._messageQueueLocal=[],this._remoteStream=null,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._statsInterval=0,this._rtcStats=null,this._session=t}t=g.prototype=Object.create(r.prototype);return t.setIceServers=function(e){this._iceServers=e},t.setConfig=function(e){this._config=e},t.getState=function(){return this._state},t.getPeerId=function(){return this._peerId},t.setTranscodingSettings=function(e){for(var t in e)Object.prototype.hasOwnProperty.call(this._transcodingSettings,t)&&(this._transcodingSettings[t]=e[t])},t.start=function(){this._logger.verbose("start()");var t,r=this;return this._session.startBroadcast(this._getBroadcastParameters()).then(function(e){return r._peerId=e.peer_id,r._setState(f.INITIALIZED),t="receiver_peer_"+r._peerId,r._session.on(t,r._onServerMessage.bind(r)),r._transcodingSettings.output||(r._transcodingSettings.output=e.output),r._transcodingSettings.streamname||(r._transcodingSettings.streamname=e.stream_name),Promise.resolve({data:{output:r._transcodingSettings.output,streamname:r._transcodingSettings.streamname}})}).catch(function(e){return r._setState(f.FAILED),Promise.reject(e)})},t.stop=function(){this._logger.verbose("stop()");var t=this;return t._stopCollectRtcStats(),t._peerId&&t._remotePeerId?t._session.isSignedIn()?this._session.stopBroadcast({sender_peer:this._peerId,receiver_peer:this._remotePeerId}).then(function(){var e="receiver_peer_"+t._peerId;return t._session.removeEvent(e),e="receiver_peer_"+t._remotePeerId,t._session.removeEvent(e),t.destroy(),t._logger.verbose("stop(): Broadcast stopped"),Promise.resolve({data:{output:t._transcodingSettings.output,streamname:t._transcodingSettings.streamname}})}).catch(function(e){return e&&"NanoError"===e.type&&t._logger.error(s.StopBroadcastError("Stopping broadcast failed: "+e)),t.destroy(),t._logger.verbose("stop(): Broadcast stopped"),Promise.reject(e)}):(t.destroy(),Promise.resolve()):Promise.reject(s.StopBroadcastError("Not connected to any peer"))},t.addStream=function(e){this._logger.verbose("addStream()"),e?2!==this._streams.length?p(e)?this._streams=e:this._streams.push(e):this._logger.warning("addStream(): [_peerId: r "+this._peerId+"] Stream count is already = 2, we only support 2 streams/Broadcaster"):this._logger.error("addStream(): [_peerId: "+this._peerId+'] Parameter "stream" must not be undefined')},t.sendMetaData=function(e,t){if(this._logger.verbose("sendMetaData()"),this.getState()===f.BROADCASTING){this._logger.verbose("sendMetaData(): [_peerId: "+this._peerId+"] Sending metaData: "+e+" - "+u(t));var r={eventType:"metaData",eventName:e,strLabel:this._streams[0].id,payload:t},r={sender_peer:this._peerId,receiver_peer:this._remotePeerId,data:r};return this._session.sendMetaData(r)}r="[_peerId: "+this._peerId+"] Tried to send metaData but Broadcaster is not in active state";return this._logger.error(r),Promise.reject(r)},t.enableStats=function(e,t){this._logger.verbose("enableStats()"),this._statsEnabled=void 0===e||e,this._statsIntervalTime=t||1e3,this._rtcStats=null,this._statsEnabled&&(this._rtcStats=new i,this._rtcStats.on("ReceivedWebRTCStats",this._reemit.bind(this)))},t.destroy=function(){this._logger.verbose("destroy()"),this._unbind(),this._closePCClient(),this._messageQueueRemote=[],this._messageQueueLocal=[],this._sdpAnswerSent=!1,this._setState(f.STOPPED),a.delete(this._logger)},t._getBroadcastParameters=function(){this._logger.verbose("_getBroadcastParameters()");var e,t={};for(e in t.peer=this._peerId,this._transcodingSettings){var r=this._transcodingSettings[e];null!==r&&((l(r)||c(r))&&(r=u(r)),t[e.toString()]=r.toString())}return t.jwt=this._config.jwt,t.stream_label=this._streams[0]&&this._streams[0].id?this._streams[0].id:"",t.stream_label2=this._streams[1]&&this._streams[1].id?this._streams[1].id:"",t.videocodec=this._config.codecs.videoCodec||"H264",t.audio=0<this._streams[0].getAudioTracks().length?"1":"0",t.video=0<this._streams[0].getVideoTracks().length?"1":"0",t},t._onServerMessage=function(e){this._logger.verbose("_onServerMessage()");var r="_onServerMessage(): ",n=this;switch(e.type){case"transcoder_message":"started"===e.state?n._pcClient?n._logger.error(r+"We should not have a pcClient at this moment"):(n._createPCClient(),n._pcClient.startAsCallee(n._messageQueueRemote),n._setState(f.STARTED)):"disconnected"===e.state&&(n._setState(f.DISCONNECTED),n._logger.verbose(r+"Disconnected"));break;case"sdp_message":if(!e.sender_peer)return void n._logger.error(r+"Received sdp_message, but message has no sender_peer");n._remotePeerId=e.sender_peer,n._pcClient&&n._pcClient.isStarted()?n._pcClient.setRemoteDescription(e.data.sdp).catch(function(e){return n._logger.error(r+"setRemoteDescription failed: "+e),Promise.reject(e)}).then(function(){return n._logger.verbose(r+"setRemoteDescription succeded"),n._pcClient.doAnswer()}).catch(function(e){return n._logger.error(r+"doAnswer failed:"+e),Promise.reject(e)}).then(function(e){n._logger.verbose(r+"doAnswer succeded: "+u(e));var t={};return t.sender_peer=n._peerId,t.receiver_peer=n._remotePeerId,t.data=e,n.emitSimple("SDPAnswer",t),n._session.sendSignalingMessage(t).then(function(){n._sdpAnswerSent=!0}).catch(function(e){n._logger.error(r+"sendSignalingMessage (answer) failed: "+e)})}).catch(function(e){n._logger.error(r+"sendSignalingMessage failed: "+e)}):n._messageQueueRemote.push(e.data.sdp);break;case"ice_candidate":n._pcClient&&n._pcClient.isStarted()?n._pcClient.addIceCandidate(e.data.candidate):n._messageQueueRemote.push(e.data.candidate);break;case"rtmp_status":n._logger.verbose(r+"Received rtmp status: "+u(e.data)),e.data&&"status"===e.data.status&&("connected"===e.data.message?n._setState(f.BROADCASTING):"reconnecting"===e.data.message&&n._setState(f.RECONNECTING)),e.data&&"error"===e.data.status&&4711===e.data.number&&n._setState(f.FAILED);var t=n._addEventPayload({data:e.data});n.emit("BroadcastStatus",t);break;case"server_error":n._setState(f.FAILED),n._logger.error(r+"Server error: "+e.error);break;default:n._logger.verbose(r+"Unknown message:"+e)}},t._addEventPayload=function(e){return(e=e||{}).data=e.data||{},e.data.streamname=this._transcodingSettings.streamname,e.data.state=this._state,e.data.message=n.getKeyByValue(f,this._state).toLowerCase(),e.data.text=e.data.message,e},t._reemit=function(e){e=this._addEventPayload(e),this.emit(e.name,e)},t._collectRtcStats=function(){this._logger.verbose("_collectRtcStats()");var r=this,n=r._config.extended;clearInterval(r._statsInterval),this._statsInterval=setInterval(function(){if(r._pcClient){var t=void 0,e=r._getBroadcastParameters();if("1"===e.video&&"0"===e.audio)t="video";else if("0"===e.video&&"1"===e.audio)t="audio";else if("0"===e.video&&"0"===e.audio)return void r._logger.error('_collectRtcStatsAttempts to show stats for "no video" and "no audio" stream');r._pcClient.getStats(t).then(function(e){r._rtcStats||(r._rtcStats=new i),r._rtcStats.putReport(e,t,n)}).catch(function(e){r._logger.error("_collectRtcStats[_peerId: "+r._peerId+"] "+e)})}else clearInterval(r._statsInterval)},this._statsIntervalTime)},t._stopCollectRtcStats=function(){this._logger.verbose("_stopCollectRtcStats()"),this._statsInterval&&(this._logger.verbose("_stopCollectRtcStats(): Stopping rtc stats collection"),this._rtcStats.removeEvent("ReceivedWebRTCStats"),clearInterval(this._statsInterval),this._rtcStats=null)},t._getPeerConnectionConfig=function(){this._logger.verbose("_getPeerConnectionConfig()");var e={iceServers:this._iceServers,iceTransports:"all"},t={optional:[],mandatory:[]};return t.optional.push({googCpuOveruseDetection:!1}),t.optional.push({RtpDataChannels:!1}),{mediaConstraints:{audio:!0,video:!0},sdpPatches:this._config.sdpPatches,encoding:this._config.encoding,peerConnectionConfig:e,peerConnectionConstraints:t,send:0!==this._streams.length,receive:!1,audioSendBitrate:this._config.bitrates.audioSendBitrate||0,videoSendCodec:this._config.codecs.videoCodec||"H264",videoRecvCodec:this._config.codecs.videoCodec||"H264",videoSendBitrate:this._config.bitrates.videoSendBitrate||0,videoSendInitialBitrate:this._config.bitrates.videoSendInitialBitrate||0}},t._createPCClient=function(){this._logger.verbose("_createPCClient()");var r="_createPCClient(): ";if(this._pcClient)this._logger.verbose(r+"[_peerId:  "+this._peerId+"] PeerConnection still alive, do not create!");else try{if(this._pcClient=new o(this._getPeerConnectionConfig(),this._startTime),"object"==typeof callstats&&callstats&&callstats.fabricUsage)try{var e=callstats.fabricUsage.multiplex,t=this._remoteUserName,n=this._remoteUserName+"_"+this._peerId+"_"+this._userId+"__"+this._remotePeerId+"_"+this._remoteUserId;callstats.addNewFabric(this._pcClient._pc,t,e,n,function(e,t){this._logger.verbose(r+"Callstats Monitoring status: "+e+" msg: "+t)})}catch(e){this._logger.warning(r+"Error in callstats")}this._bind();for(var i=0;i<this._streams.length;i++)this._pcClient.addStream(this._streams[i]);this._logger.verbose(r+"Created PeerConnectionClient")}catch(e){this._logger.error(r+"[_peerId: "+this._peerId+"] Create PeerConnection exception: "+e.message),this.emitSimple("CreatePeerConnectionClientError")}},t._bind=function(){this._logger.verbose("_bind()"),this._pcClient.on("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.on("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.on("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.on("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.on("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.on("NegotiationNeeded",this._onNegotiationNeeded.bind(this))},t._unbind=function(){this._logger.verbose("_unbind()"),this._pcClient&&(this._pcClient.off("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.off("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.off("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.off("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.off("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.off("NegotiationNeeded",this._onNegotiationNeeded.bind(this)))},t._setState=function(e){var t;e!==this._state&&(t=this._state,this._state=e,this._logger.verbose("_setState(): State: "+n.getKeyByValue(f,t)+" -> "+n.getKeyByValue(f,this._state)))},t._onIceConnectionStateChange=function(e){switch(this._logger.verbose("_onIceConnectionStateChange("+u(e)+")"),this._logger.verbose("_onIceConnectionStateChange(): Ice connection state: "+e.data.state),e.data.state){case"new":case"checking":this._setState(f.SIGNALING);break;case"connected":case"completed":this._setState(f.CONNECTED),this._statsEnabled&&this._pcClient&&this._collectRtcStats(),this._config&&this._config.bitrates&&("Microsoft Edge"!==n.browserInfo.browser?this._pcClient.updateEncodingSettings(this._config.bitrates.audioSendBitrate||0,this._config.bitrates.videoSendBitrate||0):this._logger.warning("Setting bitrate is not supported in Microsoft Edge"));break;case"failed":this._setState(f.FAILED),this._statsEnabled&&this._pcClient&&this._stopCollectRtcStats();break;case"disconnected":this._setState(f.DISCONNECTED);break;case"closed":this._setState(f.STOPPED)}e=this._addEventPayload(e),this.emit("BroadcastStatus",e)},t._onNegotiationNeeded=function(e){this._logger.verbose("NegotiationNeeded event has been fired")},t._onEndOfLocalCandidates=function(e){this._logger.verbose("_onEndOfLocalCandidates()")},t._onRemoteStreamAdded=function(e){this._logger.verbose("_onRemoteStreamAdded()"),this._remoteStream=e.data.stream},t._onRemoteStreamRemoved=function(e){this._logger.verbose("_onRemoteStreamRemoved()"),this._remoteStream=null},t._closePCClient=function(){if(this._logger.verbose("_closePCClient()"),this._pcClient){for(var e=this._streams,t=0,r=e.length;t<r;++t)try{this._pcClient.removeStream(e[t])}catch(t){this._logger.error("_closePCClient(): [_peerId: "+this._peerId+"] Could not remove stream from peerconnectionclient")}this._pcClient.close(),this._pcClient=null}},t._sendMessageToPeer=function(e){this._logger.verbose("_sendMessageToPeer()");var t="_sendMessageToPeer(): ",r=this,n={},i=void 0;return this._remotePeerId&&c(this._remotePeerId)||(i=this._remotePeerId?s.TypeNotValidError("_remotePeerId","String"):s.ObjectNotExistError("_remotePeerId","String")),this._peerId&&c(this._peerId)||(i=this._peerId?s.TypeNotValidError("_peerId","String"):s.ObjectNotExistError("_peerId","String")),(i=!l(e)?s.TypeNotValidError("message","Object"):i)?(this._logger.error(t+u(i)),Promise.reject(i)):(n.sender_peer=this._peerId,n.receiver_peer=this._remotePeerId,n.data=e,n.data&&""===n.data.candidate?Promise.resolve():this._session.sendSignalingMessage(n).catch(function(e){return r._logger.error(t+u(e)),Promise.reject(e)}))},t._onSignalingMessage=function(e){this._logger.verbose("_onSignalingMessage - "+u(e.data));var t="_onSignalingMessage(): ",r=this;if(this._remotePeerId){if(this._sdpAnswerSent&&0<this._messageQueueLocal.length)for(this._logger.debug(t+"answer sent, sending enqueued messages, count: "+this._messageQueueLocal.length);0<this._messageQueueLocal.length;){var n=this._messageQueueLocal.shift();n&&this._sendMessageToPeer(n).catch(function(e){r._logger.error(t+u(e))})}if(!this._sdpAnswerSent)return this._logger.debug(t+"answer not sent yet, enqueueing message."),void this._messageQueueLocal.push(e.data);this._sendMessageToPeer(e.data).then(function(){}).catch(function(e){r._logger.error(t+u(e))})}else this._logger.error(t+"Trying to send message, but no remote peer set! This should not happen!")},g}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(5),r(0),r(3),r(2)];void 0===(r=function(e,r,i,t){"use strict";var o=r.isString,s=r.stringifyJSON,a=r.isObject,c=r.isInt,n=r.isFunction,d=0,u={IDLE:1,CONNECTED:2,CLOSED:3};function l(){this._websocket=void 0,this._url=void 0,this._callback=void 0,this._state=u.IDLE,this._resolvers={},this._logger=t.create("WebsocketClient","console")}var p=l.prototype;return p.connect=function(e,t){if(this._logger.verbose("connect()"),!o(e))return Promise.reject(i.TypeNotValidError("url","String"));if(!n(t))return Promise.reject(i.TypeNotValidError("callback","Function"));if(this._state!==u.IDLE&&this._state!==u.CLOSED)return Promise.reject(i.WrongStateError());this._url=e,this._callback=t;var r=this;try{this._websocket=new WebSocket(this._url)}catch(e){return Promise.reject(i.CreateWebSocketError("Creating websocket failed",this._url))}return this._websocket.onclose=function(e){r._onClose(e)},this._websocket.onmessage=function(e){r._onMessage(e)},this._websocket.onerror=function(e){r._onError(e)},this._websocket.onopen=function(e){r._onOpen(e)},this._createResolver("connect")},p.close=function(){var e;return this._logger.verbose("close()"),this._websocket?(e=this._createResolver("close"),this._websocket.close(),this._setState(u.CLOSED),this._websocket=void 0):e=Promise.reject(i.WebSocketError("No websocket",this._url)),e},p.sendMessage=function(e,t){if(this._logger.verbose("sendMessage("+e+", "+s(t)+")"),!o(e))return Promise.reject(i.TypeNotValidError("type","String"));if(!a(t))return Promise.reject(i.TypeNotValidError("message","Object"));if(!this._websocket||1<this._websocket.readyState)return Promise.reject(i.WebSocketError("Sending message failed",this._url));var r=d++,n=this._createResolver(r);return this._websocket.send(s({type:e,message:t,message_id:r})),n},p._setState=function(e){var t;this._logger.verbose("_setState("+e+")"),e!==this._state&&(t=this._state,this._state=e,t="_setState(): State: "+r.getKeyByValue(u,t)+" -> "+r.getKeyByValue(u,this._state),this._logger.verbose(t))},p._onOpen=function(e){this._logger.verbose("_onOpen("+s(e)+")"),this._setState(u.CONNECTED),this._resolve("connect",{event:e})},p._onClose=function(e){this._logger.verbose("_onClose("+s(e)+")"),this._setState(u.CLOSED),this._resolve("close",{type:e.type,code:e.code})},p._onMessage=function(e){var t,r;if(this._logger.verbose("_onMessage("+s(e.data)+")"),e&&e.data){try{t=JSON.parse(e.data)}catch(e){return void this._logger.error("_onMessage(): "+s(e))}r=t.message_id,this._resolve(r,t)}else this._logger.error('_onMessage(): event has no "data" property')},p._onError=function(e){this._logger.error("_onError("+s(e)+")"),this._resolve("connect",{event:e})},p._createResolver=function(e){if(this._logger.verbose("_createResolver("+e+")"),!c(e)&&!o(e))return Promise.reject("resolver error"+e);var r,n,t=new Promise(function(e,t){r=e,n=t});return this._resolvers[e]={resolve:r,reject:n},t},p._resolve=function(e,t){this._logger.verbose("_resolve("+e+", "+s(t)+")");var r="_resolve(): ",n=this._resolvers[e];if(n){if(this._logger.verbose(r+"Message id: "+e),delete this._resolvers[e],t&&t.event&&"error"===t.event.type&&"connect"===e)return n.reject(i.WebSocketError("Could not connect to server, please check server url",this._url));t.error?(this._logger.verbose(r+"Rejecting id: "+e),n.reject(t.error)):(this._logger.verbose(r+"Resolving id: "+e),n.resolve(t))}else this._logger.verbose(r+"Passive message"),this._callback(t)},l}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(0),r(46)];void 0===(r=function(e,c){"use strict";var d=e.stringifyJSON,u=e.isString;return function(e,t,r,n,i,o){this._globalPrefix=e,this._level=t,this._url=r,this._credentials={accountId:n,accountKey:i},this._id=o,this._logger=new c(e,"GrayLogger",t),this._logger.verbose("GrayLogger("+e+", "+t+", "+r+")");var s=0,a={};this.send=function(e,t){this._logger.verbose("send("+e+", "+d(t)+")");var r="send(): ",n=this;if(u(this._credentials.accountId)&&(""!==this._credentials.accountId||u(this._credentials.accountKey))&&""!==this._credentials.accountKey)try{s+=1;var i=new XMLHttpRequest;if((a[s]=i).open("POST",n._url+n._credentials.accountKey,!0),i.onreadystatechange=function(e,t){var r;this&&4===this.readyState&&(r=400<=this.status?"fail":200<=this.status?"success":"unknown",n._done.call(n,e,t,r))}.bind(i,s,e),void 0!==t){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){this._logger.error(r+d(e)),t=null}if("object"==typeof t)try{t=JSON.stringify(t),setTimeout(n._done.bind(n,s,e,"suspend"),5e3),i.send(t)}catch(e){this._logger.error(r+d(e)),n._done.call(n,s,"catch "+e.message)}}else this._logger.verbose(r+'"data" is undefined and will not be sent')}catch(e){this._logger.error(r+d(e)),n._done.call(n,s,"catch "+e.message)}else n._logger.verbose(r+"No credentials is set; graylogger is disabled. Returning")},this.destroy=function(){for(var e in this._logger.verbose("destroy()"),a){var t;Object.prototype.hasOwnProperty.call(a,e)&&("function"==typeof(t=a[e]).onreadystatechange&&(t.onreadystatechange=null),delete a[e])}},this._done=function(e,t,r){this._logger.verbose("_done("+e+", "+t+", "+r+")"),void 0!==a[e]&&("function"==typeof(r=a[e]).onreadystatechange&&(r.onreadystatechange=null),delete a[e])}}}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(6),r(48),r(0),r(2),r(3)];void 0===(r=function(e,t,r,n,o){"use strict";var s=r.isInt,a=r.isObject,c=r.stringifyJSON,d=r.browserInfo,u={_logger:n.create("EncodingUtils","console"),setSenderBitrates:function(t,r){u._logger.verbose("setSenderBitrates("+c(t)+", "+c(r)+")");var n="setSenderBitrates(): ";if(!(t&&t instanceof window.RTCPeerConnection)){var e=o.TypeNotValidError("peerConnection","RTCPeerConnection");return u._logger.error(n+JSON.stringify(e)),Promise.reject(e)}if(!a(r))return e=o.TypeNotValidError("bitrates","Object"),u._logger.error(n+JSON.stringify(e)),Promise.reject(e);var i=parseInt(d.browserVersion,10);return("Chrome"===d.browser||"Firefox"===d.browser&&64<=i||"Safari"===d.browser&&13<=i)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype?Promise.resolve().then(function(){if(s(r.video)){var e=u.getVideoSenders(t)[0];if(e)return u.setVideoSenderMaxBitrate(e,r.video);u._logger.verbose(n+'No sender of type "video" in peerconnection, skipping')}}).catch(function(e){u._logger.warning(n+e)}).then(function(){if(s(r.audio)){var e=u.getAudioSenders(t)[0];if(e)return u.setAudioSenderMaxBitrate(e,r.audio);u._logger.verbose(n+'No sender of type "audio" in peerconnection, skipping')}}).catch(function(e){u._logger.warning(n+e)}):(e=o.GeneralError("Can not set bitrates on RTCRtpSender, browser not supported"),u._logger.error(n+JSON.stringify(e)),Promise.reject(e))},setAudioSenderMaxBitrate:function(e,t){u._logger.verbose("setAudioSenderMaxBitrate("+e+", "+t+")");var r=e.getParameters();return(!r.encodings||r.encodings.length<=0)&&(r.encodings=[{}]),0===t?delete r.encodings[0].maxBitrate:r.encodings[0].maxBitrate=1e3*t,e.setParameters(r)},setVideoSenderMaxBitrate:function(e,t){u._logger.verbose("setVideoSenderMaxBitrate("+e+", "+t+")");var r=e.getParameters();return(!r.encodings||r.encodings.length<=0)&&(r.encodings=[{}]),0===t?delete r.encodings[0].maxBitrate:r.encodings[0].maxBitrate=1e3*t,e.setParameters(r)},getAudioSenders:function(e){return e.getSenders().filter(function(e){return e.track&&"audio"===e.track.kind})},getVideoSenders:function(e){return e.getSenders().filter(function(e){return e.track&&"video"===e.track.kind})},setDegradationPreference:function(e,t){},setSDPAudioOptions:function(e,t){return parseInt(d.browserVersion,10),t&&(t.bitrate&&(e.sdp=setCodecParam(sdp,"opus/48000","maxaveragebitrate",t.bitrate)),!0===t.cbr&&(e.sdp=setCodecParam(sdp,"opus/48000","cbr",1)),!0===t.stereo&&(e.sdp=maybeSetOpusOptions(e.sdp,{opusStereo:"true"}))),e}};return u}.apply(t,r))||(e.exports=r)},function(e,t,r){"use strict";window.mergeConstraints=function(e,t){if(!e||!t)return e||t;var r,n=e;for(r in t)n[r]=t[r];return n},window.iceCandidateType=function(e){return e.split(" ")[7]},window.maybeSetOpusOptions=function(e,t){return"true"===t.opusStereo?e=setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=removeCodecParam(e,"opus/48000","usedtx")),e=t.opusMaxPbr?setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr):e},window.maybeSetAudioSendBitRate=function(e,t){return t.audioSendBitrate?(trace("Prefer audio send bitrate: "+t.audioSendBitrate),preferBitRate(e,t.audioSendBitrate,"audio")):e},window.maybeSetAudioReceiveBitRate=function(e,t){return t.audioRecvBitrate?(trace("Prefer audio receive bitrate: "+t.audioRecvBitrate),preferBitRate(e,t.audioRecvBitrate,"audio")):e},window.maybeSetVideoSendBitRate=function(e,t){return t.videoSendBitrate?(trace("Prefer video send bitrate: "+t.videoSendBitrate),preferBitRate(e,t.videoSendBitrate,"video")):e},window.maybeSetVideoReceiveBitRate=function(e,t){return t.videoRecvBitrate?(trace("Prefer video receive bitrate: "+t.videoRecvBitrate),preferBitRate(e,t.videoRecvBitrate,"video")):e},window.preferBitRate=function(e,t,r){var n=e.split("\r\n"),i=findLine(n,"m=",r);if(null===i)return trace("Failed to add bandwidth line to sdp, as no m-line found"),e;r=findLineInRange(n,i+1,-1,"m=");null===r&&(r=n.length);i=findLineInRange(n,i+1,r,"c=");if(null===i)return trace("Failed to add bandwidth line to sdp, as no c-line found"),e;r=findLineInRange(n,i+1,r,"b=AS");return r&&n.splice(r,1),n.splice(i+1,0,"b=AS:"+t),n.join("\r\n")},window.maybeSetVideoSendInitialBitRate=function(e,t){var r=parseInt(t.videoSendInitialBitrate);if(!r)return e;var n=parseInt(r),i=parseInt(t.videoSendBitrate);i&&(i<r&&(trace("Clamping initial bitrate to max bitrate of "+i+" kbps."),t.videoSendInitialBitrate=r=i),n=i);var o=e.split("\r\n"),r=findLine(o,"m=","video");if(null===r)return trace("Failed to find video m-line"),e;i=o[r],r=new RegExp("m=video\\s\\d+\\s[A-Z/]+\\s"),r=i.split(r)[1].split(" ")[0],r=o[findLine(o,"a=rtpmap",r)].split("a=rtpmap:"+r)[1].split("/")[0],r=t.videoSendCodec||r;return e=setCodecParam(e,r,"x-google-min-bitrate",t.videoSendInitialBitrate.toString()),setCodecParam(e,r,"x-google-max-bitrate",n.toString())},window.removePayloadTypeFromMline=function(e,t){e=e.split(" ");for(var r=0;r<e.length;++r)e[r]===t.toString()&&e.splice(r,1);return e.join(" ")},window.removeCodecByName=function(e,t){var r=findLine(e,"a=rtpmap",t);if(null===r)return e;t=getCodecPayloadTypeFromLine(e[r]);e.splice(r,1);r=findLine(e,"m=","video");return null===r||(e[r]=removePayloadTypeFromMline(e[r],t)),e},window.removeCodecByPayloadType=function(e,t){var r=findLine(e,"a=rtpmap",t.toString());if(null===r)return e;e.splice(r,1);r=findLine(e,"m=","video");return null===r||(e[r]=removePayloadTypeFromMline(e[r],t)),e},window.maybeRemoveVideoFec=function(e,t){if("false"!==t.videoFec)return e;var r=e.split("\r\n"),n=findLine(r,"a=rtpmap","red");if(null===n)return e;t=getCodecPayloadTypeFromLine(r[n]),r=removeCodecByPayloadType(r,t);if(r=removeCodecByName(r,"ulpfec"),null===(n=findLine(r,"a=fmtp",t.toString())))return e;t=parseFmtpLine(r[n]).pt;return null===t?e:(r.splice(n,1),(r=removeCodecByPayloadType(r,t)).join("\r\n"))},window.maybePreferAudioSendCodec=function(e,t){return maybePreferCodec(e,"audio","send",t.audioSendCodec)},window.maybePreferAudioReceiveCodec=function(e,t){return maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},window.maybePreferVideoSendCodec=function(e,t){return maybePreferCodec(e,"video","send",t.videoSendCodec)},window.maybePreferVideoReceiveCodec=function(e,t){return maybePreferCodec(e,"video","receive",t.videoRecvCodec)},window.maybePreferCodec=function(e,t,r,n){r=t+" "+r+" codec";if(!n)return trace("No preference on "+r+"."),e;trace("Prefer "+r+": "+n);var i=e.split("\r\n"),o=findLine(i,"m=",t);if(null===o)return e;for(var s,a=i.length-1;0<=a;--a){var c=findLineInRange(i,a,0,"a=rtpmap",n,"desc");if(null===c)break;a=c,(s=getCodecPayloadTypeFromLine(i[c]))&&(i[o]=setDefaultCodec(i[o],s))}return i.join("\r\n")},window.setCodecParam=function(e,t,r,n){var i=e.split("\r\n"),o=findFmtpLine(i,t),s={};if(null===o){t=findLine(i,"a=rtpmap",t);if(null===t)return e;e=getCodecPayloadTypeFromLine(i[t]);s.pt=e.toString(),s.params={},s.params[r]=n,i.splice(t+1,0,writeFmtpLine(s))}else(s=parseFmtpLine(i[o])).params[r]=n,i[o]=writeFmtpLine(s);return i.join("\r\n")},window.removeCodecParam=function(e,t,r){var n=e.split("\r\n"),t=findFmtpLine(n,t);if(null===t)return e;e=parseFmtpLine(n[t]);delete e.params[r];e=writeFmtpLine(e);return null===e?n.splice(t,1):n[t]=e,n.join("\r\n")},window.parseFmtpLine=function(e){var t={},r=e.indexOf(" "),n=e.substring(r+1).split(";"),r=new RegExp("a=fmtp:(\\d+)"),r=e.match(r);if(!r||2!==r.length)return null;t.pt=r[1];for(var i={},o=0;o<n.length;++o){var s=n[o].split("=");2===s.length&&(i[s[0]]=s[1])}return t.params=i,t},window.writeFmtpLine=function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t,r=e.pt,n=e.params,i=[],o=0;for(t in n)i[o]=t+"="+n[t],++o;return 0===o?null:"a=fmtp:"+r.toString()+" "+i.join(";")},window.findFmtpLine=function(e,t){t=getCodecPayloadType(e,t);return t?findLine(e,"a=fmtp:"+t.toString()):null},window.findLine=function(e,t,r){return findLineInRange(e,0,-1,t,r)},window.findLineInRange=function(e,t,r,n,i,o){if("asc"===(o=(o=void 0===o?"asc":o)||"asc")){for(var s=-1!==r?r:e.length,a=t;a<s;++a)if(0===e[a].indexOf(n)&&(!i||-1!==e[a].toLowerCase().indexOf(i.toLowerCase())))return a}else for(var c=-1!==t?t:e.length-1;0<=c;--c)if(0===e[c].indexOf(n)&&(!i||-1!==e[c].toLowerCase().indexOf(i.toLowerCase())))return c;return null},window.getCodecPayloadType=function(e,t){t=findLine(e,"a=rtpmap",t);return t?getCodecPayloadTypeFromLine(e[t]):null},window.getCodecPayloadTypeFromLine=function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),t=e.match(t);return t&&2===t.length?t[1]:null},window.setDefaultCodec=function(e,t){var r=e.split(" "),n=r.slice(0,3);n.push(t);for(var i=3;i<r.length;i++)r[i]!==t&&n.push(r[i]);return n.join(" ")}},function(e,t,r){var r=[r(5),r(0),r(2)];void 0===(r=function(e,t,r){"use strict";var n=t.stringifyJSON,i=t.isNumber;function o(){e.call(this),this._logger=r.create("AudioMixer","console"),this._logger.verbose("AudioMixer()"),this._name="AudioMixer",this._audioContext,this._streams=[],this._output}t=o.prototype=Object.create(e.prototype);return t.connect=function(e,t){if(this._logger.verbose("connect("+n(e)+", "+t+")"),!e||0===e.getAudioTracks().length)return Promise.reject(new Error(this._name+'.connect parameter "stream" must contain a AudioStreamTrack'));if(!i(t)||1<t)return Promise.reject(new Error(this._name+'.connect parameter "input" must be 0 or 1'));e=e.clone();return this._streams[t]=e,this._listenToStream(e)},t.disconnect=function(e){this._logger.verbose("disconnect("+e+")"),r.delete(this._logger)},t.getOutputStream=function(){return this._logger.verbose("getOutputStream()"),this._streams.length<2?Promise.reject(new Error(this._name+" needs exactly 2 input streams")):this._getMixedStream()},t._listenToStream=function(e){return this._logger.verbose("_listenToStream("+n(e)+")"),e.onactive=this._onactive.bind(this),e.oninactive=this._oninactive.bind(this),e.onaddtrack=this._onaddtrack.bind(this),e.onended=this._onended.bind(this),Promise.resolve()},t._unregisterAudioTrackListeners=function(e){this._logger.verbose("_unregisterAudioTrackListeners("+e+")")},t._onactive=function(e){this._logger.verbose("_onactive("+n(e)+")")},t._oninactive=function(e){this._logger.verbose("_oninactive("+n(e)+")")},t._onaddtrack=function(e){this._logger.verbose("_onaddtrack("+n(e)+")")},t._onended=function(e){this._logger.verbose("_onended("+n(e)+")")},t._getMixedStream=function(){this._logger.verbose("_getMixedStream()"),this._audioContext||(this._audioContext=new AudioContext);var e=this._audioContext.createMediaStreamSource(this._streams[0]),t=this._audioContext.createMediaStreamSource(this._streams[1]),r=this._audioContext.createChannelSplitter(2),n=this._audioContext.createChannelSplitter(2);e.connect(r),t.connect(n);t=this._audioContext.createChannelMerger(4);r.connect(t,0,0),r.connect(t,1,1),n.connect(t,0,2),n.connect(t,1,3);n=this._createDownMixerNode();return t.connect(n),this._output=this._audioContext.createMediaStreamDestination(),n.connect(this._output),Promise.resolve(this._output.stream)},t._createDownMixerNode=function(){this._logger.verbose("_createDownMixerNode()");var e=this._audioContext.createScriptProcessor(4096,4,2);return e.onaudioprocess=function(e){for(var t,r=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),i=e.inputBuffer.getChannelData(2),o=e.inputBuffer.getChannelData(3),s=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1),c=0;c<r.length;c++)t=.25*(r[c]+n[c])+.25*(i[c]+o[c]),s[c]=t,a[c]=t},e},o}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(6),r(0),r(92),r(3),r(2)];void 0===(r=function(o,s,a,c,e){"use strict";var d=s.stringifyJSON,u=s.isObject,l=s.isBool,p=s.isInt,t=s.isFunction,i=s.browserInfo;function r(){this._devices={videoinput:[],audioinput:[]},this._selected={videoinput:!0,audioinput:!0},this._tempDevice=void 0,this._reenumeratedOnce=!1,this._logger=e.create("DeviceController","console")}var n=r.prototype;return n.enumerateDevices=function(){this._logger.verbose("enumerateDevices()");var n="enumerateDevices(): ",i=this;return i._verifyEnumerateDevicesExistence().then(function(e){return e.enumerateDevices()}).then(function(e){var t=i._createDevices(e),r=i._updateDevices(t),e=i._tempDevice;return e&&!i._hasSCD()&&(t=i._devices.videoinput.length,e.displayIndex=t,i._devices[e.kind].push(e)),Promise.resolve({data:{devices:{videodevices:i._listed().videoinput,audiodevices:i._listed().audioinput},updated:r}})}).catch(function(e){if(!e){var t=c.ObjectNotExistError("error","Error");return i._logger.error(n+JSON.stringify(t)),Promise.reject(t)}if("NanoError"!==e.type)return t=c.EnumerateDevicesError(e),r=c.composeEvent(t),i._logger.error(n+JSON.stringify(t)),Promise.reject(r);var r=c.composeEvent(e);return i._logger.error(n+JSON.stringify(e)),Promise.reject(r)})},n.addScreenCaptureDevice=function(e){this._logger.verbose("addScreenCaptureDevice("+e+")");var t=s.browserInfo.browser,r=s.browserInfo.mobile;if(!s.enumContainsValue(o.SCREEN_CAPTURE_BROWSER,t.toLowerCase())||r)return{};e=new a({deviceId:"screen",kind:"videoinput",label:e+" ("+t+")",displayLabel:e+" ("+t+")"});if("Chrome"!==t||this._hasDevices())return this._tempDevice=e,{};t=this._devices.videoinput.length;return e.displayIndex=t,this._devices.videoinput.push(e),{data:{devices:{videodevices:this._listed().videoinput,audiodevices:this._listed().audioinput},updated:!0}}},n.setDevice=function(e){this._logger.verbose("setDevice("+d(e)+")");var t="setDevice(): ";if(!u(e)){var r=c.TypeNotValidError("config","Object");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}if("videoinput"!==e.kind&&"audioinput"!==e.kind)return r=c.ValueNotValidError("config.kind","video/audio"),this._logger.error(t+JSON.stringify(r)),Promise.reject(r);if("camera"===e.source&&!l(e.device)&&!p(e.device))return r=c.TypeNotValidError("config.device","Boolean/Int"),this._logger.error(t+JSON.stringify(r)),Promise.reject(r);var n=e.device,i=this._devices[e.kind],o=void 0;if(l(n))o=n;else if(void 0!==(n="screen"===e.source?"screen"===i[i.length-1].deviceId?i[i.length-1]:void 0:i[n]))for(var s=0;s<i.length;s++)if(n.deviceId===i[s].deviceId){"videoinput"===e.kind&&n.setVideoDeviceConfig(e),"audioinput"===e.kind&&n.setAudioDeviceConfig(e),o=n;break}return void 0===o?(this._selected[e.kind]=!1,r=c.DevicesNotFoundError(),this._logger.error(t+JSON.stringify(r)),Promise.reject(r)):(this._selected[e.kind]=o,Promise.resolve({device:o}))},n.getDevice=function(e){if(this._logger.verbose("getDevice("+e+")"),"videoinput"!==e&&"audioinput"!==e){var t=c.ValueNotValidError("config.kind","video/audio");return this._logger.error("getDevice(): "+JSON.stringify(t)),Promise.reject(t)}t=this._selected;return Promise.resolve(t[e])},n.updateSelected=function(e,n){this._logger.verbose("updateSelected("+e+", "+n+")");var i=e.getVideoTracks(),r=e.getAudioTracks(),o=this;i&&0<i.length&&this.getDevice("videoinput").then(function(e){var t,r;n||"screen"!==!e.deviceId?(l(e)||(r=e.videoDeviceConfig||{},e.setVideoDeviceConfig(r)),o._selected.videoinput=e):(t=i[0].label,t=o._getDeviceForLabel(t),!0!==e&&t.label===e.label||(r=e.videoDeviceConfig||{},t.setVideoDeviceConfig(r),o._selected.videoinput=t))}).catch(function(e){o._logger.error("updateSelected(): "+JSON.stringify(e))}),r&&0<r.length&&o.getDevice("audioinput").then(function(e){var t;n?o._selected.audioinput=e:(t=r[0].label,t=o._getDeviceForLabel(t),!0!==e&&t.label===e.label||(o._selected.audioinput=t))}).catch(function(e){o._logger.error("updateSelected(): "+JSON.stringify(e))})},n.shouldReenumerate=function(e){if(this._logger.verbose("shouldReenumerate("+e+")"),e&&this._reenumeratedOnce)return!1;this._reenumeratedOnce=!0;for(var t=0,r=this._getAllDevices(),n=0;n<r.length;n++)""===(r[n].label||"")&&(t+=1);return t==(this._hasSCD()?r.length-1:r.length)},n.composeConstraints=function(o){this._logger.verbose("composeConstraints("+d(o)+")");var s="composeConstraints(): ",a=this;return this._getConstraintTypes(o).then(function(e){for(var t={audio:!1,video:!1},r=0;r<e.length;r++)switch(e[r]){case"video":l(o.videoinput)?t.video=o.videoinput:(t.video=o.videoinput.videoDeviceConfig,""!==o.videoinput.deviceId&&(t.video.deviceId={exact:o.videoinput.deviceId}));break;case"audio":l(o.audioinput)?t.audio=o.audioinput:(t.audio=o.audioinput.getAudioDeviceConfig(),""!==o.audioinput.deviceId&&(t.audio.deviceId={exact:o.audioinput.deviceId}));break;case"screen":var n=o.videoinput.videoDeviceConfig;t.video={width:n.width.ideal,height:n.height.ideal,frameRate:n.frameRate.ideal},l(o.audioinput)?t.audio=o.audioinput:(t.audio={},t.audio.deviceId={exact:o.audioinput.deviceId})}var i=s+JSON.stringify(t);return a._logger.verbose(i),Promise.resolve(t)}).catch(function(e){var t=s+JSON.stringify(e);return a._logger.error(t),Promise.reject(e)})},n._fixChromePermissionsIssue=function(){this._logger.verbose("_fixChromePermissionsIssue()");var t=this,e=i.browser,r=parseInt(i.browserVersion,10),n=1===i.mobile;return"Chrome"===e&&81<=r&&!n?this._verifyGetUserMediaExistence().then(function(e){return t._logger.verbose("_fixChromePermissionsIssue() - applying fix"),e.getUserMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!0})}):Promise.resolve()},n._getAllDevices=function(){return[].concat(this._devices.videoinput).concat(this._devices.audioinput)},n._hasDevices=function(){return!(0<this._getAllDevices().length)},n._hasSCD=function(){var e=this._devices.videoinput.length-1,e=this._devices.videoinput[e];return e&&e.deviceId===o.MEDIA_SOURCES.SCREEN},n._listed=function(){var e=this._getAllDevices();return this._getListedFromDevices(e)},n._createDevices=function(e){this._logger.verbose("_createDevices("+d(i)+")");for(var t={videoinput:[],audioinput:[]},r=0;r<e.length;r++){var n,i=e[r],o=i.kind;"videoinput"!==o&&"audioinput"!==o||(n=t[o].length,i.displayIndex=n,n=new a(i),t[o].push(n))}return t},n._addDevices=function(e){for(this._logger.verbose("_addDevices("+d(e)+")");this._devices.videoinput.length;)this._devices.videoinput.pop();for(;this._devices.audioinput.length;)this._devices.audioinput.pop();this._devices.videoinput=e.videoinput,this._devices.audioinput=e.audioinput},n._updateDevices=function(e){this._logger.verbose("_updateDevices("+d(a)+")");var t=[].concat(e.videoinput).concat(e.audioinput),r=this._getAllDevices().filter(function(e){return"screen"!==e.deviceId}),n=!1;if(r.length!==t.length)n=!0;else for(var i=0;i<r.length;i++){var o,s=r[i],a=t[i],c=["constraints","setVideoDeviceConfig","videoDeviceConfig"];for(o in s)if(Object.prototype.hasOwnProperty.call(s,o)&&Object.prototype.hasOwnProperty.call(a,o)&&-1===c.indexOf(o)&&-1===c.indexOf(o)&&s[o]!==a[o]){n=!0;break}}return this._addDevices(e),n},n._getDeviceForLabel=function(e){this._logger.verbose("_getDeviceForLabel("+e+")");var t,r=this._getAllDevices();if(-1!==e.indexOf("screen")){for(var n=0;n<r.length;n++)if("screen"===(t=r[n]).deviceId)return t}else for(n=0;n<r.length;n++)if((t=r[n]).label===e)return t},n._getListedFromDevices=function(e){this._logger.verbose("_getListedFromDevices("+d(e)+")");for(var t={videoinput:[],audioinput:[]},r=0;r<e.length;r++){var n=e[r];t[n.kind].push({index:n.displayIndex,id:n.label||n.displayId})}return t},n._getConstraintTypes=function(e){this._logger.verbose("_getConstraintTypes("+d(e)+")");var t="_getConstraintTypes(): ";if(!e){var r=c.ObjectNotExistError("devices","Array");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}var n=[];if(e.videoinput){var i=e.videoinput.videoDeviceConfig?e.videoinput.videoDeviceConfig.source:l(e.videoinput)?o.MEDIA_SOURCES.CAMERA:void 0;if(!s.enumContainsValue(o.MEDIA_SOURCES,i))return r=c.EnumValueNotValidError(i,o.MEDIA_SOURCES),this._logger.error(t+JSON.stringify(r)),Promise.reject(r);n.push(i===o.MEDIA_SOURCES.SCREEN?"screen":"video")}return e.audioinput&&(e.videoinput&&"screen"!==e.videoinput.deviceId||!e.videoinput)&&n.push("audio"),Promise.resolve(n)},n._verifyEnumerateDevicesExistence=function(){this._logger.verbose("_verifyEnumerateDevicesExistence()");var e=navigator.mediaDevices;if(e&&t(e.enumerateDevices))return Promise.resolve(e);e=c.FunctionNotDefinedError("enumerateDevices");return this._logger.error("_verifyEnumerateDevicesExistence(): "+JSON.stringify(e)),Promise.reject(e)},n._verifyGetUserMediaExistence=function(){this._logger.verbose("_verifyGetUserMediaExistence()");var e=navigator.mediaDevices;if(e&&t(e.getUserMedia))return Promise.resolve(e);e=c.FunctionNotDefinedError("getUserMedia");return this._logger.error("_verifyGetUserMediaExistence(): "+JSON.stringify(e)),Promise.reject(e)},r}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(6)];void 0===(r=function(o){"use strict";return function(e){this.deviceId=e.deviceId,this.kind=e.kind,this.label=e.label,this.groupId=e.groupId,this.displayIndex=e.displayIndex,this.displayId=e.kind+"device ID: "+e.deviceId.substr(0,10),this.videoDeviceConfig={},this.audioDeviceConfig={},this.setVideoDeviceConfig=function(e){var t=(e=e||{}).source||o.MEDIA_SOURCES.CAMERA,r=e.width||0,n=e.height||0,i=e.framerate||0,e=e.minFramerate||0;t!==o.MEDIA_SOURCES.CAMERA&&t!==o.MEDIA_SOURCES.SCREEN||(this.videoDeviceConfig.source=t),i<e&&(i=e),0<r&&0<n&&(this.videoDeviceConfig.width={ideal:r},this.videoDeviceConfig.height={ideal:n}),0<i&&(this.videoDeviceConfig.frameRate={ideal:i})},this.getVideoDeviceConfig=function(){return this.videoDeviceConfig},this.setAudioDeviceConfig=function(e){this.audioDeviceConfig=e||{}},this.getAudioDeviceConfig=function(){return this.audioDeviceConfig}}}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(0),r(3),r(2)];void 0===(r=function(e,o,r){"use strict";var s=e.stringifyJSON,a=e.isObject,c=e.isEmpty,n=e.isString;return function(e){if(this._logger=r.create("Media","console"),!a(e)||c(e)){var t=o.TypeNotValidError("config","Object");throw this._logger.error("Media(): "+s(t)),t}if(!a(e.stream))throw t=o.TypeNotValidError("config.stream","Object"),this._consoleLogger.error("Media(): "+s(t)),t;if(!n(e.kind)||"local"!==e.kind&&"remote"!==e.kind)throw t=o.ValueNotValidError("config.kind","local/remote"),this._consoleLogger.error("Media(): "+s(t)),t;this.stream=e.stream,this.kind=e.kind,this.metadata={hasVideo:0,hasAudio:0,width:0,height:0,framerate:0},this.remoteUserName=e.remoteUserName,this.remoteUserId=e.remoteUserId,this.getTracks=function(){return[].concat(this.getVideoTracks()).concat(this.getAudioTracks())},this.getVideoTracks=function(){return this.stream.getVideoTracks()},this.getAudioTracks=function(){return this.stream.getAudioTracks()},this.hasVideoTracks=function(){return 0<this.stream.getVideoTracks().length?1:0},this.hasAudioTracks=function(){return 0<this.stream.getAudioTracks().length?1:0},this.getVideoTracksSettings=function(){var e=this.stream.getVideoTracks();return e&&0<e.length?this.stream.getVideoTracks()[0].getSettings():void 0},this.getVideoTracksConstraints=function(){var e=this.stream.getVideoTracks();return e&&0<e.length?this.stream.getVideoTracks()[0].geConstraints():void 0},this.getAudioTracksSettings=function(){var e=this.stream.getAudioTracks();return e&&0<e.length?this.stream.getAudioTracks()[0].getSettings():void 0},this.getAudioTrackConstraints=function(){var e=this.stream.getAudioTracks();return e&&0<e.length?this.stream.getAudioTracks()[0].getConstraints():void 0},this.applyAudioConstraints=function(e){var t,r,n="applyAudioConstraints(): ",i=this;return i._logger.verbose(n+s(e)),!a(e)||c(e)?(t=o.TypeNotValidError("constraints","Object"),i._logger.error(n+s(t)),Promise.reject(t)):i.hasAudioTracks()?(r=i.getAudioTracks()[0],i._logger.verbose(n+"constraints before applying: "+s(i.getAudioTrackConstraints())),r.applyConstraints(e).then(function(){i._logger.verbose(n+"constraints after applying: "+s(i.getAudioTrackConstraints()))}).catch(function(e){return i._logger.error(n+s(e)),Promise.reject(e)})):(t=o.OperationNotAllowedError("Media.applyAudioConstraints()","Media has no audio tracks."),i._logger.error(n+s(t)),Promise.reject(t))},this.muteTracks=function(e,t){var r="videoinput"===e?this.getVideoTracks():"audioinput"===e?this.getAudioTracks():void 0;if(r)for(var n=0;n<r.length;n++)r[n].enabled=!t},this.bind=function(e){for(var t=this.getTracks(),r=0;r<t.length;r++)t[r].onended=e._onTrackEnded.bind(e)},this.unbind=function(){if(this.stream){for(var e=this.getTracks(),t=0;t<e.length;t++)e[t].onended=void 0;this._stopTracks(e),this.stream=void 0}this.metadata={hasAudio:0,hasVideo:0,width:0,height:0,framerate:0}},this._stopTracks=function(e){for(var t=0;t<e.length;t++)e[t].stop()}}}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(6),r(0),r(5),r(2),r(3),r(49)];void 0===(r=function(t,r,e,n,s,a){"use strict";var c=r.isObject,d=r.isString,i=r.isFunction,u=r.stringifyJSON;function o(){e.call(this),this._logger=n.create("ScreenCapture","console"),this._logger.verbose("ScreenCapture()"),this._screenCaptureName=void 0,this._isScreenCaptureAvailable=!1,this._isChromeScreenCaptureExtensionInstalled=!1,this._sourceId=null,this._onGetSourceId=null;var o=this;window.addEventListener("message",function(e){o._logger.verbose("window.addEventListener("+u(e)+")");var t,r,n="addEventListener(): ",i=e.origin;d(i)&&o._isValidOrigin(i)&&c(e.data)&&(r=e.data.type,d(r)&&o._isValidType(r)&&(i=e.data.command,d(i)&&(r=e.data.value,d(r)&&("message"===i?"isReady"!==r&&"isLoaded"!==r||(o._isChromeScreenCaptureExtensionInstalled=!0,t=n+o._screenCaptureName+" event: "+r,o._logger.verbose(t)):"error"===i?(t=n+o._screenCaptureName+" error: "+r,o._logger.verbose(t),"PermissionDeniedError"===r&&(e=s.GetDisplayMediaError("PermissionDenied",t),o.emit(e.name,e))):"setSourceId"===i&&(r=r,t=n+o._screenCaptureName+"event: "+i,o._logger.verbose(t),o._setSourceId(r)),o._isScreenCaptureAvailable=!!("getDisplayMedia"in navigator.mediaDevices&&o._isChromeScreenCaptureExtensionInstalled)))))}),"chrome"===a.browserDetails.browser&&a.browserDetails.version<72?this._logger.warning('ScreenCapture(): Chrome screen capture extension is required for Chrome < v.72; use RTCUser\'s "addScreenCaptureExtension()" call to enable an extension'):this._initWithNativeAPISupport()}var l=o.prototype=Object.create(e.prototype);return l.addChromeExtension=function(e){if(this._logger.verbose("addChromeExtension("+e+")"),!d(e)){var t=s.TypeNotValidError("name","String");throw self._logger.error("addChromeExtension(): "+u(t)),t}this._screenCaptureName=e,this._checkChromeExtensionAliveness(),this._initWithChromeExtensionSupport()},l.getScreenCaptureName=function(){return this._logger.verbose("getScreenCaptureName()"),this._screenCaptureName},l.isScreenCaptureAvailable=function(){return this._logger.verbose("isScreenCaptureAvailable()"),this._isScreenCaptureAvailable},l._initWithNativeAPISupport=function(){this._logger.verbose("_initWithNativeAPISupport()");var e=r.browserInfo.mobile;r.enumContainsValue(t.SCREEN_CAPTURE_BROWSER,a.browserDetails.browser.toLowerCase())&&!e?(this._screenCaptureName="nanoScreenCapture","firefox"==a.browserDetails.browser&&a.browserShim.shimGetDisplayMedia(window,"screen"),this._isScreenCaptureAvailable="getDisplayMedia"in navigator.mediaDevices):this._isScreenCaptureAvailable=!1},l._initWithChromeExtensionSupport=function(){this._logger.verbose("_initWithChromeExtensionSupport()");var n="_initWithChromeExtensionSupport(): ",i=this;a.browserShim.shimGetDisplayMedia(window,function(){return new Promise(function(t,r){i.once("PermissionDenied",function(){var e=s.GetDisplayMediaError("PermissionDenied");i._logger.error(n+u(e)),r(e)}),i._getSourceId(function(){var e;i._sourceId?t(i._sourceId):(e=s.GetDisplayMediaError("NotAllowedError"),i._logger.error(n+u(e)),r(e))})})})},l._checkChromeExtensionAliveness=function(){this._logger.verbose("_checkChromeExtensionAliveness()");var e=this;setTimeout(function(){e._isChromeScreenCaptureExtensionInstalled||(e._isChromeScreenCaptureExtensionInstalled=!1)},500),this._logger.verbose("_checkChromeExtensionAliveness(): "+this._screenCaptureName+"alive?"),this._toWindow(this._screenCaptureName,"isAlive","")},l._isValidOrigin=function(e){return this._logger.verbose("_isValidOrigin("+e+")"),e===window.location.origin},l._isValidType=function(e){return this._logger.verbose("_isValidType("+e+")"),e===this._screenCaptureName},l._getSourceId=function(e){this._logger.verbose("_getSourceId()"),i(e)&&(this._onGetSourceId=e,this._logger.verbose("_getSourceId(): "+this._screenCaptureName),this._toWindow(this._screenCaptureName,"getSourceId",""))},l._setSourceId=function(e){this._logger.verbose("_setSourceId("+e+")"),this._sourceId=void 0!==e?e:null,this._onGetSourceId&&this._onGetSourceId()},l._toWindow=function(e,t,r){this._logger.verbose("_toWindow("+this._screenCaptureName+e+", "+t+", "+r+")"),window.postMessage({type:e,command:t,value:r},"*")},o}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(19),r(6),r(5),r(0),r(96),r(32),r(3),r(2)];void 0===(r=function(e,t,n,c,o,r,i,s){"use strict";var d=c.stringifyJSON,a=1,u=2,l=3,p=t.CHATPEER_STATE;function h(e,t,r){n.call(this),this._logger=s.create("ChatRoom","console"),this._logger.verbose("ChatRoom("+d(e)+")"),this._roomName=e.room,this._userName=e.userName,this._userId=e.userId,this._peers=[],this._serverUserList=[],this._state=a,this._iceServers=[],this._config={},this._session=t,this._mediaController=r}var f=h.prototype=Object.create(n.prototype);return f.setConfig=function(e){this._logger.verbose("setConfig("+d(e)+")"),this._config=e},f.setIceServers=function(e){this._iceServers=e},f.enter=function(){this._logger.verbose("enter()");var t=this;return t._state==u?Promise.reject(i.WrongStateError("Already in room")):(this._session.on("RoomMessage",t._onRoomMessage.bind(t)),this._session.enterRoom({roomName:this._roomName,userName:this._userName}).then(function(e){t._state=u}))},f.leave=function(){this._logger.verbose("leave()");var t=this;return this._session.removeEvent("RoomMessage"),this._session.leaveRoom({roomName:this._roomName}).then(function(){t.destroy(),t._state=l}).catch(function(e){return t.destroy(),t._state=l,t._logger.error("leave(): "+d(e)),Promise.reject(e)})},f.callUser=function(e){this._logger.verbose("callUser("+e+")");var t=this;return this._session.callUser({userId:e,roomName:this._roomName}).catch(function(e){return t._logger.error("callUser(): "+d(e)),Promise.reject(e)})},f.answerCall=function(t){this._logger.verbose("answerCall("+t+")");var r=this;return this._session.answerCall({userId:t,roomName:this._roomName}).then(function(e){r._createChatPeer(!1,t,e.user_name,e.caller_peer_id,e.callee_peer_id)}).catch(function(e){return r._logger.error("answerCall(): "+d(e)),Promise.reject(e)})},f.declineCall=function(e){this._logger.verbose("declineCall("+e+")");var t=this;return this._session.declineCall({userId:e,roomName:this._roomName}).catch(function(e){return t._logger.error("declineCall(): "+d(e)),Promise.reject(e)})},f.hangUpCall=function(e){this._logger.verbose("hangUpCall("+e+")");var t=this;return this._session.hangUpCall({userId:e,roomName:this._roomName}).then(function(){t._destroyPeer(e),t._createPublicUserList()}).catch(function(e){return t._logger.error("hangUpCall(): "+d(e)),Promise.reject(e)})},f.getUsersCount=function(){return this._logger.verbose("getUsersCount()"),this._peers.length},f.destroy=function(){this._logger.verbose("destroy()"),this._session.removeEvent("RoomMessage");for(var e=0;e<this._peers.length;e++)this._peers[e].destroy();return this._peers=[],s.delete(this._logger),Promise.resolve()},f._addEventPayload=function(e){return(e=e||{}).data=e.data||{},e.data.state=this._state,e},f._reemit=function(e){e=this._addEventPayload(e),this.emit(e.name,e)},f._createChatPeer=function(e,t,r,n,i){this._logger.verbose("_createChatPeer("+e+", "+t+", "+r+", "+n+", "+i+")");r=new o(this._userName,this._userId,t,r,this._roomName,this._session,this._mediaController);r.setIceServers(this._iceServers),r.addStream(this._mediaController.getLocalMedias()[0].stream),r.setConfig(this._config),r.start(e,n,i),this._peers.push(r),this._bind(r)},f._destroyPeer=function(e){this._logger.verbose("_destroyPeer("+e+")");e=this._removePeerFromPeerList(e);this._unbind(e),e.destroy()},f._bind=function(e){this._logger.verbose("_bind("+d(e)+")"),e.on("RemoteStreamAdded",this._reemit.bind(this)),e.on("StateChanged",this._handlePeerState.bind(this))},f._unbind=function(e){this._logger.verbose("_unbind("+d(e)+")"),e.removeEvent("RemoteStreamAdded"),e.removeEvent("StateChanged")},f._handlePeerState=function(e){switch(this._logger.verbose("_handlePeerState( "+d(e)+")"),e.data.state){case t.CHATPEER_STATE.INITIALIZED:case t.CHATPEER_STATE.SIGNALING:case t.CHATPEER_STATE.SIGNALLING_DONE:case t.CHATPEER_STATE.CALLING:case t.CHATPEER_STATE.NEGOTIATION_NEEDED:break;case t.CHATPEER_STATE.DISCONNECTED:case t.CHATPEER_STATE.FAILED:this._destroyPeer(e.target.getRemoteUserId());break;case t.CHATPEER_STATE.STOPPED:}this._createPublicUserList()},f._createPublicUserList=function(){this._logger.verbose("_createPublicUserList()");for(var e,t,r,n="_createPublicUserList(): ",i=[],o=0;o<this._peers.length;o++)r={},t=(e=this._peers[o]).getState(),t=c.getKeyByValue(p,t).toLowerCase(),r.state=t,r.remoteUserName=e.getRemoteUserName(),r.remoteUserId=e.getRemoteUserId(),i.push(r);var s=this._serverUserList.filter(function(e){for(var t=0;t<i.length;t++)if(i[t].remoteUserId==e.remoteUserId)return!1;return!0}),a=s.concat(i).sort(function(e,t){return e.remoteUserName.toUpperCase()<t.remoteUserName.toUpperCase()?-1:e.remoteUserName.toUpperCase()>t.remoteUserName.toUpperCase()?1:0});return this._logger.verbose(n+"publicList: "+d(s)),this._logger.verbose(n+"peerList: "+d(i)),this._logger.verbose(n+"sortedList: "+d(a)),this.emit("RoomUpdate",{type:"room_update",data:{userlist:a}}),a},f._getPeerByRemoteUserId=function(e){var t;this._logger.verbose("_getPeerByRemoteUserId("+e+")");for(var r=0;r<this._peers.length;r++)if((t=this._peers[r]).getRemoteUserId()===e)return t},f._removePeerFromPeerList=function(e){var t;this._logger.verbose("_removePeerFromPeerList("+e+")");for(var r=0;r<this._peers.length;r++)if((t=this._peers[r]).getRemoteUserId()===e)return this._peers.splice(r,1),t},f._onRoomMessage=function(e){this._logger.verbose("_onRoomMessage("+d(e)+")");var t={};switch(e.type){case"room_update":this._logger.verbose("_onRoomMessage(): room_update: "+d(e)),this._serverUserList=e.data.userlist,this._createPublicUserList();break;case"call_incoming":t.remoteUserId=e.user_id,t.remoteUserName=e.user_name,this.emit("RoomUpdate",{type:"call_incoming",data:t});break;case"call_declined":t.remoteUserName=e.data.user_name,t.remoteUserId=e.data.user_id,this.emit("RoomUpdate",{type:"call_declined",data:t});break;case"hang_up":this._destroyPeer(e.data.user_id),this._createPublicUserList();break;case"start_as_caller":this._createChatPeer(!0,e.user_id,e.user_name,e.caller_peer_id,e.callee_peer_id)}},h}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(19),r(47),r(6),r(5),r(0),r(50),r(32),r(2)];void 0===(r=function(e,r,t,c,n,i,o,d){"use strict";var u=n.isString,l=n.isIntString,s=n.stringifyJSON,a=n.isArray,p=t.CHATPEER_STATE;function h(e,t,r,n,i,o,s){c.call(this),this._logger=d.create("ChatPeer","console"),this._logger.verbose("ChatPeer("+e+", "+t+", "+r+", "+n+", "+i+")");var a="ChatPeer(): ";u(e)||this._logger.error(a+"Param userName must be a string"),u(i)||this._logger.error(a+"Param room must be a string"),l(t)||this._logger.error(a+"Param userId must be an integer"),this._userName=e,this._userId=t,this._peerId=void 0,this._remoteUserName=n,this._remoteUserId=r,this._remotePeerId=void 0,this._room=i,this._pcClient=void 0,this._streams=[],this._startTime=null,this._iceServers=[],this._config={},this._state=p.IDLE,this._messageQueue=[],this._isCaller=!1,this._remoteStream=null,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._statsInterval=0,this._rtcStats=null,this._session=o,this._mediaController=s}t=h.prototype=Object.create(c.prototype);return t.setIceServers=function(e){this._iceServers=e},t.setConfig=function(e){this._config=e},t.getState=function(){return this._state},t.getPeerId=function(){return this._peerId},t.getRemoteUserId=function(){return this._remoteUserId},t.getRemoteUserName=function(){return this._remoteUserName},t.start=function(e,t,r){this._logger.verbose("start("+e+", "+t+", "+r+")"),this._isCaller=e,this._createPCClient(),this._isCaller?(this._peerId=t,this._remotePeerId=r):(this._peerId=r,this._remotePeerId=t),t="receiver_peer_"+this._peerId,this._session.on(t,this._onServerMessage.bind(this)),this._isCaller?this._pcClient.startAsCaller(null):this._pcClient.startAsCallee(this._messageQueue),this._setState(p.INITIALIZED)},t.addStream=function(e){this._logger.verbose("addStream("+s(e)+")"),e?2!==this._streams.length?a(e)?this._streams=e:this._streams.push(e):this._logger.__warning("addStream(): [peer id: "+this._peerId+"] stream count is already=2, we only support 2 streams/Chatpeer"):this._logger.error("addStream(): [peer id: "+this._peerId+'] parameter "stream" must not be undefined')},t.enableStats=function(e,t){this._logger.verbose("enableStats("+e+", "+t+")"),this._statsEnabled=void 0===e||e,this._statsIntervalTime=t||1e3,this._rtcStats=null,this._statsEnabled&&(this._rtcStats=new i,this._rtcStats.on("ReceivedWebRTCStats",this._reemit.bind(this)))},t.destroy=function(){this._logger.verbose("destroy()"),this._unbind(),this._closePCClient(),this._setState(p.STOPPED),this._remoteStream&&(this._mediaController.removeMedia(this._remoteStream.id),this._remoteStream=null),d.delete(this._logger)},t._onServerMessage=function(e){this._logger.verbose("_onServerMessage("+s(e)+")");var r="_onServerMessage(): ",n=this;switch(e.type){case"sdp_message":n._pcClient&&n._pcClient.isStarted()?n._pcClient.setRemoteDescription(e.data).catch(function(e){return n._logger.error(r+"setRemoteDescription failed:"+e),Promise.reject(e)}).then(function(){if(n._logger.verbose(r+"setRemoteDescription succeded"),!n._isCaller)return n._pcClient.doAnswer()}).catch(function(e){return n._logger.error(r+"doAnswer failed:"+e),Promise.reject(e)}).then(function(e){if(!n._isCaller){n._logger.verbose(r+"doAnswer succeded "+e);var t={};return t.sender_peer=n._peerId,t.receiver_peer=n._remotePeerId,t.data=e,n._session.sendSignalingMessage(t).catch(function(e){n._logger.error(r+"sendSignalingMessage - "+e)})}}).catch(function(e){n._logger.error(r+"doAnswer failed:",e)}):n._messageQueue.push(e.data.sdp);break;case"ice_candidate":n._pcClient&&n._pcClient.isStarted()?n._pcClient.addIceCandidate(e.data.candidate):n._messageQueue.push(e.data.candidate);break;case"server_error":n._setState(p.FAILED),n._logger.error(r+"Server error: "+e.error);break;default:n._logger.verbose(r+"Unknown message:"+e)}},t._addEventPayload=function(e){return(e=e||{}).target=this,e.data=e.data||{},e.data.state=this._state,e.data.message=n.getKeyByValue(p,this._state).toLowerCase(),e.data.text=e.data.message,e},t._reemit=function(e){e=this._addEventPayload(e),this.emit(e.name,e)},t._collectRtcStats=function(){this._logger.verbose("_collectRtcStats()");var t=this;clearInterval(t._statsInterval),this._statsInterval=setInterval(function(){t._pcClient?t._pcClient.getStats().then(function(e){t._rtcStats||(t._rtcStats=new i),t._rtcStats.putReport(e)}).catch(function(e){t._logger.error("_collectRtcStats(): [peer id: "+t._peerId+"] "+e)}):clearInterval(t._statsInterval)},this._statsIntervalTime)},t._stopCollectRtcStats=function(){this._logger.verbose("_stopCollectRtcStats()"),this._statsInterval&&(this._logger.verbose("_stopCollectRtcStats(): Stopping rtc stats collection"),clearInterval(this._statsInterval))},t._getPeerConnectionConfig=function(){this._logger.verbose("_getPeerConnectionConfig()");var e={iceServers:this._iceServers,iceTransports:"all"},t={optional:[],mandatory:[]};return t.optional.push({googCpuOveruseDetection:!1}),t.optional.push({RtpDataChannels:!1}),{mediaConstraints:{audio:!0,video:!0},sdpPatches:this._config.sdpPatches,peerConnectionConfig:e,peerConnectionConstraints:t,send:!0,receive:!0,videoSendCodec:this._config.codecs.videoCodec||"H264",videoRecvCodec:this._config.codecs.videoCodec||"H264",videoSendBitrate:this._config.bitrates.videoSendBitrate||0,videoSendInitialBitrate:this._config.bitrates.videoSendInitialBitrate||0}},t._createPCClient=function(){this._logger.verbose("_createPCClient()");var t="_createPCClient(): ";if(this._pcClient)this._logger.verbose(t+"[peer id:  "+this._peerId+"] PeerConnection still alive, do not create!");else try{this._pcClient=new r(this._getPeerConnectionConfig(),this._startTime),this._bind();for(var e=0;e<this._streams.length;e++)this._pcClient.addStream(this._streams[e]);this._logger.verbose(t+"Created PeerConnectionClient")}catch(e){this._logger.error(t+"[peer id: "+this._peerId+"] Create PeerConnection exception: "+e.message),this.emitSimple("CreatePeerConnectionClientError")}},t._bind=function(){this._logger.verbose("_bind()"),this._pcClient.on("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.on("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.on("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.on("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.on("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.on("NegotiationNeeded",this._onNegotiationNeeded.bind(this))},t._unbind=function(){this._logger.verbose("_unbind()"),this._pcClient.off("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.off("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.off("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.off("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.off("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.off("NegotiationNeeded",this._onNegotiationNeeded.bind(this))},t._setState=function(e){var t;this._logger.verbose("_setState("+e+")"),e!==this._state?(this._state!==p.CALLING||e!==p.SIGNALING&&e!==p.SIGNALLING_DONE)&&(t=this._state,this._state=e,this._logger.verbose("_setState(): State: "+n.getKeyByValue(p,t)+" -> "+n.getKeyByValue(p,this._state)),t=this._addEventPayload({}),this.emit("StateChanged",t)):this._logger.verbose("_setState(): No state change")},t._onIceConnectionStateChange=function(e){switch(this._logger.verbose("_onIceConnectionStateChange("+s(e)+")"),e.data.state){case"new":case"checking":this._setState(p.SIGNALING);break;case"connected":case"completed":this._setState(p.SIGNALLING_DONE),this._statsEnabled&&this._pcClient&&this._collectRtcStats();break;case"failed":this._setState(p.FAILED),this._statsEnabled&&this._pcClient&&this._stopCollectRtcStats();break;case"disconnected":this._setState(p.DISCONNECTED)}},t._onNegotiationNeeded=function(e){this._logger.verbose("_onNegotiationNeeded("+s(e)+")"),this._logger.warning("_onNegotiationNeeded(): NegotiationNeeded event has been fired")},t._onEndOfLocalCandidates=function(e){this._logger.verbose("_onEndOfLocalCandidates("+s(e)+")")},t._onRemoteStreamAdded=function(e){this._logger.verbose("_onRemoteStreamAdded("+s(e)+")");var t,r=this;this._remoteStream||(this._remoteStream=e.data.stream,t={stream:this._remoteStream,kind:"remote",remoteUserId:this._remoteUserId,remoteUserName:this._remoteUserName},this._mediaController.addRemoteMedia(t).then(function(){r._setState(p.CALLING),r.emitSimple(e.name,{stream:r._remoteStream.id})}).catch(function(e){r._logger.error("_onRemoteStreamAdded(): Failed to add remote media to MediaController list of medias:"+e)}))},t._onRemoteStreamRemoved=function(e){this._logger.verbose("_onRemoteStreamRemoved("+s(e)+")"),this._remoteStream&&(this._mediaController.removeMedia(this._remoteStream.id),this._remoteStream=null)},t._closePCClient=function(){if(this._logger.verbose("_closePCClient()"),this._pcClient){for(var e=this._streams,t=0,r=e.length;t<r;++t)try{this._pcClient.removeStream(e[t])}catch(t){this._logger.error("_closePCClient(): [peer id: "+this._peerId+"] Could not remove stream from peerconnectionclient")}this._pcClient.close(),this._streams=null,this._pcClient=null}else this._logger.warning("_closePCClient(): No PeerConenctionClient")},t._sendMessageToPeer=function(e){this._logger.verbose("_sendMessageToPeer("+s(e)+")");var t="_sendMessageToPeer(): ",r=this,n={};if(this._remotePeerId)return this._peerId?(n.sender_peer=this._peerId,n.receiver_peer=this._remotePeerId,n.data=e,this._session.sendSignalingMessage(n).catch(function(e){return r._logger.error(t+e),Promise.reject(e)})):(this._logger.error(i=t+"Trying to send message, but no peer id set! This should not happen!"),Promise.reject(i));var i=t+"Trying to send message, but no remote peer id set! This should not happen!";return this._logger.error(i),Promise.reject(i)},t._onSignalingMessage=function(e){this._logger.verbose("_onSignalingMessage("+s(e)+")");var t="_onSignalingMessage(): ",r=this;this._remotePeerId?this._sendMessageToPeer(e.data).then(function(){}).catch(function(e){r._logger.error(t+e)}):this._logger.error(t+"Trying to send message, but no remote peer set! This should not happen!")},h}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(2),r(0)];void 0===(r=function(e,n){"use strict";var i={_logger:e.create("ParamUtils","console"),isRtmpUrl:function(e){if(!n.isString(e))return!1;if(!/^([rR][tT][mM][pP][sS]?):\/\/([a-zA-Z0-9.\-:]{4,})\/\b([a-zA-Z0-9()@:%_\+.~#?&\/=-]*)$/gm.test(e))return!1;var t=e.split("//")[1].split("/")[0];if(!t)return!1;e=t.split(":")[0],t=t.split(":")[1];return!(!i.isValidDomainName(e)&&!i.isValidIp(e)||t&&(5<t.length||!/^\d+$/.test(t)))},isWebSocketUrl:function(e){if(!n.isString(e))return!1;if(!/^([wW][sS][sS]?):\/\/([a-zA-Z0-9.\-:]{4,})\/\b([a-zA-Z0-9()@:%_\+.~#?&\/=-]*)$/gm.test(e))return!1;var t=e.split("//")[1].split("/")[0],e=t.split(":")[0],t=t.split(":")[1];return!(!i.isValidDomainName(e)&&!i.isValidIp(e)||t&&(5<t.length||!/^\d+$/.test(t)))},isIceServerUrl:function(e){if(!n.isString(e))return!1;if(!/^([sS][tT][uU][nN]|[tT][uU][rR][nN]):([a-zA-Z0-9.\-:]{4,})\??\b([a-zA-Z0-9()@:%_\+.~#?&\/=-]*)$/gm.test(e))return!1;var t=e.split(":")[1].split("?")[0],e=t.split(":")[0],t=t.split(":")[1];return!(!i.isValidDomainName(e)&&!i.isValidIp(e)||t&&(5<t.length||!/^\d+$/.test(t)))},isJWT:function(e){return!!n.isString(e)&&/^[A-Za-z0-9+_\-=]+\.[A-Za-z0-9+_\-=]+\.[A-Za-z0-9+_\-=]*$/gm.test(e)},isObjectOfMaxDepth:function(e,t){return n.isObject(e)&&i.getObjectDepth(e)<=t},isIntInRange:function(e,t,r){return n.isIntInRange(e,t,r)},isMetadataHandler:function(e){return!!n.isString(e)&&("onMetaData"===e||"onCuePoint"===e)},isDeviceKind:function(e){return!!n.isString(e)&&("videoinput"===e||"audioinput"===e)},isVideoSource:function(e){return!!n.isString(e)&&("camera"===e||"screen"===e)},isVideoWidth:function(e){return!!n.isInt(e)&&320<=e&&e<=3840},isVideoHeight:function(e){return!!n.isInt(e)&&240<=e&&e<=2160},isFramerate:function(e){return!!n.isInt(e)&&0<=e&&e<=60},isDevice:function(e){return n.isInt(e)||n.isBool(e)},isH264Profile:function(e){return!!n.isString(e)&&("cbp"===e||"high"===e)},isValidDomainName:function(e){e="."===(e=e).charAt(e.length-1)?e.slice(0,-1):e;if(!/^[a-zA-Z0-9.\-]*$/.test(e))return!1;if(e.length<1||253<e.length)return!1;var t=e.split(".");if(t.length<2)return!1;for(var r=0;r<t.length;r++){var n=t[r],i=r===t.length-1;if(n.length<1||63<n.length)return!1;if("-"===n.charAt(0)||"-"===n.charAt(n.length-1))return!1;if(i){if(!isNaN(Number(n)))return!1;if(n.length<2)return!1}}return!0},isValidIp:function(e){return/^((25[0-5]|(2[0-4]|1[0-9]|[1-9]|)[0-9])(\.(?!$)|$)){4}$/.test(e)},getObjectDepth:function(e){var t,r,n=1;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&"object"==typeof e[t]&&(r=i.getObjectDepth(e[t])+1,n=Math.max(r,n));return n}};return i}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(0),r(31),r(2),r(99),r(3)];void 0===(r=function(e,s,a,i,o){"use strict";var c=e.isObject,d=e.isBool,u=e.isInt,p=e.isEmpty,h=e.stringifyJSON;function t(e,t){this._consoleLogger=a.create("MetricsController","console"),this._grayLogger=a.create("MetricsController","graylog"),this._consoleLogger.verbose("MetricsController("+h(t)+")");var r="MetricsController(): ";if(this._statsInterval=10,this._lastStatsUpdate=void 0,this._broadcastSignallingTime=void 0,this._broadcastStartingTime=void 0,this._lastPLICount=void 0,this._lastPLICountUpdate=void 0,!c(e)||p(e)){var n=o.TypeNotValidError("rtcUser","Object");throw this._consoleLogger.error(r+h(n)),n}if(this._rtcUser=e,this._metrics=new i(t),t&&u(t.statsInterval)){if(t.statsInterval<1||10<t.statsInterval)throw n=o.ValueNotValidError("config.statsInterval","1...10"),this._consoleLogger.error(r+h(n)),n;this._statsInterval=t.statsInterval}this._rtcUser._statsEnabled||this._rtcUser.enableStats(!0,1e3*this._statsInterval)}var r=t.prototype;return r.onEvent=function(u){this._consoleLogger.verbose("onEvent("+h(u)+")");var l=this;return Promise.resolve().then(function(){switch(u.name){case"SignInSuccess":return l._metrics.session.serverUrl=l._rtcUser._session._serverUrl,l._metrics.session.sessionId=l._rtcUser._session._sessionId,l._rtcUser._session.status().then(function(e){e=e&&e.data?e.data.hostname:"";return l._metrics.session.hostName=e,l._getPayload(u)});case"SignOutSuccess":l._metrics.cleanUpSession();break;case"StartPreviewSuccess":return l._rtcUser._deviceController.getDevice("videoinput").then(function(e){return l._metrics.devices.videoinput=e,l._rtcUser._deviceController.getDevice("audioinput")}).then(function(e){return l._metrics.devices.audioinput=e,l._getPayload(u)});case"StopPreviewSuccess":l._metrics.cleanUpDevices();break;case"StartBroadcastSuccess":var e=u&&u.data?u.data.output:"",t=u&&u.data?u.data.streamname:"";l._metrics.rtmp.url=e,l._metrics.rtmp.streamname=t,l._broadcastStartingTime=(new Date).getTime();break;case"StopBroadcastSuccess":void 0!==l._broadcastStartingTime&&(n=(new Date).getTime()-l._broadcastStartingTime,l._metrics.broadcast.totalTime=n/1e3),l._metrics.broadcast.status="stopped",l._metrics.cleanUpStats();break;case"BroadcastStatus":var r=u&&u.data?u.data.message:"";"signaling"===(l._metrics.broadcast.status=r)?l._broadcastSignallingTime=(new Date).getTime():"broadcasting"===r&&void 0!==l._broadcastSignallingTime&&(c=(new Date).getTime()-l._broadcastSignallingTime,l._metrics.broadcast.startupTime=c/1e3);break;case"ReceivedWebRTCStats":u.name="ReceivedWebRtcStats";var t=(new Date).getTime(),n=l._lastStatsUpdate;if(void 0!==n&&(t-n)/1e3<l._statsInterval&&u.data&&u.data.results&&u.data.results.extended&&1!==u.data.results.extended.priority)return;if(l._lastStatsUpdate=t,u&&u.data&&u.data.results){var i=u.data.results,o={};for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&"extended"!==s&&(o[s]=i[s]);if(i.extended){var s,a=i.extended;for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(o[s]=a[s]);r=l._metrics.devices;r.videoinput&&r.videoinput.videoDeviceConfig&&(o.contentType=""+r.videoinput.videoDeviceConfig.source);var t=(new Date).getTime(),c=u.data.results.extended.pliCount,n=l._lastPLICount,r=l._lastPLICountUpdate;void 0!==n&&void 0!==r?0<(n=c-n)?(o.pliFrequency=(t-r)/1e3/n,l._lastPLICount=c,l._lastPLICountUpdate=t):l._consoleLogger.verbose("Connection issue: PLI is not increasing"):(l._lastPLICount=c,l._lastPLICountUpdate=t)}l._metrics.stats=o}void 0!==l._broadcastStartingTime&&(d=t-l._broadcastStartingTime,l._metrics.broadcast.totalTime=d/1e3);break;default:var d;u.name&&-1!==u.name.indexOf("Error")&&((d={}).code=u.error.code,d.message=u.error.message,l._metrics.error=d,l._metrics.broadcast.status="error")}return l._getPayload(u)}).then(function(e){c(e)&&!p(e)&&l._grayLogger.send(u.name,e)}).then(function(){("StopBroadcastSuccess"===u.name||u.name&&-1!==u.name.indexOf("Error"))&&(l._metrics.cleanUpRtmp(),l._metrics.cleanUpBroadcast(),l._metrics.cleanUpStats()),l._metrics.cleanUpError()}).catch(function(e){"NanoError"!==e.type&&(e=o.GeneralError("Failed to handle an event: "+u.name)),l._consoleLogger.error("onEvent(): "+h(e)),l._metrics.cleanUpRtmp(),l._metrics.cleanUpBroadcast(),l._metrics.cleanUpStats(),l._metrics.cleanUpError()})},r._getPayload=function(r){var n=e.browserInfo,i=a._graylog.credentials,o=this._metrics;return Promise.resolve().then(function(){var e,t={application_name:"webrtc-client",application_event_id:o.eventId,application_account_id:i.accountId,application_account_key:i.accountKey,message:r.name.replace(/\b\w/g,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,"_$1").toUpperCase(),origin:document.location.origin,path_name:document.location.pathname,referrer:document.location.href,search:document.location.search,os:n.os,os_version:n.osVersion,browser:n.browser,browser_version:n.browserVersion,webrtc_client_version:s.webrtc.release_version,server_url:o.session.serverUrl,server_hostname:o.session.hostName,session_id:o.session.sessionId,rtmp_url:o.rtmp.url,rtmp_streamname:o.rtmp.streamname,broadcast_status:o.broadcast.status,broadcast_startup_time:o.broadcast.startupTime,broadcast_total_time:o.broadcast.totalTime,bintu_orga_hash:-1!==o.rtmp.url.indexOf("bintu")?o.rtmp.streamname.split("-")[0]:"",video_device:o.devices.videoinput.label||(d(o.devices.videoinput)?o.devices.videoinput+"":o.devices.videoinput.label),audio_device:o.devices.audioinput.label||(d(o.devices.audioinput)?o.devices.audioinput+"":o.devices.audioinput.label),stats_content_type:o.stats.contentType,stats_audio_codec:o.stats.audioCodec,stats_audio_bitrate:o.stats.audioBitrate,stats_video_codec:o.stats.videoCodec,stats_frame_height:o.stats.frameHeight,stats_frame_width:o.stats.frameWidth,stats_framerate:o.stats.framerate,stats_video_bitrate:o.stats.videoBitrate,stats_nack_count:o.stats.nackCount,stats_frames_encoded:o.stats.framesEncoded,stats_key_frames_encoded:o.stats.keyFramesEncoded,stats_total_encode_time:o.stats.totalEncodeTime,stats_average_encode_time:o.stats.averageEncodeTime,stats_encode_time_percentage:o.stats.encodeTimePercentage,stats_idle_time_percentage:o.stats.idleTimePercentage,stats_fir_count:o.stats.firCount,stats_pli_count:o.stats.pliCount,stats_pli_frequency:o.stats.pliFrequency,stats_resolution_changed:o.stats.resolutionChanged,error_code:o.error.code,error_message:o.error.message};for(e in o.customFields)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=""+o.customFields[e]);return Promise.resolve(t)}).catch(function(e){return Promise.reject(e)})},t}.apply(t,r))||(e.exports=r)},function(e,t,r){var r=[r(0),r(2),r(3)];void 0===(r=function(e,o,s){"use strict";var a=e.isObject,c=e.isEmpty,d=e.stringifyJSON;return function(e){if(this.logger=o.create("Metrics","console"),this.logger.verbose("Metrics("+d(e)+")"),this.eventId="",this.customFields={},this.session={},this.devices={videoinput:{},audioinput:{}},this.rtmp={url:"",streamname:""},this.broadcast={status:"",startupTime:void 0,totalTime:void 0},this.stats={},this.error={},a(e)&&!c(e))for(var t in this.eventId=""+e.eventId,e)if(0===t.indexOf("customField")){var r=t.split("customField");if(!(1<r.length&&0===r[0].length))throw i=s.GeneralError("Custom field property is invalid"),this.logger.error(d(i)),i;var n=parseInt(r[1]);if(isNaN(n)||n.toString()!=r[1]){var i=s.GeneralError("Invalid or incorrect custom field index");throw this.logger.error(d(i)),i}if(n<1||10<n){i=s.GeneralError("Custom field index exceeds the range 1 to 10");throw this.logger.error(d(i)),i}this.customFields["application_custom_field_"+r[1]]=e[t]}this.cleanUpSession=function(){this.session={}},this.cleanUpDevices=function(){this.devices={videoinput:{},audioinput:{}}},this.cleanUpRtmp=function(){this.rtmp={url:"",streamname:""}},this.cleanUpBroadcast=function(){this.broadcast={status:"",startupTime:void 0,totalTime:void 0}},this.cleanUpStats=function(){this.stats={}},this.cleanUpError=function(){this.error={}}}}.apply(t,r))||(e.exports=r)},function(e,t,r){e.exports={castArray:r(101),clone:r(102),cloneDeep:r(160),cloneDeepWith:r(161),cloneWith:r(162),conformsTo:r(163),eq:r(23),gt:r(165),gte:r(167),isArguments:r(35),isArray:r(8),isArrayBuffer:r(168),isArrayLike:r(16),isArrayLikeObject:r(170),isBoolean:r(171),isBuffer:r(18),isDate:r(172),isElement:r(174),isEmpty:r(175),isEqual:r(176),isEqualWith:r(185),isError:r(186),isFinite:r(187),isFunction:r(24),isInteger:r(74),isLength:r(37),isMap:r(69),isMatch:r(188),isMatchWith:r(190),isNaN:r(191),isNative:r(192),isNil:r(194),isNull:r(195),isNumber:r(78),isObject:r(9),isObjectLike:r(1),isPlainObject:r(44),isRegExp:r(196),isSafeInteger:r(198),isSet:r(70),isString:r(79),isSymbol:r(43),isTypedArray:r(27),isUndefined:r(199),isWeakMap:r(200),isWeakSet:r(201),lt:r(202),lte:r(204),toArray:r(205),toFinite:r(75),toInteger:r(30),toLength:r(213),toNumber:r(42),toPlainObject:r(214),toSafeInteger:r(215),toString:r(216)}},function(e,t,r){var n=r(8);e.exports=function(){if(!arguments.length)return[];var e=arguments[0];return n(e)?e:[e]}},function(e,t,r){var n=r(20);e.exports=function(e){return n(e,4)}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,r){var n=r(22),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,e=n(t,e);return!(e<0||(e==t.length-1?t.pop():i.call(t,e,1),--this.size,0))}},function(e,t,r){var n=r(22);e.exports=function(e){var t=this.__data__,e=n(t,e);return e<0?void 0:t[e][1]}},function(e,t,r){var n=r(22);e.exports=function(e){return-1<n(this.__data__,e)}},function(e,t,r){var i=r(22);e.exports=function(e,t){var r=this.__data__,n=i(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}},function(e,t,r){var n=r(21);e.exports=function(){this.__data__=new n,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,e=t.delete(e);return this.size=t.size,e}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,r){var i=r(21),o=r(34),s=r(55);e.exports=function(e,t){var r=this.__data__;if(r instanceof i){var n=r.__data__;if(!o||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new s(n)}return r.set(e,t),this.size=r.size,this}},function(e,t){var r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=r(12),r=Object.prototype,o=r.hasOwnProperty,s=r.toString,a=n?n.toStringTag:void 0;e.exports=function(e){var t=o.call(e,a),r=e[a];try{var n=!(e[a]=void 0)}catch(e){}var i=s.call(e);return n&&(t?e[a]=r:delete e[a]),i}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t,r){var r=r(53),n=(r=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!n&&n in e}},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,r){var n=r(119),i=r(21),o=r(34);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(o||i),string:new n}}},function(e,t,r){var n=r(120),i=r(121),o=r(122),s=r(123),r=r(124);function a(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}a.prototype.clear=n,a.prototype.delete=i,a.prototype.get=o,a.prototype.has=s,a.prototype.set=r,e.exports=a},function(e,t,r){var n=r(25);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},function(e,t){e.exports=function(e){e=this.has(e)&&delete this.__data__[e];return this.size-=e?1:0,e}},function(e,t,r){var n=r(25),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return i.call(t,e)?t[e]:void 0}},function(e,t,r){var n=r(25),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:i.call(t,e)}},function(e,t,r){var n=r(25);e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,r){var n=r(26);e.exports=function(e){e=n(this,e).delete(e);return this.size-=e?1:0,e}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,r){var n=r(26);e.exports=function(e){return n(this,e).get(e)}},function(e,t,r){var n=r(26);e.exports=function(e){return n(this,e).has(e)}},function(e,t,r){var i=r(26);e.exports=function(e,t){var r=i(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}},function(e,t,r){var n=r(10),r=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=r},function(e,t,r){var n=r(17),i=r(13);e.exports=function(e,t){return e&&n(t,i(t),e)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},function(e,t,r){var n=r(4),i=r(1);e.exports=function(e){return i(e)&&"[object Arguments]"==n(e)}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&n.test(e))&&-1<e&&e%1==0&&e<t}},function(e,t,r){var n=r(4),i=r(37),o=r(1),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!s[n(e)]}},function(e,t,r){r=r(61)(Object.keys,Object);e.exports=r},function(e,t,r){var n=r(17),i=r(38);e.exports=function(e,t){return e&&n(t,i(t),e)}},function(e,t,r){var i=r(9),o=r(28),s=r(140),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return s(e);var t,r=o(e),n=[];for(t in e)("constructor"!=t||!r&&a.call(e,t))&&n.push(t);return n}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},function(e,o,s){!function(e){var t=s(7),r=o&&!o.nodeType&&o,n=r&&"object"==typeof e&&e&&!e.nodeType&&e,t=n&&n.exports===r?t.Buffer:void 0,i=t?t.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();t=e.length,t=i?i(t):new e.constructor(t);return e.copy(t),t}}.call(this,s(36)(e))},function(e,t,r){var n=r(17),i=r(39);e.exports=function(e,t){return n(e,i(e),t)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var s=e[r];t(s,r,e)&&(o[i++]=s)}return o}},function(e,t,r){var n=r(17),i=r(64);e.exports=function(e,t){return n(e,i(e),t)}},function(e,t,r){var n=r(67),i=r(64),o=r(38);e.exports=function(e){return n(e,o,i)}},function(e,t,r){r=r(10)(r(7),"DataView");e.exports=r},function(e,t,r){r=r(10)(r(7),"Promise");e.exports=r},function(e,t,r){r=r(10)(r(7),"Set");e.exports=r},function(e,t,r){r=r(10)(r(7),"WeakMap");e.exports=r},function(e,t){var n=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&n.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},function(e,t,r){var i=r(41),o=r(152),s=r(153),a=r(154),c=r(155);e.exports=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return i(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return o(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return c(e,r);case"[object Map]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return s(e);case"[object Set]":return new n;case"[object Symbol]":return a(e)}}},function(e,t,r){var n=r(41);e.exports=function(e,t){t=t?n(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.byteLength)}},function(e,t){var r=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,r.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,r){var r=r(12),r=r?r.prototype:void 0,n=r?r.valueOf:void 0;e.exports=function(e){return n?Object(n.call(e)):{}}},function(e,t,r){var n=r(41);e.exports=function(e,t){t=t?n(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}},function(e,t,r){var n=r(157),i=r(40),o=r(28);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:n(i(e))}},function(e,t,r){var n=r(9),i=Object.create;function o(){}e.exports=function(e){if(!n(e))return{};if(i)return i(e);o.prototype=e;e=new o;return o.prototype=void 0,e}},function(e,t,r){var n=r(11),i=r(1);e.exports=function(e){return i(e)&&"[object Map]"==n(e)}},function(e,t,r){var n=r(11),i=r(1);e.exports=function(e){return i(e)&&"[object Set]"==n(e)}},function(e,t,r){var n=r(20);e.exports=function(e){return n(e,5)}},function(e,t,r){var n=r(20);e.exports=function(e,t){return n(e,5,t="function"==typeof t?t:void 0)}},function(e,t,r){var n=r(20);e.exports=function(e,t){return n(e,4,t="function"==typeof t?t:void 0)}},function(e,t,r){var n=r(164),i=r(13);e.exports=function(e,t){return null==t||n(e,t,i(t))}},function(e,t){e.exports=function(e,t,r){var n=r.length;if(null==e)return!n;for(e=Object(e);n--;){var i=r[n],o=t[i],s=e[i];if(void 0===s&&!(i in e)||!o(s))return!1}return!0}},function(e,t,r){var n=r(166),n=r(29)(n);e.exports=n},function(e,t){e.exports=function(e,t){return t<e}},function(e,t,r){r=r(29)(function(e,t){return t<=e});e.exports=r},function(e,t,r){var n=r(169),i=r(14),r=r(15),r=r&&r.isArrayBuffer,n=r?i(r):n;e.exports=n},function(e,t,r){var n=r(4),i=r(1);e.exports=function(e){return i(e)&&"[object ArrayBuffer]"==n(e)}},function(e,t,r){var n=r(16),i=r(1);e.exports=function(e){return i(e)&&n(e)}},function(e,t,r){var n=r(4),i=r(1);e.exports=function(e){return!0===e||!1===e||i(e)&&"[object Boolean]"==n(e)}},function(e,t,r){var n=r(173),i=r(14),r=r(15),r=r&&r.isDate,n=r?i(r):n;e.exports=n},function(e,t,r){var n=r(4),i=r(1);e.exports=function(e){return i(e)&&"[object Date]"==n(e)}},function(e,t,r){var n=r(1),i=r(44);e.exports=function(e){return n(e)&&1===e.nodeType&&!i(e)}},function(e,t,r){var n=r(60),i=r(11),o=r(35),s=r(8),a=r(16),c=r(18),d=r(28),u=r(27),l=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(a(e)&&(s(e)||"string"==typeof e||"function"==typeof e.splice||c(e)||u(e)||o(e)))return!e.length;var t,r=i(e);if("[object Map]"==r||"[object Set]"==r)return!e.size;if(d(e))return!n(e).length;for(t in e)if(l.call(e,t))return!1;return!0}},function(e,t,r){var n=r(45);e.exports=function(e,t){return n(e,t)}},function(e,t,r){var l=r(33),p=r(71),h=r(183),f=r(184),g=r(11),m=r(8),v=r(18),_=r(27),S="[object Arguments]",b="[object Array]",y="[object Object]",C=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,n,i,o){var s=m(e),a=m(t),c=s?b:g(e),d=a?b:g(t),u=(c=c==S?y:c)==y,a=(d=d==S?y:d)==y,d=c==d;if(d&&v(e)){if(!v(t))return!1;u=!(s=!0)}if(d&&!u)return o=o||new l,s||_(e)?p(e,t,r,n,i,o):h(e,t,c,r,n,i,o);if(!(1&r)){u=u&&C.call(e,"__wrapped__"),a=a&&C.call(t,"__wrapped__");if(u||a)return i(u?e.value():e,a?t.value():t,r,n,o=o||new l)}return!!d&&(o=o||new l,f(e,t,r,n,i,o))}},function(e,t,r){var n=r(55),i=r(179),r=r(180);function o(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new n;++t<r;)this.add(e[t])}o.prototype.add=o.prototype.push=i,o.prototype.has=r,e.exports=o},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,r){var n=r(12),d=r(68),u=r(23),l=r(71),p=r(72),h=r(73),n=n?n.prototype:void 0,f=n?n.valueOf:void 0;e.exports=function(e,t,r,n,i,o,s){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new d(e),new d(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return u(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=p;case"[object Set]":a=a||h;if(e.size!=t.size&&!(1&n))return!1;var c=s.get(e);if(c)return c==t;n|=2,s.set(e,t);a=l(a(e),a(t),n,i,o,s);return s.delete(e),a;case"[object Symbol]":if(f)return f.call(e)==f.call(t)}return!1}},function(e,t,r){var _=r(66),S=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,n,i,o){var s=1&r,a=_(e),c=a.length;if(c!=_(t).length&&!s)return!1;for(var d=c;d--;){var u=a[d];if(!(s?u in t:S.call(t,u)))return!1}var l=o.get(e);if(l&&o.get(t))return l==t;var p=!0;o.set(e,t),o.set(t,e);for(var h,f=s;++d<c;){var g,m=e[u=a[d]],v=t[u];if(!(void 0===(g=n?s?n(v,m,u,t,e,o):n(m,v,u,e,t,o):g)?m===v||i(m,v,r,n,o):g)){p=!1;break}f=f||"constructor"==u}return!p||f||(h=e.constructor)!=(l=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof h&&h instanceof h&&"function"==typeof l&&l instanceof l)&&(p=!1),o.delete(e),o.delete(t),p}},function(e,t,r){var i=r(45);e.exports=function(e,t,r){var n=(r="function"==typeof r?r:void 0)?r(e,t):void 0;return void 0===n?i(e,t,void 0,r):!!n}},function(e,t,r){var n=r(4),i=r(1),o=r(44);e.exports=function(e){if(!i(e))return!1;var t=n(e);return"[object Error]"==t||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!o(e)}},function(e,t,r){var n=r(7).isFinite;e.exports=function(e){return"number"==typeof e&&n(e)}},function(e,t,r){var n=r(76),i=r(77);e.exports=function(e,t){return e===t||n(e,t,i(t))}},function(e,t,r){var n=r(9);e.exports=function(e){return e==e&&!n(e)}},function(e,t,r){var n=r(76),i=r(77);e.exports=function(e,t,r){return r="function"==typeof r?r:void 0,n(e,t,i(t),r)}},function(e,t,r){var n=r(78);e.exports=function(e){return n(e)&&e!=+e}},function(e,t,r){var n=r(51),i=r(193);e.exports=function(e){if(i(e))throw new Error("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return n(e)}},function(e,t,r){var n=r(53),i=r(24),r=r(59);e.exports=n?i:r},function(e,t){e.exports=function(e){return null==e}},function(e,t){e.exports=function(e){return null===e}},function(e,t,r){var n=r(197),i=r(14),r=r(15),r=r&&r.isRegExp,n=r?i(r):n;e.exports=n},function(e,t,r){var n=r(4),i=r(1);e.exports=function(e){return i(e)&&"[object RegExp]"==n(e)}},function(e,t,r){var n=r(74),i=9007199254740991;e.exports=function(e){return n(e)&&-i<=e&&e<=i}},function(e,t){e.exports=function(e){return void 0===e}},function(e,t,r){var n=r(11),i=r(1);e.exports=function(e){return i(e)&&"[object WeakMap]"==n(e)}},function(e,t,r){var n=r(4),i=r(1);e.exports=function(e){return i(e)&&"[object WeakSet]"==n(e)}},function(e,t,r){var n=r(203),n=r(29)(n);e.exports=n},function(e,t){e.exports=function(e,t){return e<t}},function(e,t,r){r=r(29)(function(e,t){return e<=t});e.exports=r},function(e,t,r){var n=r(12),i=r(62),o=r(11),s=r(16),a=r(79),c=r(206),d=r(72),u=r(73),l=r(207),p=r(211),h=n?n.iterator:void 0;e.exports=function(e){if(!e)return[];if(s(e))return(a(e)?l:i)(e);if(h&&e[h])return c(e[h]());var t=o(e);return("[object Map]"==t?d:"[object Set]"==t?u:p)(e)}},function(e,t){e.exports=function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}},function(e,t,r){var n=r(208),i=r(209),o=r(210);e.exports=function(e){return(i(e)?o:n)(e)}},function(e,t){e.exports=function(e){return e.split("")}},function(e,t){var r=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return r.test(e)}},function(e,t){var r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",n="\\ud83c[\\udffb-\\udfff]",i="[^\\ud800-\\udfff]",o="(?:\\ud83c[\\udde6-\\uddff]){2}",s="[\\ud800-\\udbff][\\udc00-\\udfff]",a="(?:"+r+"|"+n+")?",a="[\\ufe0e\\ufe0f]?"+a+"(?:\\u200d(?:"+[i,o,s].join("|")+")[\\ufe0e\\ufe0f]?"+a+")*",s="(?:"+[i+r+"?",r,o,s,"[\\ud800-\\udfff]"].join("|")+")",c=RegExp(n+"(?="+n+")|"+s+a,"g");e.exports=function(e){return e.match(c)||[]}},function(e,t,r){var n=r(212),i=r(13);e.exports=function(e){return null==e?[]:n(e,i(e))}},function(e,t,r){var n=r(80);e.exports=function(t,e){return n(e,function(e){return t[e]})}},function(e,t,r){var n=r(81),i=r(30);e.exports=function(e){return e?n(i(e),0,4294967295):0}},function(e,t,r){var n=r(17),i=r(38);e.exports=function(e){return n(e,i(e))}},function(e,t,r){var n=r(81),i=r(30),o=9007199254740991;e.exports=function(e){return e?n(i(e),-o,o):0===e?e:0}},function(e,t,r){var n=r(217);e.exports=function(e){return null==e?"":n(e)}},function(e,t,r){var n=r(12),i=r(80),o=r(8),s=r(43),n=n?n.prototype:void 0,a=n?n.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(s(t))return a?a.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r}},function(e,t,r){var r=[r(5),r(0),r(2)];void 0===(r=function(t,e,r){"use strict";var i=Math.max,o=Math.sqrt,s=e.stringifyJSON,n=e.isObject,a=e.isFunction;function c(){t.call(this),this._logger=r.create("AudioProcess","console"),this._logger.verbose("AudioProcess()"),this._bufferSize=1024,this._numInputChannels=2,this._numOutputChannels=2,this._channels=[],this._microphone=null,this._scriptProcessorNode=null,this.active=!1;var e=window.AudioContext||window.webkitAudioContext;a(e)?this._audioContext=new e:(this._logger.error("AudioProcess(): No browser audio context found"),this._audioContext=null)}e=c.prototype=Object.create(t.prototype);function d(e,t){this._logger=r.create("AudioChannel","console"),this._logger.verbose("AudioChannel("+s(e)+", "+t+")"),e=e||{},n(t)||this._logger.error("AudioChannel(): Param audioProcess must be of type object",2),this._audioProcess=t,this._level=0,this._maxLevel=0,this._oldLevel=0,this._id=e.id,this._name=e.name,this._channelData=void 0}return e.connect=function(e,t){var r,n,i;for(this._logger.verbose("connect("+s(e)+", "+s(t)+")"),this._bufferSize=(t=t||{bufferSize:1024,numInputChannels:2,numOutputChannels:2,channels:[{name:"left",id:0},{name:"right",id:1}]}).bufferSize||1024,this._numInputChannels=t.numInputChannels||2,this._numOutputChannels=t.numOutputChannels||2,this._channels=[],r=0,n=t.channels.length;r<n;r++)this._channels.push(new d(t.channels[r],this));e?(i=e.getAudioTracks())&&0<i.length?(i=this._scriptProcessorNode=this._audioContext.createScriptProcessor(this._bufferSize,this._numInputChannels,this._numOutputChannels),this._microphone=this._audioContext.createMediaStreamSource(e),this._microphone.connect(i),i.connect(this._audioContext.destination),i.onaudioprocess=this._onAudioProcess.bind(this),this.active=!0):this.emitSimple("AudioNoTrack",{stream:e}):this.emitSimple("AudioNoStream",{stream:e})},e.resume=function(){"suspended"===this._audioContext.state&&this._audioContext.resume()},e.reset=function(){this._logger.verbose("reset()"),this.active=!1,this._microphone=null,this._scriptProcessorNode=null},e._onAudioProcess=function(e){var t,r,n,i,o;this.active&&(n=e.inputBuffer,i=this._channels,o=this,setTimeout(function(){var e=[];for(t=0,r=i.length;t<r;t++)i[t].update(n.getChannelData(t)),e.push(i[t].getChannelData());o.emitSimple("AudioProcess",{channels:e})},0))},d.prototype.update=function(e){for(var t=0,r=(this._channelData=e).length,n=0;n<r;n++)t+=e[n]*e[n];this._level=o(t/(r||1)),this._maxLevel=i(this._level,this._maxLevel),this._oldLevel=i(this._level,this._oldLevel-.008)},d.prototype.getChannelData=function(){return{maxLevel:this._maxLevel,oldLevel:this._oldLevel,avgLevel:this._level,name:this._name,id:this._id}},c}.apply(t,r))||(e.exports=r)}]);
