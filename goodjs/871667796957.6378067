var H5PlayerVideoLib=function(s){function e(e){for(var t,r,n=e[0],i=e[1],a=0,o=[];a<n.length;a++)r=n[a],Object.prototype.hasOwnProperty.call(u,r)&&u[r]&&o.push(u[r][0]),u[r]=0;for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&(s[t]=i[t]);for(d&&d(e);o.length;)o.shift()()}var r={},u={0:0};function c(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return s[e].call(t.exports,t,t.exports,c),t.l=!0,t.exports}c.e=function(n){var i,a,e,o,t,r=[],s=u[n];return 0!==s&&(s?r.push(s[2]):(t=new Promise(function(e,t){s=u[n]=[e,t]}),r.push(s[2]=t),(i=document.createElement("script")).charset="utf-8",i.timeout=120,c.nc&&i.setAttribute("nonce",c.nc),i.src=c.p+"js/player_first/"+({1:"kiwi.min.js_0e36f63",2:"qvbp2p_douyu_v1.8.15.js_39c8510",3:"stream-sub",4:"vendors~stream-sub",5:"whprelease.3.2.0.0_200604.1.js_55a1707"}[t=n]||t)+"_"+{1:"d47fdad",2:"0fe39ac",3:"69c654c",4:"9822b57",5:"1354382"}[t]+".js",a=new Error,e=function(e){i.onerror=i.onload=null,clearTimeout(o);var t,r=u[n];0!==r&&(r&&(t=e&&("load"===e.type?"missing":e.type),e=e&&e.target&&e.target.src,a.message="Loading chunk "+n+" failed.\n("+t+": "+e+")",a.name="ChunkLoadError",a.type=t,a.request=e,r[1](a)),u[n]=void 0)},o=setTimeout(function(){e({type:"timeout",target:i})},12e4),i.onerror=i.onload=e,document.head.appendChild(i))),Promise.all(r)},c.m=s,c.c=r,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)c.d(r,n,function(e){return t[e]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="https://shark2.douyucdn.cn/front-publish/live-master/",c.oe=function(e){throw console.error(e),e};var t=(n=window.shark_player_first_jsonp=window.shark_player_first_jsonp||[]).push.bind(n);n.push=e;for(var n=n.slice(),i=0;i<n.length;i++)e(n[i]);var d=t;return c(c.s="1c1a3")}({"0266f":function(e,t,r){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},"09565":function(e,t,r){"use strict";var n="object"==typeof Reflect?Reflect:null,u=n&&"function"==typeof n.apply?n.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},i=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}((e.exports=o).EventEmitter=o).prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,a;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);return void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener||r),i=e._events),a=i[t]),void 0===a?(a=i[t]=r,++e._eventsCount):("function"==typeof a?a=i[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),0<(r=c(e))&&a.length>r&&!a.warned&&(a.warned=!0,(r=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",r.emitter=e,r.type=t,r.count=a.length,r=r,console&&console.warn&&console.warn(r))),e}function l(e,t,r){e={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},t=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,u(this.listener,this.target,e))}.bind(e);return t.listener=r,e.wrapFn=t}function h(e,t,r){e=e._events;if(void 0===e)return[];t=e[t];return void 0===t?[]:"function"==typeof t?r?[t.listener||t]:[t]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):f(t,t.length)}function p(e){var t=this._events;if(void 0!==t){e=t[e];if("function"==typeof e)return 1;if(void 0!==e)return e.length}return 0}function f(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n,i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){if((n=0<t.length?t[0]:n)instanceof Error)throw n;i=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw i.context=n,i}e=a[e];if(void 0===e)return!1;if("function"==typeof e)u(e,this,t);else for(var o=e.length,s=f(e,o),r=0;r<o;++r)u(s[r],this,t);return!0},o.prototype.on=o.prototype.addListener=function(e,t){return d(this,e,t,!1)},o.prototype.prependListener=function(e,t){return d(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,i,a,o;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;0<=a;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),a=0;a<i.length;++a)"removeListener"!==(n=i[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(a=t.length-1;0<=a;a--)this.removeListener(e,t[a]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return 0<this._eventsCount?i(this._events):[]}},"097de":function(e,t,r){"use strict";var n=r("c9415"),i=r("11b2e"),a=r("0266f"),o=r("41571"),s=r("9faa2"),u=r("68e4d");function c(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(t){return c(t),t.baseURL&&!s(t.url)&&(t.url=u(t.baseURL,t.url)),t.headers=t.headers||{},t.data=i(t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||o.adapter)(t).then(function(e){return c(t),e.data=i(e.data,e.headers,t.transformResponse),e},function(e){return a(e)||(c(t),e&&e.response&&(e.response.data=i(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},"0fa6e":function(e,t,r){(0,r("366c1").roomIsOpenH265)()?e.exports=r("99f77"):e.exports=r("1a93b")},11489:function(e,t,r){"use strict";var n=r("c9415"),i=r("63e3f"),a=r("9b5d6"),o=r("41571");function s(e){var t=new a(e),e=i(a.prototype.request,t);return n.extend(e,a.prototype,t),n.extend(e,t),e}var u=s(o);u.Axios=a,u.create=function(e){return s(n.merge(o,e))},u.Cancel=r("92545"),u.CancelToken=r("9511e"),u.isCancel=r("0266f"),u.all=function(e){return Promise.all(e)},u.spread=r("6da80"),e.exports=u,e.exports.default=u},"11b2e":function(e,t,r){"use strict";var n=r("c9415");e.exports=function(t,r,e){return n.forEach(e,function(e){t=e(t,r)}),t}},"13c9f":function(e,t,u){"use strict";var c=u("c9415"),d=u("1b396"),l=u("9ebb9"),h=u("9992b"),p=u("6d420"),f=u("d3043");e.exports=function(s){return new Promise(function(t,r){var n=s.data,i=s.headers;c.isFormData(n)&&delete i["Content-Type"];var e,a,o=new XMLHttpRequest;if(s.auth&&(e=s.auth.username||"",a=s.auth.password||"",i.Authorization="Basic "+btoa(e+":"+a)),o.open(s.method.toUpperCase(),l(s.url,s.params,s.paramsSerializer),!0),o.timeout=s.timeout,o.onreadystatechange=function(){var e;o&&4===o.readyState&&(0!==o.status||o.responseURL&&0===o.responseURL.indexOf("file:"))&&(e="getAllResponseHeaders"in o?h(o.getAllResponseHeaders()):null,e={data:s.responseType&&"text"!==s.responseType?o.response:o.responseText,status:o.status,statusText:o.statusText,headers:e,config:s,request:o},d(t,r,e),o=null)},o.onerror=function(){r(f("Network Error",s,null,o)),o=null},o.ontimeout=function(){r(f("timeout of "+s.timeout+"ms exceeded",s,"ECONNABORTED",o)),o=null},c.isStandardBrowserEnv()&&(a=u("b76a7"),(a=(s.withCredentials||p(s.url))&&s.xsrfCookieName?a.read(s.xsrfCookieName):void 0)&&(i[s.xsrfHeaderName]=a)),"setRequestHeader"in o&&c.forEach(i,function(e,t){void 0===n&&"content-type"===t.toLowerCase()?delete i[t]:o.setRequestHeader(t,e)}),s.withCredentials&&(o.withCredentials=!0),s.responseType)try{o.responseType=s.responseType}catch(t){if("json"!==s.responseType)throw t}"function"==typeof s.onDownloadProgress&&o.addEventListener("progress",s.onDownloadProgress),"function"==typeof s.onUploadProgress&&o.upload&&o.upload.addEventListener("progress",s.onUploadProgress),s.cancelToken&&s.cancelToken.promise.then(function(e){o&&(o.abort(),r(e),o=null)}),void 0===n&&(n=null),o.send(n)})}},"1a93b":function(e,t,r){function n(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var i,a;e.exports=(i=[function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.makeLogger=void 0;var a=!1;function n(e){a=e}function o(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=i(["[html5 player]","[dylive]"],e.map(function(e){return"["+e+"]"}));return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a&&r.call.apply(r,i([console],n,e))}}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{log:o.apply(void 0,i([console.log],e)),debug:o.apply(void 0,i([console.debug],e)),info:o.apply(void 0,i([console.info],e)),warn:o.apply(void 0,i([console.warn],e)),error:o.apply(void 0,i([console.error],e)),setEnable:n}}t.makeLogger=s,t.default=s()},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.values=t.shallowClone=t.concatUrl=t.resolveUrl=t.isPlayerSupported=t.isMediaSupported=t.isBrowserSupported=t.getRandomId=t.binsert=t.binsearch=t.numberCompare=t.connectEventbus=t.isHls=t.saveAs=t.isH265Supported=t.loadScript=t.isPthreadsSupported=t.isWasmSupported=t.bufferConcat=t.timescaledTime64=t.timescaledTime=t.u8aClone=t.safeClone=t.configClone=t.isBufferEqual=void 0;var i=n(r(31)),a=r(3),o=n(r(7));function s(r){if("object"!=typeof r)return r;var n={};return Object.keys(r).forEach(function(e){var t=r[e];t&&"object"==typeof t?Object.getPrototypeOf(t)===Object.prototype&&(n[e]=s(t)):"function"!=typeof t&&(n[e]=t)}),n}function u(){return"object"==typeof WebAssembly}function c(r,n){return function(e){var t=e.data;if("internalevents"!==t.name)return r(e);(e=n.__internal.eventbus).emit.apply(e,t.params)}}function d(e,t){return+e-+t}function l(e,t,r){if(0===e.length)return 0;if((r=r||d)(t,e[0])<=0)return 0;if(0<=r(t,e[e.length-1]))return e.length;for(var n=0,i=e.length-1;1<i-n;){var a=n+i>>1,o=r(t,e[a]);if(o<0)i=a;else{if(!(0<o))return a;n=a}}return i}function h(){return o.default.chrome&&43<=o.default.version.major||o.default.firefox&&43<=o.default.version.major||o.default.msedge||"mac"===o.default.platform&&o.default.safari&&11<=o.default.version.major}function p(){return MediaSource.isTypeSupported('video/mp4; codecs="avc1.640028, mp4a.40.2"')}t.isBufferEqual=function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0},t.configClone=function(e,t){return self.Worker&&e instanceof self.Worker?s(t):t},t.safeClone=s,t.u8aClone=function(e){var t=new Uint8Array(e.byteLength);return t.set(e,0),t},t.timescaledTime=function(e,t){return Math.round(e*t/1e3)},t.timescaledTime64=function(e,t){return i.default.fromNumber(Math.round(e/1e3*t),!0)},t.bufferConcat=function(e){var t=e.reduce(function(e,t){return e+t.length},0),r=new Uint8Array(t),n=0;return e.forEach(function(e){r.set(e,n),n+=e.length}),r},t.isWasmSupported=u,t.isPthreadsSupported=function(){return!!(u()&&self.SharedArrayBuffer&&self.Atomics&&new WebAssembly.Memory({initial:1,maximum:1,shared:!0}).buffer instanceof SharedArrayBuffer)},t.loadScript=function(n){return new Promise(function(e,t){var r=document.createElement("script");r.onload=e,r.onerror=t,r.src=n,document.head.appendChild(r)})},t.isH265Supported=function(){return MediaSource.isTypeSupported("video/mp4; codecs=hvc1.1.6.L93")},t.saveAs=function(e,t){var r=window.URL.createObjectURL(e),e=document.createElement("a");e.style.display="none",e.href=r,e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3)},t.isHls=function(e){return-1!==e.toLowerCase().indexOf(".m3u8")},t.connectEventbus=function(r,e,t){self.Worker&&r instanceof self.Worker?(t.__internal.eventbus.pipe=function(e,t){return r.postMessage({name:"internalevents",params:[e,t]})},r.onmessage=c(e,t)):r.inWorker?(t.__internal.eventbus=new a.InternalEventBus,t.__internal.eventbus.pipe=function(e,t){return r.dispatchMessage({name:"internalevents",params:[e,t]})},self.onmessage=c(e,t)):r.onmessage=e},t.numberCompare=d,t.binsearch=l,t.binsert=function(e,t,r){e.splice(l(e,t,r),0,t)},t.getRandomId=function(){return Date.now()+"-"+Math.floor(Math.random()*(Math.floor(999999999)-Math.ceil(1)))+Math.ceil(1)},t.isBrowserSupported=h,t.isMediaSupported=p,t.isPlayerSupported=function(){return h()&&p()},t.resolveUrl=function(e,t){return new URL(e,t).href},t.concatUrl=function(e,t){return e=t?e+(-1===e.indexOf("?")?"?":"&")+t:e},t.shallowClone=function(e){return Object.assign({},e)},t.values=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorIds=t.errorRestore=t.errorClone=t.DyDemuxError=t.DyMediaError=t.DyNetworkError=t.DyError=void 0;var a,o=(a=Error,i(s,a),s);function s(e,t,r){void 0===r&&(r=!0);e=a.call(this,e)||this;return e.errorId=0,e.fatal=!0,e.updatedSource=!1,e.errorId=t||m.Unknown,e.name="DyError",e.fatal=r,e}t.DyError=o;var u,c=(i(d,u=o),d);function d(e,t){t=u.call(this,e,t)||this;return t.name="DyNetworkError",t}t.DyNetworkError=c;var l,h=(i(p,l=o),p);function p(e,t){t=l.call(this,e,t)||this;return t.name="DyMediaError",t}t.DyMediaError=h;var f,i=(i(_,f=o),_);function _(e,t){t=f.call(this,e,t)||this;return t.name="DyDemuxError",t}t.DyDemuxError=i,t.errorClone=function(e){return{name:e.name,message:e.message,errorId:e.errorId,stack:e.stack,fatal:e.fatal}};var m,y={Error:o,DyError:o,DyNetworkError:c,DyMediaError:h,DyDemuxError:i};t.errorRestore=function(e){var t=y[e.name];if(t){t=new t(e.message,e.errorId,e.fatal);return t.stack=e.stack,t}return null},(t=m=t.ErrorIds||(t.ErrorIds={}))[t.Unknown=100]="Unknown",t[t.ParserInitError=101]="ParserInitError",t[t.ParserConfigMiss=102]="ParserConfigMiss",t[t.ParserConfigError=103]="ParserConfigError",t[t.ParserDataError=104]="ParserDataError",t[t.ParserCodecUnsupport=105]="ParserCodecUnsupport",t[t.DecoderWasmError=106]="DecoderWasmError",t[t.DecoderInvalidCanvas=107]="DecoderInvalidCanvas",t[t.DecoderDecodeError=108]="DecoderDecodeError",t[t.RenderWebglError=109]="RenderWebglError",t[t.NetworkError=110]="NetworkError",t[t.MediaError=111]="MediaError",t[t.MediaAddSourceBufferError=112]="MediaAddSourceBufferError",t[t.MediaUnsupportCodec=113]="MediaUnsupportCodec",t[t.MediaAppendError=114]="MediaAppendError",t[t.WasmUnsupportError=115]="WasmUnsupportError",t[t.NoSupportedLoader=116]="NoSupportedLoader",t[t.NoSupportedMediaHandler=117]="NoSupportedMediaHandler",t[t.InvalidFlv=118]="InvalidFlv",t[t.UnsupportedFlvAudio=119]="UnsupportedFlvAudio",t[t.UnsupportedFlvVideo=120]="UnsupportedFlvVideo",t[t.InvalidFlvVideoPacket=121]="InvalidFlvVideoPacket",t[t.WorkerError=122]="WorkerError",t[t.HlsM3u8ParseError=123]="HlsM3u8ParseError",t[t.HlsTsNetworkError=124]="HlsTsNetworkError",t[t.HlsM3u8LoadError=125]="HlsM3u8LoadError",t[t.HlsTsCustomError=126]="HlsTsCustomError",t[t.TransmuxerError=127]="TransmuxerError",t[t.UnsupportDemux=128]="UnsupportDemux",t[t.UnsupportRemux=129]="UnsupportRemux",t[t.CustomLoaderError=130]="CustomLoaderError",t[t.UnsupportedError=131]="UnsupportedError",t[t.AcceleratorClosed=132]="AcceleratorClosed",t[t.AcceleratorError=133]="AcceleratorError"},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InternalEvents=t.InternalEventBus=void 0;var o,a=a(r(15)),s=r(1),i=(o=a.default,i(u,o),u.prototype.emit=function(e,t){return(null==t?void 0:t.__sourceId)!==this.id&&((t=t||{}).__sourceId||(t.__sourceId=this.id),this.pipe&&this.pipe(e,t),o.prototype.emit.call(this,e,t))},u);function u(){var e=null!==o&&o.apply(this,arguments)||this;return e.id=s.getRandomId(),e}t.InternalEventBus=i,(t=t.InternalEvents||(t.InternalEvents={})).METADATA="METADATA",t.VBR="VBR",t.SEEK="SEEK",t.FIRST_FRAME="FIRST_FRAME",t.BASE_TS="BASE_TS",t.STAT="STAT",t.M3U8TIME="M3U8TIME",t.SWITCH_SOURCE_SUCCESS="SWITCH_SOURCE_SUCCESS",t.SWITCH_SOURCE_FAIL="SWITCH_SOURCE_FAIL"},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Codec=t.TimeDispatchType=t.VERSION=void 0,t.VERSION="dylive_202105060755",(n=t.TimeDispatchType||(t.TimeDispatchType={})).H264_SEI="H264_SEI",n.AAC_FIL="AAC_FIL",n.EXTRA_DATA="EXTRA_DATA",(t=t.Codec||(t.Codec={})).H264="h264",t.H265="h265",t.AAC="aac",t.MP3="mp3"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindAll=void 0,t.bindAll=function(r){for(var n=r,i={};r&&r!==Object.prototype;)Object.getOwnPropertyNames(r).forEach(function(e){var t=Object.getOwnPropertyDescriptor(r,e);t&&(t.get||t.set||"function"==typeof n[e]&&(i[e]=!0))}),r=Object.getPrototypeOf(r);Object.keys(i).forEach(function(e){n[e]=n[e].bind(n)})}},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.isFrameTrack=t.MediaAction=void 0,(n=t.MediaAction||(t.MediaAction={}))[n.END=0]="END",n[n.FIRST_FRAME=1]="FIRST_FRAME",n[n.RESET=2]="RESET",n[n.GET_DURATION=3]="GET_DURATION",n[n.EXTRA=4]="EXTRA",t.isFrameTrack=function(e){return!e.flag||"KEY"===e.flag}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={};!function(){var e,t=self.navigator.userAgent.toLowerCase(),r=/(edge)\/([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||0<=t.indexOf("trident")&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],n=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],t={browser:r[5]||r[3]||r[1]||"",version:r[2]||r[4]||"0",majorVersion:r[4]||r[2]||"0",platform:n[0]||""},r={};for(e in t.browser&&(r[t.browser]=!0,n=t.majorVersion.split("."),r.version={major:parseInt(t.majorVersion,10),string:t.version},1<n.length&&(r.version.minor=parseInt(n[1],10)),2<n.length&&(r.version.build=parseInt(n[2],10))),t.platform&&(r[t.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),(r.rv||r.iemobile)&&(r.rv&&delete r.rv,t.browser="msie",r.msie=!0),r.edge&&(delete r.edge,t.browser="msedge",r.msedge=!0),r.opr&&(t.browser="opera",r.opera=!0),r.safari&&r.android&&(t.browser="android",r.android=!0),r.name=t.browser,r.platform=t.platform,i)i.hasOwnProperty(e)&&delete i[e];Object.assign(i,r)}(),t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseLoader=void 0;var n=r(5),i=r(6),r=(Object.defineProperty(a.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"redirectUrl",{get:function(){return this._redirectUrl},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"supportSmooth",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"format",{get:function(){return"flv"},enumerable:!1,configurable:!0}),a.prototype.load=function(e,t,r){this._loaderBytes=0,this._url=e,this._config=t,this._loadStartTime=Date.now()},a.prototype.dispose=function(){this._destroyed=!0,this.onData=null,this.onEnd=null,this.onError=null},a.prototype.getStatistics=function(){return{loaderBytes:this._loaderBytes,cdnBytes:this._loaderBytes,p2pBytes:0,totalDropBytes:0,uploadBytes:0,speed:this._speed,url:this._url,status:this._status}},a.prototype.attachMedia=function(e){this._media=e},a.prototype.updateSource=function(e){},a.prototype.endOfStream=function(){this._onEnd()},a.prototype.reset=function(e){this.onData&&this.onData({action:i.MediaAction.RESET,actionData:e})},a.prototype.extra=function(e){this.onData&&this.onData({action:i.MediaAction.EXTRA,actionData:e})},a.prototype._onData=function(e){e&&(e instanceof ArrayBuffer?this._loaderBytes+=e.byteLength:e.data&&(this._loaderBytes+=e.data.byteLength),this.onData&&this.onData(e))},a.prototype._onRedirectUrl=function(e){this._redirectUrl=e},a.prototype._onError=function(e){this._calcSpeed(),this.onError&&this.onError(e)},a.prototype._onEnd=function(){this._calcSpeed(),this.onEnd&&this.onEnd()},a.prototype._calcSpeed=function(){this._loadEndTime=Date.now(),this._speed=this._loaderBytes/1024/((this._loadEndTime-this._loadStartTime)/1e3)},a);function a(){this._destroyed=!1,this._loaderBytes=0,this._loadStartTime=0,this._loadEndTime=0,this._speed=0,this._status=0,n.bindAll(this)}t.BaseLoader=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(a.fromArray=function(e){var t=0;e.forEach(function(e){return t+=e.byteLength});var r=new a({initLength:t});return e.forEach(function(e){return r.write(e)}),r},Object.defineProperty(a.prototype,"buffer",{get:function(){return this._buffer.slice(0,this._wposition)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"byteAvailable",{get:function(){return this._wposition-this._rposition},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"byteLength",{get:function(){return this._wposition},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bytePosition",{get:function(){return this._rposition},enumerable:!1,configurable:!0}),a.prototype.read=function(e){if(e>this.byteAvailable)throw new Error("["+a.TAG+"] not enough data for read.");var t=this._buffer.slice(this._rposition,this._rposition+e);return this._rposition+=e,t},a.prototype.readAll=function(){return this.read(this.byteAvailable)},a.prototype.readUint8=function(){return new DataView(this.read(1)).getUint8(0)},a.prototype.readUint16=function(){return new DataView(this.read(2)).getUint16(0,this.littleEndian)},a.prototype.readUint24=function(){var e=new Uint8Array(this.read(3));return this.littleEndian&&e.reverse(),e[0]<<16|e[1]<<8|e[2]},a.prototype.readUint32=function(){return new DataView(this.read(4)).getUint32(0,this.littleEndian)},a.prototype.readString=function(e){return String.fromCharCode.apply(null,new Uint8Array(this.read(e)))},a.prototype.write=function(e){var t,r,n,i,a;e&&0<e.byteLength&&(t=e.byteLength,(a=this._wposition+t)>this._buffer.byteLength&&(n=a-(r=this._autoClear?this._rposition:0),i=this._buffer.slice(r,this._wposition),a=void 0,a=n>this._buffer.byteLength?(this.increase?n+=this.increase:n=2*(this.buffer.byteLength+t),this._count++,new ArrayBuffer(n)):this._buffer,new Uint8Array(a).set(new Uint8Array(i),0),this._rposition-=r,this._wposition=i.byteLength,this._buffer=a),new Uint8Array(this._buffer).set(e instanceof ArrayBuffer?new Uint8Array(e):e,this._wposition),this._wposition+=t)},a.prototype.peekBytes=function(e,t){if((t=void 0===t?0:t)+(e=void 0===e?this.byteAvailable:e)>this.byteAvailable)throw new Error("["+a.TAG+"] not enough data for read.");return new Uint8Array(this._buffer,this._rposition+t,e)},a.prototype.skip=function(e){this._rposition+=e},a.prototype.back=function(e){this._rposition-=e},a.prototype.reset=function(){this._wposition=0,this._rposition=0},a.TAG="ByteArray",a.littleEndian=!1,a);function a(e){var t=void 0===e?{}:e,r=t.buffer,n=t.initLength,i=void 0===n?1024:n,e=t.autoClear,n=void 0!==e&&e,e=t.increase,e=void 0===e?0:e,t=t.littleEndian,t=void 0===t?a.littleEndian:t;this._rposition=0,this._wposition=0,this._count=0,this._autoClear=n,this.increase=e,this.littleEndian=t,r?(this._buffer=r,this._wposition=r.byteLength):this._buffer=new ArrayBuffer(i)}t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TrackHandler=void 0;var a,i=(a=r(19).BaseStream,i(o,a),o.prototype.append=function(e){this._destroyed||("EXTRA"!==e.flag?this.handleTrack(e):this.onData(e))},o);function o(){return null!==a&&a.apply(this,arguments)||this}t.TrackHandler=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLoader=void 0;var n=r(25),i=r(26),a=r(27),o=r(1),s=r(8);Object.defineProperty(t,"BaseLoader",{enumerable:!0,get:function(){return s.BaseLoader}}),t.createLoader=function(e){return o.isHls(e.url)?new a.HlsLoader:n.FetchStreamLoader.isSupported()?new n.FetchStreamLoader:i.MozChunkedLoader.isSupported()?new i.MozChunkedLoader:void 0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMediaHandler=t.MediaHandler=void 0;var n=r(58);Object.defineProperty(t,"MediaHandler",{enumerable:!0,get:function(){return n.MediaHandler}});var i=r(59),a=r(61);t.createMediaHandler=function(e){switch(e.mediaHandle){case"mse":return new i.ToMSE(e);case"file":return new a.ToFile(e);default:return null}}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(24),t),i(r(2),t),i(r(11),t)},function(e,t){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=i[a])}return r},writable:!0,configurable:!0}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<r;){var a=t[i];if(e.call(n,a,i,t))return a;i++}}})},function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,p="~";function i(){}function a(e,t,r,n,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");i=new function(e,t,r){this.fn=e,this.context=t,this.once=r||!1}(r,n||e,i),t=p?p+t:t;return e._events[t]?e._events[t].fn?e._events[t]=[e._events[t],i]:e._events[t].push(i):(e._events[t]=i,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(p=!1)),o.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(p?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var e=p?p+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,n=t.length,i=new Array(n);r<n;r++)i[r]=t[r].fn;return i},o.prototype.listenerCount=function(e){e=p?p+e:e,e=this._events[e];return e?e.fn?1:e.length:0},o.prototype.emit=function(e,t,r,n,i,a){var o=p?p+e:e;if(!this._events[o])return!1;var s,u=this._events[o],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,i),!0;case 6:return u.fn.call(u.context,t,r,n,i,a),!0}for(h=1,s=new Array(c-1);h<c;h++)s[h-1]=arguments[h];u.fn.apply(u.context,s)}else for(var d,l=u.length,h=0;h<l;h++)switch(u[h].once&&this.removeListener(e,u[h].fn,void 0,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,t);break;case 3:u[h].fn.call(u[h].context,t,r);break;case 4:u[h].fn.call(u[h].context,t,r,n);break;default:if(!s)for(d=1,s=new Array(c-1);d<c;d++)s[d-1]=arguments[d];u[h].fn.apply(u[h].context,s)}return!0},o.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,r,n){e=p?p+e:e;if(!this._events[e])return this;if(!t)return u(this,e),this;var i=this._events[e];if(i.fn)i.fn!==t||n&&!i.once||r&&i.context!==r||u(this,e);else{for(var a=0,o=[],s=i.length;a<s;a++)(i[a].fn!==t||n&&!i[a].once||r&&i[a].context!==r)&&o.push(i[a]);o.length?this._events[e]=1===o.length?o[0]:o:u(this,e)}return this},o.prototype.removeAllListeners=function(e){return e?(e=p?p+e:e,this._events[e]&&u(this,e)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=p,e.exports=o.EventEmitter=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(14);var o,s=r(6),u=r(17),c=r(22),d=r(0),l=r(44),h=r(53),p=r(3),f=r(2),_=a(r(54)),m=r(55),y=d.makeLogger("tranmuxer-worker"),i=(o=h.Workerable,i(v,o),v.prototype.terminate=function(){o.prototype.terminate.call(this),this.destroyed=!0,this._demux&&(this._demux.dispose(),this._demux=null),this._remux&&(this._remux.dispose(),this._remux=null),this._parser&&(this._parser.dispose(),this._parser=null),this._wsTranscoder&&(this._wsTranscoder.dispose(),this._wsTranscoder=null),this._trackGenerator&&(this._trackGenerator.dispose(),this._trackGenerator=null)},v.prototype.init=function(e){o.prototype.init.call(this,e),this._config.__internal.eventbus.on(p.InternalEvents.FIRST_FRAME,this.firstFrame),this._demux=u.createDemuxer(e),this._demux?(this._remux=c.createRemuxer(e),this._remux?(this._parser=new l.TrackParser(e),this._trackGenerator=new m.TrackGenerator(e),this.pipeline()):this._onError(new f.DyError("unsupport remux format: "+e.format,f.ErrorIds.UnsupportRemux))):this._onError(new f.DyError("unsupport demxu format: "+e.format,f.ErrorIds.UnsupportDemux))},v.prototype.pipeline=function(){var e=this._config,t=this._demux.pipe(this._trackGenerator).pipe(this._parser).pipe(this._remux);e.accelerator.enable&&"h265"===e.videoCodec&&(this._wsTranscoder=new _.default(e),t=t.pipe(this._wsTranscoder)),t.out(this._onRemuxData).catch(this._onError)},v.prototype.appendData=function(e){this.destroyed||this._demux.append(e)},v.prototype.appendEnd=function(){this.destroyed||this._demux.append(s.MediaAction.END)},v.prototype.firstFrame=function(){this.destroyed||this._demux.append(s.MediaAction.FIRST_FRAME)},v.prototype._onRemuxData=function(e){var t=[];e.data&&t.push(e.data.buffer),this.dispatchMessage({name:"_onRemuxData",params:e},t)},v.prototype.setLoggerEnable=function(e){y.setEnable(e)},v.prototype._onMessage=function(e){var t=e.data,r=t.name,n=t.params;try{switch(r){case"init":this.init(n);break;case"appendData":this.appendData(n);break;case"appendEnd":this.appendEnd();break;case"setLoggerEnable":this.setLoggerEnable(n);break;case"changeFormat":this._changeFormat(n);break;default:y.warn("unknown function: transmuxer."+r)}}catch(e){this._onError(new f.DyError("call transmuxer worker "+r+" error: "+e,f.ErrorIds.TransmuxerError))}},v.prototype._changeFormat=function(e){this._config.format=e;var t=u.createDemuxer(this._config);t||this._onError(new f.DyError("unsupport demxu format: "+e,f.ErrorIds.UnsupportDemux)),this._demux&&(this._demux.transfer(t),this._demux.dispose()),this._demux=t,this.pipeline()},v);function v(){var e=null!==o&&o.apply(this,arguments)||this;return e.destroyed=!1,e}t.default=i},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createDemuxer=t.Demuxer=void 0;var i=r(18);Object.defineProperty(t,"Demuxer",{enumerable:!0,get:function(){return i.Demuxer}});var a=n(r(35)),o=r(38);t.createDemuxer=function(e){switch(e.format){case"flv":return new a.default(e);case"raw":return new i.Demuxer(e);case"ts":return new o.TsDemuxer(e);default:return null}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Demuxer=void 0;var a,o=r(19),s=r(6),u=r(0),c=r(3),d=r(1),l=u.makeLogger("demuxer"),i=(a=o.BaseStream,i(h,a),h.prototype.dispose=function(){a.prototype.dispose.call(this),this._config=void 0,this._lastTracks=void 0,this._pendingTracks=void 0},h.prototype.append=function(e){var t;this._destroyed||(e instanceof ArrayBuffer?this._appendArrayBuffer(e):e.type?this._appendTrack(e):e.action?(t=e).action===s.MediaAction.GET_DURATION?this._duration=t.actionData:t.action===s.MediaAction.RESET?this._resetTrack(t.actionData):t.action===s.MediaAction.EXTRA&&this._extraTrack(t.actionData,"EXTRA"):e===s.MediaAction.END?this._appendEnd():e===s.MediaAction.FIRST_FRAME?this._hasFirstFrame=!0:l.warn("unknown append data: ",e))},h.prototype.transfer=function(e){Object.assign(e,{_audioConfig:this._audioConfig,_videoConfig:this._videoConfig,_lastTracks:this._lastTracks})},h.prototype._appendArrayBuffer=function(e){},h.prototype._appendTrack=function(e){if("audio"===e.type||"video"===e.type){if(!("audio"===e.type&&!1===this._config.hasAudio||"video"===e.type&&!1===this._config.hasVideo)){if(e.trackLength?this._trackLength=e.trackLength:e.trackLength=this._trackLength,-1===this._baseTs&&s.isFrameTrack(e)){if(e.dts<0&&!this._config.startFromZero&&(l.warn("negative dts detected: "+e.type+" "+e.dts+", use relative time."),this._config.startFromZero=!0),this._config.startFromZero&&2===e.trackLength){if(l.log("detecting first audio/video pts: "+e.type+" "+e.pts),void 0===this._firstAudioTs&&"audio"===e.type&&(this._firstAudioTs=e.pts),void 0===this._firstVideoTs&&"video"===e.type&&(this._firstVideoTs=e.pts),void 0===this._firstAudioTs||void 0===this._firstVideoTs)return void this._pendingTracks.push(e);l.log("detected first audio/video pts: "+this._firstAudioTs+"/"+this._firstVideoTs),this._baseTs=Math.max(this._firstAudioTs,this._firstVideoTs)}else this._baseTs=e.pts;this._config.__internal.eventbus.emit(c.InternalEvents.BASE_TS,{data:this._config.startFromZero?0:this._baseTs}),l.log("baseTs = "+this._baseTs),this._pendingTracks.length&&this._pendingTracks.splice(0).forEach(this._appendTrack)}"live"!==this._config.mode||(t=this._lastTracks[e.trackId])&&s.isFrameTrack(e)&&5<t.dts-e.dts&&l.warn("Dts error: "+e.type+" track dts rollback, last="+t.dts+", now="+e.dts+", delta="+(e.dts-t.dts)),e.extradata||(e.extradata={});var t=e.config;if(t||("audio"===e.type?t=this._audioConfig:"video"===e.type&&(t=this._videoConfig)),t)return 0<=e.trackId&&(t.trackId=e.trackId),t.codec||(t.codec=e.codec),this._config.startFromZero&&-1!==this._baseTs&&(e.pts=Math.max(e.pts-this._baseTs,0),e.dts=Math.max(e.dts-this._baseTs,0)),this._duration&&!t.duration&&(t.duration=this._duration,this._config.startFromZero||(t.duration+=this._baseTs)),e.config=t,"audio"===e.type?this._audioConfig=t:"video"===e.type&&(this._videoConfig=t),this.onData(e),s.isFrameTrack(e)&&(this._lastTracks[e.trackId]=e),!0;l.warn("unable to generate track config, type="+e.type)}}else l.warn("unknown track type="+e.type)},h.prototype._appendEnd=function(){var t=this;Object.keys(this._lastTracks).forEach(function(e){e=t._lastTracks[e];t._appendTrack({type:e.type,trackId:e.trackId,dts:e.dts,pts:e.pts,codec:e.codec,isEnd:!0})})},h.prototype._generateTrackConfig=function(e){return"audio"===e?{type:"audio",trackId:1,codec:void 0,detailCodec:"",timescale:9e4,duration:0,refSampleDuration:0,bytes:void 0,mimeType:"",channelCount:0,audioSampleRate:0}:"video"===e?{type:"video",trackId:2,codec:void 0,detailCodec:"",timescale:9e4,duration:0,refSampleDuration:0,bytes:void 0,mimeType:"",presentWidth:0,presentHeight:0,codecWidth:0,codecHeight:0}:null},h.prototype._resetTrack=function(e){this._extraTrack(e,"RESET")},h.prototype._extraTrack=function(e,t){var r,n=d.values(this._lastTracks)[0];n?(this._appendTrack({type:n.type,trackId:n.trackId,dts:0,pts:0,codec:n.codec,flag:t,extradata:e}),"RESET"===t&&null!==(r=null==e?void 0:e.switchSource)&&void 0!==r&&r._fullSwitch&&(this._trackLength=2,this._duration=0,this._baseTs=-1,this._pendingTracks=[],this._firstAudioTs=void 0,this._firstVideoTs=void 0)):l.warn("no last tracks, can't send extra track.")},h);function h(e){var t=a.call(this)||this;return t._audioConfig=t._generateTrackConfig("audio"),t._videoConfig=t._generateTrackConfig("video"),t._lastTracks={},t._hasFirstFrame=!1,t._trackLength=2,t._duration=0,t._baseTs=-1,!(t._pendingTracks=[])!==(t._config=e).hasAudio&&!1!==e.hasVideo||(t._trackLength=1),t}t.Demuxer=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStream=void 0;var n=r(5),r=(i.prototype.dispose=function(){this._destroyed=!0,this.onData=null,this.onError=null},i.prototype.error=function(e){this.onError(e),this.dispose()},i.prototype.catch=function(e){return this.onError=e,this},i.prototype.pipe=function(e){return this.onData=e.append,this.onError=e.error,e},i.prototype.out=function(e){return this.onData=e,this},i);function i(){this._destroyed=!1,n.bindAll(this)}t.BaseStream=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNal=void 0;var c=r(4);function d(e,t){for(var r=e.byteLength;t<r-2;){if(0===e[t]&&0===e[t+1]){if(1===e[t+2])return[t,t+3];if(0===e[t+2]&&1===e[t+3])return[t,t+4]}t++}return[-1,-1]}function l(e,t,r){9!==t&&(e.codec===c.Codec.H264?(7!==t&&8!==t||e.configNalus.push({naluType:t,naluData:r}),e.nals.push({naluType:t,naluData:r}),e.nalsLength+=r.byteLength):e.codec===c.Codec.H265&&(32!==t&&33!==t&&34!==t||e.configNalus.push({naluType:t,naluData:r}),e.nals.push({naluType:t,naluData:r}),e.nalsLength+=r.byteLength))}t.parseNal=function(e){for(var t,r,n,i=e.codec,a=e.bytes,o={configNalus:[],nals:[],nalsLength:0,codec:i},i=d(a,0),s=i[0],u=i[1];-1!==s;)r&&l(o,n,a.subarray(r,s)),r=u,n=o.codec===c.Codec.H265?(126&a[r])>>1:31&a[r],s=(t=d(a,u+1))[0],u=t[1];return r&&l(o,n,a.subarray(r,a.byteLength)),o}},function(e,u,t){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(u,"__esModule",{value:!0}),u.aac=u.reference=void 0;var n=t(0),i=r(t(40)),a=r(t(7)),t=t(4),c=n.makeLogger("aac-parser");u.reference={mpegSamplingRates:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]},u.aac={name:t.Codec.AAC,inited:!0,parseConfig:function(e){var t,r,n=e.bytes,i=0,a=null,i=n[0]>>>3;if((r=(7&n[0])<<1|n[1]>>>7)<0||r>=u.reference.mpegSamplingRates.length)return c.warn("AAC invalid sampling frequency index!"),-1;var o=u.reference.mpegSamplingRates[r],s=(120&n[1])>>>3;if(s<0||8<=s)return c.warn("AAC invalid channel configuration"),-1;5===i&&(a=(7&n[1])<<1|n[2]>>>7,n[2]);n=self.navigator.userAgent.toLowerCase();return-1!==n.indexOf("firefox")?a=6<=r?(i=5,t=new Array(4),r-3):(i=2,t=new Array(2),r):-1!==n.indexOf("android")?(i=2,t=new Array(2),a=r):(i=5,a=r,t=new Array(4),6<=r?a=r-3:1==s&&(i=2,t=new Array(2),a=r)),t[0]=i<<3,t[0]|=(15&r)>>>1,t[1]=(15&r)<<7,t[1]|=(15&s)<<3,5===i&&(t[1]|=(15&a)>>>1,t[2]=(1&a)<<7,t[2]|=8,t[3]=0),e.bytes=new Uint8Array(t),e.audioSampleRate=o,e.channelCount=s,e.detailCodec="mp4a.40."+i,e.refSampleDuration=1024/o*1e3,0},parseData:function(e){var t=e.data;return 32===t.byteLength&&33===t[0]&&31===t[1]&&16===t[2]?(c.warn("private aac data, ignore!"),delete e.data,-1):(6==(t[0]>>5&7)&&((t=i.default.getDbData(i.default.parseAacFilData(t)))&&(e.extradata.aacfil={aacTimestamp:e.dts,data:t},delete e.data),a.default.msedge&&delete e.data),0)}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createRemuxer=t.Remuxer=void 0;var i=r(41);Object.defineProperty(t,"Remuxer",{enumerable:!0,get:function(){return i.Remuxer}});var a=n(r(42));t.createRemuxer=function(e){return"mp4"!==e.outputFormat?null:new a.default(e)}},function(e,u,t){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(u,"__esModule",{value:!0}),u.H264SeiUUIDType=u.H264SeiType=void 0;var c=r(t(0));u.H264SeiType={H264_SEI_TYPE_BUFFERING_PERIOD:0,H264_SEI_TYPE_PIC_TIMING:1,H264_SEI_TYPE_PAN_SCAN_RECT:2,H264_SEI_TYPE_FILLER_PAYLOAD:3,H264_SEI_TYPE_USER_DATA_REGISTERED:4,H264_SEI_TYPE_USER_DATA_UNREGISTERED:5,H264_SEI_TYPE_RECOVERY_POINT:6,H264_SEI_TYPE_FRAME_PACKING:45,H264_SEI_TYPE_DISPLAY_ORIENTATION:47,H264_SEI_TYPE_GREEN_METADATA:56,H264_SEI_TYPE_MASTERING_DISPLAY_COLOUR_VOLUME:137,H264_SEI_TYPE_ALTERNATIVE_TRANSFER:147},u.H264SeiUUIDType={AdsCtrlSEIV00001:"AdsCtrlSEIV00001",AdsCtrlSEIV00003:"AdsCtrlSEIV00003",CloudVideoStream:"CloudVideoStream",RoiMaskSeiV00001:"RoiMaskSeiV00001"};d._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,a=0;a<r;a++)2<=a&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[i]=t[a],i++);return new Uint8Array(n.buffer,0,i)},d.parseSEI=function(e){for(var t,r,e=d._ebsp2rbsp(e),n=new DataView(e.buffer),i=0,a=0,o=0;r=n.getUint8(o),o+=1,i+=r,255===r;);for(;r=n.getUint8(o),o+=1,a+=r,255===r;);return{seiType:i,seiData:t=i===u.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED?d.decodeUnregisteredUserData(n,o,a):t}},d.buffer2JSON=function(e){for(var t=[],r=new Uint8Array(e),n=0,i=e.byteLength;n<i;n++)t.push(String.fromCharCode(r[n]));return JSON.parse(t.join(""))},d.decodeUnregisteredUserData=function(e,t,r){if(r<16)return c.default.warn("SEIParser ","error size: ",r),null;var n,i=String.fromCharCode.apply(null,new Uint8Array(e.buffer,t,16));switch(t+=16,i){case u.H264SeiUUIDType.AdsCtrlSEIV00001:case u.H264SeiUUIDType.AdsCtrlSEIV00003:0===(n=e.getUint8(t++))&&(s=d.buffer2JSON(e.buffer.slice(t,r+t-17)));break;case u.H264SeiUUIDType.CloudVideoStream:var a=e.getUint32(t).toString(2),o=e.getUint32(t+4).toString(2),s=parseInt(""+a+(o.length<32?new Array(32-o.length+1).join("0"):"")+o,2);break;case u.H264SeiUUIDType.RoiMaskSeiV00001:o=e.getUint8(t);t+=1,1===o&&(s=String.fromCharCode.apply(null,new Uint8Array(e.buffer,t,r-17)))}return{uuid:i,enctype:n,data:s}},t=d;function d(){}u.default=t},function(e,r,n){"use strict";var i,t=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.LivePlayer=r.PlayerEvents=void 0,n(14);var o,s=a(n(15)),u=n(5),c=n(11),d=n(34),l=n(2),h=n(57),p=n(4),a=n(0),f=n(12),_=n(1),m=n(3),y=a.makeLogger("live-player"),v={url:"",mode:"live",format:"flv",outputFormat:"mp4",mediaHandle:"mse",videoCodec:"h264",enableWorker:!0,debug:!(r.PlayerEvents={ON_MEDIA_INFO:"mediaInfo",ON_FIRST_FRAME:"firstFrame",ON_ERROR:"player_error",ON_SEI:"sei",ON_LOAD_SEI:"loadSei",ON_AAC_DATA:"aacData",ON_EXTRA_DATA_LOAD:"extra_data_load",ON_EXTRA_DATA_PLAY:"extra_data_play",ON_LOW_PERFORMANCE:"low_performance",ON_STAT:"on_stat",ON_M3U8:"ON_M3U8",ON_SWITCH_SUCCESS:"ON_SWITCH_SUCCESS",ON_SWITCH_FAIL:"ON_SWITCH_FAIL"}),stashBuffer:65536,stashTime:200,videoBackTime:10,videoBackTimeThreshold:15,enableJitterBuffer:!1,minBuffer:2,maxBuffer:6,slowRate:.95,fastRate:1.05,audioDurationThreshold:200,videoDurationThreshold:100,startFromZero:!1,smoothSwitchTime:2,hls:{m3u8LoadInterval:1e3,m3u8LoadTimeout:3e3,maxBufferTime:20,seekThreshold:10,tsRetryTimes:4,maxRemainFragments:50,upLevelThreshold:8,enableM3u8Cache:!0},accelerator:{enable:!1,byteRate:6e3}},t=(o=s.default,t(g,o),g.isSupported=function(){return _.isPlayerSupported()},g.isH265Supported=function(){return 4<=navigator.hardwareConcurrency&&_.isWasmSupported()&&_.isPthreadsSupported()},Object.defineProperty(g.prototype,"mediaHandle",{get:function(){return this._config.mediaHandle},enumerable:!1,configurable:!0}),g.prototype.dispose=function(){var e;this._destroyed||(this.pause(),this.detach(),this._mediaManager&&(this._mediaManager.dispose(),this._mediaManager=null),this._loader&&(this._loader.dispose(),this._loader=null),this._mediaHandler&&(this._mediaHandler.dispose(),this._mediaHandler=null),this._timeDispatch&&(this._timeDispatch.destroy(),this._timeDispatch=null),this.removeAllListeners(),this._config&&(null===(e=null===(e=this._config.__internal)||void 0===e?void 0:e.eventbus)||void 0===e||e.removeAllListeners(),this._config=null),this._destroyed=!0,y.log("disposed"))},g.prototype.load=function(){this._destroyed||(this._loader?(y.log("loading..."),this._loader.load(this._config.url,this._config)):y.warn("can't load because there is no available loader"))},g.prototype.attach=function(e){this._mediaHandler&&(this._timeDispatch.attach(e),this._video=e,this._video.addEventListener("loadedmetadata",this._onFirstFrameFromMeta),this._video.addEventListener("canplay",this._onCanplay),this._mediaHandler.attach(e))},g.prototype.detach=function(){this._mediaHandler&&this._mediaHandler.detach(),this._timeDispatch&&this._timeDispatch.detach(),this._video&&(this._video.removeEventListener("loadedmetadata",this._onFirstFrameFromMeta),this._video.removeEventListener("canplay",this._onCanplay),this._video=null)},g.prototype.play=function(){this._video&&this._video.play()},g.prototype.pause=function(){this._video&&this._video.pause()},g.prototype.getMediaInfo=function(){return this._mediaInfo},g.prototype.getStatInfo=function(){var e,t,r,n,i,a={url:"",redirectedURL:"",loaderBytes:0,decodedFrames:0,droppedFrames:0,cdnBytes:0,p2pBytes:0,totalDropBytes:0,uploadBytes:0,fps:0,decodeFps:0,renderFps:0,vbr:this._vbr,width:0,height:0};return this._loader&&(e=(i=this._loader.getStatistics()).loaderBytes,t=i.cdnBytes,r=i.p2pBytes,n=i.totalDropBytes,i=i.uploadBytes,a.url=this._loader.url,a.redirectedURL=this._loader.redirectUrl,a.loaderBytes=e,a.cdnBytes=t,a.p2pBytes=r,a.totalDropBytes=n||0,a.uploadBytes=i||0),this._video&&("function"==typeof this._video.getVideoPlaybackQuality?(i=this._video.getVideoPlaybackQuality(),a.decodedFrames=i.totalVideoFrames,a.droppedFrames=i.droppedVideoFrames):void 0!==this._video.webkitDecodedFrameCount&&(a.decodedFrames=this._video.webkitDecodedFrameCount,a.droppedFrames=this._video.webkitDroppedFrameCount)),this._mediaInfo&&(a.fps=this._mediaInfo.fps,a.width=this._mediaInfo.width,a.height=this._mediaInfo.height),this._mediaHandler&&Object.assign(a,this._mediaHandler.getStatInfo()),a},g.prototype.T_ADV_Timestamp=function(){return this._mediaHandler&&this._mediaHandler.T_ADV_Timestamp()},g.prototype.updateSource=function(e){var t;this._destroyed||(this._isUpdatingSource=!0,y.log("update source: ",e),null!==(t=this._loader)&&void 0!==t&&t.supportSmooth?this._loader.updateSource(e):(t=e.loader||c.createLoader(Object.assign({},this._config,{url:e.url})))?(delete e.loader,this._video&&(this._video.playbackRate=1),e._fullSwitch=!0,this._loader&&(this._loader.format!==t.format&&(y.log("format changed: "+this._loader.format+" -> "+t.format),this._config.format=t.format,this._mediaManager.changeFormat(t.format)),this._loader.reset({switchSource:e,resetReason:"switch"}),this._loader.dispose()),this._loader=t,this._mediaManager.attachLoader(this._loader),this._loader.load(e.url,this._config)):y.warn("unsupport source: ",e))},g.prototype.endOfStream=function(){this._loader&&this._loader.endOfStream()},g.prototype._onMediaInfo=function(e){y.log("onMediaInfo: ",e),this._mediaInfo=e,this.emit(r.PlayerEvents.ON_MEDIA_INFO,e)},g.prototype._onFirstFrameFromMeta=function(){this._onFirstFrame("meta")},g.prototype._onFirstFrame=function(e){void 0===e&&(e="keyframe"),this._isFirstFrameEmitted||(this._isFirstFrameEmitted=!0,this.emit(r.PlayerEvents.ON_FIRST_FRAME),y.log("first frame from "+e))},g.prototype._onExtraData=function(e){var t;"sei"===e.type?(t=e.data)&&0<t.length&&t.forEach(this._onSei):"aacfil"===e.type?this._onAACData(e.data):"vbr"===e.type&&(this._vbr=e.data),this._timeDispatch.add({type:p.TimeDispatchType.EXTRA_DATA,ts:e.ts,data:e}),this.emit(r.PlayerEvents.ON_EXTRA_DATA_LOAD,e)},g.prototype._onCanplay=function(){this._config.__internal.eventbus.emit(m.InternalEvents.FIRST_FRAME)},g.prototype._onError=function(e){(e=!e||!e.errorId?new l.DyError("unknown error: "+e,l.ErrorIds.Unknown):e).updatedSource=this._isUpdatingSource,y.warn("player error: "+e.name+" fatal="+e.fatal+" updatedSource="+e.updatedSource+" errorId="+e.errorId+" "+e.message),this._isUpdatingSource&&e.fatal&&this._onSwitchSourceFail({data:{}}),this.emit(r.PlayerEvents.ON_ERROR,e),e.fatal&&this.dispose()},g.prototype._onSei=function(e){this._timeDispatch.add({type:p.TimeDispatchType.H264_SEI,ts:e.seiTimestamp,data:e}),this.emit(r.PlayerEvents.ON_LOAD_SEI,e)},g.prototype._onAACData=function(e){this.emit(r.PlayerEvents.ON_AAC_DATA,e.data)},g.prototype._onTimeDispatch=function(e){switch(e.type){case p.TimeDispatchType.H264_SEI:this.emit(r.PlayerEvents.ON_SEI,e.data);break;case p.TimeDispatchType.EXTRA_DATA:this.emit(r.PlayerEvents.ON_EXTRA_DATA_PLAY,e.data)}},g.prototype._onLowPerformance=function(){this.emit(r.PlayerEvents.ON_LOW_PERFORMANCE)},g.prototype._onSeek=function(){this._timeDispatch&&this._timeDispatch.clear()},g.prototype._onStat=function(e){e=e.data;this.emit(r.PlayerEvents.ON_STAT,e)},g.prototype._outM3u8Time=function(e){e=e.data;this.emit(r.PlayerEvents.ON_M3U8,e)},g.prototype._onSwitchSourceSuccess=function(e){e=e.data;this._isUpdatingSource&&this.emit(r.PlayerEvents.ON_SWITCH_SUCCESS,e),this._isUpdatingSource=!1},g.prototype._onSwitchSourceFail=function(e){e=e.data;this._isUpdatingSource&&this.emit(r.PlayerEvents.ON_SWITCH_FAIL,e),this._isUpdatingSource=!1},g);function g(e){var t=o.call(this)||this;if(t._destroyed=!1,t._isFirstFrameEmitted=!1,t._vbr=0,t._isUpdatingSource=!1,u.bindAll(t),e.hls=Object.assign({},v.hls,e.hls),e.accelerator=Object.assign({},v.accelerator,e.accelerator),e.__internal={eventbus:new m.InternalEventBus},t._config=e=Object.assign({},v,e),y.setEnable(e.debug),y.log("version="+p.VERSION),"h265"===e.videoCodec){if(!_.isWasmSupported())return setTimeout(function(){t._onError(new l.DyError("Do not support wasm, can't play h265 video.",l.ErrorIds.WasmUnsupportError))},0),t;e.__internal.wasmHvcc=n(62),_.isH265Supported()?(y.log("h265 browser supported, use mse play."),e.mediaHandle="mse",e.accelerator.enable=!1):e.accelerator.enable?(y.log("h265 accelerator enabled, use mse play."),e.mediaHandle="mse"):(y.log("h265 browser not supported, use soft decode."),e.mediaHandle="soft")}return t._config.loader?t._loader=t._config.loader:t._loader=c.createLoader(t._config),t._loader?(e.format=t._loader.format,t._mediaHandler=f.createMediaHandler(e),t._mediaHandler?(t._mediaHandler.onHasKeyframe=t._onFirstFrame,t._mediaHandler.onExtraData=t._onExtraData,t._mediaHandler.onMediaInfo=t._onMediaInfo,t._mediaHandler.onLowPerformance=t._onLowPerformance,t._timeDispatch=new h.TimeDispatch,t._timeDispatch.onSend=t._onTimeDispatch,t._mediaManager=new d.MediaManager(t._loader,t._mediaHandler,t._config),t._mediaManager.onError=t._onError,t._mediaManager.init(),t._config.__internal.eventbus.on(m.InternalEvents.SEEK,t._onSeek),t._config.__internal.eventbus.on(m.InternalEvents.STAT,t._onStat),t._config.__internal.eventbus.on(m.InternalEvents.M3U8TIME,t._outM3u8Time),t._config.__internal.eventbus.on(m.InternalEvents.SWITCH_SOURCE_SUCCESS,t._onSwitchSourceSuccess),t._config.__internal.eventbus.on(m.InternalEvents.SWITCH_SOURCE_FAIL,t._onSwitchSourceFail),y.log("init")):setTimeout(function(){t._onError(new l.DyError("Do not has supported media-handler.",l.ErrorIds.NoSupportedMediaHandler))},0)):setTimeout(function(){t._onError(new l.DyError("Do not has supported loader.",l.ErrorIds.NoSupportedLoader))},0),t}r.LivePlayer=t},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FetchStreamLoader=void 0;var o,s=r(8),u=r(2),c=a(r(7)),i=(o=s.BaseLoader,i(d,o),d.isSupported=function(){try{var e=c.default.msedge&&15048<=c.default.version.minor,t=!c.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}},d.prototype.load=function(t,e,r){var n,i=this;o.prototype.load.call(this,t,e),null!=r&&r.headers&&(n={headers:r.headers}),fetch(t,n).then(function(e){if(i._status=null==e?void 0:e.status,e&&e.ok)return t!==e.url&&i._onRedirectUrl(e.url),e.body.getReader();throw e?new Error("err: "+e.status+" "+e.statusText):new Error("err: no response, maybe blocked.")}).then(function(r){var n;i._reader=r,i._destroyed?i.dispose():(n=function(e){var t=e.done,e=e.value;t?i._onEnd():(i._onData(e.buffer),r.read().then(n).catch(i._onError))},r.read().then(n).catch(i._onError))}).catch(function(e){e&&11===e.code&&c.default.msedge||i._onError(new u.DyNetworkError("fetch stream failed: "+e,u.ErrorIds.NetworkError))})},d.prototype.dispose=function(){this._reader&&(this._reader.cancel().catch(function(e){}),this._reader=null),o.prototype.dispose.call(this)},d.prototype._onEnd=function(){this._reader=null,o.prototype._onEnd.call(this)},d);function d(){return null!==o&&o.apply(this,arguments)||this}t.FetchStreamLoader=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.MozChunkedLoader=void 0;var a,o=r(8),s=r(2),i=(a=o.BaseLoader,i(u,a),u.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),(e.responseType="moz-chunked-arraybuffer")===e.responseType}catch(e){return!1}},u.prototype.load=function(e,t,r){a.prototype.load.call(this,e,t),this._requestURL=e;var n=this._xhr=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="moz-chunked-arraybuffer",null!=r&&r.headers&&Object.keys(r.headers).forEach(function(e){return n.setRequestHeader(e,r.headers[e])}),n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onloadend=this._onLoadEnd.bind(this),n.onerror=this._onXhrError.bind(this),n.send()},u.prototype.dispose=function(){this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),a.prototype.dispose.call(this)},u.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort()},u.prototype._onReadyStateChange=function(e){e=e.target;2===e.readyState&&(null!=e.responseURL&&e.responseURL!==this._requestURL&&this._onRedirectUrl(e.responseURL),this._status=e.status,0!==e.status&&(e.status<200||299<e.status)&&this._onError(new s.DyNetworkError("MozChunkedLoader: Http code invalid, "+e.status+" "+e.statusText,s.ErrorIds.NetworkError)))},u.prototype._onProgress=function(e){e=e.target.response;this._onData(e)},u.prototype._onLoadEnd=function(e){!0!==this._requestAbort?this._onEnd():this._requestAbort=!1},u.prototype._onXhrError=function(e){this._onError("xhr load exit")},u);function u(){var e=a.call(this)||this;return e._xhr=null,e._requestAbort=!1,e}t.MozChunkedLoader=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.HlsLoader=void 0;var o,s=r(8),u=r(2),c=r(28),d=r(0),l=r(29),h=r(3),p=r(1),f=r(6),_=r(32),m=r(33),y=d.makeLogger("hls-loader"),i=(o=s.BaseLoader,i(v,o),Object.defineProperty(v.prototype,"supportSmooth",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"format",{get:function(){return"ts"},enumerable:!1,configurable:!0}),v.prototype.load=function(e,t){o.prototype.load.call(this,e,t),this._config.__internal.eventbus.on(h.InternalEvents.SEEK,this._onSeeking),this._config.__internal.eventbus.on(h.InternalEvents.BASE_TS,this._onBaseTs),this._bizData=this._config.data;t=a({getBufferTime:this._getBufferTime,CdnLoader:l.TsLoader},t);this._config.hls.TsLoader?this._tsLoader=new this._config.hls.TsLoader(t):this._tsLoader=new l.TsLoader(t),this._tsLoader.onData=this._onTsData,this._tsLoader.onEnd=this._onTsEnd,this._tsLoader.onError=this._onTsError,this._m3u8Load(),this._checkLoadTimer=setInterval(this._checkLoad,2e3),"live"===this._config.mode&&(this._reloadTimer=setInterval(this._m3u8Load,this._config.hls.m3u8LoadInterval)),this._bitrateControl=new m.BitrateControl,this._bitrateControl.onBitrate=this._onBitrate},v.prototype.dispose=function(){o.prototype.dispose.call(this),this._config.__internal.eventbus.off(h.InternalEvents.SEEK,this._onSeeking),this._config.__internal.eventbus.off(h.InternalEvents.BASE_TS,this._onBaseTs),this._tsLoader&&(this._tsLoader.dispose(),this._tsLoader=null),this._fragments=null,this._tsLoadError=null,this._m3u8Request&&(this._m3u8Request.cancel(),this._m3u8Request=null),this._updateRequest&&(this._updateRequest.cancel(),this._updateRequest=null),clearInterval(this._reloadTimer),clearInterval(this._checkLoadTimer),this._bitrateControl=null,this._m3u8Streams=null,this._currentStream=null,this._m3u8Cache=null,y.log("disposed")},v.prototype.updateSource=function(t,r){var n=this;p.isHls(t.url)?(this._updateRequest&&(this._updateRequest.cancel(),this._updateRequest=null),this._requestM3u8(t.url,function(e){return n._updateRequest=e}).then(function(e){n._url=t.url,n._updateFragments(e,!0),y.log("update source success, total length: "+e.fragments.length),r&&r(),"smooth"===t.switch&&(n._switchingSource=t,n._bizData=t.data,n._resetReason="switch",n._waitingForSmoothSwitch=!0,n._checkLoad())}).catch(function(e){y.warn("update source error: "+e),"smooth"===t.switch&&n._config.__internal.eventbus.emit(h.InternalEvents.SWITCH_SOURCE_FAIL,{data:{available:n._bizData}})}).then(function(){n._updateRequest=null})):y.warn("can't update source: "+t.url)},v.prototype.endOfStream=function(){var e;this._m3u8HasEnd=!0,"vod"===this._config.mode&&0<(e=Object.keys(this._fragments).sort(p.numberCompare)).length&&(e=this._fragments[e[e.length-1]].endTime,this._onData({action:f.MediaAction.GET_DURATION,actionData:1e3*e})),clearInterval(this._reloadTimer),y.log("m3u8 reached end")},v.prototype.reset=function(e){this._tsLoadError=null,o.prototype.reset.call(this,e)},v.prototype._m3u8Load=function(){var e,t=this;this._m3u8Request||(e=this._url,this._beginDownLoadM3u8Time=(new Date).getTime(),this._requestM3u8(e,function(e){return t._m3u8Request=e}).then(this._parseM3u8).catch(function(e){t._media.getIsWaiting()&&t._onError(new u.DyNetworkError("load m3u8 error: "+e,u.ErrorIds.HlsM3u8LoadError))}).then(function(){t._m3u8Request=null}))},v.prototype._parseM3u8=function(e){var t=this;if(e){this._endDownLoadM3u8Time=(new Date).getTime();var r=this._endDownLoadM3u8Time-this._beginDownLoadM3u8Time;if(r&&this._config.__internal.eventbus.emit(h.InternalEvents.M3U8TIME,{data:r}),null!==(r=e.streams)&&void 0!==r&&r.length)return this._m3u8Streams=e.streams.sort(function(e,t){return t.bitrate-e.bitrate}),this._m3u8Streams.forEach(function(e){return e.url=p.resolveUrl(e.url,t._url)}),this._config.hls.streamFilter&&(this._m3u8Streams=this._m3u8Streams.filter(this._config.hls.streamFilter)),this._currentStream=this._m3u8Streams[this._m3u8Streams.length-1],this._url=this._currentStream.url,void setTimeout(this._m3u8Load,0);this._updateFragments(e),e.hasEnd&&this.endOfStream(),this._isTsLoading||this._checkLoad()}},v.prototype._checkLoad=function(e){var t=this;if(void 0===e&&(e=!1),!this._destroyed){if(this._media.getIsWaiting()&&this._tsLoadError)return this._tsLoadError.fatal=!0,void this._onError(this._tsLoadError);if(this._waitingForSmoothSwitch){if(!this._smoothSwitch())return;this._waitingForSmoothSwitch=!1,this._currentIndex>=this._nextIndex&&(e=!0)}if((!this._isTsLoading||e)&&("live"===this._config.mode||e||this._getBufferTime()<this._config.hls.maxBufferTime)){var r=-1;if(!this._tsLoadError){if(void 0===this._nextIndex){var n=Object.keys(this._fragments).sort(p.numberCompare);if("live"===this._config.mode&&this._config.liveDelay)for(var i=0,a=n.length-1;0<=a;a--)if((i+=this._fragments[n[a]].duration)>=this._config.liveDelay){r=+n[a];break}-1===r&&(r=+n[0])}else r=this._nextIndex;var o=this._fragments[r];o||Object.keys(this._fragments).sort(p.numberCompare).some(function(e){if(r<+e)return y.warn("fragment["+r+"] can't find in list, seek to "+e),o=t._fragments[e],!0}),o&&this._loadTs(o)}}}},v.prototype._onSeeking=function(e){var t=e.data,r=t.seekTime,e=t.waitLockId,t=this._getFragmentIndex(r);-1!==t?(this._resetReason="seek",this._waitLockId=e,e=this._fragments[t],y.log("out-buffer seek "+r+" success: base="+this._baseTime+" frag index="+t+", start="+(this._baseTime+e.startTime)+", end="+(this._baseTime+e.endTime)),this._nextIndex=t,this._waitingForSmoothSwitch=!1,this._checkLoad(!0)):y.warn("out-buffer seek can't find fragment with time="+(r-2)+", seeking "+r+" failed.")},v.prototype._onTsData=function(e){this._bitrateControl.receiveData(e),this._onData(e)},v.prototype._onTsEnd=function(){this._isTsLoading=!1,this._bitrateControl.endDownload(),!this._m3u8HasEnd||this._fragments[this._nextIndex]?this._checkLoad():this._onEnd()},v.prototype._onTsError=function(e){this._isTsLoading=!1,"string"==typeof e&&(e=new u.DyError(e,u.ErrorIds.HlsTsCustomError,!1)),this._tsLoadError=e,this._onError(e)},v.prototype._getFragmentIndex=function(r){var n=this,i=-1;return Object.keys(this._fragments).sort(p.numberCompare).some(function(e){var t=n._fragments[e];if(n._baseTime+t.endTime>=r)return i=+e,!0}),i},v.prototype._onBaseTs=function(e){e=e.data;this._baseTime=+e/1e3},v.prototype._smoothSwitch=function(){y.log("smooth switching...");var e,t=this._media.getCurrentTime(),r=this._getFragmentIndex(t);if(-1===r)return y.log("can't find currentTime="+(t-this._baseTime)+" in fragments: ",this._fragments),!1;if(!this._media.video.paused||this._media.video.ended){for(e=this._fragments[++r];e&&this._baseTime+e.startTime-t<this._config.smoothSwitchTime;)e=this._fragments[++r];if(!e)return y.log("smooth switch failed, can't find proper fragment, current="+(t-this._baseTime)+"("+t+"-"+this._baseTime+")",this._fragments),!1;r=e.index,this._fragments[this._nextIndex]&&(r=Math.min(this._nextIndex,r))}return!!(e=this._fragments[r])&&(y.log("smooth switch will start from "+(this._baseTime+e.startTime)+", currentTime="+t+", currentIndex="+this._currentIndex+", nextIndex="+r),this._nextIndex=r,this._switchingSource._switchTime=this._baseTime+e.startTime,!0)},v.prototype._getBufferTime=function(){if(this._fragments[this._currentIndex]){var e=this._media.getCurrentTime();return this._fragments[this._currentIndex].startTime+this._baseTime-e}return 0},v.prototype._onBitrate=function(t){var r,e=this;this._m3u8Streams.length&&!this._updateRequest&&(y.log("target bitrate: "+t),r=this._m3u8Streams[this._m3u8Streams.length-1],this._m3u8Streams.some(function(e){if(t>=e.bitrate)return r=e,!0}),r&&r.bitrate!==this._currentStream.bitrate&&(y.log("bitrate change from "+this._currentStream.bitrate+" to "+r.bitrate),this.updateSource({url:r.url,switch:"smooth"},function(){e._currentStream=r})))},v.prototype._loadTs=function(e){void 0!==this._currentIndex&&e.index!==this._currentIndex+1?(y.warn("fragment load discontinue, current="+this._currentIndex+", next="+e.index),this.reset({resetReason:this._resetReason,waitLockId:this._waitLockId,switchSource:this._switchingSource})):this._isTsLoading?(y.warn("need abort last ts index="+this._currentIndex+", reset reason: "+this._resetReason),this.reset({resetReason:this._resetReason,waitLockId:this._waitLockId,switchSource:this._switchingSource})):this._switchingSource?(y.warn("source switch, reason: "+this._resetReason),this.extra({resetReason:this._resetReason,waitLockId:this._waitLockId,switchSource:this._switchingSource})):this._waitLockId&&(y.warn("release wait lock id="+this._waitLockId),this.extra({resetReason:this._resetReason,waitLockId:this._waitLockId,switchSource:this._switchingSource})),this._switchingSource=void 0,this._resetReason=void 0,this._waitLockId=void 0;var t={url:p.concatUrl(e.url,this._config.hls.extraQuery),m3u8:p.concatUrl(this._url,this._config.hls.extraQuery),urlRaw:e.urlRaw,retryTimes:this._config.hls.tsRetryTimes,retryInterval:1e3,timeout:e.duration?Math.max(2e3*e.duration,1e4):0};(e.startBytes||e.endBytes)&&(t.extra={headers:{Range:"bytes="+e.startBytes+"-"+e.endBytes}}),this._isTsLoading=!0,this._currentIndex=e.index,this._nextIndex=e.index+1,this._bitrateControl.startDownload(e),this._currentStream?y.log("load ts: index="+e.index+", start="+(this._baseTime+e.startTime)+", end="+(this._baseTime+e.endTime)+", bitrate="+this._currentStream.bitrate):y.log("load ts: index="+e.index+", start="+(this._baseTime+e.startTime)+", end="+(this._baseTime+e.endTime)),this._tsLoader.load(t)},v.prototype._updateFragments=function(r,e){var n=this;void 0===e&&(e=!1);var i,a,t=r.fragments;0<t.length&&(this._lastSequence!==r.sequence||e)&&(this._lastSequence=r.sequence,i=this._fragments,this._fragments={},a=Object.keys(i).sort(p.numberCompare),t.forEach(function(e){var t;e.url=p.resolveUrl(e.urlRaw,n._url),i[e.index-1]?e.startTime=i[e.index-1].endTime:(e.startTime=0,a.length&&0<e.index&&(y.warn("fragment index discontinue. missing "+(e.index-1),r),(t=i[a[0]]).programDateTime&&e.programDateTime&&(e.startTime=t.startTime+(e.programDateTime-t.programDateTime)/1e3,y.log("adjust fragment start time with program date time: index="+e.index+", start="+e.startTime)))),e.endTime=e.startTime+e.duration,n._fragments[e.index]=i[e.index]=e}))},v.prototype._requestM3u8=function(r,n){var i=this;return void 0===n&&(n=null),Promise.resolve().then(function(){var t=i._m3u8Cache[r];if(t)return t;var e=_.request({method:"get",url:p.concatUrl(r,i._config.hls.extraQuery),timeout:i._config.hls.m3u8LoadTimeout,retryTimes:2,retryDelay:500});return n&&n(e),e.then(function(e){return e.data}).then(function(e){if(!i._destroyed)return t=c.parseM3u8(e),i._config.hls.enableM3u8Cache&&"vod"===i._config.mode&&(i._m3u8Cache[r]=t),t})})},v);function v(){var e=null!==o&&o.apply(this,arguments)||this;return e._fragments={},e._lastSequence=-1,e._baseTime=0,e._m3u8HasEnd=!1,e._isTsLoading=!1,e._beginDownLoadM3u8Time=0,e._endDownLoadM3u8Time=0,e._m3u8Streams=[],e._waitingForSmoothSwitch=!1,e._m3u8Cache={},e}t.HlsLoader=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseM3u8=void 0;var c=r(0).makeLogger("m3u8-parser"),d=/#EXTINF:([\d.]+)/,l=/^(?!#)(\S+)/,h=/#EXT-X-BYTERANGE:(\d+)@*(\d*)/,p=/#EXT-X-MEDIA-SEQUENCE:(\d+)/,f=/#EXT-X-ENDLIST/,_=/#EXT-X-PREFETCH:(\S+)/,m=/#EXT-X-STREAM-INF:.*BANDWIDTH=(\d+)/,y=/#EXT-X-PROGRAM-DATE-TIME:(\S+)/;t.parseM3u8=function(e){if(!e)throw new Error("no m3u8 data: "+e);return m.test(e)?(u={streams:[]},e.split(/\s/).forEach(function(e){return(r=e.match(m))?void(s={bitrate:parseInt(r[1],10),streamInfo:e}):(r=e.match(l))?(s.url=r[1],void u.streams.push(s)):void 0}),u):(t=e,i=(n=p.exec(t))?parseInt(n[1],10):(c.warn("no sequence tag, use default sequence=0"),0),e=!!f.exec(t),a={sequence:i,hasEnd:e,fragments:[]},o={index:i++},t.split(/\n/).forEach(function(e){if(n=e.match(_))return o.url=n[1],o.urlRaw=n[1],o.duration=0,a.fragments.push(o),void(o={index:i++});if(n=e.match(y))o.programDateTime=Date.parse(n[1]);else{if(!(n=e.match(d))){if(n=e.match(h)){var t=parseInt(n[1]),r=n[2]?parseInt(n[2]):a.fragments[o.index-1].endBytes+1;return o.startBytes=r,void(o.endBytes=r+t-1)}return(n=e.match(l))?(o.url=o.urlRaw=n[1],a.fragments.push(o),void(o={index:i++})):void 0}o.duration=parseFloat(n[1])}}),a);var t,n,i,a,o,r,s,u}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TsLoader=void 0;var n=r(30),i=r(2),a=r(5),o=r(0),s=r(3),u=o.makeLogger("ts-loader"),o=(c.prototype.load=function(e){this._request&&(u.log("abort last ts request, need reset player: "+this._request.url),this._request.dispose(),this._request=null),this._request=new n.StreamRequest(this._config),this._request.onData=this.onData,this._request.onEnd=this._onEnd,this._request.onError=this._onError,this._request.load(e)},c.prototype.dispose=function(){this._request&&(this._request.dispose(),this._request=null),this.onData=null,this.onEnd=null,this.onError=null},c.prototype._onEnd=function(){this._finish(),this.onEnd()},c.prototype._onError=function(e){this._finish(),this.onError(new i.DyError(e,i.ErrorIds.HlsTsNetworkError,!1))},c.prototype._finish=function(){this._request&&(this._config.__internal.eventbus.emit(s.InternalEvents.STAT,{data:this._request.getStatistics()}),this._request.dispose(),this._request=null)},c);function c(e){this._config=e,a.bindAll(this)}t.TsLoader=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamRequest=void 0;var n=r(11),i=r(0),a=r(5),o=i.makeLogger("stream-request"),s={timeout:0,retryTimes:0,retryInterval:200},i=(Object.defineProperty(u.prototype,"url",{get:function(){return this._options.url},enumerable:!1,configurable:!0}),u.prototype.dispose=function(){clearTimeout(this._delayTimer),clearTimeout(this._timeoutTimer),this.onData=null,this.onEnd=null,this.onError=null,this._loader&&(this._loader.dispose(),this._loader=null)},u.prototype.load=function(e){clearTimeout(this._delayTimer),clearTimeout(this._timeoutTimer),this._loader&&(this._loader.dispose(),this._loader=null),this._options=Object.assign({},s,e),this._loader=n.createLoader({url:this._options.url}),this._loader.onData=this._onLoadData,this._loader.onEnd=this._onLoadEnd,this._loader.onError=this._onLoadError,this._loader.load(this._options.url,this._config,this._options.extra),0<this._options.timeout&&(this._timeoutTimer=setTimeout(this._onTimeout,this._options.timeout)),this._continueBytes=this._loadedBytes,this._loadedBytes=0,o.log("request "+this._options.url+", extra="+JSON.stringify(this._options.extra)+", timeout="+this._options.timeout)},u.prototype.getStatistics=function(){var e;return null===(e=this._loader)||void 0===e?void 0:e.getStatistics()},u.prototype._onLoadData=function(e){if(this._loadedBytes+=e.byteLength,this._continueBytes){if(this._loadedBytes<=this._continueBytes)return;var t=e.byteLength+this._continueBytes-this._loadedBytes;0<t&&(e=e.slice(t)),this._continueBytes=0}this.onData(e)},u.prototype._onTimeout=function(){this._onError("request "+this._options.url+" timeout, exceed "+this._options.timeout+"ms")},u.prototype._onLoadError=function(e){clearTimeout(this._timeoutTimer),this._onError("request "+this._options.url+" error: "+e)},u.prototype._onLoadEnd=function(){clearTimeout(this._timeoutTimer),this.onEnd()},u.prototype._onError=function(e){var t=this;if(o.log(e),this._retryTimes>=this._options.retryTimes){e="request failed: "+e;return o.warn(e),void(this.onError&&this.onError(e))}this._delayTimer=setTimeout(function(){t._retryTimes++,t.load(t._options),o.log("retry request "+t._options.url+" "+t._retryTimes+" times.")},this._options.retryInterval)},u);function u(e){this._retryTimes=0,this._continueBytes=0,this._loadedBytes=0,this._config=e,a.bindAll(this)}t.StreamRequest=i},function(e,t){e.exports=n;var h=null;try{h=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function p(e){return!0===(e&&e.__isLong__)}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=p;var a={},o={};function r(e,t){var r,n,i;return t?(i=0<=(e>>>=0)&&e<256)&&(n=o[e])?n:(r=_(e,(0|e)<0?-1:0,!0),i&&(o[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(n=a[e])?n:(r=_(e,e<0?-1:0,!1),i&&(a[e]=r),r)}function f(e,t){if(isNaN(e))return t?l:v;if(t){if(e<0)return l;if(s<=e)return T}else{if(e<=-u)return S;if(u<=e+1)return E}return e<0?f(-e,t).neg():_(e%i|0,e/i|0,t)}function _(e,t,r){return new n(e,t,r)}n.fromInt=r,n.fromNumber=f,n.fromBits=_;var c=Math.pow;function d(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return v;if(t="number"==typeof t?(r=t,!1):!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if(0<(n=e.indexOf("-")))throw Error("interior hyphen");if(0===n)return d(e.substring(1),t,r).neg();for(var i=f(c(r,8)),a=v,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+s),r);a=s<8?(s=f(c(r,s)),a.mul(s).add(f(u))):(a=a.mul(i)).add(f(u))}return a.unsigned=t,a}function m(e,t){return"number"==typeof e?f(e,t):"string"==typeof e?d(e,t):_(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=d,n.fromValue=m;var i=4294967296,s=i*i,u=s/2,y=r(1<<24),v=r(0);n.ZERO=v;var l=r(0,!0);n.UZERO=l;var g=r(1);n.ONE=g;var b=r(1,!0);n.UONE=b;var w=r(-1);n.NEG_ONE=w;var E=_(-1,2147483647,!1);n.MAX_VALUE=E;var T=_(-1,-1,!0);n.MAX_UNSIGNED_VALUE=T;var S=_(0,-2147483648,!1);n.MIN_VALUE=S;var O=n.prototype;O.toInt=function(){return this.unsigned?this.low>>>0:this.low},O.toNumber=function(){return this.unsigned?(this.high>>>0)*i+(this.low>>>0):this.high*i+(this.low>>>0)},O.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=f(e),r=this.div(t),t=r.mul(t).sub(this);return r.toString(e)+t.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var n=f(c(e,6),this.unsigned),i=this,a="";;){var o=i.div(n),s=(i.sub(o.mul(n)).toInt()>>>0).toString(e);if((i=o).isZero())return s+a;for(;s.length<6;)s="0"+s;a=""+s+a}},O.getHighBits=function(){return this.high},O.getHighBitsUnsigned=function(){return this.high>>>0},O.getLowBits=function(){return this.low},O.getLowBitsUnsigned=function(){return this.low>>>0},O.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},O.isZero=function(){return 0===this.high&&0===this.low},O.eqz=O.isZero,O.isNegative=function(){return!this.unsigned&&this.high<0},O.isPositive=function(){return this.unsigned||0<=this.high},O.isOdd=function(){return 1==(1&this.low)},O.isEven=function(){return 0==(1&this.low)},O.equals=function(e){return p(e)||(e=m(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},O.eq=O.equals,O.notEquals=function(e){return!this.eq(e)},O.neq=O.notEquals,O.ne=O.notEquals,O.lessThan=function(e){return this.comp(e)<0},O.lt=O.lessThan,O.lessThanOrEqual=function(e){return this.comp(e)<=0},O.lte=O.lessThanOrEqual,O.le=O.lessThanOrEqual,O.greaterThan=function(e){return 0<this.comp(e)},O.gt=O.greaterThan,O.greaterThanOrEqual=function(e){return 0<=this.comp(e)},O.gte=O.greaterThanOrEqual,O.ge=O.greaterThanOrEqual,O.compare=function(e){if(p(e)||(e=m(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},O.comp=O.compare,O.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(g)},O.neg=O.negate,O.add=function(e){p(e)||(e=m(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,a=e.high>>>16,o=65535&e.high,s=e.low>>>16,u=0,c=0,d=0,l=0;return d+=(l+=i+(65535&e.low))>>>16,c+=(d+=n+s)>>>16,u+=(c+=r+o)>>>16,u+=t+a,_((d&=65535)<<16|(l&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},O.subtract=function(e){return p(e)||(e=m(e)),this.add(e.neg())},O.sub=O.subtract,O.multiply=function(e){if(this.isZero())return v;if(p(e)||(e=m(e)),h)return _(h.mul(this.low,this.high,e.low,e.high),h.get_high(),this.unsigned);if(e.isZero())return v;if(this.eq(S))return e.isOdd()?S:v;if(e.eq(S))return this.isOdd()?S:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(y)&&e.lt(y))return f(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,a=e.high>>>16,o=65535&e.high,s=e.low>>>16,u=65535&e.low,c=0,d=0,l=0,e=0;return l+=(e+=i*u)>>>16,d+=(l+=n*u)>>>16,l&=65535,d+=(l+=i*s)>>>16,c+=(d+=r*u)>>>16,d&=65535,c+=(d+=n*s)>>>16,d&=65535,c+=(d+=i*o)>>>16,c+=t*u+r*s+n*o+i*a,_((l&=65535)<<16|(e&=65535),(c&=65535)<<16|(d&=65535),this.unsigned)},O.mul=O.multiply,O.divide=function(e){if((e=!p(e)?m(e):e).isZero())throw Error("division by zero");var t,r;if(h)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?_((this.unsigned?h.div_u:h.div_s)(this.low,this.high,e.low,e.high),h.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?l:v;if(this.unsigned){if((e=!e.unsigned?e.toUnsigned():e).gt(this))return l;if(e.gt(this.shru(1)))return b;r=l}else{if(this.eq(S))return e.eq(g)||e.eq(w)?S:e.eq(S)?g:(n=this.shr(1).div(e).shl(1)).eq(v)?e.isNegative()?g:w:(t=this.sub(e.mul(n)),n.add(t.div(e)));if(e.eq(S))return this.unsigned?l:v;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=v}for(t=this;t.gte(e);){for(var n=Math.max(1,Math.floor(t.toNumber()/e.toNumber())),i=Math.ceil(Math.log(n)/Math.LN2),a=i<=48?1:c(2,i-48),o=f(n),s=o.mul(e);s.isNegative()||s.gt(t);)s=(o=f(n-=a,this.unsigned)).mul(e);o.isZero()&&(o=g),r=r.add(o),t=t.sub(s)}return r},O.div=O.divide,O.modulo=function(e){return p(e)||(e=m(e)),h?_((this.unsigned?h.rem_u:h.rem_s)(this.low,this.high,e.low,e.high),h.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},O.mod=O.modulo,O.rem=O.modulo,O.not=function(){return _(~this.low,~this.high,this.unsigned)},O.and=function(e){return p(e)||(e=m(e)),_(this.low&e.low,this.high&e.high,this.unsigned)},O.or=function(e){return p(e)||(e=m(e)),_(this.low|e.low,this.high|e.high,this.unsigned)},O.xor=function(e){return p(e)||(e=m(e)),_(this.low^e.low,this.high^e.high,this.unsigned)},O.shiftLeft=function(e){return p(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?_(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):_(0,this.low<<e-32,this.unsigned)},O.shl=O.shiftLeft,O.shiftRight=function(e){return p(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?_(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):_(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},O.shr=O.shiftRight,O.shiftRightUnsigned=function(e){if(p(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?_(this.low>>>e|t<<32-e,t>>>e,this.unsigned):_(32===e?t:t>>>e-32,0,this.unsigned)},O.shru=O.shiftRightUnsigned,O.shr_u=O.shiftRightUnsigned,O.toSigned=function(){return this.unsigned?_(this.low,this.high,!1):this},O.toUnsigned=function(){return this.unsigned?this:_(this.low,this.high,!0)},O.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},O.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},O.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.request=t.RequestError=void 0;var a,_=r(0).makeLogger("request"),m=(a=Error,i(o,a),o);function o(e,t){e=a.call(this,e)||this;return e.response=t,e}t.RequestError=m;var y={method:"get",type:"text",retryTimes:0,retryDelay:200};function v(e,t){e.status=t.status,e.statusText=t.statusText,e.data=t.response}t.request=function i(a){var o,s,u,e=Object.assign({},y,a),c=e.url,d=e.method,l=e.type,h=e.timeout,p=e.retryTimes,f=e.retryDelay,e=new Promise(function(t,r){function e(e){if(p<1)return _.warn("request "+c+" failed"),v(n,o),void r(new m(e,n));s=setTimeout(function(){_.log("retry request "+c+", remain times: "+(p-1)),(u=i(Object.assign({},a,{retryTimes:p-1}))).then(t).catch(r)},f)}var n={};(o=new XMLHttpRequest).responseType=l,o.open(d.toUpperCase(),c,!0),h&&(o.timeout=h),o.onerror=function(){return e("Network error, status="+o.status+", statusText="+o.statusText)},o.ontimeout=function(){return e("Network timeout exceed "+h+"ms, , status="+o.status+", statusText="+o.statusText)},o.onload=function(){v(n,o),200<=o.status&&o.status<300?t(n):e("Network error, status="+o.status+", statusText="+o.statusText)},o.send(null)});return e.cancel=function(e){void 0===e&&(e="cancel"),clearTimeout(s),u&&u.cancel(e),o&&o.abort()},e.url=c,e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitrateControl=void 0,r(0).makeLogger("bitrate-control");n.prototype.startDownload=function(e){this._fragment=e,this._startTime=Date.now(),this._byteLength=0},n.prototype.receiveData=function(e){e instanceof ArrayBuffer&&(this._byteLength+=e.byteLength)},n.prototype.endDownload=function(){this._endTime=Date.now();var e=(this._endTime-this._startTime)/1e3,t=8*this._byteLength/e,e=Date.now();3e4<e-this._dispatchTime&&(this.onBitrate(t),this._dispatchTime=e)},r=n;function n(){this._byteLength=0,this._startTime=0,this._endTime=0,this._dispatchTime=0}t.BitrateControl=r},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaManager=void 0;var a=i(5),o=i(1),n=i(0),s=i(2),u=r(i(16)),c=n.makeLogger("media-manager"),n=(d.prototype.init=function(){this._transmuxer.postMessage({name:"init",params:o.configClone(this._transmuxer,this._config)})},d.prototype.dispose=function(){this._destroyed=!0,this.onError=null,this._mediaHandler=null,this._loader=null,this._transmuxer.terminate(),this._transmuxer=null},d.prototype.attachLoader=function(e){this._loader=e,this._loader.onData=this.appendData,this._loader.onEnd=this.appendEnd,this._loader.onError=this._onLoaderError,this._loader.attachMedia(this._mediaHandler)},d.prototype.appendData=function(e){var t;this._destroyed||(e instanceof ArrayBuffer?this._transmuxer.postMessage({name:"appendData",params:e},[e]):(t=[],this._config.enableWorker&&e.data&&(e.data=o.u8aClone(e.data),t.push(e.data.buffer)),this._transmuxer.postMessage({name:"appendData",params:e},t)))},d.prototype.appendEnd=function(){c.log("loader end"),this._transmuxer.postMessage({name:"appendEnd"},void 0)},d.prototype.changeFormat=function(e){this._transmuxer.postMessage({name:"changeFormat",params:e},void 0)},d.prototype._onRemuxData=function(e){this._mediaHandler&&this._mediaHandler.appendData(e)},d.prototype._onError=function(e){this.onError&&(!e||e instanceof Error||!e.name||(e=s.errorRestore(e)),this.onError(e))},d.prototype._onMessage=function(e){var t=e.data,r=t.name,n=t.params;try{switch(r){case"_onRemuxData":this._onRemuxData(n);break;case"_onError":this._onError(n)}}catch(e){c.warn("call "+r+" error",e)}},d.prototype._onLoaderError=function(e){e instanceof Error?void 0===e.errorId&&(e.errorId=s.ErrorIds.CustomLoaderError,e.fatal=!0):e=new s.DyError("custom loader error: "+e,s.ErrorIds.CustomLoaderError),this._onError(e)},d);function d(e,t,r){this._destroyed=!1,a.bindAll(this);var n=(this._config=r).enableWorker,r=r.debug;this._mediaHandler=t,this._mediaHandler.onError=this._onError,this.attachLoader(e),n?(this._transmuxer=i(56)(16),this._transmuxer.postMessage({name:"setLoggerEnable",params:r},void 0),c.log("transmuxe with worker")):(this._transmuxer=new u.default,c.log("transmuxe with no worker")),o.connectEventbus(this._transmuxer,this._onMessage,this._config)}t.MediaManager=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},c=this&&this.__generator||function(r,n){var i,a,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,a&&(o=2&t[0]?a.return:t[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,t[1])).done)return o;switch(a=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],a=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var d,u=a(r(9)),o=a(r(36)),l=r(18),h=r(4),p=r(2),a=r(0),f=r(3),_=a.makeLogger("flv-demuxer");(a=d=d||{})[a.WAIT_FLV_FLAG=0]="WAIT_FLV_FLAG",a[a.WAIT_PRE_TAG_SIZE=1]="WAIT_PRE_TAG_SIZE",a[a.WAIT_TAG=2]="WAIT_TAG";var m,i=(m=l.Demuxer,i(y,m),y.prototype.dispose=function(){m.prototype.dispose.call(this),this._parser&&(this._parser.return("dispose"),this._parser=null),this._byteArray=null,this._audioConfig=null,this._videoConfig=null,this._tracks=[],this._destroyed=!0,_.log("disposed")},y.prototype._appendArrayBuffer=function(e){this._byteArray.write(e),this._parseData()},y.prototype._appendEnd=function(){this._parseData(!0),this._parser&&this._parser.return("end"),m.prototype._appendEnd.call(this)},y.prototype._parseData=function(e){var t;void 0===e&&(e=!1),0<this._byteArray.byteAvailable&&(this._parser||(this._parser=this._parse()),t=Date.now(),(e||!this._hasFirstFrame||this._byteArray.byteAvailable>this._config.stashBuffer||t-this._lastParseTime>this._config.stashTime)&&(this._lastParseTime=t,(t=this._parser.next().value)&&t.name===p.DyDemuxError.name?this._error(t):this._tracks.splice(0).forEach(this._dispatchTrack)))},y.prototype._parse=function(){var t,r,n,i,a,o,s,u;return c(this,function(e){switch(e.label){case 0:switch(this._status){case d.WAIT_FLV_FLAG:return[3,1];case d.WAIT_PRE_TAG_SIZE:return[3,4];case d.WAIT_TAG:return[3,7]}return[3,13];case 1:return this._byteArray.byteAvailable<9?[4]:[3,3];case 2:return e.sent(),[3,1];case 3:return"FLV"!==(n=this._byteArray.readString(3))?[2,new p.DyDemuxError("Not valid flv file : "+n,p.ErrorIds.InvalidFlv)]:(this._byteArray.readUint8(),4&(i=this._byteArray.readUint8())&&1&i||(this._trackLength=1),this._byteArray.read(4),this._status=d.WAIT_PRE_TAG_SIZE,[3,13]);case 4:return this._byteArray.byteAvailable<4?[4]:[3,6];case 5:return e.sent(),[3,4];case 6:return this._byteArray.read(4),this._status=d.WAIT_TAG,[3,13];case 7:return this._byteArray.byteAvailable<11?[4]:[3,9];case 8:return e.sent(),[3,7];case 9:t=this._byteArray.readUint8(),r=this._byteArray.readUint24(),n=this._byteArray.readUint24(),i=this._byteArray.readUint8(),a=(i<<24|n)>>>0,this._byteArray.readUint24(),e.label=10;case 10:return this._byteArray.byteAvailable<r?[4]:[3,12];case 11:return e.sent(),[3,10];case 12:switch(o=this._byteArray.bytePosition,s=this._byteArray.read(r),u=void 0,t){case 8:!1!==this._config.hasAudio&&(u=this._parseAudio(s,a));break;case 9:!1!==this._config.hasVideo&&(u=this._parseVideo(s,a,o));break;case 18:this._parseScript(s);break;default:_.warn("unsupport flv tag type",t)}return this._status=d.WAIT_PRE_TAG_SIZE,u?[2,u]:[3,13];case 13:return[3,0];case 14:return[2]}})},y.prototype._error=function(e){this.onError&&this.onError(e)},y.prototype._parseAudio=function(e,t){var r=new u.default({buffer:e}),n=r.readUint8(),i=(240&n)>>4,a=(12&n)>>2,e=1&n,n=r.read(r.byteAvailable),r=this._audioConfig;if(r.channelCount=0==e?1:2,r.audioSampleRate=this._flvSoundRateTable[a],10==i){var o=new Uint8Array(n),a=o[0],o=o.subarray(1),o={type:"audio",trackId:r.trackId,dts:t,pts:t,codec:h.Codec.AAC,config:r,data:o};0===a?(o.flag="CFG",this._pushTrack(o)):1===a?this._pushTrack(o):_.warn(this.TAG,"Flv: Unsupported AAC data type "+a)}else{if(2!=i)return new p.DyDemuxError("unsupport audio type = "+i,p.ErrorIds.UnsupportedFlvAudio);i=new Uint8Array(n),o={type:"audio",trackId:r.trackId,dts:t,pts:t,codec:h.Codec.MP3,config:r,data:i};this._needMp3Header&&(n=s(s({},o),{flag:"CFG",data:new Uint8Array(n.slice(0,4))}),this._pushTrack(n),this._needMp3Header=!1),this._pushTrack(o)}},y.prototype._parseVideo=function(e,t,r){var n=new u.default({buffer:e}),i=n.readUint8(),e=(240&i)>>4,i=15&i;if(7!=i&&12!=i)return new p.DyDemuxError("unsupport video codec type = "+i,p.ErrorIds.UnsupportedFlvVideo);n=n.read(n.byteAvailable);return this._parseVideoPacket(n,0,n.byteLength,t,r,e,i)},y.prototype._parseScript=function(e){e=o.default.parseScriptData(e,0,e.byteLength);"onMetaData"in e&&("number"==typeof(e=e.onMetaData).audiodatarate&&void 0===this._audioConfig.dataRate&&(this._audioConfig.dataRate=e.audiodatarate),"number"==typeof e.videodatarate&&void 0===this._videoConfig.dataRate&&(this._videoConfig.dataRate=e.videodatarate),this._config.__internal.eventbus.emit(f.InternalEvents.METADATA,e),_.log(this.TAG,"Parsed onMetaData",e))},y.prototype._parseVideoPacket=function(e,t,r,n,i,a,o){if(r<4)_.warn(this.TAG,"Flv: Invalid Video packet, missing PacketType or/and CompositionTime");else{var s=new DataView(e,t,r),u=s.getUint8(0),c=(16777215&s.getUint32(0,!1))<<8>>8,s=this._videoConfig,r=new Uint8Array(e,t+4,r-4),a={type:"video",trackId:s.trackId,dts:n,pts:n+c,codec:12===o?h.Codec.H265:h.Codec.H264,config:s,data:r,isKeyframe:1===a};if(0===u)a.flag="CFG",this._pushTrack(a);else if(1===u)this._pushTrack(a);else if(2!==u)return new p.DyDemuxError("Flv: Invalid video packet type "+u,p.ErrorIds.InvalidFlvVideoPacket)}},y.prototype._pushTrack=function(e){this._tracks.push(e)},y.prototype._dispatchTrack=function(e){this._destroyed||this._appendTrack(e)},y.prototype._resetTrack=function(e){m.prototype._resetTrack.call(this,e),this._byteArray.reset(),this._status=d.WAIT_FLV_FLAG,this._tracks=[],this._needMp3Header=!0,this._hasFirstFrame=!1,this._parser&&(this._parser.return("reset"),this._parser=null)},y);function y(e){e=m.call(this,e)||this;return e.TAG="FlvDemuxer",e._destroyed=!1,e._flvSoundRateTable=[5500,11025,22050,44100,48e3],e._status=d.WAIT_FLV_FLAG,e._lastParseTime=0,e._tracks=[],e._needMp3Header=!0,e._byteArray=new u.default({initLength:e._config.stashBuffer,autoClear:!0}),e}t.default=i},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var y=n(r(0)),i=n(r(37)),v=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0]),r=(g.parseScriptData=function(e,t,r){var n={};try{var i=g.parseValue(e,t,r),a=g.parseValue(e,t+i.size,r-i.size);n[i.data]=a.data}catch(e){y.default.error("AMF",e.toString())}return n},g.parseObject=function(e,t,r){if(r<3)throw new Error("Data not enough when parse ScriptDataObject");var n=g.parseString(e,t,r),t=g.parseValue(e,t+n.size,r-n.size),r=t.objectEnd;return{data:{name:n.data,value:t.data},size:n.size+t.size,objectEnd:r}},g.parseVariable=function(e,t,r){return g.parseObject(e,t,r)},g.parseString=function(e,t,r){if(r<2)throw new Error("Data not enough when parse String");r=new DataView(e,t,r).getUint16(0,!v);return{data:0<r?i.default(new Uint8Array(e,t+2,r)):"",size:2+r}},g.parseLongString=function(e,t,r){if(r<4)throw new Error("Data not enough when parse LongString");r=new DataView(e,t,r).getUint32(0,!v);return{data:0<r?i.default(new Uint8Array(e,t+4,r)):"",size:4+r}},g.parseDate=function(e,t,r){if(r<10)throw new Error("Data size invalid when parse Date");t=new DataView(e,t,r),r=t.getFloat64(0,!v),t=t.getInt16(8,!v);return{data:new Date(r+=60*t*1e3),size:10}},g.parseValue=function(e,t,r){if(r<1)throw new Error("Data not enough when parse Value");var n=new DataView(e,t,r),i=1,a=n.getUint8(0),o=!1;try{switch(a){case 0:u=n.getFloat64(1,!v),i+=8;break;case 1:u=!!n.getUint8(1),i+=1;break;case 2:var s=g.parseString(e,t+1,r-1),u=s.data;i+=s.size;break;case 3:u={};var c=0;for(9==(16777215&n.getUint32(r-4,!v))&&(c=3);i<r-4;){var d=g.parseObject(e,t+i,r-i-c);if(d.objectEnd)break;u[d.data.name]=d.data.value,i+=d.size}i<=r-3&&9==(16777215&n.getUint32(i-1,!v))&&(i+=3);break;case 8:for(u={},i+=4,c=0,9==(16777215&n.getUint32(r-4,!v))&&(c=3);i<r-8;){var l=g.parseVariable(e,t+i,r-i-c);if(l.objectEnd)break;u[l.data.name]=l.data.value,i+=l.size}i<=r-3&&9==(16777215&n.getUint32(i-1,!v))&&(i+=3);break;case 9:i=1,o=!(u=void 0);break;case 10:u=[];var h=n.getUint32(1,!v);i+=4;for(var p=0;p<h;p++){var f=g.parseValue(e,t+i,r-i);u.push(f.data),i+=f.size}break;case 11:var _=g.parseDate(e,t+1,r-1);u=_.data,i+=_.size;break;case 12:var m=g.parseString(e,t+1,r-1);u=m.data,i+=m.size;break;default:i=r,y.default.warn("AMF","Unsupported AMF value type "+a)}}catch(e){y.default.error("AMF",e.toString())}return{data:u,size:i,objectEnd:o}},g);function g(){}t.default=r},function(e,t,r){"use strict";function o(e,t,r){var n=e;if(t+r<n.length){for(;r--;)if(128!=(192&n[++t]))return;return 1}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t,r=[],n=e,i=0,a=e.length;i<a;)if(n[i]<128)r.push(String.fromCharCode(n[i])),++i;else{if(!(n[i]<192))if(n[i]<224){if(o(n,i,1)&&128<=(t=(31&n[i])<<6|63&n[i+1])){r.push(String.fromCharCode(65535&t)),i+=2;continue}}else if(n[i]<240){if(o(n,i,2)&&2048<=(t=(15&n[i])<<12|(63&n[i+1])<<6|63&n[i+2])&&55296!=(63488&t)){r.push(String.fromCharCode(65535&t)),i+=3;continue}}else if(n[i]<248)if(o(n,i,3)&&65536<(t=(7&n[i])<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3])&&t<1114112){t-=65536,r.push(String.fromCharCode(t>>>10|55296)),r.push(String.fromCharCode(1023&t|56320)),i+=4;continue}r.push(String.fromCharCode(65533)),++i}return r.join("")}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),p=this&&this.__assign||function(){return(p=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TsDemuxer=void 0;var o,s=r(17),u=r(0),_=a(r(9)),m=r(4),c=r(39),d=r(20),f=r(21),y=r(1),v=u.makeLogger("ts-demuxer"),i=(o=s.Demuxer,i(l,o),l.prototype.dispose=function(){o.prototype.dispose.call(this),this._byteArray=null,this._pmt=null,this._audioConfig=null,this._videoConfig=null,v.log("disposed")},l.prototype._appendArrayBuffer=function(e){this._byteArray.write(e),this._parseTsPacket()},l.prototype._parseTsPacket=function(e){for(void 0===e&&(e=!1);188<=this._byteArray.byteAvailable;){var t=this._byteArray.read(188),r=new Uint8Array(t);if(0===this._byteArray.byteAvailable&&!e)return void this._byteArray.back(188);if(0<this._byteArray.byteAvailable){var n=this._byteArray.peekBytes(1)[0];if(71!==r[0]||71!==n){v.log("invalid ts packet, trying find new ts"),this._resetPes(),this._byteArray.back(187),this._findTsPacket();continue}}var i,a=r[1]>>6&1,o=(31&r[1])<<8|r[2],t=r[3]>>4&3,s=4;if(2!=t&&3!=t||(i=r[s++],s+=i),0!=o)if(this._pmt.pid&&o===this._pmt.pid)for(h=r[s++],f=(s+=h)+3+(p=(15&r[s+1])<<8|r[s+2])-4,s+=12+((15&r[s+10])<<8|r[s+11]);s<f;){var u=r[s],c=(31&r[s+1])<<8|r[s+2];if(s+=5+((15&r[s+3])<<8|r[s+4]),!this._pmt.streams[c]){var d=void 0,l=void 0;switch(u){case 27:d="video",l=m.Codec.H264;break;case 36:d="video",l=m.Codec.H265;break;case 15:d="audio",l=m.Codec.AAC;break;case 3:d="audio",l=m.Codec.MP3;break;case 21:break;default:v.warn("unsupport stream type: "+u+", pid: "+c)}this._pmt.foundVideo&&"video"===d?v.warn("multiple video found, ignore this one: "+d+" "+l+" "+c):this._pmt.foundAudio&&"audio"===d?v.warn("multiple audio found, ignore this one: "+d+" "+l+" "+c):d&&(this._pmt.streams[c]={type:d,codec:l,pes:{ba:new _.default({initLength:this._config.stashBuffer,autoClear:!0}),waitStart:!0}},"video"===d?this._pmt.foundVideo=!0:this._pmt.foundAudio=!0,v.log("found stream: "+d+" "+l+" "+c))}}else this._pmt.streams[o]&&(n=this._pmt.streams[o].pes,t=r.subarray(s),i=this._isPesStart(t),!n.waitStart||i?(a&&i&&this._parsePes(o),n.ba.write(t),n.waitStart=!1):v.warn("ignore un-start packet pid="+o+", size="+t.byteLength));else{var h=r[s++],p=(15&r[(s+=h)+1])<<8|r[s+2];if(1&r[s+5]){var f=s+3+p-4;for(s+=8;s<f;)r[s]<<8|r[s+1]&&(this._pmt.pid=(31&r[s+2])<<8|r[s+3]),s+=4}}}},l.prototype._isPesStart=function(e){return 0===e[0]&&0===e[1]&&1===e[2]},l.prototype._parsePes=function(e){var t=this._pmt.streams[e],r=t.pes.ba;if(!(r.byteAvailable<11)){r.read(3),r.readUint8(),r.readUint16(),r.readUint8();var e=r.readUint8(),n=(r.readUint8(),536870912*(14&r.readUint8())+(r.readUint16()>>1<<15)+(r.readUint16()>>1));4294967295<n&&(n-=8589934592);var i=n/=90;192===e&&(4294967295<(i=536870912*(14&r.readUint8())+(r.readUint16()>>1<<15)+(r.readUint16()>>1))&&(i-=8589934592),i/=90);var a=r.read(r.byteAvailable),o=t.codec;switch(o){case m.Codec.H264:case m.Codec.H265:this._parseNal(a,n,i,o);break;case m.Codec.AAC:this._parseAdts(a,n,i);break;case m.Codec.MP3:this._parseMp3(a,n,i);break;default:v.warn("unsupport codec="+o)}}},l.prototype._parseNal=function(e,t,r,n){var i,a=this._videoConfig,e=new Uint8Array(e),a={type:a.type,trackId:a.trackId,dts:r,pts:t,codec:n,config:a},n=d.parseNal({codec:n,bytes:e});0<n.configNalus.length&&(e=p(p({},a),{flag:"CFG",data:e.slice(0),dataFormat:"nalu"}),this._appendTrack(e)),0<n.nals.length&&(i=new c.BufferWriter(new ArrayBuffer(n.nalsLength+4*n.nals.length)),n.nals.forEach(function(e){return i.writeUint32(e.naluData.byteLength).write(e.naluData)}),a.data=new Uint8Array(i.buf),this._appendTrack(a))},l.prototype._parseAdts=function(e,t,r){for(var n=new Uint8Array(e),i=n.byteLength,a=this._audioConfig,o={type:"audio",trackId:a.trackId,dts:r,pts:t,codec:m.Codec.AAC,config:a},s=0,u=0;s<i;){var c=n.slice(s,s+7);this._audioHeader&&y.isBufferEqual(this._audioHeader,c)||(this._audioHeader=c,h=n[s+2]>>6,d=n[s+2]>>2&15,l=f.reference.mpegSamplingRates[d],a.refSampleDuration=1024/l*1e3,c=(1&n[s+2])<<2|n[s+3]>>6,(l=[])[0]=(h=1+h)<<3,l[0]|=(15&d)>>>1,l[1]=(15&d)<<7,l[1]|=(15&c)<<3,5==h&&(a[1]|=(15&d)>>>1,a[2]=(1&d)<<7,a[2]|=8,a[3]=0),h=p(p({},o),{flag:"CFG",data:new Uint8Array(l)}),this._appendTrack(h));var d=(3&n[s+3])<<11|n[s+4]<<3|n[s+5]>>5&7,l=s+d,h=t+u*a.refSampleDuration;if(n.length<l)return void v.warn("imcomplete aac frame, aac_frame_length="+d+", missing bytes="+(l-n.length));this._appendTrack(p(p({},o),{pts:h,dts:h,data:n.subarray(s+7,l)})),s=l,u++}},l.prototype._parseMp3=function(e,t,r){var n=new Uint8Array(e),e=this._audioConfig,e={type:"audio",trackId:e.trackId,dts:r,pts:t,codec:m.Codec.MP3,config:e,data:n},n=n.slice(0,4);this._audioHeader&&y.isBufferEqual(this._audioHeader,n)||(this._audioHeader=n,n=p(p({},e),{flag:"CFG",data:n}),this._appendTrack(n)),this._appendTrack(e)},l.prototype._resetTrack=function(e){o.prototype._resetTrack.call(this,e),this._byteArray.reset(),this._resetPes()},l.prototype._resetPes=function(){var t=this;Object.keys(this._pmt.streams).forEach(function(e){e=t._pmt.streams[e];e.pes.ba.reset(),e.pes.waitStart=!0})},l.prototype._flush=function(){var t=this;this._parseTsPacket(!0),Object.keys(this._pmt.streams).forEach(function(e){t._parsePes(+e)})},l.prototype._appendEnd=function(){this._flush(),o.prototype._appendEnd.call(this)},l.prototype._findTsPacket=function(){var r=this;this._byteArray.peekBytes().some(function(e,t){if(71===e)return v.log("find new ts packet, skip "+t+" bytes."),r._byteArray.skip(t),!0})},l);function l(e){e=o.call(this,e)||this;return e._pmt={streams:{}},e._byteArray=new _.default({initLength:e._config.stashBuffer,autoClear:!0}),e}t.TsDemuxer=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferWriter=void 0;var n=(Object.defineProperty(i.prototype,"offset",{get:function(){return this._offset},enumerable:!1,configurable:!0}),i.prototype.write=function(e){var t=e instanceof ArrayBuffer?new Uint8Array(e):e,e=t.length;return 0<e&&(this.u8a.set(t,this._offset),this._offset+=e),this},i.prototype.writeString=function(e){return e&&0<e.length&&this.write(e.split("").map(function(e){return e.charCodeAt(0)})),this},i.prototype.writeInt8=function(e){return this.dv.setInt8(this._offset,e),this._offset+=1,this},i.prototype.writeInt16=function(e,t){return this.dv.setInt16(this._offset,e,t),this._offset+=2,this},i.prototype.writeInt32=function(e,t){return this.dv.setInt32(this._offset,e,t),this._offset+=4,this},i.prototype.writeUint8=function(e){return this.dv.setUint8(this._offset,e),this._offset+=1,this},i.prototype.writeUint16=function(e,t){return this.dv.setUint16(this._offset,e,t),this._offset+=2,this},i.prototype.writeUint32=function(e,t){return this.dv.setUint32(this._offset,e,t),this._offset+=4,this},i.prototype.skip=function(e){return this._offset+=e,this},i);function i(e){this._offset=0,this.buf=e,this.dv=new DataView(e),this.u8a=new Uint8Array(e)}t.BufferWriter=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(c._getbits=function(e,t,r){if(!r||t<=0||8<t)return-1;var n=0,i=7&e,n=r[e=e>>3]<<i&255;if(n>>=8-t,8<i+t){if(void 0===r[1+e])return-1;n|=r[1+e]>>16-t-i}return n},c.parseAacFilData=function(e){for(var t=0,r=0,n=[];;){var i,a=0,o=0,s=[1,35,69,103,137,100,111,117,121];if((a=c._getbits(t,3,e))<0)return null;if(7==a)return n;if(6!=a)return null;if(o=c._getbits(t+=3,4,e),t+=4,o<0)return null;if(15===o){if(i=c._getbits(t,8,e),t+=8,i<0)return null;o+=i-1}if(o<9)return null;for(var u=0;u<9;u++){if(t>>3>=e.length)return null;if(a=c._getbits(t,8,e),t+=8,a!=s[u])return null}if(r+o-9>e.length)return null;for(u=0;u<o-9;u++){if(t>>3>=e.length)return null;if(a=c._getbits(t,8,e),t+=8,a<0)return null;n[r++]=a}}return n},c.getDbData=function(e){if(!e)return null;var t={};if(e){var r=0;if(t.type=e[r++],16==t.type){for(var n=e[r++],i=[],a=0;a<n;a++){var o={uid:"",db:0},s=e[r++],u=e[r++]-s;o.uid="";for(var c=0;c<u;c++)o.uid+=(e[r++]-48).toString();o.db=e[r++],i.push(o)}t.data=i}else t.data=e.slice(r)}return t},c);function c(){}t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Remuxer=void 0;var a,o=r(0),s=r(1),r=r(10),u=o.makeLogger("remuxer"),i=(a=r.TrackHandler,i(c,a),c.prototype.dispose=function(){a.prototype.dispose.call(this),this._config=void 0,this._trackConfigs={}},c.prototype.handleTrack=function(e){var t,r;"CFG"===e.flag?(t=e.config,r=this._trackConfigs[e.trackId],s.isBufferEqual(null==r?void 0:r.bytes,t.bytes)||(this._configChanged(t,r,e),this._trackConfigs[e.trackId]=Object.assign({},t))):this._handleTrackData(e)},c.prototype._handleTrackData=function(e){this.onData(e)},c.prototype._configChanged=function(e,t,r){u.log("track config changed!",t,e)},c);function c(e){var t=a.call(this)||this;return t._trackConfigs={},t._config=e,t}t.Remuxer=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,u=o(r(43)),c=o(r(7)),d=r(22),o=r(0),l=r(1),h=o.makeLogger("mp4-remuxer"),p=c.default.safari&&(14<c.default.version.major||14===c.default.version.major&&1<=c.default.version.minor),i=(s=d.Remuxer,i(f,s),f.prototype.dispose=function(){s.prototype.dispose.call(this),this._trackInfos=void 0},f.prototype._configChanged=function(e,t,r){h.log("track config changed!",t,e);t=a(a({},e),{duration:l.timescaledTime64(e.duration,e.timescale)});"audio"===e.type?"mp3"!==e.detailCodec||c.default.firefox?(e.mimeType="audio/mp4; codecs="+e.detailCodec,r.data=u.default.generateInitSegment(t),h.log("generate init audio segment")):(e.mimeType="audio/mpeg",this._useAudioMpeg=!0,this._isAudioTimeNeedUpdate=!0,delete r.data):"video"===e.type&&(e.mimeType="video/mp4; codecs="+e.detailCodec,r.data=u.default.generateInitSegment(t),h.log("generate init video segment"));t=this._trackInfos[r.trackId];t&&t.lastTrack?t.pendingConfigTrack=r:this.onData(r)},f.prototype._handleTrackData=function(e){var t=this,r=this._trackConfigs[e.trackId];if(r){if(e.config=r,"audio"===e.type&&this._useAudioMpeg)return this._isAudioTimeNeedUpdate&&(e.extradata.timeOffset=e.pts,this._isAudioTimeNeedUpdate=!1),void this.onData(e);if("RESET"===e.flag)return l.values(this._trackInfos).forEach(function(e){e.lastTrack&&(e.lastTrack.duration=r.refSampleDuration,t._remuxTrack(e.lastTrack))}),this._trackInfos={},this.onData(e),void h.log("reset");var n=this._trackInfos[e.trackId];if(n||(this._trackInfos[e.trackId]=n={lastTrack:void 0,sequenceNumber:1}),e.isEnd)return n.lastTrack&&(n.lastTrack.duration=r.refSampleDuration,this._remuxTrack(n.lastTrack),n.lastTrack=null),e.duration=r.refSampleDuration,void this.onData(e);e.data?(n.lastTrack&&(n.lastTrack.duration=e.dts-n.lastTrack.dts,(c.default.msedge||c.default.firefox||p)&&"audio"===n.lastTrack.type&&n.lastTrack.duration<this._config.audioDurationThreshold&&(n.lastTrack.duration=e.config.refSampleDuration,e.dts=e.pts=n.lastTrack.dts+n.lastTrack.duration),this._remuxTrack(n.lastTrack),n.pendingConfigTrack&&(this.onData(n.pendingConfigTrack),n.pendingConfigTrack=void 0)),n.lastTrack=e):this.onData(e)}},f.prototype._mergeBoxes=function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r},f.prototype._remuxAudio=function(e){var t,r;e.duration<0&&(e.duration=0),e.duration>this._config.audioDurationThreshold&&!e.isFake&&(h.warn("audio duration too long "+e.duration),e.extradata.jumpOverTs=e.pts+e.duration),e.data&&(r={trackId:e.trackId,sequenceNumber:this._trackInfos[e.trackId].sequenceNumber++,samples:[{duration:l.timescaledTime(e.duration,e.config.timescale),size:e.data.byteLength,cts:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,isNonSync:0}}]},t=u.default.moof(r,l.timescaledTime64(e.dts,e.config.timescale)),r=u.default.mdat(e.data),e.data=this._mergeBoxes(t,r)),this.onData(e)},f.prototype._remuxVideo=function(e){e.duration<0&&(e.duration=0),e.duration>this._config.videoDurationThreshold&&!e.isFake&&h.warn("video duration too long "+e.duration);var t,r=e.isKeyframe;e.data&&(r={trackId:e.trackId,sequenceNumber:this._trackInfos[e.trackId].sequenceNumber++,samples:[{duration:l.timescaledTime(e.duration,e.config.timescale),size:e.data.byteLength,cts:l.timescaledTime(e.pts-e.dts,e.config.timescale),flags:{isLeading:0,dependsOn:r?2:1,isDependedOn:r?1:0,hasRedundancy:0,isNonSync:r?0:1}}]},c.default.chrome&&(c.default.version.major<50||50===c.default.version.major&&c.default.version.build<2661)&&((t=r.samples[0].flags).dependsOn=2,t.isNonSync=0),t=u.default.moof(r,l.timescaledTime64(e.dts,e.config.timescale)),r=u.default.mdat(e.data),e.data=this._mergeBoxes(t,r)),this.onData(e)},f.prototype._remuxTrack=function(e){"audio"===e.type?this._remuxAudio(e):"video"===e.type&&this._remuxVideo(e)},f);function f(){var e=null!==s&&s.apply(this,arguments)||this;return e.TAG="MP4Remuxer",e._useAudioMpeg=!1,e._isAudioTimeNeedUpdate=!1,e._trackInfos={},e}t.default=i},function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n};Object.defineProperty(t,"__esModule",{value:!0});var n=(d.init=function(){for(var e in d.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],hvc1:[],hvcC:[]})d.types.hasOwnProperty(e)&&(d.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=d.constants={};t.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),t.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),t.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSC=t.STCO=t.STTS,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),t.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},d.box=function(e){for(var t=8,r=null,n=Array.prototype.slice.call(arguments,1),i=n.length,a=0;a<i;a++)t+=n[a].byteLength;(r=new Uint8Array(t))[0]=t>>>24&255,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r.set(e,4);for(var o=8,a=0;a<i;a++)r.set(n[a],o),o+=n[a].byteLength;return r},d.generateInitSegment=function(e){var t=d.box(d.types.ftyp,d.constants.FTYP),r=d.moov(e),e=new Uint8Array(t.byteLength+r.byteLength);return e.set(t,0),e.set(r,t.byteLength),e},d.moov=function(e){var t=d.mvhd(e.timescale,e.duration),r=d.trak(e),e=d.mvex(e);return d.box(d.types.moov,t,r,e)},d.mvhd=function(e,t){return d.box(d.types.mvhd,new Uint8Array(i([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e],t.toBytesBE(),[0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255])))},d.trak=function(e){return d.box(d.types.trak,d.tkhd(e),d.mdia(e))},d.tkhd=function(e){var t=e.trackId,r=e.duration,n=e.presentWidth,e=e.presentHeight;return d.box(d.types.tkhd,new Uint8Array(i([1,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,0],r.toBytesBE(),[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,e>>>8&255,255&e,0,0])))},d.mdia=function(e){return d.box(d.types.mdia,d.mdhd(e),d.hdlr(e),d.minf(e))},d.mdhd=function(e){var t=e.timescale,e=e.duration;return d.box(d.types.mdhd,new Uint8Array(i([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t],e.toBytesBE(),[85,196,0,0])))},d.hdlr=function(e){var t="audio"===e.type?d.constants.HDLR_AUDIO:d.constants.HDLR_VIDEO;return d.box(d.types.hdlr,t)},d.minf=function(e){var t="audio"===e.type?d.box(d.types.smhd,d.constants.SMHD):d.box(d.types.vmhd,d.constants.VMHD);return d.box(d.types.minf,t,d.dinf(),d.stbl(e))},d.dinf=function(){return d.box(d.types.dinf,d.box(d.types.dref,d.constants.DREF))},d.stbl=function(e){return d.box(d.types.stbl,d.stsd(e),d.box(d.types.stts,d.constants.STTS),d.box(d.types.stsc,d.constants.STSC),d.box(d.types.stsz,d.constants.STSZ),d.box(d.types.stco,d.constants.STCO))},d.stsd=function(e){return"audio"===e.type?"mp3"===e.detailCodec?d.box(d.types.stsd,d.constants.STSD_PREFIX,d.mp3(e)):d.box(d.types.stsd,d.constants.STSD_PREFIX,d.mp4a(e)):"h265"===e.codec?d.box(d.types.stsd,d.constants.STSD_PREFIX,d.hvc1(e)):d.box(d.types.stsd,d.constants.STSD_PREFIX,d.avc1(e))},d.mp3=function(e){var t=e.channelCount,e=e.audioSampleRate,e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,e>>>8&255,255&e,0,0]);return d.box(d.types[".mp3"],e)},d.mp4a=function(e){var t=e.channelCount,r=e.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return d.box(d.types.mp4a,r,d.esds(e))},d.esds=function(e){var t=i(e.bytes),e=t.length,t=new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t).concat([6,1,2]));return d.box(d.types.esds,t)},d.avc1=function(e){var t=e.bytes,r=e.codecWidth,e=e.codecHeight,e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,e>>>8&255,255&e,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,115,107,121,45,119,97,110,103,64,113,113,46,99,111,109,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return d.box(d.types.avc1,e,d.box(d.types.avcC,t))},d.hvc1=function(e){var t=e.bytes,r=e.codecWidth,e=e.codecHeight,e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,e>>>8&255,255&e,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,115,107,121,45,119,97,110,103,64,113,113,46,99,111,109,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return d.box(d.types.hvc1,e,d.box(d.types.hvcC,t))},d.mvex=function(e){return d.box(d.types.mvex,d.trex(e))},d.trex=function(e){e=e.trackId,e=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return d.box(d.types.trex,e)},d.moof=function(e,t){return d.box(d.types.moof,d.mfhd(e.sequenceNumber),d.traf(e,t))},d.mfhd=function(e){e=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]);return d.box(d.types.mfhd,e)},d.traf=function(e,t){var r=e.trackId,n=d.box(d.types.tfhd,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),r=d.box(d.types.tfdt,new Uint8Array(i([1,0,0,0],t.toBytesBE()))),t=d.sdtp(e),e=d.trun(e,t.byteLength+16+16+8+16+8+8+4);return d.box(d.types.traf,n,r,e,t)},d.sdtp=function(e){for(var t=e.samples||[],r=t.length,n=new Uint8Array(4+r),i=0;i<r;i++){var a=t[i].flags;n[i+4]=a.isLeading<<6|a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return d.box(d.types.sdtp,n)},d.trun=function(e,t){var r=e.samples||[],n=r.length,e=12+16*n,i=new Uint8Array(e);i.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,(t+=8+e)>>>24&255,t>>>16&255,t>>>8&255,255&t],0);for(var a=0;a<n;a++){var o=r[a].duration,s=r[a].size,u=r[a].flags,c=r[a].cts;i.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,s>>>24&255,s>>>16&255,s>>>8&255,255&s,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.isNonSync,0,0,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*a)}return d.box(d.types.trun,i)},d.mdat=function(e){return d.box(d.types.mdat,e)},d);function d(){}n.init(),t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackParser=void 0;var o,s=r(0),u=r(45),c=r(2),d=a(r(7)),l=r(4),h=r(3),r=r(10),p=s.makeLogger("track-parser"),i=(o=r.TrackHandler,i(f,o),f.prototype.dispose=function(){o.prototype.dispose.call(this),this._config=void 0,this._pendingTracks=void 0},f.prototype.handleTrack=function(e){if(this._isPending)this._pendingTracks.push(e);else if("RESET"===e.flag&&(this._pendingTracks=[],this._audioExpect=void 0,this._vbrTime=0,this._vbrBytes=0,p.log("reset")),e.data){var t=e.codec,r=u.getParser(t);if(r){if(!r.inited)return this._isPending=!0,this._pendingTracks.push(e),void r.init(this._config,this._onParserInited);var n=e.config;if(n.mimeType||"CFG"===e.flag){if("KEY"===e.flag&&(e.isKeyframe=!0),"CFG"===e.flag){if(n.bytes=e.data,!n.bytes.byteLength)return void p.warn(e.type+" track config bytes is missing");if(0!==r.parseConfig(n,e.dataFormat))return void p.warn("parse "+t+" config error");"audio"===e.type&&(n.timescale=n.audioSampleRate)}else if(e.data&&!e.isFake&&(this._vbrDetect(e),this._audioGapDetect(e),0!==r.parseData(e)))return void p.warn("parse "+t+" data error");this.onData(e)}else p.warn("first track is not cfg, ignore: trackId="+e.trackId+", type="+e.type+", dts="+e.dts+", pts="+e.pts)}else this.onError(new c.DyDemuxError("unsupport codec: "+t,c.ErrorIds.ParserCodecUnsupport))}else this.onData(e)},f.prototype._onParserInited=function(e){e?this.onError(new c.DyDemuxError(""+e,c.ErrorIds.ParserInitError)):(this._isPending=!1,this._pendingTracks.splice(0).forEach(this.append))},f.prototype._audioGapDetect=function(e){var t,r,n;d.default.chrome&&"audio"===e.type&&e.codec===l.Codec.AAC&&e.data&&("KEY"===e.flag||void 0===e.flag)&&1<e.trackLength&&(void 0===this._audioExpect?this._audioExpect=e.dts:(t=Math.floor(1e3*this._audioExpect),r=1e3*e.dts-t,(n=Math.floor(Math.abs(r)/1e3))>this._audioGap&&(p.warn("Large timestamp gap detected; may cause AV sync to drift. time:"+1e3*e.dts+"us expected:"+t+"us delta:"+r+"us"),this._audioGap=n,150<this._audioGap&&(p.warn("Large timestamp gap exceed 150ms, jump over "+e.dts+" and reset."),e.extradata.jumpOverTs=e.dts,this._audioGap=50,this._audioExpect=e.dts))),this._audioExpect+=e.config.refSampleDuration)},f.prototype._vbrDetect=function(e){var t,r;this._vbrTime?(this._vbrBytes+=e.data.byteLength,23e3<=(t=e.dts-this._vbrTime)&&(r=Math.round(8*this._vbrBytes/1024/(t/1e3)),this._vbrBytes=0,this._vbrTime=e.dts,this._config.__internal.eventbus.emit(h.InternalEvents.VBR,{data:{vbr:r,pts:e.pts}}),p.log("vbr="+r+", dts="+e.dts+", delta="+t))):(this._vbrBytes=0,this._vbrTime=e.dts)},f);function f(e){var t=o.call(this)||this;return t._pendingTracks=[],t._isPending=!1,t._audioGap=50,t._vbrTime=0,t._vbrBytes=0,t._config=e,t}t.TrackParser=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getParser=t.registerParser=void 0;var n=r(21),i=r(46),a=r(49),o={};function s(e){o[e.name]=e}t.registerParser=s,t.getParser=function(e){return o[e]},s(i.h264),s(n.aac),s(a.mp3),s(r(50).h265)},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.h264=void 0;var s=r(0),S=o(r(47)),_=a(r(23)),O=r(4),A=r(20),m=r(1),k=s.makeLogger("h264-parser"),P={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3};t.h264={name:O.Codec.H264,inited:!0,parseConfig:function(e,t){if("nalu"===t){var r=A.parseNal({codec:O.Codec.H264,bytes:e.bytes});if(!(0<r.configNalus.length))return k.warn("wrong nalu config data",e),-1;e.bytes=function(e){var t=e.configNalus.find(function(e){return 7===e.naluType}),r=e.configNalus.find(function(e){return 8===e.naluType});if(!t)return null;var n=S.default.parseSPS(t.naluData),i=t.naluData.byteLength,e=r.naluData.byteLength,r=[1,n.profile_idc,n.profile_compatibility,n.level_idc,255,225,i>>8,255&i].concat(Array.prototype.slice.call(t.naluData)).concat([1,e>>8,255&e]).concat(Array.prototype.slice.call(r.naluData));return void 0!==n.bit_depth_luma_minus8&&(r=r.concat([252|n.chroma_format_idc,248|n.bit_depth_luma_minus8,248|n.bit_depth_chroma_minus8,0])),new Uint8Array(r)}(r)}t=e.bytes&&e.bytes.byteLength;if(t<7)return k.warn("Invalid AVCDecoderConfigurationRecord, lack of data!"),-1;var n=e.bytes.buffer,i=e.bytes.byteOffset,a=new DataView(n,i,t),o=(new Uint8Array(n.slice(i,i+t)),0),s=0,u=0,c=0,d=0,l="",h=P,r=a.getUint8(0),t=a.getUint8(1);if(a.getUint8(2),a.getUint8(3),1!==r||0===t)return k.warn("Invalid AVCDecoderConfigurationRecord"),-1;if(3!=(t=1+(3&a.getUint8(4)))&&4!=t)return k.warn("Strange NaluLengthSizeMinusOne: "+(t-1)),-1;var p=31&a.getUint8(5);if(0==p)return k.warn("Invalid AVCDecoderConfigurationRecord: No SPS"),-1;1<p&&k.warn("Strange AVCDecoderConfigurationRecord: SPS Count = "+p);for(var f=6,_=0;_<p;_++){var m=a.getUint16(f,!1);if(f+=2,0!==m){var y=new Uint8Array(n,i+f,m);f+=m;var v=S.default.parseSPS(y);if(0===_){for(var o=v.codec_size.width,s=v.codec_size.height,u=v.present_size.width,c=v.present_size.height,d=(h=0!==v.frame_rate.fps_num&&0!==v.frame_rate.fps_den?v.frame_rate:h).fps_den/h.fps_num*1e3,g=y.subarray(1,4),b="avc1.",w=0;w<3;w++){var E=g[w].toString(16);b+=E=E.length<2?"0"+E:E}l=b}}}var T=a.getUint8(f);if(0===T)return k.warn("Invalid AVCDecoderConfigurationRecord: No PPS"),-1;for(1<T&&k.warn("Strange AVCDecoderConfigurationRecord: PPS Count = "+T),f++,_=0;_<T;_++)m=a.getUint16(f,!1),f+=2,0!==m&&(f+=m);return e.naluLengthSize=t,e.codecWidth=o,e.codecHeight=s,e.presentWidth=u,e.presentHeight=c,e.refSampleDuration=d,e.detailCodec=l,e.fps=h.fps,k.debug("Parsed AVCDecoderConfigurationRecord"),0},parseData:function(e){for(var t=e.data.byteLength,r=e.data.buffer,n=e.data.byteOffset,i=new DataView(r,n,t),a=0,o=e.config.naluLengthSize,s=[];a<t;){if(t<=a+4){k.warn("Malformed Nalu");break}var u=i.getUint32(a,!1);if(3===o&&(u>>>=8),t-o<u)return k.warn("Malformed Nalus, NaluSize > DataSize!"),-1;var c=31&i.getUint8(a+o),d=new Uint8Array(r,n+a,4+u);if(6!=c&&s.push(d),5==c)e.isKeyframe=!0,e.pureKeyframe=d;else if(6==c)try{var l=new Uint8Array(r,n+a+1+o,u-1),h=_.default.parseSEI(l),p=h.seiType,f=h.seiData;f&&f.data&&(p===_.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED&&f.uuid===_.H264SeiUUIDType.CloudVideoStream&&(e.extradata.seiTimestamp=f.data),e.extradata.sei||(e.extradata.sei=[]),e.extradata.sei.push({seiTimestamp:e.dts,seiType:p,seiData:f}))}catch(e){k.warn("parse sei error, ignored!",e)}a+=o+u}return delete e.data,0<s.length&&(e.data=m.bufferConcat(s)),0}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),x=n(r(48)),M=i.makeLogger("sps-parser"),i=(j._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,a=0;a<r;a++)2<=a&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[i]=t[a],i++);return new Uint8Array(n.buffer,0,i)},j.parseSPS=function(e){var t=j._ebsp2rbsp(e),r=new x.default(t);r.readByte();var n=r.readByte(),i=r.readByte(),a=r.readByte();r.readUEG();var o,s,u=j.getProfileString(n),c=j.getLevelString(a),d=1,l=420,h=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(d=r.readUEG())&&r.readBits(1),d<=3&&(l=[0,420,422,444][d]),h=(o=r.readUEG())+8,s=r.readUEG(),r.readBits(1),r.readBool()))for(var p=3!==d?8:12,f=0;f<p;f++)r.readBool()&&j._skipScalingList(r,f<6?16:64);r.readUEG();var _=r.readUEG();if(0===_)r.readUEG();else if(1===_){r.readBits(1),r.readSEG(),r.readSEG();for(var m=r.readUEG(),f=0;f<m;f++)r.readSEG()}r.readUEG(),r.readBits(1);var y=r.readUEG(),v=r.readUEG(),g=r.readBits(1);0===g&&r.readBits(1),r.readBits(1);var b=0,w=0,E=0,T=0;r.readBool()&&(b=r.readUEG(),w=r.readUEG(),E=r.readUEG(),T=r.readUEG());var S=1,O=1,A=0,e=!0,t=0,_=0;r.readBool()&&(r.readBool()&&(0<(k=r.readByte())&&k<16?(S=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][k-1],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][k-1]):255===k&&(S=r.readByte()<<8|r.readByte(),O=r.readByte()<<8|r.readByte())),r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()&&(r.getBitsLeft()<9?M.warn("Truncated VUI"):(I=r.readBits(32),P=r.readBits(32),e=r.readBool(),A=(t=P)/(_=2*I))));var k=1;1===S&&1===O||(k=S/O);var P=0,I=0,I=0===d?(P=1,2-g):(P=3===d?1:2,(1===d?2:1)*(2-g)),y=16*(y+1),g=16*(v+1)*(2-g);y-=(b+w)*P,g-=(E+T)*I;k=Math.ceil(y*k);return r.destroy(),r=null,{profile_idc:n,profile_compatibility:i,level_idc:a,profile_string:u,level_string:c,bit_depth:h,bit_depth_luma_minus8:o,bit_depth_chroma_minus8:s,chroma_format_idc:d,chroma_format:l,chroma_format_string:j.getChromaFormatString(l),frame_rate:{fixed:e,fps:A,fps_den:_,fps_num:t},sar_ratio:{width:S,height:O},codec_size:{width:y,height:g},present_size:{width:k,height:g}}},j._skipScalingList=function(e,t){for(var r=8,n=8,i=0;i<t;i++)r=0===(n=0!==n?(r+e.readSEG()+256)%256:n)?r:n},j.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},j.getLevelString=function(e){return(e/10).toFixed(1)},j.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},j);function j(){}t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(i.prototype.destroy=function(){this._buffer=null},i.prototype._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new Error("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),e=new Uint8Array(4);e.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(e.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},i.prototype.readBits=function(e){if(32<e)throw new Error("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;t=e-this._current_word_bits_left;this._fillCurrentWord();e=Math.min(t,this._current_word_bits_left),t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,r<<e|t},i.prototype.readBool=function(){return 1===this.readBits(1)},i.prototype.readByte=function(){return this.readBits(8)},i.prototype._skipLeadingZero=function(){for(var e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},i.prototype.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},i.prototype.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},i.prototype.getBitsLeft=function(){return this._current_word_bits_left+8*(this._total_bytes-this._buffer_index)},i);function i(e){this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mp3=void 0;var n=r(0),r=r(4),u=n.makeLogger("mp3-parser"),c={_mpegAudioV10SampleRateTable:[44100,48e3,32e3,0],_mpegAudioV20SampleRateTable:[22050,24e3,16e3,0],_mpegAudioV25SampleRateTable:[11025,12e3,8e3,0],_mpegAudioL1BitRateTable:[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],_mpegAudioL2BitRateTable:[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],_mpegAudioL3BitRateTable:[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1]};t.mp3={name:r.Codec.MP3,inited:!0,parseConfig:function(e){if(e.bytes.byteLength<4)return u.warn("Invalid MP3 packet, header missing!"),-1;var t=e.bytes;if(255!==t[0])return-1;var r=t[1]>>>3&3,n=(6&t[1])>>1,i=(240&t[2])>>>4,a=(12&t[2])>>>2,t=3!=(t[3]>>>6&3)?2:1,o=0,s=0;switch(r){case 0:o=c._mpegAudioV25SampleRateTable[a];break;case 2:o=c._mpegAudioV20SampleRateTable[a];break;case 3:o=c._mpegAudioV10SampleRateTable[a]}switch(n){case 1:i<c._mpegAudioL3BitRateTable.length&&(s=c._mpegAudioL3BitRateTable[i]);break;case 2:i<c._mpegAudioL2BitRateTable.length&&(s=c._mpegAudioL2BitRateTable[i]);break;case 3:i<c._mpegAudioL1BitRateTable.length&&(s=c._mpegAudioL1BitRateTable[i])}return e.audioSampleRate=o,e.channelCount=t,e.detailCodec="mp3",e.dataRate=s,e.refSampleDuration=1152/o*1e3,u.log("Parsed MPEG Audio Frame Header"),0},parseData:function(e){return 0}}},function(e,n,t){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.h265=void 0;var h,s=t(0),_=r(t(23)),r=t(4),u=o(t(51)),m=t(1),y=s.makeLogger("h265-parser");n.h265={name:r.Codec.H265,inited:!1,parseConfig:function(e,t){if("nalu"===t&&(e.bytes=function(e){var t=h._malloc(4096),r=e.byteLength,n=h._malloc(r);h.HEAPU8.set(e,n);e=h._hvcC_write(t,4096,n,r),r=null;return e<0?y.warn("hvcc write error: "+e):r=h.HEAPU8.slice(t,t+e),h._free(t),h._free(n),r}(e.bytes)),!e.bytes||e.bytes.byteLength<7)return y.warn("Invalid HvcC, lack of data!"),-1;var r=h._malloc(128),n=h._malloc(e.bytes.byteLength);h.HEAPU8.set(e.bytes,n);var i,a,o,s,u,c,d,l=h._hvcC_parse(r,n,e.bytes.byteLength);return 0===l&&(i=(d=new Int32Array(h.HEAPU8.buffer,r,7))[0],a=d[1],o=d[2],s=d[3],u=d[4],c=d[5],t=d[6],d=h.UTF8ToString(r+d.byteLength),e.naluLengthSize=i,e.codecWidth=a,e.codecHeight=o,e.presentWidth=s,e.presentHeight=u,e.refSampleDuration=t/c*1e3,e.detailCodec=d,e.fps=c/t,y.log("Parsed HvcC")),h._free(r),h._free(n),l},parseData:function(e){for(var t=e.data.byteLength,r=e.data.buffer,n=e.data.byteOffset,i=new DataView(r,n,t),a=0,o=e.config.naluLengthSize,s=[];a<t;){if(t<=a+4){y.warn("Malformed Nalu");break}var u=i.getUint32(a,!1);if(3===o&&(u>>>=8),t-o<u)return y.warn("Malformed Nalus, NaluSize > DataSize!"),-1;var c=(126&i.getUint8(a+o))>>1,d=new Uint8Array(r,n+a,4+u);if(39!=c&&40!=c&&s.push(d),16<=c&&c<=23)e.isKeyframe=!0,e.pureKeyframe=d;else if(39==c||40==c)try{var l=new Uint8Array(r,n+a+2+o,u-1),h=_.default.parseSEI(l),p=h.seiType,f=h.seiData;f&&f.data&&(p===_.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED&&f.uuid===_.H264SeiUUIDType.CloudVideoStream&&(e.extradata.seiTimestamp=f.data),e.extradata.sei||(e.extradata.sei=[]),e.extradata.sei.push({seiTimestamp:e.dts,seiType:p,seiData:f}))}catch(e){y.warn("parse sei error, ignored!",e)}a+=o+u}return delete e.data,0<s.length&&(e.data=m.bufferConcat(s)),0},init:function(e,t){var r;m.isWasmSupported()?(r=e.__internal.wasmHvcc,u.default({locateFile:function(){return r},onAbort:function(e){y.warn("init hvcc wasm error: "+e),t(e)}}).then(function(e){y.log("hvcc wasm inited."),n.h265.inited=!0,h=e,t()})):t("init hvcc wasm error: WebAssembly no supported.")}}},function(t,e,r){!function(G){var q,e=(q="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(a){var r,n;(a=void 0!==(a=a||{})?a:{}).ready=new Promise(function(e,t){r=e,n=t});var e,t={};for(e in a)a.hasOwnProperty(e)&&(t[e]=a[e]);var i="./this.program",o="object"==typeof window,s="function"==typeof importScripts;"object"==typeof G&&"object"==typeof G.versions&&G.versions.node;var u,c="";(o||s)&&(s?c=self.location.href:document.currentScript&&(c=document.currentScript.src),c=0!==(c=q?q:c).indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"",s&&(u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));var d,l,h=a.print||console.log.bind(console),p=a.printErr||console.warn.bind(console);for(e in t)t.hasOwnProperty(e)&&(a[e]=t[e]);t=null,a.arguments&&a.arguments,a.thisProgram&&(i=a.thisProgram),a.quit&&a.quit,a.wasmBinary&&(d=a.wasmBinary),a.noExitRuntime&&a.noExitRuntime,"object"!=typeof WebAssembly&&j("no native wasm support detected");var f,_,m,y,v=new WebAssembly.Table({initial:14,maximum:14,element:"anyfunc"}),g=!1,b="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function w(e,t,r){for(var n=t+r,i=t;e[i]&&!(n<=i);)++i;if(16<i-t&&e.subarray&&b)return b.decode(e.subarray(t,i));for(var a="";t<i;){var o,s,u=e[t++];128&u?(o=63&e[t++],192!=(224&u)?(s=63&e[t++],(u=224==(240&u)?(15&u)<<12|o<<6|s:(7&u)<<18|o<<12|s<<6|63&e[t++])<65536?a+=String.fromCharCode(u):(s=u-65536,a+=String.fromCharCode(55296|s>>10,56320|1023&s))):a+=String.fromCharCode((31&u)<<6|o)):a+=String.fromCharCode(u)}return a}function E(e,t){return e?w(m,e,t):""}var T=a.INITIAL_MEMORY||16777216;function S(e){for(;0<e.length;){var t,r=e.shift();"function"!=typeof r?"number"==typeof(t=r.func)?void 0===r.arg?a.dynCall_v(t):a.dynCall_vi(t,r.arg):t(void 0===r.arg?null:r.arg):r(a)}}T=(f=(l=a.wasmMemory||new WebAssembly.Memory({initial:T/65536,maximum:T/65536}))?l.buffer:f).byteLength,f=T=f,a.HEAP8=_=new Int8Array(T),a.HEAP16=new Int16Array(T),a.HEAP32=y=new Int32Array(T),a.HEAPU8=m=new Uint8Array(T),a.HEAPU16=new Uint16Array(T),a.HEAPU32=new Uint32Array(T),a.HEAPF32=new Float32Array(T),a.HEAPF64=new Float64Array(T),y[12496]=5293024;var O=[],A=[],k=[],P=[],I=0,x=null,M=null;function j(e){a.onAbort&&a.onAbort(e),p(e+=""),g=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";e=new WebAssembly.RuntimeError(e);throw n(e),e}a.preloadedImages={},a.preloadedAudios={};function R(e){return t=e,e="data:application/octet-stream;base64,",String.prototype.startsWith?t.startsWith(e):0===t.indexOf(e);var t}var D="hvcC_parser.wasm";function L(){try{if(d)return new Uint8Array(d);if(u)return u(D);throw"both async and sync fetching of the wasm failed"}catch(e){j(e)}}R(D)||(T=D,D=a.locateFile?a.locateFile(T,c):c+T),A.push({func:function(){F()}});var C={};function B(){if(!B.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:i||"./this.program"};for(t in C)e[t]=C[t];var t,r=[];for(t in e)r.push(t+"="+e[t]);B.strings=r}return B.strings}var U,N={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=N.buffers[e];0===t||10===t?((1===e?h:p)(w(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return N.varargs+=4,y[N.varargs-4>>2]},getStr:function(e){return E(e)},get64:function(e,t){return e}},H={a:function(){j()},k:function(e){console.log(E(e))},j:function(e){console.warn(E(e))},c:function(e,t,r){m.copyWithin(e,t,t+r)},d:function(e){j("OOM")},e:function(n,i){var a=0;return B().forEach(function(e,t){var r=i+a;(function(e,t,r){for(var n=0;n<e.length;++n)_[t++>>0]=e.charCodeAt(n);r||(_[t>>0]=0)})(e,y[n+4*t>>2]=r),a+=e.length+1}),0},f:function(e,t){var r=B();y[e>>2]=r.length;var n=0;return r.forEach(function(e){n+=e.length+1}),y[t>>2]=n,0},h:function(e){return 0},g:function(e,t){e=1==e||2==e?2:j();return _[t>>0]=e,0},i:function(e,t,r,n,i){},b:function(e,t,r,n){for(var i=0,a=0;a<r;a++){for(var o=y[t+8*a>>2],s=y[t+(8*a+4)>>2],u=0;u<s;u++)N.printChar(e,m[o+u]);i+=s}return y[n>>2]=i,0},memory:l,table:v},F=(function(){var t={a:H};function r(e,t){e=e.exports;a.asm=e,I--,a.monitorRunDependencies&&a.monitorRunDependencies(I),0==I&&(null!==x&&(clearInterval(x),x=null),M)&&(e=M,M=null,e())}function n(e){r(e.instance)}function i(e){return(d||!o&&!s||"function"!=typeof fetch?new Promise(function(e,t){e(L())}):fetch(D,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+D+"'";return e.arrayBuffer()}).catch(L)).then(function(e){return WebAssembly.instantiate(e,t)}).then(e,function(e){p("failed to asynchronously prepare wasm: "+e),j(e)})}if(I++,a.monitorRunDependencies&&a.monitorRunDependencies(I),a.instantiateWasm)try{return a.instantiateWasm(t,r)}catch(e){return p("Module.instantiateWasm callback failed with error: "+e)}d||"function"!=typeof WebAssembly.instantiateStreaming||R(D)||"function"!=typeof fetch?i(n):fetch(D,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,t).then(n,function(e){return p("wasm streaming compile failed: "+e),p("falling back to ArrayBuffer instantiation"),i(n)})})}(),a.___wasm_call_ctors=function(){return(F=a.___wasm_call_ctors=a.asm.l).apply(null,arguments)}),V=(a._hvcC_write=function(){return(a._hvcC_write=a.asm.m).apply(null,arguments)},a._hvcC_parse=function(){return(a._hvcC_parse=a.asm.n).apply(null,arguments)},a._log_init=function(){return(a._log_init=a.asm.o).apply(null,arguments)},a._free=function(){return(a._free=a.asm.p).apply(null,arguments)},a._malloc=function(){return(V=a._malloc=a.asm.q).apply(null,arguments)});function W(e){function t(){U||(U=!0,a.calledRun=!0,g||(S(A),S(k),r(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),function(){if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)e=a.postRun.shift(),P.unshift(e);var e;S(P)}()))}0<I||(function(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)e=a.preRun.shift(),O.unshift(e);var e;S(O)}(),0<I||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),t()},1)):t()))}if(a.UTF8ToString=E,a.allocateUTF8=function(e){var t=function(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);(n=55296<=n&&n<=57343?65536+((1023&n)<<10)|1023&e.charCodeAt(++r):n)<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}(e)+1,r=V(t);return r&&function(e,t,r,n){if(0<n){for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if((s=55296<=s&&s<=57343?65536+((1023&s)<<10)|1023&e.charCodeAt(++o):s)<=127){if(a<=r)break;t[r++]=s}else if(s<=2047){if(a<=r+1)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(a<=r+2)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(a<=r+3)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}t[r]=0}}(e,_,r,t),r},M=function e(){U||W(),U||(M=e)},a.run=W,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();return W(),a.ready});t.exports=e}.call(e,r(52))},function(e,t){var r,n,e=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var s,u=[],c=!1,d=-1;function l(){c&&s&&(c=!1,s.length?u=s.concat(u):d=-1,u.length&&h())}function h(){if(!c){var e=o(l);c=!0;for(var t=u.length;t;){for(s=u,u=[];++d<t;)s&&s[d].run();d=-1,t=u.length}s=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||o(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=f,e.addListener=f,e.once=f,e.off=f,e.removeListener=f,e.removeAllListeners=f,e.emit=f,e.prependListener=f,e.prependOnceListener=f,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Workerable=void 0;var n=r(5),i=r(2),a=r(1),r=(o.prototype.init=function(e){this._config=e,this.inWorker&&a.connectEventbus(this,this._onMessage,e)},o.prototype.postMessage=function(e,t){this._onMessage({data:e})},o.prototype.terminate=function(){var e;this.onmessage=null,this.onerror=null,this.inWorker&&this._config&&(null===(e=null===(e=this._config.__internal)||void 0===e?void 0:e.eventbus)||void 0===e||e.removeAllListeners(),this._config=null)},o.prototype.dispatchMessage=function(e,t){this.inWorker?t&&t[0]instanceof ArrayBuffer?self.postMessage(e,t):self.postMessage(e):this.onmessage&&this.onmessage({data:e})},o.prototype._onError=function(e){this.dispatchMessage({name:"_onError",params:this.inWorker?i.errorClone(e):e}),this.terminate()},o);function o(){var t=this;this.inWorker=!1,n.bindAll(this),this.inWorker="object"!=typeof window,this.inWorker&&(self.onmessage=this._onMessage,self.onerror=function(e){return t._onError(new i.DyError("worker error: "+e,i.ErrorIds.WorkerError))})}t.Workerable=r},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(13),u=r(4),c=r(2),d=r(10),l=a(r(9)),h=r(1),p=r(0).makeLogger("ws-transcoder"),i=(o=d.TrackHandler,i(f,o),Object.defineProperty(f.prototype,"isConnected",{get:function(){return!(!this._ws||1!==this._ws.readyState)},enumerable:!1,configurable:!0}),f.prototype.dispose=function(){o.prototype.dispose.call(this),this._ws&&(this._ws.onopen=null,this._ws.onmessage=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.close(),this._ws=null),this._buffer=null,this._pendingTracks=null},f.prototype.handleTrack=function(e){if(!this._isEnd)return"RESET"===e.flag?(this._reset(),void this.onData(e)):void("video"===e.type?("CFG"===e.flag&&(this._videoConfigTrack=Object.assign({},e)),e.isEnd&&!this._isEnd&&(this._ws.send(JSON.stringify({type:"end"})),this._isEnd=!0),this._send(e),this._lastVideoTrack=e):this.onData(e))},f.prototype._initWs=function(){var t=this;p.log("init accelerator..."),this._ws=new WebSocket(this._config.accelerator.url),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen,this._ws.onmessage=this._onMessage,this._ws.onclose=function(e){t._isEnd||t._error(new s.DyError("accelerator closed: code="+e.code+", msg="+e.reason,c.ErrorIds.AcceleratorClosed))},this._ws.onerror=function(){return t._error(new s.DyError("accelerator error",c.ErrorIds.AcceleratorError))}},f.prototype._send=function(e){this.isConnected?(e.data&&this._sendBuffer(e.data),delete e.data,e.codec=u.Codec.H264,e.isEnd=!1,e.isKeyframe=!1,this._dispatchVideoTrack(e)):this._pendingTracks.push(e)},f.prototype._sendBuffer=function(e){this._buffer.write(e),this._buffer.byteAvailable>=this._bufferSize&&this._flush()},f.prototype._flush=function(){var e;this._buffer.byteAvailable&&(e=new Uint8Array(this._buffer.readAll()),this._ws.send(e))},f.prototype._onOpen=function(){this._ws.send(JSON.stringify({type:"S",client:location.href,codec:this._config.videoCodec,byteRate:this._config.accelerator.byteRate})),this._pendingTracks.length&&this._pendingTracks.splice(0).forEach(this._send)},f.prototype._onMessage=function(e){var t;"string"==typeof e.data?"end"===(t=JSON.parse(e.data)).type?this._dispatchVideoTrack({type:"video",trackLength:this._lastVideoTrack.trackLength,trackId:this._lastVideoTrack.trackId,config:this._lastVideoTrack.config,dts:this._lastVideoTrack.dts,pts:this._lastVideoTrack.pts,isKeyframe:!1,codec:u.Codec.H264,isEnd:!0}):t.mimeType&&(this._transcodedMimeType=t.mimeType,this._pendingTracks.length&&this._pendingTracks.splice(0).forEach(this._dispatchVideoTrack)):e.data instanceof ArrayBuffer&&this._dispatchVideoTrack({type:"video",trackLength:this._lastVideoTrack.trackLength,trackId:this._lastVideoTrack.trackId,config:this._lastVideoTrack.config,dts:this._lastVideoTrack.dts,pts:this._lastVideoTrack.pts,isKeyframe:!1,codec:u.Codec.H264,data:new Uint8Array(e.data)})},f.prototype._error=function(e){this.onError&&this.onError(e)},f.prototype._dispatchVideoTrack=function(e){this._transcodedMimeType?(e.config.mimeType=this._transcodedMimeType,this.onData(e)):this._pendingTracks.push(e)},f.prototype._reset=function(){p.log("reset"),this._ws&&(this._ws.onopen=null,this._ws.onmessage=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.close(),this._ws=null),this._buffer.reset(),this._pendingTracks=[h.shallowClone(this._videoConfigTrack)],this._transcodedMimeType="",this._initWs()},f);function f(e){var t=o.call(this)||this;return t._pendingTracks=[],t._bufferSize=51200,t._buffer=new l.default({autoClear:!0,initLength:t._bufferSize}),t._isEnd=!1,t._transcodedMimeType="",t._config=e,t._initWs(),t}t.default=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TrackGenerator=void 0;var a,o=r(6),s=r(0),r=r(10),i=(s.makeLogger("track-generator"),a=r.TrackHandler,i(u,a),u.prototype.dispose=function(){a.prototype.dispose.call(this),this._config=void 0,this._lastKeyframe=void 0,this._lastVideoTrack=void 0},u.prototype.handleTrack=function(e){var t,r;"RESET"===e.flag&&(this._lastVideoTrack=void 0),this.onData(e),o.isFrameTrack(e)&&(1===e.trackLength?this._needGenerateVideo||"audio"!==e.type||2!==(null===(t=this._lastKeyframe)||void 0===t?void 0:t.trackLength)||(this._needGenerateVideo=!0):this._needGenerateVideo=!1,"video"===e.type&&(r=Object.assign({},e),(this._lastVideoTrack=r).isKeyframe&&(this._lastKeyframe=r)),this._needGenerateVideo&&"audio"===e.type&&(r=this._lastVideoTrack,this._lastKeyframe&&(!r||50<Math.abs(e.dts-r.dts))&&((r=Object.assign({},this._lastKeyframe)).dts=e.dts,r.pts=e.pts,r.isFake=!0,r.extradata={},r.pureKeyframe&&(r.data=r.pureKeyframe),this.onData(r),this._lastVideoTrack=r)))},u);function u(e){var t=a.call(this)||this;return t._needGenerateVideo=!1,t._config=e,t}t.TrackGenerator=i},function(e,t,h){function a(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=r,i.c=n,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var e=i(i.s=ENTRY_MODULE);return e.default||e}var p="[\\.|\\-|\\+|\\w|/|@]+",f="\\((/\\*.*?\\*/)?s?.*?("+p+").*?\\)";function _(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}e.exports=function(e,t){var r={main:h.m},n=(t=t||{}).all?{main:Object.keys(r)}:function(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};function(r){return Object.keys(r).reduce(function(e,t){return e||0<r[t].length},!1)}(r);)for(var a=Object.keys(r),o=0;o<a.length;o++){var s=a[o],u=r[s].pop();if(i[s]=i[s]||{},!i[s][u]&&e[s][u]){i[s][u]=!0,n[s]=n[s]||[],n[s].push(u);for(var c=function(e,t,r){var n={};n[r]=[];var i=t.toString();if(!(t=i.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/)))return n;for(var a,t=t[1],o=new RegExp("(\\\\n|\\W)"+_(t)+f,"g");a=o.exec(i);)"dll-reference"!==a[3]&&n[r].push(a[3]);for(o=new RegExp("\\("+_(t)+'\\("(dll-reference\\s('+p+'))"\\)\\)'+f,"g");a=o.exec(i);)e[a[2]]||(n[r].push(a[1]),e[a[2]]=h(a[1]).m),n[a[2]]=n[a[2]]||[],n[a[2]].push(a[4]);return n}(e,e[s][u],s),d=Object.keys(c),l=0;l<d.length;l++)r[d[l]]=r[d[l]]||[],r[d[l]]=r[d[l]].concat(c[d[l]])}}return n}(r,e),i="";Object.keys(n).filter(function(e){return"main"!==e}).forEach(function(t){for(var e=0;n[t][e];)e++;n[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",i=i+"var "+t+" = ("+a.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n[t].map(function(e){return JSON.stringify(e)+": "+r[t][e].toString()}).join(",")+"});\n"});i=i+"new (("+a.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map(function(e){return JSON.stringify(e)+": "+r.main[e].toString()}).join(",")+"}))(self);",e=new window.Blob([i],{type:"text/javascript"});if(t.bare)return e;t=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(e),e=new window.Worker(t);return e.objectURL=t,e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeDispatch=void 0;var n=r(5),i=r(1),r=(a.prototype.destroy=function(){this.detach(),clearInterval(this._timer)},a.prototype.attach=function(e){this.video=e},a.prototype.detach=function(){this.video=null,this.array=[]},a.prototype.add=function(e){i.binsert(this.array,e,function(e,t){return e.ts-t.ts}),this._onTimeUpdate()},a.prototype.clear=function(){this.array=[]},a.prototype._send=function(e){this.onSend&&this.onSend(e)},a.prototype._onTimeUpdate=function(){if(this.video){for(var e=1e3*this.video.currentTime,t=this.array.length,r=0;r<t;r++){var n=this.array[r];if(n.ts>e)break;this._send(n)}0<r&&this.array.splice(0,r)}},a);function a(){this.array=[],n.bindAll(this),this._timer=setInterval(this._onTimeUpdate,100)}t.TimeDispatch=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHandler=void 0;var n=r(3),i=r(5),r=(Object.defineProperty(a.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),a.prototype.dispose=function(){this._config.__internal.eventbus.off(n.InternalEvents.METADATA,this._onMetadata),this._config.__internal.eventbus.off(n.InternalEvents.VBR,this._onVbr),this.detach(),this.onMediaInfo=void 0,this.onHasKeyframe=void 0,this.onExtraData=void 0,this.onError=void 0,this._destroyed=!0},a.prototype.appendData=function(e){this._destroyed||"CFG"===e.flag&&this._updateMediaInfo(e.config)},a.prototype.attach=function(e){this._video=e},a.prototype.detach=function(){this._video=null},a.prototype.getStatInfo=function(){return{}},a.prototype.getBufferTime=function(){return 0},a.prototype.getCurrentTime=function(){return 0},a.prototype.getIsWaiting=function(){return!1},a.prototype._updateMediaInfo=function(e){"audio"===e.type&&(void 0!==e.dataRate&&(this._mediaInfo.audioDataRate=e.dataRate),this._mediaInfo.audioMimeType=e.mimeType),"video"===e.type&&(void 0!==e.dataRate&&(this._mediaInfo.videoDataRate=e.dataRate),this._mediaInfo.videoMimeType=e.mimeType,this._mediaInfo.fps=e.fps,this._mediaInfo.width=e.codecWidth,this._mediaInfo.height=e.codecHeight),this._mediaInfo.mimeType=[this._mediaInfo.audioMimeType,this._mediaInfo.videoMimeType].filter(function(e){return e}).join(","),this.onMediaInfo&&this.onMediaInfo(this._mediaInfo)},a.prototype.T_ADV_Timestamp=function(){return null},a.prototype._onExtraData=function(e){this.onExtraData&&this.onExtraData(e)},a.prototype._onMetadata=function(e){this._mediaInfo.metadata=e,this.onMediaInfo&&this.onMediaInfo(this._mediaInfo)},a.prototype._onVbr=function(e){var t=e.data,e=t.vbr,t=t.pts;this._onExtraData({type:"vbr",ts:t,data:e})},a);function a(e){this._destroyed=!1,this._mediaInfo={fps:0,width:100,height:100,audioMimeType:"",videoMimeType:"",audioDataRate:0,videoDataRate:0,mimeType:"",metadata:{}},this._config=e,i.bindAll(this),e.__internal.eventbus.on(n.InternalEvents.METADATA,this._onMetadata),e.__internal.eventbus.on(n.InternalEvents.VBR,this._onVbr)}t.MediaHandler=r},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ToMSE=void 0;var a,h=r(2),o=r(60),s=r(12),u=r(6),c=r(0),p=r(1),d=r(3),f=c.makeLogger("to-mse"),i=(a=s.MediaHandler,i(l,a),Object.defineProperty(l.prototype,"isPending",{get:function(){var e;return(null===(e=this._switchingSource)||void 0===e?void 0:e.pendingAppend)||0<this._pendingClearRanges.length||this._waitLockId},enumerable:!1,configurable:!0}),l.prototype.dispose=function(){if(a.prototype.dispose.call(this),this._mediaSource){if("closed"!==this._mediaSource.readyState)for(var e=this._mediaSource.sourceBuffers,t=0;t<e.length;t++){var r=e[t];try{this._mediaSource.removeSourceBuffer(r)}catch(e){f.warn("remove source buffer error: ",e)}r.removeEventListener("updateend",this._onUpdateend)}if("open"===this._mediaSource.readyState)try{this._mediaSource.endOfStream()}catch(e){f.warn("endOfStream error: ",e)}this._mediaSource.removeEventListener("sourceopen",this._appendBuffer),this._mediaSource=null}this._mediaSourceUrl&&(URL.revokeObjectURL(this._mediaSourceUrl),this._mediaSourceUrl=null),this._sourceBufferAdded={}},l.prototype.appendData=function(e){this._destroyed||(a.prototype.appendData.call(this,e),"EXTRA"!==e.flag?"RESET"!==e.flag?((this._tracks[e.trackId]||(this._tracks[e.trackId]=[])).push(e),this._switchingSource&&this._checkSwitchSource(e),this._isTracksReady||(this._isTracksReady=this._checkTracksReady()),this._isTracksReady&&this._appendBuffer(),e.isEnd&&this._onUpdateend()):this._reset(e.extradata,!0):this._reset(e.extradata,!1))},l.prototype.appendEnd=function(){if(!this._destroyed&&this._mediaSource&&"open"===this._mediaSource.readyState){for(var e=this._mediaSource.sourceBuffers,t=!1,r=0;r<e.length;r++)if(e[r].updating){t=!0;break}t||(this._mediaSource.endOfStream(),f.log("media end"))}},l.prototype.attach=function(e){a.prototype.attach.call(this,e),this._video.addEventListener("stalled",this._onStalled),this._video.addEventListener("progress",this._checkBufferGap),this._video.addEventListener("canplay",this._onCanplay),this._video.addEventListener("waiting",this._onWaiting),this._video.addEventListener("ended",this._onEnded),this._video.addEventListener("error",this._onMediaError),this._video.addEventListener("seeking",this._onSeeking),this._video.addEventListener("play",this._onPlay),this._mediaSourceUrl||((e=this._mediaSource=new MediaSource).addEventListener("sourceopen",this._appendBuffer),this._mediaSourceUrl=URL.createObjectURL(e)),this._video.src=this._mediaSourceUrl},l.prototype.detach=function(){this._video&&(this._video.removeEventListener("stalled",this._onStalled),this._video.removeEventListener("progress",this._checkBufferGap),this._video.removeEventListener("canplay",this._onCanplay),this._video.removeEventListener("waiting",this._onWaiting),this._video.removeEventListener("ended",this._onEnded),this._video.removeEventListener("error",this._onMediaError),this._video.removeEventListener("seeking",this._onSeeking),this._video.removeEventListener("play",this._onPlay),this._video.playbackRate=1,this._video.src="",this._video.removeAttribute("src"),this._video=null),this._removeBuffer.cancel(),clearInterval(this._checkStuckTimer),clearInterval(this._checkBufferTimer),clearInterval(this._timeLoopTimer),clearInterval(this._checkBufferGapTimer),a.prototype.detach.call(this)},l.prototype._appendBuffer=function(){var l=this;this._destroyed||!this._mediaSource||"closed"===this._mediaSource.readyState||this.isPending||Object.keys(this._tracks).some(function(e){for(var t=l._tracks[e],r=[],n=0,i=l._sourceBufferAdded[e];0<t.length&&n<262144;){var a,o,s,u,c=t[0];if(!i){var d=c.config.mimeType;if(!MediaSource.isTypeSupported(d))return l._onError(new h.DyMediaError("Unsupported MIME type or codec: "+d,h.ErrorIds.MediaUnsupportCodec)),!0;try{f.log("add source buffer "+c.trackId+": "+d),(i=l._mediaSource.addSourceBuffer(d)).addEventListener("updateend",l._onUpdateend),l._sourceBufferAdded[c.trackId]=i}catch(e){return l._onError(new h.DyMediaError("failed add more source buffer, length="+l._mediaSource.sourceBuffers.length+", readyState="+l._mediaSource.readyState+"\n"+e,h.ErrorIds.MediaAddSourceBufferError)),!0}return}if(!i||i.updating)return;c.isEnd&&!l._isLoadEnded&&(l._trackEndedFlag[c.trackId]=!0,c.trackLength===Object.keys(l._trackEndedFlag).length&&(l._isLoadEnded=!0)),c.extradata&&(a=(u=c.extradata).jumpOverTs,o=u.timeOffset,s=u.seiTimestamp,d=u.aacfil,u=u.sei,0<a&&(l._jumpOverList.push({start:c.pts/1e3,end:a/1e3}),f.warn("jumpover timestamp list changed: ",JSON.stringify(l._jumpOverList))),o&&-1!==o&&(i.timestampOffset=o/1e3,f.log("buffer time offset change: "+i.timestampOffset)),s&&(l.seiTimestamp=s),d&&l._onExtraData({type:"aacfil",ts:c.pts,data:d}),u&&l._onExtraData({type:"sei",ts:c.pts,data:u})),c.pts&&(l.preTimestamp=c.pts,l._switchingSource&&"video"===c.type&&(l._switchingSource.lastUpdateVideoTs=c.pts)),"video"===c.type&&c.isKeyframe&&(p.binsert(l._keyframes,c.pts/1e3),l.onHasKeyframe&&l.onHasKeyframe()),c.data&&0<c.data.byteLength&&(r.push(c.data),n+=c.data.byteLength),delete c.data,t.shift()}if(0<r.length)try{i.appendBuffer(p.bufferConcat(r))}catch(e){f.warn("append buffer error: ",e,l._video.error),22===e.code||l._onError(new h.DyMediaError("append buffer error: "+e+" "+l._video.error,h.ErrorIds.MediaAppendError))}})},l.prototype._removeBufferNow=function(){if(this._video&&!this._isPlayEnded&&!this._switchingSource)for(var i=this._video.currentTime,a=this._mediaSource.sourceBuffers,o=this,e=0;e<a.length;e++)!function(e){var t,r,n=a[e];n.updating||0<(t=n.buffered).length&&(t=t.start(0),i-t>o._config.videoBackTimeThreshold&&(r=i-o._config.videoBackTime,(r=o._searchNearestKeyframe(r)-1)&&5<r-t&&(f.debug("remove played sb["+e+"]: "+t+" --\x3e "+r),n.remove(Math.max(t-1,0),r),o._keyframes=o._keyframes.filter(function(e){return r<=e}))))}(e)},l.prototype._searchNearestKeyframe=function(e){var t=this._keyframes.length;if(0===t)return f.log("no keyframe info!"),e;if(!(e<this._keyframes[0]))for(var r=0;r<t;r++)if(e>=this._keyframes[r]&&(r===t-1||e<this._keyframes[r+1]))return this._keyframes[r]},l.prototype._onUpdateend=function(){0<this._pendingClearRanges.length&&this._clearBufferInternal(!0)||(this._switchingSource&&this._trySwitchSourceSmooth(),this._removeBuffer(),this._appendBuffer(),this._isLoadEnded&&this.appendEnd())},l.prototype._checkPlayStuck=function(){var e,t;!this._video||this._video.paused||!this._reachCanplay||this.isPending||this._isPlayEnded||(e=this._video.buffered,t=this._video.currentTime,this._lastPlayTime===t&&0<e.length&&e.end(e.length-1)>t+3&&(f.warn("player stuck, force move forward: "+t+" -> "+(t=t+1)),this._printBuffer(this._video.buffered),this._video.currentTime=t),this._lastPlayTime=this._video.currentTime)},l.prototype._checkBufferGap=function(){if(!(!this._video||!this._isWaiting||this._reachCanplay&&this._video.paused||this.isPending||this._isPlayEnded))for(var e=this._video.buffered,t=this._video.currentTime,r=0;r<e.length;r++){var n=e.start(r),i=e.end(r);if(t<n&&(!this._reachCanplay||1<i-n)){if(0<r&&2<e.end(r-1)-t)return;this._video.currentTime=n,f.log("jump over buffer gap "+(0<r?"["+e.start(r-1)+", "+e.end(r-1)+"], ["+e.start(r)+", "+e.end(r)+"]":"0, ["+e.start(r)+", "+e.end(r)+"]")+", "+t+" --\x3e "+n);break}}},l.prototype._checkBuffer=function(){var e,t,r,n;!this._video||(n=this._video.buffered)&&0<n.length&&(e=n.end(n.length-1)-this._video.currentTime,t=this._video.playbackRate,r=void 0,e<this._config.minBuffer?r=this._config.slowRate:e<this._config.maxBuffer?(n=(this._config.minBuffer+this._config.maxBuffer)/2,t<1&&n<e&&(r=1),1<t&&e<n&&(r=1)):r=this._config.fastRate,r&&r!==t&&(this._video.playbackRate=r,f.log("playback rate change to "+r)))},l.prototype._printBuffer=function(e){var t="buffer status: current = "+this._video.currentTime,r=e.length;t+=" buffered =";for(var n=0;n<r;n++)t+=" ["+e.start(n)+", "+e.end(n)+"]";f.log(t)},l.prototype._timeLoop=function(){this._switchingSource&&this._trySwitchSourceSmooth(),this._jumpOver()},l.prototype._jumpOver=function(){var e=this._jumpOverList.length;if(0<e&&this._video)for(var t=this._video.currentTime,r=this._jumpOverList.concat(),n=e-1;0<=n;n--){var i=r[n];if(t>=i.start&&t<i.end){var a=i.end+1;f.warn("Large gap detected, jump from "+t+" to "+a),this._video.currentTime=a,this._jumpOverList.splice(0,n+1);break}t>i.end&&this._jumpOverList.splice(n,1)}},l.prototype._onStalled=function(){},l.prototype._onWaiting=function(){this._isWaiting=!0,this._checkBufferGap()},l.prototype._onCanplay=function(){this._reachCanplay=!0,this._isWaiting=!1,this._video.removeEventListener("progress",this._checkBufferGap)},l.prototype._onEnded=function(){this._isPlayEnded=!0},l.prototype._onMediaError=function(){var e="Media Error";this._video&&this._video.error&&(e="code="+this._video.error.code+", message="+this._video.error.message+", url="+this._video.src),this._onError(new h.DyMediaError(e,h.ErrorIds.MediaError))},l.prototype._onError=function(e){this.onError&&this.onError(e)},l.prototype._checkTracksReady=function(){var t=this,e=Object.keys(this._tracks)[0];if(!e)return!1;var r=this._tracks[e];if(!r||0===r.length)return!1;e=r[0].trackLength,r=Object.keys(this._tracks).map(function(e){return t._tracks[e][0]}).map(function(e){return e&&e.config.mimeType}).filter(function(e){return e});return r.length!==e?(f.log("tracks not ready, trackLength="+e+", now we have ["+r.join(",")+"], waiting..."),!1):(f.log("tracks are ready, trackLength="+e+", now we have ["+r.join(",")+"]"),!0)},l.prototype.T_ADV_Timestamp=function(){if(this._video&&0!=this._video.buffered.length)return{bufferLength:this.getBufferTime(),ptsTimestamp:this.preTimestamp,seiTimestamp:this.seiTimestamp,keyframes:this._keyframes.concat()}},l.prototype.getBufferTime=function(){return this._video&&!this._video.seeking&&this._video.buffered.length?this._video.buffered.end(0)-this._video.currentTime:0},l.prototype.getCurrentTime=function(){return this._video?this._video.currentTime:0},l.prototype.getIsWaiting=function(){return this._isWaiting},l.prototype._onSeeking=function(){if(f.log("seeking to "+this._video.currentTime),this._isPlayEnded=this._video.ended,"live"!==this._config.mode){if(this._video)for(var e=this._video.buffered.length,t=this._video.currentTime,r=0;r<e;r++){var n=this._video.buffered.start(r),i=this._video.buffered.end(r);if(n-t<=.1&&t-i<=this._config.hls.seekThreshold)return}this._waitLockId=Date.now(),f.warn("put wait lock id="+this._waitLockId),this._config.__internal.eventbus.emit(d.InternalEvents.SEEK,{data:{seekTime:this._video.currentTime,waitLockId:this._waitLockId}})}},l.prototype._reset=function(e,t){var r,n=this;null!=e&&e.switchSource&&(this._switchingSource=e.switchSource,this._switchingSource.pendingAppend=!0),"seek"===(null==e?void 0:e.resetReason)&&(this._switchingSource&&(f.log("switch source success: smooth=false, because of seek."),this._printBuffer(this._video.buffered),this._config.__internal.eventbus.emit(d.InternalEvents.SWITCH_SOURCE_SUCCESS,{data:{smooth:!1,data:this._switchingSource.data}}),this._switchingSource=void 0),this._clearBufferRange(!1)),null!=e&&e.waitLockId&&e.waitLockId===this._waitLockId&&(this._waitLockId=0,f.warn("release wait lock id="+e.waitLockId)),t&&(this._isPlayEnded=!1,this._isLoadEnded=!1,this._trackEndedFlag={},this._jumpOverList=[],this._keyframes=[],(t=null===(t=this._switchingSource)||void 0===t?void 0:t._switchTime)?(r=1e3*(t+1),Object.keys(this._tracks).forEach(function(e){n._tracks[e]=n._tracks[e].filter(function(e){return e.dts<r})}),this._clearBufferRange(!0,[t+1,1/0])):this._tracks={},f.log("mse reset"))},l.prototype._onPlay=function(){this._isPlayEnded&&(this._video.currentTime=0,this._onSeeking())},l.prototype._checkSwitchSource=function(e){if(void 0===this._switchingSource.firstTs&&"video"===e.type&&u.isFrameTrack(e)){this._switchingSource.firstTs=e.pts;var t=this._switchingSource.firstTs/1e3,e=this._video.buffered;if(f.log("check switch source: current="+this._video.currentTime+", sourceStart="+t),this._printBuffer(e),e.length){e=e.end(0);if(1<t&&t>=this._video.currentTime-12&&t<=e+1&&!this._switchingSource.quick&&!this._video.paused)return f.warn("switch source smooth=true, current="+this._video.currentTime+", sourceStart="+t),this._switchingSource.smooth=!0,void(this._switchingSource.pendingAppend=!1)}f.warn("switch source smooth=false, current="+this._video.currentTime+", sourceStart="+t),this._switchingSource.smooth=!1,this._switchingSource.pendingAppend=!1,this._clearBufferRange(!1)}},l.prototype._trySwitchSourceSmooth=function(){if(!this._destroyed&&this._switchingSource&&!this.isPending)if(!0===this._switchingSource.smooth){var e=this._switchingSource.lastUpdateVideoTs>=1e3*this._video.currentTime;(e=void 0!==this._switchingSource._switchTime?e&&this._video.currentTime>=this._switchingSource._switchTime:e)&&(this._printBuffer(this._video.buffered),this._config.__internal.eventbus.emit(d.InternalEvents.SWITCH_SOURCE_SUCCESS,{data:{smooth:!0,data:this._switchingSource.data}}),this._switchingSource=void 0,f.log("switch source success: smooth=true"))}else if(!1===this._switchingSource.smooth){var t=this._video.buffered;if(0!==t.length){e=t.start(0),t=t.end(0);if(this._video.paused&&this._video.currentTime-e<20){if(t-this._video.currentTime<.5)return;this._video.currentTime=Math.max(this._video.currentTime,e)}else this._video.currentTime=e;this._printBuffer(this._video.buffered),this._config.__internal.eventbus.emit(d.InternalEvents.SWITCH_SOURCE_SUCCESS,{data:{smooth:!1,data:this._switchingSource.data}}),this._switchingSource=void 0,f.log("switch source success: smooth=false")}}},l.prototype._clearBufferInternal=function(e){var t=this;if((e=void 0===e?!1:e)&&this._clearingRange&&(this._clearingRange===this._pendingClearRanges[0]&&this._pendingClearRanges.shift(),this._clearingRange=void 0),0===this._pendingClearRanges.length)return!1;var r=Object.keys(this._sourceBufferAdded).map(function(e){return t._sourceBufferAdded[e]});if(!r.every(function(e){return!e.updating}))return!0;if(r.every(function(e){return!e.updating&&0===e.buffered.length}))return!(this._pendingClearRanges=[]);for(var n=!1,i=this;!n&&0<this._pendingClearRanges.length;)!function(){var t=i._pendingClearRanges[0];r.forEach(function(e){if(e.buffered.length)try{e.remove(t[0],t[1]),n=!0}catch(e){f.warn("clear buffer error, ignore this range: ["+t[0]+", "+t[1]+"]. "+e)}}),n?(i._clearingRange=t,f.log("buffer ["+t[0]+", "+t[1]+"] cleared.")):i._pendingClearRanges.shift()}();return n},l.prototype._clearBufferRange=function(e,t){void 0===t&&(t=[0,1/0]),e?this._pendingClearRanges.push(t):this._pendingClearRanges=[t],this._clearBufferInternal()},l);function l(e){e=a.call(this,e)||this;return e.preTimestamp=0,e._tracks={},e._sourceBufferAdded={},e._trackEndedFlag={},e._isLoadEnded=!1,e._isPlayEnded=!1,e._isWaiting=!0,e._reachCanplay=!1,e._jumpOverList=[],e._keyframes=[],e._isTracksReady=!1,e._lastPlayTime=-1,e._removeBuffer=o.throttle(e._removeBufferNow,1e3),e._pendingClearRanges=[],e._waitLockId=0,window.T_ADV_Timestamp=e.T_ADV_Timestamp,e._config.enableJitterBuffer&&(e._checkBufferTimer=setInterval(e._checkBuffer,1e3)),e._timeLoopTimer=setInterval(e._timeLoop,200),e._checkBufferGapTimer=setInterval(e._checkBufferGap,500),e._checkStuckTimer=setInterval(e._checkPlayStuck,2e3),e}t.ToMSE=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=void 0,t.throttle=function(r,n,i){var a,o,s,u,c=0;i=i||{};function d(){c=!1===i.leading?0:performance.now(),a=null,u=r.apply(o,s),a||(o=s=null)}function e(){var e=performance.now();c||!1!==i.leading||(c=e);var t=n-(e-c);return o=this,s=arguments,t<=0||n<t?(a&&(clearTimeout(a),a=null),c=e,u=r.apply(o,s),a||(o=s=null)):a||!1===i.trailing||(a=setTimeout(d,t)),u}return e.cancel=function(){clearTimeout(a),c=0,a=o=s=null},e}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToFile=void 0;var o,s=a(r(9)),a=r(12),u=r(1),i=(o=a.MediaHandler,i(c,o),c.prototype.dispose=function(){},c.prototype.appendData=function(e){"video"===e.type&&(this._byteArray.write(e.data),e.isEnd&&this.appendEnd())},c.prototype.appendEnd=function(){u.saveAs(new Blob([this._byteArray.buffer],{type:"octet/stream"}),"sample.mp4")},c.prototype.attach=function(e){},c.prototype.detach=function(){},c);function c(e){e=o.call(this,e)||this;return e._byteArray=new s.default,e}t.ToFile=i},function(e,t,r){e.exports=r(63)},function(e,t){e.exports=r("db265")}],a={},n.m=i,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13))},"1b396":function(e,t,r){"use strict";var i=r("d3043");e.exports=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(i("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},"1c1a3":function(e,t,o){"use strict";o.r(t),o.d(t,"getVideo",function(){return vr});var r={};o.r(r),o.d(r,"getData",function(){return z}),o.d(r,"setEnterPlay",function(){return Y}),o.d(r,"changeVolumeByKeyboard",function(){return X}),o.d(r,"setVideoReady",function(){return K}),o.d(r,"P2PRollback",function(){return J}),o.d(r,"udpateVidoReal",function(){return $}),o.d(r,"setByteCount",function(){return Z}),o.d(r,"changeVolume",function(){return Q}),o.d(r,"setPlay",function(){return ee}),o.d(r,"refeshplayerStreamNameAndStatus",function(){return te}),o.d(r,"refeshplayerSrc",function(){return re}),o.d(r,"refeshplayerisPlay",function(){return ne}),o.d(r,"refeshplayerisRollback",function(){return ie}),o.d(r,"refeshplayerP2p",function(){return ae}),o.d(r,"refeshplayerP2pData",function(){return oe}),o.d(r,"changeHaveShowVideoState",function(){return se}),o.d(r,"setPlayerError",function(){return ce}),o.d(r,"videoContentResize",function(){return me}),o.d(r,"checkAccelerator",function(){return _e}),o.d(r,"handleAcceleratorError",function(){return fe}),o.d(r,"openAcc",function(){return pe}),o.d(r,"switchToHwMode",function(){return he}),o.d(r,"upView",function(){return de}),o.d(r,"initData",function(){return le}),o.d(r,"changeisAudio",function(){return ue});var n={};o.r(n),o.d(n,"getData",function(){return Gt}),o.d(n,"loadVideo",function(){return zt}),o.d(n,"loadStream",function(){return Zt}),o.d(n,"streamDataHandle",function(){return qt}),o.d(n,"playStream",function(){return Yt}),o.d(n,"reloadVideo",function(){return rr}),o.d(n,"loadTicketStream",function(){return tr}),o.d(n,"initData",function(){return nr}),o.d(n,"httpClientLoadStremUrl",function(){return Qt}),o.d(n,"getIsOpenAutio",function(){return ir}),o.d(n,"lianmaireloadVideo",function(){return ar});var m=o("e55c4"),i=o("09565"),a=o("300f3"),s=o.n(a),g=o("366c1");function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var c,d=(u(l,c=i.EventEmitter),l.prototype.init=function(e){this.container=e},l.prototype.Uprops=function(e,t){this.props.key=t},l.prototype.destroy=function(){this.removeAllListeners(),this.container&&this.element&&this.container.contains(this.element)&&this.container.removeChild(this.element),this.element=null},l),b=o("4f033"),w=o("5e757"),v=o("3b42b");function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,c.call(this));return Object(g.bindAll)(t,l.prototype),Object(g.bindAll)(t),t.h5video=e,t.props=null,t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var p,f=(h(y,p=d),y.prototype.changeBg=function(e){this.yinpingBgUrl=e.img||"https://img.douyucdn.cn/data/yuba/admin/2020/10/13/202010131133549362659697832.png",this.updateURL()},y.prototype.init=function(r){var n=this;void 0===this.element&&(this.element=document.createElement("div"),this.element.className=s.a.bg,r.appendChild(this.element),this.element.style.display="none"),m.DataCenter.event.load().subscribe(function(){m.DataCenter.common.get("$DATA").subscribe(function(e){var t=0;e.room&&e.room.cate1_id&&(t=+e.room.cate1_id),(1==+Object(g.getPageData)("$ROOM.show_status")&&Object(w.b)().app.Status||20==+t)&&(20==+t&&(n.isYinping=!0),Object(g.setISinping)(20==+t),n.container=r,n.updateURL())})})},y.prototype.updateScale=function(){},y.prototype.updateURL=function(){var e=Object(b.j)(["app","roomInfo","isVertical"]),t=Object(b.j)(["app","roomInfo","coverSrc"]),r=Object(b.j)(["app","roomInfo","owner_avatar"]),n=Object(b.j)(["app","roomInfo","isDefaultAvatar"]),i=Object(b.j)(["app","roomInfo","defaultSrc"]);if(1===e||void 0!==Object(g.getPageData)("$ROOM.audioWEBBGIMG")){e=void 0;if(void 0!==Object(g.getPageData)("$ROOM.audioWEBBGIMG"))if(this.isYinping){if(!this.yinpingBgUrl)return this.rxACJObject||(this.rxACJObject=new v.a),void this.rxACJObject.MonitorData("bj_to_videoBg_change",this.changeBg);e=this.yinpingBgUrl}else e=Object(g.getPageData)("$ROOM.audioWEBBGIMG");else t?e=t:r&&0===n?e=r:i&&(e=i);e?(this.initDom(e),this.element&&"block"!==this.element.style.display&&(this.element.style.display="block")):this.element&&(this.element.style.display="none")}else this.element&&"block"===this.element.style.display&&(this.element.style.display="none")},y.prototype.initDom=function(e){this.element&&(this.element.className=s.a.bg+" "+(void 0===Object(g.getPageData)("$ROOM.audioWEBBGIMG")?s.a.yzBg:""),this.element.style.backgroundImage="url("+e+")")},y.prototype.destroy=function(e){2!==e&&p.prototype.destroy.call(this)},y),_=o("949dc"),E=o.n(_),t=o("a63b0"),T=o.n(t);function y(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,p.call(this));return e.id="videoBg",e.isYinping=!1,e.yinpingBgUrl="",e}var S={},O={},A=0,k=6e4,P=0,I=0,x=0,M=1,j=0,R=0,D=0,L=0;function C(){clearInterval(x),x=setInterval(function(){I=(new Date).valueOf(),B({ps:2})},k)}function B(e){var t={},r=[],n={},i={},a=O,o=a.type,s=a.surl,u=a.quality,c=a.st,d=a.vt,l=e.ps,h=e.watch_time,p=e.ltime,f=S,_=f.did,m=f.uid,y=void 0===m?0:m,v=f.ct,g=f.ver,b=void 0===g?0:g,w=f.rid,a=f.tid,e=f.refer,m=f.pt,g=f.r_type,f=f.env,f=void 0===f?1:f;i.r_type=g,i.vt=d,5===l&&(i.ltime=p),R&&(i.vpid=R),j&&(i.vid=j),D&&5===l&&(i.ctime=D),n.i=y||0,n.d=_||0,n.ct=v||0,n.ver=b||0,n.r=w||0,n.t=a||0,n.hc=k||0,n.m=c||0,n.st=o||0,n.ps=l||0,n.pt=m||0,n.sst="",n.surl=s||"",n.p=A||0,n.re=e||"",5===l&&(n.wt=h),n.lt=M||0,n.q=u||0,n.e=i,n.ot=(new Date).valueOf(),t.v="1.5",r.push(n),t.m=JSON.stringify(r),function(e){var t=e.url,r=e.data,e=e.type,n=E.a.CancelToken.source(),r={method:"post",headers:{"content-type":"application/x-www-form-urlencoded"},url:t,data:"string"==typeof r?r:T.a.stringify(r),responseType:e,cancelToken:n.token};"text"===e&&(r.transformResponse=void 0);r=E()(r).then(function(e){return e.data}).catch(function(e){throw E.a.isCancel(e),e});return Object.defineProperty(r,"abort",{get:function(){return n.cancel("request abort by user.")}}),r}({url:1===f?"https://dotbeats.douyucdn.cn/beats":"http://10.1.100.44:6999/beats",data:t,type:"text"}).then(function(e){e=JSON.parse(e);1===l&&e&&e.data&&0===e.error&&e.data.interval&&(k=e.data.interval),1===l&&C()}).catch(function(){1===l&&C()})}function U(e){P=(new Date).valueOf(),B({ps:1,ext:e})}function N(e){e=!(0<arguments.length&&void 0!==e)||e;clearInterval(x),P&&B({ps:5,watch_time:(new Date).valueOf()-P,ltime:0<I?(new Date).valueOf()-I:null}),I=P=0,k=6e4,e&&(A=0)}var H=(q.prototype.onReady=function(e){!function(){for(var e=S.ct,t=["0","1","2","3","4","5","6","7","8","9","q","w","e","r","t","y","u","i","o","p","a","s","d","f","g","h","j","k","l","z","x","c","v","b","n","m"],r="",n=0;n<6;n++)r+=t[parseInt(36*Math.random(),10)];A=e+"-"+r+parseInt((new Date).valueOf(),10)}(),O=e=e,L&&(O.vt=L,L=0),j&&(e=(e=A).substr(0,e.length-13),R=""+e+parseInt((new Date).valueOf(),10)+"-"+j),U()},q.prototype.onComplete=function(){N()},q.prototype.onError=function(){N()},q.prototype.onstop=function(){N()},q.prototype.dispose=function(){clearInterval(x)},q.prototype.setlt=function(e){M=e},q.prototype.setvt=function(e){e=e,O&&(O.vt=e),L=e},q.prototype.setvid=function(e){j=e},q.prototype.setvpid=function(e){R=e},q.prototype.setctime=function(e){D=e},q.prototype.getpid=function(){return A},q.prototype.sendps5=function(){N(!1)},q.prototype.sendps1=function(){U()},q),a=o("f8ab5"),F=o.n(a),V=o("82e48"),W=null,G={byteCount:0,haveShowVideo:!1,isAudio:!1,inpip:!1,inLiveBack:!1,inticket:!1,inpassword:!1,player:{isReady:!1,isPlay:!0,volume:Object(g.getIsHostlive)()?0:Object(V.b)(V.a.player_storage_volume,.5),getPlayTime:function(){return 0},getBuffered:function(){return 0},getPlayerStat:function(){return{}},videoWidth:0,vidoRealWidth:0,vidoRealHeight:0,videoHeight:0,videoAngle:0,src:"",starEnterH5Play:0,showFrameTimePoint:0,p2p:"",error:0,isRollback:!1,isPreload:!1,acceleratorRollback:!1,useH265:!0,accOpen:!1}};function q(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,q),S=e}function z(){return G}function Y(e){G.player.starEnterH5Play=e}function X(e){var t=Object(b.j)(["videoModule","player","volume"]);1==+e?t-=.1:t+=.1,G.player.volume=t=1<(t=t<0?0:t)?1:t,W&&W.refreshPlayer()}function K(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=e.getPlayTime,n=e.getBuffered,i=e.getPlayerStat;G.player.isReady=!0,G.player.isBuffering=!1,G.player.getPlayTime=r,G.player.getBuffered=n,G.player.getPlayerStat=i,G.player.videoWidth=e.getVideoWidth(),G.player.videoHeight=e.getVideoHeight(),W&&W.viewFresh(),0==+t&&Object(b.b)({id:"loading",action:"showLoading",data:[!1]})}function J(){Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{isRollback:!0}]})}function $(e,t){G.player.vidoRealWidth=e,G.player.vidoRealHeight=t}function Z(e){G.byteCount=e}function Q(e){G.player.volume=e,W&&W.refreshPlayer()}function ee(e,t){G.player.isPlay!==e&&(G.player.isPlay=e,W&&W.refreshPlayer(),e&&Object(b.b)({id:"LoadVideoNet",action:"reloadVideo",data:[{manual:t}]}))}function te(e,t){G.player.multiratesName=e,G.player.streamStatus=t}function re(e){var t=G.player.src;G.player.src=e,W&&t!==e&&W.SrcFresh()}function ne(e){G.player.isPlay=e,W&&W.refreshPlayer()}function ie(e){G.player.isRollback=e}function ae(e){G.player.p2p=e}function oe(e){for(var t in e)G.player[t]=e[t]}function se(){G.haveShowVideo=!0}function ue(e){G.isAudio=e}function ce(e){G.player.error=e}function de(e){W=e}function le(){G={byteCount:0,haveShowVideo:!1,player:{isReady:!1,isPlay:!0,volume:Object(g.getIsHostlive)()?0:Object(V.b)(V.a.player_storage_volume,.5),getPlayTime:function(){return 0},getBuffered:function(){return 0},getPlayerStat:function(){return{}},videoWidth:0,vidoRealWidth:0,vidoRealHeight:0,videoHeight:0,videoAngle:0,src:"",starEnterH5Play:0,showFrameTimePoint:0,p2p:"",error:0,isRollback:!1,isPreload:!1,acceleratorRollback:!1,accOpen:!1}}}function he(e){G.player.useH265=e,Object(g.isSupportAccelerator)()&&(G.player.acceleratorRollback=!1),Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{manual:!0}]})}function pe(){G.player.accOpen=!0}function fe(){G.player.acceleratorRollback=!0,Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{manual:!0}]})}function _e(e,t){void 0===e&&(e=Object(b.j)(["app","cdn"])),void 0===t&&(t=Object(b.j)(["app","rate"])),fetch("http://127.0.0.1:64646/probe?cdn="+e+"&rate="+t).then(function(e){200===e.status?Object(g.setSupportAccelerator)(!0):Object(g.setSupportAccelerator)(!1)}).catch(function(){Object(g.setSupportAccelerator)(!1)})}function me(e){var t=e.width,e=e.height;G.player.videoWidth=t,G.player.videoHeight=e,W&&W.viewFresh()}var ye=o("d30de"),ve=o("51bc5"),ge=o("d1a6f"),be=o("0fa6e");function we(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var Ee,_=(we(Te,Ee=i.EventEmitter),Te.prototype.attachMedia=function(e){this.video=e,this.video.ondurationchange=this.ondurationchange,this.video.onended=this.onended,this.video.onprogress=this.onprogress,this.video.onwaiting=this.onwaiting,this.video.onseeking=this.onseeking,this.video.onseeked=this.onseeked,this.video.oncanplay=this.oncanplay,this.video.addEventListener("resize",this.onresize)},Te.prototype.detachMedia=function(){this.removeAllListeners(),this.video=null},Te.prototype.removeAllListeners=function(e){Ee.prototype.removeAllListeners.call(this,e),this.video&&(this.video.ondurationchange=void 0,this.video.onended=void 0,this.video.onprogress=void 0,this.video.onwaiting=void 0,this.video.onseeking=void 0,this.video.onseeked=void 0,this.video.oncanplay=void 0,this.video=void 0)},Te.prototype.ondurationchange=function(){this.emit(lt.DURATION_CHANGE,this.video.duration)},Te.prototype.onended=function(){this.emit(lt.COMPLETE)},Te.prototype.onprogress=function(){this.emit(lt.BUFFER_PROGRESS)},Te.prototype.onwaiting=function(){this.emit(lt.BUFFER_EMPTY)},Te.prototype.oncanplay=function(){this.emit(lt.BUFFER_FULL),this.ready||(this.ready=!0,this.emit(lt.READY))},Te.prototype.onresize=function(){this.emit(lt.ON_RESIZE)},Te.prototype.onseeking=function(){},Te.prototype.onseeked=function(){},Te.prototype.onerror=function(){},Te.prototype.load=function(){},Te.prototype.play=function(){var e,t=this;!this.video||(e=this.video.play())&&e.catch(function(e){e=e.toString();-1===e.indexOf("play() failed because the user didn't interact with the document first")&&-1===e.indexOf("The play method is not allowed by the user agent or the platform in the current context, possibly because the user denied permission")||t.emit(lt.CANAUTO_PLAY)})},Te.prototype.pause=function(){this.video&&this.video.pause()},Te.prototype.seek=function(e){this.video&&this.ready&&(this.video.currentTime=e)},Te.prototype.dispose=function(){this.ready=!1,this.removeAllListeners(),this.detachMedia()},Te.prototype.volume=function(e){return"number"!=typeof e?this.video?this.video.volume:1:(this.video&&(this.video.volume=e),1)},Te.prototype.getPlayTime=function(){return this.video?this.video.currentTime:0},Te.prototype.getBuffered=function(){return this.video&&0<this.video.buffered.length?this.video.buffered.end(this.video.buffered.length-1):0},Te.prototype.getVideoWidth=function(){return this.video?this.video.videoWidth:0},Te.prototype.getVideoHeight=function(){return this.video?this.video.videoHeight:0},Te.prototype.getPlayerStat=function(){return{mediaInfo:this.mediaInfo,statInfo:this.statInfo}},Te.prototype._error=function(e){var t=this;Object(g.callLater)(function(){t.emit(lt.ERROR,e)})},Te);function Te(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Te);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,Ee.call(this));return r.tag="Player",r.ready=!1,r.src=e,r.options=t,Object(g.bindAll)(r,Te.prototype),Object(g.bindAll)(r),r}function Se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Oe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ae(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var ke,Pe,Ie,xe=(Ae(Ce,Ie=Error),Ce.NAME="P2PInitError",Ce),Me=(Ae(Le,Pe=Error),Le.NAME="P2PRollbackError",Le),je=(Ae(De,ke=Error),De.NAME="P2PStreamNotFound",De),Re=o("5675a");function De(){Se(this,De);for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=Oe(this,ke.call.apply(ke,[this].concat(t)));return n.name=De.NAME,n}function Le(){Se(this,Le);for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=Oe(this,Pe.call.apply(Pe,[this].concat(t)));return n.name=Le.NAME,n.eCode=1<t.length?t[1]:0,n}function Ce(){Se(this,Ce);for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=Oe(this,Ie.call.apply(Ie,[this].concat(t)));return n.name=Ce.NAME,n}function Be(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ue(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var Ne,He=(Ue(Fe,Ne=be.BaseLoader),Fe.prototype.load=function(t,e){var r=this;if(Ne.prototype.load.call(this,t,e),this.isSdkLoad){if(!window.QVBP2P){e="qq p2p sdk init error.";return ve.a.warn(e),void(this.onError&&this.onError(new xe(e)))}if(!window.QVBP2P.isSupported()){var n="qq p2p not support";return ve.a.warn(n),void(this.onError&&this.onError(new xe(n)))}window.qvbp2p&&(window.qvbp2p.destroy(),window.qvbp2p=null),window.qvbp2p=new window.QVBP2P({debug:Object(g.getIsDebug)()}),window.qvbp2p.listen(window.QVBP2P.ComEvents.STATE_CHANGE,this._onStateChange),window.qvbp2p.loadSource({videoId:ye.k,src:t}),this._url=t,this.report()}else{this.isSdkLoad=!0,this._beginGetSdkTime=(new Date).getTime();n=+Object(b.j)(["app","rid"]);4258555==n||78561==n?Object(g.runGlobalJs)({url:this.sdk}).then(function(){r.load(t),r._GetSdkTime=(new Date).getTime(),ge.a.emit(Re.h,{bt:r._beginGetSdkTime,et:r._GetSdkTime})}).catch(function(){r.load(t)}):o.e(2).then(o.t.bind(null,"f1e0e",7)).then(function(){r.load(t),r._GetSdkTime=(new Date).getTime(),ge.a.emit(Re.h,{bt:r._beginGetSdkTime,et:r._GetSdkTime})}).catch(function(e){ve.a.warn("qqv1.0.0 p2p sdk load error.",e),r.load(t)})}},Fe.prototype.report=function(){var e=this;this.reportTimer=setInterval(function(){e._sendTxllMsg(e._60scdnBytes,e._60sp2pBytes,e._url),e._60scdnBytes=0,e._60sp2pBytes=0},6e4)},Fe.prototype.dispose=function(){window.qvbp2p&&(window.qvbp2p.destroy(),window.qvbp2p=null),this.reportTimer&&clearInterval(this.reportTimer),Ne.prototype.dispose.call(this)},Fe.prototype.getStatistics=function(){var e,t;return window.qvbp2p&&window.qvbp2p.getStatistics&&(e=(t=window.qvbp2p.getStatistics()).cdnBytes,t=t.p2pReceiveBytes,this._cdnBytes+=e,this._p2pBytes+=t,this._60scdnBytes+=e,this._60sp2pBytes+=t),{loaderBytes:this._loaderBytes,cdnBytes:this._cdnBytes,p2pBytes:this._p2pBytes}},Fe.prototype._onStateChange=function(e,t){var r=window.QVBP2P.ComCodes;switch(t.code){case r.RECEIVE_BUFFER:this._receiveBuffer(t.payload);break;case r.ROLLBACK:this._rollback(t.player,t.rollbackReason);break;case r.END_OF_STREAM:this._onEnd();break;case r.STREAM_NOT_FOUND:this._streamNotFound()}},Fe.prototype._receiveBuffer=function(e){this._onData(e)},Fe.prototype._onEnd=function(){this.onEnd&&this.onEnd()},Fe.prototype._rollback=function(e,t){this.onError&&this.onError(new Me("p2p error, rollback.",t)),this.dispose()},Fe.prototype._streamNotFound=function(){this.onError&&this.onError(new je("p2p error, stream not found.")),this.dispose()},Fe.prototype._sendTxllMsg=function(e,t,r){var n=+Object(b.j)(["app","rid"]);2935323!=n&&7179465!=n&&52787!=n&&1409682!=n||m.httpClient.post(String,"https://p2plog.douyucdn.cn/tencentlogreport",{cdnBytes:e,p2pBytes:t,url:r,rid:n},{headers:{"content-type":"application/json"}})},Fe);function Fe(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Fe);for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return e=t=Be(this,Ne.call.apply(Ne,[this].concat(n))),t.sdk="https://xp2p-1255868781.file.myqcloud.com/xp2psdk/h5/douyu/qvbp2p.js",t.isSdkLoad=!1,t._cdnBytes=0,t._p2pBytes=0,t._beginGetSdkTime=0,t._GetSdkTime=0,t._60scdnBytes=0,t._60sp2pBytes=0,t._url="",Be(t,e)}function Ve(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function We(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var Ge,qe=(We(ze,Ge=be.BaseLoader),ze.prototype.load=function(t,e){var r=this;if(Ge.prototype.load.call(this,t,e),!this.isSdkLoad){var n=+Object(b.j)(["app","rid"]);return this.isSdkLoad=!0,this._beginGetSdkTime=(new Date).getTime(),void(122402==n||5551065==n||606118==n||1863767==n||5382830==n||4549169==n?Object(g.runGlobalJs)({url:this.sdk}).then(function(){r.load(t),r._GetSdkTime=(new Date).getTime(),ge.a.emit(Re.h,{bt:r._beginGetSdkTime,et:r._GetSdkTime})}).catch(function(e){ve.a.warn("ws sdk yuanduan load error.",e),r.load(t)}):o.e(5).then(o.t.bind(null,"dbdb7",7)).then(function(){r.load(t),r._GetSdkTime=(new Date).getTime(),ge.a.emit(Re.h,{bt:r._beginGetSdkTime,et:r._GetSdkTime})}).catch(function(){ve.a.warn("WS 3.0p2p sdk init error."),r.load(t)}))}if(!window.wshp2p){n="WS p2p sdk init error.";return ve.a.warn(n),void(this.onError&&this.onError(new xe(n)))}if(!window.wshp2p.isSupported()){var i="WS p2p not support";return ve.a.warn(i),void(this.onError&&this.onError(new xe(i)))}this.wshp2pload&&(this.wshp2pload.close(),this.wshp2pload=null);i={vedio:document.getElementById(ye.k),customid:"douyu.com",url:t};this.wshp2pload=new window.wshp2p.p2pLive,this.wshp2pload.rollback=this.rollbackHandle,this.wshp2pload.dataarrival=this.dataarrivalHandle,this.wshp2pload.open(i)},ze.prototype.dispose=function(){this.wshp2pload&&(this.wshp2pload.close(),this.wshp2pload=null),Ge.prototype.dispose.call(this)},ze.prototype.rollbackHandle=function(e){this._rollback(e)},ze.prototype.dataarrivalHandle=function(e){this._receiveBuffer(e)},ze.prototype.getStatistics=function(){var e,t;return this.wshp2pload&&(e=(t=this.wshp2pload.infoget()).http_bytesLoaded,t=t.p2p_bytesLoaded,this._cdnBytes+=e,this._p2pBytes+=t),{loaderBytes:this._loaderBytes,cdnBytes:this._cdnBytes,p2pBytes:this._p2pBytes}},ze.prototype._receiveBuffer=function(e){this._onData(e)},ze.prototype._rollback=function(e){this.onError&&this.onError(new Me("p2p error, rollback.",e)),this.dispose()},ze);function ze(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ze);for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return e=t=Ve(this,Ge.call.apply(Ge,[this].concat(n))),t.sdk="https://www.vod.lxdns.com/html5/douyu.com/whprelease.js",t.isSdkLoad=!1,t._cdnBytes=0,t._p2pBytes=0,t._beginGetSdkTime=0,t._GetSdkTime=0,Ve(t,e)}function Ye(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Xe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var Ke,Je=(Xe($e,Ke=be.BaseLoader),$e.prototype.load=function(e,t){var r=this;if(Ke.prototype.load.call(this,e,t),!this.isSdkLoad)return this.isSdkLoad=!0,this._beginGetSdkTime=(new Date).getTime(),void o.e(1).then(o.t.bind(null,"6b4b2",7)).then(function(){r.load(e),r._GetSdkTime=(new Date).getTime(),ge.a.emit(Re.h,{bt:r._beginGetSdkTime,et:r._GetSdkTime})}).catch(function(){ve.a.warn("XY p2p sdk init error."),r.load(e)});if(!window.KiwiJs){var n="XY p2p sdk init error.";return ve.a.warn(n),void(this.onError&&this.onError(new xe(n)))}if(!window.KiwiJs.isSupported()){n="XY p2p not support";return ve.a.warn(n),void(this.onError&&this.onError(new xe(n)))}this.xyp2pload&&(this.xyp2pload.destroy(),this.xyp2pload=null),this.xyp2pload=new window.KiwiJs({appid:"589ac3b89be5e8493fd1b336",secret:"MAdVFu",url:e,only_data:!0,media_id:ye.k,rollback:this.rollbackHandle,log_level:Object(g.getIsDebug)()?"debug":void 0}),this.xyp2pload.on("data",this.dataarrivalHandle),this.xyp2pload.on("reset",this.rollbackHandle),this.xyp2pload.play()},$e.prototype.dispose=function(){this.xyp2pload&&(this.xyp2pload.destroy(),this.xyp2pload=null),Ke.prototype.dispose.call(this)},$e.prototype.rollbackHandle=function(){this._rollback()},$e.prototype.dataarrivalHandle=function(e){this._receiveBuffer(e.buffer)},$e.prototype.getStatistics=function(){var e;return this.xyp2pload&&(e=this.xyp2pload.getStatistics(),this._cdnBytes+=e.cdnBytes,this._p2pBytes+=e.p2pBytes),{loaderBytes:this._loaderBytes,cdnBytes:this._cdnBytes,p2pBytes:this._p2pBytes}},$e.prototype._receiveBuffer=function(e){this._onData(e)},$e.prototype._rollback=function(){this.onError&&this.onError(new Me("p2p error, rollback.")),this.dispose()},$e);function $e(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,$e);for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return e=t=Ye(this,Ke.call.apply(Ke,[this].concat(n))),t.sdk="https://static.galaxyclouds.cn/0.0.1/kiwi.min.js",t.isSdkLoad=!1,t._cdnBytes=0,t._p2pBytes=0,t._beginGetSdkTime=0,t._GetSdkTime=0,Ye(t,e)}var Ze=(et.prototype.loadDynamicJs=function(e,t){var r=document.createElement("script");r.type="text/javascript",r.charset="UTF-8",-1===e.toLowerCase().indexOf("sta-op.douyucdn")&&-1===e.toLowerCase().indexOf("sta-op-test.douyucdn")||(r.crossOrigin="anonymous"),r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,t&&t())}:(r.onload=function(){t&&t()},r.onerror=function(e){t&&t(e)}),r.src=e,this.loader.appendChild(r)},new et),t=function(e,t,r){return t&&Qe(e.prototype,t),r&&Qe(e,r),e};function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function et(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,et),this.body=document.getElementsByTagName("body")[0],this.loader=document.createElement("div"),this.loader.setAttribute("data-module","loader"),this.loader.style.display="none",this.body.appendChild(this.loader)}function tt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var rt,nt=(tt(at,rt=be.BaseLoader),t(at,[{key:"supportRaw",get:function(){return this._useRawPlay}},{key:"format",get:function(){return this._useRawPlay?"raw":"flv"}}]),at.prototype.load=function(t,e){var r=this;rt.prototype.load.call(this,t,e);var n=Object(b.j)(["videoModule","player","p2pMeta"]),i=this._useXp2p?window.DyP2PX:window.DyP2P;if(i||this.isSdkLoad){if(!i){e="DY p2p sdk init error.";return ve.a.warn(e),void(this.onError&&this.onError(new xe(e)))}if(!i.isSupported()){var a="DY p2p not support";return ve.a.warn(a),void(this.onError&&this.onError(new xe(a)))}this.xyp2pload&&(this.xyp2pload.destroy(),this.xyp2pload=null);a=Object(b.j)(["videoModule","player","p2pCids"]);this.xyp2pload=new i({appid:"589ac3b89be5e8493fd1b336",secret:"MAdVFu",url:t,p2pCids:a,p2pMeta:n,only_data:!0,media_id:ye.k,rollback:this.rollbackHandle,log_level:Object(g.getIsDebug)()?"debug":void 0,logLevel:Object(g.getIsDebug)()?3:void 0}),this.xyp2pload.on("data",this.dataarrivalHandle),this.xyp2pload.on("reset",this.rollbackHandle),this.xyp2pload.play()}else{this.isSdkLoad=!0,this._beginGetSdkTime=(new Date).getTime();n=void 0,n=this._useXp2p?(ve.a.log("load dyp2pxp2p"),window.streamSdkXP2P):(ve.a.log("load dyp2pzl"),window.streamSdkZL);Ze.loadDynamicJs(n,function(e){e?(ve.a.warn("DY p2p sdk init error."),r.load(t)):(r.load(t),r._GetSdkTime=(new Date).getTime(),ge.a.emit(Re.h,{bt:r._beginGetSdkTime,et:r._GetSdkTime}))})}},at.prototype.dispose=function(){this.xyp2pload&&(this.xyp2pload.destroy(),this.xyp2pload=null),rt.prototype.dispose.call(this)},at.prototype.rollbackHandle=function(e,t){t&&(window.p2pComeBackinfo=t),this._rollback()},at.prototype.dataarrivalHandle=function(e){this._receiveBuffer(this._useRawPlay?e:e.buffer)},at.prototype.getStatistics=function(){var e;return this.xyp2pload&&(e=this.xyp2pload.getStatistics(),this._cdnBytes+=e.cdnBytes,this._p2pBytes+=e.p2pBytes,this._dropBytes=e.totalDropBytes||0),{loaderBytes:this._loaderBytes,cdnBytes:this._cdnBytes,p2pBytes:this._p2pBytes,totalDropBytes:this._dropBytes}},at.prototype._receiveBuffer=function(e){this._onData(e)},at.prototype._rollback=function(){this._onError(new Me("p2p error, rollback.")),this.dispose()},at),a=function(e,t,r){return t&&it(e.prototype,t),r&&it(e,r),e};function it(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function at(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,at);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,rt.call(this));e.isSdkLoad=!1,e._cdnBytes=0,e._p2pBytes=0,e._beginGetSdkTime=0,e._GetSdkTime=0,e._useXp2p=!1,e._useRawPlay=!1;var t=Object(b.j)(["videoModule","player","p2pMeta"]);return e._useXp2p=t&&t.xp2p_txSecret&&t.xp2p_txTime&&(t.xp2p_domain&&t.xp2p_subs_domain||t.dyxp2p_domain&&t.dyxp2p_subs_domain&&t.dyxp2p_api_domain),e._useRawPlay=Object(g.useRawPlay)()&&!e._useXp2p,e}function ot(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var st,ut=(ot(ct,st=_),ct.prototype._createPlayer=function(e){var r=this;this.dispose();var t={url:e,enableWorker:!0,debug:Object(g.getIsDebug)(),videoCodec:this.options.videoCodec,canvasId:this.options.canvasId,accelerator:this.options.accelerator};if(this.options){switch(this.options.p2p){case ye.g.QQ:t.loader=new He;break;case ye.g.WS:t.loader=new qe;break;case ye.g.XY:t.loader=new Je;break;case ye.g.DOUYU:var n=new nt;n.supportRaw&&(t.format="raw"),t.loader=n}void 0!==this.options.hasVideo&&(t.hasVideo=this.options.hasVideo),void 0!==this.options.hasAudio&&(t.hasAudio=this.options.hasAudio)}this.player=new be.LivePlayer(t),this.player&&(this.player.on(be.PlayerEvents.ON_LOW_PERFORMANCE,function(){r.emit(lt.ON_LOW_PERFORMANCEL)}),this.player.on(be.PlayerEvents.ON_MEDIA_INFO,function(e){ve.a.log("ON_MEDIA_INFO: ",e),r.mediaInfo=e}),this.player.on(be.PlayerEvents.ON_FIRST_FRAME,function(){r.emit(lt.FIRST_FRAME)}),this.player.on(be.PlayerEvents.ON_ERROR,function(e){r._error(e)}),this.player.on(be.PlayerEvents.ON_SEI,function(e){ve.a.log("ON_SEI: ",e),5===e.seiType&&"RoiMaskSeiV00001"===e.seiData.uuid&&Object(b.b)({id:"comment",action:"seiMcdatachange",data:[e.seiData.data]}),r.emit(lt.ON_SEI,e)}),this.player.on(be.PlayerEvents.ON_LOAD_SEI,function(e){r.emit(lt.ON_LOAD_SEI,e)}),this.player.on(be.PlayerEvents.ON_AAC_DATA,function(e){var t;ve.a.log("ON_AAC_DATA: ",e),16==+e.type?1e3<(t=Date.now())-(r.aacTimeFlag||0)&&(r.emit(lt.ON_AAC_DATA,e),r.aacTimeFlag=t):r.emit(lt.ON_AAC_DATA,e)}),this.player.on(be.PlayerEvents.ON_EXTRA_DATA_PLAY,function(e){r.emit(lt.ON_EXTRA_DATA_PLAY,e)}),this.player.on(be.PlayerEvents.ON_SWITCH_SUCCESS,function(e){r.emit(lt.ON_SWITCH_SUCCESS,e)}),this.player.on(be.PlayerEvents.ON_SWITCH_FAIL,function(e){r.emit(lt.ON_SWITCH_FAIL,e)}))},ct.prototype.attachMedia=function(e){st.prototype.attachMedia.call(this,e),this.player&&this.player.attach(e)},ct.prototype.detachMedia=function(){this.player&&this.player.detach(),st.prototype.detachMedia.call(this)},ct.prototype.load=function(){this.player&&this.player.load()},ct.prototype.dispose=function(){this.player&&(this.player.dispose(),this.player=null),st.prototype.dispose.call(this)},ct.prototype.updateSource=function(e){var t={};if(t.url=e.url,t.switch=e.switch,t.quick=e.quick,1===e.type)switch(e.p2p){case ye.g.QQ:t.loader=new He;break;case ye.g.WS:t.loader=new qe;break;case ye.g.XY:t.loader=new Je;break;case ye.g.DOUYU:var r=new nt;t.loader=r;break;default:t.loader=null}else t.loader=null;this.player&&this.player.updateSource(t)},a(ct,[{key:"statInfo",get:function(){return this.player&&this.player.getStatInfo()}}]),ct);function ct(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ct);t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,st.call(this,e,t));t.tag="FlvPlayer",t._createPlayer(e);e=(new Date).getTime();return ge.a.emit(Re.d,{sdkok:e}),t}function dt(e,t){return new ut(e,t)}var lt={ERROR:"ERROR",FIRST_FRAME:"FIRST_FRAME",READY:"READY",BUFFER_EMPTY:"BUFFER_EMPTY",BUFFER_FULL:"BUFFER_FULL",BUFFER_PROGRESS:"BUFFER_PROGRESS",COMPLETE:"COMPLETE",DURATION_CHANGE:"DURATION_CHANGE",CANAUTO_PLAY:"CANAUTO_PLAY",ON_SEI:"ON_SEI",ON_AAC_DATA:"ON_AAC_DATA",ON_RESIZE:"ON_RESIZE",ON_LOW_PERFORMANCEL:"ON_LOW_PERFORMANCE",ON_EXTRA_DATA_LOAD:"extra_data_load",ON_EXTRA_DATA_PLAY:"extra_data_play",ON_LOAD_SEI:"ON_LOAD_SEI",ON_SWITCH_SUCCESS:"ON_SWITCH_SUCCESS",ON_SWITCH_FAIL:"ON_SWITCH_FAIL"},ht=void 0,pt=0,ft=void 0,_t=3;function mt(e){var t=0<arguments.length&&void 0!==e&&e,e=Object(V.b)(V.a.GaoRateTimestamp,0);ht=ht||new Date;e=Object(g.isNextDay)(e,ht.valueOf(),19);return e&&t&&Object(V.c)(V.a.GaoRateTimestamp,ht.valueOf()),e}function yt(){pt+=1,Object(V.c)(V.a.RateRecordTime,pt),+pt==+_t&&(Object(b.b)({id:"multiBitRate",action:"ChangeRateNotify",data:[2]}),clearInterval(ft))}function vt(e){var t=Object(b.j)(["app","pageRateSwitch"]),r=Object(b.j)(["app","isLogin"]);return pt=parseInt(Object(V.b)(V.a.RateRecordTime,0),10),mt(e)?1==+t&&0==+r&&(e&&(clearInterval(ft),ft=setInterval(function(){yt()},6e4)),1):1==+t&&0==+r&&pt<_t&&(e&&(clearInterval(ft),ft=setInterval(function(){yt()},6e4)),1)}function gt(){clearInterval(ft)}var bt="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"mozHidden"in document?"mozHidden":null,wt=!1,t=void 0;function Et(){return bt&&document[bt]}function Tt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}bt&&(t=bt.replace(/hidden/i,"visibilitychange"),document.addEventListener(t,function(e){wt=wt||document[bt]},!1));var St,Ot=(Tt(kt,St=d),kt.prototype.init=function(e){St.prototype.init.call(this,e),this.videoContent=document.createElement("div"),this.videoContent.className=F.a.videoContainer,e.appendChild(this.videoContent),this.video=document.createElement("video"),this.video.className=F.a.video,this.video.id=this.videoId,this.videoContent.appendChild(this.video),this.canvas=document.createElement("canvas"),this.canvas.className=F.a.screenshot,this.videoContent.appendChild(this.canvas),this.canvas2=document.createElement("canvas"),this.canvas2.id=this.canvasId,this.canvas2.className=F.a.screenshot,this.videoContent.appendChild(this.canvas2),this.element=this.videoContent,this.videoContent.addEventListener("mouseover",this.onmouseover),this.videoContent.addEventListener("mouseleave",this.onmouseleave),this.videoContent.addEventListener("dblclick",this.ondblclick),Object(g.delayStreamWhilte)()&&(this.videoContent.style.visibility="hidden"),this.root=document.getElementsByClassName("layout-Player-videoMain")[0],this.viewFresh()},kt.prototype.SrcFresh=function(){G.player.src&&(this.lastst=this.currentSt,this.currentSt=Object(b.j)(["videoModule","player","p2p"]));var e,t=Object(b.j)(["videoModule","isAudio"]);!Object(g.getIsPlayAudio)()&&t?this.player&&(Object(g.setIsPlayAudio)(!0),this.currentSt=0,this.player.updateSource({type:2,url:G.player.src,switch:"smooth",p2p:0,quick:!1})):Object(g.getIsPlayAudio)()&&!t?this.player?(Object(g.setIsPlayAudio)(!1),e=Object(b.j)(["videoModule","player","p2p"]),this.player.updateSource({type:1,url:G.player.src,switch:"smooth",p2p:e,quick:!0})):(Object(g.setIsPlayAudio)(!1),this.createPlayer(G.player.src)):Object(g.getIsPlayAudio)()&&t?this.player&&(Object(g.setIsPlayAudio)(!0),this.currentSt=0,this.player.updateSource({type:2,url:G.player.src,switch:"smooth",p2p:0,quick:!0})):(Object(g.setIsPlayAudio)(!1),this.createPlayer(G.player.src)),this.refreshPlayer()},kt.prototype.actionHandle=function(e){var t=e.action,e=e.data;r&&r[t]&&r[t].apply(r,e)},kt.prototype.render=function(e){var t=e.id,r=e.action,e=e.data;t===this.id&&-1<this.actionList.indexOf(r)&&this.actionHandle({action:r,data:e})},kt.prototype.destroy=function(e){this.bufIndex=0,this.bufT=0,this.baseStreamDot&&(this.baseStreamDot.onComplete(),this.baseStreamDot.dispose()),1==+e&&(St.prototype.destroy.call(this),ge.a.off(Re.h,this.getsdkTime),ge.a.off(Re.d,this.beginLoadTimefun),this.firstReadVide=!0,ge.a.off("videoPairFrameCan",this.videoPairFrameCanHandle),ge.a.off("videoPairFrameOverErr",this.videoPairFrameOverErrHandle),ge.a.off("videoPairFrame10Over",this.videoPairFrame10Over),ge.a.off("diposeFirstVideo",this.diposeFirstVideoHandle)),this.disposeVr(),clearTimeout(this.PairFrameokID),clearTimeout(this.disposeTimer),clearInterval(this.bufferCheckTimer),clearInterval(this._byteAnotherTimerID),clearInterval(this.failTimeIndex),clearInterval(this.playTimeIndex),clearInterval(this.speedTencounts),this.stopHeartDot(),this.player&&(e={ps:6,rid:Object(b.j)(["app","rid"]),uid:Object(b.j)(["tcp","loginres","userid"]),b_cdn:this._byteCount,b_p2p:this._byteP2PCount,b_up:0,b_wst:0,kd_c:this.emptyCount,kd_t:this.totalEmptyTime,play_time:(new Date).getTime()-this.starTimePlayer,res:this.getRes()},this.reportStreamDot(e),this.player.dispose(),this.player=null),this._byteTmp=0,this._byteCount=0,this._byteP2PTmp=0,this._byteP2PCount=0,this.seiTimeList=[],this.isstartPlayer=!1,Object(b.b)({id:"videoModule",action:"setByteCount",data:[0]}),this.P2PtotalByteCount=0,this.P2PCurrentCount=0,this.inEmpty=!1,this.loopVodObj={t:0,e:0},this.StarEmptyTime=0,this.StarFullTime=0,this.totalEmptyTime=0,this.emptyCount=0,this.fullCount=0,this.hasNetStream=!1,this.showFrameTimePoint=0,this.speedArray=[],this.lastLoaderBytes=0,this.minuesUpBytes=0,this.minuesDownBytes=0,this.lastUpBytes=0,this.lastTimestamp=0,ve.a.log("video disposed.")},kt.prototype.createPlayer=function(e){var t=this;if(this.reportCarlton(),this.destroy(),clearTimeout(this.P2PRollbackId),e&&0===e.indexOf("rtmp"))return ve.a.warn("can't play "+e+", switch to flash player."),Object(g.switchToFlash)();if(this.canvas&&(this.canvas.style.visibility="hidden"),this.canvas2&&(this.canvas2.style.visibility="hidden"),e){var r=Object(b.j)(["videoModule","player","p2p"]),n=Object(b.j)(["app","streamInfo","isH265"]),i=Object(b.j)(["videoModule","player","acceleratorRollback"]),n=n?"h265":"h264";if(r?(ve.a.log("player init with p2p: "+r),this.hasP2PRollback=!1):ve.a.log("player init with no p2p"),this.player=dt(e,{p2p:r,hasVideo:!Object(g.getPageData)("$ROOM.audioWEBBGIMG")&&void 0,videoCodec:n,canvasId:this.canvasId,accelerator:{enable:Object(g.isSupportAccelerator)()&&!i,url:"ws://127.0.0.1:64646",byteRate:this.getByteRate()}}),this.player){this.video.src="",this.player.attachMedia(this.video),this.player.on(lt.FIRST_FRAME,this.onFirstFrame),this.player.on(lt.READY,this.onReady),this.player.on(lt.COMPLETE,this.onComplete),this.player.on(lt.DURATION_CHANGE,this.onDurationChange),this.player.on(lt.ERROR,this.onError),this.player.on(lt.ON_SEI,this.seiDateHandle),this.player.on(lt.ON_LOAD_SEI,this.seiloadSeiDateHandle),this.player.on(lt.ON_AAC_DATA,this.aacDataHandler),this.player.on(lt.ON_EXTRA_DATA_PLAY,this.extraPlayerDataHandler),this.player.on(lt.ON_LOW_PERFORMANCEL,this.lowPerformHandle),this.player.on(lt.ON_SWITCH_SUCCESS,this.switchSuccess),this.player.on(lt.ON_SWITCH_FAIL,this.switchFail),this.player.load();for(var i=(new Date).valueOf(),a="",o=0;o<4;o++)a+=parseInt(10*Math.random(),10);this.pid=a+i,this._byteAnotherTimerID&&clearInterval(this._byteAnotherTimerID),clearInterval(this.failTimeIndex),this.failTimeIndex=setInterval(function(){t.failStreamHander()},5e3),this.starTimePlayer=(new Date).getTime(),this._byteAnotherTimerID=setInterval(function(){t.getAnotherByteTimer()},6e4)}}return""!==e&&(!this.intOK&&Object(g.isVRPlayer)()?(window.loader.loadFile("https://sta-op.douyucdn.cn/front-publish/sdk-file-master/vrsdk_32b9147.js",function(){t.initVrPlayer()}),this.intOK=!0):this.intOK&&this.initVrPlayer()),null},kt.prototype.getByteRate=function(){var e=Object(b.j)(["app","multirates"])||[],t=Object(b.j)(["app","rate"]),e=e.find(function(e){return e.rate===t});if(e)return e.bit},kt.prototype.seiDateHandle=function(e){e&&5===e.seiType&&(e.seiData&&"CloudVideoStream"===e.seiData.uuid&&(this.seiTimeList.push(Date.now()-e.seiData.data),Object(b.a)("room_sei_data",e.seiData)),e.seiData&&"AdsCtrlSEIV00003"===e.seiData.uuid&&Object(b.a)("room_lolad_data",e.seiData))},kt.prototype.seiloadSeiDateHandle=function(e){e&&5===e.seiType&&e.seiData&&"CloudVideoStream"===e.seiData.uuid&&(0<(e=Date.now()-e.seiData.data)&&e<3e4&&(this.bufT=this.bufT+e,this.bufIndex=this.bufIndex+1))},kt.prototype.aacDataHandler=function(e){e&&(16!=+e.type||!e.data||!e.data.length||0<e.data.length)&&Object(b.a)("room_web_acc_data",e)},kt.prototype.extraPlayerDataHandler=function(e){Object(b.a)("extra_data_play",e)},kt.prototype.getMoudleDate=function(){return G},kt.prototype.refreshPlayer=function(){var e=Object(b.j)(["videoModule","player","volume"]),t=Object(b.j)(["videoModule","player","isPlay"]),r=Object(b.j)(["app","canAutoPlay"]),n=Object(b.j)(["xvideoModule","xplayer","openWichVideo"]);this.player&&(Object(g.delayStreamWhilte)()?!this.PairFrameok||n?this.player.volume(0):this.player.volume(parseFloat(e,10)):n?this.player.volume(0):this.player.volume(parseFloat(e,10)),t&&r?this.player.play():this.stop())},kt.prototype.onFirstFrame=function(){var e=this,t=Object(b.j)(["app","rid"]),r=Object(b.j)(["app","streamInfo","rtmp_live"]),n=Object(b.j)(["videoModule","player","p2p"]),i=Object(b.j)(["app","cdn"]),a=Object(b.j)(["app","isLogin"]),o=Object(b.j)(["app","pageRateSwitch"]),s=Object(b.j)(["app","rate"]),u=Object(b.j)(["app","uip"]),c=n===ye.g.QQ||"tct-h5"===i;Object(g.delayStreamWhilte)()&&this.player&&this.player.player&&this.player.player.T_ADV_Timestamp&&(window.T_ADV_Timestamp=this.player.player.T_ADV_Timestamp),Object(b.a)("room_video_replay",{rtmp_live:r,rid:t,hightligth:c,cdn:i,p2p:n}),this.showFrameTimePoint=(new Date).valueOf(),this.performancePoint(),this.refreshPlayer(),Object(b.b)({id:"videoModule",action:"setVideoReady",data:[this.player,1]}),Object(b.b)({id:"videoModule",action:"changeHaveShowVideoState"}),!1===Boolean(a)&&1==+o&&(vt()||Object(b.b)({id:"multiBitRate",action:"ChangeRateNotify",data:[1]})),1!=+s&&2!=+s&&vt(!0),this.hasNetStream=!0,clearInterval(this.failTimeIndex),this.playTimeIndex=setInterval(function(){e.playSucss()},3e3);s=new Date;this.lastTimestamp=s.getTime(),Object(g.setauthenticationTime)((new Date).valueOf()),n||this.streamReport({rid:t,ip:u,ret:0})},kt.prototype.countSpeed=function(){var e=Object(b.j)(["videoModule","player","getPlayerStat"])().statInfo.loaderBytes,t=0,r=(new Date).getTime(),n=r-this.lastTimestamp;this.lastLoaderBytes&&e>this.lastLoaderBytes&&(t=parseInt((e-this.lastLoaderBytes)/1024/(n/1e3),10)),this.speedArray.push(t),10<this.speedArray.length&&(this.speedArray=this.speedArray.slice(1)),this.lastLoaderBytes=e,this.lastTimestamp=r},kt.prototype.onReady=function(){var e=this;this.isstartPlayer=!0,null!=this.firstReadData&&(o=(new Date).valueOf(),this.firstReadData.canplay_matadate=o-this.showFrameTimePoint,Object(g.prfLoad)(this.firstReadData),this.firstReadData=null),this.player.on(lt.BUFFER_EMPTY,this.onBufferEmpty),this.player.on(lt.BUFFER_FULL,this.onBufferFull),this.player.on(lt.BUFFER_PROGRESS,this.onBufferProgress),this.player.on(lt.CANAUTO_PLAY,this.onCanAutoPlay),this.player.on(lt.ON_RESIZE,this.onVideoResize),this.refreshPlayer(),Object(b.b)({id:"videoModule",action:"setVideoReady",data:[this.player]}),setTimeout(function(){e.player&&Object(b.b)({id:"videoModule",action:"setVideoReady",data:[e.player]})},50),this.bufferCheckTimer=setInterval(this.checkBuffer,2e3),this.checkBuffer(),Object(g.notifyLoadjs)(),this.pairFrameHandel();var t=Object(b.j)(["app","rid"]);this.initStreamSubSdk&&(s=this.dataCollectToFlv(),this.initStreamSubSdk(t,s)),this.subNewInit(this.isstartPlayer,0);var r=Object(b.j)(["app","streamInfo","is_mixed"]),n=Object(b.j)(["videoModule","player","p2p"]),i=Object(b.j)(["app","streamInfo","mixed_url"]),a=Object(b.j)(["app","streamInfo","mixed_live"]),o=Object(b.j)(["app","streamInfo","rtmp_url"]),t=Object(b.j)(["app","streamInfo","rtmp_live"]),s=Object(b.j)(["app","cdn"]),u=Object(b.j)(["app","rate"]),c=Object(b.j)(["app","multirates"]),d=0;if(c&&0<c.length)for(var l=0;l<c.length;l++)if(+c[l].type==+u){d=c[l].bit||"0";break}var h=0;switch(n){case ye.g.QQ:h=2;break;case ye.g.WS:h=3;break;case ye.g.XY:h=1;break;case ye.g.DOUYU:h=9}s={type:h?2:1,surl:r?i+"/"+a:o+"/"+t,quality:d,st:h||s,vt:""};this.baseStreamDot||(this.baseStreamDot=new H({did:Object(v.e)(),uid:Object(g.getuid)(),ct:"web",pt:"2",ver:ye.h,rid:Object(b.j)(["app","rid"]),tid:Object(g.getPageData)("$ROOM.cate_id"),refer:window.location.href,env:1,r_type:Object(g.getPageData)("$ROOM.audioWEBBGIMG")?3:Object(g.getPageData)("$ROOM.isVertical")?2:1})),this.baseStreamDot.onReady(s),window.__playerDot={dot:this.baseStreamDot,parm:this.loopVodObj},this.haveaddListenerHide||(this.haveaddListenerHide=!0,this.addListenerHide())},kt.prototype.addListenerHide=function(){var t=this;window.addEventListener("beforeunload",function(){t.isunloading=!0}),document.addEventListener("visibilitychange",function(){var e;"hidden"===document.visibilityState&&(t.fgTimeEnd=parseInt(performance.now(),10),t.reportHiddenChange(),Object(g.isSuperHideGetAudio)()&&t.enterHide(),t.bgTimeStar=parseInt(performance.now(),10)),"visible"===document.visibilityState&&(t.fgTimeStar=parseInt(performance.now(),10),Object(g.setIsInHide)(!1),ge.a.off("loadAudioCd",t.loadAudioCdHandele),t.bgTimeEnd=parseInt(performance.now(),10),t.goReceptionDot(),t.loadAudioCdId&&clearTimeout(t.loadAudioCdId),e=Object(b.j)(["app","isenterUseNoHandle"]),Object(g.getIsPlayAudio)()&&!e&&(t.AudiochangeTime=(new Date).valueOf(),ve.a.warn("isnoLoading2-----"+!0),Object(b.b)({id:"LoadVideoNet",action:"reloadVideo",data:[{isnoLoading:!0}]})))})},kt.prototype.asyncImport=function(){var i=this;this.rxACJObject||(this.rxACJObject=new v.a),this.rxACJObject.MonitorData("set_first_frame_to_player",this.handlePlayerSub);var a=Object(b.j)(["app","rid"]);this.flvAsynTimer=setTimeout(function(){Promise.all([o.e(4),o.e(3)]).then(o.bind(null,"6b94d")).then(function(e){var t=e.initStreamSubSdk,r=e.setUiD,e=i.dataCollectToFlv();if(i.setUiD=r,t(a,e),i.initStreamSubSdk=t,0<i.subNewList.length)for(var n=0;n<i.subNewList.length;n++)window.streamSubSdkReport(i.subNewList[n])})},1e4)},kt.prototype.dataCollectToFlv=function(){var e=Object(b.j)(["app","streamInfo","is_mixed"]),t=Object(b.j)(["videoModule","player","p2p"]),r=Object(b.j)(["app","streamInfo","mixed_url"]),n=Object(b.j)(["app","streamInfo","mixed_live"]),i=Object(b.j)(["app","streamInfo","rtmp_url"]),a=Object(b.j)(["app","streamInfo","rtmp_live"]),o=Object(b.j)(["app","cdn"]),s=Object(b.j)(["app","acdn"]),u=Object(b.j)(["tcp","loginres","userid"]),c={},d=Object(v.e)(),l=0,h=Object(b.j)(["videoModule","player","getPlayerStat"]),p=Object(b.j)(["app","rate"]),f=Object(b.j)(["app","multirates"]),_=h().mediaInfo;if(f&&0<f.length)for(var m=0;m<f.length;m++)if(+f[m].type==+p){l=f[m].bit||"0";break}h=this.getRes();return this.throttleRes=h,c.zone=Object(g.getPageData)("$ROOM.cate_id"),c.rid=Object(b.j)(["app","rid"]),c.res=h,c.lt=1,c.pt=ye.i,c.pv=ye.h,c.cv=ye.h,c.p2p=Object(b.j)(["videoModule","player","p2pValue"]),c.st=t?2:1,c.surl=e?r+"/"+n:i+"/"+a,c.zone=Object(g.getPageData)("$ROOM.cate_id"),c.s_cdn=Object(g.getIsPlayAudio)()?s:o,c.uid=u,c.vt=Object(g.getPageData)("$ROOM.audioWEBBGIMG")||Object(g.getIsPlayAudio)()?1:2,c.mix=e?1:0,c.vdecode=Object(b.j)(["app","streamInfo","isH265"])?2:1,c.fps=_?parseInt(_.fps,10):"",c.did=d,c.bit=l,c},kt.prototype.handlePlayerSub=function(e){window.streamSubSdkReport?window.streamSubSdkReport(e.data):100<this.subNewList.length?this.subNewList.shift():this.subNewList.push(e.data)},kt.prototype.pairFrameHandel=function(){Object(g.delayStreamWhilte)()&&Object(g.setAuthenticationPlayer)(this.player.player)},kt.prototype.checkBuffer=function(){var e,t,r,n;this.video&&0<this.video.buffered.length&&(e=this.video.buffered,t=this.video.currentTime,n=e.length,30<(r=e.end(n-1))-t&&(n=e.start(n-1),n=Math.max(n,r-8),ve.a.warn("buffer too much, seek to "+n+". cur="+t+" buffered="+r),this.video.currentTime=n))},kt.prototype.videoPairFrame10Over=function(e){1===e&&(this.videoContent.style.visibility="",this.PairFrameok=!0,this.refreshPlayer())},kt.prototype.diposeFirstVideoHandle=function(){this.player&&this.player.pause(),this.destroy()},kt.prototype.videoPairFrameCanHandle=function(e){var t=this;this.video.currentTime=e.time,this.PairFrameokID=setTimeout(function(){t.videoContent.style.visibility="",t.PairFrameok=!0,t.refreshPlayer(),ge.a.emit("embedmentPlayerdispose")},50)},kt.prototype.videoPairFrameOverErrHandle=function(e){1!==e.type&&4!==e.type||(this.videoContent.style.visibility="",this.PairFrameok=!0,this.refreshPlayer(),ge.a.emit("embedmentPlayerdispose")),-1===e.type&&this.destroy()},kt.prototype.onCanAutoPlay=function(){this.baseStreamDot&&this.baseStreamDot.onError(),Object(b.a)("room_yuba_sdk_streamErr",{code:1}),Object(b.b)({id:"app",action:"setAutoPlay",data:[!1]}),ge.a.emit("embedmentPlayerdispose")},kt.prototype.onComplete=function(){var e=Object(b.j)(["app","cdn"]),t=Object(b.j)(["videoModule","player","src"]),r=Object(b.j)(["videoModule","player","p2p"]),n=Object(b.j)(["app","uip"]);Object(b.c)("video",Re.b,{delta:this.player.getBuffered()-this.player.getPlayTime(),playTime:this.player.getPlayTime(),emptyCount:this.emptyCount,fullCount:this.fullCount,browser:navigator.userAgent,location:window.location.href,cdn:e,p2p:r,uip:n,src:t}),this.stop(),ve.a.log("play complete")},kt.prototype.onBufferEmpty=function(){var e,t,r,n;this.video.seeking||(Object(b.b)({id:"controller",action:"setKDShow",data:[!0]}),e=Object(b.j)(["app","cdn"]),t=Object(b.j)(["videoModule","player","src"]),r=Object(b.j)(["videoModule","player","p2p"]),n=Object(b.j)(["app","uip"]),Object(b.c)("video",Re.a,{seeking:this.video.seeking,readyState:this.video.readyState,delta:this.player.getBuffered()-this.player.getPlayTime(),buffered:this.player.getBuffered(),playTime:this.player.getPlayTime(),bufferLength:this.video.buffered.length,emptyCount:this.emptyCount,fullCount:this.fullCount,browser:navigator.userAgent,cdn:e,p2p:r,uip:n,src:t,speedArray:this.speedArray}),this.player.getBuffered()-this.player.getPlayTime()<1&&(this.emptyCount+=1,this.inEmpty=!0,this.StarEmptyTime=(new Date).valueOf(),this.loopVodObj.e=(new Date).valueOf()),ve.a.log("buffer empty"))},kt.prototype.onBufferFull=function(){this.fullCount+=1,this.inEmpty&&(this.totalEmptyTime=this.totalEmptyTime+(new Date).valueOf()-this.StarEmptyTime,this.loopVodObj.t=this.loopVodObj.t+(new Date).valueOf()-this.loopVodObj.e),this.inEmpty=!1,ve.a.log("buffer full")},kt.prototype.onVideoResize=function(){ve.a.log("video resize videoWidth is "+this.player.getVideoWidth()+", videoHeight is "+this.player.getVideoHeight()),Object(b.b)({id:"videoModule",action:"videoContentResize",data:[{width:this.player.getVideoWidth(),height:this.player.getVideoHeight()}]})},kt.prototype.onBufferProgress=function(){},kt.prototype.onDurationChange=function(){},kt.prototype.getManValue=function(e){var t=Object(b.j)(["videoModule","player","p2p"]),r=Object(b.j)(["videoModule","player","p2pValue"]);if(t){if(9===r)return 6;if(1===r)return 4;if(2===r)return 2;if(3===r)return 1;if(4===r)return 3}else{if(-1!==e.indexOf("tct"))return 2;if(-1!==e.indexOf("ws"))return 1;if(-1!==e.indexOf("ali"))return 3}return-1},kt.prototype.streamReport=function(e){m.httpClient.post(String,"//streamdot.douyucdn.cn/tianshu/access/gate/report/100",{data:JSON.stringify(e)},{headers:{"Content-Type":"text/plain; charset=utf-8"},noXReq:!0})},kt.prototype.subStreamErrorbyType=function(e){var t,r,n,i,a,o,s,u,c,d,l,h;this.isstartPlayer?(t=Object(b.j)(["app","rid"]),r=Object(b.j)(["app","streamInfo","is_mixed"]),n=Object(b.j)(["app","streamInfo","mixed_url"]),i=Object(b.j)(["app","streamInfo","mixed_live"]),a=Object(b.j)(["app","streamInfo","rtmp_url"]),o=Object(b.j)(["app","streamInfo","rtmp_live"]),s=Object(b.j)(["videoModule","player","isPreload"]),u=Object(b.j)(["videoModule","player","p2pValue"]),c=Object(b.j)(["tcp","loginres","userid"]),d=Object(b.j)(["videoModule","player","p2p"]),h=Object(b.j)(["app","cdn"]),l=Object(b.j)(["app","acdn"]),h={ps:2,net:1,rid:t,vt:Object(g.getPageData)("$ROOM.audioWEBBGIMG")||Object(g.getIsPlayAudio)()?1:2,mix:r?1:0,surl:r?n+"/"+i:a+"/"+o,res:this.getRes(),lt:1,ec:e,d_ec:0,is_err:1,is_ma:s?1:0,is_b:this.hasP2PRollback?1:0,pv:ye.h,cv:ye.h,p2p:u,uid:c,st:d?2:1,wtype:this.getWtype(),s_cdn:Object(g.getIsPlayAudio)()?l:h,zone:Object(g.getPageData)("$ROOM.cate_id"),et:2},this.reportStreamDot(h)):this.subNewInit(this.isstartPlayer,e)},kt.prototype.lowPerformHandle=function(){Object(g.setH265BackLocastorege)(),Object(b.b)({id:"LoadVideoNet",action:"reloadVideo",data:[{manual:!0}]})},kt.prototype.switchSuccess=function(){Object(g.getIsPlayAudio)()?(this.audioStarTime=(new Date).valueOf(),this.startHeartDot()):this.stopHeartDot(),Object(b.b)({id:"loading",action:"showLoading",data:[!1]}),this.audioDot(0)},kt.prototype.switchFail=function(){Object(g.getIsPlayAudio)()&&(this.audioStarTime=(new Date).valueOf()),this.stopHeartDot(),Object(b.b)({id:"loading",action:"showLoading",data:[!0]}),this.audioDot(1)},kt.prototype.onError=function(e){var t=this;if(e&&e.fatal){this.baseStreamDot&&this.baseStreamDot.onError(),Object(g.notifyLoadjs)(),clearInterval(this.failTimeIndex);var r=3,n=Object(b.j)(["yzView","isYanzhi"]),i=Object(b.j)(["app","cdn"]),a=Object(b.j)(["videoModule","player","src"]),o=Object(b.j)(["videoModule","player","p2p"]),s=Object(b.j)(["app","uip"]),u=Object(b.j)(["app","rid"]);if(e instanceof Error)switch(e.name){case xe.NAME:case Me.NAME:this.initError=e.name===xe.NAME,this.hasP2PRollback=!0;var c=e.name===xe.NAME?1:2,c={playstate:4,enum:this.emptyCount,fnum:this.fullCount,error:e.message,eCode:e.eCode,us:c};ve.a.warn("p2p error, rollback",e.name),this.DataHandle(c),this.firstReadVide?this.p2pRollback():(clearTimeout(this.P2PRollbackId),this.P2PRollbackId=setTimeout(function(){t.p2pRollback()},5e3*Math.random())),this.stop();var d=Object(b.j)(["videoModule","player","p2pValue"]);return 9!==d&&10!==d||e.name===xe.NAME||(clearTimeout(this.P2Pfresh),l=12e5,c=18e5,window.p2pComeBackinfo&&(l=window.p2pComeBackinfo.minComeBackms,c=window.p2pComeBackinfo.maxComeBackms),this.P2Pfresh=setTimeout(function(){""!==Object(b.j)(["videoModule","player","p2p"])||9!==d&&10!==d||(Object(b.b)({id:"LoadVideoNet",action:"reloadVideo",data:[{manual:!0}]}),m.httpClient.post(String,"https://p2perrorlog.douyucdn.cn/errorlogreport",{rid:u,errortype:"refreshZjP2p"},{headers:{"content-type":"application/json"}}))},Math.random()*(c-l)+l)),void this.subStreamErrorbyType(201);case"DyNetworkError":var l={playstate:3,enum:this.emptyCount,fnum:this.fullCount,error:e.message,error_num:1};this.DataHandle(l),r=1,this.subStreamErrorbyType(202),this.streamReport({rid:u,ip:s,ret:1});break;case"DyMediaError":var h={playstate:3,error:e.message,error_num:100,spec_error:180};5===Object(g.getPageData)("$ROOM.cate_id")&&this.DataHandle(h),this.subStreamErrorbyType(203);break;case"DyDemuxError":h={playstate:3,error:e.message,error_num:100,spec_error:e.errorId||0};5===Object(g.getPageData)("$ROOM.cate_id")&&this.DataHandle(h),this.subStreamErrorbyType(204);break;case je.NAME:break;case"DyError":133!==e.errorId&&132!==e.errorId||Object(b.b)({id:"videoModule",action:"handleAcceleratorError"})}Object(b.c)("video",Re.c,{errorType:r,error:e.message,playTime:this.player.getPlayTime(),browser:navigator.userAgent,isYanzhi:n,location:window.location.href,cdn:i,p2p:o,uip:s,src:a}),Object(g.delayStreamWhilte)()?e.name===xe.NAME&&e.name===Me.NAME||(0===Object(g.getInPairFrameState)()?(Object(g.closeVideoPairFrame)(2,5),ge.a.emit("embedmentPlayerdispose")):1===Object(g.getInPairFrameState)()?Object(g.closeVideoPairFrame)(2,5):2!==Object(g.getInPairFrameState)()&&3!==Object(g.getInPairFrameState)()||(Object(b.b)({id:"videoModule",action:"setPlayerError",data:[r]}),Object(g.closeVideoPairFrame)(2,5))):Object(b.b)({id:"videoModule",action:"setPlayerError",data:[r]}),this.stop(),ve.a.warn("player error",e)}},kt.prototype.p2pRollback=function(){Object(b.b)({id:"videoModule",action:"P2PRollback"})},kt.prototype.ondblclick=function(){var e=Object(b.j)(["app","isFullscreen"]),t=Object(b.j)(["app","isWebFullscreen"]);e||t?(e&&Object(b.b)({id:"app",action:"setFullScreen",data:[!1]}),t&&Object(b.b)({id:"app",action:"setPagescreen",data:[!1]})):Object(b.b)({id:"app",action:"setPagescreen",data:[!0]})},kt.prototype.getsdkTime=function(e){e&&(this.startsdkTimevalue=e.bt,this.getsdkTimevalue=e.et)},kt.prototype.beginLoadTimefun=function(e){e&&(this.beginloadTime=e.sdkok)},kt.prototype.loadAudioCdHandele=function(e){var t=this;ge.a.off("loadAudioCd",this.loadAudioCdHandele),clearTimeout(this.loadAudioCdId),(this.hideGetAudio=e)?(this.jieliucd=e.ct||0,this.sg=e.sg||""):this.sg="",1==+e.switch&&(this.loadAudioCdId=setTimeout(function(){Object(g.isSuperHideGetAudio)()&&(t.player&&t.player.statInfo&&(t.bandwidth=parseInt(60*t.player.statInfo.vbr/8,10)||0),ve.a.warn("isnoLoading3-----"+!0),Object(b.b)({id:"LoadVideoNet",action:"reloadVideo",data:[{isaudio:!0,isnoLoading:!0}]}))},1e3*e.st||1))},kt.prototype.enterHide=function(){var e=this;Object(g.setIsInHide)(!0);var t,r,n,i=(new Date).valueOf();i-this.lastGetJieliuConfigTime>=1e3*this.jieliucd?(this.lastGetJieliuConfigTime=i,ge.a.on("loadAudioCd",this.loadAudioCdHandele),this.player&&(t=(r=this.player.statInfo).loaderBytes,r=r.uploadBytes,n=[i-this.enttime,t?r/t:0,this.minuesDownBytes?this.minuesUpBytes/this.minuesDownBytes:0],setTimeout(function(){!1===e.isunloading&&Object(b.b)({id:"LoadVideoNet",action:"getIsOpenAutio",data:n})},100))):this.hideGetAudio&&1==+this.hideGetAudio.switch&&(clearTimeout(this.loadAudioCdId),this.loadAudioCdId=setTimeout(function(){Object(g.isSuperHideGetAudio)()&&(ve.a.warn("isnoLoading4-----"+!0),e.player&&e.player.statInfo&&(e.bandwidth=parseInt(60*e.player.statInfo.vbr/8,10)||0),Object(b.b)({id:"LoadVideoNet",action:"reloadVideo",data:[{isaudio:!0,isnoLoading:!0}]}))},1e3*this.hideGetAudio.st))},kt.prototype.componentDidMount=function(){ve.a.log("start loadVideo")},kt.prototype.componentWillUnmount=function(){St.prototype.componentWillUnmount.call(this),this.firstReadVide=!0,clearInterval(this._byteAnotherTimerID),clearInterval(this.failTimeIndex),clearTimeout(this.P2PRollbackId),clearTimeout(this.P2Pfresh),clearTimeout(this.flvAsynTimer),this.stopHeartDot(),this.destroy()},kt.prototype.onmouseover=function(){Object(b.b)({id:"xvideoModule",action:"showmusicIconfun",data:[!0]})},kt.prototype.onmouseleave=function(){Object(b.b)({id:"xvideoModule",action:"showmusicIconfun",data:[!1]})},kt.prototype.viewFresh=function(){var e,t=Object(b.j)(["app","width"]),r=Object(b.j)(["app","height"]),n=Object(b.j)(["app","isFullscreen"]),i=Object(b.j)(["app","isWebFullscreen"]),a=Object(b.j)(["app","playbModel"]),o=Object(b.j)(["videoModule","player","videoWidth"]),s=Object(b.j)(["videoModule","player","videoHeight"]),u=void 0;r-=n||i||!a?0:ye.e,0===o||0===s?(u={width:t,height:r},this.videoRealWidth=t,this.videoRealHeight=r):(e=1,a=i=n=c=0,s/o<=r/t?(c=s*(e=(n=t)/o),a=.5*r-s*e*.5):(n=o*(e=(c=r)/s),i=.5*t-o*e*.5),u={width:n,height:c,left:i,top:a},this.videoRealWidth=n,this.videoRealHeight=c);var c={width:u.width+"px",height:u.height+"px"};Object.assign(this.video.style,c),Object.assign(this.canvas.style,c),Object.assign(this.canvas2.style,c),this.videoRealWidth&&this.videoRealHeight&&Object(b.b)({id:"videoModule",action:"udpateVidoReal",data:[this.videoRealWidth,this.videoRealHeight]}),this.onWindowResize(u.width,u.height)},kt.prototype.stop=function(){var e=this;if(this.onstop&&this.baseStreamDot.onError(),Object(b.j)(["app","streamInfo","isH265"]))this.destroy();else{if(this.player&&this.canvas&&this.video&&this.videoRealWidth&&this.videoRealHeight){this.player.pause(),this.canvas.width=this.videoRealWidth,this.canvas.height=this.videoRealHeight;var t=this.canvas.getContext("2d");try{Object(g.isVRPlayer)()&&this.renderer&&this.renderer.domElement?t.drawImage(this.renderer.domElement,0,0,this.videoRealWidth,this.videoRealHeight):t.drawImage(this.video,0,0,this.videoRealWidth,this.videoRealHeight)}catch(e){ve.a.log("截图失败")}this.canvas.style.visibility=""}Et()?this.destroy():(clearTimeout(this.disposeTimer),this.disposeTimer=setTimeout(function(){e.destroy()},20))}},kt.prototype.getRateInt=function(e){if(!e)return 0;var t=0;return"极清4K"===e?t=11:"极清2K"===e?t=10:"4K"===e?t=9:"原始画面"===e||-1<e.indexOf("原画")?t=8:"蓝光10M"===e?t=7:"蓝光8M"===e?t=6:"蓝光4M"===e?t=5:"蓝光"===e?t=4:"超清"===e?t=3:"高清"===e?t=2:"流畅"===e&&(t=1),t},kt.prototype.subNewInit=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=Object(b.j)(["app","rid"]),n=Object(b.j)(["app","streamInfo","rtmp_url"]),i=Object(b.j)(["app","streamInfo","rtmp_live"]),a=Object(b.j)(["videoModule","player","p2pValue"]),o=Object(b.j)(["app","streamInfo","is_mixed"]),s=Object(b.j)(["videoModule","player","p2p"]),u=Object(b.j)(["videoModule","player","isPreload"]),c=Object(b.j)(["app","cdn"]),d=Object(b.j)(["app","acdn"]),l=Object(b.j)(["tcp","loginres","userid"]),h=Object(b.j)(["app","streamInfo","mixed_url"]),p=Object(b.j)(["app","streamInfo","mixed_live"]),f=0;0!==t&&e?f=2:0===t||e||(f=1);f={ps:2,net:1,rid:r,vt:Object(g.getPageData)("$ROOM.audioWEBBGIMG")||Object(g.getIsPlayAudio)()?1:2,mix:o?1:0,surl:o?h+"/"+p:n+"/"+i,res:this.getRes(),lt:1,ec:t,d_ec:0,is_err:e&&0===t?0:1,is_ma:u?1:0,is_b:this.hasP2PRollback?1:0,pv:ye.h,cv:ye.h,p2p:a,uid:l,st:s?2:1,wtype:this.getWtype(),s_cdn:Object(g.getIsPlayAudio)()?d:c,zone:Object(g.getPageData)("$ROOM.cate_id"),et:f};this.reportStreamDot(f)},kt.prototype.getAnotherByteTimer=function(){var e;!this.player||(e=this.player.statInfo)&&(a=e.cdnBytes,r=e.p2pBytes,t=e.loaderBytes,n=e.uploadBytes,this._byteCount=a-this._byteTmp,this._byteTmp=a,this._byteP2PCount=r-this._byteP2PTmp,this._byteP2PTmp=r,this.P2PCurrentCount=t-this.P2PtotalByteCount,this.minuesDownBytes=t-this.P2PtotalByteCount,this.P2PtotalByteCount=t,this.minuesUpBytes=n-this.lastUpBytes,this.lastUpBytes=n),this._byteCount<0&&(this._byteCount=0),this._byteP2PCount<0&&(this._byteP2PCount=0),this.P2PCurrentCount<0&&(this.P2PCurrentCount=0);var t,r,n,i,a=this._byteCount+this._byteP2PCount;(a=62914560<a?62914560:a)<0&&(a=0),Object(b.b)({id:"videoModule",action:"setByteCount",data:[a]}),this.inEmpty&&(this.totalEmptyTime=this.totalEmptyTime+(new Date).valueOf()-this.StarEmptyTime,this.StarEmptyTime=(new Date).valueOf()),this.hasNetStream&&(1<=this.emptyCount&&(i={playstate:0,enum:this.emptyCount,fnum:this.fullCount,emptyTime:this.totalEmptyTime,caton_type:0},this.DataHandle(i)),r={playstate:2,enum:this.emptyCount,fnum:this.fullCount,emptyTime:this.totalEmptyTime,dl:this.P2PCurrentCount,tdl:this.P2PtotalByteCount,pdl:this._byteP2PCount,pcdl:this._byteCount},this.DataHandle(r),t=Object(b.j)(["videoModule","player","p2p"]),n=Object(b.j)(["videoModule","player","getPlayerStat"]),a=this.player?this.player.statInfo:null,r=(i=n().statInfo)?i.droppedFrames:0,n=this.subDelay,(i=0)<this.bufIndex&&(i=parseInt(this.bufT/this.bufIndex,10)),this.bufIndex=0,this.bufT=0,!Object(g.getIsPlayAudio)()&&this.player&&this.player.statInfo&&(this.bandwidth=parseInt(60*this.player.statInfo.vbr/8,10)||0),i={is_heartbeat:1,ps:4,vbr:a&&a.vbr||0,delay:n,av_diff:0,cpu:"",mem:"",dfc:r,ec:0,d_ec:0,is_err:0,b_cdn:this._byteCount,b_p2p:this._byteP2PCount,b_up:0,b_wst:0,st:t?2:1,res:this.getRes(),vt:Object(g.getPageData)("$ROOM.audioWEBBGIMG")||Object(g.getIsPlayAudio)()?1:2,down:parseInt((this._byteCount+this._byteP2PCount)/60/1024,10),kd_c:this.emptyCount,kd_t:this.totalEmptyTime,vdecode:Object(b.j)(["app","streamInfo","isH265"])?2:1,play_time:(new Date).getTime()-this.starTimePlayer,buff_delay:i,bg_play:Et()?1:0,bg_bandwidth:Object(g.getIsPlayAudio)()&&this.bandwidth||0,bg_type:1,last_st:this.getLastSt()},Object(g.getIsPlayAudio)()&&(i.audio_pid=this.audioPid,i.audio_time=(new Date).valueOf()-this.audioStarTime),this.reportStreamDot(i)),this.totalEmptyTime=0,this.emptyCount=0,this.fullCount=0},kt.prototype.countDelay=function(){var e=0,t=0;if(0<this.seiTimeList.length){for(var r=0;r<this.seiTimeList.length;r++)0<this.seiTimeList[r]&&this.seiTimeList[r]<3e4&&(t+=1,e+=this.seiTimeList[r]);0<t&&(e=parseInt(e/t,10))}else e=-1;return e},kt.prototype.playSucss=function(){clearInterval(this.playTimeIndex);var e={playstate:1,enum:this.emptyCount,fnum:this.fullCount};this.DataHandle(e)},kt.prototype.failStreamHander=function(){clearInterval(this.failTimeIndex);var e={playstate:3,enum:this.emptyCount,fnum:this.fullCount,error_num:0,error:""};this.DataHandle(e)},kt.prototype.DataHandle=function(e){var t=Object(b.j)(["tcp","loginres","userid"]),r=Object(b.j)(["app","rid"]),n=Object(b.j)(["app","ct"]),i=Object(b.j)(["app","cdn"]),a=Object(b.j)(["videoModule","player","src"]),o=Object(b.j)(["videoModule","player","p2p"]),s=Object(b.j)(["app","uip"]),u=Object(b.j)(["app","streamInfo","is_mixed"]),c=Object(b.j)(["videoModule","player","isPreload"]),d=Object(b.j)(["videoModule","player","getPlayerStat"]),l=Object(b.j)(["videoModule","player","streamName"]),h=Object(b.j)(["videoModule","player","streamStatus"]),p=d().mediaInfo,f=a.match(/(^|&)isp=([^&]*)(&|$)/),_=f&&f[2]?f[2]:"",m=e.playstate,y=e.enum,d=a,f=o?1:0,a=+(void 0!==Object(g.getPageData)("$ROOM.audioWEBBGIMG")),_={bt:e.emptyTime||0,ex:e.error||"",is_ma:c?1:0,isp:_};1!=a&&(_.is_mix=void 0===u?0:+u),o&&(_.pn=o),_.definition=l,0==+m?(_.caton_type=e.caton_type,p&&(_.vbr=parseInt(p.videoDataRate,10)),_.spd=parseInt((this._byteCount+this._byteP2PCount)/1024/60*8,10)):1==+m?(p&&(_.vbr=parseInt(p.videoDataRate,10)),_.cs=h):2==+m?(_.dl=e.dl,_.tdl=e.tdl,_.pdl=e.pdl,_.pcdl=e.pcdl,p&&(_.vbr=parseInt(p.videoDataRate,10)),_.spd=parseInt((this._byteCount+this._byteP2PCount)/1024/60*8,10),p=this.countDelay(),_.delay=p,this.subDelay=p,this.seiTimeList=[]):3==+m?(_.error_num=h?e.error_num:4,_.cs=h,_.spec_error=e.spec_error||0):4==+m&&(_.us=e.us,f=0,_.err_p2p=e.eCode||""),_.bws=navigator.userAgent.toLowerCase();_=JSON.stringify(_),a={type:"ssr",uid:t,rid:r,ec:y,surl:d,cdn:i,isp2p:f,did:Object(v.e)(),ps:m,ct:n,pt:ye.i,ext:_,pid:this.pid,uip:s,v_type:a,aver:ye.h};Object(b.g)(a)},kt.prototype.performancePoint=function(){var e,t=Object(b.j)(["videoModule","player","p2p"]),r=Object(b.j)(["videoModule","player","isPreload"]),n=Object(b.j)(["app","cdn"]),i=Object(b.j)(["videoModule","player","src"]).match(/(^|&)isp=([^&]*)(&|$)/),a=i&&i[2]?i[2]:"",o=Object(b.j)(["videoModule","player","starEnterH5Play"]),s=Object(b.j)(["LoadVideoNet","requestRoomInfoTimePoint"]),u=Object(b.j)(["LoadVideoNet","requestStreamUrlTimePoint"]),c=Object(b.j)(["LoadVideoNet","starPlayStreamTimePoint"]),d=Object(b.j)(["LoadVideoNet","loadNum"]),l=t||n,h=c-u,p=this.showFrameTimePoint-c,f=t?"prf_pl_ss_p2p_0":"prf_pl_ss_cdn_0",i=t?2:1;Object(b.j)(["app","manualLoadVideo"])&&(this.firstReadVide=!1),e=-1==+s?-1:u-s,ve.a.log("firstReadVide为"+this.firstReadVide);n=window.__player&&window.__player.isSwitched,t=0;n&&(t=window.__player.timeSwitch),this.firstReadVide&&!n?(this.firstReadVide=!1,ve.a.log("发送room_video_catchtime"),this.firstReadData={type:i,service_t:l,enterFlashTimer:o,getRoomInfoTimer:s,getStramUrlTimer:u,starRequstStramTimer:c,showStramTimer:this.showFrameTimePoint,isH5:!0,is_back:this.hasP2PRollback?1:0,av:ye.h,is_ma:r?1:0,requestSDKTime:this.startsdkTimevalue,getSDKTime:this.getsdkTimevalue,starRequstStramTimer2:this.beginloadTime,showStramTimer2:this.showFrameTimePoint,isp:a}):(n=void 0,c=0,n=this.firstReadVide?(r=o-t,o=s-o,c=this.showFrameTimePoint-t,(t={type:i,service_t:l,cnt:d,prf_pl_ro_0:e,prf_pl_pf_0:h})[f]=p,t.prf_pl_dls_0=r,t.prf_pl_sa_0=o,t.prf_pl_fs_0=c,t.ac_type=1,t.is_back=this.hasP2PRollback?1:0,t.isp=a,t):(c=-1==+s?this.showFrameTimePoint-u:this.showFrameTimePoint-s,(h={type:i,service_t:l,cnt:d,prf_pl_ro_0:e,prf_pl_pf_0:h})[f]=p,h.prf_pl_fs_0=c,h.ac_type=2,h.is_back=this.hasP2PRollback?1:0,h.isp=a,h),Object(b.d)(Re.i,n,ye.h),this.firstReadVide=!1)},kt.prototype.reportCarlton=function(){var e;1<=this.emptyCount&&(e={playstate:0,enum:this.emptyCount,fnum:this.fullCount,emptyTime:this.totalEmptyTime,caton_type:1},this.DataHandle(e)),this.emptyCount=0},kt.prototype.initVrPlayer=function(){this.disposeVr(),this.target=new window.THREE.Vector3;var e=void 0;this.video.style.visibility="hidden",this.camera=new window.THREE.PerspectiveCamera(75,this.videoContent.innerWidth/this.videoContent.innerHeight,1,1100),this.camera.target=new window.THREE.Vector3(0,0,0),this.scene=new window.THREE.Scene;var t=new window.THREE.SphereBufferGeometry(500,60,40);t.scale(-1,1,1),(e=new window.THREE.VideoTexture(this.video)).minFilter=window.THREE.LinearFilter,e.format=window.THREE.RGBFormat;var e=new window.THREE.MeshBasicMaterial({map:e}),e=new window.THREE.Mesh(t,e);this.scene.add(e),this.renderer=new window.THREE.WebGLRenderer,this.renderer.setSize(this.videoContent.innerWidth/4,this.videoContent.innerHeight/4),this.videoContent.appendChild(this.renderer.domElement),this.root.addEventListener("mousedown",this.onDocumentMouseDown,!1),this.root.addEventListener("mouseup",this.onDocumentMouseUp,!1),this.vrAnimate()},kt.prototype.vrAnimate=function(){this.vrAnimateId=requestAnimationFrame(this.vrAnimate),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=window.THREE.Math.degToRad(90-this.lat),this.theta=window.THREE.Math.degToRad(this.lon),this.target.x=Math.sin(this.phi)*Math.cos(this.theta),this.target.y=Math.cos(this.phi),this.target.z=Math.sin(this.phi)*Math.sin(this.theta),this.camera.lookAt(this.target),this.renderer.render(this.scene,this.camera)},kt.prototype.onWindowResize=function(e,t){this.camera&&(this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t));e=Object(b.j)(["app","width"]),t=Object(b.j)(["app","height"]);this.renderer&&this.renderer.domElement&&(this.renderer.domElement.style.marginTop=(t-this.renderer.domElement.height)/2+"px",this.renderer.domElement.style.marginLeft=(e-this.renderer.domElement.width)/2+"px")},kt.prototype.onDocumentMouseDown=function(e){0===e.button&&(e.preventDefault(),this.root.addEventListener("mousemove",this.onDocumentMouseMove,!1),this.root.addEventListener("mouseup",this.onDocumentMouseUp,!1),this.root.addEventListener("mouseleave",this.onDocumentMouseUp,!1))},kt.prototype.onDocumentMouseMove=function(e){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,e=e.movementY||e.mozMovementY||e.webkitMovementY||0;this.lon-=.1*t,this.lat+=.1*e},kt.prototype.onDocumentMouseUp=function(){this.root.removeEventListener("mousemove",this.onDocumentMouseMove),this.root.removeEventListener("mouseup",this.onDocumentMouseUp)},kt.prototype.onDocumentMouseWheel=function(e){this.camera.fov+=.05*e.deltaY,this.camera.updateProjectionMatrix()},kt.prototype.onDocumentTouchStart=function(e){e.preventDefault();e=e.touches[0];this.touchX=e.screenX,this.touchY=e.screenY},kt.prototype.onDocumentTouchMove=function(e){e.preventDefault();e=e.touches[0];this.lon-=.1*(e.screenX-this.touchX),this.lat+=.1*(e.screenY-this.touchY),this.touchX=e.screenX,this.touchY=e.screenY},kt.prototype.disposeVr=function(){this.lon=90,this.lat=0,this.phi=0,this.theta=0,this.vrAnimateId&&cancelAnimationFrame(this.vrAnimateId),this.target=null,this.camera=null,this.renderer&&(this.renderer.domElement&&(this.renderer.domElement.parentNode.removeChild(this.renderer.domElement),this.renderer.domElement=null),this.renderer=null),this.scene=null,this.root.removeEventListener("mousedown",this.onDocumentMouseDown,!1),this.root.removeEventListener("mousemove",this.onDocumentMouseMove,!1),this.root.removeEventListener("mouseup",this.onDocumentMouseUp,!1)},kt.prototype.upUid=function(e){this.setUiD&&this.setUiD(e.uid)},kt.prototype.audioDot=function(e){var t=Object(b.j)(["app","rid"]),r=Object(b.j)(["app","streamInfo","rtmp_url"]),n=Object(b.j)(["app","streamInfo","rtmp_live"]),i=Object(b.j)(["videoModule","player","p2pValue"]),a=Object(b.j)(["app","streamInfo","is_mixed"]),o=Object(b.j)(["videoModule","player","p2p"]),s=Object(b.j)(["videoModule","player","isPreload"]),u=Object(b.j)(["app","cdn"]),c=Object(b.j)(["app","acdn"]),d=Object(b.j)(["tcp","loginres","userid"]),l=Object(b.j)(["app","streamInfo","mixed_url"]),h=Object(b.j)(["app","streamInfo","mixed_live"]),u={net:1,rid:t,vt:Object(g.getPageData)("$ROOM.audioWEBBGIMG")||Object(g.getIsPlayAudio)()?1:2,mix:a?1:0,surl:a?l+"/"+h:r+"/"+n,res:this.getThrottleRes(),lt:1,ec:e,d_ec:0,is_err:0===e?0:1,is_ma:s?1:0,is_b:this.hasP2PRollback?1:0,pv:ye.h,cv:ye.h,p2p:i,uid:d,st:o?2:1,wtype:this.getWtype(),s_cdn:Object(g.getIsPlayAudio)()?c:u,zone:Object(g.getPageData)("$ROOM.cate_id"),et:1,reportId:615,stime:(new Date).valueOf()-Object(g.getrequstTime)(),audio_pid:this.audioPid,seq_no:this.getProgressiveIncreaseSeq()};this.reportStreamDot(u)},kt.prototype.startHeartDot=function(){this.heardDotID||(this.heardDotID=setInterval(this.reportHeartDot,1e4))},kt.prototype.reportHeartDot=function(){var e={pv:ye.h,cv:ye.h,reportId:642,did:Object(v.e)(),uid:Object(g.getuid)(),rid:Object(b.j)(["app","rid"]),seq_no:this.getProgressiveIncreaseSeq(),audio_pid:this.audioPid,res:this.getThrottleRes(),sf_tag:this.sg,last_st:this.getLastSt(),wtype:this.getWtype()};this.reportStreamDot(e)},kt.prototype.getWtype=function(){switch((Object(g.getPageData)("pageType")||{}).pageCode){case"page_studio_webm":return 3;case"page_studio_dzh":return 2;default:return 1}},kt.prototype.getRes=function(){var e=Object(b.j)(["app","streamInfo","is_mixed"]),t=Object(b.j)(["videoModule","player","streamName"]);return e?3:this.getRateInt(t)},kt.prototype.getThrottleRes=function(){return this.throttleRes},kt.prototype.getLastSt=function(){return this.lastst?"2":"1"},kt.prototype.getInitSeq=function(){return this.seqNo=1,this.seqNo},kt.prototype.getProgressiveIncreaseSeq=function(){return this.seqNo+=1,this.seqNo},kt.prototype.stopHeartDot=function(){this.heardDotID&&(clearInterval(this.heardDotID),this.heardDotID=void 0)},kt.prototype.goReceptionDot=function(){var e={pv:ye.h,cv:ye.h,reportId:616,did:Object(v.e)(),uid:Object(g.getuid)(),rid:Object(b.j)(["app","rid"]),res:this.getThrottleRes(),wtype:this.getWtype(),ct:"web",seq_no:this.getProgressiveIncreaseSeq(),audio_pid:this.audioPid,bg_time:!(this.bgTimeEnd-this.bgTimeStar<0)&&this.bgTimeEnd-this.bgTimeStar||0};this.reportStreamDot(e)},kt.prototype.reportStreamDot=function(e){window.streamSubSdkReport?window.streamSubSdkReport(e):99<this.subNewList.length?this.subNewList.shift():this.subNewList.push(e)},kt.prototype.reportHiddenChange=function(){var e=this;this.createAudioPid();var t=this.fgTimeEnd-this.fgTimeStar,r={pv:ye.h,cv:ye.h,reportId:617,did:Object(v.e)(),uid:Object(g.getuid)(),rid:Object(b.j)(["app","rid"]),ct:"web",res:this.getThrottleRes(),seq_no:this.getInitSeq(),audio_pid:this.audioPid,wtype:this.getWtype(),fg_time:Math.max(t,0)};window.streamSubSdkReport?setTimeout(function(){!1===e.isunloading&&window.streamSubSdkReport(r)},100):100<this.subNewList.length?this.subNewList.shift():this.subNewList.push(r)},kt.prototype.createAudioPid=function(){for(var e=(new Date).valueOf(),t="",r=0;r<4;r++)t+=parseInt(10*Math.random(),10);this.audioPid=t+e},kt),_=o("a9aad"),At=o.n(_);function kt(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,kt);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,St.call(this));return e.subNewList=[],e.addindex=0,e.isunloading=!1,e.Delayerrindex=1,e.pid="",e.firstReadVide=!0,e.lon=90,e.lat=0,e.phi=0,e.theta=0,e.index=1,e.seqNo=0,le(),de(e),e.id="videoModule",e.isstartPlayer=!1,e.videoId=ye.k,e.canvasId=ye.d,e._byteAnotherTimerID="",e._byteTmp=0,e._byteCount=0,e._byteP2PTmp=0,e._byteP2PCount=0,e.P2PtotalByteCount=0,e.P2PCurrentCount=0,e.inEmpty=!1,e.StarEmptyTime=0,e.StarFullTime=0,e.totalEmptyTime=0,e.emptyCount=0,e.fullCount=0,e.hasNetStream=!1,e.failTimeIndex=0,e.playTimeIndex=0,e.showFrameTimePoint=0,e.aliNotified=!1,e.hasP2PRollback=!1,e.videoRealWidth=0,e.videoRealHeight=0,e.loopVodObj={t:0,e:0},e.bufferCheckTimer=0,e.speedTencounts=0,e.speedArray=[],e.lastLoaderBytes=0,e.lastUpBytes=0,e.minuesUpBytes=0,e.minuesDownBytes=0,e.lastTimestamp=0,e.firstReadData=null,e.disposeTimer=0,e.startsdkTimevalue=0,e.getsdkTimevalue=0,e.beginloadTime=0,e.pid="",e.seiTimeList=[],ge.a.on(Re.h,e.getsdkTime),ge.a.on(Re.d,e.beginLoadTimefun),e.P2Pfresh=0,e.PairFrameok=!1,e.subDelay=0,e.bufT=0,e.bufIndex=0,e.bandwidth=0,e.lastst="",e.currentSt="",e.asyncImport(),ge.a.on("videoPairFrameCan",e.videoPairFrameCanHandle),ge.a.on("videoPairFrameOverErr",e.videoPairFrameOverErrHandle),ge.a.on("videoPairFrame10Over",e.videoPairFrame10Over),ge.a.on("diposeFirstVideo",e.diposeFirstVideoHandle),ge.a.on("updateLoginres",e.upUid),e.lastGetJieliuConfigTime=0,e.jieliucd=0,e.enttime=(new Date).valueOf(),e.fgTimeStar=parseInt(performance.now(),10),e}function Pt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var It,xt=(Pt(Ut,It=d),Ut.prototype.init=function(e){It.prototype.init.call(this,e),this.videoContent=document.createElement("div"),this.videoContent.className=At.a.videoContainer,e.appendChild(this.videoContent),this.video=document.createElement("video"),this.video.className=At.a.video,this.videoContent.appendChild(this.video),this.video.id=this.videoId,this.canvas=document.createElement("canvas"),this.canvas.className=At.a.screenshot,this.videoContent.appendChild(this.canvas),this.element=this.videoContent,this.autoplaydiv=document.createElement("div"),this.videoContent.appendChild(this.autoplaydiv),this.canAutoPlay=!0,this.firstReadVide=!0,this.starIndex=0,ge.a.on("embedmentPlayerdispose",this.embedmentPlayerdisposeHandle),ge.a.on("videoPairFrame10Over",this.videoPairFrame10Over),ge.a.on(Re.h,this.getsdkTime),ge.a.on(Re.d,this.beginLoadTimefun),this.viewFresh()},Ut.prototype.viewFresh=function(){var e,t,r=Object(b.j)(["app","width"]),n=Object(b.j)(["app","height"]),i=Object(b.j)(["app","isFullscreen"]),a=Object(b.j)(["app","isWebFullscreen"]),o=Object(b.j)(["app","playbModel"]),s=Object(b.j)(["videoModule","player","videoWidth"]),u=Object(b.j)(["videoModule","player","videoHeight"]),c=void 0;n-=i||a||!o?0:ye.e,0===s||0===u?(c={width:r,height:n},this.videoRealWidth=r,this.videoRealHeight=n):(e=1,o=a=i=t=0,u/s<=n/r?(t=u*(e=(i=r)/s),o=.5*n-u*e*.5):(i=s*(e=(t=n)/u),a=.5*r-s*e*.5),c={width:i,height:t,left:a,top:o},this.videoRealWidth=i,this.videoRealHeight=t);c={width:c.width+"px",height:c.height+"px"};Object.assign(this.video.style,c),Object.assign(this.canvas.style,c)},Ut.prototype.setvideo2Src=function(e){if(this.player&&(this.player.dispose(),this.player=null),this.canvas&&(this.canvas.style.visibility="hidden"),this.player=dt(e,{P2P:"",hasVideo:!Object(g.getPageData)("$ROOM.audioWEBBGIMG")&&void 0}),this.player){this.video.src="",this.player.attachMedia(this.video),this.player.on(lt.FIRST_FRAME,this.onFirstFrame),this.player.on(lt.READY,this.onReady),this.player.on(lt.COMPLETE,this.onComplete),this.player.on(lt.ERROR,this.onError),this.player.load();for(var e=(new Date).valueOf(),t="",r=0;r<4;r++)t+=parseInt(10*Math.random(),10);this.pid=t+e,this._byteAnotherTimerID&&clearInterval(this._byteAnotherTimerID),clearInterval(this.failTimeIndex)}this.refreshPlayer()},Ut.prototype.refreshPlayer=function(){var e=Object(b.j)(["videoModule","player","volume"]);this.player&&(this.player.volume(parseFloat(e,10)),this.canAutoPlay?this.player.play():this.stop())},Ut.prototype.stop=function(){var e=this;this.player&&this.canvas&&this.video&&this.videoRealWidth&&this.videoRealHeight&&(this.player.pause(),this.canvas.width=this.videoRealWidth,this.canvas.height=this.videoRealHeight,this.canvas.getContext("2d").drawImage(this.video,0,0,this.videoRealWidth,this.videoRealHeight),this.canvas.style.visibility=""),Et()?this.dispose():(clearTimeout(this.disposeTimer),this.disposeTimer=setTimeout(function(){e.dispose()},20))},Ut.prototype.onCanAutoPlay=function(){this.canAutoPlay=!1,this.showAutoplaydiv(),this.stop(),ge.a.emit("diposeFirstVideo")},Ut.prototype.dispose=function(){this.player&&(this.player.pause(),this.player.dispose()),this.player=null,ge.a.off("embedmentPlayerdispose",this.embedmentPlayerdisposeHandle),ge.a.off("videoPairFrame10Over",this.videoPairFrame10Over)},Ut.prototype.onFirstFrame=function(){this.refreshPlayer(),this.showFrameTimePoint=(new Date).valueOf(),this.performancePoint(),Object(g.setEmbedmentShowTime)((new Date).valueOf())},Ut.prototype.onReady=function(){var e;null!=this.firstReadData&&(e=(new Date).valueOf(),this.firstReadData.canplay_matadate=e-this.showFrameTimePoint,Object(g.prfLoad)(this.firstReadData),this.firstReadData=null),this.player.on(lt.CANAUTO_PLAY,this.onCanAutoPlay),this.refreshPlayer(),Object(g.setEmbedmentPlayer)(this.player.player),0===this.starIndex&&(Object(g.starVideoPairFrame)(),this.starIndex=2)},Ut.prototype.onComplete=function(){Object(g.authenticationPlayerComplate)()},Ut.prototype.onError=function(){Object(g.closeVideoPairFrame)(1,8)},Ut.prototype.onclick1=function(){this.canAutoPlay=!0,this.autoplaydiv.style.visibility="hidden",Object(b.b)({id:"LoadVideoNet",action:"reloadVideo",data:[{manual:!0}]}),this.embedmentPlayerdisposeHandle()},Ut.prototype.videoPairFrame10Over=function(e){1===e&&this.embedmentPlayerdisposeHandle()},Ut.prototype.embedmentPlayerdisposeHandle=function(){this.player&&(this.player.pause(),this.player.dispose()),this.player=null,It.prototype.destroy.call(this),ge.a.off("embedmentPlayerdispose",this.embedmentPlayerdisposeHandle),ge.a.off("videoPairFrame10Over",this.videoPairFrame10Over)},Ut.prototype.showAutoplaydiv=function(){Object(g.closeVideoPairFrame)(-1,9);var e=Object(b.j)(["app","width"]),t=Object(b.j)(["app","height"]);this.Autoplaydiv1=document.createElement("div"),this.Autoplaydiv1.className=At.a.mask1,this.Autoplaydiv1.onclick=this.onclick1,this.Autoplaydiv2=document.createElement("div"),this.Autoplaydiv2.className=At.a.autoPlayImg,this.Autoplaydiv2.style.transform="matrix(1, 0, 0, 1, "+parseInt((e-252)/2,10)+", "+parseInt((t-178)/2,10)+")",this.Autoplaydiv1.appendChild(this.Autoplaydiv2),this.autoplaydiv.appendChild(this.Autoplaydiv1),this.Autoplaydiv3=document.createElement("div"),this.Autoplaydiv3.className=At.a.jumpdetail,this.Autoplaydiv3.style.transform="matrix(1, 0, 0, 1, "+parseInt((e-252)/2,10)+", "+parseInt((t-178)/2,10)+")",this.Autoplaydiv3.onclick=function(){window.open("https://www.douyu.com/cms/gong/201807/06/8146.shtml")},this.autoplaydiv.appendChild(this.Autoplaydiv3),this.canAutoPlay=!0},Ut.prototype.getsdkTime=function(e){e&&(this.startsdkTimevalue=e.bt,this.getsdkTimevalue=e.et)},Ut.prototype.beginLoadTimefun=function(e){e&&(this.beginloadTime=e.sdkok)},Ut.prototype.performancePoint=function(){var e=Object(b.j)(["videoModule","player","p2p"]),t=Object(b.j)(["videoModule","player","isPreload"]),r=Object(b.j)(["app","cdn"]),n=Object(b.j)(["videoModule","player","src"]).match(/(^|&)isp=([^&]*)(&|$)/),i=n&&n[2]?n[2]:"",a=Object(b.j)(["videoModule","player","starEnterH5Play"]),o=Object(b.j)(["LoadVideoNet","requestRoomInfoTimePoint"]),s=(new Date).valueOf(),n=(new Date).valueOf(),e=e||r;Object(b.j)(["app","manualLoadVideo"])&&(this.firstReadVide=!1);r=window.__player&&window.__player.isSwitched;this.firstReadVide&&!r&&(this.firstReadVide=!1,this.firstReadData={type:3,service_t:e,enterFlashTimer:a,getRoomInfoTimer:o,getStramUrlTimer:s,starRequstStramTimer:n,showStramTimer:this.showFrameTimePoint,isH5:!0,is_back:0,av:ye.h,is_ma:t?1:0,requestSDKTime:this.startsdkTimevalue,getSDKTime:this.getsdkTimevalue,starRequstStramTimer2:this.beginloadTime,showStramTimer2:this.showFrameTimePoint,isp:i})},Ut),Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jt=!1,Rt=void 0,Dt=void 0,Lt=void 0,Ct=void 0,Bt=void 0;function Ut(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ut),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,It.apply(this,arguments))}function Nt(){var e=+Object(b.j)(["app","rid"]),t=(new Date).getTime(),r=t.toString(16),n=parseInt("0x"+r.substring(0,r.length-8),16),i=parseInt("0x"+r.substring(r.length-8,r.length),16),a=Object(v.e)(),o=Object(v.d)("auth")||"201806211659380f83e682207dd1293cea68f98662b1660083967948219fe20";Promise.resolve().then(function(){return Dt=(new Date).getTime(),window.SQSSMURFNEEDALONGLONGLONGNAME.sqsneedalongname(e,n,i,a,o,3186)}).then(function(e){Lt=(new Date).getTime(),Object(b.b)({id:"LoadVideoNet",action:"httpClientLoadStremUrl",data:[e,t,Ct,Bt]}),jt?ve.a.log("****开始加密到算出加密数---"+(Lt-Dt)):ve.a.log("****加载到算出加密值-下载到回调开始加密--"+(Dt-Rt)+"开始加密到算出加密数---"+(Lt-Dt)),jt=!0}).catch(function(){Object(g.notifyLoadjs)()})}function Ht(e,t){var a=1<arguments.length&&void 0!==t?t:1e3;return new Promise(function(r){var n=0,i=setTimeout(function(){0===n&&(n=2,clearTimeout(i),i=null,r({statusCode:-2,json:{}}))},a);fetch(e,{method:"GET",headers:{}}).then(function(e){clearTimeout(i),i=null;var t=e.status;if(e.ok)2!==n&&(n=1,e.json().then(function(e){return r({statusCode:t,json:e})}));else if(2!==n)return n=1,r({statusCode:t,json:{}})}).catch(function(){return r({statusCode:400,json:{}})})})}var Ft=!(window.SQSSMURFNEEDALONGLONGLONGNAME={onRuntimeInitialized:Nt}),Vt=Object(ve.b)("MSG"),Wt={requestRoomInfoTimePoint:-1,requestStreamUrlTimePoint:0,starPlayStreamTimePoint:0,loadNum:0};function Gt(){return Wt}function qt(e){Object(w.b)().app.cdn=e.rtmp_cdn,Object(w.b)().app.acdn=e.acdn,Object(b.b)({id:"app",action:"refreshRidAndCdn",data:[e.room_id,e.rtmp_cdn]});var t={is_mixed:e.is_mixed,mixed_url:e.mixed_url,mixed_live:e.mixed_live,rtmp_url:e.rtmp_url,rtmp_live:e.rtmp_live,player_1:e.player_1,isH265:Object(g.checkIsSupporH265)()&&e.player_1?1:0};Object(w.b)().app.uip=e.client_ip,Object(b.b)({id:"app",action:"freshUip",data:[e.client_ip]}),Object(w.d)(t),Object(b.b)({id:"app",action:"refeshStreamInfo",data:[t]}),Object(b.b)({id:"LoadVideoNet",action:"playStream",data:[]})}function zt(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.cdn,r=e.rate,n=e.isRollback,i=e.isInit,a=e.manual,o=void 0!==a&&a,s=e.isLianmaiOver,u=e.isnoLoading,c=e.isaudio,d=void 0!==c&&c;if(Object(g.setrequstTime)((new Date).valueOf()),o&&Object(g.closeVideoPairFrame)(4,6),gt(),d||Object(g.getIsPlayAudio)()||Object(b.b)({id:"videoModule",action:"refeshplayerSrc",data:[""]}),Object(b.b)({id:"videoModule",action:"setPlayerError",data:[0]}),Object(b.b)({id:"videoModule",action:"refeshplayerisRollback",data:[n]}),Object(b.b)({id:"comment",action:"seiMcdatachange",data:[""]}),o&&(Object(w.b)().app.manualLoadVideo=o,Object(b.b)({id:"app",action:"manualLoadVideo",data:[o]})),i){var l=Object(g.getPageData)("$ROOM.p2p_setting"),h=Object(g.getPageData)("$ROOM.multirates"),p=void 0;Object(b.b)({id:"videoModule",action:"checkAccelerator",data:[t,r]});try{var f=localStorage.getItem("h5StreamPreload_h5p_room");f&&(f=JSON.parse(f),Date.now()<f.e&&(p=JSON.parse(f.v)))}catch(e){Vt.warn("parse preload stream error",e)}var _=Object(b.j)(["app","rid"]);p&&+_==+p.room_id&&p.multirates&&0<p.multirates.length&&(p.multirates.forEach(function(e){e.type=e.rate}),h=p.multirates,r=p.rate);var m=Object(g.getPageData)("$ROOM.coverSrc"),y=Object(g.getPageData)("$ROOM.owner_avatar"),v=Object(g.getPageData)("$ROOM.isDefaultAvatar"),a=Object(g.getPageData)("$ROOM.roomSrc"),c=Object(g.getPageData)("$ROOM.defaultSrc"),f=h&&1<h.length?1:0,_=h&&1<h.length?1:0,p=Object(g.getPageData)("$ROOM.is_high_game"),h=Object(g.getPageData)("$ROOM.room_idle");Object(w.b)().app.changeRateSwitch=f,Object(b.b)({id:"app",action:"changeRateSwitch",data:[f]}),Object(w.b)().app.pageRateSwitch=_,Object(b.b)({id:"app",action:"changePageRateSwitch",data:[_]}),h&&h.hasOwnProperty("active")&&h.hasOwnProperty("minute_limit")&&Object(b.a)(Re.f,h),mt()&&(V.c("rateRecordTime",0),V.c("realRateModel",-1));c={p2p_settings:l,coverSrc:m,owner_avatar:y,isDefaultAvatar:v,roomSrc:a,defaultSrc:c},p={rateSwitch:f,liveType:p,rate:r=V.b("realRateModel",-1)};Object(w.a)(c,p)}else r=Object(b.j)(["app","rate"]);Object(b.b)({id:"LoadVideoNet",action:"loadStream",data:[t,r,n,o,i,s,u,d]})}function Yt(){var e="",t=Object(b.j)(["app","streamInfo","rtmp_url"]);t&&(e=t+"/"+Object(b.j)(["app","streamInfo","rtmp_live"])),(t=Object(b.j)(["ticket","rtmp_url"]))&&(e=t+"/"+Object(b.j)(["ticket","rtmp_live"])),Object(b.j)(["app","streamInfo","is_mixed"])&&(e=Object(b.j)(["app","streamInfo","mixed_url"])+"/"+Object(b.j)(["app","streamInfo","mixed_live"])),Object(b.j)(["app","streamInfo","isH265"])&&(e=Object(b.j)(["app","streamInfo","player_1"]));var r=(new Date).valueOf();Wt.starPlayStreamTimePoint=r,Object(b.b)({id:"videoModule",action:"refeshplayerisPlay",data:[!0]});t=Object(b.j)(["app","roomInfo"]),r={rateSwitch:Object(b.j)(["app","rateSwitch"]),rate:Object(b.j)(["app","rate"]),multirates:Object(b.j)(["app","multirates"])};Object(b.b)({id:"app",action:"refreshAppinfo",data:[t,r]}),Object(b.b)({id:"videoModule",action:"refeshplayerSrc",data:[e]})}var Xt="",Kt=void 0,Jt=void 0,$t=void 0;function Zt(n,i,a,e,o,s,u,c){var t=Object(b.j)(["LoadVideoNet","loadNum"]);Object(b.b)({id:"videoModule",action:"changeisAudio",data:[c]}),t+=1;var r=(new Date).valueOf(),d=(new Date).valueOf();Wt.requestStreamUrlTimePoint=r,Wt.loadNum=t,Wt.requestRoomInfoTimePoint=d;var l=Object(b.j)(["app","rid"]),h=Object(v.e)(),p=parseInt((new Date).getTime()/1e3,10);void 0===n&&(n=Object(b.j)(["app","cdn"])),void 0===i&&(i=Object(b.j)(["app","rate"]));var f=void 0,r=Object(b.j)(["videoModule","haveShowVideo"])?0:1,t=0;3<=V.b(V.a.RateRecordTime,0)&&(t=1);d=Object(g.checkIsSupporH265)(n)?1:0;try{f=window.ub98484234(l,h,p)+"&cdn="+n+"&rate="+i+"&ver="+ye.h+"&iar="+r+"&ive="+t+"&hevc="+d+"&fa="+(c?1:0),Object(g.isVip)()&&!Ft&&(f=f+"&aid=web-alone&uid="+(Object(v.d)("uid")||"0")+"&fa="+(c?1:0))}catch(n){return Object(b.d)(ye.f,{s_error:2,err_type:1,en_ver:window.vdwdae325w_64we,em:n.message}),Object(g.notifyLoadjs)(),Vt.error("get stream url error.",n)}var _=!1;return Promise.resolve().then(function(){var e=window.__player&&window.__player.isSwitched;if(o&&!e){var t=void 0;try{var r=localStorage.getItem("h5StreamPreload_h5p_room");r&&(r=JSON.parse(r),Date.now()<r.e&&(t=JSON.parse(r.v)))}catch(e){Vt.warn("parse preload stream error",e)}if(t&&+l==+t.room_id&&t.multirates&&0<t.multirates.length)return _=!0,t.rtmp_live||(r=t.multirates[0],t.rtmp_url=r.rtmp_url,t.rtmp_live=r.rtmp_live,t.rate=r.rate,Vt.warn("找不到指定清晰度的流，使用rate="+r.rate+"代替")),t.rtmp_live&&(t.rtmp_live+="&"+f),t.mixed_live&&(t.mixed_live+="&"+f),localStorage.removeItem("h5StreamPreload_h5p_room"),Vt.log("use preload stream"),Object(g.streamHandle)(t,i,a,_,n,u)}Xt=n.toString(),Kt=i,Jt=s,$t=a;var t=+Object(g.getPageData)("$ROOM.cate_id");return 208!=+t&&181!=+t?Object(g.isVip)()&&!Ft?Ht(Object(v.f)().play_web_url+ye.a+"/"+l+"?"+f,1e3).then(function(e){var t=e.statusCode,e=e.json;if(-2==+t)Object(g.isVip)()&&(Ft=!0,Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{manual:!1,isLianmaiOver:!1}]}),Object(g.setvipBack)());else if(200===t){t=e.error;try{if(0!==t)throw Object(g.notifyLoadjs)(),-1===t?Object(b.d)(ye.f,{s_error:2,err_type:2,en_ver:window.vdwdae325w_64we,em:e.msg}):-9==+t?Object(b.a)(Re.j):-15==+t&&Object(g.isVip)()&&(Ft=!0,Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{manual:!1,isLianmaiOver:!1}]}),Object(g.setvipBack)()),Object(g.closeVideoPairFrame)(4,7),new Error("stream error code = "+t);var r=e.data;s&&r&&(r.is_mixed=!1),Object(g.streamHandle)(r,i,a,_,n,u)}catch(e){Object(b.b)({id:"loading",action:"showLoading",data:[!0]})}}else Object(g.isVip)()&&(Ft=!0,Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{manual:!1,isLianmaiOver:!1}]}),Object(g.setvipBack)())}):m.httpClient.post(String,Object(g.isSupermanager)()||Object(g.getIsHostlive)()?ye.b+"/"+l:ye.a+"/"+l,f,{withCredentials:!0}).subscribe(function(e){var t=e.error;try{if(0!==t)throw Object(g.notifyLoadjs)(),-1===t?Object(b.d)(ye.f,{s_error:2,err_type:2,en_ver:window.vdwdae325w_64we,em:e.msg}):-9==+t&&Object(b.a)(Re.j),Object(g.closeVideoPairFrame)(4,7),new Error("stream error code = "+t);var r=JSON.parse(e.data);s&&r&&(r.is_mixed=!1),Object(g.streamHandle)(r,i,a,_,n,u)}catch(e){Object(b.b)({id:"loading",action:"showLoading",data:[!0]}),Object(g.notifyLoadjs)()}}):(Object(g.delayStreamWhilte)()&&Object(g.getInPairFrameState)()<2||u||(Vt.warn("isnoLoading-----"+u),Object(b.b)({id:"loading",action:"showLoading",data:[!0]})),Ct=c,Bt=t=u,void(jt?Nt():(Rt=(new Date).getTime(),t="",t=document.createElement("script"),"object"!==("undefined"==typeof WebAssembly?"undefined":Mt(WebAssembly))?t.src="https://shark2.douyucdn.cn/front-publish/sdk-file-master/aanode_131510b.js":t.src="https://shark2.douyucdn.cn/front-publish/sdk-file-master/wanode_fd27bd3.js",t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t),t.onerror=function(){Object(g.notifyLoadjs)()})))}).catch(function(e){Vt.error("Load stream api error : roomid = "+l,e),Object(g.notifyLoadjs)()}),null}function Qt(e,t,r,i){var n=Object(b.j)(["app","rid"]),a=Object(b.j)(["videoModule","haveShowVideo"])?0:1,o=0;3<=V.b(V.a.RateRecordTime,0)&&(o=1);var s=Xt,u=Kt;void 0===s&&(s=Object(b.j)(["app","cdn"]).toString()),void 0===u&&(u=Object(b.j)(["app","rate"]));var c,d=Object(v.e)(),l=Object(g.checkIsSupporH265)()?1:0,h="cdn="+s+"&rate="+u+"&ver="+ye.h+"&iar="+a+"&ive="+o+"&"+e+"&sov=1&tt="+t+"&did="+d+"&hevc="+l+"&fa="+(r?1:0);return Object(g.isVip)()&&!Ft&&(h=h+"&aid=web-alone&uid="+(Object(v.d)("uid")||0)),Object(g.isVip)()&&!Ft?(c=Object(v.f)().play_web_url+ye.a+"/"+n+"?"+h,Promise.resolve().then(function(){return Ht(c,1e3).then(function(e){var t=e.statusCode,r=e.json;if(-2==+t)Object(g.isVip)()&&(Ft=!0,Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{manual:!1,isLianmaiOver:!1}]}),Object(g.setvipBack)());else if(200===t){t=r.error;try{if(0!==t)throw Object(g.notifyLoadjs)(),-1===t?Object(b.d)(ye.f,{s_error:2,err_type:2,en_ver:window.vdwdae325w_64we,em:r.msg}):-9==+t?Object(b.a)(Re.j):-15==+t&&Object(g.isVip)()&&(Ft=!0,Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{manual:!1,isLianmaiOver:!1}]}),Object(g.setvipBack)()),Object(g.closeVideoPairFrame)(4,7),new Error("stream error code = "+t);var n=r.data;n&&(n.is_mixed=!1),Object(g.streamHandle)(n,u,$t,!1,s,i)}catch(e){Object(b.b)({id:"loading",action:"showLoading",data:[!0]})}}else Object(g.isVip)()&&(Ft=!0,Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{manual:!1,isLianmaiOver:!1}]}),Object(g.setvipBack)())})}).catch(function(e){Vt.error("Load stream api error : roomid = "+n,e),Object(g.notifyLoadjs)(),e.response&&e.response.status&&(200!=+e.response.status||403!=+e.response.status)&&Object(g.isVip)()&&(Ft=!0,Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{manual:!1,isLianmaiOver:!1}]}),Object(g.setvipBack)())})):Promise.resolve().then(function(){return m.httpClient.post(String,Object(g.isSupermanager)()||Object(g.getIsHostlive)()?ye.b+"/"+n:ye.a+"/"+n,h,{withCredentials:!0}).subscribe(function(e){var t=e.error;try{if(0!==t)throw Object(g.notifyLoadjs)(),-1===t?Object(b.d)(ye.f,{s_error:2,err_type:2,en_ver:window.vdwdae325w_64we,em:e.msg}):-9==+t&&Object(b.a)(Re.j),Object(g.closeVideoPairFrame)(4,7),new Error("stream error code = "+t);var r=JSON.parse(e.data);Jt&&r&&(r.is_mixed=!1),Object(g.streamHandle)(r,u,$t,!1,s,i)}catch(e){Object(g.notifyLoadjs)(),Object(b.b)({id:"loading",action:"showLoading",data:[!0]})}})}).catch(function(e){Vt.error("Load stream api error : roomid = "+n,e),Object(g.notifyLoadjs)()}),null}var er=!1;function tr(e,t,r){var n,i,a,o;!er&&r&&(Object(b.b)({id:"ticket",action:"initpayment_mode",data:[r.payment_mode]}),Object(b.a)(Re.n,{status:1,ticketId:r.ticket_id}),er=!0),!1!==Object(b.j)(["app","isLogin"])?(o=Object(b.j)(["LoadVideoNet","loadNum"]),o+=1,a=(new Date).valueOf(),Wt.requestStreamUrlTimePoint=a,Wt.loadNum=o,Wt.requestRoomInfoTimePoint=-1,n=Object(b.j)(["videoModule","haveShowVideo"])?0:1,Object(w.b)().app.rate=t,Object(b.b)({id:"app",action:"freshRate",data:[t]}),r=Object(b.j)(["app","rid"]),i=Object(b.j)(["app","isYuanhua"]),a=Object(v.e)(),o=parseInt((new Date).getTime()/1e3,10),void 0===e&&(e=Object(b.j)(["app","cdn"])),void 0===t&&(t=Object(b.j)(["app","rate"])),m.httpClient.post(String,ye.c+"/"+r,window.ub98484234(r,a,o)+"&cdn="+e+"&rate="+t+"&iar="+n+"&ver="+ye.h).subscribe(function(e){try{var t=JSON.stringify(e);0==+(e=JSON.parse(t)).error&&(e.data=JSON.parse(e.data)),e.flash_is_yuanhua=i?1:0,Object(w.b)().app.uip=e.client_ip,Object(b.b)({id:"app",action:"freshUip",data:[e.client_ip]}),Object(b.b)({id:"app",action:"setTicketData",data:[e]}),Object(w.b)().app.cdn=e.data.rtmp_cdn,Object(b.b)({id:"app",action:"freshCdn",data:[e.data.rtmp_cdn]})}catch(e){Object(g.notifyLoadjs)(),Vt.warn("parse preload stream error",e),Object(b.b)({id:"loading",action:"showLoading",data:[!0]}),Object(b.b)({id:"videoModule",action:"setPlay",data:[!0,!0]})}})):Object(g.notifyLoadjs)()}function rr(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.manual,r=e.isLianmaiOver,n=e.isnoLoading,e=e.isaudio;Object(b.b)({id:"videoModule",action:"refeshplayerisPlay",data:[!0]}),Object(b.j)(["app","inVod"])||Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{manual:t,isLianmaiOver:r,isnoLoading:n,isaudio:e}]})}function nr(){Wt={requestRoomInfoTimePoint:-1,requestStreamUrlTimePoint:0,starPlayStreamTimePoint:0,loadNum:0}}function ir(e,t,r){var n=Object(b.j)(["app","rid"]),i=Object(v.e)(),a=Object(b.j)(["app","cdn"]),o=Object(b.j)(["app","rate"]),s=parseInt((new Date).getTime()/1e3,10),u=Object(b.j)(["videoModule","player","p2pValue"])||0,r=window.ub98484234(n,i,s)+"&cdn="+a+"&rate="+o+"&iar=1&ver="+ye.h+"&p2p="+u+"&pt="+e+"&dt=&txdw=0&il=0&ar=0&nt=&rs=1&bp=1&os=web_h5&p2p_total="+t+"&p2p_dur="+r;m.httpClient.post(String,"/gapi/live/web/autoswitch/"+n+"?client_sys=web_h5",r,{withCredentials:!0}).subscribe(function(e){var t=e.error,e=JSON.parse(e.data);0===t&&ge.a.emit("loadAudioCd",e)})}function ar(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.manual,e=e.isLianmaiOver;Object(g.getIsPlayAudio)()?rr({isaudio:!0,isnoLoading:!0,manual:t,isLianmaiOver:e}):rr({manual:t,isLianmaiOver:e})}function or(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var sr,ur=(or(cr,sr=d),cr.prototype.init=function(e){sr.prototype.init.call(this,e)},cr.prototype.destroy=function(){sr.prototype.destroy.call(this)},cr.prototype.getMoudleDate=function(){return Wt},cr.prototype.actionHandle=function(e){var t=e.action,e=e.data;n&&n[t]&&n[t].apply(n,e)},cr);function cr(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,cr);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,sr.call(this));return nr(),e.id="LoadVideoNet",e.actionList=["reloadVideo","lianmaireloadVideo"],e}function dr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var lr,hr=(dr(fr,lr=i.EventEmitter),fr.prototype.init=function(e,t){this.container=e,Object(w.c)(Object(g.get$ROOM)()),Object(w.f)(e.getBoundingClientRect());var r=void 0;Object(g.delayStreamWhilte)()&&2!==t?(r=new xt,this.registerModule(new f(this),new Ot(this),r,new ur(this))):this.registerModule(new f(this),new Ot(this),new ur(this)),Object(b.i)(this.modules);e=(new Date).valueOf();Object(b.b)({id:"videoModule",action:"setEnterPlay",data:[e]}),Object(g.delayStreamWhilte)()&&2!==t&&r.setvideo2Src(window.streamUrl),Object(b.b)({id:"LoadVideoNet",action:"loadVideo",data:[{isInit:!0}]}),Object(v.b)(ye.j)},fr.prototype.destroy=function(t){this.removeAllListeners(),this.modules.forEach(function(e){return e.destroy(t)}),this.modules=null,gt(),this.container=null,Object(g.closeVideoPairFrame)(4,4)},fr.prototype.registerModule=function(){for(var t=this,e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];r.forEach(function(e){e.init(t.container),t.modules.push(e)}),bt&&(wt=document[bt])},fr.prototype.getModule=function(e){for(var t=0;t<this.modules.length;t++){var r=this.modules[t];if(r.id===e)return r}return null},fr),pr=function(s){function r(){}var e={},t=e.lib={},n=t.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=t.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var i=0;i<e;i++)t[n+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(n+i)%4*8;else if(65535<r.length)for(i=0;i<e;i+=4)t[n+i>>>2]=r[i>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=s.ceil(t/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(4294967296*s.random()|0);return new u.init(t,e)}}),i=e.enc={},a=i.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var i=t[n>>>2]>>>24-n%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new u.init(r,t/2)}},o=i.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new u.init(r,t)}},c=i.Utf8={stringify:function(e){try{return decodeURIComponent(escape(o.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return o.parse(unescape(encodeURIComponent(e)))}},d=t.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,r=t.words,n=t.sigBytes,i=this.blockSize,a=n/(4*i);if(e=(a=e?s.ceil(a):s.max((0|a)-this._minBufferSize,0))*i,n=s.min(4*e,n),e){for(var o=0;o<e;o+=i)this._doProcessBlock(r,o);o=r.splice(0,e),t.sigBytes-=n}return new u.init(o,n)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});t.Hasher=d.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(r){return function(e,t){return new r.init(t).finalize(e)}},_createHmacHelper:function(r){return function(e,t){return new l.HMAC.init(r,t).finalize(e)}}});var l=e.algo={};return e}(Math);function fr(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,fr);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,lr.call(this));return Object(b.e)(),e.modules=[],e.isVideoShow=!1,e}!function(a){function T(e,t,r,n,i,a,o){return((e=e+(t&r|~t&n)+i+o)<<a|e>>>32-a)+t}function S(e,t,r,n,i,a,o){return((e=e+(t&n|r&~n)+i+o)<<a|e>>>32-a)+t}function O(e,t,r,n,i,a,o){return((e=e+(t^r^n)+i+o)<<a|e>>>32-a)+t}function A(e,t,r,n,i,a,o){return((e=e+(r^(t|~n))+i+o)<<a|e>>>32-a)+t}for(var e=pr,t=(n=e.lib).WordArray,r=n.Hasher,n=e.algo,k=[],i=0;i<64;i++)k[i]=4294967296*a.abs(a.sin(i+1))|0;n=n.MD5=r.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=e[o=t+r];e[o]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var i,a,r=this._hash.words,o=e[t+0],s=(n=e[t+1],e[t+2]),u=e[t+3],c=e[t+4],d=e[t+5],l=e[t+6],h=e[t+7],p=e[t+8],f=e[t+9],_=e[t+10],m=e[t+11],y=e[t+12],v=e[t+13],g=e[t+14],b=e[t+15],w=r[0],E=A(E=A(E=A(E=A(E=O(E=O(E=O(E=O(E=S(E=S(E=S(E=S(E=T(E=T(E=T(E=T(E=r[1],a=T(a=r[2],i=T(i=r[3],w=T(w,E,a,i,o,7,k[0]),E,a,n,12,k[1]),w,E,s,17,k[2]),i,w,u,22,k[3]),a=T(a,i=T(i,w=T(w,E,a,i,c,7,k[4]),E,a,d,12,k[5]),w,E,l,17,k[6]),i,w,h,22,k[7]),a=T(a,i=T(i,w=T(w,E,a,i,p,7,k[8]),E,a,f,12,k[9]),w,E,_,17,k[10]),i,w,m,22,k[11]),a=T(a,i=T(i,w=T(w,E,a,i,y,7,k[12]),E,a,v,12,k[13]),w,E,g,17,k[14]),i,w,b,22,k[15]),a=S(a,i=S(i,w=S(w,E,a,i,n,5,k[16]),E,a,l,9,k[17]),w,E,m,14,k[18]),i,w,o,20,k[19]),a=S(a,i=S(i,w=S(w,E,a,i,d,5,k[20]),E,a,_,9,k[21]),w,E,b,14,k[22]),i,w,c,20,k[23]),a=S(a,i=S(i,w=S(w,E,a,i,f,5,k[24]),E,a,g,9,k[25]),w,E,u,14,k[26]),i,w,p,20,k[27]),a=S(a,i=S(i,w=S(w,E,a,i,v,5,k[28]),E,a,s,9,k[29]),w,E,h,14,k[30]),i,w,y,20,k[31]),a=O(a,i=O(i,w=O(w,E,a,i,d,4,k[32]),E,a,p,11,k[33]),w,E,m,16,k[34]),i,w,g,23,k[35]),a=O(a,i=O(i,w=O(w,E,a,i,n,4,k[36]),E,a,c,11,k[37]),w,E,h,16,k[38]),i,w,_,23,k[39]),a=O(a,i=O(i,w=O(w,E,a,i,v,4,k[40]),E,a,o,11,k[41]),w,E,u,16,k[42]),i,w,l,23,k[43]),a=O(a,i=O(i,w=O(w,E,a,i,f,4,k[44]),E,a,y,11,k[45]),w,E,b,16,k[46]),i,w,s,23,k[47]),a=A(a,i=A(i,w=A(w,E,a,i,o,6,k[48]),E,a,h,10,k[49]),w,E,g,15,k[50]),i,w,d,21,k[51]),a=A(a,i=A(i,w=A(w,E,a,i,y,6,k[52]),E,a,u,10,k[53]),w,E,_,15,k[54]),i,w,n,21,k[55]),a=A(a,i=A(i,w=A(w,E,a,i,p,6,k[56]),E,a,b,10,k[57]),w,E,l,15,k[58]),i,w,v,21,k[59]),a=A(a,i=A(i,w=A(w,E,a,i,c,6,k[60]),E,a,m,10,k[61]),w,E,s,15,k[62]),i,w,f,21,k[63]);r[0]=r[0]+w|0,r[1]=r[1]+E|0,r[2]=r[2]+a|0,r[3]=r[3]+i|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32;var i=a.floor(r/4294967296);for(t[15+(64+n>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t[14+(64+n>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,r=0;r<4;r++)n=t[r],t[r]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8);return e},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}}),e.MD5=r._createHelper(n),e.HmacMD5=r._createHmacHelper(n)}(Math),window.CryptoJS=pr;var a=m.DataCenter.global.get("$ROOM.room_id"),t="betard/"+(a=a||window.room_id),_=m.DataCenter.cookie()||{},d=_.get("uid"),i="/roomapi/biz/getSwitch?rid="+a,_r={$DATA:t=5==+_.get("groupid")||+d==+m.DataCenter.global.get("$ROOM.owner_uid")?"betard/"+a+"?_r="+Math.random():t,$ROLE_BARRAGE_SWITCH:i};window.GIAS||m.DataCenter.event.load().subscribe(function(e){m.DataCenter.setCommonDataConfig(_r),m.DataCenter.common.get("$DATA")}),Object(ve.c)(Object(g.getIsDebug)()),(-1<window.document.referrer.indexOf("//graph.qq.com/oauth2.0/show")||-1<window.document.referrer.indexOf("//open.weixin.qq.com/connect/qrconnect")||-1<window.document.referrer.indexOf("//api.weibo.com/oauth2/authorize"))&&(V.c("realRateModel",-1),V.c("thridLoginPlayer",0));var mr=void 0,yr=void 0;function vr(){return mr}function gr(e){var t=document.getElementById("js-player-video-first");return mr&&(mr.destroy(1),mr=null),(Object(g.showVideo)()||3===e)&&(Object(g.showVideo)()||Object(g.notifyLoadjs)(),(mr=new hr).init(t,e),mr)}var br="",wr=!1;function Er(){var r=this;wr=!0;var e=window.webRoomEnter,t=document.getElementById("js-player-video-first");document.getElementById("room-flash-player")||((n=document.createElement("div")).id="room-flash-player",t.appendChild(n));var n=Object(g.getFlashvars)();window.__player.flashShellLoadTime=(new Date).getTime(),window.swfobject.embedSWF(e,"room-flash-player","100%","100%","0","",n,{quality:"high",bgcolor:"#333333",allowscriptaccess:"always",allowfullscreen:"true",wmode:"Opaque",allowFullScreenInteractive:"true"},{id:"room-flash-player",name:"room-flash-player",align:"middle",allowscriptaccess:"always",allowfullscreen:"true",allowFullScreenInteractive:"true"},function(e){var t=e.success,e=e.ref;t?(window.flashPlayer=e,window.setFlashPlayer&&window.setFlashPlayer()):r.logger.warn("嵌入Flash播放器失败")})}function Tr(e,t){var r=1<arguments.length&&void 0!==t?t:0,t=Object(g.checkH5)();if(1===r?t=!0:2===r&&(t=!1),window.$Player={useh5:t},t&&Object(g.openFirst)())ve.a.log("enable fast video."),window.FIRST_VIDEO=!0,window.__use_player_video_ready=!0,gr(e);else if(!t){if(Object(g.showVideo)()&&(window.FIRST_VIDEO=!0,window.__use_player_video_ready=!0),wr)return Er(),0;(br=document.createElement("script")).src=Object(g.getPageData)("$SYS.res_flash_url")+"v2/swfobject.js",br.onload=Er,br.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(br)}}window.checkCreateFirstVideo=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;window.$Player={useh5:!e},0===e?(Object(g.openFirst)()&&(ve.a.log("enable fast video."),window.FIRST_VIDEO=!0,window.__use_player_video_ready=!0,gr(2)),window.swfobject&&window.swfobject.removeSWF("room-flash-player")):Tr(e,2)},window.destroyFirstVideo=function(e){mr&&mr.destroy(e),mr=null};i=window.location.href.indexOf("carnivalBarrageRoom");window.GIAS?-1===i&&m.DataCenter.common.get("Player.room").subscribe(function(e){e&&e.decrypt&&1===e.decrypt.status?Tr(0,0):ve.a.warn("多房间专题页没有初始化H5播放器")}):-1===i&&Tr(0,0),window.flashTwoLoad=function(){var e;e="room-flash-player",(yr=(-1!==navigator.appName.indexOf("Microsoft")?window:document)[e])&&yr.loadTwo&&yr.loadTwo(),window.playerJSok=!0};i=document.getElementsByClassName("layout-Player-videoMain")[0];i&&(i.addEventListener("mousemove",function(){window.$Player&&!window.$Player.useh5&&Object(b.a)(Re.m,{})}),i.addEventListener("mouseleave",function(){window.$Player&&!window.$Player.useh5&&Object(b.a)(Re.l,{})}))},"1cce9":function(e,t){e.exports="https://shark2.douyucdn.cn/front-publish/live-master/assets/wasm/7e23150678a0f1673e1faccf44a06635_a18a4d3.wasm"},"26d59":function(e,t,r){e.exports=r("9b638")("26d59")},"300f3":function(e,t,r){e.exports={bg:"_1mkeE5FoAGEpF_lL5zlZRC",yzBg:"_2D8rsQEl1J7W6Ud_6l0VGe"}},"366c1":function(e,t,r){"use strict";r.r(t),r.d(t,"get$ROOM",function(){return o}),r.d(t,"notifyLoadjs",function(){return E}),r.d(t,"checkH5",function(){return d}),r.d(t,"getIsDebug",function(){return l}),r.d(t,"isNextDay",function(){return h}),r.d(t,"getDid",function(){return p}),r.d(t,"getPageData",function(){return f}),r.d(t,"callLater",function(){return _}),r.d(t,"bindAll",function(){return m}),r.d(t,"runGlobalJs",function(){return T}),r.d(t,"chooseP2P",function(){return S}),r.d(t,"switchToFlash",function(){return O}),r.d(t,"isSupermanager",function(){return A}),r.d(t,"getIsHostlive",function(){return k}),r.d(t,"delayStreamWhilte",function(){return P}),r.d(t,"useRawPlay",function(){return I}),r.d(t,"isVRPlayer",function(){return R}),r.d(t,"setH265BackLocastorege",function(){return D}),r.d(t,"roomIsOpenH265",function(){return L}),r.d(t,"setSupportAccelerator",function(){return C}),r.d(t,"isSupportAccelerator",function(){return B}),r.d(t,"checkIsSupporH265",function(){return U}),r.d(t,"getisTickect",function(){return H}),r.d(t,"setisTickect",function(){return F}),r.d(t,"streamHandle",function(){return V}),r.d(t,"showVideo",function(){return W}),r.d(t,"openFirst",function(){return G}),r.d(t,"getFlashvars",function(){return q}),r.d(t,"setEmbedmentShowTime",function(){return Y}),r.d(t,"setauthenticationTime",function(){return K}),r.d(t,"sendPairFrameStatePoint",function(){return $}),r.d(t,"setEmbedmentPlayer",function(){return re}),r.d(t,"setAuthenticationPlayer",function(){return ne}),r.d(t,"setInPairFrameState",function(){return oe}),r.d(t,"getInPairFrameState",function(){return se}),r.d(t,"videoPairFrame",function(){return ce}),r.d(t,"starVideoPairFrame",function(){return de}),r.d(t,"closeVideoPairFrame",function(){return le}),r.d(t,"authenticationPlayerComplate",function(){return he}),r.d(t,"getembedmentPlayerOK",function(){return pe}),r.d(t,"getauthenticationPlayerOk",function(){return fe}),r.d(t,"prfLoad",function(){return ye}),r.d(t,"getbrowsType",function(){return ve}),r.d(t,"setvipBack",function(){return ge}),r.d(t,"isVip",function(){return be}),r.d(t,"getuid",function(){return we}),r.d(t,"setIsPlayAudio",function(){return Te}),r.d(t,"getIsPlayAudio",function(){return Se}),r.d(t,"setIsInHide",function(){return Ae}),r.d(t,"getIsInHide",function(){return ke}),r.d(t,"setISinping",function(){return Ie}),r.d(t,"getISinping",function(){return xe}),r.d(t,"isSuperHideGetAudio",function(){return Me}),r.d(t,"setrequstTime",function(){return Re}),r.d(t,"getrequstTime",function(){return De});var n=r("e55c4"),y=r("82e48"),v=r("5e757"),g=r("4f033"),s=r("d30de"),i=r("3b42b"),b=r("51bc5"),w=r("5675a"),u=r("d1a6f"),a=r("0fa6e");function o(){return n.DataCenter.global.get("$ROOM")||{}}var c=!1;function E(){window.player_video_ready&&!c&&(c=!0,window.player_video_ready.next())}function d(){var e=location.search;if(-1!==e.search("[?&]useflash(&|$)"))return!1;e=-1!==e.search("[?&]useh5(&|$)");return(1===o().defaulth5||e)&&function(){if(!window.vdwdae325w_64we)return!1;var e=navigator.userAgent,t=e.toLowerCase().match(/version\/([\d{2}]+).*safari/);if(t){var r=parseInt(t[1],10);if(!Number.isNaN(r)&&11<=r)return!0}if(t=e.match(/Chrome\/(\d{2})/)){r=parseInt(t[1],10);if(!Number.isNaN(r)&&43<=r)return!0}if(t=e.match(/Firefox\/(\d{2})/)){t=parseInt(t[1],10);if(!Number.isNaN(t)&&43<=t)return!0}return!1}()}function l(){return 0<window.location.href.indexOf("shark_debug=2")||0<window.location.href.indexOf("dydg")}function h(e,t,r){t=new Date(t);return e<new Date(t.getFullYear(),t.getMonth(),t.getHours()>=r?t.getDate():t.getDate()-1,r).getTime()}function p(){return""}function f(e){return n.DataCenter.global.get(e)}function _(e){setTimeout(e,0)}function m(r,e){void 0===e&&(e=Object.getPrototypeOf(r)),Object.getOwnPropertyNames(e).forEach(function(e){var t=r[e];"function"==typeof t&&(r[e]=t.bind(r))})}function T(e){var a=e.content,o=e.url;return new Promise(function(e,t){function r(){return n.removeChild(i)}var n=document.head||document.body,i=document.createElement("script");a?i.text=a:(i.src=o,i.async=!0),i.onload=function(){r(),e()},i.onerror=function(){r(),t(new Error("load "+o+" failed."))},n.appendChild(i)})}function S(a,o){return Promise.resolve().then(function(){if(o)return"";var e=Object(g.j)(["app","isHostlive"]),t=Object(g.j)(["app","isLogin"]),r=Object(g.j)(["app","isPhone"]),n=Object(g.j)(["ticket","isTicketNeed"]),i="";return 0<a&&(1==+a?i=s.g.XY:2==+a?i=s.g.QQ:3==+a?i=s.g.WS:9!=+a&&10!=+a||(i=s.g.DOUYU)),e||!a||t&&r&&n?"":i})}function O(){window.__player&&window.__player.switchPlayer(!1)}function A(){return 5==+Object(i.d)("groupid")}function k(){var e=f("$ROOM.owner_uid"),t=Object(i.d)("uid")||"0";return!(!e||e!==Number(t))}function P(){return!1}function I(){return!0}var x=0,M=!1,j=!0;function R(){return M}function D(){var e=(new Date).valueOf();y.c("H265BackTime",e)}function L(){return 431460==+f("$ROOM.room_id")}function C(e){e?localStorage.setItem("isSupportAccelerator",1):localStorage.setItem("isSupportAccelerator",0)}function B(){return"1"===localStorage.getItem("isSupportAccelerator")}function U(t){if(Object(g.j)(["videoModule","player","accOpen"])){void 0===t&&(t=Object(g.j)(["app","cdn"]));var e=Object(g.j)(["app","roomInfo","cdnsWithName"])||[],r=Object(g.j)(["videoModule","player","acceleratorRollback"]),n=Object(g.j)(["videoModule","player","useH265"]),e=e.find(function(e){return e.cdn===t}),e=e&&e.isH265;return!(!n||r||!e)}return!!(864e5<(new Date).valueOf()-y.b("H265BackTime",0)&&a.LivePlayer.isH265Supported&&a.LivePlayer.isH265Supported()&&L())}var N=!1;function H(){return N}function F(e){N=e}function V(r,n,e,i,a,t){try{M=!(!r||1!=+r.smt)&&(j&&(Object(g.a)(w.k),j=!1),!0),t||Object(g.b)({id:"loading",action:"showLoading",data:[!0]});for(var o=r.multirates,s=0;s<o.length;s++)o[s].type=o[s].rate;var u=o.find(function(e){return e.type===n}),c=u?u.name:"",d=o&&1<o.length?1:0,l=d,h=r.cdnsWithName;Object(v.b)().app.pageRateSwitch=l,Object(g.b)({id:"app",action:"changePageRateSwitch",data:[l]});var p=void 0,f=!1;void 0!==r.eticket&&null!=r.eticket?(p=r.eticket,F(f=!0)):F(!1);var _="",m=U(r.rtmp_cdn)&&r.player_1?1:0;S(m?r.h265_p2p:r.p2p,e).then(function(e){_=e}).then(function(){Object(g.b)({id:"ticket",action:"initeticketData",data:[p]});var e={src:null,p2p:_,ish265:m,streamName:c,streamStatus:r.streamStatus,isPreload:i,p2pValue:r.p2p,p2pCids:m?r.h265_p2p_cids:r.p2pCids,p2pMeta:r.p2pMeta};Object(g.b)({id:"videoModule",action:"refeshplayerP2pData",data:[e]});var t={cdnsWithName:h,is_pass_player:r.isPassPlayer};y.c("realRateModel",r.rate);e={multirates:o,rateSwitch:d,rate:r.rate};Object(v.e)(t,e),f?Object(g.b)({id:"LoadVideoNet",action:"loadTicketStream",data:[a,n,p]}):Object(g.b)({id:"LoadVideoNet",action:"streamDataHandle",data:[r]})})}catch(r){b.a.warn(r+"streamHandle err"),E()}}function W(){var e=1==+f("$ROOM.show_status")||Object(v.b)().app.Status,t=Object(i.d)("groupid"),r=f("$ROOM.owner_uid"),n=Object(i.d)("uid")||"0",n=!(!r||r!==Number(n));return e||!e&&(1==+n||5==+t)}function G(){return!0}function q(){var e={};return e.DomainName=window.location.host,e.cdn=function(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]"),e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))}("cdn")||"",e.asset_url=f("$SYS.res_url"),e.usergroupid=Object(i.d)("groupid")||"0",e.uid=+(Object(i.d)("uid")||0),e.RoomId=f("$ROOM.room_id"),e.RoomTitle=f("$ROOM.room_name"),e.OwnerId=f("$ROOM.owner_uid"),e.Status=1==+f("$ROOM.show_status"),e.roompass=f("$ROOM.room_pwd"),0<navigator.appVersion.indexOf("MSIE")?e.barrage_delay_time=400:e.barrage_delay_time=250,e.phonestatus=Object(i.d)("phonestatus")||0,e.did=Object(i.d)("did"),e.avatar_url=f("$SYS.avatar_url"),e.logUrl=f("$SYS.fh2")||"",window.__player||(window.__player={},window.__player.getGlobal=f),e}var z=-1;function Y(e){z=e}var X=-1;function K(e){X=e}var J=1;function $(e,t){var r,n;1===J&&(J=2,b.a.log("show_frame_con"+e),r=Object(g.j)(["videoModule","player","p2p"]),n=z<X&&-1!==z?X-z:0,Object(g.d)("show_frame_con",{result:e,errcode:t,Eurl:window.streamUrl,isp2p:r,codeVer:"2019112601",dTime:n},""))}var Z=null,Q=null,ee=!1,te=!1;function re(e){Z=e,ee=!0}function ne(e){Q=e,te=!0,ee||(u.a.emit("videoPairFrame10Over",1),b.a.log("鉴权播放器比预埋流先来"),$(0,1))}var ie=null,ae=null;function oe(e,t){2===(x=e)?$(1,t):3===e&&$(0,t)}function se(){return x}var ue=50;function ce(){var o,s;clearInterval(ie),ie=setInterval(function(){if(Z&&Q){oe(1);var e=Z.T_ADV_Timestamp(),t=Q.T_ADV_Timestamp();if(e&&t){var r=1e3*Z._video.currentTime,n=e.keyframes;if(o=e.seiTimestamp-1e3*e.bufferLength,s=t.seiTimestamp-1e3*t.bufferLength,b.a.log("aaa- "+(o-s)+" buf:"+1e3*t.bufferLength),n)for(var i=0;i<n.length;i++){var a=1e3*n[i];if(a-ue<r&&r<a+ue){b.a.log("寻找到关键帧 关键帧数据"+i+" 是播放"+a+"秒与当前播放误差在"+(a-r));a=o+a-r;if(s<a&&t.seiTimestamp>a)return b.a.log("关键帧在缓存区域 关键帧时间搓"+a),ie&&clearInterval(ie),clearInterval(ae),u.a.emit("videoPairFrameCan",{time:a}),void oe(2)}}}}},30)}function de(){te?u.a.emit("videoPairFrameOverErr",{type:1}):(ce(),ae=setInterval(function(){clearInterval(ie),clearInterval(ae),u.a.emit("videoPairFrame10Over",x),2!==x&&oe(3,2)},1e4))}function le(e,t){}function he(){clearInterval(ie),clearInterval(ae),oe(3,3),Object(g.b)({id:"videoModule",action:"setPlayerError",data:[3]})}function pe(){return ee}function fe(){return te}var _e=1,me=!1;function ye(e){var t;1===_e&&((t=1)==+f("$ROOM.isVip")&&(t=me?3:2),(k()||A())&&(t=1),e.gst=t,Object(g.a)(w.g,e),_e=2)}function ve(){var e={},t=navigator.userAgent.toLowerCase(),r=void 0,n=void 0;return t.match(/msie ([\d.]+)/)?(r=t.match(/msie ([\d.]+)/),e.ie=r[1]):t.match(/firefox\/([\d.]+)/)?(r=t.match(/firefox\/([\d.]+)/),e.firefox=r[1]):t.match(/chrome\/([\d.]+)/)?(r=t.match(/chrome\/([\d.]+)/),e.chrome=r[1]):t.match(/opera.([\d.]+)/)?(r=t.match(/opera.([\d.]+)/),e.opera=r[1]):t.match(/version\/([\d.]+).*safari/)&&(r=t.match(/version\/([\d.]+).*safari/),e.safari=r[1]),!e.ie&&t.match(/trident/)&&(e.ie=t.match(/rv:([\d].)/)[1]),t.match(/edge\/([(\d).]+)/)&&(e.edge=t.match(/edge\/([(\d).]+)/)[1]),e.ie&&(n="IE: "+e.ie),e.edge&&(n="Edge: "+e.edge),e.firefox&&(n="Firefox: "+e.firefox),e.chrome&&!document.getBoxObjectFor&&(n="Chrome: "+e.chrome),e.opera&&(n="Opera: "+e.opera),n=e.safari?"Safari: "+e.safari:n}function ge(){me=!0}function be(){return!k()&&!A()&&1==+f("$ROOM.isVip")&&!me}function we(){return Object(i.d)("uid")||"0"}var Ee=!1;function Te(e){Ee=e}function Se(){return Ee}var Oe=!1;function Ae(e){Oe=e}function ke(){return Oe}var Pe=!0;function Ie(e){Pe=e}function xe(){return Pe}function Me(){var e=Object(g.j)(["app","streamInfo","isH265"])?1:0,t=Object(g.j)(["app","isHostlive"]),r=A(),n=Object(g.j)(["app","inVod"]),i=Object(g.j)(["app","inpip"]),a=Object(g.j)(["app","IspwdRoom"]),o=Object(g.j)(["app","illegal"]);return!(e||t||r||n||o||a||N||i||Pe)}var je=0;function Re(e){je=e}function De(){return je}},"3b42b":function(e,t,r){"use strict";r.d(t,"b",function(){return k}),r.d(t,"g",function(){return P}),r.d(t,"e",function(){return I}),r.d(t,"d",function(){return x}),r.d(t,"c",function(){return j}),r.d(t,"f",function(){return M}),r.d(t,"a",function(){return _});var n,i,a,o,s,u,c,d=r("e55c4"),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function h(e,t,r,n){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function p(r,n,e,t,i){var a={};return Object.keys(t).forEach(function(e){a[e]=t[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=e.slice().reverse().reduce(function(e,t){return t(r,n,e)||e},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(r,n,a),a=null),a}var f=function(n){return function(e,t){var r=void 0===n?"undefined":l(n);return"object"===r?e[t]=n:"Service"===Object.getPrototypeOf(n).name||-1!==n.name.toLowerCase().indexOf("service")||n.prototype.type&&-1!==n.prototype.type.indexOf("service")?(void 0===n.instance&&(n.instance=new n),e[t]=n.instance):"function"===r&&(e[t]=n()),e}},_=(n=f(d.DataCenter.acj),i=f(d.DataCenter.global),a=f(d.DataCenter.sessionStorage),t=f(d.DataCenter.cookie),w.prototype.pushData=function(e,t){this.acj.push(e,t,0)},w.prototype.MonitorData=function(e,t){this.acj.get(e).subscribe(function(){t(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})})},w.prototype.getDid=function(){return this.cookie.get("did")||"10000000000000000000000000001501"},w.prototype.setSessionStorage=function(e,t){this.sessionStorage.set(e,t)},w.prototype.getCookie=function(e){return this.cookie.get(e)||""},w.prototype.getSys=function(){return this.global.get("$SYS")||""},w.prototype.getSessionStorage=function(e){return this.sessionStorage.get(e)},w.prototype.setPlayerVersion=function(e){this.global.set("PLAYER_VERSION",e)},o=p((f=w).prototype,"acj",[n],{enumerable:!0,initializer:null}),s=p(f.prototype,"global",[i],{enumerable:!0,initializer:null}),u=p(f.prototype,"sessionStorage",[a],{enumerable:!0,initializer:null}),c=p(f.prototype,"cookie",[t],{enumerable:!0,initializer:null}),f),m=r("5675a"),y=r("4f033"),v=r("5e757"),g=r("366c1"),b=r("d1a6f");function w(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w),h(this,"acj",o,this),h(this,"global",s,this),h(this,"sessionStorage",u,this),h(this,"cookie",c,this)}var E=r("51bc5"),T=void 0;function S(e){var t=e.action,r=e.id,e=e.data;Object(y.f)(r)?Object(y.f)(r).actionHandle({action:t,data:e}):function(e,t,r){if("controller"===e)"setShowHeight"===t&&!function(e){Object(v.b)().controller.showHeight=e,Object(y.f)("videoBg")&&Object(y.f)("videoBg").updateScale()}.apply(void 0,r);else if("xvideoModule"===e)switch(t){case"setOpenWichVideo":!function(e){Object(v.b)().xvideoModule.xplayer.openWichVideo=e,Object(y.f)("videoModule")&&Object(y.f)("videoModule").refreshPlayer(),Object(y.f)("videoModule")&&Object(y.f)("videoModule").viewFresh()}.apply(void 0,r);break;case"openshowXc":!function(e){Object(v.b)().xvideoModule.xplayer.showXc=e,Object(y.f)("videoModule")&&Object(y.f)("videoModule").viewFresh()}.apply(void 0,r);break;case"showmusicIconfun":!function(e){Object(v.b)().xvideoModule.xplayer.showmusicicon=e}.apply(void 0,r)}else if("ticket"===e)"userTickStream"===t&&function(e){Object(v.b)().ticket.rtmp_url=e.rtmp_url,Object(v.b)().ticket.rtmp_live=e.rtmp_live}.apply(void 0,r);else if("app"===e)switch(t){case"playBigModel":!function(e){Object(v.b)().app.playbModel=e,Object(y.f)("videoModule")&&Object(y.f)("videoModule").viewFresh()}.apply(void 0,r);break;case"initDelayRoomInfo":!function(e){Object(v.b)().app.roomInfo.isVertical=e.roomInfo.isVertical,Object(v.b)().app.roomInfo.roomSrc=e.roomInfo.roomSrc,Object(y.f)("videoBg")&&Object(y.f)("videoBg").updateURL()}.apply(void 0,r);break;case"setAutoPlay":!function(e){Object(v.b)().app.canAutoPlay=e,Object(y.f)("videoModule")&&Object(y.f)("videoModule").refreshPlayer()}.apply(void 0,r);break;case"setPagescreen":!function(e){Object(v.b)().app.isWebFullscreen=e,Object(y.f)("videoModule")&&Object(y.f)("videoModule").viewFresh()}.apply(void 0,r);break;case"setFullScreen":!function(e){Object(v.b)().app.isFullscreen=e,Object(y.f)("videoModule")&&Object(y.f)("videoModule").viewFresh()}.apply(void 0,r);break;case"resize":!function(e,t){Object(v.b)().app.width=e,Object(v.b)().app.height=t,Object(y.f)("videoModule")&&Object(y.f)("videoModule").viewFresh(),Object(y.f)("videoBg")&&Object(y.f)("videoBg").updateScale()}.apply(void 0,r);break;case"refeshStreamInfo":!function(e){Object(v.b)().app.streamInfo=e}.apply(void 0,r);break;case"refreshRidAndCdn":!function(e,t){Object(v.b)().app.rid=e,Object(v.b)().app.cdn=t}.apply(void 0,r);break;case"refreshAppinfo":!function(e,t,r){for(var n in e)Object(v.b)().app.roomInfo[n]=e[n];Object(v.b)().app.rateSwitch=t.rateSwitch,Object(v.b)().app.rate=r.rate,Object(y.f)("videoBg")&&Object(y.f)("videoBg").updateURL()}.apply(void 0,r);break;case"initRoomInfo":!function(e,t,r){for(var n in e)Object(v.b)().app.roomInfo[n]=e[n];Object(v.b)().app.rateSwitch=t.rateSwitch,Object(v.b)().app.rate=r.rate,Object(y.f)("videoBg")&&Object(y.f)("videoBg").updateURL()}.apply(void 0,r);break;case"changePageRateSwitch":!function(e){Object(v.b)().app.pageRateSwitch=e}.apply(void 0,r);break;case"changeRateSwitch":!function(e){Object(v.b)().app.rateSwitch=e}.apply(void 0,r);break;case"manualLoadVideo":!function(e){Object(v.b)().app.manualLoadVideo=e.manualLoadVideo}.apply(void 0,r);break;case"freshUip":!function(e){Object(v.b)().app.uip=e}.apply(void 0,r);break;case"freshRate":!function(e){Object(v.b)().app.rate=e}.apply(void 0,r);break;case"freshCdn":!function(e){Object(v.b)().app.cdn=e}.apply(void 0,r);break;case"closeRoom":n=x("groupid"),i=Object(g.getPageData)("$ROOM.owner_uid"),a=x("uid")||"0",o=1==+!(!i||i!==Number(a))||5==+n,d.DataCenter.common.get("$DATA").subscribe(function(e){var t=0;20==+(t=e.room&&e.room.cate1_id?+e.room.cate1_id:t)?!o&&window.destroyFirstVideo&&window.destroyFirstVideo(2):(!o&&window.destroyFirstVideo&&window.destroyFirstVideo(1),Object(y.f)("videoBg")&&Object(y.f)("videoBg").destroy())});break;case"enterVod":!function(e){Object(v.b)().app.inVod=e}.apply(void 0,r);break;case"checkIspwdRoom":!function(e){Object(v.b)().app.IspwdRoom=e}.apply(void 0,r);break;case"setInPIP":!function(e){Object(v.b)().app.inpip=e}.apply(void 0,r);break;case"changeIllegal":!function(e){Object(v.b)().app.illegal=e}.apply(void 0,r);break;case"enterUseNoHandle":!function(e){Object(v.b)().app.isenterUseNoHandle=e}.apply(void 0,r)}else"tcp"===e&&"updateLoginres"===t&&function(e){(Object(v.b)().tcp.loginres=e)&&b.a.emit("updateLoginres",{uid:e.userid||"0"})}.apply(void 0,r);var n,i,a,o}(r,t,e)}function O(){E.a.warn("aaaaaaaa+收到第二梯队业务ok"),Object(y.h)()}var A=void 0;function k(e){T=T||new _,A||(T.MonitorData(m.o,S),T.MonitorData(m.e,O),A=!0),!0===window.playerBusinessREADY&&O(),T.setPlayerVersion(e)}function P(e,t){(T=T||new _).pushData(e,t)}function I(){return(T=T||new _).getDid()}function x(e){return(T=T||new _).getCookie(e)}function M(){return(T=T||new _).getSys()}function j(){}},41571:function(s,e,u){"use strict";!function(e){var r=u("c9415"),n=u("c7646"),t={"Content-Type":"application/x-www-form-urlencoded"};function i(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var a,o={adapter:a="undefined"!=typeof XMLHttpRequest||void 0!==e?u("13c9f"):a,transformRequest:[function(e,t){return n(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(i(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)?(i(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],function(e){o.headers[e]={}}),r.forEach(["post","put","patch"],function(e){o.headers[e]=r.merge(t)}),s.exports=o}.call(this,u("26d59"))},48936:function(e,t,r){"use strict";var n=r("c9415");function i(){this.handlers=[]}i.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(t){n.forEach(this.handlers,function(e){null!==e&&t(e)})},e.exports=i},"4f033":function(e,t,r){"use strict";r.d(t,"i",function(){return y}),r.d(t,"b",function(){return f}),r.d(t,"d",function(){return v}),r.d(t,"j",function(){return w}),r.d(t,"f",function(){return p}),r.d(t,"h",function(){return m}),r.d(t,"c",function(){return g}),r.d(t,"a",function(){return _}),r.d(t,"g",function(){return b}),r.d(t,"e",function(){return E});var a=r("5e757"),i=r("3b42b"),o=r("5675a"),n=[],s=!1,u=[],c=[],d=[],l=[],h=[];function p(e){for(var t=0;t<n.length;t++){var r=n[t];if(r.id===e)return r}return null}function f(e){var t=e.id,r=e.action,n=e.data,e=p(t);e&&e.actionHandle({action:r,data:n}),"LoadVideoNet"!==t&&(s?Object(i.g)(o.r,{id:t,action:r,data:n}):u.push({id:t,action:r,data:n}))}function _(e,t){"room_mouse_move"===e||"room_mouse_leave"===e?Object(i.g)(e,t):s?Object(i.g)(o.p,{type:e,data:t}):l.push({type:e,data:t})}function m(){s=!0,Object(i.g)(o.s,u),Object(i.g)(o.w,c),Object(i.g)(o.t,d),Object(i.g)(o.q,l),Object(i.g)(o.y,h)}function y(e){n=e}function v(e,t,r){s?Object(i.g)(o.v,{type:e,data:t,av:r}):c.push({type:e,data:t,av:r})}function g(e,t,r){s?Object(i.g)(o.u,{modu:e,mid:t,det:r}):d.push({modu:e,mid:t,det:r})}function b(e){s?Object(i.g)(o.x,e):h.push(e)}function w(e){var t=e[0],r=p(t),n=0;try{for(var n=r?r.getMoudleDate():Object(a.b)()[t],i=1;i<e.length;i++)n=n[e[i]]}catch(e){n=0}return n}function E(){s=!(n=[]),u=[],c=[],d=[],l=[],h=[],Object(i.c)()}},"51bc5":function(e,t,r){"use strict";r.d(t,"c",function(){return n}),r.d(t,"b",function(){return o});var a=!1;function n(e){a=e}function i(n){for(var e=arguments.length,t=Array(1<e?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];var i=["[html5 player]"].concat(t.map(function(e){return"["+e+"]"}));return function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a&&n.call.apply(n,[console].concat(i,t))}}function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return{log:i.apply(void 0,[console.log].concat(t)),debug:i.apply(void 0,[console.debug].concat(t)),info:i.apply(void 0,[console.info].concat(t)),warn:i.apply(void 0,[console.warn].concat(t)),error:i.apply(void 0,[console.error].concat(t))}}t.a=o("first")},"5675a":function(e,t,r){"use strict";r.d(t,"i",function(){return n}),r.d(t,"g",function(){return i}),r.d(t,"f",function(){return a}),r.d(t,"j",function(){return o}),r.d(t,"a",function(){return s}),r.d(t,"c",function(){return u}),r.d(t,"b",function(){return c}),r.d(t,"o",function(){return d}),r.d(t,"e",function(){return l}),r.d(t,"r",function(){return h}),r.d(t,"s",function(){return p}),r.d(t,"v",function(){return f}),r.d(t,"w",function(){return _}),r.d(t,"p",function(){return m}),r.d(t,"q",function(){return y}),r.d(t,"t",function(){return v}),r.d(t,"u",function(){return g}),r.d(t,"x",function(){return b}),r.d(t,"y",function(){return w}),r.d(t,"h",function(){return E}),r.d(t,"d",function(){return T}),r.d(t,"n",function(){return S}),r.d(t,"k",function(){return O}),r.d(t,"m",function(){return A}),r.d(t,"l",function(){return k});var n="player_load_o",i="room_video_catchtime",a="room_data_idle",o="room_bus_checksevertime",s="ASSIST_BUFFER_EMPTY",u="ASSIST_PLAY_ERROR",c="ASSIST_PLAY_COMPLETE",d="video_play_business",l="business_to_video_ready",h="js_to_business_action",p="js_to_business_action_list",f="js_to_business_point",_="js_to_business_point_list",m="js_to_business_acj",y="js_to_business_acj_list",v="js_to_business_asstion_list",g="js_to_business_asstion_point",b="js_to_keeplive_point",w="js_to_keeplive_point_list",E="GET_SDK_SUS",T="BEGIN_START_LOADER",S="room_ticket_status",O="room_bus_isVrRoom",A="room_mouse_move",k="room_mouse_leave"},"5e757":function(e,t,r){"use strict";r.d(t,"c",function(){return n}),r.d(t,"a",function(){return o}),r.d(t,"e",function(){return a}),r.d(t,"d",function(){return i}),r.d(t,"b",function(){return p}),r.d(t,"f",function(){return h});var s=r("d30de"),u=r("82e48"),c=r("3b42b"),d={$ROOM:{}},l={app:{Status:!0,usergroupid:"",rid:0,isLogin:!1,haveChangeMultirates:1,definitionConfig:"",rate:u.b("realRateModel","-1"),isYuanHua:!1,cdn:u.b(u.a.player_storage_cdn,""),isYuanhua:!1,pageRateSwitch:0,streamInfo:{},roomInfo:{},width:1217,height:726,isFullscreen:!1,isWebFullscreen:!1,rateSwitch:0,ct:0,uip:"",manualLoadVideo:!1,canAutoPlay:!0,playbModel:!0,isHostlive:!1,isPhone:!1,p2p:""},videoModule:{haveShowVideo:!1},tcp:{loginres:{userid:0}},LoadVideoNet:{requestRoomInfoTimePoint:-1,requestStreamUrlTimePoint:0,starPlayStreamTimePoint:0,loadNum:0},xvideoModule:{xplayer:{showXc:!1,showmusicicon:!1,openWichVideo:!1}},ticket:{isTicketNeed:!1,rtmp_url:void 0,rtmp_live:void 0},controller:{showHeight:s.e}};function n(e){var t,r,n,i,a,o;d.$ROOM.show_status=e.show_status,d.$ROOM.p2p_setting=e.p2p_setting,d.$ROOM.multirates=e.multirates,d.$ROOM.cate_id=e.cate_id,d.$ROOM.isVertical=e.isVertical,d.$ROOM.coverSrc=e.coverSrc,d.$ROOM.owner_avatar=e.owner_avatar,d.$ROOM.isDefaultAvatar=e.isDefaultAvatar,d.$ROOM.roomSrc=e.roomSrc,d.$ROOM.defaultSrc=e.defaultSrc,d.$ROOM.is_high_game=e.is_high_game,d.$ROOM.room_idle=e.room_idle,d.$ROOM.show_status=e.show_status,d.$ROOM.room_id=e.room_id,d.$ROOM.owner_uid=e.owner_uid,d.$ROOM.eticket=e.eticket,d.$ROOM.is_video_high_quality_time=e.is_video_high_quality_time,d.$ROOM.video_high_quality_resolution=e.video_high_quality_resolution,t=d.$ROOM.show_status,r=d.$ROOM.room_id,n=Object(c.d)("uid")||"0",i=d.$ROOM.owner_uid,a=d.$ROOM.eticket,o=d.$ROOM.is_video_high_quality_time,e=d.$ROOM.video_high_quality_resolution,"undefined"!==o&&"undefined"!==e&&(o=[parseInt(e,10),0,parseInt(o,10)],l.ticket.definitionConfig=escape(JSON.stringify(o))),(l={app:{Status:!0,usergroupid:"",rid:0,isLogin:!1,haveChangeMultirates:1,definitionConfig:"",rate:u.b("realRateModel","-1"),isYuanHua:!1,cdn:u.b(u.a.player_storage_cdn,""),isYuanhua:!1,pageRateSwitch:0,streamInfo:{},roomInfo:{},width:1217,height:726,isFullscreen:!1,isWebFullscreen:!1,rateSwitch:0,ct:0,uip:"",manualLoadVideo:!1,canAutoPlay:!0,playbModel:!0,isHostlive:!1,isPhone:!1,p2p:""},videoModule:{haveShowVideo:!1},tcp:{loginres:{userid:0}},LoadVideoNet:{requestRoomInfoTimePoint:-1,requestStreamUrlTimePoint:0,starPlayStreamTimePoint:0,loadNum:0},xvideoModule:{xplayer:{showXc:!1,showmusicicon:!1,openWichVideo:!1}},ticket:{isTicketNeed:!1,rtmp_url:void 0,rtmp_live:void 0},controller:{showHeight:s.e}}).app.Status=1==+t,l.app.usergroupid=Object(c.d)("groupid")||"0",l.app.rid=r,l.app.isLogin=!!(n&&0<parseFloat(n)),l.app.isHostlive=!(!i||i!==Number(n)),l.app.isYuanhua=-1!==["673327","429265"].indexOf(r),l.app.isPhone=1===(Object(c.d)("phonestatus")||0),l.ticket.isTicketNeed=void 0!==a&&""!==a&&null!==a}function i(e){for(var t in e)l.app.streamInfo[t]=e[t]}function a(e,t){for(var r in e)l.app.roomInfo[r]=e[r];l.app.multirates=t.multirates,l.app.rateSwitch=t.rateSwitch,l.app.rate=t.rate}function o(e,t){for(var r in e)l.app.roomInfo[r]=e[r];l.app.rateSwitch=t.rateSwitch,l.app.rate=t.rate}function h(e){var t=e.width,e=e.height;t&&(l.app.width=t),e&&(l.app.height=e)}function p(){return l}},"63e3f":function(e,t,r){"use strict";e.exports=function(r,n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return r.apply(n,e)}}},"68e4d":function(e,t,r){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},"6d420":function(e,t,r){"use strict";var n,i,a,o=r("c9415");function s(e){return i&&(a.setAttribute("href",e),e=a.href),a.setAttribute("href",e),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:"/"===a.pathname.charAt(0)?a.pathname:"/"+a.pathname}}e.exports=o.isStandardBrowserEnv()?(i=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a"),n=s(window.location.href),function(e){e=o.isString(e)?s(e):e;return e.protocol===n.protocol&&e.host===n.host}):function(){return!0}},"6da80":function(e,t,r){"use strict";e.exports=function(t){return function(e){return t.apply(null,e)}}},"7436c":function(e,t){e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},"82e48":function(e,t,r){"use strict";r.d(t,"b",function(){return u}),r.d(t,"c",function(){return c}),r.d(t,"a",function(){return d});var n=r("e55c4"),i=r("51bc5");function a(e){return e+"_h5p_room"}var o=function(e){return n.DataCenter.localStorage.get(e)},s=function(e,t,r){return n.DataCenter.localStorage.set(e,t,r)};function u(e,t){e=o(a(e));return null==e?t:e}function c(e,t){try{s(a(e),t)}catch(t){i.a.warn("set localStorage:"+e+" error.")}}var d={player_storage_volume:"player_storage_volume",player_storage_cdn:"player_storage_cdn",GaoRateTimestamp:"GaoRateTimestamp",RateRecordTime:"rateRecordTime"}},92545:function(e,t,r){"use strict";function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,e.exports=n},"949dc":function(e,t,r){e.exports=r("11489")},"9511e":function(e,t,r){"use strict";var n=r("92545");function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var r=this;e(function(e){r.reason||(r.reason=new n(e),t(r.reason))})}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var t;return{token:new i(function(e){t=e}),cancel:t}},e.exports=i},"9992b":function(e,t,r){"use strict";var i=r("c9415"),a=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,n={};return e&&i.forEach(e.split("\n"),function(e){r=e.indexOf(":"),t=i.trim(e.substr(0,r)).toLowerCase(),r=i.trim(e.substr(r+1)),t&&(n[t]&&0<=a.indexOf(t)||(n[t]="set-cookie"===t?(n[t]||[]).concat([r]):n[t]?n[t]+", "+r:r))}),n}},"99f77":function(e,t,r){function n(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var i,a;e.exports=(i=[function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.makeLogger=void 0;var a=!1;function n(e){a=e}function o(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=i(["[html5 player]","[dylive]"],e.map(function(e){return"["+e+"]"}));return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a&&r.call.apply(r,i([console],n,e))}}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{log:o.apply(void 0,i([console.log],e)),debug:o.apply(void 0,i([console.debug],e)),info:o.apply(void 0,i([console.info],e)),warn:o.apply(void 0,i([console.warn],e)),error:o.apply(void 0,i([console.error],e)),setEnable:n}}t.makeLogger=s,t.default=s()},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.values=t.shallowClone=t.concatUrl=t.resolveUrl=t.isPlayerSupported=t.isMediaSupported=t.isBrowserSupported=t.getRandomId=t.binsert=t.binsearch=t.numberCompare=t.connectEventbus=t.isHls=t.saveAs=t.isH265Supported=t.loadScript=t.isPthreadsSupported=t.isWasmSupported=t.bufferConcat=t.timescaledTime64=t.timescaledTime=t.u8aClone=t.safeClone=t.configClone=t.isBufferEqual=void 0;var i=n(r(36)),a=r(4),o=n(r(7));function s(r){if("object"!=typeof r)return r;var n={};return Object.keys(r).forEach(function(e){var t=r[e];t&&"object"==typeof t?Object.getPrototypeOf(t)===Object.prototype&&(n[e]=s(t)):"function"!=typeof t&&(n[e]=t)}),n}function u(){return"object"==typeof WebAssembly}function c(r,n){return function(e){var t=e.data;if("internalevents"!==t.name)return r(e);(e=n.__internal.eventbus).emit.apply(e,t.params)}}function d(e,t){return+e-+t}function l(e,t,r){if(0===e.length)return 0;if((r=r||d)(t,e[0])<=0)return 0;if(0<=r(t,e[e.length-1]))return e.length;for(var n=0,i=e.length-1;1<i-n;){var a=n+i>>1,o=r(t,e[a]);if(o<0)i=a;else{if(!(0<o))return a;n=a}}return i}function h(){return o.default.chrome&&43<=o.default.version.major||o.default.firefox&&43<=o.default.version.major||o.default.msedge||"mac"===o.default.platform&&o.default.safari&&11<=o.default.version.major}function p(){return MediaSource.isTypeSupported('video/mp4; codecs="avc1.640028, mp4a.40.2"')}t.isBufferEqual=function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0},t.configClone=function(e,t){return self.Worker&&e instanceof self.Worker?s(t):t},t.safeClone=s,t.u8aClone=function(e){var t=new Uint8Array(e.byteLength);return t.set(e,0),t},t.timescaledTime=function(e,t){return Math.round(e*t/1e3)},t.timescaledTime64=function(e,t){return i.default.fromNumber(Math.round(e/1e3*t),!0)},t.bufferConcat=function(e){var t=e.reduce(function(e,t){return e+t.length},0),r=new Uint8Array(t),n=0;return e.forEach(function(e){r.set(e,n),n+=e.length}),r},t.isWasmSupported=u,t.isPthreadsSupported=function(){return!!(u()&&self.SharedArrayBuffer&&self.Atomics&&new WebAssembly.Memory({initial:1,maximum:1,shared:!0}).buffer instanceof SharedArrayBuffer)},t.loadScript=function(n){return new Promise(function(e,t){var r=document.createElement("script");r.onload=e,r.onerror=t,r.src=n,document.head.appendChild(r)})},t.isH265Supported=function(){return MediaSource.isTypeSupported("video/mp4; codecs=hvc1.1.6.L93")},t.saveAs=function(e,t){var r=window.URL.createObjectURL(e),e=document.createElement("a");e.style.display="none",e.href=r,e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e),setTimeout(function(){window.URL.revokeObjectURL(r)},1e3)},t.isHls=function(e){return-1!==e.toLowerCase().indexOf(".m3u8")},t.connectEventbus=function(r,e,t){self.Worker&&r instanceof self.Worker?(t.__internal.eventbus.pipe=function(e,t){return r.postMessage({name:"internalevents",params:[e,t]})},r.onmessage=c(e,t)):r.inWorker?(t.__internal.eventbus=new a.InternalEventBus,t.__internal.eventbus.pipe=function(e,t){return r.dispatchMessage({name:"internalevents",params:[e,t]})},self.onmessage=c(e,t)):r.onmessage=e},t.numberCompare=d,t.binsearch=l,t.binsert=function(e,t,r){e.splice(l(e,t,r),0,t)},t.getRandomId=function(){return Date.now()+"-"+Math.floor(Math.random()*(Math.floor(999999999)-Math.ceil(1)))+Math.ceil(1)},t.isBrowserSupported=h,t.isMediaSupported=p,t.isPlayerSupported=function(){return h()&&p()},t.resolveUrl=function(e,t){return new URL(e,t).href},t.concatUrl=function(e,t){return e=t?e+(-1===e.indexOf("?")?"?":"&")+t:e},t.shallowClone=function(e){return Object.assign({},e)},t.values=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorIds=t.errorRestore=t.errorClone=t.DyDemuxError=t.DyMediaError=t.DyNetworkError=t.DyError=void 0;var a,o=(a=Error,i(s,a),s);function s(e,t,r){void 0===r&&(r=!0);e=a.call(this,e)||this;return e.errorId=0,e.fatal=!0,e.updatedSource=!1,e.errorId=t||m.Unknown,e.name="DyError",e.fatal=r,e}t.DyError=o;var u,c=(i(d,u=o),d);function d(e,t){t=u.call(this,e,t)||this;return t.name="DyNetworkError",t}t.DyNetworkError=c;var l,h=(i(p,l=o),p);function p(e,t){t=l.call(this,e,t)||this;return t.name="DyMediaError",t}t.DyMediaError=h;var f,i=(i(_,f=o),_);function _(e,t){t=f.call(this,e,t)||this;return t.name="DyDemuxError",t}t.DyDemuxError=i,t.errorClone=function(e){return{name:e.name,message:e.message,errorId:e.errorId,stack:e.stack,fatal:e.fatal}};var m,y={Error:o,DyError:o,DyNetworkError:c,DyMediaError:h,DyDemuxError:i};t.errorRestore=function(e){var t=y[e.name];if(t){t=new t(e.message,e.errorId,e.fatal);return t.stack=e.stack,t}return null},(t=m=t.ErrorIds||(t.ErrorIds={}))[t.Unknown=100]="Unknown",t[t.ParserInitError=101]="ParserInitError",t[t.ParserConfigMiss=102]="ParserConfigMiss",t[t.ParserConfigError=103]="ParserConfigError",t[t.ParserDataError=104]="ParserDataError",t[t.ParserCodecUnsupport=105]="ParserCodecUnsupport",t[t.DecoderWasmError=106]="DecoderWasmError",t[t.DecoderInvalidCanvas=107]="DecoderInvalidCanvas",t[t.DecoderDecodeError=108]="DecoderDecodeError",t[t.RenderWebglError=109]="RenderWebglError",t[t.NetworkError=110]="NetworkError",t[t.MediaError=111]="MediaError",t[t.MediaAddSourceBufferError=112]="MediaAddSourceBufferError",t[t.MediaUnsupportCodec=113]="MediaUnsupportCodec",t[t.MediaAppendError=114]="MediaAppendError",t[t.WasmUnsupportError=115]="WasmUnsupportError",t[t.NoSupportedLoader=116]="NoSupportedLoader",t[t.NoSupportedMediaHandler=117]="NoSupportedMediaHandler",t[t.InvalidFlv=118]="InvalidFlv",t[t.UnsupportedFlvAudio=119]="UnsupportedFlvAudio",t[t.UnsupportedFlvVideo=120]="UnsupportedFlvVideo",t[t.InvalidFlvVideoPacket=121]="InvalidFlvVideoPacket",t[t.WorkerError=122]="WorkerError",t[t.HlsM3u8ParseError=123]="HlsM3u8ParseError",t[t.HlsTsNetworkError=124]="HlsTsNetworkError",t[t.HlsM3u8LoadError=125]="HlsM3u8LoadError",t[t.HlsTsCustomError=126]="HlsTsCustomError",t[t.TransmuxerError=127]="TransmuxerError",t[t.UnsupportDemux=128]="UnsupportDemux",t[t.UnsupportRemux=129]="UnsupportRemux",t[t.CustomLoaderError=130]="CustomLoaderError",t[t.UnsupportedError=131]="UnsupportedError",t[t.AcceleratorClosed=132]="AcceleratorClosed",t[t.AcceleratorError=133]="AcceleratorError"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindAll=void 0,t.bindAll=function(r){for(var n=r,i={};r&&r!==Object.prototype;)Object.getOwnPropertyNames(r).forEach(function(e){var t=Object.getOwnPropertyDescriptor(r,e);t&&(t.get||t.set||"function"==typeof n[e]&&(i[e]=!0))}),r=Object.getPrototypeOf(r);Object.keys(i).forEach(function(e){n[e]=n[e].bind(n)})}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InternalEvents=t.InternalEventBus=void 0;var o,a=a(r(17)),s=r(1),i=(o=a.default,i(u,o),u.prototype.emit=function(e,t){return(null==t?void 0:t.__sourceId)!==this.id&&((t=t||{}).__sourceId||(t.__sourceId=this.id),this.pipe&&this.pipe(e,t),o.prototype.emit.call(this,e,t))},u);function u(){var e=null!==o&&o.apply(this,arguments)||this;return e.id=s.getRandomId(),e}t.InternalEventBus=i,(t=t.InternalEvents||(t.InternalEvents={})).METADATA="METADATA",t.VBR="VBR",t.SEEK="SEEK",t.FIRST_FRAME="FIRST_FRAME",t.BASE_TS="BASE_TS",t.STAT="STAT",t.M3U8TIME="M3U8TIME",t.SWITCH_SOURCE_SUCCESS="SWITCH_SOURCE_SUCCESS",t.SWITCH_SOURCE_FAIL="SWITCH_SOURCE_FAIL"},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Codec=t.TimeDispatchType=t.VERSION=void 0,t.VERSION="dylive_202105060755",(n=t.TimeDispatchType||(t.TimeDispatchType={})).H264_SEI="H264_SEI",n.AAC_FIL="AAC_FIL",n.EXTRA_DATA="EXTRA_DATA",(t=t.Codec||(t.Codec={})).H264="h264",t.H265="h265",t.AAC="aac",t.MP3="mp3"},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.isFrameTrack=t.MediaAction=void 0,(n=t.MediaAction||(t.MediaAction={}))[n.END=0]="END",n[n.FIRST_FRAME=1]="FIRST_FRAME",n[n.RESET=2]="RESET",n[n.GET_DURATION=3]="GET_DURATION",n[n.EXTRA=4]="EXTRA",t.isFrameTrack=function(e){return!e.flag||"KEY"===e.flag}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={};!function(){var e,t=self.navigator.userAgent.toLowerCase(),r=/(edge)\/([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||0<=t.indexOf("trident")&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],n=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],t={browser:r[5]||r[3]||r[1]||"",version:r[2]||r[4]||"0",majorVersion:r[4]||r[2]||"0",platform:n[0]||""},r={};for(e in t.browser&&(r[t.browser]=!0,n=t.majorVersion.split("."),r.version={major:parseInt(t.majorVersion,10),string:t.version},1<n.length&&(r.version.minor=parseInt(n[1],10)),2<n.length&&(r.version.build=parseInt(n[2],10))),t.platform&&(r[t.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),(r.rv||r.iemobile)&&(r.rv&&delete r.rv,t.browser="msie",r.msie=!0),r.edge&&(delete r.edge,t.browser="msedge",r.msedge=!0),r.opr&&(t.browser="opera",r.opera=!0),r.safari&&r.android&&(t.browser="android",r.android=!0),r.name=t.browser,r.platform=t.platform,i)i.hasOwnProperty(e)&&delete i[e];Object.assign(i,r)}(),t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(a.fromArray=function(e){var t=0;e.forEach(function(e){return t+=e.byteLength});var r=new a({initLength:t});return e.forEach(function(e){return r.write(e)}),r},Object.defineProperty(a.prototype,"buffer",{get:function(){return this._buffer.slice(0,this._wposition)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"byteAvailable",{get:function(){return this._wposition-this._rposition},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"byteLength",{get:function(){return this._wposition},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bytePosition",{get:function(){return this._rposition},enumerable:!1,configurable:!0}),a.prototype.read=function(e){if(e>this.byteAvailable)throw new Error("["+a.TAG+"] not enough data for read.");var t=this._buffer.slice(this._rposition,this._rposition+e);return this._rposition+=e,t},a.prototype.readAll=function(){return this.read(this.byteAvailable)},a.prototype.readUint8=function(){return new DataView(this.read(1)).getUint8(0)},a.prototype.readUint16=function(){return new DataView(this.read(2)).getUint16(0,this.littleEndian)},a.prototype.readUint24=function(){var e=new Uint8Array(this.read(3));return this.littleEndian&&e.reverse(),e[0]<<16|e[1]<<8|e[2]},a.prototype.readUint32=function(){return new DataView(this.read(4)).getUint32(0,this.littleEndian)},a.prototype.readString=function(e){return String.fromCharCode.apply(null,new Uint8Array(this.read(e)))},a.prototype.write=function(e){var t,r,n,i,a;e&&0<e.byteLength&&(t=e.byteLength,(a=this._wposition+t)>this._buffer.byteLength&&(n=a-(r=this._autoClear?this._rposition:0),i=this._buffer.slice(r,this._wposition),a=void 0,a=n>this._buffer.byteLength?(this.increase?n+=this.increase:n=2*(this.buffer.byteLength+t),this._count++,new ArrayBuffer(n)):this._buffer,new Uint8Array(a).set(new Uint8Array(i),0),this._rposition-=r,this._wposition=i.byteLength,this._buffer=a),new Uint8Array(this._buffer).set(e instanceof ArrayBuffer?new Uint8Array(e):e,this._wposition),this._wposition+=t)},a.prototype.peekBytes=function(e,t){if((t=void 0===t?0:t)+(e=void 0===e?this.byteAvailable:e)>this.byteAvailable)throw new Error("["+a.TAG+"] not enough data for read.");return new Uint8Array(this._buffer,this._rposition+t,e)},a.prototype.skip=function(e){this._rposition+=e},a.prototype.back=function(e){this._rposition-=e},a.prototype.reset=function(){this._wposition=0,this._rposition=0},a.TAG="ByteArray",a.littleEndian=!1,a);function a(e){var t=void 0===e?{}:e,r=t.buffer,n=t.initLength,i=void 0===n?1024:n,e=t.autoClear,n=void 0!==e&&e,e=t.increase,e=void 0===e?0:e,t=t.littleEndian,t=void 0===t?a.littleEndian:t;this._rposition=0,this._wposition=0,this._count=0,this._autoClear=n,this.increase=e,this.littleEndian=t,r?(this._buffer=r,this._wposition=r.byteLength):this._buffer=new ArrayBuffer(i)}t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseLoader=void 0;var n=r(3),i=r(6),r=(Object.defineProperty(a.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"redirectUrl",{get:function(){return this._redirectUrl},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"supportSmooth",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"format",{get:function(){return"flv"},enumerable:!1,configurable:!0}),a.prototype.load=function(e,t,r){this._loaderBytes=0,this._url=e,this._config=t,this._loadStartTime=Date.now()},a.prototype.dispose=function(){this._destroyed=!0,this.onData=null,this.onEnd=null,this.onError=null},a.prototype.getStatistics=function(){return{loaderBytes:this._loaderBytes,cdnBytes:this._loaderBytes,p2pBytes:0,totalDropBytes:0,uploadBytes:0,speed:this._speed,url:this._url,status:this._status}},a.prototype.attachMedia=function(e){this._media=e},a.prototype.updateSource=function(e){},a.prototype.endOfStream=function(){this._onEnd()},a.prototype.reset=function(e){this.onData&&this.onData({action:i.MediaAction.RESET,actionData:e})},a.prototype.extra=function(e){this.onData&&this.onData({action:i.MediaAction.EXTRA,actionData:e})},a.prototype._onData=function(e){e&&(e instanceof ArrayBuffer?this._loaderBytes+=e.byteLength:e.data&&(this._loaderBytes+=e.data.byteLength),this.onData&&this.onData(e))},a.prototype._onRedirectUrl=function(e){this._redirectUrl=e},a.prototype._onError=function(e){this._calcSpeed(),this.onError&&this.onError(e)},a.prototype._onEnd=function(){this._calcSpeed(),this.onEnd&&this.onEnd()},a.prototype._calcSpeed=function(){this._loadEndTime=Date.now(),this._speed=this._loaderBytes/1024/((this._loadEndTime-this._loadStartTime)/1e3)},a);function a(){this._destroyed=!1,this._loaderBytes=0,this._loadStartTime=0,this._loadEndTime=0,this._speed=0,this._status=0,n.bindAll(this)}t.BaseLoader=r},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TrackHandler=void 0;var a,i=(a=r(21).BaseStream,i(o,a),o.prototype.append=function(e){this._destroyed||("EXTRA"!==e.flag?this.handleTrack(e):this.onData(e))},o);function o(){return null!==a&&a.apply(this,arguments)||this}t.TrackHandler=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMediaHandler=t.MediaHandler=void 0;var n=r(61);Object.defineProperty(t,"MediaHandler",{enumerable:!0,get:function(){return n.MediaHandler}});var i=r(27),a=r(63);t.createMediaHandler=function(e){switch(e.mediaHandle){case"mse":return new i.ToMSE(e);case"file":return new a.ToFile(e);case"soft":return new(r(64).ToSoftDecoder)(e);default:return null}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLoader=void 0;var n=r(30),i=r(31),a=r(32),o=r(1),s=r(9);Object.defineProperty(t,"BaseLoader",{enumerable:!0,get:function(){return s.BaseLoader}}),t.createLoader=function(e){return o.isHls(e.url)?new a.HlsLoader:n.FetchStreamLoader.isSupported()?new n.FetchStreamLoader:i.MozChunkedLoader.isSupported()?new i.MozChunkedLoader:void 0}},function(e,t,h){function a(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=r,i.c=n,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var e=i(i.s=ENTRY_MODULE);return e.default||e}var p="[\\.|\\-|\\+|\\w|/|@]+",f="\\((/\\*.*?\\*/)?s?.*?("+p+").*?\\)";function _(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}e.exports=function(e,t){var r={main:h.m},n=(t=t||{}).all?{main:Object.keys(r)}:function(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};function(r){return Object.keys(r).reduce(function(e,t){return e||0<r[t].length},!1)}(r);)for(var a=Object.keys(r),o=0;o<a.length;o++){var s=a[o],u=r[s].pop();if(i[s]=i[s]||{},!i[s][u]&&e[s][u]){i[s][u]=!0,n[s]=n[s]||[],n[s].push(u);for(var c=function(e,t,r){var n={};n[r]=[];var i=t.toString();if(!(t=i.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/)))return n;for(var a,t=t[1],o=new RegExp("(\\\\n|\\W)"+_(t)+f,"g");a=o.exec(i);)"dll-reference"!==a[3]&&n[r].push(a[3]);for(o=new RegExp("\\("+_(t)+'\\("(dll-reference\\s('+p+'))"\\)\\)'+f,"g");a=o.exec(i);)e[a[2]]||(n[r].push(a[1]),e[a[2]]=h(a[1]).m),n[a[2]]=n[a[2]]||[],n[a[2]].push(a[4]);return n}(e,e[s][u],s),d=Object.keys(c),l=0;l<d.length;l++)r[d[l]]=r[d[l]]||[],r[d[l]]=r[d[l]].concat(c[d[l]])}}return n}(r,e),i="";Object.keys(n).filter(function(e){return"main"!==e}).forEach(function(t){for(var e=0;n[t][e];)e++;n[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",i=i+"var "+t+" = ("+a.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n[t].map(function(e){return JSON.stringify(e)+": "+r[t][e].toString()}).join(",")+"});\n"});i=i+"new (("+a.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map(function(e){return JSON.stringify(e)+": "+r.main[e].toString()}).join(",")+"}))(self);",e=new window.Blob([i],{type:"text/javascript"});if(t.bare)return e;t=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(e),e=new window.Worker(t);return e.objectURL=t,e}},function(t,e){!function(){"use strict";function e(e,t){throw new Error("abstract")}e.prototype.drawFrame=function(e){throw new Error("abstract")},e.prototype.clear=function(){throw new Error("abstract")},t.exports=e}()},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(29),t),i(r(2),t),i(r(12),t)},function(e,t){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=i[a])}return r},writable:!0,configurable:!0}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<r;){var a=t[i];if(e.call(n,a,i,t))return a;i++}}})},function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,p="~";function i(){}function a(e,t,r,n,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");i=new function(e,t,r){this.fn=e,this.context=t,this.once=r||!1}(r,n||e,i),t=p?p+t:t;return e._events[t]?e._events[t].fn?e._events[t]=[e._events[t],i]:e._events[t].push(i):(e._events[t]=i,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(p=!1)),o.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(p?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var e=p?p+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,n=t.length,i=new Array(n);r<n;r++)i[r]=t[r].fn;return i},o.prototype.listenerCount=function(e){e=p?p+e:e,e=this._events[e];return e?e.fn?1:e.length:0},o.prototype.emit=function(e,t,r,n,i,a){var o=p?p+e:e;if(!this._events[o])return!1;var s,u=this._events[o],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,i),!0;case 6:return u.fn.call(u.context,t,r,n,i,a),!0}for(h=1,s=new Array(c-1);h<c;h++)s[h-1]=arguments[h];u.fn.apply(u.context,s)}else for(var d,l=u.length,h=0;h<l;h++)switch(u[h].once&&this.removeListener(e,u[h].fn,void 0,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,t);break;case 3:u[h].fn.call(u[h].context,t,r);break;case 4:u[h].fn.call(u[h].context,t,r,n);break;default:if(!s)for(d=1,s=new Array(c-1);d<c;d++)s[d-1]=arguments[d];u[h].fn.apply(u[h].context,s)}return!0},o.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,r,n){e=p?p+e:e;if(!this._events[e])return this;if(!t)return u(this,e),this;var i=this._events[e];if(i.fn)i.fn!==t||n&&!i.once||r&&i.context!==r||u(this,e);else{for(var a=0,o=[],s=i.length;a<s;a++)(i[a].fn!==t||n&&!i[a].once||r&&i[a].context!==r)&&o.push(i[a]);o.length?this._events[e]=1===o.length?o[0]:o:u(this,e)}return this},o.prototype.removeAllListeners=function(e){return e?(e=p?p+e:e,this._events[e]&&u(this,e)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=p,e.exports=o.EventEmitter=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(16);var o,s=r(6),u=r(19),c=r(24),d=r(0),l=r(49),h=r(26),p=r(4),f=r(2),_=a(r(58)),m=r(59),y=d.makeLogger("tranmuxer-worker"),i=(o=h.Workerable,i(v,o),v.prototype.terminate=function(){o.prototype.terminate.call(this),this.destroyed=!0,this._demux&&(this._demux.dispose(),this._demux=null),this._remux&&(this._remux.dispose(),this._remux=null),this._parser&&(this._parser.dispose(),this._parser=null),this._wsTranscoder&&(this._wsTranscoder.dispose(),this._wsTranscoder=null),this._trackGenerator&&(this._trackGenerator.dispose(),this._trackGenerator=null)},v.prototype.init=function(e){o.prototype.init.call(this,e),this._config.__internal.eventbus.on(p.InternalEvents.FIRST_FRAME,this.firstFrame),this._demux=u.createDemuxer(e),this._demux?(this._remux=c.createRemuxer(e),this._remux?(this._parser=new l.TrackParser(e),this._trackGenerator=new m.TrackGenerator(e),this.pipeline()):this._onError(new f.DyError("unsupport remux format: "+e.format,f.ErrorIds.UnsupportRemux))):this._onError(new f.DyError("unsupport demxu format: "+e.format,f.ErrorIds.UnsupportDemux))},v.prototype.pipeline=function(){var e=this._config,t=this._demux.pipe(this._trackGenerator).pipe(this._parser).pipe(this._remux);e.accelerator.enable&&"h265"===e.videoCodec&&(this._wsTranscoder=new _.default(e),t=t.pipe(this._wsTranscoder)),t.out(this._onRemuxData).catch(this._onError)},v.prototype.appendData=function(e){this.destroyed||this._demux.append(e)},v.prototype.appendEnd=function(){this.destroyed||this._demux.append(s.MediaAction.END)},v.prototype.firstFrame=function(){this.destroyed||this._demux.append(s.MediaAction.FIRST_FRAME)},v.prototype._onRemuxData=function(e){var t=[];e.data&&t.push(e.data.buffer),this.dispatchMessage({name:"_onRemuxData",params:e},t)},v.prototype.setLoggerEnable=function(e){y.setEnable(e)},v.prototype._onMessage=function(e){var t=e.data,r=t.name,n=t.params;try{switch(r){case"init":this.init(n);break;case"appendData":this.appendData(n);break;case"appendEnd":this.appendEnd();break;case"setLoggerEnable":this.setLoggerEnable(n);break;case"changeFormat":this._changeFormat(n);break;default:y.warn("unknown function: transmuxer."+r)}}catch(e){this._onError(new f.DyError("call transmuxer worker "+r+" error: "+e,f.ErrorIds.TransmuxerError))}},v.prototype._changeFormat=function(e){this._config.format=e;var t=u.createDemuxer(this._config);t||this._onError(new f.DyError("unsupport demxu format: "+e,f.ErrorIds.UnsupportDemux)),this._demux&&(this._demux.transfer(t),this._demux.dispose()),this._demux=t,this.pipeline()},v);function v(){var e=null!==o&&o.apply(this,arguments)||this;return e.destroyed=!1,e}t.default=i},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createDemuxer=t.Demuxer=void 0;var i=r(20);Object.defineProperty(t,"Demuxer",{enumerable:!0,get:function(){return i.Demuxer}});var a=n(r(40)),o=r(43);t.createDemuxer=function(e){switch(e.format){case"flv":return new a.default(e);case"raw":return new i.Demuxer(e);case"ts":return new o.TsDemuxer(e);default:return null}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Demuxer=void 0;var a,o=r(21),s=r(6),u=r(0),c=r(4),d=r(1),l=u.makeLogger("demuxer"),i=(a=o.BaseStream,i(h,a),h.prototype.dispose=function(){a.prototype.dispose.call(this),this._config=void 0,this._lastTracks=void 0,this._pendingTracks=void 0},h.prototype.append=function(e){var t;this._destroyed||(e instanceof ArrayBuffer?this._appendArrayBuffer(e):e.type?this._appendTrack(e):e.action?(t=e).action===s.MediaAction.GET_DURATION?this._duration=t.actionData:t.action===s.MediaAction.RESET?this._resetTrack(t.actionData):t.action===s.MediaAction.EXTRA&&this._extraTrack(t.actionData,"EXTRA"):e===s.MediaAction.END?this._appendEnd():e===s.MediaAction.FIRST_FRAME?this._hasFirstFrame=!0:l.warn("unknown append data: ",e))},h.prototype.transfer=function(e){Object.assign(e,{_audioConfig:this._audioConfig,_videoConfig:this._videoConfig,_lastTracks:this._lastTracks})},h.prototype._appendArrayBuffer=function(e){},h.prototype._appendTrack=function(e){if("audio"===e.type||"video"===e.type){if(!("audio"===e.type&&!1===this._config.hasAudio||"video"===e.type&&!1===this._config.hasVideo)){if(e.trackLength?this._trackLength=e.trackLength:e.trackLength=this._trackLength,-1===this._baseTs&&s.isFrameTrack(e)){if(e.dts<0&&!this._config.startFromZero&&(l.warn("negative dts detected: "+e.type+" "+e.dts+", use relative time."),this._config.startFromZero=!0),this._config.startFromZero&&2===e.trackLength){if(l.log("detecting first audio/video pts: "+e.type+" "+e.pts),void 0===this._firstAudioTs&&"audio"===e.type&&(this._firstAudioTs=e.pts),void 0===this._firstVideoTs&&"video"===e.type&&(this._firstVideoTs=e.pts),void 0===this._firstAudioTs||void 0===this._firstVideoTs)return void this._pendingTracks.push(e);l.log("detected first audio/video pts: "+this._firstAudioTs+"/"+this._firstVideoTs),this._baseTs=Math.max(this._firstAudioTs,this._firstVideoTs)}else this._baseTs=e.pts;this._config.__internal.eventbus.emit(c.InternalEvents.BASE_TS,{data:this._config.startFromZero?0:this._baseTs}),l.log("baseTs = "+this._baseTs),this._pendingTracks.length&&this._pendingTracks.splice(0).forEach(this._appendTrack)}"live"!==this._config.mode||(t=this._lastTracks[e.trackId])&&s.isFrameTrack(e)&&5<t.dts-e.dts&&l.warn("Dts error: "+e.type+" track dts rollback, last="+t.dts+", now="+e.dts+", delta="+(e.dts-t.dts)),e.extradata||(e.extradata={});var t=e.config;if(t||("audio"===e.type?t=this._audioConfig:"video"===e.type&&(t=this._videoConfig)),t)return 0<=e.trackId&&(t.trackId=e.trackId),t.codec||(t.codec=e.codec),this._config.startFromZero&&-1!==this._baseTs&&(e.pts=Math.max(e.pts-this._baseTs,0),e.dts=Math.max(e.dts-this._baseTs,0)),this._duration&&!t.duration&&(t.duration=this._duration,this._config.startFromZero||(t.duration+=this._baseTs)),e.config=t,"audio"===e.type?this._audioConfig=t:"video"===e.type&&(this._videoConfig=t),this.onData(e),s.isFrameTrack(e)&&(this._lastTracks[e.trackId]=e),!0;l.warn("unable to generate track config, type="+e.type)}}else l.warn("unknown track type="+e.type)},h.prototype._appendEnd=function(){var t=this;Object.keys(this._lastTracks).forEach(function(e){e=t._lastTracks[e];t._appendTrack({type:e.type,trackId:e.trackId,dts:e.dts,pts:e.pts,codec:e.codec,isEnd:!0})})},h.prototype._generateTrackConfig=function(e){return"audio"===e?{type:"audio",trackId:1,codec:void 0,detailCodec:"",timescale:9e4,duration:0,refSampleDuration:0,bytes:void 0,mimeType:"",channelCount:0,audioSampleRate:0}:"video"===e?{type:"video",trackId:2,codec:void 0,detailCodec:"",timescale:9e4,duration:0,refSampleDuration:0,bytes:void 0,mimeType:"",presentWidth:0,presentHeight:0,codecWidth:0,codecHeight:0}:null},h.prototype._resetTrack=function(e){this._extraTrack(e,"RESET")},h.prototype._extraTrack=function(e,t){var r,n=d.values(this._lastTracks)[0];n?(this._appendTrack({type:n.type,trackId:n.trackId,dts:0,pts:0,codec:n.codec,flag:t,extradata:e}),"RESET"===t&&null!==(r=null==e?void 0:e.switchSource)&&void 0!==r&&r._fullSwitch&&(this._trackLength=2,this._duration=0,this._baseTs=-1,this._pendingTracks=[],this._firstAudioTs=void 0,this._firstVideoTs=void 0)):l.warn("no last tracks, can't send extra track.")},h);function h(e){var t=a.call(this)||this;return t._audioConfig=t._generateTrackConfig("audio"),t._videoConfig=t._generateTrackConfig("video"),t._lastTracks={},t._hasFirstFrame=!1,t._trackLength=2,t._duration=0,t._baseTs=-1,!(t._pendingTracks=[])!==(t._config=e).hasAudio&&!1!==e.hasVideo||(t._trackLength=1),t}t.Demuxer=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStream=void 0;var n=r(3),r=(i.prototype.dispose=function(){this._destroyed=!0,this.onData=null,this.onError=null},i.prototype.error=function(e){this.onError(e),this.dispose()},i.prototype.catch=function(e){return this.onError=e,this},i.prototype.pipe=function(e){return this.onData=e.append,this.onError=e.error,e},i.prototype.out=function(e){return this.onData=e,this},i);function i(){this._destroyed=!1,n.bindAll(this)}t.BaseStream=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNal=void 0;var c=r(5);function d(e,t){for(var r=e.byteLength;t<r-2;){if(0===e[t]&&0===e[t+1]){if(1===e[t+2])return[t,t+3];if(0===e[t+2]&&1===e[t+3])return[t,t+4]}t++}return[-1,-1]}function l(e,t,r){9!==t&&(e.codec===c.Codec.H264?(7!==t&&8!==t||e.configNalus.push({naluType:t,naluData:r}),e.nals.push({naluType:t,naluData:r}),e.nalsLength+=r.byteLength):e.codec===c.Codec.H265&&(32!==t&&33!==t&&34!==t||e.configNalus.push({naluType:t,naluData:r}),e.nals.push({naluType:t,naluData:r}),e.nalsLength+=r.byteLength))}t.parseNal=function(e){for(var t,r,n,i=e.codec,a=e.bytes,o={configNalus:[],nals:[],nalsLength:0,codec:i},i=d(a,0),s=i[0],u=i[1];-1!==s;)r&&l(o,n,a.subarray(r,s)),r=u,n=o.codec===c.Codec.H265?(126&a[r])>>1:31&a[r],s=(t=d(a,u+1))[0],u=t[1];return r&&l(o,n,a.subarray(r,a.byteLength)),o}},function(e,u,t){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(u,"__esModule",{value:!0}),u.aac=u.reference=void 0;var n=t(0),i=r(t(45)),a=r(t(7)),t=t(5),c=n.makeLogger("aac-parser");u.reference={mpegSamplingRates:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]},u.aac={name:t.Codec.AAC,inited:!0,parseConfig:function(e){var t,r,n=e.bytes,i=0,a=null,i=n[0]>>>3;if((r=(7&n[0])<<1|n[1]>>>7)<0||r>=u.reference.mpegSamplingRates.length)return c.warn("AAC invalid sampling frequency index!"),-1;var o=u.reference.mpegSamplingRates[r],s=(120&n[1])>>>3;if(s<0||8<=s)return c.warn("AAC invalid channel configuration"),-1;5===i&&(a=(7&n[1])<<1|n[2]>>>7,n[2]);n=self.navigator.userAgent.toLowerCase();return-1!==n.indexOf("firefox")?a=6<=r?(i=5,t=new Array(4),r-3):(i=2,t=new Array(2),r):-1!==n.indexOf("android")?(i=2,t=new Array(2),a=r):(i=5,a=r,t=new Array(4),6<=r?a=r-3:1==s&&(i=2,t=new Array(2),a=r)),t[0]=i<<3,t[0]|=(15&r)>>>1,t[1]=(15&r)<<7,t[1]|=(15&s)<<3,5===i&&(t[1]|=(15&a)>>>1,t[2]=(1&a)<<7,t[2]|=8,t[3]=0),e.bytes=new Uint8Array(t),e.audioSampleRate=o,e.channelCount=s,e.detailCodec="mp4a.40."+i,e.refSampleDuration=1024/o*1e3,0},parseData:function(e){var t=e.data;return 32===t.byteLength&&33===t[0]&&31===t[1]&&16===t[2]?(c.warn("private aac data, ignore!"),delete e.data,-1):(6==(t[0]>>5&7)&&((t=i.default.getDbData(i.default.parseAacFilData(t)))&&(e.extradata.aacfil={aacTimestamp:e.dts,data:t},delete e.data),a.default.msedge&&delete e.data),0)}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createRemuxer=t.Remuxer=void 0;var i=r(46);Object.defineProperty(t,"Remuxer",{enumerable:!0,get:function(){return i.Remuxer}});var a=n(r(47));t.createRemuxer=function(e){return"mp4"!==e.outputFormat?null:new a.default(e)}},function(e,u,t){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(u,"__esModule",{value:!0}),u.H264SeiUUIDType=u.H264SeiType=void 0;var c=r(t(0));u.H264SeiType={H264_SEI_TYPE_BUFFERING_PERIOD:0,H264_SEI_TYPE_PIC_TIMING:1,H264_SEI_TYPE_PAN_SCAN_RECT:2,H264_SEI_TYPE_FILLER_PAYLOAD:3,H264_SEI_TYPE_USER_DATA_REGISTERED:4,H264_SEI_TYPE_USER_DATA_UNREGISTERED:5,H264_SEI_TYPE_RECOVERY_POINT:6,H264_SEI_TYPE_FRAME_PACKING:45,H264_SEI_TYPE_DISPLAY_ORIENTATION:47,H264_SEI_TYPE_GREEN_METADATA:56,H264_SEI_TYPE_MASTERING_DISPLAY_COLOUR_VOLUME:137,H264_SEI_TYPE_ALTERNATIVE_TRANSFER:147},u.H264SeiUUIDType={AdsCtrlSEIV00001:"AdsCtrlSEIV00001",AdsCtrlSEIV00003:"AdsCtrlSEIV00003",CloudVideoStream:"CloudVideoStream",RoiMaskSeiV00001:"RoiMaskSeiV00001"};d._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,a=0;a<r;a++)2<=a&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[i]=t[a],i++);return new Uint8Array(n.buffer,0,i)},d.parseSEI=function(e){for(var t,r,e=d._ebsp2rbsp(e),n=new DataView(e.buffer),i=0,a=0,o=0;r=n.getUint8(o),o+=1,i+=r,255===r;);for(;r=n.getUint8(o),o+=1,a+=r,255===r;);return{seiType:i,seiData:t=i===u.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED?d.decodeUnregisteredUserData(n,o,a):t}},d.buffer2JSON=function(e){for(var t=[],r=new Uint8Array(e),n=0,i=e.byteLength;n<i;n++)t.push(String.fromCharCode(r[n]));return JSON.parse(t.join(""))},d.decodeUnregisteredUserData=function(e,t,r){if(r<16)return c.default.warn("SEIParser ","error size: ",r),null;var n,i=String.fromCharCode.apply(null,new Uint8Array(e.buffer,t,16));switch(t+=16,i){case u.H264SeiUUIDType.AdsCtrlSEIV00001:case u.H264SeiUUIDType.AdsCtrlSEIV00003:0===(n=e.getUint8(t++))&&(s=d.buffer2JSON(e.buffer.slice(t,r+t-17)));break;case u.H264SeiUUIDType.CloudVideoStream:var a=e.getUint32(t).toString(2),o=e.getUint32(t+4).toString(2),s=parseInt(""+a+(o.length<32?new Array(32-o.length+1).join("0"):"")+o,2);break;case u.H264SeiUUIDType.RoiMaskSeiV00001:o=e.getUint8(t);t+=1,1===o&&(s=String.fromCharCode.apply(null,new Uint8Array(e.buffer,t,r-17)))}return{uuid:i,enctype:n,data:s}},t=d;function d(){}u.default=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Workerable=void 0;var n=r(3),i=r(2),a=r(1),r=(o.prototype.init=function(e){this._config=e,this.inWorker&&a.connectEventbus(this,this._onMessage,e)},o.prototype.postMessage=function(e,t){this._onMessage({data:e})},o.prototype.terminate=function(){var e;this.onmessage=null,this.onerror=null,this.inWorker&&this._config&&(null===(e=null===(e=this._config.__internal)||void 0===e?void 0:e.eventbus)||void 0===e||e.removeAllListeners(),this._config=null)},o.prototype.dispatchMessage=function(e,t){this.inWorker?t&&t[0]instanceof ArrayBuffer?self.postMessage(e,t):self.postMessage(e):this.onmessage&&this.onmessage({data:e})},o.prototype._onError=function(e){this.dispatchMessage({name:"_onError",params:this.inWorker?i.errorClone(e):e}),this.terminate()},o);function o(){var t=this;this.inWorker=!1,n.bindAll(this),this.inWorker="object"!=typeof window,this.inWorker&&(self.onmessage=this._onMessage,self.onerror=function(e){return t._onError(new i.DyError("worker error: "+e,i.ErrorIds.WorkerError))})}t.Workerable=r},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ToMSE=void 0;var a,h=r(2),o=r(62),s=r(11),u=r(6),c=r(0),p=r(1),d=r(4),f=c.makeLogger("to-mse"),i=(a=s.MediaHandler,i(l,a),Object.defineProperty(l.prototype,"isPending",{get:function(){var e;return(null===(e=this._switchingSource)||void 0===e?void 0:e.pendingAppend)||0<this._pendingClearRanges.length||this._waitLockId},enumerable:!1,configurable:!0}),l.prototype.dispose=function(){if(a.prototype.dispose.call(this),this._mediaSource){if("closed"!==this._mediaSource.readyState)for(var e=this._mediaSource.sourceBuffers,t=0;t<e.length;t++){var r=e[t];try{this._mediaSource.removeSourceBuffer(r)}catch(e){f.warn("remove source buffer error: ",e)}r.removeEventListener("updateend",this._onUpdateend)}if("open"===this._mediaSource.readyState)try{this._mediaSource.endOfStream()}catch(e){f.warn("endOfStream error: ",e)}this._mediaSource.removeEventListener("sourceopen",this._appendBuffer),this._mediaSource=null}this._mediaSourceUrl&&(URL.revokeObjectURL(this._mediaSourceUrl),this._mediaSourceUrl=null),this._sourceBufferAdded={}},l.prototype.appendData=function(e){this._destroyed||(a.prototype.appendData.call(this,e),"EXTRA"!==e.flag?"RESET"!==e.flag?((this._tracks[e.trackId]||(this._tracks[e.trackId]=[])).push(e),this._switchingSource&&this._checkSwitchSource(e),this._isTracksReady||(this._isTracksReady=this._checkTracksReady()),this._isTracksReady&&this._appendBuffer(),e.isEnd&&this._onUpdateend()):this._reset(e.extradata,!0):this._reset(e.extradata,!1))},l.prototype.appendEnd=function(){if(!this._destroyed&&this._mediaSource&&"open"===this._mediaSource.readyState){for(var e=this._mediaSource.sourceBuffers,t=!1,r=0;r<e.length;r++)if(e[r].updating){t=!0;break}t||(this._mediaSource.endOfStream(),f.log("media end"))}},l.prototype.attach=function(e){a.prototype.attach.call(this,e),this._video.addEventListener("stalled",this._onStalled),this._video.addEventListener("progress",this._checkBufferGap),this._video.addEventListener("canplay",this._onCanplay),this._video.addEventListener("waiting",this._onWaiting),this._video.addEventListener("ended",this._onEnded),this._video.addEventListener("error",this._onMediaError),this._video.addEventListener("seeking",this._onSeeking),this._video.addEventListener("play",this._onPlay),this._mediaSourceUrl||((e=this._mediaSource=new MediaSource).addEventListener("sourceopen",this._appendBuffer),this._mediaSourceUrl=URL.createObjectURL(e)),this._video.src=this._mediaSourceUrl},l.prototype.detach=function(){this._video&&(this._video.removeEventListener("stalled",this._onStalled),this._video.removeEventListener("progress",this._checkBufferGap),this._video.removeEventListener("canplay",this._onCanplay),this._video.removeEventListener("waiting",this._onWaiting),this._video.removeEventListener("ended",this._onEnded),this._video.removeEventListener("error",this._onMediaError),this._video.removeEventListener("seeking",this._onSeeking),this._video.removeEventListener("play",this._onPlay),this._video.playbackRate=1,this._video.src="",this._video.removeAttribute("src"),this._video=null),this._removeBuffer.cancel(),clearInterval(this._checkStuckTimer),clearInterval(this._checkBufferTimer),clearInterval(this._timeLoopTimer),clearInterval(this._checkBufferGapTimer),a.prototype.detach.call(this)},l.prototype._appendBuffer=function(){var l=this;this._destroyed||!this._mediaSource||"closed"===this._mediaSource.readyState||this.isPending||Object.keys(this._tracks).some(function(e){for(var t=l._tracks[e],r=[],n=0,i=l._sourceBufferAdded[e];0<t.length&&n<262144;){var a,o,s,u,c=t[0];if(!i){var d=c.config.mimeType;if(!MediaSource.isTypeSupported(d))return l._onError(new h.DyMediaError("Unsupported MIME type or codec: "+d,h.ErrorIds.MediaUnsupportCodec)),!0;try{f.log("add source buffer "+c.trackId+": "+d),(i=l._mediaSource.addSourceBuffer(d)).addEventListener("updateend",l._onUpdateend),l._sourceBufferAdded[c.trackId]=i}catch(e){return l._onError(new h.DyMediaError("failed add more source buffer, length="+l._mediaSource.sourceBuffers.length+", readyState="+l._mediaSource.readyState+"\n"+e,h.ErrorIds.MediaAddSourceBufferError)),!0}return}if(!i||i.updating)return;c.isEnd&&!l._isLoadEnded&&(l._trackEndedFlag[c.trackId]=!0,c.trackLength===Object.keys(l._trackEndedFlag).length&&(l._isLoadEnded=!0)),c.extradata&&(a=(u=c.extradata).jumpOverTs,o=u.timeOffset,s=u.seiTimestamp,d=u.aacfil,u=u.sei,0<a&&(l._jumpOverList.push({start:c.pts/1e3,end:a/1e3}),f.warn("jumpover timestamp list changed: ",JSON.stringify(l._jumpOverList))),o&&-1!==o&&(i.timestampOffset=o/1e3,f.log("buffer time offset change: "+i.timestampOffset)),s&&(l.seiTimestamp=s),d&&l._onExtraData({type:"aacfil",ts:c.pts,data:d}),u&&l._onExtraData({type:"sei",ts:c.pts,data:u})),c.pts&&(l.preTimestamp=c.pts,l._switchingSource&&"video"===c.type&&(l._switchingSource.lastUpdateVideoTs=c.pts)),"video"===c.type&&c.isKeyframe&&(p.binsert(l._keyframes,c.pts/1e3),l.onHasKeyframe&&l.onHasKeyframe()),c.data&&0<c.data.byteLength&&(r.push(c.data),n+=c.data.byteLength),delete c.data,t.shift()}if(0<r.length)try{i.appendBuffer(p.bufferConcat(r))}catch(e){f.warn("append buffer error: ",e,l._video.error),22===e.code||l._onError(new h.DyMediaError("append buffer error: "+e+" "+l._video.error,h.ErrorIds.MediaAppendError))}})},l.prototype._removeBufferNow=function(){if(this._video&&!this._isPlayEnded&&!this._switchingSource)for(var i=this._video.currentTime,a=this._mediaSource.sourceBuffers,o=this,e=0;e<a.length;e++)!function(e){var t,r,n=a[e];n.updating||0<(t=n.buffered).length&&(t=t.start(0),i-t>o._config.videoBackTimeThreshold&&(r=i-o._config.videoBackTime,(r=o._searchNearestKeyframe(r)-1)&&5<r-t&&(f.debug("remove played sb["+e+"]: "+t+" --\x3e "+r),n.remove(Math.max(t-1,0),r),o._keyframes=o._keyframes.filter(function(e){return r<=e}))))}(e)},l.prototype._searchNearestKeyframe=function(e){var t=this._keyframes.length;if(0===t)return f.log("no keyframe info!"),e;if(!(e<this._keyframes[0]))for(var r=0;r<t;r++)if(e>=this._keyframes[r]&&(r===t-1||e<this._keyframes[r+1]))return this._keyframes[r]},l.prototype._onUpdateend=function(){0<this._pendingClearRanges.length&&this._clearBufferInternal(!0)||(this._switchingSource&&this._trySwitchSourceSmooth(),this._removeBuffer(),this._appendBuffer(),this._isLoadEnded&&this.appendEnd())},l.prototype._checkPlayStuck=function(){var e,t;!this._video||this._video.paused||!this._reachCanplay||this.isPending||this._isPlayEnded||(e=this._video.buffered,t=this._video.currentTime,this._lastPlayTime===t&&0<e.length&&e.end(e.length-1)>t+3&&(f.warn("player stuck, force move forward: "+t+" -> "+(t=t+1)),this._printBuffer(this._video.buffered),this._video.currentTime=t),this._lastPlayTime=this._video.currentTime)},l.prototype._checkBufferGap=function(){if(!(!this._video||!this._isWaiting||this._reachCanplay&&this._video.paused||this.isPending||this._isPlayEnded))for(var e=this._video.buffered,t=this._video.currentTime,r=0;r<e.length;r++){var n=e.start(r),i=e.end(r);if(t<n&&(!this._reachCanplay||1<i-n)){if(0<r&&2<e.end(r-1)-t)return;this._video.currentTime=n,f.log("jump over buffer gap "+(0<r?"["+e.start(r-1)+", "+e.end(r-1)+"], ["+e.start(r)+", "+e.end(r)+"]":"0, ["+e.start(r)+", "+e.end(r)+"]")+", "+t+" --\x3e "+n);break}}},l.prototype._checkBuffer=function(){var e,t,r,n;!this._video||(n=this._video.buffered)&&0<n.length&&(e=n.end(n.length-1)-this._video.currentTime,t=this._video.playbackRate,r=void 0,e<this._config.minBuffer?r=this._config.slowRate:e<this._config.maxBuffer?(n=(this._config.minBuffer+this._config.maxBuffer)/2,t<1&&n<e&&(r=1),1<t&&e<n&&(r=1)):r=this._config.fastRate,r&&r!==t&&(this._video.playbackRate=r,f.log("playback rate change to "+r)))},l.prototype._printBuffer=function(e){var t="buffer status: current = "+this._video.currentTime,r=e.length;t+=" buffered =";for(var n=0;n<r;n++)t+=" ["+e.start(n)+", "+e.end(n)+"]";f.log(t)},l.prototype._timeLoop=function(){this._switchingSource&&this._trySwitchSourceSmooth(),this._jumpOver()},l.prototype._jumpOver=function(){var e=this._jumpOverList.length;if(0<e&&this._video)for(var t=this._video.currentTime,r=this._jumpOverList.concat(),n=e-1;0<=n;n--){var i=r[n];if(t>=i.start&&t<i.end){var a=i.end+1;f.warn("Large gap detected, jump from "+t+" to "+a),this._video.currentTime=a,this._jumpOverList.splice(0,n+1);break}t>i.end&&this._jumpOverList.splice(n,1)}},l.prototype._onStalled=function(){},l.prototype._onWaiting=function(){this._isWaiting=!0,this._checkBufferGap()},l.prototype._onCanplay=function(){this._reachCanplay=!0,this._isWaiting=!1,this._video.removeEventListener("progress",this._checkBufferGap)},l.prototype._onEnded=function(){this._isPlayEnded=!0},l.prototype._onMediaError=function(){var e="Media Error";this._video&&this._video.error&&(e="code="+this._video.error.code+", message="+this._video.error.message+", url="+this._video.src),this._onError(new h.DyMediaError(e,h.ErrorIds.MediaError))},l.prototype._onError=function(e){this.onError&&this.onError(e)},l.prototype._checkTracksReady=function(){var t=this,e=Object.keys(this._tracks)[0];if(!e)return!1;var r=this._tracks[e];if(!r||0===r.length)return!1;e=r[0].trackLength,r=Object.keys(this._tracks).map(function(e){return t._tracks[e][0]}).map(function(e){return e&&e.config.mimeType}).filter(function(e){return e});return r.length!==e?(f.log("tracks not ready, trackLength="+e+", now we have ["+r.join(",")+"], waiting..."),!1):(f.log("tracks are ready, trackLength="+e+", now we have ["+r.join(",")+"]"),!0)},l.prototype.T_ADV_Timestamp=function(){if(this._video&&0!=this._video.buffered.length)return{bufferLength:this.getBufferTime(),ptsTimestamp:this.preTimestamp,seiTimestamp:this.seiTimestamp,keyframes:this._keyframes.concat()}},l.prototype.getBufferTime=function(){return this._video&&!this._video.seeking&&this._video.buffered.length?this._video.buffered.end(0)-this._video.currentTime:0},l.prototype.getCurrentTime=function(){return this._video?this._video.currentTime:0},l.prototype.getIsWaiting=function(){return this._isWaiting},l.prototype._onSeeking=function(){if(f.log("seeking to "+this._video.currentTime),this._isPlayEnded=this._video.ended,"live"!==this._config.mode){if(this._video)for(var e=this._video.buffered.length,t=this._video.currentTime,r=0;r<e;r++){var n=this._video.buffered.start(r),i=this._video.buffered.end(r);if(n-t<=.1&&t-i<=this._config.hls.seekThreshold)return}this._waitLockId=Date.now(),f.warn("put wait lock id="+this._waitLockId),this._config.__internal.eventbus.emit(d.InternalEvents.SEEK,{data:{seekTime:this._video.currentTime,waitLockId:this._waitLockId}})}},l.prototype._reset=function(e,t){var r,n=this;null!=e&&e.switchSource&&(this._switchingSource=e.switchSource,this._switchingSource.pendingAppend=!0),"seek"===(null==e?void 0:e.resetReason)&&(this._switchingSource&&(f.log("switch source success: smooth=false, because of seek."),this._printBuffer(this._video.buffered),this._config.__internal.eventbus.emit(d.InternalEvents.SWITCH_SOURCE_SUCCESS,{data:{smooth:!1,data:this._switchingSource.data}}),this._switchingSource=void 0),this._clearBufferRange(!1)),null!=e&&e.waitLockId&&e.waitLockId===this._waitLockId&&(this._waitLockId=0,f.warn("release wait lock id="+e.waitLockId)),t&&(this._isPlayEnded=!1,this._isLoadEnded=!1,this._trackEndedFlag={},this._jumpOverList=[],this._keyframes=[],(t=null===(t=this._switchingSource)||void 0===t?void 0:t._switchTime)?(r=1e3*(t+1),Object.keys(this._tracks).forEach(function(e){n._tracks[e]=n._tracks[e].filter(function(e){return e.dts<r})}),this._clearBufferRange(!0,[t+1,1/0])):this._tracks={},f.log("mse reset"))},l.prototype._onPlay=function(){this._isPlayEnded&&(this._video.currentTime=0,this._onSeeking())},l.prototype._checkSwitchSource=function(e){if(void 0===this._switchingSource.firstTs&&"video"===e.type&&u.isFrameTrack(e)){this._switchingSource.firstTs=e.pts;var t=this._switchingSource.firstTs/1e3,e=this._video.buffered;if(f.log("check switch source: current="+this._video.currentTime+", sourceStart="+t),this._printBuffer(e),e.length){e=e.end(0);if(1<t&&t>=this._video.currentTime-12&&t<=e+1&&!this._switchingSource.quick&&!this._video.paused)return f.warn("switch source smooth=true, current="+this._video.currentTime+", sourceStart="+t),this._switchingSource.smooth=!0,void(this._switchingSource.pendingAppend=!1)}f.warn("switch source smooth=false, current="+this._video.currentTime+", sourceStart="+t),this._switchingSource.smooth=!1,this._switchingSource.pendingAppend=!1,this._clearBufferRange(!1)}},l.prototype._trySwitchSourceSmooth=function(){if(!this._destroyed&&this._switchingSource&&!this.isPending)if(!0===this._switchingSource.smooth){var e=this._switchingSource.lastUpdateVideoTs>=1e3*this._video.currentTime;(e=void 0!==this._switchingSource._switchTime?e&&this._video.currentTime>=this._switchingSource._switchTime:e)&&(this._printBuffer(this._video.buffered),this._config.__internal.eventbus.emit(d.InternalEvents.SWITCH_SOURCE_SUCCESS,{data:{smooth:!0,data:this._switchingSource.data}}),this._switchingSource=void 0,f.log("switch source success: smooth=true"))}else if(!1===this._switchingSource.smooth){var t=this._video.buffered;if(0!==t.length){e=t.start(0),t=t.end(0);if(this._video.paused&&this._video.currentTime-e<20){if(t-this._video.currentTime<.5)return;this._video.currentTime=Math.max(this._video.currentTime,e)}else this._video.currentTime=e;this._printBuffer(this._video.buffered),this._config.__internal.eventbus.emit(d.InternalEvents.SWITCH_SOURCE_SUCCESS,{data:{smooth:!1,data:this._switchingSource.data}}),this._switchingSource=void 0,f.log("switch source success: smooth=false")}}},l.prototype._clearBufferInternal=function(e){var t=this;if((e=void 0===e?!1:e)&&this._clearingRange&&(this._clearingRange===this._pendingClearRanges[0]&&this._pendingClearRanges.shift(),this._clearingRange=void 0),0===this._pendingClearRanges.length)return!1;var r=Object.keys(this._sourceBufferAdded).map(function(e){return t._sourceBufferAdded[e]});if(!r.every(function(e){return!e.updating}))return!0;if(r.every(function(e){return!e.updating&&0===e.buffered.length}))return!(this._pendingClearRanges=[]);for(var n=!1,i=this;!n&&0<this._pendingClearRanges.length;)!function(){var t=i._pendingClearRanges[0];r.forEach(function(e){if(e.buffered.length)try{e.remove(t[0],t[1]),n=!0}catch(e){f.warn("clear buffer error, ignore this range: ["+t[0]+", "+t[1]+"]. "+e)}}),n?(i._clearingRange=t,f.log("buffer ["+t[0]+", "+t[1]+"] cleared.")):i._pendingClearRanges.shift()}();return n},l.prototype._clearBufferRange=function(e,t){void 0===t&&(t=[0,1/0]),e?this._pendingClearRanges.push(t):this._pendingClearRanges=[t],this._clearBufferInternal()},l);function l(e){e=a.call(this,e)||this;return e.preTimestamp=0,e._tracks={},e._sourceBufferAdded={},e._trackEndedFlag={},e._isLoadEnded=!1,e._isPlayEnded=!1,e._isWaiting=!0,e._reachCanplay=!1,e._jumpOverList=[],e._keyframes=[],e._isTracksReady=!1,e._lastPlayTime=-1,e._removeBuffer=o.throttle(e._removeBufferNow,1e3),e._pendingClearRanges=[],e._waitLockId=0,window.T_ADV_Timestamp=e.T_ADV_Timestamp,e._config.enableJitterBuffer&&(e._checkBufferTimer=setInterval(e._checkBuffer,1e3)),e._timeLoopTimer=setInterval(e._timeLoop,200),e._checkBufferGapTimer=setInterval(e._checkBufferGap,500),e._checkStuckTimer=setInterval(e._checkPlayStuck,2e3),e}t.ToMSE=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(0),u=a(r(8)),a=r(26),c=r(2),d=s.makeLogger("decoder-single"),i=(o=a.Workerable,i(l,o),l.prototype.terminate=function(){o.prototype.terminate.call(this),this._wasm&&(this._wasm._decode_abort(1),this._wasm=null),this._videoBytes=null,this._buffers=null},l.prototype.init=function(e){o.prototype.init.call(this,e),e.debug&&d.setEnable(!0),this._initWasm()},l.prototype._initWasm=function(){this._onError(new c.DyError("unsupport single thread decode.",c.ErrorIds.DecoderDecodeError))},l.prototype._onMessage=function(e){var t=e.data,r=t.name,n=t.params;try{switch(r){case"init":this.init(n);break;case"bytes":this._videoBytes.write(n);break;case"playtime":this._playTime=1e3*n,this._playTimeUpdateTime=Date.now();break;case"end":this._isEnd=!0;break;case"visibility":this._hidden=n,this._wasm&&this._wasm._set_hidden(this._hidden?1:0)}}catch(e){d.warn('call decoder worker "'+r+'" error',e)}},l.prototype.outer_read=function(e,t){if(0<this._videoBytes.byteAvailable){var r=Math.min(this._videoBytes.byteAvailable,t),t=new Uint8Array(this._videoBytes.read(r));return this._wasm.HEAPU8.set(t,e),r}return this._isEnd?(this._wasm._decode_abort(2),-1):(d.log("no data, wait..."),0)},l.prototype.outer_close=function(){return d.log("outer_close"),0},l.prototype.frame_out=function(e,t,r,n,i,a,o,s,u){var c=this._buffers,d=c.yBuffer,l=c.uBuffer,h=c.vBuffer,p=self.SharedArrayBuffer||self.ArrayBuffer,c=n*t;(d=!d||d.byteLength!==c?this._buffers.yBuffer=new Uint8Array(new p(c)):d).set(this._wasm.HEAPU8.subarray(o,o+c),0);c=i*t/2;(l=!l||l.byteLength!==c?this._buffers.uBuffer=new Uint8Array(new p(c)):l).set(this._wasm.HEAPU8.subarray(s,s+c),0);c=a*t/2;(h=!h||h.byteLength!==c?this._buffers.vBuffer=new Uint8Array(new p(c)):h).set(this._wasm.HEAPU8.subarray(u,u+c),0),this.dispatchMessage({name:"frame",params:{width:e,height:t,pts:r,stride_y:n,stride_u:i,stride_v:a,y:d,u:l,v:h}},[d.buffer,l.buffer,h.buffer])},l.prototype.get_play_time=function(){return this._playTime?this._playTime+(Date.now()-this._playTimeUpdateTime):0},l.prototype.play_exit=function(e){d.log("exit: ",e),e<0?this.dispatchMessage({name:"_onError",params:c.errorClone(new c.DyError("play exit, error code="+e,c.ErrorIds.DecoderWasmError))}):this.dispatchMessage({name:"end"})},l);function l(){var e=null!==o&&o.apply(this,arguments)||this;return e._videoBytes=new u.default({autoClear:!0}),e._isEnd=!1,e._playTime=0,e._playTimeUpdateTime=0,e._hidden=!1,e._buffers={},e}t.default=i},function(e,r,n){"use strict";var i,t=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.LivePlayer=r.PlayerEvents=void 0,n(16);var o,s=a(n(17)),u=n(3),c=n(12),d=n(39),l=n(2),h=n(60),p=n(5),a=n(0),f=n(11),_=n(1),m=n(4),y=a.makeLogger("live-player"),v={url:"",mode:"live",format:"flv",outputFormat:"mp4",mediaHandle:"mse",videoCodec:"h264",enableWorker:!0,debug:!(r.PlayerEvents={ON_MEDIA_INFO:"mediaInfo",ON_FIRST_FRAME:"firstFrame",ON_ERROR:"player_error",ON_SEI:"sei",ON_LOAD_SEI:"loadSei",ON_AAC_DATA:"aacData",ON_EXTRA_DATA_LOAD:"extra_data_load",ON_EXTRA_DATA_PLAY:"extra_data_play",ON_LOW_PERFORMANCE:"low_performance",ON_STAT:"on_stat",ON_M3U8:"ON_M3U8",ON_SWITCH_SUCCESS:"ON_SWITCH_SUCCESS",ON_SWITCH_FAIL:"ON_SWITCH_FAIL"}),stashBuffer:65536,stashTime:200,videoBackTime:10,videoBackTimeThreshold:15,enableJitterBuffer:!1,minBuffer:2,maxBuffer:6,slowRate:.95,fastRate:1.05,audioDurationThreshold:200,videoDurationThreshold:100,startFromZero:!1,smoothSwitchTime:2,hls:{m3u8LoadInterval:1e3,m3u8LoadTimeout:3e3,maxBufferTime:20,seekThreshold:10,tsRetryTimes:4,maxRemainFragments:50,upLevelThreshold:8,enableM3u8Cache:!0},accelerator:{enable:!1,byteRate:6e3}},t=(o=s.default,t(g,o),g.isSupported=function(){return _.isPlayerSupported()},g.isH265Supported=function(){return 4<=navigator.hardwareConcurrency&&_.isWasmSupported()&&_.isPthreadsSupported()},Object.defineProperty(g.prototype,"mediaHandle",{get:function(){return this._config.mediaHandle},enumerable:!1,configurable:!0}),g.prototype.dispose=function(){var e;this._destroyed||(this.pause(),this.detach(),this._mediaManager&&(this._mediaManager.dispose(),this._mediaManager=null),this._loader&&(this._loader.dispose(),this._loader=null),this._mediaHandler&&(this._mediaHandler.dispose(),this._mediaHandler=null),this._timeDispatch&&(this._timeDispatch.destroy(),this._timeDispatch=null),this.removeAllListeners(),this._config&&(null===(e=null===(e=this._config.__internal)||void 0===e?void 0:e.eventbus)||void 0===e||e.removeAllListeners(),this._config=null),this._destroyed=!0,y.log("disposed"))},g.prototype.load=function(){this._destroyed||(this._loader?(y.log("loading..."),this._loader.load(this._config.url,this._config)):y.warn("can't load because there is no available loader"))},g.prototype.attach=function(e){this._mediaHandler&&(this._timeDispatch.attach(e),this._video=e,this._video.addEventListener("loadedmetadata",this._onFirstFrameFromMeta),this._video.addEventListener("canplay",this._onCanplay),this._mediaHandler.attach(e))},g.prototype.detach=function(){this._mediaHandler&&this._mediaHandler.detach(),this._timeDispatch&&this._timeDispatch.detach(),this._video&&(this._video.removeEventListener("loadedmetadata",this._onFirstFrameFromMeta),this._video.removeEventListener("canplay",this._onCanplay),this._video=null)},g.prototype.play=function(){this._video&&this._video.play()},g.prototype.pause=function(){this._video&&this._video.pause()},g.prototype.getMediaInfo=function(){return this._mediaInfo},g.prototype.getStatInfo=function(){var e,t,r,n,i,a={url:"",redirectedURL:"",loaderBytes:0,decodedFrames:0,droppedFrames:0,cdnBytes:0,p2pBytes:0,totalDropBytes:0,uploadBytes:0,fps:0,decodeFps:0,renderFps:0,vbr:this._vbr,width:0,height:0};return this._loader&&(e=(i=this._loader.getStatistics()).loaderBytes,t=i.cdnBytes,r=i.p2pBytes,n=i.totalDropBytes,i=i.uploadBytes,a.url=this._loader.url,a.redirectedURL=this._loader.redirectUrl,a.loaderBytes=e,a.cdnBytes=t,a.p2pBytes=r,a.totalDropBytes=n||0,a.uploadBytes=i||0),this._video&&("function"==typeof this._video.getVideoPlaybackQuality?(i=this._video.getVideoPlaybackQuality(),a.decodedFrames=i.totalVideoFrames,a.droppedFrames=i.droppedVideoFrames):void 0!==this._video.webkitDecodedFrameCount&&(a.decodedFrames=this._video.webkitDecodedFrameCount,a.droppedFrames=this._video.webkitDroppedFrameCount)),this._mediaInfo&&(a.fps=this._mediaInfo.fps,a.width=this._mediaInfo.width,a.height=this._mediaInfo.height),this._mediaHandler&&Object.assign(a,this._mediaHandler.getStatInfo()),a},g.prototype.T_ADV_Timestamp=function(){return this._mediaHandler&&this._mediaHandler.T_ADV_Timestamp()},g.prototype.updateSource=function(e){var t;this._destroyed||(this._isUpdatingSource=!0,y.log("update source: ",e),null!==(t=this._loader)&&void 0!==t&&t.supportSmooth?this._loader.updateSource(e):(t=e.loader||c.createLoader(Object.assign({},this._config,{url:e.url})))?(delete e.loader,this._video&&(this._video.playbackRate=1),e._fullSwitch=!0,this._loader&&(this._loader.format!==t.format&&(y.log("format changed: "+this._loader.format+" -> "+t.format),this._config.format=t.format,this._mediaManager.changeFormat(t.format)),this._loader.reset({switchSource:e,resetReason:"switch"}),this._loader.dispose()),this._loader=t,this._mediaManager.attachLoader(this._loader),this._loader.load(e.url,this._config)):y.warn("unsupport source: ",e))},g.prototype.endOfStream=function(){this._loader&&this._loader.endOfStream()},g.prototype._onMediaInfo=function(e){y.log("onMediaInfo: ",e),this._mediaInfo=e,this.emit(r.PlayerEvents.ON_MEDIA_INFO,e)},g.prototype._onFirstFrameFromMeta=function(){this._onFirstFrame("meta")},g.prototype._onFirstFrame=function(e){void 0===e&&(e="keyframe"),this._isFirstFrameEmitted||(this._isFirstFrameEmitted=!0,this.emit(r.PlayerEvents.ON_FIRST_FRAME),y.log("first frame from "+e))},g.prototype._onExtraData=function(e){var t;"sei"===e.type?(t=e.data)&&0<t.length&&t.forEach(this._onSei):"aacfil"===e.type?this._onAACData(e.data):"vbr"===e.type&&(this._vbr=e.data),this._timeDispatch.add({type:p.TimeDispatchType.EXTRA_DATA,ts:e.ts,data:e}),this.emit(r.PlayerEvents.ON_EXTRA_DATA_LOAD,e)},g.prototype._onCanplay=function(){this._config.__internal.eventbus.emit(m.InternalEvents.FIRST_FRAME)},g.prototype._onError=function(e){(e=!e||!e.errorId?new l.DyError("unknown error: "+e,l.ErrorIds.Unknown):e).updatedSource=this._isUpdatingSource,y.warn("player error: "+e.name+" fatal="+e.fatal+" updatedSource="+e.updatedSource+" errorId="+e.errorId+" "+e.message),this._isUpdatingSource&&e.fatal&&this._onSwitchSourceFail({data:{}}),this.emit(r.PlayerEvents.ON_ERROR,e),e.fatal&&this.dispose()},g.prototype._onSei=function(e){this._timeDispatch.add({type:p.TimeDispatchType.H264_SEI,ts:e.seiTimestamp,data:e}),this.emit(r.PlayerEvents.ON_LOAD_SEI,e)},g.prototype._onAACData=function(e){this.emit(r.PlayerEvents.ON_AAC_DATA,e.data)},g.prototype._onTimeDispatch=function(e){switch(e.type){case p.TimeDispatchType.H264_SEI:this.emit(r.PlayerEvents.ON_SEI,e.data);break;case p.TimeDispatchType.EXTRA_DATA:this.emit(r.PlayerEvents.ON_EXTRA_DATA_PLAY,e.data)}},g.prototype._onLowPerformance=function(){this.emit(r.PlayerEvents.ON_LOW_PERFORMANCE)},g.prototype._onSeek=function(){this._timeDispatch&&this._timeDispatch.clear()},g.prototype._onStat=function(e){e=e.data;this.emit(r.PlayerEvents.ON_STAT,e)},g.prototype._outM3u8Time=function(e){e=e.data;this.emit(r.PlayerEvents.ON_M3U8,e)},g.prototype._onSwitchSourceSuccess=function(e){e=e.data;this._isUpdatingSource&&this.emit(r.PlayerEvents.ON_SWITCH_SUCCESS,e),this._isUpdatingSource=!1},g.prototype._onSwitchSourceFail=function(e){e=e.data;this._isUpdatingSource&&this.emit(r.PlayerEvents.ON_SWITCH_FAIL,e),this._isUpdatingSource=!1},g);function g(e){var t=o.call(this)||this;if(t._destroyed=!1,t._isFirstFrameEmitted=!1,t._vbr=0,t._isUpdatingSource=!1,u.bindAll(t),e.hls=Object.assign({},v.hls,e.hls),e.accelerator=Object.assign({},v.accelerator,e.accelerator),e.__internal={eventbus:new m.InternalEventBus},t._config=e=Object.assign({},v,e),y.setEnable(e.debug),y.log("version="+p.VERSION),"h265"===e.videoCodec){if(!_.isWasmSupported())return setTimeout(function(){t._onError(new l.DyError("Do not support wasm, can't play h265 video.",l.ErrorIds.WasmUnsupportError))},0),t;e.__internal.wasmHvcc=n(76),e.__internal.wasmDecoderPthread=n(78),_.isH265Supported()?(y.log("h265 browser supported, use mse play."),e.mediaHandle="mse",e.accelerator.enable=!1):e.accelerator.enable?(y.log("h265 accelerator enabled, use mse play."),e.mediaHandle="mse"):(y.log("h265 browser not supported, use soft decode."),e.mediaHandle="soft")}return t._config.loader?t._loader=t._config.loader:t._loader=c.createLoader(t._config),t._loader?(e.format=t._loader.format,t._mediaHandler=f.createMediaHandler(e),t._mediaHandler?(t._mediaHandler.onHasKeyframe=t._onFirstFrame,t._mediaHandler.onExtraData=t._onExtraData,t._mediaHandler.onMediaInfo=t._onMediaInfo,t._mediaHandler.onLowPerformance=t._onLowPerformance,t._timeDispatch=new h.TimeDispatch,t._timeDispatch.onSend=t._onTimeDispatch,t._mediaManager=new d.MediaManager(t._loader,t._mediaHandler,t._config),t._mediaManager.onError=t._onError,t._mediaManager.init(),t._config.__internal.eventbus.on(m.InternalEvents.SEEK,t._onSeek),t._config.__internal.eventbus.on(m.InternalEvents.STAT,t._onStat),t._config.__internal.eventbus.on(m.InternalEvents.M3U8TIME,t._outM3u8Time),t._config.__internal.eventbus.on(m.InternalEvents.SWITCH_SOURCE_SUCCESS,t._onSwitchSourceSuccess),t._config.__internal.eventbus.on(m.InternalEvents.SWITCH_SOURCE_FAIL,t._onSwitchSourceFail),y.log("init")):setTimeout(function(){t._onError(new l.DyError("Do not has supported media-handler.",l.ErrorIds.NoSupportedMediaHandler))},0)):setTimeout(function(){t._onError(new l.DyError("Do not has supported loader.",l.ErrorIds.NoSupportedLoader))},0),t}r.LivePlayer=t},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FetchStreamLoader=void 0;var o,s=r(9),u=r(2),c=a(r(7)),i=(o=s.BaseLoader,i(d,o),d.isSupported=function(){try{var e=c.default.msedge&&15048<=c.default.version.minor,t=!c.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}},d.prototype.load=function(t,e,r){var n,i=this;o.prototype.load.call(this,t,e),null!=r&&r.headers&&(n={headers:r.headers}),fetch(t,n).then(function(e){if(i._status=null==e?void 0:e.status,e&&e.ok)return t!==e.url&&i._onRedirectUrl(e.url),e.body.getReader();throw e?new Error("err: "+e.status+" "+e.statusText):new Error("err: no response, maybe blocked.")}).then(function(r){var n;i._reader=r,i._destroyed?i.dispose():(n=function(e){var t=e.done,e=e.value;t?i._onEnd():(i._onData(e.buffer),r.read().then(n).catch(i._onError))},r.read().then(n).catch(i._onError))}).catch(function(e){e&&11===e.code&&c.default.msedge||i._onError(new u.DyNetworkError("fetch stream failed: "+e,u.ErrorIds.NetworkError))})},d.prototype.dispose=function(){this._reader&&(this._reader.cancel().catch(function(e){}),this._reader=null),o.prototype.dispose.call(this)},d.prototype._onEnd=function(){this._reader=null,o.prototype._onEnd.call(this)},d);function d(){return null!==o&&o.apply(this,arguments)||this}t.FetchStreamLoader=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.MozChunkedLoader=void 0;var a,o=r(9),s=r(2),i=(a=o.BaseLoader,i(u,a),u.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),(e.responseType="moz-chunked-arraybuffer")===e.responseType}catch(e){return!1}},u.prototype.load=function(e,t,r){a.prototype.load.call(this,e,t),this._requestURL=e;var n=this._xhr=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="moz-chunked-arraybuffer",null!=r&&r.headers&&Object.keys(r.headers).forEach(function(e){return n.setRequestHeader(e,r.headers[e])}),n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onloadend=this._onLoadEnd.bind(this),n.onerror=this._onXhrError.bind(this),n.send()},u.prototype.dispose=function(){this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),a.prototype.dispose.call(this)},u.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort()},u.prototype._onReadyStateChange=function(e){e=e.target;2===e.readyState&&(null!=e.responseURL&&e.responseURL!==this._requestURL&&this._onRedirectUrl(e.responseURL),this._status=e.status,0!==e.status&&(e.status<200||299<e.status)&&this._onError(new s.DyNetworkError("MozChunkedLoader: Http code invalid, "+e.status+" "+e.statusText,s.ErrorIds.NetworkError)))},u.prototype._onProgress=function(e){e=e.target.response;this._onData(e)},u.prototype._onLoadEnd=function(e){!0!==this._requestAbort?this._onEnd():this._requestAbort=!1},u.prototype._onXhrError=function(e){this._onError("xhr load exit")},u);function u(){var e=a.call(this)||this;return e._xhr=null,e._requestAbort=!1,e}t.MozChunkedLoader=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.HlsLoader=void 0;var o,s=r(9),u=r(2),c=r(33),d=r(0),l=r(34),h=r(4),p=r(1),f=r(6),_=r(37),m=r(38),y=d.makeLogger("hls-loader"),i=(o=s.BaseLoader,i(v,o),Object.defineProperty(v.prototype,"supportSmooth",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"format",{get:function(){return"ts"},enumerable:!1,configurable:!0}),v.prototype.load=function(e,t){o.prototype.load.call(this,e,t),this._config.__internal.eventbus.on(h.InternalEvents.SEEK,this._onSeeking),this._config.__internal.eventbus.on(h.InternalEvents.BASE_TS,this._onBaseTs),this._bizData=this._config.data;t=a({getBufferTime:this._getBufferTime,CdnLoader:l.TsLoader},t);this._config.hls.TsLoader?this._tsLoader=new this._config.hls.TsLoader(t):this._tsLoader=new l.TsLoader(t),this._tsLoader.onData=this._onTsData,this._tsLoader.onEnd=this._onTsEnd,this._tsLoader.onError=this._onTsError,this._m3u8Load(),this._checkLoadTimer=setInterval(this._checkLoad,2e3),"live"===this._config.mode&&(this._reloadTimer=setInterval(this._m3u8Load,this._config.hls.m3u8LoadInterval)),this._bitrateControl=new m.BitrateControl,this._bitrateControl.onBitrate=this._onBitrate},v.prototype.dispose=function(){o.prototype.dispose.call(this),this._config.__internal.eventbus.off(h.InternalEvents.SEEK,this._onSeeking),this._config.__internal.eventbus.off(h.InternalEvents.BASE_TS,this._onBaseTs),this._tsLoader&&(this._tsLoader.dispose(),this._tsLoader=null),this._fragments=null,this._tsLoadError=null,this._m3u8Request&&(this._m3u8Request.cancel(),this._m3u8Request=null),this._updateRequest&&(this._updateRequest.cancel(),this._updateRequest=null),clearInterval(this._reloadTimer),clearInterval(this._checkLoadTimer),this._bitrateControl=null,this._m3u8Streams=null,this._currentStream=null,this._m3u8Cache=null,y.log("disposed")},v.prototype.updateSource=function(t,r){var n=this;p.isHls(t.url)?(this._updateRequest&&(this._updateRequest.cancel(),this._updateRequest=null),this._requestM3u8(t.url,function(e){return n._updateRequest=e}).then(function(e){n._url=t.url,n._updateFragments(e,!0),y.log("update source success, total length: "+e.fragments.length),r&&r(),"smooth"===t.switch&&(n._switchingSource=t,n._bizData=t.data,n._resetReason="switch",n._waitingForSmoothSwitch=!0,n._checkLoad())}).catch(function(e){y.warn("update source error: "+e),"smooth"===t.switch&&n._config.__internal.eventbus.emit(h.InternalEvents.SWITCH_SOURCE_FAIL,{data:{available:n._bizData}})}).then(function(){n._updateRequest=null})):y.warn("can't update source: "+t.url)},v.prototype.endOfStream=function(){var e;this._m3u8HasEnd=!0,"vod"===this._config.mode&&0<(e=Object.keys(this._fragments).sort(p.numberCompare)).length&&(e=this._fragments[e[e.length-1]].endTime,this._onData({action:f.MediaAction.GET_DURATION,actionData:1e3*e})),clearInterval(this._reloadTimer),y.log("m3u8 reached end")},v.prototype.reset=function(e){this._tsLoadError=null,o.prototype.reset.call(this,e)},v.prototype._m3u8Load=function(){var e,t=this;this._m3u8Request||(e=this._url,this._beginDownLoadM3u8Time=(new Date).getTime(),this._requestM3u8(e,function(e){return t._m3u8Request=e}).then(this._parseM3u8).catch(function(e){t._media.getIsWaiting()&&t._onError(new u.DyNetworkError("load m3u8 error: "+e,u.ErrorIds.HlsM3u8LoadError))}).then(function(){t._m3u8Request=null}))},v.prototype._parseM3u8=function(e){var t=this;if(e){this._endDownLoadM3u8Time=(new Date).getTime();var r=this._endDownLoadM3u8Time-this._beginDownLoadM3u8Time;if(r&&this._config.__internal.eventbus.emit(h.InternalEvents.M3U8TIME,{data:r}),null!==(r=e.streams)&&void 0!==r&&r.length)return this._m3u8Streams=e.streams.sort(function(e,t){return t.bitrate-e.bitrate}),this._m3u8Streams.forEach(function(e){return e.url=p.resolveUrl(e.url,t._url)}),this._config.hls.streamFilter&&(this._m3u8Streams=this._m3u8Streams.filter(this._config.hls.streamFilter)),this._currentStream=this._m3u8Streams[this._m3u8Streams.length-1],this._url=this._currentStream.url,void setTimeout(this._m3u8Load,0);this._updateFragments(e),e.hasEnd&&this.endOfStream(),this._isTsLoading||this._checkLoad()}},v.prototype._checkLoad=function(e){var t=this;if(void 0===e&&(e=!1),!this._destroyed){if(this._media.getIsWaiting()&&this._tsLoadError)return this._tsLoadError.fatal=!0,void this._onError(this._tsLoadError);if(this._waitingForSmoothSwitch){if(!this._smoothSwitch())return;this._waitingForSmoothSwitch=!1,this._currentIndex>=this._nextIndex&&(e=!0)}if((!this._isTsLoading||e)&&("live"===this._config.mode||e||this._getBufferTime()<this._config.hls.maxBufferTime)){var r=-1;if(!this._tsLoadError){if(void 0===this._nextIndex){var n=Object.keys(this._fragments).sort(p.numberCompare);if("live"===this._config.mode&&this._config.liveDelay)for(var i=0,a=n.length-1;0<=a;a--)if((i+=this._fragments[n[a]].duration)>=this._config.liveDelay){r=+n[a];break}-1===r&&(r=+n[0])}else r=this._nextIndex;var o=this._fragments[r];o||Object.keys(this._fragments).sort(p.numberCompare).some(function(e){if(r<+e)return y.warn("fragment["+r+"] can't find in list, seek to "+e),o=t._fragments[e],!0}),o&&this._loadTs(o)}}}},v.prototype._onSeeking=function(e){var t=e.data,r=t.seekTime,e=t.waitLockId,t=this._getFragmentIndex(r);-1!==t?(this._resetReason="seek",this._waitLockId=e,e=this._fragments[t],y.log("out-buffer seek "+r+" success: base="+this._baseTime+" frag index="+t+", start="+(this._baseTime+e.startTime)+", end="+(this._baseTime+e.endTime)),this._nextIndex=t,this._waitingForSmoothSwitch=!1,this._checkLoad(!0)):y.warn("out-buffer seek can't find fragment with time="+(r-2)+", seeking "+r+" failed.")},v.prototype._onTsData=function(e){this._bitrateControl.receiveData(e),this._onData(e)},v.prototype._onTsEnd=function(){this._isTsLoading=!1,this._bitrateControl.endDownload(),!this._m3u8HasEnd||this._fragments[this._nextIndex]?this._checkLoad():this._onEnd()},v.prototype._onTsError=function(e){this._isTsLoading=!1,"string"==typeof e&&(e=new u.DyError(e,u.ErrorIds.HlsTsCustomError,!1)),this._tsLoadError=e,this._onError(e)},v.prototype._getFragmentIndex=function(r){var n=this,i=-1;return Object.keys(this._fragments).sort(p.numberCompare).some(function(e){var t=n._fragments[e];if(n._baseTime+t.endTime>=r)return i=+e,!0}),i},v.prototype._onBaseTs=function(e){e=e.data;this._baseTime=+e/1e3},v.prototype._smoothSwitch=function(){y.log("smooth switching...");var e,t=this._media.getCurrentTime(),r=this._getFragmentIndex(t);if(-1===r)return y.log("can't find currentTime="+(t-this._baseTime)+" in fragments: ",this._fragments),!1;if(!this._media.video.paused||this._media.video.ended){for(e=this._fragments[++r];e&&this._baseTime+e.startTime-t<this._config.smoothSwitchTime;)e=this._fragments[++r];if(!e)return y.log("smooth switch failed, can't find proper fragment, current="+(t-this._baseTime)+"("+t+"-"+this._baseTime+")",this._fragments),!1;r=e.index,this._fragments[this._nextIndex]&&(r=Math.min(this._nextIndex,r))}return!!(e=this._fragments[r])&&(y.log("smooth switch will start from "+(this._baseTime+e.startTime)+", currentTime="+t+", currentIndex="+this._currentIndex+", nextIndex="+r),this._nextIndex=r,this._switchingSource._switchTime=this._baseTime+e.startTime,!0)},v.prototype._getBufferTime=function(){if(this._fragments[this._currentIndex]){var e=this._media.getCurrentTime();return this._fragments[this._currentIndex].startTime+this._baseTime-e}return 0},v.prototype._onBitrate=function(t){var r,e=this;this._m3u8Streams.length&&!this._updateRequest&&(y.log("target bitrate: "+t),r=this._m3u8Streams[this._m3u8Streams.length-1],this._m3u8Streams.some(function(e){if(t>=e.bitrate)return r=e,!0}),r&&r.bitrate!==this._currentStream.bitrate&&(y.log("bitrate change from "+this._currentStream.bitrate+" to "+r.bitrate),this.updateSource({url:r.url,switch:"smooth"},function(){e._currentStream=r})))},v.prototype._loadTs=function(e){void 0!==this._currentIndex&&e.index!==this._currentIndex+1?(y.warn("fragment load discontinue, current="+this._currentIndex+", next="+e.index),this.reset({resetReason:this._resetReason,waitLockId:this._waitLockId,switchSource:this._switchingSource})):this._isTsLoading?(y.warn("need abort last ts index="+this._currentIndex+", reset reason: "+this._resetReason),this.reset({resetReason:this._resetReason,waitLockId:this._waitLockId,switchSource:this._switchingSource})):this._switchingSource?(y.warn("source switch, reason: "+this._resetReason),this.extra({resetReason:this._resetReason,waitLockId:this._waitLockId,switchSource:this._switchingSource})):this._waitLockId&&(y.warn("release wait lock id="+this._waitLockId),this.extra({resetReason:this._resetReason,waitLockId:this._waitLockId,switchSource:this._switchingSource})),this._switchingSource=void 0,this._resetReason=void 0,this._waitLockId=void 0;var t={url:p.concatUrl(e.url,this._config.hls.extraQuery),m3u8:p.concatUrl(this._url,this._config.hls.extraQuery),urlRaw:e.urlRaw,retryTimes:this._config.hls.tsRetryTimes,retryInterval:1e3,timeout:e.duration?Math.max(2e3*e.duration,1e4):0};(e.startBytes||e.endBytes)&&(t.extra={headers:{Range:"bytes="+e.startBytes+"-"+e.endBytes}}),this._isTsLoading=!0,this._currentIndex=e.index,this._nextIndex=e.index+1,this._bitrateControl.startDownload(e),this._currentStream?y.log("load ts: index="+e.index+", start="+(this._baseTime+e.startTime)+", end="+(this._baseTime+e.endTime)+", bitrate="+this._currentStream.bitrate):y.log("load ts: index="+e.index+", start="+(this._baseTime+e.startTime)+", end="+(this._baseTime+e.endTime)),this._tsLoader.load(t)},v.prototype._updateFragments=function(r,e){var n=this;void 0===e&&(e=!1);var i,a,t=r.fragments;0<t.length&&(this._lastSequence!==r.sequence||e)&&(this._lastSequence=r.sequence,i=this._fragments,this._fragments={},a=Object.keys(i).sort(p.numberCompare),t.forEach(function(e){var t;e.url=p.resolveUrl(e.urlRaw,n._url),i[e.index-1]?e.startTime=i[e.index-1].endTime:(e.startTime=0,a.length&&0<e.index&&(y.warn("fragment index discontinue. missing "+(e.index-1),r),(t=i[a[0]]).programDateTime&&e.programDateTime&&(e.startTime=t.startTime+(e.programDateTime-t.programDateTime)/1e3,y.log("adjust fragment start time with program date time: index="+e.index+", start="+e.startTime)))),e.endTime=e.startTime+e.duration,n._fragments[e.index]=i[e.index]=e}))},v.prototype._requestM3u8=function(r,n){var i=this;return void 0===n&&(n=null),Promise.resolve().then(function(){var t=i._m3u8Cache[r];if(t)return t;var e=_.request({method:"get",url:p.concatUrl(r,i._config.hls.extraQuery),timeout:i._config.hls.m3u8LoadTimeout,retryTimes:2,retryDelay:500});return n&&n(e),e.then(function(e){return e.data}).then(function(e){if(!i._destroyed)return t=c.parseM3u8(e),i._config.hls.enableM3u8Cache&&"vod"===i._config.mode&&(i._m3u8Cache[r]=t),t})})},v);function v(){var e=null!==o&&o.apply(this,arguments)||this;return e._fragments={},e._lastSequence=-1,e._baseTime=0,e._m3u8HasEnd=!1,e._isTsLoading=!1,e._beginDownLoadM3u8Time=0,e._endDownLoadM3u8Time=0,e._m3u8Streams=[],e._waitingForSmoothSwitch=!1,e._m3u8Cache={},e}t.HlsLoader=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseM3u8=void 0;var c=r(0).makeLogger("m3u8-parser"),d=/#EXTINF:([\d.]+)/,l=/^(?!#)(\S+)/,h=/#EXT-X-BYTERANGE:(\d+)@*(\d*)/,p=/#EXT-X-MEDIA-SEQUENCE:(\d+)/,f=/#EXT-X-ENDLIST/,_=/#EXT-X-PREFETCH:(\S+)/,m=/#EXT-X-STREAM-INF:.*BANDWIDTH=(\d+)/,y=/#EXT-X-PROGRAM-DATE-TIME:(\S+)/;t.parseM3u8=function(e){if(!e)throw new Error("no m3u8 data: "+e);return m.test(e)?(u={streams:[]},e.split(/\s/).forEach(function(e){return(r=e.match(m))?void(s={bitrate:parseInt(r[1],10),streamInfo:e}):(r=e.match(l))?(s.url=r[1],void u.streams.push(s)):void 0}),u):(t=e,i=(n=p.exec(t))?parseInt(n[1],10):(c.warn("no sequence tag, use default sequence=0"),0),e=!!f.exec(t),a={sequence:i,hasEnd:e,fragments:[]},o={index:i++},t.split(/\n/).forEach(function(e){if(n=e.match(_))return o.url=n[1],o.urlRaw=n[1],o.duration=0,a.fragments.push(o),void(o={index:i++});if(n=e.match(y))o.programDateTime=Date.parse(n[1]);else{if(!(n=e.match(d))){if(n=e.match(h)){var t=parseInt(n[1]),r=n[2]?parseInt(n[2]):a.fragments[o.index-1].endBytes+1;return o.startBytes=r,void(o.endBytes=r+t-1)}return(n=e.match(l))?(o.url=o.urlRaw=n[1],a.fragments.push(o),void(o={index:i++})):void 0}o.duration=parseFloat(n[1])}}),a);var t,n,i,a,o,r,s,u}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TsLoader=void 0;var n=r(35),i=r(2),a=r(3),o=r(0),s=r(4),u=o.makeLogger("ts-loader"),o=(c.prototype.load=function(e){this._request&&(u.log("abort last ts request, need reset player: "+this._request.url),this._request.dispose(),this._request=null),this._request=new n.StreamRequest(this._config),this._request.onData=this.onData,this._request.onEnd=this._onEnd,this._request.onError=this._onError,this._request.load(e)},c.prototype.dispose=function(){this._request&&(this._request.dispose(),this._request=null),this.onData=null,this.onEnd=null,this.onError=null},c.prototype._onEnd=function(){this._finish(),this.onEnd()},c.prototype._onError=function(e){this._finish(),this.onError(new i.DyError(e,i.ErrorIds.HlsTsNetworkError,!1))},c.prototype._finish=function(){this._request&&(this._config.__internal.eventbus.emit(s.InternalEvents.STAT,{data:this._request.getStatistics()}),this._request.dispose(),this._request=null)},c);function c(e){this._config=e,a.bindAll(this)}t.TsLoader=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamRequest=void 0;var n=r(12),i=r(0),a=r(3),o=i.makeLogger("stream-request"),s={timeout:0,retryTimes:0,retryInterval:200},i=(Object.defineProperty(u.prototype,"url",{get:function(){return this._options.url},enumerable:!1,configurable:!0}),u.prototype.dispose=function(){clearTimeout(this._delayTimer),clearTimeout(this._timeoutTimer),this.onData=null,this.onEnd=null,this.onError=null,this._loader&&(this._loader.dispose(),this._loader=null)},u.prototype.load=function(e){clearTimeout(this._delayTimer),clearTimeout(this._timeoutTimer),this._loader&&(this._loader.dispose(),this._loader=null),this._options=Object.assign({},s,e),this._loader=n.createLoader({url:this._options.url}),this._loader.onData=this._onLoadData,this._loader.onEnd=this._onLoadEnd,this._loader.onError=this._onLoadError,this._loader.load(this._options.url,this._config,this._options.extra),0<this._options.timeout&&(this._timeoutTimer=setTimeout(this._onTimeout,this._options.timeout)),this._continueBytes=this._loadedBytes,this._loadedBytes=0,o.log("request "+this._options.url+", extra="+JSON.stringify(this._options.extra)+", timeout="+this._options.timeout)},u.prototype.getStatistics=function(){var e;return null===(e=this._loader)||void 0===e?void 0:e.getStatistics()},u.prototype._onLoadData=function(e){if(this._loadedBytes+=e.byteLength,this._continueBytes){if(this._loadedBytes<=this._continueBytes)return;var t=e.byteLength+this._continueBytes-this._loadedBytes;0<t&&(e=e.slice(t)),this._continueBytes=0}this.onData(e)},u.prototype._onTimeout=function(){this._onError("request "+this._options.url+" timeout, exceed "+this._options.timeout+"ms")},u.prototype._onLoadError=function(e){clearTimeout(this._timeoutTimer),this._onError("request "+this._options.url+" error: "+e)},u.prototype._onLoadEnd=function(){clearTimeout(this._timeoutTimer),this.onEnd()},u.prototype._onError=function(e){var t=this;if(o.log(e),this._retryTimes>=this._options.retryTimes){e="request failed: "+e;return o.warn(e),void(this.onError&&this.onError(e))}this._delayTimer=setTimeout(function(){t._retryTimes++,t.load(t._options),o.log("retry request "+t._options.url+" "+t._retryTimes+" times.")},this._options.retryInterval)},u);function u(e){this._retryTimes=0,this._continueBytes=0,this._loadedBytes=0,this._config=e,a.bindAll(this)}t.StreamRequest=i},function(e,t){e.exports=n;var h=null;try{h=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function p(e){return!0===(e&&e.__isLong__)}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=p;var a={},o={};function r(e,t){var r,n,i;return t?(i=0<=(e>>>=0)&&e<256)&&(n=o[e])?n:(r=_(e,(0|e)<0?-1:0,!0),i&&(o[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(n=a[e])?n:(r=_(e,e<0?-1:0,!1),i&&(a[e]=r),r)}function f(e,t){if(isNaN(e))return t?l:v;if(t){if(e<0)return l;if(s<=e)return T}else{if(e<=-u)return S;if(u<=e+1)return E}return e<0?f(-e,t).neg():_(e%i|0,e/i|0,t)}function _(e,t,r){return new n(e,t,r)}n.fromInt=r,n.fromNumber=f,n.fromBits=_;var c=Math.pow;function d(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return v;if(t="number"==typeof t?(r=t,!1):!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if(0<(n=e.indexOf("-")))throw Error("interior hyphen");if(0===n)return d(e.substring(1),t,r).neg();for(var i=f(c(r,8)),a=v,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+s),r);a=s<8?(s=f(c(r,s)),a.mul(s).add(f(u))):(a=a.mul(i)).add(f(u))}return a.unsigned=t,a}function m(e,t){return"number"==typeof e?f(e,t):"string"==typeof e?d(e,t):_(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=d,n.fromValue=m;var i=4294967296,s=i*i,u=s/2,y=r(1<<24),v=r(0);n.ZERO=v;var l=r(0,!0);n.UZERO=l;var g=r(1);n.ONE=g;var b=r(1,!0);n.UONE=b;var w=r(-1);n.NEG_ONE=w;var E=_(-1,2147483647,!1);n.MAX_VALUE=E;var T=_(-1,-1,!0);n.MAX_UNSIGNED_VALUE=T;var S=_(0,-2147483648,!1);n.MIN_VALUE=S;var O=n.prototype;O.toInt=function(){return this.unsigned?this.low>>>0:this.low},O.toNumber=function(){return this.unsigned?(this.high>>>0)*i+(this.low>>>0):this.high*i+(this.low>>>0)},O.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=f(e),r=this.div(t),t=r.mul(t).sub(this);return r.toString(e)+t.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var n=f(c(e,6),this.unsigned),i=this,a="";;){var o=i.div(n),s=(i.sub(o.mul(n)).toInt()>>>0).toString(e);if((i=o).isZero())return s+a;for(;s.length<6;)s="0"+s;a=""+s+a}},O.getHighBits=function(){return this.high},O.getHighBitsUnsigned=function(){return this.high>>>0},O.getLowBits=function(){return this.low},O.getLowBitsUnsigned=function(){return this.low>>>0},O.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},O.isZero=function(){return 0===this.high&&0===this.low},O.eqz=O.isZero,O.isNegative=function(){return!this.unsigned&&this.high<0},O.isPositive=function(){return this.unsigned||0<=this.high},O.isOdd=function(){return 1==(1&this.low)},O.isEven=function(){return 0==(1&this.low)},O.equals=function(e){return p(e)||(e=m(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},O.eq=O.equals,O.notEquals=function(e){return!this.eq(e)},O.neq=O.notEquals,O.ne=O.notEquals,O.lessThan=function(e){return this.comp(e)<0},O.lt=O.lessThan,O.lessThanOrEqual=function(e){return this.comp(e)<=0},O.lte=O.lessThanOrEqual,O.le=O.lessThanOrEqual,O.greaterThan=function(e){return 0<this.comp(e)},O.gt=O.greaterThan,O.greaterThanOrEqual=function(e){return 0<=this.comp(e)},O.gte=O.greaterThanOrEqual,O.ge=O.greaterThanOrEqual,O.compare=function(e){if(p(e)||(e=m(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},O.comp=O.compare,O.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(g)},O.neg=O.negate,O.add=function(e){p(e)||(e=m(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,a=e.high>>>16,o=65535&e.high,s=e.low>>>16,u=0,c=0,d=0,l=0;return d+=(l+=i+(65535&e.low))>>>16,c+=(d+=n+s)>>>16,u+=(c+=r+o)>>>16,u+=t+a,_((d&=65535)<<16|(l&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},O.subtract=function(e){return p(e)||(e=m(e)),this.add(e.neg())},O.sub=O.subtract,O.multiply=function(e){if(this.isZero())return v;if(p(e)||(e=m(e)),h)return _(h.mul(this.low,this.high,e.low,e.high),h.get_high(),this.unsigned);if(e.isZero())return v;if(this.eq(S))return e.isOdd()?S:v;if(e.eq(S))return this.isOdd()?S:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(y)&&e.lt(y))return f(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,a=e.high>>>16,o=65535&e.high,s=e.low>>>16,u=65535&e.low,c=0,d=0,l=0,e=0;return l+=(e+=i*u)>>>16,d+=(l+=n*u)>>>16,l&=65535,d+=(l+=i*s)>>>16,c+=(d+=r*u)>>>16,d&=65535,c+=(d+=n*s)>>>16,d&=65535,c+=(d+=i*o)>>>16,c+=t*u+r*s+n*o+i*a,_((l&=65535)<<16|(e&=65535),(c&=65535)<<16|(d&=65535),this.unsigned)},O.mul=O.multiply,O.divide=function(e){if((e=!p(e)?m(e):e).isZero())throw Error("division by zero");var t,r;if(h)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?_((this.unsigned?h.div_u:h.div_s)(this.low,this.high,e.low,e.high),h.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?l:v;if(this.unsigned){if((e=!e.unsigned?e.toUnsigned():e).gt(this))return l;if(e.gt(this.shru(1)))return b;r=l}else{if(this.eq(S))return e.eq(g)||e.eq(w)?S:e.eq(S)?g:(n=this.shr(1).div(e).shl(1)).eq(v)?e.isNegative()?g:w:(t=this.sub(e.mul(n)),n.add(t.div(e)));if(e.eq(S))return this.unsigned?l:v;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=v}for(t=this;t.gte(e);){for(var n=Math.max(1,Math.floor(t.toNumber()/e.toNumber())),i=Math.ceil(Math.log(n)/Math.LN2),a=i<=48?1:c(2,i-48),o=f(n),s=o.mul(e);s.isNegative()||s.gt(t);)s=(o=f(n-=a,this.unsigned)).mul(e);o.isZero()&&(o=g),r=r.add(o),t=t.sub(s)}return r},O.div=O.divide,O.modulo=function(e){return p(e)||(e=m(e)),h?_((this.unsigned?h.rem_u:h.rem_s)(this.low,this.high,e.low,e.high),h.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},O.mod=O.modulo,O.rem=O.modulo,O.not=function(){return _(~this.low,~this.high,this.unsigned)},O.and=function(e){return p(e)||(e=m(e)),_(this.low&e.low,this.high&e.high,this.unsigned)},O.or=function(e){return p(e)||(e=m(e)),_(this.low|e.low,this.high|e.high,this.unsigned)},O.xor=function(e){return p(e)||(e=m(e)),_(this.low^e.low,this.high^e.high,this.unsigned)},O.shiftLeft=function(e){return p(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?_(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):_(0,this.low<<e-32,this.unsigned)},O.shl=O.shiftLeft,O.shiftRight=function(e){return p(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?_(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):_(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},O.shr=O.shiftRight,O.shiftRightUnsigned=function(e){if(p(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?_(this.low>>>e|t<<32-e,t>>>e,this.unsigned):_(32===e?t:t>>>e-32,0,this.unsigned)},O.shru=O.shiftRightUnsigned,O.shr_u=O.shiftRightUnsigned,O.toSigned=function(){return this.unsigned?_(this.low,this.high,!1):this},O.toUnsigned=function(){return this.unsigned?this:_(this.low,this.high,!0)},O.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},O.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},O.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.request=t.RequestError=void 0;var a,_=r(0).makeLogger("request"),m=(a=Error,i(o,a),o);function o(e,t){e=a.call(this,e)||this;return e.response=t,e}t.RequestError=m;var y={method:"get",type:"text",retryTimes:0,retryDelay:200};function v(e,t){e.status=t.status,e.statusText=t.statusText,e.data=t.response}t.request=function i(a){var o,s,u,e=Object.assign({},y,a),c=e.url,d=e.method,l=e.type,h=e.timeout,p=e.retryTimes,f=e.retryDelay,e=new Promise(function(t,r){function e(e){if(p<1)return _.warn("request "+c+" failed"),v(n,o),void r(new m(e,n));s=setTimeout(function(){_.log("retry request "+c+", remain times: "+(p-1)),(u=i(Object.assign({},a,{retryTimes:p-1}))).then(t).catch(r)},f)}var n={};(o=new XMLHttpRequest).responseType=l,o.open(d.toUpperCase(),c,!0),h&&(o.timeout=h),o.onerror=function(){return e("Network error, status="+o.status+", statusText="+o.statusText)},o.ontimeout=function(){return e("Network timeout exceed "+h+"ms, , status="+o.status+", statusText="+o.statusText)},o.onload=function(){v(n,o),200<=o.status&&o.status<300?t(n):e("Network error, status="+o.status+", statusText="+o.statusText)},o.send(null)});return e.cancel=function(e){void 0===e&&(e="cancel"),clearTimeout(s),u&&u.cancel(e),o&&o.abort()},e.url=c,e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitrateControl=void 0,r(0).makeLogger("bitrate-control");n.prototype.startDownload=function(e){this._fragment=e,this._startTime=Date.now(),this._byteLength=0},n.prototype.receiveData=function(e){e instanceof ArrayBuffer&&(this._byteLength+=e.byteLength)},n.prototype.endDownload=function(){this._endTime=Date.now();var e=(this._endTime-this._startTime)/1e3,t=8*this._byteLength/e,e=Date.now();3e4<e-this._dispatchTime&&(this.onBitrate(t),this._dispatchTime=e)},r=n;function n(){this._byteLength=0,this._startTime=0,this._endTime=0,this._dispatchTime=0}t.BitrateControl=r},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaManager=void 0;var a=i(3),o=i(1),n=i(0),s=i(2),u=r(i(18)),c=n.makeLogger("media-manager"),n=(d.prototype.init=function(){this._transmuxer.postMessage({name:"init",params:o.configClone(this._transmuxer,this._config)})},d.prototype.dispose=function(){this._destroyed=!0,this.onError=null,this._mediaHandler=null,this._loader=null,this._transmuxer.terminate(),this._transmuxer=null},d.prototype.attachLoader=function(e){this._loader=e,this._loader.onData=this.appendData,this._loader.onEnd=this.appendEnd,this._loader.onError=this._onLoaderError,this._loader.attachMedia(this._mediaHandler)},d.prototype.appendData=function(e){var t;this._destroyed||(e instanceof ArrayBuffer?this._transmuxer.postMessage({name:"appendData",params:e},[e]):(t=[],this._config.enableWorker&&e.data&&(e.data=o.u8aClone(e.data),t.push(e.data.buffer)),this._transmuxer.postMessage({name:"appendData",params:e},t)))},d.prototype.appendEnd=function(){c.log("loader end"),this._transmuxer.postMessage({name:"appendEnd"},void 0)},d.prototype.changeFormat=function(e){this._transmuxer.postMessage({name:"changeFormat",params:e},void 0)},d.prototype._onRemuxData=function(e){this._mediaHandler&&this._mediaHandler.appendData(e)},d.prototype._onError=function(e){this.onError&&(!e||e instanceof Error||!e.name||(e=s.errorRestore(e)),this.onError(e))},d.prototype._onMessage=function(e){var t=e.data,r=t.name,n=t.params;try{switch(r){case"_onRemuxData":this._onRemuxData(n);break;case"_onError":this._onError(n)}}catch(e){c.warn("call "+r+" error",e)}},d.prototype._onLoaderError=function(e){e instanceof Error?void 0===e.errorId&&(e.errorId=s.ErrorIds.CustomLoaderError,e.fatal=!0):e=new s.DyError("custom loader error: "+e,s.ErrorIds.CustomLoaderError),this._onError(e)},d);function d(e,t,r){this._destroyed=!1,a.bindAll(this);var n=(this._config=r).enableWorker,r=r.debug;this._mediaHandler=t,this._mediaHandler.onError=this._onError,this.attachLoader(e),n?(this._transmuxer=i(13)(18),this._transmuxer.postMessage({name:"setLoggerEnable",params:r},void 0),c.log("transmuxe with worker")):(this._transmuxer=new u.default,c.log("transmuxe with no worker")),o.connectEventbus(this._transmuxer,this._onMessage,this._config)}t.MediaManager=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},c=this&&this.__generator||function(r,n){var i,a,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,a&&(o=2&t[0]?a.return:t[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,t[1])).done)return o;switch(a=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],a=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var d,u=a(r(8)),o=a(r(41)),l=r(20),h=r(5),p=r(2),a=r(0),f=r(4),_=a.makeLogger("flv-demuxer");(a=d=d||{})[a.WAIT_FLV_FLAG=0]="WAIT_FLV_FLAG",a[a.WAIT_PRE_TAG_SIZE=1]="WAIT_PRE_TAG_SIZE",a[a.WAIT_TAG=2]="WAIT_TAG";var m,i=(m=l.Demuxer,i(y,m),y.prototype.dispose=function(){m.prototype.dispose.call(this),this._parser&&(this._parser.return("dispose"),this._parser=null),this._byteArray=null,this._audioConfig=null,this._videoConfig=null,this._tracks=[],this._destroyed=!0,_.log("disposed")},y.prototype._appendArrayBuffer=function(e){this._byteArray.write(e),this._parseData()},y.prototype._appendEnd=function(){this._parseData(!0),this._parser&&this._parser.return("end"),m.prototype._appendEnd.call(this)},y.prototype._parseData=function(e){var t;void 0===e&&(e=!1),0<this._byteArray.byteAvailable&&(this._parser||(this._parser=this._parse()),t=Date.now(),(e||!this._hasFirstFrame||this._byteArray.byteAvailable>this._config.stashBuffer||t-this._lastParseTime>this._config.stashTime)&&(this._lastParseTime=t,(t=this._parser.next().value)&&t.name===p.DyDemuxError.name?this._error(t):this._tracks.splice(0).forEach(this._dispatchTrack)))},y.prototype._parse=function(){var t,r,n,i,a,o,s,u;return c(this,function(e){switch(e.label){case 0:switch(this._status){case d.WAIT_FLV_FLAG:return[3,1];case d.WAIT_PRE_TAG_SIZE:return[3,4];case d.WAIT_TAG:return[3,7]}return[3,13];case 1:return this._byteArray.byteAvailable<9?[4]:[3,3];case 2:return e.sent(),[3,1];case 3:return"FLV"!==(n=this._byteArray.readString(3))?[2,new p.DyDemuxError("Not valid flv file : "+n,p.ErrorIds.InvalidFlv)]:(this._byteArray.readUint8(),4&(i=this._byteArray.readUint8())&&1&i||(this._trackLength=1),this._byteArray.read(4),this._status=d.WAIT_PRE_TAG_SIZE,[3,13]);case 4:return this._byteArray.byteAvailable<4?[4]:[3,6];case 5:return e.sent(),[3,4];case 6:return this._byteArray.read(4),this._status=d.WAIT_TAG,[3,13];case 7:return this._byteArray.byteAvailable<11?[4]:[3,9];case 8:return e.sent(),[3,7];case 9:t=this._byteArray.readUint8(),r=this._byteArray.readUint24(),n=this._byteArray.readUint24(),i=this._byteArray.readUint8(),a=(i<<24|n)>>>0,this._byteArray.readUint24(),e.label=10;case 10:return this._byteArray.byteAvailable<r?[4]:[3,12];case 11:return e.sent(),[3,10];case 12:switch(o=this._byteArray.bytePosition,s=this._byteArray.read(r),u=void 0,t){case 8:!1!==this._config.hasAudio&&(u=this._parseAudio(s,a));break;case 9:!1!==this._config.hasVideo&&(u=this._parseVideo(s,a,o));break;case 18:this._parseScript(s);break;default:_.warn("unsupport flv tag type",t)}return this._status=d.WAIT_PRE_TAG_SIZE,u?[2,u]:[3,13];case 13:return[3,0];case 14:return[2]}})},y.prototype._error=function(e){this.onError&&this.onError(e)},y.prototype._parseAudio=function(e,t){var r=new u.default({buffer:e}),n=r.readUint8(),i=(240&n)>>4,a=(12&n)>>2,e=1&n,n=r.read(r.byteAvailable),r=this._audioConfig;if(r.channelCount=0==e?1:2,r.audioSampleRate=this._flvSoundRateTable[a],10==i){var o=new Uint8Array(n),a=o[0],o=o.subarray(1),o={type:"audio",trackId:r.trackId,dts:t,pts:t,codec:h.Codec.AAC,config:r,data:o};0===a?(o.flag="CFG",this._pushTrack(o)):1===a?this._pushTrack(o):_.warn(this.TAG,"Flv: Unsupported AAC data type "+a)}else{if(2!=i)return new p.DyDemuxError("unsupport audio type = "+i,p.ErrorIds.UnsupportedFlvAudio);i=new Uint8Array(n),o={type:"audio",trackId:r.trackId,dts:t,pts:t,codec:h.Codec.MP3,config:r,data:i};this._needMp3Header&&(n=s(s({},o),{flag:"CFG",data:new Uint8Array(n.slice(0,4))}),this._pushTrack(n),this._needMp3Header=!1),this._pushTrack(o)}},y.prototype._parseVideo=function(e,t,r){var n=new u.default({buffer:e}),i=n.readUint8(),e=(240&i)>>4,i=15&i;if(7!=i&&12!=i)return new p.DyDemuxError("unsupport video codec type = "+i,p.ErrorIds.UnsupportedFlvVideo);n=n.read(n.byteAvailable);return this._parseVideoPacket(n,0,n.byteLength,t,r,e,i)},y.prototype._parseScript=function(e){e=o.default.parseScriptData(e,0,e.byteLength);"onMetaData"in e&&("number"==typeof(e=e.onMetaData).audiodatarate&&void 0===this._audioConfig.dataRate&&(this._audioConfig.dataRate=e.audiodatarate),"number"==typeof e.videodatarate&&void 0===this._videoConfig.dataRate&&(this._videoConfig.dataRate=e.videodatarate),this._config.__internal.eventbus.emit(f.InternalEvents.METADATA,e),_.log(this.TAG,"Parsed onMetaData",e))},y.prototype._parseVideoPacket=function(e,t,r,n,i,a,o){if(r<4)_.warn(this.TAG,"Flv: Invalid Video packet, missing PacketType or/and CompositionTime");else{var s=new DataView(e,t,r),u=s.getUint8(0),c=(16777215&s.getUint32(0,!1))<<8>>8,s=this._videoConfig,r=new Uint8Array(e,t+4,r-4),a={type:"video",trackId:s.trackId,dts:n,pts:n+c,codec:12===o?h.Codec.H265:h.Codec.H264,config:s,data:r,isKeyframe:1===a};if(0===u)a.flag="CFG",this._pushTrack(a);else if(1===u)this._pushTrack(a);else if(2!==u)return new p.DyDemuxError("Flv: Invalid video packet type "+u,p.ErrorIds.InvalidFlvVideoPacket)}},y.prototype._pushTrack=function(e){this._tracks.push(e)},y.prototype._dispatchTrack=function(e){this._destroyed||this._appendTrack(e)},y.prototype._resetTrack=function(e){m.prototype._resetTrack.call(this,e),this._byteArray.reset(),this._status=d.WAIT_FLV_FLAG,this._tracks=[],this._needMp3Header=!0,this._hasFirstFrame=!1,this._parser&&(this._parser.return("reset"),this._parser=null)},y);function y(e){e=m.call(this,e)||this;return e.TAG="FlvDemuxer",e._destroyed=!1,e._flvSoundRateTable=[5500,11025,22050,44100,48e3],e._status=d.WAIT_FLV_FLAG,e._lastParseTime=0,e._tracks=[],e._needMp3Header=!0,e._byteArray=new u.default({initLength:e._config.stashBuffer,autoClear:!0}),e}t.default=i},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var y=n(r(0)),i=n(r(42)),v=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0]),r=(g.parseScriptData=function(e,t,r){var n={};try{var i=g.parseValue(e,t,r),a=g.parseValue(e,t+i.size,r-i.size);n[i.data]=a.data}catch(e){y.default.error("AMF",e.toString())}return n},g.parseObject=function(e,t,r){if(r<3)throw new Error("Data not enough when parse ScriptDataObject");var n=g.parseString(e,t,r),t=g.parseValue(e,t+n.size,r-n.size),r=t.objectEnd;return{data:{name:n.data,value:t.data},size:n.size+t.size,objectEnd:r}},g.parseVariable=function(e,t,r){return g.parseObject(e,t,r)},g.parseString=function(e,t,r){if(r<2)throw new Error("Data not enough when parse String");r=new DataView(e,t,r).getUint16(0,!v);return{data:0<r?i.default(new Uint8Array(e,t+2,r)):"",size:2+r}},g.parseLongString=function(e,t,r){if(r<4)throw new Error("Data not enough when parse LongString");r=new DataView(e,t,r).getUint32(0,!v);return{data:0<r?i.default(new Uint8Array(e,t+4,r)):"",size:4+r}},g.parseDate=function(e,t,r){if(r<10)throw new Error("Data size invalid when parse Date");t=new DataView(e,t,r),r=t.getFloat64(0,!v),t=t.getInt16(8,!v);return{data:new Date(r+=60*t*1e3),size:10}},g.parseValue=function(e,t,r){if(r<1)throw new Error("Data not enough when parse Value");var n=new DataView(e,t,r),i=1,a=n.getUint8(0),o=!1;try{switch(a){case 0:u=n.getFloat64(1,!v),i+=8;break;case 1:u=!!n.getUint8(1),i+=1;break;case 2:var s=g.parseString(e,t+1,r-1),u=s.data;i+=s.size;break;case 3:u={};var c=0;for(9==(16777215&n.getUint32(r-4,!v))&&(c=3);i<r-4;){var d=g.parseObject(e,t+i,r-i-c);if(d.objectEnd)break;u[d.data.name]=d.data.value,i+=d.size}i<=r-3&&9==(16777215&n.getUint32(i-1,!v))&&(i+=3);break;case 8:for(u={},i+=4,c=0,9==(16777215&n.getUint32(r-4,!v))&&(c=3);i<r-8;){var l=g.parseVariable(e,t+i,r-i-c);if(l.objectEnd)break;u[l.data.name]=l.data.value,i+=l.size}i<=r-3&&9==(16777215&n.getUint32(i-1,!v))&&(i+=3);break;case 9:i=1,o=!(u=void 0);break;case 10:u=[];var h=n.getUint32(1,!v);i+=4;for(var p=0;p<h;p++){var f=g.parseValue(e,t+i,r-i);u.push(f.data),i+=f.size}break;case 11:var _=g.parseDate(e,t+1,r-1);u=_.data,i+=_.size;break;case 12:var m=g.parseString(e,t+1,r-1);u=m.data,i+=m.size;break;default:i=r,y.default.warn("AMF","Unsupported AMF value type "+a)}}catch(e){y.default.error("AMF",e.toString())}return{data:u,size:i,objectEnd:o}},g);function g(){}t.default=r},function(e,t,r){"use strict";function o(e,t,r){var n=e;if(t+r<n.length){for(;r--;)if(128!=(192&n[++t]))return;return 1}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t,r=[],n=e,i=0,a=e.length;i<a;)if(n[i]<128)r.push(String.fromCharCode(n[i])),++i;else{if(!(n[i]<192))if(n[i]<224){if(o(n,i,1)&&128<=(t=(31&n[i])<<6|63&n[i+1])){r.push(String.fromCharCode(65535&t)),i+=2;continue}}else if(n[i]<240){if(o(n,i,2)&&2048<=(t=(15&n[i])<<12|(63&n[i+1])<<6|63&n[i+2])&&55296!=(63488&t)){r.push(String.fromCharCode(65535&t)),i+=3;continue}}else if(n[i]<248)if(o(n,i,3)&&65536<(t=(7&n[i])<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3])&&t<1114112){t-=65536,r.push(String.fromCharCode(t>>>10|55296)),r.push(String.fromCharCode(1023&t|56320)),i+=4;continue}r.push(String.fromCharCode(65533)),++i}return r.join("")}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),p=this&&this.__assign||function(){return(p=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TsDemuxer=void 0;var o,s=r(19),u=r(0),_=a(r(8)),m=r(5),c=r(44),d=r(22),f=r(23),y=r(1),v=u.makeLogger("ts-demuxer"),i=(o=s.Demuxer,i(l,o),l.prototype.dispose=function(){o.prototype.dispose.call(this),this._byteArray=null,this._pmt=null,this._audioConfig=null,this._videoConfig=null,v.log("disposed")},l.prototype._appendArrayBuffer=function(e){this._byteArray.write(e),this._parseTsPacket()},l.prototype._parseTsPacket=function(e){for(void 0===e&&(e=!1);188<=this._byteArray.byteAvailable;){var t=this._byteArray.read(188),r=new Uint8Array(t);if(0===this._byteArray.byteAvailable&&!e)return void this._byteArray.back(188);if(0<this._byteArray.byteAvailable){var n=this._byteArray.peekBytes(1)[0];if(71!==r[0]||71!==n){v.log("invalid ts packet, trying find new ts"),this._resetPes(),this._byteArray.back(187),this._findTsPacket();continue}}var i,a=r[1]>>6&1,o=(31&r[1])<<8|r[2],t=r[3]>>4&3,s=4;if(2!=t&&3!=t||(i=r[s++],s+=i),0!=o)if(this._pmt.pid&&o===this._pmt.pid)for(h=r[s++],f=(s+=h)+3+(p=(15&r[s+1])<<8|r[s+2])-4,s+=12+((15&r[s+10])<<8|r[s+11]);s<f;){var u=r[s],c=(31&r[s+1])<<8|r[s+2];if(s+=5+((15&r[s+3])<<8|r[s+4]),!this._pmt.streams[c]){var d=void 0,l=void 0;switch(u){case 27:d="video",l=m.Codec.H264;break;case 36:d="video",l=m.Codec.H265;break;case 15:d="audio",l=m.Codec.AAC;break;case 3:d="audio",l=m.Codec.MP3;break;case 21:break;default:v.warn("unsupport stream type: "+u+", pid: "+c)}this._pmt.foundVideo&&"video"===d?v.warn("multiple video found, ignore this one: "+d+" "+l+" "+c):this._pmt.foundAudio&&"audio"===d?v.warn("multiple audio found, ignore this one: "+d+" "+l+" "+c):d&&(this._pmt.streams[c]={type:d,codec:l,pes:{ba:new _.default({initLength:this._config.stashBuffer,autoClear:!0}),waitStart:!0}},"video"===d?this._pmt.foundVideo=!0:this._pmt.foundAudio=!0,v.log("found stream: "+d+" "+l+" "+c))}}else this._pmt.streams[o]&&(n=this._pmt.streams[o].pes,t=r.subarray(s),i=this._isPesStart(t),!n.waitStart||i?(a&&i&&this._parsePes(o),n.ba.write(t),n.waitStart=!1):v.warn("ignore un-start packet pid="+o+", size="+t.byteLength));else{var h=r[s++],p=(15&r[(s+=h)+1])<<8|r[s+2];if(1&r[s+5]){var f=s+3+p-4;for(s+=8;s<f;)r[s]<<8|r[s+1]&&(this._pmt.pid=(31&r[s+2])<<8|r[s+3]),s+=4}}}},l.prototype._isPesStart=function(e){return 0===e[0]&&0===e[1]&&1===e[2]},l.prototype._parsePes=function(e){var t=this._pmt.streams[e],r=t.pes.ba;if(!(r.byteAvailable<11)){r.read(3),r.readUint8(),r.readUint16(),r.readUint8();var e=r.readUint8(),n=(r.readUint8(),536870912*(14&r.readUint8())+(r.readUint16()>>1<<15)+(r.readUint16()>>1));4294967295<n&&(n-=8589934592);var i=n/=90;192===e&&(4294967295<(i=536870912*(14&r.readUint8())+(r.readUint16()>>1<<15)+(r.readUint16()>>1))&&(i-=8589934592),i/=90);var a=r.read(r.byteAvailable),o=t.codec;switch(o){case m.Codec.H264:case m.Codec.H265:this._parseNal(a,n,i,o);break;case m.Codec.AAC:this._parseAdts(a,n,i);break;case m.Codec.MP3:this._parseMp3(a,n,i);break;default:v.warn("unsupport codec="+o)}}},l.prototype._parseNal=function(e,t,r,n){var i,a=this._videoConfig,e=new Uint8Array(e),a={type:a.type,trackId:a.trackId,dts:r,pts:t,codec:n,config:a},n=d.parseNal({codec:n,bytes:e});0<n.configNalus.length&&(e=p(p({},a),{flag:"CFG",data:e.slice(0),dataFormat:"nalu"}),this._appendTrack(e)),0<n.nals.length&&(i=new c.BufferWriter(new ArrayBuffer(n.nalsLength+4*n.nals.length)),n.nals.forEach(function(e){return i.writeUint32(e.naluData.byteLength).write(e.naluData)}),a.data=new Uint8Array(i.buf),this._appendTrack(a))},l.prototype._parseAdts=function(e,t,r){for(var n=new Uint8Array(e),i=n.byteLength,a=this._audioConfig,o={type:"audio",trackId:a.trackId,dts:r,pts:t,codec:m.Codec.AAC,config:a},s=0,u=0;s<i;){var c=n.slice(s,s+7);this._audioHeader&&y.isBufferEqual(this._audioHeader,c)||(this._audioHeader=c,h=n[s+2]>>6,d=n[s+2]>>2&15,l=f.reference.mpegSamplingRates[d],a.refSampleDuration=1024/l*1e3,c=(1&n[s+2])<<2|n[s+3]>>6,(l=[])[0]=(h=1+h)<<3,l[0]|=(15&d)>>>1,l[1]=(15&d)<<7,l[1]|=(15&c)<<3,5==h&&(a[1]|=(15&d)>>>1,a[2]=(1&d)<<7,a[2]|=8,a[3]=0),h=p(p({},o),{flag:"CFG",data:new Uint8Array(l)}),this._appendTrack(h));var d=(3&n[s+3])<<11|n[s+4]<<3|n[s+5]>>5&7,l=s+d,h=t+u*a.refSampleDuration;if(n.length<l)return void v.warn("imcomplete aac frame, aac_frame_length="+d+", missing bytes="+(l-n.length));this._appendTrack(p(p({},o),{pts:h,dts:h,data:n.subarray(s+7,l)})),s=l,u++}},l.prototype._parseMp3=function(e,t,r){var n=new Uint8Array(e),e=this._audioConfig,e={type:"audio",trackId:e.trackId,dts:r,pts:t,codec:m.Codec.MP3,config:e,data:n},n=n.slice(0,4);this._audioHeader&&y.isBufferEqual(this._audioHeader,n)||(this._audioHeader=n,n=p(p({},e),{flag:"CFG",data:n}),this._appendTrack(n)),this._appendTrack(e)},l.prototype._resetTrack=function(e){o.prototype._resetTrack.call(this,e),this._byteArray.reset(),this._resetPes()},l.prototype._resetPes=function(){var t=this;Object.keys(this._pmt.streams).forEach(function(e){e=t._pmt.streams[e];e.pes.ba.reset(),e.pes.waitStart=!0})},l.prototype._flush=function(){var t=this;this._parseTsPacket(!0),Object.keys(this._pmt.streams).forEach(function(e){t._parsePes(+e)})},l.prototype._appendEnd=function(){this._flush(),o.prototype._appendEnd.call(this)},l.prototype._findTsPacket=function(){var r=this;this._byteArray.peekBytes().some(function(e,t){if(71===e)return v.log("find new ts packet, skip "+t+" bytes."),r._byteArray.skip(t),!0})},l);function l(e){e=o.call(this,e)||this;return e._pmt={streams:{}},e._byteArray=new _.default({initLength:e._config.stashBuffer,autoClear:!0}),e}t.TsDemuxer=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferWriter=void 0;var n=(Object.defineProperty(i.prototype,"offset",{get:function(){return this._offset},enumerable:!1,configurable:!0}),i.prototype.write=function(e){var t=e instanceof ArrayBuffer?new Uint8Array(e):e,e=t.length;return 0<e&&(this.u8a.set(t,this._offset),this._offset+=e),this},i.prototype.writeString=function(e){return e&&0<e.length&&this.write(e.split("").map(function(e){return e.charCodeAt(0)})),this},i.prototype.writeInt8=function(e){return this.dv.setInt8(this._offset,e),this._offset+=1,this},i.prototype.writeInt16=function(e,t){return this.dv.setInt16(this._offset,e,t),this._offset+=2,this},i.prototype.writeInt32=function(e,t){return this.dv.setInt32(this._offset,e,t),this._offset+=4,this},i.prototype.writeUint8=function(e){return this.dv.setUint8(this._offset,e),this._offset+=1,this},i.prototype.writeUint16=function(e,t){return this.dv.setUint16(this._offset,e,t),this._offset+=2,this},i.prototype.writeUint32=function(e,t){return this.dv.setUint32(this._offset,e,t),this._offset+=4,this},i.prototype.skip=function(e){return this._offset+=e,this},i);function i(e){this._offset=0,this.buf=e,this.dv=new DataView(e),this.u8a=new Uint8Array(e)}t.BufferWriter=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(c._getbits=function(e,t,r){if(!r||t<=0||8<t)return-1;var n=0,i=7&e,n=r[e=e>>3]<<i&255;if(n>>=8-t,8<i+t){if(void 0===r[1+e])return-1;n|=r[1+e]>>16-t-i}return n},c.parseAacFilData=function(e){for(var t=0,r=0,n=[];;){var i,a=0,o=0,s=[1,35,69,103,137,100,111,117,121];if((a=c._getbits(t,3,e))<0)return null;if(7==a)return n;if(6!=a)return null;if(o=c._getbits(t+=3,4,e),t+=4,o<0)return null;if(15===o){if(i=c._getbits(t,8,e),t+=8,i<0)return null;o+=i-1}if(o<9)return null;for(var u=0;u<9;u++){if(t>>3>=e.length)return null;if(a=c._getbits(t,8,e),t+=8,a!=s[u])return null}if(r+o-9>e.length)return null;for(u=0;u<o-9;u++){if(t>>3>=e.length)return null;if(a=c._getbits(t,8,e),t+=8,a<0)return null;n[r++]=a}}return n},c.getDbData=function(e){if(!e)return null;var t={};if(e){var r=0;if(t.type=e[r++],16==t.type){for(var n=e[r++],i=[],a=0;a<n;a++){var o={uid:"",db:0},s=e[r++],u=e[r++]-s;o.uid="";for(var c=0;c<u;c++)o.uid+=(e[r++]-48).toString();o.db=e[r++],i.push(o)}t.data=i}else t.data=e.slice(r)}return t},c);function c(){}t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Remuxer=void 0;var a,o=r(0),s=r(1),r=r(10),u=o.makeLogger("remuxer"),i=(a=r.TrackHandler,i(c,a),c.prototype.dispose=function(){a.prototype.dispose.call(this),this._config=void 0,this._trackConfigs={}},c.prototype.handleTrack=function(e){var t,r;"CFG"===e.flag?(t=e.config,r=this._trackConfigs[e.trackId],s.isBufferEqual(null==r?void 0:r.bytes,t.bytes)||(this._configChanged(t,r,e),this._trackConfigs[e.trackId]=Object.assign({},t))):this._handleTrackData(e)},c.prototype._handleTrackData=function(e){this.onData(e)},c.prototype._configChanged=function(e,t,r){u.log("track config changed!",t,e)},c);function c(e){var t=a.call(this)||this;return t._trackConfigs={},t._config=e,t}t.Remuxer=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s,u=o(r(48)),c=o(r(7)),d=r(24),o=r(0),l=r(1),h=o.makeLogger("mp4-remuxer"),p=c.default.safari&&(14<c.default.version.major||14===c.default.version.major&&1<=c.default.version.minor),i=(s=d.Remuxer,i(f,s),f.prototype.dispose=function(){s.prototype.dispose.call(this),this._trackInfos=void 0},f.prototype._configChanged=function(e,t,r){h.log("track config changed!",t,e);t=a(a({},e),{duration:l.timescaledTime64(e.duration,e.timescale)});"audio"===e.type?"mp3"!==e.detailCodec||c.default.firefox?(e.mimeType="audio/mp4; codecs="+e.detailCodec,r.data=u.default.generateInitSegment(t),h.log("generate init audio segment")):(e.mimeType="audio/mpeg",this._useAudioMpeg=!0,this._isAudioTimeNeedUpdate=!0,delete r.data):"video"===e.type&&(e.mimeType="video/mp4; codecs="+e.detailCodec,r.data=u.default.generateInitSegment(t),h.log("generate init video segment"));t=this._trackInfos[r.trackId];t&&t.lastTrack?t.pendingConfigTrack=r:this.onData(r)},f.prototype._handleTrackData=function(e){var t=this,r=this._trackConfigs[e.trackId];if(r){if(e.config=r,"audio"===e.type&&this._useAudioMpeg)return this._isAudioTimeNeedUpdate&&(e.extradata.timeOffset=e.pts,this._isAudioTimeNeedUpdate=!1),void this.onData(e);if("RESET"===e.flag)return l.values(this._trackInfos).forEach(function(e){e.lastTrack&&(e.lastTrack.duration=r.refSampleDuration,t._remuxTrack(e.lastTrack))}),this._trackInfos={},this.onData(e),void h.log("reset");var n=this._trackInfos[e.trackId];if(n||(this._trackInfos[e.trackId]=n={lastTrack:void 0,sequenceNumber:1}),e.isEnd)return n.lastTrack&&(n.lastTrack.duration=r.refSampleDuration,this._remuxTrack(n.lastTrack),n.lastTrack=null),e.duration=r.refSampleDuration,void this.onData(e);e.data?(n.lastTrack&&(n.lastTrack.duration=e.dts-n.lastTrack.dts,(c.default.msedge||c.default.firefox||p)&&"audio"===n.lastTrack.type&&n.lastTrack.duration<this._config.audioDurationThreshold&&(n.lastTrack.duration=e.config.refSampleDuration,e.dts=e.pts=n.lastTrack.dts+n.lastTrack.duration),this._remuxTrack(n.lastTrack),n.pendingConfigTrack&&(this.onData(n.pendingConfigTrack),n.pendingConfigTrack=void 0)),n.lastTrack=e):this.onData(e)}},f.prototype._mergeBoxes=function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r},f.prototype._remuxAudio=function(e){var t,r;e.duration<0&&(e.duration=0),e.duration>this._config.audioDurationThreshold&&!e.isFake&&(h.warn("audio duration too long "+e.duration),e.extradata.jumpOverTs=e.pts+e.duration),e.data&&(r={trackId:e.trackId,sequenceNumber:this._trackInfos[e.trackId].sequenceNumber++,samples:[{duration:l.timescaledTime(e.duration,e.config.timescale),size:e.data.byteLength,cts:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,isNonSync:0}}]},t=u.default.moof(r,l.timescaledTime64(e.dts,e.config.timescale)),r=u.default.mdat(e.data),e.data=this._mergeBoxes(t,r)),this.onData(e)},f.prototype._remuxVideo=function(e){e.duration<0&&(e.duration=0),e.duration>this._config.videoDurationThreshold&&!e.isFake&&h.warn("video duration too long "+e.duration);var t,r=e.isKeyframe;e.data&&(r={trackId:e.trackId,sequenceNumber:this._trackInfos[e.trackId].sequenceNumber++,samples:[{duration:l.timescaledTime(e.duration,e.config.timescale),size:e.data.byteLength,cts:l.timescaledTime(e.pts-e.dts,e.config.timescale),flags:{isLeading:0,dependsOn:r?2:1,isDependedOn:r?1:0,hasRedundancy:0,isNonSync:r?0:1}}]},c.default.chrome&&(c.default.version.major<50||50===c.default.version.major&&c.default.version.build<2661)&&((t=r.samples[0].flags).dependsOn=2,t.isNonSync=0),t=u.default.moof(r,l.timescaledTime64(e.dts,e.config.timescale)),r=u.default.mdat(e.data),e.data=this._mergeBoxes(t,r)),this.onData(e)},f.prototype._remuxTrack=function(e){"audio"===e.type?this._remuxAudio(e):"video"===e.type&&this._remuxVideo(e)},f);function f(){var e=null!==s&&s.apply(this,arguments)||this;return e.TAG="MP4Remuxer",e._useAudioMpeg=!1,e._isAudioTimeNeedUpdate=!1,e._trackInfos={},e}t.default=i},function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n};Object.defineProperty(t,"__esModule",{value:!0});var n=(d.init=function(){for(var e in d.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],hvc1:[],hvcC:[]})d.types.hasOwnProperty(e)&&(d.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=d.constants={};t.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),t.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),t.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSC=t.STCO=t.STTS,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),t.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},d.box=function(e){for(var t=8,r=null,n=Array.prototype.slice.call(arguments,1),i=n.length,a=0;a<i;a++)t+=n[a].byteLength;(r=new Uint8Array(t))[0]=t>>>24&255,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r.set(e,4);for(var o=8,a=0;a<i;a++)r.set(n[a],o),o+=n[a].byteLength;return r},d.generateInitSegment=function(e){var t=d.box(d.types.ftyp,d.constants.FTYP),r=d.moov(e),e=new Uint8Array(t.byteLength+r.byteLength);return e.set(t,0),e.set(r,t.byteLength),e},d.moov=function(e){var t=d.mvhd(e.timescale,e.duration),r=d.trak(e),e=d.mvex(e);return d.box(d.types.moov,t,r,e)},d.mvhd=function(e,t){return d.box(d.types.mvhd,new Uint8Array(i([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e],t.toBytesBE(),[0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255])))},d.trak=function(e){return d.box(d.types.trak,d.tkhd(e),d.mdia(e))},d.tkhd=function(e){var t=e.trackId,r=e.duration,n=e.presentWidth,e=e.presentHeight;return d.box(d.types.tkhd,new Uint8Array(i([1,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,0],r.toBytesBE(),[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,e>>>8&255,255&e,0,0])))},d.mdia=function(e){return d.box(d.types.mdia,d.mdhd(e),d.hdlr(e),d.minf(e))},d.mdhd=function(e){var t=e.timescale,e=e.duration;return d.box(d.types.mdhd,new Uint8Array(i([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t],e.toBytesBE(),[85,196,0,0])))},d.hdlr=function(e){var t="audio"===e.type?d.constants.HDLR_AUDIO:d.constants.HDLR_VIDEO;return d.box(d.types.hdlr,t)},d.minf=function(e){var t="audio"===e.type?d.box(d.types.smhd,d.constants.SMHD):d.box(d.types.vmhd,d.constants.VMHD);return d.box(d.types.minf,t,d.dinf(),d.stbl(e))},d.dinf=function(){return d.box(d.types.dinf,d.box(d.types.dref,d.constants.DREF))},d.stbl=function(e){return d.box(d.types.stbl,d.stsd(e),d.box(d.types.stts,d.constants.STTS),d.box(d.types.stsc,d.constants.STSC),d.box(d.types.stsz,d.constants.STSZ),d.box(d.types.stco,d.constants.STCO))},d.stsd=function(e){return"audio"===e.type?"mp3"===e.detailCodec?d.box(d.types.stsd,d.constants.STSD_PREFIX,d.mp3(e)):d.box(d.types.stsd,d.constants.STSD_PREFIX,d.mp4a(e)):"h265"===e.codec?d.box(d.types.stsd,d.constants.STSD_PREFIX,d.hvc1(e)):d.box(d.types.stsd,d.constants.STSD_PREFIX,d.avc1(e))},d.mp3=function(e){var t=e.channelCount,e=e.audioSampleRate,e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,e>>>8&255,255&e,0,0]);return d.box(d.types[".mp3"],e)},d.mp4a=function(e){var t=e.channelCount,r=e.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return d.box(d.types.mp4a,r,d.esds(e))},d.esds=function(e){var t=i(e.bytes),e=t.length,t=new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t).concat([6,1,2]));return d.box(d.types.esds,t)},d.avc1=function(e){var t=e.bytes,r=e.codecWidth,e=e.codecHeight,e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,e>>>8&255,255&e,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,115,107,121,45,119,97,110,103,64,113,113,46,99,111,109,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return d.box(d.types.avc1,e,d.box(d.types.avcC,t))},d.hvc1=function(e){var t=e.bytes,r=e.codecWidth,e=e.codecHeight,e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,e>>>8&255,255&e,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,115,107,121,45,119,97,110,103,64,113,113,46,99,111,109,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return d.box(d.types.hvc1,e,d.box(d.types.hvcC,t))},d.mvex=function(e){return d.box(d.types.mvex,d.trex(e))},d.trex=function(e){e=e.trackId,e=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return d.box(d.types.trex,e)},d.moof=function(e,t){return d.box(d.types.moof,d.mfhd(e.sequenceNumber),d.traf(e,t))},d.mfhd=function(e){e=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]);return d.box(d.types.mfhd,e)},d.traf=function(e,t){var r=e.trackId,n=d.box(d.types.tfhd,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),r=d.box(d.types.tfdt,new Uint8Array(i([1,0,0,0],t.toBytesBE()))),t=d.sdtp(e),e=d.trun(e,t.byteLength+16+16+8+16+8+8+4);return d.box(d.types.traf,n,r,e,t)},d.sdtp=function(e){for(var t=e.samples||[],r=t.length,n=new Uint8Array(4+r),i=0;i<r;i++){var a=t[i].flags;n[i+4]=a.isLeading<<6|a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return d.box(d.types.sdtp,n)},d.trun=function(e,t){var r=e.samples||[],n=r.length,e=12+16*n,i=new Uint8Array(e);i.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,(t+=8+e)>>>24&255,t>>>16&255,t>>>8&255,255&t],0);for(var a=0;a<n;a++){var o=r[a].duration,s=r[a].size,u=r[a].flags,c=r[a].cts;i.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,s>>>24&255,s>>>16&255,s>>>8&255,255&s,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.isNonSync,0,0,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*a)}return d.box(d.types.trun,i)},d.mdat=function(e){return d.box(d.types.mdat,e)},d);function d(){}n.init(),t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackParser=void 0;var o,s=r(0),u=r(50),c=r(2),d=a(r(7)),l=r(5),h=r(4),r=r(10),p=s.makeLogger("track-parser"),i=(o=r.TrackHandler,i(f,o),f.prototype.dispose=function(){o.prototype.dispose.call(this),this._config=void 0,this._pendingTracks=void 0},f.prototype.handleTrack=function(e){if(this._isPending)this._pendingTracks.push(e);else if("RESET"===e.flag&&(this._pendingTracks=[],this._audioExpect=void 0,this._vbrTime=0,this._vbrBytes=0,p.log("reset")),e.data){var t=e.codec,r=u.getParser(t);if(r){if(!r.inited)return this._isPending=!0,this._pendingTracks.push(e),void r.init(this._config,this._onParserInited);var n=e.config;if(n.mimeType||"CFG"===e.flag){if("KEY"===e.flag&&(e.isKeyframe=!0),"CFG"===e.flag){if(n.bytes=e.data,!n.bytes.byteLength)return void p.warn(e.type+" track config bytes is missing");if(0!==r.parseConfig(n,e.dataFormat))return void p.warn("parse "+t+" config error");"audio"===e.type&&(n.timescale=n.audioSampleRate)}else if(e.data&&!e.isFake&&(this._vbrDetect(e),this._audioGapDetect(e),0!==r.parseData(e)))return void p.warn("parse "+t+" data error");this.onData(e)}else p.warn("first track is not cfg, ignore: trackId="+e.trackId+", type="+e.type+", dts="+e.dts+", pts="+e.pts)}else this.onError(new c.DyDemuxError("unsupport codec: "+t,c.ErrorIds.ParserCodecUnsupport))}else this.onData(e)},f.prototype._onParserInited=function(e){e?this.onError(new c.DyDemuxError(""+e,c.ErrorIds.ParserInitError)):(this._isPending=!1,this._pendingTracks.splice(0).forEach(this.append))},f.prototype._audioGapDetect=function(e){var t,r,n;d.default.chrome&&"audio"===e.type&&e.codec===l.Codec.AAC&&e.data&&("KEY"===e.flag||void 0===e.flag)&&1<e.trackLength&&(void 0===this._audioExpect?this._audioExpect=e.dts:(t=Math.floor(1e3*this._audioExpect),r=1e3*e.dts-t,(n=Math.floor(Math.abs(r)/1e3))>this._audioGap&&(p.warn("Large timestamp gap detected; may cause AV sync to drift. time:"+1e3*e.dts+"us expected:"+t+"us delta:"+r+"us"),this._audioGap=n,150<this._audioGap&&(p.warn("Large timestamp gap exceed 150ms, jump over "+e.dts+" and reset."),e.extradata.jumpOverTs=e.dts,this._audioGap=50,this._audioExpect=e.dts))),this._audioExpect+=e.config.refSampleDuration)},f.prototype._vbrDetect=function(e){var t,r;this._vbrTime?(this._vbrBytes+=e.data.byteLength,23e3<=(t=e.dts-this._vbrTime)&&(r=Math.round(8*this._vbrBytes/1024/(t/1e3)),this._vbrBytes=0,this._vbrTime=e.dts,this._config.__internal.eventbus.emit(h.InternalEvents.VBR,{data:{vbr:r,pts:e.pts}}),p.log("vbr="+r+", dts="+e.dts+", delta="+t))):(this._vbrBytes=0,this._vbrTime=e.dts)},f);function f(e){var t=o.call(this)||this;return t._pendingTracks=[],t._isPending=!1,t._audioGap=50,t._vbrTime=0,t._vbrBytes=0,t._config=e,t}t.TrackParser=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getParser=t.registerParser=void 0;var n=r(23),i=r(51),a=r(54),o={};function s(e){o[e.name]=e}t.registerParser=s,t.getParser=function(e){return o[e]},s(i.h264),s(n.aac),s(a.mp3),s(r(55).h265)},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.h264=void 0;var s=r(0),S=o(r(52)),_=a(r(25)),O=r(5),A=r(22),m=r(1),k=s.makeLogger("h264-parser"),P={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3};t.h264={name:O.Codec.H264,inited:!0,parseConfig:function(e,t){if("nalu"===t){var r=A.parseNal({codec:O.Codec.H264,bytes:e.bytes});if(!(0<r.configNalus.length))return k.warn("wrong nalu config data",e),-1;e.bytes=function(e){var t=e.configNalus.find(function(e){return 7===e.naluType}),r=e.configNalus.find(function(e){return 8===e.naluType});if(!t)return null;var n=S.default.parseSPS(t.naluData),i=t.naluData.byteLength,e=r.naluData.byteLength,r=[1,n.profile_idc,n.profile_compatibility,n.level_idc,255,225,i>>8,255&i].concat(Array.prototype.slice.call(t.naluData)).concat([1,e>>8,255&e]).concat(Array.prototype.slice.call(r.naluData));return void 0!==n.bit_depth_luma_minus8&&(r=r.concat([252|n.chroma_format_idc,248|n.bit_depth_luma_minus8,248|n.bit_depth_chroma_minus8,0])),new Uint8Array(r)}(r)}t=e.bytes&&e.bytes.byteLength;if(t<7)return k.warn("Invalid AVCDecoderConfigurationRecord, lack of data!"),-1;var n=e.bytes.buffer,i=e.bytes.byteOffset,a=new DataView(n,i,t),o=(new Uint8Array(n.slice(i,i+t)),0),s=0,u=0,c=0,d=0,l="",h=P,r=a.getUint8(0),t=a.getUint8(1);if(a.getUint8(2),a.getUint8(3),1!==r||0===t)return k.warn("Invalid AVCDecoderConfigurationRecord"),-1;if(3!=(t=1+(3&a.getUint8(4)))&&4!=t)return k.warn("Strange NaluLengthSizeMinusOne: "+(t-1)),-1;var p=31&a.getUint8(5);if(0==p)return k.warn("Invalid AVCDecoderConfigurationRecord: No SPS"),-1;1<p&&k.warn("Strange AVCDecoderConfigurationRecord: SPS Count = "+p);for(var f=6,_=0;_<p;_++){var m=a.getUint16(f,!1);if(f+=2,0!==m){var y=new Uint8Array(n,i+f,m);f+=m;var v=S.default.parseSPS(y);if(0===_){for(var o=v.codec_size.width,s=v.codec_size.height,u=v.present_size.width,c=v.present_size.height,d=(h=0!==v.frame_rate.fps_num&&0!==v.frame_rate.fps_den?v.frame_rate:h).fps_den/h.fps_num*1e3,g=y.subarray(1,4),b="avc1.",w=0;w<3;w++){var E=g[w].toString(16);b+=E=E.length<2?"0"+E:E}l=b}}}var T=a.getUint8(f);if(0===T)return k.warn("Invalid AVCDecoderConfigurationRecord: No PPS"),-1;for(1<T&&k.warn("Strange AVCDecoderConfigurationRecord: PPS Count = "+T),f++,_=0;_<T;_++)m=a.getUint16(f,!1),f+=2,0!==m&&(f+=m);return e.naluLengthSize=t,e.codecWidth=o,e.codecHeight=s,e.presentWidth=u,e.presentHeight=c,e.refSampleDuration=d,e.detailCodec=l,e.fps=h.fps,k.debug("Parsed AVCDecoderConfigurationRecord"),0},parseData:function(e){for(var t=e.data.byteLength,r=e.data.buffer,n=e.data.byteOffset,i=new DataView(r,n,t),a=0,o=e.config.naluLengthSize,s=[];a<t;){if(t<=a+4){k.warn("Malformed Nalu");break}var u=i.getUint32(a,!1);if(3===o&&(u>>>=8),t-o<u)return k.warn("Malformed Nalus, NaluSize > DataSize!"),-1;var c=31&i.getUint8(a+o),d=new Uint8Array(r,n+a,4+u);if(6!=c&&s.push(d),5==c)e.isKeyframe=!0,e.pureKeyframe=d;else if(6==c)try{var l=new Uint8Array(r,n+a+1+o,u-1),h=_.default.parseSEI(l),p=h.seiType,f=h.seiData;f&&f.data&&(p===_.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED&&f.uuid===_.H264SeiUUIDType.CloudVideoStream&&(e.extradata.seiTimestamp=f.data),e.extradata.sei||(e.extradata.sei=[]),e.extradata.sei.push({seiTimestamp:e.dts,seiType:p,seiData:f}))}catch(e){k.warn("parse sei error, ignored!",e)}a+=o+u}return delete e.data,0<s.length&&(e.data=m.bufferConcat(s)),0}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),x=n(r(53)),M=i.makeLogger("sps-parser"),i=(j._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,a=0;a<r;a++)2<=a&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[i]=t[a],i++);return new Uint8Array(n.buffer,0,i)},j.parseSPS=function(e){var t=j._ebsp2rbsp(e),r=new x.default(t);r.readByte();var n=r.readByte(),i=r.readByte(),a=r.readByte();r.readUEG();var o,s,u=j.getProfileString(n),c=j.getLevelString(a),d=1,l=420,h=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(d=r.readUEG())&&r.readBits(1),d<=3&&(l=[0,420,422,444][d]),h=(o=r.readUEG())+8,s=r.readUEG(),r.readBits(1),r.readBool()))for(var p=3!==d?8:12,f=0;f<p;f++)r.readBool()&&j._skipScalingList(r,f<6?16:64);r.readUEG();var _=r.readUEG();if(0===_)r.readUEG();else if(1===_){r.readBits(1),r.readSEG(),r.readSEG();for(var m=r.readUEG(),f=0;f<m;f++)r.readSEG()}r.readUEG(),r.readBits(1);var y=r.readUEG(),v=r.readUEG(),g=r.readBits(1);0===g&&r.readBits(1),r.readBits(1);var b=0,w=0,E=0,T=0;r.readBool()&&(b=r.readUEG(),w=r.readUEG(),E=r.readUEG(),T=r.readUEG());var S=1,O=1,A=0,e=!0,t=0,_=0;r.readBool()&&(r.readBool()&&(0<(k=r.readByte())&&k<16?(S=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][k-1],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][k-1]):255===k&&(S=r.readByte()<<8|r.readByte(),O=r.readByte()<<8|r.readByte())),r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()&&(r.getBitsLeft()<9?M.warn("Truncated VUI"):(I=r.readBits(32),P=r.readBits(32),e=r.readBool(),A=(t=P)/(_=2*I))));var k=1;1===S&&1===O||(k=S/O);var P=0,I=0,I=0===d?(P=1,2-g):(P=3===d?1:2,(1===d?2:1)*(2-g)),y=16*(y+1),g=16*(v+1)*(2-g);y-=(b+w)*P,g-=(E+T)*I;k=Math.ceil(y*k);return r.destroy(),r=null,{profile_idc:n,profile_compatibility:i,level_idc:a,profile_string:u,level_string:c,bit_depth:h,bit_depth_luma_minus8:o,bit_depth_chroma_minus8:s,chroma_format_idc:d,chroma_format:l,chroma_format_string:j.getChromaFormatString(l),frame_rate:{fixed:e,fps:A,fps_den:_,fps_num:t},sar_ratio:{width:S,height:O},codec_size:{width:y,height:g},present_size:{width:k,height:g}}},j._skipScalingList=function(e,t){for(var r=8,n=8,i=0;i<t;i++)r=0===(n=0!==n?(r+e.readSEG()+256)%256:n)?r:n},j.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},j.getLevelString=function(e){return(e/10).toFixed(1)},j.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},j);function j(){}t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(i.prototype.destroy=function(){this._buffer=null},i.prototype._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new Error("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),e=new Uint8Array(4);e.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(e.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},i.prototype.readBits=function(e){if(32<e)throw new Error("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;t=e-this._current_word_bits_left;this._fillCurrentWord();e=Math.min(t,this._current_word_bits_left),t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,r<<e|t},i.prototype.readBool=function(){return 1===this.readBits(1)},i.prototype.readByte=function(){return this.readBits(8)},i.prototype._skipLeadingZero=function(){for(var e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},i.prototype.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},i.prototype.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},i.prototype.getBitsLeft=function(){return this._current_word_bits_left+8*(this._total_bytes-this._buffer_index)},i);function i(e){this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mp3=void 0;var n=r(0),r=r(5),u=n.makeLogger("mp3-parser"),c={_mpegAudioV10SampleRateTable:[44100,48e3,32e3,0],_mpegAudioV20SampleRateTable:[22050,24e3,16e3,0],_mpegAudioV25SampleRateTable:[11025,12e3,8e3,0],_mpegAudioL1BitRateTable:[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],_mpegAudioL2BitRateTable:[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],_mpegAudioL3BitRateTable:[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1]};t.mp3={name:r.Codec.MP3,inited:!0,parseConfig:function(e){if(e.bytes.byteLength<4)return u.warn("Invalid MP3 packet, header missing!"),-1;var t=e.bytes;if(255!==t[0])return-1;var r=t[1]>>>3&3,n=(6&t[1])>>1,i=(240&t[2])>>>4,a=(12&t[2])>>>2,t=3!=(t[3]>>>6&3)?2:1,o=0,s=0;switch(r){case 0:o=c._mpegAudioV25SampleRateTable[a];break;case 2:o=c._mpegAudioV20SampleRateTable[a];break;case 3:o=c._mpegAudioV10SampleRateTable[a]}switch(n){case 1:i<c._mpegAudioL3BitRateTable.length&&(s=c._mpegAudioL3BitRateTable[i]);break;case 2:i<c._mpegAudioL2BitRateTable.length&&(s=c._mpegAudioL2BitRateTable[i]);break;case 3:i<c._mpegAudioL1BitRateTable.length&&(s=c._mpegAudioL1BitRateTable[i])}return e.audioSampleRate=o,e.channelCount=t,e.detailCodec="mp3",e.dataRate=s,e.refSampleDuration=1152/o*1e3,u.log("Parsed MPEG Audio Frame Header"),0},parseData:function(e){return 0}}},function(e,n,t){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.h265=void 0;var h,s=t(0),_=r(t(25)),r=t(5),u=o(t(56)),m=t(1),y=s.makeLogger("h265-parser");n.h265={name:r.Codec.H265,inited:!1,parseConfig:function(e,t){if("nalu"===t&&(e.bytes=function(e){var t=h._malloc(4096),r=e.byteLength,n=h._malloc(r);h.HEAPU8.set(e,n);e=h._hvcC_write(t,4096,n,r),r=null;return e<0?y.warn("hvcc write error: "+e):r=h.HEAPU8.slice(t,t+e),h._free(t),h._free(n),r}(e.bytes)),!e.bytes||e.bytes.byteLength<7)return y.warn("Invalid HvcC, lack of data!"),-1;var r=h._malloc(128),n=h._malloc(e.bytes.byteLength);h.HEAPU8.set(e.bytes,n);var i,a,o,s,u,c,d,l=h._hvcC_parse(r,n,e.bytes.byteLength);return 0===l&&(i=(d=new Int32Array(h.HEAPU8.buffer,r,7))[0],a=d[1],o=d[2],s=d[3],u=d[4],c=d[5],t=d[6],d=h.UTF8ToString(r+d.byteLength),e.naluLengthSize=i,e.codecWidth=a,e.codecHeight=o,e.presentWidth=s,e.presentHeight=u,e.refSampleDuration=t/c*1e3,e.detailCodec=d,e.fps=c/t,y.log("Parsed HvcC")),h._free(r),h._free(n),l},parseData:function(e){for(var t=e.data.byteLength,r=e.data.buffer,n=e.data.byteOffset,i=new DataView(r,n,t),a=0,o=e.config.naluLengthSize,s=[];a<t;){if(t<=a+4){y.warn("Malformed Nalu");break}var u=i.getUint32(a,!1);if(3===o&&(u>>>=8),t-o<u)return y.warn("Malformed Nalus, NaluSize > DataSize!"),-1;var c=(126&i.getUint8(a+o))>>1,d=new Uint8Array(r,n+a,4+u);if(39!=c&&40!=c&&s.push(d),16<=c&&c<=23)e.isKeyframe=!0,e.pureKeyframe=d;else if(39==c||40==c)try{var l=new Uint8Array(r,n+a+2+o,u-1),h=_.default.parseSEI(l),p=h.seiType,f=h.seiData;f&&f.data&&(p===_.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED&&f.uuid===_.H264SeiUUIDType.CloudVideoStream&&(e.extradata.seiTimestamp=f.data),e.extradata.sei||(e.extradata.sei=[]),e.extradata.sei.push({seiTimestamp:e.dts,seiType:p,seiData:f}))}catch(e){y.warn("parse sei error, ignored!",e)}a+=o+u}return delete e.data,0<s.length&&(e.data=m.bufferConcat(s)),0},init:function(e,t){var r;m.isWasmSupported()?(r=e.__internal.wasmHvcc,u.default({locateFile:function(){return r},onAbort:function(e){y.warn("init hvcc wasm error: "+e),t(e)}}).then(function(e){y.log("hvcc wasm inited."),n.h265.inited=!0,h=e,t()})):t("init hvcc wasm error: WebAssembly no supported.")}}},function(t,e,r){!function(G){var q,e=(q="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(a){var r,n;(a=void 0!==(a=a||{})?a:{}).ready=new Promise(function(e,t){r=e,n=t});var e,t={};for(e in a)a.hasOwnProperty(e)&&(t[e]=a[e]);var i="./this.program",o="object"==typeof window,s="function"==typeof importScripts;"object"==typeof G&&"object"==typeof G.versions&&G.versions.node;var u,c="";(o||s)&&(s?c=self.location.href:document.currentScript&&(c=document.currentScript.src),c=0!==(c=q?q:c).indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"",s&&(u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));var d,l,h=a.print||console.log.bind(console),p=a.printErr||console.warn.bind(console);for(e in t)t.hasOwnProperty(e)&&(a[e]=t[e]);t=null,a.arguments&&a.arguments,a.thisProgram&&(i=a.thisProgram),a.quit&&a.quit,a.wasmBinary&&(d=a.wasmBinary),a.noExitRuntime&&a.noExitRuntime,"object"!=typeof WebAssembly&&j("no native wasm support detected");var f,_,m,y,v=new WebAssembly.Table({initial:14,maximum:14,element:"anyfunc"}),g=!1,b="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function w(e,t,r){for(var n=t+r,i=t;e[i]&&!(n<=i);)++i;if(16<i-t&&e.subarray&&b)return b.decode(e.subarray(t,i));for(var a="";t<i;){var o,s,u=e[t++];128&u?(o=63&e[t++],192!=(224&u)?(s=63&e[t++],(u=224==(240&u)?(15&u)<<12|o<<6|s:(7&u)<<18|o<<12|s<<6|63&e[t++])<65536?a+=String.fromCharCode(u):(s=u-65536,a+=String.fromCharCode(55296|s>>10,56320|1023&s))):a+=String.fromCharCode((31&u)<<6|o)):a+=String.fromCharCode(u)}return a}function E(e,t){return e?w(m,e,t):""}var T=a.INITIAL_MEMORY||16777216;function S(e){for(;0<e.length;){var t,r=e.shift();"function"!=typeof r?"number"==typeof(t=r.func)?void 0===r.arg?a.dynCall_v(t):a.dynCall_vi(t,r.arg):t(void 0===r.arg?null:r.arg):r(a)}}T=(f=(l=a.wasmMemory||new WebAssembly.Memory({initial:T/65536,maximum:T/65536}))?l.buffer:f).byteLength,f=T=f,a.HEAP8=_=new Int8Array(T),a.HEAP16=new Int16Array(T),a.HEAP32=y=new Int32Array(T),a.HEAPU8=m=new Uint8Array(T),a.HEAPU16=new Uint16Array(T),a.HEAPU32=new Uint32Array(T),a.HEAPF32=new Float32Array(T),a.HEAPF64=new Float64Array(T),y[12496]=5293024;var O=[],A=[],k=[],P=[],I=0,x=null,M=null;function j(e){a.onAbort&&a.onAbort(e),p(e+=""),g=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";e=new WebAssembly.RuntimeError(e);throw n(e),e}a.preloadedImages={},a.preloadedAudios={};function R(e){return t=e,e="data:application/octet-stream;base64,",String.prototype.startsWith?t.startsWith(e):0===t.indexOf(e);var t}var D="hvcC_parser.wasm";function L(){try{if(d)return new Uint8Array(d);if(u)return u(D);throw"both async and sync fetching of the wasm failed"}catch(e){j(e)}}R(D)||(T=D,D=a.locateFile?a.locateFile(T,c):c+T),A.push({func:function(){F()}});var C={};function B(){if(!B.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:i||"./this.program"};for(t in C)e[t]=C[t];var t,r=[];for(t in e)r.push(t+"="+e[t]);B.strings=r}return B.strings}var U,N={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=N.buffers[e];0===t||10===t?((1===e?h:p)(w(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return N.varargs+=4,y[N.varargs-4>>2]},getStr:function(e){return E(e)},get64:function(e,t){return e}},H={a:function(){j()},k:function(e){console.log(E(e))},j:function(e){console.warn(E(e))},c:function(e,t,r){m.copyWithin(e,t,t+r)},d:function(e){j("OOM")},e:function(n,i){var a=0;return B().forEach(function(e,t){var r=i+a;(function(e,t,r){for(var n=0;n<e.length;++n)_[t++>>0]=e.charCodeAt(n);r||(_[t>>0]=0)})(e,y[n+4*t>>2]=r),a+=e.length+1}),0},f:function(e,t){var r=B();y[e>>2]=r.length;var n=0;return r.forEach(function(e){n+=e.length+1}),y[t>>2]=n,0},h:function(e){return 0},g:function(e,t){e=1==e||2==e?2:j();return _[t>>0]=e,0},i:function(e,t,r,n,i){},b:function(e,t,r,n){for(var i=0,a=0;a<r;a++){for(var o=y[t+8*a>>2],s=y[t+(8*a+4)>>2],u=0;u<s;u++)N.printChar(e,m[o+u]);i+=s}return y[n>>2]=i,0},memory:l,table:v},F=(function(){var t={a:H};function r(e,t){e=e.exports;a.asm=e,I--,a.monitorRunDependencies&&a.monitorRunDependencies(I),0==I&&(null!==x&&(clearInterval(x),x=null),M)&&(e=M,M=null,e())}function n(e){r(e.instance)}function i(e){return(d||!o&&!s||"function"!=typeof fetch?new Promise(function(e,t){e(L())}):fetch(D,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+D+"'";return e.arrayBuffer()}).catch(L)).then(function(e){return WebAssembly.instantiate(e,t)}).then(e,function(e){p("failed to asynchronously prepare wasm: "+e),j(e)})}if(I++,a.monitorRunDependencies&&a.monitorRunDependencies(I),a.instantiateWasm)try{return a.instantiateWasm(t,r)}catch(e){return p("Module.instantiateWasm callback failed with error: "+e)}d||"function"!=typeof WebAssembly.instantiateStreaming||R(D)||"function"!=typeof fetch?i(n):fetch(D,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,t).then(n,function(e){return p("wasm streaming compile failed: "+e),p("falling back to ArrayBuffer instantiation"),i(n)})})}(),a.___wasm_call_ctors=function(){return(F=a.___wasm_call_ctors=a.asm.l).apply(null,arguments)}),V=(a._hvcC_write=function(){return(a._hvcC_write=a.asm.m).apply(null,arguments)},a._hvcC_parse=function(){return(a._hvcC_parse=a.asm.n).apply(null,arguments)},a._log_init=function(){return(a._log_init=a.asm.o).apply(null,arguments)},a._free=function(){return(a._free=a.asm.p).apply(null,arguments)},a._malloc=function(){return(V=a._malloc=a.asm.q).apply(null,arguments)});function W(e){function t(){U||(U=!0,a.calledRun=!0,g||(S(A),S(k),r(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),function(){if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)e=a.postRun.shift(),P.unshift(e);var e;S(P)}()))}0<I||(function(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)e=a.preRun.shift(),O.unshift(e);var e;S(O)}(),0<I||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),t()},1)):t()))}if(a.UTF8ToString=E,a.allocateUTF8=function(e){var t=function(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);(n=55296<=n&&n<=57343?65536+((1023&n)<<10)|1023&e.charCodeAt(++r):n)<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}(e)+1,r=V(t);return r&&function(e,t,r,n){if(0<n){for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if((s=55296<=s&&s<=57343?65536+((1023&s)<<10)|1023&e.charCodeAt(++o):s)<=127){if(a<=r)break;t[r++]=s}else if(s<=2047){if(a<=r+1)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(a<=r+2)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(a<=r+3)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}t[r]=0}}(e,_,r,t),r},M=function e(){U||W(),U||(M=e)},a.run=W,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();return W(),a.ready});t.exports=e}.call(e,r(57))},function(e,t){var r,n,e=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var s,u=[],c=!1,d=-1;function l(){c&&s&&(c=!1,s.length?u=s.concat(u):d=-1,u.length&&h())}function h(){if(!c){var e=o(l);c=!0;for(var t=u.length;t;){for(s=u,u=[];++d<t;)s&&s[d].run();d=-1,t=u.length}s=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||o(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=f,e.addListener=f,e.once=f,e.off=f,e.removeListener=f,e.removeAllListeners=f,e.emit=f,e.prependListener=f,e.prependOnceListener=f,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(15),u=r(5),c=r(2),d=r(10),l=a(r(8)),h=r(1),p=r(0).makeLogger("ws-transcoder"),i=(o=d.TrackHandler,i(f,o),Object.defineProperty(f.prototype,"isConnected",{get:function(){return!(!this._ws||1!==this._ws.readyState)},enumerable:!1,configurable:!0}),f.prototype.dispose=function(){o.prototype.dispose.call(this),this._ws&&(this._ws.onopen=null,this._ws.onmessage=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.close(),this._ws=null),this._buffer=null,this._pendingTracks=null},f.prototype.handleTrack=function(e){if(!this._isEnd)return"RESET"===e.flag?(this._reset(),void this.onData(e)):void("video"===e.type?("CFG"===e.flag&&(this._videoConfigTrack=Object.assign({},e)),e.isEnd&&!this._isEnd&&(this._ws.send(JSON.stringify({type:"end"})),this._isEnd=!0),this._send(e),this._lastVideoTrack=e):this.onData(e))},f.prototype._initWs=function(){var t=this;p.log("init accelerator..."),this._ws=new WebSocket(this._config.accelerator.url),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen,this._ws.onmessage=this._onMessage,this._ws.onclose=function(e){t._isEnd||t._error(new s.DyError("accelerator closed: code="+e.code+", msg="+e.reason,c.ErrorIds.AcceleratorClosed))},this._ws.onerror=function(){return t._error(new s.DyError("accelerator error",c.ErrorIds.AcceleratorError))}},f.prototype._send=function(e){this.isConnected?(e.data&&this._sendBuffer(e.data),delete e.data,e.codec=u.Codec.H264,e.isEnd=!1,e.isKeyframe=!1,this._dispatchVideoTrack(e)):this._pendingTracks.push(e)},f.prototype._sendBuffer=function(e){this._buffer.write(e),this._buffer.byteAvailable>=this._bufferSize&&this._flush()},f.prototype._flush=function(){var e;this._buffer.byteAvailable&&(e=new Uint8Array(this._buffer.readAll()),this._ws.send(e))},f.prototype._onOpen=function(){this._ws.send(JSON.stringify({type:"S",client:location.href,codec:this._config.videoCodec,byteRate:this._config.accelerator.byteRate})),this._pendingTracks.length&&this._pendingTracks.splice(0).forEach(this._send)},f.prototype._onMessage=function(e){var t;"string"==typeof e.data?"end"===(t=JSON.parse(e.data)).type?this._dispatchVideoTrack({type:"video",trackLength:this._lastVideoTrack.trackLength,trackId:this._lastVideoTrack.trackId,config:this._lastVideoTrack.config,dts:this._lastVideoTrack.dts,pts:this._lastVideoTrack.pts,isKeyframe:!1,codec:u.Codec.H264,isEnd:!0}):t.mimeType&&(this._transcodedMimeType=t.mimeType,this._pendingTracks.length&&this._pendingTracks.splice(0).forEach(this._dispatchVideoTrack)):e.data instanceof ArrayBuffer&&this._dispatchVideoTrack({type:"video",trackLength:this._lastVideoTrack.trackLength,trackId:this._lastVideoTrack.trackId,config:this._lastVideoTrack.config,dts:this._lastVideoTrack.dts,pts:this._lastVideoTrack.pts,isKeyframe:!1,codec:u.Codec.H264,data:new Uint8Array(e.data)})},f.prototype._error=function(e){this.onError&&this.onError(e)},f.prototype._dispatchVideoTrack=function(e){this._transcodedMimeType?(e.config.mimeType=this._transcodedMimeType,this.onData(e)):this._pendingTracks.push(e)},f.prototype._reset=function(){p.log("reset"),this._ws&&(this._ws.onopen=null,this._ws.onmessage=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.close(),this._ws=null),this._buffer.reset(),this._pendingTracks=[h.shallowClone(this._videoConfigTrack)],this._transcodedMimeType="",this._initWs()},f);function f(e){var t=o.call(this)||this;return t._pendingTracks=[],t._bufferSize=51200,t._buffer=new l.default({autoClear:!0,initLength:t._bufferSize}),t._isEnd=!1,t._transcodedMimeType="",t._config=e,t._initWs(),t}t.default=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TrackGenerator=void 0;var a,o=r(6),s=r(0),r=r(10),i=(s.makeLogger("track-generator"),a=r.TrackHandler,i(u,a),u.prototype.dispose=function(){a.prototype.dispose.call(this),this._config=void 0,this._lastKeyframe=void 0,this._lastVideoTrack=void 0},u.prototype.handleTrack=function(e){var t,r;"RESET"===e.flag&&(this._lastVideoTrack=void 0),this.onData(e),o.isFrameTrack(e)&&(1===e.trackLength?this._needGenerateVideo||"audio"!==e.type||2!==(null===(t=this._lastKeyframe)||void 0===t?void 0:t.trackLength)||(this._needGenerateVideo=!0):this._needGenerateVideo=!1,"video"===e.type&&(r=Object.assign({},e),(this._lastVideoTrack=r).isKeyframe&&(this._lastKeyframe=r)),this._needGenerateVideo&&"audio"===e.type&&(r=this._lastVideoTrack,this._lastKeyframe&&(!r||50<Math.abs(e.dts-r.dts))&&((r=Object.assign({},this._lastKeyframe)).dts=e.dts,r.pts=e.pts,r.isFake=!0,r.extradata={},r.pureKeyframe&&(r.data=r.pureKeyframe),this.onData(r),this._lastVideoTrack=r)))},u);function u(e){var t=a.call(this)||this;return t._needGenerateVideo=!1,t._config=e,t}t.TrackGenerator=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeDispatch=void 0;var n=r(3),i=r(1),r=(a.prototype.destroy=function(){this.detach(),clearInterval(this._timer)},a.prototype.attach=function(e){this.video=e},a.prototype.detach=function(){this.video=null,this.array=[]},a.prototype.add=function(e){i.binsert(this.array,e,function(e,t){return e.ts-t.ts}),this._onTimeUpdate()},a.prototype.clear=function(){this.array=[]},a.prototype._send=function(e){this.onSend&&this.onSend(e)},a.prototype._onTimeUpdate=function(){if(this.video){for(var e=1e3*this.video.currentTime,t=this.array.length,r=0;r<t;r++){var n=this.array[r];if(n.ts>e)break;this._send(n)}0<r&&this.array.splice(0,r)}},a);function a(){this.array=[],n.bindAll(this),this._timer=setInterval(this._onTimeUpdate,100)}t.TimeDispatch=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHandler=void 0;var n=r(4),i=r(3),r=(Object.defineProperty(a.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),a.prototype.dispose=function(){this._config.__internal.eventbus.off(n.InternalEvents.METADATA,this._onMetadata),this._config.__internal.eventbus.off(n.InternalEvents.VBR,this._onVbr),this.detach(),this.onMediaInfo=void 0,this.onHasKeyframe=void 0,this.onExtraData=void 0,this.onError=void 0,this._destroyed=!0},a.prototype.appendData=function(e){this._destroyed||"CFG"===e.flag&&this._updateMediaInfo(e.config)},a.prototype.attach=function(e){this._video=e},a.prototype.detach=function(){this._video=null},a.prototype.getStatInfo=function(){return{}},a.prototype.getBufferTime=function(){return 0},a.prototype.getCurrentTime=function(){return 0},a.prototype.getIsWaiting=function(){return!1},a.prototype._updateMediaInfo=function(e){"audio"===e.type&&(void 0!==e.dataRate&&(this._mediaInfo.audioDataRate=e.dataRate),this._mediaInfo.audioMimeType=e.mimeType),"video"===e.type&&(void 0!==e.dataRate&&(this._mediaInfo.videoDataRate=e.dataRate),this._mediaInfo.videoMimeType=e.mimeType,this._mediaInfo.fps=e.fps,this._mediaInfo.width=e.codecWidth,this._mediaInfo.height=e.codecHeight),this._mediaInfo.mimeType=[this._mediaInfo.audioMimeType,this._mediaInfo.videoMimeType].filter(function(e){return e}).join(","),this.onMediaInfo&&this.onMediaInfo(this._mediaInfo)},a.prototype.T_ADV_Timestamp=function(){return null},a.prototype._onExtraData=function(e){this.onExtraData&&this.onExtraData(e)},a.prototype._onMetadata=function(e){this._mediaInfo.metadata=e,this.onMediaInfo&&this.onMediaInfo(this._mediaInfo)},a.prototype._onVbr=function(e){var t=e.data,e=t.vbr,t=t.pts;this._onExtraData({type:"vbr",ts:t,data:e})},a);function a(e){this._destroyed=!1,this._mediaInfo={fps:0,width:100,height:100,audioMimeType:"",videoMimeType:"",audioDataRate:0,videoDataRate:0,mimeType:"",metadata:{}},this._config=e,i.bindAll(this),e.__internal.eventbus.on(n.InternalEvents.METADATA,this._onMetadata),e.__internal.eventbus.on(n.InternalEvents.VBR,this._onVbr)}t.MediaHandler=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=void 0,t.throttle=function(r,n,i){var a,o,s,u,c=0;i=i||{};function d(){c=!1===i.leading?0:performance.now(),a=null,u=r.apply(o,s),a||(o=s=null)}function e(){var e=performance.now();c||!1!==i.leading||(c=e);var t=n-(e-c);return o=this,s=arguments,t<=0||n<t?(a&&(clearTimeout(a),a=null),c=e,u=r.apply(o,s),a||(o=s=null)):a||!1===i.trailing||(a=setTimeout(d,t)),u}return e.cancel=function(){clearTimeout(a),c=0,a=o=s=null},e}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToFile=void 0;var o,s=a(r(8)),a=r(11),u=r(1),i=(o=a.MediaHandler,i(c,o),c.prototype.dispose=function(){},c.prototype.appendData=function(e){"video"===e.type&&(this._byteArray.write(e.data),e.isEnd&&this.appendEnd())},c.prototype.appendEnd=function(){u.saveAs(new Blob([this._byteArray.buffer],{type:"octet/stream"}),"sample.mp4")},c.prototype.attach=function(e){},c.prototype.detach=function(){},c);function c(e){e=o.call(this,e)||this;return e._byteArray=new s.default,e}t.ToFile=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ToSoftDecoder=void 0;var o,s=r(11),u=r(1),c=r(0),d=r(27),l=r(65),h=a(r(66)),p=r(2),f=r(72),_=c.makeLogger("soft-decoder"),i=(o=s.MediaHandler,i(m,o),m.prototype.dispose=function(){o.prototype.dispose.call(this),f.PageVisibility.offChange(this.handleVisibility),clearInterval(this._updateTimer),this._pendingFrame=null,this._mse&&(this._mse.dispose(),this._mse=null),this._decodeFpsDetect&&(this._decodeFpsDetect.destroy(),this._decodeFpsDetect=null),this._renderFpsDetect&&(this._renderFpsDetect.destroy(),this._renderFpsDetect=null),this._decoder&&(this._decoder.terminate(),this._decoder=null),_.log("disposed")},m.prototype.postMessage=function(e,t){this._decoder.postMessage(e,t)},m.prototype.onMessage=function(e){var t=e.data,r=t.name,n=t.params;try{switch(r){case"frame":this._pendingFrame||requestAnimationFrame(this.renderFrame),this._pendingFrame=n,this._decodeFpsDetect.add();break;case"_onError":this._onError(p.errorRestore(n));break;case"end":clearInterval(this._updateTimer)}}catch(e){_.warn("call soft decoder "+r+" error",e)}},m.prototype.appendData=function(e){var t,r,n;this._destroyed||(o.prototype.appendData.call(this,e),"audio"===e.type?(e.trackLength=1,this._mse.appendData(e)):"video"===e.type&&(e.extradata&&(t=(n=e.extradata).seiTimestamp,r=n.aacfil,n=n.sei,t&&(this.seiTimestamp=t),r&&this._onExtraData({type:"aacfil",ts:e.pts,data:r}),n&&this._onExtraData({type:"sei",ts:e.pts,data:n})),e.pts&&(this.preTimestamp=e.pts),"video"===e.type&&e.isKeyframe&&(this._keyframes.push(e.pts/1e3),this.onHasKeyframe&&this.onHasKeyframe()),e.data&&(this.postMessage({name:"bytes",params:e.data},[e.data.buffer]),delete e.data)),e.isEnd&&this.appendEnd())},m.prototype.appendEnd=function(){this.postMessage({name:"end"})},m.prototype.attach=function(e){var t=this;if(o.prototype.attach.call(this,e),this._canvas=document.getElementById(this._config.canvasId),this._canvas){this._canvas.style.visibility="",this._mse.attach(e);try{this._yuvCanvas=h.default.attach(this._canvas,{webGL:!0,alpha:!1,premultipliedAlpha:!1,antialias:!1,powerPreference:"default",preserveDrawingBuffer:!1}),this._canvasUpdateTimer=setInterval(this._onCanvasUpdate,100)}catch(e){setTimeout(function(){t.onWebglError(e)},0)}}else this._onError(new p.DyError("invalid canvas id: "+this._config.canvasId,p.ErrorIds.DecoderInvalidCanvas))},m.prototype.detach=function(){clearInterval(this._canvasUpdateTimer),this._canvas=null,this._video=null,this._yuvCanvas=null,this._mse&&this._mse.detach(),o.prototype.detach.call(this)},m.prototype.updatePlayTime=function(){var t=this;this.postMessage({name:"playtime",params:this._video.currentTime}),this.checkPerformance(),this._keyframes=this._keyframes.filter(function(e){return e>=t._lastRenderPts})},m.prototype.renderFrame=function(){if(this._pendingFrame){var e=this._pendingFrame,t=e.width,r=e.height,n=e.pts,i=e.stride_y,a=e.stride_u,o=e.stride_v,s=e.y,u=e.u,c=e.v,d=this._canvasWidth,l=this._canvasHeight;if(d&&l){var h=t/d,p=(h=h*l<r?r/l:h)*d,d=h*l,h=(d-r)/2,l=(p-t)/2;try{this._yuvCanvas.drawFrame({format:{top:h,left:l,width:t,height:r,chromaWidth:t/2,chromaHeight:r/2,cropLeft:0,cropTop:0,cropWidth:t,cropHeight:r,displayWidth:p,displayHeight:d},y:{stride:i,bytes:s},u:{stride:a,bytes:u},v:{stride:o,bytes:c}}),this._lastRenderPts=n,this._renderFpsDetect.add(),this._firstFrame||(this._firstFrame=!0,this.onHasKeyframe&&this.onHasKeyframe())}catch(e){this.onWebglError(e)}this._pendingFrame=null}}},m.prototype.getStatInfo=function(){var e=this._decodeFpsDetect.total;return{decodedFrames:e,droppedFrames:e-this._renderFpsDetect.total,decodeFps:this._decodeFpsDetect.fps,renderFps:this._renderFpsDetect.fps}},m.prototype.handleVisibility=function(){this.postMessage({name:"visibility",params:f.PageVisibility.isHidden()})},m.prototype.checkPerformance=function(){var e;null!==(e=this._mediaInfo)&&void 0!==e&&e.fps&&this._decodeFpsDetect.fps&&(this._decodeFpsDetect.fps<this._mediaInfo.fps-2?this._lowFpsTimes++:this._lowFpsTimes=0,20<this._lowFpsTimes&&this._video&&this._video.currentTime&&2<Math.abs(this._video.currentTime-this._lastRenderPts)&&(_.warn("soft decode low performance"),this._lowFpsTimes=0,this.onLowPerformance&&this.onLowPerformance()))},m.prototype.onWebglError=function(e){this._onError(new p.DyError("webgl error: "+e,p.ErrorIds.RenderWebglError))},m.prototype.T_ADV_Timestamp=function(){if(this._video){var e=this._video;if(0!=e.buffered.length)return{bufferLength:e.buffered.end(0)-e.currentTime,ptsTimestamp:this.preTimestamp,seiTimestamp:this.seiTimestamp,keyframes:this._keyframes.concat()}}},m.prototype._onCanvasUpdate=function(){this._canvas&&(this._canvasWidth=this._canvas.clientWidth,this._canvasHeight=this._canvas.clientHeight)},m.prototype._onError=function(e){this.onError&&this.onError(e)},m.prototype.getBufferTime=function(){return(this.preTimestamp-this._lastRenderPts)/1e3},m.prototype.getCurrentTime=function(){return this.preTimestamp/1e3},m.prototype.getIsWaiting=function(){return this._mse.getIsWaiting()},m);function m(e){var t=o.call(this,e)||this;return t.preTimestamp=0,t._lowFpsTimes=0,t._firstFrame=!1,t._keyframes=[],t._lastRenderPts=0,t._canvasWidth=0,t._canvasHeight=0,t._mse=new d.ToMSE(e),t._mse.onError=t._onError,u.isPthreadsSupported()?t._decoder=r(13)(73):t._decoder=r(13)(28),u.connectEventbus(t._decoder,t.onMessage,t._config),t.postMessage({name:"init",params:u.configClone(t._decoder,e)}),t._updateTimer=setInterval(t.updatePlayTime,1e3),t._decodeFpsDetect=new l.FpsDetect,t._renderFpsDetect=new l.FpsDetect,f.PageVisibility.onChange(t.handleVisibility),t.handleVisibility(),window.T_ADV_Timestamp=t.T_ADV_Timestamp,t}t.ToSoftDecoder=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FpsDetect=void 0;var n=r(3),r=(Object.defineProperty(i.prototype,"fps",{get:function(){return this._fps},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"total",{get:function(){return this._total},enumerable:!1,configurable:!0}),i.prototype.destroy=function(){clearInterval(this._timer)},i.prototype.add=function(e){this._count+=e=void 0===e?1:e,this._total+=e},i.prototype._onTimer=function(){var e=Date.now(),t=e-this._lastTime;this._fps=this._count/(t/1e3),this._count=0,this._lastTime=e,this.onFps&&this.onFps(this._fps)},i);function i(){this._count=0,this._fps=0,this._total=0,n.bindAll(this),this._timer=setInterval(this._onTimer,1e3),this._lastTime=Date.now()}t.FpsDetect=r},function(t,e,i){!function(){"use strict";var e=i(14),r=i(67),n=i(70),e={FrameSink:e,SoftwareFrameSink:r,WebGLFrameSink:n,attach:function(e,t){return new(("webGL"in(t=t||{})?t.webGL:n.isAvailable())?n:r)(e,t)}};t.exports=e}()},function(r,e,i){!function(){"use strict";var e=i(14),n=i(68);function t(r,e){var a=r.getContext("2d",e),o=null;return this.drawFrame=function(e){var t=e.format;r.width===t.displayWidth&&r.height===t.displayHeight||(r.width=t.displayWidth,r.height=t.displayHeight),null!==o&&o.width==t.width&&o.height==t.height||function(e,t){for(var r=(o=a.createImageData(e,t)).data,n=e*t*4,i=0;i<n;i+=4)r[i+3]=255}(t.width,t.height),n.convertYCbCr(e,o.data),a.putImageData(o,t.left,t.top,t.cropLeft,t.cropTop,t.cropWidth,t.cropHeight)},this.clear=function(){a.clearRect(0,0,r.width,r.height)},this}t.prototype=Object.create(e.prototype),r.exports=t}()},function(e,t,r){!function(){"use strict";var M=r(69);e.exports={convertYCbCr:function(e,t){var r,n=0|e.format.width,i=0|e.format.height,a=0|M(e.format.width/e.format.chromaWidth),o=0|M(e.format.height/e.format.chromaHeight),s=e.y.bytes,u=e.u.bytes,c=e.v.bytes,d=0|e.y.stride,l=0|e.u.stride,h=0|e.v.stride,p=n<<2,f=0,_=0,m=0,y=0,v=0,g=0,b=0,w=0,E=0,T=0,S=0,O=0,A=0,k=0,P=0,I=0,x=0;if(1==a&&1==o)for(w=p,I=x=b=0;I<i;I+=2){for(m=(_=I*d|0)+d|0,y=x*l|0,v=x*h|0,P=0;P<n;P+=2)E=0|u[y++],O=(409*(T=0|c[v++])|0)-57088|0,A=(100*E|0)+(208*T|0)-34816|0,k=(516*E|0)-70912|0,S=298*s[_++]|0,t[b]=S+O>>8,t[b+1]=S-A>>8,t[b+2]=S+k>>8,b+=4,S=298*s[_++]|0,t[b]=S+O>>8,t[b+1]=S-A>>8,t[b+2]=S+k>>8,b+=4,S=298*s[m++]|0,t[w]=S+O>>8,t[w+1]=S-A>>8,t[w+2]=S+k>>8,w+=4,S=298*s[m++]|0,t[w]=S+O>>8,t[w+1]=S-A>>8,t[w+2]=S+k>>8,w+=4;b+=p,w+=p,x++}else for(I=g=0;I<i;I++)for(f=I*d|0,y=(x=I>>o)*l|0,v=x*h|0,P=0;P<n;P++)E=0|u[y+(r=P>>a)],O=(409*(T=0|c[v+r])|0)-57088|0,A=(100*E|0)+(208*T|0)-34816|0,k=(516*E|0)-70912|0,S=298*s[f++]|0,t[g]=S+O>>8,t[g+1]=S-A>>8,t[g+2]=S+k>>8,g+=4}}}()},function(e,t){!function(){"use strict";e.exports=function(e){for(var t=0,r=e>>1;0!=r;)r>>=1,t++;if(e!==1<<t)throw"chroma plane dimensions must be power of 2 ratio to luma plane dimensions; got "+e;return t}}()},function(t,e,r){!function(){"use strict";var e=r(14),P=r(71);function I(n,e){var i,a,s=this,u=I.contextForCanvas(n,e);if(null===u)throw new Error("WebGL unavailable");function o(e,t){var r=u.createShader(e);if(u.shaderSource(r,t),u.compileShader(r),u.getShaderParameter(r,u.COMPILE_STATUS))return r;t=u.getShaderInfoLog(r);throw u.deleteShader(r),new Error("GL shader compilation for "+e+" failed: "+t)}var c,d,l,h,p,f,_,m,y,v,g=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),b={},w={},E={};function T(e){return b[e]||(b[e]=u.createTexture()),b[e]}function S(e,t,r,n){var i,a,o=T(e);u.activeTexture(u.TEXTURE0),I.stripe?(a=!b[e+"_temp"],i=T(e+"_temp"),u.bindTexture(u.TEXTURE_2D,i),a?(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,t/4,r,0,u.RGBA,u.UNSIGNED_BYTE,n)):u.texSubImage2D(u.TEXTURE_2D,0,0,0,t/4,r,u.RGBA,u.UNSIGNED_BYTE,n),(a=!(i=b[e+"_stripe"]))&&(i=T(e+"_stripe")),u.bindTexture(u.TEXTURE_2D,i),a&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,t,1,0,u.RGBA,u.UNSIGNED_BYTE,function(e){if(E[e])return E[e];for(var t=e,r=new Uint32Array(t),n=0;n<t;n+=4)r[n]=255,r[n+1]=65280,r[n+2]=16711680,r[n+3]=4278190080;return E[e]=new Uint8Array(r.buffer)}(t)))):(u.bindTexture(u.TEXTURE_2D,o),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,t,r,0,u.LUMINANCE,u.UNSIGNED_BYTE,n))}function O(e,t,r){var n=b[e];u.useProgram(a);var i=w[e];i||(u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,t,r,0,u.RGBA,u.UNSIGNED_BYTE,null),i=w[e]=u.createFramebuffer()),u.bindFramebuffer(u.FRAMEBUFFER,i),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,n,0);n=b[e+"_temp"];u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,n),u.uniform1i(f,1);e=b[e+"_stripe"];u.activeTexture(u.TEXTURE2),u.bindTexture(u.TEXTURE_2D,e),u.uniform1i(p,2),u.bindBuffer(u.ARRAY_BUFFER,c),u.enableVertexAttribArray(d),u.vertexAttribPointer(d,2,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,l),u.enableVertexAttribArray(h),u.vertexAttribPointer(h,2,u.FLOAT,!1,0,0),u.viewport(0,0,t,r),u.drawArrays(u.TRIANGLES,0,g.length/2),u.bindFramebuffer(u.FRAMEBUFFER,null)}function A(e,t,r){u.activeTexture(t),u.bindTexture(u.TEXTURE_2D,b[e]),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.uniform1i(u.getUniformLocation(i,e),r)}function k(e,t){var r=o(u.VERTEX_SHADER,e),e=o(u.FRAGMENT_SHADER,t),t=u.createProgram();if(u.attachShader(t,r),u.attachShader(t,e),u.linkProgram(t),u.getProgramParameter(t,u.LINK_STATUS))return t;e=u.getProgramInfoLog(t);throw u.deleteProgram(t),new Error("GL program linking failed: "+e)}return s.drawFrame=function(e){var t,o=e.format,r=!i||n.width!==o.displayWidth||n.height!==o.displayHeight;r&&(n.width=o.displayWidth,n.height=o.displayHeight,s.clear()),i||(I.stripe&&(a=k(P.vertexStripe,P.fragmentStripe),u.getAttribLocation(a,"aPosition"),l=u.createBuffer(),t=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),u.bindBuffer(u.ARRAY_BUFFER,l),u.bufferData(u.ARRAY_BUFFER,t,u.STATIC_DRAW),h=u.getAttribLocation(a,"aTexturePosition"),p=u.getUniformLocation(a,"uStripe"),f=u.getUniformLocation(a,"uTexture")),i=k(P.vertex,P.fragment),c=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,c),u.bufferData(u.ARRAY_BUFFER,g,u.STATIC_DRAW),d=u.getAttribLocation(i,"aPosition"),_=u.createBuffer(),m=u.getAttribLocation(i,"aLumaPosition"),y=u.createBuffer(),v=u.getAttribLocation(i,"aChromaPosition")),r&&((r=function(e,t,r){var n=o.cropLeft/r,i=(o.cropLeft+o.cropWidth)/r,a=(o.cropTop+o.cropHeight)/o.height,r=o.cropTop/o.height,r=new Float32Array([n,a,i,a,n,r,n,r,i,a,i,r]);u.bindBuffer(u.ARRAY_BUFFER,e),u.bufferData(u.ARRAY_BUFFER,r,u.STATIC_DRAW)})(_,0,e.y.stride),r(y,0,e.u.stride*o.width/o.chromaWidth)),S("uTextureY",e.y.stride,o.height,e.y.bytes),S("uTextureCb",e.u.stride,o.chromaHeight,e.u.bytes),S("uTextureCr",e.v.stride,o.chromaHeight,e.v.bytes),I.stripe&&(O("uTextureY",e.y.stride,o.height),O("uTextureCb",e.u.stride,o.chromaHeight),O("uTextureCr",e.v.stride,o.chromaHeight)),u.useProgram(i),u.viewport(o.left,o.top,o.width,o.height),A("uTextureY",u.TEXTURE0,0),A("uTextureCb",u.TEXTURE1,1),A("uTextureCr",u.TEXTURE2,2),u.bindBuffer(u.ARRAY_BUFFER,c),u.enableVertexAttribArray(d),u.vertexAttribPointer(d,2,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,_),u.enableVertexAttribArray(m),u.vertexAttribPointer(m,2,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,y),u.enableVertexAttribArray(v),u.vertexAttribPointer(v,2,u.FLOAT,!1,0,0),u.drawArrays(u.TRIANGLES,0,g.length/2)},s.clear=function(){u.viewport(0,0,n.width,n.height),u.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT)},s.clear(),s}I.stripe=-1!==navigator.userAgent.indexOf("Windows"),I.contextForCanvas=function(e,t){var r={preferLowPowerToHighPerformance:!0,powerPreference:"low-power",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!0};return Object.assign(r,t),e.getContext("webgl2",r)||e.getContext("webgl",r)||e.getContext("experimental-webgl",r)},I.isAvailable=function(){var e,t=document.createElement("canvas");t.width=1,t.height=1;try{e=I.contextForCanvas(t)}catch(e){return!1}if(e){var r=e.TEXTURE0,n=e.createTexture(),i=new Uint8Array(16),a=I.stripe?1:4,o=I.stripe?e.RGBA:e.LUMINANCE,t=I.stripe?e.NEAREST:e.LINEAR;return e.activeTexture(r),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,o,a,4,0,o,e.UNSIGNED_BYTE,i),!e.getError()}return!1},I.prototype=Object.create(e.prototype),t.exports=I}()},function(e,t){e.exports={vertex:"precision lowp float;\n\nattribute vec2 aPosition;\nattribute vec2 aLumaPosition;\nattribute vec2 aChromaPosition;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vLumaPosition = aLumaPosition;\n    vChromaPosition = aChromaPosition;\n}\n",fragment:"// inspired by https://github.com/mbebenita/Broadway/blob/master/Player/canvas.js\n\nprecision lowp float;\n\nuniform sampler2D uTextureY;\nuniform sampler2D uTextureCb;\nuniform sampler2D uTextureCr;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n   // Y, Cb, and Cr planes are uploaded as LUMINANCE textures.\n   float fY = texture2D(uTextureY, vLumaPosition).x;\n   float fCb = texture2D(uTextureCb, vChromaPosition).x;\n   float fCr = texture2D(uTextureCr, vChromaPosition).x;\n\n   // Premultipy the Y...\n   float fYmul = fY * 1.1643828125;\n\n   // And convert that to RGB!\n   gl_FragColor = vec4(\n     fYmul + 1.59602734375 * fCr - 0.87078515625,\n     fYmul - 0.39176171875 * fCb - 0.81296875 * fCr + 0.52959375,\n     fYmul + 2.017234375   * fCb - 1.081390625,\n     1\n   );\n}\n",vertexStripe:"precision lowp float;\n\nattribute vec2 aPosition;\nattribute vec2 aTexturePosition;\nvarying vec2 vTexturePosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vTexturePosition = aTexturePosition;\n}\n",fragmentStripe:"// extra 'stripe' texture fiddling to work around IE 11's poor performance on gl.LUMINANCE and gl.ALPHA textures\n\nprecision lowp float;\n\nuniform sampler2D uStripe;\nuniform sampler2D uTexture;\nvarying vec2 vTexturePosition;\nvoid main() {\n   // Y, Cb, and Cr planes are mapped into a pseudo-RGBA texture\n   // so we can upload them without expanding the bytes on IE 11\n   // which doesn't allow LUMINANCE or ALPHA textures\n   // The stripe textures mark which channel to keep for each pixel.\n   // Each texture extraction will contain the relevant value in one\n   // channel only.\n\n   float fLuminance = dot(\n      texture2D(uStripe, vTexturePosition),\n      texture2D(uTexture, vTexturePosition)\n   );\n\n   gl_FragColor = vec4(fLuminance, fLuminance, fLuminance, 1);\n}\n"}},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),(t.PageVisibility=void 0)!==document.hidden?(n="hidden",i="visibilitychange"):void 0!==document.msHidden?(n="msHidden",i="msvisibilitychange"):void 0!==document.webkitHidden&&(n="webkitHidden",i="webkitvisibilitychange"),t.PageVisibility={isHidden:function(){return n&&document[n]},onChange:function(e){i&&document.addEventListener(i,e)},offChange:function(e){i&&document.removeEventListener(i,e)}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(0),a=a(r(28)),u=r(1),c=r(2),d=s.makeLogger("decoder-pthreads"),s=r(74),l=URL.createObjectURL(new Blob([s],{type:"text/javascript"})),r=r(75),h=URL.createObjectURL(new Blob([r],{type:"text/javascript"})),i=(o=a.default,i(p,o),p.prototype._initWasm=function(){var t=this;d.log("Decode with multi threads.");function e(){__Decoder({mainScriptUrlOrBlob:l,locateFile:function(e){return-1===e.indexOf(".wasm")?h:r},jsLib:{outer_read:t.outer_read,outer_close:t.outer_close,frame_out:t.frame_out,get_play_time:t.get_play_time,play_exit:t.play_exit},onAbort:function(e){return t._onError(new c.DyError("decode error: "+e,c.ErrorIds.DecoderDecodeError))}}).then(function(e){d.log("wasm load complete"),t._wasm=e,t._wasm._log_init(t._config.debug?32:16),t._wasm._set_hidden(t._hidden?1:0),t._wasm._play(e.allocateUTF8("custom:mp4"))})}var r=this._config.__internal.wasmDecoderPthread;this.inWorker?(importScripts(l),e()):u.loadScript(l).then(e).catch(this._onError)},p);function p(){return null!==o&&o.apply(this,arguments)||this}t.default=i},function(e,t){e.exports='\nvar __Decoder = (function() {\n  var _scriptDir = typeof document !== \'undefined\' && document.currentScript ? document.currentScript.src : undefined;\n  \n  return (\nfunction(__Decoder) {\n  __Decoder = __Decoder || {};\n\nnull;var Module=typeof __Decoder!=="undefined"?__Decoder:{};var readyPromiseResolve,readyPromiseReject;Module["ready"]=new Promise(function(resolve,reject){readyPromiseResolve=resolve;readyPromiseReject=reject});var moduleOverrides={};var key;for(key in Module){if(Module.hasOwnProperty(key)){moduleOverrides[key]=Module[key]}}var arguments_=[];var thisProgram="./this.program";var quit_=function(status,toThrow){throw toThrow};var ENVIRONMENT_IS_WEB=false;var ENVIRONMENT_IS_WORKER=false;var ENVIRONMENT_IS_NODE=false;var ENVIRONMENT_IS_SHELL=false;ENVIRONMENT_IS_WEB=typeof window==="object";ENVIRONMENT_IS_WORKER=typeof importScripts==="function";ENVIRONMENT_IS_NODE=typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string";ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;var ENVIRONMENT_IS_PTHREAD=Module["ENVIRONMENT_IS_PTHREAD"]||false;if(ENVIRONMENT_IS_PTHREAD){buffer=Module["buffer"];DYNAMIC_BASE=Module["DYNAMIC_BASE"];DYNAMICTOP_PTR=Module["DYNAMICTOP_PTR"]}var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var read_,readAsync,readBinary,setWindowTitle;if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(document.currentScript){scriptDirectory=document.currentScript.src}if(_scriptDir){scriptDirectory=_scriptDir}if(scriptDirectory.indexOf("blob:")!==0){scriptDirectory=scriptDirectory.substr(0,scriptDirectory.lastIndexOf("/")+1)}else{scriptDirectory=""}{read_=function shell_read(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.send(null);return xhr.responseText};if(ENVIRONMENT_IS_WORKER){readBinary=function readBinary(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=function readAsync(url,onload,onerror){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=function xhr_onload(){if(xhr.status==200||xhr.status==0&&xhr.response){onload(xhr.response);return}onerror()};xhr.onerror=onerror;xhr.send(null)}}setWindowTitle=function(title){document.title=title}}else{}var out=Module["print"]||console.log.bind(console);var err=Module["printErr"]||console.warn.bind(console);for(key in moduleOverrides){if(moduleOverrides.hasOwnProperty(key)){Module[key]=moduleOverrides[key]}}moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];if(Module["quit"])quit_=Module["quit"];function warnOnce(text){if(!warnOnce.shown)warnOnce.shown={};if(!warnOnce.shown[text]){warnOnce.shown[text]=1;err(text)}}var tempRet0=0;var getTempRet0=function(){return tempRet0};var Atomics_load=Atomics.load;var Atomics_store=Atomics.store;var Atomics_compareExchange=Atomics.compareExchange;var wasmBinary;if(Module["wasmBinary"])wasmBinary=Module["wasmBinary"];var noExitRuntime;if(Module["noExitRuntime"])noExitRuntime=Module["noExitRuntime"];if(typeof WebAssembly!=="object"){abort("no native wasm support detected")}var wasmMemory;var wasmTable=new WebAssembly.Table({"initial":489,"maximum":489+0,"element":"anyfunc"});var wasmModule;var threadInfoStruct=0;var selfThreadId=0;var ABORT=false;var EXITSTATUS=0;function assert(condition,text){if(!condition){abort("Assertion failed: "+text)}}function UTF8ArrayToString(heap,idx,maxBytesToRead){var endIdx=idx+maxBytesToRead;var str="";while(!(idx>=endIdx)){var u0=heap[idx++];if(!u0)return str;if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heap[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heap[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heap[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str}function UTF8ToString(ptr,maxBytesToRead){return ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):""}function stringToUTF8Array(str,heap,outIdx,maxBytesToWrite){if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++]=192|u>>6;heap[outIdx++]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++]=224|u>>12;heap[outIdx++]=128|u>>6&63;heap[outIdx++]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++]=240|u>>18;heap[outIdx++]=128|u>>12&63;heap[outIdx++]=128|u>>6&63;heap[outIdx++]=128|u&63}}heap[outIdx]=0;return outIdx-startIdx}function stringToUTF8(str,outPtr,maxBytesToWrite){return stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite)}function lengthBytesUTF8(str){var len=0;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((u&1023)<<10)|str.charCodeAt(++i)&1023;if(u<=127)++len;else if(u<=2047)len+=2;else if(u<=65535)len+=3;else len+=4}return len}function allocateUTF8(str){var size=lengthBytesUTF8(str)+1;var ret=_malloc(size);if(ret)stringToUTF8Array(str,HEAP8,ret,size);return ret}function writeArrayToMemory(array,buffer){HEAP8.set(array,buffer)}function writeAsciiToMemory(str,buffer,dontAddNull){for(var i=0;i<str.length;++i){HEAP8[buffer++>>0]=str.charCodeAt(i)}if(!dontAddNull)HEAP8[buffer>>0]=0}var WASM_PAGE_SIZE=65536;var buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;function updateGlobalBufferAndViews(buf){buffer=buf;Module["HEAP8"]=HEAP8=new Int8Array(buf);Module["HEAP16"]=HEAP16=new Int16Array(buf);Module["HEAP32"]=HEAP32=new Int32Array(buf);Module["HEAPU8"]=HEAPU8=new Uint8Array(buf);Module["HEAPU16"]=HEAPU16=new Uint16Array(buf);Module["HEAPU32"]=HEAPU32=new Uint32Array(buf);Module["HEAPF32"]=HEAPF32=new Float32Array(buf);Module["HEAPF64"]=HEAPF64=new Float64Array(buf)}var STACK_BASE=5568960,STACKTOP=STACK_BASE,STACK_MAX=326080,DYNAMIC_BASE=5568960,DYNAMICTOP_PTR=325152;if(ENVIRONMENT_IS_PTHREAD){}var INITIAL_INITIAL_MEMORY=Module["INITIAL_MEMORY"]||134217728;if(ENVIRONMENT_IS_PTHREAD){wasmMemory=Module["wasmMemory"];buffer=Module["buffer"]}else{if(Module["wasmMemory"]){wasmMemory=Module["wasmMemory"]}else{wasmMemory=new WebAssembly.Memory({"initial":INITIAL_INITIAL_MEMORY/WASM_PAGE_SIZE,"maximum":INITIAL_INITIAL_MEMORY/WASM_PAGE_SIZE,"shared":true});if(!(wasmMemory.buffer instanceof SharedArrayBuffer)){err("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag");if(ENVIRONMENT_IS_NODE){console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)")}throw Error("bad memory")}}}if(wasmMemory){buffer=wasmMemory.buffer}INITIAL_INITIAL_MEMORY=buffer.byteLength;updateGlobalBufferAndViews(buffer);if(!ENVIRONMENT_IS_PTHREAD){HEAP32[DYNAMICTOP_PTR>>2]=DYNAMIC_BASE}function callRuntimeCallbacks(callbacks){while(callbacks.length>0){var callback=callbacks.shift();if(typeof callback=="function"){callback(Module);continue}var func=callback.func;if(typeof func==="number"){if(callback.arg===undefined){Module["dynCall_v"](func)}else{Module["dynCall_vi"](func,callback.arg)}}else{func(callback.arg===undefined?null:callback.arg)}}}var __ATPRERUN__=[];var __ATINIT__=[];var __ATMAIN__=[];var __ATEXIT__=[];var __ATPOSTRUN__=[];var runtimeInitialized=false;if(ENVIRONMENT_IS_PTHREAD)runtimeInitialized=true;function preRun(){if(ENVIRONMENT_IS_PTHREAD)return;if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=true;callRuntimeCallbacks(__ATINIT__)}function preMain(){if(ENVIRONMENT_IS_PTHREAD)return;callRuntimeCallbacks(__ATMAIN__)}function postRun(){if(ENVIRONMENT_IS_PTHREAD)return;if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(cb){__ATPRERUN__.unshift(cb)}function addOnPostRun(cb){__ATPOSTRUN__.unshift(cb)}var Math_ceil=Math.ceil;var Math_floor=Math.floor;var runDependencies=0;var runDependencyWatcher=null;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){assert(!ENVIRONMENT_IS_PTHREAD,"addRunDependency cannot be used in a pthread worker");runDependencies++;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}}function removeRunDependency(id){runDependencies--;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}if(runDependencies==0){if(runDependencyWatcher!==null){clearInterval(runDependencyWatcher);runDependencyWatcher=null}if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}Module["preloadedImages"]={};Module["preloadedAudios"]={};function abort(what){if(Module["onAbort"]){Module["onAbort"](what)}if(ENVIRONMENT_IS_PTHREAD)console.error("Pthread aborting at "+(new Error).stack);what+="";err(what);ABORT=true;EXITSTATUS=1;what="abort("+what+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(what);readyPromiseReject(e);throw e}function hasPrefix(str,prefix){return String.prototype.startsWith?str.startsWith(prefix):str.indexOf(prefix)===0}var dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(filename){return hasPrefix(filename,dataURIPrefix)}var wasmBinaryFile="decoder.pthreads.wasm";if(!isDataURI(wasmBinaryFile)){wasmBinaryFile=locateFile(wasmBinaryFile)}function getBinary(){try{if(wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(wasmBinaryFile)}else{throw"both async and sync fetching of the wasm failed"}}catch(err){abort(err)}}function getBinaryPromise(){if(!wasmBinary&&(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&typeof fetch==="function"){return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){if(!response["ok"]){throw"failed to load wasm binary file at \'"+wasmBinaryFile+"\'"}return response["arrayBuffer"]()}).catch(function(){return getBinary()})}return new Promise(function(resolve,reject){resolve(getBinary())})}function createWasm(){var info={"a":asmLibraryArg};function receiveInstance(instance,module){var exports=instance.exports;exports=Asyncify.instrumentWasmExports(exports);Module["asm"]=exports;wasmModule=module;if(!ENVIRONMENT_IS_PTHREAD){var numWorkersToLoad=PThread.unusedWorkers.length;PThread.unusedWorkers.forEach(function(w){PThread.loadWasmModuleToWorker(w,function(){if(!--numWorkersToLoad)removeRunDependency("wasm-instantiate")})})}}if(!ENVIRONMENT_IS_PTHREAD){addRunDependency("wasm-instantiate")}function receiveInstantiatedSource(output){receiveInstance(output["instance"],output["module"])}function instantiateArrayBuffer(receiver){return getBinaryPromise().then(function(binary){return WebAssembly.instantiate(binary,info)}).then(receiver,function(reason){err("failed to asynchronously prepare wasm: "+reason);abort(reason)})}function instantiateAsync(){if(!wasmBinary&&typeof WebAssembly.instantiateStreaming==="function"&&!isDataURI(wasmBinaryFile)&&typeof fetch==="function"){fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){var result=WebAssembly.instantiateStreaming(response,info);return result.then(receiveInstantiatedSource,function(reason){err("wasm streaming compile failed: "+reason);err("falling back to ArrayBuffer instantiation");return instantiateArrayBuffer(receiveInstantiatedSource)})})}else{return instantiateArrayBuffer(receiveInstantiatedSource)}}if(Module["instantiateWasm"]){try{var exports=Module["instantiateWasm"](info,receiveInstance);exports=Asyncify.instrumentWasmExports(exports);return exports}catch(e){err("Module.instantiateWasm callback failed with error: "+e);return false}}instantiateAsync();return{}}var ASM_CONSTS={306944:function(){throw"Canceled!"},307164:function($0,$1){setTimeout(function(){_do_emscripten_dispatch_to_thread($0,$1)},0)}};function _emscripten_asm_const_iii(code,sigPtr,argbuf){var args=readAsmConstArgs(sigPtr,argbuf);return ASM_CONSTS[code].apply(null,args)}function initPthreadsJS(){PThread.initRuntime()}if(!ENVIRONMENT_IS_PTHREAD)__ATINIT__.push({func:function(){___wasm_call_ctors()}});var __pthread_ptr=0;var __pthread_is_main_runtime_thread=0;var __pthread_is_main_browser_thread=0;function registerPthreadPtr(pthreadPtr,isMainBrowserThread,isMainRuntimeThread){pthreadPtr=pthreadPtr|0;isMainBrowserThread=isMainBrowserThread|0;isMainRuntimeThread=isMainRuntimeThread|0;__pthread_ptr=pthreadPtr;__pthread_is_main_browser_thread=isMainBrowserThread;__pthread_is_main_runtime_thread=isMainRuntimeThread}Module["registerPthreadPtr"]=registerPthreadPtr;var ERRNO_CODES={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135};var __main_thread_futex_wait_address=326064;function _emscripten_futex_wake(addr,count){if(addr<=0||addr>HEAP8.length||addr&3!=0||count<0)return-28;if(count==0)return 0;if(count>=2147483647)count=Infinity;var mainThreadWaitAddress=Atomics.load(HEAP32,__main_thread_futex_wait_address>>2);var mainThreadWoken=0;if(mainThreadWaitAddress==addr){var loadedAddr=Atomics.compareExchange(HEAP32,__main_thread_futex_wait_address>>2,mainThreadWaitAddress,0);if(loadedAddr==mainThreadWaitAddress){--count;mainThreadWoken=1;if(count<=0)return 1}}var ret=Atomics.notify(HEAP32,addr>>2,count);if(ret>=0)return ret+mainThreadWoken;throw"Atomics.notify returned an unexpected value "+ret}Module["_emscripten_futex_wake"]=_emscripten_futex_wake;function killThread(pthread_ptr){if(ENVIRONMENT_IS_PTHREAD)throw"Internal Error! killThread() can only ever be called from main application thread!";if(!pthread_ptr)throw"Internal Error! Null pthread_ptr in killThread!";HEAP32[pthread_ptr+12>>2]=0;var pthread=PThread.pthreads[pthread_ptr];pthread.worker.terminate();PThread.freeThreadData(pthread);PThread.runningWorkers.splice(PThread.runningWorkers.indexOf(pthread.worker),1);pthread.worker.pthread=undefined}function cancelThread(pthread_ptr){if(ENVIRONMENT_IS_PTHREAD)throw"Internal Error! cancelThread() can only ever be called from main application thread!";if(!pthread_ptr)throw"Internal Error! Null pthread_ptr in cancelThread!";var pthread=PThread.pthreads[pthread_ptr];pthread.worker.postMessage({"cmd":"cancel"})}function cleanupThread(pthread_ptr){if(ENVIRONMENT_IS_PTHREAD)throw"Internal Error! cleanupThread() can only ever be called from main application thread!";if(!pthread_ptr)throw"Internal Error! Null pthread_ptr in cleanupThread!";HEAP32[pthread_ptr+12>>2]=0;var pthread=PThread.pthreads[pthread_ptr];if(pthread){var worker=pthread.worker;PThread.returnWorkerToPool(worker)}}var PThread={MAIN_THREAD_ID:1,mainThreadInfo:{schedPolicy:0,schedPrio:0},unusedWorkers:[],runningWorkers:[],initRuntime:function(){registerPthreadPtr(PThread.mainThreadBlock,!ENVIRONMENT_IS_WORKER,1);_emscripten_register_main_browser_thread_id(PThread.mainThreadBlock)},initMainThreadBlock:function(){var pthreadPoolSize=4;for(var i=0;i<pthreadPoolSize;++i){PThread.allocateUnusedWorker()}PThread.mainThreadBlock=325312;for(var i=0;i<232/4;++i)HEAPU32[PThread.mainThreadBlock/4+i]=0;HEAP32[PThread.mainThreadBlock+12>>2]=PThread.mainThreadBlock;var headPtr=PThread.mainThreadBlock+156;HEAP32[headPtr>>2]=headPtr;var tlsMemory=325552;for(var i=0;i<128;++i)HEAPU32[tlsMemory/4+i]=0;Atomics.store(HEAPU32,PThread.mainThreadBlock+104>>2,tlsMemory);Atomics.store(HEAPU32,PThread.mainThreadBlock+40>>2,PThread.mainThreadBlock);Atomics.store(HEAPU32,PThread.mainThreadBlock+44>>2,42)},initWorker:function(){},pthreads:{},threadExitHandlers:[],setThreadStatus:function(){},runExitHandlers:function(){while(PThread.threadExitHandlers.length>0){PThread.threadExitHandlers.pop()()}if(ENVIRONMENT_IS_PTHREAD&&threadInfoStruct)___pthread_tsd_run_dtors()},threadExit:function(exitCode){var tb=_pthread_self();if(tb){Atomics.store(HEAPU32,tb+4>>2,exitCode);Atomics.store(HEAPU32,tb+0>>2,1);Atomics.store(HEAPU32,tb+60>>2,1);Atomics.store(HEAPU32,tb+64>>2,0);PThread.runExitHandlers();_emscripten_futex_wake(tb+0,2147483647);registerPthreadPtr(0,0,0);threadInfoStruct=0;if(ENVIRONMENT_IS_PTHREAD){postMessage({"cmd":"exit"})}}},threadCancel:function(){PThread.runExitHandlers();Atomics.store(HEAPU32,threadInfoStruct+4>>2,-1);Atomics.store(HEAPU32,threadInfoStruct+0>>2,1);_emscripten_futex_wake(threadInfoStruct+0,2147483647);threadInfoStruct=selfThreadId=0;registerPthreadPtr(0,0,0);postMessage({"cmd":"cancelDone"})},terminateAllThreads:function(){for(var t in PThread.pthreads){var pthread=PThread.pthreads[t];if(pthread&&pthread.worker){PThread.returnWorkerToPool(pthread.worker)}}PThread.pthreads={};for(var i=0;i<PThread.unusedWorkers.length;++i){var worker=PThread.unusedWorkers[i];worker.terminate()}PThread.unusedWorkers=[];for(var i=0;i<PThread.runningWorkers.length;++i){var worker=PThread.runningWorkers[i];var pthread=worker.pthread;PThread.freeThreadData(pthread);worker.terminate()}PThread.runningWorkers=[]},freeThreadData:function(pthread){if(!pthread)return;if(pthread.threadInfoStruct){var tlsMemory=HEAP32[pthread.threadInfoStruct+104>>2];HEAP32[pthread.threadInfoStruct+104>>2]=0;_free(tlsMemory);_free(pthread.threadInfoStruct)}pthread.threadInfoStruct=0;if(pthread.allocatedOwnStack&&pthread.stackBase)_free(pthread.stackBase);pthread.stackBase=0;if(pthread.worker)pthread.worker.pthread=null},returnWorkerToPool:function(worker){delete PThread.pthreads[worker.pthread.thread];PThread.unusedWorkers.push(worker);PThread.runningWorkers.splice(PThread.runningWorkers.indexOf(worker),1);PThread.freeThreadData(worker.pthread);worker.pthread=undefined},receiveObjectTransfer:function(data){},loadWasmModuleToWorker:function(worker,onFinishedLoading){worker.onmessage=function(e){var d=e["data"];var cmd=d["cmd"];if(worker.pthread)PThread.currentProxiedOperationCallerThread=worker.pthread.threadInfoStruct;if(d["targetThread"]&&d["targetThread"]!=_pthread_self()){var thread=PThread.pthreads[d.targetThread];if(thread){thread.worker.postMessage(e.data,d["transferList"])}else{console.error(\'Internal error! Worker sent a message "\'+cmd+\'" to target pthread \'+d["targetThread"]+", but that thread no longer exists!")}PThread.currentProxiedOperationCallerThread=undefined;return}if(cmd==="processQueuedMainThreadWork"){_emscripten_main_thread_process_queued_calls()}else if(cmd==="spawnThread"){spawnThread(e.data)}else if(cmd==="cleanupThread"){cleanupThread(d["thread"])}else if(cmd==="killThread"){killThread(d["thread"])}else if(cmd==="cancelThread"){cancelThread(d["thread"])}else if(cmd==="loaded"){worker.loaded=true;if(onFinishedLoading)onFinishedLoading(worker);if(worker.runPthread){worker.runPthread();delete worker.runPthread}}else if(cmd==="print"){out("Thread "+d["threadId"]+": "+d["text"])}else if(cmd==="printErr"){err("Thread "+d["threadId"]+": "+d["text"])}else if(cmd==="alert"){alert("Thread "+d["threadId"]+": "+d["text"])}else if(cmd==="exit"){var detached=worker.pthread&&Atomics.load(HEAPU32,worker.pthread.thread+68>>2);if(detached){PThread.returnWorkerToPool(worker)}}else if(cmd==="cancelDone"){PThread.returnWorkerToPool(worker)}else if(cmd==="objectTransfer"){PThread.receiveObjectTransfer(e.data)}else if(e.data.target==="setimmediate"){worker.postMessage(e.data)}else{err("worker sent an unknown command "+cmd)}PThread.currentProxiedOperationCallerThread=undefined};worker.onerror=function(e){err("pthread sent an error! "+e.filename+":"+e.lineno+": "+e.message)};worker.postMessage({"cmd":"load","urlOrBlob":Module["mainScriptUrlOrBlob"]||_scriptDir,"wasmMemory":wasmMemory,"wasmModule":wasmModule,"DYNAMIC_BASE":DYNAMIC_BASE,"DYNAMICTOP_PTR":DYNAMICTOP_PTR})},allocateUnusedWorker:function(){var pthreadMainJs=locateFile("decoder.pthreads.worker.js");PThread.unusedWorkers.push(new Worker(pthreadMainJs))},getNewWorker:function(){if(PThread.unusedWorkers.length==0){PThread.allocateUnusedWorker();PThread.loadWasmModuleToWorker(PThread.unusedWorkers[0])}if(PThread.unusedWorkers.length>0)return PThread.unusedWorkers.pop();else return null},busySpinWait:function(msecs){var t=performance.now()+msecs;while(performance.now()<t){}}};function establishStackSpace(stackTop,stackMax){STACK_BASE=STACKTOP=stackTop;STACK_MAX=stackMax;stackRestore(stackTop)}Module["establishStackSpace"]=establishStackSpace;function getNoExitRuntime(){return noExitRuntime}Module["getNoExitRuntime"]=getNoExitRuntime;function ___assert_fail(condition,filename,line,func){abort("Assertion failed: "+UTF8ToString(condition)+", at: "+[filename?UTF8ToString(filename):"unknown filename",line,func?UTF8ToString(func):"unknown function"])}var _emscripten_get_now;if(ENVIRONMENT_IS_PTHREAD){_emscripten_get_now=function(){return performance.now()-Module["__performance_now_clock_drift"]}}else _emscripten_get_now=function(){return performance.now()};var _emscripten_get_now_is_monotonic=true;function setErrNo(value){HEAP32[___errno_location()>>2]=value;return value}function _clock_gettime(clk_id,tp){var now;if(clk_id===0){now=Date.now()}else if((clk_id===1||clk_id===4)&&_emscripten_get_now_is_monotonic){now=_emscripten_get_now()}else{setErrNo(28);return-1}HEAP32[tp>>2]=now/1e3|0;HEAP32[tp+4>>2]=now%1e3*1e3*1e3|0;return 0}var PATH={splitPath:function(filename){var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:function(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:function(path){var isAbsolute=path.charAt(0)==="/",trailingSlash=path.substr(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:function(path){var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir},basename:function(path){if(path==="/")return"/";var lastSlash=path.lastIndexOf("/");if(lastSlash===-1)return path;return path.substr(lastSlash+1)},extname:function(path){return PATH.splitPath(path)[3]},join:function(){var paths=Array.prototype.slice.call(arguments,0);return PATH.normalize(paths.join("/"))},join2:function(l,r){return PATH.normalize(l+"/"+r)}};var SYSCALLS={mappings:{},buffers:[null,[],[]],printChar:function(stream,curr){var buffer=SYSCALLS.buffers[stream];if(curr===0||curr===10){(stream===1?out:err)(UTF8ArrayToString(buffer,0));buffer.length=0}else{buffer.push(curr)}},varargs:undefined,get:function(){SYSCALLS.varargs+=4;var ret=HEAP32[SYSCALLS.varargs-4>>2];return ret},getStr:function(ptr){var ret=UTF8ToString(ptr);return ret},get64:function(low,high){return low}};function ___sys_fcntl64(fd,cmd,varargs){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(1,1,fd,cmd,varargs);SYSCALLS.varargs=varargs;return 0}function ___sys_open(path,flags,varargs){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(2,1,path,flags,varargs);SYSCALLS.varargs=varargs}function ___sys_read(fd,buf,count){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(3,1,fd,buf,count)}function __emscripten_notify_thread_queue(targetThreadId,mainThreadId){if(targetThreadId==mainThreadId){postMessage({"cmd":"processQueuedMainThreadWork"})}else if(ENVIRONMENT_IS_PTHREAD){postMessage({"targetThread":targetThreadId,"cmd":"processThreadQueue"})}else{var pthread=PThread.pthreads[targetThreadId];var worker=pthread&&pthread.worker;if(!worker){return}worker.postMessage({"cmd":"processThreadQueue"})}return 1}function _abort(){abort()}function _clock(){if(_clock.start===undefined)_clock.start=Date.now();return(Date.now()-_clock.start)*(1e6/1e3)|0}function _emscripten_check_blocking_allowed(){if(ENVIRONMENT_IS_WORKER)return;warnOnce("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")}function _emscripten_conditional_set_current_thread_status(expectedStatus,newStatus){expectedStatus=expectedStatus|0;newStatus=newStatus|0}function _emscripten_console_log(str){console.log(UTF8ToString(str))}function _emscripten_console_warn(str){console.warn(UTF8ToString(str))}function _emscripten_futex_wait(addr,val,timeout){if(addr<=0||addr>HEAP8.length||addr&3!=0)return-28;if(ENVIRONMENT_IS_WORKER){var ret=Atomics.wait(HEAP32,addr>>2,val,timeout);if(ret==="timed-out")return-73;if(ret==="not-equal")return-6;if(ret==="ok")return 0;throw"Atomics.wait returned an unexpected value "+ret}else{var loadedVal=Atomics.load(HEAP32,addr>>2);if(val!=loadedVal)return-6;var tNow=performance.now();var tEnd=tNow+timeout;Atomics.store(HEAP32,__main_thread_futex_wait_address>>2,addr);var ourWaitAddress=addr;while(addr==ourWaitAddress){tNow=performance.now();if(tNow>tEnd){return-73}_emscripten_main_thread_process_queued_calls();addr=Atomics.load(HEAP32,__main_thread_futex_wait_address>>2)}return 0}}function _emscripten_is_main_browser_thread(){return __pthread_is_main_browser_thread|0}function _emscripten_is_main_runtime_thread(){return __pthread_is_main_runtime_thread|0}function _emscripten_memcpy_big(dest,src,num){HEAPU8.copyWithin(dest,src,src+num)}function _emscripten_proxy_to_main_thread_js(index,sync){var numCallArgs=arguments.length-2;var stack=stackSave();var args=stackAlloc(numCallArgs*8);var b=args>>3;for(var i=0;i<numCallArgs;i++){HEAPF64[b+i]=arguments[2+i]}var ret=_emscripten_run_in_main_runtime_thread_js(index,numCallArgs,args,sync);stackRestore(stack);return ret}var _emscripten_receive_on_main_thread_js_callArgs=[];var readAsmConstArgsArray=[];function readAsmConstArgs(sigPtr,buf){readAsmConstArgsArray.length=0;var ch;buf>>=2;while(ch=HEAPU8[sigPtr++]){var double=ch<105;if(double&&buf&1)buf++;readAsmConstArgsArray.push(double?HEAPF64[buf++>>1]:HEAP32[buf]);++buf}return readAsmConstArgsArray}function _emscripten_receive_on_main_thread_js(index,numCallArgs,args){_emscripten_receive_on_main_thread_js_callArgs.length=numCallArgs;var b=args>>3;for(var i=0;i<numCallArgs;i++){_emscripten_receive_on_main_thread_js_callArgs[i]=HEAPF64[b+i]}var isEmAsmConst=index<0;var func=!isEmAsmConst?proxiedFunctionTable[index]:ASM_CONSTS[-index-1];return func.apply(null,_emscripten_receive_on_main_thread_js_callArgs)}function abortOnCannotGrowMemory(requestedSize){abort("OOM")}function _emscripten_resize_heap(requestedSize){requestedSize=requestedSize>>>0;abortOnCannotGrowMemory(requestedSize)}var JSEvents={inEventHandler:0,removeAllEventListeners:function(){for(var i=JSEvents.eventHandlers.length-1;i>=0;--i){JSEvents._removeHandler(i)}JSEvents.eventHandlers=[];JSEvents.deferredCalls=[]},registerRemoveEventListeners:function(){if(!JSEvents.removeEventListenersRegistered){__ATEXIT__.push(JSEvents.removeAllEventListeners);JSEvents.removeEventListenersRegistered=true}},deferredCalls:[],deferCall:function(targetFunction,precedence,argsList){function arraysHaveEqualContent(arrA,arrB){if(arrA.length!=arrB.length)return false;for(var i in arrA){if(arrA[i]!=arrB[i])return false}return true}for(var i in JSEvents.deferredCalls){var call=JSEvents.deferredCalls[i];if(call.targetFunction==targetFunction&&arraysHaveEqualContent(call.argsList,argsList)){return}}JSEvents.deferredCalls.push({targetFunction:targetFunction,precedence:precedence,argsList:argsList});JSEvents.deferredCalls.sort(function(x,y){return x.precedence<y.precedence})},removeDeferredCalls:function(targetFunction){for(var i=0;i<JSEvents.deferredCalls.length;++i){if(JSEvents.deferredCalls[i].targetFunction==targetFunction){JSEvents.deferredCalls.splice(i,1);--i}}},canPerformEventHandlerRequests:function(){return JSEvents.inEventHandler&&JSEvents.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(!JSEvents.canPerformEventHandlerRequests()){return}for(var i=0;i<JSEvents.deferredCalls.length;++i){var call=JSEvents.deferredCalls[i];JSEvents.deferredCalls.splice(i,1);--i;call.targetFunction.apply(null,call.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:function(target,eventTypeString){for(var i=0;i<JSEvents.eventHandlers.length;++i){if(JSEvents.eventHandlers[i].target==target&&(!eventTypeString||eventTypeString==JSEvents.eventHandlers[i].eventTypeString)){JSEvents._removeHandler(i--)}}},_removeHandler:function(i){var h=JSEvents.eventHandlers[i];h.target.removeEventListener(h.eventTypeString,h.eventListenerFunc,h.useCapture);JSEvents.eventHandlers.splice(i,1)},registerOrRemoveHandler:function(eventHandler){var jsEventHandler=function jsEventHandler(event){++JSEvents.inEventHandler;JSEvents.currentEventHandler=eventHandler;JSEvents.runDeferredCalls();eventHandler.handlerFunc(event);JSEvents.runDeferredCalls();--JSEvents.inEventHandler};if(eventHandler.callbackfunc){eventHandler.eventListenerFunc=jsEventHandler;eventHandler.target.addEventListener(eventHandler.eventTypeString,jsEventHandler,eventHandler.useCapture);JSEvents.eventHandlers.push(eventHandler);JSEvents.registerRemoveEventListeners()}else{for(var i=0;i<JSEvents.eventHandlers.length;++i){if(JSEvents.eventHandlers[i].target==eventHandler.target&&JSEvents.eventHandlers[i].eventTypeString==eventHandler.eventTypeString){JSEvents._removeHandler(i--)}}}},queueEventHandlerOnThread_iiii:function(targetThread,eventHandlerFunc,eventTypeId,eventData,userData){var stackTop=stackSave();var varargs=stackAlloc(12);HEAP32[varargs>>2]=eventTypeId;HEAP32[varargs+4>>2]=eventData;HEAP32[varargs+8>>2]=userData;__emscripten_call_on_thread(0,targetThread,637534208,eventHandlerFunc,eventData,varargs);stackRestore(stackTop)},getTargetThreadForEventCallback:function(targetThread){switch(targetThread){case 1:return 0;case 2:return PThread.currentProxiedOperationCallerThread;default:return targetThread}},getNodeNameForTarget:function(target){if(!target)return"";if(target==window)return"#window";if(target==screen)return"#screen";return target&&target.nodeName?target.nodeName:""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function stringToNewUTF8(jsString){var length=lengthBytesUTF8(jsString)+1;var cString=_malloc(length);stringToUTF8(jsString,cString,length);return cString}function _emscripten_set_offscreencanvas_size_on_target_thread_js(targetThread,targetCanvas,width,height){var stackTop=stackSave();var varargs=stackAlloc(12);var targetCanvasPtr=0;if(targetCanvas){targetCanvasPtr=stringToNewUTF8(targetCanvas)}HEAP32[varargs>>2]=targetCanvasPtr;HEAP32[varargs+4>>2]=width;HEAP32[varargs+8>>2]=height;__emscripten_call_on_thread(0,targetThread,657457152,0,targetCanvasPtr,varargs);stackRestore(stackTop)}function _emscripten_set_offscreencanvas_size_on_target_thread(targetThread,targetCanvas,width,height){targetCanvas=targetCanvas?UTF8ToString(targetCanvas):"";_emscripten_set_offscreencanvas_size_on_target_thread_js(targetThread,targetCanvas,width,height)}function maybeCStringToJsString(cString){return cString>2?UTF8ToString(cString):cString}var specialHTMLTargets=[0,typeof document!=="undefined"?document:0,typeof window!=="undefined"?window:0];function findEventTarget(target){target=maybeCStringToJsString(target);var domElement=specialHTMLTargets[target]||(typeof document!=="undefined"?document.querySelector(target):undefined);return domElement}function findCanvasEventTarget(target){return findEventTarget(target)}function _emscripten_set_canvas_element_size_calling_thread(target,width,height){var canvas=findCanvasEventTarget(target);if(!canvas)return-4;if(canvas.canvasSharedPtr){HEAP32[canvas.canvasSharedPtr>>2]=width;HEAP32[canvas.canvasSharedPtr+4>>2]=height}if(canvas.offscreenCanvas||!canvas.controlTransferredOffscreen){if(canvas.offscreenCanvas)canvas=canvas.offscreenCanvas;var autoResizeViewport=false;if(canvas.GLctxObject&&canvas.GLctxObject.GLctx){var prevViewport=canvas.GLctxObject.GLctx.getParameter(2978);autoResizeViewport=prevViewport[0]===0&&prevViewport[1]===0&&prevViewport[2]===canvas.width&&prevViewport[3]===canvas.height}canvas.width=width;canvas.height=height;if(autoResizeViewport){canvas.GLctxObject.GLctx.viewport(0,0,width,height)}}else if(canvas.canvasSharedPtr){var targetThread=HEAP32[canvas.canvasSharedPtr+8>>2];_emscripten_set_offscreencanvas_size_on_target_thread(targetThread,target,width,height);return 1}else{return-4}return 0}function _emscripten_set_canvas_element_size_main_thread(target,width,height){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(4,1,target,width,height);return _emscripten_set_canvas_element_size_calling_thread(target,width,height)}function _emscripten_set_canvas_element_size(target,width,height){var canvas=findCanvasEventTarget(target);if(canvas){return _emscripten_set_canvas_element_size_calling_thread(target,width,height)}else{return _emscripten_set_canvas_element_size_main_thread(target,width,height)}}function _emscripten_set_current_thread_status(newStatus){newStatus=newStatus|0}function _emscripten_sleep(ms){Asyncify.handleSleep(function(wakeUp){Browser.safeSetTimeout(wakeUp,ms)})}function __webgl_enable_ANGLE_instanced_arrays(ctx){var ext=ctx.getExtension("ANGLE_instanced_arrays");if(ext){ctx["vertexAttribDivisor"]=function(index,divisor){ext["vertexAttribDivisorANGLE"](index,divisor)};ctx["drawArraysInstanced"]=function(mode,first,count,primcount){ext["drawArraysInstancedANGLE"](mode,first,count,primcount)};ctx["drawElementsInstanced"]=function(mode,count,type,indices,primcount){ext["drawElementsInstancedANGLE"](mode,count,type,indices,primcount)};return 1}}function __webgl_enable_OES_vertex_array_object(ctx){var ext=ctx.getExtension("OES_vertex_array_object");if(ext){ctx["createVertexArray"]=function(){return ext["createVertexArrayOES"]()};ctx["deleteVertexArray"]=function(vao){ext["deleteVertexArrayOES"](vao)};ctx["bindVertexArray"]=function(vao){ext["bindVertexArrayOES"](vao)};ctx["isVertexArray"]=function(vao){return ext["isVertexArrayOES"](vao)};return 1}}function __webgl_enable_WEBGL_draw_buffers(ctx){var ext=ctx.getExtension("WEBGL_draw_buffers");if(ext){ctx["drawBuffers"]=function(n,bufs){ext["drawBuffersWEBGL"](n,bufs)};return 1}}var GL={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:{},offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,recordError:function recordError(errorCode){if(!GL.lastError){GL.lastError=errorCode}},getNewId:function(table){var ret=GL.counter++;for(var i=table.length;i<ret;i++){table[i]=null}return ret},getSource:function(shader,count,string,length){var source="";for(var i=0;i<count;++i){var len=length?HEAP32[length+i*4>>2]:-1;source+=UTF8ToString(HEAP32[string+i*4>>2],len<0?undefined:len)}return source},createContext:function(canvas,webGLContextAttributes){var ctx=canvas.getContext("webgl",webGLContextAttributes);if(!ctx)return 0;var handle=GL.registerContext(ctx,webGLContextAttributes);return handle},registerContext:function(ctx,webGLContextAttributes){var handle=_malloc(8);HEAP32[handle+4>>2]=_pthread_self();var context={handle:handle,attributes:webGLContextAttributes,version:webGLContextAttributes.majorVersion,GLctx:ctx};if(ctx.canvas)ctx.canvas.GLctxObject=context;GL.contexts[handle]=context;if(typeof webGLContextAttributes.enableExtensionsByDefault==="undefined"||webGLContextAttributes.enableExtensionsByDefault){GL.initExtensions(context)}return handle},makeContextCurrent:function(contextHandle){GL.currentContext=GL.contexts[contextHandle];Module.ctx=GLctx=GL.currentContext&&GL.currentContext.GLctx;return!(contextHandle&&!GLctx)},getContext:function(contextHandle){return GL.contexts[contextHandle]},deleteContext:function(contextHandle){if(GL.currentContext===GL.contexts[contextHandle])GL.currentContext=null;if(typeof JSEvents==="object")JSEvents.removeAllHandlersOnTarget(GL.contexts[contextHandle].GLctx.canvas);if(GL.contexts[contextHandle]&&GL.contexts[contextHandle].GLctx.canvas)GL.contexts[contextHandle].GLctx.canvas.GLctxObject=undefined;_free(GL.contexts[contextHandle].handle);GL.contexts[contextHandle]=null},initExtensions:function(context){if(!context)context=GL.currentContext;if(context.initExtensionsDone)return;context.initExtensionsDone=true;var GLctx=context.GLctx;__webgl_enable_ANGLE_instanced_arrays(GLctx);__webgl_enable_OES_vertex_array_object(GLctx);__webgl_enable_WEBGL_draw_buffers(GLctx);GLctx.disjointTimerQueryExt=GLctx.getExtension("EXT_disjoint_timer_query");var automaticallyEnabledExtensions=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","EXT_texture_norm16","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_disjoint_timer_query","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_astc","EXT_color_buffer_float","WEBGL_compressed_texture_s3tc_srgb","EXT_disjoint_timer_query_webgl2","WEBKIT_WEBGL_compressed_texture_pvrtc"];var exts=GLctx.getSupportedExtensions()||[];exts.forEach(function(ext){if(automaticallyEnabledExtensions.indexOf(ext)!=-1){GLctx.getExtension(ext)}})},populateUniformTable:function(program){var p=GL.programs[program];var ptable=GL.programInfos[program]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1};var utable=ptable.uniforms;var numUniforms=GLctx.getProgramParameter(p,35718);for(var i=0;i<numUniforms;++i){var u=GLctx.getActiveUniform(p,i);var name=u.name;ptable.maxUniformLength=Math.max(ptable.maxUniformLength,name.length+1);if(name.slice(-1)=="]"){name=name.slice(0,name.lastIndexOf("["))}var loc=GLctx.getUniformLocation(p,name);if(loc){var id=GL.getNewId(GL.uniforms);utable[name]=[u.size,id];GL.uniforms[id]=loc;for(var j=1;j<u.size;++j){var n=name+"["+j+"]";loc=GLctx.getUniformLocation(p,n);id=GL.getNewId(GL.uniforms);GL.uniforms[id]=loc}}}}};var __emscripten_webgl_power_preferences=["default","low-power","high-performance"];function _emscripten_webgl_do_create_context(target,attributes){var contextAttributes={};var a=attributes>>2;contextAttributes["alpha"]=!!HEAP32[a+(0>>2)];contextAttributes["depth"]=!!HEAP32[a+(4>>2)];contextAttributes["stencil"]=!!HEAP32[a+(8>>2)];contextAttributes["antialias"]=!!HEAP32[a+(12>>2)];contextAttributes["premultipliedAlpha"]=!!HEAP32[a+(16>>2)];contextAttributes["preserveDrawingBuffer"]=!!HEAP32[a+(20>>2)];var powerPreference=HEAP32[a+(24>>2)];contextAttributes["powerPreference"]=__emscripten_webgl_power_preferences[powerPreference];contextAttributes["failIfMajorPerformanceCaveat"]=!!HEAP32[a+(28>>2)];contextAttributes.majorVersion=HEAP32[a+(32>>2)];contextAttributes.minorVersion=HEAP32[a+(36>>2)];contextAttributes.enableExtensionsByDefault=HEAP32[a+(40>>2)];contextAttributes.explicitSwapControl=HEAP32[a+(44>>2)];contextAttributes.proxyContextToMainThread=HEAP32[a+(48>>2)];contextAttributes.renderViaOffscreenBackBuffer=HEAP32[a+(52>>2)];var canvas=findCanvasEventTarget(target);if(!canvas){return-4}if(contextAttributes.explicitSwapControl){return-1}var contextHandle=GL.createContext(canvas,contextAttributes);return contextHandle}function _emscripten_webgl_create_context(a0,a1){return _emscripten_webgl_do_create_context(a0,a1)}var ENV={};function getExecutableName(){return thisProgram||"./this.program"}function getEnvStrings(){if(!getEnvStrings.strings){var lang=(typeof navigator==="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={"USER":"web_user","LOGNAME":"web_user","PATH":"/","PWD":"/","HOME":"/home/web_user","LANG":lang,"_":getExecutableName()};for(var x in ENV){env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(x+"="+env[x])}getEnvStrings.strings=strings}return getEnvStrings.strings}function _environ_get(__environ,environ_buf){var bufSize=0;getEnvStrings().forEach(function(string,i){var ptr=environ_buf+bufSize;HEAP32[__environ+i*4>>2]=ptr;writeAsciiToMemory(string,ptr);bufSize+=string.length+1});return 0}function _environ_sizes_get(penviron_count,penviron_buf_size){var strings=getEnvStrings();HEAP32[penviron_count>>2]=strings.length;var bufSize=0;strings.forEach(function(string){bufSize+=string.length+1});HEAP32[penviron_buf_size>>2]=bufSize;return 0}function _fd_close(fd){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(5,1,fd);return 0}function _fd_fdstat_get(fd,pbuf){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(6,1,fd,pbuf);var type=fd==1||fd==2?2:abort();HEAP8[pbuf>>0]=type;return 0}function _fd_seek(fd,offset_low,offset_high,whence,newOffset){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(7,1,fd,offset_low,offset_high,whence,newOffset)}function _fd_write(fd,iov,iovcnt,pnum){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(8,1,fd,iov,iovcnt,pnum);var num=0;for(var i=0;i<iovcnt;i++){var ptr=HEAP32[iov+i*8>>2];var len=HEAP32[iov+(i*8+4)>>2];for(var j=0;j<len;j++){SYSCALLS.printChar(fd,HEAPU8[ptr+j])}num+=len}HEAP32[pnum>>2]=num;return 0}function _frame_out(){return Module.jsLib.frame_out.apply(null,arguments)}function _getTempRet0(){return getTempRet0()|0}function _get_play_time(){return Module.jsLib.get_play_time.apply(null,arguments)}function _gettimeofday(ptr){var now=Date.now();HEAP32[ptr>>2]=now/1e3|0;HEAP32[ptr+4>>2]=now%1e3*1e3|0;return 0}var ___tm_timezone=(stringToUTF8("GMT",325216,4),325216);function _gmtime_r(time,tmPtr){var date=new Date(HEAP32[time>>2]*1e3);HEAP32[tmPtr>>2]=date.getUTCSeconds();HEAP32[tmPtr+4>>2]=date.getUTCMinutes();HEAP32[tmPtr+8>>2]=date.getUTCHours();HEAP32[tmPtr+12>>2]=date.getUTCDate();HEAP32[tmPtr+16>>2]=date.getUTCMonth();HEAP32[tmPtr+20>>2]=date.getUTCFullYear()-1900;HEAP32[tmPtr+24>>2]=date.getUTCDay();HEAP32[tmPtr+36>>2]=0;HEAP32[tmPtr+32>>2]=0;var start=Date.UTC(date.getUTCFullYear(),0,1,0,0,0,0);var yday=(date.getTime()-start)/(1e3*60*60*24)|0;HEAP32[tmPtr+28>>2]=yday;HEAP32[tmPtr+40>>2]=___tm_timezone;return tmPtr}function _tzset(){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(9,1);if(_tzset.called)return;_tzset.called=true;HEAP32[__get_timezone()>>2]=(new Date).getTimezoneOffset()*60;var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);HEAP32[__get_daylight()>>2]=Number(winter.getTimezoneOffset()!=summer.getTimezoneOffset());function extractZone(date){var match=date.toTimeString().match(/\\(([A-Za-z ]+)\\)$/);return match?match[1]:"GMT"}var winterName=extractZone(winter);var summerName=extractZone(summer);var winterNamePtr=allocateUTF8(winterName);var summerNamePtr=allocateUTF8(summerName);if(summer.getTimezoneOffset()<winter.getTimezoneOffset()){HEAP32[__get_tzname()>>2]=winterNamePtr;HEAP32[__get_tzname()+4>>2]=summerNamePtr}else{HEAP32[__get_tzname()>>2]=summerNamePtr;HEAP32[__get_tzname()+4>>2]=winterNamePtr}}function _outer_close(){return Module.jsLib.outer_close.apply(null,arguments)}function _outer_read(){return Module.jsLib.outer_read.apply(null,arguments)}function _play_exit(){return Module.jsLib.play_exit.apply(null,arguments)}function _pthread_cleanup_pop(execute){var routine=PThread.threadExitHandlers.pop();if(execute)routine()}function _pthread_cleanup_push(routine,arg){PThread.threadExitHandlers.push(function(){dynCall_vi(routine,arg)})}function spawnThread(threadParams){if(ENVIRONMENT_IS_PTHREAD)throw"Internal Error! spawnThread() can only ever be called from main application thread!";var worker=PThread.getNewWorker();if(worker.pthread!==undefined)throw"Internal error!";if(!threadParams.pthread_ptr)throw"Internal error, no pthread ptr!";PThread.runningWorkers.push(worker);var tlsMemory=_malloc(128*4);for(var i=0;i<128;++i){HEAP32[tlsMemory+i*4>>2]=0}var stackHigh=threadParams.stackBase+threadParams.stackSize;var pthread=PThread.pthreads[threadParams.pthread_ptr]={worker:worker,stackBase:threadParams.stackBase,stackSize:threadParams.stackSize,allocatedOwnStack:threadParams.allocatedOwnStack,thread:threadParams.pthread_ptr,threadInfoStruct:threadParams.pthread_ptr};var tis=pthread.threadInfoStruct>>2;Atomics.store(HEAPU32,tis+(0>>2),0);Atomics.store(HEAPU32,tis+(4>>2),0);Atomics.store(HEAPU32,tis+(8>>2),0);Atomics.store(HEAPU32,tis+(68>>2),threadParams.detached);Atomics.store(HEAPU32,tis+(104>>2),tlsMemory);Atomics.store(HEAPU32,tis+(48>>2),0);Atomics.store(HEAPU32,tis+(40>>2),pthread.threadInfoStruct);Atomics.store(HEAPU32,tis+(44>>2),42);Atomics.store(HEAPU32,tis+(108>>2),threadParams.stackSize);Atomics.store(HEAPU32,tis+(84>>2),threadParams.stackSize);Atomics.store(HEAPU32,tis+(80>>2),stackHigh);Atomics.store(HEAPU32,tis+(108+8>>2),stackHigh);Atomics.store(HEAPU32,tis+(108+12>>2),threadParams.detached);Atomics.store(HEAPU32,tis+(108+20>>2),threadParams.schedPolicy);Atomics.store(HEAPU32,tis+(108+24>>2),threadParams.schedPrio);var global_libc=_emscripten_get_global_libc();var global_locale=global_libc+40;Atomics.store(HEAPU32,tis+(176>>2),global_locale);worker.pthread=pthread;var msg={"cmd":"run","start_routine":threadParams.startRoutine,"arg":threadParams.arg,"threadInfoStruct":threadParams.pthread_ptr,"selfThreadId":threadParams.pthread_ptr,"parentThreadId":threadParams.parent_pthread_ptr,"stackBase":threadParams.stackBase,"stackSize":threadParams.stackSize};worker.runPthread=function(){msg.time=performance.now();worker.postMessage(msg,threadParams.transferList)};if(worker.loaded){worker.runPthread();delete worker.runPthread}}function _pthread_getschedparam(thread,policy,schedparam){if(!policy&&!schedparam)return ERRNO_CODES.EINVAL;if(!thread){err("pthread_getschedparam called with a null thread pointer!");return ERRNO_CODES.ESRCH}var self=HEAP32[thread+12>>2];if(self!==thread){err("pthread_getschedparam attempted on thread "+thread+", which does not point to a valid thread, or does not exist anymore!");return ERRNO_CODES.ESRCH}var schedPolicy=Atomics.load(HEAPU32,thread+108+20>>2);var schedPrio=Atomics.load(HEAPU32,thread+108+24>>2);if(policy)HEAP32[policy>>2]=schedPolicy;if(schedparam)HEAP32[schedparam>>2]=schedPrio;return 0}function _pthread_self(){return __pthread_ptr|0}Module["_pthread_self"]=_pthread_self;function _pthread_create(pthread_ptr,attr,start_routine,arg){if(typeof SharedArrayBuffer==="undefined"){err("Current environment does not support SharedArrayBuffer, pthreads are not available!");return 6}if(!pthread_ptr){err("pthread_create called with a null thread pointer!");return 28}var transferList=[];var error=0;if(ENVIRONMENT_IS_PTHREAD&&(transferList.length===0||error)){return _emscripten_sync_run_in_main_thread_4(687865856,pthread_ptr,attr,start_routine,arg)}if(error)return error;var stackSize=0;var stackBase=0;var detached=0;var schedPolicy=0;var schedPrio=0;if(attr){stackSize=HEAP32[attr>>2];stackSize+=81920;stackBase=HEAP32[attr+8>>2];detached=HEAP32[attr+12>>2]!==0;var inheritSched=HEAP32[attr+16>>2]===0;if(inheritSched){var prevSchedPolicy=HEAP32[attr+20>>2];var prevSchedPrio=HEAP32[attr+24>>2];var parentThreadPtr=PThread.currentProxiedOperationCallerThread?PThread.currentProxiedOperationCallerThread:_pthread_self();_pthread_getschedparam(parentThreadPtr,attr+20,attr+24);schedPolicy=HEAP32[attr+20>>2];schedPrio=HEAP32[attr+24>>2];HEAP32[attr+20>>2]=prevSchedPolicy;HEAP32[attr+24>>2]=prevSchedPrio}else{schedPolicy=HEAP32[attr+20>>2];schedPrio=HEAP32[attr+24>>2]}}else{stackSize=2097152}var allocatedOwnStack=stackBase==0;if(allocatedOwnStack){stackBase=_memalign(16,stackSize)}else{stackBase-=stackSize;assert(stackBase>0)}var threadInfoStruct=_malloc(232);for(var i=0;i<232>>2;++i)HEAPU32[(threadInfoStruct>>2)+i]=0;HEAP32[pthread_ptr>>2]=threadInfoStruct;HEAP32[threadInfoStruct+12>>2]=threadInfoStruct;var headPtr=threadInfoStruct+156;HEAP32[headPtr>>2]=headPtr;var threadParams={stackBase:stackBase,stackSize:stackSize,allocatedOwnStack:allocatedOwnStack,schedPolicy:schedPolicy,schedPrio:schedPrio,detached:detached,startRoutine:start_routine,pthread_ptr:threadInfoStruct,parent_pthread_ptr:_pthread_self(),arg:arg,transferList:transferList};if(ENVIRONMENT_IS_PTHREAD){threadParams.cmd="spawnThread";postMessage(threadParams,transferList)}else{spawnThread(threadParams)}return 0}function __pthread_testcancel_js(){if(!ENVIRONMENT_IS_PTHREAD)return;if(!threadInfoStruct)return;var cancelDisabled=Atomics.load(HEAPU32,threadInfoStruct+60>>2);if(cancelDisabled)return;var canceled=Atomics.load(HEAPU32,threadInfoStruct+0>>2);if(canceled==2)throw"Canceled!"}function __emscripten_do_pthread_join(thread,status,block){if(!thread){err("pthread_join attempted on a null thread pointer!");return ERRNO_CODES.ESRCH}if(ENVIRONMENT_IS_PTHREAD&&selfThreadId==thread){err("PThread "+thread+" is attempting to join to itself!");return ERRNO_CODES.EDEADLK}else if(!ENVIRONMENT_IS_PTHREAD&&PThread.mainThreadBlock==thread){err("Main thread "+thread+" is attempting to join to itself!");return ERRNO_CODES.EDEADLK}var self=HEAP32[thread+12>>2];if(self!==thread){err("pthread_join attempted on thread "+thread+", which does not point to a valid thread, or does not exist anymore!");return ERRNO_CODES.ESRCH}var detached=Atomics.load(HEAPU32,thread+68>>2);if(detached){err("Attempted to join thread "+thread+", which was already detached!");return ERRNO_CODES.EINVAL}if(block){_emscripten_check_blocking_allowed()}for(;;){var threadStatus=Atomics.load(HEAPU32,thread+0>>2);if(threadStatus==1){var threadExitCode=Atomics.load(HEAPU32,thread+4>>2);if(status)HEAP32[status>>2]=threadExitCode;Atomics.store(HEAPU32,thread+68>>2,1);if(!ENVIRONMENT_IS_PTHREAD)cleanupThread(thread);else postMessage({"cmd":"cleanupThread","thread":thread});return 0}if(!block){return ERRNO_CODES.EBUSY}__pthread_testcancel_js();if(!ENVIRONMENT_IS_PTHREAD)_emscripten_main_thread_process_queued_calls();_emscripten_futex_wait(thread+0,threadStatus,ENVIRONMENT_IS_PTHREAD?100:1)}}function _pthread_join(thread,status){return __emscripten_do_pthread_join(thread,status,true)}function _round(d){d=+d;return d>=+0?+Math_floor(d+ +.5):+Math_ceil(d-+.5)}function __isLeapYear(year){return year%4===0&&(year%100!==0||year%400===0)}function __arraySum(array,index){var sum=0;for(var i=0;i<=index;sum+=array[i++]){}return sum}var __MONTH_DAYS_LEAP=[31,29,31,30,31,30,31,31,30,31,30,31];var __MONTH_DAYS_REGULAR=[31,28,31,30,31,30,31,31,30,31,30,31];function __addDays(date,days){var newDate=new Date(date.getTime());while(days>0){var leap=__isLeapYear(newDate.getFullYear());var currentMonth=newDate.getMonth();var daysInCurrentMonth=(leap?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR)[currentMonth];if(days>daysInCurrentMonth-newDate.getDate()){days-=daysInCurrentMonth-newDate.getDate()+1;newDate.setDate(1);if(currentMonth<11){newDate.setMonth(currentMonth+1)}else{newDate.setMonth(0);newDate.setFullYear(newDate.getFullYear()+1)}}else{newDate.setDate(newDate.getDate()+days);return newDate}}return newDate}function _strftime(s,maxsize,format,tm){var tm_zone=HEAP32[tm+40>>2];var date={tm_sec:HEAP32[tm>>2],tm_min:HEAP32[tm+4>>2],tm_hour:HEAP32[tm+8>>2],tm_mday:HEAP32[tm+12>>2],tm_mon:HEAP32[tm+16>>2],tm_year:HEAP32[tm+20>>2],tm_wday:HEAP32[tm+24>>2],tm_yday:HEAP32[tm+28>>2],tm_isdst:HEAP32[tm+32>>2],tm_gmtoff:HEAP32[tm+36>>2],tm_zone:tm_zone?UTF8ToString(tm_zone):""};var pattern=UTF8ToString(format);var EXPANSION_RULES_1={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var rule in EXPANSION_RULES_1){pattern=pattern.replace(new RegExp(rule,"g"),EXPANSION_RULES_1[rule])}var WEEKDAYS=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];function leadingSomething(value,digits,character){var str=typeof value==="number"?value.toString():value||"";while(str.length<digits){str=character[0]+str}return str}function leadingNulls(value,digits){return leadingSomething(value,digits,"0")}function compareByDay(date1,date2){function sgn(value){return value<0?-1:value>0?1:0}var compare;if((compare=sgn(date1.getFullYear()-date2.getFullYear()))===0){if((compare=sgn(date1.getMonth()-date2.getMonth()))===0){compare=sgn(date1.getDate()-date2.getDate())}}return compare}function getFirstWeekStartDate(janFourth){switch(janFourth.getDay()){case 0:return new Date(janFourth.getFullYear()-1,11,29);case 1:return janFourth;case 2:return new Date(janFourth.getFullYear(),0,3);case 3:return new Date(janFourth.getFullYear(),0,2);case 4:return new Date(janFourth.getFullYear(),0,1);case 5:return new Date(janFourth.getFullYear()-1,11,31);case 6:return new Date(janFourth.getFullYear()-1,11,30)}}function getWeekBasedYear(date){var thisDate=__addDays(new Date(date.tm_year+1900,0,1),date.tm_yday);var janFourthThisYear=new Date(thisDate.getFullYear(),0,4);var janFourthNextYear=new Date(thisDate.getFullYear()+1,0,4);var firstWeekStartThisYear=getFirstWeekStartDate(janFourthThisYear);var firstWeekStartNextYear=getFirstWeekStartDate(janFourthNextYear);if(compareByDay(firstWeekStartThisYear,thisDate)<=0){if(compareByDay(firstWeekStartNextYear,thisDate)<=0){return thisDate.getFullYear()+1}else{return thisDate.getFullYear()}}else{return thisDate.getFullYear()-1}}var EXPANSION_RULES_2={"%a":function(date){return WEEKDAYS[date.tm_wday].substring(0,3)},"%A":function(date){return WEEKDAYS[date.tm_wday]},"%b":function(date){return MONTHS[date.tm_mon].substring(0,3)},"%B":function(date){return MONTHS[date.tm_mon]},"%C":function(date){var year=date.tm_year+1900;return leadingNulls(year/100|0,2)},"%d":function(date){return leadingNulls(date.tm_mday,2)},"%e":function(date){return leadingSomething(date.tm_mday,2," ")},"%g":function(date){return getWeekBasedYear(date).toString().substring(2)},"%G":function(date){return getWeekBasedYear(date)},"%H":function(date){return leadingNulls(date.tm_hour,2)},"%I":function(date){var twelveHour=date.tm_hour;if(twelveHour==0)twelveHour=12;else if(twelveHour>12)twelveHour-=12;return leadingNulls(twelveHour,2)},"%j":function(date){return leadingNulls(date.tm_mday+__arraySum(__isLeapYear(date.tm_year+1900)?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,date.tm_mon-1),3)},"%m":function(date){return leadingNulls(date.tm_mon+1,2)},"%M":function(date){return leadingNulls(date.tm_min,2)},"%n":function(){return"\\n"},"%p":function(date){if(date.tm_hour>=0&&date.tm_hour<12){return"AM"}else{return"PM"}},"%S":function(date){return leadingNulls(date.tm_sec,2)},"%t":function(){return"\\t"},"%u":function(date){return date.tm_wday||7},"%U":function(date){var janFirst=new Date(date.tm_year+1900,0,1);var firstSunday=janFirst.getDay()===0?janFirst:__addDays(janFirst,7-janFirst.getDay());var endDate=new Date(date.tm_year+1900,date.tm_mon,date.tm_mday);if(compareByDay(firstSunday,endDate)<0){var februaryFirstUntilEndMonth=__arraySum(__isLeapYear(endDate.getFullYear())?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,endDate.getMonth()-1)-31;var firstSundayUntilEndJanuary=31-firstSunday.getDate();var days=firstSundayUntilEndJanuary+februaryFirstUntilEndMonth+endDate.getDate();return leadingNulls(Math.ceil(days/7),2)}return compareByDay(firstSunday,janFirst)===0?"01":"00"},"%V":function(date){var janFourthThisYear=new Date(date.tm_year+1900,0,4);var janFourthNextYear=new Date(date.tm_year+1901,0,4);var firstWeekStartThisYear=getFirstWeekStartDate(janFourthThisYear);var firstWeekStartNextYear=getFirstWeekStartDate(janFourthNextYear);var endDate=__addDays(new Date(date.tm_year+1900,0,1),date.tm_yday);if(compareByDay(endDate,firstWeekStartThisYear)<0){return"53"}if(compareByDay(firstWeekStartNextYear,endDate)<=0){return"01"}var daysDifference;if(firstWeekStartThisYear.getFullYear()<date.tm_year+1900){daysDifference=date.tm_yday+32-firstWeekStartThisYear.getDate()}else{daysDifference=date.tm_yday+1-firstWeekStartThisYear.getDate()}return leadingNulls(Math.ceil(daysDifference/7),2)},"%w":function(date){return date.tm_wday},"%W":function(date){var janFirst=new Date(date.tm_year,0,1);var firstMonday=janFirst.getDay()===1?janFirst:__addDays(janFirst,janFirst.getDay()===0?1:7-janFirst.getDay()+1);var endDate=new Date(date.tm_year+1900,date.tm_mon,date.tm_mday);if(compareByDay(firstMonday,endDate)<0){var februaryFirstUntilEndMonth=__arraySum(__isLeapYear(endDate.getFullYear())?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,endDate.getMonth()-1)-31;var firstMondayUntilEndJanuary=31-firstMonday.getDate();var days=firstMondayUntilEndJanuary+februaryFirstUntilEndMonth+endDate.getDate();return leadingNulls(Math.ceil(days/7),2)}return compareByDay(firstMonday,janFirst)===0?"01":"00"},"%y":function(date){return(date.tm_year+1900).toString().substring(2)},"%Y":function(date){return date.tm_year+1900},"%z":function(date){var off=date.tm_gmtoff;var ahead=off>=0;off=Math.abs(off)/60;off=off/60*100+off%60;return(ahead?"+":"-")+String("0000"+off).slice(-4)},"%Z":function(date){return date.tm_zone},"%%":function(){return"%"}};for(var rule in EXPANSION_RULES_2){if(pattern.indexOf(rule)>=0){pattern=pattern.replace(new RegExp(rule,"g"),EXPANSION_RULES_2[rule](date))}}var bytes=intArrayFromString(pattern,false);if(bytes.length>maxsize){return 0}writeArrayToMemory(bytes,s);return bytes.length-1}function _sysconf(name){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(10,1,name);switch(name){case 30:return 16384;case 85:var maxHeapSize=HEAPU8.length;return maxHeapSize/16384;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:case 79:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:{if(typeof navigator==="object")return navigator["hardwareConcurrency"]||1;return 1}}setErrNo(28);return-1}function _emscripten_set_main_loop_timing(mode,value){Browser.mainLoop.timingMode=mode;Browser.mainLoop.timingValue=value;if(!Browser.mainLoop.func){return 1}if(mode==0){Browser.mainLoop.scheduler=function Browser_mainLoop_scheduler_setTimeout(){var timeUntilNextTick=Math.max(0,Browser.mainLoop.tickStartTime+value-_emscripten_get_now())|0;setTimeout(Browser.mainLoop.runner,timeUntilNextTick)};Browser.mainLoop.method="timeout"}else if(mode==1){Browser.mainLoop.scheduler=function Browser_mainLoop_scheduler_rAF(){Browser.requestAnimationFrame(Browser.mainLoop.runner)};Browser.mainLoop.method="rAF"}else if(mode==2){if(typeof setImmediate==="undefined"){var setImmediates=[];var emscriptenMainLoopMessageId="setimmediate";var Browser_setImmediate_messageHandler=function(event){if(event.data===emscriptenMainLoopMessageId||event.data.target===emscriptenMainLoopMessageId){event.stopPropagation();setImmediates.shift()()}};addEventListener("message",Browser_setImmediate_messageHandler,true);setImmediate=function Browser_emulated_setImmediate(func){setImmediates.push(func);if(ENVIRONMENT_IS_WORKER){if(Module["setImmediates"]===undefined)Module["setImmediates"]=[];Module["setImmediates"].push(func);postMessage({target:emscriptenMainLoopMessageId})}else postMessage(emscriptenMainLoopMessageId,"*")}}Browser.mainLoop.scheduler=function Browser_mainLoop_scheduler_setImmediate(){setImmediate(Browser.mainLoop.runner)};Browser.mainLoop.method="immediate"}return 0}function _emscripten_set_main_loop(func,fps,simulateInfiniteLoop,arg,noSetTiming){noExitRuntime=true;assert(!Browser.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters.");Browser.mainLoop.func=func;Browser.mainLoop.arg=arg;var browserIterationFunc;if(typeof arg!=="undefined"){browserIterationFunc=function(){Module["dynCall_vi"](func,arg)}}else{browserIterationFunc=function(){Module["dynCall_v"](func)}}var thisMainLoopId=Browser.mainLoop.currentlyRunningMainloop;Browser.mainLoop.runner=function Browser_mainLoop_runner(){if(ABORT)return;if(Browser.mainLoop.queue.length>0){var start=Date.now();var blocker=Browser.mainLoop.queue.shift();blocker.func(blocker.arg);if(Browser.mainLoop.remainingBlockers){var remaining=Browser.mainLoop.remainingBlockers;var next=remaining%1==0?remaining-1:Math.floor(remaining);if(blocker.counted){Browser.mainLoop.remainingBlockers=next}else{next=next+.5;Browser.mainLoop.remainingBlockers=(8*remaining+next)/9}}console.log(\'main loop blocker "\'+blocker.name+\'" took \'+(Date.now()-start)+" ms");Browser.mainLoop.updateStatus();if(thisMainLoopId<Browser.mainLoop.currentlyRunningMainloop)return;setTimeout(Browser.mainLoop.runner,0);return}if(thisMainLoopId<Browser.mainLoop.currentlyRunningMainloop)return;Browser.mainLoop.currentFrameNumber=Browser.mainLoop.currentFrameNumber+1|0;if(Browser.mainLoop.timingMode==1&&Browser.mainLoop.timingValue>1&&Browser.mainLoop.currentFrameNumber%Browser.mainLoop.timingValue!=0){Browser.mainLoop.scheduler();return}else if(Browser.mainLoop.timingMode==0){Browser.mainLoop.tickStartTime=_emscripten_get_now()}Browser.mainLoop.runIter(browserIterationFunc);if(thisMainLoopId<Browser.mainLoop.currentlyRunningMainloop)return;if(typeof SDL==="object"&&SDL.audio&&SDL.audio.queueNewAudioData)SDL.audio.queueNewAudioData();Browser.mainLoop.scheduler()};if(!noSetTiming){if(fps&&fps>0)_emscripten_set_main_loop_timing(0,1e3/fps);else _emscripten_set_main_loop_timing(1,1);Browser.mainLoop.scheduler()}if(simulateInfiniteLoop){throw"unwind"}}var Browser={mainLoop:{scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){Browser.mainLoop.scheduler=null;Browser.mainLoop.currentlyRunningMainloop++},resume:function(){Browser.mainLoop.currentlyRunningMainloop++;var timingMode=Browser.mainLoop.timingMode;var timingValue=Browser.mainLoop.timingValue;var func=Browser.mainLoop.func;Browser.mainLoop.func=null;_emscripten_set_main_loop(func,0,false,Browser.mainLoop.arg,true);_emscripten_set_main_loop_timing(timingMode,timingValue);Browser.mainLoop.scheduler()},updateStatus:function(){if(Module["setStatus"]){var message=Module["statusMessage"]||"Please wait...";var remaining=Browser.mainLoop.remainingBlockers;var expected=Browser.mainLoop.expectedBlockers;if(remaining){if(remaining<expected){Module["setStatus"](message+" ("+(expected-remaining)+"/"+expected+")")}else{Module["setStatus"](message)}}else{Module["setStatus"]("")}}},runIter:function(func){if(ABORT)return;if(Module["preMainLoop"]){var preRet=Module["preMainLoop"]();if(preRet===false){return}}try{func()}catch(e){if(e instanceof ExitStatus){return}else{if(e&&typeof e==="object"&&e.stack)err("exception thrown: "+[e,e.stack]);throw e}}if(Module["postMainLoop"])Module["postMainLoop"]()}},isFullscreen:false,pointerLock:false,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(!Module["preloadPlugins"])Module["preloadPlugins"]=[];if(Browser.initted)return;Browser.initted=true;try{new Blob;Browser.hasBlobConstructor=true}catch(e){Browser.hasBlobConstructor=false;console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Browser.BlobBuilder=typeof MozBlobBuilder!="undefined"?MozBlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:!Browser.hasBlobConstructor?console.log("warning: no BlobBuilder"):null;Browser.URLObject=typeof window!="undefined"?window.URL?window.URL:window.webkitURL:undefined;if(!Module.noImageDecoding&&typeof Browser.URLObject==="undefined"){console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available.");Module.noImageDecoding=true}var imagePlugin={};imagePlugin["canHandle"]=function imagePlugin_canHandle(name){return!Module.noImageDecoding&&/\\.(jpg|jpeg|png|bmp)$/i.test(name)};imagePlugin["handle"]=function imagePlugin_handle(byteArray,name,onload,onerror){var b=null;if(Browser.hasBlobConstructor){try{b=new Blob([byteArray],{type:Browser.getMimetype(name)});if(b.size!==byteArray.length){b=new Blob([new Uint8Array(byteArray).buffer],{type:Browser.getMimetype(name)})}}catch(e){warnOnce("Blob constructor present but fails: "+e+"; falling back to blob builder")}}if(!b){var bb=new Browser.BlobBuilder;bb.append(new Uint8Array(byteArray).buffer);b=bb.getBlob()}var url=Browser.URLObject.createObjectURL(b);var img=new Image;img.onload=function img_onload(){assert(img.complete,"Image "+name+" could not be decoded");var canvas=document.createElement("canvas");canvas.width=img.width;canvas.height=img.height;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0);Module["preloadedImages"][name]=canvas;Browser.URLObject.revokeObjectURL(url);if(onload)onload(byteArray)};img.onerror=function img_onerror(event){console.log("Image "+url+" could not be decoded");if(onerror)onerror()};img.src=url};Module["preloadPlugins"].push(imagePlugin);var audioPlugin={};audioPlugin["canHandle"]=function audioPlugin_canHandle(name){return!Module.noAudioDecoding&&name.substr(-4)in{".ogg":1,".wav":1,".mp3":1}};audioPlugin["handle"]=function audioPlugin_handle(byteArray,name,onload,onerror){var done=false;function finish(audio){if(done)return;done=true;Module["preloadedAudios"][name]=audio;if(onload)onload(byteArray)}function fail(){if(done)return;done=true;Module["preloadedAudios"][name]=new Audio;if(onerror)onerror()}if(Browser.hasBlobConstructor){try{var b=new Blob([byteArray],{type:Browser.getMimetype(name)})}catch(e){return fail()}var url=Browser.URLObject.createObjectURL(b);var audio=new Audio;audio.addEventListener("canplaythrough",function(){finish(audio)},false);audio.onerror=function audio_onerror(event){if(done)return;console.log("warning: browser could not fully decode audio "+name+", trying slower base64 approach");function encode64(data){var BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var PAD="=";var ret="";var leftchar=0;var leftbits=0;for(var i=0;i<data.length;i++){leftchar=leftchar<<8|data[i];leftbits+=8;while(leftbits>=6){var curr=leftchar>>leftbits-6&63;leftbits-=6;ret+=BASE[curr]}}if(leftbits==2){ret+=BASE[(leftchar&3)<<4];ret+=PAD+PAD}else if(leftbits==4){ret+=BASE[(leftchar&15)<<2];ret+=PAD}return ret}audio.src="data:audio/x-"+name.substr(-3)+";base64,"+encode64(byteArray);finish(audio)};audio.src=url;Browser.safeSetTimeout(function(){finish(audio)},1e4)}else{return fail()}};Module["preloadPlugins"].push(audioPlugin);function pointerLockChange(){Browser.pointerLock=document["pointerLockElement"]===Module["canvas"]||document["mozPointerLockElement"]===Module["canvas"]||document["webkitPointerLockElement"]===Module["canvas"]||document["msPointerLockElement"]===Module["canvas"]}var canvas=Module["canvas"];if(canvas){canvas.requestPointerLock=canvas["requestPointerLock"]||canvas["mozRequestPointerLock"]||canvas["webkitRequestPointerLock"]||canvas["msRequestPointerLock"]||function(){};canvas.exitPointerLock=document["exitPointerLock"]||document["mozExitPointerLock"]||document["webkitExitPointerLock"]||document["msExitPointerLock"]||function(){};canvas.exitPointerLock=canvas.exitPointerLock.bind(document);document.addEventListener("pointerlockchange",pointerLockChange,false);document.addEventListener("mozpointerlockchange",pointerLockChange,false);document.addEventListener("webkitpointerlockchange",pointerLockChange,false);document.addEventListener("mspointerlockchange",pointerLockChange,false);if(Module["elementPointerLock"]){canvas.addEventListener("click",function(ev){if(!Browser.pointerLock&&Module["canvas"].requestPointerLock){Module["canvas"].requestPointerLock();ev.preventDefault()}},false)}}},createContext:function(canvas,useWebGL,setInModule,webGLContextAttributes){if(useWebGL&&Module.ctx&&canvas==Module.canvas)return Module.ctx;var ctx;var contextHandle;if(useWebGL){var contextAttributes={antialias:false,alpha:false,majorVersion:1};if(webGLContextAttributes){for(var attribute in webGLContextAttributes){contextAttributes[attribute]=webGLContextAttributes[attribute]}}if(typeof GL!=="undefined"){contextHandle=GL.createContext(canvas,contextAttributes);if(contextHandle){ctx=GL.getContext(contextHandle).GLctx}}}else{ctx=canvas.getContext("2d")}if(!ctx)return null;if(setInModule){if(!useWebGL)assert(typeof GLctx==="undefined","cannot set in module if GLctx is used, but we are a non-GL context that would replace it");Module.ctx=ctx;if(useWebGL)GL.makeContextCurrent(contextHandle);Module.useWebGL=useWebGL;Browser.moduleContextCreatedCallbacks.forEach(function(callback){callback()});Browser.init()}return ctx},destroyContext:function(canvas,useWebGL,setInModule){},fullscreenHandlersInstalled:false,lockPointer:undefined,resizeCanvas:undefined,requestFullscreen:function(lockPointer,resizeCanvas){Browser.lockPointer=lockPointer;Browser.resizeCanvas=resizeCanvas;if(typeof Browser.lockPointer==="undefined")Browser.lockPointer=true;if(typeof Browser.resizeCanvas==="undefined")Browser.resizeCanvas=false;var canvas=Module["canvas"];function fullscreenChange(){Browser.isFullscreen=false;var canvasContainer=canvas.parentNode;if((document["fullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"]||document["webkitFullscreenElement"]||document["webkitCurrentFullScreenElement"])===canvasContainer){canvas.exitFullscreen=Browser.exitFullscreen;if(Browser.lockPointer)canvas.requestPointerLock();Browser.isFullscreen=true;if(Browser.resizeCanvas){Browser.setFullscreenCanvasSize()}else{Browser.updateCanvasDimensions(canvas)}}else{canvasContainer.parentNode.insertBefore(canvas,canvasContainer);canvasContainer.parentNode.removeChild(canvasContainer);if(Browser.resizeCanvas){Browser.setWindowedCanvasSize()}else{Browser.updateCanvasDimensions(canvas)}}if(Module["onFullScreen"])Module["onFullScreen"](Browser.isFullscreen);if(Module["onFullscreen"])Module["onFullscreen"](Browser.isFullscreen)}if(!Browser.fullscreenHandlersInstalled){Browser.fullscreenHandlersInstalled=true;document.addEventListener("fullscreenchange",fullscreenChange,false);document.addEventListener("mozfullscreenchange",fullscreenChange,false);document.addEventListener("webkitfullscreenchange",fullscreenChange,false);document.addEventListener("MSFullscreenChange",fullscreenChange,false)}var canvasContainer=document.createElement("div");canvas.parentNode.insertBefore(canvasContainer,canvas);canvasContainer.appendChild(canvas);canvasContainer.requestFullscreen=canvasContainer["requestFullscreen"]||canvasContainer["mozRequestFullScreen"]||canvasContainer["msRequestFullscreen"]||(canvasContainer["webkitRequestFullscreen"]?function(){canvasContainer["webkitRequestFullscreen"](Element["ALLOW_KEYBOARD_INPUT"])}:null)||(canvasContainer["webkitRequestFullScreen"]?function(){canvasContainer["webkitRequestFullScreen"](Element["ALLOW_KEYBOARD_INPUT"])}:null);canvasContainer.requestFullscreen()},exitFullscreen:function(){if(!Browser.isFullscreen){return false}var CFS=document["exitFullscreen"]||document["cancelFullScreen"]||document["mozCancelFullScreen"]||document["msExitFullscreen"]||document["webkitCancelFullScreen"]||function(){};CFS.apply(document,[]);return true},nextRAF:0,fakeRequestAnimationFrame:function(func){var now=Date.now();if(Browser.nextRAF===0){Browser.nextRAF=now+1e3/60}else{while(now+2>=Browser.nextRAF){Browser.nextRAF+=1e3/60}}var delay=Math.max(Browser.nextRAF-now,0);setTimeout(func,delay)},requestAnimationFrame:function(func){if(typeof requestAnimationFrame==="function"){requestAnimationFrame(func);return}var RAF=Browser.fakeRequestAnimationFrame;RAF(func)},safeCallback:function(func){return function(){if(!ABORT)return func.apply(null,arguments)}},allowAsyncCallbacks:true,queuedAsyncCallbacks:[],pauseAsyncCallbacks:function(){Browser.allowAsyncCallbacks=false},resumeAsyncCallbacks:function(){Browser.allowAsyncCallbacks=true;if(Browser.queuedAsyncCallbacks.length>0){var callbacks=Browser.queuedAsyncCallbacks;Browser.queuedAsyncCallbacks=[];callbacks.forEach(function(func){func()})}},safeRequestAnimationFrame:function(func){return Browser.requestAnimationFrame(function(){if(ABORT)return;if(Browser.allowAsyncCallbacks){func()}else{Browser.queuedAsyncCallbacks.push(func)}})},safeSetTimeout:function(func,timeout){noExitRuntime=true;return setTimeout(function(){if(ABORT)return;if(Browser.allowAsyncCallbacks){func()}else{Browser.queuedAsyncCallbacks.push(func)}},timeout)},safeSetInterval:function(func,timeout){noExitRuntime=true;return setInterval(function(){if(ABORT)return;if(Browser.allowAsyncCallbacks){func()}},timeout)},getMimetype:function(name){return{"jpg":"image/jpeg","jpeg":"image/jpeg","png":"image/png","bmp":"image/bmp","ogg":"audio/ogg","wav":"audio/wav","mp3":"audio/mpeg"}[name.substr(name.lastIndexOf(".")+1)]},getUserMedia:function(func){if(!window.getUserMedia){window.getUserMedia=navigator["getUserMedia"]||navigator["mozGetUserMedia"]}window.getUserMedia(func)},getMovementX:function(event){return event["movementX"]||event["mozMovementX"]||event["webkitMovementX"]||0},getMovementY:function(event){return event["movementY"]||event["mozMovementY"]||event["webkitMovementY"]||0},getMouseWheelDelta:function(event){var delta=0;switch(event.type){case"DOMMouseScroll":delta=event.detail/3;break;case"mousewheel":delta=event.wheelDelta/120;break;case"wheel":delta=event.deltaY;switch(event.deltaMode){case 0:delta/=100;break;case 1:delta/=3;break;case 2:delta*=80;break;default:throw"unrecognized mouse wheel delta mode: "+event.deltaMode}break;default:throw"unrecognized mouse wheel event: "+event.type}return delta},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(event){if(Browser.pointerLock){if(event.type!="mousemove"&&"mozMovementX"in event){Browser.mouseMovementX=Browser.mouseMovementY=0}else{Browser.mouseMovementX=Browser.getMovementX(event);Browser.mouseMovementY=Browser.getMovementY(event)}if(typeof SDL!="undefined"){Browser.mouseX=SDL.mouseX+Browser.mouseMovementX;Browser.mouseY=SDL.mouseY+Browser.mouseMovementY}else{Browser.mouseX+=Browser.mouseMovementX;Browser.mouseY+=Browser.mouseMovementY}}else{var rect=Module["canvas"].getBoundingClientRect();var cw=Module["canvas"].width;var ch=Module["canvas"].height;var scrollX=typeof window.scrollX!=="undefined"?window.scrollX:window.pageXOffset;var scrollY=typeof window.scrollY!=="undefined"?window.scrollY:window.pageYOffset;if(event.type==="touchstart"||event.type==="touchend"||event.type==="touchmove"){var touch=event.touch;if(touch===undefined){return}var adjustedX=touch.pageX-(scrollX+rect.left);var adjustedY=touch.pageY-(scrollY+rect.top);adjustedX=adjustedX*(cw/rect.width);adjustedY=adjustedY*(ch/rect.height);var coords={x:adjustedX,y:adjustedY};if(event.type==="touchstart"){Browser.lastTouches[touch.identifier]=coords;Browser.touches[touch.identifier]=coords}else if(event.type==="touchend"||event.type==="touchmove"){var last=Browser.touches[touch.identifier];if(!last)last=coords;Browser.lastTouches[touch.identifier]=last;Browser.touches[touch.identifier]=coords}return}var x=event.pageX-(scrollX+rect.left);var y=event.pageY-(scrollY+rect.top);x=x*(cw/rect.width);y=y*(ch/rect.height);Browser.mouseMovementX=x-Browser.mouseX;Browser.mouseMovementY=y-Browser.mouseY;Browser.mouseX=x;Browser.mouseY=y}},asyncLoad:function(url,onload,onerror,noRunDep){var dep=!noRunDep?getUniqueRunDependency("al "+url):"";readAsync(url,function(arrayBuffer){assert(arrayBuffer,\'Loading data file "\'+url+\'" failed (no arrayBuffer).\');onload(new Uint8Array(arrayBuffer));if(dep)removeRunDependency(dep)},function(event){if(onerror){onerror()}else{throw\'Loading data file "\'+url+\'" failed.\'}});if(dep)addRunDependency(dep)},resizeListeners:[],updateResizeListeners:function(){var canvas=Module["canvas"];Browser.resizeListeners.forEach(function(listener){listener(canvas.width,canvas.height)})},setCanvasSize:function(width,height,noUpdates){var canvas=Module["canvas"];Browser.updateCanvasDimensions(canvas,width,height);if(!noUpdates)Browser.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize:function(){if(typeof SDL!="undefined"){var flags=HEAPU32[SDL.screen>>2];flags=flags|8388608;HEAP32[SDL.screen>>2]=flags}Browser.updateCanvasDimensions(Module["canvas"]);Browser.updateResizeListeners()},setWindowedCanvasSize:function(){if(typeof SDL!="undefined"){var flags=HEAPU32[SDL.screen>>2];flags=flags&~8388608;HEAP32[SDL.screen>>2]=flags}Browser.updateCanvasDimensions(Module["canvas"]);Browser.updateResizeListeners()},updateCanvasDimensions:function(canvas,wNative,hNative){if(wNative&&hNative){canvas.widthNative=wNative;canvas.heightNative=hNative}else{wNative=canvas.widthNative;hNative=canvas.heightNative}var w=wNative;var h=hNative;if(Module["forcedAspectRatio"]&&Module["forcedAspectRatio"]>0){if(w/h<Module["forcedAspectRatio"]){w=Math.round(h*Module["forcedAspectRatio"])}else{h=Math.round(w/Module["forcedAspectRatio"])}}if((document["fullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"]||document["webkitFullscreenElement"]||document["webkitCurrentFullScreenElement"])===canvas.parentNode&&typeof screen!="undefined"){var factor=Math.min(screen.width/w,screen.height/h);w=Math.round(w*factor);h=Math.round(h*factor)}if(Browser.resizeCanvas){if(canvas.width!=w)canvas.width=w;if(canvas.height!=h)canvas.height=h;if(typeof canvas.style!="undefined"){canvas.style.removeProperty("width");canvas.style.removeProperty("height")}}else{if(canvas.width!=wNative)canvas.width=wNative;if(canvas.height!=hNative)canvas.height=hNative;if(typeof canvas.style!="undefined"){if(w!=wNative||h!=hNative){canvas.style.setProperty("width",w+"px","important");canvas.style.setProperty("height",h+"px","important")}else{canvas.style.removeProperty("width");canvas.style.removeProperty("height")}}}},wgetRequests:{},nextWgetRequestHandle:0,getNextWgetRequestHandle:function(){var handle=Browser.nextWgetRequestHandle;Browser.nextWgetRequestHandle++;return handle}};function runAndAbortIfError(func){try{return func()}catch(e){abort(e)}}var Asyncify={State:{Normal:0,Unwinding:1,Rewinding:2},state:0,StackSize:4096,currData:null,handleSleepReturnValue:0,exportCallStack:[],callStackNameToId:{},callStackIdToFunc:{},callStackId:0,afterUnwind:null,asyncFinalizers:[],sleepCallbacks:[],getCallStackId:function(funcName){var id=Asyncify.callStackNameToId[funcName];if(id===undefined){id=Asyncify.callStackId++;Asyncify.callStackNameToId[funcName]=id;Asyncify.callStackIdToFunc[id]=Module["asm"][funcName]}return id},instrumentWasmExports:function(exports){var ret={};for(var x in exports){(function(x){var original=exports[x];if(typeof original==="function"){ret[x]=function(){Asyncify.exportCallStack.push(x);try{return original.apply(null,arguments)}finally{if(ABORT)return;var y=Asyncify.exportCallStack.pop(x);assert(y===x);if(Asyncify.currData&&Asyncify.state===Asyncify.State.Unwinding&&Asyncify.exportCallStack.length===0){Asyncify.state=Asyncify.State.Normal;runAndAbortIfError(Module["_asyncify_stop_unwind"]);if(typeof Fibers!=="undefined"){Fibers.trampoline()}if(Asyncify.afterUnwind){Asyncify.afterUnwind();Asyncify.afterUnwind=null}}}}}else{ret[x]=original}})(x)}return ret},allocateData:function(){var ptr=_malloc(12+Asyncify.StackSize);Asyncify.setDataHeader(ptr,ptr+12,Asyncify.StackSize);Asyncify.setDataRewindFunc(ptr);return ptr},setDataHeader:function(ptr,stack,stackSize){HEAP32[ptr>>2]=stack;HEAP32[ptr+4>>2]=stack+stackSize},setDataRewindFunc:function(ptr){var bottomOfCallStack=Asyncify.exportCallStack[0];var rewindId=Asyncify.getCallStackId(bottomOfCallStack);HEAP32[ptr+8>>2]=rewindId},getDataRewindFunc:function(ptr){var id=HEAP32[ptr+8>>2];var func=Asyncify.callStackIdToFunc[id];return func},handleSleep:function(startAsync){if(ABORT)return;noExitRuntime=true;if(Asyncify.state===Asyncify.State.Normal){var reachedCallback=false;var reachedAfterCallback=false;startAsync(function(handleSleepReturnValue){if(ABORT)return;Asyncify.handleSleepReturnValue=handleSleepReturnValue||0;reachedCallback=true;if(!reachedAfterCallback){return}Asyncify.state=Asyncify.State.Rewinding;runAndAbortIfError(function(){Module["_asyncify_start_rewind"](Asyncify.currData)});if(Browser.mainLoop.func){Browser.mainLoop.resume()}var start=Asyncify.getDataRewindFunc(Asyncify.currData);var asyncWasmReturnValue=start();if(!Asyncify.currData){var asyncFinalizers=Asyncify.asyncFinalizers;Asyncify.asyncFinalizers=[];asyncFinalizers.forEach(function(func){func(asyncWasmReturnValue)})}});reachedAfterCallback=true;if(!reachedCallback){Asyncify.state=Asyncify.State.Unwinding;Asyncify.currData=Asyncify.allocateData();runAndAbortIfError(function(){Module["_asyncify_start_unwind"](Asyncify.currData)});if(Browser.mainLoop.func){Browser.mainLoop.pause()}}}else if(Asyncify.state===Asyncify.State.Rewinding){Asyncify.state=Asyncify.State.Normal;runAndAbortIfError(Module["_asyncify_stop_rewind"]);_free(Asyncify.currData);Asyncify.currData=null;Asyncify.sleepCallbacks.forEach(function(func){func()})}else{abort("invalid state: "+Asyncify.state)}return Asyncify.handleSleepReturnValue},handleAsync:function(startAsync){return Asyncify.handleSleep(function(wakeUp){startAsync().then(wakeUp)})}};if(!ENVIRONMENT_IS_PTHREAD)PThread.initMainThreadBlock();else PThread.initWorker();var GLctx;Module["requestFullscreen"]=function Module_requestFullscreen(lockPointer,resizeCanvas){Browser.requestFullscreen(lockPointer,resizeCanvas)};Module["requestAnimationFrame"]=function Module_requestAnimationFrame(func){Browser.requestAnimationFrame(func)};Module["setCanvasSize"]=function Module_setCanvasSize(width,height,noUpdates){Browser.setCanvasSize(width,height,noUpdates)};Module["pauseMainLoop"]=function Module_pauseMainLoop(){Browser.mainLoop.pause()};Module["resumeMainLoop"]=function Module_resumeMainLoop(){Browser.mainLoop.resume()};Module["getUserMedia"]=function Module_getUserMedia(){Browser.getUserMedia()};Module["createContext"]=function Module_createContext(canvas,useWebGL,setInModule,webGLContextAttributes){return Browser.createContext(canvas,useWebGL,setInModule,webGLContextAttributes)};var proxiedFunctionTable=[null,___sys_fcntl64,___sys_open,___sys_read,_emscripten_set_canvas_element_size_main_thread,_fd_close,_fd_fdstat_get,_fd_seek,_fd_write,_tzset,_sysconf];function intArrayFromString(stringy,dontAddNull,length){var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array}var asmLibraryArg={"d":___assert_fail,"V":___sys_fcntl64,"T":___sys_open,"U":___sys_read,"P":__emscripten_notify_thread_queue,"a":_abort,"O":_clock,"N":_clock_gettime,"n":_emscripten_asm_const_iii,"M":_emscripten_check_blocking_allowed,"m":_emscripten_conditional_set_current_thread_status,"L":_emscripten_console_log,"K":_emscripten_console_warn,"e":_emscripten_futex_wait,"c":_emscripten_futex_wake,"g":_emscripten_get_now,"f":_emscripten_is_main_browser_thread,"J":_emscripten_is_main_runtime_thread,"I":_emscripten_memcpy_big,"H":_emscripten_receive_on_main_thread_js,"G":_emscripten_resize_heap,"F":_emscripten_set_canvas_element_size,"l":_emscripten_set_current_thread_status,"k":_emscripten_sleep,"E":_emscripten_webgl_create_context,"S":_environ_get,"R":_environ_sizes_get,"p":_fd_close,"Q":_fd_fdstat_get,"y":_fd_seek,"o":_fd_write,"D":_frame_out,"C":_getTempRet0,"x":_get_play_time,"B":_gettimeofday,"A":_gmtime_r,"z":initPthreadsJS,"memory":wasmMemory||Module["wasmMemory"],"w":_outer_close,"j":_outer_read,"v":_play_exit,"u":_pthread_cleanup_pop,"t":_pthread_cleanup_push,"h":_pthread_create,"i":_pthread_join,"b":_pthread_self,"s":_round,"r":_strftime,"q":_sysconf,"table":wasmTable};var asm=createWasm();var ___wasm_call_ctors=Module["___wasm_call_ctors"]=function(){return(___wasm_call_ctors=Module["___wasm_call_ctors"]=Module["asm"]["W"]).apply(null,arguments)};var _decode_abort=Module["_decode_abort"]=function(){return(_decode_abort=Module["_decode_abort"]=Module["asm"]["X"]).apply(null,arguments)};var _set_hidden=Module["_set_hidden"]=function(){return(_set_hidden=Module["_set_hidden"]=Module["asm"]["Y"]).apply(null,arguments)};var _play=Module["_play"]=function(){return(_play=Module["_play"]=Module["asm"]["Z"]).apply(null,arguments)};var _log_init=Module["_log_init"]=function(){return(_log_init=Module["_log_init"]=Module["asm"]["_"]).apply(null,arguments)};var ___errno_location=Module["___errno_location"]=function(){return(___errno_location=Module["___errno_location"]=Module["asm"]["$"]).apply(null,arguments)};var _free=Module["_free"]=function(){return(_free=Module["_free"]=Module["asm"]["aa"]).apply(null,arguments)};var _malloc=Module["_malloc"]=function(){return(_malloc=Module["_malloc"]=Module["asm"]["ba"]).apply(null,arguments)};var _emscripten_get_global_libc=Module["_emscripten_get_global_libc"]=function(){return(_emscripten_get_global_libc=Module["_emscripten_get_global_libc"]=Module["asm"]["ca"]).apply(null,arguments)};var __get_tzname=Module["__get_tzname"]=function(){return(__get_tzname=Module["__get_tzname"]=Module["asm"]["da"]).apply(null,arguments)};var __get_daylight=Module["__get_daylight"]=function(){return(__get_daylight=Module["__get_daylight"]=Module["asm"]["ea"]).apply(null,arguments)};var __get_timezone=Module["__get_timezone"]=function(){return(__get_timezone=Module["__get_timezone"]=Module["asm"]["fa"]).apply(null,arguments)};var stackSave=Module["stackSave"]=function(){return(stackSave=Module["stackSave"]=Module["asm"]["ga"]).apply(null,arguments)};var stackRestore=Module["stackRestore"]=function(){return(stackRestore=Module["stackRestore"]=Module["asm"]["ha"]).apply(null,arguments)};var stackAlloc=Module["stackAlloc"]=function(){return(stackAlloc=Module["stackAlloc"]=Module["asm"]["ia"]).apply(null,arguments)};var _memalign=Module["_memalign"]=function(){return(_memalign=Module["_memalign"]=Module["asm"]["ja"]).apply(null,arguments)};var _emscripten_main_browser_thread_id=Module["_emscripten_main_browser_thread_id"]=function(){return(_emscripten_main_browser_thread_id=Module["_emscripten_main_browser_thread_id"]=Module["asm"]["ka"]).apply(null,arguments)};var ___pthread_tsd_run_dtors=Module["___pthread_tsd_run_dtors"]=function(){return(___pthread_tsd_run_dtors=Module["___pthread_tsd_run_dtors"]=Module["asm"]["la"]).apply(null,arguments)};var _emscripten_main_thread_process_queued_calls=Module["_emscripten_main_thread_process_queued_calls"]=function(){return(_emscripten_main_thread_process_queued_calls=Module["_emscripten_main_thread_process_queued_calls"]=Module["asm"]["ma"]).apply(null,arguments)};var _emscripten_current_thread_process_queued_calls=Module["_emscripten_current_thread_process_queued_calls"]=function(){return(_emscripten_current_thread_process_queued_calls=Module["_emscripten_current_thread_process_queued_calls"]=Module["asm"]["na"]).apply(null,arguments)};var _emscripten_register_main_browser_thread_id=Module["_emscripten_register_main_browser_thread_id"]=function(){return(_emscripten_register_main_browser_thread_id=Module["_emscripten_register_main_browser_thread_id"]=Module["asm"]["oa"]).apply(null,arguments)};var _do_emscripten_dispatch_to_thread=Module["_do_emscripten_dispatch_to_thread"]=function(){return(_do_emscripten_dispatch_to_thread=Module["_do_emscripten_dispatch_to_thread"]=Module["asm"]["pa"]).apply(null,arguments)};var _emscripten_async_run_in_main_thread=Module["_emscripten_async_run_in_main_thread"]=function(){return(_emscripten_async_run_in_main_thread=Module["_emscripten_async_run_in_main_thread"]=Module["asm"]["qa"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread=Module["_emscripten_sync_run_in_main_thread"]=function(){return(_emscripten_sync_run_in_main_thread=Module["_emscripten_sync_run_in_main_thread"]=Module["asm"]["ra"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_0=Module["_emscripten_sync_run_in_main_thread_0"]=function(){return(_emscripten_sync_run_in_main_thread_0=Module["_emscripten_sync_run_in_main_thread_0"]=Module["asm"]["sa"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_1=Module["_emscripten_sync_run_in_main_thread_1"]=function(){return(_emscripten_sync_run_in_main_thread_1=Module["_emscripten_sync_run_in_main_thread_1"]=Module["asm"]["ta"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_2=Module["_emscripten_sync_run_in_main_thread_2"]=function(){return(_emscripten_sync_run_in_main_thread_2=Module["_emscripten_sync_run_in_main_thread_2"]=Module["asm"]["ua"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_xprintf_varargs=Module["_emscripten_sync_run_in_main_thread_xprintf_varargs"]=function(){return(_emscripten_sync_run_in_main_thread_xprintf_varargs=Module["_emscripten_sync_run_in_main_thread_xprintf_varargs"]=Module["asm"]["va"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_3=Module["_emscripten_sync_run_in_main_thread_3"]=function(){return(_emscripten_sync_run_in_main_thread_3=Module["_emscripten_sync_run_in_main_thread_3"]=Module["asm"]["wa"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_4=Module["_emscripten_sync_run_in_main_thread_4"]=function(){return(_emscripten_sync_run_in_main_thread_4=Module["_emscripten_sync_run_in_main_thread_4"]=Module["asm"]["xa"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_5=Module["_emscripten_sync_run_in_main_thread_5"]=function(){return(_emscripten_sync_run_in_main_thread_5=Module["_emscripten_sync_run_in_main_thread_5"]=Module["asm"]["ya"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_6=Module["_emscripten_sync_run_in_main_thread_6"]=function(){return(_emscripten_sync_run_in_main_thread_6=Module["_emscripten_sync_run_in_main_thread_6"]=Module["asm"]["za"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_7=Module["_emscripten_sync_run_in_main_thread_7"]=function(){return(_emscripten_sync_run_in_main_thread_7=Module["_emscripten_sync_run_in_main_thread_7"]=Module["asm"]["Aa"]).apply(null,arguments)};var _emscripten_run_in_main_runtime_thread_js=Module["_emscripten_run_in_main_runtime_thread_js"]=function(){return(_emscripten_run_in_main_runtime_thread_js=Module["_emscripten_run_in_main_runtime_thread_js"]=Module["asm"]["Ba"]).apply(null,arguments)};var __emscripten_call_on_thread=Module["__emscripten_call_on_thread"]=function(){return(__emscripten_call_on_thread=Module["__emscripten_call_on_thread"]=Module["asm"]["Ca"]).apply(null,arguments)};var _emscripten_tls_init=Module["_emscripten_tls_init"]=function(){return(_emscripten_tls_init=Module["_emscripten_tls_init"]=Module["asm"]["Da"]).apply(null,arguments)};var dynCall_ii=Module["dynCall_ii"]=function(){return(dynCall_ii=Module["dynCall_ii"]=Module["asm"]["Ea"]).apply(null,arguments)};var dynCall_v=Module["dynCall_v"]=function(){return(dynCall_v=Module["dynCall_v"]=Module["asm"]["Fa"]).apply(null,arguments)};var dynCall_vi=Module["dynCall_vi"]=function(){return(dynCall_vi=Module["dynCall_vi"]=Module["asm"]["Ga"]).apply(null,arguments)};var _asyncify_start_unwind=Module["_asyncify_start_unwind"]=function(){return(_asyncify_start_unwind=Module["_asyncify_start_unwind"]=Module["asm"]["Ha"]).apply(null,arguments)};var _asyncify_stop_unwind=Module["_asyncify_stop_unwind"]=function(){return(_asyncify_stop_unwind=Module["_asyncify_stop_unwind"]=Module["asm"]["Ia"]).apply(null,arguments)};var _asyncify_start_rewind=Module["_asyncify_start_rewind"]=function(){return(_asyncify_start_rewind=Module["_asyncify_start_rewind"]=Module["asm"]["Ja"]).apply(null,arguments)};var _asyncify_stop_rewind=Module["_asyncify_stop_rewind"]=function(){return(_asyncify_stop_rewind=Module["_asyncify_stop_rewind"]=Module["asm"]["Ka"]).apply(null,arguments)};Module["_ff_h264_cabac_tables"]=130841;Module["UTF8ToString"]=UTF8ToString;Module["PThread"]=PThread;Module["allocateUTF8"]=allocateUTF8;Module["PThread"]=PThread;Module["_pthread_self"]=_pthread_self;Module["wasmMemory"]=wasmMemory;Module["ExitStatus"]=ExitStatus;var calledRun;function ExitStatus(status){this.name="ExitStatus";this.message="Program terminated with exit("+status+")";this.status=status}dependenciesFulfilled=function runCaller(){if(!calledRun)run();if(!calledRun)dependenciesFulfilled=runCaller};function run(args){args=args||arguments_;if(runDependencies>0){return}preRun();if(runDependencies>0)return;function doRun(){if(calledRun)return;calledRun=true;Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();readyPromiseResolve(Module);if(Module["onRuntimeInitialized"])Module["onRuntimeInitialized"]();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(function(){setTimeout(function(){Module["setStatus"]("")},1);doRun()},1)}else{doRun()}}Module["run"]=run;if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}if(!ENVIRONMENT_IS_PTHREAD)noExitRuntime=true;if(!ENVIRONMENT_IS_PTHREAD){run()}else{readyPromiseResolve(Module)}\n\n\n  return __Decoder.ready\n}\n);\n})();\nif (typeof exports === \'object\' && typeof module === \'object\')\n      module.exports = __Decoder;\n    else if (typeof define === \'function\' && define[\'amd\'])\n      define([], function() { return __Decoder; });\n    else if (typeof exports === \'object\')\n      exports["__Decoder"] = __Decoder;\n    '},function(e,t){e.exports='var threadInfoStruct=0;var selfThreadId=0;var parentThreadId=0;var Module={};function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:selfThreadId})}var err=threadPrintErr;this.alert=threadAlert;Module["instantiateWasm"]=function(info,receiveInstance){var instance=new WebAssembly.Instance(Module["wasmModule"],info);Module["wasmModule"]=null;receiveInstance(instance);return instance.exports};this.onmessage=function(e){try{if(e.data.cmd==="load"){Module["DYNAMIC_BASE"]=e.data.DYNAMIC_BASE;Module["DYNAMICTOP_PTR"]=e.data.DYNAMICTOP_PTR;Module["wasmModule"]=e.data.wasmModule;Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob==="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}__Decoder(Module).then(function(instance){Module=instance;postMessage({"cmd":"loaded"})})}else if(e.data.cmd==="objectTransfer"){Module["PThread"].receiveObjectTransfer(e.data)}else if(e.data.cmd==="run"){Module["__performance_now_clock_drift"]=performance.now()-e.data.time;threadInfoStruct=e.data.threadInfoStruct;Module["registerPthreadPtr"](threadInfoStruct,0,0);selfThreadId=e.data.selfThreadId;parentThreadId=e.data.parentThreadId;var max=e.data.stackBase;var top=e.data.stackBase+e.data.stackSize;Module["establishStackSpace"](top,max);Module["_emscripten_tls_init"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].setThreadStatus(Module["_pthread_self"](),1);try{var result=Module["dynCall_ii"](e.data.start_routine,e.data.arg);if(!Module["getNoExitRuntime"]())Module["PThread"].threadExit(result)}catch(ex){if(ex==="Canceled!"){Module["PThread"].threadCancel()}else if(ex!="unwind"){Atomics.store(Module["HEAPU32"],threadInfoStruct+4>>2,ex instanceof Module["ExitStatus"]?ex.status:-2);Atomics.store(Module["HEAPU32"],threadInfoStruct+0>>2,1);Module["_emscripten_futex_wake"](threadInfoStruct+0,2147483647);if(!(ex instanceof Module["ExitStatus"]))throw ex}}}else if(e.data.cmd==="cancel"){if(threadInfoStruct){Module["PThread"].threadCancel()}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processThreadQueue"){if(threadInfoStruct){Module["_emscripten_current_thread_process_queued_calls"]()}}else{err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){err("worker.js onmessage() captured an uncaught exception: "+ex);if(ex.stack)err(ex.stack);throw ex}};\n'},function(e,t,r){e.exports=r(77)},function(e,t){e.exports=r("db265")},function(e,t,r){e.exports=r(79)},function(e,t){e.exports=r("1cce9")}],a={},n.m=i,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15))},"9b5d6":function(e,t,r){"use strict";var n=r("41571"),i=r("c9415"),a=r("48936"),o=r("097de");function s(e){this.defaults=e,this.interceptors={request:new a,response:new a}}s.prototype.request=function(e){"string"==typeof e&&(e=i.merge({url:arguments[0]},arguments[1])),(e=i.merge(n,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var t=[o,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},i.forEach(["delete","get","head","options"],function(r){s.prototype[r]=function(e,t){return this.request(i.merge(t||{},{method:r,url:e}))}}),i.forEach(["post","put","patch"],function(n){s.prototype[n]=function(e,t,r){return this.request(i.merge(r||{},{method:n,url:e,data:t}))}}),e.exports=s},"9b638":function(e,t){e.exports=playerSDK2da5b1f3a3deccaa435b},"9ebb9":function(e,t,r){"use strict";var i=r("c9415");function a(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var n,t=r?r(t):i.isURLSearchParams(t)?t.toString():(n=[],i.forEach(t,function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),n.push(a(t)+"="+a(e))}))}),n.join("&"));return t&&(e+=(-1===e.indexOf("?")?"?":"&")+t),e}},"9faa2":function(e,t,r){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},"9ffc5":function(e,t,r){"use strict";e.exports=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e}},a63b0:function(e,t,r){e.exports=r("9b638")("a63b0")},a9aad:function(e,t,r){e.exports={videoContainer:"_3ZYUK0Gs39NKdRXHu7ok_k",video:"_2HUt2doZ86wOVgnO3O641n",screenshot:"jQtGHdq7S8qaVOaYlmyW5",mask1:"_1DuJNXB5Do4tFJDnNBIwl1",autoPlayImg:"LHL5lhn1jBO4lxwZJZ9ji",jumpdetail:"_20JhvNfhXCfurtEh1iGaxV"}},b76a7:function(e,t,r){"use strict";var s=r("c9415");e.exports=s.isStandardBrowserEnv()?{write:function(e,t,r,n,i,a){var o=[];o.push(e+"="+encodeURIComponent(t)),s.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),s.isString(n)&&o.push("path="+n),s.isString(i)&&o.push("domain="+i),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){e=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},c7646:function(e,t,r){"use strict";var i=r("c9415");e.exports=function(r,n){i.forEach(r,function(e,t){t!==n&&t.toUpperCase()===n.toUpperCase()&&(r[n]=e,delete r[t])})}},c9415:function(e,t,r){"use strict";var i=r("63e3f"),r=r("7436c"),n=Object.prototype.toString;function a(e){return"[object Array]"===n.call(e)}function o(e){return null!==e&&"object"==typeof e}function s(e){return"[object Function]"===n.call(e)}function u(e,t){if(null!=e)if(a(e="object"!=typeof e?[e]:e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:a,isArrayBuffer:function(e){return"[object ArrayBuffer]"===n.call(e)},isBuffer:r,isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===n.call(e)},isFile:function(e){return"[object File]"===n.call(e)},isBlob:function(e){return"[object Blob]"===n.call(e)},isFunction:s,isStream:function(e){return o(e)&&s(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function r(){var n={};function e(e,t){"object"==typeof n[t]&&"object"==typeof e?n[t]=r(n[t],e):n[t]=e}for(var t=0,i=arguments.length;t<i;t++)u(arguments[t],e);return n},extend:function(r,e,n){return u(e,function(e,t){r[t]=n&&"function"==typeof e?i(e,n):e}),r},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},d1a6f:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var a=r("51bc5"),o={},n={on:function(e,t){var r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).once;e&&(o[e]||(o[e]=[]),o[e].push({listener:t,once:r}))},off:function(e,t){o[e]&&(o[e]=o[e].filter(function(e){return e.listener!==t}))},once:function(e,t){this.on(e,t,{once:!0})},emit:function(r){for(var n=this,e=arguments.length,i=Array(1<e?e-1:0),t=1;t<e;t++)i[t-1]=arguments[t];o[r]&&o[r].every(function(e){if(e.listener)try{var t=e.listener.apply(null,i);return e.once&&n.off(r,e.listener),!t}catch(e){a.a.warn("Event emit error",r,e)}return!0})},clear:function(){o={}}}},d3043:function(e,t,r){"use strict";var a=r("9ffc5");e.exports=function(e,t,r,n,i){e=new Error(e);return a(e,t,r,n,i)}},d30de:function(e,t,r){"use strict";r.d(t,"j",function(){return n}),r.d(t,"i",function(){return i}),r.d(t,"h",function(){return a}),r.d(t,"k",function(){return o}),r.d(t,"d",function(){return s}),r.d(t,"e",function(){return u}),r.d(t,"a",function(){return c}),r.d(t,"b",function(){return d}),r.d(t,"c",function(){return l}),r.d(t,"g",function(){return h}),r.d(t,"f",function(){return p});var n=221052005,i="2",a="Douyu_"+n,o="__video2",s="__canvas2",u=0,c="/lapi/live/getH5Play",d="/gapi/live/web/super/stream",l="/gapi/live/ticket/getH5Play",h={QQ:"tct-h5",WS:"ws-h5",XY:"xy-h5",DOUYU:"dyp2p"},p="errlog_encrypt_error"},db265:function(e,t){e.exports="https://shark2.douyucdn.cn/front-publish/live-master/assets/wasm/777ffd0edc470e85cc606d45b8d634e0_3ed08ab.wasm"},e55c4:function(e,t,r){e.exports=r("9b638")("e55c4")},f8ab5:function(e,t,r){e.exports={videoContainer:"_1GyzL9trVIbYlAVmuA9KJ1",video:"_3kBBGV3-d-EIxmN6JRZPar",screenshot:"_1Osm4fzGmcuRK9M8IVy3u6"}}});
