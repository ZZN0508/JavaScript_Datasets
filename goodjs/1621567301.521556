(window.shark_room_jsonp=window.shark_room_jsonp||[]).push([["vendors~DoublePlayer_b6206f6"],{"2df4fb":function(e,t,r){e.exports=r("77c2c1")},391742:function(e,t,r){"use strict";r.d(t,"VERSION",function(){return n}),r.d(t,"SERVER_VERSION",function(){return i});var n="220042917",i="20180222"},"3d8740":function(e,t,r){"use strict";var n=!1;function customize(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var o=["[html5 player]"].concat(r.map(function(e){return"["+e+"]"}));return function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];n&&e.call.apply(e,[console].concat(o,r))}}t.default=function makeLogger(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return{log:customize.apply(void 0,[console.log].concat(t)),debug:customize.apply(void 0,[console.debug].concat(t)),info:customize.apply(void 0,[console.info].concat(t)),warn:customize.apply(void 0,[console.warn].concat(t)),error:customize.apply(void 0,[console.error].concat(t))}}("first")},"48f9fd":function(e,t,r){"use strict";e.exports=function isObject(e){return null!=e&&"object"===typeof e&&!1===Array.isArray(e)}},"58608f":function(e,t,r){"use strict";r.d(t,"makeLogger",function(){return makeLogger});var n=!1;function customize(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var o=["[html5 player]"].concat(r.map(function(e){return"["+e+"]"}));return function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];n&&e.call.apply(e,[console].concat(o,r))}}function makeLogger(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return{log:customize.apply(void 0,[console.log].concat(t)),debug:customize.apply(void 0,[console.debug].concat(t)),info:customize.apply(void 0,[console.info].concat(t)),warn:customize.apply(void 0,[console.warn].concat(t)),error:customize.apply(void 0,[console.error].concat(t))}}t.default=makeLogger()},"6e4ceb":function(e,t,r){"use strict";r.d(t,"bindAll",function(){return bindAll}),r.d(t,"callLater",function(){return callLater}),r.d(t,"setAuth",function(){return setAuth}),r.d(t,"setDid",function(){return setDid}),r.d(t,"getDid",function(){return getDid}),r.d(t,"setRid",function(){return setRid}),r.d(t,"getRid",function(){return getRid}),r.d(t,"setfrom",function(){return setfrom}),r.d(t,"setAid",function(){return setAid}),r.d(t,"httpClientLoadStremUrl",function(){return httpClientLoadStremUrl}),r.d(t,"httpClientLoadTicrtStremUrl",function(){return httpClientLoadTicrtStremUrl});var n=r("eb3e22"),i=r("ab02b7"),o=r("6f9279");function bindAll(e,t){void 0===t&&(t=Object.getPrototypeOf(e)),Object.getOwnPropertyNames(t).forEach(function(t){var r=e[t];"function"===typeof r&&(e[t]=r.bind(e))})}function callLater(e){setTimeout(e,0)}function setAuth(e){e}var a=void 0;function setDid(e){a=e}function getDid(){return a}var s=void 0;function setRid(e){s=e}function getRid(){return s}var u="";function setfrom(e){u=e}var c="";function setAid(e){c=e}var d="streamSdk20200804b";function httpClientLoadStremUrl(e,t){var r="cdn=undefined&rate=-1&ver="+d+"&iar=1&ive=0&"+e+"&sov=1&tt="+t+"&did="+a+"&from="+u+"&aid="+c;Promise.resolve().then(function(){return n.httpClient.post(String,"/lapi/live/getH5Play/"+s,r,{withCredentials:!0}).subscribe(function(e){e.error;i.EventBus.emit("streamdata",e);try{var t=JSON.parse(e.data);if(console.log("\u6570\u636e2"),t.eticket&&3===+t.eticket.payment_mode)Object(o.default)(1);else{var r=t.rtmp_url+"/"+t.rtmp_live;i.EventBus.emit("playURL",r)}}catch(e){}})}).catch(function(e){i.EventBus.emit("streamdata",{error:-2e3})})}function httpClientLoadTicrtStremUrl(e,t){var r="cdn=undefined&rate=-1&iar=1&ver="+d+"&"+e+"&sov=1&tt="+t+"&did="+a;console.log("\u5f00\u59cb\u8bf7\u6c42\u95e8\u7968\u6d41\u5730\u5740"),Promise.resolve().then(function(){return n.httpClient.post(String,"/gapi/live/ticket/getH5Play/"+s,r,{withCredentials:!0}).subscribe(function(e){e.error;i.EventBus.emit("streamTicktdata",e);try{var t=JSON.parse(e.data),r=t.rtmp_url+"/"+t.rtmp_live;console.log("\u95e8\u7968\u6d41\u5730\u5740"),i.EventBus.emit("playURL",r)}catch(e){}})}).catch(function(e){i.EventBus.emit("streamdata",{error:-2e3})})}},"6f9279":function(e,t,r){"use strict";r.d(t,"default",function(){return StreamEncode});var n=r("ab02b7"),i=r("6e4ceb"),o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=void 0;function CSQSModuleHandle(e){console.log("smurf begin"),console.log("Client cfg version: %d",a.cr()),console.log("Client trivial ability: %d",a.tr());var t=Object(i.getRid)(),r=(new Date).getTime(),o=r.toString(16),s=parseInt("0x"+o.substring(0,o.length-8),16),u=parseInt("0x"+o.substring(o.length-8,o.length),16),c=Object(i.getDid)()||"",d=Number(new Date),l=a.sqs(t,s,u,c,"201806211659380f83e682207dd1293cea68f98662b1660083967948219fe20",3186),f=Number(new Date);console.log("QS[%d]: %s",f-d,l),console.log("smurf end"),n.EventBus.emit("encryptionOK",{qs:l,t1:r,type:e})}function StreamEncode(e){a?CSQSModuleHandle(e):"object"!==("undefined"===typeof WebAssembly?"undefined":o(WebAssembly))?r.e("vendors~aanode.js").then(r.t.bind(null,"910950",7)).then(function(t){t.default().then(function(t){a=t,CSQSModuleHandle(e)})}):r.e("vendors~wanode.js").then(r.t.bind(null,"b0c190",7)).then(function(t){t.default().then(function(t){a=t,CSQSModuleHandle(e)})})}},"77c2c1":function(e,t,r){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=13)}([function(e,t,r){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var i=!1;function setEnable(e){i=e}function customize(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=n(["[html5 player]","[dylive]"],t.map(function(e){return"["+e+"]"}));return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];i&&e.call.apply(e,n([console],o,t))}}function makeLogger(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{log:customize.apply(void 0,n([console.log],e)),debug:customize.apply(void 0,n([console.debug],e)),info:customize.apply(void 0,n([console.info],e)),warn:customize.apply(void 0,n([console.warn],e)),error:customize.apply(void 0,n([console.error],e)),setEnable:setEnable}}t.makeLogger=makeLogger,t.default=makeLogger()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindAll=function bindAll(e){for(var t=e,r={};e&&e!==Object.prototype;)Object.getOwnPropertyNames(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);if(i){if(i.get||i.set)return;"function"===typeof t[n]&&(r[n]=!0)}}),e=Object.getPrototypeOf(e);Object.keys(r).forEach(function(e){t[e]=t[e].bind(t)})}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function DyNetworkError(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.name=DyNetworkError.NAME,n}return i(DyNetworkError,e),DyNetworkError.NAME="DyNetworkError",DyNetworkError}(Error);t.DyNetworkError=o;var a=function(e){function DyMediaError(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n.name=DyMediaError.NAME,n}return i(DyMediaError,e),DyMediaError.NAME="DyMediaError",DyMediaError}(Error);t.DyMediaError=a;var s=function(e){function DyDemuxError(t,r){var n=e.call(this,t)||this;return n.errorId=0,n.name=DyDemuxError.NAME,n.errorId=r,n}return i(DyDemuxError,e),DyDemuxError.NAME="DyDemuxError",DyDemuxError}(Error);t.DyDemuxError=s},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(20));t.isBufferEqual=function isBufferEqual(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0},t.deepClone=function deepClone(e){return JSON.parse(JSON.stringify(e))},t.u8aClone=function u8aClone(e){var t=new Uint8Array(e.byteLength);return t.set(e,0),t},t.timescaledTime=function timescaledTime(e,t){return Math.floor(e*t/1e3)},t.timescaledTime64=function timescaledTime64(e,t){return i.default.fromNumber(e/1e3*t,!0)},t.bufferConcat=function bufferConcat(e){var t=e.reduce(function(e,t){return e+t.length},0),r=new Uint8Array(t),n=0;return e.forEach(function(e){r.set(e,n),n+=e.length}),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=function(){function BaseLoader(){this._loaderBytes=0,this._destroyed=!1,n.bindAll(this)}return Object.defineProperty(BaseLoader.prototype,"url",{get:function get(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(BaseLoader.prototype,"redirectUrl",{get:function get(){return this._redirectUrl},enumerable:!0,configurable:!0}),BaseLoader.prototype.load=function(e,t){this._loaderBytes=0,this._url=e},BaseLoader.prototype.dispose=function(){this._destroyed=!0,this.onData=null,this.onEnd=null,this.onError=null},BaseLoader.prototype.getStatistics=function(){return{loaderBytes:this._loaderBytes,cdnBytes:this._loaderBytes,p2pBytes:0,totalDropBytes:0}},BaseLoader.prototype._onData=function(e){e&&(e instanceof ArrayBuffer?this._loaderBytes+=e.byteLength:this._loaderBytes+=e.data.byteLength,this.onData&&this.onData(e))},BaseLoader.prototype._onRedirectUrl=function(e){this._redirectUrl=e},BaseLoader.prototype._onError=function(e){this.onError&&this.onError(e)},BaseLoader}();t.BaseLoader=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};!function detect(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""},o={};if(i.browser){o[i.browser]=!0;var a=i.majorVersion.split(".");o.version={major:parseInt(i.majorVersion,10),string:i.version},a.length>1&&(o.version.minor=parseInt(a[1],10)),a.length>2&&(o.version.build=parseInt(a[2],10))}i.platform&&(o[i.platform]=!0),(o.chrome||o.opr||o.safari)&&(o.webkit=!0),(o.rv||o.iemobile)&&(o.rv&&delete o.rv,i.browser="msie",o.msie=!0);o.edge&&(delete o.edge,i.browser="msedge",o.msedge=!0);o.opr&&(i.browser="opera",o.opera=!0);o.safari&&o.android&&(i.browser="android",o.android=!0);for(var s in o.name=i.browser,o.platform=i.platform,n)n.hasOwnProperty(s)&&delete n[s];Object.assign(n,o)}(),t.default=n},function(e,t){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function assign(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}return r},writable:!0,configurable:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4);t.BaseLoader=n.BaseLoader;var i=r(16);t.FetchStreamLoader=i.FetchStreamLoader;var o=r(17);t.MozChunkedLoader=o.MozChunkedLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(6);var n=r(1),i=r(3),o=r(21),a=r(12),s=r(0).makeLogger("tranmuxer-worker"),u=function(){function TransmuxerWorker(){this.destroyed=!1,n.bindAll(this),self.window||(self.onmessage=this._onMessage,self.onerror=this._onError)}return TransmuxerWorker.prototype.init=function(e){this._demux=o.createDemuxer(e.format,e),this._demux?(this._remux=a.createRemuxer(e.outputFormat,e),this._remux?(this._remux.onData=this._onRemuxData,this._demux.pipe(this._remux).catch(this._onError)):this._onError("unsupport remux format: "+e.format)):this._onError("unsupport demxu format: "+e.format)},TransmuxerWorker.prototype.dispose=function(){this.destroyed=!0,this._demux&&(this._demux.dispose(),this._demux=null),this._remux&&(this._remux.dispose(),this._remux=null)},TransmuxerWorker.prototype.appendData=function(e){this.destroyed||this._demux.append(e)},TransmuxerWorker.prototype.appendEnd=function(){this.destroyed||this._demux.append("end")},TransmuxerWorker.prototype.firstFrame=function(){this.destroyed||this._demux.append("firstFrame")},TransmuxerWorker.prototype._dispatchMessage=function(e,t){self.postMessage(e,t)},TransmuxerWorker.prototype._onRemuxData=function(e){var t=[];e.data&&t.push(e.data.buffer),this._dispatchMessage({name:"_onRemuxData",params:e},t)},TransmuxerWorker.prototype.setLoggerEnable=function(e){s.setEnable(e)},TransmuxerWorker.prototype._onError=function(e){this._dispatchMessage({name:"_onError",params:i.deepClone(e)}),this.dispose()},TransmuxerWorker.prototype._onMessage=function(e){var t=e.data,r=t.name,n=t.params;try{switch(r){case"init":this.init(n);break;case"appendData":this.appendData(n);break;case"appendEnd":this.appendEnd();break;case"firstFrame":this.firstFrame();break;case"setLoggerEnable":this.setLoggerEnable(n);break;default:s.warn("unknown function: transmuxer."+r)}}catch(e){s.warn("call transmuxer worker "+r+" error",e)}},TransmuxerWorker}();t.default=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),a=r(0),s=r(22),u=a.makeLogger("demuxer"),c=function(e){function Demuxer(t){var r=e.call(this)||this;return r._trackConfigs={},r._lastTracks={},r._hasFirstFrame=!1,r._trackLength=2,r._pendingExtradata={},r._audioGapThresholdMs=50,r._audioGapWarningTimes=0,r._config=t,!1!==t.hasAudio&&!1!==t.hasVideo||(r._trackLength=1),r}return i(Demuxer,e),Demuxer.prototype.dispose=function(){e.prototype.dispose.call(this),this._config=void 0,this._trackConfigs=void 0,this._lastTracks=void 0},Demuxer.prototype.append=function(e){e instanceof ArrayBuffer?this._appendArrayBuffer(e):e.type?this._appendTrack(e):"end"===e?this._appendEnd():"firstFrame"===e?this._hasFirstFrame=!0:u.warn("unknown append data: ",e)},Demuxer.prototype._appendArrayBuffer=function(e){},Demuxer.prototype._appendTrack=function(e){if("audio"===e.type||"video"===e.type){if(("audio"!==e.type||!1!==this._config.hasAudio)&&("video"!==e.type||!1!==this._config.hasVideo)){var t=this._lastTracks[e.trackId];t&&"CFG"!==e.flag&&t.dts-e.dts>5&&u.warn("Dts error: "+e.type+" track dts rollback, last="+t.dts+", now="+e.dts+", delta="+(e.dts-t.dts)),e.trackLength&&(this._trackLength=e.trackLength),e.trackLength=this._trackLength,e.extradata||(e.extradata={});var r=e.config||this._trackConfigs[e.trackId];if(!r){if(!(r=this._generateTrackConfig(e.type)))return void u.warn("unable to generate track config, type="+e.type);r.trackId=e.trackId}if(r.mimeType||"CFG"===e.flag){if(e.config=this._trackConfigs[e.trackId]=r,e.data){var n=e.codec,i=s.getParser(n);if(!i)return void u.warn("unsupport codec: "+n);if("CFG"===e.flag){if(r.bytes=e.data,0!==i.parseConfig(r))return void u.warn("parse "+n+" config error");"audio"===e.type&&(r.timescale=r.audioSampleRate)}else if(0!==i.parseData(e))return void u.warn("parse "+n+" data error")}return Object.keys(this._pendingExtradata).length>0&&(Object.assign(e.extradata,this._pendingExtradata),this._pendingExtradata={}),this._audioGapDetect(e),this._lastTracks[e.trackId]=e,this.onData(e),!0}u.warn("first track is not cfg, ignore: trackId="+e.trackId+", type="+e.type+", dts="+e.dts+", pts="+e.pts)}}else u.warn("unknown track type="+e.type)},Demuxer.prototype._appendEnd=function(){var e=this;Object.keys(this._trackConfigs).forEach(function(t){var r=e._trackConfigs[t],n=e._lastTracks[t];e._appendTrack({type:r.type,trackId:r.trackId,dts:Math.floor(n.dts+r.refSampleDuration),pts:Math.floor(n.pts+r.refSampleDuration),codec:n.codec,config:r,isEnd:!0,extradata:{}})})},Demuxer.prototype._generateTrackConfig=function(e){return"audio"===e?{type:"audio",trackId:1,detailCodec:"",timescale:9e4,duration:0,refSampleDuration:0,bytes:void 0,mimeType:"",channelCount:0,audioSampleRate:0}:"video"===e?{type:"video",trackId:2,detailCodec:"",timescale:9e4,duration:0,refSampleDuration:0,bytes:void 0,mimeType:"",presentWidth:0,presentHeight:0,codecWidth:0,codecHeight:0}:null},Demuxer.prototype._audioGapDetect=function(e){if(this._audioGapWarningTimes<10&&"audio"===e.type&&e.data&&"CFG"!==e.flag){var t=this._lastTracks[e.trackId];if(t&&"CFG"!==t.flag&&t.data&&t.dts===e.dts)return;if(void 0===this._audioExpectMs)this._audioExpectMs=e.dts;else{var r=Math.floor(1e3*this._audioExpectMs),n=1e3*e.dts-r,i=Math.floor(Math.abs(n)/1e3);i>this._audioGapThresholdMs&&(this._audioGapWarningTimes++,u.warn("Large timestamp gap detected; may cause AV sync to drift. time:"+1e3*e.dts+"us expected:"+r+"us delta:"+n+"us"),this._audioGapWarningTimes>=10&&u.warn("Large timestamp gap detected Log limit reached. Further similar entries may be suppressed"),this._audioGapThresholdMs=i)}this._audioExpectMs+=e.config.refSampleDuration}},Demuxer}(o.BaseStream);t.Demuxer=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=function(){function BaseStream(){n.bindAll(this)}return BaseStream.prototype.dispose=function(){this.onData=null,this.onError=null},BaseStream.prototype.error=function(e){this.onError(e),this.dispose()},BaseStream.prototype.catch=function(e){this.onError=e},BaseStream.prototype.pipe=function(e){return this.onData=e.append,this.onError=e.error,e},BaseStream}();t.BaseStream=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.H264_SEI="H264_SEI",e.AAC_FIL="AAC_FIL",e.EXTRA_DATA="EXTRA_DATA"}(t.TimeDispatchType||(t.TimeDispatchType={})),function(e){e.H264="h264",e.AAC="aac",e.MP3="mp3"}(t.Codec||(t.Codec={}))},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(34);t.Remuxer=i.Remuxer;var o=n(r(35));t.createRemuxer=function createRemuxer(e,t){return"mp4"===e?new o.default(t):"raw"===e?new i.Remuxer(t):null}},function(e,t,r){"use strict";function __export(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),__export(r(14)),__export(r(2)),__export(r(7))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});Object.defineProperty(t,"__esModule",{value:!0}),r(6);var o=r(15),a=r(1),s=r(7),u=r(18),c=r(2),d=r(38),l=r(11),f=r(39),h=r(0).makeLogger("live-player");t.PlayerEvents={ON_MEDIA_INFO:"mediaInfo",ON_FIRST_FRAME:"firstFrame",ON_ERROR:"player_error",ON_SEI:"sei",ON_LOAD_SEI:"loadSei",ON_AAC_DATA:"aacData",ON_EXTRA_DATA_LOAD:"extra_data_load",ON_EXTRA_DATA_PLAY:"extra_data_play"};var p={url:"",format:"flv",outputFormat:"mp4",enableWorker:!0,debug:!1,stashBuffer:65536,stashTime:200,videoBackTime:10,videoBackTimeThreshold:15,enableJitterBuffer:!1,minBuffer:2,maxBuffer:6,slowRate:.95,fastRate:1.05,audioDurationThreshold:200,videoDurationThreshold:100},_=function(e){function LivePlayer(t){var r=e.call(this)||this;return r._destroyed=!1,r._isFirstFrameEmitted=!1,a.bindAll(r),r._config=Object.assign({},p,t),h.setEnable(t.debug),r._config.loader?r._loader=r._config.loader:s.FetchStreamLoader.isSupported()?r._loader=new s.FetchStreamLoader:s.MozChunkedLoader.isSupported()&&(r._loader=new s.MozChunkedLoader),r._loader?(r._timeDispatch=new d.TimeDispatch,r._timeDispatch.onSend=r._onTimeDispatch,r._mediaHandler=new f.ToMSE(r._config),r._mediaHandler.onHasKeyframe=r._onFirstFrame,r._mediaHandler.onExtraData=r._onExtraData,r._mediaHandler.onMediaInfo=r._onMediaInfo,r._mediaManager=new u.MediaManager(r._loader,r._mediaHandler,r._config),r._mediaManager.onError=r._onError,r._mediaManager.init(),h.log("init"),r):(setTimeout(function(){r._onError(new c.DyDemuxError("Do not has supported loader.",161))},0),r)}return i(LivePlayer,e),LivePlayer.prototype.dispose=function(){this._destroyed||(this.pause(),this.detach(),this._mediaManager&&(this._mediaManager.dispose(),this._mediaManager=null),this._loader&&(this._loader.dispose(),this._loader=null),this._mediaHandler&&(this._mediaHandler.dispose(),this._mediaHandler=null),this._timeDispatch&&(this._timeDispatch.destroy(),this._timeDispatch=null),this.removeAllListeners(),this._destroyed=!0,h.log("disposed"))},LivePlayer.prototype.load=function(){this._loader?(h.log("loading..."),this._loader.load(this._config.url)):h.warn("can't load because there is no available loader")},LivePlayer.prototype.attach=function(e){this._mediaHandler&&(this._mediaHandler.attach(e),this._timeDispatch.attach(e),this._video=e,this._video.addEventListener("loadedmetadata",this._onFirstFrameFromMeta),this._video.addEventListener("canplay",this._onCanplay))},LivePlayer.prototype.detach=function(){this._mediaHandler&&this._mediaHandler.detach(),this._timeDispatch&&this._timeDispatch.detach(),this._video&&(this._video.removeEventListener("loadedmetadata",this._onFirstFrameFromMeta),this._video.removeEventListener("canplay",this._onCanplay),this._video=null)},LivePlayer.prototype.play=function(){this._video&&this._video.play()},LivePlayer.prototype.pause=function(){this._video&&this._video.pause()},LivePlayer.prototype.getMediaInfo=function(){return this._mediaInfo},LivePlayer.prototype.getStatInfo=function(){var e={url:"",redirectedURL:"",loaderBytes:0,decodedFrames:0,droppedFrames:0,cdnBytes:0,p2pBytes:0,totalDropBytes:0};if(this._loader){e.url=this._loader.url,e.redirectedURL=this._loader.redirectUrl;var t=this._loader.getStatistics(),r=t.loaderBytes,n=t.cdnBytes,i=t.p2pBytes,o=t.totalDropBytes;e.loaderBytes=r,e.cdnBytes=n,e.p2pBytes=i,e.totalDropBytes=o||0}if(this._video)if("function"===typeof this._video.getVideoPlaybackQuality){var a=this._video.getVideoPlaybackQuality();e.decodedFrames=a.totalVideoFrames,e.droppedFrames=a.droppedVideoFrames}else void 0!==this._video.webkitDecodedFrameCount&&(e.decodedFrames=this._video.webkitDecodedFrameCount,e.droppedFrames=this._video.webkitDroppedFrameCount);return e},LivePlayer.prototype.T_ADV_Timestamp=function(){return this._mediaHandler instanceof f.ToMSE?this._mediaHandler.T_ADV_Timestamp():null},LivePlayer.prototype._onMediaInfo=function(e){h.log("onMediaInfo: ",e),this._mediaInfo=e,this.emit(t.PlayerEvents.ON_MEDIA_INFO,e)},LivePlayer.prototype._onFirstFrameFromMeta=function(){this._onFirstFrame("meta")},LivePlayer.prototype._onFirstFrame=function(e){void 0===e&&(e="keyframe"),this._isFirstFrameEmitted||(this._isFirstFrameEmitted=!0,this.emit(t.PlayerEvents.ON_FIRST_FRAME),h.log("first frame from "+e))},LivePlayer.prototype._onExtraData=function(e){"sei"===e.type?this._onSei(e.data):"aacfil"===e.type&&this._onAACData(e.data),this._timeDispatch.add({type:l.TimeDispatchType.EXTRA_DATA,ts:e.ts,data:e.data}),this.emit(t.PlayerEvents.ON_EXTRA_DATA_LOAD,e)},LivePlayer.prototype._onCanplay=function(){this._mediaManager.notify({type:"firstFrame"})},LivePlayer.prototype._onError=function(e){h.warn("player error: ",e),this.emit(t.PlayerEvents.ON_ERROR,e),this.dispose()},LivePlayer.prototype._onSei=function(e){this._timeDispatch.add({type:l.TimeDispatchType.H264_SEI,ts:e.seiTimestamp,data:e}),this.emit(t.PlayerEvents.ON_LOAD_SEI,e)},LivePlayer.prototype._onAACData=function(e){this.emit(t.PlayerEvents.ON_AAC_DATA,e.data)},LivePlayer.prototype._onTimeDispatch=function(e){switch(e.type){case l.TimeDispatchType.H264_SEI:this.emit(t.PlayerEvents.ON_SEI,e.data);break;case l.TimeDispatchType.EXTRA_DATA:this.emit(t.PlayerEvents.ON_EXTRA_DATA_PLAY,e.data)}},LivePlayer}(o.EventEmitter);t.LivePlayer=_},function(e,t,r){"use strict";var i,o="object"===("undefined"===typeof Reflect?"undefined":n(Reflect))?Reflect:null,a=o&&"function"===typeof o.apply?o.apply:function ReflectApply(e,t,r){return Function.prototype.apply.call(e,t,r)};i=o&&"function"===typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function ReflectOwnKeys(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function NumberIsNaN(e){return e!==e};function EventEmitter(){EventEmitter.init.call(this)}e.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var u=10;function checkListener(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+("undefined"===typeof e?"undefined":n(e)))}function _getMaxListeners(e){return void 0===e._maxListeners?EventEmitter.defaultMaxListeners:e._maxListeners}function _addListener(e,t,r,n){var i,o,a;if(checkListener(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"===typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=_getMaxListeners(e))>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,function ProcessEmitWarning(e){console&&console.warn&&console.warn(e)}(s)}return e}function _onceWrap(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(n);return i.listener=r,n.wrapFn=i,i}function _listeners(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"===typeof i?r?[i.listener||i]:[i]:r?function unwrapListeners(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):arrayClone(i,i.length)}function listenerCount(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"===typeof r)return 1;if(void 0!==r)return r.length}return 0}function arrayClone(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function get(){return u},set:function set(e){if("number"!==typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(e){if("number"!==typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function emit(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var u=i[e];if(void 0===u)return!1;if("function"===typeof u)a(u,this,t);else{var c=u.length,d=arrayClone(u,c);for(r=0;r<c;++r)a(d[r],this,t)}return!0},EventEmitter.prototype.addListener=function addListener(e,t){return _addListener(this,e,t,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(e,t){return _addListener(this,e,t,!0)},EventEmitter.prototype.once=function once(e,t){return checkListener(t),this.on(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(e,t){return checkListener(t),this.prependListener(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.removeListener=function removeListener(e,t){var r,n,i,o,a;if(checkListener(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!==typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function spliceOne(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},EventEmitter.prototype.listeners=function listeners(e){return _listeners(this,e,!0)},EventEmitter.prototype.rawListeners=function rawListeners(e){return _listeners(this,e,!1)},EventEmitter.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):listenerCount.call(e,t)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?i(this._events):[]}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),s=r(2),u=o(r(5)),c=function(e){function FetchStreamLoader(){return null!==e&&e.apply(this,arguments)||this}return i(FetchStreamLoader,e),FetchStreamLoader.isSupported=function(){try{var e=u.default.msedge&&u.default.version.minor>=15048,t=!u.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}},FetchStreamLoader.prototype.load=function(t,r){var n=this;e.prototype.load.call(this,t,r),fetch(t).then(function(e){if(e&&e.ok)return t!==e.url&&n._onRedirectUrl(e.url),e.body.getReader();throw e?new s.DyNetworkError("fetch stream failed: "+e.status+" "+e.statusText):new s.DyNetworkError("fetch stream failed: no response, maybe blocked.")}).then(function(e){if(n._reader=e,n._destroyed)n.dispose();else{e.read().then(function onRead(t){var r=t.done,i=t.value;r?n.onEnd&&n.onEnd():(n._onData(i.buffer),e.read().then(onRead).catch(n._onError))}).catch(n._onError)}}).catch(function(e){e&&11===e.code&&u.default.msedge||n._onError(new s.DyNetworkError("fetch stream failed: "+e))})},FetchStreamLoader.prototype.dispose=function(){this._reader&&(this._reader.cancel().catch(function(e){}),this._reader=null),e.prototype.dispose.call(this)},FetchStreamLoader}(a.BaseLoader);t.FetchStreamLoader=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),a=r(2),s=function(e){function MozChunkedLoader(){var t=e.call(this)||this;return t._xhr=null,t._requestAbort=!1,t}return i(MozChunkedLoader,e),MozChunkedLoader.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return!1}},MozChunkedLoader.prototype.load=function(e,t){this._requestURL=e;var r=this._xhr=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="moz-chunked-arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onloadend=this._onLoadEnd.bind(this),r.onerror=this._onXhrError.bind(this),r.send()},MozChunkedLoader.prototype.dispose=function(){this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),e.prototype.dispose.call(this)},MozChunkedLoader.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort()},MozChunkedLoader.prototype._onReadyStateChange=function(e){var t=e.target;2===t.readyState&&(void 0!=t.responseURL&&t.responseURL!==this._requestURL&&this._onRedirectUrl(t.responseURL),0!==t.status&&(t.status<200||t.status>299)&&this._onError(new a.DyNetworkError("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText)))},MozChunkedLoader.prototype._onProgress=function(e){var t=e.target.response;this._onData(t)},MozChunkedLoader.prototype._onLoadEnd=function(e){!0!==this._requestAbort?this.onEnd&&this.onEnd():this._requestAbort=!1},MozChunkedLoader.prototype._onXhrError=function(e){this._onError("xhr load exit")},MozChunkedLoader}(o.BaseLoader);t.MozChunkedLoader=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(19),o=r(3),a=r(0).makeLogger("media-manager"),s=function(){function MediaManager(e,t,o){n.bindAll(this),this._config=o;var s=o.enableWorker,u=o.debug;this._loader=e,this._loader.onData=this.appendData,this._loader.onEnd=this.appendEnd,this._loader.onError=this._onError,this._mediaHandler=t,this._mediaHandler.onError=this._onError,s?(this._transmuxer=r(37)(8),this._transmuxer.postMessage({name:"setLoggerEnable",params:u},void 0),a.log("transmuxe with worker")):(this._transmuxer=new i.Transmuxer,a.log("transmuxe with no worker")),this._transmuxer.onmessage=this._onMessage}return MediaManager.prototype.init=function(){this._transmuxer.postMessage({name:"init",params:o.deepClone(this._config)},void 0)},MediaManager.prototype.dispose=function(){this.onError=null,this._mediaHandler=null,this._loader=null,this._transmuxer.terminate(),this._transmuxer=null},MediaManager.prototype.appendData=function(e){if(e instanceof ArrayBuffer)this._transmuxer.postMessage({name:"appendData",params:e},[e]);else{var t=[];this._config.enableWorker&&e.data&&(e.data=o.u8aClone(e.data),t.push(e.data.buffer)),this._transmuxer.postMessage({name:"appendData",params:e},t)}},MediaManager.prototype.appendEnd=function(){a.log("loader end"),this._transmuxer.postMessage({name:"appendEnd"},void 0)},MediaManager.prototype.notify=function(e){var t=e.type;e.data;switch(t){case"firstFrame":this._transmuxer.postMessage({name:"firstFrame"},void 0)}},MediaManager.prototype._onRemuxData=function(e){this._mediaHandler&&this._mediaHandler.appendData(e)},MediaManager.prototype._onError=function(e){this.onError&&this.onError(e)},MediaManager.prototype._onMessage=function(e){var t=e.data,r=t.name,n=t.params;try{switch(r){case"_onRemuxData":this._onRemuxData(n);break;case"_onError":this._onError(n);break;default:a.warn("unknown function: "+r)}}catch(e){a.warn("call "+r+" error",e)}},MediaManager}();t.MediaManager=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(8)),s=(r(0).makeLogger("transmuxer"),function(e){function Transmuxer(){return null!==e&&e.apply(this,arguments)||this}return i(Transmuxer,e),Transmuxer.prototype.postMessage=function(e,t){this._onMessage({data:e})},Transmuxer.prototype.terminate=function(){e.prototype.dispose.call(this),this.onmessage=null},Transmuxer.prototype._dispatchMessage=function(e,t){this.onmessage&&this.onmessage({data:e})},Transmuxer}(a.default));t.Transmuxer=s},function(e,t){e.exports=Long;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function Long(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function isLong(e){return!0===(e&&e.__isLong__)}Long.prototype.__isLong__,Object.defineProperty(Long.prototype,"__isLong__",{value:!0}),Long.isLong=isLong;var n={},i={};function fromInt(e,t){var r,o,a;return t?(a=0<=(e>>>=0)&&e<256)&&(o=i[e])?o:(r=fromBits(e,(0|e)<0?-1:0,!0),a&&(i[e]=r),r):(a=-128<=(e|=0)&&e<128)&&(o=n[e])?o:(r=fromBits(e,e<0?-1:0,!1),a&&(n[e]=r),r)}function fromNumber(e,t){if(isNaN(e))return t?l:d;if(t){if(e<0)return l;if(e>=s)return y}else{if(e<=-u)return m;if(e+1>=u)return _}return e<0?fromNumber(-e,t).neg():fromBits(e%a|0,e/a|0,t)}function fromBits(e,t,r){return new Long(e,t,r)}Long.fromInt=fromInt,Long.fromNumber=fromNumber,Long.fromBits=fromBits;var o=Math.pow;function fromString(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return d;if("number"===typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return fromString(e.substring(1),t,r).neg();for(var i=fromNumber(o(r,8)),a=d,s=0;s<e.length;s+=8){var u=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+u),r);if(u<8){var l=fromNumber(o(r,u));a=a.mul(l).add(fromNumber(c))}else a=(a=a.mul(i)).add(fromNumber(c))}return a.unsigned=t,a}function fromValue(e,t){return"number"===typeof e?fromNumber(e,t):"string"===typeof e?fromString(e,t):fromBits(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}Long.fromString=fromString,Long.fromValue=fromValue;var a=4294967296,s=a*a,u=s/2,c=fromInt(1<<24),d=fromInt(0);Long.ZERO=d;var l=fromInt(0,!0);Long.UZERO=l;var f=fromInt(1);Long.ONE=f;var h=fromInt(1,!0);Long.UONE=h;var p=fromInt(-1);Long.NEG_ONE=p;var _=fromBits(-1,2147483647,!1);Long.MAX_VALUE=_;var y=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=y;var m=fromBits(0,-2147483648,!1);Long.MIN_VALUE=m;var g=Long.prototype;g.toInt=function toInt(){return this.unsigned?this.low>>>0:this.low},g.toNumber=function toNumber(){return this.unsigned?(this.high>>>0)*a+(this.low>>>0):this.high*a+(this.low>>>0)},g.toString=function toString(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(m)){var t=fromNumber(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=fromNumber(o(e,6),this.unsigned),a=this,s="";;){var u=a.div(i),c=(a.sub(u.mul(i)).toInt()>>>0).toString(e);if((a=u).isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}},g.getHighBits=function getHighBits(){return this.high},g.getHighBitsUnsigned=function getHighBitsUnsigned(){return this.high>>>0},g.getLowBits=function getLowBits(){return this.low},g.getLowBitsUnsigned=function getLowBitsUnsigned(){return this.low>>>0},g.getNumBitsAbs=function getNumBitsAbs(){if(this.isNegative())return this.eq(m)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},g.isZero=function isZero(){return 0===this.high&&0===this.low},g.eqz=g.isZero,g.isNegative=function isNegative(){return!this.unsigned&&this.high<0},g.isPositive=function isPositive(){return this.unsigned||this.high>=0},g.isOdd=function isOdd(){return 1===(1&this.low)},g.isEven=function isEven(){return 0===(1&this.low)},g.equals=function equals(e){return isLong(e)||(e=fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},g.eq=g.equals,g.notEquals=function notEquals(e){return!this.eq(e)},g.neq=g.notEquals,g.ne=g.notEquals,g.lessThan=function lessThan(e){return this.comp(e)<0},g.lt=g.lessThan,g.lessThanOrEqual=function lessThanOrEqual(e){return this.comp(e)<=0},g.lte=g.lessThanOrEqual,g.le=g.lessThanOrEqual,g.greaterThan=function greaterThan(e){return this.comp(e)>0},g.gt=g.greaterThan,g.greaterThanOrEqual=function greaterThanOrEqual(e){return this.comp(e)>=0},g.gte=g.greaterThanOrEqual,g.ge=g.greaterThanOrEqual,g.compare=function compare(e){if(isLong(e)||(e=fromValue(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},g.comp=g.compare,g.negate=function negate(){return!this.unsigned&&this.eq(m)?m:this.not().add(f)},g.neg=g.negate,g.add=function add(e){isLong(e)||(e=fromValue(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,o=e.high>>>16,a=65535&e.high,s=e.low>>>16,u=0,c=0,d=0,l=0;return d+=(l+=i+(65535&e.low))>>>16,c+=(d+=n+s)>>>16,u+=(c+=r+a)>>>16,u+=t+o,fromBits((d&=65535)<<16|(l&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},g.subtract=function subtract(e){return isLong(e)||(e=fromValue(e)),this.add(e.neg())},g.sub=g.subtract,g.multiply=function multiply(e){if(this.isZero())return d;if(isLong(e)||(e=fromValue(e)),r)return fromBits(r.mul(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned);if(e.isZero())return d;if(this.eq(m))return e.isOdd()?m:d;if(e.eq(m))return this.isOdd()?m:d;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(c)&&e.lt(c))return fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,a=e.high>>>16,s=65535&e.high,u=e.low>>>16,l=65535&e.low,f=0,h=0,p=0,_=0;return p+=(_+=o*l)>>>16,h+=(p+=i*l)>>>16,p&=65535,h+=(p+=o*u)>>>16,f+=(h+=n*l)>>>16,h&=65535,f+=(h+=i*u)>>>16,h&=65535,f+=(h+=o*s)>>>16,f+=t*l+n*u+i*s+o*a,fromBits((p&=65535)<<16|(_&=65535),(f&=65535)<<16|(h&=65535),this.unsigned)},g.mul=g.multiply,g.divide=function divide(e){if(isLong(e)||(e=fromValue(e)),e.isZero())throw Error("division by zero");var t,n,i;if(r)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?fromBits((this.unsigned?r.div_u:r.div_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?l:d;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return l;if(e.gt(this.shru(1)))return h;i=l}else{if(this.eq(m))return e.eq(f)||e.eq(p)?m:e.eq(m)?f:(t=this.shr(1).div(e).shl(1)).eq(d)?e.isNegative()?f:p:(n=this.sub(e.mul(t)),i=t.add(n.div(e)));else if(e.eq(m))return this.unsigned?l:d;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=d}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),s=a<=48?1:o(2,a-48),u=fromNumber(t),c=u.mul(e);c.isNegative()||c.gt(n);)c=(u=fromNumber(t-=s,this.unsigned)).mul(e);u.isZero()&&(u=f),i=i.add(u),n=n.sub(c)}return i},g.div=g.divide,g.modulo=function modulo(e){return isLong(e)||(e=fromValue(e)),r?fromBits((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},g.mod=g.modulo,g.rem=g.modulo,g.not=function not(){return fromBits(~this.low,~this.high,this.unsigned)},g.and=function and(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low&e.low,this.high&e.high,this.unsigned)},g.or=function or(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low|e.low,this.high|e.high,this.unsigned)},g.xor=function xor(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low^e.low,this.high^e.high,this.unsigned)},g.shiftLeft=function shiftLeft(e){return isLong(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fromBits(0,this.low<<e-32,this.unsigned)},g.shl=g.shiftLeft,g.shiftRight=function shiftRight(e){return isLong(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},g.shr=g.shiftRight,g.shiftRightUnsigned=function shiftRightUnsigned(e){if(isLong(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?fromBits(this.low>>>e|t<<32-e,t>>>e,this.unsigned):fromBits(32===e?t:t>>>e-32,0,this.unsigned)},g.shru=g.shiftRightUnsigned,g.shr_u=g.shiftRightUnsigned,g.toSigned=function toSigned(){return this.unsigned?fromBits(this.low,this.high,!1):this},g.toUnsigned=function toUnsigned(){return this.unsigned?this:fromBits(this.low,this.high,!0)},g.toBytes=function toBytes(e){return e?this.toBytesLE():this.toBytesBE()},g.toBytesLE=function toBytesLE(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},g.toBytesBE=function toBytesBE(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Long.fromBytes=function fromBytes(e,t,r){return r?Long.fromBytesLE(e,t):Long.fromBytesBE(e,t)},Long.fromBytesLE=function fromBytesLE(e,t){return new Long(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Long.fromBytesBE=function fromBytesBE(e,t){return new Long(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(9);t.Demuxer=i.Demuxer;var o=n(r(30));t.createDemuxer=function createDemuxer(e,t){return"flv"===e?new o.default(t):"raw"===e?new i.Demuxer(t):null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(23),i=r(25),o=r(29),a={};function registerParser(e){a[e.name]=e}t.registerParser=registerParser,t.getParser=function getParser(e){return a[e]},registerParser(i.h264),registerParser(n.aac),registerParser(o.mp3)},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=n(r(24)),a=n(r(5)),s=i.makeLogger("aac-parser"),u={mpegSamplingRates:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]};t.aac={name:"aac",parseConfig:function parseConfig(e){var t,r,n=e.bytes,i=0,o=null;if(i=n[0]>>>3,(r=(7&n[0])<<1|n[1]>>>7)<0||r>=u.mpegSamplingRates.length)return s.warn("AAC invalid sampling frequency index!"),-1;var a=u.mpegSamplingRates[r],c=(120&n[1])>>>3;if(c<0||c>=8)return s.warn("AAC invalid channel configuration"),-1;5===i&&(o=(7&n[1])<<1|n[2]>>>7,n[2]);var d=self.navigator.userAgent.toLowerCase();return-1!==d.indexOf("firefox")?r>=6?(i=5,t=new Array(4),o=r-3):(i=2,t=new Array(2),o=r):-1!==d.indexOf("android")?(i=2,t=new Array(2),o=r):(i=5,o=r,t=new Array(4),r>=6?o=r-3:1===c&&(i=2,t=new Array(2),o=r)),t[0]=i<<3,t[0]|=(15&r)>>>1,t[1]=(15&r)<<7,t[1]|=(15&c)<<3,5===i&&(t[1]|=(15&o)>>>1,t[2]=(1&o)<<7,t[2]|=8,t[3]=0),e.bytes=new Uint8Array(t),e.audioSampleRate=a,e.channelCount=c,e.detailCodec="mp4a.40."+i,e.refSampleDuration=1024/a*1e3,0},parseData:function parseData(e){var t=e.data;if(32===t.byteLength&&33===t[0]&&31===t[1]&&16===t[2])return s.warn("private aac data, ignore!"),delete e.data,-1;if(6===(t[0]>>5&7)){var r=o.default.getDbData(o.default.parseAacFilData(t));r&&(e.extradata.aacfil={aacTimestamp:e.dts,data:r},delete e.data),a.default.msedge&&delete e.data}return 0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function AAcFilParser(){}return AAcFilParser._getbits=function(e,t,r){if(!r||t<=0||t>8)return-1;var n,i,o=0;if(i=7&e,o=r[n=e>>3]<<i&255,o>>=8-t,i+t>8){if(void 0===r[n+1])return-1;o|=r[n+1]>>16-t-i}return o},AAcFilParser.parseAacFilData=function(e){for(var t=0,r=0,n=[];;){var i=0,o=0,a=0,s=[1,35,69,103,137,100,111,117,121];if(i=AAcFilParser._getbits(t,3,e),t+=3,i<0)return null;if(7==i)return n;if(6!=i)return null;if(o=AAcFilParser._getbits(t,4,e),t+=4,o<0)return null;if(15===o){if(a=AAcFilParser._getbits(t,8,e),t+=8,a<0)return null;o+=a-1}if(o<9)return null;for(var u=0;u<9;u++){if(t>>3>=e.length)return null;if(i=AAcFilParser._getbits(t,8,e),t+=8,i!=s[u])return null}if(r+o-9>e.length)return null;for(u=0;u<o-9;u++){if(t>>3>=e.length)return null;if(i=AAcFilParser._getbits(t,8,e),t+=8,i<0)return null;n[r++]=i}}return n},AAcFilParser.getDbData=function(e){if(!e)return null;var t=[];if(e){var r=0;if(16!=e[r++])return null;for(var n=e[r++],i=0;i<n;i++){var o={uid:"",db:0},a=e[r++],s=e[r++]-a;o.uid="";for(var u=0;u<s;u++)o.uid+=(e[r++]-48).toString();o.db=e[r++],t.push(o)}}return t},AAcFilParser}();t.default=n},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=n(r(26)),s=i(r(28)),u=o.makeLogger("h264-parser"),c={referenceFrameRate:{fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3}};t.h264={name:"h264",parseConfig:function parseConfig(e){var t=e.bytes.byteLength;if(t<7)return u.warn("Invalid AVCDecoderConfigurationRecord, lack of data!"),-1;var r,n=e.bytes.buffer,i=e.bytes.byteOffset,o=new DataView(n,i,t),s=(new Uint8Array(n.slice(i,i+t)),0),d=0,l=0,f=0,h=0,p="",_=c.referenceFrameRate,y=o.getUint8(0),m=o.getUint8(1);if(o.getUint8(2),o.getUint8(3),1!==y||0===m)return u.warn("Invalid AVCDecoderConfigurationRecord"),-1;if(3!==(r=1+(3&o.getUint8(4)))&&4!==r)return u.warn("Strange NaluLengthSizeMinusOne: "+(r-1)),-1;var g=31&o.getUint8(5);if(0===g)return u.warn("Invalid AVCDecoderConfigurationRecord: No SPS"),-1;g>1&&u.warn("Strange AVCDecoderConfigurationRecord: SPS Count = "+g);for(var v=6,b=0;b<g;b++){var E=o.getUint16(v,!1);if(v+=2,0!==E){var w=new Uint8Array(n,i+v,E);v+=E;var P=a.default.parseSPS(w);if(0===b){s=P.codec_size.width,d=P.codec_size.height,l=P.present_size.width,f=P.present_size.height,0!==P.frame_rate.fps_num&&0!==P.frame_rate.fps_den&&(_=P.frame_rate),h=_.fps_den/_.fps_num*1e3;for(var k=w.subarray(1,4),S="avc1.",M=0;M<3;M++){var A=k[M].toString(16);A.length<2&&(A="0"+A),S+=A}p=S}}}var L=o.getUint8(v);if(0===L)return u.warn("Invalid AVCDecoderConfigurationRecord: No PPS"),-1;for(L>1&&u.warn("Strange AVCDecoderConfigurationRecord: PPS Count = "+L),v++,b=0;b<L;b++)E=o.getUint16(v,!1),v+=2,0!==E&&(v+=E);return e.naluLengthSize=r,e.codecWidth=s,e.codecHeight=d,e.presentWidth=l,e.presentHeight=f,e.refSampleDuration=h,e.detailCodec=p,e.fps=_.fps,u.log("Parsed AVCDecoderConfigurationRecord"),0},parseData:function parseData(e){for(var t=e.data.byteLength,r=e.data.buffer,n=e.data.byteOffset,i=new DataView(r,n,t),o=[],a=!1,c=0,d=e.config.naluLengthSize;c<t;){if(c+4>=t){u.warn("Malformed Nalu");break}var l=i.getUint32(c,!1);if(3===d&&(l>>>=8),l>t-d)return u.warn("Malformed Nalus, NaluSize > DataSize!"),-1;var f=31&i.getUint8(c+d);if(5===f)a=!0;else if(6===f)try{var h=new Uint8Array(r,n+c+1+d,l-1),p=s.default.parseSEI(h),_=p.seiType,y=p.seiData;y&&y.data&&(_===s.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED&&y.uuid===s.H264SeiUUIDType.CloudVideoStream&&(e.extradata.seiTimestamp=y.data),e.extradata.sei={seiTimestamp:e.dts,seiType:_,seiData:y})}catch(e){u.warn("parse sei error, ignored!",e)}var m=new Uint8Array(r,n+c,d+l),g={type:f,data:m};o.push(g),m.byteLength,c+=d+l}return e.isKeyframe=a,0}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(27)),o=function(){function SPSParser(){}return SPSParser._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,o=0;o<r;o++)o>=2&&3===t[o]&&0===t[o-1]&&0===t[o-2]||(n[i]=t[o],i++);return new Uint8Array(n.buffer,0,i)},SPSParser.parseSPS=function(e){var t=SPSParser._ebsp2rbsp(e),r=new i.default(t);r.readByte();var n=r.readByte();r.readByte();var o=r.readByte();r.readUEG();var a=SPSParser.getProfileString(n),s=SPSParser.getLevelString(o),u=1,c=420,d=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(u=r.readUEG())&&r.readBits(1),u<=3&&(c=[0,420,422,444][u]),d=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var l=3!==u?8:12,f=0;f<l;f++)r.readBool()&&(f<6?SPSParser._skipScalingList(r,16):SPSParser._skipScalingList(r,64));r.readUEG();var h=r.readUEG();if(0===h)r.readUEG();else if(1===h){r.readBits(1),r.readSEG(),r.readSEG();var p=r.readUEG();for(f=0;f<p;f++)r.readSEG()}r.readUEG(),r.readBits(1);var _=r.readUEG(),y=r.readUEG(),m=r.readBits(1);0===m&&r.readBits(1),r.readBits(1);var g=0,v=0,b=0,E=0;r.readBool()&&(g=r.readUEG(),v=r.readUEG(),b=r.readUEG(),E=r.readUEG());var w=1,P=1,k=0,S=!0,M=0,A=0;if(r.readBool()){if(r.readBool()){var L=r.readByte();L>0&&L<16?(w=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][L-1],P=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][L-1]):255===L&&(w=r.readByte()<<8|r.readByte(),P=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var T=r.readBits(32),C=r.readBits(32);S=r.readBool(),k=(M=C)/(A=2*T)}}var O=1;1===w&&1===P||(O=w/P);var x=0,D=0;0===u?(x=1,D=2-m):(x=3===u?1:2,D=(1===u?2:1)*(2-m));var B=16*(_+1),R=16*(y+1)*(2-m);B-=(g+v)*x,R-=(b+E)*D;var I=Math.ceil(B*O);return r.destroy(),r=null,{profile_string:a,level_string:s,bit_depth:d,chroma_format:c,chroma_format_string:SPSParser.getChromaFormatString(c),frame_rate:{fixed:S,fps:k,fps_den:A,fps_num:M},sar_ratio:{width:w,height:P},codec_size:{width:B,height:R},present_size:{width:I,height:R}}},SPSParser._skipScalingList=function(e,t){for(var r=8,n=8,i=0;i<t;i++)0!==n&&(n=(r+e.readSEG()+256)%256),r=0===n?r:n},SPSParser.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},SPSParser.getLevelString=function(e){return(e/10).toFixed(1)},SPSParser.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},SPSParser}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function ExpGolomb(e){this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}return ExpGolomb.prototype.destroy=function(){this._buffer=null},ExpGolomb.prototype._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new Error("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},ExpGolomb.prototype.readBits=function(e){if(e>32)throw new Error("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var n=e-this._current_word_bits_left;this._fillCurrentWord();var i=Math.min(n,this._current_word_bits_left),o=this._current_word>>>32-i;return this._current_word<<=i,this._current_word_bits_left-=i,r=r<<i|o},ExpGolomb.prototype.readBool=function(){return 1===this.readBits(1)},ExpGolomb.prototype.readByte=function(){return this.readBits(8)},ExpGolomb.prototype._skipLeadingZero=function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(0!==(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},ExpGolomb.prototype.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},ExpGolomb.prototype.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},ExpGolomb}();t.default=n},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(0));t.H264SeiType={H264_SEI_TYPE_BUFFERING_PERIOD:0,H264_SEI_TYPE_PIC_TIMING:1,H264_SEI_TYPE_PAN_SCAN_RECT:2,H264_SEI_TYPE_FILLER_PAYLOAD:3,H264_SEI_TYPE_USER_DATA_REGISTERED:4,H264_SEI_TYPE_USER_DATA_UNREGISTERED:5,H264_SEI_TYPE_RECOVERY_POINT:6,H264_SEI_TYPE_FRAME_PACKING:45,H264_SEI_TYPE_DISPLAY_ORIENTATION:47,H264_SEI_TYPE_GREEN_METADATA:56,H264_SEI_TYPE_MASTERING_DISPLAY_COLOUR_VOLUME:137,H264_SEI_TYPE_ALTERNATIVE_TRANSFER:147},t.H264SeiUUIDType={AdsCtrlSEIV00001:"AdsCtrlSEIV00001",CloudVideoStream:"CloudVideoStream",RoiMaskSeiV00001:"RoiMaskSeiV00001"};var o=function(){function SEIParser(){}return SEIParser._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,o=0;o<r;o++)o>=2&&3===t[o]&&0===t[o-1]&&0===t[o-2]||(n[i]=t[o],i++);return new Uint8Array(n.buffer,0,i)},SEIParser.parseSEI=function(e){var r,n,i=SEIParser._ebsp2rbsp(e),o=new DataView(i.buffer),a=0,s=0,u=0;do{n=o.getUint8(u),u+=1,a+=n}while(255===n);do{n=o.getUint8(u),u+=1,s+=n}while(255===n);switch(a){case t.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED:r=SEIParser.decodeUnregisteredUserData(o,u,s)}return{seiType:a,seiData:r}},SEIParser.buffer2JSON=function(e){for(var t=[],r=new Uint8Array(e),n=0,i=e.byteLength;n<i;n++)t.push(String.fromCharCode(r[n]));return JSON.parse(t.join(""))},SEIParser.decodeUnregisteredUserData=function(e,r,n){if(n<16)return i.default.warn("SEIParser ","error size: ",n),null;var o,a,s=String.fromCharCode.apply(null,new Uint8Array(e.buffer,r,16));switch(r+=16,s){case t.H264SeiUUIDType.AdsCtrlSEIV00001:0===(a=e.getUint8(r++))&&(o=SEIParser.buffer2JSON(e.buffer.slice(r,n+r-17)));break;case t.H264SeiUUIDType.CloudVideoStream:var u=e.getUint32(r).toString(2),c=e.getUint32(r+4).toString(2);o=parseInt(""+u+(c.length<32?new Array(32-c.length+1).join("0"):"")+c,2);break;case t.H264SeiUUIDType.RoiMaskSeiV00001:var d=e.getUint8(r);r+=1,1===d&&(o=String.fromCharCode.apply(null,new Uint8Array(e.buffer,r,n-17)))}return{uuid:s,enctype:a,data:o}},SEIParser}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0).makeLogger("mp3-parser"),i={_mpegAudioV10SampleRateTable:[44100,48e3,32e3,0],_mpegAudioV20SampleRateTable:[22050,24e3,16e3,0],_mpegAudioV25SampleRateTable:[11025,12e3,8e3,0],_mpegAudioL1BitRateTable:[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],_mpegAudioL2BitRateTable:[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],_mpegAudioL3BitRateTable:[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1]};t.mp3={name:"mp3",parseConfig:function parseConfig(e){var t=e.bytes.byteLength;if(t<4)return n.warn("Invalid MP3 packet, header missing!"),-1;var r=e.bytes.buffer,o=e.bytes.byteOffset,a=new Uint8Array(r,o,t);if(255!==a[0])return-1;var s=a[1]>>>3&3,u=(6&a[1])>>1,c=(240&a[2])>>>4,d=(12&a[2])>>>2,l=3!==(a[3]>>>6&3)?2:1,f=0,h=0;switch(s){case 0:f=i._mpegAudioV25SampleRateTable[d];break;case 2:f=i._mpegAudioV20SampleRateTable[d];break;case 3:f=i._mpegAudioV10SampleRateTable[d]}switch(u){case 1:c<i._mpegAudioL3BitRateTable.length&&(h=i._mpegAudioL3BitRateTable[c]);break;case 2:c<i._mpegAudioL2BitRateTable.length&&(h=i._mpegAudioL2BitRateTable[c]);break;case 3:c<i._mpegAudioL1BitRateTable.length&&(h=i._mpegAudioL1BitRateTable[c])}return e.audioSampleRate=f,e.channelCount=l,e.detailCodec="mp3",e.dataRate=h,e.refSampleDuration=1152/f*1e3,n.log("Parsed MPEG Audio Frame Header"),0},parseData:function parseData(e){return 0}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function sent(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function verb(o){return function(s){return function step(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u,c=s(r(31)),d=s(r(32)),l=r(9),f=r(11),h=r(2),p=r(0).makeLogger("flv-demuxer");!function(e){e[e.WAIT_FLV_FLAG=0]="WAIT_FLV_FLAG",e[e.WAIT_PRE_TAG_SIZE=1]="WAIT_PRE_TAG_SIZE",e[e.WAIT_TAG=2]="WAIT_TAG"}(u||(u={}));var _=function(e){function FlvDemuxer(t){var r=e.call(this,t)||this;return r.TAG="FlvDemuxer",r._destroyed=!1,r._flvSoundRateTable=[5500,11025,22050,44100,48e3],r._status=u.WAIT_FLV_FLAG,r._lastParseTime=0,r._audioConfig=r._generateTrackConfig("audio"),r._videoConfig=r._generateTrackConfig("video"),r._tracks=[],r._needMp3Header=!0,r._byteArray=new c.default({initLength:r._config.stashBuffer,autoClear:!0}),r}return i(FlvDemuxer,e),FlvDemuxer.prototype.dispose=function(){e.prototype.dispose.call(this),this._parser&&(this._parser.return("dispose"),this._parser=null),this._byteArray=null,this._audioConfig=null,this._videoConfig=null,this._tracks=[],this._destroyed=!0,p.log("disposed")},FlvDemuxer.prototype._appendArrayBuffer=function(e){this._byteArray.write(e),this._parseData()},FlvDemuxer.prototype._appendEnd=function(){this._parseData(!0),this._parser&&this._parser.return("end"),e.prototype._appendEnd.call(this)},FlvDemuxer.prototype._parseData=function(e){if(void 0===e&&(e=!1),this._byteArray.byteAvailable>0){this._parser||(this._parser=this._parse());var t=Date.now();if(e||!this._hasFirstFrame||this._byteArray.byteAvailable>this._config.stashBuffer||t-this._lastParseTime>this._config.stashTime){this._lastParseTime=t;var r=this._parser.next().value;if(r&&r.name===h.DyDemuxError.NAME)return void this._error(r.message,r.errorId);this._tracks.splice(0).forEach(this._dispatchTrack)}}},FlvDemuxer.prototype._parse=function(){var e,t,r,n,i,o,s,c,d,l;return a(this,function(a){switch(a.label){case 0:switch(this._status){case u.WAIT_FLV_FLAG:return[3,1];case u.WAIT_PRE_TAG_SIZE:return[3,4];case u.WAIT_TAG:return[3,7]}return[3,13];case 1:return this._byteArray.byteAvailable<9?[4]:[3,3];case 2:return a.sent(),[3,1];case 3:return"FLV"!==(e=this._byteArray.readString(3))?[2,new h.DyDemuxError("Not valid flv file : "+e,1610)]:(this._byteArray.readUint8(),t=this._byteArray.readUint8(),!!(4&t)&&!!(1&t)||(this._trackLength=1),this._byteArray.read(4),this._status=u.WAIT_PRE_TAG_SIZE,[3,13]);case 4:return this._byteArray.byteAvailable<4?[4]:[3,6];case 5:return a.sent(),[3,4];case 6:return this._byteArray.read(4),this._status=u.WAIT_TAG,[3,13];case 7:return this._byteArray.byteAvailable<11?[4]:[3,9];case 8:return a.sent(),[3,7];case 9:r=this._byteArray.readUint8(),n=this._byteArray.readUint24(),i=this._byteArray.readUint24(),o=this._byteArray.readUint8(),s=o<<24|i,this._byteArray.readUint24(),a.label=10;case 10:return this._byteArray.byteAvailable<n?[4]:[3,12];case 11:return a.sent(),[3,10];case 12:switch(c=this._byteArray.bytePosition,d=this._byteArray.read(n),l=void 0,r){case 8:!1!==this._config.hasAudio&&(l=this._parseAudio(d,s));break;case 9:!1!==this._config.hasVideo&&(l=this._parseVideo(d,s,c));break;case 18:this._parseScript(d);break;default:p.warn("unsupport flv tag type",r)}return this._status=u.WAIT_PRE_TAG_SIZE,l?[2,l]:[3,13];case 13:return[3,0];case 14:return[2]}})},FlvDemuxer.prototype._error=function(e,t){p.error("["+this.TAG+"] "+e),this.onError&&this.onError({message:e,errorId:t})},FlvDemuxer.prototype._parseAudio=function(e,t){var r=new c.default({buffer:e}),n=r.readUint8(),i=(240&n)>>4,a=(12&n)>>2,s=1&n,u=r.read(r.byteAvailable),d=this._audioConfig;if(d.channelCount=0===s?1:2,d.audioSampleRate=this._flvSoundRateTable[a],10===i){var l=new Uint8Array(u),_=l[0],y=l.subarray(1),m={type:"audio",trackId:d.trackId,dts:t,pts:t,codec:f.Codec.AAC,config:d,data:y,extradata:{}};0===_?(m.flag="CFG",this._pushTrack(m)):1===_?this._pushTrack(m):p.warn(this.TAG,"Flv: Unsupported AAC data type "+_)}else{if(2!==i)return new h.DyDemuxError("unsupport audio type = "+i,162);var g=new Uint8Array(u);m={type:"audio",trackId:d.trackId,dts:t,pts:t,codec:f.Codec.MP3,config:d,data:g,extradata:{}};if(this._needMp3Header){var v=o(o({},m),{flag:"CFG",data:new Uint8Array(u.slice(0,4))});this._pushTrack(v),this._needMp3Header=!1}this._pushTrack(m)}},FlvDemuxer.prototype._parseVideo=function(e,t,r){var n=new c.default({buffer:e}),i=n.readUint8(),o=(240&i)>>4,a=15&i;if(7!==a)return new h.DyDemuxError("unsupport video codec type = "+a,163);var s=n.read(n.byteAvailable);return this._parseAVCVideoPacket(s,0,s.byteLength,t,r,o)},FlvDemuxer.prototype._parseScript=function(e){var t=d.default.parseScriptData(e,0,e.byteLength);if("onMetaData"in t){var r=t.onMetaData;"number"===typeof r.audiodatarate&&void 0===this._audioConfig.dataRate&&(this._audioConfig.dataRate=r.audiodatarate),"number"===typeof r.videodatarate&&void 0===this._videoConfig.dataRate&&(this._videoConfig.dataRate=r.videodatarate),this._pendingExtradata.metadata=r,p.log(this.TAG,"Parsed onMetaData",r)}},FlvDemuxer.prototype._parseAVCVideoPacket=function(e,t,r,n,i,o){if(r<4)p.warn(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var a=new DataView(e,t,r),s=a.getUint8(0),u=(16777215&a.getUint32(0,!1))<<8>>8,c=this._videoConfig,d=new Uint8Array(e,t+4,r-4),l={type:"video",trackId:c.trackId,dts:n,pts:n+u,codec:f.Codec.H264,config:c,data:d,extradata:{}};if(0===s)l.flag="CFG",this._pushTrack(l);else if(1===s)this._pushTrack(l);else if(2!==s)return new h.DyDemuxError("Flv: Invalid video packet type "+s,166)}},FlvDemuxer.prototype._pushTrack=function(e){this._tracks.push(e)},FlvDemuxer.prototype._dispatchTrack=function(e){this._destroyed||this._appendTrack(e)},FlvDemuxer}(l.Demuxer);t.default=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function ByteArray(e){var t=void 0===e?{}:e,r=t.buffer,n=t.initLength,i=void 0===n?1024:n,o=t.autoClear,a=void 0!==o&&o,s=t.increase,u=void 0===s?0:s,c=t.littleEndian,d=void 0===c?ByteArray.littleEndian:c;this._rposition=0,this._wposition=0,this._count=0,this._autoClear=a,this.increase=u,this.littleEndian=d,r?(this._buffer=r,this._wposition=r.byteLength):this._buffer=new ArrayBuffer(i)}return Object.defineProperty(ByteArray.prototype,"buffer",{get:function get(){return this._buffer.slice(0,this._wposition)},enumerable:!0,configurable:!0}),Object.defineProperty(ByteArray.prototype,"byteAvailable",{get:function get(){return this._wposition-this._rposition},enumerable:!0,configurable:!0}),Object.defineProperty(ByteArray.prototype,"byteLength",{get:function get(){return this._wposition},enumerable:!0,configurable:!0}),Object.defineProperty(ByteArray.prototype,"bytePosition",{get:function get(){return this._rposition},enumerable:!0,configurable:!0}),ByteArray.prototype.read=function(e){if(e>this.byteAvailable)throw new Error("["+ByteArray.TAG+"] not enough data for read.");var t=this._buffer.slice(this._rposition,this._rposition+e);return this._rposition+=e,t},ByteArray.prototype.readUint8=function(){return new DataView(this.read(1)).getUint8(0)},ByteArray.prototype.readUint16=function(){return new DataView(this.read(2)).getUint16(0,this.littleEndian)},ByteArray.prototype.readUint24=function(){var e=new Uint8Array(this.read(3));return this.littleEndian&&e.reverse(),e[0]<<16|e[1]<<8|e[2]},ByteArray.prototype.readUint32=function(){return new DataView(this.read(4)).getUint32(0,this.littleEndian)},ByteArray.prototype.readString=function(e){return String.fromCharCode.apply(null,new Uint8Array(this.read(e)))},ByteArray.prototype.write=function(e){if(e&&e.byteLength>0){var t=e.byteLength,r=this._wposition+t;if(r>this._buffer.byteLength){var n=this._autoClear?this._rposition:0,i=r-n,o=this._buffer.slice(n,this._wposition),a=void 0;i>this._buffer.byteLength?(this.increase?i+=this.increase:i=2*(this.buffer.byteLength+t),this._count++,a=new ArrayBuffer(i)):a=this._buffer,new Uint8Array(a).set(new Uint8Array(o),0),this._rposition-=n,this._wposition=o.byteLength,this._buffer=a}new Uint8Array(this._buffer).set(new Uint8Array(e),this._wposition),this._wposition+=t}},ByteArray.fromArray=function(e){var t=0;e.forEach(function(e){return t+=e.byteLength});var r=new ByteArray({initLength:t});return e.forEach(function(e){return r.write(e)}),r},ByteArray.TAG="ByteArray",ByteArray.littleEndian=!1,ByteArray}();t.default=n},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(r(0)),a=n(r(33)),s=(i=new ArrayBuffer(2),new DataView(i).setInt16(0,256,!0),256===new Int16Array(i)[0]),u=function(){function AMF(){}return AMF.parseScriptData=function(e,t,r){var n={};try{var i=AMF.parseValue(e,t,r),a=AMF.parseValue(e,t+i.size,r-i.size);n[i.data]=a.data}catch(e){o.default.error("AMF",e.toString())}return n},AMF.parseObject=function(e,t,r){if(r<3)throw new Error("Data not enough when parse ScriptDataObject");var n=AMF.parseString(e,t,r),i=AMF.parseValue(e,t+n.size,r-n.size),o=i.objectEnd;return{data:{name:n.data,value:i.data},size:n.size+i.size,objectEnd:o}},AMF.parseVariable=function(e,t,r){return AMF.parseObject(e,t,r)},AMF.parseString=function(e,t,r){if(r<2)throw new Error("Data not enough when parse String");var n=new DataView(e,t,r).getUint16(0,!s);return{data:n>0?a.default(new Uint8Array(e,t+2,n)):"",size:2+n}},AMF.parseLongString=function(e,t,r){if(r<4)throw new Error("Data not enough when parse LongString");var n=new DataView(e,t,r).getUint32(0,!s);return{data:n>0?a.default(new Uint8Array(e,t+4,n)):"",size:4+n}},AMF.parseDate=function(e,t,r){if(r<10)throw new Error("Data size invalid when parse Date");var n=new DataView(e,t,r),i=n.getFloat64(0,!s),o=n.getInt16(8,!s);return{data:new Date(i+=60*o*1e3),size:10}},AMF.parseValue=function(e,t,r){if(r<1)throw new Error("Data not enough when parse Value");var n,i=new DataView(e,t,r),a=1,u=i.getUint8(0),c=!1;try{switch(u){case 0:n=i.getFloat64(1,!s),a+=8;break;case 1:n=!!i.getUint8(1),a+=1;break;case 2:var d=AMF.parseString(e,t+1,r-1);n=d.data,a+=d.size;break;case 3:n={};var l=0;for(9===(16777215&i.getUint32(r-4,!s))&&(l=3);a<r-4;){var f=AMF.parseObject(e,t+a,r-a-l);if(f.objectEnd)break;n[f.data.name]=f.data.value,a+=f.size}if(a<=r-3)9===(16777215&i.getUint32(a-1,!s))&&(a+=3);break;case 8:n={},a+=4;l=0;for(9===(16777215&i.getUint32(r-4,!s))&&(l=3);a<r-8;){var h=AMF.parseVariable(e,t+a,r-a-l);if(h.objectEnd)break;n[h.data.name]=h.data.value,a+=h.size}if(a<=r-3)9===(16777215&i.getUint32(a-1,!s))&&(a+=3);break;case 9:n=void 0,a=1,c=!0;break;case 10:n=[];var p=i.getUint32(1,!s);a+=4;for(var _=0;_<p;_++){var y=AMF.parseValue(e,t+a,r-a);n.push(y.data),a+=y.size}break;case 11:var m=AMF.parseDate(e,t+1,r-1);n=m.data,a+=m.size;break;case 12:var g=AMF.parseString(e,t+1,r-1);n=g.data,a+=g.size;break;default:a=r,o.default.warn("AMF","Unsupported AMF value type "+u)}}catch(e){o.default.error("AMF",e.toString())}return{data:n,size:a,objectEnd:c}},AMF}();t.default=u},function(e,t,r){"use strict";function checkContinuation(e,t,r){var n=e;if(t+r<n.length){for(;r--;)if(128!==(192&n[++t]))return!1;return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function decodeUTF8(e){for(var t=[],r=e,n=0,i=e.length;n<i;)if(r[n]<128)t.push(String.fromCharCode(r[n])),++n;else{if(r[n]<192);else if(r[n]<224){if(checkContinuation(r,n,1)&&(o=(31&r[n])<<6|63&r[n+1])>=128){t.push(String.fromCharCode(65535&o)),n+=2;continue}}else if(r[n]<240){if(checkContinuation(r,n,2)&&(o=(15&r[n])<<12|(63&r[n+1])<<6|63&r[n+2])>=2048&&55296!==(63488&o)){t.push(String.fromCharCode(65535&o)),n+=3;continue}}else if(r[n]<248){var o;if(checkContinuation(r,n,3)&&(o=(7&r[n])<<18|(63&r[n+1])<<12|(63&r[n+2])<<6|63&r[n+3])>65536&&o<1114112){o-=65536,t.push(String.fromCharCode(o>>>10|55296)),t.push(String.fromCharCode(1023&o|56320)),n+=4;continue}}t.push(String.fromCharCode(65533)),++n}return t.join("")}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(3),s=r(10),u=o.makeLogger("remuxer"),c=function(e){function Remuxer(t){var r=e.call(this)||this;return r._trackConfigs={},r._config=t,r}return i(Remuxer,e),Remuxer.prototype.dispose=function(){e.prototype.dispose.call(this),this._config=void 0,this._trackConfigs=void 0},Remuxer.prototype.append=function(e){if("CFG"===e.flag){var t=e.config,r=this._trackConfigs[e.trackId];a.isBufferEqual(null===r||void 0===r?void 0:r.bytes,t.bytes)||(this._configChanged(t,r,e),this._trackConfigs[e.trackId]=Object.assign({},t))}else this._handleTrackData(e)},Remuxer.prototype._handleTrackData=function(e){this.onData(e)},Remuxer.prototype._configChanged=function(e,t,r){u.log("track config changed!",t,e)},Remuxer}(s.BaseStream);t.Remuxer=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(36)),s=o(r(5)),u=r(12),c=r(0),d=r(3),l=c.makeLogger("mp4-remuxer"),f=function(e){function Mp4Remuxer(){var t=null!==e&&e.apply(this,arguments)||this;return t.TAG="MP4Remuxer",t._useAudioMpeg=!1,t._isAudioTimeNeedUpdate=!1,t._trackInfos={},t}return i(Mp4Remuxer,e),Mp4Remuxer.prototype.dispose=function(){e.prototype.dispose.call(this),this._trackInfos=void 0},Mp4Remuxer.prototype._configChanged=function(e,t,r){l.log("track config changed!",t,e),"audio"===e.type?"mp3"!==e.detailCodec||s.default.firefox?(e.mimeType="audio/mp4; codecs="+e.detailCodec,r.data=a.default.generateInitSegment(e),l.log("generate init audio segment")):(e.mimeType="audio/mpeg",this._useAudioMpeg=!0,this._isAudioTimeNeedUpdate=!0,delete r.data):"video"===e.type&&(e.mimeType="video/mp4; codecs="+e.detailCodec,r.data=a.default.generateInitSegment(e),l.log("generate init video segment"));var n=this._trackInfos[r.trackId];n&&n.lastTrack?n.pendingConfigTrack=r:this.onData(r)},Mp4Remuxer.prototype._handleTrackData=function(e){var t=this._trackConfigs[e.trackId];if(t){if(e.config=t,e.data){if("audio"===e.type&&this._useAudioMpeg)return this._isAudioTimeNeedUpdate&&(e.extradata.timeOffset=e.pts,this._isAudioTimeNeedUpdate=!1),void this.onData(e);var r=this._trackInfos[e.trackId];r||(this._trackInfos[e.trackId]=r={lastTrack:void 0,sequenceNumber:1});var n="audio"===e.type?this._remuxAudio:this._remuxVideo;return r.lastTrack&&(r.lastTrack.duration=e.dts-r.lastTrack.dts,s.default.msedge&&"audio"===r.lastTrack.type&&r.lastTrack.duration<100*e.config.refSampleDuration&&1===r.lastTrack.trackLength&&(r.lastTrack.duration=e.config.refSampleDuration,e.dts=e.pts=r.lastTrack.dts+r.lastTrack.duration),n(r.lastTrack),r.pendingConfigTrack&&(this.onData(r.pendingConfigTrack),r.pendingConfigTrack=void 0)),r.lastTrack=e,e.isEnd?(e.duration=Math.floor(t.refSampleDuration),void n(e)):void 0}this.onData(e)}},Mp4Remuxer.prototype._mergeBoxes=function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r},Mp4Remuxer.prototype._remuxAudio=function(e){if(e.duration<0&&(e.duration=0),e.duration>this._config.audioDurationThreshold&&(l.warn("audio duration too long "+e.duration),e.extradata.jumpOverTs=e.pts+e.duration),e.data){var t={trackId:e.trackId,sequenceNumber:this._trackInfos[e.trackId].sequenceNumber++,samples:[{duration:d.timescaledTime(e.duration,e.config.timescale),size:e.data.byteLength,cts:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,isNonSync:0}}]},r=a.default.moof(t,d.timescaledTime64(e.dts,e.config.timescale)),n=a.default.mdat(e.data);e.data=this._mergeBoxes(r,n)}this.onData(e)},Mp4Remuxer.prototype._remuxVideo=function(e){e.duration<0&&(e.duration=0),e.duration>this._config.videoDurationThreshold&&l.warn("video duration too long "+e.duration);var t=e.isKeyframe;if(e.data){var r={trackId:e.trackId,sequenceNumber:this._trackInfos[e.trackId].sequenceNumber++,samples:[{duration:d.timescaledTime(e.duration,e.config.timescale),size:e.data.byteLength,cts:d.timescaledTime(e.pts-e.dts,e.config.timescale),flags:{isLeading:0,dependsOn:t?2:1,isDependedOn:t?1:0,hasRedundancy:0,isNonSync:t?0:1}}]};if(s.default.chrome&&(s.default.version.major<50||50===s.default.version.major&&s.default.version.build<2661)){var n=r.samples[0].flags;n.dependsOn=2,n.isNonSync=0}var i=a.default.moof(r,d.timescaledTime64(e.dts,e.config.timescale)),o=a.default.mdat(e.data);e.data=this._mergeBoxes(i,o)}this.onData(e)},Mp4Remuxer}(u.Remuxer);t.default=f},function(e,t,r){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function MP4(){}return MP4.init=function(){for(var e in MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},MP4.types)MP4.types.hasOwnProperty(e)&&(MP4.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=MP4.constants={};t.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),t.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),t.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSC=t.STCO=t.STTS,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),t.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},MP4.box=function(e){for(var t=8,r=null,n=Array.prototype.slice.call(arguments,1),i=n.length,o=0;o<i;o++)t+=n[o].byteLength;(r=new Uint8Array(t))[0]=t>>>24&255,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r.set(e,4);var a=8;for(o=0;o<i;o++)r.set(n[o],a),a+=n[o].byteLength;return r},MP4.generateInitSegment=function(e){var t=MP4.box(MP4.types.ftyp,MP4.constants.FTYP),r=MP4.moov(e),n=new Uint8Array(t.byteLength+r.byteLength);return n.set(t,0),n.set(r,t.byteLength),n},MP4.moov=function(e){var t=MP4.mvhd(e.timescale,e.duration),r=MP4.trak(e),n=MP4.mvex(e);return MP4.box(MP4.types.moov,t,r,n)},MP4.mvhd=function(e,t){return MP4.box(MP4.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},MP4.trak=function(e){return MP4.box(MP4.types.trak,MP4.tkhd(e),MP4.mdia(e))},MP4.tkhd=function(e){var t=e.trackId,r=e.duration,n=e.presentWidth,i=e.presentHeight;return MP4.box(MP4.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,i>>>8&255,255&i,0,0]))},MP4.mdia=function(e){return MP4.box(MP4.types.mdia,MP4.mdhd(e),MP4.hdlr(e),MP4.minf(e))},MP4.mdhd=function(e){var t=e.timescale,r=e.duration;return MP4.box(MP4.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,85,196,0,0]))},MP4.hdlr=function(e){var t=null;return t="audio"===e.type?MP4.constants.HDLR_AUDIO:MP4.constants.HDLR_VIDEO,MP4.box(MP4.types.hdlr,t)},MP4.minf=function(e){var t=null;return t="audio"===e.type?MP4.box(MP4.types.smhd,MP4.constants.SMHD):MP4.box(MP4.types.vmhd,MP4.constants.VMHD),MP4.box(MP4.types.minf,t,MP4.dinf(),MP4.stbl(e))},MP4.dinf=function(){return MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,MP4.constants.DREF))},MP4.stbl=function(e){return MP4.box(MP4.types.stbl,MP4.stsd(e),MP4.box(MP4.types.stts,MP4.constants.STTS),MP4.box(MP4.types.stsc,MP4.constants.STSC),MP4.box(MP4.types.stsz,MP4.constants.STSZ),MP4.box(MP4.types.stco,MP4.constants.STCO))},MP4.stsd=function(e){return"audio"===e.type?"mp3"===e.detailCodec?MP4.box(MP4.types.stsd,MP4.constants.STSD_PREFIX,MP4.mp3(e)):MP4.box(MP4.types.stsd,MP4.constants.STSD_PREFIX,MP4.mp4a(e)):MP4.box(MP4.types.stsd,MP4.constants.STSD_PREFIX,MP4.avc1(e))},MP4.mp3=function(e){var t=e.channelCount,r=e.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return MP4.box(MP4.types[".mp3"],n)},MP4.mp4a=function(e){var t=e.channelCount,r=e.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return MP4.box(MP4.types.mp4a,n,MP4.esds(e))},MP4.esds=function(e){var t=n(e.bytes),r=t.length,i=new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t).concat([6,1,2]));return MP4.box(MP4.types.esds,i)},MP4.avc1=function(e){var t=e.bytes,r=e.codecWidth,n=e.codecHeight,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,n>>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,115,107,121,45,119,97,110,103,64,113,113,46,99,111,109,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return MP4.box(MP4.types.avc1,i,MP4.box(MP4.types.avcC,t))},MP4.mvex=function(e){return MP4.box(MP4.types.mvex,MP4.trex(e))},MP4.trex=function(e){var t=e.trackId,r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return MP4.box(MP4.types.trex,r)},MP4.moof=function(e,t){return MP4.box(MP4.types.moof,MP4.mfhd(e.sequenceNumber),MP4.traf(e,t))},MP4.mfhd=function(e){var t=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]);return MP4.box(MP4.types.mfhd,t)},MP4.traf=function(e,t){var r=e.trackId,i=MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),o=MP4.box(MP4.types.tfdt,new Uint8Array(n([1,0,0,0],t.toBytesBE()))),a=MP4.sdtp(e),s=MP4.trun(e,a.byteLength+16+16+8+16+8+8+4);return MP4.box(MP4.types.traf,i,o,s,a)},MP4.sdtp=function(e){for(var t=e.samples||[],r=t.length,n=new Uint8Array(4+r),i=0;i<r;i++){var o=t[i].flags;n[i+4]=o.isLeading<<6|o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy}return MP4.box(MP4.types.sdtp,n)},MP4.trun=function(e,t){var r=e.samples||[],n=r.length,i=12+16*n,o=new Uint8Array(i);t+=8+i,o.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0);for(var a=0;a<n;a++){var s=r[a].duration,u=r[a].size,c=r[a].flags,d=r[a].cts;o.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*a)}return MP4.box(MP4.types.trun,o)},MP4.mdat=function(e){return MP4.box(MP4.types.mdat,e)},MP4}();i.init(),t.default=i},function(e,t,r){function webpackBootstrapFunc(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},__webpack_require__.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="/",__webpack_require__.oe=function(e){throw console.error(e),e};var r=__webpack_require__(__webpack_require__.s=ENTRY_MODULE);return r.default||r}var n="[\\.|\\-|\\+|\\w|/|@]+",i="\\((/\\*.*?\\*/)?s?.*?("+n+").*?\\)";function quoteRegExp(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function getModuleDependencies(e,t,o){var a={};a[o]=[];var s=t.toString(),u=s.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return a;for(var c,d=u[1],l=new RegExp("(\\\\n|\\W)"+quoteRegExp(d)+i,"g");c=l.exec(s);)"dll-reference"!==c[3]&&a[o].push(c[3]);for(l=new RegExp("\\("+quoteRegExp(d)+'\\("(dll-reference\\s('+n+'))"\\)\\)'+i,"g");c=l.exec(s);)e[c[2]]||(a[o].push(c[1]),e[c[2]]=r(c[1]).m),a[c[2]]=a[c[2]]||[],a[c[2]].push(c[4]);return a}function hasValuesInQueues(e){return Object.keys(e).reduce(function(t,r){return t||e[r].length>0},!1)}e.exports=function(e,t){t=t||{};var n={main:r.m},i=t.all?{main:Object.keys(n)}:function getRequiredModules(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};hasValuesInQueues(r);)for(var o=Object.keys(r),a=0;a<o.length;a++){var s=o[a],u=r[s].pop();if(i[s]=i[s]||{},!i[s][u]&&e[s][u]){i[s][u]=!0,n[s]=n[s]||[],n[s].push(u);for(var c=getModuleDependencies(e,e[s][u],s),d=Object.keys(c),l=0;l<d.length;l++)r[d[l]]=r[d[l]]||[],r[d[l]]=r[d[l]].concat(c[d[l]])}}return n}(n,e),o="";Object.keys(i).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;i[e][t];)t++;i[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+e+" = ("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+i[e].map(function(t){return JSON.stringify(t)+": "+n[e][t].toString()}).join(",")+"});\n"}),o=o+"new (("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i.main.map(function(e){return JSON.stringify(e)+": "+n.main[e].toString()}).join(",")+"}))(self);";var a=new window.Blob([o],{type:"text/javascript"});if(t.bare)return a;var s=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(a),u=new window.Worker(s);return u.objectURL=s,u}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=function(){function TimeDispatch(){this.array=[],n.bindAll(this),this._timer=setInterval(this._onTimeUpdate,100)}return TimeDispatch.prototype.destroy=function(){this.detach(),clearInterval(this._timer)},TimeDispatch.prototype.attach=function(e){this.video=e},TimeDispatch.prototype.detach=function(){this.video=null,this.array=[]},TimeDispatch.prototype.add=function(e){this.array.push(e),this._onTimeUpdate()},TimeDispatch.prototype._send=function(e){this.onSend&&this.onSend(e)},TimeDispatch.prototype._onTimeUpdate=function(){if(this.video){for(var e=1e3*this.video.currentTime,t=this.array.length,r=0;r<t;r++){var n=this.array[r];if(n.ts>e)break;this._send(n)}r>0&&this.array.splice(0,r)}},TimeDispatch}();t.TimeDispatch=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(2),s=r(40),u=r(41),c=r(0),d=r(3),l=c.makeLogger("to-mse"),f=function(e){function ToMSE(t){var r=e.call(this,t)||this;return r.preTimestamp=0,r._tracks={},r._sourceBufferAdded={},r._isLoadEnded=!1,r._isPlayEnded=!1,r._isWaiting=!1,r._reachCanplay=!1,r._jumpOverList=[],r._keyframes=[],r._isTracksReady=!1,r._lastPlayTime=-1,o.bindAll(r),window.T_ADV_Timestamp=r.T_ADV_Timestamp,r._config.enableJitterBuffer&&(r._checkBufferTimer=setInterval(r._checkBuffer,1e3)),r._jumpOverTimer=setInterval(r._jumpOver,200),r._removeBuffer=s.throttle(r._removeBuffer,1e3),r._checkStuckTimer=setInterval(r._checkPlayStuck,3e3),r}return i(ToMSE,e),ToMSE.prototype.dispose=function(){if(e.prototype.dispose.call(this),this._mediaSource){if("closed"!==this._mediaSource.readyState)for(var t=this._mediaSource.sourceBuffers,r=0;r<t.length;r++){var n=t[r];try{this._mediaSource.removeSourceBuffer(n)}catch(e){l.warn("remove source buffer error: ",e)}n.removeEventListener("updateend",this._onUpdateend)}if("open"===this._mediaSource.readyState)try{this._mediaSource.endOfStream()}catch(e){l.warn("endOfStream error: ",e)}this._mediaSource.removeEventListener("sourceopen",this._appendBuffer),this._mediaSource=null}this._mediaSourceUrl&&(URL.revokeObjectURL(this._mediaSourceUrl),this._mediaSourceUrl=null),this._sourceBufferAdded={}},ToMSE.prototype.appendData=function(t){if(!this._destroyed){e.prototype.appendData.call(this,t);var r=this._tracks[t.trackId];r||(r=this._tracks[t.trackId]=[]),r.push(t),this._isTracksReady||(this._isTracksReady=this._checkTracksReady()),this._isTracksReady&&this._appendBuffer()}},ToMSE.prototype.appendEnd=function(){if(!this._destroyed&&this._mediaSource&&"open"===this._mediaSource.readyState){for(var e=this._mediaSource.sourceBuffers,t=!1,r=0;r<e.length;r++){if(e[r].updating){t=!0;break}}t||(this._mediaSource.endOfStream(),l.log("media end"))}},ToMSE.prototype.attach=function(e){if(this._video=e,this._video.addEventListener("stalled",this._onStalled),this._video.addEventListener("progress",this._onProgress),this._video.addEventListener("canplay",this._onCanplay),this._video.addEventListener("waiting",this._onWaiting),this._video.addEventListener("ended",this._onEnded),this._video.addEventListener("error",this._onMediaError),!this._mediaSourceUrl){var t=this._mediaSource=new MediaSource;t.addEventListener("sourceopen",this._appendBuffer),this._mediaSourceUrl=URL.createObjectURL(t)}this._video.src=this._mediaSourceUrl},ToMSE.prototype.detach=function(){this._video&&(this._video.removeEventListener("stalled",this._onStalled),this._video.removeEventListener("progress",this._onProgress),this._video.removeEventListener("canplay",this._onCanplay),this._video.removeEventListener("waiting",this._onWaiting),this._video.removeEventListener("ended",this._onEnded),this._video.removeEventListener("error",this._onMediaError),this._video.playbackRate=1,this._video.src="",this._video.removeAttribute("src"),this._video=null),this._removeBuffer.cancel&&this._removeBuffer.cancel(),clearInterval(this._checkStuckTimer),clearInterval(this._checkBufferTimer),clearInterval(this._jumpOverTimer)},ToMSE.prototype._appendBuffer=function(){var e=this;!this._destroyed&&this._mediaSource&&"open"===this._mediaSource.readyState&&Object.keys(this._tracks).some(function(t){for(var r=e._tracks[t],n=[],i=e._sourceBufferAdded[t];r.length>0;){var o=r[0];if(!i){var a=o.config.mimeType;if(!MediaSource.isTypeSupported(a))return e._onError("Unsupported MIME type or codec: "+a),!0;try{l.log("add source buffer "+o.trackId+": "+a),(i=e._mediaSource.addSourceBuffer(a)).addEventListener("updateend",e._onUpdateend),e._sourceBufferAdded[o.trackId]=i}catch(t){return e._onError("failed add more source buffer, length="+e._mediaSource.sourceBuffers.length+", readyState="+e._mediaSource.readyState+"\n"+t),!0}return}if(!i||i.updating)return;if(o.isEnd&&(e._isLoadEnded=!0),o.extradata){var s=o.extradata,u=s.jumpOverTs,c=s.timeOffset,f=s.seiTimestamp,h=s.aacfil,p=s.sei,_=s.metadata;if(u>0){var y=u/1e3,m=e._jumpOverList.length;if(0===m)e._jumpOverList.push(y);else y-e._jumpOverList[m-1]<1&&e._jumpOverList.pop(),e._jumpOverList.push(y);l.warn("jumpover timestamp list changed: ",JSON.stringify(e._jumpOverList))}c&&-1!==c&&(i.timestampOffset=c/1e3,l.log("buffer time offset change: "+i.timestampOffset)),f&&(e.seiTimestamp=f),h&&e._onExtraData({type:"aacfil",ts:o.pts,data:h}),p&&e._onExtraData({type:"sei",ts:o.pts,data:p}),_&&(e._mediaInfo.metadata=_,e._updateMediaInfo(o.config))}o.pts&&(e.preTimestamp=o.pts),"video"===o.type&&o.isKeyframe&&(e._keyframes.push(o.pts/1e3),e.onHasKeyframe&&e.onHasKeyframe()),o.data&&o.data.byteLength>0&&n.push(o.data),delete o.data,r.shift()}if(n.length>0)try{i.appendBuffer(d.bufferConcat(n))}catch(t){l.warn("append buffer error: ",t,e._video.error),22===t.code||e._onError("append buffer error: "+t+" "+e._video.error)}})},ToMSE.prototype._removeBuffer=function(){if(this._video)for(var e=this._video.currentTime,t=this._mediaSource.sourceBuffers,r=function _loop_1(r){var i=t[r];if(!i.updating){var o=i.buffered;if(o.length>0)if(o.length>1){var a=Math.max(o.start(0)-.1,0),s=o.end(0)+.1;s<e&&i.remove(a,s)}else{a=Math.max(o.start(0)-.1,0);if(e-a>n._config.videoBackTimeThreshold){var u=e-n._config.videoBackTime;(u=n._searchNearestKeyframe(u)-1)&&u-a>5&&(i.remove(a,u),n._keyframes=n._keyframes.filter(function(e){return e>=u}))}}}},n=this,i=0;i<t.length;i++)r(i)},ToMSE.prototype._searchNearestKeyframe=function(e){var t=this._keyframes.length;if(0===t)return l.log("no keyframe info!"),e;if(!(e<this._keyframes[0]))for(var r=0;r<t;r++){if(e>=this._keyframes[r]&&(r===t-1||e<this._keyframes[r+1]))return this._keyframes[r]}},ToMSE.prototype._onUpdateend=function(){this._removeBuffer(),this._appendBuffer(),this._isLoadEnded&&this.appendEnd()},ToMSE.prototype._checkStart=function(){var e=this._video.buffered,t=this._video.currentTime;if(0===t&&e.length>0){var r=e.start(0),n=e.end(0);t<r&&(l.log("player start from: "+r+", buffer end: "+n),this._video.currentTime=r)}},ToMSE.prototype._checkPlayStuck=function(){var e=this._video.buffered,t=this._video.currentTime;if(this._lastPlayTime===t&&this._isWaiting&&e.length>0&&!this._isPlayEnded&&!this._video.seeking){var r=e.end(e.length-1),n=r-t;if(n>4){var i=e.start(e.length-1),o=Math.max(this._video.currentTime+1,i);r-o>2&&(l.warn("player stuck, force move forward: "+n+", "+t+" -> "+o),this._printBuffer(this._video.buffered),this._video.currentTime=o)}}this._lastPlayTime=t},ToMSE.prototype._checkBuffer=function(){if(this._video){var e=this._video.buffered;if(e&&e.length>0){var t=e.end(e.length-1)-this._video.currentTime,r=this._video.playbackRate,n=void 0;if(t<this._config.minBuffer)n=this._config.slowRate;else if(t<this._config.maxBuffer){var i=(this._config.minBuffer+this._config.maxBuffer)/2;r<1&&t>i&&(n=1),r>1&&t<i&&(n=1)}else n=this._config.fastRate;n&&n!==r&&(this._video.playbackRate=n,l.log("playback rate change to "+n))}}},ToMSE.prototype._printBuffer=function(e){var t=e.length;l.log("current time = "+this._video.currentTime);for(var r=0;r<t;r++)l.log("buffered["+r+"]: "+e.start(r)+" ---- "+e.end(r))},ToMSE.prototype._jumpOver=function(){var e=this._jumpOverList.length;if(e>0){if(!this._video)return;for(var t=this._video.currentTime,r=0;r<e;r++){var n=this._jumpOverList[r];if(t>n){if(r===e-1){l.warn("Large gap detected, jump over "+n+", current: "+t),this._video.currentTime+=.1,this._jumpOverList.splice(0,r+1);break}if(t<this._jumpOverList[r+1]){this._video.currentTime+=.1,this._jumpOverList.splice(0,r+1),l.warn("Large gap detected, jump over "+n+", current: "+t);break}}else;}}},ToMSE.prototype._onStalled=function(){},ToMSE.prototype._onProgress=function(){this._checkStart()},ToMSE.prototype._onWaiting=function(){this._reachCanplay&&(this._isWaiting=!0)},ToMSE.prototype._onCanplay=function(){this._reachCanplay=!0,this._isWaiting=!1,this._video.removeEventListener("progress",this._onProgress)},ToMSE.prototype._onEnded=function(){this._isPlayEnded=!0,clearTimeout(this._checkStuckTimer)},ToMSE.prototype._onMediaError=function(e){var t="Media Error";this._video&&this._video.error&&(t="code="+this._video.error.code+",message="+this._video.error.message),this._onError(t)},ToMSE.prototype._onError=function(e){this.onError&&this.onError(new a.DyMediaError(e))},ToMSE.prototype._onExtraData=function(e){this.onExtraData&&this.onExtraData(e)},ToMSE.prototype._checkTracksReady=function(){var e=this,t=Object.keys(this._tracks)[0];if(!t)return!1;var r=this._tracks[t];if(!r||0===r.length)return!1;var n=r[0].trackLength,i=Object.keys(this._tracks).map(function(t){return e._tracks[t][0]}).map(function(e){return e&&e.config.mimeType}).filter(function(e){return e});return i.length!==n?(l.log("tracks not ready, trackLength="+n+", now we have ["+i.join(",")+"], waiting..."),!1):(l.log("tracks are ready, trackLength="+n+", now we have ["+i.join(",")+"]"),!0)},ToMSE.prototype.T_ADV_Timestamp=function(){if(this._video){var e=this._video;if(0==e.buffered.length)return;return{bufferLength:e.buffered.end(0)-e.currentTime,ptsTimestamp:this.preTimestamp,seiTimestamp:this.seiTimestamp,keyframes:this._keyframes.concat()}}},ToMSE}(u.MediaHandler);t.ToMSE=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=function(e,t,r){var n,i,o,a,s=0;r||(r={});var u=function later(){s=!1===r.leading?0:performance.now(),n=null,a=e.apply(i,o),n||(i=o=null)},c=function throttled(){var c=performance.now();s||!1!==r.leading||(s=c);var d=t-(c-s);return i=this,o=arguments,d<=0||d>t?(n&&(clearTimeout(n),n=null),s=c,a=e.apply(i,o),n||(i=o=null)):n||!1===r.trailing||(n=setTimeout(u,d)),a};return c.cancel=function(){clearTimeout(n),s=0,n=i=o=null},c}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function MediaHandler(e){this._destroyed=!1,this._mediaInfo={fps:0,width:100,height:100,audioMimeType:"",videoMimeType:"",audioDataRate:0,videoDataRate:0,mimeType:"",metadata:{}},this._config=e}return MediaHandler.prototype.dispose=function(){this.detach(),this.onMediaInfo=void 0,this.onHasKeyframe=void 0,this.onExtraData=void 0,this.onError=void 0,this._destroyed=!0},MediaHandler.prototype.appendData=function(e){this._destroyed||"CFG"===e.flag&&this._updateMediaInfo(e.config)},MediaHandler.prototype._updateMediaInfo=function(e){"audio"===e.type&&(void 0!==e.dataRate&&(this._mediaInfo.audioDataRate=e.dataRate),this._mediaInfo.audioMimeType=e.mimeType),"video"===e.type&&(void 0!==e.dataRate&&(this._mediaInfo.videoDataRate=e.dataRate),this._mediaInfo.videoMimeType=e.mimeType,this._mediaInfo.fps=e.fps,this._mediaInfo.width=e.codecWidth,this._mediaInfo.height=e.codecHeight),this._mediaInfo.mimeType=[this._mediaInfo.audioMimeType,this._mediaInfo.videoMimeType].filter(function(e){return e}).join(","),this.onMediaInfo(this._mediaInfo)},MediaHandler}();t.MediaHandler=n}])},"78d92f":function(e,t,r){"use strict";var n=r("875bc2"),i=r("6f9279"),o=r("ab02b7"),a=r("6e4ceb");var s=function(){function baseStreamPlayer(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,baseStreamPlayer),this.config=e,Object(a.setAuth)(e.auth||""),Object(a.setDid)(e.did||""),Object(a.setfrom)(e.from||""),Object(a.setAid)(e.aid||"");var t=e.errBackFunction,r=e.onreadyBackFunction,n=e.complateBackFunction,i=e.seiDateHandle,s=e.useSysTem,u=void 0!==s&&s,c=e.videoType,d=void 0===c?2:c,l=e.onCanAutoPlay,f=e.stramDataCallback,h=e.ticktDataCallback;this.errBackFunction=t,this.onreadyBackFunction=r,this.complateBackFunction=n,this.seiDateHandle=i,this.onCanAutoPlay=l,this.stramDataCallback=f,this.useSysTem=u,this.videoType=d,this.ticktDataCallback=h,this.video=document.createElement("video"),this.video.style.width="100%",this.video.style.height="100%",this.video.style.position="absolute",this.video.style.top=0,this.video.id="__video3",u&&(this.video.controls="controls"),e.dom.appendChild(this.video),Object(a.bindAll)(this,baseStreamPlayer.prototype),Object(a.bindAll)(this),o.EventBus.on("encryptionOK",this.starqustURL),o.EventBus.on("streamTicktdata",this.streamTicktdata),o.EventBus.on("streamdata",this.stramDataCallbackHandle),o.EventBus.on("playURL",this.videoPlayHandle)}return baseStreamPlayer.prototype.videoPlayHandle=function videoPlayHandle(e){e&&this.videoPlay(e)},baseStreamPlayer.prototype.stramDataCallbackHandle=function stramDataCallbackHandle(e){this.stramDataCallback&&this.stramDataCallback(e)},baseStreamPlayer.prototype.streamTicktdata=function streamTicktdata(e){this.ticktDataCallback&&this.ticktDataCallback(e)},baseStreamPlayer.prototype.gotoAndPlayer=function gotoAndPlayer(){},baseStreamPlayer.prototype.play=function play(e){this.disposePlayer();var t=e.type,r=e.url,n=e.p2pType,o=e.rid;if(Object(a.setRid)(o),1===this.videoType)this.video.src=r;else if(2===this.videoType)0===t?this.videoPlay(r,n):1===t&&(console.log("\u8bf7\u6c42\u52a0\u5bc6\u4e32"),Object(i.default)());else;},baseStreamPlayer.prototype.videoPlay=function videoPlay(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e&&0!==e.indexOf("rtmp")&&(this.player=Object(n.createPlayer)(e,{p2p:r,hasVideo:void 0}),this.player.attachMedia(this.video),this.player.on(n.PlayerEvents.FIRST_FRAME,function(e){t.onreadyBackFunction&&t.onreadyBackFunction(e),t.player&&t.player.play()}),this.player.on(n.PlayerEvents.ERROR,function(e){t.onSteamError&&t.onSteamError(e)}),this.player.on(n.PlayerEvents.ON_SEI,function(e){t.seiDateHandle&&t.seiDateHandle(e)}),this.player.on(n.PlayerEvents.COMPLETE,function(e){t.complateBackFunction&&t.complateBackFunction(e)}),this.player.on(n.PlayerEvents.CANAUTO_PLAY,function(e){t.onCanAutoPlay&&t.onCanAutoPlay(e)}),this.player.load(),this.player.volume(0),this.player.play())},baseStreamPlayer.prototype.onSteamError=function onSteamError(){},baseStreamPlayer.prototype.onFirstFrame=function onFirstFrame(){console.log("onFirstFrame")},baseStreamPlayer.prototype.onReady=function onReady(){console.log("onReady")},baseStreamPlayer.prototype.starqustURL=function starqustURL(e){console.log("\u6536\u5230\u52a0\u5bc6\u4e32\u4e8b\u4ef6\u542f\u52a8\u6d41\u5730\u5740\u8bf7\u6c42"+e.qs),e.type?(console.log("\u5f00\u59cb\u8bf7\u6c42\u95e8\u7968\u6d41\u5730\u57400"),Object(a.httpClientLoadTicrtStremUrl)(e.qs,e.t1)):Object(a.httpClientLoadStremUrl)(e.qs,e.t1)},baseStreamPlayer.prototype.setVolue=function setVolue(e){this.player&&this.player.volume(e)},baseStreamPlayer.prototype.disposePlayer=function disposePlayer(){var e=this;this.player&&(this.player.off(n.PlayerEvents.FIRST_FRAME,function(t){e.onreadyBackFunction&&e.onreadyBackFunction(t),e.player&&e.player.play()}),this.player.off(n.PlayerEvents.ERROR,function(t){e.onSteamError&&e.onSteamError(t)}),this.player.off(n.PlayerEvents.ON_SEI,function(t){e.seiDateHandle&&e.seiDateHandle(t)}),this.player.off(n.PlayerEvents.COMPLETE,function(t){e.complateBackFunction&&e.complateBackFunction(t)}),this.player.off(n.PlayerEvents.CANAUTO_PLAY,function(t){e.onCanAutoPlay&&e.onCanAutoPlay(t)}),this.player.pause(),this.player.dispose(),this.player=null)},baseStreamPlayer.prototype.dispose=function dispose(){var e=this;this.player&&(this.player.off(n.PlayerEvents.FIRST_FRAME,function(t){e.onreadyBackFunction&&e.onreadyBackFunction(t),e.player&&e.player.play()}),this.player.off(n.PlayerEvents.ERROR,function(t){e.onSteamError&&e.onSteamError(t)}),this.player.off(n.PlayerEvents.ON_SEI,function(t){e.seiDateHandle&&e.seiDateHandle(t)}),this.player.off(n.PlayerEvents.COMPLETE,function(t){e.complateBackFunction&&e.complateBackFunction(t)}),this.player.off(n.PlayerEvents.CANAUTO_PLAY,function(t){e.onCanAutoPlay&&e.onCanAutoPlay(t)}),this.player.pause(),this.player.dispose(),this.player=null),o.EventBus.off("encryptionOK",this.starqustURL),o.EventBus.off("streamdata",this.stramDataCallbackHandle),o.EventBus.off("playURL",this.videoPlayHandle),o.EventBus.off("streamTicktdata",this.streamTicktdata),this.video=null},baseStreamPlayer.prototype.stop=function stop(){this.player&&this.player.pause()},baseStreamPlayer.prototype.setParentDom=function setParentDom(e){this.video&&e.appendChild(this.video)},baseStreamPlayer}();t.default=s},"875bc2":function(e,t,r){"use strict";r.d(t,"createPlayer",function(){return createPlayer}),r.d(t,"PlayerEvents",function(){return i});var n=r("e4a48e");function createPlayer(e,t){return new n.FlvPlayer(e,t)}var i={ERROR:"ERROR",FIRST_FRAME:"FIRST_FRAME",READY:"READY",BUFFER_EMPTY:"BUFFER_EMPTY",BUFFER_FULL:"BUFFER_FULL",BUFFER_PROGRESS:"BUFFER_PROGRESS",COMPLETE:"COMPLETE",DURATION_CHANGE:"DURATION_CHANGE",CANAUTO_PLAY:"CANAUTO_PLAY",ON_SEI:"ON_SEI",ON_AAC_DATA:"ON_AAC_DATA",ON_RESIZE:"ON_RESIZE"}},"97c911":function(e,t,r){"use strict";r.d(t,"Player",function(){return a});var n=r("bf30b2"),i=r("875bc2"),o=r("6e4ceb");function _inherits(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}return e}(e,t))}var a=function(e){function Player(t,r){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Player);var n=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this));return n.tag="Player",n.ready=!1,n.src=t,n.options=r,Object(o.bindAll)(n,Player.prototype),Object(o.bindAll)(n),n}return _inherits(Player,e),Player.prototype.attachMedia=function attachMedia(e){this.video=e,this.video.ondurationchange=this.ondurationchange,this.video.onended=this.onended,this.video.onprogress=this.onprogress,this.video.onwaiting=this.onwaiting,this.video.onseeking=this.onseeking,this.video.onseeked=this.onseeked,this.video.oncanplay=this.oncanplay,this.video.addEventListener("resize",this.onresize)},Player.prototype.detachMedia=function detachMedia(){this.removeAllListeners(),this.video=null},Player.prototype.removeAllListeners=function removeAllListeners(t){e.prototype.removeAllListeners.call(this,t),this.video&&(this.video.ondurationchange=void 0,this.video.onended=void 0,this.video.onprogress=void 0,this.video.onwaiting=void 0,this.video.onseeking=void 0,this.video.onseeked=void 0,this.video.oncanplay=void 0,this.video=void 0)},Player.prototype.ondurationchange=function ondurationchange(){this.emit(i.PlayerEvents.DURATION_CHANGE,this.video.duration)},Player.prototype.onended=function onended(){this.emit(i.PlayerEvents.COMPLETE)},Player.prototype.onprogress=function onprogress(){this.emit(i.PlayerEvents.BUFFER_PROGRESS)},Player.prototype.onwaiting=function onwaiting(){this.emit(i.PlayerEvents.BUFFER_EMPTY)},Player.prototype.oncanplay=function oncanplay(){this.emit(i.PlayerEvents.BUFFER_FULL),this.ready||(this.ready=!0,this.emit(i.PlayerEvents.READY))},Player.prototype.onresize=function onresize(){this.emit(i.PlayerEvents.ON_RESIZE)},Player.prototype.onseeking=function onseeking(){},Player.prototype.onseeked=function onseeked(){},Player.prototype.onerror=function onerror(){},Player.prototype.load=function load(){},Player.prototype.play=function play(){var e=this;if(this.video){var t=this.video.play();t&&t.catch(function(t){var r=t.toString();-1===r.indexOf("play() failed because the user didn't interact with the document first")&&-1===r.indexOf("The play method is not allowed by the user agent or the platform in the current context, possibly because the user denied permission")||e.emit(i.PlayerEvents.CANAUTO_PLAY)})}},Player.prototype.pause=function pause(){this.video&&this.video.pause()},Player.prototype.seek=function seek(e){this.video&&this.ready&&(this.video.currentTime=e)},Player.prototype.dispose=function dispose(){this.ready=!1,this.removeAllListeners(),this.detachMedia()},Player.prototype.volume=function volume(e){return"number"!==typeof e?this.video?this.video.volume:1:(this.video&&(this.video.volume=e),1)},Player.prototype.getPlayTime=function getPlayTime(){return this.video?this.video.currentTime:0},Player.prototype.getBuffered=function getBuffered(){return this.video&&this.video.buffered.length>0?this.video.buffered.end(this.video.buffered.length-1):0},Player.prototype.getVideoWidth=function getVideoWidth(){return this.video?this.video.videoWidth:0},Player.prototype.getVideoHeight=function getVideoHeight(){return this.video?this.video.videoHeight:0},Player.prototype.getPlayerStat=function getPlayerStat(){return{mediaInfo:this.mediaInfo,statInfo:this.statInfo}},Player.prototype._error=function _error(e){var t=this;Object(o.callLater)(function(){t.emit(i.PlayerEvents.ERROR,e)})},Player}(n.EventEmitter)},a2f972:function(e,t,r){"use strict";r.d(t,"ClientBarrageEvent",function(){return f}),r.d(t,"ClientBarrage",function(){return h});var n=r("bf30b2"),i=r("58608f"),o=r("c76af3"),a=r("b1962d"),s=r("d3462b"),u=r("391742"),c=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();function _inherits(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}return e}(e,t))}var d="ClientBarrage",l=Object(i.makeLogger)(d),f={LOGIN_SUCCESS:"LOGIN_SUCCESS"},h=function(e){function ClientBarrage(t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ClientBarrage);var r=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this));return Object(a.bindAll)(r),r.client=t,r.conn=null,r.isJoinGroup=!1,r._keepLiveInterval=0,r._keepLiveTime=45,r.ip="",r.port=0,r.serverId=0,r.hadLoginRes=!1,r}return _inherits(ClientBarrage,e),ClientBarrage.prototype.connect=function connect(e,t){this.ip=e,this.port=t,this.conn=new s.TcpClient(d),this.conn.on(s.TcpClientEvent.OPEN,this._onOpen),this.conn.on(s.TcpClientEvent.CLOSE,this._onClose),this.conn.on(s.TcpClientEvent.ERROR,this._onError),this.conn.on(s.TcpClientEvent.MESSAGE,this._onMessage),this.conn.connect(e,t)},ClientBarrage.prototype.close=function close(){clearInterval(this._keepLiveInterval),this.isConnected&&this._userLogout(),this.removeAllListeners(),this.conn&&(this.conn.close(),this.conn=null)},ClientBarrage.prototype.userJoinGroup=function userJoinGroup(){!this.isJoinGroup&&this.isConnected&&void 0!==this.client.gid&&this._sendmsg(o.FlashData.encode({type:"joingroup",rid:this.client.roomid,gid:this.client.gid}))&&(this.isJoinGroup=!0)},ClientBarrage.prototype._subscribeProtocol=function _subscribeProtocol(e){var t=e;t.mt=o.FlashData.encodeArray(t.mt),this._sendmsg(o.FlashData.encode(t))},ClientBarrage.prototype._onOpen=function _onOpen(){this._userLogin()},ClientBarrage.prototype._onClose=function _onClose(){this.close(),this.emit("barrageErr")},ClientBarrage.prototype._onError=function _onError(){this.close(),this.emit("barrageErr")},ClientBarrage.prototype._onMessage=function _onMessage(e){var t=o.FlashData.decode(e).too(),r=t.type;switch("keeplive"!=r&&"chatmessage"!=r&&"donateres"!=r&&"dgn"!=r&&"dgb"!=r&&"chatmsg"!=r&&"mrkl"!=r&&l.log("socetSDK\u5f39\u5e55\u7f51\u7edc\u6570\u636e ["+e+"]"),Object(a.msgDMhandle)(t),r){case"loginres":this._onLoginres(t);break;case"cpb":this._cpb(t);break;case"mrkl":this._onKeepLive(t)}},ClientBarrage.prototype._userLogin=function _userLogin(){this._sendmsg(o.FlashData.encode({type:"loginreq",username:this.client.username,password:"1234567890123456",roomid:this.client.roomid,dfl:this.client.dfl,ver:u.SERVER_VERSION,aver:u.VERSION,ct:this.client.ct}))},ClientBarrage.prototype._sendmsg=function _sendmsg(e){return this.isConnected?(this.conn.sendmsg(e),l.log("send "+e),!0):(l.warn("tcp client not connected, send failed : "+e),!1)},ClientBarrage.prototype._userLogout=function _userLogout(){this._sendmsg(o.FlashData.encode({type:"logout"}))},ClientBarrage.prototype._onLoginres=function _onLoginres(e){l.log("dmlgsuccess"),this.serverId=e.sid,this._keepLiveInterval&&clearInterval(this._keepLiveInterval),this._keepLiveInterval=setInterval(this._keepLive,1e3*this._keepLiveTime),setTimeout(this.userJoinGroup,1e3),this.hadLoginRes||(this.hadLoginRes=!0),this.emit(f.LOGIN_SUCCESS)},ClientBarrage.prototype._keepLive=function _keepLive(){this._sendmsg(o.FlashData.encode({type:"mrkl"}))},ClientBarrage.prototype._onKeepLive=function _onKeepLive(){},ClientBarrage.prototype._onServerError=function _onServerError(){this.close(),this.emit("barrageErr")},c(ClientBarrage,[{key:"isConnected",get:function get(){return!(!this.conn||!this.conn.isConnected)}}]),ClientBarrage}(n.EventEmitter)},a3f4ba:function(e,t,r){"use strict";r.d(t,"default",function(){return u});var n=r("eb3e22"),i=r("bd1ae8"),o=r("b1962d"),a=r("58608f"),s=r("a8f907");var u=function(){function socketSdk(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,socketSdk);var t=e.rid,r=e.did,n=e.wgMessageHandle,i=e.dmMessageHandle,a=e.onerrHandle,s=e.whiteMsgList;this.config=e,this.did=r,this.rid=t,Object(o.setWGMsgback)(n),Object(o.setDMMsgback)(i),Object(o.setConfig)(this.config),Object(o.setWhiteMsgList)(s),this.getGateWay(),this.onerrHandle=a}return socketSdk.prototype.getGateWay=function getGateWay(){var e=this,t=Object(o.getConfig)().did,r=parseInt((new Date).getTime()/1e3,10),i=Object(o.getConfig)().rid;try{n.httpClient.post(String,"/lapi/live/gateway/web/"+i+"?isH5="+Number(1),window[Object(s.default)(256042,"9f4f419501570ad13334")](i,t,r)).subscribe(function(t){parseInt(t.error,10)||(e.gateWay=JSON.parse(t.data).wss,e.getGateWayOk=!0),e.connectServer()})}catch(e){this.onerrHandle&&this.onerrHandle()}},socketSdk.prototype.connectServer=function connectServer(){if(this.getGateWayOk)if(this.gateWay.length>0){var e=this.gateWay;if(e&&e.length>0){var t=e[Math.floor(Math.random()*e.length)];this.client&&this.client.close(),this.client=new i.Client,this.client.connect(t.domain,t.port),this.client.on(i.ClientEvent.OPEN,this.onClientOpen),this.client.on(i.ClientEvent.ERROR,this.onClientError),this.client.on(i.ClientEvent.LOGIN,this.onClientLogin),this.client.on("barrageErr",this.barrageErr)}else a.default.log("no server info"),this.connectWsProxyServer()}else this.connectWsProxyServer()},socketSdk.prototype.barrageErr=function barrageErr(){this.onerrHandle()&&this.onerrHandle()},socketSdk.prototype.connectWsProxyServer=function connectWsProxyServer(){var e=this.config.h5wsproxy;if(e)if((e=e.toJS()).length>0){var t=e[Math.floor(e.length*Math.random())];this.client&&this.client.close(),this.client=new i.Client,this.client.connect(t.domain,t.port,!0),this.client.on(i.ClientEvent.OPEN,this.onClientOpen),this.client.on(i.ClientEvent.ERROR,this.onProxyClientError)}else this.onerrHandle&&this.onerrHandle({msg:"\u5907\u7528\u7f51\u5173\u4e3a\u7a7a"});else this.onerrHandle&&this.onerrHandle({msg:"\u5907\u7528\u7f51\u5173\u4e3a\u7a7a"})},socketSdk.prototype.onClientOpen=function onClientOpen(){clearInterval(this.checkOnlineInterval),this.checkOnlineInterval=setInterval(this.checkOnline,1e3*this.checkOnlineTime)},socketSdk.prototype.onClientError=function onClientError(){a.default.log("connect gateserver error!"),this.connectWsProxyServer()},socketSdk.prototype.onClientLogin=function onClientLogin(){},socketSdk.prototype.onProxyClientError=function onProxyClientError(){this.onerrHandle&&this.onerrHandle({msg:"\u5907\u7528\u7f51\u5173\u4e3a\u5931\u8d25"})},socketSdk.prototype.checkOnline=function checkOnline(){this.client&&(this.client.isConnected?this.client.barrage&&!this.client.barrage.isConnected&&(a.default.log("you barrage are offline, reconnecting..."),this.client.connectBarrage()):(a.default.log("you client are offline, reconnecting..."),this.connectServer()))},socketSdk.prototype.onCancelReconnect=function onCancelReconnect(){clearInterval(this.checkOnlineInterval)},socketSdk.prototype.onUserLogin=function onUserLogin(){var e;this.client?(e=this.client)._userLogin.apply(e,arguments):a.default.warn("client not ready, send failed : onUserLogin")},socketSdk.prototype.onUserLogout=function onUserLogout(){this.client?this.client.close():a.default.warn("client not ready, send failed : onUserLogout")},socketSdk.prototype.onNewClient=function onNewClient(){this.connectServer()},socketSdk.prototype.onReConnectDanmu=function onReConnectDanmu(){null!==this.client&&null!==this.client.conn||this.connectServer()},socketSdk.prototype.dispose=function dispose(){this.client&&this.client.close(),this.client=null},socketSdk}()},a8f907:function(e,t,r){"use strict";var i=function(e,t){var r={},n=r.lib={},i=function n(){},o=n.Base={extend:function extend(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function create(){var e=this.extend();return e.init.apply(e,arguments),e},init:function init(){},mixIn:function mixIn(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function clone(){return this.init.prototype.extend(this)}},a=n.WordArray=o.extend({init:function init(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function toString(e){return(e||u).stringify(this)},concat:function concat(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var i=0;i<e;i++)t[n+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(n+i)%4*8;else if(65535<r.length)for(i=0;i<e;i+=4)t[n+i>>>2]=r[i>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function clamp(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function clone(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function random(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return new a.init(r,t)}}),s=r.enc={},u=s.Hex={stringify:function stringify(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var i=t[n>>>2]>>>24-n%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function parse(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},c=s.Latin1={stringify:function stringify(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function parse(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},d=s.Utf8={stringify:function stringify(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function parse(e){return c.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=o.extend({reset:function reset(){this._data=new a.init,this._nDataBytes=0},_append:function _append(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function _process(t){var r=this._data,n=r.words,i=r.sigBytes,o=this.blockSize,s=i/(4*o);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,i=e.min(4*t,i),t){for(var u=0;u<t;u+=o)this._doProcessBlock(n,u);u=n.splice(0,t),r.sigBytes-=i}return new a.init(u,i)},clone:function clone(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:o.extend(),init:function init(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function reset(){l.reset.call(this),this._doReset()},update:function update(e){return this._append(e),this._process(),this},finalize:function finalize(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function _createHelper(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function _createHmacHelper(e){return function(t,r){return new f.HMAC.init(e,r).finalize(t)}}});var f=r.algo={};return r}(Math);function d449207d(e,t){var r=0,n=e[0],i=e[1],o=3337565984,a=t[0],s=t[1],u=t[2],c=t[3];for(r=0;r<32;r++)n-=((i-=(n<<4)+u^n+o^(n>>>5)+c)<<4)+a^i+o^(i>>>5)+s,o-=2654435769;return e[0]=n,e[1]=i,e}function f5a40d76(e,t,r){for(var n=0;n<e.length;n+=2){var i,o=e[n],a=e[n+1],s=2654435769*t;for(i=0;i<t;i++)o-=((a-=(o<<4^o>>>5)+o^s+r[s>>>11&3])<<4^a>>>5)+a^(s-=2654435769)+r[3&s];return e[n]=o,e[n+1]=a,e}}function c09599c4(e,t,r){var n,i,o,a,s,u;o=2654435769*(s=Math.floor(6+52/t)),n=e[0];do{for(u=o>>>2&3,a=t-1;a>0;a--)i=e[a-1],n=e[a]-=(i>>>5^n<<2)+(n>>>3^i<<4)^(o^n)+(r[3&a^u]^i);i=e[t-1],n=e[0]-=(i>>>5^n<<2)+(n>>>3^i<<4)^(o^n)+(r[3&a^u]^i),o-=2654435769}while(--s);return e}!function(e){function p(e,t,r,n,i,o,a){return((e=e+(t&r|~t&n)+i+a+1)<<o|e>>>32-o)+t}function m(e,t,r,n,i,o,a){return((e=e+(t&n|r&~n)+i+a-1)<<o|e>>>32-o)+t}function l(e,t,r,n,i,o,a){return((e=e+(t^r^n)+i+a+1)<<o|e>>>32-o)+t}function n(e,t,r,n,i,o,a){return((e=e+(r^(t|~n))+i+a-1)<<o|e>>>32-o)+t}for(var t=i,r=(a=t.lib).WordArray,o=a.Hasher,a=t.algo,s=[],u=0;64>u;u++)s[u]=4294967296*e.abs(e.sin(u+1))|0;a=a.MD5=o.extend({_doReset:function _doReset(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function _doProcessBlock(e,t){for(var r=0;16>r;r++){var i=e[u=t+r];e[u]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}r=this._hash.words;var o,a,u=e[t+0],c=(i=e[t+1],e[t+2]),d=e[t+3],f=e[t+4],h=e[t+5],_=e[t+6],y=e[t+7],g=e[t+8],v=e[t+9],b=e[t+10],E=e[t+11],w=e[t+12],P=e[t+13],k=e[t+14],S=e[t+15],M=r[0],A=n(A=n(A=n(A=n(A=l(A=l(A=l(A=l(A=m(A=m(A=m(A=m(A=p(A=p(A=p(A=p(A=r[1],a=p(a=r[2],o=p(o=r[3],M=p(M,A,a,o,u,7,s[0]),A,a,i,12,s[1]),M,A,c,17,s[2]),o,M,d,22,s[3]),a=p(a,o=p(o,M=p(M,A,a,o,f,7,s[4]),A,a,h,12,s[5]),M,A,_,17,s[6]),o,M,y,22,s[7]),a=p(a,o=p(o,M=p(M,A,a,o,g,7,s[8]),A,a,v,12,s[9]),M,A,b,17,s[10]),o,M,E,22,s[11]),a=p(a,o=p(o,M=p(M,A,a,o,w,7,s[12]),A,a,P,12,s[13]),M,A,k,17,s[14]),o,M,S,22,s[15]),a=m(a,o=m(o,M=m(M,A,a,o,i,5,s[16]),A,a,_,9,s[17]),M,A,E,14,s[18]),o,M,u,20,s[19]),a=m(a,o=m(o,M=m(M,A,a,o,h,5,s[20]),A,a,b,9,s[21]),M,A,S,14,s[22]),o,M,f,20,s[23]),a=m(a,o=m(o,M=m(M,A,a,o,v,5,s[24]),A,a,k,9,s[25]),M,A,d,14,s[26]),o,M,g,20,s[27]),a=m(a,o=m(o,M=m(M,A,a,o,P,5,s[28]),A,a,c,9,s[29]),M,A,y,14,s[30]),o,M,w,20,s[31]),a=l(a,o=l(o,M=l(M,A,a,o,h,4,s[32]),A,a,g,11,s[33]),M,A,E,16,s[34]),o,M,k,23,s[35]),a=l(a,o=l(o,M=l(M,A,a,o,i,4,s[36]),A,a,f,11,s[37]),M,A,y,16,s[38]),o,M,b,23,s[39]),a=l(a,o=l(o,M=l(M,A,a,o,P,4,s[40]),A,a,u,11,s[41]),M,A,d,16,s[42]),o,M,_,23,s[43]),a=l(a,o=l(o,M=l(M,A,a,o,v,4,s[44]),A,a,w,11,s[45]),M,A,S,16,s[46]),o,M,c,23,s[47]),a=n(a,o=n(o,M=n(M,A,a,o,u,6,s[48]),A,a,y,10,s[49]),M,A,k,15,s[50]),o,M,h,21,s[51]),a=n(a,o=n(o,M=n(M,A,a,o,w,6,s[52]),A,a,d,10,s[53]),M,A,b,15,s[54]),o,M,i,21,s[55]),a=n(a,o=n(o,M=n(M,A,a,o,g,6,s[56]),A,a,S,10,s[57]),M,A,_,15,s[58]),o,M,P,21,s[59]),a=n(a,o=n(o,M=n(M,A,a,o,f,6,s[60]),A,a,E,10,s[61]),M,A,c,15,s[62]),o,M,v,21,s[63]);r[0]=r[0]+M|0,r[1]=r[1]+A|0,r[2]=r[2]+a|0,r[3]=r[3]+o|0},_doFinalize:function _doFinalize(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296);for(r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(r.length+1),this._process(),r=(t=this._hash).words,n=0;4>n;n++)i=r[n],r[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function clone(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),t.MM=o._createHelper(a),t.HmacMD5=o._createHmacHelper(a)}(Math);var o=new TextDecoder;t.default=function d539fa2cf7732d2a(e,t){for(var r=i.MM(e.toString()).toString(),n=(r.length,r[0].charCodeAt(0)),a=r[16].charCodeAt(0),s=[],u=0;u<4;u++)s[u]=n<<24|n<<16|n<<8|n,s[u+4]=a<<24|a<<16|a<<8|a;var c=Math.floor(t.length/16)%4,d=[],l=t.length%8,f=Math.floor(t.length/8);for(u=0;u<f;u++)d[u]=255&parseInt(t.substr(8*u,2),16)|parseInt(t.substr(8*u+2,2),16)<<8&65280|parseInt(t.substr(8*u+4,2),16)<<24>>>8|parseInt(t.substr(8*u+6,2),16)<<24;var h=[];h=0==c?function e86500e2(e,t){for(var r=Math.floor(e.length/2),n=e.slice(0),i=0;i<r;i++){var o=d449207d(e.slice(2*i,2*i+2),t.slice(4*i%8,4*i%8+4));n[2*i+0]=o[0],n[2*i+1]=o[1]}return n}(d,s):1==c?function c30070a4(e,t){for(var r=Math.floor(e.length/2),n=e.slice(0),i=0;i<r;i++){var o=f5a40d76(e.slice(2*i,2*i+2),32,t.slice(4*i%8,4*i%8+4));n[2*i+0]=o[0],n[2*i+1]=o[1]}return n}(d,s):function d831eb20(e,t){for(var r=Math.floor(e.length/2),n=e.slice(0),i=0;i<r;i++){var o=c09599c4(e.slice(2*i,2*i+2),2,t.slice(4*i%8,4*i%8+4));n[2*i+0]=o[0],n[2*i+1]=o[1]}return n}(d,s);var p=[];for(u=0;u<h.length;u++){var _=255&h[u],y=h[u]>>>8&255,m=h[u]>>>16&255,g=h[u]>>>24&255;_&&p.push(_),y&&p.push(y),m&&p.push(m),g&&p.push(g)}var v=Math.floor(l/2);for(u=0;u<v;u++)p.push(255&parseInt(t.substr(8*f+2*u,2),16));return o.decode(new Uint8Array(p))}},ab02b7:function(e,t,r){"use strict";r.d(t,"EventBus",function(){return o});var n=r("3d8740"),i={},o={on:function on(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).once;e&&(i[e]||(i[e]=[]),i[e].push({listener:t,once:r}))},off:function off(e,t){i[e]&&(i[e]=i[e].filter(function(e){return e.listener!==t}))},once:function once(e,t){this.on(e,t,{once:!0})},emit:function emit(e){for(var t=this,r=arguments.length,o=Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];i[e]&&i[e].every(function(r){if(r.listener)try{var i=r.listener.apply(null,o);return r.once&&t.off(e,r.listener),!i}catch(t){n.default.warn("Event emit error",e,t)}return!0})},clear:function clear(){i={}}}},b1962d:function(e,t,r){"use strict";r.d(t,"bindAll",function(){return bindAll}),r.d(t,"getUnixTimestamp",function(){return getUnixTimestamp}),r.d(t,"md5",function(){return md5}),r.d(t,"setConfig",function(){return setConfig}),r.d(t,"getConfig",function(){return getConfig}),r.d(t,"getInt",function(){return getInt}),r.d(t,"setWhiteMsgList",function(){return setWhiteMsgList}),r.d(t,"setWGMsgback",function(){return setWGMsgback}),r.d(t,"msgWGhandle",function(){return msgWGhandle}),r.d(t,"setDMMsgback",function(){return setDMMsgback}),r.d(t,"msgDMhandle",function(){return msgDMhandle});var n=r("ee2152");function bindAll(e,t){void 0===t&&(t=Object.getPrototypeOf(e)),Object.getOwnPropertyNames(t).forEach(function(t){var r=e[t];"function"===typeof r&&(e[t]=r.bind(e))})}function getUnixTimestamp(){return parseInt((new Date).getTime()/1e3,10)}function md5(e){return n.CryptoJS.MD5(e).toString()}var i={};function setConfig(e){i=e}function getConfig(){return i}function getInt(e,t){var r=parseInt(e[t],10);return Number.isNaN(r)&&(r=0),r}var o=void 0;function setWhiteMsgList(e){o=e}var a=void 0;function setWGMsgback(e){a=e}function msgWGhandle(e){if(a)if(o){var t=e.type||"";o.indexOf(t)>-1&&a(e)}else a(e)}var s=void 0;function setDMMsgback(e){s=e}function msgDMhandle(e){if(s)if(o){var t=e.type||"";o.indexOf(t)>-1&&s(e)}else s(e)}},bd1ae8:function(e,t,r){"use strict";var n=r("f76270");r.o(n,"Client")&&r.d(t,"Client",function(){return n.Client}),r.o(n,"ClientEvent")&&r.d(t,"ClientEvent",function(){return n.ClientEvent})},c76af3:function(e,t,r){"use strict";r.d(t,"FlashData",function(){return s});var n=r("e0e07c"),i=r.n(n),o=function get(e,t){if("number"===typeof t)return e[t].value;for(var r=void 0,n=e.length,i=0;i<n;i++)if(t===(r=e[i]).key)return r.value},a=function too(e){for(var t=void 0,r={},n=0,i=e.length;n<i;n++)r[(t=e[n]).key]=t.value;return r},s={isArray:function isArray(e){var t=e.match(/\@\S\//g);return!(!t||1===t.length)},get:o,too:a,encode:function encode(e){var t="";function _add(e,r){var n;n=e?_scanStr(e)+"@=":"",t+=n+_scanStr(String(r))+"/"}function _scanStr(e){for(var t="",r=0,n=e.length;r<n;r++)"/"===e.charAt(r)?t+="@S":"@"===e.charAt(r)?t+="@A":t+=e.charAt(r);return t}if(i()(e)){for(var r in e)_add(r,e[r]);return t}if(Array.isArray(e)){for(var n=0,o=e.length;n<o;n++)_add(e[n].name,e[n].value);return t}},decode:function decode(e){var t=[];function _parse(e){var t=[];"/"!=e.charAt(e.length-1)&&(e+="/");for(var r=void 0,n="",i="",o=0,a=e.length;o<a;o++)"/"===e.charAt(o)?(r={key:n,value:i},t.push(r),n=i=""):"@"===e.charAt(o)?(o++,"A"===e.charAt(o)?i+="@":"S"===e.charAt(o)?i+="/":"="===e.charAt(o)&&(n=i,i="")):i+=e.charAt(o);return t}return(e=String(e))&&1===(t=_parse(e)).length&&/@=/g.test(t[0].value)&&(t=_parse(t[0].value)),t.get=function(e){return o(this,e)},t.too=function(){return a(this)},t},toArray:function toArray(e){return e?this.isArray(e)?this.decode(e).map(function(e){return e.value}):[this.encode(this.decode(e).too())]:[]},encodeArray:function encodeArray(e){return e&&0!==e.length?this.encode(e.map(function(e){return{name:"",value:e}})):""}}},d3462b:function(e,t,r){"use strict";r.d(t,"TcpClientEvent",function(){return i});var n=r("d64a12");r.d(t,"TcpClient",function(){return n.TcpClient});var i={OPEN:"open",CLOSE:"close",ERROR:"error",MESSAGE:"message"}},d64a12:function(e,t,r){"use strict";r.d(t,"TcpClient",function(){return u});var n=r("bf30b2"),i=r("d3462b"),o=r("58608f"),a=r("b1962d"),s=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();function _inherits(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}return e}(e,t))}function concat(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(e,t){e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r})}var u=function(e){function TcpClient(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"TcpClient";!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,TcpClient);var r=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this));return r._packLen=0,r._encoder=new TextEncoder,r._decoder=new TextDecoder,r._littleEndian=!0,r._name=t,r._logger=Object(o.makeLogger)(t,"TcpClient"),Object(a.bindAll)(r),r}return _inherits(TcpClient,e),TcpClient.prototype.connect=function connect(e,t){var r="wss://"+e+":"+t;this._socket=new WebSocket(r),this._socket.binaryType="arraybuffer",this._socket.onclose=this._onclose,this._socket.onerror=this._onerror,this._socket.onmessage=this._onmessage,this._socket.onopen=this._onopen,this._logger.log("connecting "+r+" ...")},TcpClient.prototype.close=function close(){this.removeAllListeners(),this._socket.onclose=null,this._socket.onerror=null,this._socket.onmessage=null,this._socket.onopen=null,this.isConnected&&this._socket.close(),this._logger.log("close tcp client")},TcpClient.prototype._onclose=function _onclose(e){this._logger.log("onclose",e),this.emit(i.TcpClientEvent.CLOSE)},TcpClient.prototype._onerror=function _onerror(e){this._logger.error("onerror",e),this.emit(i.TcpClientEvent.ERROR)},TcpClient.prototype._onmessage=function _onmessage(e){var t=e.data;this._buffer?this._buffer=concat(this._buffer,t).buffer:this._buffer=t,this._parsemsg()},TcpClient.prototype._onopen=function _onopen(e){this._logger.log("onopen",e),this.emit(i.TcpClientEvent.OPEN)},TcpClient.prototype.sendmsg=function sendmsg(e){var t=concat(this._encoder.encode(e),[0]),r=8+t.byteLength,n=new DataView(new ArrayBuffer(r+4)),i=this._littleEndian,o=0;n.setUint32(o,r,i),o+=4,n.setUint32(o,r,i),o+=4,n.setInt16(o,689,i),o+=2,n.setInt8(o,0),o+=1,n.setInt8(o,0),o+=1,new Uint8Array(n.buffer).set(t,o),this._socket.send(n.buffer)},TcpClient.prototype._parsemsg=function _parsemsg(){for(;this._buffer&&this._buffer.byteLength>0;){var e=new DataView(this._buffer),t=this._littleEndian;if(0===this._packLen){if(this._buffer.byteLength<4)return;this._packLen=e.getUint32(0,t),this._buffer=this._buffer.slice(4)}if(this._buffer.byteLength<this._packLen)return;var r=this._decoder.decode(this._buffer.slice(8,this._packLen-1));this._buffer=this._buffer.slice(this._packLen),this._packLen=0,this.emit(i.TcpClientEvent.MESSAGE,r)}},s(TcpClient,[{key:"isConnected",get:function get(){return!(!this._socket||1!==this._socket.readyState)}}]),TcpClient}(n.EventEmitter)},e0e07c:function(e,t,r){"use strict";var n=r("48f9fd");function isObjectObject(e){return!0===n(e)&&"[object Object]"===Object.prototype.toString.call(e)}e.exports=function isPlainObject(e){var t,r;return!1!==isObjectObject(e)&&("function"===typeof(t=e.constructor)&&(!1!==isObjectObject(r=t.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf")))}},e4a48e:function(e,t,r){"use strict";r.d(t,"FlvPlayer",function(){return u});var n=r("2df4fb"),i=r("97c911"),o=r("875bc2"),a=r("3d8740"),s=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();function _inherits(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}return e}(e,t))}var u=function(e){function FlvPlayer(t,r){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FlvPlayer);var n=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this,t,r));return n.tag="FlvPlayer",n._createPlayer(t),n}return _inherits(FlvPlayer,e),FlvPlayer.prototype._createPlayer=function _createPlayer(e){var t=this;this.dispose();var r={url:e,enableWorker:!1,debug:!1};this.options&&(void 0!==this.options.hasVideo&&(r.hasVideo=this.options.hasVideo),void 0!==this.options.hasAudio&&(r.hasAudio=this.options.hasAudio)),this.player=new n.LivePlayer(r),this.player&&(this.player.on(n.PlayerEvents.ON_MEDIA_INFO,function(e){a.default.log("ON_MEDIA_INFO: ",e),t.mediaInfo=e}),this.player.on(n.PlayerEvents.ON_FIRST_FRAME,function(){t.emit(o.PlayerEvents.FIRST_FRAME)}),this.player.on(n.PlayerEvents.ON_ERROR,function(e){t._error(e)}),this.player.on(n.PlayerEvents.ON_SEI,function(e){a.default.log("ON_SEI: ",e),5===e.seiType&&e.seiData.uuid,t.emit(o.PlayerEvents.ON_SEI,e)}),this.player.on(n.PlayerEvents.ON_AAC_DATA,function(e){a.default.log("ON_AAC_DATA: ",e);var r=Date.now();r-(t.aacTimeFlag||0)>1e3&&(t.emit(o.PlayerEvents.ON_AAC_DATA,e),t.aacTimeFlag=r)}))},FlvPlayer.prototype.attachMedia=function attachMedia(t){e.prototype.attachMedia.call(this,t),this.player&&this.player.attach(t)},FlvPlayer.prototype.detachMedia=function detachMedia(){this.player&&this.player.detach(),e.prototype.detachMedia.call(this)},FlvPlayer.prototype.load=function load(){this.player&&this.player.load()},FlvPlayer.prototype.dispose=function dispose(){this.player&&(this.player.dispose(),this.player=null),e.prototype.dispose.call(this)},s(FlvPlayer,[{key:"statInfo",get:function get(){return this.player&&this.player.getStatInfo()}}]),FlvPlayer}(i.Player)},ee2152:function(e,t,r){"use strict";r.d(t,"CryptoJS",function(){return i});var i=i||function(e,t){var r={},n=r.lib={},i=function n(){},o=n.Base={extend:function extend(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function create(){var e=this.extend();return e.init.apply(e,arguments),e},init:function init(){},mixIn:function mixIn(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function clone(){return this.init.prototype.extend(this)}},a=n.WordArray=o.extend({init:function init(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function toString(e){return(e||u).stringify(this)},concat:function concat(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var i=0;i<e;i++)t[n+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(n+i)%4*8;else if(65535<r.length)for(i=0;i<e;i+=4)t[n+i>>>2]=r[i>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function clamp(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function clone(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function random(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return new a.init(r,t)}}),s=r.enc={},u=s.Hex={stringify:function stringify(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var i=t[n>>>2]>>>24-n%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function parse(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},c=s.Latin1={stringify:function stringify(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function parse(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},d=s.Utf8={stringify:function stringify(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function parse(e){return c.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=o.extend({reset:function reset(){this._data=new a.init,this._nDataBytes=0},_append:function _append(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function _process(t){var r=this._data,n=r.words,i=r.sigBytes,o=this.blockSize,s=i/(4*o);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,i=e.min(4*t,i),t){for(var u=0;u<t;u+=o)this._doProcessBlock(n,u);u=n.splice(0,t),r.sigBytes-=i}return new a.init(u,i)},clone:function clone(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=l.extend({cfg:o.extend(),init:function init(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function reset(){l.reset.call(this),this._doReset()},update:function update(e){return this._append(e),this._process(),this},finalize:function finalize(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function _createHelper(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function _createHmacHelper(e){return function(t,r){return new f.HMAC.init(e,r).finalize(t)}}});var f=r.algo={};return r}(Math);!function(e){function p(e,t,r,n,i,o,a){return((e=e+(t&r|~t&n)+i+a)<<o|e>>>32-o)+t}function m(e,t,r,n,i,o,a){return((e=e+(t&n|r&~n)+i+a)<<o|e>>>32-o)+t}function l(e,t,r,n,i,o,a){return((e=e+(t^r^n)+i+a)<<o|e>>>32-o)+t}function n(e,t,r,n,i,o,a){return((e=e+(r^(t|~n))+i+a)<<o|e>>>32-o)+t}for(var t=i,r=(a=t.lib).WordArray,o=a.Hasher,a=t.algo,s=[],u=0;64>u;u++)s[u]=4294967296*e.abs(e.sin(u+1))|0;a=a.MD5=o.extend({_doReset:function _doReset(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function _doProcessBlock(e,t){for(var r=0;16>r;r++){var i=e[u=t+r];e[u]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}r=this._hash.words;var o,a,u=e[t+0],c=(i=e[t+1],e[t+2]),d=e[t+3],f=e[t+4],h=e[t+5],_=e[t+6],y=e[t+7],g=e[t+8],v=e[t+9],b=e[t+10],E=e[t+11],w=e[t+12],P=e[t+13],k=e[t+14],S=e[t+15],M=r[0],A=n(A=n(A=n(A=n(A=l(A=l(A=l(A=l(A=m(A=m(A=m(A=m(A=p(A=p(A=p(A=p(A=r[1],a=p(a=r[2],o=p(o=r[3],M=p(M,A,a,o,u,7,s[0]),A,a,i,12,s[1]),M,A,c,17,s[2]),o,M,d,22,s[3]),a=p(a,o=p(o,M=p(M,A,a,o,f,7,s[4]),A,a,h,12,s[5]),M,A,_,17,s[6]),o,M,y,22,s[7]),a=p(a,o=p(o,M=p(M,A,a,o,g,7,s[8]),A,a,v,12,s[9]),M,A,b,17,s[10]),o,M,E,22,s[11]),a=p(a,o=p(o,M=p(M,A,a,o,w,7,s[12]),A,a,P,12,s[13]),M,A,k,17,s[14]),o,M,S,22,s[15]),a=m(a,o=m(o,M=m(M,A,a,o,i,5,s[16]),A,a,_,9,s[17]),M,A,E,14,s[18]),o,M,u,20,s[19]),a=m(a,o=m(o,M=m(M,A,a,o,h,5,s[20]),A,a,b,9,s[21]),M,A,S,14,s[22]),o,M,f,20,s[23]),a=m(a,o=m(o,M=m(M,A,a,o,v,5,s[24]),A,a,k,9,s[25]),M,A,d,14,s[26]),o,M,g,20,s[27]),a=m(a,o=m(o,M=m(M,A,a,o,P,5,s[28]),A,a,c,9,s[29]),M,A,y,14,s[30]),o,M,w,20,s[31]),a=l(a,o=l(o,M=l(M,A,a,o,h,4,s[32]),A,a,g,11,s[33]),M,A,E,16,s[34]),o,M,k,23,s[35]),a=l(a,o=l(o,M=l(M,A,a,o,i,4,s[36]),A,a,f,11,s[37]),M,A,y,16,s[38]),o,M,b,23,s[39]),a=l(a,o=l(o,M=l(M,A,a,o,P,4,s[40]),A,a,u,11,s[41]),M,A,d,16,s[42]),o,M,_,23,s[43]),a=l(a,o=l(o,M=l(M,A,a,o,v,4,s[44]),A,a,w,11,s[45]),M,A,S,16,s[46]),o,M,c,23,s[47]),a=n(a,o=n(o,M=n(M,A,a,o,u,6,s[48]),A,a,y,10,s[49]),M,A,k,15,s[50]),o,M,h,21,s[51]),a=n(a,o=n(o,M=n(M,A,a,o,w,6,s[52]),A,a,d,10,s[53]),M,A,b,15,s[54]),o,M,i,21,s[55]),a=n(a,o=n(o,M=n(M,A,a,o,g,6,s[56]),A,a,S,10,s[57]),M,A,_,15,s[58]),o,M,P,21,s[59]),a=n(a,o=n(o,M=n(M,A,a,o,f,6,s[60]),A,a,E,10,s[61]),M,A,c,15,s[62]),o,M,v,21,s[63]);r[0]=r[0]+M|0,r[1]=r[1]+A|0,r[2]=r[2]+a|0,r[3]=r[3]+o|0},_doFinalize:function _doFinalize(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296);for(r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(r.length+1),this._process(),r=(t=this._hash).words,n=0;4>n;n++)i=r[n],r[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function clone(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),t.MD5=o._createHelper(a),t.HmacMD5=o._createHmacHelper(a)}(Math),window.CryptoJS=i},f76270:function(e,t,r){"use strict";r.d(t,"ClientEvent",function(){return f}),r.d(t,"Client",function(){return h});var n=r("bf30b2"),i=r("58608f"),o=r("c76af3"),a=r("d3462b"),s=r("a2f972"),u=r("b1962d"),c=r("391742"),d=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();function _inherits(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}return e}(e,t))}var l=Object(i.makeLogger)("Client"),f={OPEN:"open",ERROR:"error",LOGIN:"login"},h=function(e){function Client(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Client);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this));return u.bindAll(t),t.conn=null,t.barrage=null,t.serversBarrage=null,t.roomid="",t.userid="",t.username="",t.nickname="",t.gid="",t.did=u.getConfig().did,t.roomgroup=0,t.ip="",t.port=0,t.dfl="",t._keepLiveInterval=0,t._keepLiveTime=45,t._kd="",t._closeRoomTimer=0,t.isHistoryRequested=!1,t}return _inherits(Client,e),Client.prototype.connect=function connect(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.ip=e,this.port=t,this.is_appa=r,this.conn=new a.TcpClient("Client"),this.conn.on(a.TcpClientEvent.OPEN,this._onOpen),this.conn.on(a.TcpClientEvent.CLOSE,this._onClose),this.conn.on(a.TcpClientEvent.ERROR,this._onError),this.conn.on(a.TcpClientEvent.MESSAGE,this._onMessage),this.conn.connect(e,t)},Client.prototype.connectBarrage=function connectBarrage(){var e=this.serversBarrage;if(e&&e.length>0){var t=e[Math.floor(Math.random()*e.length)],r=o.FlashData.decode(t).too();this.barrage&&this.barrage.close(),this.barrage=new s.ClientBarrage(this),this.barrage.connect(r.ip,r.port),this.barrage.on(s.ClientBarrageEvent.LOGIN_SUCCESS,this.onBarrageLoginSuccess),this.barrage.on("barrageErr",this.barrageErr)}},Client.prototype.barrageErr=function barrageErr(){this.emit("barrageErr")},Client.prototype.onBarrageLoginSuccess=function onBarrageLoginSuccess(){},Client.prototype.close=function close(){clearInterval(this._keepLiveInterval),this.isConnected&&this._userLogout(),this.removeAllListeners(),this.barrage&&(this.barrage.close(),this.barrage=null),this.conn&&(this.conn.close(),this.conn=null)},Client.prototype._onOpen=function _onOpen(){var e="type@=loginreq/username@=/password@=/roomid@="+u.getConfig().rid+"/";this._userLogin(e)},Client.prototype._onClose=function _onClose(){this.close()},Client.prototype._onError=function _onError(){this.emit(f.ERROR),this.close()},Client.prototype._onMessage=function _onMessage(e){var t=o.FlashData.decode(e).too(),r=t.type;switch("keeplive"!=r&&"chatmessage"!=r&&"chatmsg"!=r&&l.log("socketSDK\u7f51\u7edc\u6570\u636e ["+e+"]"),u.msgWGhandle(t),r){case"loginres":this._onLoginres(t,e);break;case"loginqueueres":break;case"msgrepeaterproxylist":this._onMsgRepeater(t);break;case"setmsggroup":this._onSetGroup(t);break;case"memberinfores":this._onMemberInfo(t,e);break;case"keeplive":t.hot}},Client.prototype.__emptyFullCount=function __emptyFullCount(e){e.type="ssr",this._sendmsg(o.FlashData.encode(e))},Client.prototype._sendmsg=function _sendmsg(e){return this.isConnected?(this.conn.sendmsg(e),l.log("send "+e),!0):(l.warn("tcp client not connected, send failed : "+e),!1)},Client.prototype._userLogin=function _userLogin(e){var t=o.FlashData.decode(e).too();this.roomid=t.roomid,this.dfl=t.dfl||"",void 0===t.ct&&(t.ct=4),this.ct=t.ct,t.type="loginreq",t.devid=this.did,t.rt=u.getUnixTimestamp(),t.pt=2,t.vk=u.md5(t.rt+"r5*^5;}2#${XF[h+;'./.Q'1;,-]f'p["+t.devid),t.ver=c.SERVER_VERSION,t.aver=c.VERSION,t.ltkid="",t.biz="",t.stk="",this._sendmsg(o.FlashData.encode(t))},Client.prototype._userLogout=function _userLogout(){this._sendmsg(o.FlashData.encode({type:"logout"}))},Client.prototype._cyecydt=function _cyecydt(e){var t=e;this._sendmsg(o.FlashData.encode(t))},Client.prototype._onLoginres=function _onLoginres(e){this.userid=e.userid,this.username=e.username,this.nickname=e.nickname,this.roomgroup=u.getInt(e,"roomgroup"),this._requestKey(),this._qradsr(),this._keepLiveInterval&&clearInterval(this._keepLiveInterval),this._keepLiveInterval=setInterval(this._keepLive,1e3*this._keepLiveTime),this._keepLive(),this.emit(f.LOGIN)},Client.prototype._onMsgRepeater=function _onMsgRepeater(e){var t=e.list;this.serversBarrage=o.FlashData.toArray(t),this.connectBarrage()},Client.prototype._onSetGroup=function _onSetGroup(e){this.gid=e.gid,this.barrage&&this.barrage.userJoinGroup()},Client.prototype._onMemberInfo=function _onMemberInfo(e){},Client.prototype._requestKey=function _requestKey(){this._sendmsg(o.FlashData.encode({type:"h5ckreq",rid:this.roomid,ti:window.vdwdae325w_64we}))},Client.prototype._qradsr=function _qradsr(){this._sendmsg(o.FlashData.encode({type:"qradsr",rid:this.roomid,xhashkeyx:this.roomid}))},Client.prototype._keepLive=function _keepLive(){this._sendmsg(o.FlashData.encode({type:"keeplive",tick:parseInt((new Date).getTime()/1e3,10),vbw:1,cdn:1,kd:this._kd}))},d(Client,[{key:"isConnected",get:function get(){return!(!this.conn||!this.conn.isConnected)}},{key:"isHostlive",get:function get(){return!1}},{key:"usergroupid",get:function get(){return""}}]),Client}(n.EventEmitter)}}]);
//# sourceMappingURL=http://sourcemap.douyucdn.cn:4567/room/online/sourcemaps/vendors~DoublePlayer_b6206f6_3605ad1.js.map