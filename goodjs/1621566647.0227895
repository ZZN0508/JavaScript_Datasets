OK.gifts=function(t,e){"use strict";var a,i,s,r;function n(){$("#ifDcards").height($(t).height()-250).scroll(),$(t).scroll()}var c,l,o=null;return{activateFriendSelectPopup:function(){setTimeout((function(){$("#popLayerBodyWrapper").css("top","60px"),n()}),1),$(t).bind("resize",n)},deActivateFriendSelectPopup:function(){$(t).unbind("resize",n)},activateGiftsFront:function(t,n){if(a=$("#gf-search-form"),i=$("#gf-search-input"),s=0===a.length){r=e.getElementById("field_qs");var u=e.getElementById("gifts-tags-container");u&&u.addEventListener("click",(function(t){t.target.classList.contains("js-tag")&&OK.gifts.doSearch(t.target.innerHTML)}),!1)}else{var d=$("#gf-search-lupa"),v=($("#gf-search-progress"),$("#gf-search-reset"));OK.onload.addCallback((function(){a[0]&&(a[0].onsubmit=function(){return c===i.val().trim()?($(".gift-front_cnt").removeClass("__process"),!1):($(".gift-front_cnt").addClass("__process"),c=i.val().trim(),a.toggleClass("search-input_active",""!==c),this.onsubmitGwt())})})),d.bind("click",(function(){a.submit()})),i.val()&&""!==i.val().trim()&&a.addClass("search-input_active");var f=function(){l=!0,$(".gift-front_cnt").addClass("__process"),a.submit()};t&&i.on("keyup",(function(){var t=i.val().trim(),e=""===t;return null!==o&&clearTimeout(o),c!==t?e?f():(a.toggleClass("search-input_active",!e),a.addClass("search-input_searching"),o=setTimeout(f,n)):($(".gift-front_cnt").removeClass("__process"),a.removeClass("search-input_active")),!0})),v.bind("click",(function(){i.val(""),a.removeClass("search-input_active"),a.submit(),i.focus()})),a.on("click",".js-tag",(function(){OK.gifts.doSearch(this.innerHTML)}))}},giftsFrontContentLoaded:function(){s||(a.removeClass("search-input_searching"),c=i.val()?i.val().trim():"",l&&(setTimeout((function(){i.focus()}),100),l=!1))},doSearch:function(t){OK.logging.logger.success("giftFront","tagClick",t),s?(r.value=t,r.dispatchEvent(new CustomEvent("paste"))):(i.val(t),a.addClass("search-input_active"),a.submit())}}}(window,document),OK.musicalGifts=function(){"use strict";var t,e,a,i,s,r,n,c,l,o="#music-gifts-content",u=null,d="click",v="search-input_searching",f="search-input_active",g="__process";function m(t,e){return function t(e,a,i){return e.getAttribute(a)?{value:e.getAttribute(a),action:e.getAttribute("action")}:i<5?t(e.parentNode,a,++i):void 0}(t,e,0)}function _(t){return t.getAttribute("data-query")}function p(t){require(["OK/music2/app"],(function(e){var a;e.play(Number(t),{ctx:"gifts",tids:(a=document.getElementById("music-gifts-content"),Array.prototype.slice.call(a.childNodes).map(_).filter(Boolean).join(","))})}))}function C(t){if(t&&(t.id===e&&t.playing||function(){var t=e&&document.getElementById("gt_"+e);if(t){var a=t.querySelector(".js-track_play");a&&a.classList.remove("m_portal_track_pause")}}(),t.playing)){var a=document.getElementById("gt_"+t.id);if(a){var i=a.querySelector(".js-track_play");i&&i.classList.add("m_portal_track_pause")}e=t.id}}function h(e){var s=e.target||e.srcElement;0;var n=m(s,"data-query"),l=m(s,"send-present-link"),o=m(s,"linkOnSelectFriend"),u=m(s,"alt-link"),d=$("#hook_FormButton_button-add");if(void 0!==n)if("select"===n.action){if(t||($("#giftMusicIco").removeClass("__disabled"),$("#sendMP").removeClass("invisible"),$("#gmSelectedTr").removeClass("invisible"),$("#sendMPD").addClass("invisible"),b(d,!0)),t!==n.value){$("#gt_"+t).removeClass("__selected"),$("#gt_"+t).attr("data-redesign")&&$("#gt_"+t+" div:first").removeClass("__selected"),y(t=n.value),a=void 0!==l?l.value:"",i=void 0!==u?u.value:"";var v=void 0!==o?o.value:"";$("#giftMusicIco").attr("data-query",t),$("#mg-track-id").val(t),$("#sendMP").attr("data-query",a).attr("data-alt",i),$("#linkOpenSelFriend").attr("data-query",v);var f=$("#gt_"+n.value);f.addClass("__selected"),f.attr("data-redesign")&&$("#gt_"+n.value+" div:first").addClass("__selected"),$("#gmSelectedTr").html('<span class="lp-t">'+f.attr("data-artist")+"</span> вЂ“ "+f.attr("data-track"))}s.classList.contains("track_play")&&p(t)}else if("play"===n.action)p(t);else if("link"===n.action){var g=n.value;c.val(""),"sendMP"===s.getAttribute("id")&&(r||(g=s.getAttribute("data-alt")),t&&(g+="&st.layer.trackId="+t)),b(d,!1),navigateOnUrlFromJS(g),OK.historyManager.pushState(g),e.preventDefault()}}function b(t,e){e?(t.removeClass("__disabled"),t.removeAttr("disabled")):(t.addClass("__disabled"),t.attr("disabled","disabled"))}function k(){var t=c.val().trim();return n.toggleClass(f,""!==t),null!==u&&clearTimeout(u),l!==t?(u=setTimeout((function(){!0,n.submit()}),500),$(o).addClass(g)):$(o).removeClass(g),!0}function y(t){$("input#field_trackId[name='st.layer.trackId']").attr("value",t)}return{bind:function(e,a,i){OK.loader.use("jQuery",(function(){!function(){n=$("#mg-search-form");var u=$("#giftMSCC").attr("data-query");n.attr("action",u),c=$("#mg-search-input");var m=$("#mg-search-lupa"),_=($("#mg-search-progress"),$("#mg-search-reset"));e||(s=void 0);if(y(t=e),$("#mg-track-id").val(t),r=a,e){var p=$("#giftMusicIco");p.attr("data-query",t),t===s&&($("#gt_"+s).addClass("__selected"),$("#gt_"+s).attr("data-redesign")&&$("#gt_"+s+" div:first").addClass("__selected"),p.addClass("__animated"))}$("#giftMSCC").click(h),require("OK/music2/app").on("current-track-changed",C),n.removeClass(v),l=c.val()?c.val().trim():"",void!1,i&&(c.on("keyup",k),OK.onload.addCallback((function(){n[0]&&(n[0].onsubmit=function(){return l===c.val().trim()?($(o).removeClass(g),!1):($(o).addClass(g),n.addClass(v),l=c.val().trim(),n.toggleClass(f,""!==l),this.onsubmitGwt())})})),m.bind(d,(function(){n.submit()})),c.val()&&""!==c.val().trim()&&n.addClass(f),_.bind(d,(function(){c.val(""),n.removeClass(f),n.submit(),c.focus()})))}()}))},deActivate:function(){y(t=null),$("#giftMSCC").off("click",h),require("OK/music2/app").off("current-track-changed",C)}}}();