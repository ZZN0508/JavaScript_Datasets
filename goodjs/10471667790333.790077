define("OK/AbstractShortcutMenu",["OK/utils/dom","OK/utils/vanilla","OK/utils/delegate"],function(v,s,t){"use strict";var i=null,e=document.createElement("div");function n(){this.holder=null,this.menuElement=null,this.showTimeout=null,this.hideTimeout=null,this.ajaxRequest=null,this.direction="",this.position="center",this._visible=!1,this.inplace=!1,this.detectScrollableContainer=!1,this.menuElementHoverInListenerCalled=!1}return e.id="hook_Block_ShortcutMenu",document.body.appendChild(e),OK.hookModel.captureBlockHook("body",e),e.addEventListener("change",function(){i&&i.visible()&&i.positingElement()}),n.getActiveInstance=function(){return i},n.setActiveInstance=function(e){i=e},n.getBlockId=function(){return"ShortcutMenu"},n.prototype.getBlock=function(){return this.inplace?this.block:e},n.prototype.getHtml=function(){},n.prototype.initListeners=function(e){this.shortcutMenuDelegate=new t(e),this.shortcutMenuDelegate.on("click",".sc-menu a",this.menuElementLinkClickListener.bind(this)),this.shortcutMenuDelegate.on("click",".sc-menu .js-hide",this.menuElementClickListener.bind(this)),this.shortcutMenuDelegate.on("click",".js-forceHide",function(e,t){this.hideMenu({forceHide:!t.classList.contains("js-supress-forceHide")})}.bind(this)),this.shortcutMenuDelegate.on("mouseenter",this.menuElementHoverInListener.bind(this)),this.shortcutMenuDelegate.on("mouseleave",this.hoverOutListener.bind(this)),OK.device.isTouch&&this.shortcutMenuDelegate.on("touchstart",this.holderTouchStartListener.bind(this))},n.prototype.processHTML=function(e){var t=[];this.inplace?(this.initBlock(),t[0]=this.blockId):t[0]=n.getBlockId();var i=this.getBlock();s.updateBlocks(e,t),this.initListeners(i),this.menuElement=v.firstByClass(i,"sc-menu"),this.positingElement(),this.menuElement.classList.remove("sc-menu__hidden"),this.holder.classList.add("__vis"),n.setActiveInstance(this),this._visible=!0},n.prototype.showMenu=function(){clearTimeout(this.hideTimeout),this.showTimeout=null,this.visible()||(i&&i.hide(),this.processHTML(this.getHtml()),s.trigger(this.holder,"shortcut-menu-show"),this.hideOnScroll&&(this.oneScrollListener={element:this.getClosestScrollable(!0),type:"scroll",handler:this.hoverOutListener.bind(this)},this.oneScrollListener.element.addEventListener("scroll",this.oneScrollListener.handler)))},n.prototype.hideMenu=function(e){this.clearShowTimeout(),this.clearHideTimeout(),s.trigger(this.holder,"shortcut-menu-hide",e),this.menuElement&&(this.menuElement.classList.add("sc-menu__hidden"),OK.hookModel.setHookContent("ShortcutMenu",""),this.menuElement=null),this.holder.classList.remove("__vis"),this.shortcutMenuDelegate&&this.shortcutMenuDelegate.off(),this._visible=!1,this.removeOneTimeListener(this.oneScrollListener),n.setActiveInstance(null)},n.prototype.hide=function(){this.clearShowTimeout(),this.clearHideTimeout(),this.menuElement&&this.hideMenu()},n.prototype.getClosestScrollable=function(i){var s,e;return this.closestScrollable||(s=/(auto|scroll)/,e=v.traverseParents(this.holder,function(e){var t=window.getComputedStyle(e);return s.test(t.overflow+t.overflowY+t.overflowX)&&(!i||e.scrollHeight>e.clientHeight)}),this.closestScrollable=e||window),this.closestScrollable},n.prototype.isTopDirection=function(e,t){var i=this.holder.getBoundingClientRect().top;if(this.detectScrollableContainer){var s=this.holder.getBoundingClientRect().height,n=this.getClosestScrollable(),o=i-n.getBoundingClientRect().top,h=n.clientHeight-s,s=n.scrollTop+o+s+t,n=n.scrollHeight;return h/2<o||n<s}return window.innerHeight-e-i<t},n.prototype.isInsideViewportWhileCentered=function(e){var t,i=this.holder.getBoundingClientRect(),s=i.left,n=window.innerWidth-OK.scrollBar.width;this.detectScrollableContainer&&(s-=(t=this.getClosestScrollable().getBoundingClientRect()).left,n=t.right);i=s+(i.width-e)/2;return 0<i&&i+e<n},n.prototype.toRightFromHolder=function(e,t){if(this.detectScrollableContainer){var i=this.getClosestScrollable().getBoundingClientRect(),s=this.holder.getBoundingClientRect().left-i.left;return i.width/2>s}return window.innerWidth-OK.scrollBar.width>e.left+t},n.prototype.visible=function(){return this._visible},n.prototype.getOffset=function(e){e=e.getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset}},n.prototype.positingElement=function(){var e=v.outerSize(this.holder,!1,!1),t=this.inplace?{top:0,left:0}:this.getOffset(this.holder),i=v.outerSize(this.holder,!0,!1),s=v.outerSize(this.menuElement,!0,!0),n=this.position;"center"!==(n="center"===n&&!this.isInsideViewportWhileCentered(s)?"auto":n)&&"auto"!==n&&this.menuElement.classList.add("__noarrow");var o=v.outerSize(this.menuElement,!1,!0),h="top_force"===this.direction||"bottom_force"===this.direction?"top_force"===this.direction:"top"===this.direction?this.getOffset(this.holder).top-window.pageYOffset-90>o:"bottom"!==this.direction&&this.isTopDirection(e,o),l=t.top,r=[];h?(this.menuElement.classList.add("sc-menu__top"),this.inplace?r.push("top: auto; bottom: "+Math.round(l+e)+"px;"):(l-=o,r.push("bottom: auto; top: "+Math.round(l)+"px;"))):(this.menuElement.classList.remove("sc-menu__top"),this.inplace||(l+=e),r.push("bottom: auto; top: "+Math.round(l)+"px;"));var a=Math.round(t.left-(s-i)),c=Math.round(t.left),u=Math.round(t.left+(i-s)/2);switch(n){case"left":r.push("left: "+a+"px;");break;case"right":r.push("left: "+c+"px;");break;case"auto":var d,m=v.firstByClass(this.menuElement,"entity-shortcut-menu_arw"),p=0,g=m?54:0,f=this.toRightFromHolder(t,s);f?(this.menuElement.classList.remove("__right"),this.menuElement.classList.add("__left")):(this.menuElement.classList.add("__right"),this.menuElement.classList.remove("__left")),!g&&(m=v.firstByClass(this.menuElement,"sc-menu_arw"))&&(d=m.getBoundingClientRect()).width&&(m=this.menuElement.getBoundingClientRect(),g=f?2*(d.left-m.left)+d.width:2*(m.left+m.width-(d.left+d.width))+d.width),i<g&&(p=(g-i)/2),f?r.push("left: "+(c-p)+"px;"):r.push("left: "+(a+p)+"px;");break;default:r.push("left: "+u+"px;")}this.menuElement.setAttribute("style",r.join(""))},n.prototype.ajaxClose=function(e){this.ajaxRequest&&(this.ajaxRequest.xhr.abort(),this.ajaxRequest=null,"function"==typeof e&&e())},n.prototype.hoverInListener=function(e){OK.device.isTouch&&e||(i!==this&&(i&&i.hide(),n.setActiveInstance(this)),this.clearHideTimeout(),this.showTimeout||this.visible()||(this.showTimeout=setTimeout(this.showMenu.bind(this),this.showDelay)))},n.prototype.hoverOutListener=function(){this.clearShowTimeout(),this.ajaxClose(),!this.hideTimeout&&this.visible()&&(this.hideTimeout=setTimeout(function(){this.hideOnBlurElement!==document.activeElement?this.hideMenu():this.hideTimeout=null}.bind(this),this.hideDelay))},n.prototype.menuElementHoverInListener=function(){this.menuElementHoverInListenerCalled=!0,this.hideTimeout&&(this.hideTimeout=clearTimeout(this.hideTimeout))},n.prototype.menuElementLinkClickListener=function(e){v.parent(e.target,"js-doNotHide",this.block)||this.menuElementClickListener()},n.prototype.menuElementClickListener=function(){!0===this.hideTimeout&&(this.hideTimeout=null),this.hoverOutListener()},n.prototype.holderTouchStartListener=function(e){e.stopPropagation()},n.prototype.clearShowTimeout=function(){this.showTimeout&&(this.showTimeout=clearTimeout(this.showTimeout))},n.prototype.clearHideTimeout=function(){this.hideTimeout&&(this.hideTimeout=clearTimeout(this.hideTimeout))},n.prototype.removeOneTimeListener=function(e){e&&e.element.removeEventListener(e.type,e.handler)},n}),define("OK/ShortcutMenu",["OK/logger","OK/utils/vanilla","OK/utils/dom","OK/utils/delegate","OK/AbstractShortcutMenu"],function(i,n,o,s,h){"use strict";function e(e){h.call(this),this.hookId=e,this.stopClick=!0,this.ajaxRequest=null,this.cacheable=!0,this.loaded=!1,this.showOnClick=!0}return(e.prototype=Object.create(h.prototype)).constructor=e,Object.assign(e.prototype,{activate:function(e){if(this.element=e,this.holder=this.getHolder(),this.blockId=this.element.getAttribute("data-blockid"),this.block=document.getElementById("hook_Block_"+this.blockId),this.inplace=this.element.getAttribute("data-inplace"),this.loaded=this.element.getAttribute("data-loaded"),this.showDelay=parseInt(this.element.getAttribute("data-show"),10)||300,this.hideDelay=parseInt(this.element.getAttribute("data-hide"),10)||100,this.cacheable=!this.element.getAttribute("data-nocache"),this.saveChanges=this.element.getAttribute("data-save-changes"),this.direction=this.element.getAttribute("data-direction"),this.position=this.element.getAttribute("data-position")||"center",this.showOnClick=this.element.getAttribute("data-onClick"),this.isShowImmediately=this.element.getAttribute("data-showImmediately"),this.showImmediatelySelector=this.element.getAttribute("data-showImmediatelySelector"),this.relatedMenu=this.getRelatedMenu(),this.hideOnClick=this.element.getAttribute("data-hideOnClick"),this.hideOnMouseDown=this.element.getAttribute("data-hideOnMouseDown"),this.hideOnScroll=this.element.getAttribute("data-hideOnScroll"),this.hideOnBlurSelector=this.element.getAttribute("data-hideOnBlurSelector"),this.hideOnBlurElement=null,this.detectScrollableContainer=this.element.getAttribute("data-detect-scrollable"),!this.holder)return i.error("asm","noholder"),void i.success("asm","noholder",this.buildParamFingerprint());var t;this.handlers={},this.boundAjaxFail=this.ajaxFail.bind(this),this.boundAjaxDone=this.ajaxDone.bind(this),this.holderDelegate=new s(this.holder),OK.device.isTouch&&(this.holderDelegate.on("touchstart",this.holderTouchStartListener),(t=(t=this.holder.getElementsByTagName("a")[0])||o.traverseParents(this.holder,function(e){return"A"===e.tagName.toUpperCase()},document.body,!0))&&(this.linkDelegate=new s(t),this.linkDelegate.on("touchstart",this.touchHandle.bind(this),!0))),this.holderDelegate.on("mouseleave",this.hoverOutListener.bind(this)),this.showOnClick?this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.showMenu):(this.holderDelegate.on("mouseenter",this.hoverInListener.bind(this)),this.hideOnClick&&this.holderDelegate.on("click",this.hoverOutListener.bind(this)),this.hideOnMouseDown&&this.holderDelegate.on("mousedown",this.hoverOutListener.bind(this))),this.inplace&&this.loaded&&this.initListeners(this.getBlock()),this.isShowImmediately&&this.showImmediately(),"1"===e.getAttribute("data-expanded")&&setTimeout(this.showMenu.bind(this),0)},deactivate:function(){this.holder&&(this.ajaxClose(),this.hide(),this.removeOneTimeListener(this.oneClickListener),this.removeOneTimeListener(this.oneScrollListener),this.removeOneTimeListener(this.oneBodyTouchListener),this.removeOneTimeListener(this.oneImmediatelyHandler),this.removeOneTimeListener(this.oneBlurListener),this.holderDelegate.destroy(),this.linkDelegate&&this.linkDelegate.destroy(),this.shortcutMenuDelegate&&this.shortcutMenuDelegate.destroy())},buildParamFingerprint:function(){var e=[this.inplace,this.loaded,this.cacheable,this.showOnClick,this.hideOnClick,this.hideOnScroll],t="";return e.forEach(function(e){t+=(+!!e).toString()}),t},getHolder:function(){var e=this.element.getAttribute("data-holder");return e?document.getElementById(e):this.element.previousElementSibling},getRelatedMenu:function(){var e,t=this.element.getAttribute("data-related");return t&&(e=OK.hookModel.getHookById(t)).getInstance?e.getInstance():null},getHtml:function(){if(!this.block)return"";var e=this.block.innerHTML;return this.inplace&&this.cacheable||(OK.hookModel.setHookContent(this.blockId,""),this.cacheable&&(this.block.innerHTML=e)),e},initBlock:function(){if(this.element&&!this.block){for(var e,t=Array.prototype.slice.call(this.element.children),i=null,s=0;s<t.length;s++)if(t[s].classList.contains("posR")){i=t[s];break}i?this.block=i:((e=document.createElement("div")).id="hook_Block_"+this.blockId,e.className="posR",this.element.appendChild(e),this.block=e,OK.hookModel.captureBlockHook(this.hookId,e))}},initListeners:function(e){h.prototype.initListeners.call(this,e),this.hideOnBlurSelector&&(this.hideOnBlurElement=this.block.querySelector(this.hideOnBlurSelector),this.oneBlurListener=this.addOneTimeListener(this.hideOnBlurElement,"blur",this.hoverOutListener.bind(this)))},showMenu:function(){var e;clearTimeout(this.hideTimeout),this.showTimeout=null,this.relatedMenu&&this.relatedMenu.hide&&this.relatedMenu.hide(),this.visible()||(h.getActiveInstance()&&h.getActiveInstance().hide(),this.showOnClick&&(this.removeOneTimeListener(this.oneClickListener),this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.hideMenu)),this.hideOnScroll&&(this.oneScrollListener=this.addOneTimeListener(this.getClosestScrollable(!0),"scroll",this.hoverOutListener)),this.showTimeout=null,OK.device.isTouch&&(this.oneBodyTouchListener=this.addOneTimeListener(document.body,"touchstart",this.hoverOutListener)),this.ajaxRequest)||(this.startTime=Date.now(),this.loaded?(e=this.getHtml(),this.processHTML(e,void 0,!this.inplace||!this.cacheable),i.success("asm","show","cache")):(e=this.element.getAttribute("data-url"),this.ajaxRequest=n.ajax({url:e,dataType:"html"}),this.ajaxRequest.then(this.boundAjaxDone,this.boundAjaxFail)))},showImmediately:function(){var e=this;e.showImmediatelySelector&&setTimeout(function(){var t=e.showImmediatelySelector+":hover";e.showImmediatelyElement=o.traverseParents(e.holder,function(e){return e.matches(t)}),e.showImmediatelyElement.matches(t)&&(e.showMenu(),e.oneImmediatelyHandler=this.addOneTimeListener(e.showImmediatelyElement,"mouseleave",function(){setTimeout(function(){e.menuElementHoverInListenerCalled||e.hideMenu()},e.hideDelay)}))},1)},hideMenu:function(){this.clearShowTimeout(),(this.visible()||this.showOnClick)&&(this.clearHideTimeout(),this.stopClick=!0,this.showOnClick&&(this.removeOneTimeListener(this.oneClickListener),this.oneClickListener=this.addOneTimeListener(this.holder,"click",this.showMenu)),this.ajaxClose(function(){i.success("asm","ajax","to")}),this.menuElement&&(this.menuElement.classList.add("sc-menu__hidden"),this.getHtml(),this.saveChanges&&!this.inplace&&this.loaded&&this.cacheable&&(this.initBlock(),this.block.innerHTML=this.getBlock().innerHTML),OK.hookModel.setHookContent(h.getBlockId(),""),this.menuElement=null),this.holder.classList.remove("__vis"),this.shortcutMenuDelegate&&!this.cacheable&&this.shortcutMenuDelegate.off(),this._visible=!1,h.setActiveInstance(null))},touchHandle:function(e){if(this.stopClick)return e.preventDefault(),e.stopPropagation(),this.stopClick=!1,this.showOnClick||this.hoverInListener(),!1;this.hoverOutListener()},processHTML:function(e,t,i){var s=[];t&&t.getResponseHeader(OK.navigation.HEADER)&&(s=t.getResponseHeader(OK.navigation.HEADER).split(",")),this.inplace?(this.initBlock(),s[0]=this.blockId):s[0]=h.getBlockId();t=this.getBlock();i&&(n.updateBlocks(e,s),this.initListeners(t)),this.menuElement=o.firstByClass(t,"sc-menu"),this.positingElement(),this.menuElement.classList.remove("sc-menu__hidden"),this.holder.classList.add("__vis"),h.setActiveInstance(this),this._visible=!0},ajaxDone:function(e){i.duration("asm",Date.now()-this.startTime,"ajax");var t=e.response;t&&0!==t.split(OK.navigation.SPLITER)[0].length?(i.success("asm","show","ajax"),this.cacheable&&this.element&&(this.loaded=!0,this.initBlock(),this.block.innerHTML=t.split(OK.navigation.SPLITER)[0]),this.processHTML(t,e.xhr,!0),this.ajaxClose()):i.success("asm","ajax","e")},ajaxFail:function(){this.ajaxClose(function(){i.error("asm","ajax")})},addOneTimeListener:function(t,e,i){function s(e){t.removeEventListener(e.type,s),i.call(n,e)}var n=this;return t.addEventListener(e,s),{element:t,type:e,handler:s}},removeOneTimeListener:function(e){e&&e.element.removeEventListener(e.type,e.handler)}}),e}),define("b/shortcutMenuBundle",["OK/AbstractShortcutMenu","OK/ShortcutMenu"],{});
