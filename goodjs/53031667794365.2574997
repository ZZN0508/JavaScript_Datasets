!function(h,u,p,m,d,f){var s,c,g,l,v,y=this,w=Math.floor(1e4*Math.random()),b=Function.prototype,k=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,t=/[\-\w]+\/\.\.\//,o=/([^:])\/\//g,_="",x={},n=h.easyXDM,O="easyXDM_",M=!1;function S(e,n){var t=typeof e[n];return"function"==t||"object"==t&&e[n]||"unknown"==t}function T(){var e="Shockwave Flash",n="application/x-shockwave-flash";if(D(navigator.plugins)||"object"!=typeof navigator.plugins[e]||(t=navigator.plugins[e].description)&&!D(navigator.mimeTypes)&&navigator.mimeTypes[n]&&navigator.mimeTypes[n].enabledPlugin&&(c=t.match(/\d+/g)),!c)try{o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),c=Array.prototype.slice.call(o.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),o=null}catch(e){}if(c){var t=parseInt(c[0],10),o=parseInt(c[1],10);return g=9<t&&0<o,1}}if(S(h,"addEventListener"))l=function(e,n,t){e.addEventListener(n,t,!1)},v=function(e,n,t){e.removeEventListener(n,t,!1)};else{if(!S(h,"attachEvent"))throw new Error("Browser not supported");l=function(e,n,t){e.attachEvent("on"+n,t)},v=function(e,n,t){e.detachEvent("on"+n,t)}}var e,a,r=!1,i=[];function C(){if(!r){r=!0;for(var e=0;e<i.length;e++)i[e]();i.length=0}}function R(e,n){r?e.call(n):i.push(function(){e.call(n)})}function E(e){return e.match(k)[3]}function N(e){var n=e.toLowerCase().match(k),t=n[2],e=n[3],n=n[4]||"";return t+"//"+e+(n="http:"==t&&":80"==n||"https:"==t&&":443"==n?"":n)}function F(e){var n;for((e=e.replace(o,"$1/")).match(/^(http||https):\/\//)||("/"!==(n="/"===e.substring(0,1)?"":p.pathname).substring(n.length-1)&&(n=n.substring(0,n.lastIndexOf("/")+1)),e=p.protocol+"//"+p.host+n+e);t.test(e);)e=e.replace(t,"");return e}function P(e,n){var t="",o=e.indexOf("#");-1!==o&&(t=e.substring(o),e=e.substring(0,o));var a,r=[];for(a in n)n.hasOwnProperty(a)&&r.push(a+"="+f(n[a]));return e+(M?"#":-1==e.indexOf("?")?"?":"&")+r.join("&")+t}(r="readyState"in u?"complete"==(e=u.readyState)||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==e||"interactive"==e):!!u.body)||(S(h,"addEventListener")?l(u,"DOMContentLoaded",C):(l(u,"readystatechange",function(){"complete"==u.readyState&&C()}),u.documentElement.doScroll&&h===top&&(a=function(){if(!r){try{u.documentElement.doScroll("left")}catch(e){return void m(a,1)}C()}})()),l(h,"load",C));var H=function(e){for(var n,t={},o=(e=e.substring(1).split("&")).length;o--;)t[(n=e[o].split("="))[0]]=d(n[1]);return t}(/xdm_e=/.test(p.search)?p.search:p.hash);function D(e){return void 0===e}var j,B=function(){var e={},n={a:[1,2,3]},t='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(n).replace(/\s/g,"")===t?JSON:(Object.toJSON&&Object.toJSON(n).replace(/\s/g,"")===t&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(n=t.evalJSON()).a&&3===n.a.length&&3===n.a[2]&&(e.parse=function(e){return e.evalJSON()}),e.stringify&&e.parse?(B=function(){return e},e):null)};function L(e,n,t){var o,a;for(a in n)n.hasOwnProperty(a)&&(a in e?"object"==typeof(o=n[a])?L(e[a],o,t):t||(e[a]=n[a]):e[a]=n[a]);return e}function J(e){var n,t;D(s)&&(o=u.body.appendChild(u.createElement("form")),(n=o.appendChild(u.createElement("input"))).name=O+"TEST"+w,s=n!==o.elements[n.name],u.body.removeChild(o)),s?t=u.createElement('<iframe name="'+e.props.name+'"/>'):(t=u.createElement("IFRAME")).name=e.props.name,t.id=t.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=u.getElementById(e.container)),e.container||(L(t.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=u.body);var o=e.props.src;if(e.props.src="javascript:false",L(t,e.props),t.border=t.frameBorder=0,t.allowTransparency=!0,e.container.appendChild(t),e.onLoad&&l(t,"load",e.onLoad),e.usePost){var a,r=e.container.appendChild(u.createElement("form"));if(r.target=t.name,r.action=o,r.method="POST","object"==typeof e.usePost)for(var i in e.usePost)e.usePost.hasOwnProperty(i)&&(s?a=u.createElement('<input name="'+i+'"/>'):(a=u.createElement("INPUT")).name=i,a.value=e.usePost[i],r.appendChild(a));r.submit(),r.parentNode.removeChild(r)}else t.src=o;return e.props.src=o,t}function A(e){var n,t=e.protocol;if(e.isHost=e.isHost||D(H.xdm_p),M=e.hash||!1,e.props||(e.props={}),e.isHost)e.remote=F(e.remote),e.channel=e.channel||"default"+w++,e.secret=Math.random().toString(16).substring(2),D(t)&&(t=N(p.href)==N(e.remote)?"4":S(h,"postMessage")||S(u,"postMessage")?"1":e.swf&&S(h,"ActiveXObject")&&T()?"6":"Gecko"===navigator.product&&"frameElement"in h&&-1==navigator.userAgent.indexOf("WebKit")?"5":e.remoteHelper?"2":"0");else if(e.channel=H.xdm_c.replace(/["'<>\\]/g,""),e.secret=H.xdm_s,e.remote=H.xdm_e.replace(/["'<>\\]/g,""),t=H.xdm_p,e.acl&&!function(e,n){for(var t,o=(e="string"==typeof e?[e]:e).length;o--;)if(t=e[o],(t=new RegExp("^"==t.substr(0,1)?t:"^"+t.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$")).test(n))return 1}(e.acl,e.remote))throw new Error("Access denied for "+e.remote);switch(e.protocol=t){case"0":if(L(e,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),e.isHost){if(!e.local){for(var o,a=p.protocol+"//"+p.host,r=u.body.getElementsByTagName("img"),i=r.length;i--;)if((o=r[i]).src.substring(0,a.length)===a){e.local=o.src;break}e.local||(e.local=h)}var s={xdm_c:e.channel,xdm_p:0};e.local===h?(e.usePolling=!0,e.useParent=!0,e.local=p.protocol+"//"+p.host+p.pathname+p.search,s.xdm_e=e.local,s.xdm_pa=1):s.xdm_e=F(e.local),e.container&&(e.useResize=!1,s.xdm_po=1),e.remote=P(e.remote,s)}else L(e,{channel:H.xdm_c,remote:H.xdm_e,useParent:!D(H.xdm_pa),usePolling:!D(H.xdm_po),useResize:!e.useParent&&e.useResize});n=[new x.stack.HashTransport(e),new x.stack.ReliableBehavior({}),new x.stack.QueueBehavior({encode:!0,maxLength:4e3-e.remote.length}),new x.stack.VerifyBehavior({initiate:e.isHost})];break;case"1":n=[new x.stack.PostMessageTransport(e)];break;case"2":e.isHost&&(e.remoteHelper=F(e.remoteHelper)),n=[new x.stack.NameTransport(e),new x.stack.QueueBehavior,new x.stack.VerifyBehavior({initiate:e.isHost})];break;case"3":n=[new x.stack.NixTransport(e)];break;case"4":n=[new x.stack.SameOriginTransport(e)];break;case"5":n=[new x.stack.FrameElementTransport(e)];break;case"6":c||T(),n=[new x.stack.FlashTransport(e)]}return n.push(new x.stack.QueueBehavior({lazy:e.lazy,remove:!0})),n}function I(e){for(var n,t={incoming:function(e,n){this.up.incoming(e,n)},outgoing:function(e,n){this.down.outgoing(e,n)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},o=0,a=e.length;o<a;o++)L(n=e[o],t,!0),0!==o&&(n.down=e[o-1]),o!==a-1&&(n.up=e[o+1]);return n}L(x,{version:"2.4.18.25",query:H,stack:{},apply:L,getJSONObject:B,whenReady:R,noConflict:function(e){return h.easyXDM=n,(_=e)&&(O="easyXDM_"+_.replace(".","_")+"_"),x}}),x.DomHelper={on:l,un:v,requiresJSON:function(e){var n,t;"object"==typeof(n=h)[t="JSON"]&&n[t]||u.write('<script type="text/javascript" src="'+e+'"><\/script>')}},j={},x.Fn={set:function(e,n){j[e]=n},get:function(e,n){var t=j[e];return n&&delete j[e],t}},x.Socket=function(t){var n=I(A(t).concat([{incoming:function(e,n){t.onMessage(e,n)},callback:function(e){t.onReady&&t.onReady(e)}}])),o=N(t.remote);this.origin=N(t.remote),this.destroy=function(){n.destroy()},this.postMessage=function(e){n.outgoing(e,o)},n.init()},x.Rpc=function(n,e){if(e.local)for(var t in e.local){var o;!e.local.hasOwnProperty(t)||"function"==typeof(o=e.local[t])&&(e.local[t]={method:o})}var a=I(A(n).concat([new x.stack.RpcBehavior(this,e),{callback:function(e){n.onReady&&n.onReady(e)}}]));this.origin=N(n.remote),this.destroy=function(){a.destroy()},a.init()},x.stack.SameOriginTransport=function(e){var n,t,o,a;return n={outgoing:function(e,n,t){o(e),t&&t()},destroy:function(){t&&(t.parentNode.removeChild(t),t=null)},onDOMReady:function(){a=N(e.remote),e.isHost?(L(e.props,{src:P(e.remote,{xdm_e:p.protocol+"//"+p.host+p.pathname,xdm_c:e.channel,xdm_p:4}),name:O+e.channel+"_provider"}),t=J(e),x.Fn.set(e.channel,function(e){return o=e,m(function(){n.up.callback(!0)},0),function(e){n.up.incoming(e,a)}})):(o=function(){var e=parent;if(""!==_)for(var n=0,t=_.split(".");n<t.length;n++)e=e[t[n]];return e.easyXDM}().Fn.get(e.channel,!0)(function(e){n.up.incoming(e,a)}),m(function(){n.up.callback(!0)},0))},init:function(){R(n.onDOMReady,n)}}},x.stack.FlashTransport=function(a){var t,o,r,i,s;function c(e,n){m(function(){t.up.incoming(e,r)},0)}function l(t){var e=a.swf+"?host="+a.isHost,n="easyXDM_swf_"+Math.floor(1e4*Math.random());x.Fn.set("flash_loaded"+t.replace(/[\-.]/g,"_"),function(){x.stack.FlashTransport[t].swf=i=s.firstChild;for(var e=x.stack.FlashTransport[t].queue,n=0;n<e.length;n++)e[n]();e.length=0}),a.swfContainer?s="string"==typeof a.swfContainer?u.getElementById(a.swfContainer):a.swfContainer:(L((s=u.createElement("div")).style,g&&a.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),u.body.appendChild(s));var o="callback=flash_loaded"+f(t.replace(/[\-.]/g,"_"))+"&proto="+y.location.protocol+"&domain="+f(E(y.location.href))+"&port="+f(y.location.href.match(k)[4]||"")+"&ns="+f(_);s.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+n+"' data='"+e+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+e+"'></param><param name='flashvars' value='"+o+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+o+"' allowScriptAccess='always' wmode='transparent' src='"+e+"' height='1' width='1'></embed></object>"}return t={outgoing:function(e,n,t){i.postMessage(a.channel,e.toString()),t&&t()},destroy:function(){try{i.destroyChannel(a.channel)}catch(e){}i=null,o&&(o.parentNode.removeChild(o),o=null)},onDOMReady:function(){r=a.remote,x.Fn.set("flash_"+a.channel+"_init",function(){m(function(){t.up.callback(!0)})}),x.Fn.set("flash_"+a.channel+"_onMessage",c),a.swf=F(a.swf);function e(){x.stack.FlashTransport[n].init=!0,(i=x.stack.FlashTransport[n].swf).createChannel(a.channel,a.secret,N(a.remote),a.isHost),a.isHost&&(g&&a.swfNoThrottle&&L(a.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),L(a.props,{src:P(a.remote,{xdm_e:N(p.href),xdm_c:a.channel,xdm_p:6,xdm_s:a.secret}),name:O+a.channel+"_provider"}),o=J(a))}var n=E(a.swf);x.stack.FlashTransport[n]&&x.stack.FlashTransport[n].init?e():x.stack.FlashTransport[n]?x.stack.FlashTransport[n].queue.push(e):(x.stack.FlashTransport[n]={queue:[e]},l(n))},init:function(){R(t.onDOMReady,t)}}},x.stack.PostMessageTransport=function(o){var t,a,r,i;function s(e){var n=function(e){if(e.origin)return N(e.origin);if(e.uri)return N(e.uri);if(e.domain)return p.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}(e);n==i&&e.data.substring(0,o.channel.length+1)==o.channel+" "&&t.up.incoming(e.data.substring(o.channel.length+1),n)}return t={outgoing:function(e,n,t){r.postMessage(o.channel+" "+e,n||i),t&&t()},destroy:function(){v(h,"message",s),a&&(r=null,a.parentNode.removeChild(a),a=null)},onDOMReady:function(){var n;i=N(o.remote),o.isHost?(n=function(e){e.data==o.channel+"-ready"&&(r="postMessage"in a.contentWindow?a.contentWindow:a.contentWindow.document,v(h,"message",n),l(h,"message",s),m(function(){t.up.callback(!0)},0))},l(h,"message",n),L(o.props,{src:P(o.remote,{xdm_e:N(p.href),xdm_c:o.channel,xdm_p:1}),name:O+o.channel+"_provider"}),a=J(o)):(l(h,"message",s),(r="postMessage"in h.parent?h.parent:h.parent.document).postMessage(o.channel+"-ready",i),m(function(){t.up.callback(!0)},0))},init:function(){R(t.onDOMReady,t)}}},x.stack.FrameElementTransport=function(e){var n,t,o,a;return n={outgoing:function(e,n,t){o.call(this,e),t&&t()},destroy:function(){t&&(t.parentNode.removeChild(t),t=null)},onDOMReady:function(){a=N(e.remote),e.isHost?(L(e.props,{src:P(e.remote,{xdm_e:N(p.href),xdm_c:e.channel,xdm_p:5}),name:O+e.channel+"_provider"}),(t=J(e)).fn=function(e){return delete t.fn,o=e,m(function(){n.up.callback(!0)},0),function(e){n.up.incoming(e,a)}}):(u.referrer&&N(u.referrer)!=H.xdm_e&&(h.top.location=H.xdm_e),o=h.frameElement.fn(function(e){n.up.incoming(e,a)}),n.up.callback(!0))},init:function(){R(n.onDOMReady,n)}}},x.stack.NameTransport=function(t){var n,o,a,r,i,s,c,l;function u(e){var n=t.remoteHelper+(o?"#_3":"#_2")+t.channel;a.contentWindow.sendMessage(e,n)}function p(){o?2!=++i&&o||n.up.callback(!0):(u("ready"),n.up.callback(!0))}function d(e){n.up.incoming(e,c)}function f(){s&&m(function(){s(!0)},0)}return n={outgoing:function(e,n,t){s=t,u(e)},destroy:function(){a.parentNode.removeChild(a),a=null,o&&(r.parentNode.removeChild(r),r=null)},onDOMReady:function(){o=t.isHost,i=0,c=N(t.remote),t.local=F(t.local),o?(x.Fn.set(t.channel,function(e){o&&"ready"===e&&(x.Fn.set(t.channel,d),p())}),l=P(t.remote,{xdm_e:t.local,xdm_c:t.channel,xdm_p:2}),L(t.props,{src:l+"#"+t.channel,name:O+t.channel+"_provider"}),r=J(t)):(t.remoteHelper=t.remote,x.Fn.set(t.channel,d));function e(){var n=a||this;v(n,"load",e),x.Fn.set(t.channel+"_load",f),function e(){"function"==typeof n.contentWindow.sendMessage?p():m(e,50)}()}a=J({props:{src:t.local+"#_4"+t.channel},onLoad:e})},init:function(){R(n.onDOMReady,n)}}},x.stack.HashTransport=function(o){var a,r,e,i,s,c,l,u,p,d;function n(){var e,n,t;l&&(e=l.location.href,n="",t=e.indexOf("#"),(n=-1!=t?e.substring(t):n)&&n!=s&&(s=n,a.up.incoming(s.substring(s.indexOf("_")+1),d)))}function f(){e=setInterval(n,i)}return a={outgoing:function(e,n){e=e,u&&(e=o.remote+"#"+c+++"_"+e,(r||!p?u.contentWindow:u).location=e)},destroy:function(){h.clearInterval(e),!r&&p||u.parentNode.removeChild(u),u=null},onDOMReady:function(){var n,t;r=o.isHost,i=o.interval,s="#"+o.channel,c=0,p=o.useParent,d=N(o.remote),r?(L(o.props,{src:o.remote,name:O+o.channel+"_provider"}),p?o.onLoad=function(){l=h,f(),a.up.callback(!0)}:(n=0,t=o.delay/50,function e(){if(++n>t)throw new Error("Unable to reference listenerwindow");try{l=u.contentWindow.frames[O+o.channel+"_consumer"]}catch(e){}l?(f(),a.up.callback(!0)):m(e,50)}()),u=J(o)):(l=h,f(),p?(u=parent,a.up.callback(!0)):(L(o,{props:{src:o.remote+"#"+o.channel+new Date,name:O+o.channel+"_consumer"},onLoad:function(){a.up.callback(!0)}}),u=J(o)))},init:function(){R(a.onDOMReady,a)}}},x.stack.ReliableBehavior=function(e){var a,r,i=0,s=0,c="";return a={incoming:function(e,n){var t=e.indexOf("_"),o=e.substring(0,t).split(",");e=e.substring(t+1),o[0]==i&&(c="",r&&r(!0)),0<e.length&&(a.down.outgoing(o[1]+","+i+"_"+c,n),s!=o[1]&&(s=o[1],a.up.incoming(e,n)))},outgoing:function(e,n,t){c=e,r=t,a.down.outgoing(s+","+ ++i+"_"+e,n)}}},x.stack.QueueBehavior=function(r){var i,t,s=[],o=!0,a="",c=0,l=!1,u=!1;function p(){if(r.remove&&0===s.length)return(e=i).up.down=e.down,e.down.up=e.up,void(e.up=e.down=null);var e,n;o||0===s.length||t||(o=!0,n=s.shift(),i.down.outgoing(n.data,n.origin,function(e){o=!1,n.callback&&m(function(){n.callback(e)},0),p()}))}return i={init:function(){(r=D(r)?{}:r).maxLength&&(c=r.maxLength,u=!0),r.lazy?l=!0:i.down.init()},callback:function(e){o=!1;var n=i.up;p(),n.callback(e)},incoming:function(e,n){var t,o;u?(t=e.indexOf("_"),o=parseInt(e.substring(0,t),10),a+=e.substring(t+1),0===o&&(r.encode&&(a=d(a)),i.up.incoming(a,n),a="")):i.up.incoming(e,n)},outgoing:function(e,n,t){r.encode&&(e=f(e));var o,a=[];if(u){for(;0!==e.length;)o=e.substring(0,c),e=e.substring(o.length),a.push(o);for(;o=a.shift();)s.push({data:a.length+"_"+o,origin:n,callback:0===a.length?t:null})}else s.push({data:e,origin:n,callback:t});l?i.down.init():p()},destroy:function(){t=!0,i.down.destroy()}}},x.stack.VerifyBehavior=function(o){var a,r,i;function s(){r=Math.random().toString(16).substring(2),a.down.outgoing(r)}return a={incoming:function(e,n){var t=e.indexOf("_");-1===t?e===r?a.up.callback(!0):i||(i=e,o.initiate||s(),a.down.outgoing(e)):e.substring(0,t)===i&&a.up.incoming(e.substring(t+1),n)},outgoing:function(e,n,t){a.down.outgoing(r+"_"+e,n,t)},callback:function(e){o.initiate&&s()}}},x.stack.RpcBehavior=function(n,o){var t,a=o.serializer||B(),i=0,s={};function c(e){e.jsonrpc="2.0",t.down.outgoing(a.stringify(e))}function r(e,t,n,o){if(n){var a,r,i;t?(a=function(e){a=b,c({id:t,result:e})},r=function(e,n){r=b;e={id:t,error:{code:-32099,message:e}};n&&(e.error.data=n),c(e)}):a=r=b,i=o,"[object Array]"!==Object.prototype.toString.call(i)&&(o=[o]);try{var s=n.method.apply(n.scope,o.concat([a,r]));D(s)||a(s)}catch(e){r(e.message)}}else t&&c({id:t,error:{code:-32601,message:"Procedure not found."}})}return t={incoming:function(e,n){var t=a.parse(e);t.method?o.handle?o.handle(t,c):r(t.method,t.id,o.local[t.method],t.params):(e=s[t.id],t.error?e.error&&e.error(t.error):e.success&&e.success(t.result),delete s[t.id])},init:function(){if(o.remote)for(var e in o.remote)o.remote.hasOwnProperty(e)&&(n[e]=function(o,a){var r=Array.prototype.slice;return function(){var e,n=arguments.length,t={method:a};0<n&&"function"==typeof arguments[n-1]?(1<n&&"function"==typeof arguments[n-2]?(e={success:arguments[n-2],error:arguments[n-1]},t.params=r.call(arguments,0,n-2)):(e={success:arguments[n-1]},t.params=r.call(arguments,0,n-1)),s[""+ ++i]=e,t.id=i):t.params=r.call(arguments,0),o.namedParams&&1===t.params.length&&(t.params=t.params[0]),c(t)}}(o.remote[e],e));t.down.init()},destroy:function(){for(var e in o.remote)o.remote.hasOwnProperty(e)&&n.hasOwnProperty(e)&&delete n[e];t.down.destroy()}}},y.easyXDM=x}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent),function(){var a,e=(n.prototype.serverExists=function(){return a},n.prototype.onMessage=function(e){return this._onMessageCallback=e,this},n.prototype.postMessage=function(e,n){return this.socket.postMessage(JSON.stringify(e))},n.prototype.ready=function(e){return this._onReadyCallback=e,this},n);function n(e){var n,t,o=this;this._onMessageCallback=function(){},this._onReadyCallback=function(){},this.socket=new easyXDM.Socket({swf:"/swf/easyxdm.swf",remote:e.remote||window.location.protocol+"//music.douban.com/artists/player/xdmserver",onMessage:function(e,n){e=JSON.parse(e);return!!e&&("player_exists"===e.type&&(void 0===a&&(a=e.value,o._onReadyCallback(o.socket,e.value)),a=e.value),o._onMessageCallback.apply(null,[e,n]))}}),this.postMessage=(n=this.postMessage,t=this,function(){return n.apply(t,arguments)})}window.PLTransport=e}();
