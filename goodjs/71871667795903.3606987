!function(e){var n,t;n=this,t=function(e){"use strict";function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(n,e){var t,r=Object.keys(n);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(n),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),r.push.apply(r,t)),r}function ce(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(i,!0).forEach(function(e){var n,t=r,e=i[n=e];n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):n(i).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function t(e){function n(e,n){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.message=e,this.code=n}return(n.prototype=new Error).name=e,n.prototype.constructor=n}var I=t("LaunchDarklyUnexpectedResponseError"),le=t("LaunchDarklyInvalidEnvironmentIdError"),i=t("LaunchDarklyInvalidUserError"),fe=t("LaunchDarklyInvalidEventKeyError"),d=t("LaunchDarklyInvalidArgumentError"),de=t("LaunchDarklyFlagFetchError");function j(e){return!(400<=e&&e<500)||400===e||408===e||429===e}for(var r=Object.freeze({__proto__:null,LDUnexpectedResponseError:I,LDInvalidEnvironmentIdError:le,LDInvalidUserError:i,LDInvalidEventKeyError:fe,LDInvalidArgumentError:d,LDFlagFetchError:de,isHttpErrorRecoverable:j}),o=function(e){for(var n,t=e.length,r=t%3,i=[],o=0,a=t-r;o<a;o+=16383)i.push(function(e,n,t){for(var r,i=[],o=n;o<t;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(u[(r=r)>>18&63]+u[r>>12&63]+u[r>>6&63]+u[63&r]);return i.join("")}(e,o,a<o+16383?a:o+16383));return 1==r?(n=e[t-1],i.push(u[n>>2]+u[n<<4&63]+"==")):2==r&&(n=(e[t-2]<<8)+e[t-1],i.push(u[n>>10]+u[n>>4&63]+u[n<<2&63]+"=")),i.join("")},u=[],a=[],s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,l=s.length;c<l;++c)u[c]=s[c],a[s.charCodeAt(c)]=c;a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63;function f(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){var t,r,i,o=v(e),a=v(n);if(o&&a){if((r=e.length)!=n.length)return!1;for(t=r;0!=t--;)if(!f(e[t],n[t]))return!1;return!0}if(o!=a)return!1;o=e instanceof Date,a=n instanceof Date;if(o!=a)return!1;if(o&&a)return e.getTime()==n.getTime();o=e instanceof RegExp,a=n instanceof RegExp;if(o!=a)return!1;if(o&&a)return e.toString()==n.toString();var u=g(e);if((r=u.length)!==g(n).length)return!1;for(t=r;0!=t--;)if(!m.call(n,u[t]))return!1;for(t=r;0!=t--;)if(!f(e[i=u[t]],n[i]))return!1;return!0}return e!=e&&n!=n}var v=Array.isArray,g=Object.keys,m=Object.prototype.hasOwnProperty,p=["key","secondary","ip","country","email","firstName","lastName","avatar","name"];function y(e){e=unescape(encodeURIComponent(e));return o(function(e){for(var n=[],t=0;t<e.length;t++)n.push(e.charCodeAt(t));return n}(e))}function S(e){return y(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ve(e){return JSON.parse(JSON.stringify(e))}function ge(e,n){return f(e,n)}function me(e){setTimeout(e,0)}function pe(e,n){e=e.then(function(e){return n&&setTimeout(function(){n(null,e)},0),e},function(e){return n?void setTimeout(function(){n(e,null)},0):Promise.reject(e)});return n?void 0:e}function h(e){var n,t={};for(n in e)be(e,n)&&(t[n]={value:e[n],version:0});return t}function ye(e){var n,t={};for(n in e)be(e,n)&&(t[n]=e[n].value);return t}function b(e,n){for(var t,r=n.slice(0),i=[],o=e;0<r.length;){for(t=[];0<o;){var a=r.shift();if(!a)break;(o-=S(JSON.stringify(a)).length)<0&&0<t.length?r.unshift(a):t.push(a)}o=e,i.push(t)}return i}function k(e){var n=e.version||"3.3.0";return e.userAgent+"/"+n}function O(e,n){if(n&&!n.sendLDHeaders)return{};e={"X-LaunchDarkly-User-Agent":k(e)};return n&&n.wrapperName&&(e["X-LaunchDarkly-Wrapper"]=n.wrapperVersion?n.wrapperName+"/"+n.wrapperVersion:n.wrapperName),e}function he(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce(function(e,n){return ce({},e,{},n)},{})}function be(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function ke(e){if(!e)return e;var n,t;for(t in p){var r=p[t],i=e[r];void 0!==i&&"string"!=typeof i&&((n=n||ce({},e))[r]=String(i))}return n||e}for(var E,w,D,P,U,R=Object.freeze({__proto__:null,btoa:y,base64URLEncode:S,clone:ve,deepEquals:ge,onNextTick:me,wrapPromiseCallback:pe,transformValuesToVersionedValues:h,transformVersionedValuesToValues:ye,chunkUserEventsForUrl:b,getLDUserAgentString:k,getLDHeaders:O,extend:he,objectHasOwnProperty:be,sanitizeUser:ke}),T=(w=E={exports:{}},(U="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto))?(D=new Uint8Array(16),w.exports=function(){return U(D),D}):(P=new Array(16),w.exports=function(){for(var e,n=0;n<16;n++)0==(3&n)&&(e=4294967296*Math.random()),P[n]=e>>>((3&n)<<3)&255;return P}),E.exports),N=[],F=0;F<256;++F)N[F]=(F+256).toString(16).substr(1);function Ee(e,n,t){var r=n&&t||0,i=n||[],o=(e=e||{}).node||C,a=void 0!==e.clockseq?e.clockseq:L;null!=o&&null!=a||(s=T(),null==o&&(o=C=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==a&&(a=L=16383&(s[6]<<8|s[7])));var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),t=void 0!==e.nsecs?e.nsecs:_+1,s=u-x+(t-_)/1e4;if(s<0&&void 0===e.clockseq&&(a=a+1&16383),1e4<=(t=(s<0||x<u)&&void 0===e.nsecs?0:t))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");x=u,L=a,t=(1e4*(268435455&(u+=122192928e5))+(_=t))%4294967296,i[r++]=t>>>24&255,i[r++]=t>>>16&255,i[r++]=t>>>8&255,i[r++]=255&t,u=u/4294967296*1e4&268435455,i[r++]=u>>>8&255,i[r++]=255&u,i[r++]=u>>>24&15|16,i[r++]=u>>>16&255,i[r++]=a>>>8|128,i[r++]=255&a;for(var c=0;c<6;++c)i[r+c]=o[c];return n||A(i)}var C,L,A=function(e,n){var t=n||0,n=N;return[n[e[t++]],n[e[t++]],n[e[t++]],n[e[t++]],"-",n[e[t++]],n[e[t++]],"-",n[e[t++]],n[e[t++]],"-",n[e[t++]],n[e[t++]],"-",n[e[t++]],n[e[t++]],n[e[t++]],n[e[t++]],n[e[t++]],n[e[+t]]].join("")},x=0,_=0;function we(u,e,n){var r="/a/"+e+".gif",s=he({"Content-Type":"application/json"},O(u,n)),c=u.httpFallbackPing,l={};return l.sendChunk=function(e,n,i,t){var o=JSON.stringify(e),a=i?null:Ee();return t?function t(r){var e=i?s:he({},s,{"X-LaunchDarkly-Event-Schema":"3","X-LaunchDarkly-Payload-ID":a});return u.httpRequest("POST",n,e,o).promise.then(function(e){if(e)return 400<=e.status&&j(e.status)&&r?t(!1):(e={status:(n=e).status},!(n=n.header("date"))||(n=Date.parse(n))&&(e.serverTime=n),e);var n}).catch(function(){return r?t(!1):Promise.reject()})}(!0).catch(function(){}):(c&&c(n+r+"?d="+S(o)),Promise.resolve())},l.sendEvents=function(e,n,t){if(!u.httpRequest)return Promise.resolve();for(var r=u.httpAllowsPost(),i=r?[e]:b(2e3-n.length,e),o=[],a=0;a<i.length;a++)o.push(l.sendChunk(i[a],n,t,r));return Promise.all(o)},l}function q(e){var n={},a=e.allAttributesPrivate,u=e.privateAttributeNames||[],s={key:!0,custom:!0,anonymous:!0},i={key:!0,secondary:!0,ip:!0,country:!0,email:!0,firstName:!0,lastName:!0,avatar:!0,name:!0,anonymous:!0,custom:!0};return n.filterUser=function(e){if(!e)return null;function n(r,i){return Object.keys(r).reduce(function(e,n){var t=e;return i(n)&&(s[e=n]||!a&&-1===o.indexOf(e)&&-1===u.indexOf(e)?t[0][n]=r[n]:t[1][n]=!0),t},[{},{}])}var o=e.privateAttributeNames||[],t=n(e,function(e){return i[e]}),r=t[0],t=t[1];e.custom&&(e=n(e.custom,function(){return 1}),r.custom=e[0],t=he({},t,e[1]));t=Object.keys(t);return t.length&&(t.sort(),r.privateAttrs=t),r},n}function V(e){return e&&e.message?e.message:"string"==typeof e||e instanceof String?e:JSON.stringify(e)}function De(e){return'Custom event "'+e+'" does not exist'}function Se(){return"No environment/client-side ID was specified."+ae}function Oe(){return"LaunchDarkly client was initialized with bootstrap data that did not include flag metadata. Events may not be sent correctly."+ae}function Pe(e){return'received streaming update for flag "'+e+'"'}function Ue(e){return'received streaming update for flag "'+e+'" but ignored due to version check'}function Ie(e){return'received streaming deletion for flag "'+e+'"'}function je(e){return'received streaming deletion for flag "'+e+'" but ignored due to version check'}function Re(e){return'enqueueing "'+e+'" event'}function J(){return"Exceeded event queue capacity. Increase capacity to avoid dropping events."}function z(e){return'Expected application/json content type but got "'+e+'"'}function Te(){return"localStorage is unavailable"}function M(){return"localStorage is unavailable, so anonymous user ID cannot be cached"}function K(e){return"network error"+(e?" ("+e+")":"")}function B(){return"Environment not found. Double check that you specified a valid environment/client-side ID."+ae}function Ne(e){return"Error fetching flag settings: "+V(e)}function $(){return"No user specified."+ae}function H(){return"Invalid user specified."+ae}function G(e,n){return n?'"'+e+'" is deprecated, please use "'+n+'"':'"'+e+'" is deprecated'}function X(e,n,t){return"Received error "+e+(401===e?" (invalid SDK key)":"")+" for "+n+" - "+(j(e)?t:"giving up permanently")}function W(){return"Cannot make HTTP requests in this environment."+ae}function Q(){return"Closing stream connection"}function Y(e){return"Opening stream connection to "+e}function Z(e,n){return"Error on stream connection: "+V(e)+", will continue retrying every "+n+" milliseconds."}function ee(e){return'Ignoring unknown config option "'+e+'"'}function ne(e,n,t){return'Config option "'+e+'" should be of type '+n+", got "+t+", using default value"}function te(e,n){return'Config option "'+e+'" should be a boolean, got '+n+", converting to boolean"}function re(e,n,t){return'Config option "'+e+'" was set to '+n+", changing to minimum value of "+t}function ie(e){return"polling for feature flags at "+e}function oe(e){return"sending "+e+" events"}var ae=" Please see https://docs.launchdarkly.com/docs/js-sdk-reference#section-initializing-the-client for instructions on SDK initialization.",ue=Object.freeze({__proto__:null,clientInitialized:function(){return"LaunchDarkly client initialized"},clientNotReady:function(){return"LaunchDarkly client is not ready"},eventCapacityExceeded:J,eventWithoutUser:function(){return"Be sure to call `identify` in the LaunchDarkly client: https://docs.launchdarkly.com/docs/js-sdk-reference#section-analytics-events"},invalidContentType:z,invalidKey:function(){return"Event key must be a string"},localStorageUnavailable:Te,localStorageUnavailableForUserId:M,networkError:K,unknownCustomEventKey:De,environmentNotFound:B,environmentNotSpecified:Se,errorFetchingFlags:Ne,userNotSpecified:$,invalidUser:H,bootstrapOldFormat:Oe,bootstrapInvalid:function(){return"LaunchDarkly bootstrap data is not available because the back end could not read the flags."},deprecated:G,httpErrorMessage:X,httpUnavailable:W,identifyDisabled:function(){return"identify() has no effect here; it must be called on the main client instance"},streamClosing:Q,streamConnecting:Y,streamError:Z,unknownOption:ee,wrongOptionType:ne,wrongOptionTypeBoolean:te,optionBelowMinimum:re,debugPolling:ie,debugStreamPing:function(){return"received ping message from stream"},debugStreamPut:function(){return"received streaming update for all flags"},debugStreamPatch:Pe,debugStreamPatchIgnored:Ue,debugStreamDelete:Ie,debugStreamDeleteIgnored:je,debugEnqueueingEvent:Re,debugPostingEvents:oe,debugPostingDiagnosticEvent:function(e){return"sending diagnostic event ("+e.kind+")"}});function Fe(e,n,t,r,i,o){var a,u,s,c,l=3<arguments.length&&void 0!==r?r:null,f=4<arguments.length&&void 0!==i?i:null,d={},v=(5<arguments.length&&void 0!==o?o:null)||we(e,t,n),g=n.eventsUrl+"/events/bulk/"+t,m=(s=u=0,c={},(t={}).summarizeEvent=function(e){var n,t;"feature"===e.kind&&(n=e.key+":"+(null!==e.variation&&void 0!==e.variation?e.variation:"")+":"+(null!==e.version&&void 0!==e.version?e.version:""),(t=c[n])?t.count=t.count+1:c[n]={count:1,key:e.key,variation:e.variation,version:e.version,value:e.value,default:e.default},(0===u||e.creationDate<u)&&(u=e.creationDate),e.creationDate>s&&(s=e.creationDate))},t.getSummary=function(){var e,n={},t=!0;for(e in c){var r=c[e],i=n[r.key];i||(i={default:r.default,counters:[]},n[r.key]=i);var o={value:r.value,count:r.count};void 0!==r.variation&&null!==r.variation&&(o.variation=r.variation),r.version?o.version=r.version:o.unknown=!0,i.counters.push(o),t=!1}return t?null:{startDate:u,endDate:s,features:n}},t.clearSummary=function(){s=u=0,c={}},t),p=q(n),y=n.inlineUsersInEvents,h=n.samplingInterval,b=n.eventCapacity,k=n.flushInterval,E=n.logger,w=[],D=0,S=!1,O=!1;function P(){return 0===h||0===Math.floor(Math.random()*h)}function U(e){w.length<b?(w.push(e),O=!1):(O||(O=!0,E.warn(J())),l&&l.incrementDroppedEvents())}return d.enqueue=function(e){var n,t,r;S||(n=r=!1,m.summarizeEvent(e),"feature"===e.kind?P()&&(r=!!e.trackEvents,n=!!e.debugEventsUntilDate&&e.debugEventsUntilDate>D&&e.debugEventsUntilDate>(new Date).getTime()):r=P(),r&&U((r=he({},t=e),"alias"===t.kind||(y||"identify"===t.kind?r.user=p.filterUser(t.user):(r.userKey=t.user.key,delete r.user),"feature"===t.kind&&(delete r.trackEvents,delete r.debugEventsUntilDate)),r)),n&&(delete(e=he({},e,{kind:"debug"})).trackEvents,delete e.debugEventsUntilDate,delete e.variation,U(e)))},d.flush=function(){if(S)return Promise.resolve();var e=w,n=m.getSummary();return m.clearSummary(),n&&(n.kind="summary",e.push(n)),l&&l.setEventsInLastBatch(e.length),0===e.length?Promise.resolve():(w=[],E.debug(oe(e.length)),v.sendEvents(e,g).then(function(e){e&&(e.serverTime&&(D=e.serverTime),j(e.status)||(S=!0),400<=e.status&&me(function(){f.maybeReportError(new I(X(e.status,"event posting","some events were dropped")))}))}))},d.start=function(){a=setTimeout(function e(){d.flush(),a=setTimeout(e,k)},k)},d.stop=function(){clearTimeout(a)},d}var Ce="ready",Le="initialized",Ae="failed";function xe(n,t,r,i,o){var a={};function u(){var e="",n=i.getUser();return n&&(e=r||y(JSON.stringify(n))),"ld:"+t+":"+e}return a.loadFlags=function(){return n.get(u()).then(function(e){if(null==e)return null;try{var n,t=JSON.parse(e);return t&&(void 0===(n=t.$schema)||n<1?t=h(t):delete t.$schema),t}catch(e){return a.clearFlags().then(function(){return Promise.reject(e)})}}).catch(function(e){return o.warn(Te()),Promise.reject(e)})},a.saveFlags=function(e){e=he({},e,{$schema:1});return n.set(u(),JSON.stringify(e)).catch(function(e){return o.warn(Te()),Promise.reject(e)})},a.clearFlags=function(){return n.clear(u()).catch(function(e){return o.warn(Te()),Promise.reject(e)})},a}function _e(i,e,o,n){var a,u=e.streamUrl,s=e.logger,t={},c=u+"/eval/"+o,l=e.useReport,f=e.evaluationReasons,r=e.streamReconnectDelay,d=O(i,e),v=!1,g=null,m=null,p=null,y=null,h=null;function b(e){v||(s.warn(Z(e,r)),v=!0),D(!1),w(),k(r)}function k(e){m||(e?m=setTimeout(E,e):E())}function E(){var e;m=null;var n="",t={headers:d,readTimeoutMillis:3e5};if(i.eventSourceFactory){for(var r in null!=y&&(n="h="+y),l?i.eventSourceAllowsReport?(e=c,t.method="REPORT",t.headers["Content-Type"]="application/json",t.body=JSON.stringify(p)):(e=u+"/ping/"+o,n=""):e=c+"/"+S(JSON.stringify(p)),e=e+((n=f?n+(n?"&":"")+"withReasons=true":n)?"?":"")+n,w(),s.info(Y(e)),a=(new Date).getTime(),g=i.eventSourceFactory(e,t),h)be(h,r)&&g.addEventListener(r,h[r]);g.onerror=b}}function w(){g&&(s.info(Q()),g.close(),g=null)}function D(e){a&&n&&n.recordStreamInit(a,!e,(new Date).getTime()-a),a=null}return t.connect=function(e,n,t){for(var r in p=e,y=n,h={},t||{})!function(n){h[n]=function(e){D(!(v=!1)),t[n]&&t[n](e)}}(r);k()},t.disconnect=function(){clearTimeout(m),m=null,w()},t.isConnected=function(){return!!(g&&i.eventSourceIsActive&&i.eventSourceIsActive(g))},t}var qe="application/json";function Ve(d,v,o){var a=v.baseUrl,u=v.useReport,s=v.evaluationReasons,c=v.logger,e={},g={};function l(e,n){if(!d.httpRequest)return new Promise(function(e,n){n(new de(W()))});var t=n?"REPORT":"GET",r=O(d,v);n&&(r["Content-Type"]=qe);var i,o,a,u,s,c,l=g[e];l||(i=function(){delete g[e]},(c={addPromise:function(n,e){o=n,a&&a(),a=e,n.then(function(e){o===n&&(u(e),i())},function(e){o===n&&(s(e),i())})}}).resultPromise=new Promise(function(e,n){u=e,s=n}),g[e]=l=c);var f=d.httpRequest(t,e,r,n),n=f.promise.then(function(e){if(200!==e.status)return Promise.reject(404===(n=e).status?new le(B()):new de(Ne(n.statusText||String(n.status))));var n;if(e.header("content-type")&&e.header("content-type").substring(0,qe.length)===qe)return JSON.parse(e.body);e=z(e.header("content-type")||"");return Promise.reject(new de(e))},function(e){return Promise.reject(new de(K(e)))});return l.addPromise(n,function(){f.cancel&&f.cancel()}),l.resultPromise}return e.fetchJSON=function(e){return l(a+e,null)},e.fetchFlagSettings=function(e,n){var t,r,i="";return u?(t=[a,"/sdk/evalx/",o,"/user"].join(""),r=JSON.stringify(e)):(e=S(JSON.stringify(e)),t=[a,"/sdk/evalx/",o,"/users/",e].join("")),n&&(i="h="+n),c.debug(ie(t=t+((i=s?i+(i?"&":"")+"withReasons=true":i)?"?":"")+i)),l(t,r)},e}var Je="ld:$anonUserId";function ze(t,r){var e={};return e.validateUser=function(e){if(!e)return Promise.reject(new i($()));var n=ve(e);return null!==n.key&&void 0!==n.key?(n.key=n.key.toString(),Promise.resolve(n)):n.anonymous?(t?t.get(Je).catch(function(){return null}):Promise.resolve(null)).then(function(e){if(e)return n.key=e,n;e=Ee();return e=n.key=e,(t?t.set(Je,e).catch(function(){r.warn(M())}):Promise.resolve()).then(function(){return n})}):Promise.reject(new i(H()))},e}var Me={baseUrl:{default:"https://app.launchdarkly.com"},streamUrl:{default:"https://clientstream.launchdarkly.com"},eventsUrl:{default:"https://events.launchdarkly.com"},sendEvents:{default:!0},streaming:{type:"boolean"},sendLDHeaders:{default:!0},inlineUsersInEvents:{default:!1},allowFrequentDuplicateEvents:{default:!1},sendEventsOnlyForVariation:{default:!1},useReport:{default:!1},evaluationReasons:{default:!1},eventCapacity:{default:100,minimum:1},flushInterval:{default:2e3,minimum:2e3},samplingInterval:{default:0,minimum:0},streamReconnectDelay:{default:1e3,minimum:0},allAttributesPrivate:{default:!1},privateAttributeNames:{default:[]},bootstrap:{type:"string|object"},diagnosticRecordingInterval:{default:9e5,minimum:2e3},diagnosticOptOut:{default:!1},wrapperName:{type:"string"},wrapperVersion:{type:"string"},stateProvider:{type:"object"},autoAliasingOptOut:{default:!1}};function Ke(e,n,t,r){var a=he({logger:{default:r}},Me,t),i={all_attributes_private:"allAttributesPrivate",private_attribute_names:"privateAttributeNames",samplingInterval:null};function u(e){me(function(){n&&n.maybeReportError(new d(e))})}var o,s,c,l,e=he({},e||{});function f(e){if(null===e)return"any";if(void 0!==e){if(Array.isArray(e))return"array";e=se(e);return"boolean"===e||"string"===e||"number"===e||"function"===e?e:"object"}}return o=e,Object.keys(i).forEach(function(e){var n;void 0!==o[e]&&(n=i[e],r&&r.warn(G(e,n)),n&&(void 0===o[n]&&(o[n]=o[e]),delete o[e]))}),s=he({},e),Object.keys(a).forEach(function(e){void 0!==s[e]&&null!==s[e]||(s[e]=a[e]&&a[e].default)}),l=he({},c=e=s),Object.keys(c).forEach(function(e){var n,t,r,i,o=c[e];null!=o&&(void 0===(n=a[e])?u(ee(e)):"any"!==(t=n.type||f(n.default))&&(r=t.split("|"),i=f(o),r.indexOf(i)<0?"boolean"===t?(l[e]=!!o,u(te(e,i))):(u(ne(e,t,i)),l[e]=n.default):"number"===i&&void 0!==n.minimum&&o<n.minimum&&(u(re(e,o,n.minimum)),l[e]=n.minimum)))}),l}function Be(r,e,n,t,i,o){var a,u,s=!!r.diagnosticUseCombinedEvent,c="ld:"+t+":$diagnostics",l=i.eventsUrl+"/events/diagnostic/"+t,f=i.diagnosticRecordingInterval,d=e,v=!!i.streaming;function g(){return{sdk:(e=ce({},r.diagnosticSdkData),i.wrapperName&&(e.wrapperName=i.wrapperName),i.wrapperVersion&&(e.wrapperVersion=i.wrapperVersion),e),configuration:{customBaseURI:i.baseUrl!==$e.baseUrl.default,customStreamURI:i.streamUrl!==$e.streamUrl.default,customEventsURI:i.eventsUrl!==$e.eventsUrl.default,eventsCapacity:i.eventCapacity,eventsFlushIntervalMillis:i.flushInterval,reconnectTimeMillis:i.streamReconnectDelay,streamingDisabled:!v,allAttributesPrivate:!!i.allAttributesPrivate,inlineUsersInEvents:!!i.inlineUsersInEvents,diagnosticRecordingIntervalMillis:i.diagnosticRecordingInterval,usingSecureMode:!!i.hash,bootstrapMode:!!i.bootstrap,fetchGoalsDisabled:!i.fetchGoals,allowFrequentDuplicateEvents:!!i.allowFrequentDuplicateEvents,sendEventsOnlyForVariation:!!i.sendEventsOnlyForVariation,autoAliasingOptOut:!!i.autoAliasingOptOut},platform:r.diagnosticPlatformData};var e}function m(e){i.logger&&i.logger.debug(ue.debugPostingDiagnosticEvent(e)),n.sendEvents(e,l,!0).then(function(){}).catch(function(){})}function p(){var e,n;m((e=(new Date).getTime(),n=ce({kind:s?"diagnostic-combined":"diagnostic",id:o,creationDate:e},d.getProps()),s&&(n=ce({},n,{},g())),d.reset(e),n)),u=setTimeout(p,f),a=(new Date).getTime(),!s||r.localStorage&&(n=ce({},d.getProps()),r.localStorage.set(c,JSON.stringify(n),function(){}))}return(e={}).start=function(){var t;s?(t=function(e){var n;e?(n=(a||0)+f)<=(e=(new Date).getTime())?p():u=setTimeout(p,n-e):0===Math.floor(4*Math.random())?p():u=setTimeout(p,f)},r.localStorage?r.localStorage.get(c).then(function(e){if(e)try{var n=JSON.parse(e);d.setProps(n),a=n.dataSinceDate}catch(e){}t(!0)}).catch(function(){t(!1)}):t(!1)):(m(ce({kind:"diagnostic-init",id:o,creationDate:d.getProps().dataSinceDate},g())),u=setTimeout(p,f))},e.stop=function(){u&&clearTimeout(u)},e.setStreaming=function(e){v=e},e}var $e=Object.freeze({__proto__:null,baseOptionDefs:Me,validate:Ke}).baseOptionDefs;function He(e,n){var r=["debug","info","warn","error"],i=null!=n?""===n?"":n+" ":"LD: ",o=0;e&&(o="none"===e?100:r.indexOf(e));e={};function t(e,n,t){o<=e&&console&&((n=console[n])&&(e=e<r.length?r[e]:"?",n.call(console,i+"["+e+"] "+t)))}return e.debug=function(e){return t(0,"log",e)},e.info=function(e){return t(1,"info",e)},e.warn=function(e){return t(2,"warn",e)},e.error=function(e){return t(3,"error",e)},e}var Ge="change",Xe="internal-change";e.createConsoleLogger=He,e.errors=r,e.initialize=function(e,n,t,o,r){var a,i,u,s,c,l,f,d,v,g,m,p,y,h,b,k,E,w,D,S,O,P=t&&t.logger?t.logger:r&&r.logger&&r.logger.default||He("warn"),U=(D=P,O={},(S={}).on=function(e,n,t){O[e]=O[e]||[],O[e]=O[e].concat({handler:n,context:t})},S.off=function(e,n,t){if(O[e])for(var r=0;r<O[e].length;r++)O[e][r].handler===n&&O[e][r].context===t&&(O[e]=O[e].slice(0,r).concat(O[e].slice(r+1)))},S.emit=function(e){if(O[e])for(var n=O[e].slice(0),t=0;t<n.length;t++)n[t].handler.apply(n[t].context,Array.prototype.slice.call(arguments,1))},S.getEvents=function(){return Object.keys(O)},S.getEventListenerCount=function(e){return O[e]?O[e].length:0},S.maybeReportError=function(e){e&&(O.error?this.emit("error",e):(D||console).error(e.message))},S),I=(y=U,b=h=!1,E=k=null,w=new Promise(function(n){y.on(Ce,function e(){y.off(Ce,e),n()})}).catch(function(){}),{getInitializationPromise:function(){return E||(h?Promise.resolve():b?Promise.reject(k):E=new Promise(function(n,t){y.on(Le,function e(){y.off(Le,e),n()}),y.on(Ae,function e(n){y.off(Ae,e),t(n)})}))},getReadyPromise:function(){return w},signalSuccess:function(){h||b||(h=!0,y.emit(Le),y.emit(Ce))},signalFailure:function(e){h||b||(b=!0,k=e,y.emit(Ae,e),y.emit(Ce)),y.maybeReportError(e)}}),j=Ke(t,U,r,P),R=j.sendEvents,T=e,N=j.hash,t=we(o,T,j),r=j.sendEvents&&!j.diagnosticOptOut,m=r?(m=T,p={diagnosticId:Ee()},m&&(p.sdkKeySuffix=6<m.length?m.substring(m.length-6):m),p):null,p=r?($((new Date).getTime()),{getProps:function(){return{dataSinceDate:f,droppedEvents:d,eventsInLastBatch:v,streamInits:g}},setProps:function(e){f=e.dataSinceDate,d=e.droppedEvents||0,v=e.eventsInLastBatch||0,g=e.streamInits||[]},incrementDroppedEvents:function(){d++},setEventsInLastBatch:function(e){v=e},recordStreamInit:function(e,n,t){g.push({timestamp:e,failed:n,durationMillis:t})},reset:$}):null,F=r?Be(o,p,t,T,j,m):null,C=_e(o,j,T,p),L=j.eventProcessor||Fe(o,j,T,p,U,t),A=Ve(o,j,T),x={},_={},q=j.streaming,V=!1,J=!1,z=!0,M=j.stateProvider,K=(c=function(e,n){M||e&&H({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()}),!j.autoAliasingOptOut&&n&&n.anonymous&&e&&!e.anonymous&&Y(e,n)},{setUser:function(e){var n=l&&ve(l);(l=ke(e))&&c&&c(ve(l),n)},getUser:function(){return l?ve(l):null}}),B=ze(o.localStorage,P);function $(e){f=e,v=d=0,g=[]}function H(e){if(T&&!(M&&M.enqueueEvent&&M.enqueueEvent(e))){if("alias"!==e.kind){if(!e.user)return void(z&&(P.warn("Be sure to call `identify` in the LaunchDarkly client: https://docs.launchdarkly.com/docs/js-sdk-reference#section-analytics-events"),z=!1));z=!1}!R||J||o.isDoNotTrack()||(P.debug(Re(e.kind)),L.enqueue(e))}}function G(e,n,t,r){var i=K.getUser(),o=new Date,a=n?n.value:null;if(!j.allowFrequentDuplicateEvents){var u=JSON.stringify(a)+(i&&i.key?i.key:"")+e,s=x[u];if(s&&o-s<3e5)return;x[u]=o}o={kind:"feature",key:e,user:i,value:a,variation:n?n.variationIndex:null,default:t,creationDate:o.getTime()};i&&i.anonymous&&(o.contextKind=Q(i));e=_[e];e&&(o.version=e.flagVersion||e.version,o.trackEvents=e.trackEvents,o.debugEventsUntilDate=e.debugEventsUntilDate),(r||e&&e.trackReason)&&n&&(o.reason=n.reason),H(o)}function X(e,n,t,r){var i,o;return _&&be(_,e)&&_[e]&&!_[e].deleted?(o=W(i=_[e]),null!==i.value&&void 0!==i.value||(o.value=n)):o={value:n,variationIndex:null,reason:{kind:"ERROR",errorKind:"FLAG_NOT_FOUND"}},t&&G(e,o,n,r),o}function W(e){return{value:e.value,variationIndex:void 0===e.variation?null:e.variation,reason:e.reason||null}}function Q(e){return e.anonymous?"anonymousUser":"user"}function Y(e,n){M||e&&n&&H({kind:"alias",key:e.key,contextKind:Q(e),previousKey:n.key,previousContextKind:Q(n),creationDate:(new Date).getTime()})}function Z(){i=!0,K.getUser()&&C.connect(K.getUser(),N,{ping:function(){P.debug("received ping message from stream");var n=K.getUser();A.fetchFlagSettings(n,N).then(function(e){ge(n,K.getUser())&&ne(e||{})}).catch(function(e){U.maybeReportError(new de(Ne(e)))})},put:function(e){e=JSON.parse(e.data);P.debug("received streaming update for all flags"),ne(e)},patch:function(e){var n,t=JSON.parse(e.data),r=_[t.key];!r||!r.version||!t.version||r.version<t.version?(P.debug(Pe(t.key)),n={},delete(e=he({},t)).key,e=W(_[t.key]=e),n[t.key]=r?{previous:r.value,current:e}:{current:e},te(n)):P.debug(Ue(t.key))},delete:function(e){var n=JSON.parse(e.data);!_[n.key]||_[n.key].version<n.version?(P.debug(Ie(n.key)),e={},_[n.key]&&!_[n.key].deleted&&(e[n.key]={previous:_[n.key].value}),_[n.key]={version:n.version,deleted:!0},te(e)):P.debug(je(n.key))}})}function ee(){i&&(C.disconnect(),i=!1)}function ne(e){var n,t,r={};if(!e)return Promise.resolve();for(n in _)be(_,n)&&_[n]&&(e[n]&&!ge(e[n].value,_[n].value)?r[n]={previous:_[n].value,current:W(e[n])}:e[n]&&!e[n].deleted||(r[n]={previous:_[n].value}));for(t in e)be(e,t)&&e[t]&&(!_[t]||_[t].deleted)&&(r[t]={current:W(e[t])});return _=ce({},e),te(r).catch(function(){})}function te(i){var o,e=Object.keys(i);return 0<e.length&&(o={},e.forEach(function(e){var n=i[e].current,t=n?n.value:void 0,r=i[e].previous;U.emit(Ge+":"+e,t,r),o[e]=n?{current:t,previous:r}:{previous:r}}),U.emit(Ge,o),U.emit(Xe,_),j.sendEventsOnlyForVariation||M||e.forEach(function(e){G(e,i[e].current)})),a&&s?s.saveFlags(_).catch(function(){return null}):Promise.resolve()}function re(){var e=q||u&&void 0===q;e&&!i?Z():!e&&i&&ee(),F&&F.setStreaming(e)}function ie(e){return e===Ge||e.substr(0,Ge.length+1)===Ge+":"}function oe(e){T=e.environment,K.setUser(e.user),_=ce({},e.flags),me(ae)}function ae(){P.info("LaunchDarkly client initialized"),V=!0,re(),I.signalSuccess()}function ue(e){I.signalFailure(e)}return o.localStorage&&(s=new xe(o.localStorage,T,N,K,P)),"string"==typeof j.bootstrap&&"LOCALSTORAGE"===j.bootstrap.toUpperCase()&&(s?a=!0:P.warn(Te())),"object"===se(j.bootstrap)&&(_=function(t){var e=Object.keys(t),r="$flagsState",i=t[r];!i&&e.length&&P.warn(Oe()),!1===t.$valid&&P.warn("LaunchDarkly bootstrap data is not available because the back end could not read the flags.");var o={};return e.forEach(function(e){var n;e!==r&&"$valid"!==e&&(n={value:t[e]},i&&i[e]?n=he(n,i[e]):n.version=0,o[e]=n)}),o}(j.bootstrap)),M?((t=M.getInitialState())?oe(t):M.on("init",oe),M.on("update",function(e){e.user&&K.setUser(e.user),e.flags&&ne(e.flags)})):(e?B.validateUser(n).then(function(e){return K.setUser(e),"object"===se(j.bootstrap)?ae():a?s.loadFlags().catch(function(){return null}).then(function(e){return null==e?(_={},A.fetchFlagSettings(K.getUser(),N).then(function(e){return ne(e||{})}).then(ae).catch(function(e){ue(new de(Ne(e)))})):(_=e,me(ae),A.fetchFlagSettings(K.getUser(),N).then(ne).catch(function(e){return U.maybeReportError(e)}))}):A.fetchFlagSettings(K.getUser(),N).then(function(e){_=e||{},ae()}).catch(function(e){_={},ue(e)})}):Promise.reject(new le(Se()))).catch(ue),{client:{waitForInitialization:function(){return I.getInitializationPromise()},waitUntilReady:function(){return I.getReadyPromise()},identify:function(e,r,n){return J?pe(Promise.resolve({}),n):M?(P.warn("identify() has no effect here; it must be called on the main client instance"),pe(Promise.resolve(ye(_)),n)):pe((a&&s?s.clearFlags():Promise.resolve()).then(function(){return B.validateUser(e)}).then(function(t){return A.fetchFlagSettings(t,r).then(function(e){var n=ye(e);return K.setUser(t),N=r,e?ne(e).then(function(){return n}):n})}).then(function(e){return i&&Z(),e}).catch(function(e){return U.maybeReportError(e),Promise.reject(e)}),n)},getUser:function(){return K.getUser()},variation:function(e,n){return X(e,n,!0,!1).value},variationDetail:function(e,n){return X(e,n,!0,!0)},track:function(e,n,t){var r,i;"string"==typeof e?(o.customEventFilter&&!o.customEventFilter(e)&&P.warn(De(e)),i={kind:"custom",key:e,user:r=K.getUser(),url:o.getCurrentUrl(),creationDate:(new Date).getTime()},r&&r.anonymous&&(i.contextKind=Q(r)),null!=n&&(i.data=n),null!=t&&(i.metricValue=t),H(i)):U.maybeReportError(new fe(De(e)))},alias:Y,on:function(e,n,t){ie(e)?(u=!0,V&&re(),U.on(e,n,t)):U.on.apply(U,arguments)},off:function(e){var n;U.off.apply(U,arguments),ie(e)&&(n=!1,U.getEvents().forEach(function(e){ie(e)&&0<U.getEventListenerCount(e)&&(n=!0)}),n||(u=!1,i&&void 0===q&&ee()))},setStreaming:function(e){e=null===e?void 0:e;e!==q&&(q=e,re())},flush:function(e){return pe(R?L.flush():Promise.resolve(),e)},allFlags:function(){var e,n={};if(!_)return n;for(e in _)be(_,e)&&(n[e]=X(e,null,!j.sendEventsOnlyForVariation).value);return n},close:function(e){return pe(J?Promise.resolve():Promise.resolve().then(function(){if(ee(),F&&F.stop(),R)return L.stop(),L.flush()}).then(n).catch(n),e);function n(){J=!0,_={}}}},options:j,emitter:U,ident:K,logger:P,requestor:A,start:function(){R&&(F&&F.start(),L.start())},enqueueEvent:H,getFlagsInternal:function(){return _},getEnvironmentId:function(){return T},internalChangeEventName:Xe}},e.messages=ue,e.utils=R,e.version="3.3.0",Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof e&&e.amd?e(["exports"],t):t((n=n||self)["LDClient-Common"]={})}(globalRequire.define);
