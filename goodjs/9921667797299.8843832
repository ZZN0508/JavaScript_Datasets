var OKdiscussions,OK=OK||{};OK.editor={CLASS:"ok-e",JS_CLASS:"js-ok-e",DECORATION_STYLE_NAME:"text-decoration"},OK.editor.el={bridge:{triggerSave:{},send:{},updateLengthCounter:{},closeDropdowns:{},onFocus:{},onArrowUpClickOnEmptyTA:{},onEscClick:{},openTextarea:{}}},OK.editor.caretPosition,OK.editor.hasFocus=!1,OK.editor.harness={timer:0,onKeyDown:function(e,t){var n=OK.editor,o=n.el,i=n.util,r=n.tools,s=o.bridge;13!=e.keyCode||e.altKey?38!=e.keyCode||e.ctrlKey||e.metaKey||e.altKey?27!=e.keyCode||e.ctrlKey||e.metaKey||e.altKey||s.onEscClick(e):0==i.getAreaText().length&&(s.onArrowUpClickOnEmptyTA(),e.preventDefault()):(n=e.ctrlKey||e.metaKey,e.shiftKey?i.isWebkit&&r.insertHtml("br"):(t&&n||!t&&!n)&&(s.triggerSave(),o.data("emojiarea")&&o.data("emojiarea").hideMenu(),OK.logging.logger.success("ta","send",n?"ctrlEnter":"enter"),e.preventDefault())),clearTimeout(this.timer),this.timer=setTimeout(function(){s.closeDropdowns(),s.updateLengthCounter("keyDown"),i.updateSrollStyles()},100)},click:function(){var e=OK.editor;e.selector.supportsSelection()&&(e.util.saveCaretPosition(),setTimeout("OK.editor.tools.highlightFormatting()",50))}},OK.editor.selector={getElement:function(e){return util.isText(e)?e.parentNode:e},addRange:function(e){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},getFocusElement:function(e){return e?(e=util.getSelectedNode(e,e.startContainer,e.startOffset,!0),util.isText(e)||util.isImg(e)||util.isElement(e,"BR")?e.parentNode:e):null},getFocusNode:function(){return 0<window.getSelection().rangeCount?window.getSelection().getRangeAt(0).startContainer:null},getFocusOffset:function(){return window.getSelection().getRangeAt(0).startOffset},isSelected:function(e){return 1==e.rangeCount&&e.getRangeAt(0)&&util.isInEditor(e.getRangeAt(0).startContainer)},supportsSelection:function(){return void 0!==window.getSelection},supportsRange:function(){return this.supportsSelection()&&void 0!==document.createRange},supportsTextRange:function(){return void 0!==document.body.createTextRange},getSelection:function(){return this.supportsSelection()?window.getSelection():null},getRange:function(){try{var e=this.getSelection();return e&&this.isSelected(e)?e.getRangeAt(0):null}catch(e){return OK.logging.logger.error("ta.e","getRange_e"),null}},createTextRange:function(){var e=document.selection;return null!=e?e.createRange():null},setStart:function(e,t){e.setStart(t,0)},setEnd:function(e,t){var n;util.isText(t)?e.setEnd(t,t.nodeValue.length):util.isWebKit?e.setEnd(util.normalizeFocus(t),0):(n=Array.prototype.indexOf.call(t.parentNode.childNodes,t),e.setEnd(t.parentNode,n))}},OK.editor.tools={insertHtml:function(e){var t,n,o,i,r,s,a=OK.editor.selector,l=OK.editor.util,c=String.fromCharCode(160);void 0===e.nodeType?s=document.createElement(e):(s=e.cloneNode(!1),l.isImg(s)&&(i=!0)),a.supportsRange()?(o=a.getSelection(),t=a.getRange(),o&&t&&(t.deleteContents(),l.isSpan(a.getElement(o.anchorNode))&&(e=l.getSelectedNode(t,t.startContainer,t.startOffset,!0),o=l.getSelectedNode(t,t.endContainer,t.endOffset,!1),OK.editor.command.splitTextNodes(t,e,o),OK.editor.command.splitSpans(t,e,o),(e=e.parentNode)===o.parentNode&&l.isEmpty(e)&&$(e).remove()),t.insertNode(s),l.moveFocus(s,r=i?{text:c,offset:1}:r),tools.highlightFormatting())):a.supportsTextRange()&&(n=a.createTextRange())&&(s=s.outerHTML,i&&(s+=c),n.pasteHTML(s))},highlightFormatting:function(){var e,t,n,o,i,r,s=OK.editor.selector,a=0;try{if(s.supportsRange()&&void 0!==s.getRange&&(a=1,r=s.getRange(),a=2,n=$(".decoration"),r))if(a=3,tools.cleanFormatting(),a=4,r.collapsed)a=5,e=s.getFocusElement(r),a=6,e&&e.style.cssText&&(a=7,tools.cleanFormatting(),a=8,$.each(e.style.cssText.split(";"),function(e,t){""!=t&&(a=9,tools.decorate(n,t))}));else for(i in o={},a=10,t=r.cloneContents().querySelectorAll("span"),a=11,$.each(0==t.length?[s.getFocusElement(r)]:t,function(e,t){a=12,t.style.cssText&&(a=13,$.each(t.style.cssText.split(";"),function(e,t){""!=t&&(a=14,o[t]=!0)}))}),a=15,o)a=16,tools.decorate(n,i)}catch(e){return void OK.logging.logger.error("ta.e","highlight_e_"+a)}},decorate:function(e,t){e.find("[data-style='"+t.trim()+"']").addClass(util.decorationSelectedCss)},cleanFormatting:function(){jQuery(".decoration").find("."+util.decorationSelectedCss).removeClass(util.decorationSelectedCss)},beforeSendMsg:function(){var e=OK.editor.el;e.saveText&&e.saveText.clearText(e)},setCaretToEnd:function(e){var t,n,o,i,r,s=OK.editor,a=s.selector,l=s.util,c=0,d=s.el;try{if(c=1,!e&&s.hasFocus||!d||void 0===d||"undefined"==typeof jQuery||!(d instanceof jQuery)||d.size()<1)return;c=3,t=d[0],c=4,this.setFocus(!1),c=5,a.supportsRange()?(c=6,n=document.createRange(),o=a.getSelection(),i=s.caretPosition,c=7,o&&n&&(i&&n.setStart&&i.anchorNode&&l.isInEditor(i.anchorNode)&&i.anchorOffset?(c=8,n.setStart(i.anchorNode,i.anchorOffset)):(c=9,n.selectNodeContents(t)),c=12,n.collapse(!1),c=13,void 0!==o.removeAllRanges&&o.removeAllRanges(),c=14,o.addRange(n),c=15,this.highlightFormatting())):a.supportsTextRange()&&(c=16,r=document.body.createTextRange(),c=17,r&&(c=18,r.moveToElementText(t),c=19,r.collapse(!1),c=20,r.select()))}catch(e){return void OK.logging.logger.error("ta.e","setCaretJs_e_"+c)}},setFocus:function(e){var t,n=OK.editor,o=n.selector,i=n.el,r=0;try{if(n.hasFocus||!i||void 0===i||i.size()<1)return;r=1,t=i[0],r=2,o.supportsRange()||e?(r=3,t.focus()):(r=4,setTimeout(function(){t.focus()},10))}catch(e){return void OK.logging.logger.error("ta.e","setFocus_e_"+r)}}},OK.editor.util={zeroWidthSpace:String.fromCharCode(8203),decorationSelectedCss:"d-selected",isWebKit:!1,isSafari:!1,isFireFox:!1,ie11:!1,setActiveElement:function(e){try{if("undefined"==typeof jQuery)return;"ok-e-d"===e&&((void 0===OKdiscussions||OKdiscussions.size()<1)&&(OKdiscussions=jQuery("#"+e)),OK.editor.el=OKdiscussions)}catch(e){OK.logging.logger.error("ta.e","setActiveElementJs_e_"+step)}},isParagraph:function(e){if(void 0!==e){e=e.nodeName.toUpperCase();if("BR"==e||"DIV"==e||"P"==e)return!0}return!1},isSpan:function(e){return this.isElement(e,"SPAN")},isImg:function(e){return this.isElement(e,"IMG")},isElement:function(e,t){return e&&1==e.nodeType&&e.tagName.toUpperCase()==t},isSpace:function(e){return 160==e||32==e},isText:function(e){return e&&3==e.nodeType},isEmpty:function(e){return util.isEmptyText(util.cleanZeroWidth(e.innerHTML))},isEmptyText:function(e){return 0==util.cleanZeroWidth(e).length},isEmptyElement:function(e){return void 0!==e&&(e.innerHTML==util.zeroWidthSpace||util.isEmpty(e)||util.hasOnlyBr(e))},getAreaText:function(){var e,t=OK.editor.el,n=0,o=t.text();t.html();try{return t?(n=1,o=t.text(),n=2,e=t.html(),n=3,""!=o.trim()||(4,n=5,/[<]img[^>]* alt=[^>]+[>]/gi.test(e))?(n=6,this.prepareText(e)):""):""}catch(t){return OK.logging.logger.error("ta.e","getAreaText_e_"+n),""}},prepareText:function(e){var t=0,n=e;try{return n?(t=1,n=n.replace(/(<(\/?(strong|b|em|i|strike|a|u|p|br|img|div|span|font)(([ ][^>]*)|([\/]?)))>)/gi,"[%%[$2]%%]"),t=2,n=n.replace(/<[^>]*>/gi,""),t=3,n=n.replace(/(\[%%\[([^\]]*)\]%%\])/gi,"<$2>"),t=4,n=n.replace(/(<\w+)(?=[^>]*=\s*')(?:[^\/>]*(?:[\/][^>])?)*([\/]?>)/gi,"$1$2"),t=5,n.replace(/&nbsp;/g," ")):""}catch(n){return OK.logging.logger.error("ta.e","prepareTextJs_e_"+t),e}},cleanZeroWidth:function(e){for(;-1!=e.indexOf(this.zeroWidthSpace);)e=e.replace(this.zeroWidthSpace,"");return e},isEditor:function(e){return!util.isText(e)&&$(e).hasClass(OK.editor.JS_CLASS)},hasOnlyBr:function(e){return 1==e.childNodes.length&&util.isElement(e.firstChild,"BR")},after:function(e,t){this.checkScheme(e.parentNode,t),e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)},before:function(e,t){this.checkScheme(e.parentNode,t),e.parentNode.insertBefore(t,e)},throwSchemeViolation:function(){},throwSelectionError:function(){},checkScheme:function(e,t){(this.isSpan(e)&&this.isSpan(t)||this.isImg(e))&&this.throwSchemeViolation()},isInEditor:function(e,t){for(;e;){if(this.isEditor(e))return!t||t.id==e.id;e=e.parentNode}return!1},createEl:function(e,t,n){return this.formatCss(e,t),n.nodeType?this.append(e,n):this.append(e,document.createTextNode(n)),e},createSpan:function(e,t){var n=document.createElement("span");return this.createEl(n,e,t)},inheritSpan:function(e,t,n){e=e&&this.isSpan(e)?e.cloneNode(!1):document.createElement("span");return t&&this.formatCss(e,t),n&&(n.nodeType?this.append(e,n):$(e).text(n)),e},formatCss:function(e,t,n){var o=$(e),i=t.split(":"),r=i[0].trim();n&&OK.editor.command.hasSameStyle(e,t)?o.css(r,""):o.css(r,i[1].trim())},moveAllAfter:function(e,t,n){for(var o;e.nextSibling;)o=e.nextSibling,$(o).remove(),util.append(t,o,n)},moveAllBefore:function(e,t){for(var n,o=e.parentNode;o.firstChild!=e;)n=o.firstChild,$(n).remove(),this.append(t,n)},append:function(e,t,n){n&&util.checkScheme(e,t),e.appendChild(t)},replace:function(e,t){this.isEditor(e)&&this.throwSchemeViolation(),this.checkScheme(e.parentNode,t),e.parentNode.replaceChild(t,e)},normalizeFocus:function(e){var t;return e=!e.nextSibling||util.isText(e.nextSibling)&&0==e.nextSibling.nodeValue.length?(t=document.createTextNode(""),util.after(e,t),t):e.nextSibling},moveFocus:function(e,t){var n,o=document.createRange();t=t||{text:util.zeroWidthSpace,offset:0},n=document.createTextNode(t.text),e=e.firstChild||e,util.after(e,n),o.setStart(n,t.offset),selector.addRange(o),this.saveCaretPosition()},getSelectedNode:function(e,t,n,o){var i=!o,o=!1;return util.isText(t)||0==t.childNodes.length?t:((n=t.childNodes[n])||(n=t.lastChild,o=!0),n||util.throwSelectionError(),i&&(util.isWebKit&&util.isText(n)||(util.isFireFox||util.isWebKit&&!o)&&util.isImg(n))&&(n=util.find(n,!1),util.isFireFox&&(n=n.lastChild||n)),n)},find:function(e,t){for(var n=t?"nextSibling":"previousSibling",o=e.parentNode,i=e[n];null==i&&o;)i=o[n],o=o.parentNode;return util.isInEditor(i)?i:null},findBr:function(e,t){var n=t?"nextSibling":"previousSibling",o=(e.parentNode,e);for(o.nodeName;null!=o;){if(this.isParagraph(o))return o;var i=o[n];if(null!=i){if(this.isParagraph(i))return o;o=i}else{if(null==o.parentNode||this.isEditor(o.parentNode))return o;o=o.parentNode}}},move:function(e,t){$(e).remove(),this.append(t,e)},staticInit:function(e,t,n,o){var i,r,s,a=OK.editor,l=a.util,c=a.harness;l.setActiveElement(e),(i=a.el).size()<1?setTimeout(function(){l.staticInit(e,t,n,o)},100):(i.bridge=n,r=$.extend({},{formattingDisabled:!1,allowedTags:"",saveTextInLS:!1},o),i.on({click:function(){c.click()},paste:function(){var e=$(this);setTimeout(function(){r.allowedTags?l.cleanPaste(e,r.allowedTags):l.cleanPasteOld(e,void 0),l.updateSrollStyles(),i.bridge.updateLengthCounter("paste")},50)},keydown:function(e){!r.formattingDisabled||!e.ctrlKey&&!e.metaKey||66!==e.keyCode&&73!==e.keyCode&&85!==e.keyCode||e.preventDefault()},focus:function(){a.hasFocus=!0,i.bridge.updateLengthCounter("focus"),i.bridge.onFocus(),l.updateIsEmpty()},blur:function(){a.hasFocus=!1,l.updateIsEmpty()}}),i.on("keypress",function(e){c.onKeyDown(e,t)}),i.on("textchange",function(){s&&clearTimeout(s),s=setTimeout(function(){l.updateSrollStyles()},500)}),r.saveTextInLS&&require(["OK/saveText"],function(){i.saveText({afterRestoreValue:function(){s&&clearTimeout(s),s=setTimeout(function(){tools.setCaretToEnd(!0),l.onSetText()},100)}})}),l.hideLoadingProcess(e),l.updateSrollStyles(!0),l.updateIsEmpty())},initDropdown:function(e,t){var n,o,i=(new Date).getTime(),r=OK.logging.logger,s=OK.editor,a=s.util,l=s.tools;"format"==t?(o="A",n=function(e){var t=a.decorationSelectedCss,n=$(e),o=n.attr("data-style");-1==o.indexOf(":")&&(e=n.css(o),o===OK.editor.DECORATION_STYLE_NAME&&(e=e.split(" ")[0]),n.attr("data-style",o=o+": "+e)),r.success("ta","format",o.split(":")[0]),s.command.format(n.hasClass(t),o)}):"smiles"==t&&(o="IMG",n=function(e){r.success("ta","smile"),l.insertHtml(e)}),$("#"+e).on({mousedown:!1,click:function(e){e.preventDefault(),s.selector.supportsSelection()?l.setCaretToEnd():l.setFocus(!0);e=e.target;e.nodeName.toUpperCase()==o&&n(e)}}),0<(i=(new Date).getTime()-i)&&r.durationScalar("ta",t+"_duration",i)},hideLoadingProcess:function(e){null!=(e=document.getElementById(e+"_button"))&&e.classList.remove("__loading")},normalizeFont:function(){var e,t,n,o;selector.supportsRange()&&(n=selector.getRange(),o=util.isElement(selector.getFocusElement(n),"FONT")||util.isElement(selector.getFocusElement(n),"B")&&util.isElement(selector.getFocusElement(n).parentNode,"FONT"),n&&(util.isSafari||util.isWebKit)&&o&&(t=(e=selector.getFocusNode()).parentNode,n=document.createRange(),o=$(t).contents(),$(t).replaceWith(o),n.setStart(e,e.length),selector.addRange(n)))},cleanWordComments:function(e){e.contents().filter(function(){return 8==this.nodeType}).remove()},cleanPasteOld:function(e,t){this.cleanWordComments(e),t&&e.html(util.stripTags(e.html(),t));for(var n,o,i,r,s=e.get(0).firstChild;s;)(r=$(s)).hasClass("emoji")||r.removeAttr("class"),util.isSpan(s)&&util.isSpan(s.parentNode)&&(o=s.parentNode,n=util.inheritSpan(o),util.moveAllAfter(s,n,!1),util.after(o,n),r.remove(),util.before(n,s),i=s),s=s.firstChild||util.find(s,!0);i&&util.moveFocus(i)},cleanPaste:function(e,t){util.saveCaretPosition(),e.find("*").addBack().contents().filter(function(){return 8===this.nodeType}).remove();var n=e.find("*:not("+t+")");n.contents().unwrap(),n.remove(),e.find("*:not(img.emoji, img.usmile, img[alt^='#u'][alt$='s#'])").each(function(){for(var e=this.attributes,t=e.length;t--;){var n=e[t];this.removeAttributeNode(n)}});var o=e.children(),t=1==o.size();t&&o.contents().unwrap(),(t||0<n.size())&&(e.get(0).normalize(),tools.setCaretToEnd(!0))},saveCaretPosition:function(){var e,t=OK.editor,n=t.selector;t.hasFocus&&n.supportsSelection()&&(e=t.selector.getSelection())&&(t.caretPosition=$.extend({},e))},stripTags:function(e,t){var n,o,i,r="",s=!1,a=[],l=[],c=0,d="",u="";try{for(r in t&&(l=t.match(/([a-zA-Z0-9]+)/gi)),a=(e+="").match(/(<\/?[\S][^>]*>)/gi))if(!isNaN(r)){for(d in u=a[r].toString(),s=!1,l)if(n=l[d],c=-1,c=u.toLowerCase().indexOf("<"+n+">"),0!=c&&(c=u.toLowerCase().indexOf("<"+n+" ")),0!=c&&(c=u.toLowerCase().indexOf("</"+n)),0==c){s=!0;break}s||(o=u,i="",e=e.split(o).join(i),OK.logging.logger.success("ta","strip"))}return e}catch(t){return OK.logging.logger.error("ta.e","stripTags_e_"+step),e}},hasScroll:function(){var e=0;try{if(!OK.editor.el)return!1;var e=1,t=OK.editor.el[0];if(void 0===t)return!1;e=2;var n=!!t.scrollTop;return e=3,n||(e=4,t.scrollTop=1,e=5,n=!!t.scrollTop,e=6,t.scrollTop=0),e=7,n}catch(t){return OK.logging.logger.error("ta.e","hasScroll_e_"+e),!1}},updateSrollStyles:function(e){var t=0;try{if("undefined"==typeof jQuery)return;var t=1,n=jQuery,o=util.hasScroll();if(t=2,!e&&OK.editor.hasScroll===o)return;t=3,OK.editor.hasScroll=o,t=4,OK.editor.toolbar||(t=5,OK.editor.toolbar=n(".topPanel_m .disc_toolbar_w")),t=6,OK.editor.toolbar.toggleClass("__has-scroll",o)}catch(e){OK.logging.logger.error("ta.e","updateSrollStyles_e_"+t)}},updateIsEmpty:function(){var e=OK.editor.el;(e.hasClass("add-placeholder")||e.hasClass("add-caret"))&&setTimeout(function(){e.toggleClass("__empty",0===util.getAreaText().length)},0)},initMentions:function(e,r,s,a,l,c){var d=document.getElementById(e);require(["OK/postingForm/mentions","PTS/discussion.client","OK/suggest/searchEngines"],function(e,t,n){var o,i=e("cfmdsc_"+(new Date).getTime()),e=OK.editor.selector;i.mentionsCharStart=r||3,i.cleanupOnPaste=!1,i.useText=!0,l&&(o=n.commentMentionsEngine(l,c)),i.init(t.markFriendDisabled,a,e,!0,o),s.resolve(i.bind(d))})},onSetText:function(){util.updateIsEmpty(),OK.editor.el.trigger("keypress"),tools.cleanFormatting()}};var harness=OK.editor.harness,selector=OK.editor.selector,tools=OK.editor.tools,util=OK.editor.util;OK.editor.command={format:function(e,t){OK.editor.el.get(0).normalize();var n,o,i,r=OK.editor.util;selector.supportsRange()&&(n=selector.getRange())&&(o=r.getSelectedNode(n,n.startContainer,n.startOffset,!0),i=r.getSelectedNode(n,n.endContainer,n.endOffset,!1),o&&i||r.throwSelectionError(),-1!=t.indexOf("text-align")?this.formatDiv(n,o,i,t):n.collapsed?this.formatSingle(n,o,i,t,e):this.formatRange(n,o,i,t,e),tools.highlightFormatting())},formatSpan:function(e,t,n){OK.editor.util.formatCss(e,t,!0)},formatRange:function(e,t,n,o,i){var r,s,a,l,c=OK.editor.util;for(this.splitTextNodes(e,t,n),this.splitSpans(e,t,n),r=t;r;)(a=(s=r)===n)?(r=null,selector.setEnd(e,s)):r=r.firstChild||c.find(r,!0),c.isImg(s)||(c.isText(s)?c.isSpan(s.parentNode)?this.formatSpan(s.parentNode,o,i):c.isSpan(s.previousSibling)?c.move(s,s.previousSibling):(l=s.cloneNode(!1),c.replace(s,c.createSpan(i?"":o,l)),a&&selector.setEnd(e,l)):c.isSpan(s)&&0==s.childNodes.length&&this.formatSpan(s,o,i));selector.addRange(e)},formatDiv:function(e,t,n,o){var i,r,s,a=OK.editor.util,l=document.createDocumentFragment();if(!OK.editor.el.get(0).hasChildNodes()){r=document.createElement("div"),a.formatCss(r,o,!1),a.append(r,document.createTextNode(String.fromCharCode(8203))),a.append(t,r),e=document.createRange();var c=window.getSelection();return e.setStart(r,0),e.collapse(!1),c.removeAllRanges(),void c.addRange(e)}if("BR"==t.nodeName.toUpperCase()&&t.previousSibling&&!a.isParagraph(t.previousSibling)&&(t=t.previousSibling),i=a.findBr(t,!1),a.findBr(n,!0),"DIV"==i.nodeName.toUpperCase())r=i,a.formatCss(r,o,!0);else{for(r=document.createElement("div"),a.formatCss(r,o,!1);i=(s=i).nextSibling,a.append(r,s),i&&!a.isParagraph(i););i&&"BR"==i.nodeName.toUpperCase()&&i.nextSibling&&(i=(s=i).nextSibling,$(s).remove()),r.innerHTML||a.append(r,document.createTextNode(String.fromCharCode(8203))),l.appendChild(r)}l.hasChildNodes()&&(e.insertNode(l),a.moveFocus(r))},splitTextNodes:function(e,t,n){var o,i=t.nodeValue,r=OK.editor.util,s=n.nodeValue,a=r.isText(t)&&0<e.startOffset,l=r.isText(n)&&e.endOffset<s.length;a&&(o=i.substr(0,e.startOffset),0<r.cleanZeroWidth(o).length&&r.before(t,document.createTextNode(o))),l&&(o=s.substr(e.endOffset),0<r.cleanZeroWidth(o).length&&r.after(n,document.createTextNode(o))),t===n&&r.isText(t)?t.nodeValue=i.substr(e.startOffset,e.endOffset-e.startOffset):(a&&(t.nodeValue=i.substr(e.startOffset)),l&&(n.nodeValue=s.substr(0,e.endOffset)))},splitSpans:function(e,t,n){var o,i=t.parentNode,r=n.parentNode,s=OK.editor.util;s.isSpan(i)&&t.previousSibling&&(o=s.inheritSpan(i,null,null),s.moveAllBefore(t,o),s.isEmpty(o)||s.before(i,o)),s.isSpan(r)&&n.nextSibling&&(o=s.inheritSpan(r,null,null),s.moveAllAfter(n,o),s.isEmpty(o)||s.after(r,o))},hasSameStyle:function(e,t){var n=t.split(":"),t=n[0],n=n[1].trim(),e=$(e).css(t);return(e=t===OK.editor.DECORATION_STYLE_NAME?e.split(" ")[0]:e)===n},formatSingle:function(e,t,n,o,i){var r,s,a=OK.editor.util,l=a.isText(t)&&(a.isWebKit||a.isSafari?t.nodeValue:a.cleanZeroWidth(t.nodeValue)).length===e.endOffset&&(a.isSafari||a.isWebKit||t.parentNode.lastChild==t);a.isSpan(t.parentNode)?r=t.parentNode:a.isSpan(t)&&(r=t),r&&this.hasSameStyle(r,o)&&(!l||a.isEmptyElement(r))?$(r).css(o.split(":")[0],""):r?a.isEmptyElement(r)?a.formatCss(r,o):(s=a.inheritSpan(r,o,a.zeroWidthSpace),a.isText(n)&&e.endOffset<n.nodeValue.length&&this.splitTextNodes(e,t,n),this.splitSpans(e,t,n),l&&i&&$(s).css(o.split(":")[0],""),a.after(t.parentNode,s),a.moveFocus(s)):(s=a.createSpan(o,a.zeroWidthSpace),e.insertNode(s),a.moveFocus(s))}};
