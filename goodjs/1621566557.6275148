!function(t){function e(t,e){this._handlers=this._handlers||[],this._handlers.push({cb:t,ctx:e||this})}function i(){var t,e,i=this._handlers||[];for(e=0;e<i.length;e++)t=i[e],t.cb.apply(t.ctx,arguments)}function r(){function t(){n._disabled||(n._tick(),s++,e=Date.now()-r-s*i,window.setTimeout(t,Math.max(i-e,50)))}var e,i=1e3,r=Date.now(),s=0;window.setTimeout(t,i)}var n=t.Timer=function(e,i){this._interval=t.isNumber(e)&&e>0?e:0,this._repeat=i,n.onTick(this._onTick,this)},s=n.prototype;s.onAlarm=function(t,i){return e.call(this,t,i),this},s._onTick=function(t){if(this._interval)return this._repeat?void(t%this._interval==0&&i.call(this,t)):void(this._interval===t&&i.call(this,t))},n._ticks=0,n._started=!1,n.init=function(t){t&&t>0&&(this._ticks=t)},n.start=function(){this._started=!0},n.stop=function(){this._started=!1},n.disable=function(){this._disabled=!0},n.reset=function(){this._ticks=0},n.onTick=function(t,i){e.call(this,t,i)},n._tick=function(){!this._disabled&&this._started&&(this._ticks++,i.call(this,this._ticks))},t.isTest?n.run=r:r()}(window.Sandbox),Sandbox.static(function(){var t=window.Sandbox,e=t.Counter=function(t){this.params=t},i=e.prototype;i.hit=function(t,e){if(t.path){var i=this._getUrl(t,e);this._makeReq(i)}},i._makeReq=function(t){window.parent.postMessage("sandbox-counter:"+t,"*")},i._getUrl=function(i,r){var n={reqid:this.params.reqid,rnd:this._getRnd(2),yuid:this.params.yuid?this.params.yuid:"${yuid}"};return i.login&&(i.login=this.params.login?this.params.login:"${login}"),i.pid||(i.pid=this.params.pid),i.dtype="stred",["/jclck/",new t.Query(n).toString("/",!0,e.ENCODE_EXCEPT_PARAMS),new t.Query(i).toString("/",!0,e.ENCODE_EXCEPT_PARAMS),"*",this._getAsterixData(r)].join("")},i._getRnd=function(t){return(new Date).getTime()+Math.floor(Math.random()*Math.pow(10,t))},i._getAsterixData=function(t){return t?"data="+encodeURIComponent("url="+t):""},e.ENCODE_EXCEPT_PARAMS=["reqid","path","yuid","login"]}),Sandbox.decl({LOGGED_PLAYER_EVENTS:["inited","started","ended","paused","error","resumed","rewound","adShown","adEnd","qualityChanged","bufferingStarted","bufferingEnded"],init:function(){this.initCounters()},initCounters:function(){if(this._playbackCountersError=this.validateCountersParams(this.counters),this._playbackCountersError)return void this._logCountersError(this._playbackCountersError);this.rememberEvent=this.onPlayerEventForCounters,this.counters.live&&(this.counters.duration=0);var t=this.counters.heartbeats=this.counters.heartbeats||{};t.singlePath=t.singlePath||"heartbeat.single",t.repeatPath=t.repeatPath||"heartbeat.repeat",this.counters.pid=this.counters.pid||197,this.counters.clickId=(new Date).getTime(),this.counters.selectEvent=this.counters.selectEvent||"default",this.counters.extraParams=this.counters.extraParams||{},this.yaCounter=new Sandbox.Counter(this.counters),Sandbox.Timer.onTick(this.onTick,this);var e=this.calcHbSingleInterval(this.counters.duration),i=this.calcHbRepeatInterval(this.counters.duration);if(this.timers={single:new Sandbox.Timer(e,!1).onAlarm(this.onHeartbeatSingle,this)},t.noRepeat||(this.timers.repeat=new Sandbox.Timer(i,!0).onAlarm(this.onHeartbeatRepeat,this)),this.prevEventTrigger(),!this.PLAYER_EVENTS_SUPPORTED){this.PLAYER_EVENTS_SUPPORTED=!1;var r=Math.round(((new Date).getTime()-Sandbox.INIT_TIME)/1e3);Sandbox.Timer.init(r),Sandbox.Timer.start()}},validateCountersParams:function(t){return Sandbox.isObject(t)?t.reqid?t.live||Sandbox.isNumber(t.duration)&&!(t.duration<=0)?"":"Ð’ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸ÐºÐ¾Ð² Ð½ÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ duration":"Ð’ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸ÐºÐ¾Ð² Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ reqid":"ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸ÐºÐ¾Ð²"},prevEventTrigger:function(){if(Array.isArray(this.eventsStory))for(var t=0;t<this.eventsStory.length;t++)this.onPlayerEventForCounters.apply(this,this.eventsStory[t]);this.eventsStory=[]},calcHbSingleInterval:function(t){return t?Math.floor(Math.min(.5*t,300+2e5/t)):0},calcHbRepeatInterval:function(t){return t?Math.floor(Math.max(.1*t,30)):30},getCounterParams:function(){var t={click_id:this.counters.clickId,select_event:this.counters.selectEvent,duration:Math.round(this.counters.duration),client_timestamp:Date.now(),cts:Date.now(),jsapi:this.PLAYER_EVENTS_SUPPORTED?1:0};this.counters.videoUrl&&(t.source_url=this.counters.videoUrl),this.counters.licence&&(t.licence=this.counters.licence),this.counters.svod&&(t.svod=this.counters.svod),Sandbox.isUndefined(this.counters.watchedTime)||(t.watchedTime=this.counters.watchedTime),this.player&&Sandbox.isFunction(this.player.isMuted)&&(t.mute=this.player.isMuted()?1:0),this.counters.table&&(t.table=this.counters.table);var e=this.counters.extraParams;for(var i in e)e.hasOwnProperty(i)&&!t[i]&&(t[i]=e[i]);return t},prepareHeartbeatPath:function(t){return document.hidden&&(t+=".inactive-tab"),t},hitPixels:function(t){if(!this._playbackCountersError&&Array.isArray(t))for(var e=0;e<t.length;e++)this.yaCounter.hit(t[e],this.counters.videoUrl)},onTick:function(t){this.counters.live&&this.counters.duration<t&&(this.counters.duration=t+10),t>this.counters.duration||this.trigger("timerTick",{ticks:t})},onHeartbeatSingle:function(t){if(!(this._playbackCountersError||t>this.counters.duration)){var e=this.getCounterParams();e.path=this.prepareHeartbeatPath(this.counters.heartbeats.singlePath),e.cid=72339,e.ticks=t,e.login=!0,this.yaCounter.hit(e,this.counters.videoUrl),this.hitPixels(this.counters.heartbeats.singlePixels),this.trigger("heartbeatSingleHit",{ticks:t})}},onHeartbeatRepeat:function(t){if(!(this._playbackCountersError||t>this.counters.duration)){var e=this.getCounterParams();e.path=this.prepareHeartbeatPath(this.counters.heartbeats.repeatPath),e.cid=72339,e.ticks=t,e.login=!0,this.yaCounter.hit(e,this.counters.videoUrl),this.hitPixels(this.counters.heartbeats.repeatPixels),this.trigger("heartbeatRepeatHit",{ticks:t})}},onPlayerEventForCounters:function(t,e){if(!this._playbackCountersError){switch(t){case"started":case"resumed":this.PLAYER_EVENTS_SUPPORTED=!0,Sandbox.Timer.start();break;case"paused":case"ended":this.PLAYER_EVENTS_SUPPORTED=!0,Sandbox.Timer.stop();break;case"timeupdate":this.counters.watchedTime=e?e.utcTime:0;break;case"durationchange":this.counters.duration=e?e.duration:0}this.LOGGED_PLAYER_EVENTS.indexOf(t)>-1&&this.hitPlayerEventCounter(t,e)}},hitPlayerEventCounter:function(t,e){if(!this._playbackCountersError){var i=this.getCounterParams();i.cid=73037,i.path="player-events."+t,e&&!Sandbox.isUndefined(e.isMuted)&&(i.mute=e.isMuted?1:0),e&&e.quality&&(i.quality=e.quality),e&&e.time&&(i.time=e.time),e&&e.code&&(i.code=e.code),e&&e.source&&(i.source=e.source),e&&!Sandbox.isUndefined(e.previousTime)&&(i.previousTime=e.previousTime),this.yaCounter.hit(i,this.counters.videoUrl)}},_logCountersError:function(t){this.counters&&this.counters.debug&&window.console&&window.console.error&&console.error(t)}});