function providePlugin(e,t){var n=window[window.GoogleAnalyticsObject||"ga"];"function"==typeof n&&n("provide",e,t),setTimeout(function(){var e=document.querySelectorAll("input");if(e)for(var t=0;t<e.length;t++)e[t].addEventListener("blur",riskCheck)},750)}function provideGtagPlugin(t){var n=0,i=setInterval(function(){++n;var e=window.gtag;void 0===e&&5!==n||(Window.IpMeta=new IpMeta(e,t),Window.IpMeta.loadGtagNetworkFields(),clearInterval(i))},500)}function provideGtmPlugin(e){return Window.IpMeta=new IpMeta([],e),Window.IpMeta.loadGtmNetworkFields(),[]}function rc(e){var t=new XMLHttpRequest;t.open("POST","https://risk.ipmeta.io/check",!0),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({assoc:e}))}function riskCheck(e){input=e.srcElement.value,/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(input)&&rc(encr(input.replace(/.*@/,"")))}var IpMeta=function(e,t){this.tracker=e,this.nameDimension=t.serviceProvider||t.nameDimension||"dimension1",this.domainDimension=t.networkDomain||t.domainDimension||"dimension2",this.typeDimension=t.networkType||t.typeDimension||"dimension3",this.gtmEventKey=t.gtmEventKey||"pageview",this.isLocal=t.local||!1,this.apiKey=t.apiKey,this.isDebug=t.debug};function enrichNetwork(e,t,n){var i,o;t=t||!1,storageKey=e+"ipmetaNetworkResponse",null===sessionStorage.getItem(storageKey)?(i=new XMLHttpRequest,o="h="+encodeURI(window.location.hostname),e&&(o+="&k="+e),i.open("POST",t?"http://ipmeta.test/api/enrich":"https://ipmeta.io/api/enrich",!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.setRequestHeader("Accept","application/json"),i.send(o),i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE)return 200===i.status?(sessionStorage.setItem(storageKey,i.responseText),void n(JSON.parse(i.responseText),!0)):(429===i.status?console.error(JSON.parse(i.responseText)[0]):console.error("IpMeta lookup failed.  Returned status of "+i.status),!1)}):n(JSON.parse(sessionStorage.getItem(storageKey)),!1)}function encr(e){return"IPM"+btoa(btoa("bf2414cd32581225a82cc4fb46c67643"+btoa(e))+"dde9caf18a8fc7d8187f3aa66da8c6bb")}IpMeta.prototype.loadNetworkFields=function(){void 0===Window.IpMeta&&(Window.IpMeta=this),this.debugMessage("Loading network field parameters"),enrichNetwork(this.apiKey,this.isLocal,function(e,t){var t=t||!1,n=e.name||"(not set)",i=e.domain||"(not set)",e=e.type||"(not set)";n&&(Window.IpMeta.tracker.set(Window.IpMeta.nameDimension,n),Window.IpMeta.debugMessage("Loaded network name: "+n+" into "+Window.IpMeta.nameDimension)),i&&(Window.IpMeta.tracker.set(Window.IpMeta.domainDimension,i),Window.IpMeta.debugMessage("Loaded network domain: "+i+" into "+Window.IpMeta.domainDimension)),e&&(Window.IpMeta.tracker.set(Window.IpMeta.typeDimension,e),Window.IpMeta.debugMessage("Loaded network type: "+e+" into "+Window.IpMeta.typeDimension)),t&&Window.IpMeta.tracker.send("event","IpMeta","Enriched","IpMeta Enriched",{nonInteraction:!0})})},IpMeta.prototype.setGtagMapping=function(e){var t=e.name||"(not set)",n=e.domain||"(not set)",i=e.type||"(not set)",e={};e[this.nameDimension]=t,e[this.domainDimension]=n,e[this.typeDimension]=i,e.non_interaction=!0,Window.IpMeta.tracker("event","ipmeta_event",e)},IpMeta.prototype.loadGtagNetworkFields=function(){void 0===Window.IpMeta&&(Window.IpMeta=this),this.debugMessage("Loading network field parameters"),enrichNetwork(this.apiKey,this.isLocal,function(e,t){Window.IpMeta.setGtagMapping(e)})},IpMeta.prototype.loadGtmNetworkFields=function(){void 0===Window.IpMeta&&(Window.IpMeta=this),this.debugMessage("Loading network field parameters");var o=this.gtmEventKey;enrichNetwork(this.apiKey,this.isLocal,function(e,t){t=t||!1;var n=e.name||"(not set)",i=e.domain||"(not set)",t=e.type||"(not set)",e={};e.event=o,e.nameValue=n,e.domainValue=i,e.typeValue=t,e.nonInteraction=!0,window.dataLayer=window.dataLayer||[],window.dataLayer.push(e)})},IpMeta.prototype.setDebug=function(e){this.isDebug=e},IpMeta.prototype.debugMessage=function(e){this.isDebug&&console&&console.debug(e)},providePlugin("ipMeta",IpMeta);
