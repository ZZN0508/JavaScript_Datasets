"use strict";!function(){var c=window.location.host.replace(/^.*?([\w\d\-]+\.[\w\d\:]+)\r?$/,"$1"),r=["wsj.com","marketwatch.com","barrons.com"],e=c.indexOf(":"),a=c=-1<e?c.substr(0,e):c,s={ssoSecondaryIframes:{},generateSsoIframes:function(e,o,t){for(var n=0;n<r.length;n++){var a=r[n].trim(),s="iframe-rp-"+a+"-"+(new Date).getTime(),a=this.createIframe(s,a,o,t);this.ssoSecondaryIframes[s]=this.onIframeCompleted.bind(this),e.appendChild(a)}},generateRestoreIframe:function(e,o){var t=c,n="iframe-rp-"+t+"-"+(new Date).getTime(),o=this.createIframe(n,t,"monitor",o);this.ssoSecondaryIframes[n]=this.onIframeCompleted.bind(this),e.appendChild(o)},createIframe:function(e,o,t,n){o.split(".")[0];var a=document.createElement("iframe");a.setAttribute("id",e);var s,r=window.location.protocol+"//accounts."+o,d=r+"/assets/secondary-rp-sync.html?iframe_id="+encodeURIComponent(e),i="",m="https://accounts.dowjones.com".replace("dowjones.com",o);return i="logout"==t?(s=r+"/auth/slo-done?iframe_id="+encodeURIComponent(e),c===o?s:m+"/auth/sso/logout?url="+encodeURIComponent(d)):"login"==t?(t=r+"/auth/sso-done?iframe_id="+encodeURIComponent(e),c===o?t:m+"/auth/silent-login?target="+encodeURIComponent(d)):r+"/auth/sso-restore?djcs_session="+n+"&iframe_id="+encodeURIComponent(e),a.setAttribute("src",i),a.setAttribute("style","width:0;height:0;border:none"),a},onIframeCompleted:function(e){delete this.ssoSecondaryIframes[e],document.getElementsByTagName("body")[0].removeChild(document.getElementById(e))},clearIframes:function(){for(var e in this.ssoSecondaryIframes)this.ssoSecondaryIframes[e](e)}},d=function(e,o){e=(o||document.cookie).match(RegExp("(?:^|;\\s*)"+e.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")+"=([^;]*)"));return e?e[1]:null},i=function(e,o){o.cookie=e+"=; Domain=."+a+"; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"},o=(document.getElementsByTagName("body")[0],d("run-sso")),t=d("run-slo"),n=d("djcs_route");function m(o){if(!(o.origin.indexOf(c)<0&&o.origin.indexOf("dowjones.com")<0)&&"string"==typeof o.data&&"DJSSO"===o.data.substr(0,5))try{var e,t=o.data.split("|")[2],n=JSON.parse(t);"iframe-done"===n.name&&(void 0!==window.localStorage&&("sso-done"===n.data.action?n.data.session&&0==n.data.session.indexOf("M")&&(window.localStorage.setItem("session",n.data.session),window.localStorage.setItem("routeid",d("djcs_route")),window.localStorage.setItem("ts",Date.now())):"slo-done"===n.data.action&&(window.localStorage.removeItem("session"),window.localStorage.removeItem("routeid"),window.localStorage.removeItem("ts"),i("restored-sso",document))),s.onIframeCompleted.call(s,n.data.frameId),(e=d("restored-sso"))&&"true"===e&&(document.cookie="restored-sso=done; Domain=."+a+"; Path=/",window.location.reload()))}catch(e){console.error("event data not JSON",o)}}o&&n?(i("run-sso",document),s.generateSsoIframes(document.getElementsByTagName("body")[0],"login",n)):t&&n?(i("run-slo",document),s.generateSsoIframes(document.getElementsByTagName("body")[0],"logout",n)):void 0!==window.localStorage&&(e=window.localStorage.getItem("session"),o=window.localStorage.getItem("routeid"),t=window.localStorage.getItem("ts"),e&&o&&t&&(parseInt(t)+1728e5<Date.now()?(window.localStorage.removeItem("session"),window.localStorage.removeItem("routeid"),window.localStorage.removeItem("ts"),i("restored-sso",document)):(o=e+"&routeid="+o+"&ts="+t+"&routeid-mismatch="+(n&&n===o?"false":"true"),null==d("restored-sso")&&s.generateRestoreIframe(document.getElementsByTagName("body")[0],o)))),window.postMessage&&(window.addEventListener?window.addEventListener("message",m,!1):window.attachEvent&&window.attachEvent("onmessage",m))}();
