var calledFrames=new Array,viewImpIds=new Array,countedViewImp=new Array;function setCookie(e,t,i){var n=new Date;n.setTime(n.getTime()+1e3*i);n=n.toUTCString();document.cookie=e+"="+t+";path=/;expires="+n}function getCookie(e){return e&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null}function fetchRandomIdAndExecute(t){var e=new XMLHttpRequest;e.onreadystatechange=function(){var e;4!==this.readyState||200!==this.status||""!==(e=this.response?this.response.adrouteUuid:null)&&null!=e&&t(e)},e.responseType="json";e.open("GET","https://pc-adroute.focas.jp/ads/adr_id.php",!0),e.send()}function setAdrId(t){var e=getCookie("adr_id"),i=63072e3;e?(setCookie("adr_id",e,i),t(e)):fetchRandomIdAndExecute(function(e){setCookie("adr_id",e,i),t(e)})}function setViewImpId(e,t){t=e+"_"+t[0]+"_"+t[1]+"_"+t[2]+"_"+t[3];viewImpIds[e]=t}function showCreative(e){tmp=e.split("_frame_"),divId=tmp[0]+"_"+tmp[1],document.getElementById(divId).style.display="block"}window.addEventListener("message",function(e){if("string"==typeof e.data){var t,i,n="";if(e.data instanceof Function)for(var a=0,r=calledFrames.length;a<r;a++)e.data(calledFrames[a])&&(n=a);else for(a=0,r=calledFrames.length;a<r;a++)calledFrames[a]==e.data&&(n=a);-1==(n=""==n?-1:n)&&(calledFrames.push(e.data),iframeId=e.data,null!=e.data.match("_vid_")&&(t=e.data.split("_vid_"),iframeId=t[0]),null!=e.data.match("^adroute_ads_")&&(showCreative(iframeId),document.getElementById(iframeId).contentWindow.postMessage(e.data,"*")),null!=e.data.match("_vid_")&&setViewImpId(iframeId,t[1].split("_")),null!=e.data.match("rtg_uuid=")&&0<e.data.split("=")[1].length&&(t=getCookie("adr_id"),i=63072e3,t?setCookie("adr_id",t,i):(fetchRandomIdAndExecute(function(e){setCookie("adr_id",e,i)}),getCookie("adr_id"))))}},!1),function(){window.innerHeight;var t=document.getElementById("adroute_ads_"+window.adroute_ad.block),e=navigator.userAgent;initAd=function(e){(t=e).style.position="relative",t.style.width="100%"},showAdBlock=function(){t.style.visibility="visible",t.style.display="block",t.style.opacity=1},initViewImpCheck=function(){document.addEventListener("touchmove",checkViewImp,!1),checkViewImp()},checkViewImp=function(){var e,i,t=0;for(e in viewImpIds)t++;0==t?i=setInterval(function(){var e,t=0;for(e in viewImpIds)t++;0!=t&&(clearInterval(i),checkAllCreative())},500):checkAllCreative()},checkAllCreative=function(){for(var e in viewImpIds)null!=e.match("adroute_ads_frame")&&judgeViewImp(e)},judgeViewImp=function(e,t){var i,n=window.innerHeight,a=document.getElementById(e),r=a.clientHeight/2,r=a.getBoundingClientRect().top+r;0<=r&&r<=n&&(1==t?void 0===countedViewImp[e]&&sendViewImpCount(e):(i=e,setTimeout(function(){judgeViewImp(i,1)},1e3)))},sendViewImpCount=function(e){var t=viewImpIds[e];tmp=t.split("_");var i=document.getElementById(e).src;match=i.match(/^(http|https):\/\/(dev|test|stg|)(.|)pc-adroute\.focas\.jp/);var n=match[0]+"/ads/creative_viewimp.php?aid="+tmp[6]+"&mid="+tmp[7]+"&uid="+tmp[8];dividedFrameId=e.split("_frame_"),divId=dividedFrameId[0]+"_"+dividedFrameId[1];t=document.getElementById(divId),i=document.createElement("script");i.src=n,t.appendChild(i),countedViewImp[e]=!0},getScreen=function(e){return{width:screen.width,height:screen.height}};function i(){this.initialize.apply(this,arguments)}i.prototype={initialize:function(e){}},i.Class=function(){return function(){"function"==typeof this.initialize&&this.initialize.apply(this,arguments)}},i.Util={loadScript:function(e){var t=e[0]||null,i=e[1]||"/",e=e[2]||"http",t=null==t?i:e+"://"+t+i;try{document.write('<script type="text/javascript" src="'+t+'"><\/script>')}catch(e){i=document.createElement("script");i.type="text/javascript",i.src=t,document.getElementsByTagName("head")[0].appendChild(i)}},loadStyle:function(e){var t=e[0]||null,i=e[1]||"/",e=e[2]||"http",t=null==t?i:e+"://"+t+i;try{document.write('<link rel="stylesheet" type="text/css" href="'+t+'" />')}catch(e){i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t,document.getElementsByTagName("head")[0].appendChild(i)}},addRequestQuery:function(e,t,i){return i=e&&null!=typeof t&&""!=t?[i,"?"==i.slice(-1)?"":"&",e,"=",encodeURIComponent(String(t))].join(""):i},isSupportFlash:function(){return navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&navigator.plugins&&navigator.plugins["Shockwave Flash"]?1:0},isPc:function(){if(/i(?:Phone|Pod|OS)/.test(e))return 0;if(/Android /.test(e)){if(/Mobile/.test(e))return 0}else if(/(Windows Phone|Nexus 5|BlackBerry)/.test(e))return 0;return 1}},(i.Base=function(){}).prototype={prefix:"adroute_ads_",init:function(){void 0!==window.adroute_ad&&(this.adParams=(window.adroute_ad,window.adroute_ad),this.userParams={view:screen?{width:screen.availWidth,height:screen.availHeight}:{width:300,height:250},screen:screen?{width:screen.width,height:screen.height}:{width:300,height:250},depth:screen.colorDepth,url:document.location,inner:{width:window.innerWidth,height:window.innerHeight}},this.currentTime=(new Date).getTime())},buildHtml:function(e){var t=e.url||null,e=this.adjustSize(e);return this.createHtml(e,t)},adjustSize:function(e){return size=e.size||null,size=e.size?(size=size.split("x"),new this.Size(parseInt(size[0],10)||300,parseInt(size[1],10)||250)):new this.Size(300,250),size},createHtml:function(e,t){return""+this.createTag(this.createDivParams(e,this.createStyleParams(e)),"div")+this.createTag(this.createFrameParams(e,t),"iframe")+"</div>"},createDivBottom:function(){return""},createFrameParams:function(e,t){return{name:this.prefix+"frame_"+this.adParams.block,width:e.width+"px",height:e.height+"px",id:this.prefix+"frame_"+this.adParams.block,src:t,frameborder:0,marginwidth:0,marginheight:0,vspace:0,hspace:0,allowtransparency:"true",scrolling:"no"}},createStyleParams:function(e){return"width:"+e.width+"px;height:"+e.height+"px;position:relative;left:0px;right:0px;margin:auto;padding:0;overflow:none;text-align:center;"},createTag:function(e,t){var i,n="<"+t;for(i in e)n+=" "+i+'="'+e[i]+'"';return n+=">","iframe"==t&&(n+="</iframe>"),n},createDivParams:function(e,t){return{width:e.width+"px",height:e.height+"px",id:this.prefix+this.adParams.block,style:t}},Size:function(e,t){this.width=e,this.height=t},getAdRequestUrl:function(){var e=i.Util.addRequestQuery("mid",this.adParams.mediaId||"","https://pc-adroute.focas.jp/ads/show_page.html?");return e=i.Util.addRequestQuery("type","1",e),e=i.Util.addRequestQuery("adr_id",getCookie("adr_id")?getCookie("adr_id"):"",e),e=i.Util.addRequestQuery("block",this.adParams.block||"",e),e=i.Util.addRequestQuery("inner_w",this.userParams.inner.width||"",e),e=i.Util.addRequestQuery("inner_h",this.userParams.inner.height||"",e),e=i.Util.addRequestQuery("scr_w",this.userParams.screen.width||"",e),e=i.Util.addRequestQuery("scr_h",this.userParams.screen.height||"",e),i.Util.addRequestQuery("time",parseInt(Date.now()/1e3,10),e)},rewriteStyle:function(e){e.style.position="absolute",e.style.left=0-e.offsetLeft+"px"},createTapadTag:function(e){var t=document.createElement("img"),e="https://pixel.tapad.com/idsync/ex/receive?partner_id=2966&partner_device_id="+e;t.width="1",t.height="1",t.src=e,t.style.display="none",document.getElementsByTagName("body")[0].appendChild(t)},action:function(){var e,t;0!=i.Util.isPc()&&(this.init(),document.writeln(this.buildHtml({url:this.getAdRequestUrl(),size:this.adParams.size})),e=document.getElementById(this.prefix+this.adParams.block),t=this,null==e?setTimeout(function(){e=document.getElementById(t.prefix+t.adParams.block),console.log("timeout"),initBannerAd(e,t)},200,this):this.initBannerAd(e,t),initViewImpCheck(),setAdrId(function(e){n.createTapadTag(e)}))},initBannerAd:function(e,t){initAd(e),showAdBlock();setInterval(function(){"complete"===document.readyState&&setTimeout(function(){showAdBlock()},200)},500)},_t:null};var n=new i.Base;window.addEventListener("load",n.action(),!1)}();
