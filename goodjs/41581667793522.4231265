YUI.add("autotag-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{name:this.name,remote:{delete:function(e){return t.ModelDeletors["flickr-photos-deleteAutotags"].run(e,this.appContext)}},attributes:{autotagValue:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},score:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},isPrivate:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},searchUrl:{derivedBy:["autotagValue"],readOnly:!0,defaultFn:function(e){return"/search/?q="+this.getValue(e,"autotagValue")}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-deleteAutotags-deletor"]}),YUI.add("photo-autotags-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{name:this.name,remote:{delete:function(e){return t.ModelDeletors["flickr-photos-deleteAutotags"].run(e,this.appContext)}},attributes:{autotags:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-deleteAutotags-deletor"]}),YUI.add("flickr-photos-getInfo-fetcher",function(U,s){"use strict";U.namespace("ModelFetchers")["flickr-photos-getInfo"]={run:function(e,t){var o,r=this;return t.flipper.isFlipped("enable-scrappy-photo-page")&&(e.scrappy=!0),o=this._processParams(e),new U.FlickrPromise({apiResponse:t.callAPI("flickr.photos.getInfo",o,!0),photoRegistry:t.getModelRegistry("photo-models"),personRegistry:t.getModelRegistry("person-models"),personRelationshipRegistry:t.getModelRegistry("person-relationship-models"),photoEngagementRegistry:t.getModelRegistry("photo-engagement-models"),photoStatsRegistry:t.getModelRegistry("photo-stats-models"),photoPrivacyRegistry:t.getModelRegistry("photo-privacy-models"),photoNotesRegistry:t.getModelRegistry("photo-notes-models"),noteRegistry:t.getModelRegistry("note-models"),photoGeoRegistry:t.getModelRegistry("photo-geo-models"),photoLocationRegistry:t.getModelRegistry("photo-location-models"),photoHeadMetaRegistry:t.getModelRegistry("photo-head-meta-models"),groupRegistry:t.getModelRegistry("group-models"),contextsRegistry:t.getModelRegistry("photo-contexts-models"),favoriteRegistry:t.getModelRegistry("favorite-models"),galleryRegistry:t.getModelRegistry("gallery-models"),groupsPoolRegistry:t.getModelRegistry("group-pool-models"),setRegistry:t.getModelRegistry("set-models"),photostreamRegistry:t.getModelRegistry("photostream-models")}).then(function(e){return r._processResponse(e,t.flipper,o)},U.FetcherErrorLogger(s))},_processParams:function(e){var t=["sizes","icon_urls","ignored","rev_ignored","rev_contacts","venue","datecreate"].join(","),t={datecreate:1,extras:t=t+","+U.APIHelper.request.getRebootPhotoExtras(),photo_id:e.id,get_contexts:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"};return e.userId?t.user_id=e.userId:e.pathAlias&&(t.path_alias=e.pathAlias),e.context&&(t.context=e.context,t.num_prev=1,t.num_next=1),e.scrappy&&(U.APIHelper.request.addStaticMapsParams(t),delete t.get_contexts,delete t.primary_photo_extras,delete t.context),t},_processResponse:function(e,t,o){var r,s,i,n,a,l,p,d,h,c,u,g,f,m,y,R=e.apiResponse,v=e.photoRegistry,M=e.personRegistry,I=e.personRelationshipRegistry,P=e.photoEngagementRegistry,b=e.photoStatsRegistry,k=e.photoPrivacyRegistry,x=e.photoNotesRegistry,A=e.noteRegistry,H=e.photoGeoRegistry,S=e.photoLocationRegistry,w=e.photoHeadMetaRegistry,L=e.groupRegistry,V={},_=[];if(!R.photo.sizes)throw new Error("Missing photo sizes from flickr.photos.getInfo call.");r={id:R.photo.id,title:R.photo.title.content,description:R.photo.description.content,sizes:U.APIHelper.response.parsePhotoSize(R.photo.sizes.size,!0),needsInterstitial:R.photo.needsInterstitial,canComment:R.photo.editability.cancomment,canPublicComment:R.photo.publiceditability.cancomment,canAddMeta:R.photo.editability.canaddmeta,safetyLevel:R.photo.safetyLevel,license:R.photo.license,mediaType:R.photo.media,secret:R.photo.secret,rotation:R.photo.rotation,oWidth:R.photo.oWidth?parseInt(R.photo.oWidth,10):"",oHeight:R.photo.oHeight?parseInt(R.photo.oHeight,10):"",visibilitySource:R.photo.visibilitySource,isVideoPending:R.photo.video?R.photo.video.pending:0,isVideoFailed:R.photo.video?R.photo.video.failed:0,systemModerated:R.photo.system_moderated||0},s={id:R.photo.owner.nsid,username:R.photo.owner.username,realname:R.photo.owner.realname,pathAlias:R.photo.owner.pathAlias,buddyicon:U.APIHelper.response.removeProtocolFromURL(R.photo.owner.iconurls),isAdFree:R.photo.owner.isAdFree,isPro:R.photo.owner.ispro,proBadge:R.photo.owner.proBadge,dateCreated:R.photo.owner.datecreate,location:R.photo.owner.location},i={id:R.photo.owner.nsid,pathAlias:R.photo.owner.pathAlias,isContact:R.photo.contactIscontact,isFamily:R.photo.contactIsfamily,isFriend:R.photo.contactIsfriend,isIgnored:R.photo.owner.isignored,isIgnoredBy:R.photo.owner.revIgnored,isRevContact:R.photo.owner.revContact,isRevFamily:R.photo.owner.revFamily,isRevFriend:R.photo.owner.revFriend},n={id:R.photo.id,ownerNsid:R.photo.owner.nsid,isFaved:R.photo.isfavorite||!1,canShare:R.photo.usage.canshare,canDownload:R.photo.usage.candownload,canPrint:R.photo.usage.canprint,commentCount:R.photo.comments.content,noteCount:R.photo.notes&&R.photo.notes.note&&R.photo.notes.note.length,faveCount:R.photo.countFaves,viewCount:R.photo.views},a={id:R.photo.id,dateTaken:R.photo.dates.taken,datePosted:R.photo.dates.posted,takenGranularity:R.photo.dates.takengranularity,isDateTakenUnknown:R.photo.datetakenunknown||"1"===R.photo.datetakenunknown||1===R.photo.datetakenunknown},p=U.APIHelper.response.parsePhotoMeta(R.photo),l={id:R.photo.id,isPublic:R.photo.visibility.ispublic,isVisibleByFriends:R.photo.visibility.isfriend,isVisibleByFamily:R.photo.visibility.isfamily,permAddMeta:R.photo.permissions?R.photo.permissions.permaddmeta:0,permComment:R.photo.permissions?R.photo.permissions.permcomment:0,permPrint:R.photo.permissions?R.photo.permissions.permprint:0},R.photo&&R.photo.notes&&R.photo.notes.note&&U.Array(R.photo.notes.note).forEach(function(e){_.push(A.addOrUpdate({id:e.id,author:e.author,authorName:e.authorname,authorRealName:e.authorrealname,authorIsPro:e.authorispro,authorProBadge:e.proBadge,authorIsDeleted:e.authorisdeleted,left:e.x,top:e.y,width:e.w,height:e.h,text:e.content}))}),H=U.ModelFetchers["flickr-photos-getLocation"].mapResponse(R,H),r.owner=M.addOrUpdate(s),r.engagement=P.addOrUpdate(n),I.addOrUpdate(i),v=v.addOrUpdate(r),b.addOrUpdate(a),k.addOrUpdate(l),x.addOrUpdate({id:r.id,notes:_}),w.addOrUpdate(p),S.addOrUpdate(H),R.photo.contexts&&(H=e.contextsRegistry,V.faves=e.favoriteRegistry,V.gallery=e.galleryRegistry,V.pool=e.groupsPoolRegistry,V.set=e.setRegistry,V.stream=e.photostreamRegistry,L={photoModel:v,contextRegistries:V,contextsResponse:R.photo.contexts,personRegistry:M,contextsRegistry:H,photoEngagementRegistry:P,photoStatsRegistry:b,groupRegistry:L,apiParams:o},d=L.photoModel,h=L.contextsResponse,c=L.personRegistry,o=L.contextsRegistry,u=L.photoEngagementRegistry,g=L.photoStatsRegistry,f=L.groupRegistry,m=L.apiParams,y=[],U.Object.each(L.contextRegistries,function(a,e){h[e]&&U.Array.each(h[e],function(e){var t,o,r,s,i,n;U.APIHelper.response.addContextToRegistry(e,a,c,f),y.push(a.proxy(e.id)),m.context&&(o=!!(n=a.getValue(e.id,"photoContextList")).hasMinBoundary&&n.hasMinBoundary(),r=!!n.hasMaxBoundary&&n.hasMaxBoundary(),s=n.getList(),i=e.nextphotos,n=e.prevphotos,i=i?U.APIHelper.response.parsePhotos({photos:i.photo,personModelRegistry:c,photoModelRegistry:d.registry,photoEngagementModelRegistry:u,photoStatsModelRegistry:g}):[],((n=n?U.APIHelper.response.parsePhotos({photos:n.photo,personModelRegistry:c,photoModelRegistry:d.registry,photoEngagementModelRegistry:u,photoStatsModelRegistry:g}):[]).length||i.length)&&(t=U.APIHelper.response.addOrReplaceListByContext({model:d,next:i,prev:n.reverse(),current:s,hasMin:o,hasMax:r,numNext:m.num_next,numPrev:m.num_prev})),a.setValue(e.id,"photoContextList",t))})}),o.exists(d.id)||(o.add({id:d.id,totalGroups:h.pool?h.pool.length:0,totalSets:h.set?h.set.length:0,totalGalleries:h.gallery?h.gallery.length:0}),o.setValue(d.id,"contexts",y)))}}},"@VERSION@",{requires:["flickr-promise","api-helper","flickr-photos-getLocation-fetcher"],optional:["photo-models","person-models","person-relationship-models","photo-engagement-models","photo-stats-models","photo-geo-models","photo-location-models","photo-head-meta-models","note-models","photo-notes-models","autotag-models","photo-autotags-models"]}),YUI.add("flickr-photos-setPerms-updater",function(r,s){"use strict";r.namespace("ModelUpdaters")["flickr-photos-setPerms"]={run:function(t,e){var o=this;return t.nsid=e.getViewer().nsid,r.Promise.all([e.callAPI("flickr.photos.setPerms",t),e.getModelRegistry("photostream-models")]).then(function(e){return o._processResponse(e,t)},r.FetcherErrorLogger(s))},_processResponse:function(e,t){var o=e[0],r=e[1];if(r.attributeSearch({normalizedId:t.nsid},!0).forEach(function(e){r.remove(e)}),t.full_response)return o.photoIdsSent=t.photo_ids,o}}},"@VERSION@",{requires:["flickr-promise"]}),YUI.add("flickr-photos-setMeta-updater",function(r,s){"use strict";var i=require("hermes-core/flog")(s);r.namespace("ModelUpdaters")["flickr-photos-setMeta"]={run:function(o,e){var t={};return o.fullResponse?(t.full_response=1,t.photo_ids=o.photoId):t.photo_id=o.photoId,void 0!==o.title&&(t.title=o.title),void 0!==o.description&&(t.description=o.description),r.Promise.all([e.callAPI("flickr.photos.setMeta",t),e.getModelRegistry("photo-models")]).then(function(e){var t=e[0],e=e[1];if(o.fullResponse){if("errors"in t)return t.api="setMeta",t}else{if(!e.exists(o.photoId))throw new Error("[flickr-photos-setMeta-updater] - Photo model can not be updated if it does not exist");t.photo&&t.photo.title&&t.photo.description?e.setValues(o.photoId,{title:t.photo.title.content,description:t.photo.description.content}):i.warn("No updated data returned from API.")}},function(e){throw o.fullResponse&&(e.photoIds=o.photoId,e.returnApi="setMeta"),e}).then(null,r.FetcherErrorLogger(s))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]}),YUI.add("flickr-photos-licenses-setLicense-updater",function(r,s){"use strict";r.namespace("ModelUpdaters")["flickr-photos-licenses-setLicense"]={run:function(t,e){var o={};return t.fullResponse?(o.photo_ids=t.photoId,o.full_response=1):o.photo_id=t.photoId,o.license_id=t.license,e.callAPI("flickr.photos.licenses.setLicense",o).then(function(e){if("errors"in e)return e.api="setLicense",e},function(e){throw t.fullResponse&&(e.photoIds=t.photoId,e.returnApi="setLicense"),e}).then(null,r.FetcherErrorLogger(s))}}},"@VERSION@",{requires:["flickr-promise"]}),YUI.add("flickr-photos-setSafetyLevel-updater",function(r,s){"use strict";r.namespace("ModelUpdaters")["flickr-photos-setSafetyLevel"]={run:function(t,e){var o={};return t.fullResponse?(o.photo_ids=t.photoId,o.full_response=1):o.photo_id=t.photoId,o.safety_level=t.safetyLevel+1,e.callAPI("flickr.photos.setSafetyLevel",o).then(function(e){if("errors"in e)return e.api="setSafety",e},function(e){throw t.fullResponse&&(e.photoIds=t.photoId,e.returnApi="setSafety"),e}).then(null,r.FetcherErrorLogger(s))}}},"@VERSION@",{requires:["flickr-promise"]}),YUI.add("photo-models",function(s){function t(e){t.superclass.constructor.call(this,e)}s.Models[this.name]=t,s.extend(t,s.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return s.ModelFetchers["flickr-photos-getInfo"].run(e,this.appContext)},update:function(e,t){var o=[];return("title"in t||"description"in t)&&o.push(s.ModelUpdaters["flickr-photos-setMeta"].run({photoId:e,title:t.title?t.title.newVal:this.getValue(e,"title"),description:t.description?t.description.newVal:this.getValue(e,"description")},this.appContext)),"license"in t&&o.push(s.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:e,license:t.license.newVal},this.appContext)),"safetyLevel"in t&&o.push(s.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:e,safetyLevel:t.safetyLevel.newVal},this.appContext)),s.Promise.all(o)},batchUpdate:function(e,t){var o=[];return"safetyLevel"in t&&o.push(s.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:e,safetyLevel:parseInt(t.safetyLevel,10),fullResponse:1},this.appContext)),"title"in t&&"description"in t?o.push(s.ModelUpdaters["flickr-photos-setMeta"].run({photoId:e,title:t.title,description:t.description,fullResponse:1},this.appContext)):"title"in t?o.push(s.ModelUpdaters["flickr-photos-setMeta"].run({photoId:e,title:t.title,fullResponse:1},this.appContext)):"description"in t&&o.push(s.ModelUpdaters["flickr-photos-setMeta"].run({photoId:e,description:t.description,fullResponse:1},this.appContext)),"license"in t&&o.push(s.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:e,license:t.license,fullResponse:1},this.appContext)),s.Promise.all(o)}},getLargestSize:s.PhotoModelHelper.getLargestSize,getSizeToFit:s.PhotoModelHelper.getSizeToFit,getSizeIfExact:s.PhotoModelHelper.getSizeIfExact,isSizeSquare:s.PhotoModelHelper.isSizeSquare,isPhotoSquare:s.PhotoModelHelper.isPhotoSquare,getSizeForCanvas:s.PhotoModelHelper.getSizeForCanvas,getGuestpass:function(o){var r=this;return new s.Promise(function(t,e){r.getValue(o,"guestpass")?t():r.appContext.callAPI("flickr.sharing.createGuestpass",{photo:o}).then(function(e){r.setValue(o,"guestpass",e.guestpass.url),t()})})},canVr:function(e){var t,o=!1;return this.appContext.flipper.isFlipped("enable-vr")?(o=this&&(t=this.getValue(e,"aspectRatio"))&&1.99<=t&&t<=2.01?!0:o)?s.Promise.all([this.appContext.callAPI("flickr.vr.isEquirectangular",{photo_id:e})]).then(function(e){return s.Promise.resolve(!!e[0].is_equirectangular)}):s.Promise.resolve(!1):s.Promise.resolve(!1)},attributes:{title:s.PhotoModelHelper.attributes.title,description:s.PhotoModelHelper.attributes.description,mediaType:s.PhotoModelHelper.attributes.mediaType,license:s.PhotoModelHelper.attributes.license,isVideo:s.PhotoModelHelper.attributes.isVideo,isOwner:s.PhotoModelHelper.attributes.isOwner,sizes:s.PhotoModelHelper.attributes.sizes,descendingSizes:s.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:s.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:s.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:s.PhotoModelHelper.attributes.needsInterstitial,canComment:s.PhotoModelHelper.attributes.canComment,canPublicComment:s.PhotoModelHelper.attributes.canPublicComment,url:s.PhotoModelHelper.attributes.url,rotation:s.PhotoModelHelper.attributes.rotation,similaritySearchURL:s.PhotoModelHelper.attributes.similaritySearchURL,basicSimilaritySearchURL:s.PhotoModelHelper.attributes.basicSimilaritySearchURL,owner:{isModel:!0},engagement:{isModel:!0},secret:{},canAddMeta:{validator:function(e){return s.AttributeHelpers.validateBoolean(e)},setter:function(e){return s.AttributeHelpers.coerceBoolean(e)},defaultValue:!0},oWidth:{validator:function(e){return s.AttributeHelpers.validateInteger(e)},setter:function(e){return s.AttributeHelpers.coerceInteger(e)},defaultValue:0},oHeight:{validator:function(e){return s.AttributeHelpers.validateInteger(e)},setter:function(e){return s.AttributeHelpers.coerceInteger(e)},defaultValue:0},safetyLevel:{validator:function(e){return s.AttributeHelpers.validateInteger(e)},setter:function(e){return s.AttributeHelpers.coerceInteger(e)}},guestpass:{},sizesForAlbum:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(e){e=this.getValue(e,"sizes");return s.Object.each(e,function(e,t){e.src=e.url}),e}},stats:{isModel:!0},visibilitySource:{validator:function(e){return s.AttributeHelpers.validateInteger(e)},setter:function(e){return s.AttributeHelpers.coerceInteger(e)},defaultValue:1},isVideoPending:{validator:function(e){return s.AttributeHelpers.validateBoolean(e)},setter:function(e){return s.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isVideoFailed:{validator:function(e){return s.AttributeHelpers.validateBoolean(e)},setter:function(e){return s.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},systemModerated:{validator:function(e){return s.AttributeHelpers.validateBoolean(e)},setter:function(e){return s.AttributeHelpers.coerceBoolean(e)},defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","photo-model-helper","flickr-photos-getInfo-fetcher","flickr-photos-setPerms-updater","flickr-photos-setMeta-updater","flickr-photos-licenses-setLicense-updater","flickr-photos-setSafetyLevel-updater","attribute-helpers"]});
