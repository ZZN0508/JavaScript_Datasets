(this.$WP=this.$WP||[]).push(["S07X1M/57pCYe",(e,a)=>{"use strict";var t,U,r,w,F,o,g,h,n,y,d,s,l,i,c,T,S,N,P,x,I,u,p,m,v,M,O,f,_;function b(e,a){if(null==e)return{};for(var t,o={},l=Object.keys(e),i=0;i<l.length;i++)t=l[i],0<=a.indexOf(t)||(o[t]=e[t]);return o}var z=(t,o)=>{var[l,i]=U.useState(!1),r=y();return d("dragover",e=>{null!=e.dataTransfer&&[...e.dataTransfer.items].some(e=>"file"===e.kind)&&(e.dataTransfer.dropEffect="copy",e.preventDefault(),i(!0))}),d("dragleave",e=>{l&&(e.preventDefault(),i(!1))}),d("drop",e=>{var a;l&&((a=e).preventDefault(),i(!1),e=[],0<(e=null!=a.dataTransfer?(a.dataTransfer.items?[...a.dataTransfer.items].map(e=>e.getAsFile()):[...a.dataTransfer.files]).filter(Boolean):e).length&&(null!==o&&r({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedDragDrop",description:o.length.toString()}}}),t(e)))}),{dragging:l}},R=(a,t,l)=>{var o=F()["localize"],i=U.useCallback(e=>"video"===l?`${e.name}: ${o.string("post_video_file_type_error")}`:`${e.name}: ${o.string("post_photo_unsupported_file")}`,[o,l]),r=U.useCallback(e=>"video"===l?`${e.name}: ${o.string("post_video_size_error")}`:`${e.name}: ${o.string("file_size_too_big_photo_oops_message",{0:o.string("mobile_offline_megabyte_ffffec6c",{0:t/1024/1024})})}`,[o,t,l]);return U.useCallback(o=>{if(o.size>t)return Promise.reject(new Error(r(o)));var e=s(o.name);return e&&a.includes(e)?"video"===l?Promise.resolve():new Promise((e,a)=>{var t=new Image;t.onload=()=>{URL.revokeObjectURL(t.src),e()},t.onerror=()=>a(new Error(i(o))),t.src=URL.createObjectURL(o)}):Promise.reject(new Error(i(o)))},[a,t,i,r,l])},k=(e,a,t,o)=>{e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatus",description:a.statusText}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatusCode",description:a.status}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailResponse",description:a.response.toString()}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${t+1} of ${o}`}}})},D=()=>{var g=y(),[e,h]=U.useState(),a=U.useRef(!1);U.useEffect(()=>(a.current=!0,()=>{a.current=!1}),[]);var[,i]=c(m),[,r]=c(v),n=U.useCallback(e=>{if(a.current)return e;throw new Error("upload aborted")},[]),t=U.useCallback(({mediaType:p,file:m,description:e,locationId:a,isForCuration:t},v,_)=>{var o,l={description:e,mediaType:"video"===p?"VIDEO":"PHOTO",mimeType:m.type,fileName:m.name,fileSize:m.size,locationIds:null!=a&&0<a?[a]:[],isForCuration:t};return("video"===p?i({request:l}):(o=m,new Promise((e,a)=>{var t=new Image;t.onload=()=>{URL.revokeObjectURL(t.src),e({width:t.width,height:t.height})},t.onerror=a,t.src=URL.createObjectURL(o)}).then(({width:e,height:a})=>i({request:Object.assign({},l,{width:e,height:a})})))).then(n).then(({data:e,error:a})=>{var t,o;if(a||"OK"!==(null==e||null==(t=e.initiateMediaUpload)?void 0:t.status)||null==(null==e||null==(o=e.initiateMediaUpload)?void 0:o.mediaId)||null==(null==e||null==(u=e.initiateMediaUpload)?void 0:u.uploadUrl))throw new Error("Upload failed");var l,i,r,n,d,s,c,{mediaId:u,uploadUrl:e}=e.initiateMediaUpload;return l=m,i=u,r=e,n=g,d=v,s=_.length,c="video"===p,new Promise((e,a)=>{var t=new XMLHttpRequest;t.open("PUT",r,!0),t.onload=()=>{200===t.status?(c||n({PhotoUploadFlow:{photoUploadWeb:{action:"uploadSuccess",description:`${d+1} of ${s}`}}}),e(i)):(c||k(n,t,d,s),a(new Error(`Upload of file ${l.name} failed.`)))},t.onerror=()=>{c||k(n,t,d,s),a(new Error(`Upload of file ${l.name} failed.`))},t.onabort=()=>a(new Error(`Upload of file ${l.name} aborted.`)),t.upload.onprogress=e=>{return a=e.loaded,h(e=>{e=null==e?[]:[...e];return e[v]=a,e});var a},t.send(l)})}).then(n).then(e=>r({request:{mediaId:e}}).then(()=>({mediaId:e}))).finally(()=>{h(null)})},[i,r,n,g]);return[{progress:e},U.useCallback(e=>Promise.all(e.map(t)),[t])]},C=({mediaType:t,withMetadata:e,isForCuration:o,allowedFileTypes:a,maxFileSize:l,maxAllowedFiles:i,locationId:r})=>{var n=y(),d=F()["localize"],s=R(a,l,t),[c,u]=U.useState({media:[],error:null}),p=U.useCallback(a=>{u(e=>Object.assign({},e,{error:a}))},[]),[m,v]=U.useState(!1),_="video"===t,g=(_?O:M).maxAllowedFiles,h=U.useCallback(a=>{s(a).then(()=>{u(e=>e.media.some(e=>{return(e=e.file).name===a.name&&e.size===a.size})?e:e.media.length>=i?i!==g?e:{error:_?d.string("video_upload_max_number",{nVideos:i}):d.string("post_photo_tips_guidelines"),media:e.media}:{error:e.error,media:[...e.media,{mediaType:t,file:a,description:"",locationId:r,isForCuration:o}]})}).catch(e=>{_||n({PhotoUploadFlow:{photoUploadWeb:{action:"invalidFile",description:e.message}}}),p(e.message)})},[s,i,o,r,d,p,t,g,_,n]),f=U.useCallback(e=>{p(null),e.preventDefault(),[...e.target.files].forEach(h),_||n({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedFilePicker",description:c.media.length.toString()}}}),e.currentTarget.value=""},[h,p,n,_,c.media.length]),b=U.useCallback((a,t)=>{u(e=>{e=[...e.media];return e[a]=t,{error:null,media:e}})},[]),k=U.useCallback(a=>{u(e=>{e=[...e.media];return e.splice(a,1),{error:null,media:e}})},[]),a=z(e=>{p(null),e.forEach(h)},_?null:c.media)["dragging"],C=!m&&0<c.media.length&&(!e||!_&&o||c.media.every(e=>e.description&&null!=e.locationId&&0<e.locationId)),[{progress:l},E]=D(),e=U.useCallback(()=>C?(_||n({PhotoUploadFlow:{photoUploadWeb:{action:"submitClicked"}}}),v(!0),p(null),E(c.media).then(e=>(_||n({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedAll"}}}),v(!1),e)).catch(()=>{_||n({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedErrorExists"}}});var e=_?d.string("video_upload_fail"):d.string("post_photo_upload_failed");p(e),v(!1)})):Promise.reject(),[E,C,c.media,p,d,_,n]);return{media:c.media,error:c.error,uploading:m,progress:l,canAddMore:c.media.length<i,canSubmit:C,dragging:a,onFileSelected:f,onMediaChanged:b,onMediaDeleted:k,onSubmit:e}},E=e=>{var a=e["children"],e=b(e,["children"]),[t]=U.useContext(g),o=U.useRef(),l=Object.assign({},M,{},e),[i,r]=U.useState([]),[{progress:n},d]=D(),s=R(l.allowedFileTypes,l.maxFileSize),c=U.useRef([]),u=U.useCallback(e=>{c.current.splice(0,0,e)},[]),p=U.useCallback(a=>{var e=c.current.findIndex(e=>a===e);c.current.splice(e,1)},[]),m=U.useCallback(a=>{Promise.all(a.map(e=>s(e))).then(()=>{var e=a.map(e=>({mediaType:"photo",file:e,locationId:null,description:"",isForCuration:l.isForCuration}));return r(e),d(e)}).then(a=>{c.current.find(e=>!1!==e(a))}).catch(e=>{t({node:U.createElement(h,null,e.message||U.createElement(w,{id:"post_photo_upload_failed"}))})}).finally(()=>{r([])})},[s,d,t,l.isForCuration]),v=z(m,i)["dragging"],_=U.useCallback(()=>{var e=o.current;if(null==e)throw new Error("useCustomPhotoUploadFlow: must render the supplied element");e.click()},[]),e=U.useMemo(()=>({photos:i,open:_,dragging:v,progress:n,addPhotosUploadedCallback:u,removePhotosUploadedCallback:p}),[i,_,v,n,u,p]);return U.createElement(f.Provider,{value:e},a,U.createElement("input",{ref:o,type:"file",multiple:1<l.maxAllowedFiles,accept:l.allowedFileTypes.join(","),style:{display:"none"},onChange:e=>{e.preventDefault(),m([...e.currentTarget.files].filter(Boolean)),e.currentTarget.value=""},"aria-hidden":!0,tabIndex:-1}))},j=e=>{var a=U.useContext(f),{addPhotosUploadedCallback:t,removePhotosUploadedCallback:o}=a,a=b(a,["addPhotosUploadedCallback","removePhotosUploadedCallback"]),l=U.useRef(e);return l.current=e,U.useEffect(()=>{if(null==l.current)return()=>{};var e=(...e)=>!!l.current&&l.current(...e);return t(e),()=>{o(e)}},[t,o]),a},L=({media:a,index:t,mediaCount:e,withMetadata:o=!0,isForCuration:l=!1,hasPresetLocation:i=!1,progress:r,onChange:n,onDelete:d})=>{var s=F()["localize"],[c,u]=U.useState(!1),[p,m]=U.useState(!1),v=U.useMemo(()=>URL.createObjectURL(a.file),[a.file]);U.useEffect(()=>()=>URL.revokeObjectURL(v),[v]);var[_,g]=U.useState(null),h=U.useCallback(()=>d&&d(t),[d,t]),f=U.useCallback(e=>{u(!1),n(t,Object.assign({},a,{description:e.currentTarget.value}))},[t,a,n]),b=U.useCallback(e=>{g(e),m(!0),n(t,Object.assign({},a,{locationId:null==e?void 0:e.locationId}))},[t,a,n]),k=U.useCallback(()=>{g(null),m(!1),n(t,Object.assign({},a,{locationId:null}))},[t,a,n]),C=c&&!a.description?U.createElement(w,{id:"uploader_error_required_field"}):null,E=p&&(null==a.locationId||a.locationId<=0)?U.createElement(w,{id:"uploader_error_required_field"}):null,c=null!=r,p="video"===a.mediaType?U.createElement(w,{id:"post_video_video_count_text",args:{nCurrentVideoCount:t+1,nTotalVideoCount:e}}):U.createElement(w,{id:"post_photo_video_count_text",args:{nCurrentphotoCount:t+1,nTotalphotoCount:e}});return U.createElement("div",{className:T("_39UqzOOZ",{_3PUsR4eP:o})},U.createElement("div",{className:"_2v2Q3LYg"},1<e&&U.createElement(N,{variant:"title-05",marginBottom:"spacing-02"},p),U.createElement("div",{className:"_2wMVOzNu"},"photo"===a.mediaType&&U.createElement("img",{className:"_3Yvk44aX",src:v,alt:""}),"video"===a.mediaType&&U.createElement("video",{controls:!0,controlsList:"nodownload nofullscreen",className:"_3Yvk44aX",alt:""},U.createElement("track",{default:!0,kind:"captions"}),U.createElement("source",{src:v,type:"video/mp4"})),!c&&U.createElement("div",{className:"_3M_m3A_c"},U.createElement(P,{size:"small",variant:"dark",iconName:"times","aria-label":s.string("mobile_delete"),onClick:h})),null!=r&&U.createElement("div",{className:"_3hB_7Bek"},U.createElement(x,{numSteps:a.file.size,currentStep:r})))),o&&U.createElement("div",{className:"_1bjeam2F"},U.createElement(I,{id:"media-upload-description-"+t,variant:"five-line",label:U.createElement(N,{variant:"title-05"},U.createElement(w,{id:"post_photo_add_description_v2_part_1"})),placeholder:"video"===a.mediaType?s.string("post_video_add_description_v2_part_2"):s.string("post_photo_add_description_v2_part_2"),maxLength:500,characterCountType:C?void 0:"max",required:!0,value:a.description,state:c?"disabled":C?"error":"enabled",errorText:C,onChange:f,onBlur:()=>u(!0),marginBottom:"spacing-03"}),!l&&!i&&U.createElement("div",{className:"_-1IAzMRV"},null==_?U.createElement(S,{selectedResultDisplayValue:null==_?void 0:_.searchText,size:"small",errorText:E,placeholder:s.string("photo_uploader_add_a_location_tag"),onTextInputChanged:()=>m(!1),onBlur:()=>m(!0),onSelect:b}):U.createElement(P,{size:"small",variant:"dark",iconName:"times",textPosition:"lead","aria-label":`${_.searchText}. ${s.string("remove_location_cf6")}`,disabled:c,onClick:k},_.title))))},V=(e,a,t=e=>e)=>{a=e.match(a);return null!=a?U.createElement(U.Fragment,null,e.substr(0,a.index),t(a[1]||a[0]),e.substr(a.index+a[0].length)):e},q=({plural:e})=>e?t.createElement(w,{id:"post_photo_upload_photos_button"}):t.createElement(w,{id:"confirmed_booker_upload_photo"}),A=e=>{var{variant:a="large",dragging:t,disabled:o,allowedFileTypes:l=[],onFileSelected:i,mediaType:r,multiple:n=!1}=e,d=b(e,["variant","dragging","disabled","allowedFileTypes","onFileSelected","mediaType","multiple"]),s=u(),e=F()["localize"];return U.createElement("label",{className:T("DWeK--Ai",p(d),{fPIs6KMA:"small"===a,_2wg8awbj:"large"===a,_2_BV1R4s:!o&&t,_2tF9Kdrx:o,l9JU6k7k:s})},U.createElement("input",{type:"file",multiple:n,accept:l.join(","),disabled:o,className:"_1Zxkup0W",onChange:i,tabIndex:o?"-1":"0"}),"small"===a&&U.createElement(N,{variant:"supporting-01"},U.createElement("span",{className:"_19y44MUH"},V("video"===r?e.string("post_video_upload_another_video"):e.string("post_photo_upload_another_video"),/<\/> <span class="{sColorClass1}">(.*)<\/span>/,e=>U.createElement("span",{className:"_963sB4hL"},e))),U.createElement("span",{className:T("_1uCkVrUf","_963sB4hL")},"video"===r?U.createElement(w,{id:"add_more_videos_mw_uploader"}):U.createElement(w,{id:"add_more_photos_mw_uploader"}))),"large"===a&&U.createElement("div",null,U.createElement(N,{variant:"button-01",marginY:"spacing-03"},U.createElement("div",{className:"cfmlxRwZ",htmlFor:"media-uploader-file"},"video"===r?U.createElement(w,{id:"add_more_videos_mw_uploader"}):U.createElement(q,{plural:n}))),U.createElement("div",{className:"_19y44MUH","aria-hidden":!0},U.createElement(N,{variant:"supporting-01",marginY:"spacing-03"},U.createElement(w,{id:"post_photo_or_just_text"})),U.createElement(N,{variant:"title-05",marginY:"spacing-03"},U.createElement(w,{id:"post_photo_drag_and_drop_from_desktop"})))))},W=(t=Object.freeze({}))=>{var e=y(),a=n()["login"],[o]=U.useContext(g),l=U.useRef(()=>{}),i=r(({close:a})=>U.createElement(_,Object.assign({},t,{onUploadCanceled:()=>{a(),l.current([])},onUploadSuccess:(...e)=>{a(),o({node:U.createElement(h,null,"video"===t.mediaType?U.createElement(w,{id:"success_repost_video"}):U.createElement(w,{id:"success_repost_photo"}))}),l.current(...e)}})),{},[t,o])["open"];return U.useCallback(()=>a({flow:"CORE_COMBINED"}).then(()=>(i(),"video"!==t.mediaType&&e({PhotoUploadFlow:{photoUploadWeb:{action:"opened"}}}),new Promise(e=>{l.current=e}))),[a,i,e,t.mediaType])};return e("_",b),[()=>{(m=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"InitializeMedia"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"request"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"InitiateMediaUploadRequestInput"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"initiateMediaUpload"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"Variable","name":{"kind":"Name","value":"request"}}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"mediaId"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"status"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"uploadUrl"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":165}}')).__key=0xc803ecdf4604,m.loc.source={body:"c803ecdf4604"},(v=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"FinalizeMedia"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"request"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"CompleteMediaUploadForClientRequestInput"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"completeMediaUploadForClient"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"Variable","name":{"kind":"Name","value":"request"}}}],"directives":[]}]}}],"loc":{"start":0,"end":138}}')).__key=0x61dd9d92ebbe,v.loc.source={body:"61dd9d92ebbe"},O={mediaType:"video",withMetadata:!0,isForCuration:!(M={mediaType:"photo",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".jpg",".jpeg",".gif",".png"],maxFileSize:i,maxAllowedFiles:10,locationId:-1}),allowedFileTypes:[".mp4",".m4v",".mov"],maxFileSize:l,maxAllowedFiles:5,locationId:-1},f=U.createContext({photos:[],open:()=>{},dragging:!1,progress:null,addPhotosUploadedCallback:()=>{},removePhotosUploadedCallback:()=>{}}),_=o.onUsage(()=>a("S07X1M/v-c-G4"),"default"),e({C:E,D:A,M:L,_:b,a:M,b:W,c:j,d:O,r:V,u:C})},[e=>U=(t=e).default,e=>r=e.useVDOMPortal,e=>(w=e.default,F=e.useLocalize),e=>o=e.component,e=>(g=e.Toast,h=e.ToastItem),e=>n=e.default,e=>y=e.useInteractionLogger,e=>d=e.useWindow,e=>(s=e.fileExtension,l=e.maxVideoUploadSizeInBytes,i=e.maxImageUploadSizeInBytes),e=>c=e.useMutation,e=>T=e.default,e=>S=e.LocationSelector,e=>N=e.default,e=>P=e.CircularButton,e=>x=e.default,e=>I=e.TextArea,e=>u=e.useKeyboardNavigationMode,e=>p=e.margin]]},["cDcdfi","vq6MSq","0DsHEV","pLbCP4","Q7TAd7","VANuRt","fsml46","Dg5_-9","V_I8wA","5X2em-","jSLlaY","dAea-m","VP50Wc","7yGKf-","Ly5eaD","7bbexq","W3_c4H","iekllc"]]);
