define(["OK/logger","OK/utils/dom","OK/utils/utils"],function(e,i,s){"use strict";return{activate:function(t){this.element=t,this.submitToggle=i.firstByClass(this.element,"wp-button"),this.submitToggle&&(this.closeListener=this.close.bind(this),this.submitListener=this.deactivate.bind(this),this.element.addEventListener("click",this.closeListener),this.submitToggle.addEventListener("click",this.submitListener),function t(){this.updateState("denied"===Notification.permission),this.timeoutId=setTimeout(t.bind(this),1e3)}.bind(this)())},submit:function(t){t.stopPropagation(),"denied"!==Notification.permission&&this.deactivate()},close:function(t){if(t.target!==this.element)return!1;this.deactivate()},deactivate:function(){this.element&&(this.element.classList.add("invisible"),this.submitToggle&&(this.submitToggle.removeEventListener("click",this.submitListener),this.submitToggle=null),this.element&&(this.element.removeEventListener("click",this.closeListener),this.element=null),this.timeoutId&&clearTimeout(this.timeoutId),e.success("webpush.popup.close","denied"===Notification.permission?"denied":"allowed"),"function"==typeof this.onClose&&this.onClose())},open:function(t){return e.success("webpush.popup.open"),this.onClose=t,s.ajax({type:"POST",url:"/dk?cmd=PopLayerOver&st.layer.cmd=NotificationPermissionBlock"}).then(s.updateBlockModelCallback)},updateState:function(t){this.submitToggle.classList.toggle("__disabled",t)}}});
