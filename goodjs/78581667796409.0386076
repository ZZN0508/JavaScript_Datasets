!function(){var l,i,n,s,r,a,e,o,p,h,d,c,u,g,t,_,y,m,f,v;try{t=l=l||{},_=-85.05112878,y=85.05112878,m=180/Math.PI,f=Math.PI/180,v=2*Math.PI*6378137,et.prototype.unWrap=function(){this._tileContainer&&this._parentDiv&&this._parentDiv.removeChild(this._tileContainer)},et.prototype._getPrimerPrimitivesFromServerRenderedCard=function(){var e=null,t=document.getElementsByClassName("nonajaxCardPrimer")[0];return e=t&&window.cardPrimerViewModel&&window.cardPrimerViewModel.PrimerParseSelector?this._getPrimitivesFromCardPrimerResponse(t.innerHTML,window.cardPrimerViewModel.PrimerParseSelector):e},et.prototype._getMapBoundsFromCardPrimerResponse=function(){var e,t,i,o,n,s,r,a,l,p,h=document.getElementsByClassName("nonajaxCardPrimer")[0];if(h&&window.cardPrimerViewModel&&window.cardPrimerViewModel.PrimerParseSelector&&(t=h.innerHTML,i=window.cardPrimerViewModel.PrimerParseSelector,t))for((o=document.createElement("div")).innerHTML=t,n=0,s=i.length;n<s;n++)for(a=0,l=(r=o.querySelectorAll(i[n])).length;a<l;a++)(p=(p=r[a].getAttribute("data-boundingbox"))&&JSON.parse(p))&&p.boundingBox&&1<p.boundingBox.length&&(e=[p.boundingBox[0].latitude,p.boundingBox[0].longitude,p.boundingBox[1].latitude,p.boundingBox[1].longitude]);return e},et.prototype._getPrimitivesFromCardPrimerResponse=function(e,t){var i,o,n,s,r,a,l,p=[];if(e)for((i=document.createElement("div")).innerHTML=e,o=0,n=t.length;o<n;o++)for(r=0,a=(s=i.querySelectorAll(t[o])).length;r<a;r++)(l=s[r].getAttribute("data-entity"))&&((l=JSON.parse(l))&&p.push({geometry:{x:l.geometry.x,y:l.geometry.y,bounds:[l.geometry.y,l.geometry.x,l.geometry.y,l.geometry.x]}}));return p},et.prototype._getPoiPrimerPoiLocations=function(e){var t;return e&&0<e.length&&(t=[],e.forEach(function(e){t.push({latitude:e.geometry.y,longitude:e.geometry.x})})),t},et.prototype._getTilePrimerLocationInfo=function(e,t,i,o,n,s,r,a,l){var p;return e&&t?p={centerPointLocation:{latitude:parseFloat(e),longitude:parseFloat(t)},zoom:i}:(r=this._getBootstrapLocation(i,s,r).split(","))&&3<=r.length&&(p={centerPointLocation:{latitude:parseFloat(r[0]),longitude:parseFloat(r[1])},zoom:parseFloat(r[2])}),n&&!a&&(1<n.length?p.locations=n:(p.centerPointLocation=n[0],p.zoom=16)),p.bounds=o,!l||window.history&&window.history.state||(p.viewportPadding=this._isNavLeft?{left:436,right:70,top:0,bottom:30}:{left:384,right:70,top:70,bottom:30}),p},et.prototype._getBootstrapLocation=function(e,t,i){var o=t;if(!o||"0,0"===o){var n=MapsLocalStorage&&MapsLocalStorage.LocalStorageCache,s=parseFloat(n.getItem("centerLatitude")),t=parseFloat(n.getItem("centerLongitude"));if(isFinite(s)&&isFinite(t))return n=parseFloat(n.getItem("zoom")),isFinite(n)?s+","+t+","+n:s+","+t+","+e;o=i}return o+","+e},et.prototype._findBestMapViewFromLocationInfo=function(e){var t,i,o,n,s,r,a,l=null,p=null,h=null,d=this._width,c=this._height;e.viewportPadding&&(o=e.viewportPadding.left,a=e.viewportPadding.top,p=o+(d=this._width-e.viewportPadding.right-o)/2,h=a+(c=this._height-e.viewportPadding.bottom-a)/2),e.locations&&1<e.locations.length?l=et.accumulate(e.locations):e.bounds&&4==e.bounds.length&&(t={latitude:e.bounds[0],longitude:e.bounds[1]},r={latitude:e.bounds[2],longitude:e.bounds[3]},l=et.accumulate([t,r])),l&&(t={latitude:l[0],longitude:l[1]},s={latitude:l[0],longitude:l[3]},i={latitude:l[2],longitude:l[1]},r={latitude:l[2],longitude:l[3]},o={latitude:l[0],longitude:0},a={latitude:l[2],longitude:0},n={latitude:(l[2]+l[0])/2,longitude:(l[1]+l[3])/2},s=et._greatCircleDistance(t,s),r=et._greatCircleDistance(i,r),r=Math.max(s,r),a=et._greatCircleDistance(o,a),c=0!==(c=Math.max(r/d,a/c))?et._getZoomFromMetersPerPixel(n.latitude,c):16,e.zoom=c,e.centerPointLocation=n),n=null,p&&h&&(n=this._getAdjustedLocationAligningToGivenViewportCenter(e.zoom,e.centerPointLocation,p,h)),e.centerPointLocation=n||e.centerPointLocation},et.prototype._addTile=function(e,t,i,o,n){var s=this,r=document.createElement("img"),a=Microsoft.Maps.setTimeout(function(){return l()},5e3),l=function(){r.onload=r.onerror=r.onabort=null,window.clearTimeout(a),void 0!==s._downloadedQueuedImage[t]&&n?o?s._downloadedQueuedImage[t]=r:(s._tileContainer.appendChild(r),s._downloadedQueuedImage[t]=null):(s._tileContainer.appendChild(r),s._downloadedQueuedImage[t]&&s._tileContainer.appendChild(s._downloadedQueuedImage[t]),delete s._downloadedQueuedImage[t],++s._tilesLoaded===s._tileCount&&"undefined"!=typeof performance&&performance.now&&(window.Maps_PPLT=performance.now()))};r.onload=function(){return l()},r.onerror=r.onabort=function(){return l()},r.src=e,r.style.cssText="position:absolute;z-Index:"+(o?1:0)+";top:"+i.y+"px;left:"+i.x+"px"},et.prototype._getImageUrl=function(e,t){var i=t.charAt(t.length-1),i=e.replace("{quadkey}",t).replace("{x}",Math.floor(this._tileX).toString()).replace("{y}",Math.floor(this._tileY).toString()).replace("{zoom}",this._zoom.toString()).replace("{bbox}","").replace("{subdomain}",(parseInt(i)%2).toString()).replace("{mkt}",this._mkt);return this._geopolUserRegion?i.replace(/{ur}/,this._geopolUserRegion):i.replace(/&ur={ur}/,"")},et.prototype.isTileLoadingCompleted=function(){return this._tilesLoaded===this._tileCount},et.prototype._addTiles=function(){var e,t,i;for(this._tileX=this._centerTileX,this._tileY=this._centerTileY,this._offset=this._centerOffset,this._direction=0,this._movesLeft=1,this._step=1,this._tileCount=e=0;e<128&&this._tileCount<48;e++)this._isVisible(this._offset)&&((t=this._getQuadKey())&&(i=!!this._labelFormat&&this._isLabelVisible(this._offset),this._addTile(this._getImageUrl(this._tileFormat,t),t,this._offset,!1,i),i&&this._addTile(this._getImageUrl(this._labelFormat,t),t,this._offset,!0,i),this._tileCount++)),this._incrementSpiral()},et.prototype._getQuadKey=function(){var e,t,i,o;if(this._tileY<0||this._tileY>this._maxTileCoordinate)return null;for(e="",t=this._zoom;0<t;t--)(i=0)!=(this._tileX&(o=1<<t-1))&&i++,0!=(this._tileY&o)&&(i+=2),e+=i;return e},et.prototype._isVisible=function(e){return e.y>-this._tileSize&&e.y<this._height&&e.x>-this._tileSize&&e.x<this._width},et.prototype._isLabelVisible=function(e){var t=.4*this._tileSize;return e.y>-this._tileSize+t&&e.y<this._height-t&&e.x>-this._tileSize+t&&e.x<this._width-t},et.prototype._incrementSpiral=function(){switch(this._direction){case 0:this._tileX++,this._offset.x+=this._tileSize;break;case 1:this._tileY--,this._offset.y-=this._tileSize;break;case 2:this._tileX--,this._offset.x-=this._tileSize;break;case 3:this._tileY++,this._offset.y+=this._tileSize}this._tileX>this._maxTileCoordinate?this._tileX=0:this._tileX<0&&(this._tileX=this._maxTileCoordinate),this._movesLeft--,this._movesLeft<=0&&(this._movesLeft=Math.floor(this._step+=.5),3<++this._direction&&(this._direction=0))},et.prototype._latlongToPixelXY=function(e,t,i){e=this._median(e,_,y),t=(this._median(t,-180,180)+180)/360,e=Math.sin(e*Math.PI/180),e=.5-Math.log((1+e)/(1-e))/(4*Math.PI),i=this._tileSize<<i;return{x:this._median(t*i+.5,0,i-1),y:this._median(e*i+.5,0,i-1)}},et.prototype._median=function(e,t,i){return Math.min(Math.max(e,t),i)},et._greatCircleDistance=function(e,t){var i=et._degreesToRadians(t.latitude),o=et._degreesToRadians(e.latitude),n=et._degreesToRadians(t.longitude),t=et._degreesToRadians(e.longitude),e=Math.abs(i-o),t=Math.abs(n-t),e=Math.sin(e/2),t=Math.sin(t/2);return 6378137*(2*Math.asin(Math.sqrt(e*e+Math.cos(o)*Math.cos(i)*t*t)))},et._degreesToRadians=function(e){return e*f},et.accumulate=function(e){for(var t,i=0;i<e.length;i++)t?(t[0]=Math.max(t[0],e[i].latitude),t[1]=Math.min(t[1],e[i].longitude),t[2]=Math.min(t[2],e[i].latitude),t[3]=Math.max(t[3],e[i].longitude)):t=[e[i].latitude,e[i].longitude,e[i].latitude,e[i].longitude];t[0];var o=t[1],n=(t[2],t[3]);return 360<Math.abs(n-o)&&(o=-180,n=180),o=et._normalizeLongitude(o),(n=et._normalizeLongitude(n))<o&&(n+=360),t[1]=o,t[3]=n,t},et._normalizeLongitude=function(e){return e<-180||180<e?e-360*Math.floor((e+180)/360):e},et._getZoomFromMetersPerPixel=function(e,t){return Math.log(Math.cos(et._degreesToRadians(e))*v/(256*t))/Math.log(2)},et.prototype._getAdjustedLocationAligningToGivenViewportCenter=function(e,t,i,o){var n=Math.pow(2,e),s=256*n,e=256*n,n=et._projectToMercatorX(t.latitude,t.longitude),t=et._projectToMercatorY(t.latitude,t.longitude),i=i-this._width/2,o=o-this._height/2,s=n-i/s;return{latitude:et._projectMercatorYToLatitude(t-o/e),longitude:et._projectMercatorXToLongitude(s)}},et._projectToMercatorX=function(e,t){return t/360+.5},et._projectToMercatorY=function(e){if(y<=e)return 0;if(e<=_)return 1;e=Math.sin(e*f);return.5-+Math.log((1+e)/(1-e))/(4*Math.PI)},et._projectMercatorXToLongitude=function(e){return 360*(e-.5)},et._projectMercatorYToLatitude=function(e){return 90-2*Math.atan(Math.exp((2*e-1)*Math.PI))*m},t.Primer=et;var b=window.$MicrosoftMaps8,M=b.Internal,C=b.Anchor,k=M._AnimationRenderer,S=M._BaseMapTemplateSelector,T=b.BasicTemplate,w=(b.BirdseyeV2Manager,b.BirdseyeV2Metadata),x=b.BitmapImageTemplate,O=(M._BoundsAccumulator,M.CanvasDrawingContext,M._Color),E=M._ComponentNames,I=(b.CompositeMapMode,M.ControlTemplate),L=(b.DefaultTemplateSelector,M._Gimme),P=b.GlobalConfig,H=M._Helper,D=b.ImageryMapLayer,A=M._JSEvent,R=b.LabelVisibility,B=(M._LatLonCrs,M._LayerRendererManager,b.LocationRect),z=(M._LruCache,M.MapHelper),V=b.MapLayer,N=b.Location,F=b.MapView,j=b.MapViewAnimator,W=b.MercatorCubeCrs,G=M._MercatorTileUtility,U=M._Observable,Z=M._ObservableCollection,J=(M._ObservableObject,M._ObservableObjectChangedArgs),X=M._Overlay,K=(M._OverlayEntity,M._PerfV2Logger),Y=b.Point,Q=b.RasterImageryScene,q=b.SimpleAreaPrimitive,$=b.SimpleLinePrimitive,ee=b.SimplePointPrimitive,te=b.VectorMapLayer;b.LabelOverlay=R;b.Size;function ie(){}var oe,ne=b.VectorImageTemplate,se=b.ZoomLevel,re=b.MapTypeId,ae=M._MapAuthentication,le=(M._LoggingWrapper,this&&this.__extends||(g=function(e,t){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}g(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})),pe=($e.prototype.getHtmlElement=function(){return this._htmlElement&&this._htmlElement[0]},$e.prototype.setHtmlElement=function(e){e=L(e);this._map&&(0<e.length&&this._insertHtmlElement(e),this._htmlElement&&this._htmlElement.removeFromParent()),this._htmlElement=e},$e.prototype.getOptions=function(){return this._options},$e.prototype.onAdd=function(){},$e.prototype.onRemove=function(){},$e.prototype.onLoad=function(){},$e.prototype.attachMap=function(e){var t,i=this;if(this._map)throw new Error("This custom overlay is already attached to an existing map");e&&(this.onAdd(),this._map=e,t=this._map.getV8Map(),k.containsCustomOverlay(),this._onMapTypeChanged=t.mapTypeChanged.add(function(){i._map&&t.getFrameManager().frameRendered.addOne(function(){i._insertHtmlElement(i._htmlElement)})}),t.labelControllerLoaded.addOne(function(){i._insertHtmlElement(i._htmlElement),i.onLoad()},!1,!0))},$e.prototype.detachMap=function(e){if(this._map&&this._map!==e)throw new Error("Cannot remove custom overlay from this map since it's attached to another map instance");this._internalCleanup()},$e.prototype.getMap=function(){return this._map},$e.prototype.dispose=function(){for(var e in this._registeredJsEvents)H._undefineJSEventForDomEvent(this._htmlElement,e,this._registeredJsEvents[e].id),this._registeredJsEvents[e].dispose();this._internalCleanup(),H._nullifyClass(this)},$e.prototype._internalCleanup=function(){this._htmlElement&&this._htmlElement.removeFromParent(),this._onMapTypeChanged&&this._onMapTypeChanged.dispose(),this._map=null,this.onRemove()},$e.prototype._insertHtmlElement=function(e){var t=this._useDrawOrder?this._options.drawOrder:this._options.beneathLabels?-1:1,i=this._map.getMode();this._map&&"Streetside"!==this._map.getImageryId()&&(i=i.getRootElement(),e.set_style({zIndex:2e4+t}),i.append(e),this._stopEventsPropagation())},$e.prototype._stopEventsPropagation=function(){var e,t,i;if(this._htmlElement)for(e={stopPropagation:!0},t=["mousemove","mousedown","mouseup","click","dblclick","contextmenu","touchmove","touchstart","touchend","keydown","keyup"],i=0;i<t.length;i++)this._registeredJsEvents[t[i]]=H._defineJSEventForDomEvent(this._htmlElement,t[i],e)},$e._maxDrawOrder=100,$e._drawOrderAttribute="data-draworder",$e._defaultOptions={beneathLabels:!0,showInBirdseye:!1,drawOrder:-1},$e),he=(le(qe,u=Q),qe.prototype.getTileSize=function(){var e=this._options;return e&&(e.tileSize||e.width)||G.tileSize},qe.prototype.getHeight=function(){var e=this._options;return e&&(e.tileSize||e.height)||G.tileSize},qe.prototype.getUriConstructor=function(){return this._tileUrlTemplate},qe.prototype.getWidth=function(){return this.getTileSize()},qe.prototype.toString=function(){throw new Error("Not supported")},qe.prototype.getBounds=function(){return this._options&&this._options.bounds},qe.prototype.getMinZoom=function(){return this._options&&this._options.minZoom},qe.prototype.getMaxZoom=function(){return this._options&&this._options.maxZoom},qe._tileSourceId=0,qe),de=(le(Qe,c=pe),Qe.prototype.onAdd=function(){var e=document.createElement("div");e.style.position="absolute",this.setHtmlElement(e)},Qe.prototype.onRemove=function(){var e=this._layerOptions&&this._layerOptions.loadingScreen;e&&e.getMap()&&e.detachMap(e.getMap()),1===this._animationState&&this.stop(),H._clearDisposables(this._disposables)},Qe.prototype.onLoad=function(){var t=this,i=this._map.getV8Map(),e=i.getActualSize();this._htmlElement.set_style({height:e.height,width:e.width}),e=i.actualSizeChanged.add(function(){t._removeAllTiles();var e=i.getActualSize();t._htmlElement.set_style({height:e.height,width:e.width}),t._preLoadAllTiles()}),this._disposables.push(e),this._map.getMode().onPaint.addOne(function(){t._preLoadTilesAfterPaint()},!1,!0)},Qe.prototype.setOptions=function(e){var t;e&&("number"==typeof e.frameRate&&(this._layerOptions.frameRate=e.frameRate,1===this._animationState&&(this.pause(),this.play())),this._layerOptions.maxTotalLoadTime=("number"==typeof e.maxTotalLoadTime?e:this._layerOptions).maxTotalLoadTime,this._layerOptions.visible=("boolean"==typeof e.visible?e:this._layerOptions).visible,this._map&&(this._layerOptions.visible?(this._toggleFrameVisibility(this._currentFrameIndex,3!==this._animationState),1===this._animationState&&this.play()):(this._clearAnimation(),this._toggleFrameVisibility(this._currentFrameIndex,!1))),e.mercator&&(this._layerOptions.mercator=e.mercator,this._map&&(this._removeAllTiles(),this._preLoadAllTiles())),e.loadingScreen&&((t=this._layerOptions.loadingScreen.getMap())&&this._layerOptions.loadingScreen.detachMap(t),this._layerOptions.loadingScreen=e.loadingScreen),this._layerOptions.autoPlay=("boolean"==typeof e.autoPlay?e:this._layerOptions).autoPlay,"boolean"==typeof e.autoPlay&&(this._animationState=this._layerOptions.autoPlay?0:2))},Qe.prototype.getTileSources=function(){return this._layerOptions.mercator},Qe.prototype.getFrameRate=function(){return this._layerOptions.frameRate},Qe.prototype.getMaxTotalLoadTime=function(){return this._layerOptions.maxTotalLoadTime},Qe.prototype.getVisible=function(){return this._layerOptions.visible},Qe.prototype.getLoadingScreen=function(){return this._layerOptions.loadingScreen},Qe.prototype.getAnimationState=function(){return this._animationState},Qe.prototype.stop=function(){this._animationState=3,this._clearAnimation(),this._map&&this._toggleFrameVisibility(this._currentFrameIndex,!1),this._currentFrameIndex=0},Qe.prototype.pause=function(){this._animationState=2,this._clearAnimation()},Qe.prototype.play=function(){var t=this;this._clearAnimation(),this._animationState=1,this._map&&(this._toggleFrameVisibility(this._currentFrameIndex,!0),this._animation=Microsoft.Maps.setInterval(function(){var e;t._map&&"Streetside"!==t._map.getImageryId()&&(e=t._currentFrameIndex,t._currentFrameIndex=t._currentFrameIndex+1===t._primers.length?0:t._currentFrameIndex+1,t._toggleFrameVisibility(t._currentFrameIndex,!0),t._toggleFrameVisibility(e,!1))},this._layerOptions.frameRate))},Qe.prototype.dispose=function(){this.onRemove(),c.prototype.dispose.call(this)},Qe.prototype._removeAllTiles=function(){this._clearAnimation(),this._htmlElement.clear()},Qe.prototype._preLoadAllTiles=function(){this.preLoadStarted.invoke(),this._layerOptions.loadingScreen.getMap()||this._layerOptions.loadingScreen.attachMap(this._map),this._primers=[];for(var e,t,i,o=this._map.getCenter().latitude,n=this._map.getCenter().longitude,s=this._map.getZoom(),r=this._layerOptions.mercator,a=0;a<r.length;a++)(i=document.createElement("div")).className=Qe._layerFrameClassName,i.style.visibility="hidden",i.style.position="absolute",i.style.height="100%",i.style.width="100%",this._htmlElement.append(i),"number"==typeof r[a].getMaxZoom()&&s>r[a].getMaxZoom()||"number"==typeof r[a].getMinZoom()&&s<r[a].getMinZoom()||(t=r[0].getBounds()&&r[0].getBounds().bounds,e=Microsoft.Maps.GlobalConfig.dynamicProperties,t=new l.Primer(i,e.market,e.isGeopolUserRegion&&e.userRegion?e.userRegion:null,o.toString(),n.toString(),s,t,null,null,null,null,r[a].getUriConstructor(),null,null,null,null,null,!0,null),this._primers.push(t),i.firstElementChild.style.zIndex="auto");this._checkPreLoadTilesComplete()},Qe.prototype._checkPreLoadTilesComplete=function(){function i(){clearInterval(t),clearTimeout(n),o._layerOptions.visible&&3!==o._animationState&&o._map&&o._toggleFrameVisibility(o._currentFrameIndex,!0);var e=o._layerOptions.loadingScreen;e.getMap()&&e.detachMap(e.getMap()),o.preLoadEnded.invoke(),o._layerOptions.visible&&o._animationState<2&&o._map&&o.play()}var o=this,t=Microsoft.Maps.setInterval(function(){for(var e=!0,t=0;t<o._primers.length;t++)if(!o._primers[t].isTileLoadingCompleted()){e=!1;break}e&&i()},500),n=Microsoft.Maps.setTimeout(function(){i()},this._layerOptions.maxTotalLoadTime)},Qe.prototype._clearAnimation=function(){this._animation&&(clearInterval(this._animation),this._animation=null)},Qe.prototype._toggleFrameVisibility=function(e,t){var i;!this._htmlElement||(i=this._htmlElement.select("."+Qe._layerFrameClassName))[e]&&(i[e].style.visibility=t?"visible":"hidden",t&&this.onFrameLoaded.invoke({index:this._currentFrameIndex,animatedTileLayer:this}))},Qe._createDefaultLoadingScreen=function(){var e,i=new pe({beneathLabels:!1});return i.onAdd=function(){var e;i.getHtmlElement()||((e=document.createElement("div")).innerText="Loading tile animation...",e.style.position="absolute",e.style.backgroundColor="rgba(235, 233, 226, 0.75)",e.style.textAlign="center",e.style.verticalAlign="middle",i.setHtmlElement(e))},i.onLoad=function(){var t=i.getMap().getV8Map().getActualSize();i.getHtmlElement().style.height=t.height+"px",i.getHtmlElement().style.width=t.width+"px",i.getHtmlElement().style.lineHeight=t.height+"px",e=i.getMap().getV8Map().actualSizeChanged.add(function(){var e=i.getMap().getV8Map().getActualSize();i.getHtmlElement().style.height=e.height+"px",i.getHtmlElement().style.width=e.width+"px",i.getHtmlElement().style.lineHeight=t.height+"px"})},i.onRemove=function(){e.dispose&&e.dispose()},i},Qe.prototype._preLoadTilesAfterPaint=function(){var e=this;this._disposables.push(this._map.viewchangestart.add(function(){e._removeAllTiles()})),this._disposables.push(this._map.viewchangeend.add(function(){e._preLoadAllTiles()})),this._preLoadAllTiles()},Qe._defaultLayerOptions={visible:!0,frameRate:1e3,mercator:null,maxTotalLoadTime:15e3,loadingScreen:Qe._createDefaultLoadingScreen(),autoPlay:!0},Qe._layerFrameClassName="layerFrame",Qe),ce=(le(Ye,d=te),Ye.prototype.clear=function(){this._lastClearedPrimitives=this._primitives,H._clearDisposables(this._changedEventHandlers),this._primitives=[],this._primitiveChanged(this._lastClearedPrimitives)},Ye.prototype.add=function(e,t){var i,o,n="number"==typeof e.length?e:[e];for("number"==typeof t?(t=(t=[t,0]).concat(n),Array.prototype.splice.apply(this._primitives,t)):Array.prototype.push.apply(this._primitives,n),i=0,o=n.length;i<o;i++)n[i].layer=this;this._observePrimitiveChanges(n),this._primitiveChanged(n)},Ye.prototype.remove=function(e){e=this._primitives.indexOf(e);return this.removeAt(e)},Ye.prototype.removeAt=function(e){var t,i;return 0<=e&&e<this._primitives.length&&(t=this._primitives.splice(e,1)[0],(i=this._changedEventHandlers[e])&&i.dispose(),this._changedEventHandlers.splice(e,1),this._primitiveChanged([t])),t},Ye.prototype.bringToTop=function(e){var t=this._primitives.indexOf(e);t!==this._primitives.length-1&&0<=t&&(this._primitives.splice(t,1),t=this._changedEventHandlers.splice(t,1),Array.prototype.push.apply(this._changedEventHandlers,t),Array.prototype.push.apply(this._primitives,[e]),this._primitiveChanged([e]))},Ye.prototype.getPrimitives=function(e,t){var i,o,n,s;if(!e&&!t)return this._primitives;if(i=[],this._primitives&&this.getVisible())for(o=0,n=this._primitives.length;o<n;o++)(s=this._primitives[o]).getVisible&&!s.getVisible()||i.push(s);return t&&t({primitives:i}),i},Ye.prototype.setPrimitives=function(e){this.clear(),this.add(e,null)},Ye.prototype.raiseInvalidatedEvent=function(e){var t,i=this;this._invalidatedQueued||(t=e||{layerId:this.getId()},this._invalidatedQueued=!0,Microsoft.Maps.setTimeout(function(){i._invalidatedQueued=!1,i.invalidated&&i.invalidated.invoke(t)},0))},Ye.prototype.dispose=function(e){e&&(H._clearDisposables(this._primitives),H._clearDisposables(this._lastClearedPrimitives)),H._clearDisposables(this._changedEventHandlers),this._primitives=[],this._lastClearedPrimitives=[],d.prototype.dispose.call(this)},Ye.prototype.addToDisposables=function(e){this._disposables&&this._disposables.push(e)},Ye.prototype._observePrimitiveChanges=function(e,t){for(var i,o,n=this,s="number"==typeof e.length?e:[e],r=[],a=0,l=s.length;a<l;a++)i=null,(o=s[a]).changed&&(i=o.changed.add(function(e){n._primitiveChanged(e)})),r.push(i);t?(t=(t=[t,0]).concat(r),Array.prototype.splice.apply(this._changedEventHandlers,t)):Array.prototype.push.apply(this._changedEventHandlers,r)},Ye.prototype._primitiveChanged=function(e){var t={layerId:this.getId(),entityIds:null};e&&(e=e&&e.sender?[e.sender]:e,t.entityIds=H._getPrimitiveIds(e)),this.raiseInvalidatedEvent(t)},Ye.prototype._onPrimitiveMoved=function(e,t){var i=e.primitive;i instanceof Ce&&i.isMoveEnabled()&&i.setLocation(e.location,t)},Ye._zIndex=1e4,Ye),ue=function(e,t){this.collection=e,this.data=t},ge=(le(Ke,h=ce),Ke.prototype.get=function(e){return 0<=e&&e<this._primitives.length?this._primitives[e]:null},Ke.prototype.getLength=function(){return this._primitives.length},Ke.prototype.indexOf=function(e){return this._primitives.indexOf(e)},Ke.prototype.insert=function(e,t){this._addInternal(e,t)},Ke.prototype.pop=function(){return this.removeAt(this._primitives.length-1)},Ke.prototype.push=function(e){this._addInternal(e)},Ke.prototype.remove=function(e){var t,i,o,n,s,r=[],a=[];for(e instanceof Ke?(e.getPrimitives(null,function(e){r=e.primitives}),o=e.getId(),n=this._childCollectionElementAddedHandlers[o],s=this._childCollectionElementRemovedHandlers[o],e.entityadded.remove(n),e.entityremoved.remove(s),delete this._childCollectionElementAddedHandlers[o],delete this._childCollectionElementRemovedHandlers[o],delete this._childCollections[o]):e instanceof Array?r=e:r.push(e),t=0;t<r.length;t++)(i=h.prototype.remove.call(this,r[t]))&&a.push(i);return 0===a.length?null:1===a.length?(this.entityremoved.invoke(new ue(this,a[0])),a[0]):(this.entityremoved.invoke(new ue(this,a)),a)},Ke.prototype.removeAt=function(e){e=h.prototype.removeAt.call(this,e);return e&&this.entityremoved.invoke(new ue(this,e)),e},Ke.prototype.clear=function(){var e,t;for(e in this._childCollections)this._childCollections[e].entityadded.remove(this._childCollectionElementAddedHandlers[e]),this._childCollections[e].entityremoved.remove(this._childCollectionElementRemovedHandlers[e]);this._childCollectionElementAddedHandlers={},this._childCollectionElementRemovedHandlers={},this._childCollections={},t=this._primitives,h.prototype.clear.call(this),this.entityremoved.invoke(new ue(this,t))},Ke.prototype.setOptions=function(e){this._options=e},Ke.prototype.toString=function(){throw new Error("not implemented")},Ke.prototype.dispose=function(e){this._options=null,this._childCollectionElementAddedHandlers=null,this._childCollectionElementRemovedHandlers=null,this._childCollections=null,H._clearDisposables(this._disposables),h.prototype.dispose.call(this,e)},Ke.prototype._addInfoboxHelper=function(e){if(e)for(var t=0;t<e.length;t++)this.push(e[t])},Ke.prototype._addInternal=function(e,t){var i,o,n,s=this;e instanceof fe?(this._v8map&&(console.warn("This API is deprecated. Please use Infobox.setMap. For more information please see https://www.bing.com/api/maps/sdkrelease/mapcontrol/isdk#addDefaultInfobox+JS"),e.setMap(this._v8map)),this._infoboxCollection.push(e)):e instanceof Ke?(this._addInfoboxHelper(e._infoboxCollection),e.getPrimitives(null,function(e){i=e.primitives}),o=e.getId(),this._childCollectionElementAddedHandlers[o]||(this._childCollectionElementAddedHandlers[o]=n=function(e){e.data&&s.push(e.data),e.collection&&s._addInfoboxHelper(e.collection._infoboxCollection)},this._disposables.push(e.entityadded.add(n))),this._childCollectionElementRemovedHandlers[o]||(this._childCollectionElementRemovedHandlers[o]=n=function(e){e.data&&s.remove(e.data)},this._disposables.push(e.entityremoved.add(n))),this._childCollections[o]||(this._childCollections[o]=e)):i=e,i=i||[],h.prototype.add.call(this,i,t),this.entityadded.invoke(new ue(this,i))},Ke._layerId=1,Ke._defaultOptions={visible:!0},Ke),_e=(Xe.addHandler=function(e,t,i){i=Xe._getWrappedEventArgs(e,t,i);return i.target[i.eventName].add(i.callback)},Xe.addThrottledHandler=function(e,t,i,o){i=Xe._getWrappedEventArgs(e,t,i);return i.target[i.eventName].addThrottled(i.callback,o)},Xe.hasHandler=function(e,t){t=Xe._getWrappedEventArgs(e,t);return t.target[t.eventName].hasHandlersRegistered()},Xe.invoke=function(e,t,i){t=Xe._getWrappedEventArgs(e,t);t.target[t.eventName].invoke(i)},Xe.removeHandler=function(e){e&&e.dispose()},Xe.addOne=function(e,t,i){i=Xe._getWrappedEventArgs(e,t,i);i.target[i.eventName].addOne(i.callback)},Xe._getWrappedEventArgs=function(t,i,o){var e,n={target:t,eventName:i,callback:o};return t instanceof ke?(n.callback=function(e){e&&(e.target=t,e.targetType="map"),o&&o(e)},(e={click:"mapTapped",rightclick:"contextMenuInvoked",maptypechanged:"mapTypeChanged",mousedown:"pointerPressed",mouseup:"pointerReleased",mousemove:"pointerMoved",mouseover:"pointerEntered",mouseout:"pointerExited",mousewheel:"pointerWheelChanged",dblclick:"mapDoubleTapped",mapresize:"mapResized",mapsetview:"setViewInvoked"}[i])&&(n.eventName=e,n.target=t.getV8Map())):t instanceof Ce||t instanceof Se||t instanceof Te?(n.eventName={click:"click",dblclick:"dblclick",drag:"drag",dragend:"dragend",dragstart:"dragstart",mousedown:"mousedown",mouseup:"mouseup",mouseout:"mouseout",mouseover:"mouseover",changed:"changed"}[i],n.eventName&&!n.target[n.eventName]&&(n.target[n.eventName]=new A)):t instanceof fe?(n.eventName={click:"click",mouseenter:"mouseenter",mouseleave:"mouseleave",infoboxChanged:"infoboxChanged"}[i],n.eventName&&!n.target[n.eventName]&&(n.target[n.eventName]=new A)):t instanceof ce&&(n.callback=function(e){e&&(e.targetType="layer",e.eventName=i),o&&o(e)},(e={click:"primitiveTapped",dblclick:"primitiveDoubleTapped",rightclick:"contextMenuInvoked",mouseup:"primitivePointerReleased",mouseover:"primitiveHoverStarted",mousedown:"primitivePointerPressed",mouseout:"primitiveHoverStopped"}[i])&&(n.eventName=e)),n},Xe),ye=(Je.clone=function(e){var t;return t=e?new Je(e.a,e.r,e.g,e.b):t},Je.fromHex=function(e){var t;return t=e?new Je(255,(e=parseInt(e.slice(1),16))>>16&255,e>>8&255,255&e):t},Je.fromRGBA=function(e){var t,i,o=e.indexOf("("),n=e.indexOf(")");return-1===o||-1===n?null:(t=null,!(i=e.slice(o+1,n).split(","))||4!==i.length&&3!==i.length||(e=parseInt(i[0]),o=parseInt(i[1]),n=parseInt(i[2]),t=new Je(4===i.length?parseFloat(i[3]):1,e,o,n)),t)},Je.prototype.clone=function(){return Je.clone(this)},Je.prototype.getOpacity=function(){return this.a},Je.prototype.toHex=function(e){var t,i="#";if(e)for(t=0;t<e.length;t++)switch(e.charAt(t)){case"a":i+=this._toHexInternal(Math.floor(255*this.a));break;case"r":i+=this._toHexInternal(this.r);break;case"g":i+=this._toHexInternal(this.g);break;case"b":i+=this._toHexInternal(this.b)}else i+=this._toHexInternal(this.r)+this._toHexInternal(this.g)+this._toHexInternal(this.b);return i},Je.prototype.toRgba=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},Je.prototype._toHexInternal=function(e){e=e.toString(16);return 1==e.length?"0"+e:e},Je),me=(le(Ze,p=pe),Ze.prototype.clear=function(){this._groundOverlayOptions={beneathLabels:!0,backgroundColor:"transparent",bounds:null,imageUrl:null,opacity:1,rotation:0,visible:!0},this.setHtmlElement(null)},Ze.prototype.getBackgroundColor=function(){return this._groundOverlayOptions.backgroundColor},Ze.prototype.getBounds=function(){return this._groundOverlayOptions.bounds},Ze.prototype.getImageUrl=function(){return this._groundOverlayOptions.imageUrl},Ze.prototype.getOpacity=function(){return this._groundOverlayOptions.opacity},Ze.prototype.getRotation=function(){return this._groundOverlayOptions.rotation},Ze.prototype.getVisible=function(){return this._groundOverlayOptions.visible},Ze.prototype.setOptions=function(e){e&&"boolean"==typeof e.beneathLabels&&(this._groundOverlayOptions.beneathLabels=e.beneathLabels),void 0!==e.backgroundColor&&(this._groundOverlayOptions.backgroundColor=e.backgroundColor,this._img&&(this._img.style.backgroundColor="string"==typeof this._groundOverlayOptions.backgroundColor?this._groundOverlayOptions.backgroundColor:this._groundOverlayOptions.backgroundColor.toRgba())),"number"==typeof e.opacity&&(this._groundOverlayOptions.opacity=e.opacity,this._img&&(this._img.style.opacity=this._groundOverlayOptions.opacity.toString())),"number"==typeof e.rotation&&(this._groundOverlayOptions.rotation=e.rotation,this._rotateGroundOverlay()),e.bounds instanceof B&&(this._groundOverlayOptions.bounds=e.bounds),void 0!==e.imageUrl&&(this._groundOverlayOptions.imageUrl=e.imageUrl,this._loadGroundOverlayImage()),this.setVisible(e.visible),this._repositionGroundOverlay()},Ze.prototype.setVisible=function(e){"boolean"==typeof e&&(this._groundOverlayOptions.visible=e,this._img&&(e?(this._img.style.display="",this._repositionGroundOverlay()):this._img.style.display="none"))},Ze.prototype.onLoad=function(){var e=this;this._repositionGroundOverlay(),_e.addHandler(this.getMap(),"viewchange",function(){e._repositionGroundOverlay()}),_e.addHandler(this.getMap(),"mapresize",function(){e._repositionGroundOverlay()}),_e.addHandler(this.getMap(),"mapsetview",function(){e._repositionGroundOverlay()})},Ze.prototype.onRemove=function(){},Ze.prototype.dispose=function(){this.clear(),p.prototype.dispose.call(this)},Ze.prototype._loadGroundOverlayImage=function(){this._groundOverlayOptions.imageUrl?(this._img=document.createElement("img"),this._img.src=this._groundOverlayOptions.imageUrl,this._img.style.width="100%",this._img.style.height="100%",this._img.style.position="absolute",this._img.style.display=this._groundOverlayOptions.visible?"":"none",this._groundOverlayOptions.backgroundColor&&(this._img.style.backgroundColor="string"==typeof this._groundOverlayOptions.backgroundColor?this._groundOverlayOptions.backgroundColor:this._groundOverlayOptions.backgroundColor.toRgba()),"number"==typeof this._groundOverlayOptions.opacity&&(this._img.style.opacity=this._groundOverlayOptions.opacity.toString()),this._rotateGroundOverlay(),this.setHtmlElement(this._img)):this.setHtmlElement(null)},Ze.prototype._rotateGroundOverlay=function(){var e;this._img&&(e=this._groundOverlayOptions.rotation,this._img.style["-webkit-transform"]=e="rotate("+(e=e||0)+"deg)",this._img.style["-moz-transform"]=e,this._img.style["-ms-transform"]=e,this._img.style["-o-transform"]=e,this._img.style.transform=e)},Ze.prototype._repositionGroundOverlay=function(){var e,t=this.getMap();t&&this._img&&this._groundOverlayOptions.bounds&&this._groundOverlayOptions.visible&&(e=t.tryLocationToPixel(this._groundOverlayOptions.bounds.getNorthwest(),Microsoft.Maps.PixelReference.control),t=t.tryLocationToPixel(this._groundOverlayOptions.bounds.getSoutheast(),Microsoft.Maps.PixelReference.control),this._img.style.left=e.x+"px",this._img.style.top=e.y+"px",this._img.style.width=t.x-e.x+"px",this._img.style.width=t.x-e.x+"px",this._img.style.height=t.y-e.y+"px")},Ze),fe=(le(Ue,o=X),Ue.prototype.getActions=function(){return this._options.actions},Ue.prototype.getDescription=function(){return this._options.description},Ue.prototype.getHeight=function(){return this._getInfoboxElement().get_size().height},Ue.prototype.getHtmlContent=function(){return this._options.htmlContent},Ue.prototype.getLocation=function(){return this._options.location},Ue.prototype.getMaxHeight=function(){return this._options.maxHeight},Ue.prototype.getMaxWidth=function(){return this._options.maxHeight},Ue.prototype.getOffset=function(){return this._options.offset},Ue.prototype.getOptions=function(){return this._options},Ue.prototype.getShowCloseButton=function(){return this._options.showCloseButton},Ue.prototype.getShowDescription=function(){return void 0!==this._options.description},Ue.prototype.getShowPointer=function(){return this._options.showPointer},Ue.prototype.getShowCustomPointer=function(){return this._options.showCustomPointer},Ue.prototype.getTitle=function(){return this._options.title},Ue.prototype.getVisible=function(){var e=this._map&&this._map.getOverlays();return!(!this._map||!e||-1===e.indexOf(this))&&this._options.visible},Ue.prototype.getWidth=function(){return this._getInfoboxElement().get_size().width},Ue.prototype.getZIndex=function(){return this._options.zIndex},Ue.prototype.getIsCustom=function(){return this._customInfobox},Ue.prototype.getIsDefault=function(){return!this._customInfobox},Ue.prototype.setHtmlContent=function(e){this.setOptions({htmlContent:e})},Ue.prototype.setLocation=function(e){this.setOptions({location:e})},Ue.prototype.setOptions=function(i,e){function t(e,t){typeof i[e]===t&&(s[e]=i[e])}var o=this,n=0,s=this._options;i&&(t("closeDelayTime","number"),t("title","string"),t("description","string"),t("autoAlignment","boolean"),t("showCloseButton","boolean"),t("showPointer","boolean"),t("showCustomPointer","boolean"),t("zIndex","number"),t("htmlContent","string"),t("maxHeight","number"),t("maxWidth","number"),s.actions=i.actions||s.actions,s.offset=i.offset||s.offset,s.location=i.location||s.location,"boolean"==typeof i.visible&&(i.visible||!this._options.visible||e||(n=this._options.closeDelayTime),s.visible=i.visible)),i&&"string"==typeof i.description&&this._createDescription(),this.setAlignment(s.location),i&&"string"==typeof i.htmlContent&&this._createCustomInfobox(),s.visible&&this._timerId&&clearTimeout(this._timerId),0<n?this._timerId=Microsoft.Maps.setTimeout(function(){o._invokeSetOptionsEvents(i)},n):this._invokeSetOptionsEvents(i)},Ue.prototype.setMap=function(e){var t=this,i=e;e?(this._createControl(),this._mouseenterVisibilityHandlerId=_e.addHandler(this,"mouseenter",function(){t._cachedVisibilitySetting=t._options.visible,t._cachedVisibilitySetting||t.setOptions({visible:!0})}),this._mouseleaveVisibilityHandlerId=_e.addHandler(this,"mouseleave",function(){t._cachedVisibilitySetting||t.setOptions({visible:!1})}),e instanceof ke&&(i=e.getV8Map()),(this._map=i).getOverlayManager().then(function(){i.getOverlays().insert(t),t.changed.invoke(),t._createDescription(),t._createCustomInfobox(),t._adjustInfoboxSize()}),i.getMapOptions().allowInfoboxOverflow&&this._listenToMapChangedEvent()):this._map&&this._control&&!this._map.isDisposed()&&((i=this._map).getOverlayManager().then(function(){var e=i.getOverlays();e&&e.remove(t),t.changed.invoke()}),this._changeVisibilityDisposable&&this._changeVisibilityDisposable.dispose())},Ue.prototype.boolToDisplay=function(e){return e?"":"none"},Ue.prototype.optionsToClass=function(e){var t="Infobox";return e&&(e.title||(t+=" no-title"),e.showCloseButton||(t+=" no-close")),t},Ue.prototype.dispose=function(){if(this.setMap(null),this.click&&this.click.dispose(),this.infoboxChanged&&this.infoboxChanged.dispose(),this.mouseenter&&this.mouseenter.dispose(),this.mouseleave&&this.mouseleave.dispose(),this._control){for(var e in this._registeredJsEvents)H._undefineJSEventForDomEvent(this._control,e,this._registeredJsEvents[e].id),this._registeredJsEvents[e].dispose();this._control.removeFromParent(),this._control.remove_event("click",this._clickHandler),this._control.remove_event("mouseenter",this._mouseenterHandler),this._control.remove_event("mouseleave",this._mouseleaveHandler),_e.removeHandler(this._mouseenterVisibilityHandlerId),_e.removeHandler(this._mouseleaveVisibilityHandlerId),this._control=null}o.prototype.dispose.call(this),H._nullifyClass(this)},Ue.prototype._getInfoboxElement=function(){return this._createControl(),this._customInfobox?this._control.select(Ue._customInfoboxClass):this._control.select(Ue._infoboxClass)},Ue.prototype._createControl=function(){var e,t,i,o=this;if(!this._control){for(this.click=new A,this.mouseenter=new A,this.mouseleave=new A,this._control=new I('<div style:display="{Binding visible Converter=boolToDisplay}" style:z-index="{Binding zIndex}">    <div class="{Binding options Converter=optionsToClass}" style:display="{Binding isDefault Converter=boolToDisplay}" data-tag="SDK.Infobox">        <a class="infobox-close" href="javascript:void(0)" event:click="_onCloseClicked" event:touchstart="_onCloseClicked" style:display="{Binding showCloseButton Converter=boolToDisplay}" data-tag="SDK.Infobox.CloseBtn">            <img class="infobox-close-img" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE0cHgiIHdpZHRoPSIxNHB4IiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiPjxwYXRoIGQ9Ik03LDBDMy4xMzQsMCwwLDMuMTM0LDAsN2MwLDMuODY3LDMuMTM0LDcsNyw3YzMuODY3LDAsNy0zLjEzMyw3LTdDMTQsMy4xMzQsMTAuODY3LDAsNywweiBNMTAuNSw5LjVsLTEsMUw3LDhsLTIuNSwyLjVsLTEtMUw2LDdMMy41LDQuNWwxLTFMNyw2bDIuNS0yLjVsMSwxTDgsN0wxMC41LDkuNXoiLz48L3N2Zz4=" alt="close infobox" />        </a>        <div class="infobox-body">            <div class="infobox-title" data-tag="SDK.Infobox.Title">                <TextBlock Text="{Binding title}" />            </div>            <div class="infobox-info" data-tag="SDK.Infobox.Description" style:display="{Binding showDescription Converter=boolToDisplay}">            </div>            <div class="infobox-actions" style:display="{Binding actions Converter=boolToDisplay}" data-tag="SDK.Infobox.Actions">                <ul class="infobox-actions-list">                    <ItemsControl ItemsSource="{Binding actions}">                        <ItemsControl.ItemTemplate>                            <DataTemplate>                                <li>                                    <a href="javascript:void(0)" title="{Binding label}" event:click="eventHandler"  event:touchstart="eventHandler">                                        <TextBlock Text="{Binding label}" />                                    </a>                                </li>                            </DataTemplate>                        </ItemsControl.ItemTemplate>                    </ItemsControl>                </ul>            </div>        </div>        <div class="infobox-stalk" style:display="{Binding showPointer Converter=boolToDisplay}" data-tag="SDK.Infobox.Pointer">        </div>    </div>    <div class="InfoboxCustom" style:display="{Binding isCustom Converter=boolToDisplay}">        <div class="infobox-body">        </div>        <div class="infobox-stalk" style:display="{Binding showCustomPointer Converter=boolToDisplay}" data-tag="SDK.InfoboxCustom.Pointer">        </div>    </div></div>',this).applyDataTemplate(this),e={stopPropagation:!0},t=["mousemove","mousedown","mouseup","mousewheel","click","dblclick","contextmenu","touchmove","touchstart","touchend"],i=0;i<t.length;i++)this._registeredJsEvents[t[i]]=H._defineJSEventForDomEvent(this._control,t[i],e);this._clickHandler=function(e){o.click&&o.click.invoke({target:o,targetType:"infobox",eventName:"click",pageX:e.pageX,pageY:e.pageY,originalEvent:e})},this._control.add_event("click",this._clickHandler),this._mouseenterHandler=function(e){o.mouseenter&&o.mouseenter.invoke({target:o,targetType:"infobox",eventName:"mouseenter",pageX:e.pageX,pageY:e.pageY,originalEvent:e})},this._control.add_event("mouseenter",this._mouseenterHandler),this._mouseleaveHandler=function(e){o.mouseleave&&o.mouseleave.invoke({target:o,targetType:"infobox",eventName:"mouseleave",pageX:e.pageX,pageY:e.pageY,originalEvent:e})},this._control.add_event("mouseleave",this._mouseleaveHandler),this.setOverlayElement(this._control)}},Ue.prototype._onCloseClicked=function(){this.setOptions({visible:!1},!0)},Ue.prototype._changeAnchor=function(){var e,t=this._getInfoboxElement(),i=null;this._control.set_style({display:""});var o,n,s,r=t.select(".infobox-body").get_size(),a=r.height,l=r.width;this._control.set_style({display:this.boolToDisplay(this.getVisible())}),i=(i=(e=this._customInfobox?this._options.showCustomPointer:this._options.showPointer)?new Y(l/2,a+Ue._pointerHeight):new Y(0,a)).subtract(new Y(this._options.offset.x,-this._options.offset.y)),this._options.autoAlignment&&this._map&&l&&a&&(n=(o=this._map).getViewport(),s=o.getViewportPadding(),(r=o.getMode().tryLocationToPoint(this._options.location))&&((o=new Y(r.x-i.x,r.y-i.y)).x<s.left?o.x=s.left+Ue._padding:o.x+l>n.pixelWidth-s.right&&(o.x=n.pixelWidth-s.right-l-Ue._padding),o.y<s.top?(o.y=s.top+Ue._padding,e=!1):o.y+a>n.pixelHeight-s.bottom&&(o.y=n.pixelHeight-s.bottom-a-Ue._padding),i=new Y(r.x-o.x,r.y-o.y),o=(this._customInfobox?0:parseInt(t.get_style("border-radius"))||8)+Ue._pointerWidth/2,!e||i.x<o||i.x>l-o?t.select(".infobox-stalk").set_style({display:"none"}):t.select(".infobox-stalk").set_style({display:"",left:i.x-Ue._pointerWidth/2+"px"}))),this.setAnchor(i)},Ue.prototype._adjustInfoboxSize=function(){var e,t,i,o,n,s,r,a,l;this._control&&(l=(i=this._getInfoboxElement()).select(".infobox-body"),o=n=void 0,this._customInfobox?(this._control.set_style({display:""}),n=(a=l.get_size()).height,o=a.width):(e=i.select(".infobox-info"),l.set_style({maxWidth:this._options.maxWidth+"px",maxHeight:this._options.maxHeight+"px"}),this._control.set_style({display:""}),t=this._control.get_style("left"),this._control.set_style({left:"0px"}),l.set_style({width:""}),o=l.get_size().width,l.set_style({width:o}),n=l.get_size().height,s=parseInt(getComputedStyle(e[0],null).paddingTop.replace("px",""))||0,r=parseInt(getComputedStyle(e[0],null).paddingBottom.replace("px",""))||0,a=i.select(".infobox-title").get_size().height,l=i.select(".infobox-actions").get_size().height,a+e.get_size().height+l>n&&e.set_style({maxHeight:n-a-l-s-r+"px"}),this._control.set_style({left:t})),this._control.set_style({display:this.boolToDisplay(this.getVisible())}),i.select(".infobox-stalk").set_style({top:n-.2+"px",left:(o-Ue._pointerWidth)/2+"px"}),this._changeAnchor())},Ue.prototype._createCustomInfobox=function(){var e,t,i=this._options&&this._options.htmlContent;!i||(e=(t=this._control&&this._control.select(Ue._customInfoboxClass))&&t.select(".infobox-body"))&&0<e.length&&(e.clear(),(t=document.createElement("div")).innerHTML=i,e.append(t),this._customInfobox=!0,this.changed.invoke(new J(this,"htmlContent",void 0,i)))},Ue.prototype._createDescription=function(){var e,t=this._control&&this._getInfoboxElement();!t||(e=t.select(".infobox-info")[0])&&(e.innerHTML="",this._options.description&&((t=document.createElement("div")).innerHTML=this._options.description,e.appendChild(t)))},Ue.prototype._listenToMapChangedEvent=function(){var e=this,t=null;(t=this._map?this._map.getMapOptions():t)&&t.allowInfoboxOverflow&&(this._changeVisibilityDisposable=this._map.viewChanged.add(function(){e._visibleBeforeAnchorOutofBounds&&e._map.getBounds().contains(e.getLocation())&&(e.setOptions({visible:!0}),e._visibleBeforeAnchorOutofBounds=!1),e.getOptions().visible&&!e._map.getBounds().contains(e.getLocation())&&(e._visibleBeforeAnchorOutofBounds=!0,e.setOptions({visible:!1},!0))}))},Ue.prototype._invokeSetOptionsEvents=function(e){this.changed.invoke(new J(this,"options",this._options,e)),this._adjustInfoboxSize(),this.infoboxChanged&&this.infoboxChanged.invoke({target:this,targetType:"infobox",eventName:"infoboxChanged"})},Ue._pointerWidth=14,Ue._pointerHeight=16,Ue._defaultOptions={visible:!0,showCloseButton:!0,showPointer:!0,offset:new Y(0,0),maxHeight:126,maxWidth:256,zIndex:1002,closeDelayTime:0},Ue._padding=10,Ue._customInfoboxClass=".InfoboxCustom",Ue._infoboxClass=".Infobox",Ue),ve=(Ge.loadModule=function(e,t){function i(){0===--o&&s&&s()}var o,n,s,r,a,l,p,h,d,c=[];if("string"==typeof e?c.push(e):c=e,Ge._perfInstrument(c),o=c.length,"object"==typeof(s=t)&&(s=(t=t).callback,n=t.credentials||b.Credentials,r=t.errorCallback),n&&!ae.instance&&new ae(n,!0),Ge.container)for(a=0,l=c.length;a<l;a++)if(p=Ge._supportedModules[c[a]])if(p.isLoaded){for(i(),h=0,d=p.pendingCallbacks.length;h<d;h++)p.pendingCallbacks[h]();p.pendingCallbacks=[]}else p.dragonflyObjectName?Ge._createInstance(c[a],p,i,r):p.pendingCallbacks.push(i);else r&&r(c[a]+" is not a supported module.")},Ge.registerModule=function(e,t,i){var o,n,s,r;if(e&&t&&(Ge._supportedModules[e]={isLoaded:!1,pendingCallbacks:[]},o=document.getElementsByTagName("head")[0],(e=document.createElement("script")).type="text/javascript",e.src=t,o.appendChild(e),i&&i.styleURLs))for(n=0,s=i.styleURLs.length;n<s;n++)(r=document.createElement("link")).rel="stylesheet",r.href=i.styleURLs[n],o.appendChild(r)},Ge.moduleLoaded=function(e){var t,i,o;if(e){for((t=Ge._supportedModules[e]).isLoaded=!0,i=0,o=t.pendingCallbacks.length;i<o;i++)t.pendingCallbacks[i]();t.pendingCallbacks=[]}},Ge._createInstance=function(i,o,n,s){Ge.container.instanceAsync(o.dragonflyObjectName,function(){Ge._instrumentModuleCreation(i),o.isLoaded=!0,n();for(var e=0,t=o.pendingCallbacks.length;e<t;e++)o.pendingCallbacks[e]();o.pendingCallbacks=[]},null,null,function(e,t){b.Internal._Debug.log(null,"Factory:{0}, Message: {1}",e,t),s&&s(i+" failed to load.")})},Ge._instrumentModuleCreation=function(e){Microsoft&&Microsoft.Maps&&Microsoft.Maps.logger&&Microsoft.Maps.GlobalConfig.enableInstrumentation&&(e={feature:E.SDK,action:"ModuleLoaded",data:{moduleName:e}},Microsoft.Maps.logger.logObject(e,null,!0))},Ge._perfInstrument=function(e){for(var t,i=0;i<e.length;i++)(t=Ge._supportedModules[e[i]]&&Ge._supportedModules[e[i]].perfLoggingKey)&&K.setStartTime(t,null,!0)},Ge._supportedModules={"Microsoft.Maps.DrawingTools":{dragonflyObjectName:"DrawingToolsModule",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.WellKnownText":{dragonflyObjectName:"WellKnownText",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.GeoJson":{dragonflyObjectName:"GeoJson",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.GeoXml":{dragonflyObjectName:"GeoXml",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.SpatialDataService":{dragonflyObjectName:"GeoDataAPIManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.AutoSuggest":{dragonflyObjectName:"AutosuggestManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.HeatMap":{dragonflyObjectName:"HeatMapLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Clustering":{dragonflyObjectName:"ClusterLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.SpatialMath":{dragonflyObjectName:"SpatialMath",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Search":{dragonflyObjectName:"SearchManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Traffic":{dragonflyObjectName:"TrafficManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Directions":{dragonflyObjectName:"DirectionsManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.DataBinning":{dragonflyObjectName:"DataBinningLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Contour":{dragonflyObjectName:"ContourLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Isochrone":{dragonflyObjectName:"IsochroneLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.VenueMaps":{dragonflyObjectName:"VenueMapsModule",isLoaded:!1,pendingCallbacks:[],perfLoggingKey:"Maps_VMTTG"},"Microsoft.Maps.ConfigurableMap":{dragonflyObjectName:"ConfigurableMap",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Choropleth":{dragonflyObjectName:"ChoroplethLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.CloudGraphDataManager.ItineraryDataManager":{dragonflyObjectName:"ItineraryDataManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.CloudGraphDataManager.AutoCollectionGenerator":{dragonflyObjectName:"AutoCollectionGenerator",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.CloudGraphDataManager.SaveDropdownControl":{dragonflyObjectName:"SaveDropdownControl",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.CloudGraphDataManager.NewCollectionControl":{dragonflyObjectName:"NewCollectionControl",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.AdvancedShapes":{dragonflyObjectName:"",isLoaded:!0,pendingCallbacks:[]},"Microsoft.Maps.Themes.BingTheme":{dragonflyObjectName:"",isLoaded:!0,pendingCallbacks:[]},"Microsoft.Maps.Overlays.Style":{dragonflyObjectName:"",isLoaded:!0,pendingCallbacks:[]}},Ge);(e=oe=oe||{})[e.control=0]="control",e[e.page=1]="page",e[e.viewport=2]="viewport";var be=(We.encode=function(e){for(var t,i=0,o=0,n=[],s=0,r=e.length;s<r;s++)for(var a=Math.round(1e5*e[s].latitude),l=Math.round(1e5*e[s].longitude),p=a-i,h=l-o,i=a,o=l,d=((p=p<<1^p>>31)+(h=h<<1^h>>31))*(p+h+1)/2+p;0<d;)0<(d=(d-(t=31&d))/32)&&(t+=32),n.push(We._lookUpTable[t]);return n.join("")},We.decode=function(e){for(var t,i,o,n,s,r=[],a=0,l=0,p=0,h=e.length;a<h;){for(i=t=0;;){if(h<=a||-1===(o=We._lookUpTable.indexOf(e[a++])))return null;if(t+=(31&o)*Math.pow(2,i),i+=5,o<32)break}t-=(s=Math.floor((Math.sqrt(8*t+5)-1)/2))*(s+1)/2,n=1e-5*(p+=t>>1^-(1&t)),s=1e-5*(l+=(s=s-t)>>1^-(1&s)),n=Math.max(-85,Math.min(85,n)),s=Math.max(-180,Math.min(180,s)),r.push(new N(n,s))}return r},We._lookUpTable="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",We),Me=(je.prototype.dispose=function(){var e,t,i,o=this;if(this._sdkmap){for(t=0,i=(e=Object.keys(this._layerEventTracker)).length;t<i;t++)H._clearDisposables(this._layerEventTracker[e[t]]);L(this._sdkmap.getRootElement()).select("."+je._primitiveTabElementClass).for_each(function(e){o._removeAndUnregisterTabElement(L(e))}),H._clearDisposables(this._disposables),H._nullifyClass(this)}},je.prototype._onLayersChanged=function(e){e.added&&0<e.added.length&&this._processAddedLayers(e.added),e.removed&&0<e.removed.length&&this._processRemovedLayers(e.removed)},je.prototype._processAddedLayers=function(e){var t,i,o,n,s=this;if(e)for(t=0;t<e.length;t++)(i=e[t])instanceof ce&&i.getVisible()&&(o=i.getId(),n=[i.invalidated.add(function(e){s._onLayerUpdated(i,e)}),i.changed.add(function(e){s._onLayerUpdated(i,e)})],this._layerEventTracker[o]=n,this._addVisiblePrimitivesOnLayer(i))},je.prototype._processRemovedLayers=function(e){for(var t,i,o=0;o<e.length;o++)(t=e[o])instanceof ce&&(i=t.getId(),this._layerEventTracker[i]&&(H._clearDisposables(this._layerEventTracker[i]),this._layerEventTracker[i]=null),this._removeElementsForLayer(t,!0))},je.prototype._addVisiblePrimitivesOnLayer=function(t){var i=this;t.getVisible()&&t.getPrimitives(null,function(e){i._addElements(t,e.primitives)})},je.prototype._addElements=function(e,t){var i,o,n,s,r,a;if(t&&0<t.length)for(i=this._sdkmap.getRootElement(),o=e.getId(),n=0;n<t.length;n++)t[n]instanceof Ce&&(s=L(document.createElement("div")),a=(r=t[n]).entity.id,0===i.querySelectorAll("["+je._layerIdAttribute+"='"+o+"']["+je._primitiveIdAttribute+"='"+a+"']").length&&(s.set_attr(je._layerIdAttribute,o),s.set_attr(je._primitiveIdAttribute,a),s.set_attr("tabindex","0"),s.set_attr("class",je._primitiveTabElementClass),s.set_style({height:0,width:0}),L(s).add_event("focus",this._onPrimitiveFocus).add_event("blur",this._onPrimitiveBlur).add_event("keypress",this._onPrimitiveKeyPress),a=[],r.getTitle()&&a.push(r.getTitle()),r.getSubTitle()&&a.push(r.getSubTitle()),0<a.length&&s.set_attr("aria-label",a.join(";")),r.getAriaHaspopup()&&s.set_attr("aria-haspopup","true"),r.isTapEnabled()&&s.set_attr("role","button"),i.appendChild(s[0])))},je.prototype._findPushpin=function(e,t){for(var i,o,n,s=[this._sdkmap.entities].concat(this._sdkmap.layers.slice()),r=null,a=0;a<s.length;a++)if(s[a].getId()===e){for(i=s[a].getPrimitives(),o=0;o<i.length;o++)if((n=i[o])instanceof Ce&&n.entity&&n.entity.id===t){r=n;break}break}return r},je.prototype._removeAndUnregisterTabElement=function(e){e.remove_event("focus",this._onPrimitiveFocus).remove_event("blur",this._onPrimitiveBlur).remove_event("keypress",this._onPrimitiveKeyPress),e.removeFromParent()},je.prototype._removeElementsForLayer=function(e,t){var i,o=t||!e.getVisible(),t=e.getId(),e=e.getPrimitives(),n=[];e.forEach(function(e){e instanceof Ce&&e.getVisible()&&e.entity&&n.push(e.entity.id)});for(var s=this._sdkmap.getRootElement().querySelectorAll("["+je._layerIdAttribute+"='"+t+"']"),r=0;r<s.length;r++)i=L(s[r]),!o&&-1!==n.indexOf(i.get_attr(je._primitiveIdAttribute))||this._removeAndUnregisterTabElement(i)},je.prototype._onLayerUpdated=function(e){this._removeElementsForLayer(e,!1),this._addVisiblePrimitivesOnLayer(e)},je._layerIdAttribute="data-layerid",je._primitiveIdAttribute="data-pid",je._primitiveTabElementClass="primitiveTabs",je),Ce=(le(Fe,a=ee),Fe.prototype.getAnchor=function(){return this.anchor?new Y(this.anchor.x,this.anchor.y):null},Fe.prototype.getDraggable=function(){return this._options.draggable},Fe.prototype.getHoverStyleEnabled=function(){return this._options.enableHoverStyle},Fe.prototype.getClickedStyleEnabled=function(){return this._options.enableClickedStyle},Fe.prototype.getColor=function(){return this._options.color},Fe.prototype.getIcon=function(){return this._options.icon},Fe.prototype.hasVectorIcon=function(){return this._options.icon&&this._options.icon.hasOwnProperty("vectorType")},Fe.prototype.getRoundClickableArea=function(){return this._options.roundClickableArea},Fe.prototype.getText=function(){return this._options.text},Fe.prototype.getTextOffset=function(){return this._options.textOffset},Fe.prototype.getTitle=function(){return this._options.title},Fe.prototype.getSubTitle=function(){return this._options.subTitle},Fe.prototype.getVisible=function(){return this._options.visible},Fe.prototype.getAriaHaspopup=function(){return this._options.ariaHaspopup},Fe.prototype.setLocation=function(e,t){var i=new J(this,"location",this.getLocation(),e);a.prototype.setLocation.call(this,e),t&&this.changing&&this.changing.hasHandlersRegistered()?this.changing.invoke(i):this.changed&&this.changed.invoke(i)},Fe.prototype.setOptions=function(e,t){var i,o=this._options,n={};n.visible=("boolean"==typeof e.visible?e:o).visible,n.draggable=("boolean"==typeof e.draggable?e:o).draggable,n.icon=e.icon||o.icon,n.iconSize=e.iconSize||o.iconSize,n.anchor=e.anchor||o.anchor,this.anchor=n.anchor?new C(n.anchor.x,n.anchor.y):null,n.title=("string"==typeof e.title?e:o).title,this.entity.title=n.title,n.subTitle=("string"==typeof e.subTitle?e:o).subTitle,this.entity.subtitle=n.subTitle,n.text=("string"==typeof e.text?e:o).text,this.entity.iconText=n.text,n.textOffset=e.textOffset||o.textOffset,n.enableHoverStyle=("boolean"==typeof e.enableHoverStyle?e:o).enableHoverStyle,n.enableClickedStyle=("boolean"==typeof e.enableClickedStyle?e:o).enableClickedStyle,n.ariaHaspopup=("boolean"==typeof e.ariaHaspopup?e:o).ariaHaspopup,n.color=e.color||o.color,n.cursor=e.cursor||o.cursor,n.roundClickableArea=("boolean"==typeof e.roundClickableArea?e:o).roundClickableArea,e.hasOwnProperty("stylesheetEntry")&&(this.stylesheetEntry=n.stylesheetEntry=e.stylesheetEntry),e.hasOwnProperty("stylesheetEntryState")&&(this.stylesheetEntryState=n.stylesheetEntryState=e.stylesheetEntryState),this.catId=n.catId=("string"==typeof e.catId?e:this).catId,this.groupCatId=n.groupCatId=("string"==typeof e.groupCatId?e:this).groupCatId,this.isMicroPoi=n.isMicroPoi=("boolean"==typeof e.isMicroPoi?e:o).isMicroPoi,i=e.bucket||o.bucket,this.isMicroPoi&&i===Fe.defaultPushpinBucketId?i=S.microPoiBucket:this.isMicroPoi||i!==S.microPoiBucket||(i=Fe.defaultPushpinBucketId),this.entity.collisionBehavior=this.isMicroPoi?1:2,this.bucket=n.bucket=i,this._options=n,(e.icon||e.color||e.text||e.iconSize)&&!this.hasVectorIcon()&&this._setImage(n.icon,n.iconSize),this.revision++,this._updateDefaultStyle(),t||this.changed&&this.changed.invoke(new J(this,"options",o,n))},Fe.prototype.getCursor=function(){return this._options.cursor},Fe.prototype.dispose=function(){H._clearDisposables([this._clickedStyleDisposable,this._hoverStartStyleDisposable,this._hoverEndStyleDisposable]),H._disposeEvents(this),a.prototype.dispose.call(this)},Fe.prototype.loadImage=function(){this.image||this.hasVectorIcon()||this._setImage(this._options.icon,this._options.iconSize)},Fe.prototype._setImage=function(e,o){var t,n,s,r,i,a,l=this,p=this.getColor();p instanceof ye&&(p=p.toRgba()),"string"==typeof e&&/<svg/i.test(e)&&!/^data:/i.test(e)&&(this.hasSvgText=0<=e.indexOf("{text}"),t=unescape(encodeURIComponent(this.getText())),t=e.replace(/{color}/g,p||"").replace(/{text}/g,t||""),e="data:image/svg+xml;base64,"+window.btoa(t)),this.image=e,this.imageSize=o,n=function(e,t){l.changed&&l.changed.invoke(new J(l,"image",e,t))},"string"==typeof this.image&&(s=document.createElement("img"),r=!!this.anchor,i=function(e){var t,i;s.onload=null,window.clearTimeout(a),e?(o?(s.height=o.height||0,s.width=o.width||0):L.Browser.is_ie&&(s.style.visibility="hidden",(t=document.createElement("div")).style.display="block",t.appendChild(s),document.body.appendChild(t),e=s.height,i=s.width,document.body.removeChild(t),s.height=e,s.width=i),r||l.setOptions({anchor:new C(s.width/2,s.height)}),n(null,l.image)):(i=l.image,l.image=null,n(i,l.image))},a=Microsoft.Maps.setTimeout(function(){return i(!1)},5e3),s.onload=function(){i(!0)},s.src=this.image,this.image=s)},Fe.prototype.isTapEnabled=function(){return this._hasTapEvents()||this._layerHasTapEvents()},Fe.prototype.isDoubleTapEnabled=function(){return this._hasDoubleTapEvents()||this._layerHasDoubleTapEvents()},Fe.prototype.isHoverEnabled=function(){return this._hasHoverEvents()||this._layerHasHoverEvents()||this.isTapEnabled()||this.isDoubleTapEnabled()||this.getDraggable()},Fe.prototype.isMoveEnabled=function(){return this._options.draggable},Fe.prototype._hasHoverEvents=function(){return this.getHoverStyleEnabled()||this.mouseover&&this.mouseover.hasHandlersRegistered()||this.mouseout&&this.mouseout.hasHandlersRegistered()},Fe.prototype._hasTapEvents=function(){return this.getClickedStyleEnabled()||this.click&&this.click.hasHandlersRegistered()||this.mouseup&&this.mouseup.hasHandlersRegistered()||this.mousedown&&this.mousedown.hasHandlersRegistered()},Fe.prototype._hasDoubleTapEvents=function(){return this.dblclick&&this.dblclick.hasHandlersRegistered()},Fe.prototype._layerHasHoverEvents=function(){var e=this.layer;return e&&(e.primitiveHoverStarted&&e.primitiveHoverStarted.hasHandlersRegistered()||e.primitiveHoverStopped&&e.primitiveHoverStopped.hasHandlersRegistered())},Fe.prototype._layerHasTapEvents=function(){var e=this.layer;return e&&(e.primitiveTapped&&e.primitiveTapped.hasHandlersRegistered()||e.primitivePointerPressed&&e.primitivePointerPressed.hasHandlersRegistered())},Fe.prototype._layerHasDoubleTapEvents=function(){var e=this.layer;return e&&e.primitiveDoubleTapped&&e.primitiveDoubleTapped.hasHandlersRegistered()},Fe.prototype.hasInternalId=function(){return!!(this.entity&&this.entity.id&&/^Pushpin_[1-9]([0-9])*$/i.test(this.entity.id))},Fe.prototype.getState=function(){return this._state},Fe.prototype.setState=function(e){var t;this._state!==e&&(t=this._state,4===(this._state=e)&&this.bucket===Fe.defaultPushpinBucketId?this.bucket=Fe.defaultClickedPushpinBucketId:4!==e&&this.bucket===Fe.defaultClickedPushpinBucketId&&(this.bucket=Fe.defaultPushpinBucketId),this.changed&&this.changed.invoke(new J(this,"state",t,e)))},Fe.prototype._updateDefaultStyle=function(){var e=this;!0!==this._options.enableClickedStyle||this._clickedStyleDisposable?!1===this._options.enableClickedStyle&&(this._clickedStyleDisposable&&(this._clickedStyleDisposable.dispose(),this._clickedStyleDisposable=null),this.setState(2)):(this.click||(this.click=new A),this._clickedStyleDisposable=this.click.add(function(){e._updateClickedStyle()})),!0!==this._options.enableHoverStyle||this._hoverStartStyleDisposable||this._hoverStartStyleDisposable?!1===this._options.enableHoverStyle&&(this._hoverStartStyleDisposable&&(this._hoverStartStyleDisposable.dispose(),this._hoverStartStyleDisposable=null),this._hoverEndStyleDisposable&&(this._hoverEndStyleDisposable.dispose(),this._hoverEndStyleDisposable=null),this.setState(2)):(this.mouseover||(this.mouseover=new A),this.mouseout||(this.mouseout=new A),this._hoverStartStyleDisposable=this.mouseover.add(function(){e._updateHoverStartStyle()}),this._hoverEndStyleDisposable=this.mouseout.add(function(){e._updateHoverStoppedStyle()}))},Fe.prototype._updateClickedStyle=function(){4===this.getState()?(this.setState(2),this.getHoverStyleEnabled()&&this._updateHoverStartStyle()):this.setState(4)},Fe.prototype._updateHoverStartStyle=function(){2===this.getState()&&this.setState(3)},Fe.prototype._updateHoverStoppedStyle=function(){3===this.getState()&&this.setState(2)},Fe._pushpinId=1,Fe._defaultOptions={anchor:null,draggable:!1,icon:null,visible:!0,title:null,subTitle:null,enableHoverStyle:!1,enableClickedStyle:!1,text:null,textOffset:new Y(0,5),color:null,cursor:"pointer",roundClickableArea:!1},Fe.defaultPushpinBucketId="999999",Fe.defaultClickedPushpinBucketId="999998",Fe),ke=(Ne.prototype._raiseViewChangeStartEvent=function(e){this._viewChangeStartInvoked||(this._viewChangeStartInvoked=!0,this.viewchangestart.invoke(e)),window.clearTimeout(this._viewChangeStartInitializationTimer),window.clearTimeout(this._viewChangeEndTimer)},Ne.prototype._raiseViewChangeEvent=function(e){this._viewChangeStartInvoked&&this.viewchange.invoke(e)},Ne.prototype._raiseViewChangeEndEvent=function(e){var t=this;0<this._options.viewChangeEndDelay?this._viewChangeEndTimer=b.setTimeout(function(){t._viewChangeStartInvoked=!1,t.viewchangeend.invoke(e)},this._options.viewChangeEndDelay):(this._viewChangeStartInvoked=!1,this.viewchangeend.invoke(e)),window.clearTimeout(this._viewChangeEndInitializationTimer)},Ne.prototype._raiseViewRenderedEvent=function(e){var t=this;setTimeout(function(){t.viewrendered.invoke(e)},0)},Ne.prototype._onLayersChanged=function(e){var t,i,o,n;if(this._v8Map){var s=this._v8Map.getLayers(),r=[],a=[],l=-1;if(e.added?(-1===l&&(l=e.addedIndex),r.push.apply(r,e.added)):e.removed&&a.push.apply(a,e.removed),0<r.length){for(t=[],o=0,n=r.length;o<n;o++)(i=r[o])instanceof V&&(i.getTemplateSelector()||i.setTemplateSelector(this._templateSelector),i instanceof Le&&i.setOptions({enableCORS:this._v8Map.getMapOptions().enableCORS}),t.push(i));for(s.insertAll(t,l),o=0,n=r.length;o<n;o++)(r[o].attachMap||r[o].attachMap)&&r[o].attachMap(this)}if(0<a.length)for(o=0,n=a.length;o<n;o++)a[o].detachMap?a[o].detachMap(this):s.remove(a[o])}},Ne.prototype._onOverlayManagerLoaded=function(){this._mapHasLoaded=!0,this._mapLoaded.invoke()},Ne.prototype.blur=function(){throw new Error("Not implemented")},Ne.prototype.dispose=function(){var e,t;for(this._rootElement&&this._rootElement[0]&&delete this._rootElement[0].$map,this._v8Map&&this._v8Map.dispose(),e=0;e<this.layers.length;e++)(t=this.layers[e]).pause&&t.pause(),t.dispose&&t.dispose(!0);this.layers.clear(),H._clearDisposables(this._disposables),this._accessibilityManager&&this._accessibilityManager.dispose(),this._sdkSearchBar&&this._sdkSearchBar.dispose(),this.entities.dispose(!0),this._rootElement&&this._rootElement.clear(),this._rootElement=null,this._templateSelector=null,this._v8Map=null},Ne.prototype.focus=function(){throw new Error("Not implemented")},Ne.prototype.getBounds=function(){return z.getMapBounds(this._v8Map)},Ne.prototype.getCenter=function(){return z.getMapCenter(this._v8Map)},Ne.prototype.getCopyrights=function(e){var t=this._v8Map.getCopyrightControl(),t=t&&t.copyrightProviders;e&&e(t)},Ne.prototype.getCredentials=function(t){ae.instance.authenticateClientAndRetrieveSessionId(function(e){t&&t(e)})},Ne.prototype.getHeight=function(){return this._v8Map.getActualSize().height},Ne.prototype.getHeading=function(){return this._v8Map.getView().heading},Ne.prototype.getPitch=function(){return this._v8Map.getView().pitch},Ne.prototype.getImageryId=function(){return{r:"Road",a:"Aerial",be:"Birdseye",x:"Streetside",m:"Mercator",os:"Ordnance Survey",wd:"Canvas Dark",wl:"Canvas Light",cg:"Grayscale"}[this.getMapTypeId()]},Ne.prototype.getMapTypeId=function(){var e=this._v8Map.getMapType().id;return e=e===re.birdseyeV2?re.birdseye:e},Ne.prototype.getMapTypes=function(){for(var e,t=this.getV8Map().getMapTypes(),i=[],o=0;o<t.length;o++)e=t[o].id,i.push(e="be2"===e?"be":e);return i},Ne.prototype.getMetersPerPixel=function(){return se.toScale(z.getMapCenter(this._v8Map),z.getMercatorZoomLevel(this._v8Map),!0)},Ne.prototype.getMode=function(){return this._v8Map.getMode()},Ne.prototype.getOptions=function(){return this._options},Ne.prototype.getPageX=function(){return this._rootElement.get_absolute_pos().x},Ne.prototype.getPageY=function(){return this._rootElement.get_absolute_pos().y},Ne.prototype.getRootElement=function(){return this._rootElement[0]},Ne.prototype.getWidth=function(){return this._v8Map.getActualSize().width},Ne.prototype.getZoom=function(){return this._v8Map.getMercatorZoomLevel()},Ne.prototype.getZoomRange=function(){var e=this._v8Map.getMapType();return{min:this._options.minZoom?Math.max(e.minZoom,this._options.minZoom):e.minZoom,max:this._options.maxZoom?Math.min(e.maxZoom,this._options.maxZoom):e.maxZoom}},Ne.prototype.isMercator=function(){return 0===this._v8Map.getMode().mapModeType&&this._v8Map.getMapType().id!==re.birdseye},Ne.prototype.isRotationEnabled=function(){var e=this._v8Map.getMapType().id;return e===re.birdseye||e===re.birdseyeV2},Ne.prototype.setMapType=function(e){var t,i=this;if(e===re.birdseye&&(e=re.birdseyeV2),this._mapLoaded.isPreviouslyInvoked){if((this._options.mapTypeId=e)===re.streetside)this._v8Map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(e){var t=i._options.streetsideOptions||{};t.heading=i._options.heading,t.pitch=i._options.pitch,e.show(t.panoramaInfo||N.cloneFrom(i._v8Map.getView().cameraLocation),t)});else if(e!==re.birdseye||!this._v8Map.getMapOptions().disableBirdseye){if(this._v8Map.navigationBarLoaded.addOne(function(){return i._v8Map.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(e)},!1,!0),!(t=this._v8Map.getMapTypes()[e]))throw new Error("Invalid map type id"+e);this._v8Map.setBaseLayers(t),0!==this._v8Map.getMode().mapModeType&&this._v8Map.getContainer().instanceAsync("CompositeMapMode",function(e){i._v8Map.setMode(e)})}}else this._mapLoaded.addOne(function(){i.setMapType(e)})},Ne.prototype.setOptions=function(e){this._saveMapOptions(e),this._v8Map.setMinZoom(e.minZoom),this._v8Map.setMaxZoom(e.maxZoom),e.maxBounds&&this._v8Map.setMaxBounds(e.maxBounds),this._v8Map.mapOptionsChanged.invoke(this._options)},Ne.prototype.setView=function(e){var t,i,o=this;this._processViewOptions(e),t=this.getMapTypeId(),i=e.animate,e.animate=this._options.animate,this._saveMapOptions(e),e.animate="boolean"==typeof i?i:this._options.animate,e.mapTypeId&&t!==e.mapTypeId?t===re.streetside?(this._v8Map.mapModeChanged.addOne(function(){o._setViewInternal(e,t)}),this.setMapType(e.mapTypeId)):(this.setMapType(e.mapTypeId),this._setViewInternal(e,t)):this._setViewInternal(e,t)},Ne.prototype._setViewInternal=function(t,e){var i,o,n,s,r,a,l,p=this;if(this.getMapTypeId()!==re.streetside){if(i=this._v8Map.getView(),t.bounds){this._options.constrainBirdseyeView&&((r=this._v8Map.getMode().getCurrentCrs()).reset&&r.reset()),n=t.bounds,s="number"==typeof t.padding&&0<t.padding?t.padding:0;try{o=2*s<=Math.min(this.getHeight(),this.getWidth())?this._v8Map.getMode().getMapViewWithBounds(n,{top:s,right:s,bottom:s,left:s}):z.constructView(this._v8Map,n.center,8),this._v8Map.setView(o,Ne._constructAnimator(t,i,o))}catch(e){o=z.constructView(this._v8Map,n.center,8),this._v8Map.setView(o,Ne._constructAnimator(t,i,o))}}else(t.center||"number"==typeof t.zoom||t.center&&t.centerOffset)&&((t.center||t.centerOffset)&&this._options.constrainBirdseyeView&&((r=this._v8Map.getMode().getCurrentCrs()).reset&&r.reset()),r=this._computeMapCenterAfterOffset(t)||i.cameraLocation,o=z.constructView(this._v8Map,r,Math.round("number"==typeof t.zoom?t.zoom:this.getZoom())),this._v8Map.setView(o,Ne._constructAnimator(t,i,o)));"number"==typeof t.labelOverlay&&(a=t.mapTypeId||this.getMapTypeId(),l=function(){var e=t.labelOverlay===R.visible||a===re.road&&!p._options.allowHidingLabelsOfRoad;p._v8Map.getLabelController().setIsLabelsEnabled(e),p._v8Map.getMapOptions().labelOptions.labelVisibility=t.labelOverlay,a!==re.birdseyeV2&&a!==re.birdseye||p._updateBEv2LabelToggle(e)},this._v8Map.labelControllerLoaded.addOne(function(){l()},!1,!0)),"number"!=typeof t.heading||t.mapTypeId!==re.birdseye&&t.mapTypeId!==re.birdseyeV2&&(t.mapTypeId||e!==re.birdseye&&e!==re.birdseyeV2)||(e=w.normalizeHeading(t.heading),(o=i.clone()).heading=e,(e=t.center)&&(o.cameraLocation.latitude=e.latitude,o.cameraLocation.longitude=e.longitude),this._v8Map.setView(o,Ne._constructAnimator(t,i,o)))}this._v8Map.setViewInvoked.invoke(t)},Ne.prototype._updateBEv2LabelToggle=function(t){var i=this;this._v8Map.navigationBarLoaded.addOne(function(){var e=i._v8Map.getNavigationBar().getHelper();e.setLabelVisible(t),e.updateLabelToggleForBirdseyeV2()},!1,!0)},Ne._constructAnimator=function(e,t,i){var o=null;return o=e&&e.animate&&t&&i?new j(t,i):o},Ne.prototype.tryLocationToPixel=function(e,t){var i,o,n;if(e instanceof N)return this._trySingleLocationToPoint(e,t);if(e.length){for(i=[],o=0;o<e.length;o++){if(!(n=this._trySingleLocationToPoint(e[o],t)))return null;i.push(n)}return i}},Ne.prototype.tryPixelToLocation=function(e,t){var i,o,n;if(e instanceof Y)return this._trySinglePointToLocation(e,t);if(e.length){for(i=[],o=0;o<e.length;o++){if(!(n=this._trySinglePointToLocation(e[o],t)))return null;i.push(n)}return i}},Ne.prototype.panTo=function(){throw new Error("Not implemented")},Ne.prototype.getStreetSide=function(){throw new Error("Not implemented")},Ne.prototype.setStreetSide=function(){throw new Error("Not implemented")},Ne.prototype.getUserRegion=function(){return b.GlobalConfig.dynamicProperties.userRegion},Ne.prototype.getCulture=function(){return b.GlobalConfig.dynamicProperties.market},Ne.prototype.getReleaseType=function(){throw new Error("Not implemented")},Ne.prototype.getImage=function(){throw new Error("Not implemented")},Ne.getIsBirdseyeAvailable=function(e,t,i,o){b.BirdseyeV2Manager.getIsBirdseyeV2Available(b.Internal._CoreConfig(),e,t,i,o)},Ne.prototype.getMapLoadedEvent=function(){return this._mapLoaded},Ne.prototype.getV8Map=function(){return this._v8Map},Ne.prototype._trySingleLocationToPoint=function(e,t){var i,e=this._v8Map.getMode().tryLocationToPoint(e);if(e){switch(i=null,t="number"==typeof t?t:oe.viewport){case oe.control:i=new Y(0,0);break;case oe.page:i=this._rootElement.get_absolute_pos();break;default:oe.viewport;(i=this._v8Map.getMode().tryLocationToPoint(this._v8Map.getView().cameraLocation)).x*=-1,i.y*=-1}return e=e.add(i),isNaN(e.x)||isNaN(e.y)?null:e}return null},Ne.prototype._trySinglePointToLocation=function(e,t){var i,o,n;if(isNaN(e.x)||isNaN(e.y))return null;switch(t="number"==typeof t?t:oe.viewport,e=e.clone(),t){case oe.control:break;case oe.page:i=this._rootElement.get_absolute_pos(),e.x-=i.x,e.y-=i.y;break;default:oe.viewport;i=this._v8Map.getActualSize(),e.x+=i.width/2,e.y+=i.height/2}try{((n=(o=this._v8Map.getMode().tryPointToLocation(e)).longitude)<-180||180<n)&&(o.longitude=N.normalizeLongitude(n))}catch(e){return null}return o},Ne.prototype._saveMapOptions=function(e){!function e(t,i,o){for(var n,s,r=0,a=Object.keys(i);r<a.length;r++)(s=i[n=a[r]])&&"object"==typeof s&&o[n]?(t[n]||(t[n]={}),e(t[n],s,{})):t[n]=s}(this._options,e,{streetsideOptions:!0}),this._toggleAccessibilityManager(e.pushpinAccessible),this._toggleSDKSearchBar(e.showSearchBar)},Ne.prototype._toggleAccessibilityManager=function(e){this._v8Map&&(e?this._accessibilityManager||(this._accessibilityManager=new Me(this)):this._accessibilityManager&&(this._accessibilityManager.dispose(),this._accessibilityManager=null))},Ne.prototype._toggleSDKSearchBar=function(e){this._v8Map&&(e?this._sdkSearchBar||(this._sdkSearchBar=new Ee(this)):this._sdkSearchBar&&(this._sdkSearchBar.dispose(),this._sdkSearchBar=null))},Ne.prototype._computeMapCenterAfterOffset=function(e){var t,i=e.center;return i&&e.centerOffset&&((t=this.tryLocationToPixel(i))&&(e=new Y("number"==typeof e.centerOffset.x?e.centerOffset.x:0,"number"==typeof e.centerOffset.y?e.centerOffset.y:0),t=t.subtract(e),i=this.tryPixelToLocation(t))),i},Ne.prototype._processViewOptions=function(e){var t;"number"==typeof e.heading&&(e.heading=(e.heading%360+360)%360),"number"==typeof e.pitch&&(t=e.pitch,e.pitch=Math.max(Math.min(t,90),-90))},Ne),Se=(le(Ve,r=q),Ve.prototype.getFillColor=function(){return this._options.fillColor},Ve.prototype.getLocations=function(){var e=this.getRings();return 0<e.length?e[0]:[]},Ve.prototype.getStrokeColor=function(){return this._options.strokeColor},Ve.prototype.getStrokeDashArray=function(){return this._options.strokeDashArray},Ve.prototype.getStrokeThickness=function(){return this._options.strokeThickness},Ve.prototype.getTitle=function(){return this._options.title},Ve.prototype.getVisible=function(){return this._options.visible},Ve.prototype.setLocations=function(e){this.setRings([e])},Ve.prototype.getState=function(){return this._state},Ve.prototype.setState=function(e){var t;this._state!==e&&(t=this._state,this._state=e,this.changed&&this.changed.invoke(new J(this,"state",t,e)))},Ve.prototype.setOptions=function(e){var t,i,o=this._options,n={},s=this.getTemplate().getStyle();if(n.strokeThickness=("number"==typeof e.strokeThickness?e:o).strokeThickness,"number"==typeof e.strokeThickness&&(s.lineWidth=e.strokeThickness),n.strokeColor=e.strokeColor||o.strokeColor,e.strokeColor&&(s.strokeStyle=we(e.strokeColor)),n.strokeDashArray=e.strokeDashArray||o.strokeDashArray,e.strokeDashArray&&(s.dashes=xe(e.strokeDashArray)),n.secondaryStrokeThickness=("number"==typeof e.secondaryStrokeThickness?e:o).secondaryStrokeThickness,"number"==typeof e.secondaryStrokeThickness&&(s.secondaryLineWidth=e.secondaryStrokeThickness),n.secondaryStrokeColor=e.secondaryStrokeColor||o.secondaryStrokeColor,e.secondaryStrokeColor&&(s.secondaryStrokeStyle=we(e.secondaryStrokeColor)),n.fillColor=e.fillColor||o.fillColor,e.fillColor&&(s.fillStyle=we(e.fillColor)),n.visible=("boolean"==typeof e.visible?e:o).visible,n.generalizable=("boolean"==typeof e.generalizable?e:o).generalizable,n.generalizable!==o.generalizable)for(t=this.geometry.rings,i=0;i<t.length;i++)t[i].generalizable=n.generalizable,t[i].generalizations=null;n.cursor=e.cursor||o.cursor,n.title=(void 0!==e.title?e:o).title,this.entity.title=n.title,e.hasOwnProperty("stylesheetEntry")&&(this.stylesheetEntry=n.stylesheetEntry=e.stylesheetEntry),e.hasOwnProperty("stylesheetEntryState")&&(this.stylesheetEntryState=n.stylesheetEntryState=e.stylesheetEntryState),this._options=n,this.changed&&this.changed.invoke(new J(this,"options",o,n))},Ve.prototype.setRings=function(e){var t=this.getRings();r.prototype.setRings.call(this,e,this._options.generalizable),this.changed&&this.changed.invoke(new J(this,"rings",t,e))},Ve.prototype.toString=function(){throw new Error("Not implemented")},Ve.prototype.getCursor=function(){return this._options.cursor},Ve.prototype.getGeneralizable=function(){return this._options.generalizable},Ve.getDefaultStyle=function(){var e=Ve._defaultOptions;return{fillStyle:we(e.fillColor),strokeStyle:we(e.strokeColor),lineWidth:e.strokeThickness,dashes:xe(e.strokeDashArray)}},Ve.prototype.isTapEnabled=function(){return this._hasTapEvents()||this._layerHasTapEvents()},Ve.prototype.isDoubleTapEnabled=function(){return this._hasDoubleTapEvents()||this._layerHasDoubleTapEvents()},Ve.prototype.isHoverEnabled=function(){return this._hasHoverEvents()||this._layerHasHoverEvents()||this.isTapEnabled()||this.isDoubleTapEnabled()},Ve.prototype.dispose=function(){r.prototype.dispose.call(this),H._disposeEvents(this)},Ve.prototype._hasHoverEvents=function(){return this.mouseover&&this.mouseover.hasHandlersRegistered()||this.mouseout&&this.mouseout.hasHandlersRegistered()},Ve.prototype._hasTapEvents=function(){return this.click&&this.click.hasHandlersRegistered()||this.mouseup&&this.mouseup.hasHandlersRegistered()||this.mousedown&&this.mousedown.hasHandlersRegistered()},Ve.prototype._hasDoubleTapEvents=function(){return this.dblclick&&this.dblclick.hasHandlersRegistered()},Ve.prototype._layerHasHoverEvents=function(){var e=this.layer;return e&&(e.primitiveHoverStarted&&e.primitiveHoverStarted.hasHandlersRegistered()||e.primitiveHoverStopped&&e.primitiveHoverStopped.hasHandlersRegistered())},Ve.prototype._layerHasTapEvents=function(){var e=this.layer;return e&&(e.primitiveTapped&&e.primitiveTapped.hasHandlersRegistered()||e.primitivePointerPressed&&e.primitivePointerPressed.hasHandlersRegistered())},Ve.prototype._layerHasDoubleTapEvents=function(){var e=this.layer;return e&&e.primitiveDoubleTapped&&e.primitiveDoubleTapped.hasHandlersRegistered()},Ve.prototype.hasInternalId=function(){return!!(this.entity&&this.entity.id&&/^Polygon_[1-9]([0-9])*$/i.test(this.entity.id))},Ve._polygonId=1,Ve._defaultOptions={fillColor:"rgba(90, 255, 150, 0.4)",strokeColor:"rgba(0, 100, 200, 1)",strokeThickness:1,strokeDashArray:null,visible:!0,cursor:"pointer",generalizable:!0,title:null},Ve._stylePropertiesDict={fillColor:"fillStyle",strokeColor:"strokeStyle",strokeThickness:"lineWidth",strokeDashArray:"dashes"},Ve._defaultBucketId="999999",Ve),Te=(le(ze,s=$),ze.prototype.getStrokeColor=function(){return this._options.strokeColor},ze.prototype.getStrokeDashArray=function(){return this._options.strokeDashArray},ze.prototype.getStrokeThickness=function(){return this._options.strokeThickness},ze.prototype.getVisible=function(){return this._options.visible},ze.prototype.setLocations=function(e){var t=this.getLocations();s.prototype.setLine.call(this,e,this.getGeneralizable()),this.changed&&this.changed.invoke(new J(this,"locations",t,e))},ze.prototype.setOptions=function(e){var t=this._options,i={},o=this.getTemplate().getStyle();i.strokeThickness=("number"==typeof e.strokeThickness?e:t).strokeThickness,"number"==typeof e.strokeThickness&&(o.lineWidth=e.strokeThickness),i.strokeColor=e.strokeColor||t.strokeColor,e.strokeColor&&(o.strokeStyle=we(e.strokeColor)),i.strokeDashArray=e.strokeDashArray||t.strokeDashArray,e.strokeDashArray&&(o.dashes=xe(e.strokeDashArray)),i.secondaryStrokeThickness=("number"==typeof e.secondaryStrokeThickness?e:t).secondaryStrokeThickness,"number"==typeof e.secondaryStrokeThickness&&(o.secondaryLineWidth=e.secondaryStrokeThickness),i.secondaryStrokeColor=e.secondaryStrokeColor||t.secondaryStrokeColor,e.secondaryStrokeColor&&(o.secondaryStrokeStyle=we(e.secondaryStrokeColor)),i.visible=("boolean"==typeof e.visible?e:t).visible,i.generalizable=("boolean"==typeof e.generalizable?e:t).generalizable,i.generalizable!==t.generalizable&&(this.geometry.generalizable=i.generalizable,this.geometry.generalizations=null),i.cursor=e.cursor||t.cursor,e.hasOwnProperty("stylesheetEntry")&&(this.stylesheetEntry=i.stylesheetEntry=e.stylesheetEntry),e.hasOwnProperty("stylesheetEntryState")&&(this.stylesheetEntryState=i.stylesheetEntryState=e.stylesheetEntryState),this._options=i,this.changed&&this.changed.invoke(new J(this,"options",t,i))},ze.prototype.toString=function(){throw new Error("Not implemented")},ze.prototype.getCursor=function(){return this._options.cursor},ze.prototype.getGeneralizable=function(){return this._options.generalizable},ze.getDefaultStyle=function(){var e=ze._defaultOptions;return{strokeStyle:we(e.strokeColor),lineWidth:e.strokeThickness,dashes:xe(e.strokeDashArray)}},ze.prototype.isTapEnabled=function(){return this._hasTapEvents()||this._layerHasTapEvents()},ze.prototype.isDoubleTapEnabled=function(){return this._hasDoubleTapEvents()||this._layerHasDoubleTapEvents()},ze.prototype.isHoverEnabled=function(){return this._hasHoverEvents()||this._layerHasHoverEvents()||this.isTapEnabled()||this.isDoubleTapEnabled()},ze.prototype.dispose=function(){s.prototype.dispose.call(this),H._disposeEvents(this)},ze.prototype._hasHoverEvents=function(){return this.mouseover&&this.mouseover.hasHandlersRegistered()||this.mouseout&&this.mouseout.hasHandlersRegistered()},ze.prototype._hasTapEvents=function(){return this.click&&this.click.hasHandlersRegistered()||this.mouseup&&this.mouseup.hasHandlersRegistered()||this.mousedown&&this.mousedown.hasHandlersRegistered()},ze.prototype._hasDoubleTapEvents=function(){return this.dblclick&&this.dblclick.hasHandlersRegistered()},ze.prototype._layerHasHoverEvents=function(){var e=this.layer;return e&&(e.primitiveHoverStarted&&e.primitiveHoverStarted.hasHandlersRegistered()||e.primitiveHoverStopped&&e.primitiveHoverStopped.hasHandlersRegistered())},ze.prototype._layerHasTapEvents=function(){var e=this.layer;return e&&(e.primitiveTapped&&e.primitiveTapped.hasHandlersRegistered()||e.primitivePointerPressed&&e.primitivePointerPressed.hasHandlersRegistered())},ze.prototype._layerHasDoubleTapEvents=function(){var e=this.layer;return e&&e.primitiveDoubleTapped&&e.primitiveDoubleTapped.hasHandlersRegistered()},ze.prototype.hasInternalId=function(){return!!(this.entity&&this.entity.id&&/^Polyline_[1-9]([0-9])*$/i.test(this.entity.id))},ze._polylineId=1,ze._defaultOptions={strokeColor:"rgba(0, 100, 200, 1)",strokeThickness:1,strokeDashArray:null,visible:!0,cursor:"pointer",generalizable:!0},ze._stylePropertiesDict={strokeColor:"strokeStyle",strokeThickness:"lineWidth",strokeDashArray:"dashes"},ze);function we(e){return e?"string"==typeof e?e:e.toRgba():null}function xe(e){var t,i,o,n;if("string"==typeof e)for(i=e.split(/[, ]/),t=[],o=0;o<i.length;o++)n=parseInt(i[o]),isNaN(n)||t.push(n);else t=e;return t}var Oe=(Be.prototype.selectorReady=function(){var t=this;return!this._baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(e){return t._baseMapTemplateSelector=e,t._resetTemplateSelector=!1,t._baseMapTemplateSelector.selectorReady()}):this._baseMapTemplateSelector.selectorReady()},Be.prototype.getMarkupStyle=function(e,t,i){var o;return void 0===i&&(i=e.entity&&e.entity.poiType||1),e instanceof Ce&&(e.bucket===S.pricePoiBucketId&&(i=2)),e.getState&&(o=e.getState()),this._baseMapTemplateSelector.getMarkupStyle(e,t,o,i)},Be.prototype.getTemplates=function(t,e){function i(){var e=U.getValue(t,"anchor");return e instanceof Y?e=new C(e.x,e.y):e instanceof C||(e=new C(0,0)),e}var o,n,s,r,a,l=[],p=t.bucket,h=se.fromScale(null,e,!0),d=t.entity;if(t instanceof Ce){var c=p===S.pricePoiBucketId,u=p===Ce.defaultPushpinBucketId||p===Ce.defaultClickedPushpinBucketId||p===S.microPoiBucket,g=t.getState();t.loadImage();var _=U.getValue(t,"image"),y=t.getText(),m=!!(y&&0<y.length);if(_)o=t.getRoundClickableArea()?1:2,v=i(),U.setValue(t,"anchor",v),this._preparePushpinImage(_,g),(y=new x(_,1,v,t,g)).setHitTestShape(o),l.push(y),!t.hasSvgText&&t.getText()&&(f=this._getTextAnchor(_.width,t.getTextOffset()),l=l.concat(S.getPushpinTextTemplates(null,_,f,v)));else if(H._renderAllPoiAndLabelsGL()&&t.hasVectorIcon()){var f=i(),v=t.getIcon(),b=0<v.strokeWidth?v.strokeWidth:0,b=f.x+","+f.y+","+v.radius+","+b;(l=this._templateCache[b])||(l=[new M._VectorIconTemplate(v,1,f)],this._templateCache[b]=l)}else if(u||c)if(b=Be._pushpinColorIndex,t.taskDisplayState&&(b=t.taskDisplayState.colorIndex),t.isMicroPoi)l=this._baseMapTemplateSelector.getPoiTemplate(S.microPoiBucket,g,h,12,!1,!0,null,S.getPaletteKeyForCategory(t.groupCatId)||S.getPaletteKeyForCategory(t.catId));else{if(u=a=void 0,10===(a=d&&d.poiType?d.poiType:c?2:t.catId||!this._useClassicSdkPoi?1:10)&&(u=z._getColorMapping(b)),l=this._baseMapTemplateSelector.getPoiVectorImageTemplate(t.catId,g,h,a,m,t.groupCatId,u),4!==g&&t.getText()){for(n=!1,s=0,r=l.length;s<r&&!(n=n||l[s].hasPlaceholderText);s++);n||(l=l.concat(S.getPushpinTextTemplates(l[l.length-1],null,null,null)))}t.getColor()&&(l=this._applyCustomPushpinColor(l,this._convertSDKColorToColor(t.getColor())))}else l=this._baseMapTemplateSelector.getPoiTemplate(p,t.getState(),h,t.entity&&t.entity.poiType||1,m,!0,t.stylesheetEntry,t.stylesheetEntryState)}else(3===t.geometryType||2===t.geometryType)&&t.stylesheetEntry||t.stylesheetEntryState?(g=(m=t).getState&&m.getState()||2,a=m.entity.poiType||null,l=this._baseMapTemplateSelector.getPolygonTemplates(t.geometryType,p,g,a,e,m.isHoverEnabled()?1:0,m.stylesheetEntry,m.stylesheetEntryState)):t.getTemplates?l=t.getTemplates():t.getTemplate&&(l=[t.getTemplate()]);return l},Be.prototype.dispose=function(){this._map=null,this._baseMapTemplateSelector=null,H._clearDisposables(this._disposables)},Be.prototype._getTextAnchor=function(e,t){e=e/2+Be._pushpinTextAnchorOffset.x+t.x,t=Be._pushpinTextAnchorOffset.y+t.y;return new C(e,t)},Be.prototype._applyCustomPushpinColor=function(e,t){for(var i,o=[],n=0;n<e.length;n++){for(var s=e[n],r=s.getVectorImage().records,a=[],l=0;l<r.length;l++)2===(i=Be._cloneObject(r[l])).vectorType&&(i.style.strokeStyle&&(i.style.strokeStyle=this._getUpdatedRecordColor(O.parse(i.style.strokeStyle),t)),i.style.fillStyle&&(i.style.fillStyle=this._getUpdatedRecordColor(O.parse(i.style.fillStyle),t))),a.push(i);o.push(new ne({hitTest:1,records:a},s.getScale()))}return o},Be.prototype._getUpdatedRecordColor=function(e,t){var i,o,n=e.alpha;return e.alpha=1,o=e.toRgba(),0<=Be._defaultPoiColorsRgba.indexOf(o)?(i=t).alpha=n:Be._defaultPoiLayerColorRgbaAlphas[o]&&((i=t).alpha=Be._defaultPoiLayerColorRgbaAlphas[o]),e.alpha=n,(i||e).toRgba()},Be.prototype._convertSDKColorToColor=function(e){var t=e;return e.toHex&&(t=e.toHex()),O.parse(t)},Be._cloneObject=function(e){var t,i,o,n,s;if(!e||"object"!=typeof e)return e;for(t={},o=0,n=(i=Object.keys(e)).length;o<n;o++)t[s=i[o]]=this._cloneObject(e[s]);return t},Be.prototype._preparePushpinImage=function(e,t){var i,o=this;e.setAttribute&&(void 0===this._pushpinAccessible&&this._map&&((i=function(e){o._pushpinAccessible=void 0!==e.pushpinAccessible&&e.pushpinAccessible})(this._map.getMapOptions()),this._disposables.push(this._map.mapOptionsChanged.add(i))),this._pushpinAccessible&&(3===t?e.setAttribute(x.shadowStyleAttribute,JSON.stringify(Be._pushpinHoverShadow)):4===t?e.setAttribute(x.shadowStyleAttribute,JSON.stringify(Be._pushpinSelectShadow)):e.removeAttribute(x.shadowStyleAttribute)))},Be._pushpinColorIndex=1,Be._pushpinTextAnchorOffset=new Y(0,8),Be._defaultPoiColorsRgba=["rgb(170,41,143)","rgb(211,72,191)","rgb(128,130,133)","rgb(109,110,113)"],Be._defaultPoiLayerColorRgbaAlphas={"rgb(231,209,232)":.08,"rgb(107,64,103)":.3,"rgb(209,211,212)":.08},Be._pushpinHoverShadow={shadowBlur:2,shadowOffset:{x:2,y:2},shadowColor:"#555"},Be._pushpinSelectShadow={shadowBlur:3,shadowOffset:{x:3,y:3},shadowColor:"#333"},Be),Ee=(le(Re,n=X),Re.prototype.dispose=function(){var e,t,o=this,i=this._map&&this._map.getV8Map();i&&(this._autosuggestManager&&this._autosuggestManager.dispose(),e=i.getOverlayManager(),t=function(){var e,t,i;if(_e.removeHandler(o._mapTypeChangedDisposable),_e.removeHandler(o._mapResizedDisposable),o._control){for(e=Object.keys(o._registeredJsEvents),t=0;t<e.length;t++)i=e[t],H._undefineJSEventForDomEvent(o._control,i,o._registeredJsEvents[i].id),o._registeredJsEvents[i].dispose();o._control.select("."+o.getSearchBoxClass()).remove_event("keydown",o._onManualSearch),o._control.select("."+o.getSpyglassClass()).remove_event("click",o._onManualSearch)}n.prototype.dispose.call(o),H._nullifyClass(o)},e?e.then(function(){var e=i.getOverlays();e&&e.remove(o),t()}):t())},Re.prototype.getDisplay=function(){var e,t="none";return this._map&&((e=this._map.getMapTypeId())&&e!==re.birdseye&&e!==re.birdseyeV2&&e!==re.streetside&&(t="")),t},Re.prototype.getZIndex=function(){return 1001},Re.prototype.getSearchBarWidth=function(){return 250..toString()+"px"},Re.prototype.getSearchBarContainerClass=function(){return"sdkSearchBarContainer"},Re.prototype.getSearchBoxClass=function(){return"sdkSearchBar"},Re.prototype.getSpyglassClass=function(){return"sdkSearchBarSpyglass"},Re.prototype._initialize=function(){var r=this;b.loadModule("Microsoft.Maps.AutoSuggest",function(){function e(){return s&&!s.isDisposed()&&r._map.getOptions().showSearchBar}var t,i,o,n,s=r._map&&r._map.getV8Map();if(e()){if(!r._control){for(r._control=new I('<div class="{Binding searchBarContainerClass}" style:z-index="{Binding zIndex}" style:width="{Binding searchBarWidth}">    <input type="text" class="{Binding searchBoxClass}"/>    <div class="{Binding spyglassClass}"></div></div>',r).applyDataTemplate(r),t={stopPropagation:!0},i=["mousemove","mousedown","mouseup","click","dblclick","touchmove","touchstart","touchend"],o=0;o<i.length;o++)r._registeredJsEvents[n=i[o]]=H._defineJSEventForDomEvent(r._control,n,t);r.setOverlayElement(r._control),r._mapTypeChangedDisposable=_e.addHandler(r._map,"maptypechanged",r._onMapTypeChanged.bind(r)),r._mapResizedDisposable=_e.addHandler(r._map,"mapresize",r._onMapResized.bind(r))}s.getOverlayManager().then(function(){e()&&(s.getOverlays().insert(r),r._control.set_style({display:r.getDisplay()}),r._initializeAutoSuggest())})}})},Re.prototype._initializeAutoSuggest=function(){var e,t=this;this._autosuggestOptions.map=this._map,this._autosuggestOptions.serpOptions.width=250,this._autosuggestOptions.countryCode=b.GlobalConfig.dynamicProperties.market.split("-")[1],this._autosuggestOptions.maxResults=this._getMaxSuggestionsToQuery(),this._autosuggestManager=new b.AutosuggestManager(this._autosuggestOptions),e=this._map.getRootElement().id,this._autosuggestManager.attachAutosuggest((e=e?"#"+e+" ":"")+"."+this.getSearchBoxClass(),e+"."+this.getSearchBarContainerClass(),function(e){return t._onSuggestionSelection(e)}),this._control&&(this._control.select("."+this.getSearchBoxClass()).add_event("keydown",this._onManualSearch.bind(this)),this._control.select("."+this.getSpyglassClass()).add_event("click",this._onManualSearch.bind(this)))},Re.prototype._onSuggestionSelection=function(e,t){var i=this._map.getV8Map().getConfig(),o=i.sdkSearchBarUrlTemplate,n=this._map.getOptions().searchBarFormCode||i.sdkSearchBarUrlFormCode||"",i=t||"",t="";e&&(i=e.formattedSuggestion,t=(e=e.entityId)&&e.indexOf("local_geoid")<0?e:""),n=o.replace("{q}",i).replace("{filters}",t).replace("{formCode}",n),window.open(n,"_blank")},Re.prototype._onManualSearch=function(e){var t,i,o,n=e.keyCode||e.which;if(this._control&&(13===n||"click"===e.type)){for(t=this._control.select(".asOuterContainer ul li"),i=!1,o=0;o<t.length;o++)if("true"===L(t[o]).get_attr("aria-selected")){i=!0;break}i||0<(e=(e=this._control.select("."+this.getSearchBoxClass())[0])&&e.value||"").replace(/\s/g,"").length&&this._onSuggestionSelection(null,e)}},Re.prototype._onMapTypeChanged=function(e){e.oldMapTypeId!==e.newMapTypeId&&this._control.set_style({display:this.getDisplay()})},Re.prototype._onMapResized=function(){this._autosuggestManager&&this._autosuggestManager.setOptions({maxResults:this._getMaxSuggestionsToQuery()})},Re.prototype._getMaxSuggestionsToQuery=function(){var e,t=5;return this._map&&this._control&&(e=this._map.getHeight(),e=Math.floor((e-this._control.get_size().height-parseInt(this._control.get_style("top")))/95),t=H._clamp(e,2,t)),t},Re),Ie=(Ae.getColor=function(e){return e?"rgba("+Math.floor(255*Ae.getRandomNumber())+","+Math.floor(255*Ae.getRandomNumber())+","+Math.floor(255*Ae.getRandomNumber())+", 0.5)":"#"+Math.floor(16777215*Ae.getRandomNumber()).toString(16)},Ae.getLocations=function(e,t){var i,o;if((!e||e<=0)&&(e=1),t=this._processLocationRect(t),!e||e<=1)return this.getRandomLocation(t);for(i=[],o=0;o<e;o++)i.push(this.getRandomLocation(t));return i},Ae.getPushpins=function(e,t,i){function o(e,t,i){return t&&i&&(t.title=Ae.getText(5)),new Ce(Ae.getRandomLocation(e),t)}var n,s,r,a;if((!e||e<=0)&&(e=1),t=this._processLocationRect(t),s=(n=i)&&"*random*"===n.title,!e||e<=1)return o(t,n,s);for(r=[],a=0;a<e;a++)r.push(o(t,n,s));return r},Ae.getPolylines=function(e,t,i,o,n){var s,r,a,l,p;if((!e||e<=0)&&(e=1),i&&i<=1&&(i=2),(!o||o<=0)&&(o=.1),t=this._processLocationRect(t),s=Math.min(t.width/2,t.height)*o,t.width-=2*s,t.height-=2*s,s*=111e3,r=i,!e||e<=1)return i||(r=Math.ceil(7*Ae.getRandomNumber()+3)),a=n||{strokeColor:Ae.getColor(!0),strokeThickness:Math.ceil(3*Ae.getRandomNumber()+1)},new Te(this._generateSimplePolygonPoints(this.getRandomLocation(t),s,r),a);for(l=[],p=0;p<e;p++)i||(r=Math.ceil(7*Ae.getRandomNumber()+3)),a=n||{strokeColor:Ae.getColor(!0),strokeThickness:Math.ceil(3*Ae.getRandomNumber()+1)},l.push(new Te(this._generateSimplePolygonPoints(this.getRandomLocation(t),s,r),a));return l},Ae.getPolygons=function(e,t,i,o,n,s){var r,a,l,p,h;if((!e||e<=0)&&(e=1),i&&i<=2&&(i=3),(!o||o<=0)&&(o=.1),t=this._processLocationRect(t),r=Math.min(t.width/2,t.height)*o,t.width-=2*r,t.height-=2*r,r*=111e3,a=i,!e||e<=1)return i||(a=Math.ceil(7*Ae.getRandomNumber()+3)),l=n||{strokeColor:Ae.getColor(!0),fillColor:Ae.getColor(!0),strokeThickness:Math.ceil(3*Ae.getRandomNumber()+1)},new Se(s?this._generateHoledPolygonPoints(this.getRandomLocation(t),r,a):this._generateSimplePolygonPoints(this.getRandomLocation(t),r,a),l);for(p=[],h=0;h<e;h++)i||(a=Math.ceil(7*Ae.getRandomNumber()+3)),l=n||{strokeColor:Ae.getColor(!0),fillColor:Ae.getColor(!0),strokeThickness:Math.ceil(3*Ae.getRandomNumber()+1)},s?p.push(new Se(this._generateHoledPolygonPoints(this.getRandomLocation(t),r,a),l)):p.push(new Se(this._generateSimplePolygonPoints(this.getRandomLocation(t),r,a),l));return p},Ae.getText=function(e){var t=Ae._lipsum,t=t[Math.floor(Ae.getRandomNumber()*t.length)].split(" ");return e=Math.min(e,t.length),e=Math.ceil(Ae.getRandomNumber()*e+1),t.slice(0,e).join(" ")},Ae.getRandomNumber=function(){return"undefined"!=typeof FunctionalTestHooks?Ae._fixedRandomNumber[Ae._randomIndexNumber++%Ae._fixedRandomNumber.length]:Math.random()},Ae.getRandomBetween=function(e,t){return Ae.getRandomNumber()*(t-e)+e},Ae._processLocationRect=function(e){return e&&e instanceof B?e:new B(new N(0,0),360,170)},Ae.getRandomLocation=function(e){var t=Ae.getRandomNumber()*e.height+e.getSouth(),e=N.normalizeLongitude(Ae.getRandomNumber()*e.width+e.getWest());return new N(t,e)},Ae._generateSimplePolygonPoints=function(e,t,i){for(var o=[],n=360/i,s=360*Ae.getRandomNumber(),r=i;0<r;r--)o.push(this._calculateCoord(e,(r*n+s)%360,t*Math.max(Ae.getRandomNumber(),.3)));return o},Ae._generateHoledPolygonPoints=function(e,t,i){for(var o,n,s=[],r=[],a=360/i,l=360*Ae.getRandomNumber(),p=i;0<p;p--)n=t*Math.max(Ae.getRandomNumber(),.3),s.push(this._calculateCoord(e,o=(p*a+l)%360,n)),r.push(this._calculateCoord(e,o,n*Ae.getRandomNumber()));return[s,r.reverse()]},Ae._calculateCoord=function(e,t,i){var o=e.latitude*Math.PI/180,n=e.longitude*Math.PI/180,e=i/6378100,i=Math.asin(Math.sin(o)*Math.cos(e)+Math.cos(o)*Math.sin(e)*Math.cos(t*Math.PI/180)),o=n+Math.atan2(Math.sin(t*Math.PI/180)*Math.sin(e)*Math.cos(o),Math.cos(e)-Math.sin(o)*Math.sin(i));return new N(180*i/Math.PI,180*o/Math.PI)},Ae._lipsum=["Lorem ipsum dolor sit amet","Tamquam invidunt praesent nam ne","Ut errem doming eos","An erat fuisset disputando sed","Sea in omittantur voluptatibus","Cibo aperiri eam ei","Qui at nemore abhorreant","Eripuit labores eu vel","Id sea hinc offendit","An liber semper reprimique vix","Te mei impetus accumsan","Solet aliquid eos no","No nec iriure argumentum","Sit an labore albucius euripidis","Nec cu ancillae accommodare","No vel quando scripta mnesarchum","Sea veritus necessitatibus ea","Ut sea modo omnes indoctum","Modus iisque voluptatibus te usu","Nulla ridens pertinacia qui ne","Ei aeque oblique electram has","Vim eu odio delicata","An fastidii suscipit vel","Ne malorum volutpat tractatos eum","Vocibus disputationi nec et","Nam cibo iudico ut","Ius ea possit eligendi","Ei civibus menandri posidonium has","Esse voluptua pri ut","At petentium interpretaris pri","Te natum iudico discere est","Enim libris id est","Ea quidam corpora reprehendunt vix","Est eu habeo nulla ullamcorper","No vel mucius labore consequuntur","Quodsi pertinax eu eam","Sensibus honestatis per ne","Est ex eruditi offendit probatus","Vix scaevola splendide assentior id","Dico iriure admodum sed ne","Munere vocent albucius est ne"],Ae._randomIndexNumber=0,Ae._fixedRandomNumber=[.7386382989127653,.2065695521004587,.7489809651835657,.7006290954692962,.04091025364671497,.9954127559729178,.4912746583039538,.33492258954447696,.00939051247581979,.9355370703076171,.6639112574906407,.6426966361780018,.3800605039195766,.6520244006764719,.4209986210406571,.6272502121915353,.5776952967358593,.047346452974710074,.7181255497508585,.3761793786749503,.14860266357998486,.800076502104903,.8501424964068189,.9455797454506294,.273840925209909,.9512738435986936,.0022886739742573603,.15367566682337164,.6459795802730335,.3362969951693593,.054336254044035304,.8588520113714642,.22937582572969895,.9740016245002041,.4607652665949822,.40322686905774097,.9171997385079895,.5880980730081158,.8724148495369748,.2239024700242871,.7676683143923331,.7926649750793715,.30415825012711917,.07293642344075457,.6753791383025063,.9679377523741153,.2038322560443715,.8129500820851909,.27077686182824223,.1684700203381848,.4993160557132863,.18293656572890726,.5757666932844097,.44912958854000773,.20395822630141502,.5219136226151808,.20601322250617948,.033178847605686235,.6959785547716033,.16399309933378792,.8595173804557417,.5437663007267504,.31875889100662835,.7186497378557282,.2914619029735994,.8841938161542489,.5348728984465658,.9076766706515857,.23562101989224282,.23108006829633676,.19450167514094852,.012137182682760983,.5625723905993567,.058086334903006076,.14774651602549294,.4986287987027942,.4361142980232129,.18451663552065267,.48824807947030413,.5964374217261839,.1416270467317997,.9406141464555404,.41207749360170154,.7663479353902358,.34355378128733816,.9459770580482947,.5008866762243267,.756600353201563,.4122854653758523,.7405594496989769,.8062874665554729,.005642643076812615,.5730359088967756,.45774660398273537,.12495085292892005,.7351135248926923,.9160158262525442,.12853493439491892,.39699927614726116,.30916913109636335],Ae),Le=(le(De,i=D),De.prototype.getTileSource=function(){return this._options.mercator},De.prototype.setOptions=function(e){var t,i;if(e&&(this._downloadTimeoutInMS=Math.min(De._maxDownloadTimeout,this._options.downloadTimeout=("number"==typeof e.downloadTimeout?e:this._options).downloadTimeout),this._options.opacity=("number"==typeof e.opacity?e:this._options).opacity,this._options.visible=("boolean"==typeof e.visible?e:this._options).visible,this._options.zIndex=("number"==typeof e.zIndex?e:this._options).zIndex,this._enableCORS=this._options.enableCORS=("boolean"==typeof e.enableCORS?e:this._options).enableCORS,this._useCredentialsForCORS=this._options.useCredentialsForCORS=("boolean"==typeof e.useCredentialsForCORS?e:this._options).useCredentialsForCORS,this.setVisible(this._options.visible),this.setZIndex(this._options.zIndex),this.setOpacity(this._options.opacity),t=e.mercator,!this._options.mercator&&t))for((this._options.mercator=t)instanceof he&&(t=[t]),i=0;i<t.length;i++){t[i].downloadTimeOut=this._options.downloadTimeout;var o=t[i].getMinZoom(),n=t[i].getMaxZoom(),s=t[i].getBounds();this.addScene(0,t[i],0,null,se.toScale(null,n,!0),se.toScale(null,o,!0),s)}},De.prototype.toString=function(){throw new Error("Not supported")},De._defaultOptions={zIndex:1e4,visible:!0,opacity:1,downloadTimeout:5e3,enableCORS:!1},De._tileId=0,De._maxDownloadTimeout=3e4,De),Pe=(He.prototype._setTargetType=function(e){switch(!0){case e instanceof Ce:this.targetType="pushpin";break;case e instanceof Te:this.targetType="polyline";break;case e instanceof Se:this.targetType="polygon";break;default:this.targetType=null}},He);b.AnimatedTileLayer=de,b.Color=ye,b.CustomOverlay=pe,b.EntityCollection=ge,b.Events=_e,b.GroundOverlay=me,b.Infobox=fe,b.Layer=ce,b.PixelReference=oe,b.Polygon=Se,b.Polyline=Te,b.Pushpin=Ce,b.SDKMap=ke,M.SDKPrimitiveTemplateSelector=Oe,b.Module=ve,b.MouseEventArgs=Pe,b.TestDataGenerator=Ie,b.Themes={},b.Themes.BingTheme=ie,b.TileSource=he,b.TileLayer=Le,void 0!==l&&(b.MapsTilePrimer=l),b.PointCompression=be,b.loadModule=ve.loadModule,b.registerModule=ve.registerModule,b.moduleLoaded=ve.moduleLoaded,b.getIsBirdseyeAvailable=ke.getIsBirdseyeAvailable,Microsoft.Maps.notifyMapReadyForBootstrap()}catch(e){if(!b.logger)throw e;b.logger.logCriticalError(e)}function He(e,t,i){var o,n,s;this.eventName=e,this.location=i.location,o=this.point=i.point,n=this.target=this.primitive=i.primitive,this.hitTarget=i.hitTarget,this.layer=i.layer,this.exclusiveHitTest=i.exclusiveHitTest,this._setTargetType(n),n=t.getRootElement().get_absolute_pos(),this.pageX=o.x+n.x,this.pageY=o.y+n.y,s=t.getActualSize(),i=i.originalArgs||{},this.getX=function(){return o.x-s.width/2},this.getY=function(){return o.y-s.height/2},0<=["mousedown","mouseup","click","dblclick","rightclick"].indexOf(e)&&(this.isPrimary=1===i.which,this.isSecondary=3===i.which),"mousewheel"===e&&(this.wheelDelta=i.wheelDelta)}function De(e){var t=i.call(this,"CustomLayer_"+De._tileId++)||this;return t._options={zIndex:De._defaultOptions.zIndex,visible:De._defaultOptions.visible,opacity:De._defaultOptions.opacity,downloadTimeout:De._defaultOptions.downloadTimeout,enableCORS:De._defaultOptions.enableCORS},t.setOptions(e),t}function Ae(){}function Re(e){var t=n.call(this,null,null,null)||this;return t._registeredJsEvents={},t._map=e,t._autosuggestOptions={showBingLogo:!1,serpOptions:{showMyLocation:!1,suggestionTypes:"&"}},t._initialize(),t}function Be(e){var t=this;this._templateCache={},this._map=e,this._disposables=[],this._disposables.push(this._map.mapTypeChanged.add(function(e){e.newMapTypeId!==e.oldMapTypeId&&(t._resetTemplateSelector=!0)})),e=Microsoft.Maps.Internal._CoreConfig(),P.features.taskFramework,this._useClassicSdkPoi=e.useClassicSdkPoi}function ze(e,t){var i,o=this;return t?((i={}).strokeColor=t.strokeColor||ze._defaultOptions.strokeColor,i.strokeDashArray=t.strokeDashArray||ze._defaultOptions.strokeDashArray,i.strokeThickness=("number"==typeof t.strokeThickness?t:ze._defaultOptions).strokeThickness,i.secondaryStrokeColor=t.secondaryStrokeColor||ze._defaultOptions.secondaryStrokeColor,i.secondaryStrokeThickness=("number"==typeof t.secondaryStrokeThickness?t:ze._defaultOptions).secondaryStrokeThickness,i.visible=("boolean"==typeof t.visible?t:ze._defaultOptions).visible,i.generalizable=("boolean"==typeof t.generalizable?t:ze._defaultOptions).generalizable,i.cursor=t.cursor||ze._defaultOptions.cursor,i.stylesheetEntry=t.stylesheetEntry,i.stylesheetEntryState=t.stylesheetEntryState):i=ze._defaultOptions,t={id:"Polyline_"+ze._polylineId++},(o=s.call(this,e,t,null,i.generalizable)||this).changed=new A,o.stylesheetEntry=i.stylesheetEntry,o.stylesheetEntryState=i.stylesheetEntryState,o._options=i,i=new T({strokeStyle:we(i.strokeColor),lineWidth:i.strokeThickness,secondaryStrokeStyle:we(i.secondaryStrokeColor),secondaryLineWidth:i.secondaryStrokeThickness,dashes:xe(i.strokeDashArray),hitTest:1}),o.setTemplate(i),o}function Ve(e,t){var i=this,o={},n=Ve._defaultOptions;return o.fillColor=(t=t||{}).fillColor||n.fillColor,o.strokeColor=t.strokeColor||n.strokeColor,o.strokeDashArray=t.strokeDashArray||n.strokeDashArray,o.strokeThickness=("number"==typeof t.strokeThickness?t:n).strokeThickness,o.secondaryStrokeColor=t.secondaryStrokeColor||n.secondaryStrokeColor,o.secondaryStrokeThickness=("number"==typeof t.secondaryStrokeThickness?t:n).secondaryStrokeThickness,o.visible=("boolean"==typeof t.visible?t:n).visible,o.cursor=t.cursor||n.cursor,o.generalizable=("boolean"==typeof t.generalizable?t:n).generalizable,o.title=("string"==typeof t.title?t:n).title,n={id:"Polygon_"+Ve._polygonId++,title:o.title},(i=r.call(this,e,n,null,o.generalizable)||this).bucket=Ve._defaultBucketId,i.stylesheetEntry=o.stylesheetEntry=t.stylesheetEntry,i.stylesheetEntryState=o.stylesheetEntryState=t.stylesheetEntryState,i.changed=new A,i._state=2,i._options=o,o=new T({strokeStyle:we(o.strokeColor),fillStyle:we(o.fillColor),lineWidth:o.strokeThickness,secondaryStrokeStyle:we(o.secondaryStrokeColor),secondaryLineWidth:o.secondaryStrokeThickness,dashes:xe(o.strokeDashArray),hitTest:1}),i.setTemplate(o),i}function Ne(e,t,i,o,n,s,r){var a,l,p,h,d,c,u,g,_=this;if(this._disposables=[],this._disposables.push(this._mapLoaded=new A),this.layers=new Z(null,!1),a=[],this._disposables.push(this.layers.changed.add(function(e){_._mapHasLoaded?b.setTimeout(function(){_._onLayersChanged(e)},0):a.push(e)})),this._mapLoaded.addOne(function(){0<a.length&&b.setTimeout(function(){for(var e=0;e<a.length;e++)_._onLayersChanged(a[e])},0)}),this._rootElement=L(e),this._rootElement&&1===this._rootElement.length&&this._rootElement[0]){u=this._rootElement[0].$map;try{u&&u.dispose()}catch(e){}this._rootElement[0].$map=this}if(t=t||{credentials:null},this._options=this._options||{credentials:null},this._options.viewChangeEndDelay="number"==typeof t.viewChangeEndDelay?t.viewChangeEndDelay:0,t.mapTypeId&&(c=t.mapTypeId===re.birdseye?re.birdseyeV2:t.mapTypeId,t.mapType=c),t.trafficOptions=t.trafficOptions||{},t.trafficOptions.legendVisible=!0,"boolean"!=typeof t.showLogo&&(t.showLogo=!0),void 0!==t.showTermsLink&&null!==t.showTermsLink||(t.showTermsLink=!0),void 0!==t.showBreadcrumb&&null!==t.showBreadcrumb||(t.showBreadcrumb=!1),(l=t.supportedMapTypes)&&0<l.length){for(p=[],h=0,d=l;h<d.length;h++)c=d[h],re.isValid(c)&&p.push(c);l=t.supportedMapTypes=p}u=l&&l.indexOf(re.birdseye)<0&&l.indexOf(re.birdseyeV2)<0,t.disableBirdseye=t.disableBirdseye||u||!l&&!o.isBirdseyeV2SDKDefault,void 0===t.supportedMapTypes||null===t.supportedMapTypes||0===t.supportedMapTypes.length?(t.supportedMapTypes=[re.road,re.aerial,re.streetside,re.ordnanceSurvey],t.disableBirdseye||(b.GlobalConfig.isMapsAnswer&&!H._isFeatureEnabled("birdseyeV2UI")?t.supportedMapTypes.splice(2,0,re.birdseye):t.supportedMapTypes.splice(2,0,re.birdseyeV2))):-1<(g=l.indexOf(re.birdseye))&&(t.disableBirdseye?t.supportedMapTypes.splice(g,1):t.supportedMapTypes[g]=re.birdseyeV2),t.supportedMapTypes.push(re.highContrast),void 0===(g=t.labelOptions=t.labelOptions||{}).labelVisibility&&"number"==typeof t.labelOverlay&&(g.labelVisibility=t.labelOverlay),t.backgroundColor&&"string"!=typeof t.backgroundColor&&(t.backgroundColor=t.backgroundColor.toHex()),this._saveMapOptions(t),this._v8Map=new b.CoreMap(e,t,i,o,n,s,r),(t.bounds||t.center&&t.centerOffset)&&this.setView({bounds:t.bounds,center:t.center,centerOffset:t.centerOffset}),t.pushpinAccessible&&this._toggleAccessibilityManager(!0),t.showSearchBar&&this._toggleSDKSearchBar(!0),this._templateSelector=new Oe(this._v8Map),this._v8Map.getOverlayManager().then(function(){_._onOverlayManagerLoaded()}),this._disposables.push(this.copyrightchanged=new A),this._v8Map.copyrightControlLoaded.addOne(function(e){_._disposables.push(e.changed.add(function(e){"copyrightAttributions"===e.name&&_.copyrightchanged.invoke()}))}),this._disposables.push(this.viewchangestart=new A,this.viewchange=new A,this.viewchangeend=new A,this.viewrendered=new A,this._v8Map.mapPanStarted.add(function(e){_._raiseViewChangeStartEvent(e)}),this._v8Map.mapPanStopped.add(function(e){_._raiseViewChangeEndEvent(e)}),this._v8Map.targetViewChanged.add(function(e){_._v8Map.isPanning()||_._raiseViewChangeStartEvent(e)}),this._v8Map.viewChangingAfterPaint.add(function(e){_._raiseViewChangeEvent(e)}),this._v8Map.viewChanged.add(function(e){_._v8Map.isPanning()||_._raiseViewChangeEndEvent(e)})),this._v8Map.frameManagerLoaded.addOne(function(e){_._disposables.push(e.frameRendered.add(function(){_._raiseViewRenderedEvent({})}))},!1,!0),this._v8Map.targetViewChanged.isPreviouslyInvoked&&(this._viewChangeStartInitializationTimer=b.setTimeout(function(){_._raiseViewChangeStartEvent(_._v8Map.targetViewChanged.lastInvokedArgs)},0)),this._v8Map.viewChanged.isPreviouslyInvoked&&(this._viewChangeEndInitializationTimer=b.setTimeout(function(){_._raiseViewChangeEndEvent(_._v8Map.viewChanged.lastInvokedArgs)},0)),this._disposables.push(this._v8Map.mapTypeChanged.add(function(e){e.oldMapTypeId!==re.birdseyeV2&&e.newMapTypeId===re.birdseyeV2?b.BirdseyeV2Manager.hideLayersForSDKMap(_):e.oldMapTypeId===re.birdseyeV2&&e.newMapTypeId!==re.birdseyeV2&&b.BirdseyeV2Manager.showLayersForSDKMap(_)})),this.entities=new ge(null,this._v8Map),this.entities.setTemplateSelector(this._templateSelector),this._v8Map.getLayers().insert(this.entities)}function Fe(e,t){var i,o,n=this,s={};return s.icon=(t=t||{}).icon||Fe._defaultOptions.icon,s.iconSize=t.iconSize,s.anchor=t.anchor||Fe._defaultOptions.anchor,i=s.anchor?new C(s.anchor.x,s.anchor.y):null,s.title=("string"==typeof t.title?t:Fe._defaultOptions).title,s.subTitle=("string"==typeof t.subTitle?t:Fe._defaultOptions).subTitle,s.text=("string"==typeof t.text?t:Fe._defaultOptions).text,(o={id:"Pushpin_"+Fe._pushpinId++,collisionBehavior:2,title:s.title,subtitle:s.subTitle}).iconText=s.text,n=a.call(this,e,o,null,i)||this,s.draggable=("boolean"==typeof t.draggable?t:Fe._defaultOptions).draggable,s.visible=("boolean"==typeof t.visible?t:Fe._defaultOptions).visible,s.textOffset=t.textOffset||Fe._defaultOptions.textOffset,s.enableHoverStyle=("boolean"==typeof t.enableHoverStyle?t:Fe._defaultOptions).enableHoverStyle,s.enableClickedStyle=("boolean"==typeof t.enableClickedStyle?t:Fe._defaultOptions).enableClickedStyle,s.ariaHaspopup="boolean"==typeof t.ariaHaspopup&&t.ariaHaspopup,n.catId=s.catId=t.catId,n.groupCatId=s.groupCatId=t.groupCatId,n.isMicroPoi=s.isMicroPoi=t.isMicroPoi,n.bucket=s.bucket=t.bucket||(t.isMicroPoi?S.microPoiBucket:Fe.defaultPushpinBucketId),n.stylesheetEntry=s.stylesheetEntry=t.stylesheetEntry,n.stylesheetEntryState=s.stylesheetEntryState=t.stylesheetEntryState,n.isMicroPoi&&(o.collisionBehavior=1),n._options=s,n._updateDefaultStyle(),s.color=t.color||Fe._defaultOptions.color,s.cursor=t.cursor||Fe._defaultOptions.cursor,s.roundClickableArea=("boolean"==typeof t.roundClickableArea?t:Fe._defaultOptions).roundClickableArea,n.changed=new A,n.changing=new A,n._state=2,n.revision=0,n}function je(e){var i=this;this._disposables=[],this._layerEventTracker={},this._stateTracker={},this._onPrimitiveFocus=function(e){var t=L(e.srcElement),e=t.get_attr(je._primitiveIdAttribute),t=i._findPushpin(t.get_attr(je._layerIdAttribute),e);t&&(i._stateTracker[e]=t.getState(),t.setState(3))},this._onPrimitiveBlur=function(e){var t=L(e.srcElement),e=t.get_attr(je._primitiveIdAttribute),t=i._findPushpin(t.get_attr(je._layerIdAttribute),e);t&&(t.setState(i._stateTracker[e]),delete i._stateTracker[e])},this._onPrimitiveKeyPress=function(e){var t;13===e.keyCode&&(e=(t=L(e.srcElement)).get_attr(je._primitiveIdAttribute),(e=i._findPushpin(t.get_attr(je._layerIdAttribute),e))&&e.click&&e.click.invoke())},this._sdkmap=e,this._disposables.push(this._sdkmap.layers.changed.add(function(e){i._onLayersChanged(e)})),this._processAddedLayers(this._sdkmap.layers),this._sdkmap.entities?this._processAddedLayers([this._sdkmap.entities]):this._sdkmap.getV8Map().frameManagerLoaded.addOne(function(){i._processAddedLayers([i._sdkmap.entities])})}function We(){}function Ge(){}function Ue(e,t){var i=o.call(this,null,null,null)||this;return i._changeVisibilityDisposable=null,i._registeredJsEvents={},i._options={visible:Ue._defaultOptions.visible,showCloseButton:Ue._defaultOptions.showCloseButton,showPointer:Ue._defaultOptions.showPointer,offset:Ue._defaultOptions.offset,title:Ue._defaultOptions.title,description:Ue._defaultOptions.description,actions:Ue._defaultOptions.actions,maxHeight:Ue._defaultOptions.maxHeight,maxWidth:Ue._defaultOptions.maxWidth,closeDelayTime:Ue._defaultOptions.closeDelayTime,location:e},Microsoft.Maps.GlobalConfig.isSDK&&(i._options.zIndex=Ue._defaultOptions.zIndex),i.setOptions(t,!0),i.infoboxChanged=new A,i._visibleBeforeAnchorOutofBounds=!1,i}function Ze(e){var t=p.call(this,{beneathLabels:"boolean"!=typeof e.beneathLabels||e.beneathLabels})||this;return t._groundOverlayOptions={beneathLabels:!0,backgroundColor:"transparent",bounds:null,imageUrl:null,opacity:1,rotation:0,visible:!0},t.setOptions(e),t}function Je(e,t,i,o){this.a=1<e?e/255:e,this.r=t,this.g=i,this.b=o}function Xe(){}function Ke(e,t){var i=h.call(this,"EntityCollectionLayer_"+Ke._layerId++,e&&e.zIndex)||this;return i._infoboxCollection=[],i._options={},i._options.zIndex=i.getZIndex(),i._options.visible=(e&&"boolean"==typeof e.visible?e:Ke._defaultOptions).visible,i.setVisible(i._options.visible),i._disposables.push(i.entityadded=new A,i.entitychanged=new A,i.entityremoved=new A),i._childCollectionElementAddedHandlers={},i._childCollectionElementRemovedHandlers={},i._childCollections={},i._v8map=t,i}function Ye(e,t){var i=this;return"number"!=typeof t&&(t=Ye._zIndex++),(i=d.call(this,e,null,null,t)||this)._changedEventHandlers=[],i._disposables.push(i.primitiveMoveStarted.add(function(e){return i._onPrimitiveMoved(e,!0)}),i.primitiveMoveContinued.add(function(e){return i._onPrimitiveMoved(e,!0)}),i.primitiveMoveStopped.add(function(e){return i._onPrimitiveMoved(e,!1)}),i.invalidated=new A),i._primitives=[],i.setDataSource(i),i.setRenderTarget(2),i.overlayEvent=0,i}function Qe(e){var t=c.call(this)||this;return t._layerOptions={visible:Qe._defaultLayerOptions.visible,frameRate:Qe._defaultLayerOptions.frameRate,mercator:Qe._defaultLayerOptions.mercator,maxTotalLoadTime:Qe._defaultLayerOptions.maxTotalLoadTime,loadingScreen:Qe._defaultLayerOptions.loadingScreen,autoPlay:Qe._defaultLayerOptions.autoPlay},t._disposables=[],t._primers=[],t._currentFrameIndex=0,t._animationState=0,t.preLoadStarted=new A,t.preLoadEnded=new A,t.onFrameLoaded=new A,t.setOptions(e),t}function qe(e){var t=this;if(e&&e.tileSize&&Math.log(e.tileSize)/Math.log(2)%1!=0)throw"tileSize should be a factor of 2.";return(t=u.call(this,null,new F(se.toLocation(new N(0,0),0,!0)),W.instance,"CustomTileSource_"+qe._tileSourceId++,e&&e.uriConstructor?e.uriConstructor:void 0,"",null,null,null,null,null,e&&(e.tileSize||e.width)||G.tileSize)||this)._options=e,t}function $e(e){this._registeredJsEvents={},this._options={beneathLabels:$e._defaultOptions.beneathLabels,showInBirdseye:$e._defaultOptions.showInBirdseye,drawOrder:$e._defaultOptions.drawOrder},e&&("boolean"==typeof e.beneathLabels&&(this._options.beneathLabels=e.beneathLabels),"boolean"==typeof e.showInBirdseye&&(this._options.showInBirdseye=e.showInBirdseye),"number"==typeof e.drawOrder)&&(this._useDrawOrder=!0,e=Math.round(e.drawOrder),this._options.drawOrder=e?0<e?Math.min(e,$e._maxDrawOrder):Math.max(e,-1*$e._maxDrawOrder):$e._defaultOptions.drawOrder)}function et(e,t,i,o,n,s,r,a,l,p,h,d,c,u,g,_,y,m,f,v){a=this._getPrimerPrimitivesFromServerRenderedCard()||a,r=this._getMapBoundsFromCardPrimerResponse()||r,this._downloadedQueuedImage={},this._parentDiv="string"==typeof e?document.getElementById(e):e,"r"===h&&window.matchMedia("(-ms-high-contrast:active)").matches?(this._tileFormat=u,this._labelFormat=g):(this._tileFormat=d,this._labelFormat=c),this._width=this._parentDiv.offsetWidth,this._sessionId=f,this._isNavLeft=v;c=document.getElementById("b_header"),f=document.getElementById("b_footer"),v=0;c&&(v=f?c.clientHeight-f.clientHeight:c.clientHeight-20),this._height=this._parentDiv.offsetHeight+v,this._tilesLoaded=0,this.locationInfo=this._getTilePrimerLocationInfo(o,n,s,r,this._getPoiPrimerPoiLocations(a),l,p,_,y,this._isNavLeft),this._findBestMapViewFromLocationInfo(this.locationInfo),y=Math.floor(this.locationInfo.zoom),this._zoom=Math.max(3,y),"be2"===h&&(this._zoom=Math.min(this._zoom,19)),this._maxTileCoordinate=Math.pow(2,this._zoom)-1,this._tileSize=256,this._centerTile=this._latlongToPixelXY(this.locationInfo.centerPointLocation.latitude,this.locationInfo.centerPointLocation.longitude,this._zoom),this._centerTileX=this._centerTile.x/this._tileSize,this._centerTileY=this._centerTile.y/this._tileSize,this._centerOffset={x:-(this._centerTile.x%this._tileSize),y:-(this._centerTile.y%this._tileSize)},this._centerOffset.x+=this._width/2,this._centerOffset.y+=this._height/2,this._mkt=t||"en-US",this._geopolUserRegion=i,this._tileFormat&&m&&(m=new RegExp("amp;","g"),this._tileFormat=this._tileFormat.replace(m,""),this._labelFormat=this._labelFormat&&this._labelFormat.replace(m,""),this._tileFormat=this._tileFormat.replace(m=/&cstl=(?=&|$)/,""),this._labelFormat=this._labelFormat&&this._labelFormat.replace(m,""),this._tileContainer=document.createElement("div"),this._tileContainer.style.cssText="position:relative;overflow:hidden;z-index:99;width:"+this._width+"px;height:"+this._height+"px",this._parentDiv.appendChild(this._tileContainer),this._addTiles())}}.call(window);
