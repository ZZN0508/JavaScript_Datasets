var b$=b$||{};b$.universal=b$.universal||{},b$.universal.widgets=b$.universal.widgets||{},b$.universal.widgets.StructuredContentOverlays=function(A){"use strict";define("tc-overlay",function(k,e,t){t.exports={tcOverlay:function(l,e,o,n,t){var a;function d(){A(l.htmlNode).find(".tc-overlay").hasClass("overlay-download-app")&&(A(l.htmlNode).find(".modal-body").show(),A(l.htmlNode).find(".download-success-container, .download-error-container").hide(),A(l.htmlNode).find(".mobile-number").val(""),A(l.htmlNode).find(".captcha-image").empty(),A(l.htmlNode).find(".captcha-input").val(""),A(l.htmlNode).find(".get-captcha-error").hide(),A(l.htmlNode).find(".get-sms-error").hide(),A(l.htmlNode).find(".country-codes").val(A(".country-codes option:first").val()),A(l.htmlNode).find(".captcha-input").removeClass("captcha-error"))}A.ajax({url:e,success:function(e){var t=e;if(a=t.pageId,null!=t.TextArray)for(var o=0;o<t.TextArray.length;o++)t.TextArray[o].bodyBorderTop&&A(l.htmlNode).find(".tc-overlay .main-body .main-container:eq("+o+")").addClass("sections-border"),A(l.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .ind-row").html(t.TextArray[o].richTextItem),A(l.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .left-content").html(t.TextArray[o].leftText),A(l.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .right-content").html(t.TextArray[o].rightText),A(l.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .center-content").html(t.TextArray[o].centerText);A(l.htmlNode).find(".tc-overlay .popup-heading").text(t.overlayTitle),t.heading&&A(l.htmlNode).find(".tc-overlay .heading").text(t.heading),A(l.htmlNode).find(".tc-overlay .fb-img-container .left-img .fbleft").text(t.feedbackImgOneText),A(l.htmlNode).find(".tc-overlay .fb-img-container .right-img .fbright").text(t.feedbackImgTwoText),A(l.htmlNode).find(".tc-overlay .fb-img-container .small-gray-text").text(t.thirdPartyNotice),A(l.htmlNode).find(".tc-overlay .download-container .downLabel").text(t.downloadLabel),A(l.htmlNode).find(".tc-overlay .sms-captcha-container .smsLabel").text(t.getSmsLabel)},error:function(e){}}),"tnc"==o?S="overlay-terms-conditions":"downloadApp"==o?S="overlay-download-app":"feedback"==o?S="overlay-feedback":"feesAndCharges"==o?S="overlay-fees-charges":"howToGetStarted"==o&&(S="overlay-get-started"),A(l.htmlNode).find(".tc-overlay").addClass(S),gadgets.pubsub.subscribe("overlayTypeToOpened",function(e){var t=e.overlayType,e=e.sequenceNumber;o==t&&n==e&&("downloadApp"==o&&O(),A(l.htmlNode).find(".cover").css("display","block"),A("body").addClass("noScroll"),A(l.htmlNode).find(".popup-container").addClass("opened"))}),A(l.htmlNode).find(".tc-overlay .popup-download").on("click",function(){k(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/html2canvas"]),0<A(l.htmlNode).find(".modal-content .ind-row table").length&&0==A(l.htmlNode).find(".modal-content .ind-row table p").length&&k(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/pdfmake.min"],function(){k(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/vfs_fonts"],function(){for(var e,t=A(l.htmlNode).find(".modal-content table")[0],o="",n=0;e=t.rows[n];n++){for(var a,d=0;a=e.cells[d];d++)a.innerText=a.innerText.replace(/^\s+|\s+$/g,""),o=o+" "+a.innerText;o+="\n\n"}var r=A(l.htmlNode).find(".modal-content .modal-header"),i=r.height();html2canvas(r,{onrendered:function(e){e={pageMargins:[40,0,40,40],content:[{image:e.toDataURL("image/jpeg"),height:i-10,width:595,style:"header"},{text:o}],styles:{header:{margin:[0,0,0,10],alignment:"center"}}};A(l.htmlNode).find(".modal-content").attr("style",""),A("body").attr("style",""),A(l.htmlNode).find(".popup-container.opened").removeClass("download-in-progress"),A(l.htmlNode).find(".modal.popup-container.opened .button-options").show(),pdfMake.createPdf(e).download("download.pdf")}})})})}),A(l.htmlNode).find(".close-button,.logo-section .icon-left-open-big").on("click",function(){A(l.htmlNode).find(".cover").css("display","none"),A("body").removeClass("noScroll"),A(l.htmlNode).find(".popup-container").removeClass("opened"),d()}),gadgets.pubsub.subscribe("overlayClosed",function(){d()}),A(l.htmlNode).find(".popup-print").on("click",function(){A("body").css("visibility","hidden"),window.print(),A("body").css("visibility","visible")});function r(e){m=s.height(),f=s.width();for(var o,t=Math.ceil(m/h),n=0;n<t;n++){var a=document.createElement("canvas"),d=a.getContext("2d");a.width=f,a.height=h,p.height<h+5&&(h=p.height-5),a.height=h,d.drawImage(p,0,n*h,f,h+5,0,0,a.width,a.height+5);for(var r=d.getImageData(0,0,a.width,a.height),i=r.data,c=0;c<i.length;c+=4)i[c+3]<255&&(i[c]=255,i[c+1]=255,i[c+2]=255,i[c+3]=255);d.putImageData(r,0,0),u.push(a.toDataURL("image/jpeg"))}o=u.length-1,k(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/jspdf"],function(){var t=new jsPDF;u.forEach(function(e){t.addImage(e,"JPEG",10,9),o&&t.addPage(),o--}),void 0!==A.browser.safari?t.output("datauri"):t.save(void 0),s.attr("style",""),A("body").attr("style",""),A(l.htmlNode).find(".popup-container.opened").removeClass("download-in-progress"),A(l.htmlNode).find(".modal.popup-container.opened .button-options").show()})}var s,p,h,m,f,i=[],u=[];A(l.htmlNode).find(".tc-overlay .popup-download").on("click",function(){A(l.htmlNode).find(".modal.popup-container.opened .button-options").hide(),(0==A(l.htmlNode).find(".modal-content .ind-row table").length||0<A(l.htmlNode).find(".modal-content .ind-row table p").length)&&(A(l.htmlNode).find(".popup-container.opened").addClass("download-in-progress"),setTimeout(function(){s=A(l.htmlNode).find(".modal-content"),i=[760,888],A(window).outerWidth()<790&&540<A(window).outerWidth()&&(i[0]=550),h=i[1],m=s.height(),A("body").scrollTop(0),(u=[]).length=0,new Promise(function(t,e){k(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/html2canvas"],function(){html2canvas(s,{onrendered:function(e){t(e)}})})}).then(function(e){(p=new Image).src=e.toDataURL("image/jpeg"),p.onload=r})},100))});var c=[];A(l.htmlNode).find(".hidden-country-codes li").each(function(){c.push(A(this).text())});for(var g='<select class="form-control country-codes">',v=0;v<c.length;v++)g=g+'<option value="'+c[v]+'">'+c[v]+"</option>";g+="</select>";var b=b$.portal.portalModel.serverURL,e=A('<img class="refresh-icon">');e.attr("src",b+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/refresh.png");var y,N,w,T,x,B,C,D,S=A('<img id ="voice-icon">');function O(){A.ajax({url:window.location.origin+"/services/proxy/getCaptcha",type:"GET",async:!1,success:function(e){e=JSON.parse(e);y=e.captchaId,""!=N&&(N=" "),N="data:data/png;base64,"+e.captchaImg,w=e.captchaAudio,(T=A('<img id="captcha-image">')).attr("src",N),""==N||"undefined"==N?A(l.htmlNode).find(".sms-captcha-container").addClass("captcha-not-pres"):(A(l.htmlNode).find(".sms-captcha-container").removeClass("captcha-not-pres"),A(l.htmlNode).find(".captcha-image").append(T))}})}function P(){A(l.htmlNode).find(".captcha-image").empty(),A(l.htmlNode).find(".get-captcha-error").hide(),A(l.htmlNode).find(".get-sms-error").hide(),A(l.htmlNode).find(".captcha-input").removeClass("captcha-error"),O()}function I(){var e,t;""!=D?(e={captchaId:y,mobileNumber:C.trim()+B.trim(),captchaValue:D.trim(),appId:a},e=JSON.stringify(e),t=window.location.origin+"/services/proxy/verifyCaptcha",A.ajax({method:"POST",url:t,headers:{"Content-Type":"text/plain"},data:e}).done(function(e){e=JSON.parse(e);0==e.rc.returncode?(A(l.htmlNode).find(".get-sms-error").hide(),A(l.htmlNode).find(".modal-body").hide(),A(l.htmlNode).find(".download-success-container").show()):"A1208"==e.rc.errorcode?(P(),A(l.htmlNode).find(".get-captcha-error").show(),A(l.htmlNode).find(".captcha-input").addClass("captcha-error")):L()}).fail(function(e){L()})):(P(),A(l.htmlNode).find(".get-sms-error").hide(),A(l.htmlNode).find(".get-captcha-error").show(),A(l.htmlNode).find(".captcha-input").addClass("captcha-error"))}function L(){A(l.htmlNode).find(".get-sms-error").hide(),A(l.htmlNode).find(".modal-body").hide(),A(l.htmlNode).find(".download-error-container").show()}S.attr("src",b+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/voice.png"),A(l.htmlNode).find(".get-sms-interaction-code").append(g),A(l.htmlNode).find(".get-sms-interaction").append('<input type="text" name="mobile-number" placeholder="Enter Mobile Number" class="form-control mobile-number" />'),A(l.htmlNode).find(".get-sms-interaction").append('<label class="get-sms-error col-xs-12">Sorry, You have entered an invalid phone number. Please enter your valid phone number.</label>'),A(l.htmlNode).find(".refresh").append(e),A(l.htmlNode).find(".voice").append(S),A(l.htmlNode).find(".captcha-input-val").append('<label class="captcha-text">Type the text displayed above.</label>'),A(l.htmlNode).find(".captcha-input-val").append('<input type="text" name="captcha-input" class="form-control captcha-input"/>'),A(l.htmlNode).find(".captcha-input-val").append('<label class="get-captcha-error col-xs-12">Text did not match. Please type the correct code displayed above.</label>'),A(l.htmlNode).find(".get-sms-btn").append('<a class="btn-primary send-code">GET LINK</a>'),A(l.htmlNode).find(".refresh").click(function(){P()}),A(l.htmlNode).find(".voice").click(function(){var e=new Audio("data:audio/mp3;base64,"+w);e.play(),A(l.htmlNode).find(".close-button,.logo-section .icon-left-open-big").on("click",function(){e.pause()})}),A(l.htmlNode).find(".get-sms-btn").click(function(){x=/^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[6789]\d{9}$/i,B=A(l.htmlNode).find(".mobile-number").val(),C=A(l.htmlNode).find(".country-codes option:selected").text(),D=A(l.htmlNode).find(".captcha-input").val(),"91"==C.replace("+","")?x.test(B)?I():(A(l.htmlNode).find(".get-sms-error").show(),A(l.htmlNode).find(".get-captcha-error").hide(),A(l.htmlNode).find(".captcha-input").removeClass("captcha-error")):""!=B||"undefined"==B?""!=D||"undefined"==D?I():(A(l.htmlNode).find(".get-captcha-error").show(),A(l.htmlNode).find(".captcha-input").addClass("captcha-error"),A(l.htmlNode).find(".get-sms-error").hide()):A(l.htmlNode).find(".get-sms-error").show()})}}});var u="cs";return{prefModified:function(e){e.refreshIncludes();var t=A(e.htmlNode);A(".bd-structured-content-widget",t).attr("data-type",e.getPreference("contentType")||"Content")},start:function(r){var o,e=r.getPreference("contentRef"),n=A(r.htmlNode),t=!1;try{top.bd}catch(e){t=!0}for(var a,d=!(!window.be||t)&&be.utils.module("top.bd.PageMgmtTree.selectedLink").isMasterPage||"true"===r.model.manageable||""===r.model.manageable||void 0===r.model.manageable,i=[],c=0;c<r.model.preferences.array.length;c++)"templateUrl"==r.model.preferences.array[c].name&&(a=r.model.preferences.array[c].value);var l=r.getPreference("urlContent"),s=b$.portal.portalModel.serverURL;null!=l&&(p=l.indexOf("content"),h=l.slice(p,l.length),l=s+"/"+h);var t=b$.portal.portalModel.serverURL,p=t+"/static/features/%5BBBHOST%5D/feature-hdfc-slick-slider/media/pop-close.png";A(".close-icon-url").attr("src",p);var h=t+"/static/features/%5BBBHOST%5D/feature-hdfc-download-pdf/media/print-36-26.png",p=t+"/static/features/%5BBBHOST%5D/feature-hdfc-download-pdf/media/download-36-26.png";A(".tc-overlay .button-options .popup-print img").attr("src",h),A(".tc-overlay .button-options .popup-download img").attr("src",p);var m,f,p=t+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/success-arrow.png",t=t+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/failure.png";A(".tc-overlay .download-success-container img").attr("src",p),A(".tc-overlay .download-error-container img").attr("src",t),null==a||(i=a.split("/")),d&&(e||n.addClass("bd-empty-structured-content"),A(".bd-structured-content-widget",n).attr("data-type",r.getPreference("contentType")||"Content"),r.addEventListener("preferences-form",function(e){for(var t=b$.portal.portalModel.filterPreferences(r.model.preferences.array),o=t.length-1;0<=o;o--)if("Template"==t[o].label)for(var n=r.getPreference("templateList").split(","),a=0,d=0;a<n.length;a++,d++)t[o].inputType.options[d]={label:n[a],value:n[a+1]},a++}),r.addEventListener("bdDrop.enter",function(e){e=e.detail.info.helper.bdDragData.fileDataArray[0];e.metaData&&e.metaData["cmis:objectTypeId"]&&"bb:structuredcontent"===e.metaData["cmis:objectTypeId"].property?(o=e,n.addClass("bd-over-structured-content")):o=void 0}),r.addEventListener("bdDrop.leave",function(e){n.removeClass("bd-over-structured-content")}),r.addEventListener("bdDrop.drop",function(e){var t=e.detail.info.helper.bdDragData.fileDataArray[0];o&&(r.model.preferences.getByName("contentRef")||(e=b$.portal.portalModel.createPreference("contentRef","contentRef",void 0,""),r.model.preferences.add(e)),r.setPreference("urlContent",t.url),r.setPreference("contentRef",[u,"contentRepository"===o.repository?o.repository:"@portalRepository",o.contentUId].join(":")),r.model.save(function(){r.refreshHTML(),n.removeClass("bd-empty-structured-content")}),n.removeClass("bd-over-structured-content")),o=void 0}),window.bd&&window.bd.bindDropEvents&&window.bd.bindDropEvents(r.htmlNode),m=r.getPreference("overlayType"),f=r.getPreference("occurrenceSeq"),"tc-overlay.html"==i[i.length-1].trim()&&require(["tc-overlay"],function(e){e.tcOverlay(r,l,m,f,s)}))}}}(jQuery);
