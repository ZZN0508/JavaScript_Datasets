YUI.add("af-applet-view",function(h,e){"use strict";var s=h.Af.Utils.perfStart,r=h.Af.Utils.perfStop,n=h.Af.Bootstrap,a=h.Lang.isFunction,u="error",d="viewrender",o="viewupdate";h.namespace("Af").AppletView=h.Base.create("AfAppletView",h.View,[],{isDirty:!1,tmplPrefix:"ape-applet-templates-",_handles:[],autoRender:!0,isEditView:!1,initializer:function(t){this._handles.push(this.after("displayChange",function(e){this.fireEvent("viewdisplay",{prevRegion:e.prevVal,newRegion:e.newVal})},this)),this._handles.push(this.after("viewrender",function(){var t=this;h.use("stencil",function(e){e.Stencil.initAll(t.get("container"))})},this)),h.each(["autoRender"],function(e){h.Object.owns(t,e)&&(this[e]=t[e])},this),this.autoRender&&(this._dataHandle=this.get("model").after("dataChange",function(){this.isDirty=!0,this.render()},this))},destructor:function(){this._dataHandle&&(this._dataHandle.detach(),delete this._dataHandle),this.get("container").destroy(!0),h.Array.each(this._handles,function(e){e.detach()}),delete this.tmplPrefix,delete this.isDirty,delete this._handles},getTemplate:function(){if(this._template)return this._template;var e=this.get("name"),t=n.getTemplateName(this.get("guid"),e);return dust.cache[t]?this._template=t:(t=this.tmplPrefix+e,dust.cache[t]?this._template=t:null)},loadLazyTemplates:function(t){a(t)||(t=null);var e=n.getLazyLoadYuiModules(this.get("guid"),"templates"),i=h.Array.filter(e,function(e){return!dust.cache[e]});0!==i.length?h.use(i,function(){var e;t&&((e=h.Array.filter(i,function(e){return!dust.cache[e]}))&&0<e.length?t(e):t())}):t&&t()},refresh:function(){throw"refresh() not implemented"},setHTML:function(e){return h.Af.Dom.setHTML(this.get("container"),e),this},shouldRender:function(){return this.isDirty||!this.hasContent()},render:function(){return this.shouldRender()&&this.loadLazyTemplates(h.bind(this._render,this)),this},_render:function(){var e,i,t,n=this.getTemplate();return n?(t=this.get("type")+":"+this.get("name")+":",s(i=t+"tojson"),e=this.get("model").toJSON(),r(i),s(i=t+"dust"),dust.render(n,e,h.bind(function(e,t){r(i),e?this.fireEvent(u,{code:d,message:e.message||e}):(this.setHTML(t),this.isDirty=!1,this.fireEvent(d))},this))):this.fireEvent(u,{code:d,message:"no template found"}),this},forceRender:function(){return this.isDirty=!0,this.render()},update:function(i,e,t,n,s){"function"==typeof(n=n||{})&&(s=n,n={});var r,a=this.get("container"),d=this.get("model");return i="string"==typeof i?a.one(i):i,e&&dust.cache[e]?t?i||(r="can't find node"):r="missing data":r="missing template:"+e,r?(this.fireEvent(u,{code:o,message:r}),s&&window.setTimeout(function(){s(r)},0)):(d=h.merge(t,{i18n:d.get("i18n"),intl:d.get("intl")}),dust.render(e,d,h.bind(function(e,t){return e?(this.fireEvent(u,{code:o,message:e.message||e}),s&&s(e)):("append"===n.mode?i.append(t):h.Af.Dom.setHTML(i,t),a.contains(i)&&this.fireEvent(o),s&&s(null,t))},this))),this},hasContent:function(){var e=this.get("container");return""!==h.Lang.trim(e.getHTML())},fireEvent:function(e,t){var i={applet:{guid:this.get("guid"),type:this.get("type"),view:{name:this.get("name")}}};i[e]=t||{},this.fire(e,i)},getRapid:function(){var e=h.Af.rapid;return(e&&a(e.getRapidTracker)?e.getRapidTracker():h.rapid)||null},rapidBeaconClick:function(e,t){var i=h.Af.rapid;e&&i&&a(i.triggerBeaconClickEvent)&&i.triggerBeaconClickEvent(e,t)},rapidParseYLK:function(e){var t=h.Af.rapid;if(e&&t&&a(t.parseYLK))return t.parseYLK(e)},rapidGetSec:function(e){var t=h.Af.rapid;if(e&&t&&a(t.getSecValue))return t.getSecValue(e)}},{ATTRS:{guid:{},type:{},name:{},model:{},display:{value:null}}})},"@VERSION@",{requires:["af-bootstrap","af-utils","base-build","dust","view"]});
