(self.AMP=self.AMP||[]).push({n:"amp-auto-lightbox",ev:"0.1",l:!0,v:"2106030132000",m:0,f:function(t,e){"use strict";var o;function n(){var o=this;this.promise=new Promise(function(t,e){o.resolve=t,o.reject=e})}function i(t){return t?Array.prototype.slice.call(t):[]}!function(t){for(var e=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],o=0;o<e.length;++o){var n=e[o];if(n&&n.Math==Math)return}!function(){throw Error("Cannot find global object")}()}(this),"function"==typeof Symbol&&Symbol("x");var r=self.AMP_CONFIG||{},a=("string"==typeof r.cdnProxyRegex?new RegExp(r.cdnProxyRegex):r.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function l(t){!self.document||!self.document.head||self.location&&a.test(self.location.origin)||(t=self.document.head.querySelector('meta[name="'+t+'"]'))&&t.getAttribute("content")}r.cdnUrl||l("runtime-host"),r.geoApiUrl||l("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var u=self.__AMP_LOG;function p(){if(u.dev)return u.dev;throw Error("failed to call initLogConstructor")}function h(t,e){return b(t=t.__AMP_TOP||(t.__AMP_TOP=t),e)}function m(t,e){return b(g(d(t)),e)}function d(t){return t.nodeType?h((t.ownerDocument||t).defaultView,"ampdoc").getAmpDoc(t):t}function g(t){return(t=d(t)).isSingleDoc()?t.win:t}function b(t,e){return v(t,e),(t=(t.__AMP_SERVICES||(t.__AMP_SERVICES={}))[e]).obj||(t.obj=new t.ctor(t.context),t.context=null,t.resolve&&t.resolve(t.obj)),t.obj}function v(t,e){return(t=t.__AMP_SERVICES&&t.__AMP_SERVICES[e])&&t.ctor}function _(t){return t.closest?t.closest("a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]"):function(t,e){for(;t&&void 0!==t;t=t.parentElement)if(e(t))return t;return}(t,function(t){var e=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector;return e&&e.call(t,"a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]")})}var c,s,P={bubbles:!0,cancelable:!0};function w(t){if(c&&c.has(t))return c.get(t).promise;!function(t){c||(c=new WeakMap,s=new WeakMap);var e,o,n,r,i=s.get(t);return i||(o=t,r=(n=r=void 0===(r={needsRootBounds:!(e=function(t){for(var e=new Set,o=t.length-1;0<=o;o--){var n=t[o].target;e.has(n)||(e.add(n),i.unobserve(n),c.get(n).resolve(t[o]),c.delete(n))}})})?{}:r).needsRootBounds,i=new o.IntersectionObserver(e,{threshold:n.threshold,root:o.parent&&o.parent!=o&&r?o.document:void 0}),s.set(t,i)),i}(t.ownerDocument.defaultView).observe(t);var e=new n;return c.set(t,e),e.promise}/nochunking=1/.test(self.location.hash),o=o||Promise.resolve(void 0),new WeakMap,new WeakMap;var f={Article:!0,NewsArticle:!0,BlogPosting:!0,LiveBlogPosting:!0,DiscussionForumPosting:!0};function y(){}var A=/\s+([0-9]+)w(,|[\S\s]*$)/g;function x(t){return m(t,"mutator").mutateElement(t,function(){t.setAttribute("i-amphtml-auto-lightbox-visited","")})}function M(t){return(e=t).tagName.startsWith("AMP-"),(e.createdCallback?Promise.resolve(e):(e.__AMP_UPG_PRM||(t=new n,e.__AMP_UPG_PRM=t.promise,e.__AMP_UPG_RES=t.resolve),e.__AMP_UPG_PRM)).then(function(t){return t.signals().whenSignal("load-end")});var e}function S(t){return i(t.getRootNode().querySelectorAll('script[type="application/ld+json"]')).map(function(t){try{var e=JSON.parse(t.textContent)}catch(t){e=null}return(e||{})["@type"]}).filter(Boolean).some(function(t){return f[t]})}var E,R=0;function j(f,t){t.map(function(s){return M(s).then(function(){return w(s).then(function(t){var e,o,n=t.boundingClientRect;if(t=s.signals().get("load-end")){t=n.width;var r,i=n.height,a=s.querySelector("img"),l=a.naturalHeight,u=a.naturalWidth,n=u/l,c=-1;if(a=a.getAttribute("srcset"))for(;r=A.exec(a);)c<(r=parseInt(r[1],10))&&(c=r);l=(u=u<c?{naturalWidth:c,naturalHeight:c/n}:{naturalWidth:u,naturalHeight:l}).naturalHeight,u=u.naturalWidth,n=(c=m(s,"viewport").getSize()).width,c=c.height,(t=1.2<=u*l/(t*=i)||n<u||c<l||.25<=t/(n*c))&&(t=!_(s)&&!(v(t=g(t=d(s)),"action")?b(t,"action"):null).hasResolvableAction(s,"tap"))}if(t)return p().info("amp-auto-lightbox","apply",s),o=s,m(e=f,"mutator").mutateElement(o,function(){o.setAttribute("lightbox","i-amphtml-auto-lightbox-"+R++)}).then(function(){h(e.win,"extensions").installExtensionForDoc(e,"amp-lightbox-gallery");var t=o.ownerDocument.createEvent("Event");return t.data={},t.initEvent("amp-auto-lightbox:newly-set",P.bubbles,P.cancelable),o.dispatchEvent(t),o})})},y)})}function C(t,e){var o,n;function r(t){return!!n.getRootNode().querySelector(t)}n=t,(o=r('script[custom-element="amp-lightbox-gallery"]')&&r("[lightbox]:not([i-amphtml-auto-lightbox-visited])")?0:"article"==(o=(o=t.getRootNode().querySelector('meta[property="og:type"]'))?o.getAttribute("content"):void 0)||S(t))?((o=i((e||t.win.document).querySelectorAll("amp-img:not([lightbox]):not([i-amphtml-auto-lightbox-visited])"))).forEach(x),j(t,o)):p().info("amp-auto-lightbox","disabled")}(E=self.AMP.ampdoc).whenReady().then(function(){E.getRootNode().addEventListener("amp:dom-update",function(t){C(E,t.target)}),C(E)})}});
