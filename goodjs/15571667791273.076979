Rmodules&&"function"==typeof Rmodules.define&&Rmodules.define("R.api.top","1.7.0",["R^1","R.api^1"],[],function(e,t,n){return function(a){"use strict";var t=a.$,s={Status:{SUCCESS:0,EMPTY:1,NOT_LOGGED:2},loadBookmarkItems:function(e){var r=t.Deferred(),e=t.extend({mock_id:"BOOKMARK",limit:20},e),e=a.extendApiSettings({url:"https://g01.api.bookmark.rakuten.co.jp",data:{param2:e.limit}},e);return a.requestData(e).fail(r.reject).done(function(t){var e,n,i,o=[];if(t&&-1!==a.find(s.Status,function(e){return e===t.code})){if(t.items)for(e=0,n=t.items.length;e<n;e++)i=new a.Item(t.items[e]),o.push(i);r.resolve(o,t.code)}else r.reject(t)}),r.promise()}};a.api.bookmark=s,a.api.bookmark}(e),function(r){"use strict";var t=r.$,a={1:1,2:2},s={1:"//recommend.api.rakuten.co.jp/ichiba/ranking/items.json",2:"//grp03.api.rp.rakuten.co.jp/geap/v1/ichiba/rcmd/recommend_ichiba.json"},d=["Success","NotFound"],n={1:{ICHIBA_TOP:"1",STEP5:"34"},2:{ICHIBA_TOP:"00-00-000-001",STEP5:"00-00-000-034"}};r.api.inShopRanking={Encoding:{UTF_8:"utf-8",EUC_JP:"euc-jp"},ServiceId:{ICHIBA_TOP:"ICHIBA_TOP",STEP5:"STEP5"}},r.api.inShopRanking.ResponseData=function(e){if(this.shops=[],e.shops)for(var t=e.shops,n=t.length,i=0;i<n;i++)this.shops.push(new r.api.inShopRanking.Shops(t[i]))},r.api.inShopRanking.Shops=function(e){var t,n,i=e.items||e.item;for(this.items=[],t=0,n=i.length;t<n;t++)this.items.push(new r.Item(i[t]));e.tracking_tag&&(this.rtg=e.tracking_tag)},r.api.inShopRanking.getServiceId=function(e,t){return n[e][t]},r.api.inShopRanking.loadItems=function(e,n){var i=t.Deferred(),o=t.extend({mock_id:"SHOP_RANKING",version:a[1]},e);if(!o.sid)throw"required options.sid not set";if(!(o.version in a))throw"required version is not valid or unspecified";return e=s[o.version],o.sid=r.api.inShopRanking.getServiceId(o.version,o.sid),e=r.extendApiSettings({url:e,data:{sid:o.sid,topn:o.max_items}},o),o.version===a[1]?e.data.shop_ids=n:o.version===a[2]&&(e.data.shop_id=n,e.traditional=!0,r.isArray(n)&&(e.data.groupby="shop_id")),o.encoding&&(e.data.encoding=o.encoding),r.requestData(e).fail(i.reject).done(function(e){var t=!1;!e||o.version!==a[1]||0!==e.code&&1!==e.code?e&&o.version===a[2]?(r.isArray(n)||(t=0===e.item.length,e=[e]),-1!=d.indexOf(e[0].status)?i.resolve(new r.api.inShopRanking.ResponseData(t?{}:{shops:e})):i.reject(e)):i.reject(e):i.resolve(new r.api.inShopRanking.ResponseData(e))}),i.promise()}}(e),function(p){"use strict";var c=p.$,u="//ashiato.rakuten.co.jp/rms/sd/ashiato/vc",l="//browsing.history.api.prod.jp.local/rms/sd/ashiato/bvc",f={Action:{SHOW:6,DELETE:7},Type:{ITEM:1,SEARCH_KEYWORD:2,MERCHANT:3,PRODUCT:4,GENRE:5,ITEM_PRODUCT:14},Encoding:{UTF_8:1,EUC_JP:2},ServiceId:{ICHIBA_TOP:1,WS_IZA:20010049},DisplayOrder:{PRICE_ASC:1,PRICE_DESC:2,BROWSING_TIME_DESC:5,BROWSING_TIME_ASC:6,AFFILIATE_RATE_ASC:7,AFFILIATE_RATE_DESC:8,REVIEW_NUMBER_ASC:9,REVIEW_NUMBER_DESC:10,BROWSING_TIME_EARLIER_DESC:51,BROWSING_TIME_EARLIER_ASC:61,BROWSING_TIME_LATER_DESC:52,BROWSING_TIME_LATER_ASC:62},Category:{ALL:0,SHOPPING_AVAILABLE:1,GROUP_BUY:2,RAKUTEN_AUCTION_BC_CC:3,PRESENT:4,CATALOG_REQUEST:5,RAKUTEN_AUCTION:6,RAKUTEN_BOOKS:7,ICHIBA_MERCHANT:8,NORMAL_ITEM:9},ApiErrorHandleType:{ICHIBA_AND_API:1,ONLY_ICHIBA:2,ONLY_API:3,ICHIBA_OR_API:4},loadItems:function(e){var r=c.Deferred(),t=c.extend({mock_id:"BROWSING_HISTORY_LOAD_ITEMS",encoding:f.Encoding.EUC_JP,outputPage:1,genres:[],order:f.DisplayOrder.BROWSING_TIME_DESC,category:f.Category.ALL,apiErrorHandleType:f.ApiErrorHandleType.ICHIBA_AND_API,nameMaxLength:50,secure:!1,internal:!1},e);if(!t.sid)throw"options.sid required";return e=p.extendApiSettings({url:t.internal?l:u,data:{act:f.Action.SHOW,k:f.Type.ITEM,sid:t.sid,c:t.encoding,p:t.outputPage,s:t.order,e:t.category,es:t.apiErrorHandleType,in:t.nameMaxLength,secure:t.secure}},t),t.internal&&t.easyId&&(e.data.eid=t.easyId),0<t.genres.length&&(e.url=p.addSerializedArrayToUrl(e.url,"g",t.genres)),t.browsingTime&&50<t.order&&(e.d=p.Date(t.browsingTime).getNumericFormat({longYear:!1,seconds:!0})),p.requestData(e).fail(function(e){r.reject(e)}).done(function(e){var t,n,i,o=[];if(e&&0===e.code){for(t=0,n=e.items.length;t<n;t++)i=e.items[t],o.push(new p.Item(i));r.resolve(o)}else e&&1===e.code?r.resolve(o):r.reject(e)}),r.promise()},loadSearchKeyWords:function(e){var r=c.Deferred(),t=c.extend({mock_id:"BROWSING_HISTORY_LOAD_SEARCH_KEYWORDS",encoding:f.Encoding.EUC_JP,outputPage:1,internal:!1,order:f.DisplayOrder.BROWSING_TIME_DESC,category:f.Category.ALL,apiErrorHandleType:f.ApiErrorHandleType.ICHIBA_AND_API},e);if(!t.sid)throw"options.sid required";return e=p.extendApiSettings({url:t.internal?l:u,data:{act:f.Action.SHOW,k:f.Type.SEARCH_KEYWORD,sid:t.sid,c:t.encoding,p:t.outputPage,s:t.order,e:t.category}},t),t.internal&&t.easyId&&(e.data.eid=t.easyId),p.requestData(e).fail(function(e){r.reject(e)}).done(function(e){var t,n,i,o=[];if(e&&0===e.code){for(t=0,n=e.searchs.length;t<n;t++)i=e.searchs[t],o.push(new p.SearchKeyword(i));r.resolve(o)}else e&&1===e.code?r.resolve(o):r.reject(e)}),r.promise()},loadMerchants:function(e){var r=c.Deferred(),t=c.extend({mock_id:"BROWSING_HISTORY_LOAD_MERCHANTS",encoding:f.Encoding.EUC_JP,outputPage:1,internal:!1,order:f.DisplayOrder.BROWSING_TIME_DESC,category:f.Category.ALL,apiErrorHandleType:f.ApiErrorHandleType.ICHIBA_AND_API},e);if(!t.sid)throw"options.sid required";return e=p.extendApiSettings({url:t.internal?l:u,data:{act:f.Action.SHOW,k:f.Type.MERCHANT,sid:t.sid,c:t.encoding,p:t.outputPage,s:t.order,e:t.category,es:t.apiErrorHandleType}},t),t.internal&&t.easyId&&(e.data.eid=t.easyId),p.requestData(e).fail(function(e){r.reject(e)}).done(function(e){var t,n,i,o=[];if(e&&0===e.code){for(t=0,n=e.shops.length;t<n;t++)i=e.shops[t],o.push(new p.Shop(i));r.resolve(o)}else e&&1===e.code?r.resolve(o):r.reject(e)}),r.promise()},loadProducts:function(e){var r=c.Deferred(),t=c.extend({mock_id:"BROWSING_HISTORY_LOAD_PRODUCTS",encoding:f.Encoding.EUC_JP,outputPage:1,internal:!1,order:f.DisplayOrder.BROWSING_TIME_DESC},e);if(!t.sid)throw"options.sid required";return e=p.extendApiSettings({url:t.internal?l:u,data:{act:f.Action.SHOW,k:f.Type.PRODUCT,sid:t.sid,c:t.encoding,p:t.outputPage,s:t.order,e:f.Category.ALL}},t),t.internal&&t.easyId&&(e.data.eid=t.easyId),p.requestData(e).fail(function(e){r.reject(e)}).done(function(e){var t,n,i,o=[];if(e&&0===e.code){for(t=0,n=e.products.length;t<n;t++)i=e.products[t],o.push(new p.Product(i));r.resolve(o)}else e&&1===e.code?r.resolve(o):r.reject(e)}),r.promise()},loadItemProducts:function(e){var r=c.Deferred(),t=c.extend({mock_id:"BROWSING_HISTORY_LOAD_ITEM_PRODUCTS",encoding:f.Encoding.EUC_JP,outputPage:1,internal:!1,order:f.DisplayOrder.BROWSING_TIME_DESC},e);if(!t.sid)throw"options.sid required";return e=p.extendApiSettings({url:t.internal?l:u,data:{act:f.Action.SHOW,k:f.Type.ITEM_PRODUCT,sid:t.sid,c:t.encoding,p:t.outputPage,s:t.order,e:f.Category.ALL}},t),t.internal&&t.easyId&&(e.data.eid=t.easyId),p.requestData(e).fail(function(e){r.reject(e)}).done(function(e){var t,n,i,o=[];if(e&&0===e.code){for(t=0,n=e.itemproducts.length;t<n;t++)i=e.itemproducts[t],o.push(new p.Product(i));r.resolve(o)}else e&&1===e.code?r.resolve(o):r.reject(e)}),r.promise()}};f.remove=function(e){var t,n,i,o,r,a=c.Deferred(),s=c.extend({mock_id:"BROWSING_HISTORY_REMOVE",elements:[],secure:!1,internal:!1},e),d=[];if(!s.sid)throw"options.sid required";if(0!==s.elements.length){for((e=s.elements[0])instanceof p.Item?(n=function(e,t){return e+":"+t.getItemId()+":"+t.getShopId()+":"+t.getShopUrl()},i=f.Type.ITEM):e instanceof p.SearchKeyword?(n=function(e,t){return e+":"+t.getHash()},i=f.Type.SEARCH_KEYWORD):e instanceof p.Merchant?(n=function(e,t){return e+":"+t.getShopUrl()},i=f.Type.MERCHANT):e instanceof p.Product&&(n=function(e,t){return e+":"+t.getRanCode()},i=f.Type.PRODUCT),o=0,r=s.elements.length;o<r;o++)try{t=n(s.sid,s.elements[o]),d.push(t)}catch(e){}return i=p.extendApiSettings({url:p.addSerializedArrayToUrl(s.internal?l:u,"ih",d),data:{act:f.Action.REMOVE,k:i,sid:s.sid}},s),s.internal&&s.easyId&&(i.data.eid=s.easyId),p.requestData(i).fail(function(e){a.reject(e)}).done(function(e){e&&0===e.code?a.resolve():a.reject(e)}),a.promise()}},p.api.browsingHistory=f,p.api.browsingHistory}(e),function(a){"use strict";var n=a.$,i="https://grp03.api.rp.rakuten.co.jp/geap/v1/ichiba/rcmd/recommend_shop.json";a.api.shopRecommendation={ServiceId:{PC:"00-00-000-007",SP:"00-00-000-006",STEP5:"00-00-000-030",STEP5_ITEMS:"00-00-000-038"},Encoding:{UTF_8:"utf-8",EUC_JP:"euc-jp"}},a.api.shopRecommendation.loadRecommendedShops=function(e,t){var r=n.Deferred(),e=n.extend({mock_id:"SHOP_RECOMMEND"},e);if(!e.sid)throw"required options.sid not set";return t=a.extendApiSettings({url:i,data:{sid:e.sid,shop_id:t}},e),e.encoding&&(t.data.encoding=e.encoding),a.requestData(t).fail(r.reject).done(function(e){var t,n,i,o=[];if(!e||"Success"!==e.status&&"NotFound"!==e.status)r.reject(e);else{for(t=0,n=e.item.length;t<n;t++)i=new a.Shop(e.item[t]),o.push(i);r.resolve(o)}}),r.promise()},a.api.shopRecommendation.loadRecommendShopItems=function(e,t){var r=n.Deferred(),e=n.extend({mock_id:"SHOP_RECOMMEND"},e);if(!e.sid)throw"required options.sid not set";return t=a.extendApiSettings({url:i,data:{sid:e.sid,shop_id:t}},e),e.encoding&&(t.data.encoding=e.encoding),a.requestData(t).fail(r.reject).done(function(e){var t,n,i,o=[];if(!e||"Success"!==e.status&&"NotFound"!==e.status)r.reject(e);else{for(t=0,n=e.item.length;t<n;t++)i=new a.Item(e.item[t]),o.push(i);r.resolve({items:o,trackingTag:e.tracking_tag,itemCount:e.item_count})}}),r.promise()}}(e),function(a){"use strict";function i(e){for(var t,n=e.items,i=[],o=0,r=n.length;o<r;o++)t=new a.Coupon(n[o]),i.push(t);return i}var o=a.$,n=1,r="ok",s="ok";a.api.coupon={ServiceId:{ICHIBA_TOP:"001-001",ICHIBA_SEARCH:"001-002",COUPON:"001-003",ICHIBA_GENRE_TOP:"001-004",ICHIBA_EVENT_PAGE:"001-005",SP_APP:"001-006"}},a.api.coupon.ResponseData=function(e){this._data={countLimited:e.res.countLimited}},a.api.coupon.ResponseData.prototype.getCountLimited=function(){return this._data.countLimited},a.api.coupon.getSystemCouponCount=function(e){var t=o.Deferred(),e=a.extendApiSettings({url:"//api.coupon.rakuten.co.jp/getSystemCouponCount"},e);return a.requestData(e).fail(t.reject).done(function(e){e&&e.code==n?t.resolve(new a.api.coupon.ResponseData(e)):t.reject(e)}),t.promise()},a.api.coupon.loadRecommendedCouponsForUserSearch=function(e){var t=o.Deferred(),n=o.extend({mockid:"COUPON_RECOMMENDATION"},e);if(!n.sid)throw"required options.sid is not set";return e=a.extendApiSettings({url:"//grp20.api.rp.rakuten.co.jp/api/v1/userSearch/coupon.jsonp",data:{sid:n.sid}},n),n.encoding&&(e.data.encoding=n.encoding),a.requestData(e).fail(t.reject).done(function(e){!e||e.status!==r&&e.status!==s?t.reject(e):t.resolve(i(e))}),t.promise()},a.api.coupon.loadRecommendedCouponsForKeywordSearch=function(e){var t=o.Deferred(),n=o.extend({mockid:"COUPON_RECOMMENDATION"},e);if(!n.sid)throw"required options.sid is not set";if(!n.query)throw"required option query is not set";return e=a.extendApiSettings({url:"//grp20.api.rp.rakuten.co.jp/api/v1/keywordSearch/coupon.jsonp",data:{sid:n.sid,query:n.query}},n),n.encoding&&(e.data.encoding=n.encoding),a.requestData(e).fail(t.reject).done(function(e){!e||e.status!==r&&e.status!==s?t.reject(e):t.resolve(i(e))}),t.promise()}}(e),function(n){"use strict";var i=n.$;n.api.clientInfo={},n.api.clientInfo.ResponseData=function(e){this._data={countryCode:e.country_code.toLowerCase(),ip:e.ip,location:e.location}},n.api.clientInfo.ResponseData.prototype.getCountryCode=function(){return this._data.countryCode},n.api.clientInfo.ResponseData.prototype.getIp=function(){return this._data.ip},n.api.clientInfo.ResponseData.prototype.getLocation=function(){return this._data.location},n.api.clientInfo.loadClientInfo=function(e){var t=i.Deferred(),e=n.extendApiSettings({url:"https://api.r10s.jp/clientinfo",cacheTtl:60},e);return n.requestData(e).fail(t.reject).done(function(e){e&&e.country_code?t.resolve(new n.api.clientInfo.ResponseData(e)):t.reject(e)}),t.promise()}}(e),function(i){"use strict";var o=i.$;i.api.limitedPoint={},i.api.limitedPoint.ResponseData=function(e){this._data={total:e.termPointTotal,originalData:e.termPointInfo,structuredData:{}};for(var t,n=e.termPointInfo,i=0;n.length>i;i++)t=n[i].termEnd.substring(0,10),this._data.structuredData[t]=(0|this._data.structuredData[t])+n[i].termPoint},i.api.limitedPoint.ResponseData.prototype.getTotal=function(){return this._data.total},i.api.limitedPoint.ResponseData.prototype.getOriginalData=function(){return this._data.originalData},i.api.limitedPoint.ResponseData.prototype.getLimitedPoint=function(e){return this._data.structuredData[e]||0},i.api.limitedPoint.loadLimitedPointInfo=function(e){var t=o.Deferred();if(!i.user.isLogged(e.mockUserLogged))return t.reject(),t.promise();var n=""!==e.applicationId?{applicationId:e.applicationId}:{},e=i.extendApiSettings({url:"https://app.rakuten.co.jp/engine/zapi/MemberInformation/GetLimitedTimePointWithRz/20170109",data:n,cacheTtl:60},e);return i.requestData(e).fail(t.reject).done(function(e){e&&i.isArray(e.termPointInfo)?t.resolve(new i.api.limitedPoint.ResponseData(e)):t.reject(e)}),t.promise()}}(e),function(r){"use strict";var a=r.$;r.api.ppfBanner={StatusCode:{SUCCESS:91,NO_DATA:92,MAINTENANCE:81,ERROR:11,PARAMETER_ERROR:21},TargetPage:{PC_TOP:2,SP_TOP:4},DeviceType:{PC:"pc",SP:"sp",SPI:"spi",TABI:"tabi",TABA:"taba",SPIA:"spia",SPAA:"spaa",TABIA:"tabia",TABAA:"tabaa"},ChannelType:{WEB:"web",MAIL:"mail"}};var s={source_id:2,device_type:r.api.ppfBanner.DeviceType.PC,channel_type:r.api.ppfBanner.ChannelType.WEB};r.api.ppfBanner.ResponseData=function(e){this._data={statusCode:e.s,revision:e.r};var t,i,o={},e=e.c||[];a.each(e,function(e,n){o[n.i]=[],t=n.c||[],a.each(t,function(e,t){i=r.getUrlParams(t.l),o[n.i].push({landingUrl:t.l,bannerUrl:t.b,altString:t.a,offerId:i.ppo,contentId:i.ppc})})}),this._data.items=o},r.api.ppfBanner.ResponseData.prototype.getStatusCode=function(){return this._data.statusCode},r.api.ppfBanner.ResponseData.prototype.getRevision=function(){return this._data.revision},r.api.ppfBanner.ResponseData.prototype.getItems=function(e){return this._data.items[e]||[]},r.api.ppfBanner.ResponseData.prototype.getTargetId=function(){return this._data.targetId},r.api.ppfBanner.loadBannerItems=function(e,t){var n,i=a.Deferred(),o={};for(n in s)o[n]=(t&&t.hasOwnProperty(n)?t:s)[n];e=r.extendApiSettings({url:"//api.ppf.rakuten.co.jp/v1/get/",data:o},e||{});return r.requestData(e).fail(i.reject).done(function(e){return e&&e.s===r.api.ppfBanner.StatusCode.SUCCESS?i.resolve(new r.api.ppfBanner.ResponseData(e)):i.reject(e)}),i.promise()}}(e),t});
