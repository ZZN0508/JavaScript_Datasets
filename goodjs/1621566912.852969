!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.IMUID=e():t.IMUID=e()}(this,(function(){return function(){var t={575:function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},913:function(t){function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}t.exports=function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}},713:function(t){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},137:function(t,e,n){"use strict";n.d(e,{IMUID:function(){return y}});var o=n(713),i=n.n(o),r=n(575),u=n.n(r),a=n(913),c=n.n(a);function s(t){var e=new Error(t);return e.source="ulid",e}var d="0123456789ABCDEFGHJKMNPQRSTVWXYZ",f=d.length,l=Math.pow(2,48)-1;function I(t){var e=Math.floor(t()*f);return e===f&&(e=f-1),d.charAt(e)}function v(t,e){if(isNaN(t))throw new Error(t+" must be a number");if(t>l)throw s("cannot encode time greater than "+l);if(t<0)throw s("time must be positive");if(!1===Number.isInteger(t))throw s("time must be an integer");for(var n=void 0,o="";e>0;e--)o=d.charAt(n=t%f)+o,t=(t-n)/f;return o}function p(t,e){for(var n="";t>0;t--)n=I(e)+n;return n}function h(){var t=arguments.length>0&&arguments[0]!==undefined&&arguments[0],e=arguments[1];e||(e="undefined"!=typeof window?window:null);var o=e&&(e.crypto||e.msCrypto);if(o)return function(){var t=new Uint8Array(1);return o.getRandomValues(t),t[0]/255};try{var i=n(788);return function(){return i.randomBytes(1).readUInt8()/255}}catch(r){}if(t){try{console.error("secure crypto unusable, falling back to insecure Math.random()!")}catch(r){}return function(){return Math.random()}}throw s("secure crypto unusable, insecure Math.random not allowed")}function m(t){return t||(t=h()),function(e){return isNaN(e)&&(e=Date.now()),v(e,10)+p(16,t)}}m();var w=function(){function t(){u()(this,t)}return c()(t,[{key:"push",value:function(t){window.IMUID.run(t)}}]),t}(),b=function(){function t(){var e=this;u()(this,t),i()(this,"IMUIDs",{}),i()(this,"msToExpire",2592e6),i()(this,"ulid",void 0);var n=h(!0);(this.ulid=m(n),window.IMUIDRequest&&window.IMUIDRequest instanceof Array)&&(window.IMUIDRequest.forEach((function(t){e.run(t)})),window.IMUIDRequest=new w)}return c()(t,[{key:"run",value:function(e){if("customerId"in e&&"callback"in e){var n,o=e,i=this.getCookie(t.VISITOR_COOKIE_NAME)===t.OPTOUT_VALUE;if(i)return void e.callback({uid:"",vid:"",optouted:i,status:"done",loopbacks:null!==(n=null==o?void 0:o.loopbacks)&&void 0!==n?n:null});this.IMUIDs[o.customerId]={};var r=this.getVid();this.getUid({vid:r,seed:o,onLoad:function(t){var e;o.callback({vid:r,uid:t,optouted:!1,status:"done",loopbacks:null!==(e=null==o?void 0:o.loopbacks)&&void 0!==e?e:null})},onTimeout:function(){var t;o.callback({uid:"",vid:"",optouted:!1,status:"timeout",loopbacks:null!==(t=null==o?void 0:o.loopbacks)&&void 0!==t?t:null})}})}else if("optout"in e){e.optout?this.setCookie(t.VISITOR_COOKIE_NAME,t.OPTOUT_VALUE):this.setCookie(t.VISITOR_COOKIE_NAME,"")}}},{key:"get",value:function(t){return this.IMUIDs[t+""].uid}},{key:"getCookie",value:function(t){for(var e=t.length+1,n=document.cookie.split("; "),o="",i=0;i<n.length;i++)if(n[i].substr(0,e)===t+"="){o=n[i].substr(e,n[i].length);break}return o}},{key:"setCookie",value:function(t,e,n,o){var i;n=null!==(i=n)&&void 0!==i?i:"."+window.location.hostname,o=void 0===o?"https:"==window.location.protocol:!!o;var r=new Date;r.setTime(r.getTime()+this.msToExpire),document.cookie=t+"="+e+(this.msToExpire?"; expires="+r.toUTCString():"")+"; path=/"+(n?"; domain="+n:"")+(o?"; SameSite=none; Secure;":";")}},{key:"isImid",value:function(e){return"string"==typeof e&&0===e.indexOf(t.IMID_PREFIX)}},{key:"setCustomerUid",value:function(t,e){this.IMUIDs[t].uid=e}},{key:"getVid",value:function(){var e=this.getCookie(t.VISITOR_COOKIE_NAME);return e||(e=this.ulid()),this.setCookie(t.VISITOR_COOKIE_NAME,e),e}},{key:"getPreferUid",value:function(t,e){return this.isImid(e)?e:t||e}},{key:"fetchData",value:function(t){var e=t.url,n=t.onLoad,o=t.onTimeout,i=t.timeout,r=void 0===i?1e4:i,u=new XMLHttpRequest,a=setTimeout((function(){u.abort(),o&&o()}),r);u.onload=function(){clearTimeout(a),n&&n(u.responseText)},u.withCredentials=!0,u.open("GET",e,!0),u.send(null)}},{key:"getUid",value:function(e){var n=this,o=e.vid,i=e.seed,r=e.onLoad,u=e.onTimeout,a="https://".concat(i.SYNC_URL||t.SYNC_URL,"?vid=").concat(o,"&cid=").concat(i.customerId);this.fetchData({url:a,onLoad:function(t){var e=JSON.parse(t).uid,o=i.customerId,u=n.IMUIDs[o].aggrid,a=n.getPreferUid(u,e);n.setCustomerUid(o,a),r(a)},onTimeout:function(){u&&u()},timeout:i.callbackTimeout})}}]),t}();i()(b,"IMID_PREFIX","i"),i()(b,"SYNC_URL","audiencedata.im-apps.net/imuid/get"),i()(b,"VISITOR_COOKIE_NAME","_im_vid"),i()(b,"OPTOUT_VALUE","optout"),Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};var y=window.hasOwnProperty("IMUID")?window.IMUID:new b},788:function(){}},e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={exports:{}};return t[o](i,i.exports,n),i.exports}return n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n(137)}().IMUID}));