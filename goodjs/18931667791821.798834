(this.dmpJsonp=this.dmpJsonp||[]).push([["dynamic_quality_switcher"],{"6xEa":function(t,e,r){var E,s,a,i,o,n=(E=String.fromCharCode,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={},o={compressToBase64:function(t){if(null==t)return"";var e=o._compress(t,6,function(t){return s.charAt(t)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:o._decompress(e.length,32,function(t){return h(s,e.charAt(t))})},compressToUTF16:function(t){return null==t?"":o._compress(t,15,function(t){return E(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(t){for(var e=o.compress(t),r=new Uint8Array(2*e.length),s=0,a=e.length;s<a;s++){var i=e.charCodeAt(s);r[2*s]=i>>>8,r[2*s+1]=i%256}return r},decompressFromUint8Array:function(t){if(null==t)return o.decompress(t);for(var e=new Array(t.length/2),r=0,s=e.length;r<s;r++)e[r]=256*t[2*r]+t[2*r+1];var a=[];return e.forEach(function(t){a.push(E(t))}),o.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":o._compress(t,6,function(t){return a.charAt(t)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),o._decompress(e.length,32,function(t){return h(a,e.charAt(t))}))},compress:function(t){return o._compress(t,16,function(t){return E(t)})},_compress:function(t,e,r){if(null==t)return"";for(var s,a,i,o,n={},h={},l="",u=2,d=3,c=2,f=[],g=0,v=0,p=0;p<t.length;p+=1)if(i=t.charAt(p),Object.prototype.hasOwnProperty.call(n,i)||(n[i]=d++,h[i]=!0),o=l+i,Object.prototype.hasOwnProperty.call(n,o))l=o;else{if(Object.prototype.hasOwnProperty.call(h,l)){if(l.charCodeAt(0)<256){for(s=0;s<c;s++)g<<=1,v==e-1?(v=0,f.push(r(g)),g=0):v++;for(a=l.charCodeAt(0),s=0;s<8;s++)g=g<<1|1&a,v==e-1?(v=0,f.push(r(g)),g=0):v++,a>>=1}else{for(a=1,s=0;s<c;s++)g=g<<1|a,v==e-1?(v=0,f.push(r(g)),g=0):v++,a=0;for(a=l.charCodeAt(0),s=0;s<16;s++)g=g<<1|1&a,v==e-1?(v=0,f.push(r(g)),g=0):v++,a>>=1}0==--u&&(u=Math.pow(2,c),c++),delete h[l]}else for(a=n[l],s=0;s<c;s++)g=g<<1|1&a,v==e-1?(v=0,f.push(r(g)),g=0):v++,a>>=1;0==--u&&(u=Math.pow(2,c),c++),n[o]=d++,l=String(i)}if(""!==l){if(Object.prototype.hasOwnProperty.call(h,l)){if(l.charCodeAt(0)<256){for(s=0;s<c;s++)g<<=1,v==e-1?(v=0,f.push(r(g)),g=0):v++;for(a=l.charCodeAt(0),s=0;s<8;s++)g=g<<1|1&a,v==e-1?(v=0,f.push(r(g)),g=0):v++,a>>=1}else{for(a=1,s=0;s<c;s++)g=g<<1|a,v==e-1?(v=0,f.push(r(g)),g=0):v++,a=0;for(a=l.charCodeAt(0),s=0;s<16;s++)g=g<<1|1&a,v==e-1?(v=0,f.push(r(g)),g=0):v++,a>>=1}0==--u&&(u=Math.pow(2,c),c++),delete h[l]}else for(a=n[l],s=0;s<c;s++)g=g<<1|1&a,v==e-1?(v=0,f.push(r(g)),g=0):v++,a>>=1;0==--u&&(u=Math.pow(2,c),c++)}for(a=2,s=0;s<c;s++)g=g<<1|1&a,v==e-1?(v=0,f.push(r(g)),g=0):v++,a>>=1;for(;;){if(g<<=1,v==e-1){f.push(r(g));break}v++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,e,r){for(var s,a,i,o,n,h,l=[],u=4,d=4,c=3,f="",g=[],v={val:r(0),position:e,index:1},p=0;p<3;p+=1)l[p]=p;for(a=0,o=Math.pow(2,2),n=1;n!=o;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=e,v.val=r(v.index++)),a|=(0<i?1:0)*n,n<<=1;switch(a){case 0:for(a=0,o=Math.pow(2,8),n=1;n!=o;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=e,v.val=r(v.index++)),a|=(0<i?1:0)*n,n<<=1;h=E(a);break;case 1:for(a=0,o=Math.pow(2,16),n=1;n!=o;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=e,v.val=r(v.index++)),a|=(0<i?1:0)*n,n<<=1;h=E(a);break;case 2:return""}for(s=l[3]=h,g.push(h);;){if(v.index>t)return"";for(a=0,o=Math.pow(2,c),n=1;n!=o;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=e,v.val=r(v.index++)),a|=(0<i?1:0)*n,n<<=1;switch(h=a){case 0:for(a=0,o=Math.pow(2,8),n=1;n!=o;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=e,v.val=r(v.index++)),a|=(0<i?1:0)*n,n<<=1;l[d++]=E(a),h=d-1,u--;break;case 1:for(a=0,o=Math.pow(2,16),n=1;n!=o;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=e,v.val=r(v.index++)),a|=(0<i?1:0)*n,n<<=1;l[d++]=E(a),h=d-1,u--;break;case 2:return g.join("")}if(0==u&&(u=Math.pow(2,c),c++),l[h])f=l[h];else{if(h!==d)return null;f=s+s.charAt(0)}g.push(f),l[d++]=s+f.charAt(0),s=f,0==--u&&(u=Math.pow(2,c),c++)}}});function h(t,e){if(!i[t]){i[t]={};for(var r=0;r<t.length;r++)i[t][t.charAt(r)]=r}return i[t][e]}void 0===(e=function(){return n}.call(e,r,e,t))||(t.exports=e)},DqVu:function(t,e,r){"use strict";r.r(e);var a=r("XE2b"),i=r("znKg"),s=r("J4zp"),n=r.n(s),h=r("LwNu"),l=r("l/t8"),o=r("0oA5"),u=r("hHG0"),d=r("Zrx9"),c=r("i/kS"),s=r("6xEa"),f=r.n(s),g=d.default.get("Hls"),v=null;class p extends o.a{static createNew(t,e,r){return new p(t,e,r)}constructor(t,e,r){super(),v=r,this.hlsVersion=v.version||"stable",this.videoTag=t,this.resource=e,this.boundListeners=null,this.hls=null,this.manifestData=null,this.hashParams=null,this.mseAttached=!1,this.disableLevelCapping=!1,this.startLoad=!1,this.cumDownload=0,this.cumLatency=0,this.cumMux=0,this.cumBuffer=0,this.fragNb=0,this.fragDetailsNb=0,this.logArray=[],this.logMsg=null,this.resetStats(),this.logForwarder={log:function(t){this.appendMsg("log",t)}.bind(this),warn:function(t){this.appendMsg("warn",t)}.bind(this),error:function(t){this.appendMsg("error",t)}.bind(this),debug(t){g.debug(t)},info(t){g.info(t)}},this.hlsConfig={abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,autoStartLoad:!1,debug:this.logForwarder,fragLoadingMaxRetry:2,fragLoadingTimeOut:2e4,highBufferWatchdogPeriod:4,levelLoadingMaxRetry:2,levelLoadingTimeOut:15e3,liveSyncDuration:24,manifestLoadingMaxRetry:2,manifestLoadingTimeOut:3e4,maxLoadingDelay:4,maxMaxBufferLength:30,maxStarvationDelay:4,maxSeekHole:4,nudgeMaxRetry:2,nudgeOffset:.3,startFragPrefetch:"recorded"===c.a.metadata("stream_type")}}appendMsg(t,e){var r,s,a,i;e&&(this.logMsg||(r=this.logArray,s=this.stats.maxLogs||100,a=performance.now(),i=this.t0=this.t0||a,i=Math.round(a-i),r.length>=s&&r.shift(),r.push("".concat(i,",").concat(t,": ").concat(e))),g[t](e))}waitForManifest(){return new Promise((r,s)=>{var a,i;this.hls||(g.log("create hls.js (".concat(this.hlsVersion,")")),this.hls=new v(this.hlsConfig),this.bindListeners()),this.manifestData?r(this):(a=(t,e)=>{e.fatal&&(g.error("catch fatal error at startup",e),this.hls.off(v.Events.ERROR,a),this.hls.off(v.Events.MANIFEST_PARSED,i),s(e))},i=(t,e)=>{u.M.saveEnd(u.o),g.log("succeed to parse manifest",e),this.hls.off(v.Events.ERROR,a),this.hls.off(v.Events.MANIFEST_PARSED,i);e=(this.manifestData=e).levels[e.firstLevel];this.parseHashParams(e.url[e.urlId]),r(this)},u.M.save(u.o),this.hls.on(v.Events.ERROR,a),this.hls.on(v.Events.MANIFEST_PARSED,i),this.hls.loadSource(this.resource.url))})}attachVideo(){this.mseAttached||(g.log("Attach video to hls source"),this.hls.attachMedia(this.videoTag),this.mseAttached=!0,this.tvideo=performance.now())}setLevel(s,a,i){var t=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},e=t.prefetch,o=void 0!==e&&e,t=t.heuristic,n=void 0!==t&&t;return o||this.attachVideo(),this.waitForManifest().then(()=>{var t=this.hls,e=!o,r=!1;"start"===i?(a?(n&&(s=-1),g.log("set hls.startLevel=".concat(s)),t.startLevel=s,this.stats.startLevel=s):(g.log("set hls.loadLevel=".concat(s)),t.loadLevel=s),this.startLoad||(u.M.save(u.p),g.log("call hls.startLoad()"),t.startLoad(),this.computeAutoLevelCapping(),this.startLoad=!0)):"current"===i?a?(g.log("set hls.nextLevel=".concat(-1)),t.nextLevel=-1,r=!0):t.autoLevelEnabled&&t.currentLevel===s||h.m()?(g.log("set hls.nextLevel=".concat(s)),t.nextLevel=s,r=!0):(g.log("set hls.currentLevel=".concat(s)),t.currentLevel=s):(t.startLoad("replay"===i?0:-1),e=!1),e&&this.notifyLevelStateChange(this.hls.autoLevelEnabled,s),r&&this.notifyLevelStateChanged(this.hls.autoLevelEnabled,s)})}getMaxLevelIndex(){var t=Math.max(160,this.videoTag.clientWidth)*Math.max(120,this.videoTag.clientHeight),e=window.devicePixelRatio;null!=e&&(t*=e*e);var r=this.hls.levels||[],s=r.length;if(0===s)return-1;for(var a=0;a<s;a++){var i=r[a];if(.85*t<=i.width*i.height)break}return Math.min(a,s-1)}notifyLevelStateChange(t,e){this.trigger("level_state_change",{adaptive:t,levelIndex:e})}notifyLevelStateChanged(t,e){this.trigger("level_state_changed",{adaptive:t,levelIndex:e})}computeAutoLevelCapping(){var t,e;!this.hls||!this.videoTag||this.disableLevelCapping||(t=this.getMaxLevelIndex())!==(e=this.hls.autoLevelCapping)&&(g.log("new capping index:".concat(t)),this.hls.autoLevelCapping=t,this.hls.autoLevelEnabled&&0<=e&&e<t&&(g.log("smooth switch up"),this.hls.nextLevel=-1))}detachVideo(){g.log("Detach video from hls source");var t=this.hls;t&&null!==t.media&&t.detachMedia(),this.tvideo=void 0,this.mseAttached=!1}onHlsError(t,e){switch(e.details){case v.ErrorDetails.BUFFER_NUDGE_ON_STALL:var r=this.stats;r.nudgeNb=(r.nudgeNb||0)+1;break;case v.ErrorDetails.BUFFER_SEEK_OVER_HOLE:this.stats.maxBufferHole=0<this.stats.maxBufferHole?Math.max(this.stats.maxBufferHole,e.hole):e.hole;break;case v.ErrorDetails.INTERNAL_EXCEPTION:this.stats.exceptionNb++,this.stats.exception={event:e.event,stack:e.err.stack?JSON.stringify(e.err.stack).substr(0,1e3):e.err.message}}var s;e.fatal?(g.error("Received fatal HLS error:",t,e),null!==(s=this.getHTTPStats(e))&&(this.stats.http=s),this.trigger("fatal_error",{error:e.type+e.details})):g.warn("Received non-fatal HLS error:",t,e)}getHTTPStats(t){if(!t||!t.response)return null;var e={},r=t.response,t=t.frag||t.context;return r&&(e.code=parseInt(r.code||0),e.msg=(r.text||"").toLowerCase()),t&&(e.url=t.url||""),e}onLevelLoaded(t,e){u.M.hasSavedStart(u.p)&&u.M.saveEnd(u.p);var r=this.hls.config,s=this.hls.levels[e.level];s.details.live&&(this._liveEdgeDelay=0<r.liveSyncDuration?r.liveSyncDuration:r.liveSyncDurationCount*e.details.targetduration),0<s.urlId&&(this.stats.redundant=!0)}onCurrentFragmentChanged(t,e){this.notifyLevelStateChanged(this.hls.autoLevelEnabled,e.frag.level)}onFragBuffered(t,e){var r=this.stats,s=e.stats,a=s.tparsed,i=this.tvideo,o=i?Math.max(a,i):a,n=s.tload-s.trequest,h=s.tfirst-s.trequest,l=a-s.tload,u=s.tbuffered-o,d=n+l+u,c=r.minMs=r.minMs||{},f=r.maxMs=r.maxMs||{},g=this.cumDownload+=n,v=this.cumLatency+=h,p=this.cumMux+=l,i=this.cumBuffer+=u,a=g+p+i,o=++this.fragNb;r.HTTPDL+=s.loaded;h=8*r.HTTPDL;this.appendFragDetails(e.frag,s),r.latency=Math.round(v/o),r.avgKbps={total:Math.round(h/a),dl:Math.round(h/g),mux:Math.round(h/p),buffer:Math.round(h/i)},r.avgMs={total:Math.round(a/o),dl:Math.round(g/o),mux:Math.round(p/o),buffer:Math.round(i/o)},d&&(c.total=Math.round(c.total?Math.min(c.total,d):d),f.total=Math.round(f.total?Math.max(f.total,d):d)),n&&(c.dl=Math.round(c.dl?Math.min(c.dl,n):n),f.dl=Math.round(f.dl?Math.max(f.dl,n):n)),l&&(c.mux=Math.round(c.mux?Math.min(c.mux,l):l),f.mux=Math.round(f.mux?Math.max(f.mux,l):l)),u&&(c.buffer=Math.round(c.buffer?Math.min(c.buffer,u):u),f.buffer=Math.round(f.buffer?Math.max(f.buffer,u):u))}onFragLoadEmergencyAborted(t,e){this.appendFragDetails(e.frag,e.stats),this.stats.emergencyNb++}appendFragDetails(t,e){var r,s,a,i,o,n,h;this.fragDetailsNb<5&&(o=this.videoTag,n=e.tparsed,i=(h=this.tvideo)?Math.max(n,h):n,r=e.tload-e.trequest,s=e.tfirst-e.trequest,a=e.loaded,h=n-e.tload,n=e.tbuffered-i,i=t.duration,o={start:Math.round(1e3*t.start),end:Math.round(1e3*(t.start+i)),l:t.level,pos:o?Math.round(1e3*o.currentTime):-1},0<s&&(o.lat=Math.round(s)),0<r&&(o.DLdur=Math.round(r)),0<a&&(o.len=a),0<a&&(o.kbps=Math.round(8*a/(r+h+n))),e.aborted&&(o.aborted=!0),0<h&&(o.mux=Math.round(h)),0<n&&(o.buffer=Math.round(n)),h=(n=(h=this.stats).frags=h.frags||{}).minDuration,n.minDuration=h?Math.min(Math.round(i),h):Math.round(i),n["f".concat(this.fragDetailsNb)]=o,this.fragDetailsNb++)}recoverDecodingError(){var t=!this.videoTag.paused;g.log("playing state before recovery:",t);var e=()=>{this.hls.off(v.Events.MEDIA_ATTACHED,e),this.hls.startLoad(),t&&(g.log("video was playing before recovery, relaunch playback"),this.videoTag.play())};this.hls.recoverMediaError(),this.hls.on(v.Events.MEDIA_ATTACHED,e)}swapAudioCodec(){this.hls.swapAudioCodec()}bindListeners(){null==this.boundListeners&&(this.boundListeners={onCurrentFragmentChanged:this.onCurrentFragmentChanged.bind(this),onFragBuffered:this.onFragBuffered.bind(this),onFragLoadEmergencyAborted:this.onFragLoadEmergencyAborted.bind(this),onHlsError:this.onHlsError.bind(this),onLevelLoaded:this.onLevelLoaded.bind(this)},this.hls.on(v.Events.FRAG_CHANGED,this.boundListeners.onCurrentFragmentChanged),this.hls.on(v.Events.FRAG_BUFFERED,this.boundListeners.onFragBuffered),this.hls.on(v.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.boundListeners.onFragLoadEmergencyAborted),this.hls.on(v.Events.ERROR,this.boundListeners.onHlsError),this.hls.on(v.Events.LEVEL_LOADED,this.boundListeners.onLevelLoaded))}unbindListeners(){null!=this.boundListeners&&(this.hls.off(v.Events.FRAG_CHANGED,this.boundListeners.onCurrentFragmentChanged),this.hls.off(v.Events.FRAG_BUFFERED,this.boundListeners.onFragBuffered),this.hls.off(v.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.boundListeners.onFragLoadEmergencyAborted),this.hls.off(v.Events.ERROR,this.boundListeners.onHlsError),this.hls.off(v.Events.LEVEL_LOADED,this.boundListeners.onLevelLoaded),this.boundListeners=null)}streamCell(){return this.getHashParam("cell")}streamComment(){return this.getHashParam("comment")}getHashParam(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=this.hashParams;if(r){r=null!==e&&r[e]?r[e]:r;return r[t]||null}return null}parseHashParams(t){if(!this.hashParams){t=Object(l.e)(t).hash,t=void 0===t?null:t;if(t){var e,r=this.hashParams={},s=this.onHashParamParsed.bind(this),a=Object(l.d)(t,!0);for(e in a){var i=e.split("_"),o=n()(i,2),i=o[0],o=o[1],o=void 0===o?null:o;null===o?(r[e]=a[e],s(e,a[e])):(r[i]||(r[i]={}),r[i][o]=a[e],s(o,a[e],i))}g.log("Parsed hash-params:",r)}}}onHashParamParsed(t,e){switch(2<arguments.length&&void 0!==arguments[2]?arguments[2]:null){case"hls":this.updateHLSConfigParam(t,e,!0);break;case"ab":case"qos":this.stats[t]=e}}updateHLSConfigParams(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(t)for(var r in t){var s=t[r];this.updateHLSConfigParam(r,s,e)}}updateHLSConfigParam(t,e){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];"function"==typeof e?g.log("update hlsjs config param: ".concat(t,"=function(){}")):g.log("update hlsjs config param: ".concat(t,"=").concat(e));var s=this.hls?this.hls.config:this.hlsConfig;isNaN(e)||"boolean"==typeof e||(e=parseFloat(e)),s[t]=e,r&&(this.stats[t]=e)}streamStats(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=1<arguments.length?arguments[1]:void 0;return(e.verbose||!1)&&(this.logMsg||(this.logMsg=f.a.compressToBase64(this.logArray.join("\n")),this.logArray=[]),this.stats.logs=this.logMsg),r&&(t=this.hls)&&-1<t.autoLevelCapping&&(0<(t=null!==(t=r.getQualityForLevel(t.autoLevelCapping))?t.height:0)&&(this.stats.autoLevelCapping=t)),this.stats}getLiveEdgeDelay(){return this._liveEdgeDelay||0}resetStats(){this.stats={version:this.hlsVersion,HTTPDL:0,emergencyNb:0,exceptionNb:0,latency:0}}destroy(){g.log("Destroy hls source"),this.resetStats(),this.detachVideo(),this.unbindListeners();var t=this.hls;t&&(t.destroy(),this.hls=null),v=null,this.hlsVersion=null,this.manifestData=null,this.hashParams=null,this.hlsConfig=null,this.startLoad=!1}}var E=p,m=r("z/W+"),L=r("Bau3"),s=r("yTBV"),o=r("zC0q"),S=r("G1FZ"),y=d.default.get("DynamicQuality");e.default=Object(s.a)(o.a,function(){this.attributes({resource:null,autoplay:!1,autoplayAllowed:!1,dependencies:null}),this.currentSource=null,this.decodeErrorCount=0,this.freezeErrorCount=0,this.decodeErrorDate=[null,null,null],this.pendingRecovery=!1,this._createHlsSource=function(t){null!==this.currentSource&&(this.currentSource.destroy(),this._unbindSourceEvents()),this.currentSource=E.createNew(this.videoTag,t,this.attr.dependencies.Hlsjs),this.currentSource.disableLevelCapping=c.a.isVR360Enabled(),this._bindSourceEvents()},this._bindSourceEvents=function(){this.currentSource.disableLevelCapping||(this.computeAutoLevelCapping=this.currentSource.computeAutoLevelCapping.bind(this.currentSource),this.on(i.a.PLAYER_SIZE_CHANGED,this.computeAutoLevelCapping),"function"==typeof window.matchMedia&&(this.mediaQuery=window.matchMedia("screen and (min-resolution: 2dppx)"),this.mediaQuery&&this.mediaQuery.addListener(this.computeAutoLevelCapping))),this.currentSource.on("level_state_change",this._onSourceLevelStateChange,this),this.currentSource.on("level_state_changed",this._onSourceLevelStateChanged,this),this.currentSource.on("fatal_error",this._onSourceFatalError,this)},this._unbindSourceEvents=function(){this.currentSource.disableLevelCapping||(this.off(i.a.PLAYER_SIZE_CHANGED,this.computeAutoLevelCapping),this.mediaQuery&&(this.mediaQuery.removeListener(this.computeAutoLevelCapping),this.mediaQuery=null),this.computeAutoLevelCapping=null),this.currentSource.off("level_state_change",this._onSourceLevelStateChange),this.currentSource.off("level_state_changed",this._onSourceLevelStateChanged),this.currentSource.off("fatal_error",this._onSourceFatalError,this)},this._onSourceLevelStateChange=function(t){t={adaptive:t.adaptive,quality:this.qualityList.getQualityForLevel(t.levelIndex)};this.notifyQualityChangeConfirmed(t)},this._onSourceLevelStateChanged=function(t){var e=this.currentSource.getLiveEdgeDelay();0<e&&this.liveEdgeDelay!==e&&(this.liveEdgeDelay=e,this.trigger(i.a.LIVE_EDGE_DELAY_CHANGED,{delay:this.liveEdgeDelay}));t={adaptive:t.adaptive,quality:this.qualityList.getQualityForLevel(t.levelIndex)};this.decodeErrorDate=[null,null,null],this.notifyQualityChanged(t)},this._onSourceFatalError=function(t){this.videoSlotStarted&&this._handleError(t.error)},this.waitForQualityList=function(){var r=this.attr.resource||this.attr.qualities.auto.find(t=>{return t.type===m.a.HLS});return new Promise((s,e)=>{var t;null!=r?(this._createHlsSource(r),this.currentSource.waitForManifest().then(t=>{var e,r=t.manifestData.levels,t=t.resource,r=L.a.createFromLevels(r,t);this.trigger(i.a.DEBUG_UPDATE_REQUESTED,{type:"stream_origin",payload:{url:t.url,cell:this.currentSource.streamCell()}}),"videogames"===c.a.metadata("channel")&&"live"===c.a.metadata("stream_type")&&null!==(e=r.getHighestQuality())&&(e.tag="Source"),s(this.setQualityList(r))}).catch(t=>e(t))):(t=new L.a,s(this.setQualityList(t)))})},this.getStats=function(t,e){if(!this.currentSource)return{};var r,s={decodeError:this.decodeErrorCount,freezeError:this.freezeErrorCount},a=this.currentSource.streamComment();a&&(s.comment=a),this.videoTag&&("function"==typeof this.videoTag.getVideoPlaybackQuality?(r=this.videoTag.getVideoPlaybackQuality(),s.droppedVideoFrames=r.droppedVideoFrames,s.corruptedVideoFrames=r.corruptedVideoFrames):(r=this.videoTag.webkitDroppedFrameCount)&&(s.droppedVideoFrames=r));e=this.currentSource.streamStats(e,this.qualityList);e&&(s.stream=e),this.trigger(i.a.QUALITY_STATS_RESPONDED,s)},this.changeQuality=function(t,e){var r=e.isStartup,s=e.isReplay,a=e.isRecovering,i=e.prefetch,o=a?"recover":s?"replay":r?"start":"current",e=t.quality,s=this.qualityList.getLevelForQualityName(e.name),e={prefetch:i,heuristic:!1};r&&this.qualityChosenFromPlayerSize&&(e.heuristic=!0),this.pendingRecovery=a,this.currentSource.setLevel(s,t.adaptive,o,e).then(()=>{r&&!i&&this.videoTag&&this.videoTag.play()})},this.handleFirstSequenceStarted=function(){this.off(i.a.SEQUENCE_STARTED,this.handleFirstSequenceStarted),this.setup()},this.handleInitialQualitySet=function(t){this.changeQuality(t,{isStartup:!0,isReplay:!1,isRecovering:!1,prefetch:!0})},this.handleLoadedmetadataEvent=function(){var t;this.trigger(i.a.VIDEO_LOADED_METADATA,{videoTagSelector:this.attr.videoTagSelector}),this.pendingRecovery&&(this.pendingRecovery=!1,t={adaptive:this.currentSource.hls.autoLevelEnabled,quality:this.qualityList.getQualityForLevel(this.currentSource.hls.loadLevel)},this.notifyQualityChangeConfirmed(t,!0),this.notifyQualityChanged(t))},this.handleErrorEvent=function(t){var t=t.target.error||{},e=null;switch(t.code){case t.MEDIA_ERR_ABORTED:e=a.f;break;case t.MEDIA_ERR_NETWORK:e=a.h;break;case t.MEDIA_ERR_DECODE:e=a.g;break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:e=a.i;break;default:e=a.m}this._handleError(e)},this._handleError=function(t){if(y.warn("error received:",t),t===a.g||"mediaErrorbufferAppendError"===t){var e=Date.now(),r=(this.decodeErrorCount+2)%3,s=this.decodeErrorDate[r];if(!s||3e3<e-s)return this.decodeErrorCount%2&&this.swapAudioCodec(),this.decodeErrorCount++,this.decodeErrorDate[r]=e,this.recoverDecodingError()}if("mediaErrorbufferStalledError"===t){s=Date.now(),r=++this.freezeErrorCount,e=this.freezeErrorDate;if(this.freezeErrorDate=s,r<3&&(!e||1e4<s-e))return this.recoverDecodingError()}this.triggerQualitySwitcherError(t)},this.recoverDecodingError=function(){y.log("try to recover video decoding error"),this.currentSource.recoverDecodingError()},this.swapAudioCodec=function(){y.log("try to swap audio codec"),this.currentSource.swapAudioCodec()},this.streamCell=function(){return this.currentSource.streamCell()},this.streamTech=function(){return"hls.js"},this.after("initialize",function(){y.log("Initialized"),this.attr.autoplay&&this.attr.autoplayAllowed?this.handleFirstSequenceStarted():this.on(i.a.SEQUENCE_STARTED,this.handleFirstSequenceStarted),this.trigger(i.a.CAN_PLAY_ONE_SOURCE,{ok:!0}),this.on(i.a.VIDEO_ENDED,function(){this.currentSource.detachVideo()}),this.on(i.a.AD_LINEAR_WILL_START,function(t,e){e=e.position;e!==S.a.MIDROLL&&e!==S.a.LIVEADBREAK||this.currentSource.detachVideo()}),this.on(i.a.CHROMECAST_REMOTE_ENABLED,function(){this.unbindMediaEvents(),this.currentSource.detachVideo()}),this.on(i.a.CHROMECAST_SESSION_STOPPED,function(){this.resetQualityState(),this.bindMediaEvents()}),this.on(i.a.LOAD_VIDEO,function(){this.teardown()})}),this.after("teardown",function(){y.log("Torn down"),this.currentSource&&(this._unbindSourceEvents(),this.currentSource.destroy(),this.currentSource=null)})})}}]);
