!function(){var s,a,n,t,i,r,p,c,o,l,d,g,u,w,h,m,f,S,I,_=null,v=null,U=null,e=window.SSOConf;e&&e.cookieName&&e.targetDomain&&e.enableP2S?(s=e.cookieName,a=e.cookieP2S,n=e.enableP2S,t=e.enableLogs,i=e.targetDomain,r=null,p=0==document.cookie.length,c="; samesite=none; secure","http:"==window.location.protocol&&(c=""),o=window.location.protocol+"//"+window.location.host,l="https://login.kataweb.it"!=o?"https://scripts.kataweb.it/ws/pts/index_test.php?&tipo=ws&hash=":"https://scripts.kataweb.it/ws/pts/index.php?&tipo=ws&hash=",(d=function(o){t&&console.log(o)})("sso-frame - INIT - SSOConf: "+JSON.stringify(e)+" - cookie_samesite:"+c),document.cookie="kwsso-3pc=1; path=/; expires="+new Date((new Date).getTime()+45792e8)+c,g=function(o){for(var t=o+"=",e=document.cookie.split(";"),n=0;n<e.length;n++){for(var i=e[n];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null},u=function(){var o=g(s);try{return JSON.parse(unescape(o.replace(/\\"/g,'"').replace(/(^"|"$)/g,"")))}catch(o){return null}},w=function(o){o=JSON.stringify(o),window.parent.postMessage(o,i)},h=function(o){var t={op:"statusChange"};t.data=o,w(t),r=setTimeout(function(){I()},5e3)},m=function(o,t,e,n){var i="/login/SSO?op="+o+"&service="+escape(e.appId);e.origin&&(i+="&origin="+encodeURIComponent(e.origin)),e.jwt&&(i+="&id_token="+encodeURIComponent(e.jwt));o=function(){var o=window.sso_status&&"logged"==sso_status;o&=window.sso_is_registered&&"Y"==sso_is_registered,(o&=void 0!==window.sso_SSID)?(t.SSID=window.sso_SSID,e.jwt&&(t.op="login")):e.jwt&&(window.sso_status&&"no_logged"==sso_status?t.op="logout":window.sso_is_registered&&"N"==sso_is_registered&&(t.op="login_manual")),n(t)};$.ajax({url:i,dataType:"script",cache:!0,success:o,error:o})},f=function(o){var n,t,e=g(s),i=g(a);e&&!i&&(n=location.host,(t=new Date).setTime(t.getTime()+3e5),i="expires="+t.toUTCString(),1===(n=location.hostname).split(".").length?document.cookie=a+'={"swgt": ["NA"]};'+i+"; path=/"+c:(domainParts=n.split("."),domainParts.shift(),t=domainParts.join("."),document.cookie=a+'={"swgt": ["NA"]};'+i+"; path=/; domain="+t+c),e=$.parseJSON(e),e=$.parseJSON(e),e=l+e.hashId,$.getJSON(e,{}).done(function(o){var t=new Date;t.setTime(t.getTime()+864e5);var e="expires="+t.toUTCString();domainParts=n.split("."),domainParts.shift();t=domainParts.join("."),o=JSON.stringify(o);document.cookie=a+"="+o+";"+e+"; path=/; domain="+t+c}))},S=void 0,I=function(){clearTimeout(r);var o=u(),t=o&&o.hashId?o.hashId:null;d("detectUser - start - jsonjson.hashId:"+t+" -  siteUser:"+_+" - lastJsonHash:"+S),"Y"!=n.toUpperCase()&&"N.MC"!=n.toUpperCase()||f(v);var e="sameuser";t?_?_!=t&&(e="changeuser"):e="login":_&&!p&&(e="logout"),d("detectUser - op: "+e);o={op:e,hashId:t};p&&(o.TPCBlocked=!0),"logout"==e||"sameuser"==e?(d("detectUser - logout - same user - op:"+e),h(o)):t==S?(d("detectUser - login_manual"),o.op="login_manual",h(o)):(d("detectUser - altro"),m("app.jslogin",o,{appId:v,origin:U},function(o){o.SSID||(o.op="login_manual"),d("detectUser - altro - "+o.op),h(o)})),S=t},$(window).bind("message",function(o){if(o.originalEvent.origin==i){var t,e,n=null;try{n=JSON.parse(o.originalEvent.data)}catch(o){}n&&("setSiteUser"==n.op?(v=n.appId,U=U||n.origin,_!=n.siteUser&&(S=void 0),_=n.siteUser,I()):"getSSID"==n.op?(t=n.appId,t={appId:t=t||v,origin:n.origin},e={op:"getSSID"},_?m("app.jslogin",{},t,function(o){e.data=o,w(e)}):(e.data={},w(e))):"setJwtUser"==n.op&&m("app.jsforcelogin",{},{appId:n.appId,jwt:n.jwt},function(o){var t;d("jsforcelogin - uscita con op: "+o.op),(t={op:"forceLogin"}).data=o,w(t)}))}}),w({op:"init"})):console.error("parametri attivazione non sufficienti!!")}();
