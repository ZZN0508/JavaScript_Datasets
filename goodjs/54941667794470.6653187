function Autocomplete(e,t,s,i,o){function n(e,t){for(;t!=e&&null!=e;)e=e.parentNode;return t==e}this.field=document.getElementById(e),this.wrapper=document.getElementById(t)||document.querySelector(t),this.full=s,this.hideImages=!!o,i?this.position=i:(a=t.match(/\d$/),this.position=a?a[0]:""),this.div=$gsm.tag("div",{class:"autocomplete autocomplete-search autocomplete-small autocomplete-hide"},"",this.wrapper),this.parent=this.div,this.reviewsDiv=$gsm.tag("div",{class:"reviews-results float-left"},"",this.div),$gsm.tag("span",{class:"autocomplete-desc"},"Reviews",this.reviewsDiv),this.reviewsList=$gsm.tag("ul",{},"",this.reviewsDiv);var a=$gsm.tag("li",{class:"permanent"},"",this.reviewsList);this.reviewsMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More review results",a),this.phonesDiv=$gsm.tag("div",{class:"phone-results"},"",this.div),this.phoneLabel=$gsm.tag("span",{class:"autocomplete-desc"},"Last visited",this.phonesDiv),this.phonesList=$gsm.tag("ul",{class:"autocomplete-last-searched"},"",this.phonesDiv),this.phonesMoreLi=$gsm.tag("li",{class:"permanent",style:"display: none;"},"",this.phonesList),this.phonesMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More device results",this.phonesMoreLi),this.newsDiv=$gsm.tag("div",{class:"news-results float-left"},"",this.div),$gsm.tag("span",{class:"autocomplete-desc"},"News",this.newsDiv),this.newsList=$gsm.tag("ul",{},"",this.newsDiv);a=$gsm.tag("li",{class:"permanent"},"",this.newsList);this.newsMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More news results",a);a=this.field.parentNode;this.position||(this.searchButtons=$gsm.tag("div",{class:"search-buttons"},"",a),this.goButton=$gsm.tag("a",{class:"go",href:"#"},"Go",this.searchButtons),this.advancedButton=$gsm.tag("a",{class:"advanced",href:"search.php3"},"Advanced",this.searchButtons)),i||(this.quickSearchButton=document.querySelector("#quick-search-button")),this.loadRecentPhones();var r=this;$gsm.addEventListener(document,"click",function(e){n(e.target,r.parent)||r.hide()},!0),$gsm.addEventListener(document,"touchend",function(e){n(e.target,r.parent)||$gsm.hasClass(r.div,"autocomplete-hide")||r.hide()},!0),this.field.onclick=function(){AUTOCOMPLETE_LIST?r.searchPhones():r.loadList(),r.searchButtons&&(r.searchButtons.style.display="initial"),r.position||(r.quickSearchButton.style.display="none")},this.field.onkeyup=function(e){var t,s=r.field.value,i=r.div.querySelector(".autocomplete-selected");if(i&&$gsm.removeClass(i,"autocomplete-selected"),e.which!=KEY_DOWN_ARROW)if(e.which!=KEY_UP_ARROW){if(e.which==KEY_LEFT_ARROW||e.which==KEY_RIGHT_ARROW){if(!r.full)return;if(!i)return;if(0==s.length)return void $gsm.addClass(i,"autocomplete-selected");for(var o=[r.reviewsList,r.phonesList,r.newsList],n=i.parentNode.parentNode,a=0;a<n.childElementCount&&n.children[a].firstChild!=i;a++);for(var h=e.which==KEY_LEFT_ARROW?-1:1,l=o.indexOf(n);0==o[l=(o.length+l+h)%o.length].childElementCount;);return a=Math.min(a,o[l].childElementCount-1),void $gsm.addClass(o[l].children[a].firstChild,"autocomplete-selected")}e.which!=KEY_ESCAPE?1<=s.length?(r.setList(r.phonesList,[]),r.searchPhones(),r.searchNewsAndReviews()):r.showRecentPhones():r.hide()}else i?(t=(t=i.parentNode.previousSibling)||i.parentNode.parentNode.lastChild,$gsm.addClass(t.firstChild,"autocomplete-selected")):$gsm.addClass(r.phonesMore,"autocomplete-selected");else i?(t=(t=i.parentNode.nextSibling)||i.parentNode.parentNode.firstChild,$gsm.addClass(t.firstChild,"autocomplete-selected")):r.phonesList.firstChild&&$gsm.addClass(r.phonesList.firstChild.firstChild,"autocomplete-selected")},this.field.onkeydown=function(e){var t=r.div.querySelector(".autocomplete-selected");if(e.which==KEY_ENTER)return t?(e.preventDefault(),e.stopPropagation(),"#"==t.getAttribute("href")?void t.onclick(e):void(window.location=t.href)):this.value.length<AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH?(e.preventDefault(),void e.stopPropagation()):void 0},this.phonesMore.onclick=function(e){e.preventDefault(),e.stopPropagation();for(var t=r.field.parentNode;"FORM"!=t.nodeName;)t=t.parentNode;t.submit()},this.goButton&&(this.goButton.onclick=this.phonesMore.onclick),this.newsMore.onclick=function(e){e.preventDefault(),e.stopPropagation(),window.location="news.php3?sSearch="+r.field.value},this.reviewsMore.onclick=function(e){e.preventDefault(),e.stopPropagation(),window.location="reviews.php3?sSearch="+r.field.value},document.activeElement!=this.field&&""===this.field.value||""===this.field.getAttribute("value")&&(this.loadList(),this.searchNewsAndReviews())}"undefined"==typeof AUTOCOMPLETE_MAX_LINES&&(AUTOCOMPLETE_MAX_LINES=5),"undefined"==typeof AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT&&(AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT=1e3),"undefined"==typeof AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH&&(AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH=2),"undefined"==typeof AUTOCOMPLETE_THUMB_URL&&(AUTOCOMPLETE_THUMB_URL=CDN2_BASE_URL+"vv/bigpic/"),"undefined"==typeof NEWS_REVIEWS_URL&&(NEWS_REVIEWS_URL="search-json.php3"),"undefined"==typeof AUTOCOMPLETE_RECENT_URL&&(AUTOCOMPLETE_RECENT_URL="history-json.php3"),AUTOCOMPLETE_MAKERS=null,AUTOCOMPLETE_LIST=null,AUTOCOMPLETE_RECENT=[];var KEY_LEFT_ARROW=37,KEY_RIGHT_ARROW=39,KEY_UP_ARROW=38,KEY_DOWN_ARROW=40,KEY_BACKSPACE=8,KEY_ESCAPE=27,KEY_ENTER=13,AUTOCOMPLETE_MAKERID=0,AUTOCOMPLETE_PHONEID=1,AUTOCOMPLETE_PHONE_NAME=2,AUTOCOMPLETE_SEARCH_STR=3,AUTOCOMPLETE_THUMB=4;Autocomplete.prototype.loadList=function(){var t;null===AUTOCOMPLETE_LIST&&(AUTOCOMPLETE_LIST=!1,t=this,$gsm.xhr("GET",AUTOCOMPLETE_LIST_URL,function(e){AUTOCOMPLETE_MAKERS=e[0],AUTOCOMPLETE_LIST=e[1],window.location.search.match(new RegExp("sSearch"+this.position+"="))||t.searchPhones()}),""===this.field.value&&this.showRecentPhones())},Autocomplete.prototype.loadRecentPhones=function(){var e=(e=localStorage.getItem("recentPhones"))?JSON.parse(e):[];if("undefined"!=typeof HISTORY_ITEM_URL){for(var t={href:HISTORY_ITEM_URL,src:HISTORY_ITEM_IMAGE,text:HISTORY_ITEM_NAME,id:HISTORY_ITEM_ID},s=0;s<e.length;)e[s].id==t.id||e[s].href==t.href?e.splice(s,1):s++;e.unshift(t),e.splice(AUTOCOMPLETE_MAX_LINES),localStorage.setItem("recentPhones",JSON.stringify(e))}AUTOCOMPLETE_RECENT=e},Autocomplete.prototype.setList=function(e,t){for(var s=0;s<e.childElementCount;){var i=e.children[s];$gsm.hasClass(i,"permanent")?s++:e.removeChild(i)}for(s=t.length-1;0<=s;s--){var o=document.createElement("li");e.insertBefore(o,e.firstChild);o=$gsm.tag("a",{href:t[s].href},"",o);$gsm.tag("img",{src:this.hideImages?"":t[s].src},"",o),$gsm.tag("span",{},t[s].text,o)}},Autocomplete.prototype.makePhone=function(e){var t,s,i=this;return{href:this.full?function(e){if(e.href)return e.href;var t=AUTOCOMPLETE_MAKERS[e[AUTOCOMPLETE_MAKERID]]+" ",t=(t+=e[AUTOCOMPLETE_PHONE_NAME]).toLowerCase().replace(/\s+|-|\/|\./g,"_");return t+="-"+e[AUTOCOMPLETE_PHONEID]+".php"}(e):(t=e,"?"!=(s=(s=(s=window.location.search)||"?").replace(new RegExp("&?idPhone"+i.position+"=\\d+"),"")).charAt(s.length-1)&&(s+="&"),s+="idPhone"+i.position+"=",s+=t.id||t[AUTOCOMPLETE_PHONEID],window.location.pathname+s+window.location.hash),src:e.src||AUTOCOMPLETE_THUMB_URL+e[AUTOCOMPLETE_THUMB],text:e.text||AUTOCOMPLETE_MAKERS[e[AUTOCOMPLETE_MAKERID]]+" "+e[AUTOCOMPLETE_PHONE_NAME]}},Autocomplete.prototype.searchPhones=function(){function e(e,t,s){for(var i=0;i<e.length;i++)if(!t.match(new RegExp("\\b"+e[i]+(s?"\\b":""))))return;return 1}var t=this.field.value.replace(/^\s*(.*?)\s*$/,"$1").toLowerCase();if(0!=t.length){if(AUTOCOMPLETE_LIST){this.phoneLabel.innerHTML="Devices",$gsm.removeClass(this.phonesList,"autocomplete-last-searched"),this.phonesMoreLi.style.display="",this.show();for(var s=[],i=t.split(/\s+/g),o=0;o<AUTOCOMPLETE_LIST.length;o++){var n=AUTOCOMPLETE_LIST[o],a=AUTOCOMPLETE_MAKERS[n[AUTOCOMPLETE_MAKERID]].toLowerCase(),h=a+" "+n[AUTOCOMPLETE_PHONE_NAME].toLowerCase(),a=a+" "+n[AUTOCOMPLETE_SEARCH_STR].toLowerCase();if((e(i,h)||e(i,a,!0))&&s.push(this.makePhone(n)),s.length>=AUTOCOMPLETE_MAX_LINES)break}this.setList(this.phonesList,s)}}else this.showRecentPhones()},Autocomplete.prototype.searchNewsAndReviews=function(){var t,e,s;this.full&&(this.setList(this.newsList,[]),this.setList(this.reviewsList,[]),e=(t=this).field.value,s=NEWS_REVIEWS_URL+"?sSearch="+encodeURIComponent(e),e.length<AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH||(clearTimeout(this.newsReviewsTimeout),this.newsReviewsTimeout=setTimeout(function(){1<=e.length&&$gsm.xhr("GET",s,function(e){0!=t.field.value.length&&($gsm.addClass(t.div,"autocomplete-large"),$gsm.removeClass(t.div,"autocomplete-small"),e.news.splice(AUTOCOMPLETE_MAX_LINES),e.reviews.splice(AUTOCOMPLETE_MAX_LINES),t.setList(t.newsList,e.news),t.setList(t.reviewsList,e.reviews))})},AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT)))},Autocomplete.prototype.showRecentPhones=function(){this.loadRecentPhones();for(var e=[],t=0;t<Math.min(AUTOCOMPLETE_RECENT.length,AUTOCOMPLETE_MAX_LINES);t++)e.push(this.makePhone(AUTOCOMPLETE_RECENT[t]));0!=e.length&&(this.setList(this.phonesList,e),this.phoneLabel.innerHTML="Last visited",$gsm.addClass(this.phonesList,"autocomplete-last-searched"),$gsm.removeClass(this.div,"autocomplete-large"),$gsm.addClass(this.div,"autocomplete-small"),this.phonesMoreLi.style.display="none",this.show())},Autocomplete.prototype.hide=function(){$gsm.addClass(this.div,"autocomplete-hide"),this.searchButtons&&(this.searchButtons.style.display="none"),!this.position&&this.quickSearchButton&&(this.quickSearchButton.style.display="")},Autocomplete.prototype.show=function(){$gsm.removeClass(this.div,"autocomplete-hide"),this.searchButtons&&(this.searchButtons.style.display="initial"),!this.position&&this.quickSearchButton&&(this.quickSearchButton.style.display="none")};
