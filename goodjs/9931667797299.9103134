define(["OK/utils/utils"],function(n){"use strict";var u=n.deferred(),c=[];return{activate:function(n){u.resolve(n)},listen:function(e,i,t){u.promise.then(function(n){n.addListener(e,i,t)})},add:function(o,r){u.promise.then(function(n){var e,i={},t={ui:o,online:r||0};i[o]=t,n.updateUserCache(i),e=[t],c.forEach(function(n){n(e)})})},remove:function(e){u.promise.then(function(n){n.removeRefFromCache(e)})},ifOnline:function(t){return new Promise(function(e,i){u.promise.then(function(n){n=n.getFromUserCache(t);(!n||1!==n.online&&4!==n.online&&5!==n.online?i:e)()})})},registerOnAddListener:function(n){c.push(n)},unregisterOnAddListener:function(n){n=c.indexOf(n);-1<n&&c.splice(n,1)}}});
