!function(u,n){function r(e){var t=n.createElement("iframe");t.src=e._source,t.style.position="absolute",t.style.left="-1000px",t.style.top="-1000px",b[e._iframe]=t,n.body.appendChild(t)}function c(){p({status:"error",result:"failed",action:"timeout"}),d({status:"failed",root:_,timeout:12e5}),i(),h({uuid:f,status:"failed"})}function t(e){var t,n,o,a;~[s,v].indexOf(e.origin)&&e.data&&("last_update"!==e.data.type?(n=(t=e.data).status,o=t.timeout,a=t.root,p({status:"ok",action:"finish",result:n,message:t.message||null}),d({status:n,root:a,timeout:o}),i(),h({uuid:f,status:n})):w=Number(e.data.last_update))}function i(){try{b._iframe&&(b._iframe.parentNode.removeChild(b._iframe),b._iframe=null),U&&u.clearTimeout(U),l({name:I,value:"",expires:"Thu, 01 Jan 1970 00:00:00 GMT"})}catch(e){p({status:"error",action:"clean_up",message:e})}}function m(e){e=new RegExp("(?:(?:^|.*;\\s*)"+e+"\\s*=\\s*([^;]*).*$)|^.*$");return u.document.cookie.replace(e,"$1")}function l(e){var t=o.split(".").slice(-2).join(".");n.cookie=e.name+"="+e.value+";domain=."+t+";path=/;Expires="+e.expires}function d(e){var t=e.status,n=e.root,o=new Date((new Date).getTime()+parseInt(e.timeout,10)),e=function(e){var t,n=e.split("#"),o={},a=0;if(!e)return o;for(;a<n.length;)o[(t=n[a].split(":"))[0]]=t[1],a++;return o}(m(T));e[n]=t,l({name:T,value:function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t+":"+e[t]);return n.join("#")}(e),expires:o.toUTCString()})}function p(e){var t=new Image,n=["uuid="+encodeURIComponent(f)];n.push("event=pull"),n.push("action="+encodeURIComponent(e.action)),n.push("status="+encodeURIComponent(e.status)),n.push("target="+encodeURIComponent(u.location.hostname)),n.push("origin="+encodeURIComponent(_)),e.result&&n.push("result="+encodeURIComponent(e.result)),e.message&&n.push("message="+encodeURIComponent(e.message)),t.src="https://"+_+"/log?"+n.join("&")}var f,_,o,h,s,v,g,C,w,I,T,U,y,R,x,b;u.MDA2||(u.MDA2=(I="sso_uuid",T="sso_status",R=50,x="synchronized_no_beacon",b={_iframe:y=U=null,_iframeBeacon:null},{init:function(e){f=e.uuid,_=e.root,o=e.sso,h=e.listener,s="https://"+o,g=(v="https://"+_)+"/pull?origin="+encodeURIComponent(u.location.href)+"&uuid="+encodeURIComponent(f),C=v+"/beacon",u.addEventListener?u.addEventListener("message",t):u.attachEvent("onmessage",t)},sync:function e(){var a,t=(a=m(T),function(e){for(var t,n=a.split("#"),o=0;o<n.length;){if((t=n[o].split(":"))[0]===e)return t[1];o++}return null}(_)),n=m(I),o=m("mda2_beacon"),i=new Date((new Date).getTime()+25e3),s="timeout";if(n)h({uuid:n,status:"inprogress"});else{if(null!==t){if(s="beacon",void 0===(w=t===x?0:w)){if(R<25e3)return u.clearTimeout(y),R*=2,y=u.setTimeout(e,R),void(b._iframeBeacon||r({_iframe:"_iframeBeacon",_source:C}));w=-1}if(0===w&&(d({status:x,root:_,timeout:36e5}),t=x),b._iframeBeacon&&(b._iframeBeacon.parentNode.removeChild(b._iframeBeacon),b._iframeBeacon=null),u.clearTimeout(y),R=50,w<=o)return h(t===x?{uuid:f,status:"blocked"}:"synchronized"===t?{uuid:f,status:"up_to_date"}:{uuid:f,status:t}),void(w=void 0)}l({name:I,value:f,expires:i.toUTCString()}),p({status:"ok",action:"start",result:s}),U=u.setTimeout(c,25e3),r({_iframe:"_iframe",_source:g})}}}))}(window,window.document);
