(()=>{var r={357:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});var i=r(1);null==i.default.engines&&(i.default.engines={});const n=function(t,e){i.default.engines[t]=e}},326:(t,e,r)=>{"use strict";r.r(e),r.d(e,{setup:()=>u,teardown:()=>d});var i=r(327),n=r.n(i),e=r(1),i=e.default.lib("utilities/cacheable"),r=i.makeCacheable,a=i.uncacheNamespace,i=i.makeNamespace,s=e.default.lib("utilities/legacyLocalstorage").setOrGet,o=r("bandwidth_tracking"),l=i("bandwidth_tracking"),u=function(t){var e=t.hls,t=o(t,"persistBandwidthEstimate",function(){return function(){var t=e.abrController.getEstimate();s("hls.bandwidth_estimate",t)}});e.off(n().Events.FRAG_LOADED,t),e.on(n().Events.FRAG_LOADED,t)},d=function(t){l(t).persistBandwidthEstimate&&t.hls&&t.hls.off(n().Events.FRAG_LOADED,l(t).persistBandwidthEstimate),a("bandwidth_tracking",t)}},338:(t,e,r)=>{"use strict";function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}r.r(e),r.d(e,{default:()=>n});const n=(r=s,e=[{key:"isBuffered",value:function(t,e){try{if(t)for(var r=s.getBuffered(t),i=0;i<r.length;i++)if(e>=r.start(i)&&e<=r.end(i))return!0}catch(t){}return!1}},{key:"bufferInfo",value:function(t,e,r){try{if(t){for(var i=s.getBuffered(t),n=[],a=0;a<i.length;a++)n.push({start:i.start(a),end:i.end(a)});return this.bufferedInfo(n,e,r)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}}},{key:"bufferedInfo",value:function(t,e,r){t.sort(function(t,e){return t.start-e.start||e.end-t.end});var i,n=[];if(r)for(var a,s=0;s<t.length;s++)(a=n.length)?(i=n[a-1].end,t[s].start-i<r?t[s].end>i&&(n[a-1].end=t[s].end):n.push(t[s])):n.push(t[s]);else n=t;for(var o,l=0,u=e,d=e,c=0;c<n.length;c++){var f=n[c].start,h=n[c].end;if(f<=e+r&&e<h)u=f,l=(d=h)-e;else if(e+r<f){o=f;break}}return{len:l,start:u||0,end:d||0,nextStart:o}}},{key:"getBuffered",value:function(t){try{return t.buffered}catch(t){return{length:0,start:function(){return 0},end:function(){return 0}}}}},{key:"lastBufferedTime",value:function(t,e){return t?this.bufferInfo(t,t.currentTime||0,e).end:0}},{key:"timeBeforeEndOfBuffer",value:function(t,e){var r=t&&t.currentTime||0;return this.lastBufferedTime(t,e)-r}}],null&&i(r.prototype,null),i(r,e),s);function s(){!function(t){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this)}},337:(t,e,r)=>{"use strict";function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}r.r(e),r.d(e,{default:()=>n});const n=(i(a.prototype,[{key:"sample",value:function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}]),a);function a(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,a),this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=r}},334:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>o});var e=r(327),i=r.n(e);function n(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}function f(t,e,r){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){t=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(t){e=Object.getOwnPropertyDescriptor(t,e);return e.get?e.get.call(r):e.value}})(t,e,r||t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(r){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=h(r);return t=i?(t=h(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!=typeof t&&"function"!=typeof t?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e):t}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var r=r(1).default.lib("utilities/core"),g=(r.base64Encode,r.base64Decode),v="data:application/x-mpegURL;base64,";const o=function(){function c(t){var e;return function(t){if(!(t instanceof c))throw new TypeError("Cannot call a class as a function")}(this),(e=r.call(this,t)).log=t.debug,t&&t.getFragFromCache&&(e.getFragFromCache=t.getFragFromCache),t&&t.getM3u8FromCache&&(e.getM3u8FromCache=t.getM3u8FromCache),t&&t.callbackOnFragmentProgress&&(e.callbackOnFragmentProgress=t.callbackOnFragmentProgress),e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(c,i().DefaultConfig.loader);var r=s(c),t=c,e=[{key:"load",value:function(e,t,r){if("manifest"===e.type&&e.url&&0===e.url.indexOf(v)){var i=e.url.replace(v,""),n=g(i);setTimeout(function(){var t={url:e.url,data:n};r.onSuccess(t,{aborted:!1,loaded:0,total:0,chunkCount:0,bwEstimate:0,loading:{start:0,end:0,first:0},parsing:{start:0,end:0},buffering:{start:0,end:0,first:0},retry:0},e)},0)}else{if("level"===e.type){if(this.getM3u8FromCache){var a=this.getM3u8FromCache(e.url);if(a){var s=a.event,o=a.stats;return void setTimeout(function(){r.onSuccess(s,o,e)},0)}}var l=r.onSuccess;return r.onSuccess=function(t,e,r){l&&l(t,e,r)},void f(h(c.prototype),"load",this).call(this,e,t,r)}if(null==e.type){a=this.getFragFromCache(e.url,e.rangeStart,e.rangeEnd);if(a){var u=a.event,d=a.stats;return void setTimeout(function(){r.onProgress(d,e,u.data),r.onSuccess(u,d,e)},0)}}f(h(c.prototype),"load",this).call(this,e,t,r)}}}];return n(t.prototype,e),c}()},328:(t,e,r)=>{"use strict";r.r(e),r.d(e,{setup:()=>u,teardown:()=>c});var e=r(327),i=r.n(e),e=r(1),n=r(329),a=(e.default,e.default.lib("utilities/wlog").wlog.getPrefixedFunctions("hls_video")),r=e.default.lib("utilities/cacheable"),e=r.makeCacheable,s=r.uncacheNamespace,r=r.makeNamespace,o=e("dynamic_max_max_buffer"),l=r("dynamic_max_max_buffer"),u=function(t){var e=t.hls,r=o(t,"onFragLoaded",function(){return function(){d(t)}});e.off(i().Events.FRAG_LOADED,r),e.on(i().Events.FRAG_LOADED,r)},d=function(t){var e=t.hls;t.attributes.maxMaxBufferLength&&(e.config.maxMaxBufferLength=t.attributes.maxMaxBufferLength);var r=(0,n.levelToAsset)(t,e.currentLevel);r&&r.metadata&&e.abrController.getEstimate()*e.config.abrBandWidthFactor<8*r.metadata.max_bitrate&&(0<=e.manualLevel||0===e.currentLevel?(a.info("set maxMaxBufferLength",t.getDuration()),e.config.maxMaxBufferLength=t.getDuration()):(a.info("set maxMaxBufferLength",60),e.config.maxMaxBufferLength=60))},c=function(t){l(t).onFragLoaded&&t.hls&&t.hls.off(i().Events.FRAG_LOADED,l(t).onFragLoaded),s("dynamic_max_max_buffer",t)}},331:(t,e,r)=>{"use strict";r.r(e),r.d(e,{setup:()=>h,teardown:()=>k});var i=r(327),o=r.n(i),e=r(1).default,l=e.lib("player/lib/timeout-utils").doTimeout,n=e.lib("utilities/obj"),u=e.lib("utilities/wlog").wlog,a=e.lib("utilities/metrics"),i=e.lib("utilities/cacheable"),r=i.makeCacheable,s=i.uncacheNamespace,i=i.makeNamespace,d=r("error_handling"),c=i("error_handling"),f=u.getPrefixedFunctions("hls error_handling"),h=((0,e.lib("utilities/detect").cachedDetect)(),function(r){var t=d(r,"onError",function(){return function(t,e){g(r,t,e)}});r.hls.on(o().Events.ERROR,t);t=d(r,"onEmergencyAbortLoad",function(){return function(){y(r)}});r.hls.on(o().Events.FRAG_LOAD_EMERGENCY_ABORTED,t)}),g=function(t,e,r){(r.fatal?v:p)(t,e,r)},v=function(t,e,r){var i=t.hls,n=t.attributes;switch(r.type){case o().ErrorTypes.NETWORK_ERROR:u.info("hlsjsplugin - Fatal network error encountered, try to recover"),i.startLoad(),y(t);break;case o().ErrorTypes.MEDIA_ERROR:u.info("hlsjsplugin - Fatal media error encountered, try to recover"),c(t).countedRecoverMediaError||(c(t).countedRecoverMediaError=!0,E(t,"player/hls/recover_media_error")),t.isChangingVideo()||"bufferStalledError"!==r.details||i.startLoad(),f.error("trying to recover from media error...");var a=t.getCurrentTime();i.recoverMediaError();var s=null==n.bufferStallRecoveryTimeout?1e3:n.bufferStallRecoveryTimeout;l("".concat(t.uuid,".nudge_if_not_playing"),function(){"playing"===t.getPlaybackMode()?t.getCurrentTime()!==a&&f.error("video is playing; recoverMediaError() succeeded"):(f.error("trying to nudge 0.5 seconds..."),t.seek(t.getCurrentTime()+.5).then(function(){t.play()}))},s);break;default:E(t,"player/hls/fatal",1,{at:t.getCurrentTime(),data:r}),u.info("hlsjsplugin - Fatal error - cannot recover",e,r),i.destroy()}},p=function(t,e,r){t.hls,t.attributes,u.info("hlsjsplugin - Non fatal error encountered",r),"bufferSeekOverHole"===r.details?T(t,"player/hls/buffer_seek_over_hole",{hole:r.hole}):"bufferStalledError"===r.details?0<t.getCurrentTime()&&T(t,"player/hls/buffer_stalled"):"internalException"===r.details?T(t,"player/hls/non-fatal/".concat(r.details),{errorDetails:r}):T(t,"player/hls/non-fatal/".concat(r.details))},m=[100,500,1500,3e3,6e3],y=function(e){for(var t,r=function(){var t=e.hls;t&&t.startLoad()},i=0;i<m.length;i++)t=m[i],l("".concat(e.uuid,".hls.start_load_on_stall_").concat(t),r,t)},E=function(t,e,r){r=L(t,n.merge({at:t.getCurrentTime()},r)),a.count(e,1,r),A(t,e)},T=function(t,e,r){b(t,e)||E(t,e,r)},b=function(t,e){return S(t),!0===c(t).metricsCounted[e]},A=function(t,e){S(t),c(t).metricsCounted[e]=!0},S=function(t){null==c(t).metricsCounted&&(c(t).metricsCounted={})},L=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t={hlsVideo:t.diagnosticData()};return t.locationHref=location.href,top!==self&&(t.referrer=document.referrer,t.inIframe=!0),n.merge(t,e)},k=function(t){c(t).onError&&t.hls&&t.hls.off(o().Events.ERROR,c(t).onError),c(t).onEmergencyAbortLoad&&t.hls&&t.hls.off(o().Events.ERROR,c(t).onEmergencyAbortLoad),s("error_handling",t)}},330:(t,e,r)=>{"use strict";r.r(e),r.d(e,{allHlsAssets:()=>l,allHlsAudioAssets:()=>u,allMp4VideoAssets:()=>d,anyViableAsset:()=>c,bestAssetForCurrentSize:()=>f,buildMasterM3u8Asset:()=>h,filterByQualityAndMaxWidth:()=>g,masterM3u8ContentFromAssets:()=>v,masterM3u8DataUri:()=>p,masterM3u8Url:()=>m,maxAssetWidthBasedOnVideoWidth:()=>y,filterAssetsForScreencast:()=>E,mediumQualityStartingAsset:()=>T,rejectAudioAsset:()=>b});var r=r(1),s=r.default.lib("player/lib/assets"),i=r.default.lib("utilities/obj"),n=r.default.lib("utilities/core").base64Encode,r=r.default.lib("player/lib/hosts"),a=r.eV1Protocol,o=r.eV1Host,l=function(t){return s.filter(t,{container:"m3u8",segment_duration:3,type:"hls_video",status:s.READY,metadata:function(t){return Object(t).max_bitrate}}).sort(function(t,e){return(t.metadata.max_bitrate||0)-(e.metadata.max_bitrate||0)})},u=function(t){return s.filter(t,{type:"mp4_alternate_audio",status:s.READY})},d=function(t){return s.filter(t,{container:"mp4",status:s.READY,public:!0,metadata:function(t){return Object(t).max_bitrate},type:/\b(?!captioned_video)\S+/}).sort(function(t,e){return(t.metadata.max_bitrate||0)-(e.metadata.max_bitrate||0)})},c=function(t,e){return s.one(e,{sortBy:"width asc"})},f=function(t,e){e=g(t,e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:{});return e[e.length-1]},h=function(t){return{bitrate:"variable",ext:"m3u8",height:"variable",public:!0,size:"variable",type:"hls_video",url:t,width:"variable",slug:"hls_master_m3u8_seg3s"}},g=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=t.attributes,n=i.qualityMin,a=i.qualityMax,t=s.withinQualityRange(e,n,a);0===t.length&&(t=s.nearestOutsideRange(e,n,a));i=Math.min(r.maxWidth||8192,y(i.width,i.devicePixelRatio)),i=s.filter(t,{width:[0,i]});return 0===i.length?[t[0]]:i},v=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.video,t=t.audio,i=[];e.startPosition&&i.push("#EXT-X-START:TIME-OFFSET=".concat(e.startPosition,",PRECISE=YES")),i.push('#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio",NAME="Original",AUTOSELECT=YES, DEFAULT=YES');for(var i=i.concat(u(t).map(function(t){return'#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio",NAME="'.concat(t.details.languageMetadata.name,'",AUTOSELECT=NO, DEFAULT=NO, CHARACTERISTICS="public.accessibility.describes-video", URI="').concat(t.url,'"')})),n=0;n<r.length;n++){var a=r[n],s=8*a.metadata.max_bitrate;i.push('#EXT-X-STREAM-INF:PROGRAM-ID=1,CLOSED-CAPTIONS=NONE,AUDIO="audio",BANDWIDTH='.concat(s,",NAME=").concat(a.display_name,"\n")+a.url)}return"#EXTM3U\n"+i.join("\n")},p=function(t){t=v(t,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{});return"data:application/x-mpegURL;base64,".concat(n(t))},m=function(t){var e=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return"".concat(a(),"//").concat(o(),"/embed/medias/").concat(t,".m3u8?segment_duration=3&exclude_audio=").concat(!e)},y=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.devicePixelRatio||1;return t*(1.2*Math.max(1.25,e))},E=function(t,e){var r=i.filter(e,function(t){return 640<t.width});return 0<r.length?r:e},T=function(t,e){return f(t,e,{maxWidth:1279})},b=function(t,e){return i.filter(e,function(t){return"Audio"!=t.display_name})}},329:(t,e,r)=>{"use strict";r.r(e),r.d(e,{UNOBTAINABLE_BITRATE:()=>d,arrayBufferToString:()=>c,assetsSortedByWidth:()=>f,assetToLevel:()=>h,averageOrMaxBitrate:()=>g,bestStartingAsset:()=>v,bitrateForLevel:()=>p,bitrateForMetadata:()=>m,canSupportAsset:()=>y,cautiousThreshold:()=>E,determineBitrate:()=>T,earlyOrMaxBitrate:()=>b,filteredHlsAssets:()=>A,hasAnyVeryLargeAssets:()=>S,highestSupportedHlsAssetLevel:()=>L,highestSupportedAsset:()=>k,levelToAsset:()=>D,isVeryLargeAsset:()=>_,optimisticThreshold:()=>R,safeAverageBitrate:()=>C,startLoadOnce:()=>I,startingAssetBasedOnBandwidthEstimate:()=>x,stopLoad:()=>w,teardown:()=>O,weightedBwUpEstimate:()=>P});var i=r(330),e=r(1),r=e.default.lib("player/lib/assets"),n=r.one,a=r.isScreencast,s=e.default.lib("utilities/obj"),e=e.default.lib("utilities/cacheable"),o=e.uncacheNamespace,e=e.makeNamespace,l=e("asset_to_level"),u=e("level_to_asset"),d=99999999999,c=function(t){for(var e=new Uint8Array(t),r=e.length,i="",n=Math.pow(2,16)-1,a=0;a<r;a+=n)r<a+n&&(n=r-a),i+=String.fromCharCode.apply(null,e.subarray(a,a+n));return i},f=function(t,e){return e.sort(function(t,e){return t.width-e.width})},h=function(t,e){if(null!=(i=l(t)[e.url]))return i;if(!t.hls||!t.hls.levels)return-1;var r=s.filter(t.hls.levels,function(t){return t.url[0]===e.url})[0],i=t.hls.levels.indexOf(r);return r&&(l(t)[r.url[0]]=i),i},g=function(t){return null==t.average_bitrate?t.max_bitrate:t.average_bitrate},v=function(t,e){return x(t,e)||i.bestAssetForCurrentSize(t,e,{maxWidth:1280})||i.mediumQualityStartingAsset(t,e)||i.anyViableAsset(t,e)},p=function(t,e){e=D(t,e);return e?m(t,e.metadata):d},m=function(t,e){if(!e||!e.max_bitrate)return d;var r=8*e.max_bitrate,i=8*g(e),n=8*b(e),a=t.getPreload(),s=t.getCurrentTime(),o=t.timeBeforeEndOfBuffer(),e=t.getMediaElement()&&t.getMediaElement().paused;if(s<=E(t)&&n<i)return i;if(s<=E(t)&&"none"!==a)return"auto"===a?i:.5*i+.5*r;if(o<=E(t))return r;if(!e&&o<=R(t)){e=R(t)-E(t),e=(o-E(t))/e;return e*i+(1-e)*r}return i},y=function(t,e){return e&&e.metadata&&P(t)>8*e.metadata.max_bitrate},E=function(){return 6},T=function(t,e,r){if(t.hls){var i=null,r=s.getDeep(t.hls.levels,[r,"details","fragments"]);return i=r?8*r[r.length-1].byteRangeEndOffset/t.getDuration()/1024:i}},b=function(t){return null==t.early_max_bitrate?t.max_bitrate:t.early_max_bitrate},A=function(t,e){return a(t.allAssets)&&(e=i.filterAssetsForScreencast(t,e)),e=0<t.attributes.qualityMin?i.rejectAudioAsset(t,e):e},S=function(e){return 0<e.allAssets.filter(function(t){return _(e,t)}).lenth},L=function(t){return h(t,k(t,t.filteredVideoAssets()))},k=function(e,t){return f(e,t).filter(function(t){return y(e,t)}).pop()||t[0]},D=function(t,e){if(null!=(r=u(t)[e]))return r;var r=s.getDeep(t.hls.levels,[e,"url",0]),r=n(t.allAssets,{url:r});return r&&(r.bitrate=T(r,e)),u(t)[e]=r},_=function(t,e){e=C(e);return!!(e&&e<d&&1610612736<e*t.getDuration())},R=function(){return 16},C=function(t){return t&&t.metadata?t.metadata.real_average_bitrate||t.metadata.average_bitrate:null},I=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;t.attributes.calledStartLoad||(t.onReady().then(function(){t.hls.startLoad(e)}),t.setAttributes({calledStartLoad:!0}))},x=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e.attributes.bwEstimateOnInit;if(!r)return null;t=i.filterByQualityAndMaxWidth(e,t);return n(t,{metadata:function(t){if(!t)return!1;t=m(e,t);return t<d&&t<r*e.abrBandWidthUpFactor()},sortFn:function(t,e){return e.metadata.max_bitrate-t.metadata.max_bitrate}})},w=function(t){t.hls.stopLoad(),t.setAttributes({calledStartLoad:!1})},O=function(t){o("level_to_asset",t),o("asset_to_level",t)},P=function(t){return t.hls.abrController.getEstimate()*t.abrBandWidthUpFactor()}},325:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>I});var i=r(326),n=r(328),a=r(331),s=r(330),o=r(332),l=r(333),u=r(335),d=r(336),c=r.n(d),f=r(334),h=r(327),g=r.n(h),v=r(339),p=r(1),e=r(357),m=r(349),y=r(329);function E(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}var T=p.default.lib("player/lib/assets"),b=p.default.lib("utilities/obj"),A=p.default.lib("promiscuous"),S=p.default.lib("utilities/stopgo"),d=v.default.delegatePublicMethods,L=p.default.lib("utilities/wlog").wlog,k=L.getPrefixedFunctions("hls_video"),D=p.default.lib("utilities/seqid").seqId,_=p.default.lib("player/lib/media-data-transforms").convertMp4sToM3u8s,R=p.default.lib("utilities/legacyLocalstorage").setOrGet,h=(h=[{key:"fakeAutoAsset",value:function(){var t=s.buildMasterM3u8Asset("#fake");return t.slug="Auto",t.display_name="Auto",t}}],r=[{key:"abrBandWidthFactor",value:function(){return 1}},{key:"abrBandWidthUpFactor",value:function(){return.9}},{key:"adaptiveAsset",value:function(){var t=this.filteredVideoAssets(),t=s.buildMasterM3u8Asset(s.masterM3u8DataUri({video:t,audio:this.m3u8AudioAssets()},this.attributes));return t.display_name="Auto",t.slug="Auto",t}},{key:"assetFromQuality",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t,r=T.withinQualityRange(this.allAssets,t,e);return(r=0===r.length?T.nearestOutsideRange(this.allAssets,t,e):r)[0]}},{key:"changeAudioTrack",value:function(i){var n=this;return new A(function(t){var e="beforeplay"===n.getPlaybackMode(),r=n.getCurrentAudioTrack().id;e||r===i||n.hls.once(g().Events.AUDIO_TRACK_SWITCHED,function(){t()}),n.hls.audioTracks[i]&&r!==i?(n.hls.audioTrack=i,"beforeplay"===n.getPlaybackMode()&&t()):t()})}},{key:"changeLevel",value:function(t){var e=this;return"playing"===this.getPlaybackMode()?(this.hls.once(g().Events.LEVEL_SWITCHED,function(){e.play()}),this.pause(),void(this.hls.currentLevel=t)):void(this.hls.currentLevel!==t&&this.hls.startLevel!==t&&(this.hls.startLevel=t))}},{key:"changeQuality",value:function(t,e,r){if("auto"===t.toString().toLowerCase())return this.changeStream("auto",e,r);var i=this.selectableAssets(),t=T.findClosestAssetByQuality(i,t);return"beforeplay"===this.getPlaybackMode()?(this.changeStreamWithoutLoad(t),A.resolve()):this.changeStream(t,e,r)}},{key:"changeStream",value:function(e){var r=this,i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return e=this.getAsset(e),new A(function(t){r.changeStreamWithoutLoad(e),r.startHlsLoadOnce(),i?r.play().then(t):t()})}},{key:"changeStreamWithoutLoad",value:function(t){!(t=this.getAsset(t))||this.currentAsset()&&this.currentAsset().url===t.url||(t="variable"===t.bitrate?-1:(0,y.assetToLevel)(this,t),(0,y.stopLoad)(this),this.changeLevel(t))}},{key:"changeVideo",value:function(e,r){var i=this;return new A(function(t){i.mediaData=null,i.allAssets=[],i.attributes={},i.state={},i.state.isChangingVideo=!0,i._bindings={},i.destroyHls(),i.setupProperties(),(0,m.teardownBeforeChangeVideo)(i.simpleVideo),i.mediaData=i.prepareMp4sForHlsRepackaging(e),i.allAssets=e.assets,i.attributes=r,(0,m.initAfterChangeVideo)(i.simpleVideo,e,r),i.setAttributes({bwEstimateOnInit:R("hls.bandwidth_estimate")}),i.setupHls(),i.state.isChangingVideo=!1,t()})}},{key:"currentLevel",value:function(){return this.hls.currentLevel}},{key:"currentAsset",value:function(){return 0<=this.hls.currentLevel?(0,y.levelToAsset)(this,this.hls.currentLevel)||this.adaptiveAsset():null!=this.hls.startLevel&&0<=this.hls.startLevel&&(0,y.levelToAsset)(this,this.hls.startLevel)||this.adaptiveAsset()}},{key:"defaultAttributes",value:function(){return{contentType:"video/m3u8",qualityMin:360,qualityMax:2160,preload:"metadata"}}},{key:"destroy",value:function(){return this._bindings={},this.destroyHls(),this.simpleVideo.destroy()}},{key:"destroyHls",value:function(){function t(t){try{return t()}catch(t){k.error(t)}}var e=this;t(function(){a.teardown(e)}),t(function(){i.teardown(e)}),t(function(){n.teardown(e)}),t(function(){u.teardown(e)}),t(function(){l.teardown(e)}),t(function(){o.teardown(e)}),t(function(){(0,y.teardown)(e)}),this.hls&&(this.hls.destroy(),this.hls=null)}},{key:"determineMinAutoBitrate",value:function(){var t=this.hlsAssetFromQuality(360,1080);return t&&t.metadata&&t.metadata.max_bitrate?8*(t.metadata.max_bitrate-1):6e5}},{key:"diagnosticData",value:function(){var t=this,e=function(t){try{return t()}catch(t){return"ERROR: ".concat(t.message)}},e={simpleVideo:this.simpleVideo.diagnosticData(),attributes:this.attributes,currentLevel:e(function(){return t.currentLevel()}),startLevel:e(function(){return t.hls.startLevel}),nextLevel:e(function(){return t.hls.nextLevel}),loadLevel:e(function(){return t.hls.loadLevel}),autoLevel:e(function(){return t.hls.autoLevel}),autoLevelCapping:e(function(){return t.hls.autoLevelCapping}),nextAutoLevel:e(function(){return t.hls.nextAutoLevel}),manualLevel:e(function(){return t.hls.manualLevel}),bandwidthEstimate:e(function(){return t.hls.abrController.getEstimate()})};return e.currentAsset=this.currentAsset(),e.currentAsset&&e.currentAsset.url&&100<e.currentAsset.url.length&&(e.currentAsset.url="".concat(e.currentAsset.url.substring(0,97),"...")),e.selectedAsset=this.selectedAsset(),e.selectedAsset&&e.selectedAsset.url&&100<e.selectedAsset.url.length&&(e.selectedAsset.url="".concat(e.selectedAsset.url.substring(0,97),"...")),e}},{key:"getAsset",value:function(t){if("number"==typeof t)return this.assetFromQuality(t);if("string"==typeof t&&"auto"===t.toLowerCase()){if("auto"===t.toLowerCase())return this.adaptiveAsset();if("4k"===t.toLowerCase())return this.assetFromQuality(2160);if(/^\d+/.test(t))return this.assetFromQuality(parseInt(t))}return t}},{key:"getAudioTracks",value:function(){var i=this,n=this.m3u8AudioAssets();return this.hls.audioTracks.map(function(t,e){var r=n[e-1];return t.isSelected=e===i.getHlsAudioTrackId(),t.label=null==r?void 0:r.details.languageMetadata.nativeName,0===e&&(t.label="Original"),t})}},{key:"getCurrentAudioTrack",value:function(){var t=this.getHlsAudioTrackId(),t=this.hls.audioTrackController.tracks[t];return t.isSelected=!0,t}},{key:"getCurrentAudioTrackId",value:function(){return this.getCurrentAudioTrack().id}},{key:"getCurrentQuality",value:function(){var t=this.currentAsset();return t?"Auto"===t.slug?"auto":T.numericSizeSnapped(t.width,t.height):"?"}},{key:"getHlsAudioTrackId",value:function(){return-1===this.hls.audioTrack?0:this.hls.audioTrack}},{key:"getHlsjsConfig",value:function(){return{abrBandWidthFactor:1,abrBandWidthUpFactor:.9,abrController:c(),abrEwmaDefaultEstimate:this.attributes.bwEstimateOnInit,abrEwmaFastVoD:4,abrEwmaSlowVoD:15,autoStartLoad:!1,bitrateForLevel:this.bitrateForLevel,debug:{log:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];L.info.apply(L,["hlsjs log >"].concat(e))},error:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];L.notice.apply(L,["hlsjs error >"].concat(e))},warn:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];L.notice.apply(L,["hlsjs warn >"].concat(e))},info:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];L.info.apply(L,["hlsjs info >"].concat(e))},debug:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];L.debug.apply(L,["hlsjs debug >"].concat(e))}},getFragFromCache:this.popFragFromCache,getM3u8FromCache:this.getM3u8FromCache,loader:f.default,maxBufferSize:6e7,maxFragLookUpTolerance:.2,maxMaxBufferLength:this.attributes.maxMaxBufferLength||60,minAutoBitrate:this.determineMinAutoBitrate(),seekHoleNudgeDuration:.1,startLevel:this.getIndexOfStartingAsset()}}},{key:"getIndexOfStartingAsset",value:function(){for(var t=this.filteredVideoAssets(),e=(0,y.bestStartingAsset)(this,t),r=0;r<t.length;r++)if(t[r].url===e.url)return r}},{key:"hlsAssetFromQuality",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t,r=T.withinQualityRange(this.filteredVideoAssets(),t,e);return(r=0===r.length?T.nearestOutsideRange(this.filteredVideoAssets(),t,e):r)[0]}},{key:"isChangingVideo",value:function(){return!!this.state.isChangingVideo}},{key:"m3u8AudioAssets",value:function(){return s.allHlsAudioAssets(this.allAssets)}},{key:"masterM3u8Content",value:function(){var t=this.filteredVideoAssets();return s.masterM3u8ContentFromAssets({video:t,audio:this.m3u8AudioAssets()})}},{key:"maybeResetCurrentLevel",value:function(t){var e,r;this.simpleVideo.attributes.width&&(r=this.simpleVideo.attributes.width,"auto"===this.selectedQuality()&&r!==t&&(e=t-r,r=(t=(0,y.levelToAsset)(this,this.hls.currentLevel))?t.width:0,t=t?t.height:0,t=T.numericSizeSnapped(r,t),500<=e&&t<=360&&this.changeLevel(-1)))}},{key:"onEnterFullscreen",value:function(){return this.simpleVideo.onEnterFullscreen(),"beforeplay"===this.getPlaybackMode()?void(this.hls.startLevel=(0,y.highestSupportedHlsAssetLevel)(this)):void this.changeLevel(-1)}},{key:"onHeightChange",value:function(t){this.simpleVideo.onHeightChange(t),this.setAttributes({height:t})}},{key:"prepareMp4sForHlsRepackaging",value:function(t){t=b.clone(t);return _(t)}},{key:"onMediaDataChanged",value:function(t){this.mediaData=this.prepareMp4sForHlsRepackaging(t)}},{key:"onReady",value:function(){var t=this;return this.readyStopGo||(this.readyStopGo=new S,this.simpleVideo.onReady().then(function(){return A.all([t.mediaAttachedPromise,t.manifestParsedPromise]).then(function(){t.readyStopGo.go()})})),this.readyStopGo}},{key:"onWidthChange",value:function(t){var e=this;this.maybeResetCurrentLevel(t),this.simpleVideo.onWidthChange(t),this.setAttributes({width:t}),this.onReady().then(function(){o.capLevelBasedOnVideoWidth(e)})}},{key:"filteredVideoAssets",value:function(){var t=s.allMp4VideoAssets(this.allAssets);return(0,y.filteredHlsAssets)(this,t)}},{key:"play",value:function(t){return this.startHlsLoadOnce(),this.simpleVideo.play(t)}},{key:"qualityForAsset",value:function(t){return"Auto"===t.slug?"auto":T.numericSizeSnapped(t.width,t.height)}},{key:"removeSourceElem",value:function(){var e=this.getMediaElement(),t=Array.prototype.slice.call(e.childNodes);0<t.length&&t.map(function(t){e.removeChild(t)})}},{key:"reset",value:function(){this.simpleVideo.reset()}},{key:"seek",value:function(t,e){return this.startHlsLoadOnce(t),this.simpleVideo.seek(t,e)}},{key:"selectableAssets",value:function(){var t=this.filteredVideoAssets().sort(function(t,e){return t.width-e.width});return[this.adaptiveAsset()].concat(t)}},{key:"selectableQualities",value:function(){var e=this;return this.selectableAssets().map(function(t){return e.qualityForAsset(t)})}},{key:"selectedAsset",value:function(){return 0<=this.hls.manualLevel?this.currentAsset():this.adaptiveAsset()}},{key:"selectedQuality",value:function(){return this.qualityForAsset(this.selectedAsset())}},{key:"setAttributes",value:function(t){return b.assign(this.attributes,t),this.simpleVideo.setAttributes(t)}},{key:"setupHls",value:function(){var e=this,t=this.getHlsjsConfig();this.hls=new(g())(t),o.setup(this),u.setup(this);t=this.adaptiveAsset();this.hls.loadSource(t.url),this.manifestParsedPromise=new A(function(t){e.hls.on(g().Events.MANIFEST_PARSED,t)}),this.mediaAttachedPromise=new A(function(t){e.hls.on(g().Events.MEDIA_ATTACHED,t)}),this.hls.on(g().Events.AUDIO_TRACKS_UPDATED,function(){e.trigger("audiotracksupdated")}),this.hls.attachMedia(this.simpleVideo.getMediaElement()),this.removeSourceElem(),n.setup(this),a.setup(this),i.setup(this),l.setup(this),this.trigger("stream-changed",this.currentAsset())}},{key:"setupProperties",value:function(){null==this.preloading&&(this.preloading={}),null==this.preloading.m3u8Cache&&(this.preloading.m3u8Cache={}),null==this.preloading.fragCache&&(this.preloading.fragCache={})}},{key:"showFirstFrame",value:function(){return this.seek(.01)}},{key:"updateStartPosition",value:function(t){this._startPosition=t}},{key:"getStartPosition",value:function(){return this._startPosition}},{key:"startHlsLoadOnce",value:function(){var t=this._startPosition;(0,y.startLoadOnce)(this,t)}}],E((p=C).prototype,r),E(p,h),C);function C(t,e){var r=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=3<arguments.length?arguments[3]:void 0;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,C),this.uuid=D("wistia_hls_video_"),this.root=t,this.mediaData=this.prepareMp4sForHlsRepackaging(e),this.allAssets=this.mediaData.assets,this.attributes=b.assign(this.defaultAttributes(),i),this._startPosition=this.attributes.startPosition||-1,this.state={},this.setupProperties(),this.simpleVideo=new v.default(this.root,this.mediaData,this.attributes,n),this.setAttributes({bwEstimateOnInit:R("hls.bandwidth_estimate")||this.attributes.bwEstimateOnInit}),this.bitrateForLevel=function(t){return(0,y.bitrateForLevel)(r,t)},this.getM3u8FromCache=function(t){if(r.preloading&&r.preloading.m3u8Cache[t]){t=r.preloading.m3u8Cache[t];return{event:t.event,stats:t.stats}}return null},this.popFragFromCache=function(t){var e=t;if(r.preloading&&r.preloading.fragCache[e]){t=r.preloading.fragCache[e],t={event:t.event,stats:b.assign(t.stats,{alreadySampled:!0})};return delete r.preloading.fragCache[e],t}return null},this.setupHls()}d(h.prototype,function(){return this.simpleVideo}),(0,e.default)("HlsVideo",h);const I=h},332:(t,e,r)=>{"use strict";r.r(e),r.d(e,{capLevelBasedOnExactWidth:()=>c,capLevelBasedOnVideoWidth:()=>f,cappedLevelFromWidth:()=>h,cappedLevelFromVideoWidth:()=>g,capToLevel:()=>v,setup:()=>p,teardown:()=>m});var i=r(330),e=r(327),n=r.n(e),e=r(1),o=r(329),a=e.default.lib("player/lib/assets"),l=e.default.lib("utilities/wlog").wlog.getPrefixedFunctions("hls_video level_capping"),r=e.default.lib("utilities/cacheable"),e=r.makeCacheable,s=r.uncacheNamespace,u=(0,r.makeNamespace)("level_capping"),d=e("level_capping"),c=function(t,e){var r=h(t,e);0<=r?(l.info("Capping to level",r),v(t.hls,r)):l.info("Cannot cap level for width ".concat(e,"; no matching assets found"))},f=function(t){var e,r,i,n,a,s;!1!==t.attributes.capBasedOnVideoWidth&&(e=t.hls,r=g(t),l.info("capLevelBasedOnVideoWidth",r),0<=r&&(i=e.currentLevel,n=e.autoLevelCapping,v(t,r),s=t.getPlaybackMode(),0!==t.filteredVideoAssets().length&&("beforeplay"===s&&r===e.startLevel?l.info("Not reevaluating next fragment because starting level is the same as the capped level"):(a=(0,o.highestSupportedHlsAssetLevel)(t),s=e.levels.length-1,s=(0,o.levelToAsset)(t,Math.min(i+1,s)),0<=n&&n<r&&(0,o.canSupportAsset)(t,s)&&(e.nextLoadLevel=a)))))},h=function(t,e){var r=t.filteredVideoAssets(),r=i.filterByQualityAndMaxWidth(t,r,{maxWidth:e}),e=a.one(r,{width:[0,e],sortBy:"width desc, bitrate desc",metadata:function(t){return t.max_bitrate<o.UNOBTAINABLE_BITRATE}});return e?(0,o.assetToLevel)(t,e):-1},g=function(t){return h(t,i.maxAssetWidthBasedOnVideoWidth(t.attributes.width,t.attributes.devicePixelRatio))},v=function(t,e){t.onReady().then(function(){t.hls.autoLevelCapping=e})},p=function(r){var t=d(r,"onManifestParsed",function(){return function(t,e){r.onReady(function(){f(r)})}});r.hls.off(n().Events.MANIFEST_PARSED,t),r.hls.on(n().Events.MANIFEST_PARSED,t)},m=function(t){u(t).onManifestParsed&&t.hls&&t.hls.off(n().Events.MANIFEST_PARSED,u(t).onManifestParsed),s("level_capping",t)}},333:(t,e,r)=>{"use strict";r.r(e),r.d(e,{parseManifestPlaylist:()=>E,preloadM3u8Level:()=>b,preloadSegment:()=>A,preloadStream:()=>S,setup:()=>L,teardown:()=>k});function u(t,e){return-1!==e||(e=t.getIndexOfStartingAsset()),t.hls.levels[e].url[0]}function i(i,n,a){var s=i.hls;s&&T(i,s.startLevel,1,function(){var t=(0,o.levelToAsset)(i,s.startLevel),e=(0,o.startingAssetBasedOnBandwidthEstimate)(i,i.filteredVideoAssets(),(0,o.weightedBwUpEstimate)(i)),r=s.abrController.getEstimate();m.info("bandwidth estimate after 1 fragment",r),m.info("determined best starting asset",e);r=e&&e.url,t=t&&t.url;if(e&&t!==r){e=(0,o.assetToLevel)(i,e);if(e<0)return m.warn("no matching level found, got",e),void("function"==typeof a&&a());m.info("set startLevel",e),null!=e&&isNaN(e)&&m.error("error: setting startLevel to NaN",e,r),s.startLevel=e,T(i,e,n,function(){"function"==typeof a&&a()})}else T(i,s.startLevel,n-1,a)})}function a(t,e,r,i,n){i<=r?"function"==typeof n&&n():A(t,e,r,function(){"beforeplay"!==t.getPlaybackMode()||a(t,e,r+1,i,n)})}var n=r(1),s=r(327),d=r.n(s),c=r(334),o=r(329),e=n.default.lib("utilities/detect").cachedDetect,l=n.default.lib("player/lib/timeout-utils").doTimeout,f=n.default.lib("player/lib/elem").pageLoaded,h=n.default.lib("utilities/legacyLocalstorage").setOrGet,s=n.default.lib("utilities/wlog").wlog,r=n.default.lib("utilities/cacheable"),n=r.makeCacheable,g=r.uncacheNamespace,r=r.makeNamespace,v=n("preloading"),p=r("preloading"),m=s.getPrefixedFunctions("hls preloading"),y=e(),E=function(t,e){var n=[];return e.replace(/(\/deliveries\/)([a-zA-Z0-9.\-/]+\.ts)/g,function(t,e,r){var i=/seg-(\d+)-/g.exec(r)[1];return n.push({sn:i,url:r}),""}),n},T=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length?arguments[3]:void 0,n=t.getStartPosition(),n=0<n?Math.round(n/3)-1:0;return a(t,e,n,n+r,i)},b=function(r,t,i){var n,e,a;r.hls&&r.hls.levels&&(n=u(r,t),(a=p(r).m3u8Cache)&&a[n]?(e=a[n],l("".concat(r.uuid,".preload_m3u8_level"),function(){i(e)},0)):(a=new c.default(r.hls.config),t={type:"level",level:t,id:0,responseType:"text",loader:c.default,url:n},a.load(t,{timeout:6e3,maxRetry:3,retryDelay:500,maxRetryDelay:3e3},{onSuccess:function(t,e){t={event:t,stats:e,url:n,segments:E(r,t.data)};try{p(r).m3u8Cache[n]=t,i(t)}catch(t){m.warn(t)}},onError:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];m.error.apply(m,["Failed to fetch data for m3u8 ".concat(n)].concat(e))},onTimeout:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];m.error.apply(m,["Timeout fetching data for m3u8 ".concat(n)].concat(e))}})))},A=function(a,i,s,o){var l;a.hls&&a.hls.levels&&(l=u(a,i),b(a,i,function(){var n,t,e,r=p(a).m3u8Cache[l].segments[s];r&&(e=r.url,t=p(a).m3u8Cache[l].url,n=/^https?:\/\//.test(e)?e:t.substring(0,t.lastIndexOf("/")+1)+e,t=new c.default(a.hls.config),e={onSuccess:function(t,e){var r=n,i={event:t,stats:e},t=Math.max(50,performance.now()-e.loading.start),e=e.loaded;h("hls.bandwidth_estimate",8e3*e/t),a.hls&&(a.hls.abrController.sample(t,e),p(a).fragCache[r]=i,"function"==typeof o&&o(i))},onError:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];m.warn.apply(m,["failed to preload segment",n,s].concat(e))},onTimeout:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];m.warn.apply(m,["timed out preloading segment",n,s].concat(e))},onProgress:function(t){a.hls.trigger(d().Events.FRAG_LOAD_PROGRESS,{stats:t})}},r={id:0,level:(r={level:i,url:n,segment:r}).level,loader:c.default,responseType:"arraybuffer",type:"level",url:r.url,sn:r.segment.sn},t.load(r,{timeout:6e3,maxRetry:3,retryDelay:500,maxRetryDelay:3e3},e))}))},S=function(t,e){var r=y.edge&&parseInt(y.browser.version)<17;y.trident||r||f(function(){"beforeplay"===t.getPlaybackMode()&&("auto"===t.getPreload()?i(t,9,e):"metadata"===t.getPreload()&&i(t,1,e))})},L=function(t){var e=t.hls,r=v(t,"onMediaAttached",function(){return function(){S(t,function(){t.trigger("stream-changed",(0,o.levelToAsset)(t,e.startLevel))})}});e.off(d().Events.MEDIA_ATTACHED,r),e.on(d().Events.MEDIA_ATTACHED,r)},k=function(t){p(t).onMediaAttached&&t.hls&&t.hls.off(d().Events.MEDIA_ATTACHED,p(t).onMediaAttached),g("preloading",t)}},335:(t,e,r)=>{"use strict";r.r(e),r.d(e,{setup:()=>u,teardown:()=>d});var e=r(327),n=r.n(e),a=r(329),e=r(1),s=e.default.lib("utilities/wlog").wlog.getPrefixedFunctions("hls_video"),r=e.default.lib("utilities/cacheable"),e=r.makeCacheable,i=r.uncacheNamespace,r=r.makeNamespace,o=e("track_stream_changes"),l=r("track_stream_changes"),u=function(i){var t=i.hls;l(i).lastLevel=null,l(i).lastAutoLevel=null,l(i).substreamIndex=0;var e=o(i,"onFragChanged",function(){return function(t,e){var r;e.frag.level===i._lastLevel&&e.frag.autoLevel==i._lastAutoLevel||(r=(0,a.levelToAsset)(i,e.frag.level),i.trigger("stream-changed",r),l(i).lastLevel=e.frag.level,l(i).lastAutoLevel=e.frag.autoLevel,l(i).substreamIndex+=1,0<=e.frag.level?s.notice("frag switch to",r||e.level,"at",i.getCurrentTime()):s.notice("frag switch to Auto at",i.getCurrentTime()))}});t.off(n().Events.FRAG_CHANGED,e),t.on(n().Events.FRAG_CHANGED,e);e=o(i,"onAudioSwitching",function(){return function(t,e){i.trigger("audiostreamchange"),0<e.id?s.notice("audio asset switch to track: ",e.id,"at",i.lastBufferedTime()):s.notice("level switch to original encoded audio at",i.lastBufferedTime())}});t.off(n().Events.AUDIO_TRACK_SWITCHING,e),t.on(n().Events.AUDIO_TRACK_SWITCHING,e);e=o(i,"onLevelSwitching",function(){return function(t,e){var r;0<=e.level?(r=(0,a.levelToAsset)(i,e.level),s.notice("level switch to",r||e.level,"at",i.lastBufferedTime())):s.notice("level switch to Auto at",i.lastBufferedTime())}});t.off(n().Events.LEVEL_SWITCHING,e),t.on(n().Events.LEVEL_SWITCHING,e)},d=function(t){l(t).onFragChanged&&t.hls&&t.hls.off(n().Events.FRAG_CHANGED,l(t).onFragChanged),l(t).onLevelSwitch&&t.hls&&t.hls.off(n().Events.LEVEL_SWITCHING,l(t).onLevelSwitching),i("track_stream_changes",t)}},356:(t,e,r)=>{"use strict";r.r(e),r.d(e,{PUBLIC_METHODS:()=>i,delegateMethods:()=>n,delegatePublicMethods:()=>a});var i=["activeBufferRange","anyBuffered","bind","bindNamed","bufferInfo","canDownloadMedia","cancelFullscreen","captureCurrentFrame","changeQuality","changeStream","changeStreamWithoutLoad","changeVideo","currentAsset","defaultAsset","destroy","diagnosticData","eventContext","fit","getAudioTracks","getCurrentQuality","getCurrentTime","getCuts","getDuration","getDurationBeforeCuts","getMediaElement","getMediaType","getPlaybackMode","getPlaybackRate","getPreload","getState","getTimeAfterCuts","getTimeBeforeCuts","getTrim","getVolume","hasIssuedPlay","isChangingVideo","isInitializingFromUnmuted","isInFullscreen","isMuted","isSeeking","isSourceOfBrowserEvent","lastBufferedTime","mute","onEnterFullscreen","onHeightChange","onLeaveFullscreen","onMediaDataChanged","onPlayed","onReady","onWidthChange","pause","play","playType","requestFullscreen","reset","seek","seekOnPlay","selectedAsset","selectableAssets","selectableQualities","selectedQuality","sequentialBufferedRange","setAttributes","setCurrentTime","setPlaybackRate","setCuts","setTrim","setVolume","showFirstFrame","stopStreaming","timeBeforeEndOfBuffer","totalBuffered","totalPlayed","trigger","unbind","unbindNamed","unbindAllInNamespace","unmute","updateStartPosition"],n=function(t,r,i){for(var e,n=0;n<t.length;n++)e=t[n],r[e]||function(e){r[e]=function(){var t=i.call(this);return t?t[e].apply(t,arguments):null}}(e)},a=function(t,e){n(i,t,e)}},341:(t,e,r)=>{"use strict";r.r(e),r.d(e,{anyBuffered:()=>i,activeBufferRange:()=>n,totalBuffered:()=>a,sequentialBufferedRange:()=>o,bufferInfo:()=>l,lastBufferedTime:()=>u,timeBeforeEndOfBuffer:()=>d});var s=r(340),i=function(t){t=t.video;return 0<t.buffered.length&&0<t.buffered.end(0)},n=function(t){for(var e=t.video,r=e.currentTime,i=0;i<e.buffered.length;i++){var n=e.buffered.start(i),a=e.buffered.end(i);if(n<=r&&r<a)return[n,a]}return null},a=function(t){return s.sumTimeRanges(t.video.buffered)},o=function(t){var e=t.video,r=e.buffered,i=null;try{for(var n=0;n<r.length;n++){var a=r.start(n)-.5,s=r.end(n)+.5;if(a<=e.currentTime&&e.currentTime<s){i=n;break}}if(null==i)return null;for(var o=i,l=i;l<r.length&&r.start(l)-.5<=r.end(o)+.5;l++)o=l;return[r.start(i),r.end(o)]}catch(t){return logger.error(t),null}},l=function(t,e,r){t=t.video;if(t){for(var i=t.buffered,n=[],a=0;a<i.length;a++)n.push({start:i.start(a),end:i.end(a)});return s.bufferedInfo(n,e,r)}return{len:0,start:0,end:0,nextStart:void 0}},u=function(t,e){return l(t,t.getCurrentTime(),e).end},d=function(t,e){return u(t,e)-t.getCurrentTime()}},351:(t,e,r)=>{"use strict";r.r(e),r.d(e,{setup:()=>s,teardown:()=>o});function i(t){var e=t.attributes;return(null==e.eventLoopDuration?300:e.eventLoopDuration)/t.getPlaybackRate()}var r=r(1),n=r.default.lib("utilities/obj"),a=r.default.lib("utilities/event_loop").globalEventLoop,s=function(t){null==t.state&&(t.state={}),"playing"===t.getPlaybackMode()&&(t.state.hasPlayed=!0),t.bind("playing",function(){t.state.hasPlayed=!0}),t.bind("waiting",function(){t.state.gotWaiting=!0}),t.bind("loadedmetadata",function(){t.state.loadedMetadata=!0}),n.assign(t.state,{lastPlaybackMode:t.getPlaybackMode(),lastTimePosition:t.getCurrentTime(),lastEventLoopDuration:i(t)});var e="".concat(t.uuid,".custom_state_and_events");a.add(e,i(t),function(){n.assign(t.state,{lastTimePosition:t.getCurrentTime(),lastPlaybackMode:t.getPlaybackMode(),lastEventLoopDuration:i(t)}),a.interval(e,i(t))})},o=function(t){t="".concat(t.uuid,".custom_state_and_events");a.remove(t)}},346:(t,e,r)=>{"use strict";r.r(e),r.d(e,{getCurrentTimeAfterCuts:()=>n.getCurrentTimeAfterCuts,getCuts:()=>n.getCuts,getDurationAfterCuts:()=>n.getDurationAfterCuts,getTimeAfterCuts:()=>n.getTimeAfterCuts,getTimeBeforeCuts:()=>n.getTimeBeforeCuts,trimStartFromCuts:()=>s,trimEndFromCuts:()=>o,getTrim:()=>l,setCuts:()=>u,enforceCuts:()=>d,teardownCuts:()=>c,enforceCutsNow:()=>f,setTrim:()=>h});function i(t,e){return(e=e||{current:null}).current=requestAnimationFrame(function(){!1!==t()&&i(t,e)}),function(){cancelAnimationFrame(e.current)}}var n=r(347),a=r(342),s=function(t){t=(0,n.getCuts)(t);return t.length<1||0<t[0].start?0:t[0].end},o=function(t){var e=(0,n.getCuts)(t),t=(0,n.getDurationBeforeCuts)(t);return e.length<1||e[e.length-1].end<t?-1:e[e.length-1].start},l=function(t){return{start:s(t),end:o(t)}},u=function(t,e){(t.attributes.cuts=e)!==t._rawCuts&&(t._cuts=void 0,t._rawCuts=void 0),d(t)},d=function(t){var e,r;t._stopEnforcingCuts||0===(0,n.getCuts)(t).length||(e=function(){t._stopEnforcingCutsViaRafLoop&&(t._stopEnforcingCutsViaRafLoop(),t._stopEnforcingCutsViaRafLoop=void 0)},r=[t.on("playing",function(){e(),t._stopEnforcingCutsViaRafLoop=i(function(){if(!t.state.seeking&&!t.video.seeking&&(f(t),!t._stopEnforcingCutsViaRafLoop))return!1})}),t.on("pause",e),t.on("ended",e),t.on("beforeplay",e),t.on("timeupdate",function(){f(t)})],t._stopEnforcingCuts=function(){e(),r.forEach(function(t){return t()}),t._stopEnforcingCuts=void 0})},c=function(t){t._stopEnforcingCuts&&(t._stopEnforcingCuts(),t._stopEnforcingCuts=void 0)},f=function(t){var e,r,i;"beforeplay"!==t.getPlaybackMode()&&(e=t.video.currentTime,r=(0,n.getCuts)(t).filter(function(t){if(t.start<=e&&e<t.end)return t})[0],i=(0,n.getDurationBeforeCuts)(t),t.state.fakeEnded&&(0,n.getTimeAfterCuts)(t,e)<(0,n.getDurationAfterCuts)(t)-.1&&(t.state.fakeEnded=!1),r&&(r.end<i-.1?(0,a.seekWithoutCuts)(t,r.end):t.state.fakeEnded||(t.state.fakeEnded=!0,t.attributes.loop?(t.trigger("ended"),t.seek(0).then(function(){return t.play()})):(t.pause(),t.trigger("ended")))))},h=function(t,e){var r=e.start,i=e.end;null!=r&&(0<=r?t.attributes.trimStart=e.start:delete t.attributes.trimStart),null!=i&&(0<=i?t.attributes.trimEnd=e.end:delete t.attributes.trimEnd),t._cuts=void 0,f(t),d(t)}},347:(t,e,r)=>{"use strict";function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=Array(e);r<e;r++)i[r]=t[r];return i}r.r(e),r.d(e,{getDurationBeforeCuts:()=>o,getDurationAfterCuts:()=>i,getTimeBeforeCuts:()=>n,getTimeAfterCuts:()=>a,getCurrentTimeAfterCuts:()=>l,getCuts:()=>d});var o=function(t){var e=t.attributes;return null!=e.duration?e.duration:2<=t.video.readyState?t.video.duration:void 0},i=function(t){var e=d(t),t=o(t);if(e.length<1)return t;var r=t;return e.forEach(function(t){r-=t.end-t.start}),r},n=function(t,r){var e=o(t),t=d(t),i=0,n=0,a=0;return t.forEach(function(t){var e=t.start-n;(a+=e)<=r+i&&(e=t.end-t.start,i+=e,a+=e),n=t.end}),Math.min(e,r+i)},a=function(t,e){t=d(t);if(t.length<1)return e;var r=e;return t.forEach(function(t){t.start<=e&&(r-=Math.min(e,t.end)-t.start)}),Math.max(0,r)},l=function(t){return a(t,t.video.currentTime)},u=Object.freeze([]),d=function(t){var e=t.attributes,r=e.cuts,i=e.trimStart,e=e.trimEnd;if(t._cuts&&r===t._rawCuts)return t._cuts;if(!r&&null==i&&null==e)return u;t._rawCuts=r,t._cuts=c(t);r={start:t.attributes.trimStart,end:t.attributes.trimEnd};return t._cuts=f(t,r,t._cuts),Object.freeze(t._cuts),t._cuts},c=function(r){var i=o(r),t=r.attributes,e=t.cuts,n=t.trimStart,t=t.trimEnd;if(!e)return[];e=e.map(function(t){var e=null==t.start?0:h(r,t.start),t=null==t.end?i:h(r,t.end);return e<t?{start:e,end:t}:null}).filter(Boolean);null!=n&&e.push({start:0,end:n}),null!=t&&e.push({start:t,end:i});var e=e.sort(function(t,e){return t.start-e.start}),a={start:0,end:0};return e.map(function(t){return t.end<a.end?null:(t.start<a.end&&(t.start=a.end),a=t)}).filter(Boolean)},f=function(t,e,r){var i,n=function(t){if(Array.isArray(t))return s(t)}(i=r)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(i)||function(t){if(t){if("string"==typeof t)return s(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(t,void 0):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),a=o(t),r=e.start,i=e.end,t=n[0],e=n[n.length-1],t=t&&(0===t.start||t.start<0)?t:void 0,e=e&&(e.end>=a||e.end<0)?e:void 0;return null!=r&&(0<=r?(r={start:0,end:r},t?n.splice(0,1,r):n.unshift(r)):t&&n.shift()),null!=i&&(0<=i?(a={start:i,end:a},e?n.splice(n.length-1,1,a):n.push(a)):e&&n.pop()),n},h=function(t,e){t=o(t);return Math.min(t,Math.max(0,e))}},355:(t,e,r)=>{"use strict";r.r(e),r.d(e,{getDiagnosticData:()=>n});function i(t){try{return t()}catch(t){return"ERROR: ".concat(t.message)}}var n=function(t){var e={};return e.state=t.state,e.attributes=t.attributes,e.currentAsset=t.currentAsset(),e.currentAsset&&e.currentAsset.url&&100<e.currentAsset.url.length&&(e.currentAsset.url="".concat(e.currentAsset.url.substring(0,97),"...")),e.selectedAsset=t.selectedAsset(),e.selectedAsset&&e.selectedAsset.url&&100<e.selectedAsset.url.length&&(e.selectedAsset.url="".concat(e.selectedAsset.url.substring(0,97),"...")),e.getState=i(function(){return t.getState()}),e.getDuration=i(function(){return t.getDuration()}),e.getPlaybackRate=i(function(){return t.getPlaybackRate()}),e.getPlaybackMode=i(function(){return t.getPlaybackMode()}),e.isSeeking=i(function(){return t.isSeeking()}),e.getCurrentTime=i(function(){return t.getCurrentTime()}),e.activeBufferRange=i(function(){return t.activeBufferRange()}),e.sequentialBufferedRange=i(function(){return t.sequentialBufferedRange()}),e.getVolume=i(function(){return t.getVolume()}),e.timeBeforeEndOfBuffer=i(function(){return t.timeBeforeEndOfBuffer()}),e.lastBufferedTime=i(function(){return t.lastBufferedTime()}),e.totalBuffered=i(function(){return t.totalBuffered()}),e.anyBuffered=i(function(){return t.anyBuffered()}),e.getPreload=i(function(){return t.getPreload()}),e.rawVideoProps=i(function(){return a(t)}),e},s=["autoplay","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","muted","networkState","paused","playbackRate","preload","readyState","seeking","src","startDate","volume"],a=function(t){for(var e=t.video,r={},i=0;i<s.length;i++){var n=s[i],a=e[n];r[n]=a}return r}},353:(t,e,r)=>{"use strict";r.r(e),r.d(e,{fixWebkitControlsBug:()=>a});var e=r(1),r=e.default.lib("utilities/detect").cachedDetect,e=e.default.lib("utilities/wlog").wlog,i=r(),n=e.getPrefixedFunctions("SimpleVideo"),a=function(t){var e=t.video;i.browser.webkit&&(n.info("fixWebkitControlsBug"),t=e.getAttribute("controls"),e.setAttribute("controls","controls"),e.removeAttribute("controls"),null!=t&&e.setAttribute("controls",t))}},340:(t,e,r)=>{"use strict";r.r(e),r.d(e,{createElement:()=>f,setupVideoElemAttributes:()=>h,inferTypeAttribute:()=>g,srcProtocolAndHost:()=>v,tinyMp4Url:()=>p,sumTimeRanges:()=>m,bufferedInfo:()=>y,properAssetUrl:()=>E});function i(t,e,r){null!=r&&!1!==r?!0===r?(t[e]=!0,t.setAttribute(e,"")):(t[e]=r,t.setAttribute(e,r)):(t[e]=!1,t.removeAttribute(e))}var n=r(1),e=n.default.lib("utilities/detect").cachedDetect,a=n.default.lib("player/lib/elem").elemFromObject,s=n.default.lib("utilities/url").Url,o=n.default.lib("player/lib/assets").isBakeryUrl,r=n.default.lib("player/lib/hosts"),l=r.eV1Protocol,n=r.eV1Host,u=r.deliveryHost,d=e(),c="".concat(l(),"//").concat(n(),"/assets/images/blank.gif"),f=function(t,e,r){var i={tagName:"video",id:t,crossorigin:"anonymous",style:{background:"transparent",display:"block",height:"100%",maxHeight:"none",maxWidth:"none",position:"static",visibility:"visible",width:"100%"}};(d.browser.msie||d.trident)&&(i.style.minWidth="10px",i.style.minHeight="10px");t={tagName:"source",src:E(e.url),type:g(e,r)};return r.excludeSourceElem||(i.childNodes=[t]),h(a(i),e,r)},h=function(t,e,r){return r.poster?(t.poster=r.poster,t.setAttribute("poster",r.poster)):(t.poster=c,t.setAttribute("poster",c)),i(t,"aria-label","Video"),i(t,"defaultPlaybackRate",r.defaultPlaybackRate||1),i(t,"src",E(e.url)),i(t,"controlslist",r.controlslist||"nodownload"),i(t,"playsinline",r.playsinline),i(t,"muted",r.muted),i(t,"loop",r.loop),i(t,"controls",null!=r.controls&&r.controls),i(t,"preload",r.preload||"none"),i(t,"type",g(e,r)),i(t,"x-webkit-airplay",null==r.webkitAirplay?"allow":r.webkitAirplay),null!=r.volume&&(t.volume=r.volume),r.disablePictureInPicture&&i(t,"disablePictureInPicture",r.disablePictureInPicture),t},g=function(t,e){if(null!=e.contentType)return e.contentType;t="video/".concat(t.ext);return e.spherical&&(t+=";dimension=360;"),t},v=function(t){if(o(t)){t=new s(t);if(t.protocol)return"".concat(t.protocol,"//").concat(t.host)}return"".concat(l(),"//").concat(u(l()))},p=function(t){return"".concat(v(t),"/tiny.mp4")},m=function(t){if(null==t)return null;for(var e=0,r=0;r<t.length;r++)e+=t.end(r)-t.start(r);return e},y=function(t,e,r){var i,n,a,s,o,l=[];for(t.sort(function(t,e){return t.start-e.start||e.end-t.end}),o=0;o<t.length;o++){var u,d=l.length;d?(u=l[d-1].end,t[o].start-u<r?t[o].end>u&&(l[d-1].end=t[o].end):l.push(t[o])):l.push(t[o])}for(i=o=0,n=a=e;o<l.length;o++){var c=l[o].start,f=l[o].end;if(c<=e+r&&e<f)n=c,i=(a=f)-e;else if(e+r<c){s=c;break}}return{len:i,start:n,end:a,nextStart:s}},E=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"mp4";return o(t)&&/\.bin$/.test(t)?t.replace(/\.bin$/,"")+"/file.".concat(e):t}},339:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>k});var i=r(1),n=r(340),a=r(341),s=r(342),o=r(348),l=r(349),u=r(344),d=(r(345),r(353)),c=r(343),f=r(354),h=r(355),g=r(350),v=r(356),p=r(346),m=r(357),y=r(347);function E(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}var e=i.default.lib("utilities/bindify").bindify,T=i.default.lib("utilities/obj"),b=i.default.lib("player/lib/assets"),A=i.default.lib("utilities/seqid").seqId,S=i.default.lib("promiscuous"),r=(E(L.prototype,[{key:"activeBufferRange",value:function(){return a.activeBufferRange(this)}},{key:"anyBuffered",value:function(){return a.anyBuffered(this)}},{key:"cancelFullscreen",value:function(){return u.cancelFullscreen(this)}},{key:"captureCurrentFrame",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return u.captureCurrentFrame.apply(u,[this].concat(e))}},{key:"changeQuality",value:function(t){return l.changeQuality(this,t)}},{key:"changeStream",value:function(t){return l.changeStream(this,t)}},{key:"changeStreamWithoutLoad",value:function(t){return l.changeStreamWithoutLoad(this,t)}},{key:"changeVideo",value:function(t,e){return l.changeVideo(this,t,e)}},{key:"currentAsset",value:function(){return this._currentAsset}},{key:"defaultAsset",value:function(){return this.selectableAssets()[0]}},{key:"destroy",value:function(){var t=this.state||{};this.state={eventContext:t.eventContext,destroyed:!0,issuedPlay:t.issuedPlay},g.killBindingsAndStopLoops(this),this._bindings={}}},{key:"diagnosticData",value:function(){return h.getDiagnosticData(this)}},{key:"eventContext",value:function(){return this.state.eventContext}},{key:"fit",value:function(){return f.fit(this)}},{key:"hasIssuedPlay",value:function(){return!!this.state.issuedPlay}},{key:"getAudioTracks",value:function(){return[]}},{key:"getCurrentQuality",value:function(){var t=this.currentAsset();if(t)return b.numericSizeSnapped(t.width,t.height);t=this.selectedAsset();return t?b.numericSizeSnapped(t.width,t.height):"?"}},{key:"getCurrentTime",value:function(){return u.getCurrentTime(this)}},{key:"getCuts",value:function(){return(0,y.getCuts)(this)}},{key:"getDuration",value:function(){return u.getDuration(this)}},{key:"getMediaElement",value:function(){return this.video}},{key:"getMediaType",value:function(){return this.mediaData.mediaType}},{key:"getPlaybackMode",value:function(){return c.getPlaybackMode(this)}},{key:"getPlaybackRate",value:function(){return u.getPlaybackRate(this)}},{key:"getPreload",value:function(){return u.getPreload(this)}},{key:"getState",value:function(){return u.getState(this)}},{key:"getDurationBeforeCuts",value:function(){return(0,y.getDurationBeforeCuts)(this)}},{key:"getTimeAfterCuts",value:function(t){return(0,y.getTimeAfterCuts)(this,t)}},{key:"getTimeBeforeCuts",value:function(t){return(0,y.getTimeBeforeCuts)(this,t)}},{key:"getTrim",value:function(){return(0,p.getTrim)(this)}},{key:"getVolume",value:function(){return u.getVolume(this)}},{key:"isChangingVideo",value:function(){return l.isChangingVideo(this)}},{key:"isInFullscreen",value:function(){return u.isInFullscreen(this)}},{key:"isInitializingFromUnmuted",value:function(){return u.isInitializingFromUnmuted(this)}},{key:"isMuted",value:function(){return u.isMuted(this)}},{key:"isSeeking",value:function(){return s.isSeeking(this)}},{key:"isSourceOfBrowserEvent",value:function(t){return u.isSourceOfBrowserEvent(this,t)}},{key:"lastBufferedTime",value:function(t){return a.lastBufferedTime(this,t)}},{key:"mute",value:function(){return u.mute(this)}},{key:"onEnterFullscreen",value:function(){return u.onEnterFullscreen(this)}},{key:"onHeightChange",value:function(t){return f.onHeightChange(this,t)}},{key:"onLeaveFullscreen",value:function(){return u.onLeaveFullscreen(this)}},{key:"onReady",value:function(){return o.onReady(this)}},{key:"onWidthChange",value:function(t){return f.onWidthChange(this,t)}},{key:"pause",value:function(){return u.pause(this)}},{key:"play",value:function(t){return u.play(this,t)}},{key:"playType",value:function(){return u.playType(this)}},{key:"requestFullscreen",value:function(){return u.requestFullscreen(this)}},{key:"reset",value:function(){this.state={}}},{key:"seek",value:function(t,e){return s.seek(this,t,e)}},{key:"seekOnPlay",value:function(t){return s.seekOnPlay(this,t)}},{key:"selectedAsset",value:function(){return this._currentAsset}},{key:"selectableAssets",value:function(){return this.allAssets}},{key:"selectableQualities",value:function(){return this.selectableAssets().map(function(t){return"variable"===t.width?t.slug:b.numericSizeSnapped(t.width,t.height)}).sort(function(t,e){return("auto"===t?-1:t)-("auto"===e?-1:e)})}},{key:"selectedQuality",value:function(){var t=this.selectedAsset();return t?b.numericSizeSnapped(t.width,t.height):"?"}},{key:"sequentialBufferedRange",value:function(){return a.sequentialBufferedRange(this)}},{key:"setAttributes",value:function(t){T.assign(this.attributes,t)}},{key:"onMediaDataChanged",value:function(){}},{key:"onPlayed",value:function(){var r=this,t=this.state;return t&&t.hasPlayed?S.resolve():new S(function(e){r.bind("playing",function t(){r.unbind("playing",t),e()})})}},{key:"setCurrentTime",value:function(t){return u.setCurrentTime(this,t)}},{key:"setCuts",value:function(t){return(0,p.setCuts)(this,t)}},{key:"setPlaybackRate",value:function(t){return u.setPlaybackRate(this,t)}},{key:"setTrim",value:function(t){return(0,p.setTrim)(this,t)}},{key:"setVolume",value:function(t){return u.setVolume(this,t)}},{key:"showFirstFrame",value:function(){return s.seek(this,.01)}},{key:"canDownloadMedia",value:function(){return!0}},{key:"stopStreaming",value:function(){return l.stopStreaming(this)}},{key:"timeBeforeEndOfBuffer",value:function(t){return a.timeBeforeEndOfBuffer(this,t)}},{key:"totalBuffered",value:function(){return a.totalBuffered(this)}},{key:"totalPlayed",value:function(){return n.sumTimeRanges(this.video.played)}},{key:"unmute",value:function(){return u.unmute(this)}},{key:"updateStartPosition",value:function(){}}]),L);function L(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,L),this.uuid=A("wistia_simple_video_"),this.root=t,this.state={},g.setupProperties(this,e,r),i?g.fromOtherEngine(this,i):g.injectVideo(this),d.fixWebkitControlsBug(this),g.setupBindingsAndLoops(this),f.fit(this)}e(r.prototype),r.delegatePublicMethods=v.delegatePublicMethods,r.PUBLIC_METHODS=v.PUBLIC_METHODS,r.mediaDataWithAssets=function(t,e){t=T.clone(t);return t.assets=T.clone(e),t},(0,m.default)("SimpleVideo",r),i.default.define("player/engines/simple_video/index.js",r);const k=r},350:(t,e,r)=>{"use strict";r.r(e),r.d(e,{setupProperties:()=>u,injectVideo:()=>d,fromOtherEngine:()=>c,setupBindingsAndLoops:()=>f,killBindingsAndStopLoops:()=>h});var n=r(340),i=r(351),a=r(352),s=r(345),o=r(346),l=r(1).default.lib("player/lib/elem").elemAppend,u=function(t,e,r){var i=e.assets;0===i.length&&(i=[{}]),t.mediaData=e,t.allAssets=i,t.attributes=r},d=function(t){t._currentAsset=t.defaultAsset(),t.video=n.createElement(t.uuid,t._currentAsset,t.attributes),t.onReady(),l(t.root,t.video)},c=function(t,e){var r=e.isMuted(),i=e.hasIssuedPlay();"Audio"===e.mediaData.mediaType?d(t):t.video=e.getMediaElement(),t.onReady(),t.bind("loadstart",function(){return setTimeout(function(){t.state.isInitializingFromOtherEngine=!1},0),t.unbind}),n.setupVideoElemAttributes(t.video,t.defaultAsset(),t.attributes),t.state.eventContext=e.eventContext(),t.root.appendChild(t.video),t._currentAsset=t.defaultAsset(),t.changeStreamWithoutLoad(t.defaultAsset()),t.state.isInitializingFromOtherEngine=!0,t.state.otherEngineWasMuted=r,t.state.otherEnginePlayed=i,t.video.load()},f=function(t){a.setup(t),(0,o.enforceCuts)(t),s.setup(t),i.setup(t)},h=function(t){s.teardown(t),(0,o.teardownCuts)(t),i.teardown(t),a.teardown(t)}},354:(t,e,r)=>{"use strict";r.r(e),r.d(e,{onWidthChange:()=>l,onHeightChange:()=>u,fit:()=>c});var e=r(1),r=e.default.lib("player/lib/elem"),i=r.elemStyle,n=r.elemWidth,a=r.elemHeight,s=e.default.lib("player/lib/assets"),o=(0,e.default.lib("utilities/detect").cachedDetect)(),l=function(t,e){return t.setAttributes({width:e}),c(t)},u=function(t,e){return t.setAttributes({height:e}),c(t)},d="contain",c=function(t){var e=t.attributes.fitStrategy||f(t);return(e===d?g:"cover"===e?h:"fill"===e?v:g)(t)},f=function(t){var e=t.attributes.height,r=t.attributes.width,i=s.originalAspect(t.allAssets),t=e*i,i=2*Math.floor(r/i/2),e=Math.abs(i-e),t=Math.abs(t-r),r=o.firefox&&o.browser.mozilla&&36<=o.browser.version;return(o.browser.webkit||r)&&0<e&&e<=10&&0<t&&t<=10?"fill":d},h=function(t){var e=t.video,r=s.videoAspect(t.allAssets),t=n(t.root)/a(t.root);o.trident||o.edge||o.browser.msie?i(e,t<=r?{height:"100%",left:"50%",objectFit:"contain",position:"relative",top:"50%",transform:"translate(-50%,-50%)",width:"1920px"}:{height:"1088px",left:"50%",objectFit:"contain",position:"relative",top:"50%",transform:"translate(-50%,-50%)",width:"100%"}):i(e,{objectFit:"cover"})},g=function(t){t=t.video;i(t,{objectFit:"contain",height:"100%",width:"100%"})},v=function(t){t=t.video;i(t,{objectFit:"fill",height:"100%",width:"100%"})}},348:(t,e,r)=>{"use strict";r.r(e),r.d(e,{onReady:()=>u});var i=r(1),n=(i.default.lib("promiscuous"),i.default.lib("utilities/wlog").wlog),e=i.default.lib("player/lib/elem"),r=(e.elemBind,e.elemUnbind,i.default.lib("utilities/detect").cachedDetect),e=i.default.lib("player/lib/timeout-utils"),a=e.doTimeout,s=e.clearTimeouts,o=i.default.lib("utilities/stopgo"),l=n.getPrefixedFunctions("SimpleVideo"),u=(r(),function(t){var e=t.video;null==t.state&&(t.state={});var r=t.state;if(r.onReadyStopGo)return r.onReadyStopGo;var i=new o;if(r.onReadyStopGo=i,!r.hasBeenReady)return 2<=e.readyState?(l.info("ready readyState",e.src,e.readyState),r.hasBeenReady=!0,i.go()):(t.bind("loadstart",function(){s("".concat(t.uuid,".ready_fallback")),l.info("ready loadstart"),r.hasBeenReady=!0,i.go()}),a("".concat(t.uuid,".ready_fallback"),function(){r.hasBeenReady||(l.info("ready fallback"),r.hasBeenReady=!0,i.go())},200)),i;i.go()})},343:(t,e,r)=>{"use strict";r.r(e),r.d(e,{BEFORE_PLAY:()=>n,ENDED:()=>a,PAUSED:()=>s,PLAYING:()=>o,UNKNOWN:()=>l,getPlaybackMode:()=>u});var i=r(1).default.lib("utilities/wlog").wlog.getPrefixedFunctions("SimpleVideo"),n="beforeplay",a="ended",s="paused",o="playing",l="unknown",u=function(t){var e=t.video;try{return t.state.hasPlayed?t.state.fakeEnded||e.ended?a:e.paused?s:o:n}catch(t){return i.warn(t),l}}},345:(t,e,r)=>{"use strict";r.r(e),r.d(e,{setup:()=>i,isInVideoEventContext:()=>o,teardown:()=>l});var r=r(1).default.lib("player/lib/elem"),n=r.elemBind,a=r.elemUnbind,s=["beforeplay","ended","error","loadeddata","loadedmetadata","loadstart","pause","playing","progress","ratechange","seeked","volumechange","timeupdate","waiting","webkitbeginfullscreen","webkitendfullscreen","webkitplaybacktargetavailabilitychanged"],i=function(i){for(var t=0;t<s.length;t++)(function(e,r){var t="_marshalEvent_".concat(r);i[t]=i[t]||function(t){null==i.state&&(i.state={}),"playing"===r&&("playing"!==r||e.paused)||(i.state.eventContext=t,i.trigger(r,t),i.state.eventContext=null)},n(e,r,i[t])})(i.video,s[t])},o=function(t){return!(!t.state||!t.state.eventContext)},l=function(t){for(var e=0;e<s.length;e++){var r=s[e],i="_marshalEvent_".concat(r);a(t.video,r,t[i])}}},342:(t,e,r)=>{"use strict";r.r(e),r.d(e,{seek:()=>o,seekWithoutCuts:()=>f,seekOnPlay:()=>v,isSeeking:()=>m});var i=r(343),e=r(1),l=r(344),n=r(347),u=e.default.lib("promiscuous"),d=e.default.lib("utilities/obj").assign,r=e.default.lib("player/lib/elem"),a=r.elemBind,s=r.elemUnbind,c=e.default.lib("utilities/wlog").wlog.getPrefixedFunctions("SimpleVideo"),o=function(t,e,r){e=(0,n.getTimeBeforeCuts)(t,e);return f(t,e,r)},f=function(t,e,r){return c.info("seek",e),(t.getPlaybackMode()===i.BEFORE_PLAY?h:g)(t,e,r)},h=function(n,a){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=n.video;return c.info("seekBeforePlay",a),new u(function(r,e){c.info("time ".concat(a,": seek beforeplay"));var i="playing"===n.getPlaybackMode();o.style.visibility="hidden",d(n.state,{seeking:!0}),c.info("time ".concat(a,": start stream by calling play")),(0,l.playWithoutCuts)(n).then(function(t){c.info("time ".concat(a,": jump to time after playing")),o.currentTime=a;var e=new u(function(t){i||!1===s.pause?(c.info("time: ".concat(a,": play after seek")),t()):(c.info("time: ".concat(a,": pause after seek")),(0,l.pause)(n).then(t))});p(n).then(function(){e.then(function(){o.style.visibility="inherit",d(n.state,{seeking:!1}),r(t)})})}).catch(function(t){o.style.visibility="inherit",d(n.state,{seeking:!1}),e(t)})})},g=function(e,r){return c.info("seekNow",r),new u(function(t){c.info("seekNow: start",r),e.video.currentTime=r,d(e.state,{seeking:!0}),p(e).then(function(){d(e.state,{seeking:!1}),c.info("seekNow: resolve",r),t()})})},v=function(e,r){return new u(function(t){"playing"===e.getPlaybackMode()?g(e,r).then(t):e.bind("playing",function(){return g(e,r).then(t),e.unbind})})},p=function(t){var e=t.video;return new u(function(t){e.seeking?(c.info("waiting for seek"),a(e,"seeked",function(){return c.info("seeked"),t(),s})):(c.info("no wait for seek"),t())})},m=function(t){var e=t.state,t=t.video;return!(!e.seeking&&!t.seeking)}},344:(t,e,r)=>{"use strict";r.r(e),r.d(e,{play:()=>y,playWithoutCuts:()=>E,playType:()=>T,pause:()=>b,setCurrentTime:()=>A,setCurrentTimeWithoutCuts:()=>S,getCurrentTime:()=>L,getState:()=>k,setVolume:()=>D,getVolume:()=>_,supportsPlaybackRate:()=>R,setPlaybackRate:()=>C,getPlaybackRate:()=>I,getDuration:()=>x,isSourceOfBrowserEvent:()=>w,isMuted:()=>O,getPreload:()=>P,mute:()=>F,unmute:()=>M,onEnterFullscreen:()=>B,onLeaveFullscreen:()=>N,isInitializingFromUnmuted:()=>U,isInFullscreen:()=>G,onWidthChange:()=>j,onHeightChange:()=>H,requestFullscreen:()=>V,cancelFullscreen:()=>K,captureCurrentFrame:()=>W}),r(345);var a=r(346),i=r(1),n=r(347),l=i.default.lib("promiscuous"),e=i.default.lib("player/lib/elem"),u=(e.elemBind,e.elemUnbind),s=e.safeRequestAnimationFrame,o=e.elemRequestFullscreen,d=e.elemCancelFullscreen,c=e.inUserEventContext,r=i.default.lib("utilities/wlog").wlog,e=i.default.lib("utilities/detect").cachedDetect,f=i.default.lib("utilities/obj").merge,h=r.getPrefixedFunctions("SimpleVideo"),g=e(),v="play",p="play-silently",m="cannot-play",y=function(i,n){var t=(0,a.trimStartFromCuts)(i);return i.state.fakeEnded||i.video.currentTime<t?new l(function(e,r){i.seek(0,{pause:!1}).then(function(t){E(i,f({},n,{playType:v})).then(function(){e(t)}).catch(r)}).catch(r)}):E(i,n)},E=function(n){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=n.video,o=a.playType||T(n,a);return null==n.state.issuedPlay&&o!==m&&(n.state.issuedPlay=!0),new l(function(r,i){n.state.lastPlayRejected=!1;var t=n.getPlaybackMode();h.info("play: start",o),"playing"===t?(h.info("play: already playing, resolve"),r(v)):o===m?i(new Error("Cannot issue play.")):(o===p&&n.mute(),n.trigger("beforeplay"),"ended"===t&&0<g.ios.version&&s.load(),(t=s.play())&&t.then&&t.catch?t.then(function(){h.info("play: got",o,"resolve"),r(o)}).catch(function(t){h.notice(t),n.state.lastPlayRejected=!0;var e=(null==a.silentAutoPlay?n.attributes:a).silentAutoPlay;o!==v||n.isMuted()||"allow"!==e&&null!=e?(h.notice("play: rejected"),i(t)):(n.mute(),s.play().then(function(){h.info("play: got silent fallback, resolve"),r(p)}).catch(function(t){n.unmute(),i(t)}))}):(setTimeout(function(){g.ios.version&&g.ios.version<10.1&&s.paused&&i(new Error("Video still paused after play issued."))},10),n.bind("playing",function(){return h.info("play: got playing, resolve"),r(o),u})))})},T=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("playing"===t.getPlaybackMode())return v;if(t.isInitializingFromUnmuted())return v;if(c())return v;var r=t.attributes,e=(null==e.silentAutoPlay?r:e).silentAutoPlay;return!0===e?t.isMuted()?v:p:!1===e||"allow"!==e&&null!=e||g.chrome||g.firefox||g.edge||g.trident||(g.safari||g.ios.version&&12<=g.ios.version)||t.isMuted()?v:p},b=function(t){var e=t.video;return h.info("pause"),new l(function(t){h.info("pause: start"),e.pause(),s(function(){h.info("pause: resolve"),t()})})},A=function(t,e){e=(0,n.getTimeBeforeCuts)(t,e);return S(t,e)},S=function(t,e){h.info("setCurrentTime",e),t.video.currentTime=e},L=function(t){return(0,a.getCurrentTimeAfterCuts)(t)},k=function(t){return{playbackMode:t.getPlaybackMode(),currentTime:t.getCurrentTime(),volume:t.getVolume(),playbackRate:t.getPlaybackRate()}},D=function(t,e){h.info("setVolume",e),t.video.volume=e},_=function(t){return t.video.volume},R=function(t){return null!=t.video.playbackRate},C=function(t,e){h.info("setPlaybackRate",e),R(t)?t.video.playbackRate=e:h.info("playbackRate is not supported on",t.video)},I=function(t){return R(t)?t.video.playbackRate:1},x=function(t){return(0,a.getDurationAfterCuts)(t)},w=function(t,e){return e.target==t.video},O=function(t){var e=t.video;return!!(e.muted||t.state.loadedMetadata&&0===e.volume||t.state.hasPlayed&&e.audioTracks&&0===e.audioTracks.length)},P=function(t){return t.video.getAttribute("preload")},F=function(t){t.video.muted=!0,t.video.setAttribute("muted","muted")},M=function(t){t.video.muted=!1,t.video.removeAttribute("muted")},B=function(t){t.state.isInFullscreen=!0;var e=t.attributes.backgroundColor||"#000";t.video.style.backgroundColor=e},N=function(t){t.state.isInFullscreen=!1,t.video.style.backgroundColor="transparent"},U=function(t){t=t.state;return t.isInitializingFromOtherEngine&&t.otherEnginePlayed&&!t.otherEngineWasMuted},G=function(t){return!!t.state.isInFullscreen},j=function(t){},H=function(t){},V=function(t){t.setAttributes({fitStrategy:"contain"}),t.fit(),o(t.video)},K=function(t){t.setAttributes({fitStrategy:"auto"}),t.fit(),d(t.video)},W=function(t){var e=t.video,t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height);for(var r=arguments.length,i=Array(1<r?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return t.toDataURL.apply(t,i)}},349:(t,e,r)=>{"use strict";r.r(e),r.d(e,{stopStreaming:()=>o,changeQuality:()=>h,changeStreamWithoutLoad:()=>g,changeStream:()=>v,changeVideo:()=>m,initAfterChangeVideo:()=>E,isChangingVideo:()=>p,teardownBeforeChangeVideo:()=>y});var l=r(340),i=r(350),n=r(1),u=n.default.lib("promiscuous"),e=n.default.lib("utilities/wlog").wlog,r=n.default.lib("player/lib/elem"),a=r.elemInDom,d=r.elemBind,c=r.elemUnbind,s=n.default.lib("player/lib/assets"),f=e.getPrefixedFunctions("SimpleVideo"),o=function(t){try{if(t.state.destroyed)return;f.info("stopStreaming");var e=t.video;e.src="".concat(l.srcProtocolAndHost(e.getAttribute("src")),"/tiny.mp4"),e.load()}catch(t){f.notice(t)}},h=function(t,e,r,i){var n=t.selectableAssets(),e=s.findClosestAssetByQuality(n,e);return"beforeplay"===t.getPlaybackMode()?(g(t,e),u.resolve()):v(t,e,r,i)},g=function(n,t){f.info("changeStreamWithoutLoad",t&&t.slug,t);var e,r=n.video;a(r)&&(e=l.properAssetUrl(t.url,t.container),n.state={eventContext:n.state.eventContext},n._currentAsset=t,r.src=e,0<(r=function(){for(var t,e=n.video,r=[],i=0;i<e.childNodes.length;i++)1===(t=e.childNodes[i]).nodeType&&"source"===t.tagName.toLowerCase()&&r.push(t);return r}()).length&&(r[0].src=e),n.trigger("stream-changed",n._currentAsset))},v=function(i,n){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],s=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];f.info("changeStream",a,s,n&&n.slug,n);var o=i.video;return i.asset=n,new u(function(t){var e,r=l.properAssetUrl(n.url,n.container);s||r!==o.getAttribute("src")?(e=i.getState(),i.state.seeking=!0,d(o,"loadstart",function(){return s?(o.style.visibility="visible",i.state.seeking=!1,t()):2<e.currentTime?i.seek(e.currentTime).then(function(){"playing"===e.playbackMode?i.play().then(function(){i.state.seeking=!1,o.style.visibility="visible",t()}):i.pause().then(function(){o.style.visibility="visible",i.state.seeking=!1,t()})}):("playing"===e.playbackMode&&i.play(),o.style.visibility="visible",i.state.seeking=!1,t()),i.setPlaybackRate(e.playbackRate),c}),o.style.visibility="hidden",g(i,n,s),"beforeplay"===e.playbackMode||a||i.play()):t()})},p=function(t){return!!t.state.isChangingVideo},m=function(e,t,r){return y(e),e.state.isChangingVideo=!0,E(e,t,r),new u(function(t){v(e,e.defaultAsset()).then(function(){e.state.isChangingVideo=!1,t()})})},y=function(t){var e=t.state.eventContext;t.destroy(),t.state.eventContext=e},E=function(t,e,r){i.setupProperties(t,e,r),i.setupBindingsAndLoops(t,t.allAssets,r)}},352:(t,e,r)=>{"use strict";r.r(e),r.d(e,{maybeTriggerWaiting:()=>d,setup:()=>n,teardown:()=>a});function s(t){var e=t.attributes;return(null==e.eventLoopDuration?300:e.eventLoopDuration)/t.getPlaybackRate()}var e=r(1),o=e.default.lib("utilities/obj"),r=e.default.lib("player/lib/elem"),l=r.elemBind,u=r.elemUnbind,i=e.default.lib("utilities/event_loop").globalEventLoop,n=function(t){null==t.state&&(t.state={}),t.state.waiting=-1;var e="".concat(t.uuid,".waiting_events");i.add(e,s(t),function(){d(t),i.interval(e,s(t))})},a=function(t){t="".concat(t.uuid,".waiting_events");i.remove(t)},d=function(t){var e=t.video,r=t.state,i=r.lastPlaybackMode,n=r.gotWaiting&&"beforeplay"===t.getPlaybackMode()||"playing"===t.getPlaybackMode(),a="playing"===i||"beforeplay"===i&&!r.lastPlayRejected,i=r.lastEventLoopDuration||s(t);n&&a&&t.getCurrentTime()===r.lastTimePosition?(a=r.startedWaitingAt)?(r.waiting=((new Date).getTime()-a)/1e3,t.trigger("custom-waiting",r.waiting)):(o.assign(r,{startedWaitingAt:(new Date).getTime()-i,waiting:i/1e3}),t.trigger("custom-waiting",i/1e3),l(e,"timeupdate",function(){return c(t),u})):c(t)},c=function(t){var e=t.state.waiting;o.assign(t.state,{waiting:-1,startedWaitingAt:null}),null!=e&&0<=e&&t.trigger("custom-done-waiting",e)}},2:(t,e,r)=>{"use strict";var i;r.r(e),r.d(e,{default:()=>n});try{(i=self).self!==i&&(i.self,1)&&"undefined"!=typeof window&&(i=window)}catch(t){i="undefined"==typeof globalThis?window:globalThis}const n=i},1:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});e=r(2);null==e.default.Wistia&&(e.default.Wistia={});r=e.default.Wistia;null==r._initializers&&(r._initializers={}),null==r._destructors&&(r._destructors={}),null==r.mixin&&(r.mixin=function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])});const i=e.default.Wistia},336:(t,e,r)=>{function i(t,e){return function(){return t.apply(e,arguments)}}var g,n,a,v,s;function o(t){this.hls=t,this.abandonRulesCheck=i(this.abandonRulesCheck,this),this._onFragLoaded=i(this._onFragLoaded,this),this._onFragLoading=i(this._onFragLoading,this),this._onError=i(this._onError,this),this.lastLoadedFragLevel=0,this._autoLevelCapping=-1,this._nextAutoLevel=-1,this.defaultEstimate=this.hls.config.abrEwmaDefaultEstimate||5e5,this.minTotalWeight=.001,this._sampleCount=0,this._fast=new n(this.hls.config.abrEwmaFastVoD),this._slow=new n(this.hls.config.abrEwmaSlowVoD),this.minAutoLevel=0,(t=this.hls.config.abrEwmaDefaultEstimate)&&this.sample(6e3,6*(t/8)),this.hls.on(a.Events.FRAG_LOADING,this._onFragLoading),this.hls.on(a.Events.FRAG_LOADED,this._onFragLoaded),this.hls.on(a.Events.FRAG_LOADED,this._onError)}s=r(1).default,a=r(327),s=s.lib("utilities/wlog").wlog,v=s.getPrefixedFunctions("hlsabr"),n=r(337).default,g=r(338).default,o.prototype.destroy=function(){return this.clearTimer(),this.hls.off(a.Events.FRAG_LOADED,this._onFragLoaded),this.hls.off(a.Events.FRAG_LOADING,this._onFragLoading),this.hls.off(a.Events.FRAG_LOADING,this._onError)},o.prototype.getNextAutoLevel=function(){var t,e,r,i,n=this.maxAutoLevel();if(-1!==this._nextAutoLevel)return Math.min(this._nextAutoLevel,n);for(t=this.getEstimate()/this.playbackRate(),e=r=0,i=n;0<=i?r<=i:i<=r;e=0<=i?++r:--r)if((e<=this.lastLoadedFragLevel?this.hls.config.abrBandWidthFactor*t:this.hls.config.abrBandWidthUpFactor*t)<this.bitrateForLevel(e))return Math.max(0,e-1);return e-1},o.prototype.bitrateForLevel=function(t){return"function"==typeof this.hls.config.bitrateForLevel?this.hls.config.bitrateForLevel(t):this.hls.levels[t].bitrate},o.prototype._onError=function(t,e){var r=e.details===a.ErrorDetails.FRAG_LOAD_ERROR,e=e.details===a.ErrorDetails.FRAG_LOAD_TIMEOUT;if(r||e)return this.clearTimer()},o.prototype._onFragLoading=function(t,e){var r;if((e=e.frag).stats.loading.start=performance.now(),this.fragCurrent=e,this.timer||(this.timer=setInterval(this.abandonRulesCheck,100)),!this._setupSeekTracking)return this._setupSeekTracking=!0,this.hls.media.addEventListener("seeked",(r=this,function(){var t;if(null!=(t=r.hls)&&t.media)return 0<r.hls.media.currentTime&&r.hls.media.currentTime<3?void 0:(r._justSeeked=!0,clearTimeout(r._unsetSeekedTimeout),r._unsetSeekedTimeout=setTimeout(function(){return r._justSeeked=!1},3e3))}))},o.prototype._onFragLoaded=function(t,e){var r,i=(r=e.frag).stats;if("main"===r.type&&(this.clearTimer(),null==i.aborted&&!i.alreadySampled))return e=performance.now()-i.loading.start,i=i.loaded,!this.hls.media.seeking&&this._justSeeked&&this.timeBeforeEndOfBuffer()<3?this.sample(.35*e,.35*i):this.sample(e,i),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1},o.prototype.abandonRulesCheck=function(){var t,e,r,i,n,a,s,o,l,u,d,c,f,h=(a=this.hls).media;if((!(r=this.fragCurrent).loader||null!=(c=r.loader.stats)&&c.aborted)&&(a.config.debug.info("hlsjs: frag loader destroy or aborted, disarm abandonRulesCheck"),this.clearTimer()),h&&!h.paused&&r.autoLevel&&r.level&&(s=.1,3e3<(f=performance.now()-r.stats.loading.start)&&f>1e3*r.duration*.5&&(o=a.levels,l=Math.max(1,1e3*r.loaded/f),t=this.bitrateForLevel(r.level),c=Math.max(r.loaded,Math.round((r.duration-s)*t/8)),d=h.currentTime,n=(c-r.loaded)/l,(e=g.bufferInfo(h,d,a.config.maxBufferHole).end-d)<2*r.duration&&e<n))){if(u=r.level-1,0===r.loaded)return h.currentTime<1&&(isNaN(u)&&v.error("abandonRulesCheck a: nextLoadLevel is NaN",u,n,e,d,l,f,o),a.startLevel=u),a.nextLoadLevel=u;for(;0<=u&&(t=this.bitrateForLevel(u),i=r.duration*t/(7.2*l)+s,a.config.debug.info("hlsjs: fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay["+u+"] :"+n.toFixed(1)+"/"+e.toFixed(1)+"/"+i.toFixed(1)),!(i<e));)--u;return 1<n-i&&(u=Math.max(0,u),h.currentTime<1&&(isNaN(u)&&v.error("abandonRulesCheck b: nextLoadLevel is NaN",u,n,e,d,l,f,o),a.startLevel=u),a.nextLoadLevel=u,this.sample(f,r.loaded)),a.config.debug.warn("loading too slow, abort fragment loading and switch to level "+u),r.loader.abort(),this.clearTimer(),a.trigger(Event.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r}),a.startLoad()}},o.prototype.clearTimer=function(){if(this.timer)return clearInterval(this.timer),this.timer=null},o.prototype.maxAutoLevel=function(){var t=this.hls.levels;return-1===this._autoLevelCapping&&null!=t&&t.length?t.length-1:this._autoLevelCapping},o.prototype.playbackRate=function(){var t;return 0===(null==(t=this.hls.media)?void 0:t.playbackRate)?1:Math.abs(t.playbackRate)},o.prototype.sample=function(t,e){var r=(t=Math.max(t,50))/1e3,t=8e3*e/t;return this._fast.sample(r,t),this._slow.sample(r,t),this._sampleCount+=1},o.prototype.getEstimate=function(){return this._sampleCount<1||this._fast.getTotalWeight()<this.minTotalWeight?this.defaultEstimate:!this.hls.media||this.timeBeforeEndOfBuffer()<=6?Math.min(this._fast.getEstimate(),this._slow.getEstimate()):Math.max(this._fast.getEstimate(),this._slow.getEstimate())},o.prototype.timeBeforeEndOfBuffer=function(){return g.timeBeforeEndOfBuffer(this.hls.media,this.hls.config.maxBufferHole)},o.prototype.lastBufferedTime=function(){return g.lastBufferedTime(this.hls.media,this.hls.config.maxBufferHole)},Object.defineProperties(o.prototype,{nextAutoLevel:{get:function(){return this.getNextAutoLevel()},set:function(t){return this._nextAutoLevel=t}},autoLevelCapping:{get:function(){return this._autoLevelCapping},set:function(t){return this._autoLevelCapping=t}}}),t.exports=o},327:function(t){var e;"undefined"!=typeof window&&(e=function(){return r={"./node_modules/eventemitter3/index.js":function(t,e,r){"use strict";function i(){}function a(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function n(t,e,r,i,n){if("function"!=typeof r)throw new TypeError("The listener must be a function");n=new a(r,i||t,n),e=h?h+e:e;return t._events[e]?t._events[e].fn?t._events[e]=[t._events[e],n]:t._events[e].push(n):(t._events[e]=n,t._eventsCount++),t}function l(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function s(){this._events=new i,this._eventsCount=0}var o=Object.prototype.hasOwnProperty,h="~";Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(h=!1)),s.prototype.eventNames=function(){var t,e,r=[];if(0===this._eventsCount)return r;for(e in t=this._events)o.call(t,e)&&r.push(h?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},s.prototype.listeners=function(t){var t=h?h+t:t,e=this._events[t];if(!e)return[];if(e.fn)return[e.fn];for(var r=0,i=e.length,n=Array(i);r<i;r++)n[r]=e[r].fn;return n},s.prototype.listenerCount=function(t){t=h?h+t:t,t=this._events[t];return t?t.fn?1:t.length:0},s.prototype.emit=function(t,e,r,i,n,a){var s=h?h+t:t;if(!this._events[s])return!1;var o,l=this._events[s],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,i),!0;case 5:return l.fn.call(l.context,e,r,i,n),!0;case 6:return l.fn.call(l.context,e,r,i,n,a),!0}for(f=1,o=Array(u-1);f<u;f++)o[f-1]=arguments[f];l.fn.apply(l.context,o)}else for(var d,c=l.length,f=0;f<c;f++)switch(l[f].once&&this.removeListener(t,l[f].fn,void 0,!0),u){case 1:l[f].fn.call(l[f].context);break;case 2:l[f].fn.call(l[f].context,e);break;case 3:l[f].fn.call(l[f].context,e,r);break;case 4:l[f].fn.call(l[f].context,e,r,i);break;default:if(!o)for(d=1,o=Array(u-1);d<u;d++)o[d-1]=arguments[d];l[f].fn.apply(l[f].context,o)}return!0},s.prototype.on=function(t,e,r){return n(this,t,e,r,!1)},s.prototype.once=function(t,e,r){return n(this,t,e,r,!0)},s.prototype.removeListener=function(t,e,r,i){t=h?h+t:t;if(!this._events[t])return this;if(!e)return l(this,t),this;var n=this._events[t];if(n.fn)n.fn!==e||i&&!n.once||r&&n.context!==r||l(this,t);else{for(var a=0,s=[],o=n.length;a<o;a++)(n[a].fn!==e||i&&!n[a].once||r&&n[a].context!==r)&&s.push(n[a]);s.length?this._events[t]=1===s.length?s[0]:s:l(this,t)}return this},s.prototype.removeAllListeners=function(t){return t?(t=h?h+t:t,this._events[t]&&l(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=h,t.exports=s.EventEmitter=s},"./node_modules/url-toolkit/src/url-toolkit.js":function(t,e,r){var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,a=/^([^\/?#]*)([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),!(e=e.trim())){if(!r.alwaysNormalize)return t;var i=o.parseURL(t);if(!i)throw new Error("Error trying to parse base URL.");return i.path=o.normalizePath(i.path),o.buildURLFromParts(i)}i=o.parseURL(e);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=o.normalizePath(i.path),o.buildURLFromParts(i)):e;e=o.parseURL(t);if(!e)throw new Error("Error trying to parse base URL.");!e.netLoc&&e.path&&"/"!==e.path[0]&&(n=a.exec(e.path),e.netLoc=n[1],e.path=n[2]),e.netLoc&&!e.path&&(e.path="/");var n,t={scheme:e.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};return i.netLoc||(t.netLoc=e.netLoc,"/"===i.path[0])||(i.path?(n=(n=e.path).substring(0,n.lastIndexOf("/")+1)+i.path,t.path=o.normalizePath(n)):(t.path=e.path,i.params||(t.params=e.params,i.query||(t.query=e.query)))),null===t.path&&(t.path=r.alwaysNormalize?o.normalizePath(i.path):i.path),o.buildURLFromParts(t)},parseURL:function(t){t=i.exec(t);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(n,"");t.length!==(t=t.replace(s,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=o},"./node_modules/webworkify-webpack/index.js":function(t,e,f){function a(r){function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var n={};i.m=r,i.c=n,i.i=function(t){return t},i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i.oe=function(t){throw console.error(t),t};var t=i(i.s=ENTRY_MODULE);return t.default||t}function h(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}t.exports=function(c,t){var r={main:f.m},i=(t=t||{}).all?{main:Object.keys(r.main)}:function(t){for(var e={main:[c]},r={main:[]},i={main:{}};function(r){return Object.keys(r).reduce(function(t,e){return t||0<r[e].length},!1)}(e);)for(var n=Object.keys(e),a=0;a<n.length;a++){var s=n[a],o=e[s].pop();if(i[s]=i[s]||{},!i[s][o]&&t[s][o]){i[s][o]=!0,r[s]=r[s]||[],r[s].push(o);for(var l=function(t,e,r){var i={};i[r]=[];var n,a=e.toString();if(!(e=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)))return i;for(var s,e=e[1],o=new RegExp("(\\\\n|\\W)"+h(e)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");s=o.exec(a);)"dll-reference"!==s[3]&&i[r].push(s[3]);for(o=new RegExp("\\("+h(e)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");s=o.exec(a);)t[s[2]]||(i[r].push(s[1]),t[s[2]]=f(s[1]).m),i[s[2]]=i[s[2]]||[],i[s[2]].push(s[4]);for(var l=Object.keys(i),u=0;u<l.length;u++)for(var d=0;d<i[l[u]].length;d++)n=i[l[u]][d],isNaN(+n)||(i[l[u]][d]=+i[l[u]][d]);return i}(t,t[s][o],s),u=Object.keys(l),d=0;d<u.length;d++)e[u[d]]=e[u[d]]||[],e[u[d]]=e[u[d]].concat(l[u[d]])}}return r}(r),n="";Object.keys(i).filter(function(t){return"main"!==t}).forEach(function(e){for(var t=0;i[e][t];)t++;i[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",n=n+"var "+e+" = ("+a.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+i[e].map(function(t){return JSON.stringify(t)+": "+r[e][t].toString()}).join(",")+"});\n"});var n=n+"new (("+a.toString().replace("ENTRY_MODULE",JSON.stringify(c))+")({"+i.main.map(function(t){return JSON.stringify(t)+": "+r.main[t].toString()}).join(",")+"}))(self);",e=new window.Blob([n],{type:"text/javascript"});if(t.bare)return e;t=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(e),e=new window.Worker(t);return e.objectURL=t,e}},"./src/config.ts":function(t,e,r){"use strict";function i(){return(i=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)}function a(e,t){var r,i=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)),i}function n(i){for(var n,t=1;t<arguments.length;t++)n=null==arguments[t]?{}:arguments[t],t%2?a(Object(n),!0).forEach(function(t){var e,r;e=i,t=n[r=t],r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(n,t))});return i}function s(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return i({},t,e)}function o(t){var e=t.loader;e!==v.default&&e!==g.default?(p.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):Object(v.fetchSupported)()&&(t.loader=v.default,t.progressive=!0,t.enableSoftwareAES=!0,p.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}r.r(e),r.d(e,"hlsDefaultConfig",function(){return m}),r.d(e,"mergeConfig",function(){return s}),r.d(e,"enableStreamingMode",function(){return o});var l=r("./src/empty.js"),u=r.n(l),d=r("./src/controller/audio-stream-controller.ts"),c=r("./src/controller/audio-track-controller.ts"),f=r("./src/controller/buffer-controller.ts"),h=r("./src/controller/cap-level-controller.ts"),e=r("./src/controller/fps-controller.ts"),g=r("./src/utils/xhr-loader.ts"),v=r("./src/utils/fetch-loader.ts"),l=r("./src/utils/mediakeys-helper.ts"),p=r("./src/utils/logger.ts"),m=n(n({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:g.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:u.a,bufferController:f.default,capLevelController:h.default,fpsController:e.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:l.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:u.a,enableCEA708Captions:!1,enableWebVTT:!1,enableIMSC1:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:d.default,audioTrackController:c.default,emeController:void 0})},"./src/controller/audio-stream-controller.ts":function(t,e,r){"use strict";function f(){return(f=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}r.r(e);var n=r("./src/polyfills/number.ts"),h=r("./src/controller/base-stream-controller.ts"),g=r("./src/events.ts"),l=r("./src/utils/buffer-helper.ts"),a=r("./src/controller/fragment-tracker.ts"),s=r("./src/types/level.ts"),d=r("./src/types/loader.ts"),v=r("./src/loader/fragment.ts"),c=r("./src/demux/chunk-cache.ts"),p=r("./src/demux/transmuxer-interface.ts"),m=r("./src/types/transmuxer.ts"),u=r("./src/controller/fragment-finders.ts"),y=r("./src/utils/discontinuities.ts"),E=r("./src/errors.ts"),T=r("./src/utils/logger.ts"),r=function(o){function t(t,e){return(e=o.call(this,t,e,"[audio-stream-controller]")||this).videoBuffer=null,e.videoTrackCC=-1,e.waitingVideoCC=-1,e.audioSwitch=!1,e.trackId=-1,e.waitingData=null,e.mainDetails=null,e.bufferFlushed=!1,e._registerListeners(),e}var e,r=o;(e=t).prototype=Object.create(r.prototype),i(e.prototype.constructor=e,r);r=t.prototype;return r.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},r._registerListeners=function(){var t=this.hls;t.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(g.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(g.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(g.Events.ERROR,this.onError,this),t.on(g.Events.BUFFER_RESET,this.onBufferReset,this),t.on(g.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var t=this.hls;t.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(g.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(g.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(g.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(g.Events.ERROR,this.onError,this),t.off(g.Events.BUFFER_RESET,this.onBufferReset,this),t.off(g.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(g.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onInitPtsFound=function(t,e){var r=e.frag,i=e.id,e=e.initPTS;"main"===i&&(i=r.cc,this.initPTS[r.cc]=e,this.log("InitPTS for cc: "+i+" found from main: "+e),this.videoTrackCC=i,this.state===h.State.WAITING_INIT_PTS&&this.tick())},r.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=h.State.STOPPED);var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<e&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=h.State.IDLE):(this.loadedmetadata=!1,this.state=h.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},r.doTick=function(){switch(this.state){case h.State.IDLE:this.doTickIdle();break;case h.State.WAITING_TRACK:var t=this.levels,e=this.trackId,r=null==t||null===(r=t[e])||void 0===r?void 0:r.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=h.State.WAITING_INIT_PTS}break;case h.State.FRAG_LOADING_WAITING_RETRY:var i=performance.now(),n=this.retryDate;(!n||n<=i||null!==(a=this.media)&&void 0!==a&&a.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=h.State.IDLE);break;case h.State.WAITING_INIT_PTS:var a,s,r=this.waitingData;r?(n=r.frag,i=r.part,a=r.cache,r=r.complete,void 0!==this.initPTS[n.cc]?(this.waitingData=null,this.waitingVideoCC=-1,this.state=h.State.FRAG_LOADING,s={frag:n,part:i,payload:a.flush(),networkDetails:null},this._handleFragmentLoadProgress(s),r&&o.prototype._handleFragmentLoadComplete.call(this,s)):this.videoTrackCC!==this.waitingVideoCC?(T.logger.log("Waiting fragment cc ("+n.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):(s=this.getLoadPosition(),s=l.BufferHelper.bufferInfo(this.mediaBuffer,s,this.config.maxBufferHole),Object(u.fragmentWithinToleranceTest)(s.end,this.config.maxFragLookUpTolerance,n)<0&&(T.logger.log("Waiting fragment cc ("+n.cc+") @ "+n.start+" cancelled because another fragment at "+s.end+" is needed"),this.clearWaitingFragment()))):this.state=h.State.IDLE}this.onTickEnd()},r.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=h.State.IDLE)},r.onTickEnd=function(){var t,e=this.media;e&&e.readyState&&(t=(this.mediaBuffer||e).buffered,!this.loadedmetadata&&t.length&&(this.loadedmetadata=!0),this.lastCurrentTime=e.currentTime)},r.doTickIdle=function(){var t=this.hls,e=this.levels,r=this.media,i=this.trackId,n=t.config;if(e&&e[i]&&(r||!this.startFragRequested&&n.startFragPrefetch)){var a=e[i].details;if(!a||a.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(a))this.state=h.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer||this.media,v.ElementaryStreamTypes.AUDIO,d.PlaylistLevelType.AUDIO));var s=this.getFwdBufferInfo(this.mediaBuffer||this.media,d.PlaylistLevelType.AUDIO);if(null!==s){var n=s.len,e=this.getMaxBufferLength(),i=this.audioSwitch;if(!(e<=n)||i){if(!i&&this._streamEnded(s,a))return t.trigger(g.Events.BUFFER_EOS,{type:"audio"}),void(this.state=h.State.ENDED);var n=a.fragments[0].start,t=s.end;i&&(t=i=this.getLoadPosition(),a.PTSKnown&&i<n&&(s.end>n||s.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=n+.05));r=this.getNextFragment(t,a);return r?void("identity"!==(null===(n=r.decryptdata)||void 0===n?void 0:n.keyFormat)||null!==(n=r.decryptdata)&&void 0!==n&&n.key?this.loadFragment(r,a,t):this.loadKey(r,a)):void(this.bufferFlushed=!0)}}}}},r.getMaxBufferLength=function(){var t=o.prototype.getMaxBufferLength.call(this),e=this.getFwdBufferInfo(this.videoBuffer||this.media,d.PlaylistLevelType.MAIN);return null===e?t:Math.max(t,e.len)},r.onMediaDetaching=function(){this.videoBuffer=null,o.prototype.onMediaDetaching.call(this)},r.onAudioTracksUpdated=function(t,e){e=e.audioTracks;this.resetTransmuxer(),this.levels=e.map(function(t){return new s.Level(t)})},r.onAudioTrackSwitching=function(t,e){var r=!!e.url;this.trackId=e.id;e=this.fragCurrent;null!=e&&e.loader&&e.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=h.State.IDLE):this.state=h.State.STOPPED,this.tick()},r.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},r.onLevelLoaded=function(t,e){this.mainDetails=e.details},r.onAudioTrackLoaded=function(t,e){var r=this.levels,i=e.details,n=e.id;if(r){this.log("Track "+n+" loaded ["+i.startSN+","+i.endSN+"],duration:"+i.totalduration);e=r[n],r=0;if(i.live||null!==(a=e.details)&&void 0!==a&&a.live){var a=this.mainDetails;if(i.fragments[0]||(i.deltaUpdateFailed=!0),i.deltaUpdateFailed||!a)return;r=!e.details&&i.hasProgramDateTime&&a.hasProgramDateTime?(Object(y.alignPDT)(i,a),i.fragments[0].start):this.alignPlaylists(i,e.details)}e.details=i,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(e.details,r),this.state!==h.State.WAITING_TRACK||this.waitForCdnTuneIn(i)||(this.state=h.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+n)},r._handleFragmentLoadProgress=function(t){var e,r,i,n=t.frag,a=t.part,s=t.payload,o=this.config,l=this.trackId,u=this.levels;u?(i=u[l],console.assert(i,"Audio track is defined on fragment load progress"),e=i.details,console.assert(e,"Audio track details are defined on fragment load progress"),r=o.defaultAudioCodec||i.audioCodec||"mp4a.40.2",t=(t=this.transmuxer)||(this.transmuxer=new p.default(this.hls,d.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this))),u=this.initPTS[n.cc],i=null===(o=n.initSegment)||void 0===o?void 0:o.data,void 0!==u?(o=a?a.index:-1,o=new m.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,s.byteLength,o,-1!==o),t.push(s,i,r,"",n,a,e.totalduration,!1,o,u)):(T.logger.log("Unknown video PTS for cc "+n.cc+", waiting for video PTS before demuxing audio frag "+n.sn+" of ["+e.startSN+" ,"+e.endSN+"],track "+l),(this.waitingData=this.waitingData||{frag:n,part:a,cache:new c.default,complete:!1}).cache.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=h.State.WAITING_INIT_PTS)):this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},r._handleFragmentLoadComplete=function(t){return this.waitingData?void(this.waitingData.complete=!0):void o.prototype._handleFragmentLoadComplete.call(this,t)},r.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.onBufferCreated=function(t,e){var r=e.tracks.audio;r&&(this.mediaBuffer=r.buffer),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},r.onFragBuffered=function(t,e){var r=e.frag,e=e.part;return r.type===d.PlaylistLevelType.AUDIO?this.fragContextChanged(r)?void this.warn("Fragment "+r.sn+(e?" p: "+e.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==r.sn&&(this.fragPrevious=r,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(g.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),void this.fragBufferedComplete(r,e)):void 0},r.onError=function(t,e){switch(e.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.AUDIO,e);break;case E.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case E.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==h.State.ERROR&&this.state!==h.State.STOPPED&&(this.state=e.fatal?h.State.ERROR:h.State.IDLE,this.warn(e.details+" while loading frag, switching to "+this.state+" state"));break;case E.ErrorDetails.BUFFER_FULL_ERROR:var r,i;"audio"!==e.parent||this.state!==h.State.PARSING&&this.state!==h.State.PARSED||(r=!0,(r=(i=this.getFwdBufferInfo(this.mediaBuffer,d.PlaylistLevelType.AUDIO))&&.5<i.len?!this.reduceMaxBufferLength(i.len):r)&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState())}},r.onBufferFlushed=function(t,e){e.type===v.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},r._handleTransmuxComplete=function(t){var e,r=this.hls,i=t.remuxResult,n=t.chunkMeta,a=this.getCurrentContext(n);if(!a)return this.warn("The loading context changed while buffering fragment "+n.sn+" of level "+n.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(n.level);var s=a.frag,o=a.part,l=i.audio,u=i.text,d=i.id3,c=i.initSegment;this.fragContextChanged(s)||(this.state=h.State.PARSING,this.audioSwitch&&l&&this.completeAudioSwitch(),null!=c&&c.tracks&&(this._bufferInitSegment(c.tracks,s,n),r.trigger(g.Events.FRAG_PARSING_INIT_SEGMENT,{frag:s,id:"audio",tracks:c.tracks})),l&&(t=l.startPTS,a=l.endPTS,i=l.startDTS,c=l.endDTS,o&&(o.elementaryStreams[v.ElementaryStreamTypes.AUDIO]={startPTS:t,endPTS:a,startDTS:i,endDTS:c}),s.setElementaryStreamInfo(v.ElementaryStreamTypes.AUDIO,t,a,i,c),this.bufferFragmentData(l,s,o,n)),null!=d&&null!==(e=d.samples)&&void 0!==e&&e.length&&(d=f({frag:s,id:"audio"},d),r.trigger(g.Events.FRAG_PARSING_METADATA,d)),u&&(u=f({frag:s,id:"audio"},u),r.trigger(g.Events.FRAG_PARSING_USERDATA,u)))},r._bufferInitSegment=function(t,e,r){var i;this.state===h.State.PARSING&&(t.video&&delete t.video,(i=t.audio)&&(i.levelCodec=i.codec,i.id="audio",this.log("Init audio buffer, container:"+i.container+", codecs[parsed]=["+i.codec+"]"),this.hls.trigger(g.Events.BUFFER_CODECS,t),null!=(i=i.initSegment)&&i.byteLength&&(i={type:"audio",frag:e,part:null,chunkMeta:r,parent:e.type,data:i},this.hls.trigger(g.Events.BUFFER_APPENDING,i)),this.tick()))},r.loadFragment=function(t,e,r){var i=this.fragmentTracker.getState(t);this.fragCurrent=t,!this.audioSwitch&&i!==a.FragmentState.NOT_LOADED&&i!==a.FragmentState.PARTIAL||("initSegment"===t.sn?this._loadInitSegment(t):e.live&&!Object(n.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=h.State.WAITING_INIT_PTS):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,t,e,r)))},r.completeAudioSwitch=function(){var t=this.hls,e=this.media,r=this.trackId;e&&(this.log("Switching audio track : flushing all audio"),o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(g.Events.AUDIO_TRACK_SWITCHED,{id:r})},t}(h.default);e.default=r},"./src/controller/audio-track-controller.ts":function(t,e,r){"use strict";function n(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}r.r(e);var l=r("./src/events.ts"),s=r("./src/errors.ts"),i=r("./src/controller/base-playlist-controller.ts"),o=r("./src/types/loader.ts"),i=function(r){function t(t){return(t=r.call(this,t,"[audio-track-controller]")||this).tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}var e,i=r;(e=t).prototype=Object.create(i.prototype),a(e.prototype.constructor=e,i);i=t.prototype;return i.registerListeners=function(){var t=this.hls;t.on(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(l.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(l.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(l.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(l.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(l.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){var t=this.hls;t.off(l.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(l.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(l.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(l.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(l.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(l.Events.ERROR,this.onError,this)},i.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,r.prototype.destroy.call(this)},i.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},i.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},i.onAudioTrackLoaded=function(t,e){var r,i=e.id,n=e.details,a=this.tracksInGroup[i];a?(r=a.details,a.details=e.details,this.log("audioTrack "+i+" loaded ["+n.startSN+"-"+n.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,e,r))):this.warn("Invalid audio track id "+i)},i.onLevelLoading=function(t,e){this.switchLevel(e.level)},i.onLevelSwitching=function(t,e){this.switchLevel(e.level)},i.switchLevel=function(t){var e,r=this.hls.levels[t];null!=r&&r.audioGroupIds&&(e=r.audioGroupIds[r.urlId],this.groupId!==e&&(this.groupId=e,t=this.tracks.filter(function(t){return!e||t.groupId===e}),this.selectDefaultTrack&&!t.some(function(t){return t.default})&&(this.selectDefaultTrack=!1),r={audioTracks:this.tracksInGroup=t},this.log("Updating audio tracks, "+t.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(l.Events.AUDIO_TRACKS_UPDATED,r),this.selectInitialTrack()))},i.onError=function(t,e){r.prototype.onError.call(this,t,e),e.fatal||!e.context||e.context.type===o.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},i.setAudioTrack=function(t){var e,r,i,n,a,s,o=this.tracksInGroup;t<0||t>=o.length?this.warn("Invalid id passed to audio-track controller"):(this.clearTimer(),s=o[this.trackId],this.log("Now switching to audio-track index "+t),r=(e=o[t]).id,i=void 0===(a=e.groupId)?"":a,n=e.name,o=e.type,a=e.url,this.trackId=t,this.trackName=n,this.selectDefaultTrack=!1,this.hls.trigger(l.Events.AUDIO_TRACK_SWITCHING,{id:r,groupId:i,name:n,type:o,url:a}),e.details&&!e.details.live||(s=this.switchParams(e.url,null==s?void 0:s.details),this.loadPlaylist(s)))},i.selectInitialTrack=function(){var t=this.tracksInGroup;console.assert(t.length,"Initial audio track should be selected when tracks are known");t=this.trackName,t=this.findTrackId(t)||this.findTrackId();-1===t?(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(l.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0})):this.setAudioTrack(t)},i.findTrackId=function(t){for(var e,r=this.tracksInGroup,i=0;i<r.length;i++)if(e=r[i],(!this.selectDefaultTrack||e.default)&&(!t||t===e.name))return e.id;return-1},i.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var r=e.id,i=e.groupId,e=e.url;if(t)try{e=t.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(l.Events.AUDIO_TRACK_LOADING,{url:e,id:r,groupId:i,deliveryDirectives:t||null})}},n(t.prototype,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}]),t}(i.default);e.default=i},"./src/controller/base-playlist-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return a});var o=r("./src/polyfills/number.ts"),l=r("./src/types/level.ts"),g=r("./src/controller/level-helper.ts"),i=r("./src/utils/logger.ts"),n=r("./src/errors.ts"),a=((r=s.prototype).destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},r.onError=function(t,e){e.fatal&&e.type===n.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},r.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},r.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},r.stopLoad=function(){this.canLoad=!1,this.clearTimer()},r.switchParams=function(t,e){var r=null==e?void 0:e.renditionReports;if(r)for(var i=0;i<r.length;i++){var n=r[i],a=""+n.URI;if(a===t.substr(-a.length)){var s=parseInt(n["LAST-MSN"]),a=parseInt(n["LAST-PART"]);if(e&&this.hls.config.lowLatencyMode&&(n=Math.min(e.age-e.partTarget,e.targetduration),void 0!==a&&n>e.partTarget&&(a+=1)),Object(o.isFiniteNumber)(s))return new l.HlsUrlParameters(s,Object(o.isFiniteNumber)(a)?a:void 0,l.HlsSkip.No)}}},r.loadPlaylist=function(t){},r.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},r.playlistLoaded=function(t,e,r){var i=this,n=e.details,a=e.stats,s=a.loading.end?Math.max(0,self.performance.now()-a.loading.end):0;if(n.advancedDateTime=Date.now()-s,n.live||null!=r&&r.live){if(n.reloaded(r),r&&this.log("live playlist "+t+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),r&&0<n.fragments.length&&Object(g.mergeDetails)(r,n),this.canLoad&&n.live){var o,l=void 0,u=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var d=this.hls.config.lowLatencyMode,c=n.lastPartSn,f=n.endSN,h=n.lastPartIndex,s=c===f;-1!==h?(l=s?f+1:c,u=s?d?0:h:h+1):l=f+1;h=n.age,f=h+n.ageHeader,f=Math.min(f-n.partTarget,1.5*n.targetduration);if(0<f&&(r&&f>r.tuneInGoal?(this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+f+" with playlist age: "+n.age),f=0):(l+=r=Math.floor(f/n.targetduration),void 0!==u&&(u+=Math.round(f%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+h.toFixed(2)+"s goal: "+f+" skip sn "+r+" to part "+u)),n.tuneInGoal=f),o=this.getDeliveryDirectives(n,e.deliveryDirectives,l,u),d||!s)return void this.loadPlaylist(o)}else o=this.getDeliveryDirectives(n,e.deliveryDirectives,l,u);a=Object(g.computeReloadInterval)(n,a);void 0!==l&&n.canBlockReload&&(a-=n.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(a)+" ms"),this.timer=self.setTimeout(function(){return i.loadPlaylist(o)},a)}}else this.clearTimer()},r.getDeliveryDirectives=function(t,e,r,i){var n=Object(l.getSkipValue)(t,r);return null!=e&&e.skip&&t.deltaUpdateFailed&&(r=e.msn,i=e.part,n=l.HlsSkip.No),new l.HlsUrlParameters(r,i,n)},r.retryLoadingOrFail=function(t){var e,r=this,i=this.hls.config,n=this.retryCount<i.levelLoadingMaxRetry;return n?(this.retryCount++,-1<t.details.indexOf("LoadTimeOut")&&null!==(e=t.context)&&void 0!==e&&e.deliveryDirectives?(this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist()):(i=Math.min(Math.pow(2,this.retryCount)*i.levelLoadingRetryDelay,i.levelLoadingMaxRetryTimeout),this.timer=self.setTimeout(function(){return r.loadPlaylist()},i),this.warn("retry playlist loading #"+this.retryCount+" in "+i+' ms after "'+t.details+'"'))):(this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0),n},s);function s(t,e){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=i.logger.log.bind(i.logger,e+":"),this.warn=i.logger.warn.bind(i.logger,e+":"),this.hls=t}},"./src/controller/base-stream-controller.ts":function(t,e,r){"use strict";function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}r.r(e),r.d(e,"State",function(){return b}),r.d(e,"default",function(){return n});var l=r("./src/polyfills/number.ts"),e=r("./src/task-loop.ts"),f=r("./src/controller/fragment-tracker.ts"),s=r("./src/utils/buffer-helper.ts"),o=r("./src/utils/logger.ts"),c=r("./src/events.ts"),u=r("./src/errors.ts"),d=r("./src/types/transmuxer.ts"),h=r("./src/utils/mp4-tools.ts"),g=r("./src/utils/discontinuities.ts"),v=r("./src/controller/fragment-finders.ts"),p=r("./src/controller/level-helper.ts"),m=r("./src/loader/fragment-loader.ts"),y=r("./src/crypt/decrypter.ts"),E=r("./src/utils/time-ranges.ts"),T=r("./src/types/loader.ts"),b={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},n=function(n){function t(t,e,r){var i;return(i=n.call(this)||this).hls=void 0,i.fragPrevious=null,i.fragCurrent=null,i.fragmentTracker=void 0,i.transmuxer=null,i._state=b.STOPPED,i.media=void 0,i.mediaBuffer=void 0,i.config=void 0,i.bitrateTest=!1,i.lastCurrentTime=0,i.nextLoadPosition=0,i.startPosition=0,i.loadedmetadata=!1,i.fragLoadError=0,i.retryDate=0,i.levels=null,i.fragmentLoader=void 0,i.levelLastLoaded=null,i.startFragRequested=!1,i.decrypter=void 0,i.initPTS=[],i.onvseeking=null,i.onvended=null,i.logPrefix="",i.log=void 0,i.warn=void 0,i.logPrefix=r,i.log=o.logger.log.bind(o.logger,r+":"),i.warn=o.logger.warn.bind(o.logger,r+":"),i.hls=t,i.fragmentLoader=new m.default(t.config),i.fragmentTracker=e,i.config=t.config,i.decrypter=new y.default(t,t.config),t.on(c.Events.KEY_LOADED,i.onKeyLoaded,function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(i)),i}var e,r=n;(e=t).prototype=Object.create(r.prototype),a(e.prototype.constructor=e,r);r=t.prototype;return r.doTick=function(){this.onTickEnd()},r.onTickEnd=function(){},r.startLoad=function(t){},r.stopLoad=function(){this.fragmentLoader.abort();var t=this.fragCurrent;t&&this.fragmentTracker.removeFragment(t),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=b.STOPPED},r._streamEnded=function(t,e){var r=this.fragCurrent,i=this.fragmentTracker;if(e.live||!r||r.sn!==e.endSN||t.nextStart)return!1;r=i.getState(r);return r===f.FragmentState.PARTIAL||r===f.FragmentState.OK},r.onMediaAttached=function(t,e){e=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);e=this.config;this.levels&&e.autoStartLoad&&this.state===b.STOPPED&&this.startLoad(e.startPosition)},r.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},r.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,r=this.media,i=this.mediaBuffer,n=this.state,a=r?r.currentTime:0,i=s.BufferHelper.bufferInfo(i||r,a,t.maxBufferHole);this.log("media seeking to "+(Object(l.isFiniteNumber)(a)?a.toFixed(3):a)+", state: "+n),n===b.ENDED?this.resetLoadingState():e&&!i.len&&(n=t.maxFragLookUpTolerance,t=e.start-n,n=a>e.start+e.duration+n,(a<t||n)&&(n&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.resetLoadingState())),r&&(this.lastCurrentTime=a),this.loadedmetadata||i.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},r.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},r.onKeyLoaded=function(t,e){var r;this.state===b.KEY_LOADING&&e.frag===this.fragCurrent&&this.levels&&(this.state=b.IDLE,(r=this.levels[e.frag.level].details)&&this.loadFragment(e.frag,r,e.frag.start))},r.onHandlerDestroying=function(){this.stopLoad(),n.prototype.onHandlerDestroying.call(this)},r.onHandlerDestroyed=function(){this.state=b.STOPPED,this.hls.off(c.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,n.prototype.onHandlerDestroyed.call(this)},r.loadKey=function(t,e){this.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=b.KEY_LOADING,this.fragCurrent=t,this.hls.trigger(c.Events.KEY_LOADING,{frag:t})},r.loadFragment=function(t,e,r){this._loadFragForPlayback(t,e,r)},r._loadFragForPlayback=function(r,t,e){var i=this;this._doFragLoad(r,t,e,function(t){return i.fragContextChanged(r)?(i.warn("Fragment "+r.sn+(t.part?" p: "+t.part.index:"")+" of level "+r.level+" was dropped during download."),void i.fragmentTracker.removeFragment(r)):(r.stats.chunkCount++,void i._handleFragmentLoadProgress(t))}).then(function(t){if(t){i.fragLoadError=0;var e=i.state;return i.fragContextChanged(r)?void(e!==b.FRAG_LOADING&&e!==b.BACKTRACKING&&(i.fragCurrent||e!==b.PARSING)||(i.fragmentTracker.removeFragment(r),i.state=b.IDLE)):"payload"in t&&(i.log("Loaded fragment "+r.sn+" of level "+r.level),i.hls.trigger(c.Events.FRAG_LOADED,t),i.state===b.BACKTRACKING)?(i.fragmentTracker.backtrack(r,t),void i.resetFragmentLoading(r)):void i._handleFragmentLoadComplete(t)}}).catch(function(t){i.warn(t),i.resetFragmentLoading(r)})},r.flushMainBuffer=function(t,e,r){void 0===r&&(r=null),t-e&&(r={startOffset:t,endOffset:e,type:r},this.fragLoadError=0,this.hls.trigger(c.Events.BUFFER_FLUSHING,r))},r._loadInitSegment=function(a){var s=this;this._doFragLoad(a).then(function(t){if(!t||s.fragContextChanged(a)||!s.levels)throw new Error("init load aborted");return t}).then(function(r){var i=s.hls,t=r.payload,e=a.decryptdata;if(t&&0<t.byteLength&&e&&e.key&&e.iv&&"AES-128"===e.method){var n=self.performance.now();return s.decrypter.webCryptoDecrypt(new Uint8Array(t),e.key.buffer,e.iv.buffer).then(function(t){var e=self.performance.now();return i.trigger(c.Events.FRAG_DECRYPTED,{frag:a,payload:t,stats:{tstart:n,tdecrypt:e}}),r.payload=t,r})}return r}).then(function(t){var e=s.fragCurrent,r=s.hls,i=s.levels;if(!i)throw new Error("init load aborted, missing levels");i=i[a.level].details;console.assert(i,"Level details are defined when init segment is loaded");i=a.stats;s.state=b.IDLE,s.fragLoadError=0,a.data=new Uint8Array(t.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),t.frag===e&&r.trigger(c.Events.FRAG_BUFFERED,{stats:i,frag:e,part:null,id:a.type}),s.tick()}).catch(function(t){s.warn(t),s.resetFragmentLoading(a)})},r.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId},r.fragBufferedComplete=function(t,e){var r=this.mediaBuffer||this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level+" "+E.default.toString(s.BufferHelper.getBuffered(r))),this.state=b.IDLE,this.tick()},r._handleFragmentLoadComplete=function(t){var e,r,i=this.transmuxer;i&&(e=t.frag,r=t.part,t=!(t=t.partsLoaded)||0===t.length||t.some(function(t){return!t}),t=new d.ChunkMetadata(e.level,e.sn,e.stats.chunkCount+1,0,r?r.index:-1,!t),i.flush(t))},r._handleFragmentLoadProgress=function(t){},r._doFragLoad=function(t,e,r,i){var n=this;if(void 0===r&&(r=null),!this.levels)throw new Error("frag load aborted, missing levels");if(r=Math.max(t.start,r||0),this.config.lowLatencyMode&&e){var a=e.partList;if(a&&i){r>t.end&&e.fragmentHint&&(t=e.fragmentHint);var s=this.getNextPart(a,t,r);if(-1<s){var o=a[s];return this.log("Loading part sn: "+t.sn+" p: "+o.index+" cc: "+t.cc+" of playlist ["+e.startSN+"-"+e.endSN+"] parts [0-"+s+"-"+(a.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(r.toFixed(3))),this.nextLoadPosition=o.start+o.duration,this.state=b.FRAG_LOADING,this.hls.trigger(c.Events.FRAG_LOADING,{frag:t,part:a[s],targetBufferTime:r}),this.doFragPartsLoad(t,a,s,i).catch(function(t){return n.handleFragLoadError(t)})}if(!t.url||this.loadedEndOfParts(a,r))return Promise.resolve(null)}}return this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(e?"of ["+e.startSN+"-"+e.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(r.toFixed(3))),Object(l.isFiniteNumber)(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=b.FRAG_LOADING,this.hls.trigger(c.Events.FRAG_LOADING,{frag:t,targetBufferTime:r}),this.fragmentLoader.load(t,i).catch(function(t){return n.handleFragLoadError(t)})},r.doFragPartsLoad=function(o,l,e,u){var d=this;return new Promise(function(a,t){var s=[];!function r(i){var n=l[i];d.fragmentLoader.loadPart(o,n,u).then(function(t){var e=(s[n.index]=t).part;d.hls.trigger(c.Events.FRAG_LOADED,t);t=l[i+1];return t&&t.fragment===o?void r(i+1):a({frag:o,part:e,partsLoaded:s})}).catch(t)}(e)})},r.handleFragLoadError=function(t){t=t.data;return t&&t.details===u.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(c.Events.ERROR,t),null},r._handleTransmuxerFlush=function(t){var e,r,i,n=this.getCurrentContext(t);n&&this.state===b.PARSING?(e=n.frag,r=n.part,i=n.level,n=self.performance.now(),e.stats.parsing.end=n,r&&(r.stats.parsing.end=n),this.updateLevelTiming(e,r,i,t.partial)):this.fragCurrent||(this.state=b.IDLE)},r.getCurrentContext=function(t){var e=this.levels,r=t.level,i=t.sn,t=t.part;if(!e||!e[r])return this.warn("Levels object was unset while buffering fragment "+i+" of level "+r+". The current chunk will not be buffered."),null;r=e[r],t=-1<t?Object(p.getPartWith)(r,i,t):null,i=t?t.fragment:Object(p.getFragmentWithSN)(r,i,this.fragCurrent);return i?{frag:i,part:t,level:r}:null},r.bufferFragmentData=function(t,e,r,i){var n,a,s;t&&this.state===b.PARSING&&(n=t.data1,a=t.data2,(s=(s=n)&&a?Object(h.appendUint8Array)(n,a):s)&&s.length&&(s={type:t.type,frag:e,part:r,chunkMeta:i,parent:e.type,data:s},this.hls.trigger(c.Events.BUFFER_APPENDING,s),t.dropped&&t.independent&&!r&&this.flushBufferGap(e)))},r.flushBufferGap=function(t){var e,r,i=this.media;i&&(s.BufferHelper.isBuffered(i,i.currentTime)?(r=i.currentTime,e=s.BufferHelper.bufferInfo(i,r,0),i=t.duration,i=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),r=Math.max(Math.min(t.start-i,e.end-i),r+i),t.start-r>i&&this.flushMainBuffer(r,t.start)):this.flushMainBuffer(0,t.start))},r.getFwdBufferInfo=function(t,e){var r=this.config,i=this.getLoadPosition();if(!Object(l.isFiniteNumber)(i))return null;var n=s.BufferHelper.bufferInfo(t,i,r.maxBufferHole);if(0===n.len&&void 0!==n.nextStart){e=this.fragmentTracker.getBufferedFrag(i,e);if(e&&n.nextStart<e.end)return s.BufferHelper.bufferInfo(t,i,Math.max(n.nextStart,r.maxBufferHole))}return n},r.getMaxBufferLength=function(t){var e=this.config,t=t?Math.max(8*e.maxBufferSize/t,e.maxBufferLength):e.maxBufferLength;return Math.min(t,e.maxMaxBufferLength)},r.reduceMaxBufferLength=function(t){var e=this.config,t=t||e.maxBufferLength;return!!(e.maxMaxBufferLength>=t)&&(e.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},r.getNextFragment=function(t,e){var r=e.fragments,i=r.length;if(!i)return null;var n,a=this.config,s=r[0].start;if(e.live){var o=a.initialLiveManifestSize;if(i<o)return this.warn("Not enough fragments to start playback (have: "+i+", need: "+o+")"),null;e.PTSKnown||this.startFragRequested||-1!==this.startPosition||(n=this.getInitialLiveFragment(e,r),this.startPosition=n?this.hls.liveSyncPosition||n.start:t)}else t<=s&&(n=r[0]);return n||(a=a.lowLatencyMode?e.partEnd:e.fragmentEnd,n=this.getFragmentAtPosition(t,a,e)),n=!(null===n||void 0===n||!n.initSegment||null!==n&&void 0!==n&&n.initSegment.data||this.bitrateTest)?n.initSegment:n},r.getNextPart=function(t,e,r){for(var i,n,a=-1,s=!1,o=!0,l=0,u=t.length;l<u&&(i=t[l],o=o&&!i.independent,!(-1<a&&r<i.start));l++)!(n=i.loaded)&&(s||i.independent||o)&&i.fragment===e&&(a=l),s=n;return a},r.loadedEndOfParts=function(t,e){t=t[t.length-1];return t&&e>t.start&&t.loaded},r.getInitialLiveFragment=function(t,e){var r,i=this.fragPrevious,n=null;return i?(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),n=Object(v.findFragmentByPDT)(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),n||((r=i.sn+1)>=t.startSN&&r<=t.endSN&&(r=e[r-t.startSN],i.cc===r.cc&&this.log("Live playlist, switching playlist, load frag with next SN: "+(n=r).sn)),n||(n=Object(v.findFragWithCC)(e,i.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn))):null!==(i=this.hls.liveSyncPosition)&&(n=this.getFragmentAtPosition(i,this.bitrateTest?t.fragmentEnd:t.edge,t)),n},r.getFragmentAtPosition=function(t,e,r){var i,n=this.config,a=this.fragPrevious,s=r.fragments,o=r.endSN,l=r.fragmentHint,u=n.maxFragLookUpTolerance,n=!!(n.lowLatencyMode&&r.partList&&l);if(n&&l&&!this.bitrateTest&&(s=s.concat(l),o=l.sn),i=t<e?(d=e-u<t?0:u,Object(v.findFragmentByPTS)(a,s,t,d)):s[s.length-1]){var t=i.sn-r.startSN,d=a&&i.level===a.level,r=s[1+t];if(this.fragmentTracker.getState(i)===f.FragmentState.BACKTRACKED){i=null;for(var c=t;s[c]&&this.fragmentTracker.getState(s[c])===f.FragmentState.BACKTRACKED;)i=a?s[c--]:s[--c];i=i||r}else a&&i.sn===a.sn&&!n&&d&&(i=i.sn<o&&this.fragmentTracker.getState(r)!==f.FragmentState.OK?(this.log("SN "+i.sn+" just loaded, load next one: "+r.sn),r):null)}return i},r.synchronizeToLiveEdge=function(t){var e,r,i,n,a=this.config,s=this.media;s&&(e=this.hls.liveSyncPosition,r=s.currentTime,n=t.fragments[0].start,i=t.edge,n=r>=n-a.maxFragLookUpTolerance&&r<=i,null!==e&&s.duration>e&&(r<e||!n)&&(a=void 0===a.liveMaxLatencyDuration?a.liveMaxLatencyDurationCount*t.targetduration:a.liveMaxLatencyDuration,(!n&&s.readyState<4||r<i-a)&&(this.loadedmetadata||(this.nextLoadPosition=e),s.readyState&&(this.warn("Playback: "+r.toFixed(3)+" is located too far from the end of live sliding playlist: "+i+", reset currentTime to : "+e.toFixed(3)),s.currentTime=e))))},r.alignPlaylists=function(t,e){var r=this.levels,i=this.levelLastLoaded,n=this.fragPrevious,a=null===i?null:r[i],s=t.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;var o=t.fragments[0].start,r=!e,i=t.alignedSliding&&Object(l.isFiniteNumber)(o);if(r||!i&&!o){Object(g.alignStream)(n,a,t);a=t.fragments[0].start;return this.log("Live playlist sliding: "+a.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(n?n.sn:"na")+" fragments: "+s),a}return o},r.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},r.setStartPosition=function(t,e){var r,i=this.startPosition;-1!==(i=i<e?-1:i)&&-1!==this.lastCurrentTime||(r=t.startTimeOffset,Object(l.isFiniteNumber)(r)?(i=e+r,r<0&&(i+=t.totalduration),i=Math.min(Math.max(e,i),e+t.totalduration),this.log("Start time offset "+r+" found in playlist, adjust startPosition to "+i),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||e:this.startPosition=i=0,this.lastCurrentTime=i),this.nextLoadPosition=i},r.getLoadPosition=function(){var t=this.media,e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e},r.handleFragLoadAborted=function(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(e?" part"+e.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},r.resetFragmentLoading=function(t){this.fragCurrent&&this.fragContextChanged(t)||(this.state=b.IDLE)},r.onFragmentOrKeyLoadError=function(t,e){var r,i;e.fatal||(r=e.frag)&&r.type===t&&(i=this.fragCurrent,console.assert(i&&r.sn===i.sn&&r.level===i.level&&r.urlId===i.urlId,"Frag load error must match current frag to retry"),i=this.config,this.fragLoadError+1<=i.fragLoadingMaxRetry?this.resetLiveStartWhenNotLoaded(r.level)||(i=Math.min(Math.pow(2,this.fragLoadError)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout),this.warn("Fragment "+r.sn+" of "+t+" "+r.level+" failed to load, retrying in "+i+"ms"),this.retryDate=self.performance.now()+i,this.fragLoadError++,this.state=b.FRAG_LOADING_WAITING_RETRY):e.levelRetry?(t===T.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=b.IDLE):(o.logger.error(e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.stopLoad(),this.state=b.ERROR))},r.afterBufferFlushed=function(t,e,r){t&&(t=s.BufferHelper.getBuffered(t),this.fragmentTracker.detectEvictedFragments(e,t,r),this.state===b.ENDED&&this.resetLoadingState())},r.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=b.IDLE},r.resetLiveStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;t=this.levels?this.levels[t].details:null;if(null!=t&&t.live)return this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},r.updateLevelTiming=function(n,t,a,s){var o=this,l=a.details;console.assert(!!l,"level.details must be defined"),Object.keys(n.elementaryStreams).reduce(function(t,e){var r=n.elementaryStreams[e];if(r){var i=r.endPTS-r.startPTS;if(i<=0)return o.warn("Could not parse fragment "+n.sn+" "+e+" duration reliably ("+i+") resetting transmuxer to fallback to playlist timing"),o.resetTransmuxer(),t||!1;i=s?0:Object(p.updateFragPTSDTS)(l,n,r.startPTS,r.endPTS,r.startDTS,r.endDTS);return o.hls.trigger(c.Events.LEVEL_PTS_UPDATED,{details:l,level:a,drift:i,type:e,frag:n,start:r.startPTS,end:r.endPTS}),!0}return t},!1)?(this.state=b.PARSED,this.hls.trigger(c.Events.FRAG_PARSED,{frag:n,part:t})):this.resetLoadingState()},r.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i(t.prototype,[{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}]),t}(e.default)},"./src/controller/buffer-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return a});var l=r("./src/polyfills/number.ts"),v=r("./src/events.ts"),p=r("./src/utils/logger.ts"),m=r("./src/errors.ts"),y=r("./src/utils/buffer-helper.ts"),e=r("./src/utils/mediasource-helper.ts"),s=r("./src/loader/fragment.ts"),i=r("./src/controller/buffer-operation-queue.ts"),n=Object(e.getMediaSource)(),u=/([ha]vc.)(?:\.[^.,]+)+/,a=((e=o.prototype).hasSourceTypes=function(){return 0<this.getSourceBufferTypes().length||0<Object.keys(this.pendingTracks).length},e.destroy=function(){this.unregisterListeners(),this.details=null},e.registerListeners=function(){var t=this.hls;t.on(v.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(v.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(v.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(v.Events.BUFFER_RESET,this.onBufferReset,this),t.on(v.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(v.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(v.Events.BUFFER_EOS,this.onBufferEos,this),t.on(v.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(v.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(v.Events.FRAG_PARSED,this.onFragParsed,this),t.on(v.Events.FRAG_CHANGED,this.onFragChanged,this)},e.unregisterListeners=function(){var t=this.hls;t.off(v.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(v.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(v.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(v.Events.BUFFER_RESET,this.onBufferReset,this),t.off(v.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(v.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(v.Events.BUFFER_EOS,this.onBufferEos,this),t.off(v.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(v.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(v.Events.FRAG_PARSED,this.onFragParsed,this),t.off(v.Events.FRAG_CHANGED,this.onFragChanged,this)},e._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new i.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},e.onManifestParsed=function(t,e){var r=2;(!e.audio||e.video)&&e.altAudio||(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,p.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},e.onMediaAttaching=function(t,e){var r=this.media=e.media;r&&n&&((e=this.mediaSource=new n).addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(e),this._objectUrl=r.src)},e.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,r=this._objectUrl;if(e){if(p.logger.log("[buffer-controller]: media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(t){p.logger.warn("[buffer-controller]: onMediaDetaching: "+t.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(r&&self.URL.revokeObjectURL(r),t.src===r?(t.removeAttribute("src"),t.load()):p.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(v.Events.MEDIA_DETACHED,void 0)},e.onBufferReset=function(){var r=this;this.getSourceBufferTypes().forEach(function(e){var t=r.sourceBuffer[e];try{t&&(r.removeBufferListeners(e),r.mediaSource&&r.mediaSource.removeSourceBuffer(t),r.sourceBuffer[e]=void 0)}catch(t){p.logger.warn("[buffer-controller]: Failed to reset the "+e+" buffer",t)}}),this._initSourceBuffer()},e.onBufferCodecs=function(t,a){var s=this,o=this.getSourceBufferTypes().length;Object.keys(a).forEach(function(t){var e,r,i,n;o?(e=s.tracks[t])&&"function"==typeof e.buffer.changeType&&(r=(n=a[t]).codec,i=n.levelCodec,n=n.container,(e.levelCodec||e.codec).replace(u,"$1")!==(i||r).replace(u,"$1")&&s.appendChangeType(t,n+";codecs="+(i||r))):s.pendingTracks[t]=a[t]}),o||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},e.appendChangeType=function(e,r){var i=this,n=this.operationQueue,t={execute:function(){var t=i.sourceBuffer[e];t&&(p.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+r),t.changeType(r)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){p.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};n.append(t,e)},e.onBufferAppending=function(t,e){var n=this,r=this.hls,i=this.operationQueue,a=this.tracks,s=e.data,o=e.type,l=e.frag,u=e.part,d=e.chunkMeta,c=d.buffering[o],e=self.performance.now();c.start=e;var f=l.stats.buffering,h=u?u.stats.buffering:null;0===f.start&&(f.start=e),h&&0===h.start&&(h.start=e);var a=a.audio,g="audio"===o&&1===d.id&&"audio/mpeg"===(null==a?void 0:a.container),a={execute:function(){var t,e;c.executeStart=self.performance.now(),g&&(t=n.sourceBuffer[o])&&(e=l.start-t.timestampOffset,.1<=Math.abs(e)&&(p.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+l.start+" (delta: "+e+") sn: "+l.sn+")"),t.timestampOffset=l.start)),n.appendExecutor(s,o)},onStart:function(){},onComplete:function(){var t=self.performance.now();c.executeEnd=c.end=t,0===f.first&&(f.first=t),h&&0===h.first&&(h.first=t);var e,r=n.sourceBuffer,i={};for(e in r)i[e]=y.BufferHelper.getBuffered(r[e]);n.appendError=0,n.hls.trigger(v.Events.BUFFER_APPENDED,{type:o,frag:l,part:u,chunkMeta:d,parent:l.type,timeRanges:i})},onError:function(t){p.logger.error("[buffer-controller]: Error encountered while trying to append to the "+o+" SourceBuffer",t);var e={type:m.ErrorTypes.MEDIA_ERROR,parent:l.type,details:m.ErrorDetails.BUFFER_APPEND_ERROR,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?e.details=m.ErrorDetails.BUFFER_FULL_ERROR:(n.appendError++,e.details=m.ErrorDetails.BUFFER_APPEND_ERROR,n.appendError>r.config.appendErrorMaxRetry&&(p.logger.error("[buffer-controller]: Failed "+r.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),e.fatal=!0)),r.trigger(v.Events.ERROR,e)}};i.append(a,o)},e.onBufferFlushing=function(t,r){function e(e){return{execute:i.removeExecutor.bind(i,e,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(v.Events.BUFFER_FLUSHED,{type:e})},onError:function(t){p.logger.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}}var i=this,n=this.operationQueue;r.type?n.append(e(r.type),r.type):this.getSourceBufferTypes().forEach(function(t){n.append(e(t),t)})},e.onFragParsed=function(t,e){var r=this,i=e.frag,n=e.part,a=[],e=(n||i).elementaryStreams;e[s.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(e[s.ElementaryStreamTypes.AUDIO]&&a.push("audio"),e[s.ElementaryStreamTypes.VIDEO]&&a.push("video")),0===a.length&&p.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(function(){var t=self.performance.now();i.stats.buffering.end=t,n&&(n.stats.buffering.end=t);t=(n||i).stats;r.hls.trigger(v.Events.FRAG_BUFFERED,{frag:i,part:n,stats:t,id:i.type})},a)},e.onFragChanged=function(t,e){this.flushBackBuffer()},e.onBufferEos=function(t,i){var n=this;this.getSourceBufferTypes().reduce(function(t,e){var r=n.sourceBuffer[e];return i.type&&i.type!==e||!r||r.ended||(r.ended=!0,p.logger.log("[buffer-controller]: "+e+" sourceBuffer now EOS")),t&&(!r||r.ended)},!0)&&this.blockBuffers(function(){var t=n.mediaSource;t&&"open"===t.readyState&&t.endOfStream()})},e.onLevelUpdated=function(t,e){e=e.details;e.fragments.length&&(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},e.flushBackBuffer=function(){var t,e,r,i,n=this.hls,a=this.details,s=this.media,o=this.sourceBuffer;!s||null===a||(t=this.getSourceBufferTypes()).length&&(r=a.live&&null!==n.config.liveBackBufferLength?n.config.liveBackBufferLength:n.config.backBufferLength,!Object(l.isFiniteNumber)(r)||r<0||(e=s.currentTime,s=a.levelTargetDuration,r=Math.max(r,s),i=Math.floor(e/s)*s-r,t.forEach(function(t){var e=o[t];!e||0<(e=y.BufferHelper.getBuffered(e)).length&&i>e.start(0)&&(n.trigger(v.Events.BACK_BUFFER_REACHED,{bufferEnd:i}),a.live&&n.trigger(v.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i}),n.trigger(v.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:t}))})))},e.updateMediaElementDuration=function(){var t,e,r,i,n,a;this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState&&(t=this.details,e=this.hls,a=this.media,r=this.mediaSource,i=t.fragments[0].start+t.totalduration,n=a.duration,a=Object(l.isFiniteNumber)(r.duration)?r.duration:0,t.live&&e.config.liveDurationInfinity?(p.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(t)):(a<i&&n<i||!Object(l.isFiniteNumber)(n))&&(p.logger.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),r.duration=i))},e.updateSeekableRange=function(t){var e=this.mediaSource,r=t.fragments;r.length&&t.live&&null!=e&&e.setLiveSeekableRange&&(r=Math.max(0,r[0].start),t=Math.max(r,r+t.totalduration),e.setLiveSeekableRange(r,t))},e.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;(i&&!t||2===i)&&(this.createSourceBuffers(r),this.pendingTracks={},0!==(r=this.getSourceBufferTypes()).length?r.forEach(function(t){e.executeNext(t)}):this.hls.trigger(v.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"}))},e.createSourceBuffers=function(t){var e=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var i,n=0;for(i in t)if(!e[i]){var a=t[i];if(!a)throw Error("source buffer exists for track "+i+", however track does not");var s=a.levelCodec||a.codec,o=a.container+";codecs="+s;p.logger.log("[buffer-controller]: creating sourceBuffer("+o+")");try{var l=e[i]=r.addSourceBuffer(o),u=i;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.tracks[i]={buffer:l,codec:s,container:a.container,levelCodec:a.levelCodec,id:a.id},n++}catch(t){p.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(v.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:o})}}n&&this.hls.trigger(v.Events.BUFFER_CREATED,{tracks:this.tracks})},e._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},e._onSBUpdateEnd=function(t){var e=this.operationQueue;e.current(t).onComplete(),e.shiftAndExecuteNext(t)},e._onSBUpdateError=function(t,e){p.logger.error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(v.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});t=this.operationQueue.current(t);t&&t.onError(e)},e.removeExecutor=function(t,e,r){var i=this.media,n=this.mediaSource,a=this.operationQueue,s=this.sourceBuffer[t];if(!i||!n||!s)return p.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(t);i=Object(l.isFiniteNumber)(i.duration)?i.duration:1/0,n=Object(l.isFiniteNumber)(n.duration)?n.duration:1/0,e=Math.max(0,e),n=Math.min(r,i,n);e<n?(p.logger.log("[buffer-controller]: Removing ["+e+","+n+"] from the "+t+" SourceBuffer"),console.assert(!s.updating,t+" sourceBuffer must not be updating"),s.remove(e,n)):a.shiftAndExecuteNext(t)},e.appendExecutor=function(t,e){var r=this.operationQueue,i=this.sourceBuffer[e];return i?(i.ended=!1,console.assert(!i.updating,e+" sourceBuffer must not be updating"),void i.appendBuffer(t)):(p.logger.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e))},e.blockBuffers=function(t,e){var r=this;if(!(e=void 0===e?this.getSourceBufferTypes():e).length)return p.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(t);var i=this.operationQueue,n=e.map(function(t){return i.appendBlocker(t)});Promise.all(n).then(function(){t(),e.forEach(function(t){var e=r.sourceBuffer[t];e&&e.updating||i.shiftAndExecuteNext(t)})})},e.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},e.addBufferListener=function(t,e,r){var i=this.sourceBuffer[t];i&&(r=r.bind(this,t),this.listeners[t].push({event:e,listener:r}),i.addEventListener(e,r))},e.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach(function(t){e.removeEventListener(t.event,t.listener)})},o);function o(t){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=i.hls,e=i.media,r=i.mediaSource;p.logger.log("[buffer-controller]: Media source opened"),e&&(i.updateMediaElementDuration(),t.trigger(v.Events.MEDIA_ATTACHED,{media:e})),r&&r.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){p.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){p.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}},"./src/controller/buffer-operation-queue.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var a=r("./src/utils/logger.ts"),i=((r=n.prototype).append=function(t,e){var r=this.queues[e];r.push(t),1===r.length&&this.buffers[e]&&this.executeNext(e)},r.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},r.appendBlocker=function(t){var e,r=new Promise(function(t){e=t}),i={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,t),r},r.executeNext=function(t){var e=this.buffers,r=this.queues,i=e[t],n=r[t];if(n.length){r=n[0];try{r.execute()}catch(e){a.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),r.onError(e),i&&i.updating||(n.shift(),this.executeNext(t))}}},r.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},r.current=function(t){return this.queues[t][0]},n);function n(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}},"./src/controller/cap-level-controller.ts":function(t,e,r){"use strict";function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}r.r(e);var n,a=r("./src/events.ts"),r=((n=s.prototype).setStreamController=function(t){this.streamController=t},n.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},n.registerListeners=function(){var t=this.hls;t.on(a.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},n.unregisterListener=function(){var t=this.hls;t.off(a.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},n.onFpsDropLevelCapping=function(t,e){s.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},n.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null},n.onManifestParsed=function(t,e){var r=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,r.config.capLevelToPlayerSize&&e.video&&this.startCapping()},n.onBufferCodecs=function(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},n.onMediaDetaching=function(){this.stopCapping()},n.detectPlayerSize=function(){var t,e;this.media&&0<this.mediaHeight&&0<this.mediaWidth&&((t=this.hls.levels).length&&((e=this.hls).autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping))},n.getMaxLevel=function(r){var i=this,t=this.hls.levels;if(!t.length)return-1;t=t.filter(function(t,e){return s.isLevelAllowed(e,i.restrictedLevels)&&e<=r});return this.clientRect=null,s.getMaxLevelByMediaSize(t,this.mediaWidth,this.mediaHeight)},n.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},n.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},n.getDimensions=function(){if(this.clientRect)return this.clientRect;var t,e=this.media,r={width:0,height:0};return e&&(t=e.getBoundingClientRect(),r.width=t.width,r.height=t.height,r.width||r.height||(r.width=t.right-t.left||e.width||0,r.height=t.bottom-t.top||e.height||0)),this.clientRect=r},s.isLevelAllowed=function(t,e){return-1===(e=void 0===e?[]:e).indexOf(t)},s.getMaxLevelByMediaSize=function(t,e,r){if(!t||!t.length)return-1;for(var i,n,a=t.length-1,s=0;s<t.length;s+=1)if(((i=t[s]).width>=e||i.height>=r)&&(!(n=t[s+1])||i.width!==n.width||i.height!==n.height)){a=s;break}return a},r=[{key:"contentScaleFactor",get:function(){var t=1;try{t=self.devicePixelRatio}catch(t){}return t}}],i((n=s).prototype,[{key:"mediaWidth",get:function(){return this.getDimensions().width*s.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*s.contentScaleFactor}}]),i(n,r),s);function s(t){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}e.default=r},"./src/controller/fps-controller.ts":function(t,e,r){"use strict";r.r(e);var l=r("./src/events.ts"),u=r("./src/utils/logger.ts"),r=((r=i.prototype).setStreamController=function(t){this.streamController=t},r.registerListeners=function(){this.hls.on(l.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},r.unregisterListeners=function(){this.hls.off(l.Events.MEDIA_ATTACHING,this.onMediaAttaching)},r.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},r.onMediaAttaching=function(t,e){var r=this.hls.config;r.capLevelOnFPSDrop&&(e=e.media instanceof self.HTMLVideoElement?e.media:null,(this.media=e)&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod))},r.checkFPS=function(t,e,r){var i,n,a,s,o=performance.now();e&&(this.lastTime&&(a=o-this.lastTime,i=r-this.lastDroppedFrames,s=e-this.lastDecodedFrames,n=1e3*i/a,(a=this.hls).trigger(l.Events.FPS_DROP,{currentDropped:i,currentDecoded:s,totalDroppedFrames:r}),0<n&&i>a.config.fpsDroppedMonitoringThreshold*s&&(s=a.currentLevel,u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+s),0<s&&(-1===a.autoLevelCapping||a.autoLevelCapping>=s)&&(a.trigger(l.Events.FPS_DROP_LEVEL_CAPPING,{level:--s,droppedLevel:a.currentLevel}),a.autoLevelCapping=s,this.streamController.nextLevelSwitch()))),this.lastTime=o,this.lastDroppedFrames=r,this.lastDecodedFrames=e)},r.checkFPSInterval=function(){var t,e=this.media;e&&(this.isVideoPlaybackQualityAvailable?(t=e.getVideoPlaybackQuality(),this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)):this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount))},i);function i(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}e.default=r},"./src/controller/fragment-finders.ts":function(t,e,r){"use strict";function i(t,e,r){if(null===e||!Array.isArray(t)||!t.length||!Object(l.isFiniteNumber)(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;r=r||0;for(var i,n=0;n<t.length;++n)if(s(e,r,i=t[n]))return i;return null}function n(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=null;return t?n=e[t.sn-e[0].sn+1]||null:0===r&&0===e[0].start&&(n=e[0]),(!n||0!==a(r,i,n))&&u.default.search(e,a.bind(null,r,i))||n}function a(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0);e=Math.min(e,r.duration+(r.deltaPTS||0));return r.start+r.duration-e<=t?1:r.start-e>t&&r.start?-1:0}function s(t,e,r){e=1e3*Math.min(e,r.duration+(r.deltaPTS||0));return(r.endProgramDateTime||0)-e>t}function o(t,e){return u.default.search(t,function(t){return t.cc<e?1:t.cc>e?-1:0})}r.r(e),r.d(e,"findFragmentByPDT",function(){return i}),r.d(e,"findFragmentByPTS",function(){return n}),r.d(e,"fragmentWithinToleranceTest",function(){return a}),r.d(e,"pdtWithinToleranceTest",function(){return s}),r.d(e,"findFragWithCC",function(){return o});var l=r("./src/polyfills/number.ts"),u=r("./src/utils/binary-search.ts")},"./src/controller/fragment-tracker.ts":function(t,e,r){"use strict";function l(t){var e;return t.buffered&&(null!==(e=t.range.video)&&void 0!==e&&e.partial||null!==(t=t.range.audio)&&void 0!==t&&t.partial)}function u(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}r.r(e),r.d(e,"FragmentState",function(){return i}),r.d(e,"FragmentTracker",function(){return a});var i,n=r("./src/events.ts"),o=r("./src/types/loader.ts");(r=i=i||{}).NOT_LOADED="NOT_LOADED",r.BACKTRACKED="BACKTRACKED",r.APPENDING="APPENDING",r.PARTIAL="PARTIAL",r.OK="OK";var a=((r=s.prototype)._registerListeners=function(){var t=this.hls;t.on(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.on(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(n.Events.FRAG_LOADED,this.onFragLoaded,this)},r._unregisterListeners=function(){var t=this.hls;t.off(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.off(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(n.Events.FRAG_LOADED,this.onFragLoaded,this)},r.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},r.getAppendedFrag=function(t,e){if(e===o.PlaylistLevelType.MAIN){var r=this.activeFragment,i=this.activeParts;if(!r)return null;if(i)for(var n=i.length;n--;){var a=i[n],s=a?a.end:r.appendedPTS;if(a.start<=t&&void 0!==s&&t<=s)return 9<n&&(this.activeParts=i.slice(n-9)),a}else if(r.start<=t&&void 0!==r.appendedPTS&&t<=r.appendedPTS)return r}return this.getBufferedFrag(t,e)},r.getBufferedFrag=function(t,e){for(var r=this.fragments,i=Object.keys(r),n=i.length;n--;)if((null==(a=r[i[n]])?void 0:a.body.type)===e&&a.buffered){var a=a.body;if(a.start<=t&&t<=a.end)return a}return null},r.detectEvictedFragments=function(r,i,n){var a=this;Object.keys(this.fragments).forEach(function(t){var e=a.fragments[t];e&&(e.buffered?(t=e.range[r])&&t.time.some(function(t){t=!a.isTimeBuffered(t.startPTS,t.endPTS,i);return t&&a.removeFragment(e.body),t}):e.body.type===n&&a.removeFragment(e.body))})},r.detectPartialFragments=function(t){var i,n=this,a=this.timeRanges,s=t.frag,o=t.part;a&&"initSegment"!==s.sn&&(t=u(s),(i=this.fragments[t])&&(Object.keys(a).forEach(function(t){var e,r=s.elementaryStreams[t];r&&(e=a[t],r=null!==o||!0===r.partial,i.range[t]=n.getBufferedTimes(s,o,r,e))}),i.backtrack=i.loaded=null,Object.keys(i.range).length?i.buffered=!0:this.removeFragment(i.body)))},r.fragBuffered=function(t){t=u(t),t=this.fragments[t];t&&(t.backtrack=t.loaded=null,t.buffered=!0)},r.getBufferedTimes=function(t,e,r,i){for(var n={time:[],partial:r},a=(e||t).start,s=(e||t).end,o=t.minEndPTS||s,l=t.maxStartPTS||a,u=0;u<i.length;u++){var d=i.start(u)-this.bufferPadding,c=i.end(u)+this.bufferPadding;if(d<=l&&o<=c){n.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(s,i.end(u))});break}if(a<c&&d<s)n.partial=!0,n.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(s,i.end(u))});else if(s<=d)break}return n},r.getPartialFragment=function(e){var r,i,n=null,a=0,s=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(t){t=o[t];!t||l(t)&&(r=t.body.start-s,i=t.body.end+s,r<=e&&e<=i&&(i=Math.min(e-r,i-e),a<=i&&(n=t.body,a=i)))}),n},r.getState=function(t){t=u(t),t=this.fragments[t];return t?t.buffered?l(t)?i.PARTIAL:i.OK:t.backtrack?i.BACKTRACKED:i.APPENDING:i.NOT_LOADED},r.backtrack=function(t,e){t=u(t),t=this.fragments[t];if(!t||t.backtrack)return null;e=t.backtrack=e||t.loaded;return t.loaded=null,e},r.getBacktrackData=function(t){var e=u(t),e=this.fragments[e];if(e){var r,e=e.backtrack;if(null!=e&&null!==(r=e.payload)&&void 0!==r&&r.byteLength)return e;this.removeFragment(t)}return null},r.isTimeBuffered=function(t,e,r){for(var i,n,a=0;a<r.length;a++){if(i=r.start(a)-this.bufferPadding,n=r.end(a)+this.bufferPadding,i<=t&&e<=n)return!0;if(e<=i)return!1}return!1},r.onFragLoaded=function(t,e){var r=e.frag,i=e.part;"initSegment"===r.sn||r.bitrateTest||i||(i=u(r),this.fragments[i]={body:r,loaded:e,backtrack:null,buffered:!1,range:Object.create(null)})},r.onBufferAppended=function(t,e){var i=this,n=e.frag,a=e.part,s=e.timeRanges;n.type===o.PlaylistLevelType.MAIN&&(this.activeFragment=n,a?((e=this.activeParts)||(this.activeParts=e=[]),e.push(a)):this.activeParts=null),this.timeRanges=s,Object.keys(s).forEach(function(t){var e=s[t];if(i.detectEvictedFragments(t,e),!a)for(var r=0;r<e.length;r++)n.appendedPTS=Math.max(e.end(r),n.appendedPTS||0)})},r.onFragBuffered=function(t,e){this.detectPartialFragments(e)},r.hasFragment=function(t){t=u(t);return!!this.fragments[t]},r.removeFragmentsInRange=function(e,r,i){var n=this;Object.keys(this.fragments).forEach(function(t){t=n.fragments[t];t&&t.buffered&&((t=t.body).type===i&&t.start<r&&t.end>e&&n.removeFragment(t))})},r.removeFragment=function(t){var e=u(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[e]},r.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},s);function s(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}},"./src/controller/gap-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"STALL_MINIMUM_DURATION_MS",function(){return i}),r.d(e,"MAX_START_GAP_JUMP",function(){return n}),r.d(e,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return c}),r.d(e,"SKIP_BUFFER_RANGE_START",function(){return g}),r.d(e,"default",function(){return a});var f=r("./src/utils/buffer-helper.ts"),u=r("./src/errors.ts"),d=r("./src/events.ts"),h=r("./src/utils/logger.ts"),i=250,n=2,c=.1,g=.05,a=((r=s.prototype).destroy=function(){this.hls=this.fragmentTracker=this.media=null},r.poll=function(t){var e=this.config,r=this.media,i=this.stalled,n=r.currentTime,a=r.seeking,s=this.seeking&&!a,o=!this.seeking&&a;if(this.seeking=a,n===t){if((o||s)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&f.BufferHelper.getBuffered(r).length){var l=f.BufferHelper.bufferInfo(r,n,0),t=0<l.len,o=l.nextStart||0;if(t||o){if(a){s=2<l.len,t=!o||2<o-n&&!this.fragmentTracker.getPartialFragment(n);if(s||t)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var u,d=Math.max(o,l.start||0)-n,c=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,c=null!=c&&null!==(u=c.details)&&void 0!==u&&u.live?2*c.details.targetduration:2;if(0<d&&d<=c)return void this._trySkipBufferHole(null)}d=self.performance.now();null!==i?(c=d-i,!a&&250<=c&&this._reportStall(l.len),e=f.BufferHelper.bufferInfo(r,n,e.maxBufferHole),this._tryFixBufferStall(e,c)):this.stalled=d}}}else this.moved=!0,null!==i&&(this.stallReported&&(i=self.performance.now()-i,h.logger.warn("playback not stuck anymore @"+n+", after "+Math.round(i)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0)},r._tryFixBufferStall=function(t,e){var r=this.config,i=this.fragmentTracker,n=this.media.currentTime,n=i.getPartialFragment(n);n&&this._trySkipBufferHole(n)||t.len>r.maxBufferHole&&e>1e3*r.highBufferWatchdogPeriod&&(h.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},r._reportStall=function(t){var e=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,h.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer (buffer="+t+")"),e.trigger(d.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},r._trySkipBufferHole=function(t){for(var e=this.config,r=this.hls,i=this.media,n=i.currentTime,a=0,s=f.BufferHelper.getBuffered(i),o=0;o<s.length;o++){if(l=s.start(o),n+e.maxBufferHole>=a&&n<l){var l=Math.max(l+g,i.currentTime+c);return h.logger.warn("skipping hole, adjusting currentTime from "+n+" to "+l),this.moved=!0,this.stalled=null,i.currentTime=l,t&&r.trigger(d.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+l,frag:t}),l}a=s.end(o)}return 0},r._tryNudgeBuffer=function(){var t=this.config,e=this.hls,r=this.media,i=r.currentTime,n=(this.nudgeRetry||0)+1;(this.nudgeRetry=n)<t.nudgeMaxRetry?(n=i+n*t.nudgeOffset,h.logger.warn("Nudging 'currentTime' from "+i+" to "+n),r.currentTime=n,e.trigger(d.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(h.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(d.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0}))},s);function s(t,e,r,i){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=r,this.hls=i}},"./src/controller/id3-track-controller.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/events.ts"),n=r("./src/utils/texttrack-utils.ts"),f=r("./src/demux/id3.ts"),r=((r=a.prototype).destroy=function(){this._unregisterListeners()},r._registerListeners=function(){var t=this.hls;t.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},r._unregisterListeners=function(){var t=this.hls;t.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},r.onMediaAttached=function(t,e){this.media=e.media},r.onMediaDetaching=function(){this.id3Track&&(Object(n.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},r.getID3Track=function(t){if(this.media){for(var e,r=0;r<t.length;r++)if("metadata"===(e=t[r]).kind&&"id3"===e.label)return Object(n.sendAddTrackEvent)(e,this.media),e;return this.media.addTextTrack("metadata","id3")}},r.onFragParsingMetadata=function(t,e){if(this.media){var r=e.frag,i=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n,a=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,s=0;s<i.length;s++)if(n=f.getID3Frames(i[s].data)){var o=i[s].pts,l=s<i.length-1?i[s+1].pts:r.end;l-o<=0&&(l=o+.25);for(var u=0;u<n.length;u++){var d,c=n[u];f.isTimeStampFrame(c)||((d=new a(o,l,"")).value=c,this.id3Track.addCue(d))}}}},r.onBufferFlushing=function(t,e){var r=e.startOffset,i=e.endOffset,e=e.type;e&&"audio"!==e||(e=this.id3Track)&&Object(n.removeCuesInRange)(e,r,i)},a);function a(t){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=t,this._registerListeners()}e.default=r},"./src/controller/latency-controller.ts":function(t,e,r){"use strict";function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}r.r(e),r.d(e,"default",function(){return o});var n=r("./src/errors.ts"),a=r("./src/events.ts"),s=r("./src/utils/logger.ts"),o=((r=l.prototype).destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},r.registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(a.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(a.Events.ERROR,this.onError,this)},r.unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(a.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(a.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(a.Events.ERROR,this.onError)},r.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},r.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},r.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},r.onLevelUpdated=function(t,e){e=e.details;(this.levelDetails=e).advanced&&this.timeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},r.onError=function(t,e){e.details!==n.ErrorDetails.BUFFER_STALLED_ERROR||(this.stallCount++,s.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},r.timeupdate=function(){var t,e,r,i=this.media,n=this.levelDetails;i&&n&&(this.currentTime=i.currentTime,null!==(r=this.computeLatency())&&(this._latency=r,t=(e=this.config).lowLatencyMode,e=e.maxLiveSyncPlaybackRate,!t||1===e||null!==(t=this.targetLatency)&&(t=(r=r-t)<Math.min(this.maxLatency,t+n.targetduration),n.live&&t&&.05<r&&1<this.forwardBufferLength?(e=Math.min(2,Math.max(1,e)),r=Math.round(2/(1+Math.exp(-.75*r-this.edgeStalled))*20)/20,i.playbackRate=Math.min(e,Math.max(1,r))):1!==i.playbackRate&&0!==i.playbackRate&&(i.playbackRate=1))))},r.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},r.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},i(l.prototype,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return void 0===t.liveMaxLatencyDuration?e?t.liveMaxLatencyDurationCount*e.targetduration:0:t.liveMaxLatencyDuration}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var e=t.holdBack,r=t.partHoldBack,i=t.targetduration,n=this.config,a=n.liveSyncDuration,s=n.liveSyncDurationCount,t=n.lowLatencyMode,n=this.hls.userConfig,e=t&&r||e;return(e=n.liveSyncDuration||n.liveSyncDurationCount||0===e?void 0===a?s*i:a:e)+Math.min(+this.stallCount,i)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency,r=this.levelDetails;if(null===t||null===e||null===r)return null;var i=r.edge,t=t-e-this.edgeStalled,e=i-r.totalduration,r=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(e,t),r)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(null===t)return 0;var e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var r=t.buffered.length;return r?t.buffered.end(r-1):e.edge-this.currentTime}}]),l);function l(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}},"./src/controller/level-controller.ts":function(t,e,r){"use strict";function n(){return(n=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)}function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}r.r(e),r.d(e,"default",function(){return s});var h=r("./src/types/level.ts"),g=r("./src/events.ts"),v=r("./src/errors.ts"),p=r("./src/utils/codecs.ts"),m=r("./src/controller/level-helper.ts"),e=r("./src/controller/base-playlist-controller.ts"),l=r("./src/types/loader.ts"),y=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),s=function(o){function t(t){return(t=o.call(this,t,"[level-controller]")||this)._levels=[],t._firstLevel=-1,t._startLevel=void 0,t.currentLevelIndex=-1,t.manualLevelIndex=-1,t.onParsedComplete=void 0,t._registerListeners(),t}var e,r=o;(e=t).prototype=Object.create(r.prototype),a(e.prototype.constructor=e,r);var r=t.prototype;return r._registerListeners=function(){var t=this.hls;t.on(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(g.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(g.Events.ERROR,this.onError,this)},r._unregisterListeners=function(){var t=this.hls;t.off(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(g.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(g.Events.ERROR,this.onError,this)},r.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,o.prototype.destroy.call(this)},r.startLoad=function(){this._levels.forEach(function(t){t.loadError=0}),o.prototype.startLoad.call(this)},r.onManifestLoaded=function(t,e){var r,i,n=[],a=[],s=[],o={},l=!1,u=!1,d=!1;if(e.levels.forEach(function(t){var e=t.attrs;l=l||!(!t.width||!t.height),u=u||!!t.videoCodec,d=d||!!t.audioCodec,y&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0);var r=t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS;(i=o[r])?i.url.push(t.url):(i=new h.Level(t),o[r]=i,n.push(i)),e&&(e.AUDIO&&Object(m.addGroupId)(i,"audio",e.AUDIO),e.SUBTITLES&&Object(m.addGroupId)(i,"text",e.SUBTITLES))}),n=(n=(l||u)&&d?n.filter(function(t){var e=t.videoCodec,r=t.width,t=t.height;return!!e||!(!r||!t)}):n).filter(function(t){var e=t.audioCodec,t=t.videoCodec;return(!e||Object(p.isCodecSupportedInMp4)(e,"audio"))&&(!t||Object(p.isCodecSupportedInMp4)(t,"video"))}),e.audioTracks&&(a=e.audioTracks.filter(function(t){return!t.audioCodec||Object(p.isCodecSupportedInMp4)(t.audioCodec,"audio")}),Object(m.assignTrackIdsByGroup)(a)),e.subtitles&&(s=e.subtitles,Object(m.assignTrackIdsByGroup)(s)),0<n.length){r=n[0].bitrate,n.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=n;for(var c=0;c<n.length;c++)if(n[c].bitrate===r){this._firstLevel=c,this.log("manifest loaded, "+n.length+" level(s) found, first bitrate: "+r);break}var f=d&&!u,a={levels:n,audioTracks:a,subtitleTracks:s,firstLevel:this._firstLevel,stats:e.stats,audio:d,video:u,altAudio:!f&&a.some(function(t){return!!t.url})};this.hls.trigger(g.Events.MANIFEST_PARSED,a),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(g.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},r.onError=function(t,e){if(o.prototype.onError.call(this,t,e),!e.fatal){var r=e.context,t=this._levels[this.currentLevelIndex];if(r&&(r.type===l.PlaylistContextType.AUDIO_TRACK&&t.audioGroupIds&&r.groupId===t.audioGroupIds[t.urlId]||r.type===l.PlaylistContextType.SUBTITLE_TRACK&&t.textGroupIds&&r.groupId===t.textGroupIds[t.urlId]))this.redundantFailover(this.currentLevelIndex);else{var i,n,a=!1,s=!0;switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:case v.ErrorDetails.KEY_LOAD_ERROR:case v.ErrorDetails.KEY_LOAD_TIMEOUT:e.frag&&((n=this._levels[e.frag.level])?(n.fragmentError++,n.fragmentError>this.hls.config.fragLoadingMaxRetry&&(i=e.frag.level)):i=e.frag.level);break;case v.ErrorDetails.LEVEL_LOAD_ERROR:case v.ErrorDetails.LEVEL_LOAD_TIMEOUT:r&&(r.deliveryDirectives&&(s=!1),i=r.level),a=!0;break;case v.ErrorDetails.REMUX_ALLOC_ERROR:i=e.level,a=!0}void 0!==i&&this.recoverLevel(e,i,a,s)}}},r.recoverLevel=function(t,e,r,i){var n=t.details,a=this._levels[e];if(a.loadError++,r){if(!this.retryLoadingOrFail(t))return void(this.currentLevelIndex=-1);t.levelRetry=!0}i&&(1<(i=a.url.length)&&a.loadError<i?(t.levelRetry=!0,this.redundantFailover(e)):-1===this.manualLevelIndex&&(e=0===e?this._levels.length-1:e-1,this.currentLevelIndex!==e&&0===this._levels[e].loadError&&(this.warn(n+": switch to "+e),t.levelRetry=!0,this.hls.nextAutoLevel=e)))},r.redundantFailover=function(t){var e,r=this._levels[t],i=r.url.length;1<i&&(e=(r.urlId+1)%i,this.warn("Switching to redundant URL-id "+e),this._levels.forEach(function(t){t.urlId=e}),this.level=t)},r.onFragLoaded=function(t,e){e=e.frag;void 0===e||e.type!==l.PlaylistLevelType.MAIN||void 0!==(e=this._levels[e.level])&&(e.fragmentError=0,e.loadError=0)},r.onLevelLoaded=function(t,e){var r,i=e.level,n=e.details,a=this._levels[i];if(!a)return this.warn("Invalid level index "+i),void(null!==(r=e.deliveryDirectives)&&void 0!==r&&r.skip&&(n.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===a.fragmentError&&(a.loadError=0,this.retryCount=0),this.playlistLoaded(i,e,a.details)):null!==(e=e.deliveryDirectives)&&void 0!==e&&e.skip&&(n.deltaUpdateFailed=!0)},r.onAudioTrackSwitched=function(t,e){var r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var i=-1,n=this.hls.audioTracks[e.id].groupId,a=0;a<r.audioGroupIds.length;a++)if(r.audioGroupIds[a]===n){i=a;break}i!==r.urlId&&(r.urlId=i,this.startLoad())}},r.loadPlaylist=function(t){var e=this.currentLevelIndex,r=this._levels[e];if(this.canLoad&&r&&0<r.url.length){var i=r.urlId,r=r.url[i];if(t)try{r=t.addDirectives(r)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Attempt loading level index "+e+(t?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+i+" "+r),this.clearTimer(),this.hls.trigger(g.Events.LEVEL_LOADING,{url:r,level:e,id:i,deliveryDirectives:t||null})}},r.removeLevel=function(r,i){function n(t,e){return e!==i}var t=this._levels.filter(function(t,e){return e!==r||!!(1<t.url.length&&void 0!==i)&&(t.url=t.url.filter(n),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(n)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(n)),!(t.urlId=0))}).map(function(t,e){var r=t.details;return null!=r&&r.fragments&&r.fragments.forEach(function(t){t.level=e}),t});this._levels=t,this.hls.trigger(g.Events.LEVELS_UPDATED,{levels:t})},r=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;if(0!==e.length&&(this.currentLevelIndex!==t||null===(i=e[t])||void 0===i||!i.details)){if(t<0||t>=e.length){var r=t<0;if(this.hls.trigger(g.Events.ERROR,{type:v.ErrorTypes.OTHER_ERROR,details:v.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:r,reason:"invalid level idx"}),r)return;t=Math.min(t,e.length-1)}this.clearTimer();var i=this.currentLevelIndex,r=e[i],e=e[t];this.log("switching to level "+t+" from "+i);t=n({},e,{level:this.currentLevelIndex=t,maxBitrate:e.maxBitrate,uri:e.uri,urlId:e.urlId});delete t._urlId,this.hls.trigger(g.Events.LEVEL_SWITCHING,t);t=e.details;t&&!t.live||(r=this.switchParams(e.uri,null==r?void 0:r.details),this.loadPlaylist(r))}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var t=this.hls.config.startLevel;return void 0===t?this._firstLevel:t},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1===this.manualLevelIndex?this.hls.nextAutoLevel:this.manualLevelIndex},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}],i(t.prototype,r),t}(e.default)},"./src/controller/level-helper.ts":function(t,e,r){"use strict";function i(t,e,r){"audio"===e?(t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(r)):"text"===e&&(t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(r))}function n(t){var r={};t.forEach(function(t){var e=t.groupId||"";t.id=r[e]=r[e]||0,r[e]++})}function a(t,e,r){h(t[e],t[r])}function h(t,e){var r,i=e.startPTS;Object(y.isFiniteNumber)(i)?(r=0,(i=e.sn>t.sn?(r=i-t.start,t):(r=t.start-i,e)).duration!==r&&(i.duration=r)):e.sn>t.sn?(r=t.cc===e.cc,e.start=r&&t.minEndPTS?t.start+(t.minEndPTS-t.start):t.start+t.duration):e.start=Math.max(t.start-e.duration,0)}function g(t,e,r,i,n,a){i-r<=0&&(E.logger.warn("Fragment should have a positive duration",e),i=r+e.duration,a=n+e.duration);var s,o=r,l=i,u=e.startPTS,d=e.endPTS;Object(y.isFiniteNumber)(u)&&(s=Math.abs(u-r),e.deltaPTS=Object(y.isFiniteNumber)(e.deltaPTS)?Math.max(s,e.deltaPTS):s,o=Math.max(r,u),r=Math.min(r,u),n=Math.min(n,e.startDTS),l=Math.min(i,d),i=Math.max(i,d),a=Math.max(a,e.endDTS)),e.duration=i-r;d=r-e.start;e.appendedPTS=i,e.start=e.startPTS=r,e.maxStartPTS=o,e.startDTS=n,e.endPTS=i,e.minEndPTS=l,e.endDTS=a;a=e.sn;if(!t||a<t.startSN||a>t.endSN)return 0;var c,a=a-t.startSN,f=t.fragments;for(f[a]=e,c=a;0<c;c--)h(f[c],f[c-1]);for(c=a;c<f.length-1;c++)h(f[c],f[c+1]);return t.fragmentHint&&h(f[f.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,d}function s(t,r){for(var e,i=null,n=t.fragments,a=n.length-1;0<=a;a--)if(e=n[a].initSegment){i=e;break}t.fragmentHint&&delete t.fragmentHint.endPTS;var s,o=0;if(p(t,r,function(t,e){t.relurl&&(o=t.cc-e.cc),Object(y.isFiniteNumber)(t.startPTS)&&Object(y.isFiniteNumber)(t.endPTS)&&(e.start=e.startPTS=t.startPTS,e.startDTS=t.startDTS,e.appendedPTS=t.appendedPTS,e.maxStartPTS=t.maxStartPTS,e.endPTS=t.endPTS,e.endDTS=t.endDTS,e.minEndPTS=t.minEndPTS,e.duration=t.endPTS-t.startPTS,e.duration&&(s=e),r.PTSKnown=r.alignedSliding=!0),e.elementaryStreams=t.elementaryStreams,e.loader=t.loader,e.stats=t.stats,e.urlId=t.urlId,t.initSegment?(e.initSegment=t.initSegment,i=t.initSegment):e.initSegment&&e.initSegment.relurl!=(null===i||void 0===i?void 0:i.relurl)||(e.initSegment=i)}),r.skippedSegments&&(r.deltaUpdateFailed=r.fragments.some(function(t){return!t}),r.deltaUpdateFailed)){E.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var l=r.skippedSegments;l--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}var u=r.fragments;if(o){E.logger.warn("discontinuity sliding from playlist, take drift into account");for(var d=0;d<u.length;d++)u[d].cc+=o}r.skippedSegments&&(r.startCC=r.fragments[0].cc),v(t.partList,r.partList,function(t,e){e.elementaryStreams=t.elementaryStreams,e.stats=t.stats}),s?g(r,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):m(t,r),u.length&&(r.totalduration=r.edge-u[0].start),r.driftStartTime=t.driftStartTime,r.driftStart=t.driftStart;var c,f=r.advancedDateTime;r.advanced&&f?(c=r.edge,r.driftStart||(r.driftStartTime=f,r.driftStart=c),r.driftEndTime=f,r.driftEnd=c):(r.driftEndTime=t.driftEndTime,r.driftEnd=t.driftEnd,r.advancedDateTime=t.advancedDateTime)}function v(t,e,r){if(t&&e)for(var i=0,n=0,a=t.length;n<=a;n++){var s=t[n],o=e[n+i];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?r(s,o):i--}}function p(t,e,r){for(var i=e.skippedSegments,n=Math.max(t.startSN,e.startSN)-e.startSN,a=(t.fragmentHint?1:0)+(i?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,s=e.startSN-t.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=n;u<=a;u++){var d=l[s+u],c=o[u];i&&!c&&u<i&&(c=e.fragments[u]=d),d&&c&&r(d,c)}}function m(t,e){var r=e.startSN+e.skippedSegments-t.startSN,t=t.fragments;r<0||r>=t.length||o(e,t[r].start)}function o(t,e){if(e){for(var r=t.fragments,i=t.skippedSegments;i<r.length;i++)r[i].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function l(t,e){var r,i=1e3*t.levelTargetDuration,n=i/2,a=t.age,s=0<a&&a<3*i,o=e.loading.end-e.loading.start,e=t.availabilityDelay;return!1!==t.updated?r=s?(e=Math.min(e||i/2,a),(t.availabilityDelay=e)+i-a):i-o:s?(s=333*t.misses,r=Math.max(Math.min(n,2*o),s),t.availabilityDelay=(t.availabilityDelay||0)+r):r=n,Math.round(r)}function u(t,e,r){if(!t||!t.details)return null;var i=t.details;return(t=i.fragments[e-i.startSN])||((t=i.fragmentHint)&&t.sn===e?t:e<i.startSN&&r&&r.sn===e?r:null)}function d(t,e,r){if(!t||!t.details)return null;var i=t.details.partList;if(i)for(var n,a=i.length;a--;)if((n=i[a]).index===r&&n.fragment.sn===e)return n;return null}r.r(e),r.d(e,"addGroupId",function(){return i}),r.d(e,"assignTrackIdsByGroup",function(){return n}),r.d(e,"updatePTS",function(){return a}),r.d(e,"updateFragPTSDTS",function(){return g}),r.d(e,"mergeDetails",function(){return s}),r.d(e,"mapPartIntersection",function(){return v}),r.d(e,"mapFragmentIntersection",function(){return p}),r.d(e,"adjustSliding",function(){return m}),r.d(e,"addSliding",function(){return o}),r.d(e,"computeReloadInterval",function(){return l}),r.d(e,"getFragmentWithSN",function(){return u}),r.d(e,"getPartWith",function(){return d});var y=r("./src/polyfills/number.ts"),E=r("./src/utils/logger.ts")},"./src/controller/stream-controller.ts":function(t,e,r){"use strict";function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}r.r(e),r.d(e,"default",function(){return a});var p=r("./src/polyfills/number.ts"),m=r("./src/controller/base-stream-controller.ts"),s=r("./src/is-supported.ts"),y=r("./src/events.ts"),o=r("./src/utils/buffer-helper.ts"),l=r("./src/controller/fragment-tracker.ts"),c=r("./src/types/loader.ts"),E=r("./src/loader/fragment.ts"),f=r("./src/demux/transmuxer-interface.ts"),h=r("./src/types/transmuxer.ts"),u=r("./src/controller/gap-controller.ts"),d=r("./src/errors.ts"),g=r("./src/utils/logger.ts"),a=function(a){function t(t,e){return(e=a.call(this,t,e,"[stream-controller]")||this).audioCodecSwap=!1,e.gapController=null,e.level=-1,e._forceStartLoad=!1,e.altAudio=!1,e.audioOnly=!1,e.fragPlaying=null,e.onvplaying=null,e.onvseeked=null,e.fragLastKbps=0,e.stalled=!1,e.couldBacktrack=!1,e.audioCodecSwitch=!1,e.videoBuffer=null,e._registerListeners(),e}var e,r=a;(e=t).prototype=Object.create(r.prototype),n(e.prototype.constructor=e,r);r=t.prototype;return r._registerListeners=function(){var t=this.hls;t.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(y.Events.ERROR,this.onError,this),t.on(y.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(y.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(y.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(y.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(y.Events.ERROR,this.onError,this),t.off(y.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(y.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(y.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(y.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},r.startLoad=function(t){var e,r,i;this.levels?(e=this.lastCurrentTime,r=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(i=r.startLevel)&&(r.config.testBandwidth?this.bitrateTest=!(i=0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1),0<e&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=m.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()):(this._forceStartLoad=!0,this.state=m.State.STOPPED)},r.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},r.doTick=function(){switch(this.state){case m.State.IDLE:this.doTickIdle();break;case m.State.WAITING_LEVEL:var t=this.levels,e=this.level,e=null==t||null===(r=t[e])||void 0===r?void 0:r.details;if(!e||e.live&&this.levelLastLoaded!==this.level)break;if(this.waitForCdnTuneIn(e))break;this.state=m.State.IDLE;break;case m.State.FRAG_LOADING_WAITING_RETRY:var r=self.performance.now(),e=this.retryDate;(!e||e<=r||null!==(r=this.media)&&void 0!==r&&r.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=m.State.IDLE)}this.onTickEnd()},r.onTickEnd=function(){a.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},r.doTickIdle=function(){var t=this.hls,e=this.levelLastLoaded,r=this.levels,i=this.media,n=t.config,a=t.nextLoadLevel;if(null!==e&&(i||!this.startFragRequested&&n.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&r&&r[a]){r=r[a];this.level=t.nextLoadLevel=a;t=r.details;if(!t||this.state===m.State.WAITING_LEVEL||t.live&&this.levelLastLoaded!==a)this.state=m.State.WAITING_LEVEL;else{a=this.getFwdBufferInfo(this.mediaBuffer||i,c.PlaylistLevelType.MAIN);if(null!==a&&!(a.len>=this.getMaxBufferLength(r.maxBitrate))){if(this._streamEnded(a,t)){var s={};return this.altAudio&&(s.type="video"),this.hls.trigger(y.Events.BUFFER_EOS,s),void(this.state=m.State.ENDED)}var o,r=a.end,s=this.getNextFragment(r,t);!this.couldBacktrack||this.fragPrevious||!s||"initSegment"===s.sn||1<(a=s.sn-t.startSN)&&(s=t.fragments[a-1],this.fragmentTracker.removeFragment(s)),s&&this.fragmentTracker.getState(s)===l.FragmentState.OK&&this.nextLoadPosition>r&&(o=this.audioOnly&&!this.altAudio?E.ElementaryStreamTypes.AUDIO:E.ElementaryStreamTypes.VIDEO,this.afterBufferFlushed(i,o,c.PlaylistLevelType.MAIN),s=this.getNextFragment(this.nextLoadPosition,t)),s&&("identity"!==(null===(o=(s=s.initSegment&&!s.initSegment.data&&!this.bitrateTest?s.initSegment:s).decryptdata)||void 0===o?void 0:o.keyFormat)||null!==(o=s.decryptdata)&&void 0!==o&&o.key?this.loadFragment(s,t,r):this.loadKey(s,t))}}}},r.loadFragment=function(t,e,r){var i=this.fragmentTracker.getState(t);if(this.fragCurrent=t,i===l.FragmentState.BACKTRACKED){var n=this.fragmentTracker.getBacktrackData(t);if(n)return this._handleFragmentLoadProgress(n),void this._handleFragmentLoadComplete(n);i=l.FragmentState.NOT_LOADED}i===l.FragmentState.NOT_LOADED||i===l.FragmentState.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t):this.bitrateTest?(t.bitrateTest=!0,this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,t,e,r)):i===l.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null===(t=this.media)||void 0===t?void 0:t.buffered.length)&&this.fragmentTracker.removeAllFragments()},r.getAppendedFrag=function(t){t=this.fragmentTracker.getAppendedFrag(t,c.PlaylistLevelType.MAIN);return t&&"fragment"in t?t.fragment:t},r.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,c.PlaylistLevelType.MAIN)},r.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},r.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.nextLevelSwitch=function(){var t,e,r,i=this.levels,n=this.media;null!=n&&n.readyState&&((t=this.getAppendedFrag(n.currentTime))&&1<t.start&&this.flushMainBuffer(0,t.start-1),r=!n.paused&&i?(r=i[this.hls.nextLoadLevel],(e=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*r.maxBitrate/(1e3*e)+1:0):0,!(e=this.getBufferedFrag(n.currentTime+r))||(n=this.followingBufferedFrag(e))&&(this.abortCurrentFrag(),r=n.maxStartPTS||n.start,n=n.duration,n=Math.max(e.end,r+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,.5*n),.75*n)),this.flushMainBuffer(n,Number.POSITIVE_INFINITY)))},r.abortCurrentFrag=function(){var t=this.fragCurrent;(this.fragCurrent=null)!=t&&t.loader&&t.loader.abort(),this.state===m.State.KEY_LOADING&&(this.state=m.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},r.flushMainBuffer=function(t,e){a.prototype.flushMainBuffer.call(this,t,e,this.altAudio?"video":null)},r.onMediaAttached=function(t,e){a.prototype.onMediaAttached.call(this,t,e);e=e.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new u.default(this.config,e,this.fragmentTracker,this.hls)},r.onMediaDetaching=function(){var t=this.media;t&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),a.prototype.onMediaDetaching.call(this)},r.onMediaPlaying=function(){this.tick()},r.onMediaSeeked=function(){var t=this.media,t=t?t.currentTime:null;Object(p.isFiniteNumber)(t)&&this.log("Media seeked to "+t.toFixed(3)),this.tick()},r.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},r.onManifestParsed=function(t,e){var r,i=!1,n=!1;e.levels.forEach(function(t){(r=t.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(i=!0),-1!==r.indexOf("mp4a.40.5")&&(n=!0))}),this.audioCodecSwitch=i&&n&&!Object(s.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},r.onLevelLoading=function(t,e){var r=this.levels;!r||this.state!==m.State.IDLE||(!(r=r[e.level]).details||r.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(r.details))&&(this.state=m.State.WAITING_LEVEL)},r.onLevelLoaded=function(t,e){var r=this.levels,i=e.level,n=e.details,a=n.totalduration;if(r){this.log("Level "+i+" loaded ["+n.startSN+","+n.endSN+"], cc ["+n.startCC+", "+n.endCC+"] duration:"+a);a=this.fragCurrent;a&&(this.state===m.State.FRAG_LOADING||this.state===m.State.FRAG_LOADING_WAITING_RETRY)&&a.level!==e.level&&a.loader&&(this.state=m.State.IDLE,a.loader.abort());e=r[i],a=0;if(n.live||null!==(r=e.details)&&void 0!==r&&r.live){if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed)return;a=this.alignPlaylists(n,e.details)}if(e.details=n,this.levelLastLoaded=i,this.hls.trigger(y.Events.LEVEL_UPDATED,{details:n,level:i}),this.state===m.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(n))return;this.state=m.State.IDLE}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,a),this.tick()}else this.warn("Levels were reset while loading level "+i)},r._handleFragmentLoadProgress=function(t){var e,r,i,n,a,s,o=t.frag,l=t.part,u=t.payload,d=this.levels;d?(e=(a=d[o.level]).details)?(r=a.videoCodec,i=e.PTSKnown||!e.live,n=null===(s=o.initSegment)||void 0===s?void 0:s.data,t=this._getAudioCodec(a),d=this.transmuxer=this.transmuxer||new f.default(this.hls,c.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),s=l?l.index:-1,a=new h.ChunkMetadata(o.level,o.sn,o.stats.chunkCount,u.byteLength,s,-1!==s),s=this.initPTS[o.cc],d.push(u,n,t,r,o,l,e.totalduration,i,a,s)):this.warn("Dropping fragment "+o.sn+" of level "+o.level+" after level details were reset"):this.warn("Levels were reset while fragment load was in progress. Fragment "+o.sn+" of level "+o.level+" will not be buffered")},r.onAudioTrackSwitching=function(t,e){var r,i=this.altAudio,n=!!e.url,e=e.id;n||(this.mediaBuffer!==this.media?(this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,null!=(r=this.fragCurrent)&&r.loader&&(this.log("Switching to main audio track, cancel main fragment load"),r.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()):this.audioOnly&&this.resetTransmuxer(),r=this.hls,i&&r.trigger(y.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),r.trigger(y.Events.AUDIO_TRACK_SWITCHED,{id:e}))},r.onAudioTrackSwitched=function(t,e){var r=e.id,e=!!this.hls.audioTracks[r].url;!e||(r=this.videoBuffer)&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r),this.altAudio=e,this.tick()},r.onBufferCreated=function(t,e){var r,i=e.tracks,n=!1;for(r in i){var a,s,o,l=i[r];"main"!==l.id?n=!0:(o=l,"video"===(s=r)&&(a=i[r])&&(this.videoBuffer=a.buffer))}n&&o?(this.log("Alternate track found, use "+s+".buffered to schedule main fragment loading"),this.mediaBuffer=o.buffer):this.mediaBuffer=this.media},r.onFragBuffered=function(t,e){var r=e.frag,i=e.part;if(!r||r.type===c.PlaylistLevelType.MAIN){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===m.State.PARSED&&(this.state=m.State.IDLE));e=(i||r).stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}},r.onError=function(t,e){switch(e.details){case d.ErrorDetails.FRAG_LOAD_ERROR:case d.ErrorDetails.FRAG_LOAD_TIMEOUT:case d.ErrorDetails.KEY_LOAD_ERROR:case d.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.MAIN,e);break;case d.ErrorDetails.LEVEL_LOAD_ERROR:case d.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==m.State.ERROR&&(e.fatal?(this.warn(""+e.details),this.state=m.State.ERROR):e.levelRetry||this.state!==m.State.WAITING_LEVEL||(this.state=m.State.IDLE));break;case d.ErrorDetails.BUFFER_FULL_ERROR:var r,i;"main"!==e.parent||this.state!==m.State.PARSING&&this.state!==m.State.PARSED||(r=!0,(r=(i=this.getFwdBufferInfo(this.media,c.PlaylistLevelType.MAIN))&&.5<i.len?!this.reduceMaxBufferLength(i.len):r)&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState())}},r.checkBuffer=function(){var t,e=this.media,r=this.gapController;e&&r&&e.readyState&&(t=o.BufferHelper.getBuffered(e),!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this.seekToStartPos()):r.poll(this.lastCurrentTime),this.lastCurrentTime=e.currentTime)},r.onFragLoadEmergencyAborted=function(){this.state=m.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},r.onBufferFlushed=function(t,e){var r=e.type;(r!==E.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&(e=(r===E.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,this.afterBufferFlushed(e,r,c.PlaylistLevelType.MAIN))},r.onLevelsUpdated=function(t,e){this.levels=e.levels},r.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},r.seekToStartPos=function(){var t,e=this.media,r=e.currentTime,i=this.startPosition;0<=i&&r<i&&(e.seeking?g.logger.log("could not seek to "+i+", already seeking at "+r):(0<(t=((t=o.BufferHelper.getBuffered(e)).length?t.start(0):0)-i)&&t<this.config.maxBufferHole&&(g.logger.log("adjusting start position by "+t+" to match buffer start"),this.startPosition=i+=t),this.log("seek to target start position "+i+" from current time "+r),e.currentTime=i))},r._getAudioCodec=function(t){t=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1===t.indexOf("mp4a.40.5")?"mp4a.40.5":"mp4a.40.2"),t},r._loadBitrateTestFrag=function(i){var n=this;this._doFragLoad(i).then(function(t){var e,r=n.hls;!t||r.nextLoadLevel||n.fragContextChanged(i)||(n.fragLoadError=0,n.state=m.State.IDLE,n.startFragRequested=!1,n.bitrateTest=!1,(e=i.stats).parsing.start=e.parsing.end=e.buffering.start=e.buffering.end=self.performance.now(),r.trigger(y.Events.FRAG_LOADED,t))})},r._handleTransmuxComplete=function(t){var e,r=this.hls,i=t.remuxResult,n=t.chunkMeta,a=this.getCurrentContext(n);if(!a)return this.warn("The loading context changed while buffering fragment "+n.sn+" of level "+n.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(n.level);var s=a.frag,o=a.part,l=a.level,u=i.video,d=i.text,c=i.id3,f=i.initSegment,t=this.altAudio?void 0:i.audio;if(!this.fragContextChanged(s)){if(this.state=m.State.PARSING,f&&(f.tracks&&(this._bufferInitSegment(l,f.tracks,s,n),r.trigger(y.Events.FRAG_PARSING_INIT_SEGMENT,{frag:s,id:"main",tracks:f.tracks})),a=f.initPTS,h=f.timescale,Object(p.isFiniteNumber)(a)&&(this.initPTS[s.cc]=a,r.trigger(y.Events.INIT_PTS_FOUND,{frag:s,id:"main",initPTS:a,timescale:h}))),u&&!1!==i.independent){if(l.details){var h=u.startPTS,l=u.endPTS,g=u.startDTS,v=u.endDTS;if(o)o.elementaryStreams[u.type]={startPTS:h,endPTS:l,startDTS:g,endDTS:v};else if(u.firstKeyFrame&&u.independent&&(this.couldBacktrack=!0),u.dropped&&u.independent){if(this.getLoadPosition()+this.config.maxBufferHole<h)return void this.backtrack(s);s.setElementaryStreamInfo(u.type,s.start,l,s.start,v,!0)}s.setElementaryStreamInfo(u.type,h,l,g,v),this.bufferFragmentData(u,s,o,n)}}else if(!1===i.independent)return void this.backtrack(s);t&&(g=t.startPTS,v=t.endPTS,u=t.startDTS,i=t.endDTS,o&&(o.elementaryStreams[E.ElementaryStreamTypes.AUDIO]={startPTS:g,endPTS:v,startDTS:u,endDTS:i}),s.setElementaryStreamInfo(E.ElementaryStreamTypes.AUDIO,g,v,u,i),this.bufferFragmentData(t,s,o,n)),null!=c&&null!==(e=c.samples)&&void 0!==e&&e.length&&(c={frag:s,id:"main",samples:c.samples},r.trigger(y.Events.FRAG_PARSING_METADATA,c)),d&&(d={frag:s,id:"main",samples:d.samples},r.trigger(y.Events.FRAG_PARSING_USERDATA,d))}},r._bufferInitSegment=function(t,r,i,n){var e,a,s,o,l,u=this;this.state===m.State.PARSING&&(this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio,e=r.audio,a=r.video,s=r.audiovideo,e&&(o=t.audioCodec,l=navigator.userAgent.toLowerCase(),this.audioCodecSwitch&&(o=o&&(-1===o.indexOf("mp4a.40.5")?"mp4a.40.5":"mp4a.40.2"),1!==e.metadata.channelCount&&-1===l.indexOf("firefox")&&(o="mp4a.40.5")),-1!==l.indexOf("android")&&"audio/mpeg"!==e.container&&this.log("Android: force audio codec to "+(o="mp4a.40.2")),t.audioCodec&&t.audioCodec!==o&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+o+'"'),e.levelCodec=o,e.id="main",this.log("Init audio buffer, container:"+e.container+", codecs[selected/level/parsed]=["+(o||"")+"/"+(t.audioCodec||"")+"/"+e.codec+"]")),a&&(a.levelCodec=t.videoCodec,a.id="main",this.log("Init video buffer, container:"+a.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+a.codec+"]")),s&&this.log("Init audiovideo buffer, container:"+s.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+s.codec+"]"),this.hls.trigger(y.Events.BUFFER_CODECS,r),Object.keys(r).forEach(function(t){var e=r[t].initSegment;null!=e&&e.byteLength&&u.hls.trigger(y.Events.BUFFER_APPENDING,{type:t,data:e,frag:i,part:null,chunkMeta:n,parent:i.type})}),this.tick())},r.backtrack=function(t){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(t);var e=this.fragmentTracker.backtrack(t);this.fragPrevious=null,this.nextLoadPosition=t.start,e?this.resetFragmentLoading(t):this.state=m.State.BACKTRACKING},r.checkFragmentChanged=function(){var t,e=this.media,r=null;e&&1<e.readyState&&!1===e.seeking&&(t=e.currentTime,o.BufferHelper.isBuffered(e,t)?r=this.getAppendedFrag(t):o.BufferHelper.isBuffered(e,t+.1)&&(r=this.getAppendedFrag(t+.1)),r&&(e=this.fragPlaying,t=r.level,e&&r.sn===e.sn&&e.level===t&&r.urlId===e.urlId||(this.hls.trigger(y.Events.FRAG_CHANGED,{frag:r}),e&&e.level===t||this.hls.trigger(y.Events.LEVEL_SWITCHED,{level:t}),this.fragPlaying=r)))},i(t.prototype,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentLevel",get:function(){var t=this.media;if(t){t=this.getAppendedFrag(t.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;if(t){t=this.getAppendedFrag(t.currentTime);return this.followingBufferedFrag(t)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(m.default)},"./src/crypt/aes-crypto.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var i=(n.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},n);function n(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}},"./src/crypt/aes-decryptor.ts":function(t,e,r){"use strict";function i(t){var e=t.byteLength,r=e&&new DataView(t.buffer).getUint8(e-1);return r?Object(n.sliceUint8)(t,0,e-r):t}r.r(e),r.d(e,"removePadding",function(){return i}),r.d(e,"default",function(){return a});var n=r("./src/utils/typed-array.ts"),a=((r=s.prototype).uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},r.initTable=function(){for(var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],n=r[1],a=r[2],s=r[3],r=this.invSubMix,o=r[0],l=r[1],u=r[2],d=r[3],c=new Uint32Array(256),f=0,h=0,g=0,g=0;g<256;g++)c[g]=g<128?g<<1:283^g<<1;for(g=0;g<256;g++){var v=h^h<<1^h<<2^h<<3^h<<4;t[f]=v=v>>>8^255&v^99;var p=c[e[v]=f],m=c[p],y=c[m],E=257*c[v]^16843008*v;i[f]=E<<24|E>>>8,n[f]=E<<16|E>>>16,a[f]=E<<8|E>>>24,s[f]=E,o[v]=(E=16843009*y^65537*m^257*p^16843008*f)<<24|E>>>8,l[v]=E<<16|E>>>16,u[v]=E<<8|E>>>24,d[v]=E,f?(f=p^c[c[c[y^p]]],h^=c[c[h]]):f=h=1}},r.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;i<e.length&&r;)r=e[i]===this.key[i],i++;if(!r){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);for(var a,s,o,l=this.ksRows=4*(n+6+1),u=this.keySchedule=new Uint32Array(l),d=this.invKeySchedule=new Uint32Array(l),c=this.sBox,f=this.rcon,t=this.invSubMix,h=t[0],g=t[1],v=t[2],p=t[3],m=0;m<l;m++)m<n?s=u[m]=e[m]:(o=s,0==m%n?(o=c[(o=o<<8|o>>>24)>>>24]<<24|c[255&o>>>16]<<16|c[255&o>>>8]<<8|c[255&o],o^=f[0|m/n]<<24):6<n&&4==m%n&&(o=c[o>>>24]<<24|c[255&o>>>16]<<16|c[255&o>>>8]<<8|c[255&o]),u[m]=s=(u[m-n]^o)>>>0);for(a=0;a<l;a++)m=l-a,o=3&a?u[m]:u[m-4],d[a]=a<4||m<=4?o:h[c[o>>>24]]^g[c[255&o>>>16]]^v[c[255&o>>>8]]^p[c[255&o]],d[a]>>>=0}},r.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},r.decrypt=function(t,e,r){for(var i,n,a,s,o,l,u,d,c,f,h,g,v,p,m=this.keySize+6,y=this.invKeySchedule,E=this.invSBox,T=this.invSubMix,b=T[0],A=T[1],S=T[2],L=T[3],r=this.uint8ArrayToUint32Array_(r),k=r[0],D=r[1],_=r[2],R=r[3],C=new Int32Array(t),I=new Int32Array(C.length),x=this.networkToHostOrderSwap;e<C.length;){for(c=x(C[e]),f=x(C[e+1]),h=x(C[e+2]),g=x(C[e+3]),o=c^y[0],l=g^y[1],u=h^y[2],d=f^y[3],v=4,p=1;p<m;p++)i=b[o>>>24]^A[255&l>>16]^S[255&u>>8]^L[255&d]^y[v],n=b[l>>>24]^A[255&u>>16]^S[255&d>>8]^L[255&o]^y[v+1],a=b[u>>>24]^A[255&d>>16]^S[255&o>>8]^L[255&l]^y[v+2],s=b[d>>>24]^A[255&o>>16]^S[255&l>>8]^L[255&u]^y[v+3],o=i,l=n,u=a,d=s,v+=4;i=E[o>>>24]<<24^E[255&l>>16]<<16^E[255&u>>8]<<8^E[255&d]^y[v],n=E[l>>>24]<<24^E[255&u>>16]<<16^E[255&d>>8]<<8^E[255&o]^y[v+1],a=E[u>>>24]<<24^E[255&d>>16]<<16^E[255&o>>8]<<8^E[255&l]^y[v+2],s=E[d>>>24]<<24^E[255&o>>16]<<16^E[255&l>>8]<<8^E[255&u]^y[v+3],I[e]=x(i^k),I[e+1]=x(s^D),I[e+2]=x(a^_),I[e+3]=x(n^R),k=c,D=f,_=h,R=g,e+=4}return I.buffer},s);function s(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}},"./src/crypt/decrypter.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var s=r("./src/crypt/aes-crypto.ts"),o=r("./src/crypt/fast-aes-key.ts"),l=r("./src/crypt/aes-decryptor.ts"),n=r("./src/utils/logger.ts"),u=r("./src/utils/mp4-tools.ts"),d=r("./src/utils/typed-array.ts"),i=((r=a.prototype).destroy=function(){this.observer=null},r.isSync=function(){return this.config.enableSoftwareAES},r.flush=function(){var t=this.currentResult;if(t){t=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Object(l.removePadding)(t):t}this.reset()},r.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},r.decrypt=function(t,e,r,i){var n;this.config.enableSoftwareAES?(this.softwareDecrypt(new Uint8Array(t),e,r),(n=this.flush())&&i(n.buffer)):this.webCryptoDecrypt(new Uint8Array(t),e,r).then(i)},r.softwareDecrypt=function(t,e,r){var i=this.currentIV,n=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(t=Object(u.appendUint8Array)(a,t),this.remainderData=null);t=this.getValidChunk(t);if(!t.length)return null;i&&(r=i);i=this.softwareDecrypter;(i=i||(this.softwareDecrypter=new l.default)).expandKey(e);return this.currentResult=i.decrypt(t.buffer,0,r),this.currentIV=Object(d.sliceUint8)(t,-16).buffer,n||null},r.webCryptoDecrypt=function(e,r,i){var n=this,a=this.subtle;return this.key===r&&this.fastAesKey||(this.key=r,this.fastAesKey=new o.default(a,r)),this.fastAesKey.expandKey().then(function(t){return a?new s.default(a,i).decrypt(e.buffer,t):Promise.reject(new Error("web crypto not initialized"))}).catch(function(t){return n.onWebCryptoError(t,e,r,i)})},r.onWebCryptoError=function(t,e,r,i){return n.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",t),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(e,r,i)},r.getValidChunk=function(t){var e=t,r=t.length-t.length%16;return r!==t.length&&(e=Object(d.sliceUint8)(t,0,r),this.remainderData=Object(d.sliceUint8)(t,r)),e},r.logOnce=function(t){this.logEnabled&&(n.logger.log("[decrypter.ts]: "+t),this.logEnabled=!1)},a);function a(t,e,r){r=(void 0===r?{}:r).removePKCS7Padding,r=void 0===r||r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=t,this.config=e,this.removePKCS7Padding=r)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch(t){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}},"./src/crypt/fast-aes-key.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var i=(n.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},n);function n(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}},"./src/demux/aacdemuxer.ts":function(t,e,r){"use strict";function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}r.r(e);var i=r("./src/demux/base-audio-demuxer.ts"),a=r("./src/demux/adts.ts"),s=r("./src/utils/logger.ts"),o=r("./src/demux/id3.ts"),i=function(i){function t(t,e){var r;return(r=i.call(this)||this).observer=void 0,r.config=void 0,r.observer=t,r.config=e,r}var e,r=i;(e=t).prototype=Object.create(r.prototype),n(e.prototype.constructor=e,r);r=t.prototype;return r.resetInitSegment=function(t,e,r){i.prototype.resetInitSegment.call(this,t,e,r),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}},t.probe=function(t){if(!t)return!1;for(var e=(o.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(a.probe(t,e))return s.logger.log("ADTS sync word found !"),!0;return!1},r.canParse=function(t,e){return a.canParse(t,e)},r.appendFrame=function(t,e,r){a.initTrackConfig(t,this.observer,e,r,t.manifestCodec);r=a.appendFrame(t,e,r,this.initPTS,this.frameIndex);if(r&&0===r.missing)return r},t}(i.default);i.minProbeByteLength=9,e.default=i},"./src/demux/adts.ts":function(t,e,r){"use strict";function a(t,e,r,i){var n,a=navigator.userAgent.toLowerCase(),s=i,o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=1+((192&e[r+2])>>>6),u=(60&e[r+2])>>>2;return o.length-1<u?void t.trigger(p.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+u}):(t=(1&e[r+2])<<2,t|=(192&e[r+3])>>>6,i=/firefox/i.test(a)?6<=u?(l=5,n=[,,,,],u-3):(l=2,n=[,,],u):-1===a.indexOf("android")?(l=5,n=[,,,,],i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&6<=u?u-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(6<=u&&1==t||/vivaldi/i.test(a))||!i&&1==t)&&(l=2,n=[,,]),u)):(l=2,n=[,,],u),n[0]=l<<3,n[0]|=(14&u)>>1,n[1]|=(1&u)<<7,n[1]|=t<<3,5===l&&(n[1]|=(14&i)>>1,n[2]=(1&i)<<7,n[2]|=8,n[3]=0),{config:n,samplerate:o[u],channelCount:t,codec:"mp4a.40."+l,manifestCodec:s})}function i(t,e){return 255===t[e]&&240==(246&t[e+1])}function s(t,e){return 1&t[e+1]?7:9}function o(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function n(t,e){return e+5<t.length}function l(t,e){return e+1<t.length&&i(t,e)}function u(t,e){return n(t,e)&&i(t,e)&&o(t,e)<=t.length-e}function d(t,e){if(l(t,e)){var r=s(t,e);if(e+r>=t.length)return!1;var i=o(t,e);if(i<=r)return!1;i=e+i;return i===t.length||l(t,i)}return!1}function c(t,e,r,i,n){t.samplerate||(n=a(e,r,i,n))&&(t.config=n.config,t.samplerate=n.samplerate,t.channelCount=n.channelCount,t.codec=n.codec,t.manifestCodec=n.manifestCodec)}function f(t){return 9216e4/t}function h(t,e,r,i,n){var a=s(t,e),e=o(t,e);if(0<(e-=a))return{headerLength:a,frameLength:e,stamp:r+i*n}}function g(t,e,r,i,n){var a=h(e,r,i,n,f(t.samplerate));if(a){var s,o=a.frameLength,i=a.headerLength,n=a.stamp,a=i+o,o=Math.max(0,r+a-e.length);o?(s=new Uint8Array(a-i)).set(e.subarray(r+i,e.length),0):s=e.subarray(r+i,r+a);n={unit:s,pts:n};return o||t.samples.push(n),{sample:n,length:a,missing:o}}}r.r(e),r.d(e,"getAudioConfig",function(){return a}),r.d(e,"isHeaderPattern",function(){return i}),r.d(e,"getHeaderLength",function(){return s}),r.d(e,"getFullFrameLength",function(){return o}),r.d(e,"canGetFrameLength",function(){return n}),r.d(e,"isHeader",function(){return l}),r.d(e,"canParse",function(){return u}),r.d(e,"probe",function(){return d}),r.d(e,"initTrackConfig",function(){return c}),r.d(e,"getFrameDuration",function(){return f}),r.d(e,"parseFrameHeader",function(){return h}),r.d(e,"appendFrame",function(){return g});var v=r("./src/errors.ts"),p=r("./src/events.ts")},"./src/demux/base-audio-demuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"initPTSFn",function(){return v});var i=r("./src/polyfills/number.ts"),c=r("./src/demux/id3.ts"),f=r("./src/demux/dummy-demuxed-track.ts"),h=r("./src/utils/mp4-tools.ts"),g=r("./src/utils/typed-array.ts"),r=((r=n.prototype).resetInitSegment=function(t,e,r){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},r.resetTimeStamp=function(){},r.resetContiguity=function(){},r.canParse=function(t,e){return!1},r.appendFrame=function(t,e,r){},r.demux=function(t,e){this.cachedData&&(t=Object(h.appendUint8Array)(this.cachedData,t),this.cachedData=null);var r,i,n,a=c.getID3Data(t,0),s=a?a.length:0,o=this._audioTrack,l=this._id3Track,u=a?c.getTimeStamp(a):void 0,d=t.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=v(u,e)),a&&0<a.length&&l.samples.push({pts:this.initPTS,dts:this.initPTS,data:a}),i=this.initPTS;s<d;)this.canParse(t,s)?(n=this.appendFrame(o,t,s))?(this.frameIndex++,i=n.sample.pts,r=s+=n.length):s=d:c.canParse(t,s)?(a=c.getID3Data(t,s),l.samples.push({pts:i,dts:i,data:a}),r=s+=a.length):s++,s===d&&r!==d&&(n=Object(g.sliceUint8)(t,r),this.cachedData=this.cachedData?Object(h.appendUint8Array)(this.cachedData,n):n);return{audioTrack:o,avcTrack:Object(f.dummyTrack)(),id3Track:l,textTrack:Object(f.dummyTrack)()}},r.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},r.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(f.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(f.dummyTrack)()}},r.destroy=function(){},n),v=function(t,e){return Object(i.isFiniteNumber)(t)?90*t:9e4*e};function n(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}e.default=r},"./src/demux/chunk-cache.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var i=((e=n.prototype).push=function(t){this.chunks.push(t),this.dataLength+=t.length},e.flush=function(){var t=this.chunks,a=this.dataLength;return t.length?(t=1===t.length?t[0]:function(t){for(var e,r=new Uint8Array(a),i=0,n=0;n<t.length;n++)e=t[n],r.set(e,i),i+=e.length;return r}(t),this.reset(),t):new Uint8Array(0)},e.reset=function(){this.chunks.length=0,this.dataLength=0},n);function n(){this.chunks=[],this.dataLength=0}},"./src/demux/dummy-demuxed-track.ts":function(t,e,r){"use strict";function i(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}r.r(e),r.d(e,"dummyTrack",function(){return i})},"./src/demux/exp-golomb.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/utils/logger.ts"),r=((r=n.prototype).loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),e=Math.min(4,e);if(0===e)throw new Error("no bytes available");i.set(t.subarray(r,r+e)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},r.skipBits=function(t){var e;this.bitsAvailable>t||(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord()),this.word<<=t,this.bitsAvailable-=t},r.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return 32<t&&i.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,0<this.bitsAvailable?this.word<<=e:0<this.bytesAvailable&&this.loadWord(),0<(e=t-e)&&this.bitsAvailable?r<<e|this.readBits(e):r},r.skipLZ=function(){for(var t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},r.skipUEG=function(){this.skipBits(1+this.skipLZ())},r.skipEG=function(){this.skipBits(1+this.skipLZ())},r.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},r.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},r.readBoolean=function(){return 1===this.readBits(1)},r.readUByte=function(){return this.readBits(8)},r.readUShort=function(){return this.readBits(16)},r.readUInt=function(){return this.readBits(32)},r.skipScalingList=function(t){for(var e=8,r=8,i=0;i<t;i++)e=0===(r=0!==r?(e+this.readEG()+256)%256:r)?e:r},r.readSPS=function(){var t,e,r,i=0,n=0,a=0,s=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),d=this.readBoolean.bind(this),c=this.skipBits.bind(this),f=this.skipEG.bind(this),h=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);o();var v=o();if(l(5),c(3),o(),h(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){var p=u();if(3===p&&c(1),h(),h(),c(1),d())for(e=3===p?12:8,r=0;r<e;r++)d()&&g(r<6?16:64)}h();p=u();if(0===p)u();else if(1===p)for(c(1),f(),f(),t=u(),r=0;r<t;r++)f();h(),c(1);p=u(),h=u(),l=l(1);0===l&&c(1),c(1),d()&&(i=u(),n=u(),a=u(),s=u());var m=[1,1];if(d()&&d())switch(o()){case 1:m=[1,1];break;case 2:m=[12,11];break;case 3:m=[10,11];break;case 4:m=[16,11];break;case 5:m=[40,33];break;case 6:m=[24,11];break;case 7:m=[20,11];break;case 8:m=[32,11];break;case 9:m=[80,33];break;case 10:m=[18,11];break;case 11:m=[15,11];break;case 12:m=[64,33];break;case 13:m=[160,99];break;case 14:m=[4,3];break;case 15:m=[3,2];break;case 16:m=[2,1];break;case 255:m=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(p+1)-2*i-2*n),height:(2-l)*(h+1)*16-(l?2:4)*(a+s),pixelRatio:m}},r.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},n);function n(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}e.default=r},"./src/demux/id3.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"isHeader",function(){return o}),r.d(e,"isFooter",function(){return l}),r.d(e,"getID3Data",function(){return i}),r.d(e,"canParse",function(){return n}),r.d(e,"getTimeStamp",function(){return a}),r.d(e,"isTimeStampFrame",function(){return s}),r.d(e,"getID3Frames",function(){return f}),r.d(e,"decodeFrame",function(){return h}),r.d(e,"utf8ArrayToStr",function(){return y}),r.d(e,"testables",function(){return E});var d,o=function(t,e){return!!(e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128)},l=function(t,e){return!!(e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128)},i=function(t,e){for(var r=e,i=0;o(t,e);)i+=10,i+=u(t,e+6),l(t,e+10)&&(i+=10),e+=i;return 0<i?t.subarray(r,r+i):void 0},u=function(t,e){var r=0,r=(127&t[e])<<21;return r|=(127&t[e+1])<<14,(r|=(127&t[e+2])<<7)|127&t[e+3]},n=function(t,e){return o(t,e)&&u(t,e+6)+10<=t.length-e},a=function(t){for(var e,r=f(t),i=0;i<r.length;i++)if(e=r[i],s(e))return m(e)},s=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},c=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),r=u(t,4);return{type:e,size:r,data:t.subarray(10,10+r)}},f=function(t){for(var e=0,r=[];o(t,e);){for(var i=u(t,e+6),n=(e+=10)+i;e+8<n;){var a=c(t.subarray(e)),s=h(a);s&&r.push(s),e+=a.size+10}l(t,e)&&(e+=10)}return r},h=function(t){return("PRIV"===t.type?g:"W"===t.type[0]?p:v)(t)},g=function(t){if(!(t.size<2)){var e=y(t.data,!0),r=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:r.buffer}}},v=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,r=y(t.data.subarray(1),!0);e+=r.length+1;e=y(t.data.subarray(e));return{key:t.type,info:r,data:e}}e=y(t.data.subarray(1));return{key:t.type,data:e}}},p=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,r=y(t.data.subarray(1),!0);e+=r.length+1;e=y(t.data.subarray(e));return{key:t.type,info:r,data:e}}e=y(t.data);return{key:t.type,data:e}},m=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),t=1&e[3],e=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return e/=45,t&&(e+=47721858.84),Math.round(e)}},y=function(t,e){void 0===e&&(e=!1);d=d||void 0===self.TextDecoder?d:new self.TextDecoder("utf-8");if(d){var r=d.decode(t);if(e){var i=r.indexOf("\0");return-1===i?r:r.substring(0,i)}return r.replace(/\0/g,"")}for(var n,a,s,o=t.length,l="",u=0;u<o;){if(0===(n=t[u++])&&e)return l;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(n);break;case 12:case 13:a=t[u++],l+=String.fromCharCode((31&n)<<6|63&a);break;case 14:a=t[u++],s=t[u++],l+=String.fromCharCode((15&n)<<12|(63&a)<<6|(63&s)<<0)}}return l},E={decodeTextFrame:v}},"./src/demux/mp3demuxer.ts":function(t,e,r){"use strict";function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}r.r(e);var i=r("./src/demux/base-audio-demuxer.ts"),a=r("./src/demux/id3.ts"),s=r("./src/utils/logger.ts"),o=r("./src/demux/mpegaudio.ts"),i=function(i){function t(){return i.apply(this,arguments)||this}var e,r=i;(e=t).prototype=Object.create(r.prototype),n(e.prototype.constructor=e,r);r=t.prototype;return r.resetInitSegment=function(t,e,r){i.prototype.resetInitSegment.call(this,t,e,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}},t.probe=function(t){if(!t)return!1;for(var e=(a.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(o.probe(t,e))return s.logger.log("MPEG Audio sync word found !"),!0;return!1},r.canParse=function(t,e){return o.canParse(t,e)},r.appendFrame=function(t,e,r){return null===this.initPTS?void 0:o.appendFrame(t,e,r,this.initPTS,this.frameIndex)},t}(i.default);i.minProbeByteLength=4,e.default=i},"./src/demux/mp4demuxer.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/utils/mp4-tools.ts"),n=r("./src/demux/dummy-demuxed-track.ts"),r=((r=a.prototype).resetTimeStamp=function(){},r.resetInitSegment=function(){},r.resetContiguity=function(){},a.probe=function(t){return 0<Object(i.findBox)({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length},r.demux=function(t){var e=t,r=Object(n.dummyTrack)();return this.config.progressive?(this.remainderData&&(e=Object(i.appendUint8Array)(this.remainderData,t)),t=Object(i.segmentValidRange)(e),this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array):r.samples=e,{audioTrack:Object(n.dummyTrack)(),avcTrack:r,id3Track:Object(n.dummyTrack)(),textTrack:Object(n.dummyTrack)()}},r.flush=function(){var t=Object(n.dummyTrack)();return t.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(n.dummyTrack)(),avcTrack:t,id3Track:Object(n.dummyTrack)(),textTrack:Object(n.dummyTrack)()}},r.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},r.destroy=function(){},a);function a(t,e){this.remainderData=null,this.config=void 0,this.config=e}r.minProbeByteLength=1024,e.default=r},"./src/demux/mpegaudio.ts":function(t,e,r){"use strict";function i(t,e,r,i,n){if(!(r+24>e.length)){var a=s(e,r);if(a&&r+a.frameLength<=e.length){n=i+n*(9e4*a.samplesPerFrame/a.sampleRate),n={unit:e.subarray(r,r+a.frameLength),pts:n,dts:n};return t.config=[],t.channelCount=a.channelCount,t.samplerate=a.sampleRate,t.samples.push(n),{sample:n,length:a.frameLength,missing:0}}}}function s(t,e){var r=3&t[e+1]>>3,i=3&t[e+1]>>1,n=15&t[e+2]>>4,a=3&t[e+2]>>2;if(1!=r&&0!=n&&15!=n&&3!=a){var s=1&t[e+2]>>1,o=t[e+3]>>6,l=1e3*f[14*(3==r?3-i:3==i?3:4)+n-1],u=h[3*(3==r?0:2==r?1:2)+a],d=3==o?1:2,n=g[r][i],a=v[i],r=8*n*a,s=Math.floor(n*l/u+s)*a;return null===c&&(a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),c=a?parseInt(a[1]):0),c&&c<=87&&2==i&&224e3<=l&&0==o&&(t[e+3]=128|t[e+3]),{sampleRate:u,channelCount:d,frameLength:s,samplesPerFrame:r}}}function n(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])}function a(t,e){return e+1<t.length&&n(t,e)}function o(t,e){return n(t,e)&&4<=t.length-e}function l(t,e){if(e+1<t.length&&n(t,e)){var r=s(t,e),i=4,i=e+(i=null!=r&&r.frameLength?r.frameLength:i);return i===t.length||a(t,i)}return!1}r.r(e),r.d(e,"appendFrame",function(){return i}),r.d(e,"parseHeader",function(){return s}),r.d(e,"isHeaderPattern",function(){return n}),r.d(e,"isHeader",function(){return a}),r.d(e,"canParse",function(){return o}),r.d(e,"probe",function(){return l});var c=null,f=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],h=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],g=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],v=[0,1,1,4]},"./src/demux/sample-aes.ts":function(t,e,r){"use strict";r.r(e);var i=r("./src/crypt/decrypter.ts"),u=r("./src/demux/tsdemuxer.ts"),r=((r=n.prototype).decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,e)},r.decryptAacSample=function(e,r,i,n){var a=e[r].unit,t=a.subarray(16,a.length-a.length%16),t=t.buffer.slice(t.byteOffset,t.byteOffset+t.length),s=this;this.decryptBuffer(t,function(t){t=new Uint8Array(t);a.set(t,16),n||s.decryptAacSamples(e,r+1,i)})},r.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,e,r,i),!i)return}}},r.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,n=32;n<=t.length-16;n+=160,i+=16)r.set(t.subarray(n,n+16),i);return r},r.getAvcDecryptedUnit=function(t,e){for(var r=new Uint8Array(e),i=0,n=32;n<=t.length-16;n+=160,i+=16)t.set(r.subarray(i,i+16),n);return t},r.decryptAvcSample=function(e,r,i,n,a,s){var o=Object(u.discardEPB)(a.data),t=this.getAvcEncryptedData(o),l=this;this.decryptBuffer(t.buffer,function(t){a.data=l.getAvcDecryptedUnit(o,t),s||l.decryptAvcSamples(e,r,i+1,n)})},r.decryptAvcSamples=function(t,e,r,i){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,r=0){if(e>=t.length)return void i();for(var n=t[e].units;!(r>=n.length);r++){var a=n[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(t,e,r,i,a,s),!s)return}}}},n);function n(t,e,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new i.default(t,e,{removePKCS7Padding:!1})}e.default=r},"./src/demux/transmuxer-interface.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var o=r("./node_modules/webworkify-webpack/index.js"),l=r("./src/events.ts"),b=r("./src/demux/transmuxer.ts"),A=r("./src/utils/logger.ts"),u=r("./src/errors.ts"),e=r("./src/utils/mediasource-helper.ts"),d=r("./node_modules/eventemitter3/index.js"),c=Object(e.getMediaSource)()||{isTypeSupported:function(){return!1}},i=((e=n.prototype).destroy=function(){var t=this.worker;t?(t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null):(e=this.transmuxer)&&(e.destroy(),this.transmuxer=null);var e=this.observer;e&&e.removeAllListeners(),this.observer=null},e.push=function(t,e,r,i,n,a,s,o,l,u){var d=this;l.transmuxing.start=self.performance.now();var c=this.transmuxer,f=this.worker,h=(a||n).start,g=n.decryptdata,v=this.frag,p=!(v&&n.cc===v.cc),m=!(v&&l.level===v.level),y=v?l.sn-v.sn:-1,E=this.part?l.part-this.part.index:1,T=!m&&(1==y||0==y&&1==E),v=self.performance.now();(m||y||0===n.stats.parsing.start)&&(n.stats.parsing.start=v),!a||!E&&T||(a.stats.parsing.start=v);v=new b.TransmuxState(p,T,o,m,h);T&&!p||(A.logger.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+p+"\n        trackSwitch: "+m+"\n        contiguous: "+T+"\n        accurateTimeOffset: "+o+"\n        timeOffset: "+h),u=new b.TransmuxConfig(r,i,e,s,u),this.configureTransmuxer(u)),this.frag=n,this.part=a,f?f.postMessage({cmd:"demux",data:t,decryptdata:g,chunkMeta:l,state:v},t instanceof ArrayBuffer?[t]:[]):c&&(v=c.push(t,g,l,v),Object(b.isPromise)(v)?v.then(function(t){d.handleTransmuxComplete(t)}):this.handleTransmuxComplete(v))},e.flush=function(e){var r=this;e.transmuxing.start=self.performance.now();var t=this.transmuxer,i=this.worker;i?i.postMessage({cmd:"flush",chunkMeta:e}):t&&(t=t.flush(e),Object(b.isPromise)(t)?t.then(function(t){r.handleFlushResult(t,e)}):this.handleFlushResult(t,e))},e.handleFlushResult=function(t,e){var r=this;t.forEach(function(t){r.handleTransmuxComplete(t)}),this.onFlush(e)},e.onWorkerMessage=function(t){var e=t.data,r=this.hls;switch(e.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data)}},e.configureTransmuxer=function(t){var e=this.worker,r=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):r&&r.configure(t)},e.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},n);function n(r,t,e,i){var n=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=r,this.id=t,this.onTransmuxComplete=e,this.onFlush=i;var a=r.config,e=function(t,e){(e=e||{}).frag=n.frag,e.id=n.id,r.trigger(t,e)};this.observer=new d.EventEmitter,this.observer.on(l.Events.FRAG_DECRYPTED,e),this.observer.on(l.Events.ERROR,e);var s,i={mp4:c.isTypeSupported("video/mp4"),mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"')},e=navigator.vendor;if(a.enableWorker&&"undefined"!=typeof Worker){A.logger.log("demuxing in webworker");try{s=this.worker=o("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),s.addEventListener("message",this.onwmsg),s.onerror=function(t){r.trigger(l.Events.ERROR,{type:u.ErrorTypes.OTHER_ERROR,details:u.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(t.message+"  ("+t.filename+":"+t.lineno+")")})},s.postMessage({cmd:"init",typeSupported:i,vendor:e,id:t,config:JSON.stringify(a)})}catch(r){A.logger.warn("Error in worker:",r),A.logger.error("Error while initializing DemuxerWorker, fallback to inline"),s&&self.URL.revokeObjectURL(s.objectURL),this.transmuxer=new b.default(this.observer,i,a,e,t),this.worker=null}}else this.transmuxer=new b.default(this.observer,i,a,e,t)}},"./src/demux/transmuxer-worker.ts":function(t,e,r){"use strict";function i(a){function s(t,e){a.postMessage({event:t,data:e})}var o=new f.EventEmitter;o.on(n.Events.FRAG_DECRYPTED,s),o.on(n.Events.ERROR,s),a.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":var r=JSON.parse(e.config);a.transmuxer=new d.default(o,e.typeSupported,r,e.vendor,e.id),Object(c.enableLogs)(r.debug),s("init",null);break;case"configure":a.transmuxer.configure(e.config);break;case"demux":var i=a.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(d.isPromise)(i)?i.then(function(t){l(a,t)}):l(a,i);break;case"flush":var n=e.chunkMeta,i=a.transmuxer.flush(n);Object(d.isPromise)(i)?i.then(function(t){u(a,t,n)}):u(a,i,n)}})}function l(t,e){var r,i,n;((n=e.remuxResult).audio||n.video||n.text||n.id3||n.initSegment)&&(r=[],n=(i=e.remuxResult).audio,i=i.video,n&&a(r,n),i&&a(r,i),t.postMessage({event:"transmuxComplete",data:e},r))}function a(t,e){e.data1&&t.push(e.data1.buffer),e.data2&&t.push(e.data2.buffer)}function u(e,t,r){t.forEach(function(t){l(e,t)}),e.postMessage({event:"flush",data:r})}r.r(e),r.d(e,"default",function(){return i});var d=r("./src/demux/transmuxer.ts"),n=r("./src/events.ts"),c=r("./src/utils/logger.ts"),f=r("./node_modules/eventemitter3/index.js")},"./src/demux/transmuxer.ts":function(t,e,r){"use strict";function u(t){return"then"in t&&t.then instanceof Function}r.r(e),r.d(e,"default",function(){return l}),r.d(e,"isPromise",function(){return u}),r.d(e,"TransmuxConfig",function(){return h}),r.d(e,"TransmuxState",function(){return g});var m,d=r("./src/events.ts"),c=r("./src/errors.ts"),i=r("./src/crypt/decrypter.ts"),n=r("./src/demux/aacdemuxer.ts"),y=r("./src/demux/mp4demuxer.ts"),a=r("./src/demux/tsdemuxer.ts"),s=r("./src/demux/mp3demuxer.ts"),e=r("./src/remux/mp4-remuxer.ts"),E=r("./src/remux/passthrough-remuxer.ts"),o=r("./src/demux/chunk-cache.ts"),T=r("./src/utils/mp4-tools.ts"),b=r("./src/utils/logger.ts");try{m=self.performance.now.bind(self.performance)}catch(t){b.logger.debug("Unable to use Performance API on this environment"),m=self.Date.now}var A=[{demux:a.default,remux:e.default},{demux:y.default,remux:E.default},{demux:n.default,remux:e.default},{demux:s.default,remux:e.default}],f=1024;A.forEach(function(t){t=t.demux;f=Math.max(f,t.minProbeByteLength)});var l=((e=v.prototype).configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},e.push=function(t,e,r,i){var n=this,a=r.transmuxing;a.executeStart=m();var s=new Uint8Array(t),o=this.cache,l=this.config,u=this.currentTransmuxState,d=this.transmuxConfig;i&&(this.currentTransmuxState=i);var c=(p=null,p=0<s.byteLength&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method?e:p);if(c&&"AES-128"===c.method){var f=this.getDecrypter();if(!l.enableSoftwareAES)return this.decryptionPromise=f.webCryptoDecrypt(s,c.key.buffer,c.iv.buffer).then(function(t){t=n.push(t,null,r);return n.decryptionPromise=null,t}),this.decryptionPromise;var h=f.softwareDecrypt(s,c.key.buffer,c.iv.buffer);if(!h)return a.executeEnd=m(),S(r);s=new Uint8Array(h)}var g=i||u,v=g.contiguous,t=g.discontinuity,e=g.trackSwitch,p=g.accurateTimeOffset,l=g.timeOffset,f=d.audioCodec,h=d.videoCodec,i=d.defaultInitPts,u=d.duration,g=d.initSegmentData;(t||e)&&this.resetInitSegment(g,f,h,u),t&&this.resetInitialTimestamp(i),v||this.resetContiguity(),this.needsProbing(s,t,e)&&(o.dataLength&&(o=o.flush(),s=Object(T.appendUint8Array)(o,s)),this.configureTransmuxer(s,d));l=this.transmux(s,c,l,p,r),p=this.currentTransmuxState;return p.contiguous=!0,p.discontinuity=!1,p.trackSwitch=!1,a.executeEnd=m(),l},e.flush=function(e){var r=this,t=e.transmuxing;t.executeStart=m();var i=this.decrypter,n=this.cache,a=this.currentTransmuxState,s=this.decryptionPromise;if(s)return s.then(function(){return r.flush(e)});var o=[],a=a.timeOffset;!i||(l=i.flush())&&o.push(this.push(l,null,e));i=n.dataLength;n.reset();var l=this.demuxer,n=this.remuxer;if(!l||!n)return f<=i&&this.observer.emit(d.Events.ERROR,d.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),t.executeEnd=m(),[S(e)];a=l.flush(a);return u(a)?a.then(function(t){return r.flushRemux(o,t,e),o}):(this.flushRemux(o,a,e),o)},e.flushRemux=function(t,e,r){var i=e.audioTrack,n=e.avcTrack,a=e.id3Track,s=e.textTrack,o=this.currentTransmuxState,e=o.accurateTimeOffset,o=o.timeOffset,e=this.remuxer.remux(i,n,a,s,o,e,!0,this.id);t.push({remuxResult:e,chunkMeta:r}),r.transmuxing.executeEnd=m()},e.resetInitialTimestamp=function(t){var e=this.demuxer,r=this.remuxer;e&&r&&(e.resetTimeStamp(t),r.resetTimeStamp(t))},e.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},e.resetInitSegment=function(t,e,r,i){var n=this.demuxer,a=this.remuxer;n&&a&&(n.resetInitSegment(e,r,i),a.resetInitSegment(t,e,r))},e.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},e.transmux=function(t,e,r,i,n){return e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,r,i,n):this.transmuxUnencrypted(t,r,i,n)},e.transmuxUnencrypted=function(t,e,r,i){var n=this.demuxer.demux(t,e,!1,!this.config.progressive),a=n.audioTrack,s=n.avcTrack,t=n.id3Track,n=n.textTrack;return{remuxResult:this.remuxer.remux(a,s,t,n,e,r,!1,this.id),chunkMeta:i}},e.transmuxSampleAes=function(t,e,r,i,n){var a=this;return this.demuxer.demuxSampleAes(t,e,r).then(function(t){return{remuxResult:a.remuxer.remux(t.audioTrack,t.avcTrack,t.id3Track,t.textTrack,r,i,!1,a.id),chunkMeta:n}})},e.configureTransmuxer=function(t,e){for(var r,i=this.config,n=this.observer,a=this.typeSupported,s=this.vendor,o=e.audioCodec,l=e.defaultInitPts,u=e.duration,d=e.initSegmentData,c=e.videoCodec,f=0,h=A.length;f<h;f++)if(A[f].demux.probe(t)){r=A[f];break}r||(b.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),r={demux:y.default,remux:E.default});var g=this.demuxer,v=this.remuxer,p=r.remux,e=r.demux;v&&v instanceof p||(this.remuxer=new p(n,i,a,s)),g&&g instanceof e||(this.demuxer=new e(n,i,a),this.probe=e.probe),this.resetInitSegment(d,o,c,u),this.resetInitialTimestamp(l)},e.needsProbing=function(t,e,r){return!this.demuxer||!this.remuxer||e||r},e.getDecrypter=function(){return this.decrypter||(this.decrypter=new i.default(this.observer,this.config))},v),S=function(t){return{remuxResult:{},chunkMeta:t}},h=function(t,e,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n},g=function(t,e,r,i,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n};function v(t,e,r,i,n){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new o.default,this.observer=t,this.typeSupported=e,this.config=r,this.vendor=i,this.id=n}},"./src/demux/tsdemuxer.ts":function(t,e,r){"use strict";function R(t,e,r,i){return{key:t,frame:!1,pts:e,dts:r,units:[],debug:i,length:0}}function _(t){var e,r,i,n,a=0,s=t.data;if(!t||0===t.size)return null;for(;s[0].length<19&&1<s.length;){var o=new Uint8Array(s[0].length+s[1].length);o.set(s[0]),o.set(s[1],s[0].length),s[0]=o,s.splice(1,1)}if(1!==((e=s[0])[0]<<16)+(e[1]<<8)+e[2])return null;if((r=(e[4]<<8)+e[5])&&r>t.size-6)return null;var l=e[7];192&l&&(i=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&l?54e5<i-(n=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)&&(M.logger.warn(Math.round((i-n)/9e4)+"s delta between PTS and DTS, align them"),i=n):n=i);var u=(l=e[8])+9;if(t.size<=u)return null;t.size-=u;for(var d=new Uint8Array(t.size),c=0,f=s.length;c<f;c++){var h=(e=s[c]).byteLength;if(u){if(h<u){u-=h;continue}e=e.subarray(u),h-=u,u=0}d.set(e,a),a+=h}return r&&(r-=l+3),{data:d,pts:i,dts:n,len:r}}function C(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var r=e.samples,i=r.length;if(!i)return e.dropped++,0;i=r[i-1];t.pts=i.pts,t.dts=i.dts}e.samples.push(t)}t.debug.length&&M.logger.log(t.pts+"/"+t.dts+":"+t.debug)}function I(t,e){var r=t.length;if(0<r){if(e.pts>=t[r-1].pts)t.push(e);else for(var i=r-1;0<=i;i--)if(e.pts<t[i].pts){t.splice(i,0,e);break}}else t.push(e)}function x(t){for(var e=t.byteLength,r=[],i=1;i<e-2;)0===t[i]&&0===t[i+1]&&3===t[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return t;for(var n=e-r.length,a=new Uint8Array(n),s=0,i=0;i<n;s++,i++)s===r[0]&&(s++,r.shift()),a[i]=t[s];return a}r.r(e),r.d(e,"discardEPB",function(){return x});var h=r("./src/demux/adts.ts"),o=r("./src/demux/mpegaudio.ts"),w=r("./src/demux/exp-golomb.ts"),O=r("./src/demux/id3.ts"),i=r("./src/demux/sample-aes.ts"),P=r("./src/events.ts"),F=r("./src/utils/mp4-tools.ts"),M=r("./src/utils/logger.ts"),B=r("./src/errors.ts"),n={video:1,audio:2,id3:3,text:4},r=function(){function D(t,e,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=r}D.probe=function(t){t=D.syncOffset(t);return!(t<0||(t&&M.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),0))},D.syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),r=0;r<e;){if(71===t[r]&&71===t[r+188]&&71===t[r+376])return r;r++}return-1},D.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:n[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}};var t=D.prototype;return t.resetInitSegment=function(t,e,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=D.createTrack("video",r),this._audioTrack=D.createTrack("audio",r),this._id3Track=D.createTrack("id3",r),this._txtTrack=D.createTrack("text",r),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=e,this._duration=r},t.resetTimeStamp=function(){},t.resetContiguity=function(){var t=this._audioTrack,e=this._avcTrack,r=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},t.demux=function(t,e,r,i){void 0===i&&(i=!1),(r=void 0===r?!1:r)||(this.sampleAes=null);var n,a=this._avcTrack,s=this._audioTrack,o=this._id3Track,l=a.pid,u=a.pesData,d=s.pid,c=o.pid,f=s.pesData,h=o.pesData,g=!1,v=this.pmtParsed,p=this._pmtId,m=t.length;if(this.remainderData&&(m=(t=Object(F.appendUint8Array)(this.remainderData,t)).length,this.remainderData=null),m<188&&!i)return this.remainderData=t,{audioTrack:s,avcTrack:a,id3Track:o,textTrack:this._txtTrack};var y=Math.max(0,D.syncOffset(t));(m-=(m+y)%188)<t.byteLength&&!i&&(this.remainderData=new Uint8Array(t.buffer,m,t.buffer.byteLength-m));for(var E,T=y;T<m;T+=188)if(71===t[T]){var b=!!(64&t[T+1]),A=((31&t[T+1])<<8)+t[T+2],S=void 0;if(1<(48&t[T+3])>>4){if((S=T+5+t[T+4])===T+188)continue}else S=T+4;switch(A){case l:b&&(u&&(n=_(u))&&this.parseAVCPES(n,!1),u={data:[],size:0}),u&&(u.data.push(t.subarray(S,T+188)),u.size+=T+188-S);break;case d:b&&(f&&(n=_(f))&&(s.isAAC?this.parseAACPES(n):this.parseMPEGPES(n)),f={data:[],size:0}),f&&(f.data.push(t.subarray(S,T+188)),f.size+=T+188-S);break;case c:b&&(h&&(n=_(h))&&this.parseID3PES(n),h={data:[],size:0}),h&&(h.data.push(t.subarray(S,T+188)),h.size+=T+188-S);break;case 0:b&&(S+=t[S]+1),p=this._pmtId=(31&(E=t)[(L=S)+10])<<8|E[L+11];break;case p:b&&(S+=t[S]+1);var L=function(t,e,r,i){var n={audio:-1,avc:-1,id3:-1,isAAC:!0},a=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<a;){var s=(31&t[e+1])<<8|t[e+2];switch(t[e]){case 207:if(!i){M.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=s);break;case 21:-1===n.id3&&(n.id3=s);break;case 219:if(!i){M.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=s);break;case 3:case 4:r?-1===n.audio&&(n.audio=s,n.isAAC=!1):M.logger.log("MPEG audio found, not supported in this browser");break;case 36:M.logger.warn("Unsupported HEVC stream type found")}e+=5+((15&t[e+3])<<8|t[e+4])}return n}(t,S,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,r);0<(l=L.avc)&&(a.pid=l),0<(d=L.audio)&&(s.pid=d,s.isAAC=L.isAAC),0<(c=L.id3)&&(o.pid=c),g&&!v&&(M.logger.log("reparse from beginning"),g=!1,T=y-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:g=!0}}else this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});a.pesData=u,s.pesData=f,o.pesData=h;var k={audioTrack:s,avcTrack:a,id3Track:o,textTrack:this._txtTrack};return i&&this.extractRemainingSamples(k),k},t.flush=function(){var t=this.remainderData;return this.remainderData=null,t=t?this.demux(t,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},t.extractRemainingSamples=function(t){var e,r=t.audioTrack,i=t.avcTrack,n=t.id3Track,a=i.pesData,s=r.pesData,t=n.pesData;a&&(e=_(a))?(this.parseAVCPES(e,!0),i.pesData=null):i.pesData=a,s&&(e=_(s))?(r.isAAC?this.parseAACPES(e):this.parseMPEGPES(e),r.pesData=null):(null!=s&&s.size&&M.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=s),t&&(e=_(t))?(this.parseID3PES(e),n.pesData=null):n.pesData=t},t.demuxSampleAes=function(t,e,r){r=this.demux(t,r,!0,!this.config.progressive),e=this.sampleAes=new i.default(this.observer,this.config,e);return this.decrypt(r,e)},t.decrypt=function(i,n){return new Promise(function(t){var e=i.audioTrack,r=i.avcTrack;e.samples&&e.isAAC?n.decryptAacSamples(e.samples,0,function(){r.samples?n.decryptAvcSamples(r.samples,0,0,function(){t(i)}):t(i)}):r.samples&&n.decryptAvcSamples(r.samples,0,0,function(){t(i)})})},t.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},t.parseAVCPES=function(A,t){var S,L=this,k=this._avcTrack,e=this.parseAVCNALu(A.data),D=this.avcSample,_=!1;A.data=null,D&&e.length&&!k.audFound&&(C(D,k),D=this.avcSample=R(!1,A.pts,A.dts,"")),e.forEach(function(t){switch(t.type){case 1:S=!0,(D=D||(L.avcSample=R(!0,A.pts,A.dts,""))).frame=!0;var e=t.data;_&&4<e.length&&(2!==(m=new w.default(e).readSliceType())&&4!==m&&7!==m&&9!==m||(D.key=!0));break;case 5:S=!0,(D=D||(L.avcSample=R(!0,A.pts,A.dts,""))).key=!0,D.frame=!0;break;case 6:S=!0;var r=new w.default(x(t.data));r.readUByte();for(var i=0,n=0,a=!1,s=0;!a&&1<r.bytesAvailable;){for(i=0;i+=s=r.readUByte(),255===s;);for(n=0;n+=s=r.readUByte(),255===s;);if(4===i&&0!==r.bytesAvailable){if(a=!0,181===r.readUByte()&&49===r.readUShort()&&1195456820===r.readUInt()&&3===r.readUByte()){for(var o=r.readUByte(),l=31&o,u=[o,r.readUByte()],d=0;d<l;d++)u.push(r.readUByte()),u.push(r.readUByte()),u.push(r.readUByte());I(L._txtTrack.samples,{type:3,pts:A.pts,bytes:u})}}else if(5===i&&0!==r.bytesAvailable){if(a=!0,16<n){for(var c=[],f=0;f<16;f++)c.push(r.readUByte().toString(16)),3!=f&&5!==f&&7!==f&&9!==f||c.push("-");for(var h=n-16,g=new Uint8Array(h),v=0;v<h;v++)g[v]=r.readUByte();I(L._txtTrack.samples,{pts:A.pts,payloadType:i,uuid:c.join(""),userData:Object(O.utf8ArrayToStr)(g),userDataBytes:g})}}else if(n<r.bytesAvailable)for(var p=0;p<n;p++)r.readUByte()}break;case 7:if(_=S=!0,!k.sps){var m=new w.default(t.data).readSPS();k.width=m.width,k.height=m.height,k.pixelRatio=m.pixelRatio,k.sps=[t.data],k.duration=L._duration;for(var y,E=t.data.subarray(1,4),T="avc1.",b=0;b<3;b++)T+=y=(y=E[b].toString(16)).length<2?"0"+y:y;k.codec=T}break;case 8:S=!0,k.pps||(k.pps=[t.data]);break;case 9:S=!1,k.audFound=!0,D&&C(D,k),D=L.avcSample=R(!1,A.pts,A.dts,"");break;case 12:S=!1;break;default:S=!1,D&&(D.debug+="unknown NAL "+t.type+" ")}D&&S&&D.units.push(t)}),t&&D&&(C(D,k),this.avcSample=null)},t.getLastNalUnit=function(){var t,e,r=this.avcSample;return e=null!==(r=!r||0===r.units.length?(t=this._avcTrack.samples)[t.length-1]:r)&&void 0!==r&&r.units?(r=r.units)[r.length-1]:e},t.parseAVCNALu=function(t){var e,r,i,n,a,s,o=t.byteLength,l=this._avcTrack,u=l.naluState||0,d=u,c=[],f=0,h=-1,g=0;for(-1===u&&(g=31&t[h=0],u=0,f=1);f<o;)e=t[f++],u=u?1!==u?e?1===e?(0<=h?(n={data:t.subarray(h,f-u-1),type:g},c.push(n)):(i=this.getLastNalUnit())&&(d&&f<=4-d&&i.state&&(i.data=i.data.subarray(0,i.data.byteLength-d)),0<(r=f-u-1))&&((n=new Uint8Array(i.data.byteLength+r)).set(i.data,0),n.set(t.subarray(0,r),i.data.byteLength),i.data=n),f<o?(g=31&t[h=f],0):-1):0:3:e?0:2:e?0:1;return 0<=h&&0<=u&&(s={data:t.subarray(h,o),type:g,state:u},c.push(s)),0!==c.length||(a=this.getLastNalUnit())&&((s=new Uint8Array(a.data.byteLength+t.byteLength)).set(a.data,0),s.set(t,a.data.byteLength),a.data=s),l.naluState=u,c},t.parseAACPES=function(t){var e,r,i,n,a,s=0,o=this._audioTrack,l=this.aacOverFlow,u=t.data;for(l&&(this.aacOverFlow=null,a=(a=l.sample.unit.byteLength)-(n=Math.min(l.missing,a)),l.sample.unit.set(u.subarray(0,n),a),o.samples.push(l.sample),s=l.missing),e=s,r=u.length;e<r-1&&!h.isHeader(u,e);e++);if(e===s||(s=e<r-1?(i="AAC PES did not start with ADTS header,offset:"+e,!1):(i="no ADTS header found in AAC PES",!0),M.logger.warn("parsing error:"+i),this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:i}),!s)){if(h.initTrackConfig(o,this.observer,u,e,this.audioCodec),void 0!==t.pts)d=t.pts;else{if(!l)return void M.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var t=h.getFrameDuration(o.samplerate),d=l.sample.pts+t}for(var c=0;e<r;){if(h.isHeader(u,e)){if(e+5<r){var f=h.appendFrame(o,u,e,d,c);if(f){if(!f.missing){e+=f.length,c++;continue}this.aacOverFlow=f}}break}e++}}},t.parseMPEGPES=function(t){var e=t.data,r=e.length,i=0,n=0,a=t.pts;if(void 0!==a)for(;n<r;)if(o.isHeader(e,n)){var s=o.appendFrame(this._audioTrack,e,n,a,i);if(!s)break;n+=s.length,i++}else n++;else M.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(t){return void 0===t.pts?void M.logger.warn("[tsdemuxer]: ID3 PES unknown PTS"):void this._id3Track.samples.push(t)},D}();r.minProbeByteLength=188,e.default=r},"./src/empty.js":function(t,e){t.exports=void 0},"./src/errors.ts":function(t,e,r){"use strict";var i,n;r.r(e),r.d(e,"ErrorTypes",function(){return i}),r.d(e,"ErrorDetails",function(){return n}),(e=i=i||{}).NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",(e=n=n||{}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown"},"./src/events.ts":function(t,e,r){"use strict";var i;r.r(e),r.d(e,"Events",function(){return i}),(e=i=i||{}).MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(t,e,r){"use strict";function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}r.r(e),r.d(e,"default",function(){return l});var n=r("./node_modules/url-toolkit/src/url-toolkit.js"),f=r("./src/loader/playlist-loader.ts"),h=r("./src/loader/key-loader.ts"),g=r("./src/controller/id3-track-controller.ts"),v=r("./src/controller/latency-controller.ts"),p=r("./src/controller/level-controller.ts"),m=r("./src/controller/fragment-tracker.ts"),y=r("./src/controller/stream-controller.ts"),a=r("./src/is-supported.ts"),E=r("./src/utils/logger.ts"),T=r("./src/config.ts"),b=r("./node_modules/eventemitter3/index.js"),s=r("./src/events.ts"),o=r("./src/errors.ts"),l=function(){function c(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new b.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var e=this.config=Object(T.mergeConfig)(c.DefaultConfig,t);this.userConfig=t,Object(E.enableLogs)(e.debug),this._autoLevelCapping=-1,e.progressive&&Object(T.enableStreamingMode)(e);var r=e.abrController,i=e.bufferController,n=e.capLevelController,a=e.fpsController,s=this.abrController=new r(this),o=this.bufferController=new i(this),l=this.capLevelController=new n(this),u=new a(this),d=new f.default(this),t=new h.default(this),r=new g.default(this),i=this.levelController=new p.default(this),n=new m.FragmentTracker(this),a=this.streamController=new y.default(this,n);l.setStreamController(a),u.setStreamController(a);a=[i,a];this.networkControllers=a;r=[d,t,s,o,l,u,r,n];this.audioTrackController=this.createController(e.audioTrackController,null,a),this.createController(e.audioStreamController,n,a),this.subtitleTrackController=this.createController(e.subtitleTrackController,null,a),this.createController(e.subtitleStreamController,n,a),this.createController(e.timelineController,null,r),this.emeController=this.createController(e.emeController,null,r),this.latencyController=this.createController(v.default,null,r),this.coreComponents=r}c.isSupported=function(){return Object(a.isSupported)()};var t,e,r=c.prototype;return r.createController=function(t,e,r){if(t){t=e?new t(this,e):new t(this);return r&&r.push(t),t}return null},r.on=function(t,e,r){this._emitter.on(t,e,r=void 0===r?this:r)},r.once=function(t,e,r){this._emitter.once(t,e,r=void 0===r?this:r)},r.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},r.off=function(t,e,r,i){this._emitter.off(t,e,r=void 0===r?this:r,i)},r.listeners=function(t){return this._emitter.listeners(t)},r.emit=function(t,e,r){return this._emitter.emit(t,e,r)},r.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(e){E.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.trigger(s.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,error:e})}return!1},r.listenerCount=function(t){return this._emitter.listenerCount(t)},r.destroy=function(){E.logger.log("destroy"),this.trigger(s.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0},r.attachMedia=function(t){E.logger.log("attachMedia"),this._media=t,this.trigger(s.Events.MEDIA_ATTACHING,{media:t})},r.detachMedia=function(){E.logger.log("detachMedia"),this.trigger(s.Events.MEDIA_DETACHING,void 0),this._media=null},r.loadSource=function(t){this.stopLoad();var e=this.media,r=this.url,i=this.url=n.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});E.logger.log("loadSource:"+i),e&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(e)),this.trigger(s.Events.MANIFEST_LOADING,{url:t})},r.startLoad=function(e){void 0===e&&(e=-1),E.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},r.stopLoad=function(){E.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},r.swapAudioCodec=function(){E.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},r.recoverMediaError=function(){E.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},r.removeLevel=function(t,e){this.levelController.removeLevel(t,e=void 0===e?0:e)},e=[{key:"version",get:function(){return"1.0.6-2"}},{key:"Events",get:function(){return s.Events}},{key:"ErrorTypes",get:function(){return o.ErrorTypes}},{key:"ErrorDetails",get:function(){return o.ErrorDetails}},{key:"DefaultConfig",get:function(){return c.defaultConfig||T.hlsDefaultConfig},set:function(t){c.defaultConfig=t}}],t=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){E.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){E.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){E.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){E.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){E.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){t=!!t;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(E.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var r=t.length,i=0;i<r;i++)if(t[i].maxBitrate>e)return i;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],i((r=c).prototype,t),i(r,e),c}();l.defaultConfig=void 0},"./src/is-supported.ts":function(t,e,r){"use strict";function i(){return self.SourceBuffer||self.WebKitSourceBuffer}function n(){var t=Object(s.getMediaSource)();if(!t)return!1;var e=i(),t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!t&&!!e}function a(){var t,e=i();return"function"==typeof(null==e||null===(t=e.prototype)||void 0===t?void 0:t.changeType)}r.r(e),r.d(e,"isSupported",function(){return n}),r.d(e,"changeTypeSupported",function(){return a});var s=r("./src/utils/mediasource-helper.ts")},"./src/loader/fragment-loader.ts":function(t,e,r){"use strict";function i(t){var r="function"==typeof Map?new Map:void 0;return(i=function(t){function e(){return n(t,arguments,s(this).constructor)}if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a(e,t)})(t)}function n(t,e,r){return(n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);i=new(Function.bind.apply(t,i));return r&&a(i,r.prototype),i}).apply(null,arguments)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){var r=(e=void 0===e?null:e)||t,t={frag:t,part:e,responseType:"arraybuffer",url:r.url,rangeStart:0,rangeEnd:0},e=r.byteRangeStartOffset,r=r.byteRangeEndOffset;return Object(l.isFiniteNumber)(e)&&Object(l.isFiniteNumber)(r)&&(t.rangeStart=e,t.rangeEnd=r),t}r.r(e),r.d(e,"default",function(){return u}),r.d(e,"LoadError",function(){return g});var o,l=r("./src/polyfills/number.ts"),h=r("./src/errors.ts"),u=(Math.pow(2,17),(e=c.prototype).destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(s,o){var l=this,t=s.url;if(!t)return Promise.reject(new g({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,networkDetails:null},"Fragment does not have a "+(t?"part list":"url")));this.abort();var r=this.config,u=r.fLoader,d=r.loader;return new Promise(function(n,i){l.loader&&l.loader.destroy();var a=l.loader=s.loader=new(u||d)(r),t=f(s),e={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:131072};s.stats=a.stats,a.load(t,e,{onSuccess:function(t,e,r,i){l.resetLoader(s,a),n({frag:s,part:null,payload:t.data,networkDetails:i})},onError:function(t,e,r){l.resetLoader(s,a),i(new g({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,response:t,networkDetails:r}))},onAbort:function(t,e,r){l.resetLoader(s,a),i(new g({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:s,networkDetails:r}))},onTimeout:function(t,e,r){l.resetLoader(s,a),i(new g({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:s,networkDetails:r}))},onProgress:function(t,e,r,i){o&&o({frag:s,part:null,payload:r,networkDetails:i})}})})},e.loadPart=function(s,o,l){var u=this;this.abort();var r=this.config,d=r.fLoader,c=r.loader;return new Promise(function(n,i){u.loader&&u.loader.destroy();var a=u.loader=s.loader=new(d||c)(r),t=f(s,o),e={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:131072};o.stats=a.stats,a.load(t,e,{onSuccess:function(t,e,r,i){u.resetLoader(s,a),u.updateStatsFromPart(s,o);i={frag:s,part:o,payload:t.data,networkDetails:i};l(i),n(i)},onError:function(t,e,r){u.resetLoader(s,a),i(new g({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,part:o,response:t,networkDetails:r}))},onAbort:function(t,e,r){s.stats.aborted=o.stats.aborted,u.resetLoader(s,a),i(new g({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:s,part:o,networkDetails:r}))},onTimeout:function(t,e,r){u.resetLoader(s,a),i(new g({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:s,part:o,networkDetails:r}))}})})},e.updateStatsFromPart=function(t,e){var r=t.stats,i=e.stats,n=i.total;r.loaded+=i.loaded,n?(e=((e=Math.round(t.duration/e.duration))-(e=Math.min(Math.round(r.loaded/n),e)))*Math.round(r.loaded/e),r.total=r.loaded+e):r.total=Math.max(r.loaded,r.total);r=r.loading,i=i.loading;r.start?r.first+=i.first-i.start:(r.start=i.start,r.first=i.first),r.end=i.end},e.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},c),g=(o=i(Error),r=o,(e=d).prototype=Object.create(r.prototype),a(e.prototype.constructor=e,r),d);function d(t){for(var e,r=arguments.length,i=Array(1<r?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return(e=o.call.apply(o,[this].concat(i))||this).data=void 0,e.data=t,e}function c(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}},"./src/loader/fragment.ts":function(t,e,r){"use strict";function i(t,e){t.prototype=Object.create(e.prototype),n(t.prototype.constructor=t,e)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}function s(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}r.r(e),r.d(e,"ElementaryStreamTypes",function(){return o}),r.d(e,"BaseSegment",function(){return g}),r.d(e,"Fragment",function(){return v}),r.d(e,"Part",function(){return p});var o,l=r("./src/polyfills/number.ts"),u=r("./node_modules/url-toolkit/src/url-toolkit.js"),d=r("./src/utils/logger.ts"),c=r("./src/loader/level-key.ts"),f=r("./src/loader/load-stats.ts");(r=o=o||{}).AUDIO="audio",r.VIDEO="video",r.AUDIOVIDEO="audiovideo";var h,g=(y.prototype.setByteRange=function(t,e){var r=t.split("@",2),t=[];t[0]=1===r.length?e?e.byteRangeEndOffset:0:parseInt(r[1]),t[1]=parseInt(r[0])+t[0],this._byteRange=t},s(y,[{key:"byteRange",get:function(){return this._byteRange||[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(u.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),y),v=function(r){function t(t,e){return(e=r.call(this,e)||this)._decryptdata=null,e.rawProgramDateTime=null,e.programDateTime=null,e.tagList=[],e.duration=0,e.sn=0,e.levelkey=void 0,e.type=void 0,e.loader=null,e.level=-1,e.cc=0,e.startPTS=void 0,e.endPTS=void 0,e.appendedPTS=void 0,e.startDTS=void 0,e.endDTS=void 0,e.start=0,e.deltaPTS=void 0,e.maxStartPTS=void 0,e.minEndPTS=void 0,e.stats=new f.LoadStats,e.urlId=0,e.data=void 0,e.bitrateTest=!1,e.title=null,e.initSegment=null,e.type=t,e}i(t,r);var e=t.prototype;return e.createInitializationVector=function(t){for(var e=new Uint8Array(16),r=12;r<16;r++)e[r]=255&t>>8*(15-r);return e},e.setDecryptDataFromLevelKey=function(t,e){var r=t;return"AES-128"===(null==t?void 0:t.method)&&t.uri&&!t.iv&&((r=c.LevelKey.fromURI(t.uri)).method=t.method,r.iv=this.createInitializationVector(e),r.keyFormat="identity"),r},e.setElementaryStreamInfo=function(t,e,r,i,n,a){void 0===a&&(a=!1);var s=this.elementaryStreams,o=s[t];return o?(o.startPTS=Math.min(o.startPTS,e),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),void(o.endDTS=Math.max(o.endDTS,n))):void(s[t]={startPTS:e,endPTS:r,startDTS:i,endDTS:n,partial:a})},e.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[o.AUDIO]=null,t[o.VIDEO]=null,t[o.AUDIOVIDEO]=null},s(t,[{key:"decryptdata",get:function(){return this.levelkey||this._decryptdata?(!this._decryptdata&&this.levelkey&&("number"!=typeof(t=this.sn)&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&d.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)),this._decryptdata):null;var t}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(l.isFiniteNumber)(this.programDateTime))return null;var t=Object(l.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;return!(null===(t=this.decryptdata)||void 0===t||!t.keyFormat||!this.decryptdata.uri)}}]),t}(g),p=(i(m,h=g),s(m,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),m);function m(t,e,r,i,n){(r=h.call(this,r)||this).fragOffset=0,r.duration=0,r.gap=!1,r.independent=!1,r.relurl=void 0,r.fragment=void 0,r.index=void 0,r.stats=new f.LoadStats,r.duration=t.decimalFloatingPoint("DURATION"),r.gap=t.bool("GAP"),r.independent=t.bool("INDEPENDENT"),r.relurl=t.enumeratedString("URI"),r.fragment=e,r.index=i;t=t.enumeratedString("BYTERANGE");return t&&r.setByteRange(t,n),n&&(r.fragOffset=n.fragOffset+n.duration),r}function y(t){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[o.AUDIO]=null,e[o.VIDEO]=null,e[o.AUDIOVIDEO]=null,e),this.baseurl=t}},"./src/loader/key-loader.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return n});var s=r("./src/events.ts"),i=r("./src/errors.ts"),o=r("./src/utils/logger.ts"),n=((r=a.prototype)._registerListeners=function(){this.hls.on(s.Events.KEY_LOADING,this.onKeyLoading,this)},r._unregisterListeners=function(){this.hls.off(s.Events.KEY_LOADING,this.onKeyLoading)},r.destroy=function(){for(var t in this._unregisterListeners(),this.loaders){t=this.loaders[t];t&&t.destroy()}this.loaders={}},r.onKeyLoading=function(t,e){var r,i=e.frag,n=i.type,a=this.loaders[n];i.decryptdata?(r=i.decryptdata.uri)!==this.decrypturl||null===this.decryptkey?(e=this.hls.config,a&&(o.logger.warn("abort previous key loader for type:"+n),a.abort()),r?(a=e.loader,n=i.loader=this.loaders[n]=new a(e),this.decrypturl=r,this.decryptkey=null,a={url:r,frag:i,responseType:"arraybuffer"},r={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:e.fragLoadingRetryDelay,maxRetryDelay:e.fragLoadingMaxRetryTimeout,highWaterMark:0},e={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.load(a,r,e)):o.logger.warn("key uri is falsy")):this.decryptkey&&(i.decryptdata.key=this.decryptkey,this.hls.trigger(s.Events.KEY_LOADED,{frag:i})):o.logger.warn("Missing decryption data on fragment in onKeyLoading")},r.loadsuccess=function(t,e,r){r=r.frag;return r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(t.data),r.loader=null,delete this.loaders[r.type],void this.hls.trigger(s.Events.KEY_LOADED,{frag:r})):void o.logger.error("after key load, decryptdata unset")},r.loaderror=function(t,e){var r=e.frag,e=r.loader;e&&e.abort(),delete this.loaders[r.type],this.hls.trigger(s.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:t})},r.loadtimeout=function(t,e){var r=e.frag,e=r.loader;e&&e.abort(),delete this.loaders[r.type],this.hls.trigger(s.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},a);function a(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this._registerListeners()}},"./src/loader/level-details.ts":function(t,e,r){"use strict";function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}r.r(e),r.d(e,"LevelDetails",function(){return a});var n=r("./src/polyfills/number.ts"),a=(s.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-t.lastPartSn,r=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!r||!!e,this.advanced=this.endSN>t.endSN||0<e||0==e&&0<r,this.misses=this.updated||this.advanced?Math.floor(.6*t.misses):t.misses+1,this.availabilityDelay=t.availabilityDelay},i(s.prototype,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(n.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return 0<t?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!==(t=this.fragments)&&void 0!==t&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),s);function s(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=t}},"./src/loader/level-key.ts":function(t,e,r){"use strict";function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}r.r(e),r.d(e,"LevelKey",function(){return a});var n=r("./node_modules/url-toolkit/src/url-toolkit.js"),a=(s.fromURL=function(t,e){return new s(t,e)},s.fromURI=function(t){return new s(t)},i(s.prototype,[{key:"uri",get:function(){return this._uri}}]),s);function s(t,e){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=e?Object(n.buildAbsoluteURL)(t,e,{alwaysNormalize:!0}):t}},"./src/loader/load-stats.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"LoadStats",function(){return i});var i=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(t,e,r){"use strict";function l(t,e,r){e=e[r];e&&(t[r]=e)}function N(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),Object(U.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}r.r(e),r.d(e,"default",function(){return i});var U=r("./src/polyfills/number.ts"),G=r("./node_modules/url-toolkit/src/url-toolkit.js"),j=r("./src/loader/fragment.ts"),H=r("./src/loader/level-details.ts"),V=r("./src/loader/level-key.ts"),K=r("./src/utils/attr-list.ts"),W=r("./src/utils/logger.ts"),u=r("./src/utils/codecs.ts"),d=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,c=/#EXT-X-MEDIA:(.*)/g,Y=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),q=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),z=/\.(mp4|m4s|m4v|m4a)$/i,i=(f.findGroup=function(t,e){for(var r,i=0;i<t.length;i++)if((r=t[i]).id===e)return r},f.convertAVC1ToAVCOTI=function(t){var e=t.split(".");if(2<e.length){var r=e.shift()+".";return(r+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).substr(-4)}return t},f.resolve=function(t,e){return G.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},f.parseMasterPlaylist=function(t,e){var r,i,n,a,s=[],o={},l=!1;for(d.lastIndex=0;null!=(a=d.exec(t));)a[1]?(i={attrs:r=new K.AttrList(a[1]),bitrate:r.decimalInteger("AVERAGE-BANDWIDTH")||r.decimalInteger("BANDWIDTH"),name:r.NAME,url:f.resolve(a[2],e)},(n=r.decimalResolution("RESOLUTION"))&&(i.width=n.width,i.height=n.height),function(i,n){["video","audio","text"].forEach(function(e){var t,r=i.filter(function(t){return Object(u.isCodecType)(t,e)});r.length&&(t=r.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}),n[e+"Codec"]=(0<t.length?t:r)[0],i=i.filter(function(t){return-1===r.indexOf(t)}))}),n.unknownCodecs=i}((r.CODECS||"").split(/[ ,]+/).filter(function(t){return t}),i),i.videoCodec&&-1!==i.videoCodec.indexOf("avc1")&&(i.videoCodec=f.convertAVC1ToAVCOTI(i.videoCodec)),s.push(i)):!a[3]||(a=new K.AttrList(a[3]))["DATA-ID"]&&(l=!0,o[a["DATA-ID"]]=a);return{levels:s,sessionData:l?o:null}},f.parseMasterPlaylistMedia=function(t,e,r,i){void 0===i&&(i=[]);var n=[],a=0;for(c.lastIndex=0;null!==(s=c.exec(t));){var s,o=new K.AttrList(s[1]);o.TYPE===r&&(s={attrs:o,bitrate:0,id:a++,groupId:o["GROUP-ID"],instreamId:o["INSTREAM-ID"],name:o.NAME||o.LANGUAGE||"",type:r,default:o.bool("DEFAULT"),autoselect:o.bool("AUTOSELECT"),forced:o.bool("FORCED"),lang:o.LANGUAGE,url:o.URI?f.resolve(o.URI,e):""},i.length&&(l(s,o=f.findGroup(i,s.groupId)||i[0],"audioCodec"),l(s,o,"textCodec")),n.push(s))}return n},f.parseLevelPlaylist=function(t,e,r,i,n){var a,s,o,l=new H.LevelDetails(e),u=l.fragments,d=null,c=0,f=0,h=0,g=0,v=null,p=new j.Fragment(i,e),m=-1,y=!1;for(Y.lastIndex=0,l.m3u8=t;null!==(a=Y.exec(t));){y&&(y=!1,(p=new j.Fragment(i,e)).start=h,p.sn=c,p.cc=g,p.level=r,d&&(p.initSegment=d,p.rawProgramDateTime=d.rawProgramDateTime));var E=a[1];if(E){p.duration=parseFloat(E);var T=(" "+a[2]).slice(1);p.title=T||null,p.tagList.push(T?["INF",E,T]:["INF",E])}else if(a[3])Object(U.isFiniteNumber)(p.duration)&&(p.start=h,o&&(p.levelkey=o),p.sn=c,p.level=r,p.cc=g,p.urlId=n,u.push(p),p.relurl=(" "+a[3]).slice(1),N(p,v),h+=(v=p).duration,c++,y=!(f=0));else if(a[4]){E=(" "+a[4]).slice(1);v?p.setByteRange(E,v):p.setByteRange(E)}else if(a[5])p.rawProgramDateTime=(" "+a[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),-1===m&&(m=u.length);else if(a=a[0].match(q)){for(s=1;s<a.length&&void 0===a[s];s++);var b=(" "+a[s]).slice(1),A=(" "+a[s+1]).slice(1),S=a[s+2]?(" "+a[s+2]).slice(1):"";switch(b){case"PLAYLIST-TYPE":l.type=A.toUpperCase();break;case"MEDIA-SEQUENCE":c=l.startSN=parseInt(A);break;case"SKIP":var L=new K.AttrList(A),k=L.decimalInteger("SKIPPED-SEGMENTS");if(Object(U.isFiniteNumber)(k)){for(var D=l.skippedSegments=k;D--;)u.unshift(null);c+=k}var _=L.enumeratedString("RECENTLY-REMOVED-DATERANGES");_&&(l.recentlyRemovedDateranges=_.split("\t"));break;case"TARGETDURATION":l.targetduration=parseFloat(A);break;case"VERSION":l.version=parseInt(A);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"#":(A||S)&&p.tagList.push(S?[A,S]:[A]);break;case"DIS":g++;case"GAP":p.tagList.push([b]);break;case"BITRATE":p.tagList.push([b,A]);break;case"DISCONTINUITY-SEQ":g=parseInt(A);break;case"KEY":var R=new K.AttrList(A),C=R.enumeratedString("METHOD"),k=R.URI,I=R.hexadecimalInteger("IV"),L=R.enumeratedString("KEYFORMATVERSIONS"),_=R.enumeratedString("KEYID"),R=null==(R=R.enumeratedString("KEYFORMAT"))?"identity":R;if(-1<["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(R)){W.logger.warn("Keyformat "+R+" is not supported from the manifest");continue}if("identity"!==R)continue;C&&(o=V.LevelKey.fromURL(e,k),k&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(C)&&(o.method=C,o.keyFormat=R,_&&(o.keyID=_),L&&(o.keyFormatVersions=L),o.iv=I));break;case"START":I=new K.AttrList(A).decimalFloatingPoint("TIME-OFFSET");Object(U.isFiniteNumber)(I)&&(l.startTimeOffset=I);break;case"MAP":var x=new K.AttrList(A);p.relurl=x.URI,x.BYTERANGE&&p.setByteRange(x.BYTERANGE),p.level=r,p.sn="initSegment",o&&(p.levelkey=o),p.initSegment=null,d=p,y=!0;break;case"SERVER-CONTROL":var w=new K.AttrList(A);l.canBlockReload=w.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=w.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=0<l.canSkipUntil&&w.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=w.optionalFloat("PART-HOLD-BACK",0),l.holdBack=w.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var O=new K.AttrList(A);l.partTarget=O.decimalFloatingPoint("PART-TARGET");break;case"PART":x=(x=l.partList)||(l.partList=[]),w=0<f?x[x.length-1]:void 0,O=f++,w=new j.Part(new K.AttrList(A),p,e,O,w);x.push(w),p.duration+=w.duration;break;case"PRELOAD-HINT":var P=new K.AttrList(A);l.preloadHint=P;break;case"RENDITION-REPORT":P=new K.AttrList(A);l.renditionReports=l.renditionReports||[],l.renditionReports.push(P);break;default:W.logger.warn("line parsed but not handled: "+a)}}else W.logger.warn("No matches on slow regex match for level playlist!")}v&&!v.relurl?(u.pop(),h-=v.duration,l.partList&&(l.fragmentHint=v)):l.partList&&(N(p,v),p.cc=g,l.fragmentHint=p);var F=u.length,M=u[0],B=u[F-1];return 0<(h+=l.skippedSegments*l.targetduration)&&F&&B?(l.averagetargetduration=h/F,F=B.sn,l.endSN="initSegment"===F?0:F,M&&(l.startCC=M.cc,!M.initSegment&&l.fragments.every(function(t){return t.relurl&&(t=t.relurl,z.test(null==(t=null===(t=G.parseURL(t))||void 0===t?void 0:t.path)?"":t))})&&(W.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(p=new j.Fragment(i,e)).relurl=B.relurl,p.level=r,p.sn="initSegment",M.initSegment=p,l.needSidxRanges=!0))):(l.endSN=0,l.startCC=0),l.fragmentHint&&(h+=l.fragmentHint.duration),l.totalduration=h,l.endCC=g,0<m&&function(t,e){for(var r,i=t[e],n=e;n--;){if(!(r=t[n]))return;r.programDateTime=i.programDateTime-1e3*r.duration,i=r}}(u,m),l},f);function f(){}},"./src/loader/playlist-loader.ts":function(t,e,r){"use strict";function h(t,e){t=t.url;return t=void 0===t||0===t.indexOf("data:")?e.url:t}r.r(e);var g=r("./src/polyfills/number.ts"),v=r("./src/events.ts"),p=r("./src/errors.ts"),c=r("./src/utils/logger.ts"),n=r("./src/utils/mp4-tools.ts"),m=r("./src/loader/m3u8-parser.ts"),y=r("./src/types/loader.ts"),E=r("./src/utils/attr-list.ts"),r=((r=i.prototype).registerListeners=function(){var t=this.hls;t.on(v.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(v.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(v.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(v.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},r.unregisterListeners=function(){var t=this.hls;t.off(v.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(v.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(v.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(v.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},r.createInternalLoader=function(t){var e=this.hls.config,r=e.pLoader,i=e.loader,e=new(r||i)(e);return t.loader=e,this.loaders[t.type]=e},r.getInternalLoader=function(t){return this.loaders[t.type]},r.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},r.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},r.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},r.onManifestLoading=function(t,e){e=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:y.PlaylistContextType.MANIFEST,url:e,deliveryDirectives:null})},r.onLevelLoading=function(t,e){var r=e.id,i=e.level,n=e.url,e=e.deliveryDirectives;this.load({id:r,groupId:null,level:i,responseType:"text",type:y.PlaylistContextType.LEVEL,url:n,deliveryDirectives:e})},r.onAudioTrackLoading=function(t,e){var r=e.id,i=e.groupId,n=e.url,e=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:y.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:e})},r.onSubtitleTrackLoading=function(t,e){var r=e.id,i=e.groupId,n=e.url,e=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:y.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:e})},r.load=function(t){var e,r,i,n,a,s=this.hls.config;if(l=this.getInternalLoader(t)){var o=l.context;if(o&&o.url===t.url)return void c.logger.trace("[playlist-loader]: playlist request ongoing");c.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),l.abort()}switch(t.type){case y.PlaylistContextType.MANIFEST:e=s.manifestLoadingMaxRetry,r=s.manifestLoadingTimeOut,i=s.manifestLoadingRetryDelay,n=s.manifestLoadingMaxRetryTimeout;break;case y.PlaylistContextType.LEVEL:case y.PlaylistContextType.AUDIO_TRACK:case y.PlaylistContextType.SUBTITLE_TRACK:e=0,r=s.levelLoadingTimeOut;break;default:e=s.levelLoadingMaxRetry,r=s.levelLoadingTimeOut,i=s.levelLoadingRetryDelay,n=s.levelLoadingMaxRetryTimeout}var l=this.createInternalLoader(t);null!==(o=t.deliveryDirectives)&&void 0!==o&&o.part&&(t.type===y.PlaylistContextType.LEVEL&&null!==t.level?a=this.hls.levels[t.level].details:t.type===y.PlaylistContextType.AUDIO_TRACK&&null!==t.id?a=this.hls.audioTracks[t.id].details:t.type===y.PlaylistContextType.SUBTITLE_TRACK&&null!==t.id&&(a=this.hls.subtitleTracks[t.id].details),a)&&(u=a.partTarget,d=a.targetduration,u&&d&&(r=Math.min(1e3*Math.max(3*u,.8*d),r)));var u={timeout:r,maxRetry:e,retryDelay:i,maxRetryDelay:n,highWaterMark:0},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};l.load(t,u,d)},r.loadsuccess=function(t,e,r,i){if(void 0===i&&(i=null),r.isSidxRequest)return this.handleSidxRequest(t,r),void this.handlePlaylistLoaded(t,e,r,i);this.resetInternalLoader(r.type);var n=t.data;return 0===n.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),void(0<n.indexOf("#EXTINF:")||0<n.indexOf("#EXT-X-TARGETDURATION:")?this.handleTrackOrLevelPlaylist(t,e,r,i):this.handleMasterPlaylist(t,e,r,i))):void this.handleManifestParsingError(t,r,"no EXTM3U delimiter",i)},r.loaderror=function(t,e,r){this.handleNetworkError(e,r=void 0===r?null:r,!1,t)},r.loadtimeout=function(t,e,r){this.handleNetworkError(e,r=void 0===r?null:r,!0)},r.handleMasterPlaylist=function(t,e,r,i){var n,a=this.hls,s=t.data,o=h(t,r),l=m.default.parseMasterPlaylist(s,o),u=l.levels,d=l.sessionData;u.length?(n=u.map(function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}}),l=u.map(function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}}),n=m.default.parseMasterPlaylistMedia(s,o,"AUDIO",n),l=m.default.parseMasterPlaylistMedia(s,o,"SUBTITLES",l),s=m.default.parseMasterPlaylistMedia(s,o,"CLOSED-CAPTIONS"),n.length&&(n.some(function(t){return!t.url})||!u[0].audioCodec||u[0].attrs.AUDIO||(c.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new E.AttrList({}),bitrate:0,url:""}))),a.trigger(v.Events.MANIFEST_LOADED,{levels:u,audioTracks:n,subtitles:l,captions:s,url:o,stats:e,networkDetails:i,sessionData:d})):this.handleManifestParsingError(t,r,"no level found in manifest",i)},r.handleTrackOrLevelPlaylist=function(t,e,r,i){var n,a,s=this.hls,o=r.id,l=r.level,u=r.type,d=h(t,r),c=Object(g.isFiniteNumber)(o)?o:0,f=Object(g.isFiniteNumber)(l)?l:c,n=(n=r.type)===y.PlaylistContextType.AUDIO_TRACK?y.PlaylistLevelType.AUDIO:n===y.PlaylistContextType.SUBTITLE_TRACK?y.PlaylistLevelType.SUBTITLE:y.PlaylistLevelType.MAIN,c=m.default.parseLevelPlaylist(t.data,d,f,n,c);c.fragments.length?(u===y.PlaylistContextType.MANIFEST&&(a={attrs:new E.AttrList({}),bitrate:0,details:c,name:"",url:d},s.trigger(v.Events.MANIFEST_LOADED,{levels:[a],audioTracks:[],url:d,stats:e,networkDetails:i,sessionData:null})),e.parsing.end=performance.now(),c.needSidxRanges?(a=null===(a=c.fragments[0].initSegment)||void 0===a?void 0:a.url,this.load({url:a,isSidxRequest:!0,type:u,level:l,levelDetails:c,id:o,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})):(r.levelDetails=c,this.handlePlaylistLoaded(t,e,r,i))):s.trigger(v.Events.ERROR,{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:d,reason:"no fragments found in level",level:"number"==typeof r.level?r.level:void 0})},r.handleSidxRequest=function(t,e){var r,i=Object(n.parseSegmentIndex)(new Uint8Array(t.data));i&&(t=i.references,r=e.levelDetails,t.forEach(function(t,e){t=t.info,e=r.fragments[e];0===e.byteRange.length&&e.setByteRange(1+t.end-t.start+"@"+t.start),e.initSegment&&e.initSegment.setByteRange(i.moovEndOffset+"@0")}))},r.handleManifestParsingError=function(t,e,r,i){this.hls.trigger(v.Events.ERROR,{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===y.PlaylistContextType.MANIFEST,url:t.url,reason:r,response:t,context:e,networkDetails:i})},r.handleNetworkError=function(t,e,r,i){c.logger.warn("[playlist-loader]: A network "+((r=void 0===r?!1:r)?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var n=p.ErrorDetails.UNKNOWN,a=!1,s=this.getInternalLoader(t);switch(t.type){case y.PlaylistContextType.MANIFEST:n=r?p.ErrorDetails.MANIFEST_LOAD_TIMEOUT:p.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case y.PlaylistContextType.LEVEL:n=r?p.ErrorDetails.LEVEL_LOAD_TIMEOUT:p.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case y.PlaylistContextType.AUDIO_TRACK:n=r?p.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:p.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;case y.PlaylistContextType.SUBTITLE_TRACK:n=r?p.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:p.ErrorDetails.SUBTITLE_LOAD_ERROR,a=!1}s&&this.resetInternalLoader(t.type);e={type:p.ErrorTypes.NETWORK_ERROR,details:n,fatal:a,url:t.url,loader:s,context:t,networkDetails:e};i&&(e.response=i),this.hls.trigger(v.Events.ERROR,e)},r.handlePlaylistLoaded=function(t,e,r,i){var n=r.type,a=r.level,s=r.id,o=r.groupId,l=r.loader,u=r.levelDetails,d=r.deliveryDirectives;return null!=u&&u.targetduration?void(l&&(u.live&&(l.getCacheAge&&(u.ageHeader=l.getCacheAge()||0),l.getCacheAge&&!isNaN(u.ageHeader)||(u.ageHeader=0)),n===y.PlaylistContextType.MANIFEST||n===y.PlaylistContextType.LEVEL?this.hls.trigger(v.Events.LEVEL_LOADED,{details:u,level:a||0,id:s||0,stats:e,networkDetails:i,deliveryDirectives:d}):n===y.PlaylistContextType.AUDIO_TRACK?this.hls.trigger(v.Events.AUDIO_TRACK_LOADED,{details:u,id:s||0,groupId:o||"",stats:e,networkDetails:i,deliveryDirectives:d}):n===y.PlaylistContextType.SUBTITLE_TRACK&&this.hls.trigger(v.Events.SUBTITLE_TRACK_LOADED,{details:u,id:s||0,groupId:o||"",stats:e,networkDetails:i,deliveryDirectives:d}))):void this.handleManifestParsingError(t,r,"invalid target duration",i)},i);function i(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}e.default=r},"./src/polyfills/number.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"isFiniteNumber",function(){return i}),r.d(e,"MAX_SAFE_INTEGER",function(){return n});var i=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},n=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(t,e,r){"use strict";r.r(e);i.getSilentFrame=function(t,e){if("mp4a.40.2"===t)return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):void 0;else return 1===e?new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):2===e||3===e?new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):void 0},r=i;function i(){}e.default=r},"./src/remux/mp4-generator.ts":function(t,e,r){"use strict";r.r(e),Math.pow(2,32);c.init=function(){for(var t in c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})c.types.hasOwnProperty(t)&&(c.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);c.HDLR_TYPES={video:e,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);c.STTS=c.STSC=c.STCO=n,c.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),c.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),c.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),c.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);e=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),n=new Uint8Array([0,0,0,1]);c.FTYP=c.box(c.types.ftyp,e,n,e,r),c.DINF=c.box(c.types.dinf,c.box(c.types.dref,i))},c.box=function(t){for(var e=8,r=arguments.length,i=Array(1<r?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(var a=i.length,s=a;a--;)e+=i[a].byteLength;var o=new Uint8Array(e);for(o[0]=255&e>>24,o[1]=255&e>>16,o[2]=255&e>>8,o[3]=255&e,o.set(t,4),a=0,e=8;a<s;a++)o.set(i[a],e),e+=i[a].byteLength;return o},c.hdlr=function(t){return c.box(c.types.hdlr,c.HDLR_TYPES[t])},c.mdat=function(t){return c.box(c.types.mdat,t)},c.mdhd=function(t,e){e*=t;var r=Math.floor(e/4294967296),e=Math.floor(e%4294967296);return c.box(c.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&t>>24,255&t>>16,255&t>>8,255&t,r>>24,255&r>>16,255&r>>8,255&r,e>>24,255&e>>16,255&e>>8,255&e,85,196,0,0]))},c.mdia=function(t){return c.box(c.types.mdia,c.mdhd(t.timescale,t.duration),c.hdlr(t.type),c.minf(t))},c.mfhd=function(t){return c.box(c.types.mfhd,new Uint8Array([0,0,0,0,t>>24,255&t>>16,255&t>>8,255&t]))},c.minf=function(t){return"audio"===t.type?c.box(c.types.minf,c.box(c.types.smhd,c.SMHD),c.DINF,c.stbl(t)):c.box(c.types.minf,c.box(c.types.vmhd,c.VMHD),c.DINF,c.stbl(t))},c.moof=function(t,e,r){return c.box(c.types.moof,c.mfhd(t),c.traf(r,e))},c.moov=function(t){for(var e=t.length,r=[];e--;)r[e]=c.trak(t[e]);return c.box.apply(null,[c.types.moov,c.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(c.mvex(t)))},c.mvex=function(t){for(var e=t.length,r=[];e--;)r[e]=c.trex(t[e]);return c.box.apply(null,[c.types.mvex].concat(r))},c.mvhd=function(t,e){e*=t;var r=Math.floor(e/4294967296),e=Math.floor(e%4294967296),e=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&t>>24,255&t>>16,255&t>>8,255&t,r>>24,255&r>>16,255&r>>8,255&r,e>>24,255&e>>16,255&e>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return c.box(c.types.mvhd,e)},c.sdtp=function(t){for(var e,r=t.samples||[],i=new Uint8Array(4+r.length),n=0;n<r.length;n++)e=r[n].flags,i[n+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return c.box(c.types.sdtp,i)},c.stbl=function(t){return c.box(c.types.stbl,c.stsd(t),c.box(c.types.stts,c.STTS),c.box(c.types.stsc,c.STSC),c.box(c.types.stsz,c.STSZ),c.box(c.types.stco,c.STCO))},c.avc1=function(t){for(var e,r,i=[],n=[],a=0;a<t.sps.length;a++)r=(e=t.sps[a]).byteLength,i.push(255&r>>>8),i.push(255&r),i=i.concat(Array.prototype.slice.call(e));for(a=0;a<t.pps.length;a++)r=(e=t.pps[a]).byteLength,n.push(255&r>>>8),n.push(255&r),n=n.concat(Array.prototype.slice.call(e));var s=c.box(c.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(n))),o=t.width,l=t.height,u=t.pixelRatio[0],d=t.pixelRatio[1];return c.box(c.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255&o>>8,255&o,255&l>>8,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,c.box(c.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),c.box(c.types.pasp,new Uint8Array([u>>24,255&u>>16,255&u>>8,255&u,d>>24,255&d>>16,255&d>>8,255&d])))},c.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},c.mp4a=function(t){var e=t.samplerate;return c.box(c.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,255&e>>8,255&e,0,0]),c.box(c.types.esds,c.esds(t)))},c.mp3=function(t){var e=t.samplerate;return c.box(c.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,255&e>>8,255&e,0,0]))},c.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?c.box(c.types.stsd,c.STSD,c.mp4a(t)):c.box(c.types.stsd,c.STSD,c.mp3(t)):c.box(c.types.stsd,c.STSD,c.avc1(t))},c.tkhd=function(t){var e=t.id,r=t.duration*t.timescale,i=t.width,n=t.height,t=Math.floor(r/4294967296),r=Math.floor(r%4294967296);return c.box(c.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&e>>24,255&e>>16,255&e>>8,255&e,0,0,0,0,t>>24,255&t>>16,255&t>>8,255&t,r>>24,255&r>>16,255&r>>8,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,255&i>>8,255&i,0,0,255&n>>8,255&n,0,0]))},c.traf=function(t,e){var r=c.sdtp(t),i=t.id,n=Math.floor(e/4294967296),e=Math.floor(e%4294967296);return c.box(c.types.traf,c.box(c.types.tfhd,new Uint8Array([0,0,0,0,i>>24,255&i>>16,255&i>>8,255&i])),c.box(c.types.tfdt,new Uint8Array([1,0,0,0,n>>24,255&n>>16,255&n>>8,255&n,e>>24,255&e>>16,255&e>>8,255&e])),c.trun(t,r.length+16+20+8+16+8+8),r)},c.trak=function(t){return t.duration=t.duration||4294967295,c.box(c.types.trak,c.tkhd(t),c.mdia(t))},c.trex=function(t){t=t.id;return c.box(c.types.trex,new Uint8Array([0,0,0,0,t>>24,255&t>>16,255&t>>8,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},c.trun=function(t,e){var r,i,n,a,s,o=t.samples||[],l=o.length,t=12+16*l,u=new Uint8Array(t);for(u.set([0,0,15,1,255&l>>>24,255&l>>>16,255&l>>>8,255&l,255&(e+=8+t)>>>24,255&e>>>16,255&e>>>8,255&e],0),r=0;r<l;r++)i=(s=o[r]).duration,n=s.size,a=s.flags,s=s.cts,u.set([255&i>>>24,255&i>>>16,255&i>>>8,255&i,255&n>>>24,255&n>>>16,255&n>>>8,255&n,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,255&s>>>24,255&s>>>16,255&s>>>8,255&s],12+16*r);return c.box(c.types.trun,u)},c.initSegment=function(t){c.types||c.init();var e=c.moov(t),t=new Uint8Array(c.FTYP.byteLength+e.byteLength);return t.set(c.FTYP),t.set(e,c.FTYP.byteLength),t},r=c;function c(){}r.types=void 0,r.HDLR_TYPES=void 0,r.STTS=void 0,r.STSC=void 0,r.STCO=void 0,r.STSZ=void 0,r.VMHD=void 0,r.SMHD=void 0,r.STSD=void 0,r.FTYP=void 0,r.DINF=void 0,e.default=r},"./src/remux/mp4-remuxer.ts":function(t,e,r){"use strict";function W(){return(W=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)}function Y(t,e){var r;if(null===e)return t;for(r=e<t?-8589934592:8589934592;4294967296<Math.abs(t-e);)t+=r;return t}r.r(e),r.d(e,"default",function(){return i}),r.d(e,"normalizePts",function(){return Y});var f=r("./src/polyfills/number.ts"),B=r("./src/remux/aac-helper.ts"),q=r("./src/remux/mp4-generator.ts"),z=r("./src/events.ts"),X=r("./src/errors.ts"),Q=r("./src/utils/logger.ts"),A=r("./src/types/loader.ts"),$=r("./src/utils/timescale-conversion.ts"),Z=null,a=null,J=!1,i=((r=s.prototype).destroy=function(){},r.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},r.resetNextTimestamp=function(){this.isVideoContiguous=!1,this.isAudioContiguous=!1},r.resetInitSegment=function(){this.ISGenerated=!1},r.getVideoStartPts=function(t){var i=!1,t=t.reduce(function(t,e){var r=e.pts-t;return r<-4294967296?(i=!0,Y(t,e.pts)):0<r?t:e.pts},t[0].pts);return i&&Q.logger.debug("PTS rollover detected"),t},r.remux=function(t,e,r,i,n,a,s,o){var l,u,d,c,f,h,g,v=n,p=n,m=-1<t.pid,y=-1<e.pid,E=e.samples.length,T=0<t.samples.length,b=1<E;return(m&&!T||y&&!b)&&!this.ISGenerated&&!s||(this.ISGenerated||(u=this.generateIS(t,e,n)),h=this.isVideoContiguous,m=-1,b&&(m=function(t){for(var e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!h&&this.config.forceKeyFrameOnDiscontinuity)&&(f=!0,0<m?(Q.logger.warn("[mp4-remuxer]: Dropped "+m+" out of "+E+" video samples due to a missing keyframe"),s=this.getVideoStartPts(e.samples),e.samples=e.samples.slice(m),e.dropped+=m,p+=(e.samples[0].pts-s)/(e.timescale||9e4)):-1===m&&(Q.logger.warn("[mp4-remuxer]: No keyframe found out of "+E+" video samples"),f=!1)),this.ISGenerated&&(T&&b&&(E=this.getVideoStartPts(e.samples),E=(Y(t.samples[0].pts,E)-E)/e.inputTimeScale,v+=Math.max(0,E),p+=Math.max(0,-E)),T?(t.samplerate||(Q.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(t,e,n)),l=this.remuxAudio(t,v,this.isAudioContiguous,a,y||b||o===A.PlaylistLevelType.AUDIO?p:void 0),b&&(g=l?l.endPTS-l.startPTS:0,e.inputTimeScale||(Q.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(t,e,n)),g=this.remuxVideo(e,p,h,g))):b&&(g=this.remuxVideo(e,p,h,0)),g&&(g.firstKeyFrame=m,g.independent=-1!==m))),this.ISGenerated&&(r.samples.length&&(c=this.remuxID3(r,n)),i.samples.length&&(d=this.remuxText(i,n))),{audio:l,video:g,initSegment:u,independent:f,text:d,id3:c}},r.generateIS=function(t,e,r){var i,n,a,s=t.samples,o=e.samples,l=this.typeSupported,u={},d=!Object(f.isFiniteNumber)(this._initPTS),c="audio/mp4";return d&&(a=n=1/0),t.config&&s.length&&(t.timescale=t.samplerate,t.isAAC||(l.mpeg?(c="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),u.audio={id:"audio",container:c,codec:t.codec,initSegment:!t.isAAC&&l.mpeg?new Uint8Array(0):q.default.initSegment([t]),metadata:{channelCount:t.channelCount}},d&&(i=t.inputTimeScale,a=n=s[0].pts-Math.round(i*r))),e.sps&&e.pps&&o.length&&(e.timescale=e.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:q.default.initSegment([e]),metadata:{width:e.width,height:e.height}},d)&&(i=e.inputTimeScale,e=this.getVideoStartPts(o),r=Math.round(i*r),n=Math.min(n,Y(o[0].dts,e)-r),a=Math.min(a,e-r)),Object.keys(u).length?(this.ISGenerated=!0,d&&(this._initPTS=a,this._initDTS=n),{tracks:u,initPTS:a,timescale:i}):void 0},r.remuxVideo=function(t,e,r,i){var n,a=t.inputTimeScale,s=t.samples,o=[],l=s.length,u=this._initPTS,d=this.nextAvcDts,c=8,f=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,g=0,v=!1;r&&null!==d||(d=e*a-(s[0].pts-Y(s[0].dts,s[0].pts)));for(var p,m=0;m<l;m++)(p=s[m]).pts=Y(p.pts-u,d),p.dts=Y(p.dts-u,d),p.dts>p.pts&&(g=Math.max(Math.min(g,p.pts-p.dts),-18e3)),p.dts<s[0<m?m-1:m].dts&&(v=!0);v&&s.sort(function(t,e){var r=t.dts-e.dts,e=t.pts-e.pts;return r||e}),y=s[0].dts;var y,e=s[s.length-1].dts,E=Math.round((e-y)/(l-1));if(g<0){if(g<-2*E){Q.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object($.toMsFromMpegTsClock)(-E,!0)+" ms");for(var T=g,b=0;b<l;b++)s[b].dts=T=Math.max(T,s[b].pts-E),s[b].pts=Math.max(T,s[b].pts)}else{Q.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object($.toMsFromMpegTsClock)(g,!0)+" ms to overcome this issue");for(var A=0;A<l;A++)s[A].dts+=g}y=s[0].dts}!r||((r=E<(w=y-d))||w<-1)&&(r?Q.logger.warn("AVC: "+Object($.toMsFromMpegTsClock)(w,!0)+" ms ("+w+"dts) hole between fragments detected, filling it"):Q.logger.warn("AVC: "+Object($.toMsFromMpegTsClock)(-w,!0)+" ms ("+w+"dts) overlapping between fragments detected"),y=d,r=s[0].pts-w,s[0].dts=y,s[0].pts=r,Q.logger.log("Video: First PTS/DTS adjusted: "+Object($.toMsFromMpegTsClock)(r,!0)+"/"+Object($.toMsFromMpegTsClock)(y,!0)+", delta: "+Object($.toMsFromMpegTsClock)(w,!0)+" ms")),J&&(y=Math.max(0,y));for(var S=0,L=0,k=0;k<l;k++){for(var D=s[k],_=D.units,R=_.length,C=0,I=0;I<R;I++)C+=_[I].data.length;L+=C,S+=R,D.length=C,D.dts=Math.max(D.dts,y),D.pts=Math.max(D.pts,D.dts,0),f=Math.min(D.pts,f),h=Math.max(D.pts,h)}e=s[l-1].dts;var x,w=L+4*S+8;try{x=new Uint8Array(w)}catch(t){return void this.observer.emit(z.Events.ERROR,z.Events.ERROR,{type:X.ErrorTypes.MUX_ERROR,details:X.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:w,reason:"fail allocating video mdat "+w})}var O=new DataView(x.buffer);O.setUint32(0,w),x.set(q.default.types.mdat,4);for(var P=0;P<l;P++){for(var F,M,B=s[P],N=B.units,U=0,G=0,j=N.length;G<j;G++){var H=N[G],V=H.data,H=H.data.byteLength;O.setUint32(c,H),c+=4,x.set(V,c),c+=H,U+=4+H}P<l-1?n=s[P+1].dts-B.dts:(F=this.config,K=B.dts-s[0<P?P-1:P].dts,F.stretchShortVideoTrack&&null!==this.nextAudioPts&&Math.floor(F.maxBufferHole*a)<(M=(i?f+i*a:this.nextAudioPts)-B.pts)?((n=M-K)<0&&(n=K),Q.logger.log("[mp4-remuxer]: It is approximately "+M/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=K);var K=Math.round(B.pts-B.dts);o.push(new tt(B.key,n,U,K))}o.length&&Z&&Z<70&&((w=o[0].flags).dependsOn=2,w.isNonSync=0),console.assert(void 0!==n,"mp4SampleDuration must be computed"),this.nextAvcDts=d=e+n,this.isVideoContiguous=!0;e={data1:q.default.moof(t.sequenceNumber++,y,W({},t,{samples:o})),data2:x,startPTS:f/a,endPTS:(h+n)/a,startDTS:y/a,endDTS:d/a,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(x.length,"MDAT length must not be zero"),e},r.remuxAudio=function(t,e,r,i,n){var a=t.inputTimeScale,s=a/(t.samplerate||a),o=t.isAAC?1024:1152,l=o*s,u=this._initPTS,d=!t.isAAC&&this.typeSupported.mpeg,c=[],f=t.samples,h=d?0:8,g=this.nextAudioPts||-1,v=e*a;if(this.isAudioContiguous=r=r||f.length&&0<g&&(i&&Math.abs(v-g)<9e3||Math.abs(Y(f[0].pts-u,v)-g)<20*l),f.forEach(function(t){t.pts=Y(t.pts-u,v)}),!r||g<0){if(!(f=f.filter(function(t){return 0<=t.pts})).length)return;g=0===n?0:i?Math.max(0,v):f[0].pts}if(t.isAAC)for(var p=void 0!==n,m=this.config.maxAudioFramesDrift,y=0,E=g;y<f.length;y++){var T=f[y],b=T.pts,A=b-E,S=Math.abs(1e3*A/a);if(A<=-m*l&&p)0===y&&(Q.logger.warn("Audio frame @ "+(b/a).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*A/a)+" ms."),this.nextAudioPts=g=E=b);else if(m*l<=A&&S<1e4&&p){var L=Math.round(A/l);(E=b-L*l)<0&&(L--,E+=l),0===y&&(this.nextAudioPts=g=E),Q.logger.warn("[mp4-remuxer]: Injecting "+L+" audio frame @ "+(E/a).toFixed(3)+"s due to "+Math.round(1e3*A/a)+" ms gap.");for(var k=0;k<L;k++){var D=Math.max(E,0),_=B.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);_||(Q.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),_=T.unit.subarray()),f.splice(y,0,{unit:_,pts:D}),E+=l,y++}}T.pts=E,E+=l}for(var R,C=null,I=null,x=0,w=f.length;w--;)x+=f[w].unit.byteLength;for(var O=0,P=f.length;O<P;O++){var F=f[O],M=F.unit,F=F.pts;if(null!==I)c[O-1].duration=Math.round((F-I)/s);else{if(C=F=r&&t.isAAC?g:F,!(0<x))return;x+=h;try{R=new Uint8Array(x)}catch(t){return void this.observer.emit(z.Events.ERROR,z.Events.ERROR,{type:X.ErrorTypes.MUX_ERROR,details:X.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:x,reason:"fail allocating audio mdat "+x})}d||(new DataView(R.buffer).setUint32(0,x),R.set(q.default.types.mdat,4))}R.set(M,h);M=M.byteLength;h+=M,c.push(new tt(!0,o,M,0)),I=F}e=c.length;if(e){i=c[c.length-1];this.nextAudioPts=g=I+s*i.duration;n=C/a,i=g/a,e={data1:d?new Uint8Array(0):q.default.moof(t.sequenceNumber++,C/s,W({},t,{samples:c})),data2:R,startPTS:n,endPTS:i,startDTS:n,endDTS:i,type:"audio",hasAudio:!0,hasVideo:!(t.samples=[]),nb:e};return this.isAudioContiguous=!0,console.assert(R.length,"MDAT length must not be zero"),e}},r.remuxEmptyAudio=function(t,e,r,i){var n=t.inputTimeScale,a=n/(t.samplerate||n),s=this.nextAudioPts,o=(null===s?i.startDTS*n:s)+this._initDTS,n=i.endDTS*n+this._initDTS,l=1024*a,u=Math.ceil((n-o)/l),d=B.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(Q.logger.warn("[mp4-remuxer]: remux empty Audio"),d){for(var c,f=[],h=0;h<u;h++)f.push({unit:d,pts:c=o+h*l,dts:c});return t.samples=f,this.remuxAudio(t,e,r,!1)}Q.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},r.remuxID3=function(t,e){var r=t.samples.length;if(r){for(var i,n=t.inputTimeScale,a=this._initPTS,s=this._initDTS,o=0;o<r;o++)(i=t.samples[o]).pts=Y(i.pts-a,e*n)/n,i.dts=Y(i.dts-s,e*n)/n;var l=t.samples;return t.samples=[],{samples:l}}},r.remuxText=function(t,e){var r=t.samples.length;if(r){for(var i,n=t.inputTimeScale,a=this._initPTS,s=0;s<r;s++)(i=t.samples[s]).pts=Y(i.pts-a,e*n)/n;t.samples.sort(function(t,e){return t.pts-e.pts});var o=t.samples;return t.samples=[],{samples:o}}},s),tt=function(t,e,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=r,this.cts=i,this.flags=new n(t)},n=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1};function s(t,e,r,i){var n;void 0===i&&(i=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=r,this.ISGenerated=!1,null===Z&&(n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),Z=n?parseInt(n[1]):0),null===a&&(n=navigator.userAgent.match(/Safari\/(\d+)/i),a=n?parseInt(n[1]):0),J=!!Z&&Z<75||!!a&&a<600}},"./src/remux/passthrough-remuxer.ts":function(t,e,r){"use strict";function a(t,e){t=null==t?void 0:t.codec;return t&&4<t.length?t:"hvc1"===t?"hvc1.1.c.L120.90":"av01"===t?"av01.0.04M.08":"avc1"===t||e===s.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}r.r(e);var c=r("./src/polyfills/number.ts"),f=r("./src/utils/mp4-tools.ts"),s=r("./src/loader/fragment.ts"),h=r("./src/utils/logger.ts"),r=((r=i.prototype).destroy=function(){},r.resetTimeStamp=function(t){this.initPTS=t,this.lastEndDTS=null},r.resetNextTimestamp=function(){this.lastEndDTS=null},r.resetInitSegment=function(t,e,r){this.audioCodec=e,this.videoCodec=r,this.generateInitSegment(t),this.emitInitSegment=!0},r.generateInitSegment=function(t){var e=this.audioCodec,r=this.videoCodec;if(!t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=Object(f.parseInitSegment)(t),e=e||a(i.audio,s.ElementaryStreamTypes.AUDIO),r=r||a(i.video,s.ElementaryStreamTypes.VIDEO),n={};i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:e+","+r,initSegment:t,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,initSegment:t,id:"main"}:h.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n},r.remux=function(t,e,r,i,n){var a=this.initPTS,s=this.lastEndDTS,o={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};Object(c.isFiniteNumber)(s)||(s=this.lastEndDTS=n||0);var l=e.samples;if(!l||!l.length)return o;var u={initPTS:void 0,timescale:1},d=this.initData;if(d&&d.length||(this.generateInitSegment(l),d=this.initData),!d||!d.length)return h.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),o;this.emitInitSegment&&(u.tracks=this.initTracks,this.emitInitSegment=!1),Object(c.isFiniteNumber)(a)||(this.initPTS=u.initPTS=a=g(d,l,s));n=Object(f.getDuration)(l,d),e=s,s=n+e;Object(f.offsetStartDTS)(d,l,a),0<n?this.lastEndDTS=s:(h.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());a=!!d.audio,n=!!d.video,d="";a&&(d+="audio"),n&&(d+="video");n={data1:l,startPTS:e,startDTS:e,endPTS:s,endDTS:s,type:d,hasAudio:a,hasVideo:n,nb:1,dropped:0};return o.audio="audio"===n.type?n:void 0,o.video="audio"===n.type?void 0:n,o.text=i,o.id3=r,o.initSegment=u,o},i),g=function(t,e,r){return Object(f.getStartDTS)(t,e)-r};function i(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}e.default=r},"./src/task-loop.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i});var i=((e=n.prototype).destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.onHandlerDestroyed=function(){},e.hasInterval=function(){return!!this._tickInterval},e.hasNextTick=function(){return!!this._tickTimer},e.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},e.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),!(this._tickInterval=null))},e.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),!(this._tickTimer=null))},e.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&this.tickImmediate(),this._tickCallCount=0)},e.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},e.doTick=function(){},n);function n(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}},"./src/types/level.ts":function(t,e,r){"use strict";function i(t,e){for(var r,i=0;i<e.length;i++)(r=e[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}function n(t,e){var r=t.canSkipUntil,i=t.canSkipDateRanges,t=t.endSN;return r&&(void 0===e?0:e-t)<r?i?a.v2:a.Yes:a.No}var a;r.r(e),r.d(e,"HlsSkip",function(){return a}),r.d(e,"getSkipValue",function(){return n}),r.d(e,"HlsUrlParameters",function(){return s}),r.d(e,"Level",function(){return o}),(e=a=a||{}).No="",e.Yes="YES",e.v2="v2";var s=(u.prototype.addDirectives=function(t){t=new self.URL(t);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.toString()},u),o=(i(l.prototype,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){t%=this.url.length;this._urlId!==t&&(this.details=void 0,this._urlId=t)}}]),l);function l(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(t){return t}).join(",").replace(/\.[^.,]+/g,"")}function u(t,e,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=r}},"./src/types/loader.ts":function(t,e,r){"use strict";var i,n;r.r(e),r.d(e,"PlaylistContextType",function(){return i}),r.d(e,"PlaylistLevelType",function(){return n}),(e=i=i||{}).MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack",(e=n=n||{}).MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"ChunkMetadata",function(){return i});var i=function(t,e,r,i,n,a){void 0===i&&(i=0),void 0===n&&(n=-1),void 0===a&&(a=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=r,this.size=i,this.part=n,this.partial=a}},"./src/utils/attr-list.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"AttrList",function(){return a});var i=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,a=((e=s.prototype).decimalInteger=function(t){t=parseInt(this[t],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.hexadecimalInteger=function(t){if(this[t]){for(var e=(1&(e=(this[t]||"0x").slice(2)).length?"0":"")+e,r=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)r[i]=parseInt(e.slice(2*i,2*i+2),16);return r}return null},e.hexadecimalIntegerAsNumber=function(t){t=parseInt(this[t],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.decimalFloatingPoint=function(t){return parseFloat(this[t])},e.optionalFloat=function(t,e){t=this[t];return t?parseFloat(t):e},e.enumeratedString=function(t){return this[t]},e.bool=function(t){return"YES"===this[t]},e.decimalResolution=function(t){t=i.exec(this[t]);return null===t?void 0:{width:parseInt(t[1],10),height:parseInt(t[2],10)}},s.parseAttrList=function(t){var e,r={};for(n.lastIndex=0;null!==(e=n.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[e[1]]=i}return r},s);function s(t){for(var e in t="string"==typeof t?s.parseAttrList(t):t)t.hasOwnProperty(e)&&(this[e]=t[e])}},"./src/utils/binary-search.ts":function(t,e,r){"use strict";r.r(e),e.default={search:function(t,e){for(var r,i,n=0,a=t.length-1;n<=a;){var s=e(i=t[r=0|(n+a)/2]);if(0<s)n=1+r;else{if(!(s<0))return i;a=r-1}}return null}}},"./src/utils/buffer-helper.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"BufferHelper",function(){return a});var i=r("./src/utils/logger.ts"),n={length:0,start:function(){return 0},end:function(){return 0}},a=(s.isBuffered=function(t,e){try{if(t)for(var r=s.getBuffered(t),i=0;i<r.length;i++)if(e>=r.start(i)&&e<=r.end(i))return!0}catch(t){}return!1},s.bufferInfo=function(t,e,r){try{if(t){for(var i=s.getBuffered(t),n=[],a=0;a<i.length;a++)n.push({start:i.start(a),end:i.end(a)});return this.bufferedInfo(n,e,r)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},s.bufferedInfo=function(t,e,r){t.sort(function(t,e){return t.start-e.start||e.end-t.end});var i,n=[];if(r)for(var a,s=0;s<t.length;s++)(a=n.length)?(i=n[a-1].end,t[s].start-i<r?t[s].end>i&&(n[a-1].end=t[s].end):n.push(t[s])):n.push(t[s]);else n=t;for(var o,l=0,u=e,d=e,c=0;c<n.length;c++){var f=n[c].start,h=n[c].end;if(f<=e+r&&e<h)u=f,l=(d=h)-e;else if(e+r<f){o=f;break}}return{len:l,start:u||0,end:d||0,nextStart:o}},s.getBuffered=function(t){try{return t.buffered}catch(t){return i.logger.log("failed to get media.buffered",t),n}},s);function s(){}},"./src/utils/codecs.ts":function(t,e,r){"use strict";function i(t,e){e=a[e];return!!e&&!0===e[t.slice(0,4)]}function n(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}r.r(e),r.d(e,"isCodecType",function(){return i}),r.d(e,"isCodecSupportedInMp4",function(){return n});var a={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}}},"./src/utils/discontinuities.ts":function(t,e,r){"use strict";function i(t,e){for(var r,i=null,n=0,a=t.length;n<a;n++)if((r=t[n])&&r.cc===e){i=r;break}return i}function n(t,e,r){return!(!e.details||!(r.endCC>r.startCC||t&&t.cc<r.startCC))}function a(t,e){t=t.fragments,e=e.fragments;if(e.length&&t.length){e=i(t,e[0].cc);return e&&e.startPTS?e:void c.logger.log("No frag in previous level to align on")}c.logger.log("No fragments to align")}function s(t,e){t&&(e=t.start+e,t.start=t.startPTS=e,t.endPTS=e+t.duration)}function o(t,e){for(var r=e.fragments,i=0,n=r.length;i<n;i++)s(r[i],t);e.fragmentHint&&s(e.fragmentHint,t),e.alignedSliding=!0}function l(t,e,r){var i;e&&(!n(t,e,i=r)||(t=a(e.details,i))&&Object(d.isFiniteNumber)(t.start)&&(c.logger.log("Adjusting PTS using last level due to CC increase within current level "+i.url),o(t.start,i)),!r.alignedSliding&&e.details&&u(r,e.details),r.alignedSliding||!e.details||r.skippedSegments||Object(f.adjustSliding)(e.details,r))}function u(t,e){var r,i;e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime&&(r=e.fragments[0].programDateTime,(e=((i=t.fragments[0].programDateTime)-r)/1e3+e.fragments[0].start)&&Object(d.isFiniteNumber)(e)&&(c.logger.log("Adjusting PTS using programDateTime delta "+(i-r)+"ms, sliding:"+e.toFixed(3)+" "+t.url+" "),o(e,t)))}r.r(e),r.d(e,"findFirstFragWithCC",function(){return i}),r.d(e,"shouldAlignOnDiscontinuities",function(){return n}),r.d(e,"findDiscontinuousReferenceFrag",function(){return a}),r.d(e,"adjustSlidingStart",function(){return o}),r.d(e,"alignStream",function(){return l}),r.d(e,"alignPDT",function(){return u});var d=r("./src/polyfills/number.ts"),c=r("./src/utils/logger.ts"),f=r("./src/controller/level-helper.ts")},"./src/utils/fetch-loader.ts":function(t,e,r){"use strict";function i(t){var r="function"==typeof Map?new Map:void 0;return(i=function(t){function e(){return n(t,arguments,s(this).constructor)}if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a(e,t)})(t)}function n(t,e,r){return(n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);i=new(Function.bind.apply(t,i));return r&&a(i,r.prototype),i}).apply(null,arguments)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}function l(t,e){return new self.Request(t.url,e)}r.r(e),r.d(e,"fetchSupported",function(){return o});var u,d,c=r("./src/polyfills/number.ts"),f=r("./src/loader/load-stats.ts"),h=r("./src/demux/chunk-cache.ts"),g=((d=m.prototype).destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},d.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},d.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},d.load=function(i,n,a){var s=this,o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();var t=function(t){t={method:"GET",mode:"cors",credentials:"same-origin",signal:t};return i.rangeEnd&&(t.headers=new self.Headers({Range:"bytes="+i.rangeStart+"-"+(i.rangeEnd-1)})),t}(this.controller.signal),l=a.onProgress,u="arraybuffer"===i.responseType,d=u?"byteLength":"length";this.context=i,this.config=n,this.callbacks=a,this.request=this.fetchSetup(i,t),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){s.abortInternal(),a.onTimeout(o,i,s.response)},n.timeout),self.fetch(this.request).then(function(t){if((s.response=s.loader=t).ok)return o.loading.first=Math.max(self.performance.now(),o.loading.start),o.total=parseInt(t.headers.get("Content-Length")||"0"),l&&Object(c.isFiniteNumber)(n.highWaterMark)?s.loadProgressively(t,o,i,n.highWaterMark,l):u?t.arrayBuffer():t.text();var e=t.status,r=t.statusText;throw new v(r||"fetch, bad network response",e,t)}).then(function(t){var e=s.response;self.clearTimeout(s.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first),o.loaded=o.total=t[d];var r={url:e.url,data:t};l&&!Object(c.isFiniteNumber)(n.highWaterMark)&&l(o,i,t,e),a.onSuccess(r,o,i,e)}).catch(function(t){var e;self.clearTimeout(s.requestTimeout),o.aborted||(e=t.code||0,a.onError({code:e,text:t.message},i,t.details))})},d.getCacheAge=function(){var t,e=null;return e=this.response?(t=this.response.headers.get("age"))?parseFloat(t):null:e},d.loadProgressively=function(i,n,a,s,o){void 0===s&&(s=0);var l=new h.default,t=i.body.getReader();return function r(){return t.read().then(function(t){if(t.done)return l.dataLength&&o(n,a,l.flush(),i),Promise.resolve(new ArrayBuffer(0));var e=t.value,t=e.length;return n.loaded+=t,t<s||l.dataLength?(l.push(e),l.dataLength>=s&&o(n,a,l.flush(),i)):o(n,a,e,i),r()}).catch(function(){return Promise.reject()})}()},m),v=(u=i(Error),r=u,(d=p).prototype=Object.create(r.prototype),a(d.prototype.constructor=d,r),p);function p(t,e,r){return(t=u.call(this,t)||this).code=void 0,t.details=void 0,t.code=e,t.details=r,t}function m(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||l,this.controller=new self.AbortController,this.stats=new f.LoadStats}e.default=g},"./src/utils/logger.ts":function(t,e,r){"use strict";function i(t){if(self.console&&!0===t||"object"==typeof t){!function(r){for(var t=arguments.length,e=Array(1<t?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];e.forEach(function(t){var e;s[t]=r[t]?r[t].bind(r):(e=t,(t=self.console[e])?t.bind(self.console,"["+e+"] >"):n)})}(t,"debug","log","info","warn","error");try{s.log()}catch(t){s=a}}else s=a}r.r(e),r.d(e,"enableLogs",function(){return i}),r.d(e,"logger",function(){return o});function n(){}var a={trace:n,debug:n,log:n,warn:n,info:n,error:n},s=a,o=a},"./src/utils/mediakeys-helper.ts":function(t,e,r){"use strict";var i;r.r(e),r.d(e,"KeySystems",function(){return i}),r.d(e,"requestMediaKeySystemAccess",function(){return n}),(e=i=i||{}).WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready";var n="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(t,e,r){"use strict";function i(){return self.MediaSource||self.WebKitMediaSource}r.r(e),r.d(e,"getMediaSource",function(){return i})},"./src/utils/mp4-tools.ts":function(t,e,r){"use strict";function u(t){return String.fromCharCode.apply(null,t)}function f(t,e){"data"in t&&(e+=t.start,t=t.data);e=t[e]<<8|t[e+1];return e<0?65536+e:e}function p(t,e){"data"in t&&(e+=t.start,t=t.data);e=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return e<0?4294967296+e:e}function a(t,e,r){"data"in t&&(e+=t.start,t=t.data),t[e]=r>>24,t[e+1]=255&r>>16,t[e+2]=255&r>>8,t[e+3]=255&r}function m(t,e){var r,i,n=[];if(!e.length)return n;for(var a=("data"in t?(r=t.data,i=t.start,t.end):(i=0,(r=t).byteLength)),s=i;s<a;){var o=p(r,s),l=1<o?s+o:a;u(r.subarray(s+4,s+8))===e[0]&&(1===e.length?n.push({data:r,start:s+8,end:l}):(o=m({data:r,start:s+8,end:l},e.slice(1))).length&&h.apply(n,o)),s=l}return n}function y(t){var e=m(t,["moov"])[0],e=e?e.end:null,t=m(t,["sidx"]);if(!t||!t[0])return null;var r=[],i=t[0],t=i.data[0],n=0===t?8:16,a=p(i,n);n+=4,n+=0===t?8:16;var s=i.end+0,o=f(i,n+=2);n+=2;for(var l=0;l<o;l++){var u=n,d=p(i,u);u+=4;var c=2147483647&d;if(1==(2147483648&d)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;d=p(i,u);u+=4,r.push({referenceSize:c,subsegmentDuration:d,info:{duration:d/a,start:s,end:s+c-1}}),s+=c,n=u+=4}return{earliestPresentationTime:0,timescale:a,version:t,referencesCount:o,references:r,moovEndOffset:e}}function i(t){for(var r=[],e=m(t,["moov","trak"]),i=0;i<e.length;i++){var n,a,s,o=e[i],l=m(o,["tkhd"])[0];l&&(n=p(l,0===l.data[l.start]?12:20),(s=m(o,["mdia","mdhd"])[0])&&(a=p(s,0===s.data[s.start]?12:20),(l=m(o,["mdia","hdlr"])[0])&&(s=u(l.data.subarray(l.start+8,l.start+12)),(l={soun:T.ElementaryStreamTypes.AUDIO,vide:T.ElementaryStreamTypes.VIDEO}[s])&&(s=void 0,(o=m(o,["mdia","minf","stbl","stsd"])[0])&&(s=u(o.data.subarray(o.start+12,o.start+16))),r[n]={timescale:a,type:l},r[l]={timescale:a,id:n,codec:s}))))}return m(t,["moov","mvex","trex"]).forEach(function(t){var e=p(t,4),e=r[e];e&&(e.default={duration:p(t,12),flags:p(t,20)})}),r}function n(a,t){return m(t,["moof","traf"]).reduce(function(t,e){var i=m(e,["tfdt"])[0],n=i.data[i.start],e=m(e,["tfhd"]).reduce(function(t,e){var r=p(e,4),e=a[r];if(e){r=p(i,4);1===n&&(r*=Math.pow(2,32),r+=p(i,8));e=r/(e.timescale||9e4);if(isFinite(e)&&(null===t||e<t))return e}return t},null);return null!==e&&isFinite(e)&&(null===t||e<t)?e:t},null)||0}function s(t,e){for(var r,i=0,n=0,a=m(t,["moof","traf"]),s=0;s<a.length;s++){var o=a[s],l=m(o,["tfhd"])[0],u=e[p(l,4)];if(u){var d=u.default,c=p(l,0)|(null==d?void 0:d.flags),f=null==d?void 0:d.duration;8&c&&(f=p(l,2&c?12:8));for(var h=u.timescale||9e4,g=m(o,["trun"]),v=0;v<g.length;v++)r=f?f*p(g[v],4):E(g[v]),u.type===T.ElementaryStreamTypes.VIDEO?i+=r/h:u.type===T.ElementaryStreamTypes.AUDIO&&(n+=r/h)}}if(0===i&&0===n){t=y(t);if(null!=t&&t.references)return t.references.reduce(function(t,e){return t+e.info.duration||0},0)}return i||n}function E(t){var e=p(t,0),r=8;1&e&&(r+=4),4&e&&(r+=4);for(var i=0,n=p(t,4),a=0;a<n;a++)256&e&&(i+=p(t,r),r+=4),512&e&&(r+=4),1024&e&&(r+=4),2048&e&&(r+=4);return i}function o(r,t,n){m(t,["moof","traf"]).forEach(function(e){m(e,["tfhd"]).forEach(function(t){var i,t=p(t,4),t=r[t];t&&(i=t.timescale||9e4,m(e,["tfdt"]).forEach(function(t){var e=t.data[t.start],r=p(t,4);0===e?a(t,4,r-n*i):(r*=Math.pow(2,32),r+=p(t,8),r-=n*i,r=Math.max(r,0),e=Math.floor(r/4294967296),r=Math.floor(r%4294967296),a(t,4,e),a(t,8,r))}))})})}function l(t){var e={valid:null,remainder:null},r=m(t,["moof"]);if(!r)return e;if(r.length<2)return e.remainder=t,e;r=r[r.length-1];return e.valid=Object(c.sliceUint8)(t,0,r.start-8),e.remainder=Object(c.sliceUint8)(t,r.start-8),e}function d(t,e){var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}r.r(e),r.d(e,"bin2str",function(){return u}),r.d(e,"readUint16",function(){return f}),r.d(e,"readUint32",function(){return p}),r.d(e,"writeUint32",function(){return a}),r.d(e,"findBox",function(){return m}),r.d(e,"parseSegmentIndex",function(){return y}),r.d(e,"parseInitSegment",function(){return i}),r.d(e,"getStartDTS",function(){return n}),r.d(e,"getDuration",function(){return s}),r.d(e,"computeRawDurationFromSamples",function(){return E}),r.d(e,"offsetStartDTS",function(){return o}),r.d(e,"segmentValidRange",function(){return l}),r.d(e,"appendUint8Array",function(){return d});var c=r("./src/utils/typed-array.ts"),T=r("./src/loader/fragment.ts"),h=(Math.pow(2,32),[].push)},"./src/utils/texttrack-utils.ts":function(t,e,r){"use strict";function i(t,e){var r;try{r=new Event("addtrack")}catch(t){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)}function n(t,e){var r=t.mode;if("disabled"===r&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(r){l.logger.debug("[texttrack-utils]: "+r);var i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,t.addCue(i)}"disabled"===r&&(t.mode=r)}function a(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(var r=t.cues.length;r--;)t.removeCue(t.cues[r]);"disabled"===e&&(t.mode=e)}function s(t,e,r){var i=t.mode;if("disabled"===i&&(t.mode="hidden"),t.cues&&0<t.cues.length)for(var n=o(t.cues,e,r),a=0;a<n.length;a++)t.removeCue(n[a]);"disabled"===i&&(t.mode=i)}function o(t,e,r){var i=[],n=function(t,e){if(e<t[0].startTime)return 0;var r=t.length-1;if(e>t[r].endTime)return-1;for(var i,n=0,a=r;n<=a;)if(e<t[i=Math.floor((a+n)/2)].startTime)a=i-1;else{if(!(e>t[i].startTime&&n<r))return i;n=i+1}return t[n].startTime-e<e-t[a].startTime?n:a}(t,e);if(-1<n)for(var a,s=n,o=t.length;s<o;s++)if((a=t[s]).startTime>=e&&a.endTime<=r)i.push(a);else if(a.startTime>r)return i;return i}r.r(e),r.d(e,"sendAddTrackEvent",function(){return i}),r.d(e,"addCueToTrack",function(){return n}),r.d(e,"clearCurrentCues",function(){return a}),r.d(e,"removeCuesInRange",function(){return s}),r.d(e,"getCuesInRange",function(){return o});var l=r("./src/utils/logger.ts")},"./src/utils/time-ranges.ts":function(t,e,r){"use strict";r.r(e),e.default={toString:function(t){for(var e="",r=t.length,i=0;i<r;i++)e+="["+t.start(i).toFixed(3)+","+t.end(i).toFixed(3)+"]";return e}}},"./src/utils/timescale-conversion.ts":function(t,e,r){"use strict";function n(t,e,r,i){r=t*e*(r=void 0===r?1:r);return(i=void 0===i?!1:i)?Math.round(r):r}function i(t,e,r,i){return n(t,e,1/(r=void 0===r?1:r),i=void 0===i?!1:i)}function a(t,e){return n(t,1e3,1/9e4,e=void 0===e?!1:e)}function s(t,e){return n(t,9e4,1/(e=void 0===e?1:e))}r.r(e),r.d(e,"toTimescaleFromBase",function(){return n}),r.d(e,"toTimescaleFromScale",function(){return i}),r.d(e,"toMsFromMpegTsClock",function(){return a}),r.d(e,"toMpegTsClockFromTimescale",function(){return s})},"./src/utils/typed-array.ts":function(t,e,r){"use strict";function i(t,e,r){return Uint8Array.prototype.slice?t.slice(e,r):new Uint8Array(Array.prototype.slice.call(t,e,r))}r.r(e),r.d(e,"sliceUint8",function(){return i})},"./src/utils/xhr-loader.ts":function(t,e,r){"use strict";r.r(e);var o=r("./src/utils/logger.ts"),i=r("./src/loader/load-stats.ts"),n=/^age:\s*[\d.]+\s*$/m,r=((r=a.prototype).destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},r.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},r.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},r.load=function(t,e,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=r,this.retryDelay=e.retryDelay,this.loadInternal()},r.loadInternal=function(){var t=this.config,e=this.context;if(t){var r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0;i=this.xhrSetup;try{if(i)try{i(r,e.url)}catch(t){r.open("GET",e.url,!0),i(r,e.url)}r.readyState||r.open("GET",e.url,!0)}catch(t){return void this.callbacks.onError({code:r.status,text:t.message},e,r)}e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),r.send()}},r.readystatechange=function(){var t,e,r,i,n=this.context,a=this.loader,s=this.stats;n&&a&&(r=a.readyState,t=this.config,!s.aborted&&2<=r&&(self.clearTimeout(this.requestTimeout),0===s.loading.first&&(s.loading.first=Math.max(self.performance.now(),s.loading.start)),4===r?(a.onreadystatechange=null,a.onprogress=null,200<=(e=a.status)&&e<300?(s.loading.end=Math.max(self.performance.now(),s.loading.first),r="arraybuffer"===n.responseType?(i=a.response).byteLength:(i=a.responseText).length,s.loaded=s.total=r,this.callbacks&&((r=this.callbacks.onProgress)&&r(s,n,i,a),this.callbacks&&(i={url:a.responseURL,data:i},this.callbacks.onSuccess(i,s,n,a)))):s.retry>=t.maxRetry||400<=e&&e<499?(o.logger.error(e+" while loading "+n.url),this.callbacks.onError({code:e,text:a.statusText},n,a)):(o.logger.warn(e+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,t.maxRetryDelay),s.retry++)):(self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout))))},r.loadtimeout=function(){o.logger.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},r.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},r.getCacheAge=function(){var t,e=null;return e=this.loader&&n.test(this.loader.getAllResponseHeaders())?(t=this.loader.getResponseHeader("age"))?parseFloat(t):null:e},a);function a(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new i.LoadStats,this.retryDelay=0}e.default=r}},i={},n.m=r,n.c=i,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s="./src/hls.ts").default;function n(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var r,i},t.exports=e())}},i={};function n(t){var e=i[t];if(void 0!==e)return e.exports;e=i[t]={exports:{}};return r[t].call(e.exports,e,e.exports,n),e.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};(()=>{"use strict";n.r(a);var t=n(1),e=n(325);t.default.define("engines/hls_video.js",e.default)})()})();
