var Passport={_nickName:"",_pid:null,getNickName:function(){return this._nickName||(this._nickName=this._getCookie("nickname")),this._nickName},getPid:function(){return this._pid||(this._pid=this._getCookie("pid")),this._pid},_getCookie:function(t){var n,t=document.cookie.match(new RegExp("(^| )"+t+"=([^;]*)(;|$)"));if(t){try{n=decodeURIComponent(t[2])}catch(e){n=unescape(t[2]),console.log("error of get cookie -> ",e)}return n}return null},getElById:function(e){return document.getElementById(e)},init:function(){var e,t=this.getElById("NavLoginUserDiv");t&&this.getPid()&&((e=this.getElById("NavLoginDiv"))&&(e.style.display="none"),t.style.display="block",(t=this.getElById("NavNickName"))&&(t.innerHTML=this.getNickName()),this.loadUnReadMsgCount())},loadUnReadMsgCount:function(){var t=this;this.jsonpRequest({url:"http://my.39.net/post.ashx",data:{action:"jsonpmsgcount"},dataType:"jsonp",callback:"callback",success:function(e){0<e.Data?t.addClass(t.getElById("NavUnread"),"unread"):t.removeClass(t.getElById("NavUnread"),"unread")},error:function(){}})},jsonpRequest:function(t){if(!(t=t||{}).url||!t.callback)throw new Error("参数不合法");var n=("jsonp_"+Math.random()).replace(".",""),a=document.getElementsByTagName("head")[0];t.data[t.callback]=n;var e=this.formatParams(t.data),s=document.createElement("script");a.appendChild(s),window[n]=function(e){a.removeChild(s),clearTimeout(s.timer),window[n]=null,t.success&&t.success(e)},s.src=t.url+"?"+e,t.time&&(s.timer=setTimeout(function(){window[n]=null,a.removeChild(s),t.fail&&t.fail({message:"超时"})},time))},formatParams:function(e){var t,n=[];for(t in e)n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n.join("&")},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){this.hasClass(e,t)&&(t=new RegExp("(\\s|^)"+t+"(\\s|$)"),e.className=e.className.replace(t," "))}};Passport.init();
