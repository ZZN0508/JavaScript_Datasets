define("lofty/alicn/suggestion/3.0/core",["lofty/lang/class","lofty/ui/widget/1.0/widget","lofty/util/misc/2.0/misc","lofty/util/template/2.0/tplhandler","jquery"],function(t,e,n,i,a){var r={UP:38,DOWN:40,LEFT:37,RIGHT:39,ENTER:13,ESC:27,BACKSPACE:8},s=n.isIE(),l=t(e,{options:{target:null,dTop:0,dLeft:0,width:0,dWidth:0,delay:300,noInputHandler:null,inputHandler:null,extendClass:"",callback:null},_create:function(){this.render(),this._enable=!0,this.get("noInputHandler")&&"setContext"in this.get("noInputHandler")&&this.get("noInputHandler").setContext(this),this.get("inputHandler")&&"setContext"in this.get("inputHandler")&&this.get("inputHandler").setContext(this),this._calCurrentHandler(),this.resetWidth(),this.resetPosition(),this._bindRenderEvent(),this._bindTargetEvent(),this._bindDocEvent(),this._tokenId=1,this.$sgtCtn=this.get("el").find(".fui-web-suggestion-inner")},_calCurrentHandler:function(){this._currentHandler=null;var t=a.trim(a(this.get("target")).val());this._currentHandler=this.get(""==t?"noInputHandler":"inputHandler")},enable:function(){this._enable=!0},disable:function(){this._enable=!1},_bindDocEvent:function(){var t=this;this.get("el").on("click",function(t){t.stopPropagation()}),a(this.get("target")).on("click",function(t){t.stopPropagation()}),a(document).on("click",function(){t.hide()})},_bindRenderEvent:function(){var t=this;this.on("htmlReady",function(e){e&&e.token==t._tokenId&&(e.html?(t.$sgtCtn.html(e.html),t.show()):t.hide())})},getCurrentHandler:function(){return this._currentHandler},_processHandler:function(t,e){if(this._enable){var n=a(this.get("target"));"onTargetKeyEnter"!=t&&(this._hasShow&&"onTargetInput"!=t||this._calCurrentHandler());var i=a.trim(n.val());t in this._currentHandler&&(this._tokenId++,this._currentHandler[t](this._tokenId,i,e))}},_targetMousedownHandler:function(){this._processHandler("onTargetMouseDown")},_targetInputHandler:function(){this._processHandler("onTargetInput")},_targetEnterHandler:function(){this._processHandler("onTargetHover")},_targetLeaveHandler:function(){this._processHandler("onTargetBlur")},_targetKeyUpHandler:function(t){this._processHandler("onTargetKeyUp",t)},_targetKeyDownHandler:function(t){this._processHandler("onTargetKeyDown",t)},_targetKeyLeftHandler:function(t){this._processHandler("onTargetKeyLeft",t)},_targetKeyRightHandler:function(t){this._processHandler("onTargetKeyRight",t)},_targetKeyEnterHandler:function(t){this._processHandler("onTargetKeyEnter",t)},_sgtShow:function(){this._processHandler("onShow")},_bindTargetEvent:function(){var t=this,e=a(this.get("target"));e.on("mousedown",function(e){t._targetMousedownHandler()}),e.on("keydown",function(e){switch(e.which){case r.ESC:t.hide();break;case r.UP:t._targetKeyUpHandler(e);break;case r.DOWN:t._targetKeyDownHandler(e);break;case r.LEFT:t._targetKeyLeftHandler(e);break;case r.RIGHT:t._targetKeyRightHandler(e);break;case r.ENTER:t._targetKeyEnterHandler(e)}});var n,i,l,o,h=!1,u=this.get("el");if(u.on("mouseenter",function(){i&&(clearTimeout(i),i=null),n&&(clearTimeout(n),n=null),o&&(clearTimeout(o),o=null),l&&clearTimeout(l),h||(l=setTimeout(function(){h=!0,l=null,t._targetEnterHandler()},200))}).on("mouseleave",function(){l&&(clearTimeout(l),l=null),o&&clearTimeout(o),n&&(clearTimeout(n),n=null),i&&(clearTimeout(i),i=null),h&&(o=setTimeout(function(){h=!1,o=null,t._targetLeaveHandler()},200))}),e.on("mouseenter",function(){l&&(clearTimeout(l),l=null),o&&(clearTimeout(o),o=null),i&&(clearTimeout(i),i=null),n&&clearTimeout(n),h||(n=setTimeout(function(){h=!0,n=null,t._targetEnterHandler()},200))}).on("mouseleave",function(){l&&(clearTimeout(l),l=null),o&&(clearTimeout(o),o=null),n&&(clearTimeout(n),n=null),i&&clearTimeout(i),h&&(i=setTimeout(function(){h=!1,i=null,t._targetLeaveHandler()},200))}),s)this.targetLast2Val=e.val(),this.targetLast1Val=void 0,this.valChangeTmId=null,this._listenTargetValChange(e);else{this.inputTmId=null;var g=this.get("delay");e.on("input",function(e){t.inputTmId&&clearTimeout(t.inputTmId),t.inputTmId=setTimeout(function(){t.inputTmId=null,t._targetInputHandler()},g)})}},setTargetValue:function(t){var e=a(this.get("target"));e.val(t),s&&(this.targetLast2Val=t,this.targetLast1Val=void 0);var n=this.get("callback");n&&n(t)},getWidth:function(){return this.width},resetHeight:function(){var t=this.$sgtCtn.height();return this._hasShow&&this.get("el").stop().css({height:t}),t},resetWidth:function(){var t=this.get("width"),e=this.get("el");this.width=t?t+this.get("dWidth"):a(this.get("target")).outerWidth()+this.get("dWidth"),e.width(this.width)},resetPosition:function(){var t=a(this.get("target")),e=t.offset().left,n=t.offset().top,i=t.outerHeight(),r=this.get("dLeft"),s=this.get("dTop"),l=e+r,o=n+i+s;this.get("el").css({top:o,left:l})},show:function(){var t=this.$sgtCtn.height(),e=this;this._hasShow?(this.get("el").stop().css({height:t}),e._sgtShow()):(this._hasShow=!0,this.get("el").animate({height:t},250,function(){e._sgtShow()})),this.trigger("show")},hide:function(){this._hasShow=!1,this.get("el").stop().height(0),this.trigger("hide")},_listenTargetValChange:function(t){var e=this;this.valChangeTmId=setTimeout(function(){e.valChangeTmId=null;var n=t.val();if(n!=e.targetLast2Val){if(void 0===e.targetLast1Val)return e.targetLast1Val=n,void e._listenTargetValChange(t);n===e.targetLast1Val?(e.targetLast2Val=n,e.targetLast1Val=void 0,e._targetInputHandler(),e._listenTargetValChange(t)):(e.targetLast1Val=n,e._listenTargetValChange(t))}else e._listenTargetValChange(t)},this.get("delay")/2)},tpl:'<div class="fui-web-suggestion {{extendClass}}"><div class="fui-web-suggestion-inner"></div></div>',handleTpl:function(){var t={};t.extendClass=this.get("extendClass"),i.process.call(this,t)}});return l});;