define(["require","exports","tslib","classnames","react","modules/core/browser","modules/core/exception","modules/core/html","modules/core/notify","modules/core/uri","modules/clean/auth/common/types","modules/clean/auth/login/2fa/authenticator_form","modules/clean/auth/login/2fa/email_form","modules/clean/marketing_tracker","modules/clean/auth/login/2fa/phone_form","modules/clean/auth/login/2fa/seckey_form","modules/clean/auth/login/api","modules/clean/auth/login/credentials_form","modules/clean/auth/login/sso_utils","modules/clean/auth/login/types","modules/clean/react/components/css","modules/core/i18n","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/auth/authenticator","modules/clean/security/passwords","modules/clean/auth/common/stats","modules/clean/react/fedramp/fedramp_util"],(function(e,t,o,r,s,a,i,n,l,c,p,u,g,m,d,h,_,f,S,y,w,T,F,E,A,b,L,C){"use strict";var R;Object.defineProperty(t,"__esModule",{value:!0}),t.TestOnlyLoginStep=t.TestOnlyLoginFormComponent=t.LoginForm=void 0,r=o.__importDefault(r),s=o.__importDefault(s),a=o.__importStar(a),_=o.__importStar(_),F=o.__importDefault(F),A=o.__importStar(A),(function(e){e[e.CREDENTIALS_OR_SSO=0]="CREDENTIALS_OR_SSO",e[e.EMAIL_2FA=1]="EMAIL_2FA",e[e.PHONE_2FA=2]="PHONE_2FA",e[e.AUTHENTICATOR_2FA=3]="AUTHENTICATOR_2FA",e[e.SECKEY_2FA=4]="SECKEY_2FA"})(R||(R={})),t.TestOnlyLoginStep=R;var v=(function(e){function t(t){var r,u=e.call(this,t)||this;u.testOnlyGetSsoChecker=function(){return u.ssoChecker},u.setCredentialsFormComponent=function(e){u.credentialsFormComponent=e},u.testOnlyGetCredentialsFormComponent=function(){return u.credentialsFormComponent},u.onInputChange=function(e){var t=e.currentTarget,r={},s=o.__assign({},u.state.localErrors),a=!1;switch(t.name){case"login_email":r.email=t.value,s.email=void 0,a=!0;break;case"login_password":r.password=t.value,s.password=void 0;break;case"remember_me":r.rememberMe=t.checked;break;case"trusted":r.trusted=t.checked;break;case"code":r.twoFactorCode=t.value,s.twoFactor=void 0}r.localErrors=s,u.setState(r,(function(){a&&u.ssoChecker.checkSsoState(r.email,u.onSsoStateUpdate)}))},u.onSsoStateUpdate=function(e,t){e===u.state.email&&u.setState({ssoState:t})},u.onSsoChangeClick=function(){i.assert(u.state.ssoState===y.SsoState.OPTIONAL,"User can change SSO state only when it is optional",{tags:["react-login-form"]}),u.setState({ssoState:y.SsoState.OFF})},u.generateThirdPartyAuthUrl=function(e,t){var o={fname:e.profile.given_name,lname:e.profile.family_name,email:e.profile.email,picture_url:e.profile.picture_url,refresh_token:e.refresh_token,email_sig:e.email_sig,automatic_redirect:t.toString(),cont:u.props.continuationUrl||"/"};return u.props.googleLoginProps&&u.props.googleLoginProps.signupTag&&(o.signup_tag=u.props.googleLoginProps.signupTag),u.props.googleLoginProps&&u.props.googleLoginProps.signupEndpoint&&(o.signup_endpoint=u.props.googleLoginProps.signupEndpoint),String(new c.URI({path:"/third_party_signup"}).updateQuery(o))},u.handleGoogleCallback=function(e){L.AuthAMPLogger.logThirdPartyLoginResponse(L.AuthType.GOOGLE,u.props.type,e.success,e.err_msg),L.GoogleUXAnalyticsLogger.logLoginResponse(e);var t=C.getFedrampRedirectUrlIfApplicable(e.is_fedramp_user||!1,u.props.continuationUrl||"/");if(e.success)u.handleLoginFormEvent(y.LoginFormEvent.GOOGLE_LOGIN_SUCCESS),_.logProfileServicesSuccess(),!1!==u.props.canRedirect?(l.Notify.success(T.intl.formatMessage({id:"Ce9FpX",defaultMessage:"Log in successful! Your browser will be redirected in a few seconds."})),a.redirect(t)):e.is_fedramp_user?(t=C.getFedrampRedirectUrlIfApplicable(!0,u.props.continuationUrl||a.get_href()),a.redirect(t)):u.props.onLoginSuccess&&u.props.onLoginSuccess({display_name:e.display_name,id:e.user_id,email:e.profile.email});else if(_.logProfileServicesFailure(),"emails_do_not_match_redirect"===e.err_msg){var r=u.props.googleLoginProps,i=r&&r.customErrorHandlers;if(i&&i.emailsDoNotMatchRedirect)i.emailsDoNotMatchRedirect(e);else{var g=u.generateThirdPartyAuthUrl(e,!0);a.redirect(g)}}else if("emails_do_not_match"===e.err_msg)if("pairing"!==u.props.type&&u.props.variant===p.AuthFormVariant.STANDARD){var m=u.generateThirdPartyAuthUrl(e,!1),d=T.intl.formatMessage({id:"6AHSKo",defaultMessage:"Oops! We couldnâ€™t find a Dropbox account matching that email. <a>Click here to create one.</a>"},{a:function(e){return s.default.createElement("a",{className:"third-party-signup-link",href:m},e)}});u.setState({localErrors:o.__assign(o.__assign({},u.state.localErrors),{googleLogin:d})})}else e.localized_error?l.Notify.error(e.localized_error):l.Notify.error(T.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}));else if("tos_required"===e.err_msg){g=new c.URI({path:"/account/complete_registration_page"}).updateQuery({finish_web_auth:"true",remember_me:e.remember_me.toString(),cont:u.props.continuationUrl||"/"});a.redirect(g.toString())}else if("tfa_required"===e.err_msg){g=new c.URI({path:"/verify_code"}).updateQuery({cont:t,remember_me:e.remember_me.toString(),pair_user:e.pair_user.toString()});a.redirect(g.toString())}else if("enable_twofactor_required"===e.err_msg){g=new c.URI({path:"/twofactor"}).updateQuery({cont:t,remember_me:e.remember_me.toString(),pair_user:e.pair_user.toString()});a.redirect(g.toString())}else if("not_verified"===e.err_msg){g=new c.URI({path:"/show_password_form"}).updateQuery({cont:t,remember_me:e.remember_me.toString(),pair_user:e.pair_user.toString()});a.redirect(g.toString())}else if("email_not_verified"===e.err_msg){var h=T.intl.formatMessage({id:"S6RuBm",defaultMessage:"Before you can sign in, youâ€™ll need to verify your account with Google {email}"},{email:e.profile.email});l.Notify.error(new n.HTML("<span>"+h+"</span>"),30)}else e.localized_error?l.Notify.error(e.localized_error):l.Notify.error(T.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."})),"google_login_not_allowed"!==e.err_msg&&"sso_required"!==e.err_msg||(u.setState({email:e.profile.email}),u.ssoChecker.checkSsoState(e.profile.email,u.onSsoStateUpdate))},u.onGoogleLoginClick=function(){u.handleLoginFormEvent(y.LoginFormEvent.GOOGLE_LOGIN_CLICK),u.setState({localErrors:{}}),L.AuthAMPLogger.logLoginAttempt(L.AuthType.GOOGLE,u.props.type),L.GoogleUXAnalyticsLogger.logLoginStart();var e=!!u.props.googleLoginProps&&!1!==u.props.googleLoginProps.popup;(new E.ProfileServicesLinkingHandler).auth_service_login_web(F.default.GOOGLE,u.handleGoogleCallback,"login_form",e?E.AuthWindowOption.POP_UP:E.AuthWindowOption.REDIRECT,u.state.rememberMe,u.props.continuationUrl||"/","pairing"===u.props.type)},u.handleAppleCallback=function(e){L.AuthAMPLogger.logThirdPartyLoginResponse(L.AuthType.APPLE,u.props.type,e.success,e.err_msg),L.AppleUXAnalyticsLogger.logLoginResponse(e);var t=C.getFedrampRedirectUrlIfApplicable(e.is_fedramp_user||!1,u.props.continuationUrl||"/");if(e.success)u.handleLoginFormEvent(y.LoginFormEvent.APPLE_LOGIN_SUCCESS),l.Notify.success(T.intl.formatMessage({id:"ZJmJez",defaultMessage:"Sign in successful! Your browser will be redirected in a few seconds."})),_.logProfileServicesSuccess(),!1===u.props.canRedirect&&e.is_fedramp_user&&(t=C.getFedrampRedirectUrlIfApplicable(!0,u.props.continuationUrl||a.get_href())),a.redirect(t);else if(_.logProfileServicesFailure(),"no_email_in_response"===e.err_msg){var o=T.intl.formatMessage({id:"oFA/9f",defaultMessage:"Sign in failed. If youâ€™d like to sign in with Apple again, <a>see how in our help center</a>. You could also sign in with your Dropbox account email and password."},{a:function(e){return'<a href="/help/accounts-billing/settings-sign-in/apple-sign-in-error">'+e+"</a>"}});l.Notify.error(new n.HTML("<span>"+o+"</span>"),30)}else if("tfa_required"===e.err_msg){var r=new c.URI({path:"/verify_code"}).updateQuery({cont:t,remember_me:e.remember_me.toString(),pair_user:e.pair_user.toString()});a.redirect(r.toString())}else if("enable_twofactor_required"===e.err_msg){r=new c.URI({path:"/twofactor"}).updateQuery({cont:t,remember_me:e.remember_me.toString(),pair_user:e.pair_user.toString()});a.redirect(r.toString())}else if("requires_password_on_first_link"===e.err_msg){r=new c.URI({path:"/show_password_form"}).updateQuery({cont:t,remember_me:e.remember_me.toString(),pair_user:e.pair_user.toString()});a.redirect(r.toString())}else if("emails_do_not_match"===e.err_msg){o=T.intl.formatMessage({id:"8cKJMG",defaultMessage:"We couldnâ€™t find a Dropbox account matching the email {email}. <a1>Sign up for a new account</a1> or <a2>get help signing in</a2> to an existing account."},{a1:function(e){return'<a href="/individual/plans-comparison?_tk=sia_nomatch_plan_web">'+e+"</a1>"},a2:function(e){return'<a href="/help/accounts-billing/settings-sign-in/sign-in-with-apple?_tk=sia_nomatch_help_web">'+e+"</a2>"},email:e.profile.email});l.Notify.error(new n.HTML("<span>"+o+"</span>"),30)}else e.localized_error?l.Notify.error(e.localized_error):l.Notify.error(T.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."})),"apple_login_not_allowed"===e.err_msg&&(u.setState({email:e.profile.email}),u.ssoChecker.checkSsoState(e.profile.email,u.onSsoStateUpdate))},u.onAppleLoginClick=function(){u.handleLoginFormEvent(y.LoginFormEvent.APPLE_LOGIN_CLICK),u.setState({localErrors:{}}),L.AuthAMPLogger.logLoginAttempt(L.AuthType.APPLE,u.props.type),L.AppleUXAnalyticsLogger.logLoginStart();var e=!!u.props.appleLoginProps&&!1!==u.props.appleLoginProps.popup;(new E.ProfileServicesLinkingHandler).auth_service_login_web(F.default.APPLE,u.handleAppleCallback,"login_form",e?E.AuthWindowOption.POP_UP:E.AuthWindowOption.REDIRECT,u.state.rememberMe,u.props.continuationUrl||"/","pairing"===u.props.type)},u.credentialsFormData=function(){var e=o.__assign(o.__assign({login_email:u.state.email,cont:u.props.continuationUrl,remember_me:u.state.rememberMe},u.credentialsFormComponent.getCaptchaResponses()),u.props.additionalData);if(void 0===u.props.encryptionOptions)return Promise.reject(new Error("Must provide encryption options"));var t=u.state.ssoState===y.SsoState.OFF?u.state.password:"";return b.wrapPassword(t,u.props.encryptionOptions).then((function(t){return e.encrypted_password=t,Promise.resolve(e)}))},u.handleLoginSuccess=function(e){if(u.handleLoginFormEvent(y.LoginFormEvent.LOGIN_IMMEDIATE_SUCCESS,{userInfo:e}),!1!==u.props.canRedirect){var t=C.getFedrampRedirectUrlIfApplicable(e.is_fedramp_user||!1,u.props.continuationUrl||"/");return a.redirect(t)}if(e.is_fedramp_user){t=C.getFedrampRedirectUrlIfApplicable(!0,u.props.continuationUrl||a.get_href());return a.redirect(t)}return u.props.onLoginSuccess?u.props.onLoginSuccess(e):a.redirect("/")},u.handleSuccessResponse=function(e){switch(u.setState({isSubmitting:!1}),L.AuthAMPLogger.logCredentialsLoginResponse(u.props.type,e.status),L.EmailAuthUXAnalyticsLogger.logLoginResponse(e),e.status){case y.LoginResponseStatus.ERROR:var t=e.html_response?new n.HTML(e.message):e.message;return l.Notify.error(t);case y.LoginResponseStatus.EXPIRED:return a.redirect(e.cont);case y.LoginResponseStatus.OK:var r={id:e.id,email:e.email,display_name:e.display_name,locale:e.locale,is_fedramp_user:e.is_fedramp_user};u.handleLoginSuccess(r);break;case y.LoginResponseStatus.PASSWORD_EXPIRED:return u.setState({localErrors:o.__assign(o.__assign({},u.state.localErrors),{email:{message_text:T.intl.formatMessage({id:"3EEu7s",defaultMessage:"The password of the account associated with this email has expired. Please login to this account and update its password before pairing."})}})});case y.LoginResponseStatus.RATELIMIT:return u.setState({localErrors:o.__assign(o.__assign({},u.state.localErrors),{email:{message_text:T.intl.formatMessage({id:"7k/CMy",defaultMessage:"Youâ€™ve tried to log in too many times. Please try again in a few minutes."})}})});case y.LoginResponseStatus.TWOFACTOR_REQUIRED:case y.LoginResponseStatus.TOS_SIGNATURE_REQUIRED:return a.redirect(e.cont);case y.LoginResponseStatus.TWOFACTOR:e.checkpoint_token&&u.setState({checkpointToken:e.checkpoint_token}),e.use_email_2fa?u.setState({primaryTwoFactorType:y.TwoFactorType.EMAIL,currentStep:R.EMAIL_2FA}):e.u2f_challenge&&A.canUseAuthenticator(u.generateU2fRequest(e.u2f_challenge))?(u.setState({primaryTwoFactorType:y.TwoFactorType.SEC_KEY,currentStep:R.SECKEY_2FA}),e.last_two_digits?u.setState({lastTwoDigits:e.last_two_digits,secondaryTwoFactorType:y.TwoFactorType.SMS}):u.setState({secondaryTwoFactorType:y.TwoFactorType.AUTHENTICATOR}),u.kickOffU2f(e.u2f_challenge)):e.last_two_digits?u.setState({primaryTwoFactorType:y.TwoFactorType.SMS,lastTwoDigits:e.last_two_digits,secondaryTwoFactorType:void 0,currentStep:R.PHONE_2FA}):u.setState({primaryTwoFactorType:y.TwoFactorType.AUTHENTICATOR,lastTwoDigits:void 0,secondaryTwoFactorType:void 0,currentStep:R.AUTHENTICATOR_2FA});break;case y.LoginResponseStatus.SSO:return a.unsafeRedirect(e.sso_url);case y.LoginResponseStatus.PASSWORD_DECRYPTION_ERROR:return a.redirect(e.cont)}},u.handleServerErrors=function(e){if(L.AuthAMPLogger.logCredentialsLoginResponse(u.props.type,e.funcaptcha_response?"funcaptcha_response":"form_error"),!u.credentialsFormComponent.handleCaptchaErrors(e)){L.EmailAuthUXAnalyticsLogger.logLoginError();var t={};e.login_email?t.email=e.login_email:t.email=void 0,e.login_password?t.password=e.login_password:t.password=void 0,e["failed-login-invalid-email-password"]?t.login=T.intl.formatMessage({id:"kfg1Pg",defaultMessage:"Oops! It looks like you may have forgotten your password. <a>Click here to reset it.</a>"},{a:function(e){return s.default.createElement("a",{href:"/forgot"},e)}}):t.login=void 0,u.setState({localErrors:t}),u.setState({isSubmitting:!1})}},u.onCredentialsFormSubmit=function(){L.EmailAuthUXAnalyticsLogger.logLoginStart(),u.setState({isSubmitting:!0}),u.credentialsFormData().then((function(e){var t=_.submitCredentialsForm(u.props.type,e);t.catch(u.handleServerErrors),t.then(u.handleSuccessResponse)})).catch((function(e){var t,o;e.isBrowserNotSupported?(t="user-error",o=T.intl.formatMessage({id:"rWb8d2",defaultMessage:"Dropbox doesnâ€™t support your browser. For a better experience, upgrade to the latest version of a modern browser like Chrome, Firefox, Edge, or Safari."})):(t="critical",o=T.intl.formatMessage({id:"dNlIBC",defaultMessage:"There was a problem completing this request."})),i.reportException({err:e,severity:t,tags:["react-login-form"]}),u.setState({isSubmitting:!1}),l.Notify.error(o)}))},u.onLoginClick=function(e){e.preventDefault(),L.AuthAMPLogger.logLoginAttempt(L.AuthType.CREDENTIALS,u.props.type),u.handleLoginFormEvent(y.LoginFormEvent.LOGIN_CLICK),u.credentialsFormComponent.submitRecaptcha()},u.handleResendCodeSuccess=function(e){var t;switch(e){case y.TwoFactorResendResponse.OK:return l.Notify.success(T.intl.formatMessage({id:"vdqTup",defaultMessage:"We sent you a code. It may take a few minutes to arrive."}));case y.TwoFactorResendResponse.RATELIMIT:t=T.intl.formatMessage({id:"7k/CMy",defaultMessage:"Youâ€™ve tried to log in too many times. Please try again in a few minutes."});break;case y.TwoFactorResendResponse.UNREACHABLE:t=T.intl.formatMessage({id:"G6HUee",defaultMessage:"We couldnâ€™t reach your phone number. Are you sure itâ€™s correct?"});break;case y.TwoFactorResendResponse.EXPIRED:t=T.intl.formatMessage({id:"l5AyQn",defaultMessage:"Sorry, your phone code has expired. Please log in again."});break;case y.TwoFactorResendResponse.BADCARRIER:t=T.intl.formatMessage({id:"ffjRA4",defaultMessage:"Unfortunately, your carrier isnâ€™t supported at this time."});break;case y.TwoFactorResendResponse.INVALIDNUMBER:t=T.intl.formatMessage({id:"1P05hM",defaultMessage:"That isnâ€™t a valid phone number."});break;case y.TwoFactorResendResponse.NOTAMOBILE:t=T.intl.formatMessage({id:"aI/ARD",defaultMessage:"That phone number doesnâ€™t appear to be a valid mobile number."});break;default:return l.Notify.error(T.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))}u.setState({localErrors:o.__assign(o.__assign({},u.state.localErrors),{twoFactor:{message_text:t}})})},u.resendCode=function(){var e,t,o,r,s=_.resendTwoFactorCode(null!==(t=null===(e=u.props.additionalData)||void 0===e?void 0:e.backup)&&void 0!==t&&t,null!==(r=null===(o=u.props.additionalData)||void 0===o?void 0:o.mobile_push)&&void 0!==r&&r);s.then(u.handleResendCodeSuccess),s.catch((function(){l.Notify.error(T.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))}))},u.handleTwoFactorSuccess=function(e){switch(L.AuthAMPLogger.log2faResponse(u.props.type,e.status),e.status){case y.LoginResponseStatus.OK:u.state.currentStep===R.SECKEY_2FA&&u.setState({securityKeyState:y.SecurityKeyState.FOUND});var t={id:e.id,email:e.email,display_name:e.display_name,locale:e.locale,is_fedramp_user:e.is_fedramp_user};u.handleLoginSuccess(t);break;case y.LoginResponseStatus.ERROR:l.Notify.error(e.message);break;case y.LoginResponseStatus.REQUIRES_ROLE:case y.LoginResponseStatus.EXPIRED:u.setState({localErrors:o.__assign(o.__assign({},u.state.localErrors),{email:{message_text:e.message}}),currentStep:R.CREDENTIALS_OR_SSO});break;case y.LoginResponseStatus.INVALID_CREDENTIALS:u.setState({localErrors:o.__assign(o.__assign({},u.state.localErrors),{password:{message_text:e.message}}),currentStep:R.CREDENTIALS_OR_SSO});break;default:l.Notify.error(T.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))}},u.twoFactorFormData=function(){var e=o.__assign({remember_me:u.state.rememberMe,cont:u.props.continuationUrl,code:u.state.twoFactorCode,trusted:u.state.trusted},u.props.additionalData);return u.state.checkpointToken?o.__assign({checkpoint_token:u.state.checkpointToken},e):e},u.submitTwoFactor=function(){u.setState({isSubmitting:!0});var e=_.submitTwoFactorForm(u.props.type,u.twoFactorFormData());e.then(u.handleTwoFactorSuccess),e.catch((function(e){L.AuthAMPLogger.log2faResponse(u.props.type,e.u2f?"u2f_error":e.code?"code_error":"unknown"),u.state.currentStep===R.SECKEY_2FA&&e.u2f?u.setState({localErrors:o.__assign(o.__assign({},u.state.localErrors),{securityKey:e.u2f.message_text}),securityKeyState:y.SecurityKeyState.NOT_FOUND}):e.code?u.setState({localErrors:o.__assign(o.__assign({},u.state.localErrors),{twoFactor:e.code})}):l.Notify.error(T.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))})),e.finally((function(){u.setState({isSubmitting:!1})}))},u.onPhone2FASubmit=function(e){e.preventDefault(),u.submitTwoFactor()},u.onAuthenticator2FASubmit=function(e){e.preventDefault(),u.submitTwoFactor()},u.generateU2fRequest=function(e){for(var t=JSON.parse(e),o={challenge_id:t.challenge_id},r=0,s=Object.keys(A.PROTOCOLS);r<s.length;r++){var a=s[r];o[a]=t[a]&&JSON.parse(t[a])}return o},u.kickOffU2f=function(e){return o.__awaiter(u,void 0,void 0,(function(){var t,r,s,a=this;return o.__generator(this,(function(o){switch(o.label){case 0:if(t=this.generateU2fRequest(e),!A.canUseAuthenticator(t))return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,A.sign(t)];case 2:return r=o.sent(),this.state.currentStep===R.SECKEY_2FA&&this.setState({twoFactorCode:JSON.stringify(r)},(function(){return a.submitTwoFactor()})),[3,4];case 3:return s=o.sent(),this.state.currentStep===R.SECKEY_2FA&&this.setState({securityKeyState:y.SecurityKeyState.NOT_FOUND}),i.assert(!1,"U2F Error - "+s,{tags:["react-login-form","u2f"]}),[3,4];case 4:return[3,5];case 5:return[2]}}))}))},u.switch2FA=function(){var e;i.assert(u.state.primaryTwoFactorType===y.TwoFactorType.SEC_KEY,"Unexpected two factor choice switch",{tags:["react-login-form"]}),u.state.secondaryTwoFactorType===y.TwoFactorType.SMS?(e=R.PHONE_2FA,u.resendCode()):e=R.AUTHENTICATOR_2FA,u.setState({twoFactorCode:"",primaryTwoFactorType:u.state.secondaryTwoFactorType,secondaryTwoFactorType:void 0,currentStep:e})},u.onRetryU2f=function(){u.setState({securityKeyState:y.SecurityKeyState.LOADING});var e=_.retryU2fAuthentication();e.then(u.kickOffU2f),e.catch((function(){u.setState({securityKeyState:y.SecurityKeyState.NOT_FOUND}),l.Notify.error(T.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))}))},u.onCaptchaReady=function(){},i.assert(!1!==t.canRedirect||!!t.onLoginSuccess,"Need an on login success handler if we cannot redirect the user",{tags:["react-login-form"]}),u.ssoChecker=new S.SsoStateChecker;var g=R.CREDENTIALS_OR_SSO,m=void 0,d=void 0,h=void 0;return t.twoFactorOnlyProps&&(t.twoFactorOnlyProps.u2fChallenge&&!(null===(r=t.additionalData)||void 0===r?void 0:r.backup)&&A.canUseAuthenticator(u.generateU2fRequest(t.twoFactorOnlyProps.u2fChallenge))?(g=R.SECKEY_2FA,m=y.TwoFactorType.SEC_KEY,t.twoFactorOnlyProps.lastTwoDigits?(d=y.TwoFactorType.SMS,h=t.twoFactorOnlyProps.lastTwoDigits):d=y.TwoFactorType.AUTHENTICATOR):t.twoFactorOnlyProps.lastTwoDigits?(g=R.PHONE_2FA,m=y.TwoFactorType.SMS,h=t.twoFactorOnlyProps.lastTwoDigits):(g=R.AUTHENTICATOR_2FA,m=y.TwoFactorType.AUTHENTICATOR)),u.state={currentStep:g,email:t.emailProps&&t.emailProps.initialValue||"",isSubmitting:!1,lastTwoDigits:h,localErrors:{},password:"",primaryTwoFactorType:m,secondaryTwoFactorType:d,rememberMe:t.rememberMeCheckboxProps&&t.rememberMeCheckboxProps.checked||!1,securityKeyState:y.SecurityKeyState.LOADING,ssoState:y.SsoState.OFF,trusted:t.twoFactorTrustCheckboxProps&&t.twoFactorTrustCheckboxProps.checked||!1,twoFactorCode:"",checkpointToken:void 0,shouldDisableForm:!0},u}return o.__extends(t,e),t.prototype.trackSuccessfulLogin=function(e,t){if(e===y.LoginFormEvent.LOGIN_IMMEDIATE_SUCCESS||e===y.LoginFormEvent.GOOGLE_LOGIN_SUCCESS||e===y.LoginFormEvent.APPLE_LOGIN_SUCCESS){var o=m.getGAEventData(m.MARKETING_LOGIN_EVENT,m.MARKETING_LOGIN_EVENT);m.MarketingTracker.tryPushEvent(m.MARKETING_LOGIN_EVENT,m.EventTypeEnum.Link,o)}},t.prototype.handleLoginFormEvent=function(e,t){this.trackSuccessfulLogin(e,t),this.props.onLoginFormEvent&&this.props.onLoginFormEvent(e,t)},t.prototype.componentDidMount=function(){this.setState({shouldDisableForm:!1}),this.props.twoFactorOnlyProps||L.AuthAMPLogger.logLoginIntent(this.props.type),this.props.twoFactorOnlyProps&&this.props.twoFactorOnlyProps.u2fChallenge&&this.state.currentStep===R.SECKEY_2FA&&this.kickOffU2f(this.props.twoFactorOnlyProps.u2fChallenge),this.state.email&&this.ssoChecker.checkSsoState(this.state.email,this.onSsoStateUpdate)},Object.defineProperty(t.prototype,"shouldDisableForm",{get:function(){return!!this.props.disabled||this.state.shouldDisableForm},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportsCaptcha",{get:function(){return!this.props.hideCredentialFields&&!["multi","pairing","cli_link_nonce"].includes(this.props.type)},enumerable:!1,configurable:!0}),t.prototype.render=function(){var e,t,o,a,i;switch(this.state.currentStep){case R.CREDENTIALS_OR_SSO:i=s.default.createElement(f.LoginCredentialsForm,{ref:this.setCredentialsFormComponent,disabled:this.shouldDisableForm,emailError:this.state.localErrors.email,emailProps:this.props.emailProps||{},emailValue:this.state.email,forgotPasswordProps:this.props.forgotPasswordProps||{},googleLoginError:this.state.localErrors.googleLogin,googleLoginProps:this.props.googleLoginProps,appleLoginError:this.state.localErrors.appleLogin,appleLoginProps:this.props.appleLoginProps,hideCredentialFields:this.props.hideCredentialFields||!1,hideHelp:this.props.hideHelp||!1,hideRememberMe:this.props.hideRememberMe||!1,isPaperLogin:this.props.isPaperLogin||!1,isSubmitting:this.state.isSubmitting,loginButtonProps:this.props.loginButtonProps||{},loginError:this.state.localErrors.login,maestroStyle:this.props.maestroStyle||!1,onGoogleLoginClick:this.onGoogleLoginClick,onAppleLoginClick:this.onAppleLoginClick,onInputChange:this.onInputChange,onLoginClick:this.onLoginClick,openLinksInNewTab:!!this.props.openLinksInNewTab,onSsoChangeClick:this.onSsoChangeClick,onSubmit:this.onCredentialsFormSubmit,onCaptchaReady:this.onCaptchaReady,passwordError:this.state.localErrors.password,passwordProps:this.props.passwordProps||{},passwordValue:this.state.password,rememberMeProps:this.props.rememberMeCheckboxProps||{},rememberMeValue:this.state.rememberMe,showNaviSiteLogin:!!this.props.showNaviSiteLogin,ssoState:this.state.ssoState,supportsCaptcha:this.supportsCaptcha,variant:this.props.variant||p.AuthFormVariant.STANDARD});break;case R.PHONE_2FA:i=s.default.createElement(d.Phone2FAForm,{continuationUrl:this.props.continuationUrl,displayHeader:null!==(e=this.props.twoFactorDisplayHeader)&&void 0!==e&&e,error:this.state.localErrors.twoFactor,hideHelp:this.props.hideHelp||!1,hideTrustCheckbox:this.props.hideRememberMe||!1,inlineSubmit:void 0===this.props.twoFactorSubmitButtonInline||this.props.twoFactorSubmitButtonInline,lastTwoDigits:this.state.lastTwoDigits||"",maestroStyle:this.props.maestroStyle||!1,onInputChange:this.onInputChange,onResendCodeClick:this.resendCode,onSubmit:this.onPhone2FASubmit,rememberMe:this.state.rememberMe,trusted:this.state.trusted,trustTooltipPosition:this.props.twoFactorTrustCheckboxProps&&this.props.twoFactorTrustCheckboxProps.tooltipPosition,value:this.state.twoFactorCode,variant:this.props.variant||p.AuthFormVariant.STANDARD});break;case R.EMAIL_2FA:i=s.default.createElement(g.Email2FAForm,{displayHeader:null!==(t=this.props.twoFactorDisplayHeader)&&void 0!==t&&t,email:this.state.email,error:this.state.localErrors.twoFactor,inlineSubmit:void 0===this.props.twoFactorSubmitButtonInline||this.props.twoFactorSubmitButtonInline,maestroStyle:this.props.maestroStyle||!1,onInputChange:this.onInputChange,onSubmit:this.onPhone2FASubmit,value:this.state.twoFactorCode,variant:this.props.variant||p.AuthFormVariant.STANDARD,onResendCodeClick:this.resendCode});break;case R.AUTHENTICATOR_2FA:i=s.default.createElement(u.Authenticator2FAForm,{continuationUrl:this.props.continuationUrl,displayHeader:null!==(o=this.props.twoFactorDisplayHeader)&&void 0!==o&&o,error:this.state.localErrors.twoFactor,hideHelp:this.props.hideHelp||!1,hideTrustCheckbox:this.props.hideRememberMe||!1,inlineSubmit:void 0===this.props.twoFactorSubmitButtonInline||this.props.twoFactorSubmitButtonInline,maestroStyle:this.props.maestroStyle||!1,onInputChange:this.onInputChange,onSubmit:this.onAuthenticator2FASubmit,rememberMe:this.state.rememberMe,trusted:this.state.trusted,trustTooltipPosition:this.props.twoFactorTrustCheckboxProps&&this.props.twoFactorTrustCheckboxProps.tooltipPosition,value:this.state.twoFactorCode,variant:this.props.variant||p.AuthFormVariant.STANDARD});break;case R.SECKEY_2FA:i=s.default.createElement(h.SecKey2FAForm,{displayHeader:null!==(a=this.props.twoFactorDisplayHeader)&&void 0!==a&&a,error:this.state.localErrors.securityKey,hideTrustCheckbox:this.props.hideRememberMe||!1,maestroStyle:this.props.maestroStyle||!1,onChange2FA:this.switch2FA,onInputChange:this.onInputChange,onRetry:this.onRetryU2f,trusted:this.state.trusted,trustTooltipPosition:this.props.twoFactorTrustCheckboxProps&&this.props.twoFactorTrustCheckboxProps.tooltipPosition,secondaryTwoFactorType:this.state.secondaryTwoFactorType,securityKeyState:this.state.securityKeyState,variant:this.props.variant||p.AuthFormVariant.STANDARD})}var n=r.default("login-form-container",this.props.variant,this.props.className,{"login-form-container--centered":this.props.centered});return s.default.createElement("div",{className:n},s.default.createElement("div",{className:"regular-login-forms"},i))},t})(s.default.Component);t.TestOnlyLoginFormComponent=v,t.LoginForm=w.requireCssWithComponent(v,["/static/css/components/exp_cards-vfls5BO1G.css","/static/css/components/login_form-vflgnZctA.css","/static/css/legacy_packages/components-vflwFi1IV.css","/static/css/login_or_register-vflZ9ry5P.css","/static/css/scooter/scooter-scoped-vflpl9JSl.css","/static/css/spectrum/index.web-vflmHVRF-.css","/static/css/recaptcha_challenge-vflrcf67y.css","/static/css/recaptcha_v2_challenge-vfl5GXpO2.css"])}));
//# sourceMappingURL=form.min.js-vflJDebgf.map