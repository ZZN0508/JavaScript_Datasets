(this.$WP=this.$WP||[]).push(["mT-Pb2",(e,n)=>{"use strict";var C,S,k,v,O,b,y,I,h,M,x,a,P,d,w,g,B=["OPTIMUS_BRANDED_IMAGE_HIGHLIGHT"],K=({allowClose:n,flow:a,forceLogin:s,contextualMessagingVariant:e,contextualMessageKey:o,contextualMessageParamKey:i,contextualMessageParam:t,contextualMessageSubheaderKey:l,isSignInOnly:r,onClose:u,onFailure:c,funnelKey:d,pid:g})=>{var{login:f,close:m}=b(),p=C(()=>{return Object.assign({},e?{}:{contextualMessage:o,contextualMessageParamKey:i,contextualMessageParam:t,contextualMessageSubheader:l},{isSignInOnly:r,contextualMessagingVariant:e,funnelKey:d})},[o,t,i,l,e,r,d]),y=B.includes((a||"").toUpperCase());return{login:S(e=>f({flowOrigin:"login",flow:a,isFullWidthMobile:!0,forceLogin:s,requireSecure:s,closeX:n,closeOnDocClick:n,hideBoxShadow:y,extraQueryParams:p,pid:g||40777,onSuccess:e||void 0,onClose:u,onFailure:c}),[n,p,y,a,s,f,u,c,g]),close:m}},s=({members:e,nonMembers:n,messageVariant:a,onClose:s,flow:o="OPTIMUS_BRANDED",funnelKey:i,pid:t})=>{var l=k(h)["userId"],r=x(),u=I("phoenix_plus"),c=K(Object.assign({allowClose:!0,forceLogin:!1},a&&{flow:o,contextualMessagingVariant:a},{onClose:s,funnelKey:i,pid:t}))["login"],[d,g]=v(!1),[{data:f,fetching:m},p]=y({query:w,pause:!l});return O(()=>{l&&p({requestPolicy:"network-only"})},[p,l]),O(()=>{(l||u)&&d&&!m&&(null!=f&&f.OptimusBenefits_isSubscribedToOptimus?r(e):r(n))},[f,m,e,r,n,d,l,u]),S(()=>{l||u?g(!0):c(()=>{g(!0)})},[c,g,l,u])},o=()=>{var s=a(),[{page:o}]=k(M);return S(({locationId:e,listingKey:n=null,funnelKey:a})=>{if(!e||!a)throw new Error("Unable to record user login. Missing offer data - "+JSON.stringify({locationId:e,funnelKey:a}));s({OptimusOffer:{optimusInitialOfferSignedIn:{servletName:o,locationId:e,funnelKey:a,listingKey:n}}})},[s,o])},i=({children:e,forceLogin:n,loginContextualMessageKey:a,shouldLogoutAfterPaymentFailures:s=!1,renderBeforeLogout:o})=>{var[i,t]=v(!n),[l,r]=v(!1),[u]=k(M),{failedCardPayment:c,hasBlockedCardInSession:d,hadBlockedCard:g,clearAllBlockedCards:f}=(()=>{var[a,s]=v(!1),[o,i]=v(new Map);return{failedCardPayment:S(e=>{var n;e&&!a&&(n=o.get(e)||0,5<=(n+=1)&&(s(!0),P.set("PlusHadBlockedCards",!0),n=0),i(new Map(o.set(e,n))))},[a,s,o]),hasBlockedCardInSession:S(()=>a,[a]),hadBlockedCard:S(()=>!!a||P.has("PlusHadBlockedCards"),[a]),clearAllBlockedCards:S(()=>{a&&s(!1),P.has("PlusHadBlockedCards")&&P.remove("PlusHadBlockedCards")},[a,s])}})(),a=g()?"plus_too_many_failed_payments":a,m=K({allowClose:!1,forceLogin:n,contextualMessageKey:a})["login"],p=k(h)["userId"];O(()=>{p&&i||l||(r(!0),m(()=>t(!0)).finally(()=>r(!1)))},[m,i,l,p]);var y=S(()=>{window.location=`/RegistrationController?flow=${encodeURIComponent("SIGN_OUT")}&pid=${encodeURIComponent(String(K))}&returnTo=${encodeURIComponent(u.path)}&fullscreen=true`},[u.path]),C=s&&d();return O(()=>{C&&y()},[C,y]),C?o?o():null:p&&i?(f(),e({userId:p,failedCardPayment:c})):null},f=e=>!(null==e||!e.canAccessSecureContent),t=({children:e,contextualMessageKey:n,renderNotSecure:a,skip:s})=>{var{login:o,close:i}=K({allowClose:!1,forceLogin:!0,contextualMessageKey:n}),[{data:t,fetching:l},r]=(()=>{var e=k(h)["userId"],[n,a]=v(null),[s,o]=d({query:g,pause:!e},f);return O(()=>{e!==n&&(a(e),o())},[o,n,e]),O(()=>()=>a(null),[a]),[s,o]})(),[u,c]=v(!1);return O(()=>{t||l||u||s||o(()=>{r(),c(!0)})},[t,r,l,o,u,c,s]),O(()=>()=>i(),[i]),t||s?e():a?a():null};return[()=>{(w=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"IsSubscribed"},"variableDefinitions":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"OptimusBenefits_isSubscribedToOptimus"},"arguments":[],"directives":[]}]}}],"loc":{"start":0,"end":71}}')).__key=93070980626319,w.loc.source={body:"54a5c6bd378f"},(g=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"query","name":{"kind":"Name","value":"CanAccessSecureContent"},"variableDefinitions":[],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","alias":{"kind":"Name","value":"canAccessSecureContent"},"name":{"kind":"Name","value":"OptimusBenefits_canAccessSecureContent"},"arguments":[],"directives":[]}]}}],"loc":{"start":0,"end":106}}')).__key=0xb7349ab36c89,g.loc.source={body:"b7349ab36c89"},e({OptimusHardGate:i,OptimusSecureLoginGate:t,useOptimusLogin:K,useOptimusLoginNavigation:s,useOptimusLoginTracking:o})},[e=>(C=e.useMemo,S=e.useCallback,k=e.useContext,v=e.useState,O=e.useEffect),e=>b=e.default,e=>y=e.useQuery,e=>I=e.featureIsEnabled,e=>(h=e.Visitor,M=e.Route),e=>x=e.useNavigate,e=>a=e.useInteractionLogger,e=>P=e.default,e=>d=e.default]]},["cDcdfi","VANuRt","5X2em-","-i3PJS","2R4xv2","1yEXVQ","fsml46","jaCyxS","kYmwth"]]);
