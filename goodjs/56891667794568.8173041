(self.webpackJsonp__wix_thunderbolt_app=self.webpackJsonp__wix_thunderbolt_app||[]).push([[4522],{31857:function(e,t,n){"use strict";n.r(t),n.d(t,{AUTH_RESULT_REASON:function(){return Pe.$9},BIEvents:function(){return Ee},INTERACTIONS:function(){return Pe.SE},PrivacyStatus:function(){return Pe.iY},SiteMembersApiSymbol:function(){return b.n9},isLoginAcceptableError:function(){return ke.Y2},isSignupAcceptableError:function(){return ke.fJ},memberDetailsFromDTO:function(){return ke.Ky},page:function(){return L},site:function(){return T}});function be(e,t,n){document.cookie=e+"=;max-age=0",document.cookie=e+"=;max-age=0;path="+t,document.cookie=e+"=;domain="+n+";max-age=0",document.cookie=e+"=;domain="+n+";max-age=0;path="+t}var i=n(43757),Se=n(31191),o=n(61049),r=n(49574),s=n(5096),a=n(55048),u=n(98333),c=n(10666),l=n(58629),d=n(26513),m=n(82627),we=n(8562),g=n(56405),h=n(19238),p=n(87821),f=n(23228),t=n(99552),Ce=n(16684),Pe=n(95848),v=n(51831),b=n(2811),De=(A.prototype.displayDialog=function(r,s,a,u){return void 0===u&&(u={}),(0,Se.mG)(this,void 0,Promise,function(){var t,n,i,o=this;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return t=function(){return(0,Se.mG)(o,void 0,void 0,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return t=(0,Ce.uniqueId)(b.rj),this.propsStore.update(((n={})[t]=(0,Se.pi)((0,Se.pi)({},s),a),n)),(0,v.U)(),[4,this.structureApi.addComponentToDynamicStructure(t,{componentType:r,components:[]})];case 1:return e.sent(),this.currentCompId&&(this.structureApi.removeComponentFromDynamicStructure(this.currentCompId),this.siteScrollBlocker.setSiteScrollingBlocked(!1,this.currentCompId)),this.siteScrollBlocker.setSiteScrollingBlocked(!0,t),this.currentCompId=t,[2]}})})},n=u.shouldWaitForAppDidMount,i=u.registerToAppDidMount,n&&i?(i(t),[3,3]):[3,1];case 1:return[4,t()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},A.prototype.hideDialog=function(){this.currentCompId&&(this.structureApi.removeComponentFromDynamicStructure(this.currentCompId),this.siteScrollBlocker.setSiteScrollingBlocked(!1,this.currentCompId),(0,v.i)()),this.currentCompId=void 0},A),ke=n(43096),Ee=function(e){function n(e,t){return{biToken:r.msId,context:e,ts:S(r),viewmode:s,visitor_id:i.getVisitorId(),site_member_id:i.getSiteMemberId(),vsi:r.viewerSessionId,site_settings_lng:a.siteLanguage,browser_lng:a.userLanguage,lng_mismatch:a.siteLanguage!==a.userLanguage,layout:t}}var i=e.sessionManager,o=e.businessLogger,r=e.wixBiSession,s=e.viewMode,a=e.language;return{loginOrSignUpDialogLoaded:function(e,t){o.logger.log((0,Se.pi)({src:5,evid:658},n(e,t=void 0===t?"fullscreen":t)),{endpoint:"site-members"})},closingDialog:function(e,t){o.logger.log((0,Se.pi)({src:5,evid:602,form_type:"default"},n(e,t=void 0===t?"fullscreen":t)),{endpoint:"site-members"})},emailAuthSubmitClicked:function(e,t){o.logger.log((0,Se.pi)({src:5,evid:603,form_type:"default"},n(e,t)),{endpoint:"site-members"})},siteMembersFeatureLoaded:function(){o.logger.log((0,Se.pi)({src:5,evid:698},n()),{endpoint:"site-members"})},siteMembersSdkFeatureLoaded:function(){o.logger.log((0,Se.pi)({src:5,evid:699},n()),{endpoint:"site-members"})}}},S=function(e){e=e.initialTimestamp||0;return Date.now()-e},ye=(I.prototype.openPopupPage=function(i,o,r){var s;return(0,Se.mG)(this,void 0,void 0,function(){var t,n=this;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return t=this.shouldRunCustomPopupCloseCallback,this.shouldRunCustomPopupCloseCallback=!1,this.assignRequestAuthenticationRejection(o),[4,null===(s=this.popups)||void 0===s?void 0:s.openPopupPage(i,function(){n.shouldRunCustomPopupCloseCallback&&(n.rejectAuthenticationRequest(),r&&r())})];case 1:return e.sent(),this.shouldRunCustomPopupCloseCallback=t,[2]}})})},I.prototype.preventCustomPopupCloseCallback=function(){this.shouldRunCustomPopupCloseCallback=!1},I.prototype.allowCustomPopupCloseCallback=function(){this.shouldRunCustomPopupCloseCallback=!0},I.prototype.assignRequestAuthenticationRejection=function(e){this.requestAuthenticationRejection=this.requestAuthenticationRejection||e},I.prototype.rejectAuthenticationRequest=function(){this.requestAuthenticationRejection&&(this.requestAuthenticationRejection(Pe.$9.CANCELED),this.requestAuthenticationRejection=void 0)},I),w=(0,i.ff)([(0,i.t6)(o.R9,b.u2),(0,i.t6)(o.jC,b.u2),(0,i.t6)(o.Wf,b.u2),r.U,s.EE,s.Zr,g.X,a.xP,a.QZ,s.bk,s.ZQ,h.F0,p.x,u.v,h.Iz,c.$,l.s,(0,i.jt)(f.r_),(0,i.jt)(t.I),d.jj,m.O],function(e,t,n,i,p,r,l,o,s,d,a,u,c,f,m,g,h,v,b,S,w){void 0===b&&(b={trackEvent:function(){return 0}});function C(e){ae=e}function P(){var e=!S.getCurrentRouteInfo();return{registerToAppDidMount:C,shouldWaitForAppDidMount:!ue&&e}}var D=e.collectionExposure,k=e.smcollectionId,E=e.svSession,y=e.smSessionCookie,T=e.protectedHomepage,L=e.isCommunityInstalled,I=e.memberInfoAppId,A=e.sm_efCookie,R="WixInternal"===D,_=l.getAppInstanceByAppDefId("22bef345-3c5b-4c18-b782-74d4085112ff"),M=null!==(J=l.getVisitorId())&&void 0!==J?J:"00000000-0000-0000-0000-000000000000",O=t.smSettings,U=t.tpaApplicationIds,G=t.policyLinks,N=I&&U[I],D=r.site,J=D.siteRevision,x=D.metaSiteId,t=D.siteId,U=D.externalBaseUrl,F=r.requestUrl,I=r.viewMode,D=-1!==Pe.F0.findIndex(function(e){var t;return null===(t=null===(t=null==a?void 0:a.navigator)||void 0===t?void 0:t.userAgent)||void 0===t?void 0:t.includes(e)}),j=!(w["specs.thunderbolt.sm_socialAuthMessageInInAppBrowser"]&&D),W=!(w["specs.thunderbolt.sm_customLoginSocialAuthMessageInInAppBrowser"]&&D),q="/_api/wix-sm-webapp/tokens/verify/"+x+"/"+t,B=U.replace(/\/$/,"")+"/api/wix-sm/v1/authorize/"+t+"/pages",V="/_api/wix-sm-webapp/tokens/logout/"+x,K="/_api/wix-sm-webapp/member/changePasswordWithMailToken?metaSiteId="+x+"&collectionId="+k,Y="/_api/wix-sm-webapp/social/token/handle?metaSiteId="+x+"&collectionId="+k,z=U.replace(/\/$/,"")+"/_api/dynamicmodel",H=O.smFirstDialogLogin?"login":"signup",$=O.socialLoginFacebookEnabled,X=O.socialLoginGoogleEnabled,Q=O.termsOfUse,Z=O.privacyPolicy,ee=O.codeOfConduct,te=O.customSignUpPageId,ne=O.customSignInPageId,ie=null===(O=O.joinCommunityCheckedByDefault)||void 0===O||O,oe=e.smToken,re={},se=y,ae=null,ue=!1,ce={},le={},de=Ee({sessionManager:l,businessLogger:g,wixBiSession:h,viewMode:null==I?void 0:I.toUpperCase(),language:d});de.siteMembersFeatureLoaded();var me={},ge=(0,ke.Qn)(i,{credentials:"same-origin",headers:{accept:"application/json","x-wix-site-revision":""+J,"x-wix-client-artifact-id":"thunderbolt"}},r.requestUrl),he=new De(o,s,c),pe=w["specs.thunderbolt.sm_googleAuthViaSDK"],fe=new ye(v),ve={appDidMount:function(){ae&&ae(),ue=!0},login:function(i,o,r,s){return void 0===s&&(s=!1),(0,Se.mG)(this,void 0,Promise,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Submit",eventLabel:"Wix"}}),e.label=1;case 1:return e.trys.push([1,4,,5]),[4,ve.performLogin(i,o,r)];case 2:return t=e.sent(),[4,ve.handleLoginResponse(t,s)];case 3:return n=e.sent(),b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Success",eventLabel:"Wix"}}),[2,n];case 4:throw n=e.sent(),b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Failure",eventLabel:"Wix"}}),n;case 5:return[2]}})})},performLogin:function(n,i,o){var r;return(0,Se.mG)(this,void 0,Promise,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return[4,ge("/_api/wix-sm-webapp/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json",authorization:_||""},body:JSON.stringify({email:n,password:i,recaptchaToken:null==o?void 0:o.recaptchaToken})})];case 1:return[2,{member:(t=e.sent()).member,token:null===(r=null==t?void 0:t.session)||void 0===r?void 0:r.token}]}})})},handleOauthToken:function(r,s,a,u,c){return void 0===c&&(c=!1),(0,Se.mG)(this,void 0,Promise,function(){var t,n,i,o;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return t=l.getVisitorId(),p.interactionStarted(Pe.SE.SOCIAL_APP_LOGIN),b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Submit",eventLabel:s}}),[4,ge(Y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({svSession:E,visitorId:t,token:r,provider:s,mode:a,lang:d.userLanguage,privacyStatus:u})})];case 1:if(o=e.sent(),t=o.errorCode,o=o.payload,t)throw b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Failure",eventLabel:s}}),t;return p.interactionEnded(Pe.SE.SOCIAL_APP_LOGIN),o.smSession&&(i=o.smSession.siteMemberDto,n=o.smSession.sessionToken),i=o.siteMemberDto,o=(0,ke.Ky)(i),[4,ve.handleLoginResponse({member:o,token:n},c)];case 2:return o=e.sent(),b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Success",eventLabel:s}}),[2,o]}})})},handleSocialLoginResponse:function(o,r,s){return void 0===s&&(s=!1),(0,Se.mG)(this,void 0,Promise,function(){var t,n,i;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return p.interactionStarted(Pe.SE.SOCIAL_APP_LOGIN),p.interactionEnded(Pe.SE.SOCIAL_APP_LOGIN),b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Submit",eventLabel:r}}),o.smSession&&(n=o.smSession.siteMemberDto,t=o.smSession.sessionToken),n=o.siteMemberDto,i=(0,ke.Ky)(n),[4,ve.handleLoginResponse({member:i,token:t},s)];case 1:return i=e.sent(),b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Success",eventLabel:r}}),[2,i]}})})},handleLoginResponse:function(e,i){var o=e.token,r=e.member;return void 0===i&&(i=!1),(0,Se.mG)(this,void 0,Promise,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return t=r.emailVerified,o||t||"ACTIVE"!==r.status?[3,2]:[4,ve.showConfirmationEmailDialog(r.id)];case 1:return e.sent(),[2,(0,ke.Y_)()];case 2:return o?[3,5]:[4,f()];case 3:return n=e.sent(),[4,ve.showNotificationDialog("",(n("siteMembersTranslations","SMApply_Success1","Success! Your member signup request has been sent and is awaiting approval.")+" "+n("siteMembersTranslations","SMApply_Success2","The site administrator will notify you via email ({0}) once your request has been approved.")).replace("{0}",r.loginEmail),n("siteMembersTranslations","SMContainer_OK","OK"))];case 4:return e.sent(),[2,(0,ke.Y_)()];case 5:return[4,ve.applySessionToken(o,r,i)];case 6:return n=e.sent(),[2,(0,Se.pi)({sessionToken:o,member:r},i?{pages:n}:{})]}})})},promptLogin:function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var i=(e=void 0===e?{}:e).mode,e=e.modal?"popup":"fullscreen";return"login"===(null!=i?i:H)?ve.showLoginDialog(t,e,n):ve.showSignUpDialog(t,e,n)},promptForgotPassword:function(i){return void 0===i&&(i=!0),new Promise(function(n,e){fe.assignRequestAuthenticationRejection(e);var t={isCloseable:i},e={onCloseDialogCallback:function(){de.closingDialog("RequestResetPassword"),he.hideDialog(),fe.rejectAuthenticationRequest()},onSubmitCallback:function(e){var t=this;return ve.sendForgotPasswordMail(e).then(function(){return(0,Se.mG)(t,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return t=e.sent(),ve.showNotificationDialog(t("siteMembersTranslations","siteMembersTranslations_RESET_PASSWORD_CHECKEMAIL_TITLE","Please Check Your Email"),t("siteMembersTranslations","siteMembersTranslations_RESET_PASSWORD_CHECKEMAIL_TEXT","Weâ€™ve emailed you a link to reset your password."),t("siteMembersTranslations","siteMembersTranslations_Reset_Password_OK","Got It")),n(),[2]}})})})}};he.displayDialog("RequestPasswordResetDialog",t,e)})},requestAuthentication:function(n){return void 0===n&&(n={}),(0,Se.mG)(this,void 0,Promise,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:if(se)return[2,{success:!0,token:se,reason:Pe.$9.ALREADY_LOGGED_IN}];e.label=1;case 1:return e.trys.push([1,3,,4]),t=!T,[4,ve.promptLogin(n,t)];case 2:return[2,{success:!0,token:e.sent().sessionToken,reason:Pe.$9.SUCCESS}];case 3:return[2,{success:!1,reason:e.sent()}];case 4:return[2]}})})},requestAuthorizedPages:function(i){return void 0===i&&(i={}),(0,Se.mG)(this,void 0,Promise,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return oe?(n={success:!0},[4,ve.authorizeMemberPagesBySignedInstance(oe)]):[3,2];case 1:return[2,(n.pages=e.sent(),n)];case 2:return e.trys.push([2,4,,5]),t=!T,[4,ve.promptLogin(i,t,!0)];case 3:return[2,{success:!0,pages:e.sent().pages}];case 4:return[2,{success:!1,reason:e.sent()}];case 5:return[2]}})})},applySessionToken:function(o,r,s){return void 0===s&&(s=!1),(0,Se.mG)(this,void 0,Promise,function(){var t,n,i;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return p.interactionStarted(Pe.SE.VERIFY_TOKEN),[4,ge(q,{method:"POST",body:"token="+o})];case 1:if(n=e.sent(),t=n.payload,n=n.errorCode)throw n;return p.interactionEnded(Pe.SE.VERIFY_TOKEN),[4,l.loadNewSession({reason:"memberLogin"})];case 2:return e.sent(),[4,ve.getSmToken()];case 3:return oe=e.sent(),se=o,null==r?[3,4]:(i=r,[3,6]);case 4:return[4,ve.getMemberDetails()];case 5:i=e.sent(),e.label=6;case 6:return re=i,[4,Promise.all(Object.values(ce).map(function(n){return(0,Se.mG)(void 0,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),p.captureError(t,{tags:{feature:"site-members"}}),[3,3];case 3:return[2]}})})}))];case 7:return e.sent(),s?[2,t.pages]:[2]}})})},getSmToken:function(){return(0,Se.mG)(this,void 0,Promise,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return[4,i.envFetch(z).then(function(e){return e.json()})];case 1:return t=e.sent().clientSpecMap,[2,Object.values(t).find(function(e){return"sitemembers"===e.type}).smtoken]}})})},authorizeMemberPagesByCookie:function(){return(0,Se.mG)(this,void 0,Promise,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return t=(0,we.yF)(a)?{headers:{cookie:"smSession="+y}}:void 0,[4,ge(B,t)];case 1:if(n=e.sent(),t=n.authorizedPages,n=n.errorCode)throw n;return[2,t]}})})},authorizeMemberPagesByToken:function(i){return(0,Se.mG)(this,void 0,Promise,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return i===y?[2,this.authorizeMemberPagesByCookie()]:[4,ge(q,{method:"POST",body:"token="+i})];case 1:if(n=e.sent(),t=n.payload,n=n.errorCode)throw n;return[2,t.pages]}})})},authorizeMemberPagesBySignedInstance:function(i){return(0,Se.mG)(this,void 0,Promise,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return[4,ge(B,{headers:{authorization:i}})];case 1:if(n=e.sent(),t=n.authorizedPages,n=n.errorCode)throw n;return[2,t]}})})},getMemberDetails:function(i){return void 0===i&&(i=!1),(0,Se.mG)(this,void 0,Promise,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return!re.id||i?[3,1]:[2,re];case 1:return oe?[4,ge("/_api/wix-sm-webapp/member/"+oe+"?collectionId="+k+"&metaSiteId="+x)]:[3,5];case 2:if(n=e.sent(),t=n.payload,n=n.errorCode)throw n;return re=(0,ke.Ky)(t),i?[4,Promise.all(Object.values(me).map(function(n){return(0,Se.mG)(void 0,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),p.captureError(t,{tags:{feature:"site-members"}}),[3,3];case 3:return[2]}})})}))]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2,re];case 5:return[2,null]}})})},register:function(u,c,l,d,m,g,h){return(0,Se.mG)(this,void 0,Promise,function(){var t,n,i,o,r,s,a;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:g=null!=g&&g,e.label=1;case 1:return e.trys.push([1,10,,11]),p.interactionStarted(Pe.SE.CODE_SIGNUP),b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Sign up Submit",eventLabel:"Wix"}}),t={email:u,password:c,profilePrivacyStatus:d,contactInfo:(0,ke.t1)(l||{}),defaultFlow:m,recaptchaToken:h},[4,ge("/_api/wix-sm-webapp/v1/auth/signup",{method:"POST",headers:{"Content-Type":"application/json",authorization:_||""},body:JSON.stringify(t)})];case 2:return o=e.sent(),n=o.member,i=o.approvalToken,r=o.session,s=n.emailVerified,o=null==r?void 0:r.token,r="ACTIVE"===(null==n?void 0:n.status)?"ACTIVE":"PENDING",o||s||"ACTIVE"!==n.status?[3,4]:[4,ve.showConfirmationEmailDialog(n.id)];case 3:return e.sent(),p.interactionEnded(Pe.SE.CODE_SIGNUP),[2,{member:n,status:r}];case 4:return m&&"APPLICANT"===(null==n?void 0:n.status)||!o?[4,f()]:[3,7];case 5:return s=e.sent(),[4,ve.showNotificationDialog("",(s("siteMembersTranslations","SMApply_Success1","Success! Your member login request has been sent and is awaiting approval.")+" "+s("siteMembersTranslations","SMApply_Success2","The site administrator will notify you via email ({0}) once your request has been approved.")).replace("{0}",u),s("siteMembersTranslations","SMContainer_OK","OK"))];case 6:return e.sent(),p.interactionEnded(Pe.SE.CODE_SIGNUP),[2,{member:n,status:r,approvalToken:i}];case 7:return[4,ve.applySessionToken(o,n,g)];case 8:return a=e.sent(),p.interactionEnded(Pe.SE.CODE_SIGNUP),b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Sign up Success",eventLabel:"Wix"}}),b.trackEvent({eventName:"CompleteRegistration",params:{origin:"Site members",method:"Wix"}}),[2,(0,Se.pi)({member:n,status:r,sessionToken:o},g&&a?{pages:a}:{})];case 9:return[3,11];case 10:throw a=e.sent(),b.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Sign up Failure",eventLabel:"Wix"}}),(0,ke.fJ)(a)&&p.interactionEnded(Pe.SE.CODE_SIGNUP),a;case 11:return[2]}})})},sendForgotPasswordMail:function(o){return(0,Se.mG)(this,void 0,void 0,function(){var t,n,i;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return p.interactionStarted(Pe.SE.RESET_PASSWORD),t=d.userLanguage,n=encodeURIComponent(F),i=encodeURIComponent(o),[4,ge("/_api/wix-sm-webapp/member/sendForgotPasswordMail",{method:"POST",body:"returnUrl="+n+"&collectionId="+k+"&metaSiteId="+x+"&lang="+t+"&email="+i})];case 1:if(i=e.sent().errorCode)throw i;return p.interactionEnded(Pe.SE.RESET_PASSWORD),[2]}})})},sendSetPasswordEmail:function(i,o){return void 0===o&&(o=!1),(0,Se.mG)(this,void 0,Promise,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return[4,ge("/_api/wix-sm-webapp/members/v1/auth/members/send-set-password-email",{method:"POST",headers:{"Content-Type":"application/json",authorization:_||""},body:JSON.stringify({email:i,hideIgnoreMessage:o})})];case 1:if(n=e.sent(),t=n.payload,n=n.errorCode)throw n;return[2,t.accepted]}})})},changePassword:function(n,i){return(0,Se.mG)(this,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return t=encodeURIComponent(n),[4,ge(K,{method:"POST",body:"newPassword="+t+"&forgotPasswordToken="+i})];case 1:if(t=e.sent().errorCode)throw t;return[2]}})})},resendEmailVerification:function(n){return(0,Se.mG)(this,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return[4,ge("/_api/wix-sm-webapp/tokens/email/resend/"+n)];case 1:if(t=e.sent().errorCode)throw t;return[2]}})})},logout:function(n){return(0,Se.mG)(this,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return oe?[4,ge(V,{method:"POST"})]:[2];case 1:return e.sent(),[4,Promise.all(Object.values(le).map(function(n){return(0,Se.mG)(void 0,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),p.captureError(t,{tags:{feature:"site-members"}}),[3,3];case 3:return[2]}})})}))];case 2:return e.sent(),n?(t="./"+n.replace(/^\//,""),[4,u.navigate(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return(0,we.yF)(a)||a.document.location.reload(),[2]}})})},registerToUserLogin:function(e){var t=(0,Ce.uniqueId)("callback");return ce[t]=e,t},unRegisterToUserLogin:function(e){delete ce[e]},registerToMemberLogout:function(e){var t=(0,Ce.uniqueId)("logout_callback");return le[t]=e,t},unRegisterToMemberLogout:function(e){delete le[e]},registerToMemberDetailsRefresh:function(e){var t=(0,Ce.uniqueId)("mdrcb");return me[t]=e,t},unRegisterToMemberDetailsRefresh:function(e){delete me[e]},showWelcomeDialog:function(o){return void 0===o&&(o=!0),(0,Se.mG)(this,void 0,void 0,function(){var t,n,i;return(0,Se.Jh)(this,function(e){return t={isCloseable:o},n=m.getParsedUrl(),i={onCloseDialogCallback:function(){de.closingDialog("WelcomeDialog");var e=new URL(r.requestUrl).hostname,e=0===e.indexOf("www")?e.substr(3):e;be("sm_ef","/",e),A="",he.hideDialog(),u.navigate(n.href)},onSubmitCallback:function(){var e=new URL(r.requestUrl).hostname,e=0===e.indexOf("www")?e.substr(3):e;be("sm_ef","/",e),A="",he.hideDialog(),N&&u.navigate("./account/my-account"),u.navigate(n.href)}},he.displayDialog("WelcomeDialog",t,i),[2]})})},showNoPermissionsToPageDialog:function(n){return(0,Se.mG)(this,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){return t={onCloseDialogCallback:function(){he.hideDialog(),n&&n()},onSwitchAccountLinkClick:function(){ve.logout()}},he.displayDialog("NoPermissionsToPageDialog",{},t),[2]})})},showResetPasswordDialog:function(s,n){return void 0===n&&(n=!1),(0,Se.mG)(this,void 0,void 0,function(){var r,t;return(0,Se.Jh)(this,function(e){return r={isCloseable:!0},t={onCloseDialogCallback:function(){de.closingDialog("ResetPasswordDialog");var e=m.getParsedUrl();e.searchParams.delete("forgotPasswordToken"),e.searchParams.delete("forgotPasswordLang"),m.pushUrlState(e),he.hideDialog(),u.navigate(e.href)},onSubmitCallback:function(o){return(0,Se.mG)(this,void 0,void 0,function(){var t,n,i=this;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return[4,f()];case 1:t=e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,ve.changePassword(o,s)];case 3:return e.sent(),ve.showNotificationDialog(t("siteMembersTranslations","siteMembersTranslations_Reset_Password_Sucess_Title","Your password has been changed."),"",t("siteMembersTranslations","SMContainer_OK","OK"),function(){return(0,Se.mG)(i,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return(t=m.getParsedUrl()).searchParams.delete("forgotPasswordToken"),t.searchParams.delete("forgotPasswordLang"),m.pushUrlState(t),[4,ve.showLoginDialog()];case 1:return e.sent(),u.navigate(t.href),[2]}})})}),[3,5];case 4:if(-19972!==(n=e.sent()))throw n;return ve.showNotificationDialog(t("siteMembersTranslations","siteMembersTranslations_PASSWORD_HAS_EXPIRED_TITLE","Your link to create a new password has expired"),t("siteMembersTranslations","siteMembersTranslations_PASSWORD_HAS_EXPIRED_TEXT","To continue, resend a new link to your email."),t("siteMembersTranslations","siteMembersTranslations_PASSWORD_HAS_EXPIRED_OK","Resend Link"),function(){return ve.promptForgotPassword(r.isCloseable).then(function(){var e=m.getParsedUrl();u.navigate(e.href)})}),[3,5];case 5:return[2]}})})}},he.displayDialog("ResetPasswordDialog",r,t,n?{}:P()),[2]})})},showLoginDialog:function(r,s,a){return void 0===r&&(r=!0),void 0===s&&(s="fullscreen"),void 0===a&&(a=!1),(0,Se.mG)(this,void 0,Promise,function(){var t=this;return(0,Se.Jh)(this,function(e){return ne&&null!=v&&v.isPopupPage(ne)?[2,ve.showCustomAuthenticationDialog(ne,a)]:[2,new Promise(function(i,o){return(0,Se.mG)(t,void 0,void 0,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return fe.assignRequestAuthenticationRejection(o),t={displayMode:s,language:d.userLanguage,isCloseable:r,smCollectionId:k,svSession:E,biVisitorId:M,metaSiteId:x,isSocialLoginGoogleEnabled:X,isSocialLoginFacebookEnabled:!R&&$,isEmailLoginEnabled:!R,isSocialAuthSupported:j,useGoogleSdk:pe},n={onCloseDialogCallback:function(){he.hideDialog(),de.closingDialog("MemberLoginDialog",s),fe.rejectAuthenticationRequest()},submit:function(e,t,n){return p.interactionStarted(Pe.SE.DEFAULT_LOGIN),de.emailAuthSubmitClicked("MemberLoginDialog",s),ve.login(e,t,n,a).then(function(e){p.interactionEnded(Pe.SE.DEFAULT_LOGIN),he.hideDialog(),i(e)}).catch(function(e){throw(0,ke.Y2)(e)&&p.interactionEnded(Pe.SE.DEFAULT_LOGIN),e})},onForgetYourPasswordClick:function(){ve.promptForgotPassword(r)},onSwitchDialogLinkClick:function(){ve.showSignUpDialog(r,s).then(i,function(){fe.rejectAuthenticationRequest()})},onTokenMessage:function(e,t,n){return ve.handleOauthToken(e,t,"memberLoginDialog",(n=void 0===n?!1:n)?"PUBLIC":"PRIVATE",a).then(function(e){he.hideDialog(),i(e)})},onBackendSocialLogin:function(e,t){return ve.handleSocialLoginResponse(e,t,a).then(function(e){he.hideDialog(),i(e)})},getHostReadyPayload:function(){return{visitorId:M,svSession:E}}},de.loginOrSignUpDialogLoaded("MemberLoginDialog",s),[4,he.displayDialog("MemberLoginDialog",t,n,P())];case 1:return e.sent(),ve.closeCustomAuthenticationDialogs(!0),[2]}})})})]})})},showSignUpDialog:function(r,s,a){return void 0===r&&(r=!0),void 0===s&&(s="fullscreen"),void 0===a&&(a=!1),(0,Se.mG)(this,void 0,Promise,function(){var t=this;return(0,Se.Jh)(this,function(e){return te&&null!=v&&v.isPopupPage(te)?[2,ve.showCustomAuthenticationDialog(te,a)]:[2,new Promise(function(o,i){return(0,Se.mG)(t,void 0,void 0,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return fe.assignRequestAuthenticationRejection(i),t={displayMode:s,language:d.userLanguage,isCloseable:r,smCollectionId:k,biVisitorId:M,svSession:E,metaSiteId:x,isSocialLoginGoogleEnabled:X,isSocialLoginFacebookEnabled:!R&&$,isSocialAuthSupported:j,isEmailLoginEnabled:!R,isCommunityInstalled:L,joinCommunityCheckedByDefault:ie,isTermsOfUseNeeded:!(null==Q||!Q.enabled||!G.termsOfUse),isPrivacyPolicyNeeded:!(null==Z||!Z.enabled||!G.privacyPolicy),isCodeOfConductNeeded:!(null==ee||!ee.enabled||!G.codeOfConduct),termsOfUseLink:G.termsOfUse,privacyPolicyLink:G.privacyPolicy,codeOfConductLink:G.codeOfConduct,useGoogleSdk:pe},n={onCloseDialogCallback:function(){he.hideDialog(),de.closingDialog("SignUpDialog",s),fe.rejectAuthenticationRequest()},submit:function(e,t,n){var i="boolean"==typeof n?n:n.isCommunityChecked,n="boolean"==typeof n||null==n?void 0:n.recaptchaToken;p.interactionStarted(Pe.SE.DEFAULT_SIGNUP),de.emailAuthSubmitClicked("SignUpDialog",s);i=i?Pe.iY.PUBLIC:Pe.iY.PRIVATE;return ve.register(e,t,void 0,i,void 0,a,n).then(function(e){p.interactionEnded(Pe.SE.DEFAULT_SIGNUP);var t=e.member,n=e.sessionToken,e=e.pages;n&&(he.hideDialog(),o((0,Se.pi)({member:t,sessionToken:n},a?{pages:e}:{})))}).catch(function(e){throw(0,ke.fJ)(e)&&p.interactionEnded(Pe.SE.DEFAULT_SIGNUP),e})},onSwitchDialogLinkClick:function(){ve.showLoginDialog(r,s,a).then(o,function(){fe.rejectAuthenticationRequest()})},onTokenMessage:function(e,t,n){return ve.handleOauthToken(e,t,"memberLoginDialog",(n=void 0===n?!1:n)?"PUBLIC":"PRIVATE",a).then(function(e){he.hideDialog(),o(e)})},onBackendSocialLogin:function(e,t){return ve.handleSocialLoginResponse(e,t,a).then(function(e){he.hideDialog(),o(e)})},getHostReadyPayload:function(){return{visitorId:M,svSession:E}}},de.loginOrSignUpDialogLoaded("SignUpDialog",s),[4,he.displayDialog("SignUpDialog",t,n,P())];case 1:return e.sent(),ve.closeCustomAuthenticationDialogs(!0),[2]}})})})]})})},showNotificationDialog:function(i,o,r,s,a){return void 0===s&&(s=function(){return 0}),void 0===a&&(a=function(){return 0}),(0,Se.mG)(this,void 0,void 0,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return t={isCloseable:!0,title:i,description:o,okButtonText:r},n={onCloseDialogCallback:function(){de.closingDialog("NotificationDialog"),he.hideDialog(),a()},onOkButtonClick:function(){he.hideDialog(),s()}},[4,he.displayDialog("NotificationDialog",t,n)];case 1:return e.sent(),[2]}})})},showConfirmationEmailDialog:function(i,o){return void 0===o&&(o=!0),(0,Se.mG)(this,void 0,void 0,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return t={isCloseable:!0,isSignUp:o},n={onCloseDialogCallback:function(){de.closingDialog("ConfirmationEmailDialog"),he.hideDialog()},onResendConfirmationEmail:function(){return(0,Se.mG)(this,void 0,void 0,function(){return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return[4,ve.resendEmailVerification(i)];case 1:return e.sent(),[4,ve.showConfirmationEmailDialog(i,!1)];case 2:return e.sent(),[2]}})})}},[4,he.displayDialog("ConfirmationEmailDialog",t,n)];case 1:return e.sent(),[2]}})})},showCustomAuthenticationDialog:function(a,u){return void 0===u&&(u=!1),(0,Se.mG)(this,void 0,Promise,function(){var t=this;return(0,Se.Jh)(this,function(e){if(!v)throw new Error("popup unavailable");return[2,new Promise(function(s,n){return(0,Se.mG)(t,void 0,void 0,function(){var r,t=this;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return r=ve.registerToUserLogin(function(){return(0,Se.mG)(t,void 0,void 0,function(){var t,n,i,o;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return t=s,n=[{member:re,sessionToken:se}],u?(o={},[4,ve.authorizeMemberPagesBySignedInstance(oe)]):[3,2];case 1:return o.pages=e.sent(),i=o,[3,3];case 2:i={},e.label=3;case 3:return t.apply(void 0,[Se.pi.apply(void 0,n.concat([i]))]),ve.unRegisterToUserLogin(r),v.getCurrentPopupId()===a&&v.closePopupPage(),[2]}})})}),[4,fe.openPopupPage(a,n,function(){ve.unRegisterToUserLogin(r)})];case 1:return e.sent(),he.hideDialog(),[2]}})})})]})})},closeCustomAuthenticationDialogs:function(n){return void 0===n&&(n=!1),(0,Se.mG)(this,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return(t=null==v?void 0:v.getCurrentPopupId())&&[te,ne].includes(t)?(n&&fe.preventCustomPopupCloseCallback(),[4,v.closePopupPage()]):[3,2];case 1:e.sent(),fe.allowCustomPopupCloseCallback(),e.label=2;case 2:return[2]}})})},getForgotPasswordToken:function(){return new URL((0,we.yF)(a)?r.requestUrl:location.href).searchParams.get("forgotPasswordToken")},shouldDisplayWelcomeDialog:function(){return A&&N},appWillMount:function(){switch(new URL(r.requestUrl).searchParams.get("showDialog")){case"MemberLoginDialog":ve.showLoginDialog();break;case"SignUpDialog":ve.showSignUpDialog();break;case"RequestPasswordResetDialog":ve.promptForgotPassword();break;case"ResetPasswordDialog":ve.showResetPasswordDialog("faketoken",!0);break;case"WelcomeDialog":ve.showWelcomeDialog();break;case"NoPermissionsToPageDialog":ve.showNoPermissionsToPageDialog();break;case"NotificationDialog":ve.showNotificationDialog("title","description","ok");break;case"ConfirmationEmailDialog":ve.showConfirmationEmailDialog("fakemember")}},pageWillUnmount:function(e){e=e.pageId;[te,ne].includes(e)||he.hideDialog()},getSocialAuthComponentProps:function(){return(0,ke.IO)({config:e,viewerModel:r,sessionManager:l,handleOauthToken:ve.handleOauthToken,handleSocialLoginResponse:ve.handleSocialLoginResponse,isSocialAuthSupported:W})}};return n.update(function(){return{shouldShowRenderingBlockingDialogs:function(){return!(!ve.getForgotPasswordToken()&&!ve.shouldDisplayWelcomeDialog())},showRenderingBlockingDialogs:function(){var e=ve.getForgotPasswordToken();return e?ve.showResetPasswordDialog(e):ve.shouldDisplayWelcomeDialog()?ve.showWelcomeDialog():void 0}}}),ve}),C=n(59032),P=n(95793),D=n(81600),k=(0,i.ff)([b.n9],function(o){return{getTpaHandlers:function(){function e(e,t,i){return(0,Se.mG)(n,void 0,Promise,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return[4,o.getMemberDetails()];case 1:return(t=e.sent())?null!==(n=i.appClientSpecMapData)&&void 0!==n&&n.isWixTPA?[2,{attributes:{firstName:null!==(n=t.firstName)&&void 0!==n?n:"",lastName:null!==(n=t.lastName)&&void 0!==n?n:"",privacyStatus:t.profilePrivacyStatus},name:t.memberName,email:t.loginEmail,id:t.id,owner:t.owner,status:t.status}]:[2,{id:t.id,owner:t.owner,status:t.status}]:[2,null]}})})}function t(e,i){return void 0===i&&(i={}),(0,Se.mG)(n,void 0,Promise,function(){var t,n;return(0,Se.Jh)(this,function(e){switch(e.label){case 0:return[4,o.promptLogin({mode:i.mode,modal:i.modal})];case 1:return t=e.sent().member,[2,{attributes:{firstName:null!==(n=t.firstName)&&void 0!==n?n:"",lastName:null!==(n=t.lastName)&&void 0!==n?n:"",privacyStatus:t.profilePrivacyStatus},name:t.memberName,email:t.loginEmail,id:t.id,owner:t.owner,status:t.status}]}})})}var n=this;return{currentMember:e,smCurrentMember:e,logOutCurrentMember:(0,D.u)(["site"],function(e,t){o.logout(null==t?void 0:t.url)}),requestLogin:(0,D.u)(["site"],t),smRequestLogin:(0,D.u)(["site"],t)}}}}),E=(0,i.ff)([b.n9,(0,i.t6)(o.$e,b.u2),a.xP],function(i,e,n){var o=e.componentIds;return{pageWillMount:function(){return(0,Se.mG)(this,void 0,void 0,function(){var t;return(0,Se.Jh)(this,function(e){return t=o.reduce(function(e,t){var n=i.getSocialAuthComponentProps();return(0,Se.pi)((0,Se.pi)({},e),((e={})[t]=n,e))},{}),n.update(t),[2]})})}}}),y=(0,i.ff)([(0,i.t6)(o.Wf,b.u2)],function(o){return{handle:function(i){return(0,Se.mG)(void 0,void 0,void 0,function(){var t,n;return(0,Se.Jh)(this,function(e){return n=o.get(),t=n.shouldShowRenderingBlockingDialogs,n=n.showRenderingBlockingDialogs,t()?(n(),[2,null]):[2,i]})})}}}),T=function(e){e(b.n9,C.j.AppWillMountHandler,C.j.AppDidMountHandler).to(w),e(h.BD.BlockingDialogs).to(y)},L=function(e){e(P.g).to(k),e(C.j.PageWillMountHandler).to(E),e(C.j.PageWillUnmountHandler).to((0,i.ff)([b.n9],function(t){return{pageWillUnmount:function(e){return t.pageWillUnmount(e)}}}))};function I(e){this.shouldRunCustomPopupCloseCallback=!0,this.popups=e}function A(e,t,n){this.propsStore=e,this.structureApi=t,this.siteScrollBlocker=n}}}]);
