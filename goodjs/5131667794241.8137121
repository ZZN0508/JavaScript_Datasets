window._sinaereIsInited=window._sinaereIsInited||function(l){"use strict";var f,u,s,c,t,i,d=(i="function"==typeof l.setImmediate?function(e){l.setImmediate(e)}:function(e){l.setTimeout(e,0)},y.prototype={syncModeEnabled:!1,resolve:function(){"pending"===this.state&&(this.state="resolved",this._args=[].slice.call(arguments),r(this))},reject:function(){"pending"===this.state&&(this.state="rejected",this._args=[].slice.call(arguments),r(this))},done:function(e){return this.then(e)},fail:function(e){return this.then(null,e)},then:function(e,t){var n=new y;return n.syncModeEnabled=this.syncModeEnabled,this._doneCallbacks.push(o(this,n,e,"resolve")),this._failCallbacks.push(o(this,n,t,"reject")),r(this),n.promise}},y.isPromise=function(e){return e&&"function"==typeof e.then},y.all=function(){function e(e){r--;var t=[].slice.call(arguments,1);t.length<=1&&(t=t[0]),o[e]=t,0===r&&a[i].apply(a,o)}function t(){i="reject",e.apply(this,arguments)}var n=[].concat.apply([],arguments),r=n.length;if(!r)return y.resolved();for(var i="resolve",o=[],a=new y,s=0;s<n.length;s++){var c=n[s];c.then(p.bind(e,c,s),p.bind(t,c,s))}return a.promise},y.resolved=function(){var e=new y;return e.resolve.apply(e,arguments),e.promise},y.rejected=function(){var e=new y;return e.reject.apply(e,arguments),e.promise},y.when=function(e){if(y.isPromise(e))return e;var t=new y;return t.syncModeEnabled=!0,t.resolve(e),t.promise},y),p=(c={},t=Function.prototype.bind,c.bind=t?function(e){return t.apply(e,[].slice.call(arguments,1))}:function(t,n){var r=[].slice.call(arguments,2);return function(){var e=r.concat([].slice.call(arguments));return t.apply(n,e)}},c.noop=function(){},c.sio=c.sio||{jsonp:function(e,t){function n(t){return function(){try{t?i.reject():(i.resolve.apply(i,arguments),clearTimeout(r)),l[a]=null,delete l[a]}catch(e){}finally{(e=o)&&e.parentNode&&e.parentNode.removeChild(e)}var e}}var r,i=new d,o=document.createElement("SCRIPT"),a="ere_callback"+Math.floor(2147483648*Math.random()).toString(36),s=t||{},c=s.charset||"utf-8",u=s.queryField||"callback",t=s.timeout||0,s=new RegExp("(\\?|&)"+u+"=([^&]*)");return l[a]=n(0),t&&(r=setTimeout(n(1),t)),(e=e.replace(s,"$1"+u+"="+a)).search(s)<0&&(e+=(e.indexOf("?")<0?"?":"&")+u+"="+a),u=e,e=c,(c=o).setAttribute("type","text/javascript"),e&&c.setAttribute("charset",e),c.setAttribute("src",u),document.getElementsByTagName("head")[0].appendChild(c),i},log:function(e,t){var n=new Image,r="_ere_sio_log_"+Math.floor(2147483648*Math.random()).toString(36);(l[r]=n).onload=n.onerror=n.onabort=function(){n.onload=n.onerror=n.onabort=null,l[r]=null,n=null},n.src=e+(t?"":(0<e.indexOf("?")?"&":"?")+r)},serilize:function(e){var t,n=[];for(t in e)e[t]&&n.push(t+"="+encodeURIComponent(e[t]));return n.join("&")}},c.url=c.url||{top:function(){var e;try{e=l.top.location.href}catch(e){}return e||(l.top===l.self?l.location.href:l.document.referrer)}()},c.cookie=c.cookie||{_isValidKey:function(e){return new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(e)},_getRaw:function(e){if(c.cookie._isValidKey(e)){e=new RegExp("(^| )"+e+"=([^;]*)(;|$)").exec(document.cookie);if(e)return e[2]||null}return null},_setRaw:function(e,t,n){var r;c.cookie._isValidKey(e)&&(r=(n=n||{}).expires,"number"==typeof n.expires&&(r=new Date).setTime(r.getTime()+n.expires),document.cookie=e+"="+t+(n.path?"; path="+n.path:"")+(r?"; expires="+r.toGMTString():"")+(n.domain?"; domain="+n.domain:"")+(n.secure?"; secure":""))},get:function(e){e=c.cookie._getRaw(e);return"string"==typeof e?decodeURIComponent(e):null},set:function(e,t,n){c.cookie._setRaw(e,encodeURIComponent(t),n)},remove:function(e,t){(t=t||{}).expires=new Date(0),c.cookie._setRaw(e,"",t)}},c.json=c.json||{parse:function(e){return new Function("return ("+e+")")()},stringify:(s={"\b":"\\b"," ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},function(e){switch(typeof e){case"undefined":return"undefined";case"number":return isFinite(e)?String(e):"null";case"string":return'"'+(a=/["\\\x00-\x1f]/.test(a=e)?a.replace(/["\\\x00-\x1f]/g,function(e){var t=s[e];return t||(t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))}):a)+'"';case"boolean":return String(e);default:if(null===e)return"null";if(e instanceof Array)return function(e){for(var t,n,r=["["],i=e.length,o=0;o<i;o++)switch(n=e[o],typeof n){case"undefined":case"function":case"unknown":break;default:t&&r.push(","),r.push(c.json.stringify(n)),t=1}return r.push("]"),r.join("")}(e);if(e instanceof Date)return'"'+(a=e).getFullYear()+"-"+v(a.getMonth()+1)+"-"+v(a.getDate())+"T"+v(a.getHours())+":"+v(a.getMinutes())+":"+v(a.getSeconds())+'"';var t,n,r,i=["{"],o=c.json.stringify;for(r in e)if(Object.prototype.hasOwnProperty.call(e,r))switch(n=e[r],typeof n){case"undefined":case"unknown":case"function":break;default:t&&i.push(","),t=1,i.push(o(r)+":"+o(n))}return i.push("}"),i.join("")}var a})},c.iframe=c.iframe||{uid:0,init:function(e,t,n,r){var i=r?'"':"",r=i+"0"+i;e.width=i+t+i,e.height=i+n+i,e.frameborder=r,e.marginwidth=r,e.marginheight=r,e.vspace=r,e.hspace=r,e.allowtransparency=i+"true"+i,e.scrolling=i+"no"+i},createHTML:function(e){var t,n=[];for(t in e.name=e.name||e.id||"sinaere_iframe_uid_"+c.iframe.uid++,e)n.push(" "+t+'="'+(null===e[t]?"":e[t])+'"');return"<iframe"+n.join("")+"></iframe>"}},c),e=(f=p,u=0,function(e){var t=e.element,n=e.params||{};if(t="string"==typeof t?document.getElementById(t):t){if(!h(t)&&!(t=t.id&&m(t.id)))return;if(!("innerHTML"in t))return}else if(!(t=m()))return;t.setAttribute("data-status","done"),n.uid=u++;for(var r,i=t.attributes,o=i.length,a=0;a<o;a++){var s,c=i[a];/data-/.test(c.nodeName)&&(s=c.nodeName.replace("data-","").replace(/-/g,"_"),n.hasOwnProperty(s)||(n[s]=c.value))}n.page_url=p.url.top,r=l._ereData||{},e={rfunc:107,cre:"ad_business",mod:"g",merge:3,statics:1,cateid:"carshopping",offset:0,multi_func:2,length:n.num},((r=r[[n.tpl,n.w,n.h].join("_")])?d.resolved(r):p.sio.jsonp("//cre.mix.sina.com.cn/api/v3/get?"+p.sio.serilize(e),{rfunc:107,cre:"ad_business",mod:"g",merge:3,statics:1,cateid:"carshopping",offset:0,multi_func:2,length:e.num},{timeout:5e3})).done(function(e){e.referrer=p.url.top,e.pos=n.pos||"",g(t,e,n)}).fail(function(){console.log("fail")})}),n=l.sinaere;function h(e){return/(^| )sinaere($| )/.test(e.className)&&"done"!==e.getAttribute("data-status")}function m(e){for(var t,n=document.getElementsByTagName("ins"),r=0,i=n.length,o=n[r];r<i;o=n[++r])if(h(o)&&(!e&&(t=o,!/(^| )sinaere($| )/.test(t.className)||"async"!==t.getAttribute("data-status"))||o.id===e))return o;return null}function g(e,t,n){if(t&&t.data&&t.data.length){for(var r,i=0,o=t.uid;r=t.data[i++];)!function(e,t,n){var r,i={cbrand:t.cbrand,country:t.country,cprice:t.cprice,cseries:t.cseries,ctype:t.ctype},o=[];for(r in i)i[r]&&o.push(r+"="+i[r]);t={type:"recmd_ad_exposure",ad_url:t.url,ad_pos:n.pos||"",host_url:p.url.top,uid:e,sinaglobal:p.cookie.get("SINAGLOBAL"),time:+new Date,features:t.meta||o.join("&")},f.sio.log("//slog.sina.com.cn/b.gif?"+p.sio.serilize(t))}(o,r,n);var a=parseInt(n.w,10),s=parseInt(n.h,10),c="//d"+Math.floor(0+10*Math.random())+".sina.com.cn/litong/zhitou/sinaads/test/e-recommendation/tpl/"+["eretpl",n.tpl,a,s].join("_")+".html?"+ +new Date;e.style.cssText+=";display:block;overflow:hidden;text-decoration:none;",e.innerHTML='<ins style="text-decoration:none;margin:0px auto;display:block;overflow:hidden;width:'+a+"px;height:"+s+'px;"></ins>',e=e.getElementsByTagName("ins")[0];var u={};p.iframe.init(u,a,s,!1),u.src=c,u.name=encodeURIComponent(p.json.stringify(t)),e.innerHTML=f.iframe.createHTML(u)}}function v(e){return e<10?"0"+e:e}function r(n){function e(){for(var e=0;e<r.length;e++){var t=r[e];try{t.apply(n.promise,n._args)}catch(e){}}}var r;"pending"!==n.state&&(r=("resolved"===n.state?n._doneCallbacks:n._failCallbacks).slice(),n.syncModeEnabled?e():i(e),n._doneCallbacks=[],n._failCallbacks=[])}function o(n,r,i,o){return function(){if("function"==typeof i){var t=r.resolver;try{var e=i.apply(n.promise,arguments);y.isPromise(e)?e.then(t.resolve,t.reject):t.resolve(e)}catch(e){t.reject(e)}}else r[o].apply(r,n._args)}}function y(){this.state="pending",this._args=null,this._doneCallbacks=[],this._failCallbacks=[],this.promise={done:p.bind(this.done,this),fail:p.bind(this.fail,this),then:p.bind(this.then,this)},this.promise.promise=this.promise,this.resolver={resolve:p.bind(this.resolve,this),reject:p.bind(this.reject,this)}}if(n&&n.shift)for(var a,b=100;(a=n.shift())&&0<b--;)e(a);return l.sinaere={push:e},!0}(window);
