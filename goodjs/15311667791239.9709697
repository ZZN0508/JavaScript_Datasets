"function"==typeof Rmodules.define&&Rmodules.define("R.api.top.wrapped","1.0.0",["jQuery","R^1","R.api^1","R.api.top^1"],function(p,e,t){return function(o){"use strict";o.api.ppfBanner={StatusCode:{SUCCESS:91,NO_DATA:92,MAINTENANCE:81,ERROR:11,PARAMETER_ERROR:21},TargetPage:{PC_TOP:2,SP_TOP:4},DeviceType:{PC:"pc",SP:"sp",SPI:"spi",TABI:"tabi",TABA:"taba",SPIA:"spia",SPAA:"spaa",TABIA:"tabia",TABAA:"tabaa"},ChannelType:{WEB:"web",MAIL:"mail"}};var r={source_id:2,device_type:o.api.ppfBanner.DeviceType.PC,channel_type:o.api.ppfBanner.ChannelType.WEB};o.api.ppfBanner.ResponseData=function(e){this._data={statusCode:e.s,revision:e.r};var t,n,i={},e=e.c||[];p.each(e,function(e,a){i[a.i]=[],t=a.c||[],p.each(t,function(e,t){n=o.getUrlParams(t.l),i[a.i].push({landingUrl:t.l,bannerUrl:t.b,altString:t.a,offerId:n.ppo,contentId:n.ppc})})}),this._data.items=i},o.api.ppfBanner.ResponseData.prototype.getStatusCode=function(){return this._data.statusCode},o.api.ppfBanner.ResponseData.prototype.getRevision=function(){return this._data.revision},o.api.ppfBanner.ResponseData.prototype.getItems=function(e){return this._data.items[e]||[]},o.api.ppfBanner.ResponseData.prototype.getTargetId=function(){return this._data.targetId},o.api.ppfBanner.loadBannerItems=function(e,t){var a,n=p.Deferred(),i={};for(a in r)i[a]=(t&&t.hasOwnProperty(a)?t:r)[a];e=o.extendApiSettings({url:"https://scview-content-high.api.rakuten.co.jp/eh-cont/v2/ichiba",data:i},e||{});return o.requestData(e).fail(n.reject).done(function(e){return e&&e.s===o.api.ppfBanner.StatusCode.SUCCESS?n.resolve(new o.api.ppfBanner.ResponseData(e)):n.reject(e)}),n.promise()}}(e),t}),"function"==typeof Rmodules.define&&Rmodules.define(["jQuery","R^1","R.ui^1","R.api.top.wrapped^1"],function(d,u){"use strict";function e(){var p;d(c.config.configSelector).each(function(e,t){var a,n,i,o,r=d(t.innerHTML);if(r.length){switch(t=r.find(c.config.settingsSelector),(a={global:u.readSettings(t,c.global),api:u.readApiSettings(t,c.api),rat:u.readSettings(t,c.rat),shisa:u.readSettings(t,c.shisa),mock:u.readApiSettings(t.find(c.config.mockSettingsSelector))}).api.deviceType){case u.api.ppfBanner.DeviceType.TABA:case u.api.ppfBanner.DeviceType.TABAA:case u.api.ppfBanner.DeviceType.TABI:case u.api.ppfBanner.DeviceType.TABIA:a.global.itemWidth=157,i=s.TB,o="TB";break;default:a.api.deviceType=u.api.ppfBanner.DeviceType.PC,i=s.PC,o=a.api.deviceType.toUpperCase()}a.global.device=i,a.rat.ratPageType=o,d.map(a.global.defaultContent,function(e,t){var a;e.altString=e.altString||e.a,e.bannerUrl=e.bannerUrl||e.b,e.landingUrl=e.landingUrl||e.l,e.offerId&&e.contentId||(a=u.getUrlParams(e.landingUrl),e.offerId=a.ppo,e.contentId=a.ppc)}),m=m||a.global.waitDom,window.Shisa&&a.shisa.shisaEnabled&&(p={},a.shisa.shisaUrl&&(p.url=a.shisa.shisaUrl),a.shisa.shisaGroup&&(p.group=a.shisa.shisaGroup),a.shisa.shisaSendPercentage&&(p.sendPercentage=a.shisa.shisaSendPercentage),n=new window.Shisa(p)),h.push({$config:r,options:a,shisa:n})}})}function t(){0===h.length&&e(),d.each(h,function(e,a){a.options.global&&a.options.global.enabled&&u.api.ppfBanner.loadBannerItems(d.extend({},a.options.mock),{device_type:a.options.api.deviceType,source_id:a.options.api.sourceId,channel_type:a.options.api.channelType}).fail(function(e){var t=i.API_ERROR_MESSAGE;e.code&&(t+=" ["+e.code+"]"),t+=" on "+a.options.global.target,e.message&&(t+=" ("+e.message+")"),e={fileUrl:i.FILE_URL,type:i.API_ERROR_TYPE,msg:t},t=a.shisa,e=e,t&&t.log(e)}).done(function(e){n=e}).always(function(){!function(e){var t=n&&n.getItems(e.options.global.targetId);if(!t||0===t.length){if(!e.options.global.defaultContent)return d(e.options.global.target).remove();t=e.options.global.defaultContent}e.items=t.slice(0,e.options.global.maxItems||t.length),e.options.global.mode===f.SLIDESHOW||e.options.global.mode===f.BIGBANNER?function(e,t,a,n){var i;n.global.device===s.TB&&(t.addClass(c.css.tabletClass),i=2),new u.ui.Slideshow(t,function(e,t,a){return{itemWidth:parseInt(t.attr("width"),10)||a.global.itemWidth,itemTemplate:{html:t.html(),data:e}}}(function(e,t){return 1<t?function(e,a){var n,t,i=[],o=0;if(d.each(e,function(e,t){n=d.extend(n,r(t,"_"+o)),(o+=1)===a&&(i.push(n),n={},o=0)}),!d.isEmptyObject(n)){for(t=0;o<a;t+=1,o+=1)n=d.extend(n,r(e[t],"_"+o));i.push(n)}return i}(e,t):d.map(e,function(e,t){return r(e)})}(e,i),a,n),function(e,n,i){return d.extend({},u.ui.Slideshow.getPcOptions(),{hideOnEmpty:e,onScrollEnd:function(e,t,a){o(e,n,i,g.IMPRESSION)},afterFirstRender:function(e,t,a){o(e,n,i,g.APPEAR)},onResize:function(e,t,a){o(e,n,i,g.RESIZE)},onOrientationChange:function(e,t,a){o(e,n,i,g.RESIZE)},autoScroll:i.global.autoPlay,autoScrollDelay:i.global.autoPlayDelay,autoScrollPauseOnBg:i.global.autoPlayPauseOnBg,autoScrollPauseOnHover:i.global.autoPlayPauseOnHover},l[i.global.mode])}(t,e,n))}(e.items,d(e.options.global.target).html(e.$config.find(c.config.slideshowTemplateSelector).html()).show(),d(e.$config.find(c.config.slideshowItemTemplateSelector)).remove(),e.options):function(e,a,t){var n="";a&&(d.map(e,function(e,t){n+=u.applyTemplate(a,r(e))}),d(t.global.target).html(n).show(),u.imageLazyLoad(d(t.global.target)),function(e,t){p(f.BANNER,e,t)}(g.APPEAR,t))}(e.items,e.$config.find(c.config.bannerItemTemplateSelector).html(),e.options)}(a)})})}function r(e,t){var a={};return a["#ALT_STRING"+(t=t||"")+"#"]=e.altString,a["#BANNER_URL"+t+"#"]=e.bannerUrl,a["#LANDING_URL"+t+"#"]=e.landingUrl,a}function o(e,t,a,n){var i;n=n,a=a,t=t,e=e.getVisibleIndexes(),p(f.SLIDESHOW,n,a,t,e,i)}function p(e,t,a,n,i,o){var r=t===g.CLICK?S.CLICK:S.IMPRESSION,p=[],s=[],l={pgn:a.rat.ratPageName,pgl:a.rat.ratPageType},c={},t={eventType:t,accountId:a.rat.ratAccountId,serviceId:a.rat.ratServiceId};a.rat.ratComponent&&(l.compid=[a.rat.ratComponent]),t.pData=l,a.rat.ratWidget&&(c.widget=a.rat.ratWidget),e===f.SLIDESHOW&&(d.each(i,function(e,t){void 0!==n[t]&&(p.push(n[t].offerId),s.push(n[t].contentId))}),c.targeting=a.global.targetId,c.device=a.api.deviceType,c.channel=a.api.channelType,c.source=a.api.sourceId,c.kpi_type=r,c.page_layer=a.rat.ratLayer,c.positions=i,c.offers=p,c.contents=s,t.options=["url","ua"]),t.cpData=c,u.sendToRat(t,o,a.rat.ratTimeout)}var n,f={SLIDESHOW:"SLIDESHOW",BANNER:"BANNER",BIGBANNER:"BIGBANNER"},s={PC:0,TB:1},g={APPEAR:"appear",CLICK:"click",IMPRESSION:"imp",LANDING:"landing",RESIZE:"resize"},S={CLICK:"click",IMPRESSION:"imp"},i={API_ERROR_TYPE:"PpfApiError",API_ERROR_MESSAGE:"PPF API error",FILE_URL:"ppf.js"},l={SLIDESHOW:{itemStyle:u.ui.Slideshow.ItemStyle.FLOW,itemsPerPage:void 0,scrollEffect:u.ui.Slideshow.ScrollEffect.ALPHA},BIGBANNER:{itemStyle:u.ui.Slideshow.ItemStyle.FIXED,itemsPerPage:1,scrollEffect:u.ui.Slideshow.ScrollEffect.SLIDE}},c={config:{configSelector:".ppfConfig",slideshowTemplateSelector:".ppfSlideshowTemplate",slideshowItemTemplateSelector:".ppfSlideshowItemTemplate",bannerItemTemplateSelector:".ppfBannerItemTemplate",settingsSelector:".settings",mockSettingsSelector:".mock"},css:{tabletClass:"ppf-slideshow-tb"},global:{enabled:[!0,"bool"],waitDom:[!1,"bool"],target:[void 0,"str"],targetId:[void 0,"int"],mode:[f.SLIDESHOW,"enumValue",f],autoPlay:[!1,"bool"],autoPlayDelay:[4e3,"int"],autoPlayPauseOnBg:[!0,"bool"],autoPlayPauseOnHover:[!0,"bool"],itemWidth:[170,"int"],maxItems:[100,"int"],defaultContent:[void 0,"json"]},api:{sourceId:[u.api.ppfBanner.TargetPage.PC_TOP,"enumValue",u.api.ppfBanner.TargetPage],deviceType:[u.api.ppfBanner.DeviceType.PC,"enumValue",u.api.ppfBanner.DeviceType],channelType:[u.api.ppfBanner.ChannelType.WEB,"enumValue",u.api.ppfBanner.ChannelType]},rat:{ratEnabled:[!0,"bool"],ratAccountId:[1088,"int"],ratServiceId:[u.api.browsingHistory.ServiceId.ICHIBA_TOP,"enumValue",u.api.browsingHistory.ServiceId],ratComponent:[void 0,"str"],ratWidget:[void 0,"str"],ratLayer:["none","str"],ratPageName:["top","str"],ratPageType:[void 0,"str"],ratTimeout:[void 0,"int"]},shisa:{shisaEnabled:[!0,"bool"],shisaUrl:[void 0,"str"],shisaGroup:[void 0,"str"],shisaSendPercentage:[void 0,"int"]}},h=[],m=!1;e(),m?d(t):t()});
