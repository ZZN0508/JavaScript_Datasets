YUI.add("history-hash",function(n,e){function o(){o.superclass.constructor.apply(this,arguments)}var s,r,h,i=n.HistoryBase,l=n.Lang,c=n.Array,u=n.Object,a=YUI.namespace("Env.HistoryHash"),f="hash",H=n.config.win,t=n.config.useHistoryHTML5;n.extend(o,i,{_init:function(e){var a=o.parseHash();this._initialState=(e=e||{}).initialState?n.merge(e.initialState,a):a,n.after("hashchange",n.bind(this._afterHashChange,this),H),o.superclass._init.apply(this,arguments)},_change:function(e,t,a){return u.each(t,function(e,a){l.isValue(e)&&(t[a]=e.toString())}),o.superclass._change.call(this,e,t,a)},_storeState:function(e,a){var t=o.decode,n=o.createHash(a);o.superclass._storeState.apply(this,arguments),e!==f&&t(o.getHash())!==t(n)&&o[e===i.SRC_REPLACE?"replaceHash":"setHash"](n)},_afterHashChange:function(e){this._resolveChanges(f,o.parseHash(e.newHash),{})}},{NAME:"historyHash",SRC_HASH:f,hashPrefix:"",_REGEX_HASH:/([^\?#&]+)=([^&]+)/g,createHash:function(e){var t=o.encode,n=[];return u.each(e,function(e,a){l.isValue(e)&&n.push(t(a)+"="+t(e))}),n.join("&")},decode:function(e){return decodeURIComponent(e.replace(/\+/g," "))},encode:function(e){return encodeURIComponent(e).replace(/%20/g,"+")},getHash:n.UA.gecko?function(){var e=n.getLocation(),a=/#(.*)$/.exec(e.href),e=a&&a[1]||"",a=o.hashPrefix;return a&&0===e.indexOf(a)?e.replace(a,""):e}:function(){var e=n.getLocation().hash.substring(1),a=o.hashPrefix;return a&&0===e.indexOf(a)?e.replace(a,""):e},getUrl:function(){return location.href},parseHash:function(e){var a,t,n,s,r,h=o.decode,i={},c=o.hashPrefix;for(e=l.isValue(e)?e:o.getHash(),a=0,t=(n=(e=c&&(0===(r=e.indexOf(c))||1===r&&"#"===e.charAt(0))?e.replace(c,""):e).match(o._REGEX_HASH)||[]).length;a<t;++a)i[h((s=n[a].split("="))[0])]=h(s[1]);return i},replaceHash:function(e){var a=n.getLocation(),t=a.href.replace(/#.*$/,"");"#"===e.charAt(0)&&(e=e.substring(1)),a.replace(t+"#"+(o.hashPrefix||"")+e)},setHash:function(e){var a=n.getLocation();"#"===e.charAt(0)&&(e=e.substring(1)),a.hash=(o.hashPrefix||"")+e}}),s=(s=a._notifiers)||(a._notifiers=[]),n.Event.define("hashchange",{on:function(e,a,t){(e.compareTo(H)||e.compareTo(n.config.doc.body))&&s.push(t)},detach:function(e,a,t){t=c.indexOf(s,t);-1!==t&&s.splice(t,1)}}),r=o.getHash(),h=o.getUrl(),i.nativeHashChange?a._hashHandle||(a._hashHandle=n.Event.attach("hashchange",function(a){var t=o.getHash(),n=o.getUrl();c.each(s.concat(),function(e){e.fire({_event:a,oldHash:r,oldUrl:h,newHash:t,newUrl:n})}),r=t,h=n},H)):a._hashPoll||(a._hashPoll=n.later(50,null,function(){var a,e,t=o.getHash();r!==t&&(e=o.getUrl(),a={oldHash:r,oldUrl:h,newHash:t,newUrl:e},r=t,h=e,c.each(s.concat(),function(e){e.fire(a)}))},null,!0)),n.HistoryHash=o,!1!==t&&(n.History||!0===t||i.html5&&n.HistoryHTML5)||(n.History=o)},"3.12.0",{requires:["event-synthetic","history-base","yui-later"]});
