YUI.add("model-proxy",function(o,e){var n=require("hermes-core/flog")(e);o.getModelProxyConstructor=function(r){var i=function(e){this.id=e,this.registry=r,this.isModel=!0};return i.prototype={},o.getModelProxyConstructor.skipList.forEach(function(t){i.prototype[t]=function(){var e=new Error("Registry methods are not exposed on models.");throw n.error({err:e,method:t}),e}}),o.Object.each(r,function(e,t){var n;i.prototype[t]||0!==t.indexOf("_")&&o.Lang.isFunction(e)&&(0<Object.keys(e.prototype).length||(i.prototype[t]=(n=t,function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];return e.unshift(this.id),r[n].apply(r,e)})))},this,!0),i},o.getModelProxyConstructor.skipList=["add","get","load","proxy","remoteRead","remoteCreate","attributeSearch","removeAll","getCount","serialize","deserialize"]},"@VERSION@",{requires:[]}),YUI.add("flickr-collection",function(o){var e,a={};(e=o.FlickrCollection=function(e,t,n){this.registry=e,this.id=t,this.attrName=n,this._data=[],this.fetchedStart=!1,this.fetchedEnd=!1,this.totalItems=Number.MAX_VALUE}).prototype={constructor:e,push:function(e){var t=this._data.concat();t.push(e),this.registry.setValue(this.id,this.attrName,t)},unshift:function(e){var t=this._data.concat();t.unshift(e),this.registry.setValue(this.id,this.attrName,t)},concat:function(e){e=this._data.concat(e);this.registry.setValue(this.id,this.attrName,e)},remove:function(e){var t=this.find(e="string"==typeof e?{id:e}:e,!0);return t&&((e=this._data.concat()).splice(t.index,1),this.registry.setValue(this.id,this.attrName,e)),t&&t.value},find:function(n,e){if(!n)return null;var r=null,i=Object.keys(n);return this._data.some(function(t,e){if(t)return i.every(function(e){return t[e]===n[e]})?(r={value:t,index:e},!0):void 0}),e?r:r?r.value:null},getFirstItem:function(){for(var e,t=0;t<this._data.length;t++)if(e=this._data[t])return{item:e,index:t};return null},getLastItem:function(){for(var e,t=this._data.length-1;0<=t;t--)if(e=this._data[t])return{item:e,index:t};return null},getList:function(){return this._data.concat()},size:function(){return this._data.length},toJSON:function(){var t=[];return o.Array.each(this.getList(),function(e){e&&t.push(e.toJSON())}),t},toString:function(){return this.registry.name+'["'+this.attrName+'"]'},appendToListMulti:function(e){this.concat(e)},appendToList:function(e){this.push(e)},prependToList:function(e){this.unshift(e)},getFromListByID:function(e,t){var n={};return n[t||"id"]=e,this.find(n)||void 0},removeFromList:function(e,t){var n={};return n[t||"id"]=e,this.remove(n)},hasMinBoundary:function(){return this.fetchedStart},hasMaxBoundary:function(){return this.fetchedEnd},_setValue:function(e){this._data=e}},o.FlickrCollection.executeFetch=function(e,t,n,r){var i;return r&&o.Lang.isFunction(r.run)?(i=JSON.stringify(e),a[i]||(a[i]=r.run.call(r,e,t.appContext).then(function(e){return delete a[i],e},function(e){throw delete a[i],e}),a[i])):o.Promise.reject("(flickr-collection::executeFetch) invalid fetcher for "+t.name+"["+n+"]")},o.FlickrCollection.trimArray=function(e){for(var t=0,n=e.length-1;t<e.length&&!e[t];)t++;for(;t<n&&!e[n];)n--;return e.slice(t,n+1)}},"@VERSION@",{requires:[]}),YUI.add("paged-collection",function(s,e){var n=require("hermes-core/flog")(e);s.PagedCollection=function(e,t,n,r){this.constructor.superclass.constructor.call(this,e,t,n),r&&((r=r instanceof Array?{pageContent:r,page:1,perPage:r.length}:r).totalPages&&(this.totalPages=r.totalPages),r.totalItems,isNaN(parseFloat(r.totalItems))||(this.totalItems=parseFloat(r.totalItems)),this.fetchedStart=!!r.fetchedStart,this.fetchedEnd=!!r.fetchedEnd,this.addPage(r))},s.extend(s.PagedCollection,s.FlickrCollection,{getPage:function(e){var t,n,r,i,o,a;if(e&&e.page&&e.perPage&&!e.forceAPICall){if(o=this.totalPages&&e.page>=this.totalPages,a=this.totalItems&&n>=this.totalItems,t=e.perPage*(e.page-1),n=Math.min(e.perPage*e.page,this.totalItems),!o&&!a||!this.fetchedEnd)for(r=t;r<n;r++)if(void 0===this._data[r]||!this._data[r].exists()){i=!0;break}}else e=e||{},i=!0;return i?(e.pathAlias||(e.id=this.id),e.isCollection=!0,(a=this.registry.attributes[this.attrName].pageFetch).fetchParams&&(e=s.merge(e,a.fetchParams)),s.FlickrCollection.executeFetch(e,this.registry,this.attrName,a.listFetcher)):s.Promise.resolve(this._data.slice(t,n))},addPage:function(e){var t,n,r=e.perPage*(e.page-1),i=r+Math.min(e.pageContent.length,e.perPage),o=0;if(e.forceAppend)this._data=this._data.concat(e.pageContent);else if(this._data.length<=r)this._data.length=r,this._data=this._data.concat(e.pageContent);else for(this._data.length<i&&(this._data.length=i),t=r;t<i;t++)this._data[t]=e.pageContent[o],o++;e.totalPages&&(this.totalPages=e.totalPages,e.page>=this.totalPages&&(this.fetchedEnd=!0)),e.totalItems,isNaN(parseFloat(e.totalItems))||(n=parseFloat(e.totalItems),this.totalItems=n,(this._data.length>=n||r+parseInt(e.perPage,10)>n&&this._data.length<n)&&(this.fetchedEnd=!0)),this.fetchedStart=this._data&&void 0!==this._data[0]},removePage:function(e){},getPageOf:function(e,t){t||(n.warn("`perPage` must be specified; defaulting to 50."),t=50);e=this.find(e,!0);return e?Math.floor(e.index/t)+1:-1},getNextIncompletePage:function(e){for(var t=e.page*(e.perPage-1),n=Math.floor(this._data.length/e.perPage)+1;t<this._data.length;t++)if(void 0===this._data[t]||!this._data[t].exists()){n=Math.floor(t/e.perPage)+1;break}return n},_setValue:function(e){var t;e instanceof Array?this.constructor.superclass._setValue.call(this,e):(e=(t=e)?(t instanceof Array&&(t={pageContent:t}),s.merge({page:1,perPage:0,pageContent:[]},t)):(n.warn("No pageData sent to PagedCollection; aborting."),null))&&(e.remove?this.removePage(e):this.addPage(e))}})},"@VERSION@",{requires:["flickr-collection"]}),YUI.add("flickr-model-registry",function(y,e){function l(e,t,n){return!1===n&&"string"==typeof e&&"string"==typeof t&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t||(y.moment.isMoment(e)&&y.moment.isMoment(t)?0===e.diff(t):y.Lang.isArray(e)&&y.Lang.isArray(t)&&(a=t,s=!0,(s=(n=e).length!==a.length?!1:s)&&y.Array.some(n,function(e,t){if(!l(a[t],e))return!(s=!1)}),s)||y.Lang.isObject(e,!0)&&y.Lang.isObject(t,!0)&&(r=e,i=t,o=!0,(o=y.Object.size(r)!==y.Object.size(i)?!1:o)&&y.Object.some(r,function(e,t){if(!i.hasOwnProperty(t)||!l(i[t],e))return!(o=!1)}),o&&y.Object.some(i,function(e,t){if(!r.hasOwnProperty(t)||!l(r[t],e))return!(o=!1)}),o));var r,i,o,a,s}function h(e){var n=e;return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Array.prototype?(n=e.slice(),void 0!==e.hasMinBoundary&&(n.hasMinBoundary=e.hasMinBoundary),void 0!==e.hasMaxBoundary&&(n.hasMaxBoundary=e.hasMaxBoundary)):Object.getPrototypeOf(e)===Object.prototype&&(n={},y.Object.each(e,function(e,t){n[t]=e},this))),n}var p=require("hermes-core/flog")(e);y.Models={};e=y.FlickrModelRegistry=function(e){this.appContext=e,this.attributes=this.attributes||{},this.attributes.id={writeOnce:"initOnly",setter:function(e){return y.Lang.isString(e)||(y.Lang.isNumber(e)?e+="":(p.info("`id` falling back to a Y.guid",{topic:this.name,val:e}),e=y.guid())),e}},this._setDefaultRemoteMethods(),this._validateAttributes(),this._data={},this._dataSize=0,this._subscribers=[],this.hasWeakSubscribers=!1,this._chainedEvents={},this._derivedCache=void 0,this._unsavedModels={}};e.prototype={attributeSearch:function(t,i){var o=[];return t.id?o.push(t.id):y.Object.each(this._data,function(n,e){var r=!0;y.Object.some(t,function(e,t){if(!l(e,n[t],!1))return!0===i&&l(e,this.getDefaultValue(n.id,t),!1)?void 0:!(r=!1)},this),r&&o.push(e)},this),o},load:function(n,e){var r,i,o=this;return e=e||{},e=y.Lang.isObject(n,!0)?(r=this.attributeSearch(n).sort()[0],y.merge(n,e||{})):(r=n,y.merge({id:r},e)),r&&this.exists(r)?y.Promise.resolve(r):(this._fetchPromises||(this._fetchPromises={}),i=r||JSON.stringify(e),this._fetchPromises[i]||(this._fetchPromises[i]=this.remoteRead(e).then(function(){var e,t=r;if(r||0<(e=o.attributeSearch(n)).length&&(t=e[0]),delete o._fetchPromises[i],t&&o.exists(t))return t;throw(t=new Error("["+o.name+"] Model ID is missing after fetching.")).getModelFailure=!0,t}),this._fetchPromises[i]))},get:function(e,t){return this.load(e,t).then(this.proxy.bind(this))},add:function(r,e,i){var o;if(y.Lang.isObject(r,!0)&&!y.Lang.isArray(r))return void 0===e&&(e=!1),o=this.attributes.id.setter.apply(this,[r.id,void 0]),this._data[o]?p.warn("Attempt to add a model that is already in the registry.",{topic:this.name,id:o}):(this._data[o]={},this._dataSize++,this._queueEvent("modelsAdded",{id:o}),e?this._data[o]=r:Object.keys(this.attributes).forEach(function(e){var t=this.attributes[e],n=r[e];t.readOnly||this.setValue(o,e,n,!0,i)},this),this.appContext.markAsNewlyFetched(this.name,o)),this.proxy(o);p.warn("`add` requires an object",{topic:this.name,data:r})},remove:function(e){this.exists(e)&&(delete this._data[e],this._dataSize--,this._removeChainedEvents(e),this._removeEventSubscribers(e),this._queueEvent("modelsRemoved",{id:e}))},removeAll:function(){y.Object.each(this._data,function(e,t){this.remove(t)},this)},removeAllExcept:function(e){var n=e.reduce(function(e,t){return e[t]=!0,e},{});y.Object.each(this._data,function(e,t){n[t]||this.remove(t)},this)},_removeChainedEvents:function(e){var n;this._chainedEvents[e]&&(y.Object.each(this._chainedEvents[e],function(e,t){(n=this.attributes[t])&&(n.isModel?e.detach():(n.isListProxy||n.isCollection)&&y.Array.each(e,function(e){e.detach&&e.detach()}))},this),delete this._chainedEvents[e])},_removeEventSubscribers:function(n){var r=[];this._subscribers.length&&(y.Array.each(this._subscribers,function(e,t){e.id===n&&r.push(t)},this),y.Array.each(r,function(e){this._subscribers.splice(e,1)},this))},proxy:function(e){return this._ModelProxy||(this._ModelProxy=y.getModelProxyConstructor(this)),new this._ModelProxy(e)},getValue:function(e,t,n){var r,i;if(e&&t)if(this.exists(e)){if(i=this.attributes[t])return r=i.isListProxy?new y.ListProxy(this,e,t):(void 0===(r=this._data[e][t])&&(r=this.getDefaultValue(e,t)),i=i.getter,h(r=!n&&i?i.apply(this,[r,e]):r));p.warn("`getValue` called for an attribute that isn't defined",{topic:this.name,id:e,attr:t})}else p.warn("`getValue` called for an id that doesn't exist in the registry.",{topic:this.name,id:e,attr:t});else p.warn("`getValue` requires two arguments.",{topic:this.name,id:e,attr:t})},setValue:function(r,i,e,t,n){var o,a,s,u,c,d;if(!r||!i||arguments.length<3)p.warn("`setValue` requires three arguments.",{topic:this.name,id:r});else if(this.exists(r))if(o=this.attributes[i])if(o.readOnly)p.warn("Attribute is readOnly.",{topic:this.name,id:r,attr:i});else if("initOnly"!==o.writeOnce||t)if(!0===o.writeOnce&&this._data[r][i])p.warn("Attribute can only be set once.",{topic:this.name,id:r,attr:i});else{if(s=this.getValue(r,i),u=this._data[r][i],o.isListProxy&&(s=u),!n&&o.validator){if(c=o.validator,!y.Lang.isFunction(c))return void p.warn("Attribute has an invalid validator.",{topic:this.name,validator:o.validator,attr:i});if(!c.apply(this,[e,r]))return void p.info("Attribute validation failed.",{topic:this.name,id:r,val:e,attr:i})}e=h(e),!n&&o.setter&&(e=o.setter.apply(this,[e,r])),o.isListProxy&&!y.Lang.isArray(e)&&(e=[]),o.isCollection&&(e?"object"==typeof e&&e instanceof y.PagedCollection||(e=s?(u=s.getList(),s._setValue(e),s):(u=null,new y.PagedCollection(this,r,i,e))):e=new y.PagedCollection(this,r,i)),this._isDifferentValue(r,i,e,s)&&(!o.isModel||y.Lang.isObject(e)&&e.isModel?(t||(a=this._getAttributeValuesDerivedBy(r,i)),this._data[r][i]=e,o.isListProxy&&e&&(e.hasMinBoundary&&this.getValue(r,i).setMinBoundary(),e.hasMaxBoundary&&this.getValue(r,i).setMaxBoundary()),(o.isModel||o.isListProxy||o.isCollection)&&this._chainEvents(r,i),t||(c=this.getValue(r,i),o.isListProxy||o.isCollection||this._setUnsaved(r,i,c,s,u),d={id:r,attrName:i,prevVal:s,newVal:c},o.isListProxy?d.listDiff=this._calcListDiff(c,s):o.isCollection&&(d.listDiff=this._calcListDiff(c,u)),this._queueEvent("valuesChanged",d),y.Object.size(a)&&y.Object.each(a,function(e,t){var n=this.getValue(r,t);l(n,e)||(d={id:r,attrName:t,prevVal:e,newVal:n,derivedBy:[i]},(this.attributes[t].isListProxy||this.attributes[t].isCollection)&&(d.listDiff=this._calcListDiff(n,e)),this._queueEvent("valuesChanged",d))},this))):p.warn("Attribute must be a ModelProxy instance.",{topic:this.name,id:r,attr:i}))}else p.warn("Attribute can only be set during initialization.",{topic:this.name,id:r,attr:i});else p.warn("Attribute is not present in the attributes list.",{topic:this.name,id:r,attr:i});else p.warn("`setValue called for an id that is not in the registry.",{topic:this.name,id:r})},setValues:function(n,e){var r={};y.Object.each(e,function(e,t){"id"!==t&&(r[t]=this.setValue(n,t,e))},this)},revertValue:function(e,t){this._unsavedModels[e]&&void 0!==this._unsavedModels[e][t]&&this.setValue(e,t,this._unsavedModels[e][t].lastSavedValRaw)},exists:function(e){e=y.Lang.isArray(e)?e[0]:y.Lang.isObject(e,!0)?this.attributeSearch(e)[0]:e;return!!this._data[e]},addOrUpdate:function(t){var n,r;return this.exists(t.id)?Object.keys(t).forEach(function(e){n=this.attributes[e],r=t[e],n&&!n.readOnly&&"initOnly"!==n.writeOnce&&this.setValue(t.id,e,r)},this):this.add(t),this.appContext.markAsNewlyFetched(this.name,t.id),this.markChildModelsAsNewlyFetched(t.id),this.proxy(t.id)},markChildModelsAsNewlyFetched:function(e){var t=this;this.getOwnedModels(e).forEach(function(e){e&&(t.appContext.markAsNewlyFetched(e.registry.name,e.id),e.markChildModelsAsNewlyFetched(e.id))})},getOwnedModels:function(e){var t,n,r,i=[];if(!e)return p.warn("`getOwnedModels` requires a model id.",{topic:this.name,id:e}),i;if(!this.exists(e))return i;for(t in this._ModelProxy||(this._ModelProxy=y.getModelProxyConstructor(this)),this.attributes)(n=this.attributes[t]).isModel?(r=this.getValue(e,t))&&r.exists()&&i.push(r):(n.isListProxy||n.isCollection)&&(i=i.concat(this.getValue(e,t).getList().filter(function(e){return e&&e.isModel&&e.exists()})));return i},hasAttribute:function(e){return!!this.attributes[e]},toJSON:function(e){var t,n,r={};if(e)for(t in this.attributes)r[t]=this.getValue(e,t),r[t]&&(this.attributes[t].isModel||this.attributes[t].isListProxy||this.attributes[t].isCollection)&&(r[t]=r[t].toJSON());else for(n in this._data)r[n]=this.toJSON(n);return r},on:function(e,t,n,r){var i;return this._subscribers.push(i={eventName:t,fn:n,id:e=e||null,weak:r}),r&&(this.hasWeakSubscribers=!0),{detach:function(){var e=y.Array.indexOf(this._subscribers,i);this._subscribers.splice(e,1)}.bind(this)}},removeWeakSubscribers:function(){var e=this._subscribers.length;if(e)for(;e--;)this._subscribers[e].weak&&this._subscribers.splice(e,1);this.hasWeakSubscribers=!1},getCount:function(){return this._dataSize},getDefaultValue:function(e,t){var n;return n=void 0===(n="function"==typeof(t=this.attributes[t]).defaultFn?t.defaultFn.call(this,e):n)&&void 0!==t.defaultValue?t.defaultValue:n},_isDifferentValue:function(e,t,n,r){var i=this.attributes[t],t=i.getter;if(t&&(n=t.apply(this,[n,e])),void 0!==i.isListProxy&&i.isListProxy&&void 0!==r){if(n.hasMaxBoundary!==(void 0!==r.hasMaxBoundary&&r.hasMaxBoundary)||n.hasMinBoundary!==(void 0!==r.hasMinBoundary&&r.hasMinBoundary))return!0}else if(i.isCollection)return!0;return!l(n,r)},_calcListDiff:function(e,t){var n={added:null,removed:null},e=e instanceof y.ListProxy||e instanceof y.PagedCollection?e.getList():e,t=t instanceof y.ListProxy||t instanceof y.PagedCollection?t.getList():t,r=t.reduce(function(e,t){return t&&t.id&&(e[t.id]=!0),e},{}),i=e.reduce(function(e,t){return t&&t.id&&(e[t.id]=!0),e},{});return n.added=e.filter(function(e){return e&&!r[e.id]}),n.removed=t.filter(function(e){return e&&!i[e.id]}),n},_getAttributesDerivedBy:function(e){return this._derivedCache||(this._derivedCache={},y.Object.each(this.attributes,function(e,t){e.derivedBy&&y.Lang.isArray(e.derivedBy)&&y.Array.each(e.derivedBy,function(e){this._derivedCache[e]||(this._derivedCache[e]=[]),this._derivedCache[e].push(t)},this)},this)),this._derivedCache[e]},_getAttributeValuesDerivedBy:function(t,e){var e=this._getAttributesDerivedBy(e),n={};return e&&e.length&&y.Array.each(e,function(e){n[e]=this.getValue(t,e)},this),n},_queueEvent:function(e,t){var n;this._eventQueue||(this._eventQueue=[]),(n=this._eventQueue).push({type:e,data:t}),this._eventPending||(this._eventPending=!0,setTimeout(function(){var i={};this._eventPending=!1,delete this._eventQueue,y.Array.each(n,function(e){var t=e.type,n=e.data,r=n.id;switch(t){case"modelsAdded":case"modelsRemoved":i[t]=i[t]||{},i[t][r]=n;break;case"valuesChanged":if(i.valuesChanged&&i.valuesChanged[r]&&i.valuesChanged[r][n.attrName]&&i.valuesChanged[r][n.attrName].newVal){i.valuesChanged[r][n.attrName].newVal=n.newVal,i.valuesChanged[r][n.attrName].derivedBy&&n.derivedBy&&(i.valuesChanged[r][n.attrName].derivedBy=i.valuesChanged[r][n.attrName].derivedBy.concat(n.derivedBy)),i.valuesChanged[r][n.attrName].chained&&!n.chained&&delete i.valuesChanged[r][n.attrName].chained;break}i.valuesChanged=i.valuesChanged||{},i.valuesChanged[r]=i.valuesChanged[r]||{},i.valuesChanged[r][n.attrName]=n}}),y.Object.each(i,function(e,t){this._fireEvent(t,e)},this)}.bind(this),0))},_fireEvent:function(t,n){this._subscribers.slice().forEach(function(e){e&&e.eventName===t&&(e.id?n[e.id]&&e.fn.call(void 0,n[e.id]):e.fn.call(void 0,n))})},_chainEvents:function(t,n){var e,r=this.attributes[n];this._chainedEvents[t]=this._chainedEvents[t]||{},r.isModel?(this._chainedEvents[t][n]&&this._chainedEvents[t][n].detach(),e=this.getValue(t,n),this._chainedEvents[t][n]=e.on("valuesChanged",function(e){this._queueChainedEvent(t,n)}.bind(this))):(r.isListProxy||r.isCollection)&&(this._chainedEvents[t][n]&&y.Array.each(this._chainedEvents[t][n],function(e){e.detach()}),this._chainedEvents[t][n]=[],r=this.getValue(t,n),y.Array.each(r.getList(),function(e){e&&this._chainedEvents[t][n].push(e.on("valuesChanged",function(e){this._queueChainedEvent(t,n)}.bind(this)))},this))},_queueChainedEvent:function(n,r){var e=this.getValue(n,r);this._queueEvent("valuesChanged",{id:n,attrName:r,prevVal:e,newVal:e,chained:!0}),e=this._getAttributeValuesDerivedBy(n,r),y.Object.size(e)&&y.Object.each(e,function(e,t){this._queueEvent("valuesChanged",{id:n,attrName:t,newVal:e,derivedBy:[r],chained:!0})},this)},_deleteUnsaved:function(e,t){this._unsavedModels[e]&&this._unsavedModels[e][t]&&(delete this._unsavedModels[e][t],0===y.Object.size(this._unsavedModels[e])&&delete this._unsavedModels[e])},_setUnsaved:function(e,t,n,r,i){this._unsavedModels[e]&&this._unsavedModels[e][t]?l(n,this._unsavedModels[e][t].lastSavedVal)&&this._deleteUnsaved(e,t):(this._unsavedModels[e]=this._unsavedModels[e]||{},this._unsavedModels[e][t]={lastSavedVal:r,lastSavedValRaw:i})},_validateAttributes:function(){var i=["setter","getter","validator","defaultValue","defaultFn","derivedBy","readOnly","writeOnce","isModel","serialize","deserialize"],o=["isListProxy","isCollection","pageFetch","contextFetch","rangeFetch"];y.Object.each(this.attributes,function(n,r){y.Object.each(n,function(e,t){n.isListProxy||n.isCollection?-1===y.Array.indexOf(o,t)&&p.warn("Unknown property on collection attribute.",{topic:this.name,prop:t,attr:r}):-1===y.Array.indexOf(i,t)&&p.warn("Unknown property on attribute.",{topic:this.name,prop:t,attr:r})},this)},this)},_setDefaultRemoteMethods:function(){this.remote=this.remote||{},this.remote.create||(this.remote.create=function(e){return p.error("`remote.create` was called without being implemented.",{topic:this.name,attrs:e}),y.Promise.reject()}),this.remote.read||(this.remote.read=function(e){Object.keys(this.attributes).some(function(e){var t=this.attributes[e];if(!("id"===e||t.readOnly||t.isListProxy||t.isCollection||t.defaultValue||t.defaultFn))return!0},this);e={id:(e="object"!=typeof e?{id:e}:e).id};return this.add(e),y.Promise.resolve(e)}),this.remote.update||(this.remote.update=function(e,t){return p.error("`remote.update` was called without being implemented.",{topic:this.name,id:e,attrs:t}),y.Promise.reject()}),this.remote.delete||(this.remote.delete=function(e){return p.error("`remote.delete` was called without being implemented.",{topic:this.name,id:e}),y.Promise.reject()})},remoteCreate:function(e){return this.remote.create.call(this,e)},remoteRead:function(e){return this.remote.read.call(this,e)},remoteUpdate:function(n){var r={},t=this;return this._unsavedModels[n]&&y.Object.each(this._unsavedModels[n],function(e,t){r[t]={newVal:this.getValue(n,t),prevVal:e.lastSavedVal}},this),0<y.Object.size(r)?this.remote.update.call(this,n,r).then(function(e){return t._unsavedModels={},e}):y.Promise.resolve()},remoteBatchUpdate:function(e,t){return this.remote.batchUpdate.call(this,e,t)},remoteDelete:function(e){var t=this;return this.remote.delete.call(this,e).then(function(){t.remove(e)})},getListPageByContinuation:function(s,e){var t,u,n,c,r,d,l,i,h=this,o=h.appContext,a=y.APIHelper.request.getRebootPhotoExtras();switch(h.name){case"photo-groups-models":t="group-pool-models",u="groups",n="flickr.photos.getGroups",c="groups.group",a+=","+y.APIHelper.request.getRebootGroupExtras();break;case"photo-sets-models":t="set-models",u="sets",n="flickr.photos.getSets",c="sets.set";break;case"photo-galleries-models":t="gallery-models",u="galleries",n="flickr.photos.getGalleries",c="galleries.gallery"}return n?h.exists(s)?(h.continuationKeys=h.continuationKeys||{},h.getMorePromises=h.getMorePromises||{},"-1"===(r=h.continuationKeys[s]||"0")?y.Promise.resolve({newItems:[],loadedAll:!0}):("0"===r&&(e+=h.getValue(s,u).getList().length),(i=h.getMorePromises[l=s+"_"+r])?i:(e={apiResponse:o.callAPI(n,{photo_id:s,extras:a,primary_photo_extras:"url_sq, url_t, url_s, url_m",continuation:r,per_page:e},!0),contextRegistry:o.getModelRegistry(t),personRegistry:o.getModelRegistry("person-models")},"photo-groups-models"===h.name&&(e.groupRegistry=o.getModelRegistry("group-models")),h.getMorePromises[l]=new y.FlickrPromise(e).then(function(e){var t,n=[],r=e.apiResponse,i=e.contextRegistry,o=e.personRegistry,a=e.groupRegistry;return(e=c.split(".").reduce(function(e,t){return y.Lang.isObject(e)?e[t]:void 0},r))&&(y.Array.each(e,function(e){y.APIHelper.response.addContextToRegistry(e,i,o,a),n.push(i.proxy(e.id))}),n.length&&(t=h.getValue(s,u).getList().map(function(e){return e.getValue("id")}),(n=n.filter(function(e){return-1===t.indexOf(e.getValue("id"))})).length&&h.getValue(s,u).appendToListMulti(n))),void 0===(d=r[u].continuation)?d="-1":y.Lang.isNumber(d)&&(d+=""),r="-1"===d,h.continuationKeys[s]=d,delete h.getMorePromises[l],{newItems:n,loadedAll:r}},function(e){throw delete h.getMorePromises[l],e}),h.getMorePromises[l]))):y.Promise.reject("[api-helper] getListPageByContinuation was called for an ID that isn't in the registry: "+s):y.Promise.reject("[api-helper] getListPageByContinuation was called without an invalid registry type: "+h.name)},getBuriedValue:function(e,t){var n={};return n=(t=this.getValue(e,t))&&t.payload?t.payload:n},setBuriedValue:function(e,t,n,r){return this.setValue(e,t,{payload:n},r)}},y.mix(e.prototype,y.Localizable)},"@VERSION@",{requires:["flickr-promise","model-proxy","list-proxy","moment","paged-collection","localizable"]}),YUI.add("timezone-helper",function(r){"use strict";r.TimezoneHelper=function(e,t,n){n?(this.tz=n,this.dst=!1):(this.tz=e.getViewer().prefs.timezonePref.offset,this.dst=e.getViewer().prefs.timezonePref.dst),this.momentObject=r.moment(t,"X"),this.momentObject.utcOffset(this.tz),this.dst&&this.momentObject.isDST()&&this.momentObject.add(1,"hour")},r.TimezoneHelper.prototype.toFormat=function(e){return this.momentObject.format(e)}},"@VERSION@",{requires:["moment"]}),YUI.add("subscriptions-helper",function(a,e){"use strict";var t=require("hermes-core/flog")(e);a.SubscriptionsHelper=function(){this.FLICKR_PRO_3_MONTH_PLAN_ID=1,this.FLICKR_PRO_1_YEAR_PLAN_ID=2,this.FLICKR_PRO_2_YEARS_PLAN_ID=3,this.FLICKR_PRO_MONTHLY_PLAN_ID=7,this.FLICKR_PRO_ANNUAL_PLAN_ID=8,this.FLICKR_PRO_ANNUAL_TRIAL=9,this.FLICKR_PRO_OLD_ANNUAL_TRIAL=10,this.FLICKR_PRO_3_MONTH_V2_PLAN_ID=11,this.FLICKR_PRO_2_YEAR_V2_PLAN_ID=12,this.FLICKR_PRO_1_MONTH_V2_APPLE_ID=13,this.FLICKR_PRO_1_YEAR_V2_APPLE_ID=14,this.FLICKR_PRO_1_MONTH_V2_GOOGLE_ID=15,this.FLICKR_PRO_1_YEAR_V2_GOOGLE_ID=16,this.FLICKR_PRO_STRIPE_MONTHLY_PLAN_ID=17,this.FLICKR_PRO_STRIPE_ANNUAL_PLAN_ID=18,this.FLICKR_PRO_STRIPE_3_MONTH_PLAN_ID=19,this.FLICKR_PRO_ANNUAL_PRICE=59.99,this.FLICKR_PRO_MONTHLY_PRICE=6.99,this.FLICKR_PRO_3_MONTH_V2_PRICE=18.99,this.FLICKR_PRO_2_YEAR_V2_PRICE=117.99,this.ADOBE_PARTNERSHIP_COUPON="FlickrAdobe25",this.BT_MIG_5_1_ANNUAL_COUPON="BTMIG5135A",this.BT_MIG_3_1_ANNUAL_COUPON="BTMIG3125A",this.BT_MIG_3_2_ANNUAL_COUPON="BTMIG3225A",this.subscriptionsIdByName={"pro-3month":this.FLICKR_PRO_3_MONTH_PLAN_ID,"pro-3month-v2":this.FLICKR_PRO_3_MONTH_V2_PLAN_ID,"pro-1year":this.FLICKR_PRO_1_YEAR_PLAN_ID,"pro-2year":this.FLICKR_PRO_2_YEARS_PLAN_ID,"pro-2year-v2":this.FLICKR_PRO_2_YEAR_V2_PLAN_ID,"pro-monthly":this.FLICKR_PRO_MONTHLY_PLAN_ID,"pro-annual":this.FLICKR_PRO_ANNUAL_PLAN_ID,"pro-trial":this.FLICKR_PRO_ANNUAL_TRIAL},this.subscriptionsIdByNameOnStripe={"pro-3month":this.FLICKR_PRO_STRIPE_3_MONTH_PLAN_ID,"pro-3month-v2":this.FLICKR_PRO_STRIPE_3_MONTH_PLAN_ID,"pro-1year":this.FLICKR_PRO_STRIPE_ANNUAL_PLAN_ID,"pro-2year":this.FLICKR_PRO_STRIPE_ANNUAL_PLAN_ID,"pro-2year-v2":this.FLICKR_PRO_STRIPE_ANNUAL_PLAN_ID,"pro-monthly":this.FLICKR_PRO_STRIPE_MONTHLY_PLAN_ID,"pro-annual":this.FLICKR_PRO_STRIPE_ANNUAL_PLAN_ID},this.subscriptionStatusMap={initiated:1,active:2,closed:3,canceled:4,failed:5,refunded:6,pending:7,subscription_canceled:8,subscription_charged_successfully:9,subscription_charged_unsuccessfully:10,subscription_expired:11,subscription_went_past_due:12,change_initiated:13,closed_pending:14},this.subscriptionsIdHasAnnualPerk={1:!1,2:!0,3:!0,4:!0,6:!1,7:!1,8:!0,9:!0,10:!0,11:!1,12:!0,13:!1,14:!0,15:!1,16:!0,17:!1,18:!0,19:!1},this.cardTypeMap={1:"visa",2:"master-card",3:"discover",4:"american-express",5:"JCB"},this.paymentVendorMap={braintree:10,oldpaypal:20,digitalriver:30,apple:40,google:50,stripe:60},this.countriesArray=[{countryCode:"US",countryName:"United States"},{countryCode:"AF",countryName:"Afghanistan"},{countryCode:"AX",countryName:"Ã…land"},{countryCode:"AL",countryName:"Albania"},{countryCode:"DZ",countryName:"Algeria"},{countryCode:"AS",countryName:"American Samoa"},{countryCode:"AD",countryName:"Andorra"},{countryCode:"AO",countryName:"Angola"},{countryCode:"AI",countryName:"Anguilla"},{countryCode:"AQ",countryName:"Antarctica"},{countryCode:"AG",countryName:"Antigua and Barbuda"},{countryCode:"AR",countryName:"Argentina"},{countryCode:"AM",countryName:"Armenia"},{countryCode:"AW",countryName:"Aruba"},{countryCode:"AU",countryName:"Australia"},{countryCode:"AT",countryName:"Austria"},{countryCode:"AZ",countryName:"Azerbaijan"},{countryCode:"BS",countryName:"Bahamas"},{countryCode:"BH",countryName:"Bahrain"},{countryCode:"BD",countryName:"Bangladesh"},{countryCode:"BB",countryName:"Barbados"},{countryCode:"BY",countryName:"Belarus"},{countryCode:"BE",countryName:"Belgium"},{countryCode:"BZ",countryName:"Belize"},{countryCode:"BJ",countryName:"Benin"},{countryCode:"BM",countryName:"Bermuda"},{countryCode:"BT",countryName:"Bhutan"},{countryCode:"BO",countryName:"Bolivia"},{countryCode:"BQ",countryName:"Bonaire, Sint Eustatius and Saba"},{countryCode:"BA",countryName:"Bosnia and Herzegovina"},{countryCode:"BW",countryName:"Botswana"},{countryCode:"BV",countryName:"Bouvet Island"},{countryCode:"BR",countryName:"Brazil"},{countryCode:"IO",countryName:"British Indian Ocean Territory"},{countryCode:"BN",countryName:"Brunei Darussalam"},{countryCode:"BG",countryName:"Bulgaria"},{countryCode:"BF",countryName:"Burkina Faso"},{countryCode:"BI",countryName:"Burundi"},{countryCode:"KH",countryName:"Cambodia"},{countryCode:"CM",countryName:"Cameroon"},{countryCode:"CA",countryName:"Canada"},{countryCode:"CV",countryName:"Cape Verde"},{countryCode:"KY",countryName:"Cayman Islands"},{countryCode:"CF",countryName:"Central African Republic"},{countryCode:"TD",countryName:"Chad"},{countryCode:"CL",countryName:"Chile"},{countryCode:"CN",countryName:"China"},{countryCode:"CX",countryName:"Christmas Island"},{countryCode:"CC",countryName:"Cocos (Keeling) Islands"},{countryCode:"CO",countryName:"Colombia"},{countryCode:"KM",countryName:"Comoros"},{countryCode:"CG",countryName:"Congo (Brazzaville)"},{countryCode:"CD",countryName:"Congo (Kinshasa)"},{countryCode:"CK",countryName:"Cook Islands"},{countryCode:"CR",countryName:"Costa Rica"},{countryCode:"CI",countryName:"CÃ´te d'Ivoire"},{countryCode:"HR",countryName:"Croatia"},{countryCode:"CW",countryName:"CuraÃ§ao"},{countryCode:"CY",countryName:"Cyprus"},{countryCode:"CZ",countryName:"Czech Republic"},{countryCode:"DK",countryName:"Denmark"},{countryCode:"DJ",countryName:"Djibouti"},{countryCode:"DM",countryName:"Dominica"},{countryCode:"DO",countryName:"Dominican Republic"},{countryCode:"EC",countryName:"Ecuador"},{countryCode:"EG",countryName:"Egypt"},{countryCode:"SV",countryName:"El Salvador"},{countryCode:"GQ",countryName:"Equatorial Guinea"},{countryCode:"ER",countryName:"Eritrea"},{countryCode:"EE",countryName:"Estonia"},{countryCode:"ET",countryName:"Ethiopia"},{countryCode:"FK",countryName:"Falkland Islands"},{countryCode:"FO",countryName:"Faroe Islands"},{countryCode:"FJ",countryName:"Fiji"},{countryCode:"FI",countryName:"Finland"},{countryCode:"FR",countryName:"France"},{countryCode:"GF",countryName:"French Guiana"},{countryCode:"PF",countryName:"French Polynesia"},{countryCode:"TF",countryName:"French Southern Lands"},{countryCode:"GA",countryName:"Gabon"},{countryCode:"GM",countryName:"Gambia"},{countryCode:"GE",countryName:"Georgia"},{countryCode:"DE",countryName:"Germany"},{countryCode:"GH",countryName:"Ghana"},{countryCode:"GI",countryName:"Gibraltar"},{countryCode:"GR",countryName:"Greece"},{countryCode:"GL",countryName:"Greenland"},{countryCode:"GD",countryName:"Grenada"},{countryCode:"GP",countryName:"Guadeloupe"},{countryCode:"GU",countryName:"Guam"},{countryCode:"GT",countryName:"Guatemala"},{countryCode:"GG",countryName:"Guernsey"},{countryCode:"GN",countryName:"Guinea"},{countryCode:"GW",countryName:"Guinea-Bissau"},{countryCode:"GY",countryName:"Guyana"},{countryCode:"HT",countryName:"Haiti"},{countryCode:"HM",countryName:"Heard and McDonald Islands"},{countryCode:"HN",countryName:"Honduras"},{countryCode:"HK",countryName:"Hong Kong"},{countryCode:"HU",countryName:"Hungary"},{countryCode:"IS",countryName:"Iceland"},{countryCode:"IN",countryName:"India"},{countryCode:"ID",countryName:"Indonesia"},{countryCode:"IE",countryName:"Ireland"},{countryCode:"IM",countryName:"Isle of Man"},{countryCode:"IL",countryName:"Israel"},{countryCode:"IT",countryName:"Italy"},{countryCode:"JM",countryName:"Jamaica"},{countryCode:"JP",countryName:"Japan"},{countryCode:"JE",countryName:"Jersey"},{countryCode:"JO",countryName:"Jordan"},{countryCode:"KZ",countryName:"Kazakhstan"},{countryCode:"KE",countryName:"Kenya"},{countryCode:"KI",countryName:"Kiribati"},{countryCode:"KR",countryName:"Korea, South"},{countryCode:"KW",countryName:"Kuwait"},{countryCode:"KG",countryName:"Kyrgyzstan"},{countryCode:"LA",countryName:"Laos"},{countryCode:"LV",countryName:"Latvia"},{countryCode:"LB",countryName:"Lebanon"},{countryCode:"LS",countryName:"Lesotho"},{countryCode:"LR",countryName:"Liberia"},{countryCode:"LY",countryName:"Libya"},{countryCode:"LI",countryName:"Liechtenstein"},{countryCode:"LT",countryName:"Lithuania"},{countryCode:"LU",countryName:"Luxembourg"},{countryCode:"MO",countryName:"Macau"},{countryCode:"MK",countryName:"Macedonia"},{countryCode:"MG",countryName:"Madagascar"},{countryCode:"MW",countryName:"Malawi"},{countryCode:"MY",countryName:"Malaysia"},{countryCode:"MV",countryName:"Maldives"},{countryCode:"ML",countryName:"Mali"},{countryCode:"MT",countryName:"Malta"},{countryCode:"MH",countryName:"Marshall Islands"},{countryCode:"MQ",countryName:"Martinique"},{countryCode:"MR",countryName:"Mauritania"},{countryCode:"MU",countryName:"Mauritius"},{countryCode:"YT",countryName:"Mayotte"},{countryCode:"MX",countryName:"Mexico"},{countryCode:"FM",countryName:"Micronesia"},{countryCode:"MD",countryName:"Moldova"},{countryCode:"MC",countryName:"Monaco"},{countryCode:"MN",countryName:"Mongolia"},{countryCode:"ME",countryName:"Montenegro"},{countryCode:"MS",countryName:"Montserrat"},{countryCode:"MA",countryName:"Morocco"},{countryCode:"MZ",countryName:"Mozambique"},{countryCode:"MM",countryName:"Myanmar"},{countryCode:"NA",countryName:"Namibia"},{countryCode:"NR",countryName:"Nauru"},{countryCode:"NP",countryName:"Nepal"},{countryCode:"NL",countryName:"Netherlands"},{countryCode:"AN",countryName:"Netherlands Antilles"},{countryCode:"NC",countryName:"New Caledonia"},{countryCode:"NZ",countryName:"New Zealand"},{countryCode:"NI",countryName:"Nicaragua"},{countryCode:"NE",countryName:"Niger"},{countryCode:"NG",countryName:"Nigeria"},{countryCode:"NU",countryName:"Niue"},{countryCode:"NF",countryName:"Norfolk Island"},{countryCode:"MP",countryName:"Northern Mariana Islands"},{countryCode:"NO",countryName:"Norway"},{countryCode:"OM",countryName:"Oman"},{countryCode:"PK",countryName:"Pakistan"},{countryCode:"PW",countryName:"Palau"},{countryCode:"PS",countryName:"Palestine"},{countryCode:"PA",countryName:"Panama"},{countryCode:"PG",countryName:"Papua New Guinea"},{countryCode:"PY",countryName:"Paraguay"},{countryCode:"PE",countryName:"Peru"},{countryCode:"PH",countryName:"Philippines"},{countryCode:"PN",countryName:"Pitcairn"},{countryCode:"PL",countryName:"Poland"},{countryCode:"PT",countryName:"Portugal"},{countryCode:"PR",countryName:"Puerto Rico"},{countryCode:"QA",countryName:"Qatar"},{countryCode:"RE",countryName:"Reunion"},{countryCode:"RO",countryName:"Romania"},{countryCode:"RU",countryName:"Russian Federation"},{countryCode:"RW",countryName:"Rwanda"},{countryCode:"BL",countryName:"Saint BarthÃ©lemy"},{countryCode:"SH",countryName:"Saint Helena"},{countryCode:"KN",countryName:"Saint Kitts and Nevis"},{countryCode:"LC",countryName:"Saint Lucia"},{countryCode:"MF",countryName:"Saint Martin (French part)"},{countryCode:"PM",countryName:"Saint Pierre and Miquelon"},{countryCode:"VC",countryName:"Saint Vincent and the Grenadines"},{countryCode:"WS",countryName:"Samoa"},{countryCode:"SM",countryName:"San Marino"},{countryCode:"ST",countryName:"Sao Tome and Principe"},{countryCode:"SA",countryName:"Saudi Arabia"},{countryCode:"SN",countryName:"Senegal"},{countryCode:"RS",countryName:"Serbia"},{countryCode:"SC",countryName:"Seychelles"},{countryCode:"SL",countryName:"Sierra Leone"},{countryCode:"SG",countryName:"Singapore"},{countryCode:"SX",countryName:"Sint Maarten (Dutch part)"},{countryCode:"SK",countryName:"Slovakia"},{countryCode:"SI",countryName:"Slovenia"},{countryCode:"SB",countryName:"Solomon Islands"},{countryCode:"SO",countryName:"Somalia"},{countryCode:"ZA",countryName:"South Africa"},{countryCode:"GS",countryName:"South Georgia and South Sandwich Islands"},{countryCode:"SS",countryName:"South Sudan"},{countryCode:"ES",countryName:"Spain"},{countryCode:"LK",countryName:"Sri Lanka"},{countryCode:"SD",countryName:"Sudan"},{countryCode:"SR",countryName:"Suriname"},{countryCode:"SJ",countryName:"Svalbard and Jan Mayen Islands"},{countryCode:"SZ",countryName:"Swaziland"},{countryCode:"SE",countryName:"Sweden"},{countryCode:"CH",countryName:"Switzerland"},{countryCode:"TW",countryName:"Taiwan"},{countryCode:"TJ",countryName:"Tajikistan"},{countryCode:"TZ",countryName:"Tanzania"},{countryCode:"TH",countryName:"Thailand"},{countryCode:"TL",countryName:"Timor-Leste"},{countryCode:"TG",countryName:"Togo"},{countryCode:"TK",countryName:"Tokelau"},{countryCode:"TO",countryName:"Tonga"},{countryCode:"TT",countryName:"Trinidad and Tobago"},{countryCode:"TN",countryName:"Tunisia"},{countryCode:"TR",countryName:"Turkey"},{countryCode:"TM",countryName:"Turkmenistan"},{countryCode:"TC",countryName:"Turks and Caicos Islands"},{countryCode:"TV",countryName:"Tuvalu"},{countryCode:"UG",countryName:"Uganda"},{countryCode:"AE",countryName:"United Arab Emirates"},{countryCode:"GB",countryName:"United Kingdom"},{countryCode:"UM",countryName:"United States Minor Outlying Islands"},{countryCode:"UY",countryName:"Uruguay"},{countryCode:"UZ",countryName:"Uzbekistan"},{countryCode:"VU",countryName:"Vanuatu"},{countryCode:"VA",countryName:"Vatican City"},{countryCode:"VN",countryName:"Vietnam"},{countryCode:"VG",countryName:"Virgin Islands, British"},{countryCode:"VI",countryName:"Virgin Islands, U.S."},{countryCode:"WF",countryName:"Wallis and Futuna Islands"},{countryCode:"EH",countryName:"Western Sahara"},{countryCode:"YE",countryName:"Yemen"},{countryCode:"ZM",countryName:"Zambia"},{countryCode:"ZW",countryName:"Zimbabwe"}],this.usStatesArray=["AL","AK","AZ","AR","AE","AA","AP","CA","CO","CT","DE","DC","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"],this.canadaProvincesArray=["AB","BC","MB","NB","NL","NT","NS","NU","ON","PE","QC","SK","YT"],this.US_TERRITORIES_COUNTRIES_CODES=["PR","UM","GU","VI","AS","MP"]},a.SubscriptionsHelper.prototype.canPlanIdSeeAnnualPerks=function(e){return this.subscriptionsIdHasAnnualPerk[e]},a.SubscriptionsHelper.prototype.convertDesiredPlan=function(e){var t;if("pro-3month"===e||"pro-3month-v2"===e||"pro-1year"===e||"pro-2year"===e||"pro-2year-v2"===e)switch(e){case"pro-monthly":t="pro-monthly";break;case"pro-3month":case"pro-3month-v2":t="pro-3month-v2";break;default:t="pro-annual"}else t=""===e?"pro-annual":e;return t},a.SubscriptionsHelper.prototype.getPlanIdWithPlanName=function(e,t){var n=this.FLICKR_PRO_ANNUAL_PLAN_ID,t=t?this.subscriptionsIdByNameOnStripe:this.subscriptionsIdByName;return n=void 0!==t[e]?t[e]:n},a.SubscriptionsHelper.prototype.getPlanNameWithPlanId=function(e,t){var n,r="",i=t?this.subscriptionsIdByNameOnStripe:this.subscriptionsIdByName;for(n in this.subscriptionsIdByName)if(i[n]===e){r=n;break}return r},a.SubscriptionsHelper.prototype.canPurchaseAtLeastOnePlan=function(e){var t=[];return 0<(t=e?e.filter(function(e){return 1===e.canPurchase}):t).length},a.SubscriptionsHelper.prototype.canPurchaseThisPlanId=function(t,e){var n=[];return 0<(n=t&&e?e.filter(function(e){return e.planId===t}):n).length},a.SubscriptionsHelper.prototype.getNewProPlans=function(e){if(e)return e.filter(function(e){return"FlickrNewPro"===e.familyName})},a.SubscriptionsHelper.prototype.getOldProPlans=function(e){if(e)return e.filter(function(e){return"FlickrPro"===e.familyName})},a.SubscriptionsHelper.prototype.getPlanWithIdInPlansList=function(e){},a.SubscriptionsHelper.prototype.sanitizeCouponCode=function(e){var t=!1;if(e){if(t=e.trim(),e.length<=1)return!1;if(!t.match(/^[\w\-]+$/))return!1}return t},a.SubscriptionsHelper.prototype.convertLocaleToPaypalFormat=function(e){if(e)return{"de-DE":"de_DE","en-US":"en_US","es-US":"es_ES","fr-FR":"fr_FR","id-ID":"id_ID","it-IT":"it_IT","ko-KR":"ko_KR","pt-BR":"pt_PT","vi-VN":"en_US","zh-HK":"zh_HK"}[e]},a.SubscriptionsHelper.prototype.getStripeLocale=function(e){return e?{"de-DE":"de","en-US":"en","es-US":"es-419","fr-FR":"fr","id-ID":"id","it-IT":"it","ko-KR":"en","pt-BR":"pt-BR","vi-VN":"en","zh-HK":"zh"}[e]:"en"},a.SubscriptionsHelper.prototype.getNiceCardType=function(e){return this.cardTypeMap[e]},a.SubscriptionsHelper.prototype.getPaymentVendorType=function(e){return this.paymentVendorMap[e]},a.SubscriptionsHelper.prototype.isPaymentVendorBraintree=function(e){return e===this.paymentVendorMap.braintree},a.SubscriptionsHelper.prototype.isPaymentVendorDigitalRiver=function(e){return e===this.paymentVendorMap.digitalriver},a.SubscriptionsHelper.prototype.isPaymentVendorStripe=function(e){return e===this.paymentVendorMap.stripe},a.SubscriptionsHelper.prototype.isPaymentVendorAppleOrGoogle=function(e){return e===this.paymentVendorMap.apple||e===this.paymentVendorMap.google},a.SubscriptionsHelper.prototype.isPaymentVendorApple=function(e){return e===this.paymentVendorMap.apple},a.SubscriptionsHelper.prototype.isPaymentVendorGoogle=function(e){return e===this.paymentVendorMap.google},a.SubscriptionsHelper.prototype.hasYearlyLegalNotice=function(e){return this.subscriptionsIdHasAnnualPerk[e]},a.SubscriptionsHelper.prototype.log=function(e,t){!YUI.Env.isServer&&a.config.win.beaconError&&a.config.win.beaconError("[flickr-add-payment-method] "+e,a.config.win.location.href,t||{})},a.SubscriptionsHelper.prototype.beaconTransactionStep=function(e,t){!YUI.Env.isServer&&a.config.win.beaconError&&a.config.win.beaconError("[PRO] "+e,a.config.win.location.href,t||{})},a.SubscriptionsHelper.prototype.doesPlanIdHaveTrial=function(e){return e===this.FLICKR_PRO_ANNUAL_PLAN_ID||e===this.FLICKR_PRO_1_YEAR_PLAN_ID||e===this.FLICKR_PRO_2_YEARS_PLAN_ID},a.SubscriptionsHelper.prototype.canPurchaseTrialPlan=function(e,t){if(e&&t){e=e.getValue("products");return 0<a.Array.filter(e,function(e){return e.planId===this.FLICKR_PRO_ANNUAL_TRIAL&&1===e.canPurchase||e.planId===this.FLICKR_PRO_OLD_ANNUAL_TRIAL&&1===e.canPurchase}.bind(this)).length}},a.SubscriptionsHelper.prototype.getTrialLength=function(){return 45},a.SubscriptionsHelper.prototype.formatSubscriptionModels=function(e){if(!e)return[];e=e.toJSON();return e&&e.subscriptions&&e.subscriptions instanceof Array&&0!==e.subscriptions.length?a.Array.map(e.subscriptions,this.formatSubscriptionModel.bind(this)):[]},a.SubscriptionsHelper.prototype.formatSubscriptionModel=function(e){var t,n,r,i,o=!1;return e.amountBilled&&("number"==typeof e.amountBilled?e.amountBilled=e.amountBilled.toFixed(2):"string"==typeof e.amountBilled?e.amountBilled=parseInt(e.amountBilled,10).toFixed(2):e.amountBilled="0.00"),t=e.amountBilled,n=e.pendingPrice?e.pendingPrice.toFixed(2):"0.00",(r=this.isPaymentVendorStripe(parseInt(e.vendorId,10)))&&e.futureChanges&&(o={type:parseInt(e.futureChanges.type,10),intlName:this.getPlanIntlName(parseInt(e.futureChanges.type,10)),startDate:1e3*parseInt(e.futureChanges.startDate,10),currency:e.futureChanges.currency,hasDiscount:e.futureChanges.hasDiscount,basePrice:e.futureChanges.basePrice,totalPrice:e.futureChanges.totalPrice}),i=parseInt(e.status,10),{type:e.type,canSeeAnnualPerks:this.canPlanIdSeeAnnualPerks(e.type),startDate:1e3*parseInt(e.startDate,10),nextBillingDate:i===this.subscriptionStatusMap.active||i===this.subscriptionStatusMap.pending?a.moment(1e3*parseInt(e.nextBillingDate,10)):0,id:e.id,intlName:this.getPlanIntlName(parseInt(e.type,10)),name:e.prettyName,duration:e.billingScheduleMonths,price:t,pendingPrice:n,status:i,isClosed:i===this.subscriptionStatusMap.closed,isPastDue:i===this.subscriptionStatusMap.subscription_went_past_due,effectiveEndDate:1e3*parseInt(e.effectiveEndDate,10),paymentVendorType:e.paymentVendorType||e.vendorId,paymentMethodType:e.paymentMethodType,isBraintreeSubscription:this.isPaymentVendorBraintree(parseInt(e.paymentVendorType||e.vendorId,10)),isDigitalRiverSubscription:this.isPaymentVendorDigitalRiver(parseInt(e.paymentVendorType||e.vendorId,10)),isStripeSubscription:r,isGoogleOrAppleSubscription:this.isPaymentVendorAppleOrGoogle(parseInt(e.paymentVendorType||e.vendorId),10),transactions:e.transactions,futureChanges:o,isPayPal:e.paymentMethodType&&["1","2","4"].includes(e.paymentMethodType),btMigrationSegment:e.btMigrationSegment||void 0}},a.SubscriptionsHelper.prototype.getEligibleSubscription=function(e,t){var n,r,i=e.getValue("pending"),o=e.getValue("active"),a=e.getValue("pastDue");return t&&(r=e.getValue("closed")),i&&i.length?n=i[0]:o&&o.length?n=o[0]:a&&a.length?n=a[0]:t&&r&&r[0]&&(n=r[0]),n},a.SubscriptionsHelper.prototype.getActiveAndPendingSubscriptions=function(e){var t=a.Array.filter(this.formatSubscriptionModels(e),function(e){return e.status===this.subscriptionStatusMap.pending}.bind(this));return{activeSubs:a.Array.filter(this.formatSubscriptionModels(e),function(e){return e.status===this.subscriptionStatusMap.active||e.status===this.subscriptionStatusMap.closed&&void 0!==e.effectiveEndDate&&a.moment(e.effectiveEndDate).isAfter(a.moment())||e.status===this.subscriptionStatusMap.subscription_went_past_due}.bind(this)),pendingSubs:t}},a.SubscriptionsHelper.prototype.isUserOnActiveButClosedPro=function(e){e=this.getActiveAndPendingSubscriptions(e);return 1<=a.Array.filter(e.activeSubs,function(e){return e.status!==this.subscriptionStatusMap.active}.bind(this)).length&&e.pendingSubs&&0===e.pendingSubs.length},a.SubscriptionsHelper.prototype.isUserCurrentlyOnADigitalRiverSub=function(e){var t=this.getActiveAndPendingSubscriptions(e),n=!1;return t.activeSubs&&0<t.activeSubs.length&&(e=t.activeSubs[0],t.pendingSubs&&0<t.pendingSubs.length?(t=t.pendingSubs[0])&&(n=t.isDigitalRiverSubscription):n=e.isDigitalRiverSubscription),n},a.SubscriptionsHelper.prototype.isUserCurrentlyOnABraintreeSub=function(e){var t=this.getActiveAndPendingSubscriptions(e),n=!1,r=!1;return t.activeSubs&&0<t.activeSubs.length&&(e=t.activeSubs[0],t.pendingSubs&&0<t.pendingSubs.length?(t=t.pendingSubs[0])&&(n=t.isBraintreeSubscription,r=t.nextBillingDate):e.isClosed||(n=e.isBraintreeSubscription,r=e.nextBillingDate)),{isUserCurrentlyOnABraintreeSub:n,renewalDate:r}},a.SubscriptionsHelper.prototype.isUserCurrentlyOnAStripeSub=function(e){var t=this.getActiveAndPendingSubscriptions(e),n=!1,r=!1;return t.activeSubs&&0<t.activeSubs.length&&(e=t.activeSubs[0],t.pendingSubs&&0<t.pendingSubs.length?(t=t.pendingSubs[0])&&(n=t.isStripeSubscription,r=t.nextBillingDate):e.isClosed||(n=e.isStripeSubscription,r=e.nextBillingDate)),{isStripeSubscription:n,renewalDate:r}},a.SubscriptionsHelper.prototype.isUserCurrentlyOnAIAPSub=function(e){var t=this.getActiveAndPendingSubscriptions(e),n=!1;return t.activeSubs&&0<t.activeSubs.length&&(e=t.activeSubs[0],t.pendingSubs&&0<t.pendingSubs.length?(t=t.pendingSubs[0])&&(n=t.isGoogleOrAppleSubscription):e.isClosed||(n=e.isGoogleOrAppleSubscription)),n},a.SubscriptionsHelper.prototype.isUserPastDue=function(e){var t,e=this.getActiveAndPendingSubscriptions(e);return(t=a.Array.filter(e.activeSubs,function(e){return e.status===this.subscriptionStatusMap.subscription_went_past_due}.bind(this)))&&1<=t.length},a.SubscriptionsHelper.prototype.hasPurchasedTrialInThePast=function(e){e=e.toJSON();return 0<a.Array.filter(e,function(e){return e.planId===this.FLICKR_PRO_ANNUAL_TRIAL||e.planId===this.FLICKR_PRO_OLD_ANNUAL_TRIAL}.bind(this)).length},a.SubscriptionsHelper.prototype.isOnActiveTrial=function(e){var t=this.getActiveAndPendingSubscriptions(e),e=!1;return e=t&&t.activeSubs&&0<t.activeSubs.length?t.activeSubs[0].type===this.FLICKR_PRO_ANNUAL_TRIAL||t.activeSubs[0].type===this.FLICKR_PRO_OLD_ANNUAL_TRIAL:e},a.SubscriptionsHelper.prototype.isOneTimePro=function(e){return e.toJSON().oneTimePro.isOneTimePro},a.SubscriptionsHelper.prototype.getShopperCurrencyAndLocale=function(e){var t="US",n="en_US",r="USD",i=!1;if(!e&&a.config.flickr.geo?(a.config.flickr.geo.countryCode&&(t=a.config.flickr.geo.countryCode),a.config.flickr.geo.eu&&(i=a.config.flickr.geo.eu)):e&&(t=e.countryCode||"US",i=e.eu||!1),i)r="GB"===t?(n="en_IE","GBP"):(n="en_IE","EUR");else if(-1<this.US_TERRITORIES_COUNTRIES_CODES.indexOf(t))n="en_US",r="USD";else switch(t){case"US":n="en_US",r="USD";break;case"CA":n="en_IE",r="CAD";break;default:n="en_IE",r="USD"}return{locale:n,currency:r}},a.SubscriptionsHelper.prototype.getPlanIntlName=function(e){switch(e){case this.FLICKR_PRO_MONTHLY_PLAN_ID:case this.FLICKR_PRO_1_MONTH_V2_APPLE_ID:case this.FLICKR_PRO_1_MONTH_V2_GOOGLE_ID:case this.FLICKR_PRO_STRIPE_MONTHLY_PLAN_ID:return"checkout.FLICKR_MONTHLY_PRO_PLAN";case this.FLICKR_PRO_3_MONTH_PLAN_ID:case this.FLICKR_PRO_3_MONTH_V2_PLAN_ID:case this.FLICKR_PRO_STRIPE_3_MONTH_PLAN_ID:return"checkout.FLICKR_3_MONTHS_PRO_PLAN";case this.FLICKR_PRO_1_YEAR_PLAN_ID:case this.FLICKR_PRO_ANNUAL_PLAN_ID:case this.FLICKR_PRO_1_YEAR_V2_APPLE_ID:case this.FLICKR_PRO_1_YEAR_V2_GOOGLE_ID:case this.FLICKR_PRO_STRIPE_ANNUAL_PLAN_ID:return"checkout.FLICKR_ANNUAL_PRO_PLAN";case this.FLICKR_PRO_2_YEARS_PLAN_ID:case this.FLICKR_PRO_2_YEAR_V2_PLAN_ID:return"checkout.FLICKR_2_YEAR_PRO_PLAN";default:return"common.FLICKR_PRO"}},a.SubscriptionsHelper.prototype.getPriceWithCurrency=function(e,t,n){n=n.replace("_","-");return new Intl.NumberFormat(n,{style:"currency",currency:t}).format(e)},a.SubscriptionsHelper.prototype.doesCountryRequiresSignedInGifting=function(e){return!(!e||!e.countryCode||"VN"!==e.countryCode)},a.SubscriptionsHelper.prototype.isADeniedCountry=function(e){return!!(e&&e.countryCode&&-1<["VE","CU","IR","IQ","KP","SY"].indexOf(e.countryCode))},a.SubscriptionsHelper.prototype.isProductPubliclyAvailable=function(e){return!(!e||e===this.FLICKR_PRO_2_YEAR_V2_PLAN_ID)},a.SubscriptionsHelper.prototype.parseEffectiveSubscriptionData=function(e,t){var n,r,i=!1,o=!1,a=!1;return e&&t&&t.length&&(1<t.length&&t.sort(function(e,t){return parseInt(e.startDate,10)<parseInt(t.startDate)}),n=parseInt(t[0].status,10),r=parseInt(t[0].effectiveEndDate,10),parseInt(t[0].nextBillingDate,10),i=n===this.subscriptionStatusMap.closed&&r>parseInt((new Date).getTime()/1e3,10),(a=n===this.subscriptionStatusMap.pending)&&this.isSubscriptionPendingAndPaidFor(t[0]),n===this.subscriptionStatusMap.active&&parseInt((new Date).getTime()/1e3,10),o=n===this.subscriptionStatusMap.subscription_went_past_due),{isPro:e,isClosed:i,isPastDue:o,isPending:a}},a.SubscriptionsHelper.prototype.isOneTimePro=function(e){return!(!e||!e.getValue("isPro"))&&e.getValue("proExpireDate")&&e.getValue("proExpireDate").isAfter()},a.SubscriptionsHelper.prototype.parseEffectiveSubscriptions=function(e){return e?a.Array.map(e,this.formatSubscriptionModel.bind(this)):[]},a.SubscriptionsHelper.prototype.isAMonthlySub=function(e){var t=[this.FLICKR_PRO_3_MONTH_PLAN_ID,this.FLICKR_PRO_MONTHLY_PLAN_ID,this.FLICKR_PRO_3_MONTH_V2_PLAN_ID];return!!(e&&-1<t.indexOf(e))},a.SubscriptionsHelper.prototype.isSubscriptionPendingAndPaidFor=function(e){return!!e&&parseInt(e.status,10)===this.subscriptionStatusMap.pending&&e.transactions&&0<e.transactions.length},a.SubscriptionsHelper.prototype.getErrorMessageIntlKeyForStripeErrorCode=function(e){if(e){var t=!1;switch(e){case"incorrect_cvc":t="checkout.PLEASE_ENTER_CORRECT_VALID_CVV";break;case"processing_error":t="checkout.PROCESSING_ERROR";break;case"expired_card":t="checkout.YOUR_CARD_IS_EXPIRED";break;case"card_declined":t="checkout.YOUR_CARD_WAS_DECLINED";break;default:t="checkout.PROCESSING_ERROR"}return t}},a.SubscriptionsHelper.prototype.trackAddToCart=function(e){a.Snowplough&&e?a.Snowplough.sendSelfDescribingEvent({schema:a.Snowplough.SCHEMAS.ADD_TO_CART,data:{sku:e.sku,name:e.name,category:"subscription",unitPrice:e.unitPrice,quantity:1,currency:e.currency}}):t.error("Missing Y.Snowplough in Y.SubscriptionsHelper.trackAddToCart")},a.SubscriptionsHelper.prototype.sendSuccessfulPurchaseEvent=function(e){a.Snowplough&&e?a.Snowplough.sendSelfDescribingEvent({schema:a.Snowplough.SCHEMAS.SUBSCRIPTION_PURCHASE_EVENT,data:{sku:parseInt(e.sku,10),nsid:e.nsid,flow:"purchase",currency:e.currency,totalPrice:e.totalPrice}}):t.error("Missing Y.Snowplough in Y.SubscriptionsHelper.sendSuccessfulPurchaseEvent")},a.SubscriptionsHelper.prototype.sendPurchaseFunnelEvent=function(e){a.Snowplough&&e?a.Snowplough.sendSelfDescribingEvent({schema:a.Snowplough.SCHEMAS.SUBSCRIPTION_PURCHASE_FUNNEL_EVENT,data:{nsid:e.nsid||"",sku:parseInt(e.sku,10)||0,step:e.step,currency:e.currency||"",signedIn:e.signedIn||!1}}):t.error("Missing Y.Snowplough in Y.SubscriptionsHelper.sendPurchaseFunnelEvent")},a.SubscriptionsHelper.prototype.sendCancellationFlowEvent=function(e){a.Snowplough&&e?a.Snowplough.sendSelfDescribingEvent({schema:a.Snowplough.SCHEMAS.SUBSCRIPTION_CANCEL_FLOW_EVENT,data:{nsid:e.nsid,currentSku:parseInt(e.currentSku,10),feedbackId:e.feedbackId||null,paymentVendorType:parseInt(e.paymentVendorType,10),cancellationStep:e.cancellationStep,cancellationReasonPicked:e.cancellationReasonPicked?parseInt(e.cancellationReasonPicked,10):null,cancellationReasonText:e.cancellationReasonText||null,bucket:e.bucket,eligibleForSurvey:e.eligibleForSurvey}}):t.error("Missing Y.Snowplough in Y.SubscriptionsHelper.sendCancellationFlowEvent")}},"@VERSION@",{requires:["moment","timezone-helper","array-extras"],optional:[]}),YUI.add("effective-subscriptions-models",function(t){function n(e){n.superclass.constructor.call(this,e)}t.Models[this.name]=n,t.extend(n,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-subscriptions-getEffectiveSubscriptions-fetcher"].run(e,this.appContext)}},attributes:{active:{},closed:{},pending:{},pastDue:{},all:{},length:{defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-subscriptions-getEffectiveSubscriptions-fetcher"]}),YUI.add("flickr-subscriptions-getEffectiveSubscriptions-fetcher",function(e,i){var o=new e.SubscriptionsHelper;e.namespace("ModelFetchers")["flickr-subscriptions-getEffectiveSubscriptions-fetcher"]={run:function(t,n){var r=this;return e.Promise.all([n.callAPI("flickr.subscriptions.getEffectiveSubscriptions",t),n.getModelRegistry("effective-subscriptions-models")]).then(function(e){return r._processResponse(e,t,n)},e.FetcherErrorLogger(i))},_processResponse:function(e,t,n){var r=e[0],i=e[1],e={id:t.id,all:[],active:[],pending:[],closed:[],pastDue:[]};r&&"ok"===r.stat&&r.subscriptions&&(t=0,(r=r.subscriptions)&&(r.all&&(e.all=o.parseEffectiveSubscriptions(r.all),t+=r.all.length),r.active&&(e.active=o.parseEffectiveSubscriptions(r.active),t+=r.active.length),r.pending&&(e.pending=o.parseEffectiveSubscriptions(r.pending),t+=r.pending.length),r.closed&&(e.closed=o.parseEffectiveSubscriptions(r.closed),t+=r.closed.length),r.subscription_went_past_due&&(e.pastDue=o.parseEffectiveSubscriptions(r.subscription_went_past_due),t+=r.subscription_went_past_due.length),e.length=t)),i.addOrUpdate(e)}}},"@VERSION@",{requires:["flickr-promise","flickr-promise","effective-subscriptions-models","subscriptions-helper"],optional:["api-helper"]});
