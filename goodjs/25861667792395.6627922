(window.monolithJsonpFunction=window.monolithJsonpFunction||[]).push([["91a39cfd"],{10678:function(e,t,n){"use strict";var r=n(4194),s=n.n(r),a=(babelHelpers.createClass(i,[{key:"send",value:function(){throw new Error("not implemented")}},{key:"dispose",value:function(){throw new Error("not implemented")}}]),i);function i(){babelHelpers.classCallCheck(this,i),this.message={},this.transport="unknown"}a.TIMEOUT="timeout",a.ABORT="abort";function u(e){return 1.2*y(e)}var o=function(e){return+e},c=o(15e3),l=o(15e3),d=o(25e3),f=o(1e4),h=o(1e3),p=o(8e3),E=o(3e4),v=o(500),m=o(500),g=o(25e3),S=o(500),y=function(e){return o(e<=100?1e4:e/10*1e3)};var b=function(){babelHelpers.inherits(o,a);var n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function o(e,t,n){var r,s=(3<arguments.length&&void 0!==arguments[3]?arguments[3]:{}).timeout,s=void 0===s?l:s;if(babelHelpers.classCallCheck(this,o),r=i.call(this),!(e instanceof WebSocket))throw new Error("First argument should be a WebSocket instance");if(null===t||"object"!==babelHelpers.typeof(t)||t.constructor!==Object)throw new Error("Second argument should be a plain object");if("function"!=typeof n)throw new Error("Third argument should be a function");return r.ws=e,r.message=t,r.responseConfirmation=n,r.timeout=s,r.sendingTimeoutId=null,r.waitingTimeoutId=null,r.promise=new Promise(function(e,t){r.resolve=e,r.reject=t}),r.transport="ws",r.handleMessage=r.handleMessage.bind(babelHelpers.assertThisInitialized(r)),r}return babelHelpers.createClass(o,[{key:"send",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if(!this.ws||-1!==[WebSocket.CLOSED,WebSocket.CLOSING].indexOf(this.ws.readyState))return Promise.reject(new Error("WebSocket is not open: closed or closing"));if(this.ws.readyState===WebSocket.CONNECTING)return t<o.MAX_RESENDS?this.waitFor(v).then(function(){return e.send(t+1)}):Promise.reject(new Error("WebSocket is not open: still connecting after ".concat(o.MAX_RESENDS," tries")));try{this.ws.send(JSON.stringify(this.message)),this.ws.addEventListener("message",this.handleMessage)}catch(e){return Promise.reject(e)}return this.sendingTimeoutId=setTimeout(function(){e.dispose(o.TIMEOUT)},this.timeout),this.promise}},{key:"dispose",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:o.ABORT;clearTimeout(this.sendingTimeoutId),clearTimeout(this.waitingTimeoutId),e!==o.SENT&&this.reject(new Error(e)),this.ws.removeEventListener("message",this.handleMessage)}},{key:"waitFor",value:function(t){var n=this;return clearTimeout(this.waitingTimeoutId),new Promise(function(e){n.waitingTimeoutId=setTimeout(e,t)})}},{key:"handleMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(e){}t&&this.responseConfirmation(t)&&(this.resolve(t),this.dispose(o.SENT))}}]),o}();b.TIMEOUT=a.TIMEOUT,b.ABORT=a.ABORT,b.SENT="sent",b.MAX_RESENDS=3;function I(e,t){return Math.floor(Math.random()*(t-e))+e}var T=(babelHelpers.createClass(L,[{key:"incr",value:function(){var e=this.nextId;return this.nextId+=2,this.nextId>Number.MAX_SAFE_INTEGER&&(this.nextId=Number.MIN_SAFE_INTEGER+(this.odd?0:1)),e}}]),L),_=(babelHelpers.createClass(k,[{key:"connect",value:function(){clearTimeout(this.reconnectionTimeoutId)}},{key:"reconnect",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.event,r=t.error,t=t.timeout,t=void 0===t?this.getReconnectAttemptTimeout():t;clearTimeout(this.reconnectionTimeoutId),this.isMaxReconnectionsExceeded()?this.switchTransport({event:n,error:r}):(this.reconnectionTimeoutId=setTimeout(function(){e.incrementReconnectionsCounter(),e.reconnectMethod()},t),this.emitSystemMessage("reconnect",{event:n,error:r}))}},{key:"reconnectMethod",value:function(){throw Error("Unimplemented")}},{key:"disconnect",value:function(){clearTimeout(this.reconnectionTimeoutId),this.resetReconnectionsCounter(),this.requestsQueue.clear()}},{key:"emitSystemMessage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.event,t=t.error;this.context.emit("notify",{type:"system",value:{type:e,event:n,error:t}})}},{key:"transportCode",get:function(){return"undefined"}},{key:"getState",value:function(){return null}},{key:"getReconnectionCounter",value:function(){return this.reconnectionsCounter}},{key:"getReconnectAttemptTimeout",value:function(){var e=3<=this.reconnectionsCounter?p:h*Math.pow(2,this.reconnectionsCounter+1);return e+I(1,.2*e)}},{key:"incrementReconnectionsCounter",value:function(){this.reconnectionsCounter++}},{key:"resetReconnectionsCounter",value:function(){this.reconnectionsCounter=0}},{key:"isMaxReconnectionsExceeded",value:function(){return 3<=this.reconnectionsCounter}},{key:"switchTransport",value:function(e){this.emitSystemMessage("switch",e)}}]),k),C=n(4195),O=1e3,R=3410,w=[4998],A=[O,1001,3401,3403,3429];function k(e,t){var n=t.context,t=t.seq;babelHelpers.classCallCheck(this,k),this.reconnectionsCounter=0,this.context=n,this.requestsQueue=e,this.reconnectionTimeoutId=null,t&&(this.seq=t)}function L(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;babelHelpers.classCallCheck(this,L),this.nextId=0,this.nextId=e,this.odd=Boolean(e%2)}function M(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}var P=function(){babelHelpers.inherits(i,_);var t,e,n,r,s=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function i(e,t){var n;return babelHelpers.classCallCheck(this,i),(n=s.call(this,e,t)).runPingPolling=function(){clearTimeout(n.pingTimeoutId),n.pingTimeoutId=setTimeout(babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.request({method:"ping",params:{}});case 3:n.runPingPolling(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n.disconnect(4999);case 9:case"end":return e.stop()}},e,null,[[0,6]])})),d)},n.wasConnected=!1,n.options=t,n.ws=null,n.messageIdCounter=new T(1),n.isConnectionTimeOut=!1,n.hasSuccessfulRequest=null,n.pingTimeoutId=null,n.connectionTimeoutId=null,n.handleOpen=n.handleOpen.bind(babelHelpers.assertThisInitialized(n)),n.handleClose=n.handleClose.bind(babelHelpers.assertThisInitialized(n)),n.handleError=n.handleError.bind(babelHelpers.assertThisInitialized(n)),n.handleMessage=n.handleMessage.bind(babelHelpers.assertThisInitialized(n)),n}return babelHelpers.createClass(i,[{key:"buildEndpointUrl",value:function(){var e=this.options,t=e.wsEndpoint,n=e.appName,r=e.appVersion,e=encodeURIComponent(n),n=encodeURIComponent(r),r=1===t.split("?").length?"?":"&",n="".concat(t).concat(r,"use_seq=true&app_name=").concat(e)+"&app_version=".concat(n,"&old_notify=false&pv=4");return this.seq&&(n+="&seq=".concat(this.seq)),n}},{key:"transportCode",get:function(){return i.transportCode}},{key:"connect",value:(e=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"connect",this).call(this),this.clearTimers(),e.prev=2,this.ws=new WebSocket(this.buildEndpointUrl()),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),this.switchTransport({error:e.t0}),e.abrupt("return");case 10:this.ws.addEventListener("open",this.handleOpen),this.ws.addEventListener("error",this.handleError),this.ws.addEventListener("close",this.handleClose),this.ws.addEventListener("message",this.handleMessage),this.connectionTimeoutId=setTimeout(function(){t.disconnect(4998)},c);case 15:case"end":return e.stop()}},e,this,[[2,6]])})),function(){return e.apply(this,arguments)})},{key:"disconnect",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:O;babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"disconnect",this).call(this),this.clearTimers(),this.ws&&(this.ws.removeEventListener("close",this.handleError),this.ws.close(e),this.handleClose({code:e,message:"Transport run disconnect"}))}},{key:"clearSocket",value:function(){this.clearTimers(),this.ws&&(this.ws.removeEventListener("open",this.handleOpen),this.ws.removeEventListener("error",this.handleError),this.ws.removeEventListener("close",this.handleClose),this.ws.removeEventListener("message",this.handleMessage),this.ws=null,this.requestsQueue.clear())}},{key:"clearTimers",value:function(){clearTimeout(this.pingTimeoutId),clearTimeout(this.connectionTimeoutId)}},{key:"convertToAPIErrorCode",value:function(e){var t=C.c.ERROR_CODES,n=t.NOT_AUTHORIZED,r=t.INTERNAL_ERROR,s=t.CLOSE_NORMAL,i=t.MESSAGE_LOG_GONE;switch(e){case 3401:return n;case O:case 1001:return s;case R:return i;default:return r}}},{key:"getState",value:function(){return this.ws?this.ws.readyState:null}},{key:"request",value:(t=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r,s,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.method,r=t.params,this.getState()!==WebSocket.OPEN)return o=new Error("WebSocket is not open"),e.abrupt("return",Promise.reject(o));e.next=4;break;case 4:return s=this.messageIdCounter.incr(),i={id:s,method:n,params:r,jsonrpc:"2.0"},o=function(e){return"2.0"===e.jsonrpc&&e.id===s},o=new b(this.ws,i,o),e.next=10,this.requestsQueue.send(o);case 10:if((a=e.sent).id=void 0,this.hasSuccessfulRequest=!0,this.runPingPolling(),"error"in a)throw function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},a.error,{rpcId:a.rpcId,requestId:a.requestId});e.next=17;break;case 17:return e.abrupt("return",a);case 18:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"reconnectMethod",value:function(){this.clearTimers(),this.connect()}},{key:"isMaxReconnectionsExceeded",value:function(){return!this.hasSuccessfulRequest&&babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"isMaxReconnectionsExceeded",this).call(this)}},{key:"handleOpen",value:function(e){this.clearTimers(),this.wasConnected||(this.wasConnected=!0),this.emitSystemMessage("open",{event:e}),this.runPingPolling(),0<this.getReconnectionCounter()&&this.emitSystemMessage("reconnected",{event:e}),this.resetReconnectionsCounter()}},{key:"handleClose",value:function(e){this.clearSocket();var t=e.code,n=new C.c({code:this.convertToAPIErrorCode(t)});A.includes(t)?this.emitSystemMessage("close",{error:n,event:e}):1006===t&&!this.wasConnected||w.includes(t)?this.switchTransport({error:n,event:e}):(t===R&&(this.seq=void 0),this.reconnect({error:n,event:e}))}},{key:"handleError",value:function(e){var t=new C.c({code:this.convertToAPIErrorCode(e.code)});this.emitSystemMessage("error",{error:t,event:e})}},{key:"handleMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(t){return void this.emitSystemMessage("error",{error:new C.c({code:C.c.ERROR_CODES.PARSE_ERROR,message:"Parsing message error"}),event:{data:e.data}})}e=t.seq||(t.value?t.value.seq:null);e&&(this.seq=e),this.context.emit("notify",t)}}],[{key:"isSupported",value:function(){var e=navigator.userAgent.match(/android\s([0-9\.]+)/i)||[],e=babelHelpers.slicedToArray(e,2)[1],e=parseFloat(e);return"undefined"!=typeof WebSocket&&(!e||4.4<=e)}}]),i}();P.transportCode="ws";var U,N=function(){babelHelpers.inherits(i,a);var n,r,s=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function i(e,t){var n,r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).timeout;return babelHelpers.classCallCheck(this,i),(n=s.call(this)).message=t,n.timeout=r,n.endpoint=e,n.xhr=null,n.promise=new Promise(function(e,t){n.resolve=e,n.reject=t}),n.transport="http",n}return babelHelpers.createClass(i,[{key:"send",value:function(){var t=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,r=new XMLHttpRequest;return(this.xhr=r).open("POST",this.endpoint),r.withCredentials=!0,this.timeout&&(r.timeout=this.timeout),r.onload=function(){if(200===r.status){var e;try{e=JSON.parse(r.responseText)}catch(e){return void t.reject(new Error("bad response format"))}if(void 0!==e.id&&null!==e.id&&t.message.id!==e.id)return 3<=n?void t.reject(new Error("max rerun count exceeded")):void t.send(n+1);t.resolve(e)}else t.reject({code:r.status,message:r.responseText})},r.onerror=function(e){t.reject(e)},r.onabort=function(){t.reject(new Error(i.ABORT))},r.ontimeout=function(){t.reject(new Error(i.TIMEOUT))},r.setRequestHeader("accept",null),r.setRequestHeader("accept-language",null),r.send(JSON.stringify(this.message)),this.promise}},{key:"dispose",value:function(){this.xhr&&this.xhr.abort()}}]),i}();N.TIMEOUT=a.TIMEOUT,N.ABORT=a.ABORT;var H=new Uint8Array(16);for(var x=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,D=[],j=0;j<256;++j)D.push((j+256).toString(16).substr(1));function q(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=(D[e[t+0]]+D[e[t+1]]+D[e[t+2]]+D[e[t+3]]+"-"+D[e[t+4]]+D[e[t+5]]+"-"+D[e[t+6]]+D[e[t+7]]+"-"+D[e[t+8]]+D[e[t+9]]+"-"+D[e[t+10]]+D[e[t+11]]+D[e[t+12]]+D[e[t+13]]+D[e[t+14]]+D[e[t+15]]).toLowerCase();if("string"!=typeof(t=e)||!x.test(t))throw TypeError("Stringified UUID is invalid");return e}function F(){try{return JSON.parse(localStorage.getItem(G)||"[]")}catch(e){}return null}function Q(e){try{localStorage.setItem(G,JSON.stringify(e))}catch(e){}}var G="__socket-client-tabs",B="__socket-client-updates",W=function(e){e=(e=e||{}).random||(e.rng||function(){if(!U&&!(U="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return U(H)})();return e[6]=15&e[6]|64,e[8]=63&e[8]|128,q(e)}();function V(){try{window.localStorage.removeItem(B)}catch(e){}}function K(e){try{window.localStorage.setItem(B,JSON.stringify(e))}catch(e){}V()}function z(r){V();function e(e){var t,n=e.key;if((e=e.newValue)&&n===B){try{t=JSON.parse(e)}catch(e){return}r(t)}}return window.addEventListener("storage",e),function(){return window.removeEventListener("storage",e)}}function Y(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}var J=[C.a.NOT_AUTHORIZED],X=function(){babelHelpers.inherits(o,_);var t,e,n,r,s,i=(r=o,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(r);return t=s?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function o(e,t){var a;return babelHelpers.classCallCheck(this,o),(a=i.call(this,e,t)).tabCheck=function(){clearTimeout(a.healthCheckTimeoutId);var e=F(),t=u(e.length||1),n=Date.now(),r=e.filter(function(e){e=e.lastTime;return n-e<=t}),s=e.find(function(e){return e.tabId===W})||{},i=Boolean(s.isMaster),o=n-s.lastTime<=t,s=e.filter(function(e){return e.isMaster}),e=s.filter(function(e){e=e.lastTime;return n-e<=t});s.length&&e.length||i?i&&!o?(a.isMaster=!1,clearTimeout(a.pollingTimeoutId)):a.isMaster=i:(a.isMaster=!0,a.runPolling());r=r.filter(function(e){return e.tabId!==W}).concat({tabId:W,lastTime:n,isMaster:a.isMaster});Q(r),a.healthCheckTimeoutId=setTimeout(a.tabCheck,y(r.length))},a.fetchUpdates=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.isMaster){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,a.request({method:"getSocketMessages",params:{seq:a.seq}});case 5:t=e.sent,K(t=t.result),a.handleUpdates(t),a.runPolling(),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(2),a.handleError(e.t0),e.t0;case 16:case"end":return e.stop()}},e,null,[[2,12]])})),a.tryFetchUpdates=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.fetchUpdates();case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 9:case"end":return e.stop()}},e,null,[[0,6]])})),a.handleUpdates=function(e){e&&e.length&&e.forEach(function(e){return setTimeout(function(){a.context.emit("notify",e),e.seq&&(a.seq=e.seq)},0)})},a.handleError=function(e){a.clearTimers();e=new C.c({code:a.convertToAPIErrorCode(e.code),message:e.message});if(J.includes(e.code))return a.emitSystemMessage("close",{error:e}),void a.unlistenTabUpdates();e.code===C.a.MESSAGE_LOG_GONE&&(a.seq=void 0),a.reconnect({error:e})},a.options=t,a.endpoint=a.buildEndpointUrl(),a.messageIdCounter=new T(1),a.pollingTimeoutId=null,a.healthCheckTimeoutId=null,a.isMaster=!1,a}return babelHelpers.createClass(o,[{key:"connect",value:(n=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0<r.length&&void 0!==r[0]?r[0]:{}).isOnlineEvent,babelHelpers.get(babelHelpers.getPrototypeOf(o.prototype),"connect",this).call(this),this.clearTimers(),e.prev=3,e.next=6,this.request({method:"avito.getSession",params:{seq:this.seq}});case 6:n=e.sent,n=n.result,this.emitSystemMessage("open"),this.context.emit("notify",{type:"session",value:n}),n.seq&&(this.seq=n.seq),this.tabCheck(),this.listenTabUpdates(),t?this.tryFetchUpdates():this.runPolling(),0<this.getReconnectionCounter()&&this.emitSystemMessage("reconnected"),this.resetReconnectionsCounter(),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),this.handleError(e.t0);case 21:case"end":return e.stop()}},e,this,[[3,18]])})),function(){return n.apply(this,arguments)})},{key:"buildEndpointUrl",value:function(){var e=this.options,t=e.httpEndpoint,n=e.appName,r=e.appVersion,e=encodeURIComponent(n),n=encodeURIComponent(r),r=1===t.split("?").length?"?":"&";return"".concat(t).concat(r,"app_name=").concat(e)+"&app_version=".concat(n,"&old_notify=false&pv=4")}},{key:"convertToAPIErrorCode",value:function(e){switch(e){case C.b:return C.a.NOT_AUTHORIZED;case C.a.MESSAGE_LOG_GONE:return e;default:return C.a.INTERNAL_ERROR}}},{key:"transportCode",get:function(){return o.transportCode}},{key:"disconnect",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(o.prototype),"disconnect",this).call(this),this.clearTimers(),this.emitSystemMessage("close"),this.unlistenTabUpdates()}},{key:"runPolling",value:function(){clearTimeout(this.pollingTimeoutId),this.isMaster&&(this.pollingTimeoutId=setTimeout(this.tryFetchUpdates,f))}},{key:"reconnectMethod",value:(e=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.seq)return this.tabCheck(),this.listenTabUpdates(),e.next=5,this.tryFetchUpdates();e.next=10;break;case 5:if(!e.sent){e.next=8;break}0<this.getReconnectionCounter()&&this.emitSystemMessage("reconnected"),this.resetReconnectionsCounter();case 8:e.next=11;break;case 10:this.connect();case 11:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"listenTabUpdates",value:function(){this.unlistenTabUpdates(),this.unlistenTabUpdatesInternal=z(this.handleUpdates)}},{key:"unlistenTabUpdates",value:function(){this.unlistenTabUpdatesInternal&&(this.unlistenTabUpdatesInternal(),this.unlistenTabUpdatesInternal=null)}},{key:"request",value:(t=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.method,r=t.params,r={jsonrpc:"2.0",id:this.messageIdCounter.incr(),method:n,params:r},r=new N(this.endpoint,r),e.next=5,this.requestsQueue.send(r);case 5:if("error"in(s=e.sent))throw function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Y(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},s.error,{rpcId:s.rpcId,requestId:s.requestId});e.next=9;break;case 9:return e.abrupt("return",s);case 10:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"clearTimers",value:function(){clearTimeout(this.pollingTimeoutId),clearTimeout(this.healthCheckTimeoutId)}}]),o}();X.transportCode="http";var Z=(babelHelpers.createClass(te,[{key:"send",value:function(n){var r=this;if(!(n instanceof a))throw new Error("argument is not instance of Request");var s=this.getHash(n.message),e=this.sendingPromisesByHash[s];if(e)return e;if(this.processingQueue.length>=this.maxParallelRequests){e=new Promise(function(e,t){r.waitingQueue.push({request:n,resolve:e,reject:t,hash:s})});return this.sendingPromisesByHash[s]=e}return this.forceSend(n,s)}},{key:"clear",value:function(){this.waitingQueue.forEach(function(e){return e.request.dispose()}),this.processingQueue.forEach(function(e){return e.dispose()}),this.waitingQueue=[],this.processingQueue=[],this.sendingPromisesByHash={}}},{key:"remove",value:function(t){if(!(t instanceof a))throw new Error("argument is not instance of Request");var e=this.getHash(t.message);this.processingQueue=this.processingQueue.filter(function(e){return e!==t}),this.waitingQueue=this.waitingQueue.filter(function(e){return e.request!==t}),delete this.sendingPromisesByHash[e],t.dispose(),this.processWaitingQueue()}},{key:"forceSend",value:function(t,n){var r=this;n=n||this.getHash(t.message);var e=t.send();return this.sendingPromisesByHash[n]=e,this.processingQueue.push(t),e.then(function(e){return r.onRequestEnd(t,n),e}).catch(function(e){return r.onRequestEnd(t,n),Promise.reject(e)})}},{key:"processWaitingQueue",value:function(){var e,t,n,r;this.waitingQueue.length&&(e=(r=this.waitingQueue.shift()).request,t=r.resolve,n=r.reject,r=r.hash,this.forceSend(e,r).then(function(e){return t(e)}).catch(function(e){return n(e)}))}},{key:"getHash",value:function(n){if(!this.hashFields.length)return JSON.stringify(n);var e=this.hashFields.reduce(function(e,t){return void 0!==n[t]&&(e[t]=n[t]),e},{});return JSON.stringify(e)}},{key:"onRequestEnd",value:function(t,e){this.processingQueue=this.processingQueue.filter(function(e){return e!==t}),delete this.sendingPromisesByHash[e],this.processWaitingQueue()}}]),te),$=(babelHelpers.createClass(ee,[{key:"patchRequestsSend",value:function(s){var i=this,o=s.send;s.send=function(t){i.logMessage(ee.OUT,t.message,t.transport);for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return o.call.apply(o,[s,t].concat(n)).then(function(e){return i.logMessage(ee.IN,e,t.transport),e})}}},{key:"setTransport",value:function(e){this.transport=e}},{key:"setRequestsQueue",value:function(e){(this.requests=e)&&this.patchRequestsSend(e)}},{key:"stringifyMessage",value:function(e){var t=Object.assign({},e),e=t.value;return e&&e.event instanceof Event&&(e.event={code:e.event.code}),e&&e.error instanceof Error&&(e.error={message:e.error.message,stack:e.error.stack}),JSON.stringify(t)}},{key:"logMessage",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:ee.UNKNOWN,t=1<arguments.length?arguments[1]:void 0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.transport,t="string"==typeof t?t:this.stringifyMessage(t),t={time:Date.now(),type:e,transport:n,message:t};this.messageLogs.length>=this.messagesLogSize&&this.messageLogs.shift(),this.messageLogs.push(t)}},{key:"logScStateToCs",value:function(e){var t;this.sendEvent&&this.sendEvent(5015,{uid:null!==(t=this.userId)&&void 0!==t?t:void 0,msg_state_id:e,version:1})}}]),ee);function ee(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{messagesLogSize:20};babelHelpers.classCallCheck(this,ee),this.userId=null,this.sessionGetTime=null,this.messageLogs=[],this.context=t,this.messagesLogSize=r.messagesLogSize,this.userId=null,this.transport=null,this.messageLogs=[],this.initTime=Date.now(),this.sessionGetTime=null,this.sendEvent=r.sendEvent,this.setRequestsQueue(e),this.context.on("notify",function(e){"session"===e.type&&(n.sessionGetTime=Date.now()-n.initTime,n.userId=e.value.userId),["session","system"].includes(e.type)&&n.logMessage(ee.NOTIFY,e)})}function te(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.maxParallelRequests,t=void 0===t?10:t,e=e.hashFields,e=void 0===e?[]:e;if(babelHelpers.classCallCheck(this,te),"number"!=typeof t||isNaN(t))throw new Error("maxParallelRequests is not a number");if(!Array.isArray(e))throw new Error("hashFields is not an array");this.maxParallelRequests=t,this.hashFields=e,this.waitingQueue=[],this.processingQueue=[],this.sendingPromisesByHash={}}function ne(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}$.UNKNOWN="unknown",$.NOTIFY="notify",$.OUT="out",$.IN="in";function re(e){var r=this;babelHelpers.classCallCheck(this,re),this.timeoutId=0,"number"==typeof e&&(this.timeoutId=window.setTimeout(function(){r.reject({message:fe})},e)),this.promise=new Promise(function(t,n){r.resolve=function(e){clearTimeout(r.timeoutId),t(e)},r.reject=function(e){clearTimeout(r.timeoutId),n(e)}})}var se=function(e){babelHelpers.inherits(o,e);var n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function o(e){var t,n=e.wsEndpoint,r=e.httpEndpoint,s=e.appName,e=e.appVersion;if(babelHelpers.classCallCheck(this,o),(t=i.call(this)).handleOnline=function(){t.clearTimers(),t.onlineTimeoutId=setTimeout(function(){t.transport&&t.transport.connect({isOnlineEvent:!0})},m+I(1,.2*m))},t.handleOffline=function(){t.clearTimers(),t.transport&&t.transport.disconnect()},!n&&!r)throw new Error("At list one endpoint should be provided");t.config={context:babelHelpers.assertThisInitialized(t),wsEndpoint:n,httpEndpoint:r,appName:s,appVersion:e};s=new Z({hashFields:["method","params"]}),e=t.resolveTransport();return t.transport=new e(s,t.config),t.requestsQueue=s,t.userId=null,t.serverTimeOffset=0,t.noSwitchTimeoutId=null,t.onlineTimeoutId=null,t.logger=new $(s,babelHelpers.assertThisInitialized(t)),t.logger.setTransport(t.transport.transportCode),t.listenNotifications(),t.listenNavigatorOnlineAPI(),t}return babelHelpers.createClass(o,[{key:"destroy",value:function(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline)}},{key:"resolveTransport",value:function(e){var t=this.config,n=t.httpEndpoint,t=t.wsEndpoint;return n&&t?P.isSupported()&&(!e||this.transport instanceof X)?P:X:t?P:X}},{key:"connect",value:function(){return this.clearTimers(),this.transport.connect()}},{key:"disconnect",value:function(){return this.clearTimers(),this.transport.disconnect()}},{key:"request",value:function(e){return this.transport.request(e)}},{key:"listenNotifications",value:function(){var t=this;this.on("notify",function(e){switch(e.type){case"session":return t.handleSessionNotify(e);case"system":return t.handleSystemNotify(e);default:return null}})}},{key:"listenNavigatorOnlineAPI",value:function(){window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline)}},{key:"handleSystemNotify",value:function(e){"switch"===e.value.type&&this.switchTransport()}},{key:"handleSessionNotify",value:function(e){var t=e.value,e=t.serverTime,t=t.userId;this.userId=t,e&&(this.serverTimeOffset=1e3*Math.round((Date.now()-e)/1e3),this.emit("notify",{type:"time",value:{offset:this.serverTimeOffset}}))}},{key:"switchTransport",value:function(){var e=this;this.clearTimers();var t=this.resolveTransport(!0),n=this.transport;n.disconnect(),this.requestsQueue=new Z({hashFields:["method","params"]}),this.transport=new t(this.requestsQueue,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ne(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},this.config,{seq:n.seq})),this.logger.setTransport(this.transport.transportCode),this.logger.setRequestsQueue(this.requestsQueue),n.transportCode!==this.transport.transportCode?this.transport.connect():this.noSwitchTimeoutId=setTimeout(function(){return e.transport.connect()},E)}},{key:"getLogs",value:function(){var e=this.logger;return{userId:e.userId,transport:e.transport,logs:e.messageLogs,uptime:Date.now()-e.initTime,sessionGetTime:e.sessionGetTime}}},{key:"clearTimers",value:function(){clearTimeout(this.noSwitchTimeoutId),clearTimeout(this.onlineTimeoutId)}}],[{key:"isSupportedWS",value:function(){return P.isSupported()}}]),o}(s.a),ie="disconnect",oe="offline detected",ae="received stop code",ue="ws zombie connection detected",ce="switch to ws",le="disconnect",de="bad response format",fe="defer timeout";function he(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function pe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?he(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Ee=(babelHelpers.createClass(ve,[{key:"connect",value:function(e){this.runOpenTimeout();try{this.wsInstance=new WebSocket(this.buildEndpointUrl()),this.wsInstance.addEventListener("open",this.handleOpen),this.wsInstance.addEventListener("close",this.handleClose),this.wsInstance.addEventListener("message",this.handleMessage)}catch(e){this.switchTransport("ws create error",{message:e.message})}}},{key:"disconnect",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:O;this.wsInstance&&(e={code:n,reason:t,message:le},this.clearSocket(n),this.clearRequestsQueue(ie),t!==ue&&this.emitSystemMessage("close",e))}},{key:"reconnect",value:function(e){var t,n=this;clearTimeout(this.reconnectTimeoutId),this.reconnectCounter<3?((null===(t=this.wsInstance)||void 0===t?void 0:t.readyState)!==WebSocket.CLOSED&&this.disconnect(ue),t=this.getReconnectAttemptTimeout(),this.reconnectTimeoutId=window.setTimeout(function(){n.reconnectCounter++,n.connect()},t),this.emitSystemMessage("reconnect",e)):this.switchTransport("maximum ws reconnect exceeded",e)}},{key:"switchTransport",value:function(e,t){this.clearTimers(),this.clearRequestsQueue("switch to fallback"),this.clearSocket(),this.config.httpEndpoint?this.emitSystemMessage("switch",pe({},t,{reason:e})):this.emitSystemMessage("close",pe({},t,{reason:e}))}},{key:"getReconnectAttemptTimeout",value:function(){var e=3<=this.reconnectCounter?p:h*Math.pow(2,this.reconnectCounter+1);return e+I(1,.2*e)}},{key:"buildEndpointUrl",value:function(){var e=this.config,t=e.wsEndpoint,n=void 0===t?"":t,r=e.appName,t=e.appVersion,e=void 0===t?"":t,t=encodeURIComponent(void 0===r?"":r),r=encodeURIComponent(e),e=1===n.split("?").length?"?":"&",r="".concat(n).concat(e,"use_seq=true")+"&app_name=".concat(t,"&app_version=").concat(r,"&old_notify=false&pv=5");return this.seq&&(r+="&seq=".concat(this.seq)),r}},{key:"request",value:function(e,t){var n=this,r={method:e,params:t,id:this.idCounter.incr(),jsonrpc:"2.0"},s=new re(l),e=s.promise.then(function(e){if(n.logger&&n.logger.logMessage($.IN,e,"ws"),e.error)throw pe({},e.error,{rpcId:e.rpcId,requestId:e.requestId});return n.didWork||n.emitSystemMessage("working"),n.didWork=!0,n.reconnectCounter=0,e},function(e){throw e.message===fe&&(n.didWork?n.reconnect(pe({},e,{reason:ue})):n.switchTransport("ws request timeout error",e)),e});return(null===(t=this.wsInstance)||void 0===t?void 0:t.readyState)!==WebSocket.OPEN?s.reject({message:"websocket is not open"}):(this.requestsQueue.push(pe({},r,{defer:s})),this.logger&&this.logger.logMessage($.OUT,r,"ws"),this.wsInstance.send(JSON.stringify(r))),e}},{key:"emitSystemMessage",value:function(e,t){this.emit("notify",{type:"system",value:{type:e,error:t}})}},{key:"clearTimers",value:function(){clearTimeout(this.pingTimeoutId),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId)}},{key:"clearRequestsQueue",value:function(t){this.requestsQueue.forEach(function(e){return e.defer.reject({message:t})}),this.requestsQueue=[]}},{key:"clearSocket",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:O;this.wsInstance&&(this.wsInstance.removeEventListener("open",this.handleOpen),this.wsInstance.removeEventListener("close",this.handleClose),this.wsInstance.removeEventListener("message",this.handleMessage),this.wsInstance.close(e),this.wsInstance=void 0)}},{key:"setEmitter",value:function(e){this.emit=e}},{key:"setLogger",value:function(e){this.logger=e}}]),ve);function ve(e,t,n){var r=this;babelHelpers.classCallCheck(this,ve),this.requestsQueue=[],this.idCounter=new T(1),this.pingTimeoutId=0,this.connectTimeoutId=0,this.reconnectTimeoutId=0,this.reconnectCounter=0,this.didWork=!1,this.handleOpen=function(){clearTimeout(r.connectTimeoutId),r.runPingPolling(),r.emitSystemMessage("open")},this.handleClose=function(e){var t=e.code,e={code:t,message:e.reason};A.includes(t)?r.disconnect(ae,t):1006!==t||r.didWork?(t===R&&(r.seq=void 0),r.reconnect(e)):r.switchTransport("ws abnormal close",e)},this.handleMessage=function(e){var t;try{t=JSON.parse(e.data)}catch(e){return void r.emitSystemMessage("error",{code:C.a.PARSE_ERROR,message:de})}r.requestsQueue=r.requestsQueue.filter(function(e){return!("jsonrpc"in t&&t.id===e.id&&(r.runPingPolling(),e.defer.resolve(t),1))}),"jsonrpc"in t||(r.seq=("session"===t.type?t.value:t).seq,r.emit("notify",t))},this.runPingPolling=function(){clearTimeout(r.pingTimeoutId),r.pingTimeoutId=window.setTimeout(babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.request("ping",{});case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:r.runPingPolling();case 8:case"end":return e.stop()}},e,null,[[0,5]])})),r.didWork?d:S)},this.runOpenTimeout=function(){clearTimeout(r.connectTimeoutId),r.connectTimeoutId=window.setTimeout(function(){r.switchTransport("ws open timeout",{message:"connect timeout error"})},c)},this.config=e,this.emit=t,this.logger=n}function me(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function ge(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?me(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Se,ye=(babelHelpers.createClass(be,[{key:"connect",value:(Se=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.clearTimers(),e.prev=1,e.next=4,this.fetchSession();case 4:0<this.fetchSessionErrorCounter&&(n={reason:"fetch session success",message:"fetch session success message"},this.emitSystemMessage("reconnected",n)),this.fetchSessionErrorCounter=0,this.emitSystemMessage("open"),this.tabCheck(),this.listenTabUpdates(),this.runWsCheck(),t===ce?this.fetchUpdates():this.runPolling(),e.next=31;break;case 13:if(e.prev=13,e.t0=e.catch(1),this.handleError(e.t0))return e.abrupt("return");e.next=18;break;case 18:if(this.fetchSessionErrorCounter++,this.didWork){e.next=23;break}this.disconnect("unable fetch session",e.t0),e.next=31;break;case 23:if(this.fetchSessionErrorCounter<=2)return this.emitSystemMessage("reconnect",e.t0),e.next=27,function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(e){return setTimeout(e,t)})}(this.getSessionAttemptTimeout());e.next=30;break;case 27:this.connect(),e.next=31;break;case 30:this.disconnect("maximum getSession error exceeded",e.t0);case 31:case"end":return e.stop()}},e,this,[[1,13]])})),function(e){return Se.apply(this,arguments)})},{key:"disconnect",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{message:le};this.clearTimers(),this.clearRequestsQueue(ie),this.unlistenTabUpdates(),this.emitSystemMessage("close",ge({},t,{reason:e,code:e===oe?0:t.code})),this.wsClient&&(this.wsClient.disconnect(ie),this.wsClient=null)}},{key:"buildEndpointUrl",value:function(){var e=this.config,t=e.httpEndpoint,n=void 0===t?"":t,r=e.appName,t=e.appVersion,e=void 0===t?"":t,t=encodeURIComponent(void 0===r?"":r),r=encodeURIComponent(e),e=1===n.split("?").length?"?":"&";return"".concat(n).concat(e,"app_name=").concat(t)+"&app_version=".concat(r,"&old_notify=false&pv=5")}},{key:"request",value:function(e,t){var n=this,r=this.buildEndpointUrl(),s={method:e,params:t,id:this.idCounter.incr(),jsonrpc:"2.0"},i=new re(l),o=new XMLHttpRequest,t=i.promise.then(function(e){return n.requestsQueue=n.requestsQueue.filter(function(e){return e.id===s.id}),e},function(e){throw n.requestsQueue=n.requestsQueue.filter(function(e){return e.id===s.id}),o.status!==XMLHttpRequest.DONE&&(o.onabort=null,o.abort()),e});return this.requestsQueue.push(ge({},s,{defer:i})),o.open("POST",r),o.withCredentials=!0,o.timeout=l,o.onload=function(){if(200===o.status){var e;try{e=JSON.parse(o.responseText)}catch(e){return void i.reject({message:de})}n.logger&&n.logger.logMessage($.IN,e,"http"),e.error?i.reject(ge({},e.error,{rpcId:e.rpcId,requestId:e.requestId})):i.resolve(e)}else i.reject({code:o.status,message:o.responseText})},o.onerror=function(){i.reject({message:"xhr error"})},o.onabort=function(){i.reject({message:"xhr error"})},o.ontimeout=function(){i.reject({message:"xhr error"})},this.logger&&this.logger.logMessage($.OUT,s,"http"),o.send(JSON.stringify(s)),t}},{key:"listenTabUpdates",value:function(){this.unlistenTabUpdates(),this.unlistenTabUpdatesInternal=z(this.handleUpdates)}},{key:"unlistenTabUpdates",value:function(){this.unlistenTabUpdatesInternal&&(this.unlistenTabUpdatesInternal(),this.unlistenTabUpdatesInternal=void 0)}},{key:"clearTimers",value:function(){clearTimeout(this.pollingTimeoutId),clearTimeout(this.healthCheckTimeoutId),clearTimeout(this.checkWsTimeoutId),this.fetchUpdatesErrorCounter=0,this.fetchSessionErrorCounter=0}},{key:"runPolling",value:function(){clearTimeout(this.pollingTimeoutId),this.isMaster&&(this.pollingTimeoutId=window.setTimeout(this.fetchUpdates,f))}},{key:"emitSystemMessage",value:function(e,t){this.emit("notify",{type:"system",value:{type:e,error:t}})}},{key:"runWsCheck",value:function(){var e=this;clearTimeout(this.checkWsTimeoutId),this.config.wsEndpoint&&(this.checkWsTimeoutId=window.setTimeout(function(){e.wsClient=new Ee(e.config,e.handleWsEmit),e.wsClient.seq=e.seq,e.wsClient.connect("ws check")},g))}},{key:"getSessionAttemptTimeout",value:function(){var e=2<=this.fetchSessionErrorCounter?p:h*Math.pow(2,this.fetchSessionErrorCounter+1);return e+I(1,.2*e)}},{key:"clearRequestsQueue",value:function(t){this.requestsQueue.forEach(function(e){e.defer.reject({message:t})}),this.requestsQueue=[]}},{key:"switchTransport",value:function(){this.clearTimers(),this.clearRequestsQueue(ce),this.unlistenTabUpdates();var e={reason:ce,message:"switch to ws"};this.emitSystemMessage("switch",e),this.emitSystemMessage("open",e),this.wsClient&&(this.wsClient=null)}}]),be);function be(e,t,n){var a=this;babelHelpers.classCallCheck(this,be),this.pollingTimeoutId=0,this.healthCheckTimeoutId=0,this.checkWsTimeoutId=0,this.idCounter=new T(1),this.isMaster=!1,this.didWork=!1,this.fetchUpdatesErrorCounter=0,this.fetchSessionErrorCounter=0,this.requestsQueue=[],this.wsClient=null,this.handleError=function(e){return e.code===C.b?(a.disconnect(ae,e),!0):(e.code===C.a.MESSAGE_LOG_GONE&&(a.seq=void 0,a.fetchSession()),!1)},this.handleUpdates=function(e){e&&e.length&&e.forEach(function(e){return setTimeout(function(){a.emit("notify",e),e.seq&&(a.seq=e.seq)},0)})},this.fetchUpdates=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.isMaster){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,a.request("getSocketMessages",{seq:a.seq});case 5:n=e.sent,t=n.result,0<a.fetchUpdatesErrorCounter&&(n={reason:"fetch updates success",message:"fetch updates success message"},a.emitSystemMessage("reconnected",n)),a.fetchUpdatesErrorCounter=0,K(t),a.handleUpdates(t),a.runPolling(),e.next=21;break;case 14:if(e.prev=14,e.t0=e.catch(2),a.handleError(e.t0))return e.abrupt("return");e.next=19;break;case 19:a.fetchUpdatesErrorCounter++,3<a.fetchUpdatesErrorCounter?a.disconnect("maximum fetch updates error exceeded",e.t0):(a.emitSystemMessage("reconnect",e.t0),a.runPolling());case 21:case"end":return e.stop()}},e,null,[[2,14]])})),this.fetchSession=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.request("avito.getSession",{seq:a.seq});case 2:return t=e.sent,t=t.result,a.emit("notify",{type:"session",value:t}),t.seq&&(a.seq=t.seq),a.didWork||a.emitSystemMessage("working"),a.didWork=!0,a.fetchSessionErrorCounter=0,e.abrupt("return",t);case 10:case"end":return e.stop()}},e)})),this.tabCheck=function(){clearTimeout(a.healthCheckTimeoutId);var e=null!==(o=F())&&void 0!==o?o:[],t=u(e.length||1),n=Date.now(),r=e.filter(function(e){e=e.lastTime;return n-e<=t}),s=e.find(function(e){return e.tabId===W}),i=Boolean(null==s?void 0:s.isMaster),o=!!s&&n-s.lastTime<=t,s=e.filter(function(e){return e.isMaster}),e=s.filter(function(e){e=e.lastTime;return n-e<=t});s.length&&e.length||i?i&&!o?(a.isMaster=!1,clearTimeout(a.pollingTimeoutId)):a.isMaster=i:(a.isMaster=!0,a.runPolling());r=r.filter(function(e){return e.tabId!==W}).concat({tabId:W,lastTime:n,isMaster:a.isMaster});Q(r),a.healthCheckTimeoutId=window.setTimeout(a.tabCheck,y(r.length))},this.handleWsEmit=function(e){var t=arguments.length<=1?void 0:arguments[1];if("notify"===e&&"system"===t.type)switch(t.value.type){case"working":a.switchTransport();break;case"close":case"switch":a.runWsCheck()}return!1},this.emit=t,this.config=e,this.logger=n}var Ie=function(e){babelHelpers.inherits(i,e);var n,r,t=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function i(e){var s;if(babelHelpers.classCallCheck(this,i),(s=t.call(this)).activeClient=null,s.isSubscribed=!1,s.isOffline=!1,s.scState=0,s.emitInternal=function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("notify"===e)switch(n[0].type){case"session":s.handleSessionNotify(n[0]);break;case"system":s.handleSystemNotify(n[0])}return s.emit.apply(s,[e].concat(n))},s.handleOnline=function(){s.isOffline=!1,s.connect("online")},s.handleOffline=function(){s.isOffline=!0,s.disconnect(oe)},s.handleFocus=function(){s.isOffline||s.connect("focus event")},!e.wsEndpoint&&!e.httpEndpoint)throw Error("one of wsEndpoint or httpEndpoint should be listed");return s.config=e,s.logger=new $(null,babelHelpers.assertThisInitialized(s),{messagesLogSize:20,sendEvent:e.sendEvent}),s.setState(0),s}return babelHelpers.createClass(i,[{key:"transport",get:function(){return this.activeClient instanceof Ee?{transportCode:"ws"}:this.activeClient instanceof ye?{transportCode:"http"}:{transportCode:null}}},{key:"connect",value:function(e){this.activeClient||(this.listenWindowEvents(),this.config.wsEndpoint?(this.activeClient=new Ee(this.config,this.emitInternal,this.logger),this.logger.setTransport("ws"),this.setState(10)):(this.activeClient=new ye(this.config,this.emitInternal,this.logger),this.logger.setTransport("http"),this.setState(30)),this.activeClient.seq=this.lastSeq,this.activeClient.connect(e))}},{key:"disconnect",value:function(e){this.activeClient&&(this.lastSeq=this.activeClient.seq,this.activeClient.disconnect(e),this.activeClient=null,this.setState(0))}},{key:"destroy",value:function(){this.unlistenWindowEvents(),this.disconnect("destroy")}},{key:"request",value:function(e){if(!this.activeClient)throw{message:"client disconnected"};return this.activeClient.request(e.method,e.params)}},{key:"getLogs",value:function(){var e=this.logger;return{userId:e.userId,transport:e.transport,logs:e.messageLogs,uptime:Date.now()-e.initTime,sessionGetTime:e.sessionGetTime}}},{key:"setState",value:function(e){this.scState=e,this.logger.logScStateToCs(e)}},{key:"listenWindowEvents",value:function(){this.isSubscribed||(window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),window.addEventListener("focus",this.handleFocus),this.isSubscribed=!0)}},{key:"unlistenWindowEvents",value:function(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),window.removeEventListener("focus",this.handleFocus),this.isSubscribed=!1}},{key:"handleSystemNotify",value:function(e){switch(e.value.type){case"switch":this.activeClient instanceof Ee?(this.lastSeq=this.activeClient.seq,this.activeClient=new ye(this.config,this.emitInternal,this.logger),this.logger.setTransport("http"),this.activeClient.seq=this.lastSeq,this.activeClient.connect(ce),this.setState(30)):this.activeClient instanceof ye&&this.activeClient.wsClient&&(this.activeClient=this.activeClient.wsClient,this.activeClient.setEmitter(this.emitInternal),this.activeClient.setLogger(this.logger),this.logger.setTransport("ws"),this.setState(20));break;case"reconnect":this.setState(this.activeClient instanceof Ee?10:30);break;case"working":this.setState(this.activeClient instanceof Ee?20:40);break;case"close":var t;this.lastSeq=null===(t=this.activeClient)||void 0===t?void 0:t.seq,this.activeClient=null,this.setState(0)}}},{key:"handleSessionNotify",value:function(e){var t=e.value,e=t.serverTime,t=t.userId;this.userId=t,e&&(this.serverTimeOffset=1e3*Math.round((Date.now()-e)/1e3),this.emit("notify",{type:"time",value:{offset:this.serverTimeOffset}}))}}],[{key:"isSupportedWS",value:function(){var e=navigator.userAgent.match(/android\s([0-9\.]+)/i)||[],e=babelHelpers.slicedToArray(e,2)[1],e=parseFloat(e);return"undefined"!=typeof WebSocket&&(!e||4.4<=e)}}]),i}(s.a),Te=n(4196),_e=n(4189),Ce=n.n(_e),Oe=n(4202),Re=["type"];function we(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function Ae(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?we(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function ke(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)}}var Le,Me=function(){babelHelpers.inherits(s,Ie);var e=ke(s);function s(){return babelHelpers.classCallCheck(this,s),e.apply(this,arguments)}return babelHelpers.createClass(s,[{key:"handleSessionNotify",value:function(){var e;Te.a.logSession();for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"handleSessionNotify",this)).call.apply(e,[this].concat(n))}}]),s}(),Pe=function(){babelHelpers.inherits(s,se);var e=ke(s);function s(){return babelHelpers.classCallCheck(this,s),e.apply(this,arguments)}return babelHelpers.createClass(s,[{key:"handleSessionNotify",value:function(){var e;Te.a.logSession();for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"handleSessionNotify",this)).call.apply(e,[this].concat(n))}}]),s}(),Ue=(babelHelpers.createClass(De,[{key:"connect",value:function(e,t){var r=this;return Te.a.logTransportConnect(),this.session=Ae({},this.session,{userId:null,timeCorrectionOffset:0}),this.config.appName=t,this.config.isTestAccount&&Ce()(window,"avito.messenger.Client",this),4===this.config.version?this.client=new Pe(this.config):this.client=new Me(this.config),this.addNotificationsListener(e),this.defer=new Oe.a,this.client.on("notify",function e(t){var n;"session"===t.type&&(null===(n=r.defer)||void 0===n||n.resolve(!0),null===(n=r.client)||void 0===n||n.removeListener("notify",e)),"close"!==t.type&&"error"!==t.type||r.disconnect(t)}),this.client.connect(),this.defer.promise}},{key:"disconnect",value:function(){var e,t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"disconnect";this.client&&(this.client.disconnect(),this.removeNotificationsListener(),this.client.destroy(),this.client=null),this.defer&&(null===(e=this.defer)||void 0===e||null===(t=e.reject)||void 0===t||t.call(e,n)),this.defer=null}},{key:"request",value:(Le=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.defer&&this.defer.promise&&this.client)return e.next=3,this.defer.promise;e.next=6;break;case 3:return e.next=5,this.client.request({method:t,params:n});case 5:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",{result:{}});case 7:case"end":return e.stop()}},e,this)})),function(e,t){return Le.apply(this,arguments)})},{key:"addNotificationsListener",value:function(t){var n=this;this.client&&this.client.on("notify",function(e){return n.hotifyHandler(t,e)})}},{key:"removeNotificationsListener",value:function(){this.client&&this.client.removeAllListeners("notify")}},{key:"hotifyHandler",value:function(e,t){switch(t.type){case"system":var n=t.value;return e({type:n.type,value:babelHelpers.objectWithoutProperties(n,Re)});case"time":return this.session.timeCorrectionOffset=t.value.offset,e(t);case"session":var r=t.value.userId;return this.session.userId=r,e(t);default:r=t.type;return r?e(Ae({},t,{type:r})):t}}},{key:"getMessages",value:function(e){return this.request("messenger.history",e)}},{key:"sendMessage",value:function(e,t,n,r){return this.request("avito.sendTextMessage",{channelId:e,text:t,randomId:n,templates:r})}},{key:"sendReactionMessage",value:function(e,t,n,r){return this.request("messenger.sendReactionMessage",{channelId:e,text:t,randomId:n,templates:r})}},{key:"sendItemMessage",value:function(e,t,n){return this.request("avito.sendItemMessage",{channelId:e,itemId:t,randomId:n})}},{key:"getThread",value:function(e){return this.request("avito.getChatById.v2",e)}},{key:"getThreads",value:function(e){var t;return e.limit=Math.min(100,null!==(t=e.limit)&&void 0!==t?t:0),this.request("avito.getChats.v3",e)}},{key:"readThread",value:function(e){return this.request("messenger.readChat",{channelId:e})}},{key:"sendTyping",value:function(e,t){return this.request("messenger.sendTyping",{channelId:e,userIds:t})}},{key:"removeThreads",value:function(e){return this.request("messenger.clearMessageHistoryMulti",{channelIds:e})}},{key:"getLastActionTimes",value:function(e){return this.request("messenger.getLastActionTimes",{userIds:e})}},{key:"getUsersBlacklist",value:function(e){return this.request("avito.getBlacklist",e)}},{key:"addUsersBlacklist",value:function(e,t){return this.request("avito.blacklistAdd",{users:e,reasonId:t})}},{key:"removeUserBlacklist",value:function(e){return this.request("avito.blacklistRemove",{userId:e})}},{key:"getBlacklistReasons",value:function(){return this.request("messenger.getBlacklistReasons",{})}},{key:"getBodyItems",value:function(e){return this.request("avito.getBodyItems.v2",{ids:e})}},{key:"getUsers",value:function(e,t){return this.request("messenger.getUsers.v1",{channelId:e,userIds:t})}},{key:"getBodyFile",value:function(e){return this.request("messenger.getFile.v1",{fileId:e})}},{key:"getFoldersCounters",value:function(e){return this.request("messenger.getUnreadCount.v2",{folders:e})}},{key:"getItemsForFilter",value:function(e){return this.request("avito.getItemsForFilter",e)}},{key:"getItemsForAttach",value:function(e){return this.request("avito.getItemsForAttach.v2",e)}},{key:"sendImageMessage",value:function(e,t,n){return this.request("avito.sendImageMessage",{channelId:e,imageId:t,randomId:n})}},{key:"sendFileMessage",value:function(e,t,n){return this.request("messenger.sendFile.v1",{channelId:e,fileId:t,randomId:n})}},{key:"createFile",value:function(e){return this.request("messenger.createFile.v1",{channelId:e})}},{key:"sendLinkMessage",value:function(e,t,n){return this.request("messenger.sendLinkMessage",{channelId:e,url:t,randomId:n})}},{key:"getBodyImages",value:function(e){return this.request("avito.getBodyImages",{ids:e})}},{key:"getReplySuggest",value:function(e){return this.request("suggest.getReplySuggest",{channelIds:e})}},{key:"getChannelPhone",value:function(e){return this.request("messenger.getPhoneByChannelId.v1",{channelId:e})}},{key:"createChat",value:function(e){return this.request("avito.chatCreateByItemId.v1",{itemId:e})}},{key:"createU2UChat",value:function(e){return this.request("messenger.chatCreateByUserId.v1",{opponentId:e})}},{key:"getGeoReverse",value:function(e){var t=e.lon,e=e.lat;return this.request("messenger.reverseGeo.v1",{lon:t,lat:e})}},{key:"getFavoritePlaces",value:function(e,t){var n=e.lon,e=e.lat;return this.request("messenger.favoritePlaces.v1",{itemLocation:{lon:n,lat:e},channelId:t})}},{key:"geoSearch",value:function(e){var t=e.query,n=e.channelId,e=e.mapCenter;return this.request("messenger.geoSearch.v1",{query:t,centerPoint:e,channelId:n})}},{key:"sendLocationMessage",value:function(e){return this.request("messenger.sendLocationMessage.v1",e)}},{key:"confirmSuspect",value:function(e){return this.request("messenger.suspectConfirm",e)}},{key:"cancelSuspect",value:function(e){return this.request("messenger.suspectCancel",e)}},{key:"search",value:function(e){return this.request("messenger.search.v1",e)}},{key:"deleteMessage",value:function(e){return this.request("messenger.deleteMessage.v1",e)}},{key:"getLiquidityStats",value:function(){return this.request("messenger.liquidity.v1",{})}},{key:"updateChannelsTags",value:function(e){return this.request("messenger.updateFolderTags.v1",e)}},{key:"getAutoReplySettings",value:function(){return this.request("messenger.getAutoreplySettings.v1",{})}},{key:"saveAutoReplySettings",value:function(e){return this.request("messenger.saveAutoreplySettings.v1",e)}},{key:"getSettings",value:function(){return this.request("messenger.getSettings.v1",{})}}],[{key:"isSupportedWS",value:function(){return se.isSupportedWS()}}]),De),Ne=n(4204),r=n(3956),He=n.n(r),s=n(4208),_e=n(4191),xe=n(4203),r=n(4205);function De(e){var t=this;babelHelpers.classCallCheck(this,De),this.defer=null,this.client=null,this.getLogs=function(){var e;return null===(e=t.client)||void 0===e?void 0:e.getLogs()},this.getTransport=function(){var e;return null===(e=t.client)||void 0===e?void 0:e.transport},this.config=e,this.session={userId:null,timeCorrectionOffset:0,backupUserId:null}}n.d(t,"b",function(){return je});var je=_e.c&&Ue.isSupportedWS(),s=new Ue({get wsEndpoint(){var e=Object(Ne.f)();return He.a.get("forceHTTPFallback")||e.isForceHttp?void 0:He.a.get("socketServer")},get httpEndpoint(){return He.a.get("httpFallback")},get isTestAccount(){return He.a.get("isTestAccount")},get version(){var e=(e=null===(e=He.a.get("experiments"))||void 0===e?void 0:e[xe.b],Object(xe.d)(e)?5:4);return Ce()(window,"avito.messenger.Client.version",e),e},sendEvent:r.b,appVersion:s.version});t.a=s},10761:function(e,t,n){"use strict";var p=n(4213),E=n(4257),v=n(4234),r=n(4214);var m=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=p.c.SYSTEM,e}return s}(r.a),g=n(4258);var S=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=p.c.CALL,e}return s}(r.a);var y=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=p.c.APP_CALL,e}return s}(r.a),b=n(4259),I=n(4260);var T=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=p.c.DELETED,e}return s}(r.a),_=n(4212),s=n(4256),C=n.n(s),i=n(4238),O=n.n(i),s=n(3890),i=n(4261);Object(i.a)({name:"messenger-phone-call",originalWidth:16,originalHeight:16,svg:s.createElement("path",{d:"M10.435 9.776a1 1 0 011.136.018l2.74 1.957a1.002 1.002 0 01.125 1.52l-1.582 1.583a.5.5 0 01-.354.147C6.149 15 1 9.85 1 3.5a.5.5 0 01.146-.354L2.73 1.564a1 1 0 011.52.126l1.957 2.74a1 1 0 01.019 1.135L4.97 7.447a8.54 8.54 0 003.583 3.584l1.882-1.255zM12.146 3.146l-2.5 2.5.708.708 2.5-2.5L15 6V1h-5l2.146 2.146z"})});Object(i.a)({name:"messenger-phone-call-incoming",originalWidth:16,originalHeight:16,svg:s.createElement("path",{d:"M5.564 9.776a1 1 0 00-1.135.018l-2.74 1.957a1 1 0 00-.126 1.52l1.583 1.583a.5.5 0 00.354.147C9.851 15 15 9.85 15 3.5a.5.5 0 00-.146-.354L13.27 1.564a1 1 0 00-1.52.126L9.793 4.43a1 1 0 00-.019 1.135l1.255 1.882a8.54 8.54 0 01-3.583 3.584L5.564 9.776zM.646 1.354l.708-.708 2.5 2.5L6 1v5H1l2.146-2.146-2.5-2.5z"})});Object(i.a)({name:"messenger-missed-call",originalWidth:16,originalHeight:16,svg:s.createElement(s.Fragment,null,s.createElement("path",{d:"M10.435 9.775a1 1 0 011.136.019l2.74 1.956a1 1 0 01.125 1.52l-1.582 1.584A.5.5 0 0112.5 15C6.149 15 1 9.851 1 3.5a.5.5 0 01.146-.354L2.73 1.564a1 1 0 011.52.126l1.957 2.739a1 1 0 01.019 1.136L4.97 7.447a8.541 8.541 0 003.583 3.583l1.882-1.255z",fill:"#B8B8B8"}),s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 5.293l.707.707 2.5-2.5 2.147 2.146v-5h-5L12.5 2.793l-2.5 2.5z",fill:"#FF6163"}))});Object(i.a)({name:"messenger-missed-call-incoming",originalWidth:16,originalHeight:16,svg:s.createElement(s.Fragment,null,s.createElement("path",{d:"M5.564 9.775a1 1 0 00-1.135.019l-2.74 1.956a1 1 0 00-.126 1.52l1.583 1.584A.5.5 0 003.5 15C9.851 15 15 9.851 15 3.5a.5.5 0 00-.146-.354L13.27 1.564a1 1 0 00-1.52.126L9.793 4.429a1 1 0 00-.019 1.136l1.255 1.882a8.54 8.54 0 01-3.583 3.583L5.564 9.775z",fill:"#B8B8B8"}),s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.5 4.207L1 1.707 1.707 1l2.5 2.5 2.147-2.146v5h-5L3.5 4.207z",fill:"#FF6163"}))});var o=n(10987),a=n(4305),u=n(4306);function c(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function R(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}n.d(t,"h",function(){return d}),n.d(t,"g",function(){return w}),n.d(t,"i",function(){return f}),n.d(t,"e",function(){return h}),n.d(t,"f",function(){return A}),n.d(t,"c",function(){return k}),n.d(t,"d",function(){return L}),n.d(t,"b",function(){return M}),n.d(t,"a",function(){return P}),n.d(t,"j",function(){return U});var l=[p.c.DELETED,p.c.CALL,p.c.APP_CALL];function d(e){var r=[],s=new Set,i=new Set;return e.forEach(function(e){var t=w(e),n=t.message,e=t.imageIds,t=t.itemIds;r.push(n),e.forEach(function(e){return i.add(e)}),t.forEach(function(e){return s.add(e)})}),{messages:r,imageIds:Array.from(i),itemIds:Array.from(s)}}function w(i){var e,t,n=i,o=new Set,a=new Set;switch(i.type){case p.c.TEXT:d=E.a;break;case p.c.ITEM:d=g.a,i.body.itemId&&o.add(i.body.itemId);break;case p.c.IMAGE:d=v.a,i.body.imageId&&a.add(i.body.imageId);break;case p.c.CALL:d=S;break;case p.c.APP_CALL:d=y;break;case p.c.DELETED:d=T;break;case p.c.LINK:var r,s,u,c,l,d=b.a;null!=i&&null!==(r=i.body)&&void 0!==r&&null!==(s=r.preview)&&void 0!==s&&s.value.imageId&&a.add(null==i||null===(l=i.body)||void 0===l?void 0:l.preview.value.imageId),"image"===(null==i||null===(u=i.body)||void 0===u||null===(c=u.preview)||void 0===c?void 0:c.type)&&(n=R({},i,{type:p.c.IMAGE,body:{randomId:null===(c=i.body)||void 0===c?void 0:c.randomId,imageId:null===(c=i.body)||void 0===c||null===(e=c.preview)||void 0===e||null===(t=e.value)||void 0===t?void 0:t.imageId}}),d=v.a);break;case p.c.SYSTEM:d=m,(i.body.chunks||[]).forEach(function(e){e.type===p.a.IMAGE&&a.add(e.value.imageId)});break;case p.c.LOCATION:d=I.a;break;case p.c.FILE:d=_.a;break;default:d=E.a}var f,h=new d(n);return i.updates&&(f=O()(i.updates,function(e){return-e.ts}).map(function(e){var t=e.action,n=e.ts,r=e.type,s=e.body,e=w(R({},i,{updates:void 0,type:r,body:s})),r=e.message,s=e.itemIds,e=e.imageIds;return s.forEach(function(e){return o.add(e)}),e.forEach(function(e){return a.add(e)}),{action:t,date:new Date(n/1e4),message:r}}),h.versions=f),h.isMine&&(h.sendingStatus=h.sendingStatus||p.d.SENT),{message:h,imageIds:Array.from(a).filter(function(e){return!C()(e)}),itemIds:Array.from(o).filter(function(e){return!C()(e)})}}function f(t,n,e){return e.map(function(e){return e.id===t?n instanceof r.a?n:e.assign(n):e})}function h(e,t){return e&&t?e.toISOString().substr(0,10)===t.toISOString().substr(0,10):null}function A(e,t){var n=h(t.date,new Date);return e&&n&&!h(t.date,e.date)}function k(e,t,n){return Boolean(t)&&t.fromUid===e.fromUid&&h(t.date,e.date)&&!n}function L(e){return e&&e.isMine&&!l.includes(e.type)}function M(e){if(!e)return null;var t=e.isMine?"  ":"  ";return e.type===p.c.CALL?t:e.type===p.c.APP_CALL?e.body.text||t:null}function P(e){return e.type===p.c.APP_CALL?e.isMine?"messenger-phone-call":"messenger-phone-call-incoming":e.isMine?"messenger-missed-call":"messenger-missed-call-incoming"}var U=function(e){var t=new o.a({text:e,urlsAreTrusted:!0});return t.hasSpecialPhrases()?t.phrases.reduce(function(e,t){return e+(t.type===a.a.URL?Object(u.b)(t.text):t.text)},""):e}},10963:function(e,t,n){"use strict";n.r(t);function d(e,t){return t=v(e,t),Boolean(null==t?void 0:t.success)}var a=n(4187),f=n(4204),u=n(10678),s=n(4234),i=n(4259),o=n(4258),c=n(4257),l=n(4260),h=n(4309),p=n(4212),E=n(4211),v=function(e,t){return e.upload.hash[t]},m=n(4236),g=n(4213);function S(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object(f.c)(e),r=new s.a({id:n,body:{imageId:t,randomId:n},channelId:e});return{type:a.a.MESSAGE_IMAGE_SEND,radar:!0,promise:u.a.sendImageMessage(e,t,n),id:n,channelId:e,imageId:t,message:r}}n.d(t,"sendImageMessage",function(){return S}),n.d(t,"sendImageMessageWithUpload",function(){return r}),n.d(t,"sendFileMessage",function(){return y}),n.d(t,"sendFileMessageWithUpload",function(){return b}),n.d(t,"sendLocationMessage",function(){return I}),n.d(t,"sendLinkMessage",function(){return T}),n.d(t,"getImages",function(){return _}),n.d(t,"getItems",function(){return C}),n.d(t,"getFile",function(){return O}),n.d(t,"getUsers",function(){return R}),n.d(t,"sendItemMessage",function(){return w}),n.d(t,"reset",function(){return A}),n.d(t,"sendMessage",function(){return k}),n.d(t,"sendAutoReply",function(){return L}),n.d(t,"setDraftMessage",function(){return M}),n.d(t,"setDraftMessages",function(){return P}),n.d(t,"removeTempMessage",function(){return U}),n.d(t,"getMessages",function(){return N}),n.d(t,"confirmSuspect",function(){return H}),n.d(t,"cancelSuspect",function(){return x}),n.d(t,"deleteMessage",function(){return D});var r=function(u,c){var n,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object(f.c)(u);return n=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(t,n){var r,s,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d(n(),l),s="",r){e.next=9;break}return e.next=5,t(Object(E.uploadImage)(u,c,l));case 5:if((i=e.sent).isError)return e.abrupt("return",i);e.next=8;break;case 8:s=Object.keys(i)[0];case 9:if((o=Object(m.d)(n(),l))&&(null==o?void 0:o.type)===g.c.IMAGE){e.next=12;break}throw Error("expected image message");case 12:if(a=o.body.imageId||s){e.next=15;break}throw Error("expected image with imageId");case 15:return e.next=17,t(S(u,a,l));case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)}};function y(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object(f.c)(e),r=new p.a({id:n,body:{fileId:t.fileId,name:t.name,sizeBytes:t.sizeBytes,randomId:n},channelId:e});return{type:a.a.MESSAGE_FILE_SEND,radar:!0,promise:u.a.sendFileMessage(e,t.fileId,n),id:n,channelId:e,fileId:t.fileId,message:r}}var b=function(i,o){var n,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object(f.c)(i);return n=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(t,n){var r,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d(n(),a)){e.next=7;break}return e.next=4,t(Object(E.uploadFile)(i,o,a));case 4:if((r=e.sent).isError)return e.abrupt("return",r);e.next=7;break;case 7:if((s=Object(m.d)(n(),a))&&(null==s?void 0:s.type)===g.c.FILE){e.next=10;break}throw Error("expected file message");case 10:if(s.body.fileId){e.next=13;break}throw Error("expected file with fileId");case 13:return e.next=15,t(y(i,s.body,a));case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)}};function I(e){var t=e.channelId,n=e.lon,r=e.lat,s=e.title,i=e.kind,o=e.randomId,e=void 0===o?Object(f.c)(t):o,o=new l.a({id:e,body:{lon:n,lat:r,title:s,kind:i,randomId:e},channelId:t});return{type:a.a.MESSAGE_LOCATION_SEND,radar:!0,promise:u.a.sendLocationMessage({channelId:t,lon:n,lat:r,title:s,kind:i,randomId:e}),id:e,channelId:t,message:o}}function T(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object(f.c)(e),r=new i.a({id:n,body:{url:t,randomId:n},channelId:e});return{type:a.a.MESSAGE_LINK_SEND,radar:!0,promise:u.a.sendLinkMessage(e,t,n),id:n,channelId:e,message:r}}function _(e){return{type:a.a.MESSAGES_IMAGES_REQUEST,promise:u.a.getBodyImages(e),radar:!0,imageIds:e}}function C(e){return{type:a.a.MESSAGES_ITEMS_REQUEST,promise:u.a.getBodyItems(e),radar:!0,itemIds:e}}function O(e){return{type:a.a.MESSAGES_FILE_REQUEST,promise:u.a.getBodyFile(e),radar:!0,fileId:e}}function R(e,t){return{type:a.a.MESSAGES_USERS_REQUEST,promise:u.a.getUsers(e,t),channelId:e,userIds:t}}function w(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object(f.c)(e),r=new o.a({id:n,channelId:e,body:{itemId:t.value.id,randomId:n}});return{type:a.a.MESSAGE_ITEM_SEND,promise:u.a.sendItemMessage(e,t.value.id,n),id:n,radar:!0,channelId:e,itemData:t,message:r}}function A(){return{type:a.a.MESSAGES_RESET}}function k(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object(f.c)(e),r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],s=new c.a({id:n,isReaction:r,channelId:e,body:{text:t,randomId:n}});return{type:a.a.MESSAGE_SEND,promise:r?u.a.sendReactionMessage(e,t,n):u.a.sendMessage(e,t,n),id:n,text:t.trim(),radar:!0,channelId:e,message:s}}function L(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Object(f.c)(e),s=new h.a({id:r,channelId:e,body:{text:t,randomId:r}});return{type:a.a.MESSAGE_AUTO_REPLY_SEND,promise:u.a.sendMessage(e,t,r,n),id:r,radar:!0,message:s}}function M(e){var t=e.channelId,n=e.text,e=e.interlocutorId;return{type:a.a.MESSAGE_DRAFT,channelId:t,text:n,interlocutorId:e}}function P(e){return{type:a.a.SET_DRAFT_MESSAGES,draftMessages:e}}var U=function(i,o){return n=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(t,n){var r,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=n(),null==(s=v(s,o))||null===(r=s.abort)||void 0===r||r.call(s),t({type:a.a.MESSAGE_TEMP_REMOVE,radar:!0,channelId:i,messageId:o});case 4:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)};var n};function N(e){var t=e.channelId,n=e.before,r=e.after,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=s.isPatch,s=s.isApiFetchEvent;return{type:a.a.MESSAGES_REQUEST,promise:u.a.getMessages({channelId:t,before:n}),channelId:t,before:n,after:r,radar:!0,isPatch:e,isApiFetchEvent:s}}function H(e){var t=e.userId,n=e.messageId,r=e.itemId,e=e.channelId;return{type:a.a.MESSAGE_CONFIRM_SUSPECT_REQUEST,promise:u.a.confirmSuspect({userId:t,messageId:n,itemId:r}),userId:t,messageId:n,itemId:r,channelId:e,radar:!0}}function x(e){var t=e.channelId,e=e.messageId;return{type:a.a.MESSAGE_CANCEL_SUSPECT_REQUEST,promise:u.a.cancelSuspect({channelId:t,messageId:e}),channelId:t,messageId:e,radar:!0}}function D(e){e=e.messageId;return{type:a.a.MESSAGE_DELETE,promise:u.a.deleteMessage({messageId:e}),messageId:e,radar:!0}}},10971:function(e,t,n){"use strict";var r=n(4238),s=n.n(r),r=n(4247),i=n.n(r),r=n(4251),o=n.n(r),r=n(4252),a=n.n(r),u=n(10761),c=n(4307),l=n(4308),d=n(4207);function f(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function h(e){return s()(e,function(e){var t=e.updated,e=e.sortingTimestamp;return null!=e?e:-t})}function p(e,t){var e=e&&document.querySelector('[data-marker="'.concat(e,'"]')),n=document.querySelectorAll('[data-marker="'.concat(t,'"]')),r=0,s=0;e?r=e.clientHeight:!n.length||(t=null===(t=document.querySelector('[data-marker="'.concat(t,'"]')))||void 0===t?void 0:t.parentElement)&&(r=window.innerHeight-(null==t?void 0:t.getBoundingClientRect().top));for(var i=0,o=0;a=n[i];i++){var a=a.clientHeight;if(r<=o+a)break;o+=a,s+=1}return s}function E(e,t){var n,r,s,i=e.lastMessage,r=(s={},y(n=e)&&n.lastMessage&&(s[l.a.CHANNEL_CHANGE_FOLDER]={route:l.a.CHANNEL_CHANGE_FOLDER,title:" "}),(null!==(r=null===(n=n.context)||void 0===n||null===(r=n.value)||void 0===r?void 0:r.menu)&&void 0!==r?r:[]).reduce(function(e,t){var n=t.deepLink,r=void 0===n?"":n,s=t.icon,i=t.confirmation,n=t.title,t=Object(l.b)(r),r=t.route,r=void 0===r?"":r,t=t.query;return e[r]={icon:s,confirmation:i,query:t,title:n,route:r},e},s)),s=function(e,t){if(e.info)return e.info;var n,r,s,i,o,a,u,c,l,d,f={name:""},h=e.users.filter(function(e){return e.id!==t});return g(e)?(f.name=null!==(n=null===(n=e.context)||void 0===n?void 0:n.value.name)&&void 0!==n?n:"",f.status=null===(n=e.context)||void 0===n?void 0:n.value.status):S(e)?(d=h[0],f.name=d.name,f.avatar=null===(e=d.publicUserProfile)||void 0===e||null===(r=e.avatar)||void 0===r?void 0:r.images,f.link={title:null==d||null===(s=d.publicUserProfile)||void 0===s||null===(i=s.deepLink)||void 0===i?void 0:i.title,url:null==d||null===(o=d.publicUserProfile)||void 0===o?void 0:o.url}):1===h.length?(d=h[0],f.name=d.name,f.avatar=null===(o=d.publicUserProfile)||void 0===o||null===(a=o.avatar)||void 0===a?void 0:a.images,f.link={title:null==d||null===(u=d.publicUserProfile)||void 0===u||null===(c=u.deepLink)||void 0===c?void 0:c.title,url:null==d||null===(l=d.publicUserProfile)||void 0===l?void 0:l.url},f.userId=d.id):f.name=h.map(function(e){return null==e?void 0:e.name}).join(", "),f}(e,t),t=function(e){if(null!==(s=e.context)&&void 0!==s&&s.value.attachMenu)return e.context.value.attachMenu;var t=y(e),n=S(e),r=g(e),s={};return s.image={title:" ",enableForUnanswered:!t},(t||n)&&(s.item={title:" "},s.location={title:"  "}),r&&e.users.find(function(e){return 191717891===e.id})&&(s.file={title:" ",enableForUnanswered:!0,maxSizeBytes:26214400}),s}(e),s=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},e,{lastMessage:void 0,chatActions:r,info:s});return s.context&&(s.context.value.attachMenu=t),i&&(i=Object(u.g)(i).message,s.lastMessage=i),s}n.d(t,"m",function(){return h}),n.d(t,"d",function(){return p}),n.d(t,"l",function(){return E}),n.d(t,"g",function(){return v}),n.d(t,"a",function(){return m}),n.d(t,"j",function(){return g}),n.d(t,"k",function(){return S}),n.d(t,"h",function(){return y}),n.d(t,"i",function(){return b}),n.d(t,"b",function(){return I}),n.d(t,"f",function(){return T}),n.d(t,"c",function(){return _}),n.d(t,"e",function(){return C});var v=function(e){var t;return(null==e||null===(t=e.readOnly)||void 0===t?void 0:t.reason)===c.b};function m(e){var t=Date.now();return e.filter(function(e){e=e.updated;return t-e/1e4<=25056e5})}function g(e){var t;return"system"===(null==e||null===(t=e.context)||void 0===t?void 0:t.type)}function S(e){var t;return"user"===(null==e||null===(t=e.context)||void 0===t?void 0:t.type)}function y(e){var t;return"item"===(null==e||null===(t=e.context)||void 0===t?void 0:t.type)}function b(e){var t;return Boolean("system"===(null==e||null===(t=e.context)||void 0===t?void 0:t.type)&&(null===(e=e.tags)||void 0===e?void 0:e.includes(d.f)))}function I(e,n){if(!e.length)return{};e=e.map(function(t){var e=n.find(function(e){e=e.channelId;return t===e});return null!=e&&e.chatActions?Object.values(e.chatActions):[]});return a()(i.a.apply(void 0,babelHelpers.toConsumableArray(e).concat(["route"])),"route")}var T=function(e){return e===d.e?d.b:d.e},_=function(e){return{marker:"changeFolderConfirmPopup",title:"    ".concat(d.d[T(e)],"?"),description:" ,    .",confirmText:", ",cancelText:",  "}},C=function(t){return Object.keys(d.g).find(function(e){return o()(d.g[e],null!=t?t:[]).length})}},10987:function(e,t,n){"use strict";var i=n(4305),r=n(4303),o=n.n(r);n.d(t,"a",function(){return u});var a=/(\s+)/,s=[i.a.URL],u=(babelHelpers.createClass(c,[{key:"hasSpecialPhrases",value:function(){var t=this;return s.some(function(e){return Boolean(t.counters[e])})}},{key:"toString",value:function(){return this.substring(0,this.phrases.length)}},{key:"substring",value:function(e,t){return c.phrasesToString(this.phrases.slice(e,t))}},{key:"first",get:function(){return this.phrases[0]}},{key:"last",get:function(){return this.phrases[this.phrases.length-1]}}],[{key:"phrasesToString",value:function(e){return e.map(function(e){return e.text}).join("")}}]),c);function c(){var s=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.text,e=e.urlsAreTrusted,e=void 0!==e&&e;if(babelHelpers.classCallCheck(this,c),this.counters={},o()(i.a).forEach(function(e){return s.counters[e]=0}),this.phrases=[],!t&&!t.length||!e)return this;t.split(a).forEach(function(e){var t,n,r,n=new i.b({text:e,type:(t=e,n=i.a.ANY,r=i.a.URL,e=i.a.DELIMITER,a.test(t)?e:/^(?:(?:https?):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-zA-Z0-9]-*)*[a-zA-Z0-9]+)(?:\.(?:[a-zA-Z0-9]-*)*[a-zA-Z0-9]+)*(?:\.(?:[a-zA-Z]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i.test(t)?r:n)});s.phrases.push(n),s.counters[n.type]++})}},4174:function(e,t,n){var r=n(3967),s=n(4169),i=n(4013);e.exports=function(e,t){return i(s(e,t,r),e+"")}},4178:function(e,t,n){n=n(4179)();e.exports=n},4179:function(e,t){e.exports=function(u){return function(e,t,n){for(var r=-1,s=Object(e),i=n(e),o=i.length;o--;){var a=i[u?o:++r];if(!1===t(s[a],a,s))break}return e}}},4181:function(e,t,n){var r=n(4058),s=n(4005);e.exports=function(e){return s(e)&&r(e)}},4186:function(e,t,n){var s=n(4040),i=n(4058),o=n(4026),a=n(3980);e.exports=function(e,t,n){if(!a(n))return!1;var r=typeof t;return!!("number"==r?i(n)&&o(t,n.length):"string"==r&&t in n)&&s(n[t],e)}},4187:function(e,t,n){"use strict";n.d(t,"b",function(){return r});var n=n(4188),n=Object(n.a)({INIT:null,APP_RESET:null,MESSAGES_RESET:null,EVENTS_CHAT_TYPING:null,SEND_CHAT_TYPING:null,SEND_CHAT_TYPING_SUCCESS:null,SEND_CHAT_TYPING_FAIL:null,EVENTS_MESSAGE:null,EVENTS_CHANNELS_UPDATE:null,EVENTS_SESSION:null,EVENTS_MESSAGE_UPDATE:null,EVENTS_BLACKLIST_ADDED:null,EVENTS_BLACKLIST_REMOVED:null,EVENTS_CHAT_REMOVED:null,EVENTS_CHAT_SHOW:null,EVENTS_CHAT_HIDE:null,EVENTS_SYSTEM_OPEN:null,EVENTS_SYSTEM_CLOSE:null,EVENTS_SYSTEM_RECONNECT:null,EVENTS_SYSTEM_RECONNECTED:null,EVENTS_TIME:null,EVENTS_MESSAGES_READ:null,EVENTS_CHAT_READ:null,EVENTS_SYSTEM_ERROR:null,EVENTS_SYSTEM_SWITCH:null,EVENTS_UNKNOWN:null,APP_ACTIVE_CHANGE:null,APP_SET_STATUS:null,APP_TABS_SYNC:null,IMAGE_UPLOAD:null,IMAGE_UPLOAD_SUCCESS:null,IMAGE_UPLOAD_FAIL:null,FILE_UPLOAD:null,FILE_UPLOAD_SUCCESS:null,FILE_UPLOAD_FAIL:null,FILE_CREATE:null,FILE_CREATE_SUCCESS:null,FILE_CREATE_FAIL:null,SET_UPLOAD_PROGRESS:null,MESSAGE_IMAGE_SEND:null,MESSAGE_IMAGE_SEND_SUCCESS:null,MESSAGE_IMAGE_SEND_FAIL:null,MESSAGE_FILE_SEND:null,MESSAGE_FILE_SEND_SUCCESS:null,MESSAGE_FILE_SEND_FAIL:null,MESSAGE_LINK_SEND:null,MESSAGE_LINK_SEND_SUCCESS:null,MESSAGE_LINK_SEND_FAIL:null,MESSAGE_SEND:null,MESSAGE_SEND_FAIL:null,MESSAGE_SEND_SUCCESS:null,MESSAGE_DELETE:null,MESSAGE_DELETE_SUCCESS:null,MESSAGE_DELETE_FAIL:null,MESSAGE_DRAFT:null,MESSAGE_TEMP_REMOVE:null,MESSAGES_REQUEST:null,MESSAGES_REQUEST_SUCCESS:null,MESSAGES_REQUEST_FAIL:null,SET_DRAFT_MESSAGES:null,LAST_ACTION_TIMES_REQUEST:null,LAST_ACTION_TIMES_REQUEST_SUCCESS:null,LAST_ACTION_TIMES_REQUEST_FAIL:null,CHANNEL_RESET_ACTIONS:null,CHANNEL_RESET:null,CHANNEL_REQUEST:null,CHANNEL_REQUEST_FAIL:null,CHANNEL_REQUEST_SUCCESS:null,CHANNEL_INITIAL_REQUEST:null,CHANNEL_INITIAL_REQUEST_FAIL:null,CHANNEL_INITIAL_REQUEST_SUCCESS:null,GEO_MESSAGES_MARKERS_REQUEST:null,GEO_MESSAGES_MARKERS_REQUEST_SUCCESS:null,GEO_MESSAGES_MARKERS_REQUEST_FAIL:null,GEO_MESSAGES_MARKERS_SET:null,MESSAGES_IMAGES_REQUEST:null,MESSAGES_IMAGES_REQUEST_FAIL:null,MESSAGES_IMAGES_REQUEST_SUCCESS:null,MESSAGES_ITEMS_REQUEST:null,MESSAGES_ITEMS_REQUEST_FAIL:null,MESSAGES_ITEMS_REQUEST_SUCCESS:null,MESSAGES_FILE_REQUEST:null,MESSAGES_FILE_REQUEST_FAIL:null,MESSAGES_FILE_REQUEST_SUCCESS:null,MESSAGES_USERS_REQUEST:null,MESSAGES_USERS_REQUEST_FAIL:null,MESSAGES_USERS_REQUEST_SUCCESS:null,MESSAGE_ITEM_SEND:null,MESSAGE_ITEM_SEND_FAIL:null,MESSAGE_ITEM_SEND_SUCCESS:null,MESSAGE_AUTO_REPLY_SEND:null,MESSAGE_AUTO_REPLY_SEND_SUCCESS:null,MESSAGE_AUTO_REPLY_SEND_FAIL:null,MESSAGE_CONFIRM_SUSPECT_REQUEST:null,MESSAGE_CONFIRM_SUSPECT_REQUEST_FAIL:null,MESSAGE_CONFIRM_SUSPECT_REQUEST_SUCCESS:null,MESSAGE_CANCEL_SUSPECT_REQUEST:null,MESSAGE_CANCEL_SUSPECT_REQUEST_FAIL:null,MESSAGE_CANCEL_SUSPECT_REQUEST_SUCCESS:null,CHANNELS_REQUEST:null,CHANNELS_REQUEST_FAIL:null,CHANNELS_REQUEST_SUCCESS:null,PINNED_CHANNELS_REQUEST:null,PINNED_CHANNELS_REQUEST_FAIL:null,PINNED_CHANNELS_REQUEST_SUCCESS:null,CHANNELS_RESET_FETCHED:null,CHANNEL_READ_REQUEST:null,CHANNEL_READ_REQUEST_SUCCESS:null,CHANNEL_READ_REQUEST_FAIL:null,PHONE_REQUEST:null,PHONE_REQUEST_SUCCESS:null,PHONE_REQUEST_FAIL:null,PHONE_RESET:null,FOLDERS_COUNTERS_REQUEST:null,FOLDERS_COUNTERS_REQUEST_SUCCESS:null,FOLDERS_COUNTERS_REQUEST_FAIL:null,ROUTER_SET:null,BLACKLIST_REQUEST:null,BLACKLIST_REQUEST_FAIL:null,BLACKLIST_REQUEST_SUCCESS:null,BLACKLIST_ADD_USERS_REQUEST:null,BLACKLIST_ADD_USERS_REQUEST_FAIL:null,BLACKLIST_ADD_USERS_REQUEST_SUCCESS:null,BLACKLIST_REMOVE_USER_REQUEST:null,BLACKLIST_REMOVE_USER_REQUEST_FAIL:null,BLACKLIST_REMOVE_USER_REQUEST_SUCCESS:null,BLACKLIST_REASONS_REQUEST:null,BLACKLIST_REASONS_REQUEST_SUCCESS:null,BLACKLIST_REASONS_REQUEST_FAIL:null,BLACKLIST_TOOLTIP_HIDE:null,ATTACH_ITEMS_REQUEST:null,ATTACH_ITEMS_REQUEST_FAIL:null,ATTACH_ITEMS_REQUEST_SUCCESS:null,ATTACH_ITEMS_RESET:null,PLATFORM_METHOD_CALL_REQUEST:null,PLATFORM_METHOD_CALL_REQUEST_SUCCESS:null,PLATFORM_METHOD_CALL_REQUEST_FAIL:null,CHANNEL_CREATE_REQUEST:null,CHANNEL_CREATE_REQUEST_SUCCESS:null,CHANNEL_CREATE_REQUEST_FAIL:null,GEO_REVERSE_REQUEST:null,GEO_REVERSE_REQUEST_SUCCESS:null,GEO_REVERSE_REQUEST_FAIL:null,MESSAGE_LOCATION_SEND:null,MESSAGE_LOCATION_SEND_SUCCESS:null,MESSAGE_LOCATION_SEND_FAIL:null,FAVORITE_PLACES_REQUEST:null,FAVORITE_PLACES_REQUEST_SUCCESS:null,FAVORITE_PLACES_REQUEST_FAIL:null,GEO_SEARCH_REQUEST:null,GEO_SEARCH_REQUEST_SUCCESS:null,GEO_SEARCH_REQUEST_FAIL:null,CHANNELS_REMOVE_REQUEST:null,CHANNELS_REMOVE_REQUEST_FAIL:null,CHANNELS_REMOVE_REQUEST_SUCCESS:null,CHANNELS_UPDATE_TAGS_REQUEST:null,CHANNELS_UPDATE_TAGS_REQUEST_FAIL:null,CHANNELS_UPDATE_TAGS_REQUEST_SUCCESS:null,CHANNELS_SET_COUNTERS:null,AUTO_REPLIES_REQUEST:null,AUTO_REPLIES_REQUEST_FAIL:null,AUTO_REPLIES_REQUEST_SUCCESS:null,SEARCH_REQUEST:null,SEARCH_REQUEST_FAIL:null,SEARCH_REQUEST_SUCCESS:null,NOTIFICATION_SHOW:null,NOTIFICATION_HIDE:null,LIQUIDITY_REQUEST:null,LIQUIDITY_REQUEST_FAIL:null,LIQUIDITY_REQUEST_SUCCESS:null,FILTER_ITEMS_REQUEST:null,FILTER_ITEMS_REQUEST_FAIL:null,FILTER_ITEMS_REQUEST_SUCCESS:null,FILTER_ITEMS_RESET:null,FILTER_ITEMS_EXACT_REQUEST:null,FILTER_ITEMS_EXACT_REQUEST_FAIL:null,FILTER_ITEMS_EXACT_REQUEST_SUCCESS:null,REVIEW_REQUEST:null,REVIEW_REQUEST_FAIL:null,REVIEW_REQUEST_SUCCESS:null,SPAM_UNBLOCK_REQUEST:null,SPAM_UNBLOCK_REQUEST_FAIL:null,SPAM_UNBLOCK_REQUEST_SUCCESS:null,SETTINGS_REQUEST:null,SETTINGS_REQUEST_FAIL:null,SETTINGS_REQUEST_SUCCESS:null,PUSH_RESET:null}),r=function(e){return function(){return e.apply(void 0,arguments)}};t.a=n},4188:function(e,t,n){"use strict";t.a=function(e){var t,n={};if(!(e instanceof Object)||Array.isArray(e))throw new Error("keyMirror(...): Argument must be an object.");for(t in e)e.hasOwnProperty(t)&&(n[t]=t);return n}},4195:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return r});var s=["code","message"];function i(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}var o={INTERNAL_ERROR:-32603,INVALID_REQUEST:-32600,METHOD_NOT_FOUND:-32601,INVALID_PARAMS:-32602,PARSE_ERROR:-32700,SOCKET_RECONNECT:-32800,NOT_FOUND:-32044,NOT_AUTHORIZED:-32041,FORBIDDEN:-32043,BAD_REQUEST:-32040,TOO_MANY_REQUESTS:-32249,SERVER_ERROR:-32050,REQUEST_TIMEOUT:-32054,MESSAGE_LOG_GONE:-32140,CLOSE_NORMAL:"close_normal"},r=401;function a(e){var t,n=e.code,r=e.message,e=babelHelpers.objectWithoutProperties(e,s),r=new Error(r);return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({code:n,type:(t=n,Object.keys(o).find(function(e){return o[e]===t})||"UNKNOWN_ERROR"),message:r.message,stack:r.stack},e)}a.ERROR_CODES=o,t.c=a},4202:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function e(){var n=this;babelHelpers.classCallCheck(this,e),this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})}},4203:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"c",function(){return s}),n.d(t,"e",function(){return i}),n.d(t,"b",function(){return o}),n.d(t,"d",function(){return a});var r="messenger_folders",s=function(e){return"messenger_folders"===e},i=function(){return!0},o="messenger_fallback",a=function(e){return"messenger_fallback"===e}},4204:function(e,t,n){"use strict";n.d(t,"c",function(){return o}),n.d(t,"f",function(){return u}),n.d(t,"g",function(){return c}),n.d(t,"e",function(){return l}),n.d(t,"d",function(){return d}),n.d(t,"a",function(){return f}),n.d(t,"b",function(){return h});var t=n(3956),r=n.n(t),s=n(10678),i=(t=new Date,n=/\(MSK\)$/.test(t.toString()),t=-t.getTimezoneOffset()/60,n&&3!=t?36e5*(3-t):0);function o(e){return e+"#"+Date.now()}function a(){try{var e=window.localStorage.getItem("messenger:settings");return JSON.parse(e)||{}}catch(e){return{}}}function u(){var e=r.a.get("userSettingsUniqueKey");return a()[e]||{}}function c(e){var t=a();t[r.a.get("userSettingsUniqueKey")]=e;try{window.localStorage.setItem("messenger:settings",JSON.stringify(t))}catch(e){}}function l(){return 1e4*new Date(Date.now()-s.a.session.timeCorrectionOffset).getTime()}function d(){return Date.now()+i}function f(e){if("undefined"!=typeof window&&window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.value=e,t.setAttribute("type","hidden"),t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(e){return!1}finally{setTimeout(function(){return document.body.removeChild(t)},0)}}}function h(e,t){for(;t;){if(e(t))return t;t=t.parentNode}return null}},4205:function(e,t,n){"use strict";n.d(t,"b",function(){return l});var r=n(3956),s=n.n(r),i=n(4206),o=n(4207),a=i.a.MOBILE,r=i.a.MINI,n=i.a.DESKTOP,u=(i={},babelHelpers.defineProperty(i,a,"mav"),babelHelpers.defineProperty(i,r,"mini-messenger"),babelHelpers.defineProperty(i,n,"messenger"),i),c=(i={},babelHelpers.defineProperty(i,o.e,"inbox"),babelHelpers.defineProperty(i,o.b,"bargainAndExchange"),i);function l(){try{return s.a.get("sendClickstreamEvent").apply(void 0,arguments)}catch(e){return null}}t.a={phoneCall:function(e){return l(2472,{uid:e.userId,iid:e.itemId,chatid:e.channelId,version:6})},phoneCallReplyTime:function(e){return l(2474,{uid:e.userId,iid:e.itemId,chatid:e.channelId,version:4})},phoneShowNumber:function(e){return l(2486,{uid:e.userId,iid:e.itemId,chatid:e.channelId,version:5})},phoneShowNumberReplyTime:function(e){return l(2487,{uid:e.userId,iid:e.itemId,chatid:e.channelId,version:4})},sendMessage:function(e){return l(3176,{uid:e.userId,chatid:e.channelId,message_type:e.messageType,s:e.source,version:3})},channelShow:function(e){var t=e.userId;return l(2919,{chatid:e.channelId,uid:t,s:e.source,channel_number:e.channelNumber,mid:e.searchMsgId,msg_search_query:e.searchQuery,from_page:e.fromPage,version:5})},channelsShow:function(e){return l(2920,{uid:e.userId,from_page:e.fromPage,s:e.source,channels_screen_count:e.channelsScreenCount,version:3})},showConfirmPhoneCodeScreen:function(e){return l(2077,{phone:e,s:"msg_phone_confirm",version:3})},geoAttachmentClick:function(e){var t=e.userId,n=e.channelId,r=e.itemId,e=e.appName;return l(3110,{uid:t,chatid:n,msg_app_name:u[e],iid:r,version:4})},searchLocation:function(e){var t=e.userId,n=e.channelId,r=e.isEdit,e=e.appName;return l(3327,{uid:t,chatid:n,msg_app_name:u[e],s:r?"geo_edit":"geo_search",version:1})},geoSuggestionClick:function(e){var t=e.userId,n=e.channelId,r=e.suggestionType,e=e.appName;return l(3328,{uid:t,chatid:n,msg_app_name:u[e],search_address_type:r,version:2})},detectLocationClick:function(e){var t=e.userId,n=e.channelId,e=e.appName;return l(3326,{uid:t,msg_app_name:u[e],chatid:n,version:2})},attachmentsClick:function(e){var t=e.userId,n=e.channelId,e=e.appName;return l(3109,{uid:t,msg_app_name:u[e],chatid:n,version:2})},profileClick:function(e){var t=e.userId,n=e.channelId,r=e.appName,s=e.itemId,i=e.itemOwnerId,e=e.profileUserId;return l(2998,{uid:t,s:"messenger_chat_menu",msg_app_name:u[r],chatid:n,oid:i,iid:s,puid:e,version:3})},messageCopy:function(e){var t=e.userId,n=e.channelId,r=e.appName,s=e.messageId,i=e.copyText,e=e.isTextWrappedByChecker;return l(3450,{uid:t,msg_app_name:u[r],chatid:n,msg_copy_text:i,mid:s,msg_copy_link_checker:e,version:3})},channelsFilterByMyItems:function(e){return l(2686,{uid:e,version:4})},channelsFilterByItem:function(e){return l(2687,{uid:e,version:2})},channelsFilterByText:function(e){return l(2688,{uid:e,version:2})},channelsFilterByUnread:function(e){return l(2689,{uid:e,version:3})},itemNavigate:function(e){return l(3130,{uid:e.userId,chatid:e.channelId,version:1})},messageTypingStart:function(e){return l(3129,{uid:e.userId,chatid:e.channelId})},resendMessage:function(e){return l(3177,{uid:e.userId,chatid:e.channelId,msg_random_id:e.randomId,message_type:e.messageType,version:1})},sendMessageRequest:function(e){var t=e.userId,n=e.channelId,r=e.network;return l(3477,{uid:t,chatid:n,message_type:e.messageType,msg_random_id:e.randomId,msg_socket_type:e.transport,network_type:r})},deleteMessage:function(e){return l(3218,{uid:e.userId,chatid:e.channelId,msg_random_id:e.randomId,message_type:e.messageType,version:2})},enterButtonClick:function(e,t){return l(3184,{uid:e,s:t})},showConfirmPhoneStartScreen:function(e){return l(3312,{uid:e})},showConfirmPhoneInputScreen:function(e){return l(3313,{uid:e})},platformButtonClick:function(e){var t=e.userId,n=e.messageId;return l(3439,{uid:t,chatid:e.channelId,mid:n,flow_id:e.flowId,msg_button_type:e.buttonType,action_payload:e.actionPayload,version:4})},blockButtonClick:function(e){return l(3464,{uid:e.userId,chatid:e.channelId})},complainButtonClick:function(e){return l(3465,{uid:e.userId,chatid:e.channelId})},suspectMessageDialogShow:function(e){return l(3499,{uid:e.userId,chatid:e.channelId,mid:e.messageId})},channelWithDraftOpen:function(e){return l(3554,{uid:e.userId,chatid:e.channelId})},searchFieldFocus:function(e){return l(3528,{uid:e.userId,version:0})},search:function(e){return l(3529,{uid:e.userId,msg_search_query:e.query,version:1})},showFoundedMsg:function(e){var t=e.userId,n=e.channelId,r=e.searchMsgId,s=e.searchQuery,i=e.chatPageNumber;return l(3532,{uid:t,chatid:n,mid:r,msg_search_success:e.isSuccessful,msg_chat_page_num:i,msg_search_query:s})},showProStats:function(e){return l(4072,{uid:e.userId})},recommendationsClick:function(e){return l(3563,{uid:e.userId,chatid:e.channelId,iid:e.itemId})},browserSearchActivated:function(e){return l(4036,{uid:e.userId,ref:window.location.href})},linkClick:function(e){return l(4170,{uid:e.userId,mid:e.messageId,chatid:e.channelId,msg_link_text:e.linkAddress,version:1})},openFolder:function(e){var t=e.userId,e=e.folder;return l(4275,{uid:t,folder_name:c[e]})},filterExchangeChats:function(e){return l(4281,{uid:e.userId})},filterBargainChats:function(e){return l(4279,{uid:e.userId})},closeFoldersOnboarding:function(e){return l(4282,{uid:e.userId,messenger_folder_onbording_action_name:e.actionType})},clickFolderLandingLink:function(e){return l(4286,{uid:e.userId})},changeFolder:function(e){var t=e.userId,n=e.channelId,r=e.folder,s=e.tags,e=e.source;return l(4285,{uid:t,chatid:n,folder_name:c[r],tag_name:s.toString(),msg_move_to_folder_from:{chatPage:"c",bulkAction:"gt",chatListPage:"chl"}[e]})},itemChunkClick:function(e){var t=e.userId,n=e.itemId,r=e.channelId,e=e.appName;return l(4270,{uid:t,item_id:n,chatid:r,msg_app_name:u[e]})},requestReviewClick:function(e){return l(4361,{chatid:e.channelId,version:0})},downloadCallsButtonClick:function(){return l(4244)},channelsContextMenuClick:function(e){return l(4379,{uid:e.userId})},channelsContextMenuItemClick:function(e){return l(4380,{uid:e.userId,menu_item:e.menuItem})},changeChatbotSettings:function(e){var t=e.userId,n=e.autoReplyEnabled,r=e.itemEmailEnabled,e=e.addressesEnabled;return l(4381,{uid:t,ns_type:"auto_replies",ns_value:n,ns_channel:[].concat(babelHelpers.toConsumableArray(r?["email"]:[]),babelHelpers.toConsumableArray(e?["extra_email"]:[])).join(",")})},fileUpload:function(e){return l(4844,{uid:e.userId,chatid:e.channelId,msg_file:e.fileId})},fileDownloadClick:function(e){return l(4845,{uid:e.userId,chatid:e.channelId,msg_file:e.fileId})}}},4206:function(e,t,n){"use strict";t.a={DESKTOP:"web",PRO_DESKTOP:"pro-web",MOBILE:"mav",MINI:"mini",MODERATION:"moderation",SUPPORT:"support-web"}},4207:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"c",function(){return s}),n.d(t,"f",function(){return i}),n.d(t,"e",function(){return o}),n.d(t,"b",function(){return a}),n.d(t,"g",function(){return u}),n.d(t,"d",function(){return c});var r="f_b",s="f_e",i="s",o="other",a="exb",u=(t={},babelHelpers.defineProperty(t,o,["f_i"]),babelHelpers.defineProperty(t,a,[s,r]),t),c=(t={},babelHelpers.defineProperty(t,o," "),babelHelpers.defineProperty(t,a,"  "),t)},4211:function(e,t,n){"use strict";n.r(t),n.d(t,"setUploadProgress",function(){return m}),n.d(t,"createFile",function(){return g}),n.d(t,"uploadImage",function(){return r}),n.d(t,"uploadFile",function(){return a});var d=n(4187),s=n(4204),t=n(3956),f=n.n(t),u=n(4234),h=n(4212),i=n(10678),o=n(4202),p=n(4205),E=n(4235),v=function(e,t,n){var r=new o.a,s=new XMLHttpRequest;return s.open("POST",t),s.withCredentials=!0,s.upload.addEventListener("progress",function(e){n(e.loaded,e.total)}),s.addEventListener("error",function(){r.reject("request error")}),s.addEventListener("load",function(){200!==s.status&&r.reject(s.responseText),s.responseText||r.resolve({result:{ok:!0}});try{var e=JSON.parse(s.responseText);r.resolve(e)}catch(e){r.reject("Response promise parse error")}}),s.send(e),{promise:r.promise,abort:function(){s.abort(),r.reject("abort")}}};function m(e,t,n){return{type:d.a.SET_UPLOAD_PROGRESS,messageId:e,uploadedBytes:t,totalBytes:n}}function g(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e),r=t.get("file");if(!(r&&r instanceof File))throw Error("expected valid file at form data");r=new h.a({id:n,channelId:e,body:{randomId:n,sizeBytes:r.size,name:r.name}});return{type:d.a.FILE_CREATE,promise:i.a.createFile(e),message:r,formData:t,id:n,radar:!0}}function r(i,o){var t,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object(s.c)(i);return t=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(n){var r,t,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new u.a({id:a,channelId:i,body:{randomId:a}}),s=v(o,f.a.get("imageUploadUrl"),function(e,t){return n(m(r.id,e,t))}),t=s.promise,s=s.abort,e.abrupt("return",n({channelId:i,formData:o,id:a,type:d.a.IMAGE_UPLOAD,message:r,radar:!0,promise:t,abort:s}));case 3:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}}function a(u,c){var n,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object(s.c)(u);return n=babelHelpers.asyncToGenerator(regeneratorRuntime.mark(function e(n,t){var r,s,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=c.get("file"))&&r instanceof File){e.next=3;break}throw Error("expected valid file at form data");case 3:return e.next=5,n(g(u,c,l));case 5:if((s=e.sent).isError)return e.abrupt("return",s);e.next=8;break;case 8:return o=s.result.fileId,i=new h.a({id:l,channelId:u,body:{randomId:l,fileId:o,sizeBytes:r.size,name:r.name}}),a=Object(E.g)(t()),p.a.fileUpload({userId:a,channelId:u,fileId:o}),a=v(c,"".concat(f.a.get("fileUploadUrl"),"?id=").concat(o),function(e,t){return n(m(i.id,e,t))}),o=a.promise,a=a.abort,e.abrupt("return",n({channelId:u,formData:c,id:l,type:d.a.FILE_UPLOAD,message:i,radar:!0,promise:o,abort:a}));case 14:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)}}},4212:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var t=n(4214),i=n(4213);var r=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=i.c.FILE,e}return s}(t.a)},4213:function(e,t,n){"use strict";var r,s,i,o;n.d(t,"c",function(){return r}),n.d(t,"b",function(){return s}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return o}),(t=r=r||{}).SYSTEM="system",t.IMAGE="image",t.TEXT="text",t.ITEM="item",t.CALL="call",t.LINK="link",t.LOCATION="location",t.DELETED="deleted",t.APP_CALL="appCall",t.FILE="file",t.UNKNOWN="",(t=s=s||{}).PLATFORM="platform",t.PLATFORM_FROM_USER="platformFromUser",t.REACTION="react",(t=i=i||{}).DEFAULT="default",t.TEXT="text",t.GEO="geo_message",t.IMAGE="image",t.ITEM="item",(t=o=o||{})[t.SENDING=0]="SENDING",t[t.SENT=1]="SENT",t[t.DELIVERED=2]="DELIVERED",t[t.READ=3]="READ",t[t.FAILED=4]="FAILED"},4214:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(10809),s=n(10678),i=n(4213);function o(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}var a=(babelHelpers.createClass(u,[{key:"checkRequired",value:function(e){if(null==e||!e.channelId)throw new Error("channelId isRequired")}},{key:"init",value:function(e){var t=e.channelId,n=e.read,r=e.delivered,e=e.fromUid;this.channelId=null!=t?t:this.channelId,this.fromUid=null!==(e=e||s.a.session.userId)&&void 0!==e?e:this.fromUid,this.created=1e4*new Date(Date.now()-s.a.session.timeCorrectionOffset).getTime(),r&&(this.sendingStatus=i.d.DELIVERED),n&&(this.sendingStatus=i.d.READ),this.isMine&&!this.sendingStatus&&(this.sendingStatus=i.d.SENDING)}},{key:"assign",value:function(e){return new this.constructor(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},this,{},e))}},{key:"date",get:function(){return new Date(this.created/1e4)}},{key:"isSendingFailed",get:function(){return this.sendingStatus===i.d.FAILED}},{key:"isMine",get:function(){return u.isMine(this.fromUid)}},{key:"isEqual",value:function(e){return e instanceof u&&this.id===e.id&&this.type===e.type&&this.sendingStatus===e.sendingStatus}}],[{key:"isMine",value:function(e){return e===s.a.session.userId}}]),u);function u(e){babelHelpers.classCallCheck(this,u),this.id="",this.type=i.c.UNKNOWN,this.fromUid=0,this.uid=0,this.created=0,this.channelId="",this.body={},this.isRead=!1,this.isSpam=!1,this.isDeleted=!1,this.checkRequired(e),this.init(e),r.e.deepAssign(this,e)}},4234:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var t=n(4214),i=n(4213);var r=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=i.c.IMAGE,e}return s}(t.a)},4235:function(e,t,n){"use strict";n.d(t,"g",function(){return s}),n.d(t,"f",function(){return i}),n.d(t,"e",function(){return o}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return u}),n.d(t,"a",function(){return c}),n.d(t,"d",function(){return l});var r=n(4206),s=function(e){return null!==(e=e.system.userId)&&void 0!==e?e:0},i=function(e){return e.system.isConnected},o=function(e){return e.system.isClosed},a=function(e){return null!==(e=e.system.appName)&&void 0!==e?e:r.a.DESKTOP},u=function(e){return e.system.appVersion},c=function(e){return e.system.appName===r.a.PRO_DESKTOP},l=function(e){return e.system.isAuthorized}},4236:function(e,t,n){"use strict";n.d(t,"f",function(){return c}),n.d(t,"c",function(){return r}),n.d(t,"a",function(){return s}),n.d(t,"e",function(){return i}),n.d(t,"d",function(){return l}),n.d(t,"b",function(){return d});var o=n(4206),a=n(4237),u=n(4235),c=function(e){return e.messages.list||[]},r=function(e){return c(e).some(function(e){return e.isSpam})},s=function(e){var t=c(e),n=Object(u.g)(e);return t.some(function(e){return e.fromUid!==n})},i=function(e){return e.messages.channelId},l=function(e,t){return c(e).find(function(e){return e.id===t})},d=function(e){var t=Object(u.g)(e),n=Object(a.c)(e),r="item"===(null==n?void 0:n.type)?n.value.userId:void 0,s=c(e),i="item"===(null==n?void 0:n.type)?n.value.replyTime:void 0,n=e.messages.fetching,e=e.system.appName===o.a.SUPPORT||e.system.appName===o.a.MODERATION;return!(0!==s.length||r===t||n||e)&&Boolean(i)}},4237:function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"g",function(){return i}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return u}),n.d(t,"e",function(){return c}),n.d(t,"f",function(){return l});var r=n(10971),s=function(e){return null===(e=e.channel)||void 0===e?void 0:e.channel},i=function(e){var t,n=s(e),e=null==n?void 0:n.inputState;return e?e.description:null==n||null===(t=n.readOnly)||void 0===t?void 0:t.description},o=function(e){var t=s(e),e=null==t?void 0:t.inputState;return e?e.isDisabled:Boolean(null==t?void 0:t.readOnly)},a=function(e){e=s(e);return null==e?void 0:e.context},u=function(e){e=s(e);return null==e?void 0:e.channelId},c=function(e){var e=s(e);if(Object(r.h)(e))return null===(e=e.context)||void 0===e?void 0:e.value.id},l=function(e){var e=s(e);if(Object(r.h)(e))return null===(e=e.context)||void 0===e?void 0:e.value.priceString}},4238:function(e,t,n){var r=n(4167),s=n(4239),i=n(4174),o=n(4186),i=i(function(e,t){if(null==e)return[];var n=t.length;return 1<n&&o(e,t[0],t[1])?t=[]:2<n&&o(t[0],t[1],t[2])&&(t=[t[0]]),s(e,r(t,1),[])});e.exports=i},4239:function(e,t,n){var i=n(4156),o=n(4148),a=n(4128),u=n(4240),c=n(4244),l=n(4052),d=n(4245),f=n(3967),h=n(4004);e.exports=function(e,r,n){r=r.length?i(r,function(t){return h(t)?function(e){return o(e,1===t.length?t[0]:t)}:t}):[f];var s=-1;r=i(r,l(a));e=u(e,function(t,e,n){return{criteria:i(r,function(e){return e(t)}),index:++s,value:t}});return c(e,function(e,t){return d(e,t,n)})}},4240:function(e,t,n){var o=n(4241),a=n(4058);e.exports=function(e,r){var s=-1,i=a(e)?Array(e.length):[];return o(e,function(e,t,n){i[++s]=r(e,t,n)}),i}},4241:function(e,t,n){var r=n(4242),r=n(4243)(r);e.exports=r},4242:function(e,t,n){var r=n(4178),s=n(4041);e.exports=function(e,t){return e&&r(e,t,s)}},4243:function(e,t,n){var a=n(4058);e.exports=function(i,o){return function(e,t){if(null==e)return e;if(!a(e))return i(e,t);for(var n=e.length,r=o?n:-1,s=Object(e);(o?r--:++r<n)&&!1!==t(s[r],r,s););return e}}},4244:function(e,t){e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},4245:function(e,t,n){var c=n(4246);e.exports=function(e,t,n){for(var r=-1,s=e.criteria,i=t.criteria,o=s.length,a=n.length;++r<o;){var u=c(s[r],i[r]);if(u)return a<=r?u:u*("desc"==n[r]?-1:1)}return e.index-t.index}},4246:function(e,t,n){var l=n(4035);e.exports=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,s=e==e,i=l(e),o=void 0!==t,a=null===t,u=t==t,c=l(t);if(!a&&!c&&!i&&t<e||i&&o&&u&&!a&&!c||r&&o&&u||!n&&u||!s)return 1;if(!r&&!i&&!c&&e<t||c&&n&&s&&!r&&!i||a&&n&&s||!o&&s||!u)return-1}return 0}},4247:function(e,t,n){var r=n(4156),s=n(4248),i=n(4128),o=n(4174),a=n(4250),u=n(4199),o=o(function(e){var t=u(e),n=r(e,a);return t===u(n)?t=void 0:n.pop(),n.length&&n[0]===e[0]?s(n,i(t,2)):[]});e.exports=o},4248:function(e,t,n){var v=n(4134),m=n(4019),g=n(4249),S=n(4156),y=n(4052),b=n(4138),I=Math.min;e.exports=function(e,t,n){for(var r=n?g:m,s=e[0].length,i=e.length,o=i,a=Array(i),u=1/0,c=[];o--;){var l=e[o];o&&t&&(l=S(l,y(t))),u=I(l.length,u),a[o]=!n&&(t||120<=s&&120<=l.length)?new v(o&&l):void 0}var l=e[0],d=-1,f=a[0];e:for(;++d<s&&c.length<u;){var h=l[d],p=t?t(h):h,h=n||0!==h?h:0;if(!(f?b(f,p):r(c,p,n))){for(o=i;--o;){var E=a[o];if(!(E?b(E,p):r(e[o],p,n)))continue e}f&&f.push(p),c.push(h)}}return c}},4249:function(e,t){e.exports=function(e,t,n){for(var r=-1,s=null==e?0:e.length;++r<s;)if(n(t,e[r]))return!0;return!1}},4250:function(e,t,n){var r=n(4181);e.exports=function(e){return r(e)?e:[]}},4251:function(e,t,n){var r=n(4156),s=n(4248),i=n(4174),o=n(4250),i=i(function(e){var t=r(e,o);return t.length&&t[0]===e[0]?s(t):[]});e.exports=i},4252:function(e,t,n){var r=n(4039),n=n(4253)(function(e,t,n){r(e,n,t)});e.exports=n},4253:function(e,t,n){var o=n(4254),a=n(4255),u=n(4128),c=n(4004);e.exports=function(s,i){return function(e,t){var n=c(e)?o:a,r=i?i():{};return n(e,s,u(t,2),r)}}},4254:function(e,t){e.exports=function(e,t,n,r){for(var s=-1,i=null==e?0:e.length;++s<i;){var o=e[s];t(r,o,n(o),e)}return r}},4255:function(e,t,n){var o=n(4241);e.exports=function(e,r,s,i){return o(e,function(e,t,n){r(i,e,s(e),n)}),i}},4256:function(e,t){e.exports=function(e){return null==e}},4257:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var t=n(4214),i=n(4213);var r=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=i.c.TEXT,e}return babelHelpers.createClass(s,[{key:"checkRequired",value:function(e){var t;if(null==e||null===(t=e.body)||void 0===t||!t.text)throw new Error("body.text isRequired");babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"checkRequired",this).call(this,e)}}]),s}(t.a)},4258:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var t=n(4214),i=n(4213);var r=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=i.c.ITEM,e}return babelHelpers.createClass(s,[{key:"checkRequired",value:function(e){if(!e||!e.body||!e.body.itemId)throw new Error("body.itemId isRequired");babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"checkRequired",this).call(this,e)}}]),s}(t.a)},4259:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var t=n(4214),i=n(4213);var r=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=i.c.LINK,e}return babelHelpers.createClass(s,[{key:"checkRequired",value:function(e){var t;if(null==e||null===(t=e.body)||void 0===t||!t.url)throw new Error("body.url isRequired");babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"checkRequired",this).call(this,e)}}]),s}(t.a)},4260:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var t=n(4214),i=n(4213);var r=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=i.c.LOCATION,e}return babelHelpers.createClass(s,[{key:"checkRequired",value:function(e){var t,n;if("number"!=typeof(null==e||null===(t=e.body)||void 0===t?void 0:t.lat)||"number"!=typeof(null==e||null===(n=e.body)||void 0===n?void 0:n.lon))throw new Error("body.lat and body.lon are required");babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"checkRequired",this).call(this,e)}}]),s}(t.a)},4303:function(e,t,n){var r=n(4304),s=n(4041);e.exports=function(e){return null==e?[]:r(e,s(e))}},4304:function(e,t,n){var r=n(4156);e.exports=function(t,e){return r(e,function(e){return t[e]})}},4305:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var r,t=n(4303),s=n.n(t);(t=r=r||{}).ANY="any",t.URL="url",t.DELIMITER="delimiter";var i=function e(t){var n=t.text,t=t.type;if(babelHelpers.classCallCheck(this,e),!s()(r).includes(t))throw new Error("type is incorrect");this.text=n,this.type=t}},4306:function(e,t,n){"use strict";function r(e){var t="https://link.avito.ru/go?to=",n=0===e.indexOf(t);return!e||n?e:"".concat(t).concat(encodeURIComponent(e))}function s(e){if(!e)return e;var t=e.toLowerCase();return 0===t.indexOf("http://")||0===t.indexOf("https://")||0===t.indexOf("//")||0===e.indexOf("/")?e:"https://".concat(e)}n.d(t,"b",function(){return r}),n.d(t,"a",function(){return s})},4307:function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"d",function(){return s}),n.d(t,"a",function(){return i}),n.d(t,"e",function(){return o}),n.d(t,"b",function(){return a});var r=3e3,s=2e3,i={JOB_VACANCY:111,JOB_RESUME:112},o="  ",a="blacklist"},4308:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return s});var t=n(4188),i=n(10779),o={CHANNEL_DELETE:"ru.avito://1/channel/delete",CHANNEL_COMPLAIN:"ru.avito://1/channel/blockWithReason",CHANNEL_BLOCK:"ru.avito://1/channel/block",CHANNEL_CALL:"ru.avito://1/channel/call",CHANNEL_CHANGE_FOLDER:"ru.avito://1/channel/changeFolder",CHANNEL_REVIEW:"ru.avito://1/channel/review",ABUSE:"ru.avito://1/abuse/report",HELP_CENTER_SHOW:"ru.avito://1/helpcenter/show"},r=Object(t.a)(o),s=function(r){var s,e=Object.entries(o).find(function(e){var t=babelHelpers.slicedToArray(e,2),n=(t[0],t[1]),e=r.split("?"),t=babelHelpers.slicedToArray(e,2),e=t[0],t=t[1],t=void 0===t?"":t;return e===n&&(s=Object(i.queryStringToObject)(t),!0)})||[],e=babelHelpers.slicedToArray(e,1)[0];return{query:s,route:e}}},4309:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var t=n(4214),i=n(4213);var r=function(e){babelHelpers.inherits(s,e);var n,r,t=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=babelHelpers.getPrototypeOf(n);return t=r?(e=babelHelpers.getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),babelHelpers.possibleConstructorReturn(this,t)});function s(e){return babelHelpers.classCallCheck(this,s),(e=t.call(this,e)).type=i.c.TEXT,e}return babelHelpers.createClass(s,[{key:"checkRequired",value:function(e){var t;if(null==e||null===(t=e.body)||void 0===t||!t.text)throw new Error("body.text isRequired");babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"checkRequired",this).call(this,e)}}]),s}(t.a)},4326:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return s}),n.d(t,"d",function(){return i}),n.d(t,"c",function(){return o});var a="msgr:inited";function r(o){return function(){for(var e,t,n,r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];null!==(e=window.avito)&&void 0!==e&&null!==(t=e.messenger)&&void 0!==t&&t.helpers?null===(t=(n=window.avito.messenger.helpers)[o])||void 0===t||t.call.apply(t,[n].concat(i)):(n=function e(){var t,n,r,s;null===(t=window.avito)||void 0===t||null===(n=t.messenger)||void 0===n||null===(r=n.helpers)||void 0===r||null===(s=r[o])||void 0===s||s.call.apply(s,[r].concat(i)),document.removeEventListener(a,e)},document.addEventListener(a,n))}}var s=r("openChannel"),i=r("verifyPhone"),o=r("setDraftMessage");r("refetchChannels")},4338:function(e,t,n){var r=n(4167),s=n(4128),i=n(4174),o=n(4339),a=n(4181),u=n(4199),i=i(function(e){var t=u(e);return a(t)&&(t=void 0),o(r(e,1,a,!0),s(t,2))});e.exports=i},4339:function(e,t,n){var h=n(4134),p=n(4019),E=n(4249),v=n(4138),m=n(4340),g=n(4141);e.exports=function(e,t,n){var r=-1,s=p,i=e.length,o=!0,a=[],u=a;if(n)o=!1,s=E;else if(200<=i){var c=t?null:m(e);if(c)return g(c);o=!1,s=v,u=new h}else u=t?[]:a;e:for(;++r<i;){var l=e[r],d=t?t(l):l,l=n||0!==l?l:0;if(o&&d==d){for(var f=u.length;f--;)if(u[f]===d)continue e;t&&u.push(d),a.push(l)}else s(u,d,n)||(u!==a&&u.push(d),a.push(l))}return a}},4340:function(e,t,n){var r=n(4109),s=n(3999),n=n(4141),s=r&&1/n(new r([,-0]))[1]==1/0?function(e){return new r(e)}:s;e.exports=s},4357:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var v=n(4187),t=n(4338),m=n.n(t),g=n(10971);function r(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function S(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){babelHelpers.defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var y={hash:{},emptyChannels:[]};function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:y,t=1<arguments.length?arguments[1]:void 0;switch(t.type){case v.a.SET_DRAFT_MESSAGES:var n=t.draftMessages,r=n.hash,n=n.emptyChannels,n=void 0===n?[]:n;return{hash:void 0===r?{}:r,emptyChannels:Object(g.a)(n)};case v.a.MESSAGE_DRAFT:var r=t.text,n=t.channelId,s=t.interlocutorId;return S({},e,{hash:S({},e.hash,babelHelpers.defineProperty({},n,r?{text:String(r),userId:Number(s)}:void 0))});case v.a.MESSAGE_SEND:var i=t.channelId;return S({},e,{hash:S({},e.hash,babelHelpers.defineProperty({},i,void 0))});case v.a.CHANNEL_REQUEST_SUCCESS:var o=t.channel,s=Boolean(o.lastMessage),i=Boolean(e.emptyChannels.find(function(e){return e.channelId===o.channelId})),a=babelHelpers.toConsumableArray(e.emptyChannels);return s?i&&(a=e.emptyChannels.filter(function(e){return e.channelId!==o.channelId})):a=m()([o],e.emptyChannels,"channelId"),S({},e,{emptyChannels:a,hash:S({},e.hash,babelHelpers.defineProperty({},o.channelId,o.readOnly?void 0:e.hash[o.channelId]))});case v.a.CHANNELS_REMOVE_REQUEST_SUCCESS:var a=t.channelIds.reduce(function(e,t){return e[t]=void 0,e},{}),u=e.emptyChannels.filter(function(e){return!t.channelIds.includes(e.channelId)});return S({},e,{hash:S({},e.hash,{},a),emptyChannels:u});case v.a.BLACKLIST_ADD_USERS_REQUEST_SUCCESS:var c=[],u=Object.entries(e.hash).reduce(function(n,e){var e=babelHelpers.slicedToArray(e,2),r=e[0],e=e[1],e=(e=void 0===e?{}:e).userId,s=void 0===e?0:e;return t.users.forEach(function(e){var t=e.itemId,e=e.userId;c.push(t),s===e&&(n[r]=void 0)}),n},S({},e.hash)),l=e.emptyChannels.filter(function(e){var t=Object(g.h)(e)&&(null===(t=e.context)||void 0===t?void 0:t.value.id)||0;return!c.includes(t)});return S({},e,{hash:u,emptyChannels:l});case v.a.EVENTS_BLACKLIST_ADDED:var d,f=null===(l=t.response)||void 0===l?void 0:l.userId,h=null===(l=t.response)||void 0===l||null===(d=l.context)||void 0===d?void 0:d.itemId,p=null===(d=t.response)||void 0===d||null===(E=d.context)||void 0===E?void 0:E.channelId,E=Object.entries(e.hash).reduce(function(e,t){var n=babelHelpers.slicedToArray(t,2),t=n[0],n=n[1],n=(n=void 0===n?{}:n).userId;return(void 0===n?0:n)===f&&(e[t]=void 0),e},S({},e.hash));return S({},e,{hash:E,emptyChannels:e.emptyChannels.filter(function(e){var t,n=e.users.find(function(e){return e.id===f}),r=h&&Object(g.h)(e)&&(null===(t=e.context)||void 0===t||null===(r=t.value)||void 0===r?void 0:r.id)===h,e=p&&e.channelId===p;return!n||!r&&!e})});default:return e}}}}]);
