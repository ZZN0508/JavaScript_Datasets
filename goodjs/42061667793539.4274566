YUI.add("fluid-modal-nav-bar-view",function(s){"use strict";var e={css:{nav:".fluid-modal-nav-bar",navContent:".fluid-modal-nav-content",links:".links",link:".link"},options:{}};s.FlickrView.create(this.name,s.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){for(var t=this.get("breakpointConfig")||[],n=this.appContext.viewportData.getWidth(),i=t.sort(function(e,t){return e.maxWidth-t.maxWidth}),r=0;r<i.length;r++)if(n<i[r].maxWidth){this.mobileConfig=i[r],this.set("links",this.mobileConfig.links),this.set("enableSearch",this.mobileConfig.enableSearch);break}return this},loadState:function(){return this},buildContainer:function(){var e={links:this.get("links"),enableSearch:this.get("enableSearch")};return this.setContainerWithTemplate("fluid-modal-nav-bar",e),this},activate:function(){var t=this.get("container"),n=this;return this.registerEventHandler(t.on("click",this.handleClick.bind(this))),this.registerEventHandler(t.on("key",this.handleClick.bind(this),"down:13")),this.get("links").forEach(function(e){e.selected&&n.set("currentSelection",t.one('.link[data-id="'+e.id+'"]'))}),this},deselectAll:function(){this.get("container").one(e.css.nav).one(e.css.navContent).one(e.css.links).all(e.css.link).removeClass("selected")},handleClick:function(e){var t,n=e.target,i=n.get("parentNode"),r=this.get("container"),o={},a=this.appContext.getViewer().nsid;"a"===n.getDOMNode().tagName.toLowerCase()?(e.halt(),this.deselectAll(),i.addClass("selected"),this.set("currentSelection",i),(t=r.one(".search-field"))&&(t.getDOMNode().value=""),this.fire("subviewViewEvent","navigation",e)):n.hasClass("link")?(e.halt(),this.deselectAll(),n.addClass("selected"),this.set("currentSelection",n),(t=r.one(".search-field"))&&(t.getDOMNode().value=""),this.fire("subviewViewEvent","navigation",e)):(t=r.one(".search-field"),this.get("enableSearch")&&t&&(r=r.one(".search-field").getDOMNode(),"submit"===n.getDOMNode().type&&(e.halt(),o.apiParams={},o.apiParams[s.AttributeHelpers.coerceString(r.name)]=r.value,o.id=s.SearchHelper.generateQueryString(o.apiParams)||s.guid(),o.viewerNsid=a,this.fire("subviewViewEvent","search",o),this.deselectAll(),this.set("currentSelection",{type:"search",modelParams:o}))))},onParentViewEvent:function(e,t){var n=this.get("currentSelection");"backToList"===t[0]&&(n instanceof s.Node?this.get("currentSelection").getDOMNode().click():"search"===n.type&&this.fire("subviewViewEvent","search",n.modelParams))}},{ATTRS:{links:{value:[],validator:function(e){return s.Lang.isArray(e)}},currentSelection:{value:null},enableSearch:{value:!0,validator:function(e){return s.AttributeHelpers.validateBoolean(e)},setter:function(e){return s.AttributeHelpers.coerceBoolean(e)}},breakpointConfig:{value:null}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-fluid-modal-nav-bar","attribute-helpers","search-helper"],langBundles:["common","wallart"],optional:["person-models","photo-models"]}),YUI.add("photo-prints-helper",function(a,e){var s=require("url-parse"),l=require("hermes-core/flog")(e),c=require("superagent"),h=a.mix({langBundles:["prints"]},a.Localizable),d={default:"prints.SOMETHING_WRONG_PREPARING_PRINT",4:"prints.UNSUPPORTED_FILE_TYPE_PLEASE_JPG"};a.PhotoPrintsHelper=function(i){var e=a.config.flickr.flickrprints.devBaseUrl,t=a.config.flickr.flickrprints.baseUrl,n=a.config.flickr.flickrprints.cartPath,r=a.config.flickr.flickrprints.devApiKey,o=a.config.flickr.flickrprints.apiKey;return{isPrintsEnabled:function(){return i.getViewer().signedIn||!i.getViewer().signedIn&&i.flipper.isFlipped("enable-others-to-print")},canPrintPhoto:function(e){return this.isPrintsEnabled()&&!e.getValue("isVideo")&&(e.getValue("isOwner")||i.flipper.isFlipped("enable-others-to-print")&&!e.getValue("isOwner")&&e.getValue("engagement").getValue("canPrint"))},registerPrint:function(e,t){var n=this;return i.callAPI("flickr.printservice.getRedirectURL",{user_id:e.getValue("owner").getValue("id"),photo_id:e.getValue("id"),return_url:t}).then(function(e){return n.isPrintUrlSafe(e.redirectURL)?{redirectURL:e.redirectURL}:a.Promise.reject({message:n.getRegisterPrintErrorCodeMessage()})}).catch(function(e){throw{message:n.getRegisterPrintErrorCodeMessage(e.code)}})},isPrintUrlSafe:function(e){e=new s(e);return"https:"===e.protocol&&"https://"+e.hostname===this.getBaseUrl()},getBaseUrl:function(){return i.flipper.isFlipped("enable-photo-prints-prod-url")?t:e},getApiKey:function(){return i.flipper.isFlipped("enable-photo-prints-prod-url")?o:r},getCartUrl:function(){return this.getBaseUrl()+n},fetchCartCount:function(){var e=this.getBaseUrl()+"/api/v2/cart?APIKey="+this.getApiKey();return c.get(e).withCredentials().set("Accept","application/json").then(function(e){return{count:e&&e.body.Response.Cart?e.body.Response.Cart.ItemCount:0}}).catch(function(e){throw l.error("Error fetching cart count",{err:e}),e})},fetchOrder:function(n){var e=this.getBaseUrl()+"/api/v2/order/"+n+"?_expand=OrderBillingAddress&APIKey="+this.getApiKey();return c.get(e).withCredentials().set("Accept","application/json").then(function(e){var t=e.body.Response.Order,e=e.body.Expansions["/api/v2/order/"+n+"!billingaddress"];return{orderId:t.OrderID,orderUrl:t.WebUri,email:e.OrderBillingAddress.Email}})},getRegisterPrintErrorCodeMessage:function(e){e=e?e.toString():"";return d.hasOwnProperty(e)?h.intlMessage({intlName:d[e]}):h.intlMessage({intlName:d.default})}}}},"@VERSION@",{requires:[]}),YUI.add("math-helper",function(e){e.MathHelper=function(e){return{seedRandom:function(e){return 0+(9301*e+49297)%233280/233280*1}}}},"@VERSION@",{requires:[]}),YUI.add("hermes-template-slim-footer",function(n,e){var i=n.Template.Handlebars.revive({1:function(e,t,n,i,r){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"requiresCookieConsent"):t,{name:"if",hash:{},fn:e.program(2,r,0),inverse:e.program(4,r,0),data:r,loc:{start:{line:12,column:2},end:{line:16,column:9}}}))?r:""},2:function(e,t,n,i,r){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t\t<a class="trustarc-cookie-pref-butt">'+e.escapeExpression((o(n,"intlMessage")||t&&o(t,"intlMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlMessage",hash:{intlName:"policy-terms.COOKIES"},data:r,loc:{start:{line:13,column:40},end:{line:13,column:87}}}))+"</a>\n"},4:function(e,t,n,i,r){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t\t<a href="/help/cookies">'+e.escapeExpression((o(n,"intlMessage")||t&&o(t,"intlMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlMessage",hash:{intlName:"policy-terms.COOKIES"},data:r,loc:{start:{line:15,column:27},end:{line:15,column:74}}}))+"</a>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,r){var o=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,s=e.escapeExpression,l=e.lambda,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="slim-footer">\n\t<a href="/about" data-track="footer-about">'+s((c(n,"intlMessage")||t&&c(t,"intlMessage")||a).call(o,{name:"intlMessage",hash:{intlName:"common.ABOUT"},data:r,loc:{start:{line:2,column:44},end:{line:2,column:83}}}))+'</a>\n\t<a href="/jobs" data-track="footer-jobs">'+s((c(n,"intlMessage")||t&&c(t,"intlMessage")||a).call(o,{name:"intlMessage",hash:{intlName:"common.JOBS"},data:r,loc:{start:{line:3,column:42},end:{line:3,column:80}}}))+'</a>\n\t<a href="//blog.flickr.net/en" data-track="footer-blog">'+s((c(n,"intlMessage")||t&&c(t,"intlMessage")||a).call(o,{name:"intlMessage",hash:{intlName:"common.BLOG"},data:r,loc:{start:{line:4,column:57},end:{line:4,column:95}}}))+'</a>\n\t<a href="/services/developer" data-track="footer-developers">'+s((c(n,"intlMessage")||t&&c(t,"intlMessage")||a).call(o,{name:"intlMessage",hash:{intlName:"common.DEVELOPERS"},data:r,loc:{start:{line:5,column:62},end:{line:5,column:106}}}))+'</a>\n\t<a href="/help/guidelines" data-track="footer-guidelines">'+s((c(n,"intlMessage")||t&&c(t,"intlMessage")||a).call(o,{name:"intlMessage",hash:{intlName:"common.GUIDELINES"},data:r,loc:{start:{line:6,column:59},end:{line:6,column:103}}}))+'</a>\n\t<a href="//help.flickr.com" data-track="footer-help">'+s((c(n,"intlMessage")||t&&c(t,"intlMessage")||a).call(o,{name:"intlMessage",hash:{intlName:"common.HELP"},data:r,loc:{start:{line:7,column:54},end:{line:7,column:92}}}))+'</a>\n\t<a href="/help/forum" data-track="footer-forum">'+s((c(n,"intlMessage")||t&&c(t,"intlMessage")||a).call(o,{name:"intlMessage",hash:{intlName:"common.HELP_FORUM"},data:r,loc:{start:{line:8,column:49},end:{line:8,column:93}}}))+'</a>\n\t<a href="/help/privacy" data-track="footer-privacy">'+s((c(n,"intlMessage")||t&&c(t,"intlMessage")||a).call(o,{name:"intlMessage",hash:{intlName:"common.PRIVACY"},data:r,loc:{start:{line:9,column:53},end:{line:9,column:94}}}))+'</a>\n\t<a href="/help/terms" data-track="footer-terms">'+s((c(n,"intlMessage")||t&&c(t,"intlMessage")||a).call(o,{name:"intlMessage",hash:{intlName:"common.TERMS"},data:r,loc:{start:{line:10,column:49},end:{line:10,column:88}}}))+"</a>\n"+(null!=(r=(c(n,"isFlipped")||t&&c(t,"isFlipped")||a).call(o,"enable-cookie-consent-execution-hermes",{name:"isFlipped",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:11,column:1},end:{line:17,column:15}}}))?r:"")+'\t<div class="foot-li lang-switcher">\n\t\t<a href="/change_language.gne?lang='+s(l(null!=(r=null!=t?c(t,"selectedLang"):t)?c(r,"code"):r,t))+"&csrf="+s(l(null!=(r=null!=t?c(t,"selectedLang"):t)?c(r,"csrf"):r,t))+'" data-track="footer-language">'+s(l(null!=(r=null!=t?c(t,"selectedLang"):t)?c(r,"name"):r,t))+'</a>\n\t\t<div class="arrow">\n\t\t\t<svg class="icon icon-caret-down"><use xlink:href="#icon-caret-down"></use></svg>\n\t\t</div>\n\t </div>\n</div>\n\t\n'},useData:!0}),r={};n.Array.each([],function(e){var t=n.Template.get("hermes/"+e);t&&(r[e]=t)}),n.Template.register("hermes/slim-footer",function(e,t){return(t=t||{}).partials=t.partials?n.merge(r,t.partials):r,i(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]}),YUI.add("footer-helper",function(h,e){require("hermes-core/flog")(e);var d=["en-US","zh-HK","de-DE","es-US","fr-FR","ko-KR","it-IT","pt-BR","vn-VN","id-ID"],p={"en-US":"English","de-DE":"Deutsch","es-US":"EspaÃ±ol","fr-FR":"FranÃ§ais","ko-KR":"í•œê¸€","it-IT":"Italiano","pt-BR":"PortuguÃªs","vn-VN":"Tiáº¿ng Viá»‡t","id-ID":"Bahasa Indonesia","zh-HK":"ç¹é«”ä¸­æ–‡"};h.FooterHelper=function(i,e){var t,n,r,o=[],a=i.lang,s=i.auth&&i.auth.csrf?i.auth.csrf:"";for("vi-vn"===a.toLowerCase()&&(a="vn-VN"),r={code:a,name:p[a],csrf:s},t=0,n=d.length;t<n;t++)d[t]!==a&&"string"==typeof d[t]&&o.push({code:d[t].toLowerCase(),name:p[d[t]],csrf:s});var l=o.map(function(e){return{href:"/change_language.gne?lang="+e.code+"&csrf="+e.csrf,text:e.name}}),c={createDropAround:function(e,t){var n;(n=e.one("a")).addClass("dimmed"),(e=new h.Views.FluidDroparound({appContext:i,showDropArrow:!0,observePageResize:!0,dismissOnOverlayClick:!0,anchorElement:e.one(".arrow"),classList:"lang-droparound",menuItems:l})).show(),t.registerEventHandler(e.on("closeDroparound",function(e){n.removeClass("dimmed")}))},getTemplateParams:function(){return{selectedLang:r,helpLocaleKey:r.code.replace("-","_")||"en_US",menuLangs:o}}};return h.augment(c,h.EventTarget),c}},"@VERSION@",{requires:["dropdown","fluid-droparound-view","event-custom"]}),YUI.add("slim-footer-view",function(t){t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.footerHelper=new t.FooterHelper(this.appContext,{}),this},buildContainer:function(){var e;return this.get("viewer")&&t.merge(this.get("viewer").toJSON(),{urls:t.URLHelper.generatePersonUrls(this.get("viewer"))}),e=this.footerHelper.getTemplateParams(),YUI.Env.isServer?e.pageUrl=this.appContext.request.url:e.pageUrl=window.location.pathname,e.requiresCookieConsent=!0,this.appContext.flipper.isFlipped("enable-geoblock-cookie-consent")&&(e.requiresCookieConsent=this.appContext.requiresCookieConsent),this.setContainerWithTemplate("slim-footer",e),this},activate:function(){var t,n=this,e=this.get("container");return this.registerEventHandler(e.delegate("click",function(e){t=e.target.ancestor(".lang-switcher",!0),e.preventDefault(),n.footerHelper.createDropAround(t,n)},".lang-switcher")),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-slim-footer","url-helper","footer-helper"],langBundles:["common","policy-terms"]}),YUI.add("hermes-lang-policy-terms",function(e,t){e.Intl.add("hermes/policy-terms","en-US",{DOWNLOAD_TERMS_OF_SERVICE:["Download Terms of Service"],DOWNLOAD_PRIVACY_POLICY:["Download Privacy Policy"],DOWNLOAD_API_TERMS:["Download API Terms of Service"],DOWNLOAD_COMMUNITY_GUIDELINES:["Download Community Guidelines"],DOWNLOAD_COOKIE_POLICY:["Download Cookie Policy"],DOWNLOAD_DATA_PROCESSING_POLICY:["Download Data Processing Policy"],POLICIES_AND_GUIDELINES:["Policies & Guidelines"],TERMS:["Terms"],PRIVACY:["Privacy"],API:["API"],COMMUNITY:["Community"],COOKIES:["Cookies"],DATA_PROCESSING:["Data Processing"]})},"@VERSION@",{requires:["intl"]}),YUI.add("global-nav-view",function(a,n){require("hermes-core/flog")(n),a.FlickrView.create(this.name,a.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var t,n,i,r;return void 0===e.enableBrowserUpgradeBanner&&(e.enableBrowserUpgradeBanner=!0),this.set("showBrowserUpgradeBanner",!1),YUI.Env.isServer&&e.enableBrowserUpgradeBanner&&(i=this.appContext.request.headers["user-agent"],t=a.BrowserSupport.isUnsupportedBrowser(i),n=a.BrowserSupport.isBot(i),i=a.BrowserSupport.isSharingBot(i),!t||n||i||this.set("showBrowserUpgradeBanner",!0)),YUI.Env.isServer||(r=a.StorageHelper.getItem("hasDismissedBrowserUpgradeBanner",!0))&&"true"===r&&this.set("showBrowserUpgradeBanner",!1),""===this.get("container").get("innerHTML")&&this.setContainerHTML('<div class="global-nav-content"></div>'),this.appStateParams=e,this.themeClass=e.theme||"default-theme",r=this.appContext.getLocation(),r=e.modelParams&&e.modelParams.apiParams?e.modelParams.apiParams:r.href,this.searchUrl=new a.SearchUrl(r,this.appContext,e.searchType),this.isSOHP=e.isSOHP,this.isProPage=e.isProPage,this.disableMobileNav=e.disableMobileNav,this.hideBanner=e.isSearchResults,this.isRefencingAnnouncementPage=e.isRefencingAnnouncementPage,this.uploadLimitDismissHours=48,this.isDesktopWidthBreakpoint=1080,this.photoPrintsHelper=new a.PhotoPrintsHelper(this.appContext),this.mathHelper=new a.MathHelper,this},subviewConfig:{"search-autosuggest-field-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,isSOHP:this.isSOHP},"account-menu-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"notifications-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.getViewer().signedIn}},"browser-upgrade-banner-view":{requiredToShowOnServer:!0,requiredToShowOnClient:!1,dealbreaker:!1,disabled:function(){return!this.get("showBrowserUpgradeBanner")}},"person-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,containerSelector:"#content",excludeSelectors:[".c-account-menu"],disabled:function(){return!(this.appContext.flipper.isFlipped("enable-hover-account-menu")&&this.appContext.flipper.isFlipped("rebootify-group-discussions-list"))}},"group-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,containerSelector:"#content",excludeSelectors:[".c-account-menu"],disabled:function(){return!(this.appContext.flipper.isFlipped("enable-hover-account-menu")&&this.appContext.flipper.isFlipped("rebootify-group-discussions-list"))}},"partner-account-banner-view":{requiredToShowOnServer:!1,requiredToShowOnClient:!1},"featured-toast-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"slim-footer-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["navbar-footer-placement","mobile-nav-drawer-list"],disabled:function(){return!this.appContext.flipper.isFlipped("enable-cookie-consent-execution-hermes")}}},loadState:function(){var t=this,e=this.appContext.getViewer(),n=[];return e.signedIn?(n.push(this.appContext.getModel("person-models",e.nsid).then(function(e){t.set("viewer",e),t.elementStates=t.setElementStates(t.appStateParams)})),n.push(this.appContext.getModel("person-profile-models",e.nsid).then(function(e){t.profileModel=e}))):this.elementStates=this.setElementStates(this.appStateParams),a.Promise.all(n).then(function(){t.get("viewer"),!YUI.Env.isServer&&t.appContext.flipper.isFlipped("enable-feedback-modal")&&"en-US"===t.appContext.lang&&a.config.flickr&&a.config.flickr.geo&&!localStorage.getItem("feedbackmodalseen4_20")&&"photostream-route"!==this.appContext.routeConfig.module&&(t.meetsFeedbackCriteria=!0)})},buildContainer:function(){var e={},t=this.appContext.getViewer().signedIn;return this.get("viewer")&&(e=a.merge(this.get("viewer").toJSON(),{urls:a.URLHelper.generatePersonUrls(this.get("viewer"))})),e={theme:this.themeClass,disableMobileNav:this.disableMobileNav,"show-browser-upgrade-banner":this.get("showBrowserUpgradeBanner"),showNotificationsMenu:!1,viewer:e,isSignedIn:t,elements:this.elementStates,isRefencingAnnouncementPage:this.isRefencingAnnouncementPage},t&&(e["notifications-menu-view"]=this.subviews["notifications-menu-view"].get("container"),e.showNotificationsMenu=!0),this.photoPrintsHelper.isPrintsEnabled()&&(e.printCartUrl=this.photoPrintsHelper.getCartUrl()),this.setContainerWithTemplate("global-nav",e),this},activate:function(){var r=this,o=(this.appContext.flapp.get("activeView").name,this.get("container")),e=this.appContext.getViewer(),t=o.one(".gn-upload .gn-title");return this.contentContainer=o.one(".global-nav"),o.one(".mobile-nav-toggle")&&(this.navDrawer=o.one(".mobile-nav-drawer"),this.navDrawerOverlay=o.one(".mobile-nav-drawer-overlay"),this.registerEventHandler(o.one(".mobile-nav-toggle").on("click",function(e){r.navDrawerShown?r.hideMobileNavDrawer():r.showMobileNavDrawer()})),this.registerEventHandler(this.navDrawer.delegate("click",this.handleDrawerItemClick.bind(this),".mobile-nav-menu-item"))),o.one(".mobile-search-button")?(this.registerEventHandler(o.one(".mobile-search-button").on("click",function(e){r.contentContainer.addClass("search-open"),r.fire("parentViewEvent","focus-search-field"),o.one(".flickr-logo-container").addClass("hidden")}.bind(this))),this.registerEventHandler(a.on("add-context-to-search-field",function(e){r.contentContainer.addClass("search-open"),r.fire("parentViewEvent","focus-search-field")},this))):this.registerEventHandler(a.globalEvents.subscribe("window:resize",function(e){var t=a.config.win.innerWidth<=this.isDesktopWidthBreakpoint,n=t?this.appContext.viewportData.getWidth():0,i=t?46:0;t||(r.contentContainer.removeClass("search-open"),o.one(".flickr-logo-container").removeClass("hidden")),r.fire("parentViewEvent","resize-search-field",n-i)}.bind(this))),o.one(".mobile-search-close-button")&&this.registerEventHandler(o.one(".mobile-search-close-button").on("click",function(e){r.contentContainer.removeClass("search-open"),o.one(".flickr-logo-container").removeClass("hidden"),r.fire("parentViewEvent","clear-search-field")}.bind(this))),e.signedIn||t&&this.registerEventHandler(t.on("click",this.signUpAndUpload.bind(this))),a.AnchorRepositioner.addOffset(n,o),this.registerEventHandler(o.delegate("keydown",this.toggleSubmenu.bind(this),"a[aria-haspopup=true]")),this.registerEventHandler(o.delegate("keydown",this.enterSubmenu.bind(this),"a[aria-haspopup=true]")),this.registerEventHandler(o.on("keydown",this.goToSubmenuHeading.bind(this),"ul.gn-submenu")),this.registerEventHandler(o.delegate("keydown",this.keyboardNavigation.bind(this),"ul.nav-menu")),this.registerEventHandler(o.delegate("mouseup",this.toggleAriaExpanded.bind(this),"a[aria-haspopup=true]")),this.showFeedbackModal(),this.toastSubview=this.subviews["featured-toast-view"],this.registerEventHandler(a.on("accountCard:overLimitLearnMoreClick",function(){r.showOverLimitToast()})),this.registerEventHandler(a.on("printsPage:choosePhotosClicked",function(){r.handlePrintClick()})),this.photoPrintsHelper.isPrintsEnabled()&&(this.printsButton=o.one(".gn-create .prints-button"),this.mobilePrintsButton=o.one(".mobile-nav-drawer .prints-button"),this.cartLink=o.one(".gn-create .cart-link"),this.mobileCartLink=o.one(".mobile-nav-drawer .cart-link"),this.printsButton&&this.registerEventHandler(this.printsButton.on("click",this.handlePrintClick.bind(this))),this.mobilePrintsButton&&this.registerEventHandler(this.mobilePrintsButton.on("click",this.handlePrintClick.bind(this))),(this.cartLink||this.mobileCartLink)&&(this.photoPrintsHelper.fetchCartCount().then(function(e){var t=e?e.count:0,e=r.intlMessage({intlName:"prints.VIEW_CART_WITH_COUNT",count:void 0!==t?t.toString():"0"});0<t&&(r.cartLink.removeClass("disabled"),r.mobileCartLink.removeClass("disabled")),r.cartLink.set("innerHTML",e),r.mobileCartLink.set("innerHTML",e)}).catch(function(e){var t=r.intlMessage({intlName:"prints.VIEW_CART_WITH_COUNT",count:"0"});r.cartLink.set("innerHTML",t),r.mobileCartLink.set("innerHTML",t)}),this.prepareOrderConfirmationModal())),this.appContext.bannerManager.loadBanners([{type:"loginMigration",priority:2,placement:"header"},{type:"pastDue",priority:1,placement:"header"},{type:"migrateSubscription",priority:0,placement:"header"},{type:"cookieConsent",priority:0,placement:"footer"},{type:"cookie",priority:0,placement:"footer"},{type:"uploadLimit",priority:0,placement:"toast"},{type:"macroExplore",priority:4,placement:"header"}]).then(function(){var e=this.appContext.bannerManager.getBanners(["header","footer"]);(e=0===e.length?this.appContext.bannerManager.getBanners(["toast"]):e).forEach(function(e){return this.appContext.bannerManager.renderBannerView(e)})}),this.registerEventHandler(this.appContext.bannerManager.on("renderBanner",function(e){var n,t,i;return"header"===e.placement?(t=(n=e.bannerView).get("container"),(i=o.one(".nav-banner-container")).empty(),i.appendChild(t),n.on("subviewActivated",function(){a.fire("globalNav:bannerSubviewActivated")}),n.on("dismissed",function(){n.get("container").remove(),n.destroy(),a.fire("globalNav:bannerDismissed")}),n.normalizedActivate()):"toast"===e.placement?(t=(n=e.bannerView).get("container"),n.activate().then(function(){var t=n.subview;r.toastSubview.setup(t.featuredToastConfig),r.toastSubview.on("primaryActionClicked",function(e){t.handleToastPrimaryActionClick(e)}),r.toastSubview.on("secondaryActionClicked",function(e){t.handleToastSecondaryActionClick(e)}),n.on("dismissed",function(){r.toastSubview.dismiss()}),r.toastSubview.show()})):void 0})),this.appContext.flipper.isFlipped("enable-photo-limit-pro-redir")&&e.signedIn&&"en-us"===this.appContext.lang.toLowerCase()&&a.UserLimitsHelper.isOverARRLimit(this.profileModel,this.appContext)&&!this.appContext.getCookie(a.config.flickr.upload_blocking.photo_limit_pro_redir_cookie_name)&&(this.setProRedirectCookie(),this.appContext.flapp.navigate(a.config.flickr.upload_blocking.photo_limit_pro_redir_url)),this},showFeedbackModal:function(){var c=this,e=a.QueryString.parse(a.config.win.location.search.replace("?","")),t=a.config.win.location.href;if(c.appContext.flipper.isFlipped("enable-feedback-modal")&&e&&void 0!==e.survey&&(t=t.replace("?survey",""),a.config.win.history.replaceState({},"",t),this.meetsFeedbackCriteria=!0),this.meetsFeedbackCriteria){var h,n=this.templates("feedback-modal-view")({}),t=[];return this.appContext.getViewer().signedIn&&(this.get("viewer").getValue("isPro")&&t.push(this.appContext.getModel("person-proStatus-models",c.get("viewer").id).then(function(e){c.proStatusModel=e,e.toJSON().firstStart,new Date("November 1, 2018").getTime()})),t.push(this.appContext.getModel("person-profile-models",c.get("viewer").id).then(function(e){c.profileModel=e}))),a.Promise.all(t).then(function(){var l;(l=new a.Views.FluidModal({appContext:c.appContext,noScroll:!0,hideModalOverlay:!1,maxHeight:!1,showFooter:!1,classList:"modal-restyle",width:560,htmlMessage:n})).show(),l.on("activated",function(){h=l.get("container").one(".accept-button"),l.get("container").one(".cancel-button").on("click",function(e){l.close()}),h.on("click",function(e){var t,n,i,r,o="https://selfserve.decipherinc.com/survey/selfserve/2225/200401?list=3",a="no",s=c.appContext.getViewer().signedIn?"yes":"no";h.setAttribute("disabled"),c.appContext.getViewer().signedIn&&(n=c.appContext.getViewer().nsid,t=c.get("viewer").getValue("isPro")?"pro":"free",r=c.get("viewer").getValue("dateCreated").year()),c.proStatusModel&&(a=0<1e3*c.proStatusModel.toJSON().firstStart-new Date("November 1, 2018").getTime()?"yes":"no"),(i=c.profileModel?c.profileModel.getValue("photoCount"):i)&&(o+="&nop="+encodeURIComponent(i)),t&&(o+="&at="+encodeURIComponent(t)),a&&(o+="&np="+encodeURIComponent(a)),r&&(o+="&y="+encodeURIComponent(r)),n&&(o+="&id="+encodeURIComponent(n)),s&&(o+="&li="+encodeURIComponent(s)),window.open(o,"_blank"),l.close()})}),l.on("close",function(){localStorage.setItem("feedbackmodalseen4_20",!0)})})}},clearKeyboardFocus:function(e){this.get("container").all(".has-keyboard-focus").removeClass("has-keyboard-focus"),this.get("container").all(".nav-menu a[aria-expanded=true]").setAttribute("aria-expanded","false")},toggleAriaExpanded:function(e){e.target.setAttribute("aria-expanded","false"===e.target.getAttribute("aria-expanded")?"true":"false")},enterSubmenu:function(e){40===e.keyCode&&(e.preventDefault(),(e=e.target.next("ul"))&&e.hasClass("has-keyboard-focus")&&e.one(":first-child").one(":first-child").focus())},toggleSubmenu:function(e){var t=e.keyCode;13!==t&&32!==t||(e.preventDefault(),(t=e.target.next("ul"))&&(t.hasClass("has-keyboard-focus")?this.clearKeyboardFocus():(t.addClass("has-keyboard-focus"),e.target.setAttribute("aria-expanded","true"))))},goToSubmenuHeading:function(e,t){var n;!t&&27!==e.keyCode||(t||this.clearKeyboardFocus(),e.target.hasClass("gn-submenu")?n=e.target.previous("a"):e.target.ancestor("ul.gn-submenu")&&(n=e.target.ancestor("ul.gn-submenu").previous("a")),n&&n.focus())},keyboardNavigation:function(e){var t=e.keyCode,n=9===t&&e.shiftKey,i=9===t&&!e.shiftKey;e.target.hasClass("gn-title")?(n=(37===t||n)&&e.target.ancestor("li").previous("li"),i=(39===t||i)&&!!e.target.ancestor("li").next("li"),n?(this.clearKeyboardFocus(),this.focusOnPreviousItem(e)):!i||e.target.next("ul")&&e.target.next("ul").hasClass("has-keyboard-focus")||(this.clearKeyboardFocus(),this.focusOnNextItem(e))):38===t||n?this.focusOnPreviousItem(e):40!==t&&!i||this.focusOnNextItem(e)},focusOnPreviousItem:function(e){e.preventDefault();var t=e.target.ancestor("li").previous("li:not(.divider)");t?t.one(":first-child").focus():e.target.ancestor("ul.gn-submenu")&&this.goToSubmenuHeading(e,!0)},focusOnNextItem:function(e){e.preventDefault();e=e.target.ancestor("li").next("li:not(.divider)");e&&e.one(":first-child").focus()},signUpAndUpload:function(e){var t=a.url("/upload/"),n=this.intlMessage({intlName:"global-nav.UPLOAD_MODAL_SIGNUP_TITLE"});e.halt(),a.rapidTracker.beacon(this.name,"uploadButtonClick"),(n=new a.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-upload",signUpTitle:n,beaconPrefix:"upload"})).on("signUpClick",function(e){a.SigninHelper._redirectToSignUp("upload",{postLoginUrl:t})}),n.on("signInClick",function(e){a.SigninHelper._redirectToSignin("upload",{postLoginUrl:t})}),n.show()},executeSearch:function(e){var t=this.get("container").one("#gn-search-field").getDOMNode(),t=this.searchUrl.createNewSearch(t.value).getURL();e.halt(),this.appContext.flapp.navigate(t)},setElementStates:function(e){var t=this.appContext.getViewer(),n=e.isSOHP&&!t.signedIn,i=e.isProPage,e={you_link:!1,you_menu:!1,contacts_menu:!1,groups_menu:!1,explore_menu:!1,weekly_flickr:!1,flickr_shorts:!1,get_pro_link:!0,upload_icon:!1,account_menu:!1,search_bar:!1,signup_link:!1,signin_link:!1,right_side_signup:!0,vr_link:!0,sidebar_signin_link:!1};return n?(e.search_bar=!0,e.signin_link=!0,e.signup_link=!0,e.get_pro_link=!1):i?(e.you_menu=!1,e.explore_menu=!1,e.upload_icon=!1,e.search_bar=!1,e.account_menu=!0,e.get_pro_link=!1):t.signedIn?(e.you_menu=!0,e.explore_menu=!0,e.upload_icon=!0,e.search_bar=!0,e.account_menu=!0):(e.signup_link=!0,e.explore_menu=!0,e.upload_icon=!0,e.search_bar=!0,e.signin_link=!0),this.get("viewer")&&this.get("viewer").getValue("isPro")&&(e.stats=!0,e.get_pro_link=!1),"en-us"===this.appContext.lang.toLowerCase()&&(e.weekly_flickr=!0,e.flickr_shorts=!0),i||n||(e.prints_menu=!0),this.appContext.flipper.isFlipped("enable-events-page")&&(e.events_link=!0,e.weekly_flickr=!1,e.vr_link=!1),this.isSOHP||t.signedIn||(e.sidebar_signin_link=!0),e},isExpiringPartnerAccount:function(){var e=this.get("viewer").getValue("expiringPartner");return this.appContext.flipper.isFlipped("enable-partner-account-banner")&&e&&-1===["embedr-route","browser-upgrade-interstitial-route","products-marketplace-eol-route","products-account-payouts-route","error-route"].indexOf(this.appContext.routeConfig.module)},handleToastActionClick:function(e){e=e&&e.clickEvent?e.clickEvent.target.getAttribute("href"):null;e?a.config.win.location.href=e:this.toastSubview.dismiss()},setProRedirectCookie:function(){var e=new Date;e.setTime(e.getTime()+60*a.config.flickr.upload_blocking.photo_limit_pro_redir_cookie_hours*60*1e3),this.appContext.setCookie({cookieName:a.config.flickr.upload_blocking.photo_limit_pro_redir_cookie_name,cookieValue:1,expires:e,path:"/"})},showOverLimitToast:function(){this.toastSubview&&this.appContext.flipper.isFlipped("enable-upload-limit-messages")&&a.UserLimitsHelper.isOverARRLimit(this.profileModel,this.appContext)&&(this.toastSubview.setup({htmlContent:this.templates("upload-limit-message")({title:this.intlMessage({intlName:"upload-blocking.OVER_UPLOAD_LIMIT_HEAD_FINAL"}),description:this.intlMessage({intlName:"upload-blocking.OVER_UPLOAD_LIMIT_COPY_FINAL",limitCount:a.config.flickr.account.photo_limit.toLocaleString(this.appContext.lang,{maximumFractionDigits:0})}),primaryActionText:this.intlMessage({intlName:"common.GET_PRO"}),secondaryActionText:this.intlMessage({intlName:"common.DISMISS"})}),classList:["urgent"]}),this.toastSubview.on("primaryActionClicked",this.handleToastActionClick.bind(this)),this.toastSubview.on("secondaryActionClicked",this.handleToastActionClick.bind(this)),this.toastSubview.show())},handlePrintClick:function(){"en-us"===this.appContext.lang.toLowerCase()?this.appContext.getCookie(a.config.flickr.flickrprints.dismiss_intro_to_prints_cookie_name)?this.showPrintSelector():this.showIntroToPrintsModal():this.showEnglishPrintWarningModal()},showPrintSelector:function(){var t=this,n=this.intlMessage({intlName:"prints.CHOOSE_PHOTO_TO_GET_PRINTS"}),e=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],i=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],r=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"}],o={appContext:this.appContext,searchable:{yours:!0,contacts:!1,everyone:!1,marketplace:!1}};this.printSelector=new a.Views["photo-selector-view"](o),this.printSelectorModal=new a.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:"",navBarView:new a.Views["fluid-modal-nav-bar-view"]({appContext:this.appContext,links:e,enableSearch:!0,breakpointConfig:[{maxWidth:700,links:i,enableSearch:!1},{maxWidth:500,links:r,enableSearch:!1}]}),actionButtonLabel:this.intlMessage({intlName:"prints.BUY_PRINTS"}),actionButtonDisabled:!0,subview:this.printSelector,width:Math.round(.8*Math.max(1280,a.config.win.innerWidth)),height:Math.round(a.config.win.innerHeight-60),fullWindow:!0,classList:"photo-selector",hideModalOverlay:!1,buttonFlavorText:n,flexLayout:!0}),this.printSelectorModal.show(),this.printSelectorModal.registerEventHandler(a.on("photoSelector:selected",function(e){t.printSelectorModal.enableActionButton(),t.printSelectorModal.setFlavorText(n)})),this.printSelectorModal.registerEventHandler(a.on("photoSelector:unselected",function(e){t.printSelectorModal.disableActionButton()})),this.printSelectorModal.on("actionClick",this.handleBuyPrintClick.bind(t))},handleBuyPrintClick:function(){var t=this,e=this.printSelector.get("selected");a.config.win.location.href,this.printSelectorModal.disableActionButton(!0),this.appContext.getModel("photo-models",e).then(function(e){return t.photoPrintsHelper.canPrintPhoto(e)?t.photoPrintsHelper.registerPrint(e,a.config.win.location.href):a.Promise.reject({message:"Error: Canâ€™t print photo."})}).then(function(e){a.config.win.location.href=e.redirectURL}).catch(function(e){t.printSelectorModal.enableActionButton(),t.printSelectorModal.setFlavorText(e.message||t.intlMessage({intlName:"prints.SOMETHING_WRONG_PREPARING_PRINT"}),!0)})},showEnglishPrintWarningModal:function(e){var t=this;this.englishPrintWarningModal=new a.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,showActionButton:!0,actionButtonLabel:this.intlMessage({intlName:"prints.CONTINUE_IN_ENGLISH"}),showCancelButton:!0,cancelButtonLabel:"en-us"===this.appContext.lang.toLowerCase()?this.intlMessage({intlName:"common.GO_BACK_BUTTON"}):this.intlMessage({intlName:"common.CANCEL"}),showCancelX:!1,showHeader:!0,showFooter:!0,title:this.intlMessage({intlName:"prints.ENGLISH_LANGUAGE_AHEAD"}),message:this.intlMessage({intlName:"prints.ORDERING_IS_ENGLISH_ONLY"}),hideModalOverlay:!1}),this.englishPrintWarningModal.show(),this.englishPrintWarningModal.on("actionClick",function(){setTimeout(function(){t.appContext.getCookie(a.config.flickr.flickrprints.dismiss_intro_to_prints_cookie_name)?t.showPrintSelector():t.showIntroToPrintsModal()},0)}),this.englishPrintWarningModal.on("close",function(){})},handleDrawerPageMouseDown:function(e){e=e.target;e.ancestor(".mobile-nav-drawer",!0)||e.ancestor(".mobile-nav-toggle",!0)||this.hideMobileNavDrawer()},handleDrawerItemClick:function(e){this.hideMobileNavDrawer()},showMobileNavDrawer:function(){var e=this;this.get("container"),this.contentContainer.addClass("drawer-open"),this.navDrawerShown=!0,this.navDrawer.addClass("shown"),a.fire("globalNav:navDrawerOpen"),clearTimeout(this.navDrawerOverlayHideTimeout),this.navDrawerOverlay&&(this.navDrawerOverlay.addClass("displayed"),setTimeout(function(){e.navDrawerOverlay.addClass("shown")},10)),this.drawerPageClickHandler||setTimeout(function(){e.drawerPageClickHandler=a.on(["mousedown","touchstart"],e.handleDrawerPageMouseDown.bind(e)),e.registerEventHandler(e.drawerPageClickHandler)},10)},hideMobileNavDrawer:function(){var e=this;this.get("container"),this.contentContainer.removeClass("drawer-open"),this.navDrawerShown=!1,this.navDrawer.removeClass("shown"),a.fire("globalNav:navDrawerClosed"),this.navDrawerOverlay&&(this.navDrawerOverlay.removeClass("shown"),this.navDrawerOverlayHideTimeout=setTimeout(function(){e.navDrawerOverlay.removeClass("displayed")},500)),this.drawerPageClickHandler&&(this.detachRegisteredEvent(this.drawerPageClickHandler),this.drawerPageClickHandler=void 0)},prepareOrderConfirmationModal:function(){var t=this,e=a.QueryString.parse(a.config.win.location.search.replace("?",""));a.config.win.location.href,this.photoPrintsHelper.isPrintsEnabled()&&e&&void 0!==e.OrderID&&(e=e.OrderID,this.photoPrintsHelper.fetchOrder(e).then(function(e){t.showOrderConfirmationModal({orderId:e.orderId,orderUrl:e.orderUrl,email:e.email})}).catch(function(e){t.showOrderConfirmationModal({})}))},showOrderConfirmationModal:function(e){var t=this,e=this.templates("print-order-confirmation")({orderNum:e.orderId,orderUrl:e.orderUrl,email:e.email,helpUrl:"https://help.flickr.com/",feedbackUrl:"/help/forum"}),n=new a.Views.FluidModal({appContext:this.appContext,noScroll:!0,hideModalOverlay:!1,maxHeight:!1,showHeader:!1,showFooter:!1,showCancelX:!1,width:460,htmlMessage:e});n.show(),n.on("activated",function(){t.registerEventHandler(n.get("container").one("button.accept-button").on("click",function(){n.close()}))})},showIntroToPrintsModal:function(){var t=this,e=this.templates("intro-to-prints")({}),n=new a.Views.FluidModal({appContext:this.appContext,noScroll:!0,hideModalOverlay:!1,dismissOnOverlayClick:!0,maxHeight:!1,showHeader:!1,showFooter:!1,width:450,contentPadding:0,showCancelX:!0,htmlMessage:e});n.show(),n.on("activated",function(){n.get("container").one(".accept-button").on("click",function(e){n.close()})}),n.on("close",function(){var e=new Date;e.setTime(e.getTime()+36e10),t.appContext.setCookie({cookieName:a.config.flickr.flickrprints.dismiss_intro_to_prints_cookie_name,cookieValue:1,expires:e,path:"/"}),setTimeout(function(){t.showPrintSelector()},0)})},destructor:function(){a.AnchorRepositioner.removeOffset(n)}})},"@VERSION@",{requires:["flickr-view","hermes-template-global-nav","hermes-template-feedback-modal-view","hermes-template-upload-limit-message","hermes-template-print-order-confirmation","hermes-template-intro-to-prints","search-url","search-autosuggest-field-view","querystring-parse-simple","querystring-stringify-simple","notifications-menu-view","url-helper","person-menu-view","group-menu-view","browser-support","fluid-modal-view","signup-modal-view","signin-helper","storage-helper","partner-account-banner-view","featured-toast-view","user-limits-helper","photo-selector-view","fluid-modal-nav-bar-view","banner-view","photo-prints-helper","math-helper","slim-footer-view"],langBundles:["global-nav","common","search","upload-blocking","prints","blurb","thanks"]}),YUI.add("hermes-lang-global-nav",function(e,t){e.Intl.add("hermes/global-nav","en-US",{FLICKR_LOGO_ALT:["Flickr logo. If you click it, you'll go home"],YOUR_PHOTOSTREAM:["Your Photostream"],FOLLOWING:["Following"],PHOTOS_OF:["Photos of"],PHOTOS_FROM:["Photos from"],LIST:["List"],COMMUNITIES:["Communities"],GROUPS_LIST:["Groups List"],SEARCH_GROUPS:["Search Groups"],RECENT_DISCUSSIONS:["Recent Discussions"],CREATE_A_GROUP:["Create a Group"],RECENT_PHOTOS:["Recent Photos"],THE_COMMONS:["The Commons"],GETTY_COLLECTION:["Getty Collection"],GALLERIES:["Galleries"],FLICKR_GALLERIES:["Flickr Galleries"],WORLD_MAP:["World Map"],APP_GARDEN:["App Garden"],THE_WEEKLY_FLICKR:["The Weekly Flickr"],FLICKR_BLOG:["Flickr Blog"],UPLOAD:["Upload"],SIGN_IN:["Sign In"],SEARCH:["Search"],CAMERA_FINDER:["Camera Finder"],RECENT_ACTIVITY:["Recent Activity"],STATS:["Stats"],ORGANIZE:["Organize"],CREATIONS:["Creations"],FIND_FRIENDS:["Find Friends"],GROUPS:["Groups"],PEOPLE:["People"],CAMERAROLL:["Camera Roll"],CREATE:["Create"],CREATE_NEW:["New Creation"],CREATE_MY_WALLART:["My Wall Art"],CREATE_MY_PHOTOS_BOOKS:["My Photo Books"],CREATE_ORDER_HISTORY:["My Order History"],UPLOAD_MODAL_SIGNUP_TITLE:["Upload your photos securely and privately!"],UPLOAD_MODAL_SIGNUP_MESSAGE:["Join Flickr to unlock 1,000GB of free photo storage."],HOME:["Home"],LOG_IN:["Log In"]})},"@VERSION@",{requires:["intl"]});
