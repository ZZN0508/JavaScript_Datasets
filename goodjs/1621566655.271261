define(["module","OK/logger","OK/utils/vanilla"],(function(e,t,n){"use strict";var r,s={},u=[],i={},o="$Hash$",a=e.config().timeout||3e5;function h(e){var t=s[e];return t&&0!==Object.keys(t).length||!OK.fn.isDebug()||console.error('РџР°РєРµС‚ "'+e+'" РѕС‚СЃСѓС‚СЃС‚РІСѓРµС‚. РќР°РІРµСЂРЅРѕ, РЅРµ СѓРґР°Р»РѕСЃСЊ Р·Р°РіСЂСѓР·РёС‚СЊ'),s[e]}function f(e,t){return s[e]=new c(e,t),function(e){for(var t=i[e]||[],n=t.length;n--;)t[n]()}(e),h(e)}function c(e,t){this.pkg=e,this.messages=t,this.parsedResources={}}function g(e){this.text=e}function l(e){this.argName=e}function p(e,t){this.argName=e,this.values=t}function v(e,t){this.argName=e,this.values=t}function d(e){return(e=Math.abs(e))%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2}function w(e){return 1===e?0:1}function b(e){return 0}c.prototype={has:function(e){return this.messages.hasOwnProperty(e)},getLMsg:function(e,n){if(!e&&!n)return this.messages;var r=this.messages[e];if("string"!=typeof r)return t.success("pts.miss",this.pkg,e),this.pkg+"."+e;if(n){var s=this.parsedResources[e];return s||(s=function(e){for(var t=[],n=0;;){var r=k(t,e,n);if(r===e.length)break;n===r&&r++,n=r}return R(t)}(r),this.parsedResources[e]=s),s.getResource(n)}return r},subscribe:function(e){var t=this.pkg;i[t]||(i[t]=[]),i[t].push(e)}},g.prototype.getResource=function(){return n.encodeHtml(this.text)},l.prototype.getResource=function(e){var t=e[this.argName];return t||0===t?t:""},p.prototype.getResource=function(e){var t=e[this.argName],n=t;"Plural"===this.argName.substr(-"Plural".length)&&(n=m.getIndex(t));var r=this.values[n];return r?r.getResource(e):""},v.prototype.getResource=function(e){var t=e[this.argName],n=this.values[t];return n?n.getResource(e):""};var m={ru:d,uk:d,en:w,hy:w,mo:w,ro:w,de:w,uz:b,az:b,kk:b,ka:b,ky:b,tg:b,tr:b,getIndex:function(e){var t=document.body.parentElement.getAttribute("lang"),n=m[t];return n||(n=d),n(e)}};function y(e){this.children=e}function k(e,t,n){var r,s;if(-1===(r=O(t,n,"|[]")))return-1===(r=O(t,n,"]"))?(e.push(new g(t.substr(n))),t.length):(e.push(new g(t.substr(n,r-n))),r);if(r>n)return e.push(new g(t.substr(n,r-n))),r;if("["===t[r]){if(-1===(r=O(t,n=r+1,":?]")))return n--,e.push(new g(t.substr(n))),t.length;var u=(s=t.substr(n,r-n))?s.replace(/^\s+|\s+$/gm,""):"";if("]"===t[r])return e.push(new l(u)),r+1;var i=t[r],o="?"===i,a=o?{}:[];if("?"!==i&&":"!==i)return r=O(t,n,"]"),e.push(new g(t.substr(n-1,r))),t.length;for(;;){n=r+1;var h,f=[];if(o){if(!((r=O(t,n,"="))>n))return r=O(t,n,"]"),e.push(new g(t.substr(n,r))),t.length;h=t.substr(n,r-n),n=r+1}for(;(r=k(f,t,n))!==t.length&&("|"!==t[r]&&"]"!==t[r]);)n==r&&r++,n=r;if(o?a[h]=R(f):a.push(R(f)),r===t.length||"]"===t[r])break}return o?e.push(new v(u,a)):e.push(new p(u,a)),r===t.length?t.length:r+1}return r}function R(e){return 0===e.length?new g(""):1===e.length?e[0]:new y(e)}function O(e,t,n){for(var r=t;r<e.length;r++)for(var s=0;s<n.length;s++)if(n[s]===e[r])return r;return-1}function N(){for(var e,t=[],n=0,r=u.length;n<r;n+=1){var s=h(e=u[n]);t.push({pkg:e,hash:s&&s.messages[o]||"0"})}return JSON.stringify(t)}function x(){n.ajax({url:"/web-api/upts",headers:{"Content-Type":"application/json"},data:N(),dataType:"json"}).then((function(e){for(var t,n=e.response,r=Object.keys(n),s=0,u=r.length;s<u;s+=1)f(t=r[s],n[t])}))}function P(e){e&&(-1===u.indexOf(e)&&u.push(e),!r&&a>0&&(r=window.setInterval(x,a)))}if(y.prototype.getResource=function(e){for(var t="",n=0;n<this.children.length;n++)t+=this.children[n].getResource(e);return t},"undefined"!=typeof window&&(window.l10n={getPkg:function(e){return P(e),h(e)}},void 0!==window.inline_resources&&void 0!==window.inline_resources.pts)){for(var j in window.inline_resources.pts)f(j,window.inline_resources.pts[j]),P(j);window.inline_resources.pts={}}return{load:function(e,t,n,r){r.isBuild?n():!function(e){return s.hasOwnProperty(e)}(e)?t(["PTS/"+e],(function(t){f(e,t),n(h(e))})):n(h(e))}}}));