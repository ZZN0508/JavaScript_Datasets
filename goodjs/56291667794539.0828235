define("bagsdk/global",[],function(){return window}),define("bagsdk/utils/getInstanceEventBus",["jquery"],function(t){return"function"==typeof t?t({}):void 0}),define("bagsdk/utils/sdkInstanceAsyncLoader",["bagsdk/utils/getInstanceEventBus"],function(r){var t={load:function(t,e,i,n){return n.isBuild?void i(t):(r.bagSdkInstantiated&&i(t),void r.on("bagSdk:instanceReady",function(){i(t)}))}};return t}),define("Asos.Commerce.Bag.Sdk",["bagsdk/global","bagsdk/utils/sdkInstanceAsyncLoader!dummyModuleName"],function(t){return["asos","commerce","_bagSdkInstance"].reduce(function(t,e){return void 0!==t?t[e]:void 0},t)}),define("bagsdk/config/configuration",[],function(){return{}}),define("bagsdk/config/defaultConfiguration",["bagsdk/global"],function(t){var e="https://"+t.location.hostname+"/bag/gateway/",i="https://"+t.location.hostname+"/api";return{postMessageUrl:e,bagApiUrl:i,paymentOptionsApiUrl:i,productCatalogueApiUrl:"http://"+t.location.hostname+"/api",subscriptionOptionsApiUrl:i,xSiteOrigin:null}}),define("bagsdk/config/currencies",[],function(){return{"COM:GBP":"£0.00","COM:USD":"$0.00","COM:CAD":"C$0.00","COM:SEK":"SEK0.00","COM:NOK":"NOK0.00","COM:DKK":"DKK0.00","COM:CHF":"CHF0.00","COM:EUR":"€0.00","COM:AUD":"$0.00","COM:RMB":"¥0.00","COM:HKD":"HKD$0.00","COM:NZD":"NZD$0.00","COM:SGD":"SGD$0.00","COM:TWD":"NT$0.00","COM:RUB":"руб. 0.00","US:GBP":"£0.00","US:USD":"$0.00","US:CAD":"C$0.00","US:SEK":"SEK0.00","US:NOK":"NOK0.00","US:DKK":"DKK0.00","US:CHF":"CHF0.00","US:EUR":"€0.00","US:AUD":"$0.00","US:RMB":"¥0.00","US:HKD":"HKD$0.00","US:NZD":"NZD$0.00","US:SGD":"SGD$0.00","US:TWD":"NT$0.00","US:RUB":"руб. 0.00","FR:GBP":"0,00 £","FR:USD":"0,00 $","FR:CAD":"0,00 C$","FR:SEK":"0,00 SEK","FR:NOK":"0,00 NOK","FR:DKK":"0,00 DKK","FR:CHF":"0,00 CHF","FR:EUR":"0,00 €","FR:AUD":"0,00 $","FR:RMB":"0,00 ¥","FR:HKD":"0,00 HKD$","FR:NZD":"0,00 NZD$","FR:SGD":"0,00 SGD$","FR:TWD":"0,00 NT$","FR:RUB":"0,00 руб.","DE:GBP":"0,00 £","DE:USD":"0,00 $","DE:CAD":"0,00 C$","DE:SEK":"0,00 SEK","DE:NOK":"0,00 NOK","DE:DKK":"0,00 DKK","DE:CHF":"0,00 CHF","DE:EUR":"0,00 €","DE:AUD":"0,00 $","DE:RMB":"0,00 ¥","DE:HKD":"0,00 HKD$","DE:NZD":"0,00 NZD$","DE:SGD":"0,00 SGD$","DE:TWD":"0,00 NT$","DE:RUB":"0,00 руб.","IT:GBP":"£ 0,00","IT:USD":"$ 0,00","IT:CAD":"C$ 0,00","IT:SEK":"SEK 0,00","IT:NOK":"NOK 0,00","IT:DKK":"DKK 0,00","IT:CHF":"CHF 0,00","IT:EUR":"€ 0,00","IT:AUD":"$ 0,00","IT:RMB":"¥ 0,00","IT:HKD":"HKD$ 0,00","IT:NZD":"NZD$ 0,00","IT:SGD":"SGD$ 0,00","IT:TWD":"NT$ 0,00","IT:RUB":"руб. 0,00","ES:GBP":"0,00 £","ES:USD":"0,00 $","ES:CAD":"0,00 C$","ES:SEK":"0,00 SEK","ES:NOK":"0,00 NOK","ES:DKK":"0,00 DKK","ES:CHF":"0,00 CHF","ES:EUR":"0,00 €","ES:AUD":"0,00 $","ES:RMB":"0,00 ¥","ES:HKD":"0,00 HKD$","ES:NZD":"0,00 NZD$","ES:SGD":"0,00 SGD$","ES:TWD":"0,00 NT$","ES:RUB":"0,00 руб.","AU:GBP":"£0.00","AU:USD":"$0.00","AU:CAD":"C$0.00","AU:SEK":"SEK0.00","AU:NOK":"NOK0.00","AU:DKK":"DKK0.00","AU:CHF":"CHF0.00","AU:EUR":"€0.00","AU:AUD":"$0.00","AU:RMB":"¥0.00","AU:HKD":"HKD$0.00","AU:NZD":"NZD$0.00","AU:SGD":"SGD$0.00","AU:TWD":"NT$0.00","AU:RUB":"руб. 0.00","RU:GBP":"0,00£","RU:USD":"0,00$","RU:CAD":"0,00C$","RU:SEK":"0,00SEK","RU:NOK":"0,00NOK","RU:DKK":"0,00DKK","RU:CHF":"0,00CHF","RU:EUR":"0,00€","RU:AUD":"0,00$","RU:RMB":"0,00¥","RU:HKD":"0,00HKD$","RU:NZD":"0,00NZD$","RU:SGD":"0,00SGD$","RU:TWD":"0,00NT$","RU:RUB":"0,00 руб."}}),define("bagsdk/models/SimpleXhrResponseWrapper",[],function(){function t(t,e,i){this.responseText=t||"",this.status=e,this._responseHeaders=this._parseHeaders(i)}return t.prototype._parseHeaders=function(t){var e={};if(!t||"string"!=typeof t)return e;for(var i,n,r=t.split("\r\n"),o=r.length;o--;)0<r[o].indexOf(": ")&&(i=(n=r[o].split(": "))[0],n=n[1],e[i]=n);return e},t.prototype.getResponseHeader=function(t){return this._responseHeaders.hasOwnProperty(t)?this._responseHeaders[t]:null},t}),define("bagsdk/models/apiService",["jquery","uuid","bagsdk/config/configuration","bagsdk/global","bagsdk/models/SimpleXhrResponseWrapper"],function(a,n,r,o,s){function t(t){var e;this.defaultOptions={contentType:"application/json",dataType:"json",headers:{"asos-c-plat":"Web","asos-c-name":"Asos.Commerce.Bag.Sdk","asos-c-ver":"5.1.0","asos-c-istablet":!1,"asos-c-ismobile":!1}},a.extend(!0,this.defaultOptions,t),this.isCorsSupported()||((e=o.document.createElement("a")).href=r.postMessageUrl,this.gatewayOrigin=e.protocol+"//"+e.hostname,"https:"===(t=e).protocol&&"443"===t.port||"http:"===t.protocol&&"80"===t.port||(this.gatewayOrigin+=":"+e.port),this.postMessageInitiator="BagSdk",0===(i=a('iframe[src="'+r.postMessageUrl+'"]')).length&&(i=a("<iframe>").attr("src",r.postMessageUrl).appendTo(o.document.body).css("display","none")),u=i.get(0).contentWindow,o.addEventListener?o.addEventListener("message",this.postMessageTransportEventHandler.bind(this),!1):o.attachEvent&&o.attachEvent("onmessage",this.postMessageTransportEventHandler.bind(this)))}function c(t){return null==t?"":t.join(":::")}var i,u,d=0;return t.prototype.isCorsSupported=function(){return"XMLHttpRequest"in o&&"withCredentials"in new XMLHttpRequest},t.prototype.setupRequestAjaxOptions=function(t,e,i){return t=a.extend(!0,{url:"",headers:{"asos-cid":n()}},this.defaultOptions,t||{}),r.xSiteOrigin&&e.withParam("x-site-origin",r.xSiteOrigin),t.type=e.method.toUpperCase(),t.url+=e.path,"object"==typeof i&&Object.keys(i).length&&(t.data=JSON.stringify(i)),t},t.prototype.successfulResponseHandler=function(t){return t},t.prototype.failedResponseHandler=function(t){var e=t.getResponseHeader("content-type")||t.getResponseHeader("Content-Type");return 401===t.status||403===t.status?[{errorCode:"BagDoesNotExist"}]:e&&-1!==e.indexOf("json")?JSON.parse(t.responseText):e&&-1!==e.indexOf("plain")&&t.responseText?t.responseText:""},t.prototype.jQueryTransport=function(i){return new Promise(function(t,e){a.ajax(i).done(function(){t(this.successfulResponseHandler.apply(this,arguments))}.bind(this)).fail(function(){e(this.failedResponseHandler.apply(this,arguments))}.bind(this))}.bind(this))},t.prototype.postMessageTransport=function(e){return new Promise(function(n,r){a(this).on(c(["postMessageResolution",d]),function(t,e,i){a(this).off(c(["postMessageResolution",t])),i.success?n(this.successfulResponseHandler.call(this,i.data,"success",i.response)):r(this.failedResponseHandler.call(this,i.response))}.bind(this,d));var t=c([d,this.postMessageInitiator,JSON.stringify(e)]);this.postMessageSend(t),d++}.bind(this))},t.prototype.postMessageSend=function(t){u?u.postMessage(t,r.postMessageUrl):a(i).on("load",function(){(u=i.get(0).contentWindow).postMessage(t,r.postMessageUrl)})},t.prototype.postMessageTransportEventHandler=function(t){if(t.origin===this.gatewayOrigin){var e,i,n=(t.data||"").split(":::"),r=parseInt(n[0],10),t=parseInt(n[1],10);if(n[2]===this.postMessageInitiator){try{e=JSON.parse(n[3]),o=n[4],i=parseInt(n[5],10)}catch(t){e=""}var o=new s(n[3],i,o);a(this).trigger(c(["postMessageResolution",r]),{data:e,success:t,response:o})}}},t.prototype.request=function(t,e,i){var n=this.setupRequestAjaxOptions(i,t,e),i=o.document.createElement("a");i.href=n.url;t=i.hostname===o.location.hostname,e=i.protocol===o.location.protocol,i=n.url&&n.url.length&&"/"===n.url[0];return o.newrelic&&o.newrelic.interaction().save(),i||t&&e||this.isCorsSupported()?this.jQueryTransport(n):this.postMessageTransport(n)},t}),define("bagsdk/services/identityService",["require","asos.identity.events","asos.identity.sdk.supportedEventTypes"],function(t,e,i){function n(){return new Promise(function(e){t(["Asos.Identity.Web.ClientSdk"],function(t){e(t)})})}return{customerGuid:function(){return n().then(function(t){return t.customer.customerGuid()})},customerId:function(){return n().then(function(t){return t.customer.customerId()})},getAccessToken:function(){return n().then(function(t){return t.getAccessToken()})},onSessionEnded:function(t){e.subscribe(i.onSessionEnded,t)},onLoggedIn:function(t){e.subscribe(i.onLoggedIn,t)},persistentId:function(){return n().then(function(i){return i.ready().then(function(e){return i.customer.profile().then(function(t){return void 0===t||t.isAnonymous?i.customer.customerGuid():t.customerAid||e._oidcTokenManager._token.profile.aid})})})}}}),define("bagsdk/exceptions/bagSdkException",[],function(){function e(t,e){return!!Array.isArray(t)&&t.some(function(t){return t.errorCode===e})}function t(t){this.name="BagSdkException",this.message=t,this.stack=(new Error).stack,this.bagStateInvalid=e(t,"BagItemDoesNotExist")||e(t,"ProductNotAvailableFromProductService")}return(t.prototype=Object.create(Error.prototype)).constructor=t}),define("bagsdk/factories/memoryCacheFactory",[],function(){function t(t){this.storage=t}var e={};return t.prototype.getItem=function(t){var e,i=this.storage[t];return e=i?i.expires>(new Date).getTime()||!i.expires?i.value:(delete this.storage[t],null):e},t.prototype.removeItem=function(t){this.storage[t]&&delete this.storage[t]},t.prototype.setItem=function(t,e,i){i=1e3*i||0;this.storage[t]={value:e,expires:i&&(new Date).getTime()+i}},t.prototype.clear=function(){this.storage={}},function(){return{application:new t(e),instance:new t({})}}}),define("global",[],function(){return window}),define("bagsdk/services/persistedDataService",["global"],function(i){function t(t){this.storage=t,this.storageKey="Asos.Commerce.Bag.Sdk",this.cleanCache()}return t.prototype.cleanCache=function(){var t,e,i=this.getStorageItem(),n={};for(t in i)!i.hasOwnProperty(t)||(e=i[t]).hasOwnProperty("expires")&&e.expires>(new Date).getTime()&&(n[t]=e);this._setStorageItem(this.storageKey,JSON.stringify(n))},t.prototype.getStorageItem=function(){var t=this.storage.getItem(this.storageKey);return t?JSON.parse(t):{}},t.prototype.getItem=function(t){var e=this.getStorageItem();if(e.hasOwnProperty(t)){e=e[t];if(e.expires>(new Date).getTime())return e.data;this.deleteItem(t)}return null},t.prototype.setItem=function(t,e,i){i=void 0===i?36e5:i;var n=this.getStorageItem();n[t]={data:e,expires:(new Date).getTime()+i},this._setStorageItem(this.storageKey,JSON.stringify(n))},t.prototype.deleteItem=function(t){var e=this.getStorageItem();delete e[t],this._setStorageItem(this.storageKey,JSON.stringify(e))},t.prototype.clear=function(){this._setStorageItem(this.storageKey,JSON.stringify({}))},t.prototype._setStorageItem=function(t,e){try{this.storage.setItem(t,e)}catch(t){i.console.warn("Error setting localStorage:",t)}},new t(i.localStorage)}),define("bagsdk/services/cookieService",["bagsdk/global","jquery"],function(a,s){function c(){return new Date}function u(){var t=new RegExp(/(?:.)*?\.?asos(.+)/);return a.location.hostname.replace(t,"asos$1")}function o(t,e,i){var n,r=u(),o="";i&&((n=c()).setTime(n.getTime()+24*i*60*60*1e3),o="; expires="+n.toGMTString()),a.document.cookie=t+"="+e+o+";path=/;domain="+r}function d(t,e,i){var n={};if(t)for(var r=t.split(e),o=0;o<r.length;o++){var a=r[o].indexOf(i);n[s.trim(r[o].substr(0,a))]=r[o].substr(a+1)}return n}function h(t){var e=d(a.document.cookie,";","="),i="";return t in e&&(i=e[t]),decodeURIComponent(i)}return{readCookie:h,writeToCookie:function(t,e,i,n){var r=function(t){t=h(t);return d(t,"&","=")}(t);r[e]=encodeURIComponent(i),o(t,function(t,e,i){var n,r=[];for(n in t)t.hasOwnProperty(n)&&r.push(n+i+t[n]);return r.join(e)}(r,"&","="),n)},writeCookie:function(t,e,i){o(t,e,i)},getCookieDomain:u,getDate:c,invalidateCookieByPrefix:function(e){a.document.cookie.split(/;\s*/).filter(function(t){return t.match(e+"[^=]*=")}).forEach(function(t){t=t.split("=")[0];this.writeCookie(t,"null",-1)}.bind(this))}}}),define("bagsdk/services/bagApiService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/exceptions/bagSdkException","bagsdk/factories/memoryCacheFactory","bagsdk/services/persistedDataService","bagsdk/services/cookieService"],function(r,t,e,n,a,s){function i(t){r.call(this,{url:t.bagApiUrl,headers:{"asos-c-store":t.store}}),this.memoryCache=n(),this.keyCreator=t.keyCreator;var i=null;this.setBagId=function(t){var e=this.keyCreator.createCookieKey("BagId");i=t,s.writeCookie(e,t,2/24)},this.readLastModifiedCookie=function(){var t=this.keyCreator.createCookieKey("BagLastModified"),t=parseInt(s.readCookie(t),10);return isNaN(t)?null:t},this.setLastModifiedCookie=function(t,e){var i=this.keyCreator.createCookieKey("BagLastModified");s.writeCookie(i,t,e)},this.updatePersistedLastModified=function(t){var e=this.keyCreator.createPersistedDataKey({persistentId:t,keyName:"bagLastModified"}),t=Date.now();a.setItem(e,t),this.setLastModifiedCookie(t,1/24)},this.getBagId=function(){return i},this.setOrigin=function(t){s.writeCookie("BagOrigin",t,2/24)},this.getOrigin=function(){return s.readCookie("BagOrigin")||null}}return((i.prototype=Object.create(r.prototype)).constructor=i).prototype.setupRequestAjaxOptions=function(){var t=r.prototype.setupRequestAjaxOptions.apply(this,arguments),e=this.getOrigin();return e&&(t.headers=t.headers||{},t.headers["asos-bag-origin"]=e),t},i.prototype.successfulResponseHandler=function(t,e,i){i=t.bag&&t.bag.origin?t.bag.origin:i.getResponseHeader("asos-bag-origin");return i&&this.setOrigin(i),t.bag&&t.bag.id?this.setBagId(t.bag.id):t.bagId&&this.setBagId(t.bagId),t},i.prototype.exceptionHandler=function(t){throw new(Array.isArray(t)?e:Error)(t)},i.prototype.request=function(i,n){return Promise.all([t.getAccessToken(),t.persistentId()]).then(function(t){var e=t[0],o=t[1];return r.prototype.request.call(this,i,n,{headers:{Authorization:"bearer "+e}}).then(function(t){var e,i=(t=t||{}).bag?t.bag.summary:t,n=!!t.bag;e=i,s.writeToCookie("asosbasket","basketitemcount",e.totalQuantity,1/24),s.writeToCookie("asosbasket","basketitemtotalretailprice",e.totalPrice?e.totalPrice.value:void 0,1/24),n&&(r=this.keyCreator.createMemoryCacheKey({keyName:"bag"}),this.memoryCache.application.setItem(r,t,20));var n=this.keyCreator.createPersistedDataKey({persistentId:o,keyName:"summary"}),r=this.keyCreator.createPersistedDataKey({persistentId:o,keyName:"bagId"});return a.setItem(n,i,3e5),a.setItem(r,i.bagId,72e5),this.updatePersistedLastModified(o),t}.bind(this))}.bind(this)).catch(this.exceptionHandler.bind(this))},i}),define("bagsdk/adaptors/summaryVariantsToVariantSizesAdaptor",[],function(){function t(){}return t.prototype.adapt=function(t){return t.sort(function(t,e){return t.sizeOrder-e.sizeOrder}).map(function(t){return{variantId:t.id,price:t.price.current.text,size:t.brandSize,inStock:t.isInStock}})},new t}),define("bagsdk/adaptors/summaryVariantsToProductColoursAdaptor",[],function(){function t(){}return t.prototype.adapt=function(t){return t.sort(function(t,e){return t.colour.localeCompare(e.colour)}).map(function(t){return{price:t.price,colour:t.colour,colourCode:t.colourCode,image:t.image}})},new t}),define("bagsdk/services/productCatalogueApiService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/exceptions/bagSdkException","bagsdk/adaptors/summaryVariantsToVariantSizesAdaptor","bagsdk/adaptors/summaryVariantsToProductColoursAdaptor"],function(n,t,e,i,r){function o(t){n.call(this,{url:t})}function a(t){return t.filter(function(t){return!0===t.isInStock})}function s(t){return i.adapt(t)}function c(t){return r.adapt(t)}function u(t){return t.variants}function d(t){return i={},(e=t).images.filter(function(t){return"Standard"===t.type}).forEach(function(t){i[t.colour]=t.url}),e.variants.forEach(function(t){t.image=i[t.colour]}),u(t);var e,i}function h(t){if(!Array.isArray(t)||0===t.length)throw new Error("Invalid server response");return t[0]}return((o.prototype=Object.create(n.prototype)).constructor=o).prototype.exceptionHandler=function(t){throw new(Array.isArray(t)?e:Error)(t)},o.prototype.request=function(e,i){return t.getAccessToken().then(function(t){return n.prototype.request.call(this,e,i,{headers:{Authorization:"bearer "+t}})}.bind(this)).catch(this.exceptionHandler.bind(this))},o.prototype.requestVariantSizes=function(t,e){return this.request(t).then(h).then(u).then((i=e,function(t){return t.filter(function(t){var e=!1;return e=(e=t.hasOwnProperty("colourCode")?t.colourCode===i:e)||t.colour===i})})).then(s);var i},o.prototype.requestProductColours=function(t){return this.request(t).then(h).then(d).then(a).then((e={},function(t){return t.filter(function(t){return!e.hasOwnProperty(t.colour)&&(e[t.colour]=!0)})})).then(c);var e},o}),define("bagsdk/config/routes",[],function(){return{commerceBag:{createBagByCustomer:{path:"/commerce/bag/v4/customers/:guid/bags/getbag",method:"post"},getBagByCustomerAndStore:{path:"/commerce/bag/v4/customers/:guid/stores/:store/bag",method:"get"},getBagByCustomer:{path:"/commerce/bag/v4/customers/:guid/countries/:country/bag",method:"get"},getBagSummaryByCustomerAndStore:{path:"/commerce/bag/v4/customers/:guid/stores/:store/bag/total",method:"get"},getBagSummaryByCustomer:{path:"/commerce/bag/v4/customers/:guid/countries/:country/bag/total",method:"get"},getBagById:{path:"/commerce/bag/v4/bags/:bagId",method:"get"},getBagSummaryById:{path:"/commerce/bag/v4/bags/:bagId/total",method:"get"},addVariant:{path:"/commerce/bag/v4/bags/:bagId/product",method:"post"},addVariants:{path:"/commerce/bag/v4/bags/:bagId/products",method:"post"},removeItem:{path:"/commerce/bag/v4/bags/:bagId/product/:itemId",method:"delete"},removeSubscription:{path:"/commerce/bag/v4/bags/:bagId/subscription/:itemId",method:"delete"},removeVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers/:itemId",method:"delete"},updateItem:{path:"/commerce/bag/v4/bags/:bagId/product/:itemId",method:"patch"},moveToBag:{path:"/commerce/bag/v4/bags/:bagId/products/save",method:"post"},saveBag:{path:"/commerce/bag/v4/bags/:bagId/items/save",method:"post"},saveBagItem:{path:"/commerce/bag/v4/bags/:bagId/items/:itemId/save",method:"post"},updateCurrency:{path:"/commerce/bag/v4/bags/:bagId/currency",method:"put"},setDeliveryOption:{path:"/commerce/bag/v4/bags/:bagId/deliveryoptions",method:"put"},addVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers",method:"post"},updateVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers/:itemId",method:"put"},addSubscription:{path:"/commerce/bag/v4/bags/:bagId/subscription",method:"post"}},productCatalog:{getProductSummary:{path:"/product/catalogue/v2/summaries/",method:"get"}},paymentOptions:{getPaymentMethods:{path:"/finance/paymentoptions/v2/paymentmethods/klarnaNordics",method:"get"}},subscriptionOptions:{getSubscriptionOptions:{path:"/commerce/subscriptionsoptions/v1/subscriptions",method:"get"}}}}),define("bagsdk/models/route",["bagsdk/global"],function(o){function t(t,e){this.path=t,this.method=e}return t.prototype.withExpansions=function(t){return this.path=function(t,e){if(t+=-1===t.indexOf("?")?"?":"&",t+="expand=",Array.isArray(e)){for(var i=0;i<e.length-1;i++)t+=o.escape(e[i])+",";t+=o.escape(e[e.length-1])}else t+=o.escape(e);return t}(this.path,t),this},t.prototype.withParam=function(t,e){return this.path=(i=this.path,n=t,r=e,(i+=-1===i.indexOf("?")?"?":"&")+(o.escape(n)+"="+o.escape(r))),this;var i,n,r},t}),define("bagsdk/services/routeService",["bagsdk/config/routes","bagsdk/models/route"],function(n,r){var o=n.commerceBag;return{createRoute:function(t,e,i){if(!(i=function(t){var e=o;if(t&&t.routeCollection){if(!n[t.routeCollection])throw new Error('Unknown routeCollection "'+t.routeCollection+'".');e=n[t.routeCollection]}return e}(i)[t]))throw new Error('Unknown route "'+t+'".');return new r(function(t,e){var i,n,r=t;for(n in e)e.hasOwnProperty(n)&&(i=new RegExp(":"+n,"g"),r=r.replace(i,e[n]));return r}(i.path,e),i.method)}}}),define("bagsdk/services/paymentOptionsService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/exceptions/bagSdkException"],function(i,t,e){function n(t){i.call(this,{url:t})}return((n.prototype=Object.create(i.prototype)).constructor=n).prototype.exceptionHandler=function(t){throw new(Array.isArray(t)?e:Error)(t)},n.prototype.getPaymentMethods=function(e){return t.getAccessToken().then(function(t){return i.prototype.request.call(this,e,void 0,{headers:{Authorization:"bearer "+t}})}.bind(this)).catch(this.exceptionHandler.bind(this))},n}),define("bagsdk/services/subscriptionOptionsService",["bagsdk/models/apiService","bagsdk/exceptions/bagSdkException"],function(e,i){function t(t){e.call(this,{url:t})}return((t.prototype=Object.create(e.prototype)).constructor=t).prototype.exceptionHandler=function(t){throw new(Array.isArray(t)?i:Error)(t)},t.prototype.getSubscriptionOptions=function(t){return e.prototype.request.call(this,t,void 0,{}).catch(this.exceptionHandler.bind(this))},t}),define("bagsdk/services/notificationService",["jquery"],function(n){function r(t,e,i){n(t).trigger(e,i)}function t(){}var e="addToBag:",o={addEventStart:e+"started",addEventCompleted:e+"completed",addEventError:e+"error",updateEventCompleted:"bagUpdated:completed",customerLogoutEvent:"bagSdk:customerLogout"};return t.prototype.notifyItemAddedToBagStart=function(t,e){r(t,o.addEventStart,e)},t.prototype.notifyItemAddedToBagComplete=function(t,e){r(t,o.addEventCompleted,e)},t.prototype.notifyItemAddedToBagError=function(t,e){r(t,o.addEventError,e)},t.prototype.notifyBagUpdatedComplete=function(t,e,i){r(t,o.updateEventCompleted,[e,i])},new t}),define("bagsdk/utils/comparer",[],function(){function t(e,i){var t=Object.keys(e),n=Object.keys(i);return t.length===n.length&&t.every(function(t){return e[t]===i[t]})}return{areConfigurationsEqual:t,areContextsEqual:t}}),define("bagsdk/utils/keyCreator",[],function(){function t(t,e,i){this._storeId=t,this._country=e,this._enableStoreBaseOperation=i}function i(t){return t.join(":::")}return t.prototype.createMemoryCacheKey=function(t){var e=[];return this._enableStoreBaseOperation||e.push(this._storeId),e.push(this._country),e.push(t.keyName),i(e)},t.prototype.createPersistedDataKey=function(t){var e=[];return e.push(t.persistentId),e.push(this._storeId),this._enableStoreBaseOperation||e.push(this._country),e.push(t.keyName),i(e)},t.prototype.createCookieKey=function(t){var e=[];return e.push(t),e.push(this._storeId),this._enableStoreBaseOperation||e.push(this._country),e.join(":")},t}),define("bagsdk/exceptions/bagSdkSingleInstanceMismatchError",["./bagSdkException"],function(t){function e(){this.name="BagSdkSingleInstanceMismatchError",this.stack=(new Error).stack}return(e.prototype=Object.create(t.prototype)).constructor=e}),define("bagsdk/exceptions/argumentError",["./bagSdkException"],function(t){function e(t){this.name="ArgumentError",this.message=t,this.stack=(new Error).stack}return(e.prototype=Object.create(t.prototype)).constructor=e}),define("bagSdk/sdk",["bagsdk/config/configuration","bagsdk/config/defaultConfiguration","bagsdk/config/currencies","bagsdk/services/bagApiService","bagsdk/factories/memoryCacheFactory","bagsdk/services/cookieService","bagsdk/services/productCatalogueApiService","bagsdk/services/identityService","bagsdk/services/routeService","bagsdk/services/persistedDataService","bagsdk/services/paymentOptionsService","bagsdk/services/subscriptionOptionsService","bagsdk/services/notificationService","bagsdk/utils/comparer","bagsdk/utils/keyCreator","bagsdk/utils/getInstanceEventBus","bagsdk/global","jquery","bagsdk/exceptions/bagSdkException","bagsdk/exceptions/bagSdkSingleInstanceMismatchError","bagsdk/exceptions/argumentError"],function(n,r,i,e,o,a,s,t,h,c,u,d,g,p,m,l,f,y,b,v,S){function I(t){var e=[x.summary,x.total];return e=void 0!==t?e.concat(t):e}function C(t){this._context=t,this._keyCreator=new m(t.storeId,t.country,t.enableStoreBasedOperation),this._bagApiService=new e({keyCreator:this._keyCreator,bagApiUrl:n.bagApiUrl,store:this._context.storeId}),this._paymentOptionsService=new u(n.paymentOptionsApiUrl),this._subscriptionOptionsService=new d(n.subscriptionOptionsApiUrl),this._productCatalogueApiService=new s(n.productCatalogueApiUrl),this._memoryCache=o(),this._bindEventSubscriptions(),this._bagIdCookieKey=this._keyCreator.createCookieKey("BagId"),this._bagOriginCookieKey="BagOrigin",this._lastModifiedCookieKey=this._keyCreator.createCookieKey("BagLastModified"),this._keyStoreDataVersionKey="asos-b-sdv629",this._googleAnalyticsClientIdCookieName="asos-b-gat251",this._existingDataVersionCookie=a.readCookie(this._keyStoreDataVersionKey),this._computeKeyStoreDataVersion()}function k(t){return"RMB"===t?"CNY":t}function _(t,e){t=a.readCookie(t),e=a.readCookie(e);return t&&e&&"null"!==t&&"null"!==e}function B(n,r,o){return new Promise(function(e,i){var t=this._context.currency;r!==t?this.updateCurrency(t,o).then(function(t){e(t)}).catch(function(t){i(t)}):e(n)}.bind(this))}function D(t){return Promise.resolve(t&&t.bag&&t.bag.summary?t.bag.summary:t)}var x={deliveryOptions:"getdeliveryoptions",summary:"summary",total:"total",variants:"variants"};C.prototype._expansions=x,C.prototype._bindEventSubscriptions=function(){t.onSessionEnded(this._handleLogout.bind(this)),t.onLoggedIn(this._handleLogin.bind(this))},C.prototype._getUniqueUrlValue=function(){return(new Date).getTime()},C.prototype.version="5.1.0",C.prototype._init=function(){return Promise.all([t.customerGuid(),t.persistentId(),t.customerId()]).then(function(t){var e={customerGuid:t[0],persistentId:t[1],customerId:t[2]},t=this._keyCreator.createPersistedDataKey({persistentId:e.persistentId,keyName:"bagId"}),t=(t=c.getItem(t))||(a.readCookie(this._bagIdCookieKey)||null);return e.bagId=t,e}.bind(this))},C.prototype._prepareBag=function(n){return new Promise(function(e,i){return null===n.bagId?this._createBag().then(function(t){n.bagId=t.bag.id,e(n)}).catch(function(t){i(t)}):void e(n)}.bind(this))},C.prototype.getCustomerConfig=function(){return new Promise(function(t){t({country:this._context.originCountry,currency:this._context.currency})}.bind(this))},C.prototype._getCurrencyNillValueByStoreAndCurrencyCode=function(t,e){e=[t=t||"",e=e||""].join(":");return i.hasOwnProperty(e)?i[e]:"0.00"},C.prototype._bagDoesNotExist=function(t){return!!(t&&"object"==typeof t&&Array.isArray(t.message)&&t.message.filter(function(t){return"BagDoesNotExist"===t.errorCode||"BagDoesNotExistForCustomer"===t.errorCode}).length)},C.prototype._handleBagDoesNotExist=function(t,e){e&&this._bagDoesNotExist(t)&&this._invalidateCachesAndCookies(e)},C.prototype._invalidateCaches=function(e){["summary","bagId","bagLastModified","isLoggedIn"].forEach(function(t){t=this._keyCreator.createPersistedDataKey({persistentId:e,keyName:t});c.deleteItem(t)}.bind(this))},C.prototype._invalidateCachesAndCookies=function(t){t?this._invalidateCaches(t):c.clear(),a.invalidateCookieByPrefix("BagId"),a.invalidateCookieByPrefix("BagLastModified"),a.invalidateCookieByPrefix("BagOrigin")},C.prototype.getOrCreateBag=function(e){return this.getBag().catch(function(t){if(this._bagDoesNotExist(t))return this._createBag(e);throw t}.bind(this))},C.prototype.getBag=function(i){var e=this._memoryCache.application.getItem(this._keyCreator.createMemoryCacheKey({keyName:"bag"}));return e?new Promise(function(t){t(e)}):this._init().then(function(t){if(null!==t.bagId)return this._getBagById(t.bagId,i,t.persistentId);var e=t.customerId||t.customerGuid;return this._getBagByCustomerId(e,i,t.persistentId)}.bind(this))},C.prototype.getBagById=function(e,i){return this._init().then(function(t){return this._getBagById(e,i,t.persistentId)}.bind(this))},C.prototype._getBagById=function(t,e,i){t=h.createRoute("getBagById",{bagId:t}).withExpansions(I(e)).withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue());return this._bagApiService.request(t).then(this._validateBagCurrency.bind(this,e)).then(function(t){return g.notifyBagUpdatedComplete(this,"bagRetrieved",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,i),t}.bind(this))},C.prototype.getBagByCustomer=function(i){return this._init().then(function(t){var e=t.customerId||t.customerGuid;return this._getBagByCustomerId(e,i,t.persistentId)}.bind(this))},C.prototype._getBagByCustomerId=function(t,e,i){t=this._constructGetBagByCustomerIdRoute(t,e);return this._bagApiService.request(t).then(this._validateBagCurrency.bind(this,e)).then(function(t){return g.notifyBagUpdatedComplete(this,"bagRetrieved",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,i),t}.bind(this))},C.prototype._constructGetBagByCustomerIdRoute=function(t,e){return(this._context.enableStoreBasedOperation?h.createRoute("getBagByCustomerAndStore",{guid:t,store:this._context.storeId}):h.createRoute("getBagByCustomer",{guid:t,country:this._context.country}).withParam("keyStoreDataversion",this._context.keyStoreDataversion)).withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue()).withExpansions(I(e))},C.prototype._createBag=function(i){return this._init().then(function(t){var e={currency:this._context.currency,lang:this._context.language,sizeSchema:this._context.sizeSchema},t=h.createRoute("createBagByCustomer",{guid:t.customerId||t.customerGuid}).withExpansions(I(i)).withParam("lang",this._context.language);return this._context.enableStoreBasedOperation?(e.country=this._context.originCountry,e.store=this._context.storeId):(t.withParam("keyStoreDataversion",this._context.keyStoreDataversion),e.country=this._context.country,e.originCountry=this._context.originCountry),this._bagApiService.request(t,e)}.bind(this))},C.prototype._getCachedSummary=function(t){if(this._bagModified(t))return null;t=this._keyCreator.createPersistedDataKey({persistentId:t,keyName:"summary"});return c.getItem(t)},C.prototype._getCachedLastModified=function(t){t=this._keyCreator.createPersistedDataKey({persistentId:t,keyName:"bagLastModified"});return c.getItem(t)},C.prototype.getNillBagSummary=function(t){return{bagId:null,currency:t,totalPrice:{text:this._getCurrencyNillValueByStoreAndCurrencyCode(this._context.storeId,t),value:0},totalQuantity:0}},C.prototype._bagModified=function(t){return this._getCachedLastModified(t)!==this._bagApiService.readLastModifiedCookie()},C.prototype.getBagSummary=function(){return this._init().then(function(i){var t=this._getCachedSummary(i.persistentId);if(t&&t.bagId===i.bagId)return t;t=function(t){var e;return null!==t.bagId?e=h.createRoute("getBagSummaryById",{bagId:t.bagId}):(t={guid:t.customerId||t.customerGuid},!0===this._context.enableStoreBasedOperation?(t.store=this._context.storeId,e=h.createRoute("getBagSummaryByCustomerAndStore",t)):(t.country=this._context.country,(e=h.createRoute("getBagSummaryByCustomer",t)).withParam("keyStoreDataversion",this._context.keyStoreDataversion))),e.withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue()),e}.call(this,i);return this._bagApiService.request(t).catch(function(t){this._handleBagDoesNotExist(t,i.persistentId);var e=this.getNillBagSummary(this._context.currency),t=this._keyCreator.createPersistedDataKey({persistentId:i.persistentId,keyName:"summary"});return c.setItem(t,e),e}.bind(this))}.bind(this)).then(this._validateBagSummaryCurrency.bind(this))};C.prototype.addVariant=function(t,r){return new Promise(function(e,i){g.notifyItemAddedToBagStart(this,t.variantId);var n=function(i,n){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t=h.createRoute("addVariant",{bagId:e.bagId}).withExpansions(I(n)).withParam("lang",this._context.language);return this._bagApiService.request(t,{variantId:i}).then(function(t){return g.notifyItemAddedToBagComplete(this,t),g.notifyBagUpdatedComplete(this,"itemAdded",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))}.bind(this,t.variantId,r);n().then(e).catch(function(t){this._bagDoesNotExist(t)?n().then(e).catch(function(t){g.notifyItemAddedToBagError(this,t),i(t)}):(g.notifyItemAddedToBagError(this,t),i(t))}.bind(this))}.bind(this))};C.prototype.addVariants=function(r,o){return new Promise(function(e,i){var t=r.map(function(t){return{variantId:t.variantId}});g.notifyItemAddedToBagStart(this,r);var n=function(i,n){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t=h.createRoute("addVariants",{bagId:e.bagId}).withExpansions(I(n)).withParam("lang",this._context.language);return this._bagApiService.request(t,i).then(function(t){return g.notifyItemAddedToBagComplete(this,t),g.notifyBagUpdatedComplete(this,"itemAdded",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))}.bind(this,t,o);n().then(e).catch(function(t){this._bagDoesNotExist(t)?n().then(e).catch(function(t){g.notifyItemAddedToBagError(this,t),i(t)}):(g.notifyItemAddedToBagError(this,t),i(t))}.bind(this))}.bind(this))},C.prototype.removeItem=function(n,r,o){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t;switch(r){case"subscription":t="removeSubscription";break;case"voucher":t="removeVoucher";break;default:t="removeItem"}var i=h.createRoute(t,{bagId:e.bagId,itemId:n}).withExpansions(I(o)).withParam("lang",this._context.language);return this._bagApiService.request(i).then(function(t){return g.notifyBagUpdatedComplete(this,"removeItem",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))},C.prototype.updateItem=function(i,n,r,o){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t={bagId:e.bagId,itemId:i},t=h.createRoute("updateItem",t).withExpansions(I(o)).withParam("lang",this._context.language);return this._bagApiService.request(t,{quantity:r,variantId:n}).then(function(t){return g.notifyBagUpdatedComplete(this,"updateItem",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))};C.prototype.moveToBag=function(t,r,o){return new Promise(function(e,i){g.notifyItemAddedToBagStart(this,t);var n=function(n,r,o){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t=h.createRoute("moveToBag",{bagId:e.bagId}).withExpansions(I(o)).withParam("lang",this._context.language),i=[{variantId:n}];return isNaN(parseInt(r,10))||(i[0].savedItemId=parseInt(r,10)),g.notifyItemAddedToBagStart(this,n),this._bagApiService.request(t,i).then(function(t){return g.notifyItemAddedToBagComplete(this,t),g.notifyBagUpdatedComplete(this,"itemAdded",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))}.bind(this,t,r,o);n().then(e).catch(function(t){this._bagDoesNotExist(t)?n().then(e).catch(function(t){g.notifyItemAddedToBagError(this,t),i(t)}):(g.notifyItemAddedToBagError(this,t),i(t))}.bind(this))}.bind(this))},C.prototype.saveBag=function(i){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t={bagId:e.bagId},t=h.createRoute("saveBag",t).withExpansions(I(i)).withParam("lang",this._context.language);return this._bagApiService.request(t).then(function(t){return g.notifyBagUpdatedComplete(this,"saveBag",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))},C.prototype.saveForLater=function(i,n){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t={bagId:e.bagId,itemId:i},t=h.createRoute("saveBagItem",t).withExpansions(I(n)).withParam("lang",this._context.language);return this._bagApiService.request(t).then(function(t){return g.notifyBagUpdatedComplete(this,"saveForLater",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))},C.prototype._computeKeyStoreDataVersion=function(){var t=this._context.keyStoreDataversion||"NO_KEY_STORE_DATAVERSION";this._existingDataVersionCookie!==t&&this._invalidateCachesAndCookies(),a.writeCookie(this._keyStoreDataVersionKey,t,.25)},C.prototype._getProductSummaryRoute=function(t){t=h.createRoute("getProductSummary",{},{routeCollection:"productCatalog"}).withParam("productids",t).withParam("store",this._context.storeId).withParam("currency",this._context.currency).withParam("lang",this._context.language).withParam("sizeSchema",this._context.sizeSchema).withExpansions(x.variants);return this._context.keyStoreDataversion&&t.withParam("keyStoreDataversion",this._context.keyStoreDataversion),t},C.prototype.getSizes=function(t,e){t=this._getProductSummaryRoute(t);return this._productCatalogueApiService.requestVariantSizes(t,e)},C.prototype.getColours=function(t){t=this._getProductSummaryRoute(t);return this._productCatalogueApiService.requestProductColours(t)},C.prototype.updateCurrency=function(r,i){return this._init().then(function(n){if(!n.bagId)return new Promise(function(t){var e=this.getNillBagSummary(r),i=this._keyCreator.createPersistedDataKey({persistentId:n.persistentId,keyName:"summary"});c.setItem(i,e),this._context.currency=r,t(null)}.bind(this));var t={bagId:n.bagId},t=h.createRoute("updateCurrency",t).withExpansions(I(i)).withParam("lang",this._context.language),e=k(r);return this._bagApiService.request(t,{currency:e}).then(function(t){return this._context.currency=e,g.notifyBagUpdatedComplete(this,"updateCurrency",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,n.persistentId),t}.bind(this))}.bind(this))},C.prototype.setDeliveryOption=function(n,r){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t={bagId:e.bagId},i=h.createRoute("setDeliveryOption",t).withExpansions(x.deliveryOptions).withParam("lang",this._context.language),t={deliveryOptionId:n};return void 0!==r&&(t.nominatedDate=r),this._bagApiService.request(i,t).then(function(t){return g.notifyBagUpdatedComplete(this,"setDeliveryOption",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))};C.prototype.addVoucher=function(t,r,o,a,s,c,u){return new Promise(function(e,i){var n=function(n,r,o,a,s,c,u){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t={bagId:e.bagId},i=h.createRoute("addVoucher",t).withExpansions(I(u)).withParam("lang",this._context.language),t={Value:n,ToName:r,ToEmail:o,VoucherStyleId:a,DeliveryDate:s};return c&&(c.fromName&&(t.FromName=c.fromName),c.personalMessage&&(t.PersonalMessage=c.personalMessage)),this._bagApiService.request(i,t).then(function(t){return g.notifyBagUpdatedComplete(this,"addVoucher",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))}.bind(this,t,r,o,a,s,c,u);n().then(e).catch(function(t){this._bagDoesNotExist(t)?n().then(e).catch(i):i(t)}.bind(this))}.bind(this))},C.prototype.updateVoucher=function(n,r,o,a,s,c,u,d){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t={bagId:e.bagId,itemId:n},i=h.createRoute("updateVoucher",t).withExpansions(I(d)).withParam("lang",this._context.language),t={Value:r,ToName:o,ToEmail:a,VoucherStyleId:s,DeliveryDate:c};return u&&(u.fromName&&(t.FromName=u.fromName),u.personalMessage&&(t.PersonalMessage=u.personalMessage)),this._bagApiService.request(i,t).then(function(t){return g.notifyBagUpdatedComplete(this,"updateVoucher",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))};C.prototype.addSubscription=function(t,r){return new Promise(function(e,i){var n=function(i,n){return this._init().then(this._prepareBag.bind(this)).then(function(e){var t={bagId:e.bagId},t=h.createRoute("addSubscription",t).withExpansions(I(n)).withParam("lang",this._context.language);return this._bagApiService.request(t,{SubscriptionId:i}).then(function(t){return g.notifyBagUpdatedComplete(this,"addSubscription",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.persistentId),t}.bind(this))}.bind(this))}.bind(this,t,r);n().then(e).catch(function(t){this._bagDoesNotExist(t)?n().then(e).catch(i):i(t)}.bind(this))}.bind(this))},C.prototype.getPaymentMethods=function(t){t=h.createRoute("getPaymentMethods",{},{routeCollection:"paymentOptions"}).withParam("lang",this._context.language).withParam("billingCountry",t||this._context.originCountry).withParam("currency",this._context.currency);return this._paymentOptionsService.getPaymentMethods(t)},C.prototype.getSubscriptionOptions=function(t){t=h.createRoute("getSubscriptionOptions",{},{routeCollection:"subscriptionOptions"}).withParam("country",t||this._context.originCountry).withParam("store",this._context.storeId).withParam("currency",this._context.currency).withParam("lang",this._context.language);return this._subscriptionOptionsService.getSubscriptionOptions(t)},C.prototype._saveGoogleAnalyticsClientId=function(){return f.ga&&f.ga(function(t){t=t.get("clientId");a.writeCookie(this._googleAnalyticsClientIdCookieName,t)}.bind(this)),!0},C.prototype.startCheckout=function(){return new Promise(function(t,e){this._init().then(this._ensureCheckoutValues.bind(this)).then(function(t){this._invalidateCaches(t.persistentId)}.bind(this)).then(this._saveGoogleAnalyticsClientId.bind(this)).then(t.bind(this)).catch(e)}.bind(this))},C.prototype._ensureCheckoutValues=function(o){return new Promise(function(n,r){_(this._bagIdCookieKey,this._bagOriginCookieKey)?n(o):this.getBag().then(function(){var t,e,i;_(this._bagIdCookieKey,this._bagOriginCookieKey)?n(o):(t=this._bagIdCookieKey,e=this._bagOriginCookieKey,i=a.readCookie(t),t=a.readCookie(e),e=!!i&&"null"!==i,i=!!t&&"null"!==t,t="StartCheckout:CookieCheckFailed",e||i?e&&!i?t="StartCheckout:MissingBagOrigin":!e&&i&&(t="StartCheckout:MissingBagId"):t="StartCheckout:MissingBagOriginAndId",r(new Error(t)))}.bind(this)).catch(function(t){var e="";"object"==typeof t&&Array.isArray(t.message)&&0<t.message.length&&(e=":"+t.message[0].errorCode),r(new Error("StartCheckout:GetBagFailed"+e))})}.bind(this))},C.prototype._getUserBagOrReplaceBag=function(t){t=this._keyCreator.createPersistedDataKey({persistentId:t,keyName:"summary"}),t=c.getItem(t);return!t||!t.bagId?(this._invalidateCachesAndCookies(),this.getBagSummary()):this.getBagById(t.bagId)},C.prototype._handleLogin=function(){return t.persistentId().then(function(t){var e=this._keyCreator.createPersistedDataKey({persistentId:t,keyName:"isLoggedIn"}),i=c.getItem(e);return c.setItem(e,!0,3600),i?Promise.resolve():this._getUserBagOrReplaceBag(t)}.bind(this))},C.prototype._handleLogout=function(){this._memoryCache.application.clear(),this._invalidateCachesAndCookies(),a.writeCookie(this._keyStoreDataVersionKey,"null",-1)},C.prototype._validateBagCurrency=function(t,e){return B.call(this,e,e.bag.currency,t)},C.prototype._validateBagSummaryCurrency=function(t){return this._init().then(function(e){return B.call(this,t,t.currency).then(D).then(function(t){return null===t?this._getCachedSummary(e.persistentId):t}.bind(this))}.bind(this))},f.asos=f.asos||{},f.asos.commerce=f.asos.commerce||{};var E=null;return f.asos.commerce.bagSdk={getInstance:function(t,e){!function(e){if(!e)throw new S("context is required");if(!0===e.enableStoreBasedOperation){if(e.keyStoreDataversion)throw new S("invalid use of context.keyStoreDataversion")}else if(!e.keyStoreDataversion)throw new S("context.keyStoreDataversion is required");["storeId","country","originCountry","currency","language","sizeSchema"].forEach(function(t){if(!e[t])throw new S("context."+t+" is required")})}(t);var i=y.extend({},t,{currency:k(t.currency)});if(E){t=y.extend({},e);if(function(t){for(var e in t)null===t[e]&&delete t[e]}(t),t=y.extend({},r,t),p.areContextsEqual(i,E._context)&&p.areConfigurationsEqual(t,n))return E;throw new v}return y.extend(n,r,e),E=new C(i),f.asos.commerce._bagSdkInstance=E,l.trigger("bagSdk:instanceReady"),l.bagSdkInstantiated=!0,E}},f.asos.commerce.bagSdk});
