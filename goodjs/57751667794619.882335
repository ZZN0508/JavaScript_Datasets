!function(p,a){var s=38,i=40,o=27,l=13,u={},h=null,m="",y="",v=null,r=null,C=null,w=0,b=0,k=!0,c=!1,N=null,d=!1,g=!1,f=!1,x=!1;function I(e,t){if(null!==r){for(var n,s=0;;){if(""!=(n=p(p("#suggestion > div").get(r))).find("*[name=suggestName]").text())break;if(10<s)break;t?r--:r++,s++}e.val(n.find("*[name=suggestName]").text()),n.siblings().removeClass("focused"),n.addClass("focused")}}function S(){v.hide(),v.text(""),c&&(k=!1),T()}function T(){C=r=null,w=0,x=!1}function _(){null!=N?y=h:m=h}function j(e,t,n,s){if(null==e.suggestion||0==e.suggestion.length)return S(),void _();v.text(""),C=e.suggestion.length-1;var i=s.viewCnt-1;(i=i<0?0:i)<C&&(C=i);var a="";k||(a="display:none;");for(var o,l=0;l<=C;l++){var u=e.suggestion[l],r=U(D(u.orgName)),c=U(D(u.orgName)),d=U(u.categoryCD),g=U(u.path),f="";!k&&b<=l&&(f="display:none;");f='<div style="width:'+s.width+"px;"+f+'">';null==u.categoryName?f+='<span class="type_a wide">'+r.replace(U(h),"<b>"+U(h)+"</b>")+"</span>":("カテゴリのページへ"==u.categoryName?f+='<span class="type_a ic_f">':f+='<span class="type_a">',f+=r.replace(U(h),"<b>"+U(h)+"</b>")+"</span>",f+='<span class="type_b">'+U(u.categoryName)+"</span>"),f+='<span name="suggestName" style="display:none;">'+c+"</span>",f+='<span name="suggestCD" style="display:none;">'+d+"</span>",f+='<span name="suggestPath" style="display:none;">'+g+"</span>",p(f+="</div>").click(function(e){P(n,p(this),s)}).hover(function(e){x=!0,p(this).siblings().removeClass("focused"),p(this).addClass("focused")},function(){x=!1,p(this).removeClass("focused")}).appendTo(v),"カテゴリのページへ"!=u.categoryName&&l<C&&l<i&&null==e.suggestion[l+1].categoryName^null==u.categoryName&&(v.append('<div class="line" style="width:'+s.width+"px;"+a+'" />'),w++)}!k&&b<=C&&(o='<div id="suggestMore" class="see_more" style="width:'+s.width+'px;"><span>もっと見る</span></div>',p(o).click(function(e){p("#suggestion > div").show(),p(this).hide(),p(this).removeClass("focused"),n.focus(),k=!(x=!1)}).hover(function(e){x=!0,p(this).siblings().removeClass("focused"),p(this).addClass("focused")},function(){x=!1,p(this).removeClass("focused")}).appendTo(v)),v.show(),null!=N?y="":m=""}function P(e,t,n){var s=t.find("*[name=suggestName]").text(),i=t.find("*[name=suggestCD]").text(),t=t.find("*[name=suggestPath]").text();S(),e.val(s);e="";d?null!=n.lidCategory&&(e="lid="+n.lidCategory):null!=n.lid&&(e="lid="+n.lid),""==t?(f=!0,""!=s&&(""!=e&&(e="&"+e),""==i?a.location.href="/search_results/"+UrlEncSJIS(s)+"/?act=Suggest"+e:(""!=e&&(e+="_category"),a.location.href="/search_results/"+UrlEncSJIS(s)+"/?category="+UrlEncSJIS(i)+"&act=Suggest"+e))):a.open(t+(e=""!=e?"?"+e+"_pricemenu":e))}function U(e){return null==e?"":p("<div/>").text(e).html()}function D(e){return null==e?"":p("<div/>").html(e).text()}function E(e){e=parseInt(e,10);return isNaN(e)?0:e}p.fn.suggest=function(e){var t=a.document,n=p.extend({formID:null,class:null,width:null,categoryTagNm:null,pricePageCategory:null,lid:null,lidCategory:null,viewCnt:10,hideCnt:0,pageType:1,adjustment:[0,0]},e);return function(t,n){{var e;p("#"+n.formID).bind({keypress:function(e){if(e.keyCode===l&&null!==r){e=p(p("#suggestion > div").get(r));return P(t,e,n),!1}}}),null!=n.categoryTagNm&&0<(e=p("#"+n.formID+" *[name="+n.categoryTagNm+"]")).size()&&(""==e.filter(":checked").val()?N=null:(N=e.filter(":checked").val(),d=!0),e.bind({change:function(e){N=p(this).val()?p(this).val():null}}))}null!=n.pricePageCategory&&(d=!0);var s;t.attr("autocomplete","off"),f=g=!1,t.offsetParent()[0]?(s=t.offsetParent()[0],t.position().top,t.outerHeight(),n.adjustment[0],t.position().left+E(t.css("padding-left"))+E(t.css("border-left-width"))+n.adjustment[1]):(s=t.parent()[0],t.offset().top,t.outerHeight(),n.adjustment[0],t.offset().left+E(t.css("padding-left"))+E(t.css("border-left-width"))+n.adjustment[1]);0==p("#suggestion").size()?(v=p("<div />")).attr("id","suggestion"):v=p("#suggestion");v.hide(),null!=n.class&&v.addClass(n.class);v.css({display:"none"}).appendTo(s),b=n.viewCnt-n.hideCnt,0<n.hideCnt&&(c=!(k=!1))}(p(this),n),this.each(function(){p(this).bind({keyup:function(e){e.keyCode===s||e.keyCode===i||e.keyCode===o||!0===f||function(e,t,n){if(""===(h=p.trim(t.val())))return S();T(),h+" "+N in u?j(u[h+" "+N],0,t,n):function(e,s,i){if(""==h||g)return;if(function(){if(null!=N){if(""!=y&&y==h.substr(0,y.length))return!0}else if(""!=m&&m==h.substr(0,m.length))return!0;return!1}())return;var t="/apiSuggest/ApiSuggest.aspx";t+="?kw="+encodeURIComponent(s.val()),null!=N&&(t+="&cd="+encodeURIComponent(N));t+="&pt="+encodeURIComponent(i.pageType),null!=i.pricePageCategory&&(t+="&pc="+encodeURIComponent(i.pricePageCategory));g=!0,p.ajax({type:"GET",url:t,dataType:"json",cache:!1,success:function(e,t,n){0==e.status?j(u[h+" "+N]=e,0,s,i):(S(),_())},error:function(e,t,n){S(),_()},complete:function(e,t,n){g=!1}})}(e,t,n)}(t,p(this),n)},keydown:function(e){if(e.keyCode===s||e.keyCode===i||e.keyCode===o)switch(e.keyCode){case s:null==r||0==r?r=k?C+w:b:r--,I(p(this),!0);break;case i:null===r?(""==v.text()&&h+" "+N in u&&j(u[h+" "+N],0,p(this),n),r=0):r++,k?C+w<r&&(r=0):C<b?b-1<=r&&(r=0):b-1<r&&(p("#suggestion > div").show(),p("#suggestMore").hide(),k=!0),I(p(this),!1);break;case o:S()}},blur:function(e){x||S()},mousedown:function(e){x||S()}},this.settings)})}}(jQuery,window);
