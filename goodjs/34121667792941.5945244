KISSY.add("base",["attribute"],function(a,t){function e(a,o){return function(s){return function(){(o?s:this.callSuper).apply(this,arguments);var t=arguments.callee.__owner__.__extensions__||[];o&&t.reverse();var e,r=arguments;if(e=t&&t.length)for(var n=0;n<e;n++){var i=t[n]&&(a?t[n].prototype[a]:t[n]);i&&i.apply(this,r||[])}(o?this.callSuper:s).apply(this,arguments)}}}function o(t){var e=this.__hooks__,r=this.prototype;if(this.__extensions__.length&&e)for(var n in e)r.hasOwnProperty(n)&&!t.hasOwnProperty(n)||(t[n]=t[n]||s);return c.call(this,t)}function r(t){t.target===this&&this[l+t.type.slice(5).slice(0,-6)].call(this,t.newVal,t)}function i(t){var e,r=this.get("plugins");if(e=r.length)for(var n=0;n<e;n++)r[n][t]&&r[n][t](this)}var u=t("attribute"),h=a.ucfirst,l="_onSet",s=a.noop,t=u.extend({constructor:function(){this.callSuper.apply(this,arguments);var t,r,n,e=this.get("listeners");for(t in e)this.on(t,e[t]);this.initializer(),n=this.get("plugins"),a.each(n,function(t,e){"function"==typeof t&&(r=t,n[e]=new r)}),i.call(this,"pluginInitializer"),this.bindInternal(),this.syncInternal()},initializer:s,__getHook:e,__callPluginsMethod:i,bindInternal:function(){for(var t in this.getAttrs())this[l+h(t)]&&this.on("after"+h(t)+"Change",r)},syncInternal:function(){for(var t,e,r,n=[],i=this.constructor,s=this.getAttrs();i;)n.push(i),i=i.superclass&&i.superclass.constructor;for(n.reverse(),i=0;i<n.length;i++)for(t in n[i].ATTRS||{})t in s&&(r=this[l+h(t)])&&0!==s[t].sync&&void 0!==(e=this.get(t))&&r.call(this,e)},plug:function(t){return(t="function"==typeof t?new t:t).pluginInitializer&&t.pluginInitializer(this),this.get("plugins").push(t),this},unplug:function(r){var n=[],i=this,s="string"==typeof r;return a.each(i.get("plugins"),function(t){var e=0;r&&(s?(t.get&&t.get("pluginId")||t.pluginId)!==r&&(n.push(t),e=1):t!==r&&(n.push(t),e=1)),e||t.pluginDestructor(i)}),i.setInternal("plugins",n),i},getPlugin:function(e){var r=null;return a.each(this.get("plugins"),function(t){if((t.get&&t.get("pluginId")||t.pluginId)===e)return r=t,!1}),r},destructor:a.noop,destroy:function(){this.get("destroyed")||(i.call(this,"pluginDestructor"),this.destructor(),this.set("destroyed",!0),this.fire("destroy"),this.detach())}});a.mix(t,{__hooks__:{initializer:e(),destructor:e("__destructor",!0)},ATTRS:{plugins:{value:[]},destroyed:{value:!1},listeners:{value:[]}},extend:function t(e,r,n){var i,s;return a.isArray(e)||(n=r,r=e,e=[]),(r=u.extend.call(this,r=r||{},n=n||{})).__extensions__=e,o.call(r,{}),e.length&&(i={},s={},a.each(e.concat(r),function(t){if(t)for(var e in a.each(t.ATTRS,function(t,e){e=i[e]=i[e]||{};a.mix(e,t)}),t=t.prototype)t.hasOwnProperty(e)&&(s[e]=t[e])}),r.ATTRS=i,s.constructor=r,a.augment(r,s)),r.extend=n.extend||t,r.addMembers=o,r}});var c=t.addMembers;return a.Base=t}),KISSY.add("attribute",["event/custom"],function(c,t,e,r){function s(t,e){return"string"==typeof e?t[e]:e}function a(t){return t.__attrVals||(t.__attrVals={})}function l(t,e,r,n,i,s,a,o){return a=a||r,t.fire(e+c.ucfirst(r)+"Change",c.mix({attrName:a,subAttrName:s,prevVal:n,newVal:i},o))}function _(t,e,r){var n=t[e];return r||n||(t[e]=n={}),n||{}}function f(t,e){for(var r=0,n=e.length;void 0!==t&&r<n;r++)t=t[e[r]];return t}function p(t){var e;return-1!==t.indexOf(".")&&(t=(e=t.split(".")).shift()),{path:e,name:t}}function d(t,e,r){var n=r;if(e){var t=n=void 0===t?{}:c.clone(t),i=e.length-1;if(0<=i){for(var s=0;s<i;s++)t=t[e[s]];void 0!==t&&(t[e[s]]=r)}}return n}function v(t,e,r,n,i){var s,a=p(e),o=e,e=a.name;a=a.path;var u=t.get(e),h=e,l=_(t,"__defaultBeforeFns");if(l[h]||(l[h]=1,h="before"+c.ucfirst(h)+"Change",t.publish(h,{defaultFn:g})),a&&(s=f(u,a)),n.force||!(!a&&u===r||a&&s===r)){if(r=d(u,a,r),r=c.mix({attrName:e,subAttrName:o,prevVal:u,newVal:r,_opts:n,_attrs:i,target:t},n.data),n.silent){if(A===g.call(t,r))return A}else if(A===t.fire("before"+c.ucfirst(e)+"Change",r))return A;return t}}function g(t){if(t.target===this){var e=t.newVal,r=t.prevVal,n=t.attrName,i=t.subAttrName,s=t._attrs,t=t._opts;if((e=this.setInternal(n,e))===A)return e;t.silent||(l(this,"after",n,r,e=a(this)[n],i,null,t.data),s?s.push({prevVal:r,newVal:e,attrName:n,subAttrName:i}):l(this,"","*",[r],[e],[i],[n],t.data))}}function n(t){var e=this.constructor;for(this.userConfig=t;e;){var r=e.ATTRS;if(r){var n=void 0;for(n in r)this.addAttr(n,r[n],!1)}e=e.superclass?e.superclass.constructor:null}if(t)for(var i in t)this.setInternal(i,t[i])}function o(s,a){var t,e=a.__hooks__||{};for(t in e)t in s&&(s[t]=e[t](s[t]));c.each(s,function(t,e){var r,n,i;"function"==typeof t&&(n=0,t.__owner__?(r=t.__owner__,delete t.__owner__,delete t.__name__,n=t.__wrapped__=1,(i=y(t)).__owner__=r,i.__name__=e,r.prototype[e]=i):t.__wrapped__&&(n=1),n&&(s[e]=t=y(t)),t.__owner__=a,t.__name__=e)})}function u(t){o(t,this),c.mix(this.prototype,t)}function h(t,e){var r=t.getAttrs(),n=_(r,e,1),i=n.valueFn;return(i=i&&s(t,i))&&(void 0!==(i=i.call(t))&&(n.value=i),delete n.valueFn,r[e]=n),n.value}function m(t,e,r,n){var i=p(e);if(e=i.name,(i=i.path)&&(r=d(t.get(e),i,r)),(i=_(t.getAttrs(),e).validator)&&(i=s(t,i))&&(void 0!==(t=i.call(t,r,e,n))&&!0!==t))return t}t=t("event/custom"),r.exports=n;var y=c.bind,i={},A=!1;n.extend=function t(e,r){var n,e=e||{},i=(r=r||{}).__hooks__;(n=this.__hooks__)&&(i=r.__hooks__=r.__hooks__||{},c.mix(i,n,!1)),n=e.hasOwnProperty("constructor")?e.constructor:function(){this.callSuper.apply(this,arguments)},(e.constructor=n).__hooks__=i,o(e,n);var s=r.inheritedStatics;return(i=this.inheritedStatics)&&(s=r.inheritedStatics=r.inheritedStatics||{},c.mix(s,i,!1)),c.extend(n,this,e,r),s&&c.mix(n,s),n.extend=r.extend||t,n.addMembers=u,n},c.augment(n,t.Target,{INVALID:i,callSuper:function(){var t,e,r=arguments;"function"==typeof this&&this.__name__?(t=this,e=r[0],r=Array.prototype.slice.call(r,1)):((t=arguments.callee.caller).__wrapped__&&(t=t.caller),e=this);var n=t.__name__;if(n)return(t=t.__owner__.superclass[n])?t.apply(e,r||[]):void 0},getAttrs:function(){return this.__attrs||(this.__attrs={})},getAttrVals:function(){var t,e={};for(t in this.getAttrs())e[t]=this.get(t);return e},addAttr:function(t,e,r){var n,i=this.getAttrs(),e=c.clone(e);return(n=i[t])?c.mix(n,e,r):i[t]=e,this},addAttrs:function(t,e){var r=this;return c.each(t,function(t,e){r.addAttr(e,t)}),e&&r.set(e),r},hasAttr:function(t){return this.getAttrs().hasOwnProperty(t)},removeAttr:function(t){var e=a(this),r=this.getAttrs();return this.hasAttr(t)&&(delete r[t],delete e[t]),this},set:function(t,e,r){var n;if(c.isPlainObject(t)){var r=e||{},i=[],s=[];for(t in e=Object(t))void 0!==(n=m(this,t,e[t],e))&&s.push(n);if(s.length)return r.error&&r.error(s),A;for(t in e)v(this,t,e[t],r,i);var a=[],o=[],u=[],h=[];return c.each(i,function(t){o.push(t.prevVal),u.push(t.newVal),a.push(t.attrName),h.push(t.subAttrName)}),a.length&&l(this,"","*",o,u,h,a,r.data),this}return r=r||{},void 0!==(n=m(this,t,e))?(r.error&&r.error(n),A):v(this,t,e,r)},setInternal:function(t,e){var r,n=_(this.getAttrs(),t).setter;if((r=(n=n&&s(this,n))?n.call(this,e,t):r)===i)return A;void 0!==r&&(e=r),a(this)[t]=e},get:function(t){var e,r,n,i=a(this);return-1!==t.indexOf(".")&&(t=(e=t.split(".")).shift()),r=_(this.getAttrs(),t,1).getter,n=t in i?i[t]:h(this,t),(r=r&&s(this,r))&&(n=r.call(this,n,t)),t in i||void 0===n||(i[t]=n),n=e?f(n,e):n},reset:function(t,e){if("string"==typeof t)return this.hasAttr(t)?this.set(t,h(this,t),e):this;var e=t,r={};for(t in this.getAttrs())r[t]=h(this,t);return this.set(r,e),this}})});
