define(["OK/utils/dom","OK/autofocus","OK/capture"],(function(t,i,e){"use strict";function s(){this.options={closable:"0",resetActiveItems:"1",autofocus:"",resetLoaderHook:!1},this._activeItems=[],this._toogle=this._toogle.bind(this),this._loaders=[]}return s.prototype={_show:function(){if("1"===this.options.resetActiveItems){var i=this._activeItems;t.byClass(this._filter,"filter_i").forEach((function(t){t.classList.contains("__active")&&(i.push(t),t.classList.remove("__active"))}))}this._el.classList.add("__active"),this._toogleNext(),this._filter.classList.add("__search-visible"),"true"===this.options.resetLoaderHook&&this._loaders.forEach((function(t){e.deactivate(t,!0)}))},_toogleNext:function(){for(var t=this._filter.nextElementSibling,e=this.options.autofocus;t;)t.classList.toggle("invisible"),t=t.nextElementSibling;e&&(e=this._filter.parentNode.querySelector(e))&&i.activate(e)},_hide:function(){"0"!==this.options.closable&&(this._activeItems.forEach((function(t){t.classList.add("__active")})),this._activeItems=[],this._el.classList.remove("__active"),this._toogleNext(),this._filter.classList.remove("__search-visible"),"true"===this.options.resetLoaderHook&&this._loaders.forEach((function(t){e.activate(t)})))},_toogle:function(t){var i=this._el;t.preventDefault(),i.classList.contains("__active")?this._hide():this._show()},_initOptions:function(t){Object.assign(this.options,t)},_findLoaders:function(){var t=this._filter.parentNode.querySelectorAll(".hookBlock .loader-container");this._loaders=Array.prototype.slice.call(t)},activate:function(i){this._initOptions(i.dataset),this._filter=t.parent(i,"filter"),this._filter&&(this._el=i,i.addEventListener("click",this._toogle),"true"===this.options.resetLoaderHook&&this._findLoaders())},deactivate:function(){this._el.removeEventListener("click",this._toogle),OK.util.clean(this)}},s}));