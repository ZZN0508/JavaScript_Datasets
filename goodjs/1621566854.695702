require=function(){function c(a,o,u){function s(r,e){if(!o[r]){if(!a[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[r]={exports:{}};a[r][0].call(i.exports,function(e){var t=a[r][1][e];return s(t||e)},i,i.exports,c,a,o,u)}return o[r].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)s(u[e]);return s}return c}()({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.createWixDataProxy=n;function n(t){return{save:function e(){return t.getJSON("/wix/data-web.jsw/save.ajax",arguments)},insert:function e(){return t.getJSON("/wix/data-web.jsw/insert.ajax",arguments)},update:function e(){return t.getJSON("/wix/data-web.jsw/update.ajax",arguments)},get:function e(){return t.getJSON("/wix/data-web.jsw/get.ajax",arguments)},distinct:function e(){return t.getJSON("/wix/data-web.jsw/distinct.ajax",arguments)},truncate:function e(){return t.getJSON("/wix/data-web.jsw/truncate.ajax",arguments)},remove:function e(){return t.getJSON("/wix/data-web.jsw/remove.ajax",arguments)},find:function e(){return t.getJSON("/wix/data-web.jsw/find.ajax",arguments)},runAggregate:function e(){return t.getJSON("/wix/data-web.jsw/runAggregate.ajax",arguments)},count:function e(){return t.getJSON("/wix/data-web.jsw/count.ajax",arguments)},bulkInsert:function e(){return t.getJSON("/wix/data-web.jsw/bulkInsert.ajax",arguments)},bulkSave:function e(){return t.getJSON("/wix/data-web.jsw/bulkSave.ajax",arguments)},bulkUpdate:function e(){return t.getJSON("/wix/data-web.jsw/bulkUpdate.ajax",arguments)},bulkRemove:function e(){return t.getJSON("/wix/data-web.jsw/bulkRemove.ajax",arguments)},queryReferenced:function e(){return t.getJSON("/wix/data-web.jsw/queryReferenced.ajax",arguments)},insertReference:function e(){return t.getJSON("/wix/data-web.jsw/insertReference.ajax",arguments)},insertReferences:function e(){return t.getJSON("/wix/data-web.jsw/insertReferences.ajax",arguments)},replaceReferences:function e(){return t.getJSON("/wix/data-web.jsw/replaceReferences.ajax",arguments)},removeReference:function e(){return t.getJSON("/wix/data-web.jsw/removeReference.ajax",arguments)},removeReferences:function e(){return t.getJSON("/wix/data-web.jsw/removeReferences.ajax",arguments)},isReferenced:function e(){return t.getJSON("/wix/data-web.jsw/isReferenced.ajax",arguments)},getSchema:function e(){return t.getJSON("/wix/data-web.jsw/getSchema.ajax",arguments)}}}},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=o;var n=e("@wix/wix-data-core/lib/data-api");var i=e("./create-wix-data-proxy"),a=i.createWixDataProxy;function o(e){return new n(a(e))}},{"./create-wix-data-proxy":1,"@wix/wix-data-core/lib/data-api":12}],3:[function(e,t,r){"use strict";function n(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){n=function e(t){return typeof t}}else{n=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return n(e)}var i="User";var a="Error";var o="EDM";var u="Unknown";var s=function e(t,r){if(t&&n(t)==="object"){t.errorGroup=r}};var l=function e(t){return s(t,i)};var c=function e(t){return s(t,a)};var f=function e(t){return s(t,o)};var d=function e(t){return t&&t.errorGroup===i};var v=function e(t){return t&&t.errorGroup===a};var p=function e(t){return t&&t.errorGroup===o};var y=function e(t){if(!t){return false}return t.errorGroup!==undefined};t.exports={markUserError:l,isUserError:d,markAppError:c,isAppError:v,markEdmError:f,isEdmError:p,markError:s,isMarked:y,USER_ERROR_GROUP:i,APP_ERROR_GROUP:a,EDM_ERROR_GROUP:o,UNKNOWN_ERROR_GROUP:u}},{}],4:[function(e,t,r){"use strict";function n(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){n=function e(t){return typeof t}}else{n=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return n(e)}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)i(e,t)}function i(e,t){i=Object.setPrototypeOf||function e(t,r){t.__proto__=r;return t};return i(e,t)}function s(i){var a=f();return function e(){var t=d(i),r;if(a){var n=d(this).constructor;r=Reflect.construct(t,arguments,n)}else{r=t.apply(this,arguments)}return l(this,r)}}function l(e,t){if(t&&(n(t)==="object"||typeof t==="function")){return t}return c(e)}function c(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function f(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function d(e){d=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return d(e)}function a(t){function e(){var e=Reflect.construct(t,Array.from(arguments));Object.setPrototypeOf(e,Object.getPrototypeOf(this));return e}e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}else{e.__proto__=t}return e}var v=e("./error-marks");var p=function(e){u(a,e);var i=s(a);function a(){var e;o(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}e=i.call.apply(i,[this].concat(r));if(Error.captureStackTrace){Error.captureStackTrace(c(e),e.constructor)}e.name=a.name;v.markUserError(c(e));return e}return a}(a(Error));t.exports={UserCodeError:p}},{"./error-marks":3}],5:[function(e,t,r){"use strict";function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);if(e)n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable});r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};if(e%2){n(Object(r),true).forEach(function(e){a(t,e,r[e])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))}else{n(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}}return t}function a(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var o=e("./errors");var u=e("./error-marks");t.exports=i(i({},o),u)},{"./error-marks":3,"./errors":4}],6:[function(e,t,r){t.exports=e("./lib/index")},{"./lib/index":9}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();r.platformizedFilterBuilder=d;r.filterBuilderFactory=v;var i=e("./filterMixin");var a=o(i);function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){l(t,e);function t(){u(this,t);return s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}n(t,[{key:"_build",value:function e(){return this.getFilterModel()}},{key:"constructorName",get:function e(){return"FilterBuilder"}}]);return t}((0,a.default)());var f=function(e){l(t,e);function t(){u(this,t);return s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}n(t,[{key:"in",value:function e(t,r){return this._AndSetOperand("$in",".in",arguments)}},{key:"exists",value:function e(t,r){return this._binaryAnd("$exists",".exists",arguments)}},{key:"gte",value:function e(t,r){return this.ge(t,r)}},{key:"lte",value:function e(t,r){return this.le(t,r)}},{key:"build",value:function e(){return this.getFilterModel()}}]);return t}((0,a.default)());function d(){return new f({})}function v(){return new c({})}r.default=v},{"./filterMixin":8}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var v=function(){function r(e,t){var r=[];var n=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){i=true;a=e}finally{try{if(!n&&o["return"])o["return"]()}finally{if(i)throw a}}return r}return function(e,t){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return r(e,t)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();var p=e("@wix/wix-data-utils");var i=e("@wix/wix-data-errors");var a=e("./queryOptimiser");function y(e){return Array.isArray(e)?e:Array.from(e)}function s(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++){r[t]=e[t]}return r}else{return Array.from(e)}}function o(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(){function e(){l(this,e)}return e}();return function(e){u(r,e);function r(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};l(this,r);var t=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));t.filterTree=e.filterTree||{$and:[]};t.invalidArguments=e.invalidArguments||[];return t}n(r,[{key:"eq",value:function e(t,r){return this._binaryAnd("$eq",".eq",arguments)}},{key:"ne",value:function e(t,r){return this._binaryAnd("$ne",".ne",arguments)}},{key:"ge",value:function e(t,r){return this._AndLogicalEquivalence("$gte",".ge",arguments)}},{key:"gt",value:function e(t,r){return this._AndLogicalEquivalence("$gt",".gt",arguments)}},{key:"le",value:function e(t,r){return this._AndLogicalEquivalence("$lte",".le",arguments)}},{key:"lt",value:function e(t,r){return this._AndLogicalEquivalence("$lt",".lt",arguments)}},{key:"isNotEmpty",value:function e(t){var r=this._filterValidator(".isNotEmpty").arityIsOne(arguments).validFieldName(t).validateAndAggregate(this.invalidArguments),n=v(r,2),i=n[0],a=n[1];if(a){return this.ne(t,null)}return this._copy(this.filterTree,i)}},{key:"isEmpty",value:function e(t){var r=this._filterValidator(".isEmpty").arityIsOne(arguments).validFieldName(t).validateAndAggregate(),n=v(r,2),i=n[0],a=n[1];if(a){return this.eq(t,null)}return this._copy(this.filterTree,i)}},{key:"startsWith",value:function e(t,r){return this._AndStringOperand("$startsWith",".startsWith",arguments)}},{key:"endsWith",value:function e(t,r){return this._AndStringOperand("$endsWith",".endsWith",arguments)}},{key:"contains",value:function e(t,r){return this._AndStringOperand("$contains",".contains",arguments)}},{key:"hasSome",value:function e(t,r){return this._AndSetOperand("$hasSome",".hasSome",arguments)}},{key:"hasAll",value:function e(t,r){return this._AndSetOperand("$hasAll",".hasAll",arguments)}},{key:"or",value:function e(t){var r=w(t,this.collectionName);var n=this._filterValidator(".or").arityIsOne(arguments).isInstanceOfSameClass(r).isForCollection(r,this.collectionName).validateAndAggregate(),i=v(n,2),a=i[0],o=i[1];if(o){var u=N(this.filterTree)?[]:[this.filterTree];return this._copy(g({$or:[].concat(u,[r.filterTree])}),a.concat(r.invalidArguments))}else{return this._copy(this.filterTree,a)}}},{key:"and",value:function e(t){var r=w(t,this.collectionName);var n=this._filterValidator(".and").arityIsOne(arguments).isInstanceOfSameClass(r).isForCollection(r,this.collectionName).validateAndAggregate(),i=v(n,2),a=i[0],o=i[1];if(o){var u=N(this.filterTree)?[]:[this.filterTree];return this._copy(g.apply(undefined,u.concat([r.filterTree])),a.concat(r.invalidArguments))}else{return this._copy(this.filterTree,a)}}},{key:"not",value:function e(t){var r=w(t,this.collectionName);var n=this._filterValidator(".not").arityIsOne(arguments).isInstanceOfSameClass(r).isForCollection(r,this.collectionName).validateAndAggregate(),i=v(n,2),a=i[0],o=i[1];if(o){var u=(0,p.clone)(this.filterTree);var s={$not:[r.filterTree]};var l=b(u,s);return this._copy(l,a.concat(r.invalidArguments))}else{return this._copy(this.filterTree,a)}}},{key:"between",value:function e(t,r,n){var i=this._filterValidator(".between").arityIsThree(arguments).sameType(r,n).typeIsStringNumberOrDate(r).typeIsStringNumberOrDate(n).validateAndAggregate(),a=v(i,2),o=a[0],u=a[1];if(u){return this.ge(t,r).lt(t,n)}return this._copy(this.filterTree,o)}},{key:"getFilterModel",value:function e(){if(this.invalidArguments.length>0){throw(0,i.validationError)(i.messages.filterBuilderInvalid(this.invalidArguments))}return(0,a.optimisedQuery)(this.filterTree)}},{key:"setFilterModel",value:function e(t){return this._copy(t,[])}},{key:"_matchesUrlized",value:function e(t,r){var n=this._filterValidator("._matchesUrlized").arityIsTwo(arguments).validFieldName(t).typeIsString(r).validateAndAggregate(),i=v(n,2),a=i[0],o=i[1];if(o){var u=this._makeNewFilter.apply(this,[t].concat(s(f(r))));return this._copy(u,a)}return this._copy(this.filterTree,a)}},{key:"_binaryAnd",value:function e(t,r,n){var i=Array.prototype.slice.call(n),a=v(i,2),o=a[0],u=a[1];var s=this._filterValidator(r).arityIsTwo(n).validFieldName(o).validateAndAggregate(),l=v(s,1),c=l[0];var f=this._makeNewFilter(o,t,u);return this._copy(f,c)}},{key:"_AndLogicalEquivalence",value:function e(t,r,n){var i=Array.prototype.slice.call(n),a=v(i,2),o=a[0],u=a[1];var s=this._filterValidator(r).arityIsTwo(n).validFieldName(o).typeIsStringNumberOrDate(u).validateAndAggregate(),l=v(s,1),c=l[0];var f=this._makeNewFilter(o,t,u);return this._copy(f,c)}},{key:"_AndStringOperand",value:function e(t,r,n){var i=Array.prototype.slice.call(n),a=v(i,2),o=a[0],u=a[1];var s=this._filterValidator(r).arityIsTwo(n).validFieldName(o).typeIsString(u).validateAndAggregate(),l=v(s,1),c=l[0];var f=this._makeNewFilter(o,t,u);return this._copy(f,c)}},{key:"_AndSetOperand",value:function e(t,r,n){var i=Array.prototype.slice.call(n),a=y(i),o=a[0],u=a.slice(1);var s=(0,p.isArray)(u[0])?u[0]:u;var l=this._filterValidator(r).arityIsAtLeastTwo(n).validFieldName(o).typeIsStringNumberOrDateForAll(s).validateAndAggregate(),c=v(l,1),f=c[0];var d=this._makeNewFilter(o,t,s);return this._copy(d,f)}},{key:"_makeNewFilter",value:function e(t,r,n){var i=(0,p.clone)(this.filterTree);var a=this._buildFilter(t,r,n);if((0,p.isArray)(i["$and"])){i["$and"].push(a);return i}else{var o=m(i)?g(a):g(i,a);return o}}},{key:"_buildFilter",value:function e(t,r,n){if(r!=="$eq"){var i={};i[t]={};i[t][r]=this._replaceRefs(n);return i}else{var a={};a[t]=this._replaceRefs(n);return a}}},{key:"_replaceRefs",value:function e(t){var r=this;if((0,p.isArray)(t)){return t.map(function(e){return r._replaceRefs(e)})}else{return t}}},{key:"_copy",value:function e(t,r){return new this.constructor(Object.assign({},this,{filterTree:t,invalidArguments:r}))}},{key:"_filterValidator",value:function e(t){return new O(t,this.invalidArguments,this.constructor,this.constructorName)}}]);return r}(t)};function f(e){if(t(e)){return["$in",[e,Number.parseInt(e)]]}else{return["$matches",{ignoreCase:true,spec:d(e)}]}function t(e){return/^-?[0-9]{1,16}$/.test(e)}}function d(e){var t=e.split("-");var r=[];for(var n=0;n<t.length-1;n++){i(r,t[n]);a(r)}i(r,t[t.length-1]);return r;function i(e,t){if(t.length!==0){e.push({type:"literal",value:t})}}function a(e){e.push({type:"anyOf",value:" \t\n-"})}}function h(e){return(0,p.isArray)(e["$and"])}function m(e){return Object.keys(e).length===0}function g(){return{$and:[].concat(Array.prototype.slice.call(arguments))}}function b(){return{$and:[].concat(Array.prototype.slice.call(arguments)).reduce(function(e,t){return h(t)?e.concat(t["$and"]):e.concat([t])},[])}}var O=function(e){u(a,e);function a(e,t,r,n){l(this,a);var i=o(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));i.operatorName=e;i.ctor=r;i.constructorName=n;return i}n(a,[{key:"typeIsString",value:function e(t){var r=this;return this.addValidation(function(){return(0,p.isString)(t)},function(){return i.messages.filterValidations.typeIsString(r.operatorName,t)})}},{key:"typeIsStringNumberOrDate",value:function e(t){var r=this;return this.addValidation(function(){return _(t)},function(){return i.messages.filterValidations.typeIsStringNumberOrDate(r.operatorName,t)})}},{key:"sameType",value:function e(t,r){var n=this;return this.addValidation(function(){return(0,p.typeForDisplay)(t)===(0,p.typeForDisplay)(r)},function(){return i.messages.filterValidations.sameType(n.operatorName,t,r)})}},{key:"typeIsStringNumberOrDateForAll",value:function e(t){var r=this;return this.addValidation(function(){return t.every(_)},function(){return i.messages.filterValidations.typeIsStringNumberOrDateForAll(r.operatorName)})}},{key:"validFieldName",value:function e(t){var r=this;return this.addValidation(function(){return(0,p.isString)(t)},function(){return i.messages.filterValidations.validFieldName(r.operatorName,t)})}},{key:"isInstanceOfSameClass",value:function e(t){var r=this;return this.addValidation(function(){return t instanceof r.ctor},function(){return i.messages.filterValidations.isInstanceOfSameClass(r.operatorName,r.constructorName,t)})}},{key:"isForCollection",value:function e(t,r){var n=this;return this.addValidation(function(){return t.collectionName===r},function(){return i.messages.filterValidations.isForCollection(n.operatorName,n.constructorName,t.collectionName)})}}]);return a}(i.AggregatingValidator);function _(e){return(0,p.isString)(e)||(0,p.isNumber)(e)||(0,p.isDate)(e)}function w(e,t){if(!e||!e.constructor)return e;var r=e.collectionName?e.collectionName:t;return new e.constructor(Object.assign({},e,{collectionName:r}))}function N(e){return e&&e["$and"]&&e["$and"].length===0}r.default=c},{"./queryOptimiser":10,"@wix/wix-data-errors":19,"@wix/wix-data-utils":24}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.platformizedFilterBuilder=r.filterBuilderFactory=r.filterMixin=undefined;var n=e("./filterBuilder");var i=e("./filterMixin");var a=o(i);function o(e){return e&&e.__esModule?e:{default:e}}r.filterMixin=a.default;r.filterBuilderFactory=n.filterBuilderFactory;r.platformizedFilterBuilder=n.platformizedFilterBuilder;r.default=n.platformizedFilterBuilder},{"./filterBuilder":7,"./filterMixin":8}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var p=function(){function r(e,t){var r=[];var n=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){i=true;a=e}finally{try{if(!n&&o["return"])o["return"]()}finally{if(i)throw a}}return r}return function(e,t){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return r(e,t)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();r.optimisedQuery=i;function s(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++){r[t]=e[t]}return r}else{return Array.from(e)}}function y(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var h=[u,l,c,f];function i(e){var t=m(e),r=p(t,1),n=r[0];return n}function m(e){if(Array.isArray(e)){return a(e)}if((typeof e==="undefined"?"undefined":n(e))==="object"&&e!==null&&!d(e)){return o(e)}return[e,false]}function a(e){var t=e.map(m);var r=0<t.filter(function(e){var t=p(e,2),r=t[1];return r}).length;var n=t.map(function(e){var t=p(e,1),r=t[0];return r});return[n,r]}function o(e){var t=f(e),r=p(t,2),n=r[0],i=r[1];var a=c(n),o=p(a,2),u=o[0],s=o[1];var l=i||s;return[u,l];function c(e){var t=g(e,h);if(!t)return[e,false];var r=m(t),n=p(r,1),i=n[0];return[i,true]}function f(e){var t=Object.entries(e).map(d).filter(function(e){var t=p(e,3),r=t[2];return r});var r=Object.assign({},e,v(t));var n=!!t.length;return[r,n]}function d(e){var t=p(e,2),r=t[0],n=t[1];var i=m(n),a=p(i,2),o=a[0],u=a[1];return[r,o,u]}function v(e){return e.reduce(function(e,t){var r=p(t,2),n=r[0],i=r[1];return Object.assign({},e,y({},n,i))},{})}}function g(e,t){for(var r=0;r<t.length;++r){var n=t[r](e);if(n)return n}}function u(e){var t=e["$and"];if(t&&t.length===1)return t[0]}function l(e){var t=e["$and"];if(!t)return;var r=[];var n=[];t.forEach(function(e){if(a(e)){n=[].concat(s(n),[e])}else{r=[].concat(s(r),[e])}});if(r.length<=1||o(r))return;var i=Object.assign.apply(Object,[{}].concat(s(r)));return{$and:[i].concat(s(n))};function a(e){return Object.keys(e).every(function(e){return e.startsWith("$")})}function o(e){var t=e.map(function(e){return Object.keys(e)}).reduce(function(e,t){return[].concat(s(e),s(t))},[]);var r=u(t);return r.length!==t.length}function u(e){var t={};e.forEach(function(e){return t[e]=true});return Object.keys(t)}}function c(e){var t=e["$and"];if(!t)return;var r=!!t.find(function(e){return e["$and"]});if(!r)return;var n=t.reduce(function(e,t){var r=t["$and"];if(!r)return[].concat(s(e),[t]);return[].concat(s(e),s(r))},[]);return{$and:n}}function f(e){var t=e["$or"];if(!t)return;var r=!!t.find(function(e){return e["$or"]});if(!r)return;var n=t.reduce(function(e,t){var r=t["$or"];if(!r)return[].concat(s(e),[t]);return[].concat(s(e),s(r))},[]);return{$or:n}}function d(e){return e instanceof Date}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var l=function(){function r(e,t){var r=[];var n=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){i=true;a=e}finally{try{if(!n&&o["return"])o["return"]()}finally{if(i)throw a}}return r}return function(e,t){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return r(e,t)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();var i=function e(t,r,n){var i=true;e:while(i){var a=t,o=r,u=n;i=false;if(a===null)a=Function.prototype;var s=Object.getOwnPropertyDescriptor(a,o);if(s===undefined){var l=Object.getPrototypeOf(a);if(l===null){return undefined}else{t=l;r=o;n=u;i=true;s=l=undefined;continue e}}else if("value"in s){return s.value}else{var c=s.get;if(c===undefined){return undefined}return c.call(u)}}};r.aggregateFactory=O;function a(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else{return Array.from(e)}}function u(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("./sort/sortMixin");var d=a(s);var v=e("@wix/wix-data-errors");var p=e("./group");var y=e("@wix/wix-data-utils");var h=function(e){f(s,e);function s(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];c(this,s);i(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,e);this.provider=e.provider;this.collectionName=e.collectionName;this.filterTree=e.filterTree;this.havingTree=e.havingTree;this.skipNumber=e.skipNumber||0;this.limitNumber=e.limitNumber||50;this.invalidArguments=e.invalidArguments||[]}n(s,[{key:"filter",value:function e(t){var r=this._aggregateValidator(".filter").arityIsOne(arguments).filterIsNotSet(this).filterBuilder(t).validateAndAggregate();var n=l(r,1);var i=n[0];return new s({provider:this.provider,collectionName:this.collectionName,filterTree:t.filterTree,groupByTree:this.groupByTree,havingTree:this.havingTree,skipNumber:this.skipNumber,limitNumber:this.limitNumber,orderBy:this.orderBy,invalidArguments:i.concat(t.invalidArguments)})}},{key:"group",value:function e(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++){r[n]=arguments[n]}var i=(0,y.clone)(this.groupByTree);var a=this._aggregateValidator(".group").arityIsAtLeastOne(arguments).groupIsNotSet(i).validateAndAggregate();var o=l(a,1);var u=o[0];if(!i){i={_id:p.formId.apply(undefined,r)}}else if(i._id==="0"){i=Object.assign({},i,{_id:p.formId.apply(undefined,r)})}return new s({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:i,havingTree:this.havingTree,skipNumber:this.skipNumber,limitNumber:this.limitNumber,orderBy:this.orderBy,invalidArguments:u})}},{key:"having",value:function e(t){var r=this._aggregateValidator(".having").arityIsOne(arguments).havingIsNotSet(this).filterBuilder(t).validateAndAggregate();var n=l(r,1);var i=n[0];return new s({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:this.groupByTree,havingTree:t.filterTree,skipNumber:this.skipNumber,limitNumber:this.limitNumber,orderBy:this.orderBy,invalidArguments:i.concat(t.invalidArguments)})}},{key:"skip",value:function e(t){var r=this._aggregateValidator(".skip").arityIsOne(arguments).isNonNegativeNumber(t).isInteger(t).validateAndAggregate();var n=l(r,1);var i=n[0];return new s({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:this.groupByTree,havingTree:this.havingTree,skipNumber:t,limitNumber:this.limitNumber,orderBy:this.orderBy,invalidArguments:i})}},{key:"limit",value:function e(t){var r=this._aggregateValidator(".limit").arityIsOne(arguments).isPositiveNumber(t).isInteger(t).validateAndAggregate();var n=l(r,1);var i=n[0];return new s({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:this.groupByTree,havingTree:this.havingTree,skipNumber:this.skipNumber,limitNumber:t,orderBy:this.orderBy,invalidArguments:i})}},{key:"run",value:function e(t){var r=this;var n=this;var i=this._buildPipeline();return m(this.invalidArguments,this.collectionName).then(function(){return(0,v.apiValidator)().options(t).validateAndReject()}).then(function(){return r.provider.runAggregate(r.collectionName,i,r.limitNumber,t)}).then(function(e){return new _({items:e.items,hasNext:e.hasNext,aggregate:n,pageSize:r.limitNumber})})}},{key:"_buildPipeline",value:function e(){return[this.filterTree?{$match:this.filterTree}:null,this.groupByTree?{$group:this.groupByTree}:null,this.groupByTree?{$project:g(this.groupByTree)}:null,this.havingTree?{$match:this.havingTree}:null,this.orderBy.length>0?{$sort:this.orderBy}:null,{$skip:this.skipNumber}].filter(function(e){return e!==null})}},{key:"_aggregateValidator",value:function e(t){return new N(t,this.invalidArguments)}}]);return s}((0,d["default"])((0,p.groupMixin)()));r.WixDataAggregate=h;function m(e,t){if(e.length>0){return Promise.reject((0,v.validationError)(v.messages.aggregateValidations.aggregateInvalid(t,e)))}else{return Promise.resolve()}}function g(e){var t=Object.keys(e);var r=t.map(function(e){return u({},e,1)});if((0,y.isObject)(e._id)){r.push(b(e._id))}else if((0,y.isString)(e._id)&&e._id!=="0"){r.push(u({},e._id.substr(1),"$_id"))}return Object.assign.apply(Object,[{}].concat(o(r)))}function b(e){var t=Object.keys(e);var r=t.map(function(e){return u({},e,"$_id."+e)});return Object.assign.apply(Object,[{}].concat(o(r)))}function O(e,t){return new h({provider:e,collectionName:t,skip:0,limit:50})}var _=function(){function t(e){c(this,t);if(!e){return}this._items=e.items;this._hasNext=e.hasNext;this._aggregate=e.aggregate;this._pageSize=e.pageSize}n(t,[{key:"hasNext",value:function e(){return this._hasNext}},{key:"next",value:function e(){var t=this._aggregate;if(this.hasNext()){var r=t.skip(t.skipNumber+this._pageSize);return r.run()}}},{key:"items",get:function e(){return this._items}},{key:"length",get:function e(){return this._items.length}}]);return t}();r.WixDataAggregateResult=_;var w=9007199254740991;var N=function(e){f(r,e);function r(e,t){c(this,r);i(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,t);this.operatorName=e}n(r,[{key:"filterBuilder",value:function e(t){var r=this;return this.addValidation(function(){return t.constructorName==="FilterBuilder"},function(){return v.messages.aggregateValidations.filterMustBeBuilder(r.operatorName)})}},{key:"filterIsNotSet",value:function e(t){var r=this;return this.addValidation(function(){return t.filterTree===undefined},function(){return v.messages.aggregateValidations.filterIsAlreadySet(r.operatorName)})}},{key:"havingIsNotSet",value:function e(t){var r=this;return this.addValidation(function(){return t.havingTree===undefined},function(){return v.messages.aggregateValidations.filterIsAlreadySet(r.operatorName)})}},{key:"groupIsNotSet",value:function e(t){var r=this;return this.addValidation(function(){return k(t)},function(){return v.messages.aggregateValidations.groupIsAlreadySet(r.operatorName)})}},{key:"_isNumber",value:function e(t,r){var n=this;return this.addValidation(function(){return(0,y.isNumber)(r)},function(){return v.messages.queryValidations.isNumber(n.operatorName,t,r)})}},{key:"isPositiveNumber",value:function e(t){var r=this;return this._isNumber("positive",t).addValidation(function(){return!Number.isNaN(t)&&t>0},function(){return v.messages.queryValidations.isPositiveNumber(r.operatorName,t)})}},{key:"isNonNegativeNumber",value:function e(t){var r=this;return this._isNumber("non-negative",t).addValidation(function(){return!Number.isNaN(t)&&t>=0},function(){return v.messages.queryValidations.isNonNegativeNumber(r.operatorName,t)})}},{key:"isInteger",value:function e(t){var r=this;return this.addValidation(function(){return!Number.isNaN(t)&&Number.isFinite(t)&&Number.isInteger(t)&&t<w&&t>-w},function(){return v.messages.queryValidations.isInteger(r.operatorName,t)})}}]);return r}(v.AggregatingValidator);function k(e){return e?e._id==="0":true}},{"./group":13,"./sort/sortMixin":17,"@wix/wix-data-errors":19,"@wix/wix-data-utils":24}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=e("./query");var u=e("./group");var s=e("./aggregate");var l=e("@wix/platformized-filter-builder");var c=e("./sort/sortBuilder");var f=i(c);var d=e("@wix/wix-data-errors");var v=e("@wix/wix-data-utils");var p=e("./multiref");var y=e("./utils/field-key-utils");var h=function(){function t(e){a(this,t);this.provider=e}n(t,[{key:"get",value:function e(t,r,n){var i=this;return(0,d.apiValidator)().arity("get",arguments,2,3).collectionName(t).itemId(r).options(n).validateAndReject().then(function(){return i.provider.get(t,r,n)}).then(b)}},{key:"insert",value:function e(t,r,n){var i=this;return(0,d.apiValidator)().arity("insert",arguments,2,3).validateAndReject().then(function(){return g(i.provider,"insert")(t,r,n)})}},{key:"query",value:function e(t){return(0,o.queryFactory)(this.provider,t)}},{key:"filter",value:function e(){return(0,l.filterBuilderFactory)()}},{key:"sort",value:function e(){return(0,f["default"])()}},{key:"find",value:function e(t,r,n,i,a,o,u){return this.provider.find(t,r,n,i,a,o,u).then(m)}},{key:"remove",value:function e(t,r,n){var i=this;return(0,d.apiValidator)().arity("remove",arguments,2,3).collectionName(t).itemId(r).options(n).validateAndReject().then(function(){return i.provider.remove(t,r,n)}).then(b)}},{key:"truncate",value:function e(t,r){var n=this;return(0,d.apiValidator)().arity("truncate",arguments,1,2).collectionName(t).options(r).validateAndReject().then(function(){return n.provider.truncate(t,r)}).then(b)}},{key:"bulkRemove",value:function e(t,r,n){var i=this;return(0,d.apiValidator)().arity("bulkRemove",arguments,2,3).collectionName(t).itemIds(r,t).options(n).validateAndReject().then(function(){return i.provider.bulkRemove(t,r,n)}).then(b).then(function(e){var t=e.errors.map(function(e){return new d.BulkError(e.message,e.code,e.item,e.name)});return Object.assign({},e,{errors:t})})}},{key:"save",value:function e(t,r,n){var i=this;return(0,d.apiValidator)().arity("save",arguments,2,3).validateAndReject().then(function(){return g(i.provider,"save")(t,r,n)})}},{key:"update",value:function e(t,r,n){var i=this;return(0,d.apiValidator)().arity("update",arguments,2,3).validateAndReject().then(function(){return g(i.provider,"update",true)(t,r,n)})}},{key:"queryReferenced",value:function e(n,i,a,o){var u=this;return(0,d.apiValidator)().arity("queryReferenced",arguments,3,4).referenceParameter(i).validateAndReject().then(function(){var t=w(i);var e=o||{};var r=e.limit?e:Object.assign({},e,{limit:50});return u.provider.queryReferenced(n,t,a,r).then(function(e){return new p.WixDataQueryReferencedResult(u.provider,n,a,t,e,r)})})}},{key:"insertReference",value:function e(t,r,n,i,a){var o=arguments,u=this;var s=function e(t){return t.map(function(e){return Object.assign({},{relationshipName:e.relationshipName,left:w(e.left),right:w(e.right)})})};var l=undefined;var c=undefined;var f=undefined;if((0,v.isArray)(r)){c=r;l=n;f=function(){return(0,d.apiValidator)().arity("insertReference",o,2,3).references(c).validateAndReject()}}else{c=_(i).map(function(e){return{relationshipName:r,left:n,right:e}});l=a;f=function(){return(0,d.apiValidator)().arity("insertReference",o,4,5).references(c).validateAndReject()}}return f().then(function(){return u.provider.insertReferences(t,s(c),l)})}},{key:"replaceReferences",value:function e(t,r,n,i,a){var o=this;i=_(i).map(w);n=w(n);return(0,d.apiValidator)().arity("replaceReferences",arguments,4,5).referenceParameter(n).referenceParameters(i).validateAndReject().then(function(){return o.provider.replaceReferences(t,{relationshipName:r,left:n},i.map(function(e){return{relationshipName:r,right:e,left:n}}),a)})}},{key:"removeReference",value:function e(t,r,n,i,a){var o=this;i=_(i).map(w);n=w(n);return(0,d.apiValidator)().arity("removeReference",arguments,4,5).referenceParameter(n).referenceRemoveParameters(i).validateAndReject().then(function(){if(i.length===1){return o.provider.removeReference(t,r,n,i[0],a)}else{return o.provider.removeReferences(t,i.map(function(e){return{relationshipName:r,right:e,left:n}}),a)}})}},{key:"isReferenced",value:function e(t,r,n,i,a){var o=this;return(0,d.apiValidator)().arity("isReferenced",arguments,4,5).referenceParameter(n).referenceParameter(i).validateAndReject().then(function(){return o.provider.isReferenced(t,r,w(n),w(i),a)})}},{key:"bulkInsert",value:function e(t,r,n){var i=this;return(0,d.apiValidator)().arity("bulkInsert",arguments,2,3).validateAndReject().then(function(){return i.provider.bulkInsert(t,r,n)}).then(function(e){var t=e.errors.map(function(e){return new d.BulkError(e.message,e.code,e.item,e.name)});return Object.assign({},e,{errors:t})})}},{key:"bulkSave",value:function e(t,r,n){var i=this;return(0,d.apiValidator)().arity("bulkSave",arguments,2,3).validateAndReject().then(function(){return i.provider.bulkSave(t,r,n)}).then(function(e){var t=e.errors.map(function(e){return new d.BulkError(e.message,e.code,e.item,e.name)});return Object.assign({},e,{errors:t})})}},{key:"bulkUpdate",value:function e(t,r,n){var i=this;return(0,d.apiValidator)().arity("bulkUpdate",arguments,2,3).validateAndReject().then(function(){return i.provider.bulkUpdate(t,r,n)}).then(function(e){var t=e.errors.map(function(e){return new d.BulkError(e.message,e.code,e.item,e.name)});return Object.assign({},e,{errors:t})})}},{key:"getSchema",value:function e(){return this.provider.getSchema()}},{key:"group",value:function e(){return u.groupFactory.apply(undefined,arguments)}},{key:"aggregate",value:function e(t){return(0,s.aggregateFactory)(this.provider,t)}}]);return t}();r["default"]=h;function m(e){var t=e.totalCount;if(e.hasOwnProperty("items")){return{totalCount:t,items:e.items}}else{var r=e.items;return{totalCount:t,items:r}}}function g(n,i){var a=arguments.length<=2||arguments[2]===undefined?false:arguments[2];return function(e,t,r){return(0,d.apiValidator)().collectionName(e).item(t,e,a).options(r).validateAndReject().then(function(){return N(t)}).then(function(){return n[i](e,t,r)}).then(b).then(O(t))}}function b(e){if(e&&e.hasOwnProperty("item")){return e.item}else{return e}}function O(n){return function e(t){if(t){for(var r in t){if(t.hasOwnProperty(r)){if(!n.hasOwnProperty(r)||Object.getOwnPropertyDescriptor(n,r).writable===true){n[r]=t[r]}}}for(var r in n){if(!t.hasOwnProperty(r)){delete n[r]}}return n}else{return undefined}}}function _(e){if((0,v.isArray)(e))return e;return[e]}function w(e){return(0,v.isObject)(e)?e._id:e}function N(e){var t=(0,y.hasField)(e,function(e){return e.startsWith("$")});var r=(0,y.hasField)(e,function(e){return e.includes(".")});if(t)console.error("Data inserted contains field name prefixed with symbol '$'. It is not recommended to use such field names as it will not work with some data operations.");if(r)console.error("Data inserted contains field name containing symbol '.'. It is not recommended to use such field names as it will not work with some data operations.")}t.exports=r["default"]},{"./aggregate":11,"./group":13,"./multiref":14,"./query":15,"./sort/sortBuilder":16,"./utils/field-key-utils":18,"@wix/platformized-filter-builder":6,"@wix/wix-data-errors":19,"@wix/wix-data-utils":24}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var u=function(){function r(e,t){var r=[];var n=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){i=true;a=e}finally{try{if(!n&&o["return"])o["return"]()}finally{if(i)throw a}}return r}return function(e,t){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return r(e,t)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();var i=function e(t,r,n){var i=true;e:while(i){var a=t,o=r,u=n;i=false;if(a===null)a=Function.prototype;var s=Object.getOwnPropertyDescriptor(a,o);if(s===undefined){var l=Object.getPrototypeOf(a);if(l===null){return undefined}else{t=l;r=o;n=u;i=true;s=l=undefined;continue e}}else if("value"in s){return s.value}else{var c=s.get;if(c===undefined){return undefined}return c.call(u)}}};r.groupFactory=y;r.formId=h;function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("@wix/wix-data-utils");var l=e("@wix/wix-data-errors");var c=function e(){var t=arguments.length<=0||arguments[0]===undefined?function(){function e(){o(this,e)}return e}():arguments[0];return function(e){a(t,e);function t(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];o(this,t);i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);this.groupByTree=e.groupByTree;this.invalidArguments=e.invalidArguments||[]}n(t,[{key:"sum",value:function e(t,r){var n=this._groupValidator(".sum").arityIsAtLeastOne(arguments).typeIsString(t).validateAndAggregate();var i=u(n,1);var a=i[0];return this._addAccumulator("sum",t,r,a)}},{key:"avg",value:function e(t,r){var n=this._groupValidator(".avg").arityIsAtLeastOne(arguments).typeIsString(t).validateAndAggregate();var i=u(n,1);var a=i[0];return this._addAccumulator("avg",t,r,a)}},{key:"min",value:function e(t,r){var n=this._groupValidator(".min").arityIsAtLeastOne(arguments).typeIsString(t).validateAndAggregate();var i=u(n,1);var a=i[0];return this._addAccumulator("min",t,r,a)}},{key:"max",value:function e(t,r){var n=this._groupValidator(".max").arityIsAtLeastOne(arguments).typeIsString(t).validateAndAggregate();var i=u(n,1);var a=i[0];return this._addAccumulator("max",t,r,a)}},{key:"count",value:function e(){var t=this._groupValidator(".count").arityIsZero(arguments).validateAndAggregate();var r=u(t,1);var n=r[0];var i=(0,s.clone)(this.groupByTree)||{_id:h()};var a="count";var o={$sum:1};i[a]=o;return this._copy(i,n)}},{key:"_addAccumulator",value:function e(t,r,n,i){var a=(0,s.clone)(this.groupByTree)||{_id:h()};var o=n||r+p(t);var u={};u["$"+t]="$"+r;a[o]=u;return this._copy(a,i)}},{key:"_copy",value:function e(t,r){return new this.constructor(Object.assign({},this,{groupByTree:t,invalidArguments:r}))}},{key:"_groupValidator",value:function e(t){return new v(t,this.invalidArguments)}}]);return t}(t)};r.groupMixin=c;var f=function(e){a(t,e);function t(){o(this,t);i(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}n(t,[{key:"_build",value:function e(){d(this.invalidArguments);return this.groupByTree}}]);return t}(c());r.WixDataGroupBuilder=f;function d(e){if(e.length>0){throw(0,l.validationError)(l.messages.groupBuilderInvalid(e))}}var v=function(e){a(r,e);function r(e,t){o(this,r);i(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,t);this.operatorName=e}n(r,[{key:"typeIsString",value:function e(t){var r=this;return this.addValidation(function(){return(0,s.isString)(t)},function(){return l.messages.filterValidations.typeIsString(r.operatorName,t)})}}]);return r}(l.AggregatingValidator);function p(e){return e.charAt(0).toUpperCase()+e.slice(1)}function y(){var e=h.apply(undefined,arguments);return m(e)}function h(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++){r[t]=arguments[t]}if(r.length===1){return"$"+r}else if(r.length>1){var n=function(){var t={};r.forEach(function(e){return t[e]="$"+e});return{v:t}}();if(typeof n==="object")return n.v}else{return"0"}}function m(e){return new f({groupByTree:{_id:e}})}},{"@wix/wix-data-errors":19,"@wix/wix-data-utils":24}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function c(e,t,r,n,i){var a=arguments.length<=5||arguments[5]===undefined?{}:arguments[5];f(this,c);this.provider=e;this.collectionName=t;this.referenceAttribute=r;this.holdingItemId=n;this.result=i;this.options=a;var o=a.skip;var u=o===undefined?0:o;var s=a.limit;var l=s===undefined?50:s;this.skip=u;this.limit=l}n(c,[{key:"hasNext",value:function e(){return this.skip+this.limit<this.result.totalCount}},{key:"hasPrev",value:function e(){return this.skip>0}},{key:"next",value:function e(){return a.call(this,this.skip+this.limit)}},{key:"prev",value:function e(){return a.call(this,this.skip-this.limit)}},{key:"items",get:function e(){return this.result.items}},{key:"totalCount",get:function e(){return this.result.totalCount}}]);return c}();r.WixDataQueryReferencedResult=i;function a(e){var t=this;var r=e>=0?e:0;var n=Object.assign({},this.options,{skip:r,limit:this.limit});return this.provider.queryReferenced(this.collectionName,this.holdingItemId,this.referenceAttribute,n).then(function(e){return new i(t.provider,t.collectionName,t.referenceAttribute,t.holdingItemId,e,n)})}},{}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=function(){function r(e,t){var r=[];var n=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){i=true;a=e}finally{try{if(!n&&o["return"])o["return"]()}finally{if(i)throw a}}return r}return function(e,t){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return r(e,t)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();var i=function e(t,r,n){var i=true;e:while(i){var a=t,o=r,u=n;i=false;if(a===null)a=Function.prototype;var s=Object.getOwnPropertyDescriptor(a,o);if(s===undefined){var l=Object.getPrototypeOf(a);if(l===null){return undefined}else{t=l;r=o;n=u;i=true;s=l=undefined;continue e}}else if("value"in s){return s.value}else{var c=s.get;if(c===undefined){return undefined}return c.call(u)}}};r.queryFactory=g;function a(e){return e&&e.__esModule?e:{default:e}}function u(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else{return Array.from(e)}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=e("@wix/wix-data-utils");var f=e("@wix/wix-data-errors");var d=e("@wix/platformized-filter-builder");var v=e("./sort/sortMixin");var p=a(v);var y=9007199254740991;var h=function(e){l(a,e);function a(e){s(this,a);i(Object.getPrototypeOf(a.prototype),"constructor",this).call(this,e);this.provider=e.provider;this.collectionName=e.collectionName;this.limitNumber=e.limitNumber;this.invalidArguments=e.invalidArguments;this.orderBy=e.orderBy;this.skipNumber=e.skipNumber;this.included=e.included}n(a,[{key:"count",value:function e(t){var r=this;return m(this.invalidArguments,this.collectionName).then(function(){return(0,f.apiValidator)().options(t).validateAndReject()}).then(function(){return r.provider.count(r.collectionName,r.filterTree,t)}).then(function(e){return e.totalCount})}},{key:"distinct",value:function e(t,r){var n=this;var i=this;return m(this.invalidArguments,this.collectionName).then(function(){return(0,f.apiValidator)().options(r).validateAndReject()}).then(function(){return(0,f.apiValidator)().fieldName(t).validateAndReject()}).then(function(){return n.provider.distinct(n.collectionName,n.filterTree,n.orderBy,t,n.skipNumber,n.limitNumber,r)}).then(function(e){return new O({items:e.items,length:e.items.length,query:i,totalCount:e.totalCount,partialIncludes:false,pagingFunction:function e(){return this.distinct(t,r)}})})}},{key:"_transformOrderingForAggregates",value:function e(t,r){if(t===undefined)t=[];if(t.length>0){return t.filter(function(e){return e.hasOwnProperty(r)}).map(function(e){return{_id:e[r]}})}else{return null}}},{key:"_distinctValuesPipeline",value:function e(t){return[this.filterTree&&Object.keys(this.filterTree).length>0?{$match:this.filterTree}:null,{$distinct:"$"+t}].filter(this._stageFilter)}},{key:"_stageFilter",value:function e(t){return t!==null}},{key:"find",value:function e(t){var r=this;var n=this;return m(this.invalidArguments,this.collectionName).then(function(){return(0,f.apiValidator)().options(t).validateAndReject()}).then(function(){return r.provider.find(r.collectionName,r.filterTree,r.orderBy,r.skipNumber,r.limitNumber,t,r.included)}).then(function(e){return new O({length:e.items.length,totalCount:e.totalCount,query:n,items:e.items,partialIncludes:e.partialIncludes,pagingFunction:function e(){return this.find(t)}})})}},{key:"limit",value:function e(t){var r=this._queryValidator(".limit").arityIsOne(arguments).isPositiveNumber(t).isInteger(t).validateAndAggregate();var n=o(r,1);var i=n[0];return new a({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,orderBy:this.orderBy,skipNumber:this.skipNumber,limitNumber:t,included:this.included,invalidArguments:i})}},{key:"skip",value:function e(t){var r=this._queryValidator(".skip").arityIsOne(arguments).isNonNegativeNumber(t).isInteger(t).validateAndAggregate();var n=o(r,1);var i=n[0];return new a({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,orderBy:this.orderBy,skipNumber:t,limitNumber:this.limitNumber,included:this.included,invalidArguments:i})}},{key:"include",value:function e(){var t=(0,c.clone)(this.included);for(var r=0;r<arguments.length;r++){t.push(arguments[r])}return new a({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,orderBy:this.orderBy,skipNumber:this.skipNumber,limitNumber:this.limitNumber,invalidArguments:this.invalidArguments,included:t})}},{key:"setFilterModel",value:function e(t){var r=i(Object.getPrototypeOf(a.prototype),"setFilterModel",this).call(this,t);return this._setQuerySpecificInvalidArguments(r)}},{key:"setSortModel",value:function e(t){var r=i(Object.getPrototypeOf(a.prototype),"setSortModel",this).call(this,t);return this._setQuerySpecificInvalidArguments(r)}},{key:"_setQuerySpecificInvalidArguments",value:function e(t){var r=function e(t,r){return t!==undefined?r.validateAndAggregate()[0]:[]};var n=this._queryValidator(".limit",[]).isPositiveNumber(this.limitNumber).isInteger(this.limitNumber);var i=this._queryValidator(".skip",[]).isNonNegativeNumber(this.skipNumber).isInteger(this.skipNumber);var a=[].concat(u(r(this.limitNumber,n)),u(r(this.skipNumber,i)));return Object.assign(t,{invalidArguments:a})}},{key:"_queryValidator",value:function e(t){var r=arguments.length<=1||arguments[1]===undefined?this.invalidArguments:arguments[1];return new w(t,r)}},{key:"constructorName",get:function e(){return"WixDataQuery"}}]);return a}((0,d.filterMixin)((0,p["default"])()));r.WixDataQuery=h;function m(e,t){var r=(0,c.isString)(t)?[]:[f.messages.queryValidations.collectionNameIsRequired()];var n=r.concat(e);if(n.length>0){return Promise.reject((0,f.validationError)(f.messages.queryValidations.queryInvalid(t,n)))}else{return Promise.resolve()}}function g(e,t){return new h({provider:e,collectionName:t,filterTree:{},orderBy:undefined,skipNumber:0,limitNumber:50,invalidArguments:[],included:[]})}function b(e,t,r){var n=e.skipNumber||0;var i=e.limitNumber===undefined?t:e.limitNumber;if(r){i=Math.min(i,t)}return r?n+i:n-i}var O=function(){function t(e){s(this,t);if(!e){return}this._items=e.items;this._totalCount=e.totalCount;this._query=e.query;this._partialIncludes=e.partialIncludes;this._pagingFunction=e.pagingFunction;this.nextSkipNumber=b(this.query,this.length,true);this.prevSkipNumber=b(this.query,this.length,false)}n(t,[{key:"next",value:function e(){var t=new h({provider:this.query.provider,collectionName:this.query.collectionName,filterTree:this.query.filterTree,orderBy:this.query.orderBy,skipNumber:b(this.query,this.length,true),limitNumber:this.query.limitNumber,included:this.query.included,invalidArguments:[]});return this._pagingFunction.bind(t)()}},{key:"prev",value:function e(){var t=b(this.query,this.length,false);if(t<0){return Promise.reject((0,f.validationError)(f.messages.queryValidations.invalidSkipParameter(this.query.collectionName,t)))}else{var r=new h({provider:this.query.provider,collectionName:this.query.collectionName,filterTree:this.query.filterTree,orderBy:this.query.orderBy,skipNumber:t,limitNumber:this.query.limitNumber,included:this.query.included,invalidArguments:[]});return this._pagingFunction.bind(r)()}}},{key:"hasNext",value:function e(){if(this.totalCount<=0){return false}var t=b(this.query,this.length,true);return t<this.totalCount}},{key:"hasPrev",value:function e(){if(this.totalCount<=0){return false}var t=b(this.query,this.length,false);return t>=0}},{key:"toJSON",value:function e(){return{items:this._items,length:this._items?this._items.length:0,totalCount:this._totalCount,query:this._query}}},{key:"items",get:function e(){return this._items}},{key:"length",get:function e(){return this.items.length}},{key:"totalCount",get:function e(){return this._totalCount}},{key:"query",get:function e(){return this._query}},{key:"pageSize",get:function e(){return this._query.limitNumber||50}},{key:"totalPages",get:function e(){return Math.ceil(this.totalCount/this.pageSize)}},{key:"currentPage",get:function e(){return this.totalCount>0&&(this.query.skipNumber||0)<this.totalCount?Math.floor(this.totalPages*(this.query.skipNumber||0)/this.totalCount):undefined}},{key:"partialIncludes",get:function e(){return this._partialIncludes}}]);return t}();var _=function(){function u(e,t,r,n,i,a,o){s(this,u);this.provider=e;this.collectionName=t;this.referenceAttribute=r;this.holdingItemId=n;this.totalCount=i;this.skip=a;this.limit=o}n(u,[{key:"hasNext",value:function e(){return this.skip+this.limit<this.totalCount}},{key:"hasPrev",value:function e(){return this.skip>0}},{key:"next",value:function e(){return this.provider.queryReferenced(this.collectionName,this.holdingItemId,this.referenceAttribute,{skip:this.skip+this.limit,limit:this.limit})}},{key:"prev",value:function e(){var t=this.skip-this.limit;var r=t>=0?t:0;return this.provider.queryReferenced(this.collectionName,this.holdingItemId,this.referenceAttribute,{skip:r,limit:this.limit})}}]);return u}();r.WixDataQueryReferencedResult=_;var w=function(e){l(r,e);function r(e,t){s(this,r);i(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,t);this.operatorName=e}n(r,[{key:"_isNumber",value:function e(t,r){var n=this;return this.addValidation(function(){return(0,c.isNumber)(r)},function(){return f.messages.queryValidations.isNumber(n.operatorName,t,r)})}},{key:"isPositiveNumber",value:function e(t){var r=this;return this._isNumber("positive",t).addValidation(function(){return!Number.isNaN(t)&&t>0},function(){return f.messages.queryValidations.isPositiveNumber(r.operatorName,t)})}},{key:"isNonNegativeNumber",value:function e(t){var r=this;return this._isNumber("non-negative",t).addValidation(function(){return!Number.isNaN(t)&&t>=0},function(){return f.messages.queryValidations.isNonNegativeNumber(r.operatorName,t)})}},{key:"isInteger",value:function e(t){var r=this;return this.addValidation(function(){return!Number.isNaN(t)&&Number.isFinite(t)&&Number.isInteger(t)&&t<y&&t>-y},function(){return f.messages.queryValidations.isInteger(r.operatorName,t)})}},{key:"notGreaterThan",value:function e(t,r){var n=this;return this.addValidation(function(){return t<=r},function(){return f.messages.queryValidations.notGreaterThan(n.operatorName,t,r)})}}]);return r}(f.AggregatingValidator)},{"./sort/sortMixin":17,"@wix/platformized-filter-builder":6,"@wix/wix-data-errors":19,"@wix/wix-data-utils":24}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();var i=function e(t,r,n){var i=true;e:while(i){var a=t,o=r,u=n;i=false;if(a===null)a=Function.prototype;var s=Object.getOwnPropertyDescriptor(a,o);if(s===undefined){var l=Object.getPrototypeOf(a);if(l===null){return undefined}else{t=l;r=o;n=u;i=true;s=l=undefined;continue e}}else if("value"in s){return s.value}else{var c=s.get;if(c===undefined){return undefined}return c.call(u)}}};r.sortBuilderFactory=f;function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("./sortMixin");var l=a(s);var c=function(e){u(t,e);function t(){o(this,t);i(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}n(t,[{key:"_build",value:function e(){return this.getSortModel()}}]);return t}((0,l["default"])());function f(){return new c(undefined)}r["default"]=f},{"./sortMixin":17}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var f=function(){function r(e,t){var r=[];var n=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){i=true;a=e}finally{try{if(!n&&o["return"])o["return"]()}finally{if(i)throw a}}return r}return function(e,t){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return r(e,t)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();var i=function e(t,r,n){var i=true;e:while(i){var a=t,o=r,u=n;i=false;if(a===null)a=Function.prototype;var s=Object.getOwnPropertyDescriptor(a,o);if(s===undefined){var l=Object.getPrototypeOf(a);if(l===null){return undefined}else{t=l;r=o;n=u;i=true;s=l=undefined;continue e}}else if("value"in s){return s.value}else{var c=s.get;if(c===undefined){return undefined}return c.call(u)}}};function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var d=e("@wix/wix-data-utils");var u=e("@wix/wix-data-errors");var s=function e(){var t=arguments.length<=0||arguments[0]===undefined?function(){function e(){o(this,e)}return e}():arguments[0];return function(e){a(t,e);function t(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];o(this,t);i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);this.orderBy=e.orderBy||[];this.invalidArguments=e.invalidArguments||[]}n(t,[{key:"ascending",value:function e(t){return this._sortClause("asc",".ascending",arguments)}},{key:"descending",value:function e(t){return this._sortClause("desc",".descending",arguments)}},{key:"getSortModel",value:function e(){if(this.invalidArguments.length>0){throw(0,u.validationError)(u.messages.sortBuilderInvalid(this.invalidArguments))}return this.orderBy}},{key:"setSortModel",value:function e(t){return this._copySort(t,[])}},{key:"_sortClause",value:function e(t,r,n){var i=[];if(this.orderBy){i=(0,d.clone)(this.orderBy)}var a=v(i,t);var o=(0,d.isArray)(n[0])&&n.length===1?n[0]:Array.prototype.slice.call(n,0);var u=this._sortValidator(r).arityIsAtLeastOne(n).allStrings(o).validateAndAggregate();var s=f(u,2);var l=s[0];var c=s[1];if(c){o.forEach(a)}return this._copySort(i,l)}},{key:"_sortValidator",value:function e(t){return new l(t,this.invalidArguments)}},{key:"_copySort",value:function e(t,r){return new this.constructor(Object.assign({},this,{orderBy:t,invalidArguments:r}))}}]);return t}(t)};function v(r,n){return function(e){var t={};t[e]=n;r.push(t)}}var l=function(e){a(r,e);function r(e,t){o(this,r);i(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,t);this.operatorName=e}n(r,[{key:"allStrings",value:function e(t){var r=this;return this.addValidation(function(){return t.every(d.isString)},function(){return u.messages.sortValidations.typeIsStringOrArrayOfStrings(r.operatorName,t)})}}]);return r}(u.AggregatingValidator);r["default"]=s;t.exports=r["default"]},{"@wix/wix-data-errors":19,"@wix/wix-data-utils":24}],18:[function(e,t,r){"use strict";t.exports.hasField=function t(r,n){if(!r){return false}if(Array.isArray(r)){return r.some(function(e){return t(e,n)})}if(typeof r==="object"){var e=Object.keys(r);return e.some(function(e){return n(e)||t(r[e],n)})}return false}},{}],19:[function(e,t,r){arguments[4][6][0].apply(r,arguments)},{"./lib/index":22,dup:6}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.RejectingValidator=r.AggregatingValidator=undefined;var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();var i=e("@wix/wix-data-utils");var a=e("./errors");function o(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var l=function(){function e(){s(this,e);this._validations=[]}n(e,[{key:"arityIsZero",value:function e(t){var r=this;return this.addValidation(function(){return t.length===0},function(){return a.messages.arityValidations.arityIsZero(r.operatorName)})}},{key:"arityIsOne",value:function e(t){var r=this;return this.addValidation(function(){return t.length===1},function(){return a.messages.arityValidations.arityIsOne(r.operatorName)})}},{key:"arityIsTwo",value:function e(t){var r=this;return this.addValidation(function(){return t.length===2},function(){return a.messages.arityValidations.arityIsTwo(r.operatorName)})}},{key:"arityIsThree",value:function e(t){var r=this;return this.addValidation(function(){return t.length===3},function(){return a.messages.arityValidations.arityIsThree(r.operatorName)})}},{key:"arityIsAtLeastTwo",value:function e(t){var r=this;return this.addValidation(function(){return t.length>=2},function(){return a.messages.arityValidations.arityIsAtLeastTwo(r.operatorName)})}},{key:"arityIsAtLeastOne",value:function e(t){var r=this;return this.addValidation(function(){return t.length>=1},function(){return a.messages.arityValidations.arityIsAtLeastOne(r.operatorName)})}},{key:"addValidation",value:function e(t,r){this._validations.push({predicateFn:t,messageFn:r});return this}}]);return e}();var c=r.AggregatingValidator=function(e){u(r,e);function r(e){s(this,r);var t=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));t._invalidArguments=(0,i.clone)(e);return t}n(r,[{key:"validateAndAggregate",value:function e(){var n=this;var t=this._validations.every(function(e){var t=e.predicateFn,r=e.messageFn;return n._appendIfInvalid(t(),r())});return[this._invalidArguments,t]}},{key:"_appendIfInvalid",value:function e(t,r){if(!t){this._invalidArguments.push(r);return false}return true}}]);return r}(l);var f=r.RejectingValidator=function(e){u(t,e);function t(){s(this,t);return o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}n(t,[{key:"validateAndReject",value:function e(){var t=this;return Promise.resolve().then(function(){t._validations.forEach(function(e){var t=e.predicateFn,r=e.messageFn;if(!t()){throw(0,a.validationError)(r())}})})}}]);return t}(l)},{"./errors":21,"@wix/wix-data-utils":24}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.DATA_HOOK_ERROR_NAME=r.codes=r.messages=undefined;r.wixDataError=c;r.validationError=f;r.isDataHookError=v;r.dataHookError=p;r.schemaNotFoundError=h;r.BulkError=m;var i=e("@wix/wix-data-utils");var n=e("@wix/cloud-base-errors-definitions");var a=e("safe-json-stringify");var o=u(a);function u(e){return e&&e.__esModule?e:{default:e}}var s=r.messages={collectionNameMustBeAString:function e(){return"WDE0001: Collection name must be a string."},itemIdMustBeAString:function e(){return"WDE0002: ItemId must be a string."},itemIdsMustBeArrayOfStrings:function e(){return"WDE0068: Item ids must be an array of strings"},removeItemsMustBeLessThanThousand:function e(t){return"WDE0069: Failed to remove items from ["+t+"].\nCannot remove more than 1000 items in one request"},fieldNameMustBeAString:function e(){return"WDE0003: FieldName must be a string."},itemMustBeAnObject:function e(t,r){return"WDE0004: Failed to save ["+t+"] into ["+r+"].\nItems must be JavaScript objects."},itemsMustBeArrayOfObjects:function e(t){return"WDE0005: Failed to bulk save items into ["+t+"].\nItems must be an array of JavaScript objects and itemIds must be strings if present."},itemsMustBeLessThanThousand:function e(t){return"WDE0006: Failed to bulk save items into ["+t+"].\nCannot insert more than 1000 items in one request"},updateItemInvalid:function e(){return"WDE0007: Invalid update. Updated object must have a string _id property."},invalidArgumentLength:function e(t,r,n,i){return"WDE0008: wixData."+t+" expects between "+r+" and "+n+" arguments, but was called with "+i+"."},documentTooLarge:function e(){return"WDE0009: Document is too large."},aggregateValidations:{aggregateInvalid:function e(t,r){return"Failed to perform aggregation on ["+t+"].\n"+r.join("\n")},filterMustBeBuilder:function e(t){return"WDE0011: Invalid "+t+" usage. "+t+" requires WixDataFilter."},filterIsAlreadySet:function e(t){return"WDE0012: Invalid "+t+" usage. Filter is already set."},groupIsAlreadySet:function e(t){return"WDE0013: Invalid "+t+" usage. Group is already set."}},filterBuilderInvalid:function e(t){return"Failed to build a filter.\n"+t.join("\n")+"."},groupBuilderInvalid:function e(t){return"Failed to build group.\n"+t.join("\n")+"."},filterMustBeAnObject:function e(){return"WDE0016: Filter must be an object."},sortBuilderInvalid:function e(t){return"Failed to build a sort.\n"+t.join("\n")+"."},optionsInvalid:function e(t){return"WDE0018: Options must be an object with one or all of the following boolean properties: "+t.join(", ")+"."},referenceOperationParameterError:function e(){return"WDE0019: Reference operation takes a string ID or an object with an ID to be connected."},referenceOperationFieldError:function e(t){return"WDE0020: Provided relationshipAttribute ["+t+"] is not a multi-reference field."},invalidReferenceError:function e(){return"WDE0021: Invalid reference"},multipleMultiRefIncludeError:function e(){return"WDE0022: Unable to execute a query. Only single multi-reference field can be included."},multiRefItemLimitError:function e(){return"WDE0023: Can not fetch more than 50 elements when include is being used on multi-reference field"},fieldIsDeleted:function e(){return"WDE0024: Field is deleted"},schemaDoesNotExist:function e(t){return"WDE0025: The "+t+" collection does not exist. You cannot work with a collection using the Data API before it is created in the Editor."},collectionDeleted:function e(t){return"WDE0026: The "+t+" collection was removed, so you cannot work with it. To restore its data, create a new collection with the same name."},permissionDenied:function e(t,r){return"WDE0027: The current user does not have permissions to "+t+" on the "+r+" collection."},requestTimedOut:function e(){return"WDE0028: Request timed out."},internalAuthorizationProblem:function e(){return"WDE0029: An internal error has occurred while trying to check authorization."},queryValidations:{queryInvalid:function e(t,r){return"Failed to perform query on ["+t+"].\n"+r.join("\n")},collectionNameIsRequired:function e(){return"WDE0031: Collection name is required and must be a string."},isNumber:function e(t,r,n){return"WDE0032: Invalid "+t+" parameter ["+(0,i.typeForDisplay)(n)+"]. "+t+" parameter must be a "+r+" number."},isPositiveNumber:function e(t,r){return"WDE0033: Invalid "+t+" parameter ["+r+"]. "+t+" parameter must be a positive number."},isNonNegativeNumber:function e(t,r){return"WDE0034: Invalid "+t+" parameter ["+r+"]. "+t+" parameter must be a non-negative number."},isInteger:function e(t,r){return"WDE0035: Invalid "+t+" parameter ["+r+"]. "+t+" parameter must be an integer."},notGreaterThan:function e(t,r,n){return"WDE0036: Invalid "+t+" parameter ["+r+"]. "+t+" parameter cannot exceed "+n+"."},invalidSkipParameter:function e(t,r){return"WDE0037: Invalid query on ["+t+"].\nInvalid prev positioned query skip on a negative number "+r+"."}},arityValidations:{arityIsZero:function e(t){return"WDE0038: Invalid "+t+" usage. "+t+" does not take parameters."},arityIsOne:function e(t){return"WDE0039: Invalid "+t+" usage. "+t+" requires one parameter."},arityIsTwo:function e(t){return"WDE0040: Invalid "+t+" usage. "+t+" requires two parameters."},arityIsThree:function e(t){return"WDE0041: Invalid "+t+" usage. "+t+" requires three parameters."},arityIsAtLeastTwo:function e(t){return"WDE0042: Invalid "+t+" usage. "+t+" requires at least two parameters."},arityIsAtLeastOne:function e(t){return"WDE0043: Invalid "+t+" usage. "+t+" requires at least one parameter."}},filterValidations:{typeIsString:function e(t,r){return"WDE0044: Invalid "+t+" parameter value ["+(0,i.typeForDisplay)(r)+"]. "+t+" parameter must be a String."},typeIsStringNumberOrDate:function e(t,r){return"WDE0045: Invalid "+t+" parameter value ["+(0,i.typeForDisplay)(r)+"]. Valid "+t+" parameter types are String, Number or Date."},sameType:function e(t,r,n){return"WDE0046: Invalid "+t+" parameter values ["+(0,i.typeForDisplay)(r)+"] and ["+(0,i.typeForDisplay)(n)+"]. Both parameters must be of the same type."},typeIsStringNumberOrDateForAll:function e(t){return"WDE0047: Invalid "+t+" usage. "+t+" supports only Number, String or Date items."},validFieldName:function e(t,r){return"WDE0048: Invalid "+t+" field value ["+(0,i.typeForDisplay)(r)+"]. "+t+" field must be a String."},isInstanceOfSameClass:function e(t,r,n){return"WDE0049: Invalid "+t+" parameter ["+(0,i.typeForDisplay)(n)+"]. "+t+" expects "+r+" only."},isForCollection:function e(t,r,n){return"WDE0050: Invalid "+t+" parameter query for ["+n+"]. "+t+" accepts "+r+" for the same collection only."},incorrectDraftPublishFilter:function e(){return"WDE0093: Invalid filter for _status field, only .eq and .ne filters are allowed with 'Draft' and 'Published' possible values."}},filterTreeValidations:{objectType:function e(t){return"WDE0056: "+t+" should be an Object. Got ${0} instead"},arrayType:function e(t){return"WDE0057: "+t+" should be an Array. Got ${0} instead"},arrayLength:function e(t,r){return"WDE0057: ${0}.length is ${0/length}. "+t+" Array should have length "+r},comparisonOperatorType:function e(t){return"WDE0058: "+t+" should be a Date, Number, or String. Got ${0} instead"},stringOperatorType:function e(t){return"WDE0059: "+t+" should be a String. Got ${0} instead"},setOperatorItems:function e(t){return"WDE0060: "+t+" Array should only contain values of types Date, Number, and String. Got ${0} instead"},inOperatorItems:function e(){return"WDE0061: $in Array should have length 2, and match [String, Number]. Got ${0} instead"},matchesOperatorRequiredProperty:function e(t){return"WDE0062: $matches value ${0} does not have property "+t},matchesOperatorIgnoreCase:function e(){return"WDE0063: $matches.ignoreCase should equal true. Got ${0/ignoreCase} instead"},matchesOperatorSpecItems:function e(){return'WDE0064: $matches.spec Array values should be either {"type":"anyOf","value":" -"} or {"type":"literal","value":String}. Got ${0} instead'},regexNotAllowed:function e(){return"WDE0070: $regex keyword is not allowed."}},sortValidations:{typeIsStringOrArrayOfStrings:function e(t,r){return"WDE0051: Invalid "+t+" parameters ["+r.map(i.typeForDisplay)+"]. Valid "+t+" values are String, Array of String or varargs String."}},orderByValidations:{sortModelType:function e(){return"WDE0065: Sort Model should be an Array. Got ${0} instead"},sortModelItemType:function e(){return"WDE0066: Sort Model Array should contain values of type Object only. Got ${0} instead"},sortModelItem:function e(){return'WDE0067: Sort Model Array items should have a single property with value "asc" or "desc". Got ${0} instead'}},siteIsInTemplateMode:function e(){return"WDE0052: The current site is in template mode. Please save it to modify data."},internalError:function e(t){return"WDE0053: Internal wixData error: "+t},serverGeneralError:function e(){return"WDE0054: The server could not fulfill the request."},serverInvalidResponse:function e(){return"WDE0055: Failed to parse server response."},tooManyRequests:function e(){return"WDE0014: Too many requests."},operationNotSupported:function e(t,r){return t+" does not support "+r+" operation."},databaseQuotaExceeded:function e(){return"WDE0091: Database quota exceeded. Delete some data and try again."},itemDoesNotExist:function e(t,r){return"WDE0073: Item ["+t+"] does not exist in collection ["+r+"]."},invalidLimit:function e(t){return"WDE0077: 'limit' cannot exceed "+t},datasetTooLargeToSort:function e(){return"WDE0092: Dataset is too large to sort."}};var l=r.codes={ItemDoesNotExist:"WD_ITEM_DOES_NOT_EXIST",ItemAlreadyExists:"WD_ITEM_ALREADY_EXISTS",SiteInTemplateMode:"WD_SITE_IN_TEMPLATE_MODE",UnknownError:"WD_UNKNOWN_ERROR",ValidationError:"WD_VALIDATION_ERROR",CollectionDeleted:"WD_COLLECTION_DELETED",SchemaDoesNotExist:"WD_SCHEMA_DOES_NOT_EXIST",PermissionDenied:"WD_PERMISSION_DENIED",BadRequest:"WD_BAD_REQUEST",Unauthorized:"WD_UNAUTHORIZED",TooManyRequests:"WD_TOO_MANY_REQUESTS",RequestTimedOut:"WD_REQUEST_TIMED_OUT",QuotaExceeded:"WD_DATABASE_QUOTA_EXCEEDED",QueryExecutionError:"WD_QUERY_EXECUTION_ERROR"};function c(e,t){return y(e,t)}function f(e){return y(e,l.ValidationError)}var d=r.DATA_HOOK_ERROR_NAME="WixDataHookError";function v(e){return e instanceof Error&&e.name===d}function p(e){function t(e){if(e===undefined){return{type:"undefined"}}else if(e instanceof Error){return{type:"error",value:e.message}}else{return{type:"value",value:e}}}function r(e){return(0,o.default)(e)}var n=new Error(r(t(e)));n.name=d;n.originalError=e;if(Error.captureStackTrace){Error.captureStackTrace(n,p)}return n}function y(e,t){var r=t&&t!==l.UnknownError?g:Error;var n=new r(e);n.code=t;return n}function h(e){return c(s.schemaDoesNotExist(e),l.SchemaDoesNotExist)}function m(e,t,r,n){var i=new Error(e);if(n){i.name=n}i.code=t;i.item=r;Object.setPrototypeOf(i,Object.getPrototypeOf(this));if(Error.captureStackTrace){Error.captureStackTrace(i,m)}return i}m.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:false,writable:true,configurable:true}});function g(e){var t=new n.UserCodeError(e);Object.setPrototypeOf(t,Object.getPrototypeOf(this));if(Error.captureStackTrace){Error.captureStackTrace(t,g)}t.name=Error.name;return t}g.prototype=Object.create(n.UserCodeError.prototype,{constructor:{value:g,enumerable:false,writable:true,configurable:true}})},{"@wix/cloud-base-errors-definitions":5,"@wix/wix-data-utils":24,"safe-json-stringify":30}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.RejectingValidator=r.AggregatingValidator=r.apiValidator=r.BulkError=r.schemaNotFoundError=r.dataHookError=r.isDataHookError=r.DATA_HOOK_ERROR_NAME=r.validationError=r.wixDataError=r.codes=r.messages=undefined;var n=e("./validations");var i=e("./base-validator");var a=e("./errors");r.messages=a.messages;r.codes=a.codes;r.wixDataError=a.wixDataError;r.validationError=a.validationError;r.DATA_HOOK_ERROR_NAME=a.DATA_HOOK_ERROR_NAME;r.isDataHookError=a.isDataHookError;r.dataHookError=a.dataHookError;r.schemaNotFoundError=a.schemaNotFoundError;r.BulkError=a.BulkError;r.apiValidator=n.apiValidator;r.AggregatingValidator=i.AggregatingValidator;r.RejectingValidator=i.RejectingValidator},{"./base-validator":20,"./errors":21,"./validations":23}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}}();r.apiValidator=f;var a=e("./errors");var i=e("@wix/wix-data-utils");var o=e("./base-validator");function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){l(t,e);function t(){u(this,t);return s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}n(t,[{key:"arity",value:function e(t,r,n,i){return this.addValidation(function(){return r.length<=i&&r.length>=n},function(){return a.messages.invalidArgumentLength(t,n,i,r.length)})}},{key:"_isObject",value:function e(t,r){return this.addValidation(function(){return(0,i.isObject)(t)},function(){return a.messages.itemMustBeAnObject(t,r)})}},{key:"item",value:function e(t,r,n){return this._isObject(t,r).addValidation(function(){return t._id!==undefined?(0,i.isString)(t._id):!n},function(){return a.messages.updateItemInvalid()})}},{key:"items",value:function e(t,r){return this.addValidation(function(){return(0,i.isArray)(t)&&t.every(function(e){return(0,i.isObject)(e)&&(e._id===undefined||e._id===null||(0,i.isString)(e._id))})},function(){return a.messages.itemsMustBeArrayOfObjects(r)}).addValidation(function(){return t.length<=1e3},function(){return a.messages.itemsMustBeLessThanThousand(r)})}},{key:"fieldName",value:function e(t){return this.addValidation(function(){return(0,i.isString)(t)},function(){return a.messages.fieldNameMustBeAString()})}},{key:"itemId",value:function e(t){return this.addValidation(function(){return(0,i.isString)(t)},function(){return a.messages.itemIdMustBeAString()})}},{key:"itemIds",value:function e(t,r){return this.addValidation(function(){return(0,i.isArray)(t)&&t.every(function(e){return(0,i.isString)(e)})},function(){return a.messages.itemIdsMustBeArrayOfStrings()}).addValidation(function(){return t.length<=1e3},function(){return a.messages.removeItemsMustBeLessThanThousand(r)})}},{key:"_options",value:function e(t,r){return this.addValidation(function(){var e=(0,i.isObject)(t)&&r.every(function(e){return d(t[e])});return t==null||e},function(){return a.messages.optionsInvalid(r)})}},{key:"referenceRemoveParameters",value:function e(t){return this.addValidation(function(){return(0,i.isArray)(t)&&t.every(p)},a.messages.referenceOperationParameterError)}},{key:"referenceParameters",value:function e(t){return this.addValidation(function(){return(0,i.isArray)(t)&&t.every(v)},a.messages.referenceOperationParameterError)}},{key:"referenceParameter",value:function e(t){return this.addValidation(function(){return v(t)},a.messages.referenceOperationParameterError)}},{key:"references",value:function e(t){return this.addValidation(function(){return(0,i.isArray)(t)&&t.every(function(e){return(0,i.isString)(e.relationshipName)&&v(e.left)&&v(e.right)})},a.messages.invalidReferenceError)}},{key:"options",value:function e(t){return this._options(t,["suppressAuth","suppressHooks"])}},{key:"bulkInsertOptions",value:function e(t){return this._options(t,["suppressAuth","suppressHooks","overrideExisting"])}},{key:"bulkUpdateOptions",value:function e(t){return this._options(t,["suppressAuth","suppressHooks"])}},{key:"bulkRemoveOptions",value:function e(t){return this._options(t,["suppressAuth","suppressHooks"])}},{key:"truncateOptions",value:function e(t){return this._options(t,["suppressAuth"])}},{key:"collectionName",value:function e(t){return this.addValidation(function(){return(0,i.isString)(t)},function(){return a.messages.collectionNameMustBeAString()})}}]);return t}(o.RejectingValidator);function f(){return new c}function d(e){return e==null||(0,i.isBoolean)(e)}function v(e){return(0,i.isString)(e)&&e!=""||(0,i.isObject)(e)&&e.hasOwnProperty("_id")}function p(e){return(0,i.isString)(e)||(0,i.isObject)(e)&&e.hasOwnProperty("_id")}},{"./base-validator":20,"./errors":21,"@wix/wix-data-utils":24}],24:[function(e,t,r){arguments[4][6][0].apply(r,arguments)},{"./lib/index":26,dup:6}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.default=a;var i=e("./type-utils");function a(e){if(e==null||(typeof e==="undefined"?"undefined":n(e))!=="object"){return e}var t=null;if((0,i.isDate)(e)){t=new Date(e.getTime())}else{t=e.constructor();for(var r in e){t[r]=a(e[r])}}return t}},{"./type-utils":28}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.parseEntityJson=r.stringifyEntityJson=r.isNull=r.isUndefined=r.typeForDisplay=r.isFunction=r.isString=r.isBoolean=r.isNumber=r.isDate=r.isArray=r.isObject=r.clone=undefined;var n=e("./clone");var i=u(n);var a=e("./type-utils");var o=e("./serialization");function u(e){return e&&e.__esModule?e:{default:e}}r.clone=i.default;r.isObject=a.isObject;r.isArray=a.isArray;r.isDate=a.isDate;r.isNumber=a.isNumber;r.isBoolean=a.isBoolean;r.isString=a.isString;r.isFunction=a.isFunction;r.typeForDisplay=a.typeForDisplay;r.isUndefined=a.isUndefined;r.isNull=a.isNull;r.stringifyEntityJson=o.stringifyEntityJson;r.parseEntityJson=o.parseEntityJson},{"./clone":25,"./serialization":27,"./type-utils":28}],27:[function(e,t,r){"use strict";function n(e){if(Object.prototype.toString.call(e)!=="[object Date]"){return false}return!isNaN(e.getTime())}var i=function e(t){return!Number.isNaN(Date.parse(t))};function a(e){var n=null;return JSON.parse(e,function(e,t){if(e==="$date"&&i(t)){n=new Date(t)}else if(e==="$date"){n={$date:t}}else if(n!==null){var r=n;n=null;return r}else{return t}})}function o(e){function t(e,t){var r=this;return u.call(r,e,t)}return JSON.stringify(e,t)}function u(e,t,r){if(e&&n(this[e])){return s(this[e])}if(r){return r(e,t)}else{return t}}function s(e){return{$date:e.toJSON()}}t.exports={stringifyEntityJson:o,parseEntityJson:a}},{}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.isObject=o;r.isArray=u;r.isDate=s;r.isNumber=l;r.isBoolean=c;r.isString=f;r.isFunction=d;r.typeForDisplay=v;r.isUndefined=p;r.isNull=y;var n=e("kind-of");var i=a(n);function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return(0,i.default)(e)==="object"}function u(e){return(0,i.default)(e)==="array"}function s(e){return(0,i.default)(e)==="date"}function l(e){return(0,i.default)(e)==="number"}function c(e){return(0,i.default)(e)==="boolean"}function f(e){return(0,i.default)(e)==="string"}function d(e){return(0,i.default)(e)==="function"}function v(e){return h((0,i.default)(e))}function p(e){return(0,i.default)(e)==="undefined"}function y(e){return(0,i.default)(e)==="null"}function h(e){if(!f(e)){return e}var t=e.slice(0,1).toUpperCase();var r=e.slice(1,e.length);return t+r}},{"kind-of":29}],29:[function(e,t,r){var n=Object.prototype.toString;t.exports=function e(t){var r=typeof t;if(r==="undefined"){return"undefined"}if(t===null){return"null"}if(t===true||t===false||t instanceof Boolean){return"boolean"}if(r==="string"||t instanceof String){return"string"}if(r==="number"||t instanceof Number){return"number"}if(r==="function"||t instanceof Function){if(typeof t.constructor.name!=="undefined"&&t.constructor.name.slice(0,9)==="Generator"){return"generatorfunction"}return"function"}if(typeof Array.isArray!=="undefined"&&Array.isArray(t)){return"array"}if(t instanceof RegExp){return"regexp"}if(t instanceof Date){return"date"}r=n.call(t);if(r==="[object RegExp]"){return"regexp"}if(r==="[object Date]"){return"date"}if(r==="[object Arguments]"){return"arguments"}if(r==="[object Error]"){return"error"}if(r==="[object Promise]"){return"promise"}if(i(t)){return"buffer"}if(r==="[object Set]"){return"set"}if(r==="[object WeakSet]"){return"weakset"}if(r==="[object Map]"){return"map"}if(r==="[object WeakMap]"){return"weakmap"}if(r==="[object Symbol]"){return"symbol"}if(r==="[object Map Iterator]"){return"mapiterator"}if(r==="[object Set Iterator]"){return"setiterator"}if(r==="[object Int8Array]"){return"int8array"}if(r==="[object Uint8Array]"){return"uint8array"}if(r==="[object Uint8ClampedArray]"){return"uint8clampedarray"}if(r==="[object Int16Array]"){return"int16array"}if(r==="[object Uint16Array]"){return"uint16array"}if(r==="[object Int32Array]"){return"int32array"}if(r==="[object Uint32Array]"){return"uint32array"}if(r==="[object Float32Array]"){return"float32array"}if(r==="[object Float64Array]"){return"float64array"}return"object"};function i(e){return e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}},{}],30:[function(e,t,r){var n=Object.prototype.hasOwnProperty;function o(e){return"[Throws: "+(e?e.message:"?")+"]"}function u(e,t){if(n.call(e,t)){try{return e[t]}catch(e){return o(e)}}return e[t]}function i(e){var i=[];function a(r){if(r===null||typeof r!=="object"){return r}if(i.indexOf(r)!==-1){return"[Circular]"}i.push(r);if(typeof r.toJSON==="function"){try{var e=a(r.toJSON());i.pop();return e}catch(e){return o(e)}}if(Array.isArray(r)){var t=r.map(a);i.pop();return t}var n=Object.keys(r).reduce(function(e,t){e[t]=a(u(r,t));return e},{});i.pop();return n}return a(e)}t.exports=function(e,t,r){return JSON.stringify(i(e),t,r)};t.exports.ensureProperties=i},{}],"wix-data":[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.wixData=undefined;var n=e("./create-wix-data");var i=a(n);function a(e){return e&&e.__esModule?e:{default:e}}var o=r.wixData=(0,i.default)(elementorySupport);r.default=o},{"./create-wix-data":2}]},{},[]);(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.elementorySupport=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";var elementorySupportFactory=require(".");module.exports=elementorySupportFactory()},{".":3}],2:[function(require,module,exports){"use strict";module.exports={PARSE:"parsererror",ERROR:"error",ABORT:"abort",TIMEOUT:"timeout"}},{}],3:[function(require,module,exports){"use strict";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var _require=require("@wix/cloud-elementory-client-core"),serialize=_require.serialize,deserialize=_require.deserialize,getPathWithBaseUrl=require("./paths"),errorTypes=require("./error-types"),THIRTY_SECONDS=3e4,NO_XHR_STATUS_ERROR_MESSAGE="Request aborted",TIMEOUT_ERROR_MESSAGE="Request timed out";module.exports=function(e,r,t){return{baseUrl:e,queryParameters:r,currentPath:t,options:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},errorTypes:errorTypes,getJSON:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=this.currentPath?location.href.replace(this.currentPath,e):getPathWithBaseUrl(this.baseUrl,e,this.queryParameters),o=this.options,n=o.headers,i=void 0===n?{}:n,s=o.withCredentials,a=void 0!==s&&s,u=o.timeout,c=void 0===u?THIRTY_SECONDS:u,p=_objectSpread(_objectSpread({},i),{},{"Content-Type":"application/json"});return new Promise(function(e,o){var n=new XMLHttpRequest;function i(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=new Error(r);return t.xhr=n,t.errorType=e,t}n.withCredentials=a;var s=setTimeout(function(){o(i(errorTypes.TIMEOUT,TIMEOUT_ERROR_MESSAGE)),n.abort()},c);n.open("POST",t,!0),n.onerror=function(){return o(i(errorTypes.ERROR,n.statusText))},n.onreadystatechange=function(){if(4===n.readyState)if(clearTimeout(s),200===n.status)try{var r=deserialize(n.responseText),t=r.isError,a=r.payload;t?o(a):e(a)}catch(e){o(i(errorTypes.PARSE,e.message))}else{var u=n.status?errorTypes.ERROR:errorTypes.ABORT,c=n.status?n.statusText:NO_XHR_STATUS_ERROR_MESSAGE;o(i(u,c))}},Object.keys(p).forEach(function(e){return n.setRequestHeader(e,p[e])}),n.send(serialize(r))})}}}},{"./error-types":2,"./paths":4,"@wix/cloud-elementory-client-core":6}],4:[function(require,module,exports){"use strict";var sanitize=function(t){return t.startsWith("?")||t.startsWith("&")?t.substr(1):t};module.exports=function(t,n,c){if(!c)return t+n;var r=sanitize(c);return-1===n.indexOf("?")?"".concat(t).concat(n,"?").concat(r):"".concat(t).concat(n,"&").concat(r)}},{}],5:[function(require,module,exports){"use strict";var _require=require("@wix/cloud-elementory-protocol"),convertFromCustomFormat=_require.convertFromCustomFormat,convertToErrorObject=function(r){var e=new Error(r.message);return e.stack=r.stack,e.name=r.name,e.code=r.code,e},deserialize=function(r){var e=convertFromCustomFormat(JSON.parse(r)),o=e.result;return{isError:!!e.exception,payload:o&&o._elementoryError?convertToErrorObject(o):o}};module.exports={deserialize:deserialize}},{"@wix/cloud-elementory-protocol":12}],6:[function(require,module,exports){"use strict";var _require=require("./serialize"),serialize=_require.serialize,_require2=require("./deserialize"),deserialize=_require2.deserialize;module.exports={serialize:serialize,deserialize:deserialize}},{"./deserialize":5,"./serialize":7}],7:[function(require,module,exports){"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=r[t];return o}var _require=require("@wix/cloud-elementory-protocol"),convertToCustomFormat=_require.convertToCustomFormat,serialize=function(r){return JSON.stringify(convertToCustomFormat(_toConsumableArray(r)))};module.exports={serialize:serialize}},{"@wix/cloud-elementory-protocol":12}],8:[function(require,module,exports){"use strict";function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var e=0;e<r.length;e++){var o=r[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,r,e){return r&&_defineProperties(t.prototype,r),e&&_defineProperties(t,e),t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var _require=require("../mapValues"),mapValues=_require.mapValues,isObjectButNotNull=function(t){return null!==t&&"object"===_typeof(t)},ConvertersComposer=function(){function t(){_classCallCheck(this,t);for(var r=arguments.length,e=new Array(r),o=0;o<r;o++)e[o]=arguments[o];this._converters=e}return _createClass(t,[{key:"convertToCustomFormat",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(isObjectButNotNull(t)){if(r.has(t))throw new TypeError("Converting circular structure to JSON");r.add(t)}if(Array.isArray(t))return this._convertArray(t,r);var o=this._findConverterToCustomFormat(t).convertToCustomFormat(t,e);return isObjectButNotNull(t)?this._convertObject(o,t,r):o}},{key:"convertFromCustomFormat",value:function(t){var r=this,e=t;return Array.isArray(t)?e=t.map(function(t){return r.convertFromCustomFormat(t)}):isObjectButNotNull(t)&&(e=mapValues(t,this.convertFromCustomFormat.bind(this))),this._findConverterFromCustomFormat(e).convertFromCustomFormat(e)}},{key:"_convertObject",value:function(t,r,e){var o,n=this;return o="function"==typeof t.toJSON?mapValues(t.toJSON(),function(t){return n.convertToCustomFormat(t,e)}):mapValues(t,function(t){return n.convertToCustomFormat(t,e)}),e.delete(r),o}},{key:"_convertArray",value:function(t,r){var e=this,o=t.map(function(t){return e.convertToCustomFormat(t,r,!0)});return r.delete(t),o}},{key:"_findConverterFromCustomFormat",value:function(t){return this._converters.find(function(r){return r.canConvertFromCustomFormat(t)})}},{key:"_findConverterToCustomFormat",value:function(t){return this._converters.find(function(r){return r.canConvertToCustomFormat(t)})}}]),t}();module.exports={ConvertersComposer:ConvertersComposer}},{"../mapValues":13}],9:[function(require,module,exports){"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var isDateString=function(e){return!Number.isNaN(Date.parse(e))},DateConverter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canConvertToCustomFormat",value:function(e){return e instanceof Date}},{key:"convertToCustomFormat",value:function(e){return{$date:e.toISOString()}}},{key:"canConvertFromCustomFormat",value:function(e){return e&&"object"===_typeof(e)&&"$date"in e&&isDateString(e.$date)}},{key:"convertFromCustomFormat",value:function(e){return new Date(e.$date)}}]),e}();module.exports={DateConverter:DateConverter}},{}],10:[function(require,module,exports){"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var DefaultConverter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canConvertToCustomFormat",value:function(){return!0}},{key:"convertToCustomFormat",value:function(e,r){return r&&void 0===e?null:e}},{key:"canConvertFromCustomFormat",value:function(){return!0}},{key:"convertFromCustomFormat",value:function(e){return e}}]),e}();module.exports={DefaultConverter:DefaultConverter}},{}],11:[function(require,module,exports){"use strict";var _require=require("./DefaultConverter"),DefaultConverter=_require.DefaultConverter,_require2=require("./DateConverter"),DateConverter=_require2.DateConverter,_require3=require("./ConvertersComposer"),ConvertersComposer=_require3.ConvertersComposer,composedConverters=new ConvertersComposer(new DateConverter,new DefaultConverter);module.exports={convertToCustomFormat:function(e){return composedConverters.convertToCustomFormat(e)},convertFromCustomFormat:function(e){return composedConverters.convertFromCustomFormat(e)}}},{"./ConvertersComposer":8,"./DateConverter":9,"./DefaultConverter":10}],12:[function(require,module,exports){"use strict";var _require=require("../dist/converter"),convertToCustomFormat=_require.convertToCustomFormat,convertFromCustomFormat=_require.convertFromCustomFormat,_require2=require("../dist/web-method-protocol"),resultToWebMethodPayload=_require2.resultToWebMethodPayload,exceptionToWebMethodPayload=_require2.exceptionToWebMethodPayload;module.exports={convertToCustomFormat:convertToCustomFormat,convertFromCustomFormat:convertFromCustomFormat,resultToWebMethodPayload:resultToWebMethodPayload,exceptionToWebMethodPayload:exceptionToWebMethodPayload}},{"../dist/converter":11,"../dist/web-method-protocol":14}],13:[function(require,module,exports){"use strict";function mapValues(a,e){var u={};return Object.keys(a).forEach(function(r){var s=e(a[r]);void 0!==s&&(u[r]=s)}),u}module.exports={mapValues:mapValues}},{}],14:[function(require,module,exports){"use strict";var _require=require("../converter"),convertToCustomFormat=_require.convertToCustomFormat,resultToWebMethodPayload=function(e,o){var t=o?JSON.parse(JSON.stringify(e,o)):convertToCustomFormat(e);return void 0===t?{}:{result:t}},exceptionToWebMethodPayload=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return""};return{result:e instanceof Error?{message:o(e.message),name:e.name,stack:t(e.stack),code:e.code,_elementoryError:!0}:e,exception:!0}};module.exports={resultToWebMethodPayload:resultToWebMethodPayload,exceptionToWebMethodPayload:exceptionToWebMethodPayload}},{"../converter":11}]},{},[1])(1)});