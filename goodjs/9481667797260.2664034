!function(){"use strict";function i(e){const t=[];for(const i of function(){try{return document.cookie.split(";")}catch(e){return[]}}()){var[r,n]=i.trim().split("=");e===r&&void 0!==n&&t.push({key:r,value:n})}return t}function r(){let e="";const t=i("_octo"),r=[];for(const i of t){const t=i.value.split(".");if("GH1"===t.shift()&&1<t.length){const i=(t.shift()||"").split("-");1===i.length&&(i[1]="1");var n=[Number(i[0]),Number(i[1])];e=t.join("."),r.push([n,e])}}return e="",0<r.length&&(e=String(r.sort().reverse()[0][1])),e}var o="<unknown>";function n(e){return e.split("\n").reduce(function(e,i){var t,r,t=function(){var e=a.exec(i);if(!e)return null;var t=e[2]&&0===e[2].indexOf("native"),r=e[2]&&0===e[2].indexOf("eval"),n=s.exec(e[2]);return r&&null!=n&&(e[2]=n[1],e[3]=n[2],e[4]=n[3]),{file:t?null:e[2],methodName:e[1]||o,arguments:t?[e[2]]:[],lineNumber:e[3]?+e[3]:null,column:e[4]?+e[4]:null}}()||((r=u.exec(i))?{file:r[2],methodName:r[1]||o,arguments:[],lineNumber:+r[3],column:r[4]?+r[4]:null}:null)||function(){var e=l.exec(i);if(!e)return null;var t=e[3]&&-1<e[3].indexOf(" > eval"),r=c.exec(e[3]);return t&&null!=r&&(e[3]=r[1],e[4]=r[2],e[5]=null),{file:e[3],methodName:e[1]||o,arguments:e[2]?e[2].split(","):[],lineNumber:e[4]?+e[4]:null,column:e[5]?+e[5]:null}}()||((r=f.exec(i))?{file:r[2],methodName:r[1]||o,arguments:[],lineNumber:+r[3],column:r[4]?+r[4]:null}:null)||((t=d.exec(i))?{file:t[3],methodName:t[1]||o,arguments:[],lineNumber:+t[4],column:t[5]?+t[5]:null}:null);return t&&e.push(t),e},[])}var a=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,s=/\((\S*)(?::(\d+))(?::(\d+))\)/,u=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,l=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,c=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,d=/^\s*(?:([^@]*)(?:\((.*?)\))?@)?(\S.*?):(\d+)(?::(\d+))?\s*$/i,f=/^\s*at (?:((?:\[object object\])?[^\\/]+(?: \[as \S+\])?) )?\(?(.*?):(\d+)(?::(\d+))?\)?\s*$/i;function E(e){e=document.querySelectorAll(e);if(0<e.length)return e[e.length-1]}let e=!1;window.addEventListener("pageshow",()=>e=!1),window.addEventListener("pagehide",()=>e=!0);var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function g(e,t){return e(t={exports:{}},t.exports),t.exports}var _=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(n.prototype.handleError=function(e){},n);function n(){}var i=new(t.NoopErrorHandler=r);t.setErrorHandler=function(e){i=e},t.getErrorHandler=function(){return i},t.resetErrorHandler=function(){i=new r}});t(_),_.NoopErrorHandler,_.setErrorHandler,_.getErrorHandler,_.resetErrorHandler;var h=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),(t=t.LogLevel||(t.LogLevel={}))[t.NOTSET=0]="NOTSET",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARNING=3]="WARNING",t[t.ERROR=4]="ERROR"});t(h),h.LogLevel;for(var v=g(function(e){var t,r,n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);n?(t=new Uint8Array(16),e.exports=function(){return n(t),t}):(r=new Array(16),e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r})}),I=[],y=0;y<256;++y)I[y]=(y+256).toString(16).substr(1);function m(e,t){var r=t||0;return[(t=I)[e[r++]],t[e[r++]],t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],t[e[r++]],t[e[r++]],t[e[r++]],t[e[+r]]].join("")}var R,N,O=0,T=0,A=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||v)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[n+o]=i[o];return t||m(i)},L=A;L.v1=function(e,t,r){var n=t&&r||0,i=t||[],o=(e=e||{}).node||R,a=void 0!==e.clockseq?e.clockseq:N;null!=o&&null!=a||(u=v(),null==o&&(o=R=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==a&&(a=N=16383&(u[6]<<8|u[7])));var s=void 0!==e.msecs?e.msecs:(new Date).getTime(),r=void 0!==e.nsecs?e.nsecs:T+1,u=s-O+(r-T)/1e4;if(u<0&&void 0===e.clockseq&&(a=a+1&16383),1e4<=(r=(u<0||O<s)&&void 0===e.nsecs?0:r))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");O=s,N=a;r=(1e4*(268435455&(s+=122192928e5))+(T=r))%4294967296;i[n++]=r>>>24&255,i[n++]=r>>>16&255,i[n++]=r>>>8&255,i[n++]=255&r;s=s/4294967296*1e4&268435455;i[n++]=s>>>8&255,i[n++]=255&s,i[n++]=s>>>24&15|16,i[n++]=s>>>16&255,i[n++]=a>>>8|128,i[n++]=255&a;for(var l=0;l<6;++l)i[n+l]=o[l];return t||m(i)},L.v4=A;var S=L,U=g(function(e,t){function i(t){return Object.keys(t).map(function(e){return t[e]})}Object.defineProperty(t,"__esModule",{value:!0}),t.getTimestamp=function(){return(new Date).getTime()},t.generateUUID=function(){return S.v4()},t.isValidEnum=function(e,t){for(var r=!1,n=Object.keys(e),i=0;i<n.length;i++)if(t===e[n[i]]){r=!0;break}return r},t.groupBy=function(e,r){var n={};return e.forEach(function(e){var t=r(e);n[t]=n[t]||[],n[t].push(e)}),i(n)},t.objectValues=i,t.objectEntries=function(t){return Object.keys(t).map(function(e){return[e,t[e]]})},t.find=function(e,t){for(var r,n=0,i=e;n<i.length;n++){var o=i[n];if(t(o)){r=o;break}}return r},t.keyBy=function(e,r){var n={};return e.forEach(function(e){var t=r(e);n[t]=e}),n},t.sprintf=function(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var n=0;return e.replace(/%s/g,function(){var e=r[n++],t=typeof e;return"function"==t?e():"string"==t?e:String(e)})},(t=t.NOTIFICATION_TYPES||(t.NOTIFICATION_TYPES={})).ACTIVATE="ACTIVATE:experiment, user_id,attributes, variation, event",t.DECISION="DECISION:type, userId, attributes, decisionInfo",t.LOG_EVENT="LOG_EVENT:logEvent",t.OPTIMIZELY_CONFIG_UPDATE="OPTIMIZELY_CONFIG_UPDATE",t.TRACK="TRACK:event_key, user_id, attributes, event_tags, event"});t(U),U.getTimestamp,U.generateUUID,U.isValidEnum,U.groupBy;var b=U.objectValues,D=(U.objectEntries,U.find,U.keyBy),C=U.sprintf,V=U.NOTIFICATION_TYPES,P=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4};function n(e){return"string"!=typeof e?e:("WARN"===(e=e.toUpperCase())&&(e="WARNING"),r[e]||e)}var i=(s.prototype.getLogger=function(e){return e?(this.loggers[e]||(this.loggers[e]=new c({messagePrefix:e})),this.loggers[e]):this.defaultLoggerFacade},s),o=(a.prototype.log=function(e,t){this.shouldLog(e)&&this.logToConsole&&(t=this.prefix+" - "+this.getLogLevelName(e)+" "+this.getTime()+" "+t,this.consoleLog(e,[t]))},a.prototype.setLogLevel=function(e){e=n(e),U.isValidEnum(h.LogLevel,e)&&void 0!==e?this.logLevel=e:this.logLevel=h.LogLevel.ERROR},a.prototype.getTime=function(){return(new Date).toISOString()},a.prototype.shouldLog=function(e){return e>=this.logLevel},a.prototype.getLogLevelName=function(e){switch(e){case h.LogLevel.DEBUG:return"DEBUG";case h.LogLevel.INFO:return"INFO ";case h.LogLevel.WARNING:return"WARN ";case h.LogLevel.ERROR:return"ERROR";default:return"NOTSET"}},a.prototype.consoleLog=function(e,t){switch(e){case h.LogLevel.DEBUG:console.log.apply(console,t);break;case h.LogLevel.INFO:console.info.apply(console,t);break;case h.LogLevel.WARNING:console.warn.apply(console,t);break;case h.LogLevel.ERROR:console.error.apply(console,t);break;default:console.log.apply(console,t)}},a);function a(e){void 0===e&&(e={}),this.logLevel=h.LogLevel.NOTSET,void 0!==e.logLevel&&U.isValidEnum(h.LogLevel,e.logLevel)&&this.setLogLevel(e.logLevel),this.logToConsole=void 0===e.logToConsole||!!e.logToConsole,this.prefix=void 0!==e.prefix?e.prefix:"[OPTIMIZELY]"}function s(){this.defaultLoggerFacade=new c,this.loggers={}}t.ConsoleLogHandler=o;var u=h.LogLevel.NOTSET,l=null,c=(f.prototype.log=function(e,t){this.internalLog(n(e),{message:t,splat:[]})},f.prototype.info=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(h.LogLevel.INFO,e,t)},f.prototype.debug=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(h.LogLevel.DEBUG,e,t)},f.prototype.warn=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(h.LogLevel.WARNING,e,t)},f.prototype.error=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(h.LogLevel.ERROR,e,t)},f.prototype.format=function(e){return(this.messagePrefix?this.messagePrefix+": ":"")+U.sprintf.apply(void 0,[e.message].concat(e.splat))},f.prototype.internalLog=function(e,t){l&&(e<u||(l.log(e,this.format(t)),t.error&&t.error instanceof Error&&_.getErrorHandler().handleError(t.error)))},f.prototype.namedLog=function(e,t,r){var n,i;if(t instanceof Error)return t=(n=t).message,void this.internalLog(e,{error:n,message:t,splat:r});0!==r.length?((i=r[r.length-1])instanceof Error&&(n=i,r.splice(-1)),this.internalLog(e,{message:t,error:n,splat:r})):this.internalLog(e,{message:t,splat:r})},f),d=new i;function f(e){void 0===e&&(e={}),this.messagePrefix="",e.messagePrefix&&(this.messagePrefix=e.messagePrefix)}t.getLogger=function(e){return d.getLogger(e)},t.setLogHandler=function(e){l=e},t.setLogLevel=function(e){e=n(e),u=U.isValidEnum(h.LogLevel,e)&&void 0!==e?e:h.LogLevel.ERROR},t.getLogLevel=function(){return u},t.resetLogger=function(){d=new i,u=h.LogLevel.NOTSET}});t(P),P.ConsoleLogHandler,P.getLogger,P.setLogHandler,P.setLogLevel,P.getLogLevel,P.resetLogger;var M=g(function(e,r){function t(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),t(_),t(h),t(P)});t(M);var F=M.ConsoleLogHandler,A=M.getLogger,x=M.setLogLevel,k=M.LogLevel,w=M.setLogHandler,B=M.setErrorHandler,G=M.getErrorHandler,K=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.areEventContextsEqual=function(e,t){e=e.context,t=t.context;return e.accountId===t.accountId&&e.projectId===t.projectId&&e.clientName===t.clientName&&e.clientVersion===t.clientVersion&&e.revision===t.revision&&e.anonymizeIP===t.anonymizeIP&&e.botFiltering===t.botFiltering}});t(K),K.areEventContextsEqual;var j=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=M.getLogger("EventProcessor"),i=(a.prototype.start=function(){this.timeoutId=setTimeout(this.callback,this.timeout)},a.prototype.refresh=function(){this.stop(),this.start()},a.prototype.stop=function(){this.timeoutId&&clearTimeout(this.timeoutId)},a),n=(o.prototype.start=function(){},o.prototype.stop=function(){return Promise.resolve()},o.prototype.enqueue=function(e){this.sink([e])},o);function o(e){e=e.sink;this.sink=e}function a(e){var t=e.timeout,e=e.callback;this.timeout=Math.max(t,0),this.callback=e}t.SingleEventQueue=n;s.prototype.start=function(){this.started=!0},s.prototype.stop=function(){this.started=!1;var e=this.sink(this.buffer);return this.buffer=[],this.timer.stop(),e},s.prototype.enqueue=function(e){var t;this.started?((t=this.buffer[0])&&!this.batchComparator(t,e)&&this.flush(),0===this.buffer.length&&this.timer.refresh(),this.buffer.push(e),this.buffer.length>=this.maxQueueSize&&this.flush()):r.warn("Queue is stopped, not accepting event")},s.prototype.flush=function(){this.sink(this.buffer),this.buffer=[],this.timer.stop()},n=s;function s(e){var t=e.flushInterval,r=e.maxQueueSize,n=e.sink,e=e.batchComparator;this.buffer=[],this.maxQueueSize=Math.max(r,1),this.sink=n,this.batchComparator=e,this.timer=new i({callback:this.flush.bind(this),timeout:t}),this.started=!1}t.DefaultEventQueue=n});t(j),j.SingleEventQueue,j.DefaultEventQueue;var Y=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(n.prototype.trackRequest=function(e){var t=this;this.reqsInFlightCount++;function r(){t.reqsInFlightCount--,0===t.reqsInFlightCount&&(t.reqsCompleteResolvers.forEach(function(e){return e()}),t.reqsCompleteResolvers=[])}e.then(r,r)},n.prototype.onRequestsComplete=function(){var t=this;return new Promise(function(e){0===t.reqsInFlightCount?e():t.reqsCompleteResolvers.push(e)})},n);function n(){this.reqsInFlightCount=0,this.reqsCompleteResolvers=[]}t.default=r});t(Y);var H=g(function(e,t){var r=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(Y),a=M.getLogger("EventProcessor"),r=(n.prototype.drainQueue=function(r){var n=this,e=new Promise(function(e){var t;a.debug("draining queue with %s events",r.length),0!==r.length?(t=n.formatEvents(r),n.dispatcher.dispatchEvent(t,function(){e()}),n.notificationCenter&&n.notificationCenter.sendNotifications(U.NOTIFICATION_TYPES.LOG_EVENT,t)):e()});return this.requestTracker.trackRequest(e),e},n.prototype.process=function(e){this.queue.enqueue(e)},n.prototype.stop=function(){try{return this.queue.stop(),this.requestTracker.onRequestsComplete()}catch(e){a.error('Error stopping EventProcessor: "%s"',e.message,e)}return Promise.resolve()},n.prototype.start=function(){this.queue.start()},n);function n(e){var t=e.dispatcher,r=e.flushInterval,n=void 0===r?3e4:r,r=e.maxQueueSize,r=void 0===r?3e3:r,e=e.notificationCenter,i=this;this.dispatcher=t,n<=0&&(a.warn("Invalid flushInterval "+n+", defaulting to 30000"),n=3e4),(r=Math.floor(r))<1&&(a.warn("Invalid maxQueueSize "+r+", defaulting to 10"),r=10),r=Math.max(1,r),this.queue=1<r?new j.DefaultEventQueue({flushInterval:n,maxQueueSize:r,sink:function(e){return i.drainQueue(e)},batchComparator:K.areEventContextsEqual}):new j.SingleEventQueue({sink:function(e){return i.drainQueue(e)}}),this.notificationCenter=e,this.requestTracker=new o.default}t.AbstractEventProcessor=r});t(H),H.AbstractEventProcessor;var q=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=M.getLogger("EventProcessor"),n=(i.prototype.get=function(e){return this.getMap()[e]||null},i.prototype.set=function(e,t){var r=this.getMap();r[e]=t,this.replace(r)},i.prototype.remove=function(e){var t=this.getMap();delete t[e],this.replace(t)},i.prototype.values=function(){return U.objectValues(this.getMap())},i.prototype.clear=function(){this.replace({})},i.prototype.replace=function(e){try{window.localStorage&&localStorage.setItem(this.LS_KEY,JSON.stringify(e)),this.clean()}catch(e){r.error(e)}},i.prototype.clean=function(){var t=this.getMap(),e=Object.keys(t),r=e.length-this.maxValues;if(!(r<1)){var n=e.map(function(e){return{key:e,value:t[e]}});n.sort(function(e,t){return e.value.timestamp-t.value.timestamp});for(var i=0;i<r;i++)delete t[n[i].key];this.replace(t)}},i.prototype.getMap=function(){try{var e=window.localStorage&&localStorage.getItem(this.LS_KEY);if(e)return JSON.parse(e)||{}}catch(e){r.error(e)}return{}},i);function i(e){var t=e.key,e=e.maxValues,e=void 0===e?1e3:e;this.LS_KEY=t,this.maxValues=e}t.LocalStorageStore=n});t(q),q.LocalStorageStore;var z=g(function(e,t){var n,r=p&&p.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=M.getLogger("EventProcessor"),o=(a.prototype.dispatchEvent=function(e,t){this.send({uuid:U.generateUUID(),timestamp:U.getTimestamp(),request:e},t)},a.prototype.sendPendingEvents=function(){var t=this,e=this.store.values();i.debug("Sending %s pending events from previous page",e.length),e.forEach(function(e){try{t.send(e,function(){})}catch(e){}})},a.prototype.send=function(t,r){var n=this;this.store.set(t.uuid,t),this.dispatcher.dispatchEvent(t.request,function(e){n.store.remove(t.uuid),r(e)})},a);function a(e){var t=e.eventDispatcher,e=e.store;this.dispatcher=t,this.store=e}t.PendingEventsDispatcher=o;var s,o=(r(u,s=o),u);function u(e){e=e.eventDispatcher;return s.call(this,{eventDispatcher:e,store:new q.LocalStorageStore({maxValues:100,key:"fs_optly_pending_events"})})||this}t.LocalStoragePendingEventsDispatcher=o});t(z),z.PendingEventsDispatcher,z.LocalStoragePendingEventsDispatcher;var W=g(function(e,t){var r=p&&p.__assign||function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n="$opt_bot_filtering";function i(e){var t=r({},e.tags);delete t.revenue,delete t.value;t={entity_id:e.event.id,key:e.event.key,timestamp:e.timestamp,uuid:e.uuid};return e.tags&&(t.tags=e.tags),null!=e.value&&(t.value=e.value),null!=e.revenue&&(t.revenue=e.revenue),{events:[t]}}function o(e){var t=e.layer,r=e.experiment,n=e.variation,t=t?t.id:null;return{decisions:[{campaign_id:t,experiment_id:r?r.id:null,variation_id:n?n.id:null}],events:[{entity_id:t,timestamp:e.timestamp,key:"campaign_activated",uuid:e.uuid}]}}function a(e){var t={snapshots:[],visitor_id:e.user.id,attributes:[]};return e.user.attributes.forEach(function(e){t.attributes.push({entity_id:e.entityId,key:e.key,type:"custom",value:e.value})}),"boolean"==typeof e.context.botFiltering&&t.attributes.push({entity_id:n,key:n,type:"custom",value:e.context.botFiltering}),t}t.makeBatchedEventV1=function(e){var r=[],t=e[0];return e.forEach(function(e){var t;"conversion"!==e.type&&"impression"!==e.type||(t=a(e),"impression"===e.type?t.snapshots.push(o(e)):"conversion"===e.type&&t.snapshots.push(i(e)),r.push(t))}),{client_name:t.context.clientName,client_version:t.context.clientVersion,account_id:t.context.accountId,project_id:t.context.projectId,revision:t.context.revision,anonymize_ip:t.context.anonymizeIP,enrich_decisions:!0,visitors:r}},t.buildImpressionEventV1=function(e){var t=a(e);return t.snapshots.push(o(e)),{client_name:e.context.clientName,client_version:e.context.clientVersion,account_id:e.context.accountId,project_id:e.context.projectId,revision:e.context.revision,anonymize_ip:e.context.anonymizeIP,enrich_decisions:!0,visitors:[t]}},t.buildConversionEventV1=function(e){var t=a(e);return t.snapshots.push(i(e)),{client_name:e.context.clientName,client_version:e.context.clientVersion,account_id:e.context.accountId,project_id:e.context.projectId,revision:e.context.revision,anonymize_ip:e.context.anonymizeIP,enrich_decisions:!0,visitors:[t]}}});t(W),W.makeBatchedEventV1,W.buildImpressionEventV1,W.buildConversionEventV1;var X=g(function(e,t){var n,r=p&&p.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i,r=(i=H.AbstractEventProcessor,r(o,i),o.prototype.formatEvents=function(e){return{url:"https://logx.optimizely.com/v1/events",httpVerb:"POST",params:W.makeBatchedEventV1(e)}},o);function o(){return null!==i&&i.apply(this,arguments)||this}t.LogTierV1EventProcessor=r});t(X),X.LogTierV1EventProcessor;L=g(function(e,r){function t(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),t(K),t(H),t(z),t(W),t(X)});t(L);var J=L.LogTierV1EventProcessor,Z=L.LocalStoragePendingEventsDispatcher,$=g(function(e){function t(e,t){for(var r,n,i=3&e.length,o=e.length-i,a=t,s=3432918353,u=461845907,l=0;l<o;)n=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24,++l,a=27492+(65535&(r=5*(65535&(a=(a^=n=(65535&(n=(n=(65535&n)*s+(((n>>>16)*s&65535)<<16)&4294967295)<<15|n>>>17))*u+(((n>>>16)*u&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(n=0,i){case 3:n^=(255&e.charCodeAt(l+2))<<16;case 2:n^=(255&e.charCodeAt(l+1))<<8;case 1:a^=n=(65535&(n=(n=(65535&(n^=255&e.charCodeAt(l)))*s+(((n>>>16)*s&65535)<<16)&4294967295)<<15|n>>>17))*u+(((n>>>16)*u&65535)<<16)&4294967295}return a^=e.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,((a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295)^a>>>16)>>>0}var r;(r=t).v2=function(e,t){for(var r,n=e.length,i=t^n,o=0;4<=n;)r=1540483477*(65535&(r=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16),n-=4,++o;switch(n){case 3:i^=(255&e.charCodeAt(o+2))<<16;case 2:i^=(255&e.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return((i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16))^i>>>15)>>>0},r.v3=t,e.exports=r}),Q=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_UPDATE_INTERVAL=3e5,t.MIN_UPDATE_INTERVAL=1e3,t.DEFAULT_URL_TEMPLATE="https://cdn.optimizely.com/datafiles/%s.json",t.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT=[0,8,16,32,64,128,256,512],t.REQUEST_TIMEOUT_MS=6e4});t(Q),Q.DEFAULT_UPDATE_INTERVAL,Q.MIN_UPDATE_INTERVAL,Q.DEFAULT_URL_TEMPLATE,Q.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT,Q.REQUEST_TIMEOUT_MS;var ee=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=M.getLogger("DatafileManager");t.makeGetRequest=function(e,o){var a=new XMLHttpRequest;return{responsePromise:new Promise(function(t,r){var n,i;a.open("GET",e,!0),n=o,i=a,Object.keys(n).forEach(function(e){var t=n[e];i.setRequestHeader(e,t)}),a.onreadystatechange=function(){var e;4===a.readyState&&(0!==a.status?(e=function(){var e=a.getAllResponseHeaders();if(null===e)return{};var e=e.split("\r\n"),n={};return e.forEach(function(e){var t,r=e.indexOf(": ");-1<r&&(t=e.slice(0,r),0<(r=e.slice(r+2)).length&&(n[t]=r))}),n}(),e={statusCode:a.status,body:a.responseText,headers:e},t(e)):r(new Error("Request error")))},a.timeout=Q.REQUEST_TIMEOUT_MS,a.ontimeout=function(){s.error("Request timed out")},a.send()}),abort:function(){a.abort()}}}});t(ee),ee.makeGetRequest;var te=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(n.prototype.on=function(e,t){var r=this;this.listeners[e]||(this.listeners[e]={});var n=String(this.listenerId);return this.listenerId++,this.listeners[e][n]=t,function(){r.listeners[e]&&delete r.listeners[e][n]}},n.prototype.emit=function(e,t){var r=this.listeners[e];r&&Object.keys(r).forEach(function(e){(0,r[e])(t)})},n.prototype.removeAllListeners=function(){this.listeners={}},n);function n(){this.listeners={},this.listenerId=1}t.default=r});t(te);var re=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(n.prototype.getDelay=function(){return 0===this.errorCount?0:1e3*Q.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT[Math.min(Q.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1,this.errorCount)]+Math.round(1e3*Math.random())},n.prototype.countError=function(){this.errorCount<Q.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1&&this.errorCount++},n.prototype.reset=function(){this.errorCount=0},n);function n(){this.errorCount=0}t.default=r});t(re);var ne=g(function(e,t){var s=p&&p.__assign||function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},r=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(te),l=r(re),c=M.getLogger("DatafileManager");function n(e){return 200<=e&&e<400}var d={get:function(){return Promise.resolve(null)},set:function(){return Promise.resolve()},contains:function(){return Promise.resolve(!1)},remove:function(){return Promise.resolve()}},r=(i.prototype.get=function(){return this.currentDatafile},i.prototype.start=function(){this.isStarted||(c.debug("Datafile manager started"),this.isStarted=!0,this.backoffController.reset(),this.setDatafileFromCacheIfAvailable(),this.syncDatafile())},i.prototype.stop=function(){return c.debug("Datafile manager stopped"),this.isStarted=!1,this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.emitter.removeAllListeners(),this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),Promise.resolve()},i.prototype.onReady=function(){return this.readyPromise},i.prototype.on=function(e,t){return this.emitter.on(e,t)},i.prototype.onRequestRejected=function(e){this.isStarted&&(this.backoffController.countError(),e instanceof Error?c.error("Error fetching datafile: %s",e.message,e):"string"==typeof e?c.error("Error fetching datafile: %s",e):c.error("Error fetching datafile"))},i.prototype.onRequestResolved=function(e){this.isStarted&&(void 0!==e.statusCode&&n(e.statusCode)?this.backoffController.reset():this.backoffController.countError(),this.trySavingLastModified(e.headers),null!==(e=this.getNextDatafileFromResponse(e))&&(c.info("Updating datafile from response"),this.currentDatafile=e,this.cache.set(this.cacheKey,e),this.isReadyPromiseSettled?this.emitter.emit("update",{datafile:e}):this.resolveReadyPromise()))},i.prototype.onRequestComplete=function(){this.isStarted&&(this.currentRequest=null,this.isReadyPromiseSettled||this.autoUpdate||this.rejectReadyPromise(new Error("Failed to become ready")),this.autoUpdate&&this.syncOnCurrentRequestComplete&&this.syncDatafile(),this.syncOnCurrentRequestComplete=!1)},i.prototype.syncDatafile=function(){var t=this,e={};this.lastResponseLastModified&&(e["if-modified-since"]=this.lastResponseLastModified),c.debug("Making datafile request to url %s with headers: %s",this.datafileUrl,function(){return JSON.stringify(e)}),this.currentRequest=this.makeGetRequest(this.datafileUrl,e);function r(){t.onRequestComplete()}this.currentRequest.responsePromise.then(function(e){t.onRequestResolved(e)},function(e){t.onRequestRejected(e)}).then(r,r),this.autoUpdate&&this.scheduleNextUpdate()},i.prototype.resolveReadyPromise=function(){this.readyPromiseResolver(),this.isReadyPromiseSettled=!0},i.prototype.rejectReadyPromise=function(e){this.readyPromiseRejecter(e),this.isReadyPromiseSettled=!0},i.prototype.scheduleNextUpdate=function(){var e=this,t=this.backoffController.getDelay(),t=Math.max(t,this.updateInterval);c.debug("Scheduling sync in %s ms",t),this.currentTimeout=setTimeout(function(){e.currentRequest?e.syncOnCurrentRequestComplete=!0:e.syncDatafile()},t)},i.prototype.getNextDatafileFromResponse=function(e){return c.debug("Response status code: %s",e.statusCode),void 0!==e.statusCode&&304!==e.statusCode&&n(e.statusCode)?this.tryParsingBodyAsJSON(e.body):null},i.prototype.tryParsingBodyAsJSON=function(e){var t;try{t=JSON.parse(e)}catch(e){return c.error("Error parsing response body: %s",e.message,e),null}e=null;return"object"==typeof t&&null!==t?e=t:c.error("Error parsing response body: was not an object"),e},i.prototype.trySavingLastModified=function(e){e=e["last-modified"]||e["Last-Modified"];void 0!==e&&(this.lastResponseLastModified=e,c.debug("Saved last modified header value from response: %s",this.lastResponseLastModified))},i.prototype.setDatafileFromCacheIfAvailable=function(){var t=this;this.cache.get(this.cacheKey).then(function(e){t.isStarted&&!t.isReadyPromiseSettled&&e&&(c.debug("Using datafile from cache"),t.currentDatafile=e,t.resolveReadyPromise())})},i);function i(e){var r=this,t=s({},this.getConfigDefaults(),e),n=t.datafile,i=t.autoUpdate,o=void 0!==i&&i,a=t.sdkKey,e=t.updateInterval,i=void 0===e?Q.DEFAULT_UPDATE_INTERVAL:e,e=t.urlTemplate,e=void 0===e?Q.DEFAULT_URL_TEMPLATE:e,t=t.cache;this.cache=void 0===t?d:t,this.cacheKey="opt-datafile-"+a,this.isReadyPromiseSettled=!1,this.readyPromiseResolver=function(){},this.readyPromiseRejecter=function(){},this.readyPromise=new Promise(function(e,t){r.readyPromiseResolver=e,r.readyPromiseRejecter=t}),n?(this.currentDatafile=n,a||this.resolveReadyPromise()):this.currentDatafile=null,this.isStarted=!1,this.datafileUrl=U.sprintf(e,a),this.emitter=new u.default,this.autoUpdate=o,i>=Q.MIN_UPDATE_INTERVAL?this.updateInterval=i:(c.warn("Invalid updateInterval %s, defaulting to %s",i,Q.DEFAULT_UPDATE_INTERVAL),this.updateInterval=Q.DEFAULT_UPDATE_INTERVAL),this.currentTimeout=null,this.currentRequest=null,this.backoffController=new l.default,this.syncOnCurrentRequestComplete=!1}t.default=r});t(ne);var ie=g(function(e,t){var n,r=p&&p.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o,r=(o=i(ne).default,r(a,o),a.prototype.makeGetRequest=function(e,t){return ee.makeGetRequest(e,t)},a.prototype.getConfigDefaults=function(){return{autoUpdate:!1}},a);function a(){return null!==o&&o.apply(this,arguments)||this}t.default=r});t(ie);L=g(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HttpPollingDatafileManager=ie.default});t(L);function oe(e){return"number"==typeof e&&Math.abs(e)<=fe}function ae(e){if(!e)return{};if("function"==typeof Object.assign)return Object.assign.apply(Object,arguments);for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}function se(){return Math.round((new Date).getTime())}function ue(e,t){return e?D(e,function(e){return e[t]}):{}}function le(){return S.v4()}function ce(e){if(!e)throw new Error(C(_e.NO_DATAFILE_SPECIFIED,me));if("string"==typeof e||e instanceof String)try{e=JSON.parse(e)}catch(e){throw new Error(C(_e.INVALID_DATAFILE_MALFORMED,me))}if(-1===Re.indexOf(e.version))throw new Error(C(_e.INVALID_DATAFILE_VERSION,me,e.version));return 1}var de=L.HttpPollingDatafileManager,fe=Math.pow(2,53),Ee=oe,pe=function(e){return"number"==typeof e},ge={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},_e={CONDITION_EVALUATOR_ERROR:"%s: Error evaluating audience condition of type %s: %s",DATAFILE_AND_SDK_KEY_MISSING:"%s: You must provide at least one of sdkKey or datafile. Cannot start Optimizely",EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",FEATURE_NOT_IN_DATAFILE:"%s: Feature key %s is not in datafile.",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_DATAFILE_MALFORMED:"%s: Datafile is invalid because it is malformed.",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_ROLLOUT_ID:"%s: Invalid rollout ID %s attached to feature %s",INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",UNRECOGNIZED_ATTRIBUTE:"%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",UNABLE_TO_CAST_VALUE:"%s: Unable to cast value %s to type %s, returning null.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIABLE_KEY_NOT_IN_DATAFILE:'%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s.",VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT:"%s: Variation ID %s is not in the datafile.",INVALID_INPUT_FORMAT:"%s: Provided %s is in an invalid format.",INVALID_DATAFILE_VERSION:"%s: This version of the JavaScript SDK does not support the given datafile version: %s",INVALID_VARIATION_KEY:"%s: Provided variation key is in an invalid format."},he={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EVENT_KEY_NOT_FOUND:"%s: Event key %s is not in datafile.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FEATURE_ENABLED_FOR_USER:"%s: Feature %s is enabled for user %s.",FEATURE_NOT_ENABLED_FOR_USER:"%s: Feature %s is not enabled for user %s.",FEATURE_HAS_NO_EXPERIMENTS:"%s: Feature %s is not attached to any experiments.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NO_ROLLOUT_EXISTS:"%s: There is no rollout of feature %s.",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',ROLLOUT_HAS_NO_EXPERIMENTS:"%s: Rollout of feature %s has no experiments",SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is not in "Running" state. Not activating user.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",USER_ASSIGNED_TO_VARIATION_BUCKET:"%s: Assigned variation bucket %s to user %s.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned experiment bucket %s to user %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_BUCKETED_INTO_TARGETING_RULE:"%s: User %s bucketed into targeting rule %s.",USER_IN_FEATURE_EXPERIMENT:"%s: User %s is in variation %s of experiment %s on the feature %s.",USER_IN_ROLLOUT:"%s: User %s is in rollout of feature %s.",USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s bucketed into everyone targeting rule.",USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP:"%s: User %s is not in any experiment of group %s.",USER_NOT_BUCKETED_INTO_TARGETING_RULE:"%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",USER_NOT_IN_FEATURE_EXPERIMENT:"%s: User %s is not in any experiment on the feature %s.",USER_NOT_IN_ROLLOUT:"%s: User %s is not in rollout of feature %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s does not meet conditions for targeting rule %s.",USER_MEETS_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s meets conditions for targeting rule %s.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",USER_RECEIVED_DEFAULT_VARIABLE_VALUE:'%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Feature "%s" is not enabled for user %s. Returning default value for variable "%s".',VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Variable "%s" is not used in variation "%s". Returning default value.',USER_RECEIVED_VARIABLE_VALUE:'%s: Value for variable "%s" of feature flag "%s" is %s for user "%s"',VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s.",VARIABLE_REQUESTED_WITH_WRONG_TYPE:'%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',VALID_BUCKETING_ID:'%s: BucketingId is valid: "%s"',BUCKETING_ID_NOT_STRING:"%s: BucketingID attribute is not a string. Defaulted to userId",EVALUATING_AUDIENCE:'%s: Starting to evaluate audience "%s" with conditions: %s.',EVALUATING_AUDIENCES_COMBINED:'%s: Evaluating audiences for experiment "%s": %s.',AUDIENCE_EVALUATION_RESULT:'%s: Audience "%s" evaluated to %s.',AUDIENCE_EVALUATION_RESULT_COMBINED:"%s: Audiences for experiment %s collectively evaluated to %s.",MISSING_ATTRIBUTE_VALUE:'%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',UNEXPECTED_CONDITION_VALUE:"%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",UNEXPECTED_TYPE:'%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',UNEXPECTED_TYPE_NULL:'%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',UNKNOWN_CONDITION_TYPE:"%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",UNKNOWN_MATCH_TYPE:"%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",UPDATED_OPTIMIZELY_CONFIG:"%s: Updated Optimizely config to revision %s (project id %s)",OUT_OF_BOUNDS:'%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].',UNABLE_TO_ATTACH_UNLOAD:'%s: unable to bind optimizely.close() to page unload event: "%s"'},L={REVENUE:"revenue",VALUE:"value"},ve=V,Ie={BOOLEAN:"boolean",DOUBLE:"double",INTEGER:"integer",STRING:"string"},V={V2:"2",V3:"3",V4:"4"},ye={LOG_LEVEL:ge,ERROR_MESSAGES:_e,LOG_MESSAGES:he,RESERVED_EVENT_KEYWORDS:L,CONTROL_ATTRIBUTES:{BOT_FILTERING:"$opt_bot_filtering",BUCKETING_ID:"$opt_bucketing_id",STICKY_BUCKETING_KEY:"$opt_experiment_bucket_map",USER_AGENT:"$opt_user_agent"},JAVASCRIPT_CLIENT_ENGINE:"javascript-sdk",NODE_CLIENT_ENGINE:"node-sdk",REACT_CLIENT_ENGINE:"react-sdk",NODE_CLIENT_VERSION:"4.0.0",VALID_CLIENT_ENGINES:["node-sdk","react-sdk","javascript-sdk"],NOTIFICATION_TYPES:ve,DECISION_NOTIFICATION_TYPES:{AB_TEST:"ab-test",FEATURE:"feature",FEATURE_TEST:"feature-test",FEATURE_VARIABLE:"feature-variable"},DECISION_SOURCES:{FEATURE_TEST:"feature-test",ROLLOUT:"rollout"},FEATURE_VARIABLE_TYPES:Ie,DATAFILE_VERSIONS:V},me="CONFIG_VALIDATOR",Re=[V.V2,V.V3,V.V4],Ne={dispatchEvent:function(e,t){var r,n,i=e.url,o=e.params;"POST"===e.httpVerb?((r=new XMLHttpRequest).open("POST",i,!0),r.setRequestHeader("Content-Type","application/json"),r.onreadystatechange=function(){if(4===r.readyState&&t&&"function"==typeof t)try{t(o)}catch(e){}},r.send(JSON.stringify(o))):(i+="?wxhr=true",o&&(i+="&"+(n=o,Object.keys(n).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&"))),(r=new XMLHttpRequest).open("GET",i,!0),r.onreadystatechange=function(){if(4===r.readyState&&t&&"function"==typeof t)try{t()}catch(e){}},r.send())}};function Oe(){}Oe.prototype.log=function(){};function Te(e,t){return"string"==typeof e&&("string"==typeof t||"boolean"==typeof t||pe(t)&&Ee(t))}function Ae(e,t){return e.experimentFeatureMap.hasOwnProperty(t)}function Le(e,t){if(Array.isArray(e)){var r=e[0],n=e.slice(1);switch(-1===Ce.indexOf(r)&&(r="or",n=e),r){case"and":return function(e,t){for(var r=!1,n=0;n<e.length;n++){var i=Le(e[n],t);if(!1===i)return!1;null===i&&(r=!0)}return!r||null}(n,t);case"not":return function(e){if(0<e.length){e=Le(e[0],t);return null===e?null:!e}return null}(n);default:return function(e,t){for(var r=!1,n=0;n<e.length;n++){var i=Le(e[n],t);if(!0===i)return!0;null===i&&(r=!0)}return!!r&&null}(n,t)}}return t(e)}var V={createLogger:function(e){return new F(e)},createNoOpLogger:function(){return new Oe}},Se=Math.pow(2,32),Ue={bucket:function(e){var t=e.experimentKeyMap[e.experimentKey].groupId;if(t){var r=e.groupIdMap[t];if(!r)throw new Error(C(_e.INVALID_GROUP_ID,"BUCKETER",t));if("random"===r.policy){var n=this.bucketUserIntoExperiment(r,e.bucketingId,e.userId,e.logger);if(null===n){r=C(he.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",e.userId,t);return e.logger.log(ge.INFO,r),null}if(n!==e.experimentId){var i=C(he.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",e.userId,e.experimentKey,t);return e.logger.log(ge.INFO,i),null}i=C(he.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",e.userId,e.experimentKey,t);e.logger.log(ge.INFO,i)}}t=C("%s%s",e.bucketingId,e.experimentId),i=this._generateBucketValue(t),t=C(he.USER_ASSIGNED_TO_VARIATION_BUCKET,"BUCKETER",i,e.userId);e.logger.log(ge.DEBUG,t);i=this._findBucket(i,e.trafficAllocationConfig);if(i){if(!e.variationIdMap.hasOwnProperty(i)){var o=C(he.INVALID_VARIATION_ID,"BUCKETER");return e.logger.log(ge.WARNING,o),null}o=e.variationIdMap[i].key,o=C(he.USER_HAS_VARIATION,"BUCKETER",e.userId,o,e.experimentKey);e.logger.log(ge.INFO,o)}else{o=C(he.USER_HAS_NO_VARIATION,"BUCKETER",e.userId,e.experimentKey);e.logger.log(ge.DEBUG,o)}return i},bucketUserIntoExperiment:function(e,t,r,n){t=C("%s%s",t,e.id),t=this._generateBucketValue(t);n.log(ge.DEBUG,C(he.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",t,r));e=e.trafficAllocation;return this._findBucket(t,e)},_findBucket:function(e,t){for(var r=0;r<t.length;r++)if(e<t[r].endOfRange)return t[r].entityId;return null},_generateBucketValue:function(e){try{var t=$.v3(e,1);return parseInt(t/Se*1e4,10)}catch(t){throw new Error(C(_e.INVALID_BUCKETING_ID,"BUCKETER",e,t.message))}}},be="PROJECT_CONFIG",De={createProjectConfig:function(e){var t,r=((e=ae({},t=e)).audiences=(t.audiences||[]).map(function(e){return ae({},e)}),e.experiments=(t.experiments||[]).map(function(e){return ae({},e)}),e.featureFlags=(t.featureFlags||[]).map(function(e){return ae({},e)}),e.groups=(t.groups||[]).map(function(e){var t=ae({},e);return t.experiments=(e.experiments||[]).map(function(e){return ae({},e)}),t}),e.rollouts=(t.rollouts||[]).map(function(e){var t=ae({},e);return t.experiments=(e.experiments||[]).map(function(e){return ae({},e)}),t}),e);return(r.audiences||[]).forEach(function(e){e.conditions=JSON.parse(e.conditions)}),r.audiencesById=ue(r.audiences,"id"),ae(r.audiencesById,ue(r.typedAudiences,"id")),r.attributeKeyMap=ue(r.attributes,"key"),r.eventKeyMap=ue(r.events,"key"),r.groupIdMap=ue(r.groups,"id"),Object.keys(r.groupIdMap||{}).forEach(function(t){(r.groupIdMap[t].experiments||[]).forEach(function(e){r.experiments.push(ae(e,{groupId:t}))})}),r.rolloutIdMap=ue(r.rollouts||[],"id"),b(r.rolloutIdMap||{}).forEach(function(e){(e.experiments||[]).forEach(function(e){r.experiments.push(e),e.variationKeyMap=ue(e.variations,"key")})}),r.experimentKeyMap=ue(r.experiments,"key"),r.experimentIdMap=ue(r.experiments,"id"),r.variationIdMap={},r.variationVariableUsageMap={},(r.experiments||[]).forEach(function(e){e.variationKeyMap=ue(e.variations,"key"),ae(r.variationIdMap,ue(e.variations,"id")),b(e.variationKeyMap||{}).forEach(function(e){e.variables&&(r.variationVariableUsageMap[e.id]=ue(e.variables,"id"))})}),r.experimentFeatureMap={},r.featureKeyMap=ue(r.featureFlags||[],"key"),b(r.featureKeyMap||{}).forEach(function(t){t.variableKeyMap=ue(t.variables,"key"),(t.experimentIds||[]).forEach(function(e){r.experimentFeatureMap[e]?r.experimentFeatureMap[e].push(t.id):r.experimentFeatureMap[e]=[t.id];e=r.experimentIdMap[e];e.groupId&&!t.groupId&&(t.groupId=e.groupId)})}),r},getExperimentId:function(e,t){e=e.experimentKeyMap[t];if(!e)throw new Error(C(_e.INVALID_EXPERIMENT_KEY,be,t));return e.id},getLayerId:function(e,t){e=e.experimentIdMap[t];if(!e)throw new Error(C(_e.INVALID_EXPERIMENT_ID,be,t));return e.layerId},getAttributeId:function(e,t,r){var n=e.attributeKeyMap[t],e=0===t.indexOf("$opt_");return n?(e&&r.log(ge.WARN,C("Attribute %s unexpectedly has reserved prefix %s; using attribute ID instead of reserved attribute name.",t,"$opt_")),n.id):e?t:(r.log(ge.DEBUG,C(_e.UNRECOGNIZED_ATTRIBUTE,be,t)),null)},getEventId:function(e,t){t=e.eventKeyMap[t];return t?t.id:null},getExperimentStatus:function(e,t){e=e.experimentKeyMap[t];if(!e)throw new Error(C(_e.INVALID_EXPERIMENT_KEY,be,t));return e.status},isActive:function(e,t){return"Running"===this.getExperimentStatus(e,t)},isRunning:function(e,t){return"Running"===this.getExperimentStatus(e,t)},getExperimentAudienceConditions:function(e,t){e=e.experimentKeyMap[t];if(!e)throw new Error(C(_e.INVALID_EXPERIMENT_KEY,be,t));return e.audienceConditions||e.audienceIds},getVariationKeyFromId:function(e,t){return e.variationIdMap.hasOwnProperty(t)?e.variationIdMap[t].key:null},getVariationIdFromExperimentAndVariationKey:function(e,t,r){t=e.experimentKeyMap[t];return t.variationKeyMap.hasOwnProperty(r)?t.variationKeyMap[r].id:null},getExperimentFromKey:function(e,t){if(e.experimentKeyMap.hasOwnProperty(t)){e=e.experimentKeyMap[t];if(e)return e}throw new Error(C(_e.EXPERIMENT_KEY_NOT_IN_DATAFILE,be,t))},getTrafficAllocation:function(e,t){e=e.experimentKeyMap[t];if(!e)throw new Error(C(_e.INVALID_EXPERIMENT_KEY,be,t));return e.trafficAllocation},getExperimentFromId:function(e,t,r){if(e.experimentIdMap.hasOwnProperty(t)){e=e.experimentIdMap[t];if(e)return e}return r.log(ge.ERROR,C(_e.INVALID_EXPERIMENT_ID,be,t)),null},getFeatureFromKey:function(e,t,r){if(e.featureKeyMap.hasOwnProperty(t)){e=e.featureKeyMap[t];if(e)return e}return r.log(ge.ERROR,C(_e.FEATURE_NOT_IN_DATAFILE,be,t)),null},getVariableForFeature:function(e,t,r,n){e=e.featureKeyMap[t];return e?e.variableKeyMap[r]||(n.log(ge.ERROR,C(_e.VARIABLE_KEY_NOT_IN_DATAFILE,be,r,t)),null):(n.log(ge.ERROR,C(_e.FEATURE_NOT_IN_DATAFILE,be,t)),null)},getVariableValueForVariation:function(e,t,r,n){if(!t||!r)return null;if(!e.variationVariableUsageMap.hasOwnProperty(r.id))return n.log(ge.ERROR,C(_e.VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT,be,r.id)),null;t=e.variationVariableUsageMap[r.id][t.id];return t?t.value:null},getTypeCastValue:function(e,t,r){var n;switch(t){case Ie.BOOLEAN:n="true"!==e&&"false"!==e?(r.log(ge.ERROR,C(_e.UNABLE_TO_CAST_VALUE,be,e,t)),null):"true"===e;break;case Ie.INTEGER:n=parseInt(e,10),isNaN(n)&&(r.log(ge.ERROR,C(_e.UNABLE_TO_CAST_VALUE,be,e,t)),n=null);break;case Ie.DOUBLE:n=parseFloat(e),isNaN(n)&&(r.log(ge.ERROR,C(_e.UNABLE_TO_CAST_VALUE,be,e,t)),n=null);break;default:n=e}return n},getAudiencesById:function(e){return e.audiencesById},eventWithKeyExists:function(e,t){return e.eventKeyMap.hasOwnProperty(t)},isFeatureExperiment:Ae,tryCreatingProjectConfig:function(e){return ce(e.datafile),e.jsonSchemaValidator?(e.jsonSchemaValidator.validate(e.datafile),e.logger.log(ge.INFO,C(he.VALID_DATAFILE,be))):e.logger.log(ge.INFO,C(he.SKIPPING_JSON_VALIDATION,be)),this.createProjectConfig(e.datafile)}},Ce=["and","or","not"],Ve=Le,Pe="CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",Me=["exact","exists","gt","lt","substring"],Fe={};function xe(e){return"string"==typeof e||"boolean"==typeof e||pe(e)}function ke(e,t,r){var n=e.value,i=typeof n,o=e.name,a=t[o],t=typeof a;return!xe(n)||pe(n)&&!Ee(n)?(r.log(ge.WARNING,C(he.UNEXPECTED_CONDITION_VALUE,Pe,JSON.stringify(e))),null):null===a?(r.log(ge.DEBUG,C(he.UNEXPECTED_TYPE_NULL,Pe,JSON.stringify(e),o)),null):xe(a)&&i==t?pe(a)&&!Ee(a)?(r.log(ge.WARNING,C(he.OUT_OF_BOUNDS,Pe,JSON.stringify(e),o)),null):n===a:(r.log(ge.WARNING,C(he.UNEXPECTED_TYPE,Pe,JSON.stringify(e),t,o)),null)}Fe.exact=ke,Fe.exists=function(e,t){return null!=t[e.name]},Fe.gt=function(e,t,r){var n=e.name,i=t[n],o=typeof i,t=e.value;return Ee(t)?null===i?(r.log(ge.DEBUG,C(he.UNEXPECTED_TYPE_NULL,Pe,JSON.stringify(e),n)),null):pe(i)?Ee(i)?t<i:(r.log(ge.WARNING,C(he.OUT_OF_BOUNDS,Pe,JSON.stringify(e),n)),null):(r.log(ge.WARNING,C(he.UNEXPECTED_TYPE,Pe,JSON.stringify(e),o,n)),null):(r.log(ge.WARNING,C(he.UNEXPECTED_CONDITION_VALUE,Pe,JSON.stringify(e))),null)},Fe.lt=function(e,t,r){var n=e.name,i=t[e.name],o=typeof i,t=e.value;return Ee(t)?null===i?(r.log(ge.DEBUG,C(he.UNEXPECTED_TYPE_NULL,Pe,JSON.stringify(e),n)),null):pe(i)?Ee(i)?i<t:(r.log(ge.WARNING,C(he.OUT_OF_BOUNDS,Pe,JSON.stringify(e),n)),null):(r.log(ge.WARNING,C(he.UNEXPECTED_TYPE,Pe,JSON.stringify(e),o,n)),null):(r.log(ge.WARNING,C(he.UNEXPECTED_CONDITION_VALUE,Pe,JSON.stringify(e))),null)},Fe.substring=function(e,t,r){var n=e.name,i=t[e.name],o=typeof i,t=e.value;return"string"!=typeof t?(r.log(ge.WARNING,C(he.UNEXPECTED_CONDITION_VALUE,Pe,JSON.stringify(e))),null):null===i?(r.log(ge.DEBUG,C(he.UNEXPECTED_TYPE_NULL,Pe,JSON.stringify(e),n)),null):"string"!=typeof i?(r.log(ge.WARNING,C(he.UNEXPECTED_TYPE,Pe,JSON.stringify(e),o,n)),null):-1!==i.indexOf(t)};var we={evaluate:function(e,t,r){var n=e.match;if(void 0!==n&&-1===Me.indexOf(n))return r.log(ge.WARNING,C(he.UNKNOWN_MATCH_TYPE,Pe,JSON.stringify(e))),null;var i=e.name;return t.hasOwnProperty(i)||"exists"==n?(Fe[n]||ke)(e,t,r):(r.log(ge.DEBUG,C(he.MISSING_ATTRIBUTE_VALUE,Pe,JSON.stringify(e),i)),null)}},Be=A();function Ge(e){this.typeToEvaluatorMap=ae({},e,{custom_attribute:we})}Ge.prototype.evaluate=function(e,n,i){if(!e||0===e.length)return!0;i=i||{};var t=function(e){var t=n[e];if(t){Be.log(ge.DEBUG,C(he.EVALUATING_AUDIENCE,"AUDIENCE_EVALUATOR",e,JSON.stringify(t.conditions)));var r=Ve(t.conditions,this.evaluateConditionWithUserAttributes.bind(this,i)),t=null===r?"UNKNOWN":r.toString().toUpperCase();return Be.log(ge.INFO,C(he.AUDIENCE_EVALUATION_RESULT,"AUDIENCE_EVALUATOR",e,t)),r}return null}.bind(this);return Ve(e,t)||!1},Ge.prototype.evaluateConditionWithUserAttributes=function(e,t){var r=this.typeToEvaluatorMap[t.type];if(!r)return Be.log(ge.WARNING,C(he.UNKNOWN_CONDITION_TYPE,"AUDIENCE_EVALUATOR",JSON.stringify(t))),null;try{return r.evaluate(t,e,Be)}catch(e){Be.log(ge.ERROR,C(_e.CONDITION_EVALUATOR_ERROR,"AUDIENCE_EVALUATOR",t.type,e.message))}return null};function Ke(e){return"string"==typeof e&&""!==e}var je="DECISION_SERVICE",Ye=ye.ERROR_MESSAGES,He=ye.LOG_LEVEL,qe=ye.LOG_MESSAGES,ze=ye.DECISION_SOURCES;function We(e){this.audienceEvaluator=new Ge(e.UNSTABLE_conditionEvaluators),this.forcedVariationMap={},this.logger=e.logger,this.userProfileService=e.userProfileService||null}We.prototype.getVariation=function(e,t,r,n){var i=this._getBucketingId(r,n);if(!this.__checkIfExperimentIsActive(e,t))return null;var o=e.experimentKeyMap[t],a=this.getForcedVariation(e,t,r);if(a)return a;var s=this.__getWhitelistedVariation(o,r);if(s)return s.key;a=this.__resolveExperimentBucketMap(r,n);if(s=this.__getStoredVariation(e,o,r,a))return this.logger.log(He.INFO,C(qe.RETURNING_STORED_VARIATION,je,s.key,t,r)),s.key;if(!this.__checkIfUserIsInAudience(e,t,r,n))return null;i=this.__buildBucketerParams(e,t,i,r),i=Ue.bucket(i);return(s=e.variationIdMap[i])?(this.__saveUserProfile(o,s,r,a),s.key):null},We.prototype.__resolveExperimentBucketMap=function(e,t){t=t||{};e=this.__getUserProfile(e)||{},t=t[ye.CONTROL_ATTRIBUTES.STICKY_BUCKETING_KEY];return ae({},e.experiment_bucket_map,t)},We.prototype.__checkIfExperimentIsActive=function(e,t){if(De.isActive(e,t))return!0;t=C(qe.EXPERIMENT_NOT_RUNNING,je,t);return this.logger.log(He.INFO,t),!1},We.prototype.__getWhitelistedVariation=function(e,t){if(e.forcedVariations&&e.forcedVariations.hasOwnProperty(t)){var r=e.forcedVariations[t];if(e.variationKeyMap.hasOwnProperty(r)){var n=C(qe.USER_FORCED_IN_VARIATION,je,t,r);return this.logger.log(He.INFO,n),e.variationKeyMap[r]}t=C(qe.FORCED_BUCKETING_FAILED,je,r,t);return this.logger.log(He.ERROR,t),null}return null},We.prototype.__checkIfUserIsInAudience=function(e,t,r,n){var i=De.getExperimentAudienceConditions(e,t),e=De.getAudiencesById(e);this.logger.log(He.DEBUG,C(qe.EVALUATING_AUDIENCES_COMBINED,je,t,JSON.stringify(i)));n=this.audienceEvaluator.evaluate(i,e,n);if(this.logger.log(He.INFO,C(qe.AUDIENCE_EVALUATION_RESULT_COMBINED,je,t,n.toString().toUpperCase())),n)return!0;t=C(qe.USER_NOT_IN_EXPERIMENT,je,r,t);return this.logger.log(He.INFO,t),!1},We.prototype.__buildBucketerParams=function(e,t,r,n){var i={};return i.experimentKey=t,i.experimentId=De.getExperimentId(e,t),i.userId=n,i.trafficAllocationConfig=De.getTrafficAllocation(e,t),i.experimentKeyMap=e.experimentKeyMap,i.groupIdMap=e.groupIdMap,i.variationIdMap=e.variationIdMap,i.logger=this.logger,i.bucketingId=r,i},We.prototype.__getStoredVariation=function(e,t,r,n){if(n.hasOwnProperty(t.id)){var i=n[t.id],n=i.variation_id;if(e.variationIdMap.hasOwnProperty(n))return e.variationIdMap[i.variation_id];this.logger.log(He.INFO,C(qe.SAVED_VARIATION_NOT_FOUND,je,r,n,t.key))}return null},We.prototype.__getUserProfile=function(t){if(!this.userProfileService)return{user_id:t,experiment_bucket_map:{}};try{return this.userProfileService.lookup(t)}catch(e){this.logger.log(He.ERROR,C(Ye.USER_PROFILE_LOOKUP_ERROR,je,t,e.message))}},We.prototype.__saveUserProfile=function(e,t,r,n){if(this.userProfileService)try{n[e.id]={variation_id:t.id},this.userProfileService.save({user_id:r,experiment_bucket_map:n}),this.logger.log(He.INFO,C(qe.SAVED_VARIATION,je,t.key,e.key,r))}catch(e){this.logger.log(He.ERROR,C(Ye.USER_PROFILE_SAVE_ERROR,je,r,e.message))}},We.prototype.getVariationForFeature=function(e,t,r,n){var i=this._getVariationForFeatureExperiment(e,t,r,n);if(null!==i.variation)return this.logger.log(He.DEBUG,C(qe.USER_IN_FEATURE_EXPERIMENT,je,r,i.variation.key,i.experiment.key,t.key)),i;this.logger.log(He.DEBUG,C(qe.USER_NOT_IN_FEATURE_EXPERIMENT,je,r,t.key));n=this._getVariationForRollout(e,t,r,n);return null!==n.variation?this.logger.log(He.DEBUG,C(qe.USER_IN_ROLLOUT,je,r,t.key)):this.logger.log(He.DEBUG,C(qe.USER_NOT_IN_ROLLOUT,je,r,t.key)),n},We.prototype._getVariationForFeatureExperiment=function(e,t,r,n){var i,o=null,a=null;t.hasOwnProperty("groupId")?(i=e.groupIdMap[t.groupId])&&(o=this._getExperimentInGroup(e,i,r))&&-1!==t.experimentIds.indexOf(o.id)&&(a=this.getVariation(e,o.key,r,n)):0<t.experimentIds.length?(o=De.getExperimentFromId(e,t.experimentIds[0],this.logger))&&(a=this.getVariation(e,o.key,r,n)):this.logger.log(He.DEBUG,C(qe.FEATURE_HAS_NO_EXPERIMENTS,je,t.key));t=null;return{experiment:o,variation:t=null!==a&&null!==o?o.variationKeyMap[a]:t,decisionSource:ze.FEATURE_TEST}},We.prototype._getExperimentInGroup=function(e,t,r){var n=Ue.bucketUserIntoExperiment(t,r,r,this.logger);if(n){this.logger.log(He.INFO,C(qe.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,je,r,n,t.id));n=De.getExperimentFromId(e,n,this.logger);if(n)return n}return this.logger.log(He.INFO,C(qe.USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP,je,r,t.id)),null},We.prototype._getVariationForRollout=function(e,t,r,n){if(!t.rolloutId)return this.logger.log(He.DEBUG,C(qe.NO_ROLLOUT_EXISTS,je,t.key)),{experiment:null,variation:null,decisionSource:ze.ROLLOUT};var i=e.rolloutIdMap[t.rolloutId];if(!i)return this.logger.log(He.ERROR,C(Ye.INVALID_ROLLOUT_ID,je,t.rolloutId,t.key)),{experiment:null,variation:null,decisionSource:ze.ROLLOUT};if(0===i.experiments.length)return this.logger.log(He.ERROR,C(qe.ROLLOUT_HAS_NO_EXPERIMENTS,je,t.rolloutId)),{experiment:null,variation:null,decisionSource:ze.ROLLOUT};for(var o,a,s,u,l=this._getBucketingId(r,n),c=i.experiments.length-1,d=0;d<c;d++){if(o=e.experimentKeyMap[i.experiments[d].key],this.__checkIfUserIsInAudience(e,o.key,r,n)){if(this.logger.log(He.DEBUG,C(qe.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,je,r,d+1)),a=this.__buildBucketerParams(e,o.key,l,r),s=Ue.bucket(a),u=e.variationIdMap[s])return this.logger.log(He.DEBUG,C(qe.USER_BUCKETED_INTO_TARGETING_RULE,je,r,d+1)),{experiment:o,variation:u,decisionSource:ze.ROLLOUT};this.logger.log(He.DEBUG,C(qe.USER_NOT_BUCKETED_INTO_TARGETING_RULE,je,r,d+1));break}this.logger.log(He.DEBUG,C(qe.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,je,r,d+1))}t=e.experimentKeyMap[i.experiments[c].key];if(this.__checkIfUserIsInAudience(e,t.key,r,n)){if(a=this.__buildBucketerParams(e,t.key,l,r),s=Ue.bucket(a),u=e.variationIdMap[s])return this.logger.log(He.DEBUG,C(qe.USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE,je,r)),{experiment:t,variation:u,decisionSource:ze.ROLLOUT};this.logger.log(He.DEBUG,C(qe.USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE,je,r))}return{experiment:null,variation:null,decisionSource:ze.ROLLOUT}},We.prototype._getBucketingId=function(e,t){return null!=t&&"object"==typeof t&&t.hasOwnProperty(ye.CONTROL_ATTRIBUTES.BUCKETING_ID)&&("string"==typeof t[ye.CONTROL_ATTRIBUTES.BUCKETING_ID]?(e=t[ye.CONTROL_ATTRIBUTES.BUCKETING_ID],this.logger.log(He.DEBUG,C(qe.VALID_BUCKETING_ID,je,e))):this.logger.log(He.WARNING,C(qe.BUCKETING_ID_NOT_STRING,je))),e},We.prototype.removeForcedVariation=function(e,t,r){if(!e)throw new Error(C(Ye.INVALID_USER_ID,je));if(!this.forcedVariationMap.hasOwnProperty(e))throw new Error(C(Ye.USER_NOT_IN_FORCED_VARIATION,je,e));delete this.forcedVariationMap[e][t],this.logger.log(He.DEBUG,C(qe.VARIATION_REMOVED_FOR_USER,je,r,e))},We.prototype.__setInForcedVariationMap=function(e,t,r){this.forcedVariationMap.hasOwnProperty(e)||(this.forcedVariationMap[e]={}),this.forcedVariationMap[e][t]=r,this.logger.log(He.DEBUG,C(qe.USER_MAPPED_TO_FORCED_VARIATION,je,r,t,e))},We.prototype.getForcedVariation=function(e,t,r){var n=this.forcedVariationMap[r];if(!n)return this.logger.log(He.DEBUG,C(qe.USER_HAS_NO_FORCED_VARIATION,je,r)),null;try{var i=De.getExperimentFromKey(e,t);if(!i.hasOwnProperty("id"))return this.logger.log(He.ERROR,C(Ye.IMPROPERLY_FORMATTED_EXPERIMENT,je,t)),null;o=i.id}catch(e){return this.logger.log(He.ERROR,e.message),null}var o=n[o];if(!o)return this.logger.log(He.DEBUG,C(qe.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,je,t,r)),null;o=De.getVariationKeyFromId(e,o);return o?this.logger.log(He.DEBUG,C(qe.USER_HAS_FORCED_VARIATION,je,o,t,r)):this.logger.log(He.DEBUG,C(qe.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,je,t,r)),o},We.prototype.setForcedVariation=function(e,t,r,n){if(null!=n&&!Ke(n))return this.logger.log(He.ERROR,C(Ye.INVALID_VARIATION_KEY,je)),!1;var i;try{var o=De.getExperimentFromKey(e,t);if(!o.hasOwnProperty("id"))return this.logger.log(He.ERROR,C(Ye.IMPROPERLY_FORMATTED_EXPERIMENT,je,t)),!1;i=o.id}catch(e){return this.logger.log(He.ERROR,e.message),!1}if(null==n)try{return this.removeForcedVariation(r,i,t,this.logger),!0}catch(e){return this.logger.log(He.ERROR,e.message),!1}o=De.getVariationIdFromExperimentAndVariationKey(e,t,n);if(!o)return this.logger.log(He.ERROR,C(Ye.NO_VARIATION_FOR_EXPERIMENT_KEY,je,n,t)),!1;try{return this.__setInForcedVariationMap(r,i,o),!0}catch(e){return this.logger.log(He.ERROR,e.message),!1}};function Xe(e,t){if(e&&e.hasOwnProperty(Ze)){var r=e[Ze],e=parseInt(r,10);return isNaN(e)?(t.log(ge.INFO,C(he.FAILED_TO_PARSE_REVENUE,"EVENT_TAG_UTILS",r)),null):(t.log(ge.INFO,C(he.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",e)),e)}return null}function Je(e,t){if(e&&e.hasOwnProperty($e)){var r=e[$e],e=parseFloat(r);return isNaN(e)?(t.log(ge.INFO,C(he.FAILED_TO_PARSE_VALUE,"EVENT_TAG_UTILS",r)),null):(t.log(ge.INFO,C(he.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",e)),e)}return null}var Ze=L.REVENUE,$e=L.VALUE,Qe="https://logx.optimizely.com/v1/events";function et(r){var n=r.attributes,e=r.configObj,t=e.anonymizeIP,i=e.botFiltering,o={snapshots:[],visitor_id:r.userId,attributes:[]},a={account_id:e.accountId,project_id:e.projectId,visitors:[o],revision:e.revision,client_name:r.clientEngine,client_version:r.clientVersion,anonymize_ip:t=null==t?!1:t,enrich_decisions:!0};return Object.keys(n||{}).forEach(function(e){var t=n[e];!Te(e,t)||(t=De.getAttributeId(r.configObj,e,r.logger))&&a.visitors[0].attributes.push({entity_id:t,key:e,type:"custom",value:n[e]})}),"boolean"==typeof i&&a.visitors[0].attributes.push({entity_id:ye.CONTROL_ATTRIBUTES.BOT_FILTERING,key:ye.CONTROL_ATTRIBUTES.BOT_FILTERING,type:"custom",value:i}),a}var tt=A("EVENT_BUILDER");function rt(r,n){var i=[];return Object.keys(n||{}).forEach(function(e){var t=n[e];!Te(e,t)||(t=De.getAttributeId(r,e,tt))&&i.push({entityId:t,key:e,value:n[e]})}),i}function nt(e){this.logger=e.logger,this.errorHandler=e.errorHandler,this.__notificationListeners={},b(ve).forEach(function(e){this.__notificationListeners[e]=[]}.bind(this)),this.__listenerId=1}nt.prototype.addNotificationListener=function(e,t){try{if(!(-1<b(ve).indexOf(e)))return-1;this.__notificationListeners[e]||(this.__notificationListeners[e]=[]);var r=!1;if((this.__notificationListeners[e]||[]).forEach(function(e){if(e.callback===t)return!(r=!0)}),r)return-1;this.__notificationListeners[e].push({id:this.__listenerId,callback:t});var n=this.__listenerId;return this.__listenerId+=1,n}catch(e){return this.logger.log(ge.ERROR,e.message),this.errorHandler.handleError(e),-1}},nt.prototype.removeNotificationListener=function(n){try{var i,o;if(Object.keys(this.__notificationListeners).some(function(r){if((this.__notificationListeners[r]||[]).every(function(e,t){return e.id!==n||(i=t,o=r,!1)}),void 0!==i&&void 0!==o)return!0}.bind(this)),void 0!==i&&void 0!==o)return this.__notificationListeners[o].splice(i,1),!0}catch(n){this.logger.log(ge.ERROR,n.message),this.errorHandler.handleError(n)}return!1},nt.prototype.clearAllNotificationListeners=function(){try{b(ve).forEach(function(e){this.__notificationListeners[e]=[]}.bind(this))}catch(e){this.logger.log(ge.ERROR,e.message),this.errorHandler.handleError(e)}},nt.prototype.clearNotificationListeners=function(e){try{this.__notificationListeners[e]=[]}catch(e){this.logger.log(ge.ERROR,e.message),this.errorHandler.handleError(e)}},nt.prototype.sendNotifications=function(t,r){try{(this.__notificationListeners[t]||[]).forEach(function(e){e=e.callback;try{e(r)}catch(e){this.logger.log(ge.ERROR,C(he.NOTIFICATION_LISTENER_EXCEPTION,"NOTIFICATION_CENTER",t,e.message))}}.bind(this))}catch(t){this.logger.log(ge.ERROR,t.message),this.errorHandler.handleError(t)}};function it(e){var u,t,l,r,n,i=(t=((u=e).rollouts||[]).reduce(function(t,e){return e.experiments.forEach(function(e){t[e.id]=!0}),t},{}),l=(u.featureFlags||[]).reduce(function(e,t){return e[t.id]=t.variables,e},{}),(u.experiments||[]).reduce(function(e,s){return t[s.id]||(e[s.key]={id:s.id,key:s.key,variationsMap:(s.variations||[]).reduce(function(e,t){return e[t.key]={id:t.id,key:t.key,variablesMap:(r=u,n=t,i=s.id,o=l,r=r.experimentFeatureMap[i],i={},r&&(r=o[r],a=(n.variables||[]).reduce(function(e,t){return e[t.id]={id:t.id,value:t.value},e},{}),i=(r||[]).reduce(function(e,t){var r=a[t.id],r=n.featureEnabled&&r?r.value:t.defaultValue;return e[t.key]={id:t.id,key:t.key,type:t.type,value:r},e},{})),i)},Ae(u,s.id)&&(e[t.key].featureEnabled=t.featureEnabled),e;var r,n,i,o,a},{})}),e},{}));return{experimentsMap:i,featuresMap:(n=i,((r=e).featureFlags||[]).reduce(function(e,t){return e[t.key]={id:t.id,key:t.key,experimentsMap:(t.experimentIds||[]).reduce(function(e,t){t=r.experimentIdMap[t].key;return e[t]=n[t],e},{}),variablesMap:(t.variables||[]).reduce(function(e,t){return e[t.key]={id:t.id,key:t.key,type:t.type,value:t.defaultValue},e},{})},e},{})),revision:e.revision}}var ot=A();function at(e,t){return e instanceof Error?e.message:t||"Unknown error"}function st(e){try{this.__initialize(e)}catch(e){ot.error(e),this.__updateListeners=[],this.__configObj=null,this.__optimizelyConfigObj=null,this.__readyPromise=Promise.resolve({success:!1,reason:at(e,"Error in initialize")})}}st.prototype.__initialize=function(e){if(this.__updateListeners=[],this.jsonSchemaValidator=e.jsonSchemaValidator,!e.datafile&&!e.sdkKey){this.__configObj=null;var t=new Error(C(_e.DATAFILE_AND_SDK_KEY_MISSING,"PROJECT_CONFIG_MANAGER"));return this.__readyPromise=Promise.resolve({success:!1,reason:at(t)}),void ot.error(t)}var r,n=this.__getDatafileFromConfig(e);if(n)try{this.__configObj=De.tryCreatingProjectConfig({datafile:n,jsonSchemaValidator:this.jsonSchemaValidator,logger:ot}),this.__optimizelyConfigObj=it(this.__configObj)}catch(e){ot.error(e),r=e,this.__configObj=null}else this.__configObj=null;e.sdkKey?(t={sdkKey:e.sdkKey},this.__validateDatafileOptions(e.datafileOptions)&&ae(t,e.datafileOptions),n&&this.__configObj&&(t.datafile=n),this.datafileManager=new de(t),this.datafileManager.start(),this.__readyPromise=this.datafileManager.onReady().then(this.__onDatafileManagerReadyFulfill.bind(this),this.__onDatafileManagerReadyReject.bind(this)),this.datafileManager.on("update",this.__onDatafileManagerUpdate.bind(this))):this.__configObj?this.__readyPromise=Promise.resolve({success:!0}):this.__readyPromise=Promise.resolve({success:!1,reason:at(r,"Invalid datafile")})},st.prototype.__onDatafileManagerReadyFulfill=function(){var e,t=this.datafileManager.get();try{e=De.tryCreatingProjectConfig({datafile:t,jsonSchemaValidator:this.jsonSchemaValidator,logger:ot})}catch(e){return ot.error(e),{success:!1,reason:at(e)}}return this.__handleNewConfigObj(e),{success:!0}},st.prototype.__onDatafileManagerReadyReject=function(e){return{success:!1,reason:at(e,"Failed to become ready")}},st.prototype.__onDatafileManagerUpdate=function(){var e,t=this.datafileManager.get();try{e=De.tryCreatingProjectConfig({datafile:t,jsonSchemaValidator:this.jsonSchemaValidator,logger:ot})}catch(e){ot.error(e)}e&&this.__handleNewConfigObj(e)},st.prototype.__getDatafileFromConfig=function(e){var t=null;try{e.datafile&&(ce(e.datafile),t="string"==typeof e.datafile||e.datafile instanceof String?JSON.parse(e.datafile):e.datafile)}catch(e){ot.error(e)}return t},st.prototype.__validateDatafileOptions=function(e){return void 0===e||"object"==typeof e&&null!==e},st.prototype.__handleNewConfigObj=function(t){var e=this.__configObj;(e?e.revision:"null")!==t.revision&&(this.__configObj=t,this.__optimizelyConfigObj=it(t),this.__updateListeners.forEach(function(e){e(t)}))},st.prototype.getConfig=function(){return this.__configObj},st.prototype.getOptimizelyConfig=function(){return this.__optimizelyConfigObj},st.prototype.onReady=function(){return this.__readyPromise},st.prototype.onUpdate=function(t){return this.__updateListeners.push(t),function(){var e=this.__updateListeners.indexOf(t);-1<e&&this.__updateListeners.splice(e,1)}.bind(this)},st.prototype.stop=function(){this.datafileManager&&this.datafileManager.stop(),this.__updateListeners=[]};var ut={ProjectConfigManager:st},lt=ye.ERROR_MESSAGES,ct=ye.LOG_LEVEL,dt=ye.LOG_MESSAGES,ft=ye.DECISION_SOURCES,Et=ye.FEATURE_VARIABLE_TYPES,pt=ye.DECISION_NOTIFICATION_TYPES,gt=ye.NOTIFICATION_TYPES;function _t(e){var t=e.clientEngine;-1===ye.VALID_CLIENT_ENGINES.indexOf(t)&&(e.logger.log(ct.INFO,C(dt.INVALID_CLIENT_ENGINE,"OPTIMIZELY",t)),t=ye.NODE_CLIENT_ENGINE),this.clientEngine=t,this.clientVersion=e.clientVersion||ye.NODE_CLIENT_VERSION,this.errorHandler=e.errorHandler,this.eventDispatcher=e.eventDispatcher,this.__isOptimizelyConfigValid=e.isValidInstance,this.logger=e.logger,this.projectConfigManager=new ut.ProjectConfigManager({datafile:e.datafile,datafileOptions:e.datafileOptions,jsonSchemaValidator:e.jsonSchemaValidator,sdkKey:e.sdkKey}),this.__disposeOnUpdate=this.projectConfigManager.onUpdate(function(e){this.logger.log(ct.INFO,C(dt.UPDATED_OPTIMIZELY_CONFIG,"OPTIMIZELY",e.revision,e.projectId)),this.notificationCenter.sendNotifications(gt.OPTIMIZELY_CONFIG_UPDATE)}.bind(this)),this.__readyPromise=this.projectConfigManager.onReady();t=null;if(e.userProfileService)try{!function(e){if("function"!=typeof e.lookup)throw new Error(C(_e.INVALID_USER_PROFILE_SERVICE,"USER_PROFILE_SERVICE_VALIDATOR","Missing function 'lookup'"));if("function"!=typeof e.save)throw new Error(C(_e.INVALID_USER_PROFILE_SERVICE,"USER_PROFILE_SERVICE_VALIDATOR","Missing function 'save'"));return 1}(e.userProfileService)||(t=e.userProfileService,this.logger.log(ct.INFO,C(dt.VALID_USER_PROFILE_SERVICE,"OPTIMIZELY")))}catch(e){this.logger.log(ct.WARNING,e.message)}this.decisionService=new We({userProfileService:t,logger:this.logger,UNSTABLE_conditionEvaluators:e.UNSTABLE_conditionEvaluators}),this.notificationCenter=new nt({logger:this.logger,errorHandler:this.errorHandler}),this.eventProcessor=new J({dispatcher:this.eventDispatcher,flushInterval:e.eventFlushInterval,maxQueueSize:e.eventBatchSize,notificationCenter:this.notificationCenter}),this.eventProcessor.start(),this.__readyTimeouts={},this.__nextReadyTimeoutId=0}_t.prototype.__isValidInstance=function(){return this.__isOptimizelyConfigValid&&this.projectConfigManager.getConfig()},_t.prototype.activate=function(e,t,r){try{if(!this.__isValidInstance())return this.logger.log(ct.ERROR,C(dt.INVALID_OBJECT,"OPTIMIZELY","activate")),null;if(!this.__validateInputs({experiment_key:e,user_id:t},r))return this.__notActivatingExperiment(e,t);var n=this.projectConfigManager.getConfig();if(!n)return null;try{var i=this.getVariation(e,t,r);if(null===i)return this.__notActivatingExperiment(e,t);if(De.isRunning(n,e))return this._sendImpressionEvent(e,i,t,r),i;var o=C(dt.SHOULD_NOT_DISPATCH_ACTIVATE,"OPTIMIZELY",e);return this.logger.log(ct.DEBUG,o),i}catch(r){this.logger.log(ct.ERROR,r.message);var a=C(dt.NOT_ACTIVATING_USER,"OPTIMIZELY",t,e);return this.logger.log(ct.INFO,a),this.errorHandler.handleError(r),null}}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),null}},_t.prototype._sendImpressionEvent=function(e,t,r,n){var i,o,a,s,u,l,c,d,f,E=this.projectConfigManager.getConfig();E&&(i={experimentKey:e,variationKey:t,userId:r,userAttributes:n,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:E},o=i.configObj,a=i.experimentKey,s=i.variationKey,u=i.userId,l=i.userAttributes,c=i.clientEngine,d=i.clientVersion,f=De.getVariationIdFromExperimentAndVariationKey(o,a,s),E=De.getExperimentId(o,a),i=De.getLayerId(o,E),s={type:"impression",timestamp:se(),uuid:le(),user:{id:u,attributes:rt(o,l)},context:{accountId:o.accountId,projectId:o.projectId,revision:o.revision,clientName:c,clientVersion:d,anonymizeIP:o.anonymizeIP||!1,botFiltering:o.botFiltering},layer:{id:i},experiment:{id:E,key:a},variation:{id:f,key:s}},this.eventProcessor.process(s),this.__emitNotificationCenterActivate(e,t,r,n))},_t.prototype.__emitNotificationCenterActivate=function(e,t,r,n){var i,o,a,s=this.projectConfigManager.getConfig();s&&(a=De.getVariationIdFromExperimentAndVariationKey(s,e,t),o=De.getExperimentId(s,e),a=function(e){var t={httpVerb:"POST"},r=et(e);t.url=Qe;var n,i,e=(i=e.variationId,{decisions:[{campaign_id:De.getLayerId(n=e.configObj,e=e.experimentId),experiment_id:e,variation_id:i}],events:[{entity_id:De.getLayerId(n,e),timestamp:se(),key:"campaign_activated",uuid:le()}]});return r.visitors[0].snapshots.push(e),t.params=r,t}({attributes:n,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:s,experimentId:o,userId:r,variationId:a,logger:this.logger}),(e=s.experimentKeyMap[e])&&e.variationKeyMap&&(i=e.variationKeyMap[t]),this.notificationCenter.sendNotifications(gt.ACTIVATE,{experiment:e,userId:r,attributes:n,variation:i,logEvent:a}))},_t.prototype.track=function(e,t,r,n){try{if(!this.__isValidInstance())return void this.logger.log(ct.ERROR,C(dt.INVALID_OBJECT,"OPTIMIZELY","track"));if(!this.__validateInputs({user_id:t,event_key:e},r,n))return;var i=this.projectConfigManager.getConfig();if(!i)return;if(!De.eventWithKeyExists(i,e))return this.logger.log(ct.WARNING,C(ye.LOG_MESSAGES.EVENT_KEY_NOT_FOUND,"OPTIMIZELY",e)),void this.logger.log(ct.WARNING,C(dt.NOT_TRACKING_USER,"OPTIMIZELY",t));var o=(a={eventKey:e,eventTags:n=this.__filterEmptyValues(n),userId:t,userAttributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:i},s=a.configObj,u=a.userId,l=a.userAttributes,c=a.clientEngine,d=a.clientVersion,f=a.eventKey,E=a.eventTags,a=De.getEventId(s,f),{type:"conversion",timestamp:se(),uuid:le(),user:{id:u,attributes:rt(s,l)},context:{accountId:s.accountId,projectId:s.projectId,revision:s.revision,clientName:c,clientVersion:d,anonymizeIP:s.anonymizeIP||!1,botFiltering:s.botFiltering},event:{id:a,key:f},revenue:Xe(E,tt),value:Je(E,tt),tags:E});this.logger.log(ct.INFO,C(ye.LOG_MESSAGES.TRACK_EVENT,"OPTIMIZELY",e,t)),this.eventProcessor.process(o),this.__emitNotificationCenterTrack(e,t,r,n)}catch(e){this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e);t=C(dt.NOT_TRACKING_USER,"OPTIMIZELY",t);this.logger.log(ct.ERROR,t)}var a,s,u,l,c,d,f,E},_t.prototype.__emitNotificationCenterTrack=function(e,t,r,n){try{var i=this.projectConfigManager.getConfig();if(!i)return;var o=function(e){var t={httpVerb:"POST"},r=et(e);t.url=Qe;var n,i,o,a,a=(n=e.eventKey,i=e.eventTags,o=e.logger,a={events:[]},e={entity_id:De.getEventId(e.configObj,n),timestamp:se(),uuid:le(),key:n},i&&(null!==(n=Xe(i,o))&&(e[ye.RESERVED_EVENT_KEYWORDS.REVENUE]=n),null!==(o=Je(i,o))&&(e[ye.RESERVED_EVENT_KEYWORDS.VALUE]=o),e.tags=i),a.events.push(e),a);return r.visitors[0].snapshots=[a],t.params=r,t}({attributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:i,eventKey:e,eventTags:n,logger:this.logger,userId:t});this.notificationCenter.sendNotifications(gt.TRACK,{eventKey:e,userId:t,attributes:r,eventTags:n,logEvent:o})}catch(e){this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e)}},_t.prototype.getVariation=function(e,t,r){try{if(!this.__isValidInstance())return this.logger.log(ct.ERROR,C(dt.INVALID_OBJECT,"OPTIMIZELY","getVariation")),null;try{if(!this.__validateInputs({experiment_key:e,user_id:t},r))return null;var n=this.projectConfigManager.getConfig();if(!n)return null;var i=n.experimentKeyMap[e];if(!i)return this.logger.log(ct.DEBUG,C(lt.INVALID_EXPERIMENT_KEY,"OPTIMIZELY",e)),null;var o=this.decisionService.getVariation(n,e,t,r),a=De.isFeatureExperiment(n,i.id)?pt.FEATURE_TEST:pt.AB_TEST;return this.notificationCenter.sendNotifications(gt.DECISION,{type:a,userId:t,attributes:r||{},decisionInfo:{experimentKey:e,variationKey:o}}),o}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),null}}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),null}},_t.prototype.setForcedVariation=function(e,t,r){if(!this.__validateInputs({experiment_key:e,user_id:t}))return!1;var n=this.projectConfigManager.getConfig();if(!n)return!1;try{return this.decisionService.setForcedVariation(n,e,t,r)}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),!1}},_t.prototype.getForcedVariation=function(e,t){if(!this.__validateInputs({experiment_key:e,user_id:t}))return null;var r=this.projectConfigManager.getConfig();if(!r)return null;try{return this.decisionService.getForcedVariation(r,e,t)}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),null}},_t.prototype.__validateInputs=function(e,t,r){try{if(e.hasOwnProperty("user_id")){var n=e.user_id;if("string"!=typeof n||null===n||"undefined"===n)throw new Error(C(lt.INVALID_INPUT_FORMAT,"OPTIMIZELY","user_id"));delete e.user_id}for(var i=Object.keys(e),o=0;o<i.length;o++){var a=i[o];if(!Ke(e[a]))throw new Error(C(lt.INVALID_INPUT_FORMAT,"OPTIMIZELY",a))}return t&&function(t){if("object"!=typeof t||Array.isArray(t)||null===t)throw new Error(C(_e.INVALID_ATTRIBUTES,"ATTRIBUTES_VALIDATOR"));Object.keys(t).forEach(function(e){if(void 0===t[e])throw new Error(C(_e.UNDEFINED_ATTRIBUTE,"ATTRIBUTES_VALIDATOR",e))})}(t),r&&function(e){if("object"!=typeof e||Array.isArray(e)||null===e)throw new Error(C(_e.INVALID_EVENT_TAGS,"EVENT_TAGS_VALIDATOR"))}(r),!0}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),!1}},_t.prototype.__notActivatingExperiment=function(e,t){e=C(dt.NOT_ACTIVATING_USER,"OPTIMIZELY",t,e);return this.logger.log(ct.INFO,e),null},_t.prototype.__filterEmptyValues=function(e){for(var t in e)!e.hasOwnProperty(t)||null!==e[t]&&void 0!==e[t]||delete e[t];return e},_t.prototype.isFeatureEnabled=function(e,t,r){try{if(!this.__isValidInstance())return this.logger.log(ct.ERROR,C(dt.INVALID_OBJECT,"OPTIMIZELY","isFeatureEnabled")),!1;if(!this.__validateInputs({feature_key:e,user_id:t},r))return!1;var n=this.projectConfigManager.getConfig();if(!n)return!1;var i=De.getFeatureFromKey(n,e,this.logger);if(!i)return!1;var o=!1,a=this.decisionService.getVariationForFeature(n,i,t,r),s=a.variation,u={};s&&(o=s.featureEnabled,a.decisionSource===ft.FEATURE_TEST&&(u={experimentKey:a.experiment.key,variationKey:a.variation.key},this._sendImpressionEvent(a.experiment.key,a.variation.key,t,r))),!0===o?this.logger.log(ct.INFO,C(dt.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",e,t)):(this.logger.log(ct.INFO,C(dt.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",e,t)),o=!1);var l={featureKey:e,featureEnabled:o,source:a.decisionSource,sourceInfo:u};return this.notificationCenter.sendNotifications(gt.DECISION,{type:pt.FEATURE,userId:t,attributes:r||{},decisionInfo:l}),o}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),!1}},_t.prototype.getEnabledFeatures=function(t,r){try{var n=[];if(!this.__isValidInstance())return this.logger.log(ct.ERROR,C(dt.INVALID_OBJECT,"OPTIMIZELY","getEnabledFeatures")),n;if(!this.__validateInputs({user_id:t}))return n;var e=this.projectConfigManager.getConfig();return e&&b(e.featureKeyMap).forEach(function(e){this.isFeatureEnabled(e.key,t,r)&&n.push(e.key)}.bind(this)),n}catch(t){return this.logger.log(ct.ERROR,t.message),this.errorHandler.handleError(t),[]}},_t.prototype.getFeatureVariable=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,null,r,n)}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),null}},_t.prototype._getFeatureVariableForType=function(e,t,r,n,i){if(!this.__isValidInstance()){var o=r?"getFeatureVariable"+r.charAt(0).toUpperCase()+r.slice(1):"getFeatureVariable";return this.logger.log(ct.ERROR,C(dt.INVALID_OBJECT,"OPTIMIZELY",o)),null}if(!this.__validateInputs({feature_key:e,variable_key:t,user_id:n},i))return null;var a=this.projectConfigManager.getConfig();if(!a)return null;var s=De.getFeatureFromKey(a,e,this.logger);if(!s)return null;var u=De.getVariableForFeature(a,e,t,this.logger);if(!u)return null;if(r){if(u.type!==r)return this.logger.log(ct.WARNING,C(dt.VARIABLE_REQUESTED_WITH_WRONG_TYPE,"OPTIMIZELY",r,u.type)),null}else r=u.type;var l=!1,c=u.defaultValue,o=this.decisionService.getVariationForFeature(a,s,n,i);null!==o.variation?(l=o.variation.featureEnabled,null!==(u=De.getVariableValueForVariation(a,u,o.variation,this.logger))?!0===l?this.logger.log(ct.INFO,C(dt.USER_RECEIVED_VARIABLE_VALUE,"OPTIMIZELY",t,s.key,c=u,n)):this.logger.log(ct.INFO,C(dt.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",s.key,n,t)):this.logger.log(ct.INFO,C(dt.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",t,o.variation.key))):this.logger.log(ct.INFO,C(dt.USER_RECEIVED_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",n,t,s.key));s={};o.decisionSource===ft.FEATURE_TEST&&(s={experimentKey:o.experiment.key,variationKey:o.variation.key});c=De.getTypeCastValue(c,r,this.logger);return this.notificationCenter.sendNotifications(gt.DECISION,{type:pt.FEATURE_VARIABLE,userId:n,attributes:i||{},decisionInfo:{featureKey:e,featureEnabled:l,source:o.decisionSource,variableKey:t,variableValue:c,variableType:r,sourceInfo:s}}),c},_t.prototype.getFeatureVariableBoolean=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,Et.BOOLEAN,r,n)}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),null}},_t.prototype.getFeatureVariableDouble=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,Et.DOUBLE,r,n)}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),null}},_t.prototype.getFeatureVariableInteger=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,Et.INTEGER,r,n)}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),null}},_t.prototype.getFeatureVariableString=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,Et.STRING,r,n)}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),null}},_t.prototype.getOptimizelyConfig=function(){try{return this.projectConfigManager.getConfig()?this.projectConfigManager.getOptimizelyConfig():null}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),null}},_t.prototype.close=function(){try{var e=this.eventProcessor.stop();return this.__disposeOnUpdate&&(this.__disposeOnUpdate(),this.__disposeOnUpdate=null),this.projectConfigManager&&this.projectConfigManager.stop(),Object.keys(this.__readyTimeouts).forEach(function(e){e=this.__readyTimeouts[e];clearTimeout(e.readyTimeout),e.onClose()}.bind(this)),this.__readyTimeouts={},e.then(function(){return{success:!0}},function(e){return{success:!1,reason:String(e)}})}catch(e){return this.logger.log(ct.ERROR,e.message),this.errorHandler.handleError(e),Promise.resolve({success:!1,reason:String(e)})}},_t.prototype.onReady=function(e){var t,r;"object"==typeof e&&null!==e&&(t=e.timeout),Ee(t)||(t=3e4);var n=new Promise(function(e){r=e}),i=this.__nextReadyTimeoutId;this.__nextReadyTimeoutId++;var e=function(){delete this.__readyTimeouts[i],r({success:!1,reason:C("onReady timeout expired after %s ms",t)})}.bind(this),o=setTimeout(e,t);return this.__readyTimeouts[i]={readyTimeout:o,onClose:function(){r({success:!1,reason:"Instance closed"})}},this.__readyPromise.then(function(){clearTimeout(o),delete this.__readyTimeouts[i],r({success:!0})}.bind(this)),Promise.race([this.__readyPromise,n])};var ht=A();w(V.createLogger()),x(k.INFO);var vt=!1,It={logging:V,errorHandler:{handleError:function(){}},eventDispatcher:Ne,enums:ye,setLogger:w,setLogLevel:x,createInstance:function(e){try{(e=e||{}).errorHandler&&B(e.errorHandler),e.logger&&(w(e.logger),x(k.NOTSET)),void 0!==e.logLevel&&x(e.logLevel);try{(function(e){if(e.errorHandler&&"function"!=typeof e.errorHandler.handleError)throw new Error(C(_e.INVALID_ERROR_HANDLER,me));if(e.eventDispatcher&&"function"!=typeof e.eventDispatcher.dispatchEvent)throw new Error(C(_e.INVALID_EVENT_DISPATCHER,me));if(e.logger&&"function"!=typeof e.logger.log)throw new Error(C(_e.INVALID_LOGGER,me))})(e),e.isValidInstance=!0}catch(t){ht.error(t),e.isValidInstance=!1}var t;null==e.eventDispatcher?(t=new Z({eventDispatcher:Ne}),vt||(t.sendPendingEvents(),vt=!0)):t=e.eventDispatcher,o=(e=ae({clientEngine:ye.JAVASCRIPT_CLIENT_ENGINE,eventBatchSize:10,eventFlushInterval:1e3},e,{eventDispatcher:t,logger:ht,errorHandler:G()})).eventBatchSize,oe(o)&&1<=o||(ht.warn("Invalid eventBatchSize %s, defaulting to %s",e.eventBatchSize,10),e.eventBatchSize=10),i=e.eventFlushInterval,oe(i)&&0<i||(ht.warn("Invalid eventFlushInterval %s, defaulting to %s",e.eventFlushInterval,1e3),e.eventFlushInterval=1e3);var r,n=new _t(e);try{"function"==typeof window.addEventListener&&(r="onpagehide"in window?"pagehide":"unload",window.addEventListener(r,function(){n.close()},!1))}catch(e){ht.error(ye.LOG_MESSAGES.UNABLE_TO_ATTACH_UNLOAD,"INDEX_BROWSER",e.message)}return n}catch(e){return ht.error(e),null}var i,o},__internalResetRetryState:function(){vt=!1}};const yt={handleError(e){!async function(e){var t=null===(t=null===(t=document.head)||void 0===t?void 0:t.querySelector('meta[name="browser-optimizely-client-errors-url"]'))||void 0===t?void 0:t.content;if(t){e={message:e.message,stack:e.stack,stacktrace:function(e){const t=n(e.stack||"").map(e=>({filename:e.file||"",function:String(e.methodName),lineno:(e.lineNumber||0).toString(),colno:(e.column||0).toString()})),r=null!==(e=e.framesToPop)&&void 0!==e?e:0;return 0===r?t:t.slice(r)}(e),sanitizedUrl:`${window.location.protocol}//${window.location.host}${e=E("meta[name=analytics-location]"),(e?e.content:window.location.pathname)+function(){let e="";E("meta[name=analytics-location-query-strip]")||(e=window.location.search);const t=E("meta[name=analytics-location-params]");t&&(e+=(e?"&":"?")+t.content);for(const r of document.querySelectorAll("meta[name=analytics-param-rename]")){const t=r.content.split(":",2);e=e.replace(new RegExp(`(^|[?&])${t[0]}($|=)`,"g"),`$1${t[1]}$2`)}return e}()}`||window.location.href,user:(e=null===(e=null===(e=document.head)||void 0===e?void 0:e.querySelector('meta[name="user-login"]'))||void 0===e?void 0:e.content)||((e=r())?"anonymous-"+e:null)||void 0};try{await fetch(t,{method:"post",body:JSON.stringify(e)})}catch(e){}}}(e)}};function mt(){if(!(this instanceof mt))return new mt;this.size=0,this.uid=0,this.selectors=[],this.indexes=Object.create(this.indexes),this.activeIndexes=[]}var V=window.document.documentElement,Rt=V.matches||V.webkitMatchesSelector||V.mozMatchesSelector||V.oMatchesSelector||V.msMatchesSelector;mt.prototype.matchesSelector=function(e,t){return Rt.call(e,t)},mt.prototype.querySelectorAll=function(e,t){return t.querySelectorAll(e)};var Nt=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;(mt.prototype.indexes=[]).push({name:"ID",selector:function(e){if(e=e.match(Nt))return e[0].slice(1)},element:function(e){if(e.id)return[e.id]}});var Ot=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;mt.prototype.indexes.push({name:"CLASS",selector:function(e){if(e=e.match(Ot))return e[0].slice(1)},element:function(e){e=e.className;if(e)return"string"==typeof e?e.split(/\s/):"object"==typeof e&&"baseVal"in e?e.baseVal.split(/\s/):void 0}});var Tt=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;function At(){this.map={}}mt.prototype.indexes.push({name:"TAG",selector:function(e){if(e=e.match(Tt))return e[0].toUpperCase()},element:function(e){return[e.nodeName.toUpperCase()]}}),mt.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}};var Lt="function"==typeof window.Map?window.Map:(At.prototype.get=function(e){return this.map[e+" "]},At.prototype.set=function(e,t){this.map[e+" "]=t},At),St=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function Ut(e,t){var r,n,i,o,a,s,u=(e=e.slice(0).concat(e.default)).length,l=t,c=[];do{if(St.exec(""),(i=St.exec(l))&&(l=i[3],i[2]||!l))for(r=0;r<u;r++)if(a=(s=e[r]).selector(i[1])){for(n=c.length,o=!1;n--;)if(c[n].index===s&&c[n].key===a){o=!0;break}o||c.push({index:s,key:a});break}}while(i);return c}function bt(e,t){return e.id-t.id}mt.prototype.logDefaultIndexUsed=function(){},mt.prototype.add=function(e,t){var r,n,i,o,a,s,u=this.activeIndexes,l=this.selectors;if("string"==typeof e){for(r={id:this.uid++,selector:e,data:t},a=Ut(this.indexes,e),n=0;n<a.length;n++)i=(s=a[n]).key,(s=function(e,t){for(var r,n=0,i=e.length;n<i;n++)if(r=e[n],t.isPrototypeOf(r))return r}(u,o=s.index))||((s=Object.create(o)).map=new Lt,u.push(s)),o===this.indexes.default&&this.logDefaultIndexUsed(r),(o=s.map.get(i))||s.map.set(i,o=[]),o.push(r);this.size++,l.push(e)}},mt.prototype.remove=function(e,t){if("string"==typeof e){for(var r,n,i,o,a,s,u=this.activeIndexes,l={},c=1===arguments.length,d=Ut(this.indexes,e),f=0;f<d.length;f++)for(r=d[f],n=u.length;n--;)if(o=u[n],r.index.isPrototypeOf(o)){if(a=o.map.get(r.key))for(i=a.length;i--;)(s=a[i]).selector!==e||!c&&s.data!==t||(a.splice(i,1),l[s.id]=!0);break}this.size-=Object.keys(l).length}},mt.prototype.queryAll=function(e){if(!this.selectors.length)return[];for(var t,r,n,i,o,a,s={},u=[],l=this.querySelectorAll(this.selectors.join(", "),e),c=0,d=l.length;c<d;c++)for(n=l[c],t=0,r=(i=this.matches(n)).length;t<r;t++)s[(a=i[t]).id]?o=s[a.id]:(o={id:a.id,selector:a.selector,data:a.data,elements:[]},s[a.id]=o,u.push(o)),o.elements.push(n);return u.sort(bt)},mt.prototype.matches=function(e){if(!e)return[];for(var t,r,n,i,o,a,s,u,l,c=this.activeIndexes,d={},f=[],E=0,p=c.length;E<p;E++)if(a=(o=c[E]).element(e))for(t=0,n=a.length;t<n;t++)if(s=o.map.get(a[t]))for(r=0,i=s.length;r<i;r++)!d[l=(u=s[r]).id]&&this.matchesSelector(e,u.selector)&&(d[l]=!0,f.push(u));return f.sort(bt)};var Dt={},Ct={},Vt=new WeakMap,Pt=new WeakMap,Mt=new WeakMap,Ft=Object.getOwnPropertyDescriptor(Event.prototype,"currentTarget");function xt(e,t,r){var n=e[t];return e[t]=function(){return r.apply(e,arguments),n.apply(e,arguments)},e}function kt(){Vt.set(this,!0)}function wt(){Vt.set(this,!0),Pt.set(this,!0)}function Bt(){return Mt.get(this)||null}function Gt(e,t){Ft&&Object.defineProperty(e,"currentTarget",{configurable:!0,enumerable:!0,get:t||Ft.get})}function Kt(e){if(function(e){try{return e.eventPhase,1}catch(e){return}}(e)){var t=(1===e.eventPhase?Ct:Dt)[e.type];if(t){var r=function(e,t,r){var n=[],i=t;do{if(1!==i.nodeType)break;var o=e.matches(i)}while(o.length&&(o={node:i,observers:o},r?n.unshift(o):n.push(o)),i=i.parentElement);return n}(t,e.target,1===e.eventPhase);if(r.length){xt(e,"stopPropagation",kt),xt(e,"stopImmediatePropagation",wt),Gt(e,Bt);for(var n=0,i=r.length;n<i&&!Vt.get(e);n++){var o=r[n];Mt.set(e,o.node);for(var a=0,s=o.observers.length;a<s&&!Pt.get(e);a++)o.observers[a].data.call(o.node,e)}Mt.delete(e),Gt(e)}}}}function jt(e,t,r,n){var i=!!(3<arguments.length&&void 0!==n?n:{}).capture,o=i?Ct:Dt,n=o[e];n||(n=new mt,o[e]=n,document.addEventListener(e,Kt,i)),n.add(t,r)}function Yt(){var e=(new Date).getTime(),t=`${Math.round(Math.random()*(Math.pow(2,31)-1))}.${Math.round(e/1e3)}`;return function(e,t=null){let r=document.domain;if(null==r)throw new Error("Unable to get document domain");r.endsWith(".github.com")&&(r="github.com");var n="https:"===location.protocol?"; secure":"",t=t?"; expires="+t:"";r="."+r;try{document.cookie=`_octo=${e}; path=/; domain=${r}${t}${n}; samesite=lax`}catch(e){}}("GH1.1."+t,new Date(e+31536e6).toUTCString()),t}jt("click","[data-octo-click]",function(t){if(window._octo){const r=t.currentTarget,n=r instanceof HTMLElement&&r.getAttribute("data-octo-click")||"",i={};i.event_type=n;const o={},a={},s={};let e=[];r instanceof HTMLElement&&r.hasAttribute("data-octo-dimensions")&&(e=(r.getAttribute("data-octo-dimensions")||"").split(","));for(const u of document.head?document.head.querySelectorAll('meta[name^="octolytics-"]'):[])u instanceof HTMLMetaElement&&(u.name.startsWith("octolytics-dimension-")?o[u.name.replace(/^octolytics-dimension-/,"")]=u.content:u.name.startsWith("octolytics-measure-")?a[u.name.replace(/^octolytics-measure-/,"")]=u.content:u.name.startsWith("octolytics-context-")?s[u.name.replace(/^octolytics-context-/,"")]=u.content:u.name.startsWith("octolytics-actor-")?o[u.name.replace(/^octolytics-/,"").replace(/-/g,"_")]=u.content:u.name.startsWith("octolytics-")&&(i[u.name.replace(/^octolytics-/,"").replace(/-/g,"_")]=u.content));t=document.querySelector("meta[name=visitor-payload]");if(t instanceof HTMLMetaElement){const l=JSON.parse(atob(t.content));Object.assign(o,l)}if(r instanceof HTMLElement&&r.hasAttribute("data-ga-click")){const l=(r.getAttribute("data-ga-click")||"").split(",").map(e=>e.trim());o.category=l[0],o.action=l[1]}for(const c of e){const l=c.split(":"),r=l.shift();r&&(o[r]=l.join(":"))}i.dimensions=o,i.measures=a,i.context=s,function(e){if(window._octo){const r=Math.floor((new Date).getTime()/1e3);e.timestamp=r;var t='meta[name="octolytics-event-url"]';if(document.head&&document.head.querySelector(t)){const r=document.head.querySelector(t).content,n=JSON.stringify(e);try{navigator.sendBeacon&&navigator.sendBeacon(r,n)}catch(e){}}}}(i)}});var Ht=null,qt=null,zt=[];function Wt(n,t){var i=[];function o(){var e=i;i=[],t(e)}return function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];i.push(t),1===i.length&&Xt(n,o)}}function Xt(e,t){qt=qt||new MutationObserver(Jt),Ht||(Ht=e.createElement("div"),qt.observe(Ht,{attributes:!0})),zt.push(t),Ht.setAttribute("data-twiddle",""+Date.now())}function Jt(){var e=zt;zt=[];for(var t=0;t<e.length;t++)try{e[t]()}catch(e){setTimeout(function(){throw e},0)}}var Zt=new WeakMap,$t=new WeakMap,Qt=new WeakMap,er=new WeakMap;function tr(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n[0],o=n[1],n=n[2];i===or?(function(e,t){{var r,n,i;t instanceof e.elementConstructor&&((r=Zt.get(t))||(r=[],Zt.set(t,r)),-1===r.indexOf(e.id)&&(n=void 0,(n=e.initialize?e.initialize.call(void 0,t):n)&&((i=$t.get(t))||(i={},$t.set(t,i)),i[""+e.id]=n),r.push(e.id)))}}(n,o),function(e,t){{var r,n,i;t instanceof e.elementConstructor&&((r=er.get(t))||(r=[],er.set(t,r)),-1===r.indexOf(e.id)&&(e.elements.push(t),i=$t.get(t),(i=i?i[""+e.id]:null)&&i.add&&i.add.call(void 0,t),e.subscribe&&(n=e.subscribe.call(void 0,t))&&((i=Qt.get(t))||(i={},Qt.set(t,i)),i[""+e.id]=n),e.add&&e.add.call(void 0,t),r.push(e.id)))}}(n,o)):i===ar?rr(n,o):i===sr&&function(e,t){var r=er.get(t);if(r){for(var n=r.slice(0),i=0;i<n.length;i++){var o,a=e[n[i]];a&&(-1!==(o=a.elements.indexOf(t))&&a.elements.splice(o,1),o=$t.get(t),(o=o?o[""+a.id]:null)&&o.remove&&o.remove.call(void 0,t),o=Qt.get(t),(o=o?o[""+a.id]:null)&&o.unsubscribe&&o.unsubscribe(),a.remove&&a.remove.call(void 0,t))}er.delete(t)}}(e.observers,o)}}function rr(e,t){var r,n,i,o;t instanceof e.elementConstructor&&((r=er.get(t))&&(-1!==(n=e.elements.indexOf(t))&&e.elements.splice(n,1),-1!==(n=r.indexOf(e.id))&&((i=(i=$t.get(t))?i[""+e.id]:null)&&i.remove&&i.remove.call(void 0,t),e.subscribe&&(o=(o=Qt.get(t))?o[""+e.id]:null)&&o.unsubscribe&&o.unsubscribe(),e.remove&&e.remove.call(void 0,t),r.splice(n,1)),0===r.length&&er.delete(t)))}var nr=null;function ir(e){return"matches"in e||"webkitMatchesSelector"in e||"mozMatchesSelector"in e||"oMatchesSelector"in e||"msMatchesSelector"in e}var or=1,ar=2,sr=3;function ur(e,t,r){for(var n,i,o,a=0;a<r.length;a++){var s=r[a];"childList"===s.type?(lr(e,t,s.addedNodes),function(e,t){for(var r=0;r<t.length;r++){var n=t[r];if("querySelectorAll"in n){e.push([sr,n]);for(var i=n.querySelectorAll("*"),o=0;o<i.length;o++)e.push([sr,i[o]])}}}(t,s.removedNodes)):"attributes"===s.type&&cr(e,t,s.target)}n=e.ownerDocument,null===nr&&(i=n.createElement("div"),o=n.createElement("div"),n=n.createElement("div"),i.appendChild(o),o.appendChild(n),i.innerHTML="",nr=n.parentNode!==o),nr&&function(e,t){for(var r=0;r<e.observers.length;r++){var n=e.observers[r];if(n)for(var i=n.elements,o=0;o<i.length;o++){var a=i[o];a.parentNode||t.push([sr,a])}}}(e,t)}function lr(e,t,r){for(var n=0;n<r.length;n++){var i=r[n];if(ir(i))for(var o=e.selectorSet.matches(i),a=0;a<o.length;a++){var s=o[a].data;t.push([or,i,s])}if("querySelectorAll"in i)for(var u=e.selectorSet.queryAll(i),l=0;l<u.length;l++)for(var c=u[l],d=c.data,f=c.elements,E=0;E<f.length;E++)t.push([or,f[E],d])}}function cr(e,t,r){if(ir(r))for(var n=e.selectorSet.matches(r),i=0;i<n.length;i++){var o=n[i].data;t.push([or,r,o])}if("querySelectorAll"in r){var a=er.get(r);if(a)for(var s=0;s<a.length;s++){var u=e.observers[a[s]];u&&(e.selectorSet.matchesSelector(r,u.selector)||t.push([ar,r,u]))}}}var dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fr=0;function Er(e){var t,r;this.rootNode=9===e.nodeType?e.documentElement:e,this.ownerDocument=9===e.nodeType?e:e.ownerDocument,this.observers=[],this.selectorSet=new mt,this.mutationObserver=new MutationObserver(function(e,t){var r=[];ur(e,r,t),tr(e,r)}.bind(this,this)),this._scheduleAddRootNodes=Wt(this.ownerDocument,function(e){var t=[];lr(e,t,[e.rootNode]),tr(e,t)}.bind(this,this)),this._handleThrottledChangedTargets=Wt(this.ownerDocument,function(e,t){var r=[];!function(e,t,r){for(var n=0;n<r.length;n++)for(var i=r[n],o=i.form?i.form.elements:e.rootNode.querySelectorAll("input"),a=0;a<o.length;a++)cr(e,t,o[a])}(e,r,t),tr(e,r)}.bind(this,this)),this.rootNode.addEventListener("change",function(e,t){e._handleThrottledChangedTargets(t.target)}.bind(this,this),!1),t=this.ownerDocument,r=function(e){e.mutationObserver.observe(e.rootNode,{childList:!0,attributes:!0,subtree:!0}),e._scheduleAddRootNodes()}.bind(this,this),"interactive"===(e=t.readyState)||"complete"===e?Xt(t,r):t.addEventListener("DOMContentLoaded",Xt(t,r))}Er.prototype.disconnect=function(){this.mutationObserver.disconnect()},Er.prototype.observe=function(e,t){var r=void 0;"function"==typeof t?r={selector:e,initialize:t}:"object"===(void 0===t?"undefined":dr(t))?(r=t).selector=e:r=e;var n=this,i={id:fr++,selector:r.selector,initialize:r.initialize,add:r.add,remove:r.remove,subscribe:r.subscribe,elements:[],elementConstructor:r.hasOwnProperty("constructor")?r.constructor:this.ownerDocument.defaultView.Element,abort:function(){n._abortObserving(i)}};return this.selectorSet.add(i.selector,i),this.observers[i.id]=i,this._scheduleAddRootNodes(),i},Er.prototype._abortObserving=function(e){for(var t=e.elements,r=0;r<t.length;r++)rr(e,t[r]);this.selectorSet.remove(e.selector,e),delete this.observers[e.id]},Er.prototype.triggerObservers=function(e){var t=[];!function(e,t,r){if("querySelectorAll"in r){cr(e,t,r);for(var n=r.querySelectorAll("*"),i=0;i<n.length;i++)cr(e,t,n[i])}}(this,t,e),tr(this,t)};var pr=void 0;let gr;function _r(){return r()||Yt()}function hr(e){const t={};for(var{name:r,value:n}of e.attributes)if(r.startsWith("data-optimizely-meta-")){const e=r.replace("data-optimizely-meta-","");n&&n.trim().length&&(t[e.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()})]=n)}return t}!async function(){gr=function(){(e=function(){var e;try{return null===(e=window.localStorage)||void 0===e?void 0:e.getItem("optimizely.logLevel")}catch(e){return null}}())?It.setLogLevel(e):It.setLogger(null);var e=null===(e=document.head.querySelector("meta[name=optimizely-datafile]"))||void 0===e?void 0:e.content;return It.createInstance({datafile:e,errorHandler:yt})}(),await gr.onReady()}(),jt("click","[data-optimizely-event]",function(e){if(gr){const t=e.currentTarget,r=t.getAttribute("data-optimizely-event")||"",[n,i]=r.trim().split(/\s*,\s*/),o=hr(t);n&&i?gr.track(n,i,o):n&&gr.track(n,_r(),o)}}),function(){(pr=pr||new Er(window.document)).observe.apply(pr,arguments)}("[data-optimizely-experiment]",e=>{if(gr){var t=e.getAttribute("data-optimizely-experiment");if(t&&!e.hidden){var r=gr.activate(t,_r());if(r)for(const n of e.querySelectorAll("[data-optimizely-variation]")){const e=n.getAttribute("data-optimizely-variation");n.hidden=!(e===r)}}}});const vr=(null===(V=null===(V=document.querySelector('meta[name="enabled-homepage-translation-languages"]'))||void 0===V?void 0:V.getAttribute("content"))||void 0===V?void 0:V.split(","))||[],Ir=0<i("_locale_experiment").length&&"ko"===i("_locale_experiment")[0].value&&vr.includes("ko");Ir&&"/"===window.location.pathname&&async function(){var e;const t="ko_homepage_translation",r=_r(),n=null===(e=null===(e=i("_locale")[0])||void 0===e?void 0:e.value)||void 0===e?void 0:e.slice(0,2);gr.setForcedVariation(t,r,n),gr.activate(t,r);for(const i of document.querySelectorAll("[data-optimizely-variation]"))i.hidden=n!==i.getAttribute("data-optimizely-variation");for(const i of document.querySelectorAll('form[action^="/join"]'))i.addEventListener("submit",()=>{gr.track("submit.homepage_signup",r)});for(const i of document.querySelectorAll('a[href^="/join"]'))i.addEventListener("click",()=>{gr.track("click.homepage_signup",r)})}(),Ir&&"/join"===window.location.pathname&&async function(){var e;null===(e=document.getElementById("signup-form"))||void 0===e||e.addEventListener("submit",()=>{var e=_r();gr.activate("ko_homepage_translation",e),gr.track("submit.create_account",e)})}();const yr=document.querySelector('meta[name^="user-currency"]');yr&&"/pricing"===window.location.pathname&&async function(){var e;const t=(null===(e=null===(e=document.querySelector('meta[name^="supported-currencies"]'))||void 0===e?void 0:e.getAttribute("content"))||void 0===e?void 0:e.split(","))||[],r="local_currency_pricing",n=_r(),i=null===(e=null==yr?void 0:yr.getAttribute("content"))||void 0===e?void 0:e.toUpperCase(),o=new URLSearchParams(window.location.search);if("USD"!==i&&i&&t.includes(i)){o.has("currency")&&gr.setForcedVariation(r,n,"localized_currency");var a="usd"===gr.activate(r,n)?"USD":i;gr.track("view.pricing_page",n,{requestedCurrency:i});for(const s of document.querySelectorAll("[data-currency]"))s.hidden=s.getAttribute("data-currency")!==a}}(),jt("click","#signup_button",function(){var e;if(gr&&yr){const t=new URLSearchParams(document.location.href);t.get("pricing_exp")&&null!==(e=t.get("ref_page"))&&void 0!==e&&e.startsWith("/pricing")&&(e=null===(e=null==yr?void 0:yr.getAttribute("content"))||void 0===e?void 0:e.toUpperCase(),gr.track("submit.create_account",_r(),{requestedCurrency:e}))}})}();
