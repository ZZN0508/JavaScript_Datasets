define("modules/clean/mailcheck",["require","exports","modules/core/html","modules/core/i18n"],function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,n=(a.initClass=function(){this.DOMAINS=["gmail.com","hotmail.com","yahoo.com","aol.com","web.de","gmx.de","googlemail.com","me.com","live.com","msn.com","mail.ru","comcast.net","google.com","mac.com"],this.WHITELIST_REGEXS=[/ymail.com/,/yahoo\.co\./,/yahoo\.com\./,/hotmail\.co\./,/hotmail\.com\./,/gmx\.net/,/gmx\.at/,/gmx\.ch/,/gmx\.com/,/mail\.com/,/web\.com/],this.THRESHOLD=2},a.prototype.checkInput=function(){var e=this.suggest(this.$input.val());e?this.populate(e):this.clear()},a.prototype.populate=function(e){var t=this,n=r.HTML.escape(e.local).toHTML()+"@<span class='email_warning_area'>"+r.HTML.escape(e.domain).toHTML()+"</span>";return this.$suggestion_container.html(new r.HTML(i.intl.formatMessage({id:"1826y6",defaultMessage:"Did you mean {suggested_email}?"},{suggested_email:n})).toHTML()),this.$suggestion_container.show(),this.$suggestion_container.on("click",function(){return t.$input.val(e.full),t.clear()})},a.prototype.clear=function(){return this.$suggestion_container.empty(),this.$suggestion_container.hide()},a.prototype.suggest=function(e){if((e=void 0===e?"":e).length){e=e.toLowerCase();var t=this.splitEmail(e);if(!t)return!1;e=t.local,t=t.domain;if(this.whitelistedDomain(t))return!1;t=this.findClosestDomain(t);return!!t&&{local:e,domain:t,full:e+"@"+t}}},a.prototype.whitelistedDomain=function(e){for(var t=0,n=Array.from(a.WHITELIST_REGEXS);t<n.length;t++)if(n[t].test(e))return!0;return!1},a.prototype.splitEmail=function(e){e=e.split("@");return 2===e.length&&{local:e[0],domain:e[1]}},a.prototype.findClosestDomain=function(e){for(var t=99,n=null,r=0,i=Array.from(a.DOMAINS);r<i.length;r++){var s=i[r],o=this.stringDistance(e,s);o<t&&(t=o,n=s)}return!!(n&&n!==e&&t<=a.THRESHOLD)&&n},a.prototype.stringDistance=function(e,t){if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(var n=0,r=0,i=0,s=0;n+r<e.length&&n+i<t.length;){if(e.charAt(n+r)===t.charAt(n+i))s++;else for(var r=0,i=0,o=0;o<5;){if(n+o<e.length&&e.charAt(n+o)===t.charAt(n)){r=o;break}if(n+o<t.length&&e.charAt(n)===t.charAt(n+o)){i=o;break}o++}n++}return(e.length+t.length)/2-s},(n=a).initClass(),n);function a(e,t,n){void 0===n&&(n={}),this.$input=e,this.$suggestion_container=t,this.checkInput();n=!0===n.livecheck?"keyup blur":"blur";this.$input.on(n,this.checkInput.bind(this))}t.default=n}),define("modules/clean/deprecated_pyxl/controllers/login_or_register",["require","exports","tslib","jquery","modules/clean/auth_event_logger","modules/clean/register_form"],function(e,t,n,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),s=n.__importStar(s);o.prototype.logAppropriateAuthIntent=function(){this.$login_form.is(":visible")?r.AuthEventLogger.log_web_login_intent():this.$register_form.is(":visible")&&r.AuthEventLogger.log_web_signup_intent()},o.prototype._toggle_forms=function(){this.$login_form.toggle(),this.$register_form.toggle(),this.logAppropriateAuthIntent()},n=o;function o(e){var r=this;this.$login_form=e.find(".login-register-login-part"),this.$register_form=e.find(".login-register-register-part"),this.logAppropriateAuthIntent(),e.click(function(e){if(i.default(e.target).hasClass("login-register-switch-link"))return e.preventDefault(),r._toggle_forms(),r.$login_form.find(".text-input input:visible").first().focus(),r.$register_form.find(".text-input input:visible").first().focus()}),this.$register_form.on(s.USER_EXISTS,function(e){for(var t in r._toggle_forms(),e.prefill){var n=e.prefill[t];r.$login_form.find(t).val(n)}return r.$login_form.find(e.focus).focus()})}t.default=n}),define("modules/clean/form_util/name_parser",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(r.splitFullName=function(e){e=e.split(" ");return[e[0],e.slice(1).join(" ")]},r);function r(){}t.default=n}),define("modules/clean/register_form",["require","exports","tslib","jquery","modules/clean/abuse/invisible_captcha","modules/clean/deprecated_pyxl/controllers/ajax_form","modules/clean/em_string","modules/clean/form_util/name_parser","modules/clean/mailcheck","modules/clean/profile_services/auth_callback_handler","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/web_register_logging_data","modules/core/accessible_announce","modules/core/browser"],function(m,e,_,h,g,f,p,i,v,a,b,y,l,s,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RegisterForm=void 0,h=_.__importDefault(h),f=_.__importDefault(f),i=_.__importDefault(i),v=_.__importDefault(v),b=_.__importDefault(b),n=_.__importStar(n);var t=(d.prototype._handle_google_callback=function(e){var t=this.$registerForm.find("input[type='hidden'][name='cont']").val(),n=this.$registerForm.find("input[type='hidden'][name='cont']").val(),r=this.$registerForm.find("input[type='hidden'][name='signup_tag']").val(),i=this.$registerForm.find("input[type='hidden'][name='k']").val(),s=this.$registerForm.find("input[type='hidden'][name='eh']").val(),o=l.getWebRegisterLoggingData();a.handleRegisterResponse(e,_.__assign({registerCont:t,loginCont:n,signupTag:r,canRedirect:this.canRedirect,k:i,eh:s,signupEndpoint:this.signupEndpoint},o),{form:this.$registerForm,newAccount:d.NEW_ACCOUNT_FROM_3RD_PARTY,userExists:d.USER_EXISTS})},d.prototype._before_submit=function(){!0===this.combinedName&&this._combined_name_handler();var e=l.setWebRegisterLoggingData({signup_endpoint:this.signupEndpoint});this.registerController.add_additional_data(e)},d.prototype._on_register_success=function(e,t){this.$registerForm.trigger(d.REGISTER_SUCCESS,t),this.canRedirect&&(t.force_redirect_url?n.redirect(t.redirect_url):this.cont?n.redirect(this.cont):t.redirect_url&&n.redirect(t.redirect_url))},d.prototype._animate_form=function(){var e=this;this.$registerFormContainer.hasClass("form_shown")||h.default.when(this.$registerFormContainer.animate({height:this.$registerForm.height()},{easing:"easeInOutCubic",duration:500})).done(function(){e.$registerFormContainer.addClass("form_shown"),e.$registerFormContainer.filter(":input").filter(":visible").first().focus()})},d.prototype.fill=function(t){var n=this;Object.keys(t).forEach(function(e){return n.$registerForm.find("[name="+e+"]").val(t[e])})},d.prototype._index_error_handler=function(e){this.$registerFormContainer.find(".register-form__errors").remove();var t,n,r=h.default("<ul />").addClass("register-form__errors"),i=[];for(t in e)e.hasOwnProperty(t)&&(n=(n=e[t]).message_text||n.message_html,i.push(n),h.default("<li />").addClass("register-form__error").html(n).appendTo(r),this.$registerForm.find(".input-"+t).addClass("text-input--error"),"tos_agree"===t&&this.$registerForm.find(".checkbox-inline.agree").addClass("checkbox-inline--error"),this.combinedName&&"fname"===t&&(this.$registerForm.find(".input-fullname").addClass("text-input--error"),this.$registerForm.find("input[name='fullname']").addClass("input-error")),this.$registerForm.find("input[name='"+t+"']").addClass("input-error"));return this.$registerFormContainer.append(r),s.AccessibleAnnounce.assertive(i.join(". "))},d.prototype._index_clear_error_handler=function(e){e=h.default(e.target);e.removeClass("input-error"),"checkbox"===e.attr("type")?e.parents(".checkbox-inline--error").removeClass("checkbox-inline--error"):e.parents(".text-input--error").removeClass("text-input--error")},d.prototype._combined_name_handler=function(){var e=this.$registerFormContainer.find('input[name="fullname"]'),t=this.$registerFormContainer.find('input[name="fname"]'),n=this.$registerFormContainer.find('input[name="lname"]'),r=i.default.splitFullName(e.val()),e=r[0],r=r[1];!0!==this.lastNameGoesFirst?(t.val(e),void 0!==r&&r!==e&&n.val(r)):(n.val(e),void 0!==r&&r!==e&&t.val(r))},d.REGISTER_SUCCESS="db:register:success",d.NEW_ACCOUNT_FROM_3RD_PARTY="db:register:new_account_from_3rd_party",d.USER_EXISTS="db:register:user_exists",d);function d(e,t,n,r,i,s,o,a,l,d){var c=this;void 0===d&&(d=!1),this._handleResendClick=function(t){var n;"login-register-resend-invite"===t.target.className&&(n=c.$registerFormContainer.find('input[name="email"]').val(),new Promise(function(e,t){m(["modules/clean/auth/register/form"],e,t)}).then(_.__importStar).then(function(e){(0,e.handleInviteResendImpl)(t,c.isSendingInvite,n,function(){return c.isSendingInvite=!0},function(){return c.isSendingInvite=!1})}))},this._handle_google_callback=this._handle_google_callback.bind(this),this._before_submit=this._before_submit.bind(this),this._on_register_success=this._on_register_success.bind(this),this._animate_form=this._animate_form.bind(this),this._index_error_handler=this._index_error_handler.bind(this),this._combined_name_handler=this._combined_name_handler.bind(this),this.$registerFormContainer=e,this.canRedirect=n,this.showForm=r,this.clientSideValidation=i,this.customErrorHandler=s,this.combinedName=o,this.lastNameGoesFirst=a,this.signupEndpoint=l,this.isSendingInvite=!1,this.$registerForm=this.$registerFormContainer.find(".register-form"),"index"===this.customErrorHandler&&(u=this._index_error_handler,this.$registerForm.on("click change","input",this._index_clear_error_handler)),this.registerController=new f.default(this.$registerForm,this._before_submit,{client_side_validation:this.clientSideValidation,error_handler:u}),this.cont=this.$registerForm.find("input[name='cont']").val(),this.$registerForm.find(".login-button, .auth-google").prop("disabled",!1),this.$registerForm.find(".login-button.disabled-button").prop("disabled",!0),g.loadCaptcha(this.registerController,this.$registerForm,"email","REGISTER",d);var u=this.$registerForm.find("label[for='tos_agree']"),d=parseInt(u.css("font-size"),10);200<new p.Emstring(u.text()).length*d&&this.$registerForm.find(".checkbox").removeClass("checkbox-inline"),this.$registerForm.on(f.default.SUCCESS_EVENT,this._on_register_success),this.showForm?this.$registerForm.find("input[type='hidden'][name='is_third_party_auth']").val()&&this.$registerFormContainer.find("input").filter(":visible").filter(function(e,t){return!h.default(t).val()}).first().focus():this.$registerForm.find(".login-button").on("click",function(e){c.$registerFormContainer.hasClass("form_shown")||(e.preventDefault(),c._animate_form())}),this.$registerForm.find(".auth-google").click(function(e){e="true"===e.target.getAttribute("data-third-party-no-popup");(new y.ProfileServicesLinkingHandler).auth_service_create_user_if_needed(b.default.GOOGLE,function(e){c._handle_google_callback(e)},"register_form",e?y.AuthWindowOption.REDIRECT:y.AuthWindowOption.POP_UP)}),"small"===t?(this.$registerForm.find(".bubble-dropdown-container .bubble-dropdown").css({visibility:"hidden"}),this.$registerForm.find(".password-input-meter").css({cursor:"default"})):new v.default(this.$registerForm.find(".input-email"),this.$registerForm.find(".email-suggestion"),{livecheck:!1});t=this.$registerForm.find("input[type='checkbox'][name='tos_agree']");0<t.length&&t.on("change",function(e){var t=c.$registerForm.find(".agree .error-message");0<t.length&&t[0].remove()}),document.addEventListener("click",this._handleResendClick)}e.RegisterForm=t}),define("modules/clean/sharing/components/shared_content_icon",["require","exports","tslib","react","spectrum/file_icon/index","spectrum/icon_content/index"],function(e,t,n,r,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharedContentIcon=void 0;var o,n=(o=(r=n.__importDefault(r)).default.Component,n.__extends(a,o),a.prototype.render=function(){var e=this.props,t=e.className,e=e.variant;return this.props.isFolder?r.default.createElement(s.IconContent,{className:t,name:"large"===e?"folder_shared-large":"folder_shared-small"}):r.default.createElement(i.FileIcon,{className:t,path:this.props.contentName,variant:e})},a);function a(){return null!==o&&o.apply(this,arguments)||this}t.SharedContentIcon=n}),define("modules/clean/sharing/invitation_signup_page",["require","exports","tslib","react","jquery","modules/clean/em_string","modules/clean/react/maestro_nav/shared_code/constants","modules/clean/react/maestro_nav/shared_code/dropbox_logo","modules/clean/react/maestro_nav/shared_code/strings","modules/clean/sharing/components/shared_content_icon","modules/core/i18n"],function(e,t,n,r,i,s,o,a,l,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharedFolderHeader=t.InvitationSignupPageHeader=void 0,r=n.__importDefault(r),i=n.__importDefault(i);var u,m=(u=r.default.Component,n.__extends(_,u),_.prototype.onSignInClick=function(){var e=i.default(".login-register-container"),t=e.find(".login-register-login-part"),e=e.find(".login-register-register-part");t.show(),e.hide(),t.find(".text-input input:visible").first().focus()},_.prototype.render=function(){return r.default.createElement("div",{id:"page-header",className:"page-header-border"},r.default.createElement("a",{className:"maestro-nav__home-button",href:"https://"+o.WWW_HOST+"/"},r.default.createElement(a.DropboxLogo,{className:"maestro-nav__logo","aria-label":l.homeAriaLabel()})),r.default.createElement("a",{className:"invitation-signup-page-sign-in",onClick:this.onSignInClick},c.intl.formatMessage({id:"raLp6W",defaultMessage:"Sign in"})))},_);function _(){return null!==u&&u.apply(this,arguments)||this}t.InvitationSignupPageHeader=m;var h,n=(h=r.default.Component,n.__extends(g,h),g.prototype.render=function(){return r.default.createElement("div",{className:"sf-invite-referral__header"},this.renderContentIcon(),r.default.createElement("h1",{className:"sf-invite-referral__heading"},this.renderHeaderText()),this.renderRegisterText())},g.prototype.renderContentIcon=function(){return r.default.createElement(d.SharedContentIcon,{contentName:this.props.contentName,isFolder:!this.props.isFile,variant:"large"})},g.prototype.renderRegisterText=function(){if(this.props.inNewInbandJourney){var e={content_name:s.Emstring.em_snippet(this.props.contentName,32,.5),content_name_span:function(e){return r.default.createElement("span",{className:"sf-invite-referral__folder-name"},e)}},e=c.intl.formatMessage({id:"3Nsy4s",defaultMessage:"To keep <content_name_span>{content_name}</content_name_span> secure, we need to confirm your identity."},e);return r.default.createElement("div",{className:"sf-invite-referral__subheader"},e)}return""},g.prototype.renderHeaderText=function(){var e={sender_name:s.Emstring.em_snippet(this.props.senderDisplayName,28,.5),content_name:s.Emstring.em_snippet(this.props.contentName,32,.5),sender_name_span:function(e){return r.default.createElement("span",{className:"sf-invite-referral__sender-name"},e)},content_name_span:function(e){return r.default.createElement("span",{className:"sf-invite-referral__folder-name"},e)}};return this.props.isFile?this.props.inNewInbandJourney?c.intl.formatMessage({id:"Efc8DE",defaultMessage:"Sign up to access the file <sender_name_span>{sender_name}</sender_name_span> shared."},e):c.intl.formatMessage({id:"uhqcGI",defaultMessage:"<sender_name_span>{sender_name}</sender_name_span> wants to share the file <content_name_span>{content_name}</content_name_span> with you."},e):this.props.inNewInbandJourney?c.intl.formatMessage({id:"svGlE8",defaultMessage:"Sign up to access the folder <sender_name_span>{sender_name}</sender_name_span> shared."},e):c.intl.formatMessage({id:"59a7/c",defaultMessage:"<sender_name_span>{sender_name}</sender_name_span> wants to share the folder <content_name_span>{content_name}</content_name_span> with you."},e)},g);function g(){return null!==h&&h.apply(this,arguments)||this}t.SharedFolderHeader=n});
