(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{1226:function(e,t,n){e.exports=n(1247)},1247:function(e,t,n){var r=n(1248);e.exports=r},1248:function(e,t,n){n(1249);var r=n(17);e.exports=r.parseFloat},1249:function(e,t,n){var r=n(3),o=n(1250);r({global:!0,forced:parseFloat!=o},{parseFloat:o})},1250:function(e,t,n){var r=n(26),o=n(250).trim,a=n(179),c=r.parseFloat,s=1/c(a+"-0")!=-1/0;e.exports=s?function(e){var t=o(String(e)),n=c(t);return 0===n&&"-"==t.charAt(0)?-0:n}:c},1262:function(e,t,n){var r=n(233),o=n(229),a=n(343),c=n(225);e.exports=function(e,t,n){if(!c(n))return!1;var s=typeof t;return!!("number"==s?o(n)&&a(t,n.length):"string"==s&&t in n)&&r(n[t],e)}},1283:function(e,t,n){var r=n(759);e.exports=function(e){return e?(e=r(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},1297:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(228),o=n.n(r),a=n(232),c=n.n(a),s=n(18);var i=n(20),d=n.n(i);async function l(e,t={}){const n=(new Date).getTime(),{responseHeaders:r,...a}=e,i=c.a.format(a),l=Object(s.createLogger)("dal",{url:i});try{const e=await fetch(i,t),a=await async function(e){const{ok:t,status:n,statusText:r}=e,o={ok:t,status:n,statusText:r};let a="";try{if(a=await e.text(),!t)return{...o,data:{text:a}};const n=JSON.parse(a);return{...o,data:n}}catch(e){return{...o,data:{text:a}}}}(e);if(r){const t=function(e,t){return d()(t).call(t,(t,n)=>({...t,[n]:e.headers.get(n)}),{})}(e,r);a.data={...a.data,responseHeaders:t}}return l.info({responseTime:o()()-n+"ms",fetchOptions:t},"dal request"),a}catch(e){switch(!0){case"FetchError"===e.name&&"request-timeout"===e.type:throw new Error("Timeout exceeded for "+i);case"FetchError"===e.name&&"invalid-json"===e.type:throw new Error("Got non-JSON or invalid JSON response for "+i);default:throw e}}}},1316:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return p})),n.d(t,"a",(function(){return f}));var r=n(10),o=n.n(r),a=n(11),c=n.n(a),s=n(8),i=n.n(s),d=n(34),l=n.n(d);function u(){var e;if(!window.location.search)return{};const t={},n=l()(e=window.location.search).call(e,1).split("&");return i()(n).call(n,e=>{const n=e.split("=");t[n[0]]=n[1]}),t}function p(){!function(e){var t;const n=u();n[e]&&delete n[e];const r=c()(t=o()(n)).call(t,e=>e+"="+n[e]).join("&");window.history.pushState({},document.title,window.location.pathname+(r?"?"+r:""))}("ta")}function f(e){document.cookie=e+"=; Domain=.weather.com; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}},1386:function(e,t,n){var r=n(1226),o=n(1387),a=n(1262),c=n(1283),s=r,i=Math.min,d=Math.random;e.exports=function(e,t,n){if(n&&"boolean"!=typeof n&&a(e,t,n)&&(t=n=void 0),void 0===n&&("boolean"==typeof t?(n=t,t=void 0):"boolean"==typeof e&&(n=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=c(e),void 0===t?(t=e,e=0):t=c(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var l=d();return i(e+l*(t-e+s("1e-"+((l+"").length-1))),t)}return o(e,t)}},1387:function(e,t){var n=Math.floor,r=Math.random;e.exports=function(e,t){return e+n(r()*(t-e+1))}},1402:function(e,t,n){"use strict";function r({pathname:e=window.location.pathname,search:t="",bustCache:n=!1}){const r=new Date;return{pathname:e,search:""+t+(n?(t?"&":"")+"cbs="+r.getTime():"")}}n.d(t,"a",(function(){return r}))},1470:function(e,t,n){"use strict";n.d(t,"a",(function(){return A}));n(37);var r=n(11),o=n.n(r),a=n(72),c=n.n(a),s=n(38),i=n.n(s),d=n(8),l=n.n(d),u=n(20),p=n.n(u),f=n(1316),g=n(18),h=n(770);const b={amplitude:()=>n.e(390).then(n.bind(null,2024))};var v=n(6),y=n.n(v),m=n(10),O=n.n(m),j=n(1386),w=n.n(j);const U=Object(g.createLogger)("class MetricsApi");class I{constructor(e){this.vendorObjectsArray=void 0,this.selectedVendors=void 0,this.vendorObjectsMap=void 0,this.ready=void 0,this.vendorObjectsArray=e,this.vendorObjectsMap=p()(e).call(e,(e,t)=>{const{name:n}=t;return{...e,[n]:t}},{}),this.selectedVendors=[],U.debug(this,"MetricsApi instance constructed")}sendMetricsEvent(e){const{vendorObjectsMap:t,selectedVendors:n}=this;l()(n).call(n,n=>{const{adaptor:r}=t[n];r?(r.sendMetricsEvent(e),U.debug({metricsEvent:e,adaptor:r},"Completed sendMetricsEvent({ type, props }) on adaptor for "+n)):E(n)})}setUserProperties(e){const{vendorObjectsMap:t,selectedVendors:n}=this;l()(n).call(n,n=>{const{adaptor:r}=t[n];r?"function"==typeof r.setUserProperties?(r.setUserProperties(e),U.debug({newProps:e,adaptor:r},"Completed setUserProperties(newProps) on adaptor for "+n)):U.debug({adaptor:r},"setUserProperties not provided on adaptor for "+n+"; skipping"):E(n)})}resetUserAndDeviceId(){const{vendorObjectsMap:e,selectedVendors:t}=this;l()(t).call(t,t=>{const{adaptor:n}=e[t];n?"function"==typeof n.resetUserAndDeviceId?(n.resetUserAndDeviceId(),U.debug({adaptor:n},"Completed resetUserAndDeviceId() on adaptor for "+t)):U.debug({adaptor:n},"resetUserAndDeviceId not provided on adaptor for "+t+"; skipping"):E(t)})}getUserId(){const{vendorObjectsMap:e,selectedVendors:t}=this;l()(t).call(t,t=>{const{adaptor:n}=e[t];n?"function"==typeof n.getUserId?(n.getUserId(),U.debug({adaptor:n},"Completed getUserId() on adaptor for "+t)):U.debug({adaptor:n},"getUserId not provided on adaptor for "+t+"; skipping"):E(t)})}setAdaptor(e,t){const{vendorObjectsMap:n}=this;n[e]?"function"==typeof(null==t?void 0:t.sendMetricsEvent)?(n[e].adaptor=t,U.debug({vendorName:e,adaptor:t},"adaptor set!")):U.error("Error: setAdaptor for '"+e+"' called with malformed adaptor;\n",t,"adaptor not set!"):U.error("Error: setAdaptor called with invalid vendor name '"+e+"'",t,"adaptor not set!")}async init({userId:e}){const{vendorObjectsMap:t,ready:n}=this;return n||(this.ready=new i.a(async n=>{var r;const a=Object(f.b)(),{mapivendors:s}=a,d=c()(r=(null==s?void 0:s.split(","))||function(e){let t="amplitude";const n=[],r=[],a=O()(e),c=o()(a).call(a,t=>e[t]);l()(c).call(c,e=>{const{name:r,isDefault:o}=e;o?t=r:y()(n).call(n,r)||n.push(r)});const s=p()(c).call(c,(e,t)=>{const{isDefault:n,override:r}=t;return n?e:e+r},0);let i;if(s>99){const e=s/99;l()(c).call(c,t=>{const{override:n}=t,r=n/e;t.override=r}),i=1}else i=100-s;const d=w()(1,100);return d<=i?(p()(n).call(n,(t,n)=>{const o=e[n],{name:a,overlap:c}=o,s=t+c;return 0===r.length&&d<=s&&r.push(a),s},0),r.push(t)):p()(n).call(n,(t,n)=>{const o=e[n],{name:a,override:c}=o,s=t+c;return 0===r.length&&d<=s&&r.push(a),s},i),r}(t)).call(r,e=>!!b[e]),u=await i.a.all(o()(d).call(d,async e=>b[e]()));await i.a.all(o()(u).call(u,async t=>{const n=t.getAssets();await i.a.all(o()(n).call(n,e=>Object(h.a)(e,{async:!0})));const r=t.getAdaptor({userId:e});this.setAdaptor(t.name,r)})),this.selectedVendors=d,U.debug({dynaloadVendors:u,selectedVendors:d},"metricsApi.init() completed"),n()}),this.ready)}}function E(e){U.error("Missing Adaptor Error on sendMetricsEvent({ type, props }) to adaptor for "+e)}var S=n(94);let P=null;const A=()=>{if(!P){const e=function(){const{METRICS_API_VENDORS_CLIENT:e,METRICS_API_FREQUENCIES_CLIENT:t}=S.env,n=(e||"amplitude").split(","),r=(t||"D").split(",");return o()(n).call(n,(e,t)=>{const n=r[t];let o=!1,a=0,c=0;if(n)if("D"===n)o=!0;else if(/^\d+:\d+$/.test(n)){const[e,t]=n.split(":");a=Math.floor(e),c=Math.floor(t)}return{name:e,isDefault:o,override:a,overlap:c,adaptor:null}})}();P=new I(e)}return P}},1942:function(e,t,n){"use strict";n.r(t),n.d(t,"logger",(function(){return U})),n.d(t,"userAuthenticationSaga",(function(){return I})),n.d(t,"watchers",(function(){return E})),n.d(t,"checkUserLoggedIn",(function(){return S})),n.d(t,"logoutUpsUser",(function(){return P})),n.d(t,"onUpsUserLoggedOut",(function(){return A})),n.d(t,"refreshPageSaga",(function(){return M})),n.d(t,"getPageUrlConfigParams",(function(){return C})),n.d(t,"onUpsUserLoggedIn",(function(){return T})),n.d(t,"clearUpsUserIdFromStore",(function(){return x})),n.d(t,"checkLoggedInStatus",(function(){return L})),n.d(t,"fetchUpsUserId",(function(){return D})),n.d(t,"fetchUpsEmail",(function(){return N}));var r=n(232),o=n.n(r),a=n(5),c=n(135),s=n.n(c),i=n(1297),d=n(749);const l=Object(d.a)("UPS2","HOST","PROFILE","ups-2.weather.com"),u=Object(d.a)("UPS2","PROTOCOL","PROFILE","https");const p=Object(d.a)("UPS2","HOST","USER"),f=Object(d.a)("UPS2","PROTOCOL","USER","https");var g=n(1402),h=n(116),b=n(1470),v=n(1198),y=n(71),m=n(176),O=n(18),j=n(96),w=n(236);const U=Object(O.createLogger)("UserContext - Authentication");function*I(){yield Object(a.j)(E),yield Object(a.c)(L)}function*E(){yield Object(a.l)(y.m,P),yield Object(a.l)(y.I,A),yield Object(a.l)(y.d,T),yield Object(a.l)(y.g,S)}function*S(e={}){const{payload:{postAction:t,redirect:n,loginPathname:r,search:o}={}}=e;(yield Object(a.c)(D))?t&&t():(n&&(yield Object(a.c)(h.i,y.l,n)),yield Object(a.g)(Object(v.c)({pathname:r,search:o})))}function*P(e){const t=null==e?void 0:e.payload;U.debug({payload:t},"logoutUpsUser action triggered. "+t);try{const e=yield Object(a.c)(i.a,{host:l,protocol:u,pathname:"logout"},{method:"POST",credentials:"include"});(null==t?void 0:t.keepCurrentPage)&&(yield Object(a.c)(h.i,y.l,window.location.href));200===(null==e?void 0:e.status)&&(yield Object(a.g)(Object(v.b)(t)))}catch(e){U.error(e)}}function*A(e={}){const{payload:t}=e;Object(b.a)().resetUserAndDeviceId(),s.a.expire("optimizelyEndUserId",{domain:".weather.com"}),yield Object(a.c)(M,{payload:t})}function*M({payload:e}){const{delayRefreshPage:t=!1}=e||{},n=yield Object(a.c)(C,e);U.debug({urlConfigParams:n},"******** Authentication Saga - refreshPageSaga");const r=yield Object(a.c)(g.a,n),c=yield Object(a.c)(o.a.format,r);U.debug({...r,goToPage:c},"******** Authentication Saga - redirecting"),"number"==typeof t&&(yield Object(a.d)(t));const{location:{pathname:s}={}}=window;s===c?window.location.reload():window.location.href=c}function*C(e){const t=yield Object(a.i)(j.a);let n=null==e?void 0:e.pathname;t&&!n&&(n="/login");const r={pathname:n,search:null==e?void 0:e.search};return U.debug({authenticationRequired:t,configs:e,pageConfigParams:r},"******** Authentication Saga - getPageUrlConfigParams"),r}function*T(){s.a.expire("optimizelyEndUserId",{domain:".weather.com"});Object(b.a)().resetUserAndDeviceId(),yield Object(a.c)(h.i,y.c,!0)}function*x(){yield Object(a.g)(Object(v.a)("")),yield Object(a.c)([s.a,s.a.expire],"twcSubsTier")}function*L(){const e=yield Object(a.i)(m.c),t=yield Object(a.i)(m.f);if(U.debug({userIsLoggedIn:e},"checkLoggedInStatus"),e){if(!t){const{userId:e,status:t}=yield Object(a.c)(D);401===t?(yield Object(a.c)(h.i,y.l,window.location.href),yield Object(a.g)(Object(v.c)({pathname:"/login"}))):e&&(yield Object(a.g)(Object(v.a)(e)))}}else if(t){yield Object(a.c)(x);const e=Object(b.a)();e.getUserId()&&e.resetUserAndDeviceId()}}function*D(){var e;const t={host:p,protocol:f,pathname:"/user/id"},n=yield Object(a.c)(i.a,t,{credentials:"include"});return{status:null==n?void 0:n.status,userId:(null==n||null===(e=n.data)||void 0===e?void 0:e.userID)||""}}function*N(){yield Object(a.c)(w.a,[{name:"getUps2UserIdEmailUrlConfig",params:{}}])}},749:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(94);const o=(e,t,n,o)=>{const a=n?n+"_":"",c=e+"_"+t;return r.env[""+a+c+"_CLIENT"]||r.env[c+"_CLIENT"]||o}},759:function(e,t,n){n(42);var r=n(34),o=n(328),a=n(225),c=n(175),s=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=o;e.exports=function(e){if("number"==typeof e)return e;if(c(e))return NaN;if(a(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=a(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=d.test(e);return n||l.test(e)?u(r(e).call(e,2),n?2:8):i.test(e)?NaN:+e}},770:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return p}));n(42);var r=n(10),o=n.n(r),a=n(8),c=n.n(a),s=n(38),i=n.n(s),d=n(18);const l=Object(d.createLogger)("script-loader"),u=(e,t={})=>new i.a(n=>{var r;const a=document.createElement("script");a.type="text/javascript",a.src=e,c()(r=o()(t)).call(r,e=>{a[e]=t[e]}),a.onerror=()=>{t.onerror&&(l.debug(t.onerror,"Calling onerror attribute for script "+e),t.onerror()),l.error("Error occurred loading script "+e),n()},a.onload=()=>{var r;(r=a).readyState&&"loaded"!==r.readyState&&"complete"!==r.readyState||(t.onload&&(l.debug(t.onload,"Calling onload attribute for script "+e),t.onload()),l.debug("Successfully loaded script "+e),n())},a.readyState&&(a.onreadystatechange=()=>{"loaded"!==a.readyState&&"complete"!==a.readyState||(t.onreadystatechange&&(l.debug(t.onreadystatechange,"Calling onreadystatechange attribute for script "+e),t.onreadystatechange()),n())}),l.debug("Loading script "+e),document.getElementsByTagName("head")[0].appendChild(a)}),p=(e,t)=>new i.a(n=>{const r="jsonp_callback_"+Math.round(1e5*Math.random()),o=document.createElement("script"),a=e.replace(/=\?/,"="+r);window[r]=e=>{window[r]=null,l.debug("Successful callback for "+a),n(e)},o.async=t,o.src=a,o.onerror=()=>{l.error("Error occurred loading script "+a),n()},l.debug("Loading script "+a),document.getElementsByTagName("head")[0].appendChild(o)})}}]);
//# sourceMappingURL=12.vendors~loginRedirect~userAuthenticationSaga.512deb7e6f447b84ac39.js.map