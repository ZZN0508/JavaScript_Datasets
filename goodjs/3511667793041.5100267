YUI.add("af-applet-mgr",function(r,l){"use strict";var c=r.Af.AppletDom,m=r.Af.Beacon,s=r.Af.Transport,f=r.Af.Utils,u=r.Lang.isFunction;function e(){}function t(){}function o(){}function a(){}e.prototype={name:"applet.add",execute:function(e,t,o){if("applet.add"!==t.action)return o();this.addApplet(e,t.params.type,t.params.config,t.params.settings,t.params.location,t.callback),o()},addApplet:function(p,e,t,o,n,i){i=i||f.noop,e?((n=n||{}).container=n.container||c.getContainerGuid(r.one(c.selectors().container)),n.index=n.index||0,s.create("applet",{type:e},{config:t,settings:o,location:n},function(e,t){var o,a;!e&&f.objectGetValue(t,"content.chrome.html")?(o=c.getContainerNode(n.container),t=t.content.chrome,a=r.Node.create(t.html),(o=c.getContainerContentNode(o)).insert(a,n.index),t.assets&&r.Af.Dom.jsAttach(t.assets),p.execControllers({action:"applet.init",params:{node:a,replace:!1}}),r.use("stencil",function(e){e.Stencil.initAll(a)}),t=c.getGuid(a),p.fire("appletadd",{applet:{guid:t,type:c.getType(a)}}),i(null,null)):i(e||"no content")})):i("missing type")}},t.prototype={name:"applet.move",execute:function(e,t,o){"applet.move"===t.action&&this.moveApplet(e,t.params.guid,t.params.from,t.params.to,t.params,t.callback),o()},moveApplet:function(t,o,a,p,e,n){u(e)&&(n=e,e={}),n=n||f.noop;var i=!0===(e&&e.moveBeforePersist),r=!1!==(e&&e.save),l=this;if((a=a||c.getLocation(o))&&p){if(e=c.getType(o),!r)return l._updateDom(t,o,a,p),void n();i&&l._updateDom(t,o,a,p),s.update("applet.layout",{guid:o,type:e},{from:a,to:p},function(e){e?n(e):(i||l._updateDom(t,o,a,p),n())})}else n("invalid from/to location")},_updateDom:function(e,t,o,a){var p=e.applets[t];if(c.getContainerNode(a.container))c.move(t,o,a);else if(c.remove(t),p){try{p.destroy({remove:!0})}catch(e){m.error(l+":destroy",{applet:p.get("type")},e)}delete e.applets[t]}e.fire("appletmove",{applet:{guid:t,type:p?p.get("type"):null,from:o,to:a}})}},o.prototype={name:"applet.remote",execute:function(t,e,o){var a=r.Af.Content;"applet.remote"===e.action?a.remoteApplet(t,e.params,e.callback):"page.init"===e.action&&t.after("*:remoteapplet",function(e){e=e.remoteapplet;a.remoteApplet(t,e,e&&e.callback)}),o()}},a.prototype={name:"applet.remove",execute:function(t,e,o){"applet.remove"===e.action||"removeapplet"===e.action?this.removeApplet(t,e.params.guid,e.params,e.callback):"page.init"===e.action&&t.after("*:removeapplet",function(e){this.removeApplet(t,e.removeapplet.guid||e.applet.guid,e.removeapplet)},this),o()},removeApplet:function(t,o,e,a){if(u(e)&&(a=e,e={}),a=a||f.noop,o){var p=c.getType(o)||null,n=!0===(e&&e.removeBeforePersist);if(!1===(e&&e.save))return i(),void a();n&&i(),s.update("applet.layout",{guid:o,type:p},{from:c.getLocation(o),to:null},function(e){e?a(e):(n||i(),a())})}else a("missing guid");function i(){c.remove(o,function(){t.fire("appletremove",{applet:{guid:o,type:p}})});var e=t.applets[o];if(e){try{e.destroy({remove:!0})}catch(e){m.error(l+":destroy",{applet:p},e)}delete t.applets[o]}}}},r.namespace("Af").AppletAdd=e,r.Af.AppletMove=t,r.Af.AppletRemote=o,r.Af.AppletRemove=a},"@VERSION@",{requires:["af-applet-dom","af-beacon","af-content","af-transport","af-utils"]});
