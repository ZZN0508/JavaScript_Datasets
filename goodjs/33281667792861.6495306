!function(h,r){var l="BBTAD-",c=!0,s=!1,y="",p=[],f=[],C="",g={BBAD:{url:"//g.kexin001.com/qa.do",callback:"window.__BBT_adr",callback_random:"window.__BBT_adr_rd"}};function e(){}function u(e,t,a){for(var r,n=JSON.parse(e.templateContent).content,i="ADID"+e.adId,o=e.materials,d=0;d<o.length;d++)var l=o[d],n="URL"==l.materialType&&0<n.indexOf("_bbtngo_")?l.materialExt?n.replace("{"+d+"}","'', '"+l.material+"','"+i+"','"+l.materialExt+"'"):n.replace("{"+d+"}","'','"+l.material+"','"+i+"'"):n.replace("{"+d+"}",l.material);return c&&(r="",r=s?'<span style="position: absolute;z-index: 998;right: 5px; line-height: 18px; border-radius: 5px;padding: 0 3px;color:#ffffff; font-size: 6px;background-color: rgba(0,0,0,0.05);">广告</span>':'<span style="position: absolute;z-index: 998;left: 8px;border-radius: 5px;padding: 0 3px;bottom: 6px;color:#ffffff; font-size: 6px;background-color: rgba(0,0,0,0.2);">广告</span>',_(a)&&(_(a).style.position="relative"),n+=r),h.BBTAD_CLICKTRACK_URL={},h.BBTAD_CLICKTRACK_URL[i]=[e.babytreeClickUrls,e.clickUrl3rd],n}function b(e){var t=r.createElement("script"),a=r.getElementsByTagName("script")[0];t.charset="utf-8",t.type="text/javascript",t.async=!0,t.src=e,a.parentNode.insertBefore(t,a)}function a(e,t){try{var a=h.location.href,r=new RegExp("assignAdId=([^&]*)","i");if(a.match(r)){var n=JSON.parse(a.match(r)[1]||"[]");if(0<n.length&&n.indexOf(e.rgid)<0)return}var i=new Date,i=parseInt(i.getTime()/3600*1e3),o=g[e.srv],d=e.AppABVersion?",'AppABVersion':'"+e.AppABVersion+"'":"",l=e.district?",'district':'"+e.district+"'":"";e.noDataCallBackFunc&&p.push({rgid:e.rgid,callFunc:e.noDataCallBackFunc}),b(encodeURI(o.url+"?regionId="+e.rgid+"&data="+function(e,t){var a=0,r="",n="",i="",o="",d=!(64<(h.$$DEVICE_UNIQUE_ID||"").length)&&h.$$DEVICE_UNIQUE_ID||"",l="",c="",s="",p="",f="",g="",u="",b="";try{var B=h.location.search;if(B&&1<B.length)for(var m=B.substring(1,B.length).split("&"),_=0;_<m.length;_++)A(m[_],"random-regionId")?C=A(m[_],"random-regionId"):A(m[_],"client-baby-status")?a=A(m[_],"client-baby-status"):A(m[_],"bpreg-brithday")?r=A(m[_],"bpreg-brithday"):A(m[_],"content_id")?n=A(m[_],"content_id"):A(m[_],"babytree-app-id")?i=A(m[_],"babytree-app-id"):A(m[_],"babytree-app-version")?o=A(m[_],"babytree-app-version"):A(m[_],"babytree-app-latitude")?l=A(m[_],"babytree-app-latitude"):A(m[_],"babytree-app-longitude")?c=A(m[_],"babytree-app-longitude"):A(m[_],"babytree-client-type")?p="android"===A(m[_],"babytree-client-type")?"1":"2":A(m[_],"babytree-app-imei")?f=A(m[_],"babytree-app-imei"):A(m[_],"idfa")?g=A(m[_],"idfa"):A(m[_],"android-id")?u=A(m[_],"android-id"):A(m[_],"enc-user-id")&&(b=A(m[_],"enc-user-id"))}catch(e){}l&&c&&(s=l+"x"+c);return y="&os="+p+"&imei="+f+"&idfa="+g,"{'exactId':'"+a+"', 'babyBirthday':'"+r+"', 'appName':'"+i+"', 'appVersion':'"+o+"', 'deviceLbs':'"+s+"', 'os':'"+p+"', 'imei':'"+f+"', 'idfa':'"+g+"', 'androidId':'"+u+"', 'userId':'"+b+"' "+t+"}&ext_params={'content_id':'"+n+"', 'token':'"+d+"' "+e+"}"}(d,l)+"&st="+e.srv+"&callback="+(t?o.callback_random:o.callback)+"&ts="+i))}catch(e){}}function A(e,t){return-1<e.indexOf(t+"=")&&e.substring(t.length+1,e.length)}function B(e,t){var a=e.impressionUrl||"",r=e.viewUrl||"",n=(new Date).getTime();a&&b(a+="&adEvent=1&localTs="+n+"&r="+t+y),r&&b(r+="&adEvent=3&localTs="+n+"&r="+t+y),i(e.impressionUrl3rd),i(e.viewUrl3rd)}function i(e){try{if(e)for(var t=0;t<e.length;t++)0<e[t].length&&b(e[t])}catch(e){}}function n(e){if(h.localStorage){var t=h.localStorage;if(e){for(var a="",r=0;r<e.length&&0<e[r].length;r++)a=a+"||"+e[r];var n=t.getItem("BBTAD_CLICKTRACK_URLS");t.setItem("BBTAD_CLICKTRACK_URLS",a=n?n+"||"+a:a)}}else i(e)}function m(){var e="";try{e=h.ifReferer||h._doc.location.href}catch(e){}return e}function _(e){return r.getElementById(e)}e.prototype={constructor:e,queryMultiAds:function(e){for(var t=0;t<e.length;t++)a(e[t],!1)},querySingleAd:function(e){a(e,!1)},queryRandomAd:function(e){f.push({adId:e.rgid}),a(e,!0)}},h._bbtngo_=function(e,t,a,r){r?b(r+=y):t+=y;try{a&&h.BBTAD_CLICKTRACK_URL&&h.BBTAD_CLICKTRACK_URL[a]&&(h.BBTAD_CLICKTRACK_URL[a][0]&&n(h.BBTAD_CLICKTRACK_URL[a][0]),h.BBTAD_CLICKTRACK_URL[a][1]&&n(h.BBTAD_CLICKTRACK_URL[a][1]))}catch(e){}h.adAction?h.adAction(e,t):window.Bridge&&window.Bridge.postMessage?window.Bridge.postMessage({method:"adAction",params:[e,t]}):h.location.href=t},h.__BBT_adr=function(e){if(e&&e.status&&200==e.status&&e.data&&e.data.length&&0<e.data.length){var t=e.data[0];c=1===(t.isCommercial||0),s=0<=t.templateFlag.indexOf("WZMB")||0<=t.templateFlag.indexOf("WZLMB");var a=encodeURIComponent(m()),r=l+"BBAD-"+t.groupId,n=u(t,0,r);n&&1<n.length&&_(r)&&(_(r).innerHTML=n,B(t,a))}else try{var i=parseInt(e.message);if(0<i)for(var o=0;o<p.length;o++)if(p[o].rgid==i&&p[o].callFunc){p[o].callFunc(i);break}}catch(e){}},h.__BBT_adr_rd=function(e){if(e&&e.status&&200==e.status&&e.data&&e.data.length&&0<e.data.length){for(var t=e.data.length-1,a=e.data.map(function(e){return e.groupId}),r="",n=0;n<f.length;n++){var i=f[n].adId||[];if(a.every(function(e){return 0<=i.indexOf(e)})){r=i.join("-");break}}var o=Math.floor(Math.random()*(1+t)+0),d=(d=C?e.data.find(function(e){return e.groupId==C}):d)||e.data[o];c=1===(d.isCommercial||0),s=0<=d.templateFlag.indexOf("WZMB")||0<=d.templateFlag.indexOf("WZLMB");t=encodeURIComponent(m()),e=l+"BBAD-"+r,o=u(d,0,e);o&&1<o.length&&_(e)&&(_(e).innerHTML=o,B(d,t))}},h.QueryBabyTreeAds=e}(window,document);
