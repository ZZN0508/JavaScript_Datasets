define(["newsletter/1/authmodule"],function(r){return{authmodule:r,id:void 0,views:3,active:!0,cookieName:"nls2",viewsCap:9,totalPV:0,init:function(e,t){var i=this;if(e&&e.id&&e.nl)if(this.debug("settings are as follows"),webmd.debug(e),$.extend(this,e),!0===this.newsletterOndemand)this.display(this.timerOverride);else{if(webmd.url.getParam("ecd")&&-1<webmd.url.getParam("ecd").indexOf("wnl")){var o=r.generate({ishashRequest:!0}),n="",s="";window.webmd&&window.webmd.url&&(window.webmd.url.getSLD()&&(s=window.webmd.url.getSLD()),window.webmd.url.getParam("mb")&&(n=window.webmd.url.getParam("mb")));var d=new $.Deferred;return""!==n&&$.ajax("https://www.webmd.com/api/svcgateway/v2/reg/regservice.asmx/GetHashEmail",{type:"post",headers:o,data:{EncryptedGuid:n},success:function(e){webmd.cookie.set("REG_UUID",e.Email,{expires:36500,domain:s})},error:function(e,t,i){d.reject(e,t,i)}}),void this.debug("suppressed the newsletter for pages with ecd-wnl url")}(this.cookieGet(),this.active||this.isTestMode())?(t||(i.totalPV!==i.views&&i.increment(),$(document).on("after_pv",function(){i.totalPV!==i.views&&(i.increment(),i.init(e,!0))})),this.isPageExcluded()?this.debug("excluded on this page"):this.shouldDisplay()?(this.debug("should display"),webmd.p.pim.increment(),this.deactivate(),this.display()):(this.debug("should not display"),this.cookieSet())):this.debug("inactive")}else this.debug("missing settings")},isTestMode:function(){return webmd.url.getParam("testnewsletterhover")},isPageExcluded:function(){var e=!1;return webmd.sitefrontsConfig&&webmd.sitefrontsConfig.nav?"TOC - Channel"===window.s_business_reference&&(this.debug("NL hover on Sitefronts TOC channel is suppressed as per requirement"),e=!0):e=!0,e=window.enableAutoNL?!1:e},checkSensitive:function(){var t=!1;return window.s_sensitive&&-1===window.s_business_reference.toLowerCase().indexOf("news")&&(0===window.s_topic.search(/^7\d*/)&&"7019"!==window.s_topic?t=!0:window.secTopId&&""!==window.secTopId&&window.secTopId.split(",").forEach(function(e){t||0!==e.search(/^7\d*/)||"7019"===e||(t=!0)})),t},cookieGet:function(){var e;return webmd.cookie.exists(this.cookieName)?(this.debug("cookie value = "+webmd.cookie.get(this.cookieName)),e=webmd.cookie.getJson(this.cookieName),this.active=Boolean(void 0===e.a),void(this.totalPV=e.i||0)):void this.debug("cookie was not found.")},cookieSet:function(){var e,t={};this.active?t.i=this.totalPV:(t.a=0,e=7),webmd.cookie.setJson(this.cookieName,t,{domain:webmd.url.getSLD(),expires:e})},increment:function(){var e=this.cap(this.totalPV+1);this.totalPV=e,this.cookieSet(),this.debug("target views = "+this.views)},shouldDisplay:function(){return this.isTestMode()||this.totalPV===this.views},getOptions:function(e){var t={reqModule:"newsletter/1/moduleUI-daily",containerId:"newsletterHover",mode:"daily-hover",reqCss:"css!newsletter/1/newsletter-signup-daily.css",width:"650px",responsive:!1,overlayWrapper:"newsletter-hover"},i={reqModule:"newsletter/1/moduleUI-daily-mobile",containerId:"newsletterHover",mode:"daily-mobile",reqCss:"css!newsletter/1/newsletter-signup-daily.css",width:"650px",responsive:!1,overlayWrapper:"newsletter-hover"},o=webmd.useragent.ua.type&&"mobile"===webmd.useragent.ua.type;switch(t.divContainer='<div id="'+t.containerId+'" class="newsletter-daily hover"></div>',i.divContainer='<div id="newsletterHoverContainer"><div id="'+i.containerId+'" class="newsletter-daily"></div></div>',e){case 1162:case 1096:case 1091:return{reqModule:"newsletter/1/moduleUI-pregnancy",containerId:"pregnancyHover",divContainer:'<div id="pregnancyHover" class="nls-preg hover"></div>',mode:"pregnancy",reqCss:"css!newsletter/1/newsletter-pregnancy.css",width:o?void 0:1012,responsive:!0,overlayWrapper:"nls-preg-hover"};default:return o?i:t}},display:function(e){var o=this,n=webmd.useragent.ua.type&&"mobile"===webmd.useragent.ua.type,t=o.getOptions(o.id).containerId,i=o.getOptions(o.id).reqModule,s=o.getOptions(o.id).divContainer,d=o.getOptions(o.id).mode,r=o.getOptions(o.id).reqCss,a=o.getOptions(o.id).responsive,l=o.getOptions(o.id).overlayWrapper,w=!0===webmd.hoverTest?webmd.hoverNlArray:o.nl[0];e=void 0!==e?e:n?5e3:3e3,o.config=$.extend({},o.config,{nl:w,header:o.header,subhead:o.subhead,selector:"#"+t,uiMode:d,adServed:o.adServed,newsletterOndemand:o.newsletterOndemand}),setTimeout(function(){require([i,r],function(e){var t=new e,i=navigator.userAgent.match(/(iPhone|iPod touch);/i);return 0<$("#decision_select").length?(webmd.debug("NLHover module suppressed due to Decision Select"),webmd.cookie.deleteCookie("nls2",{domain:"webmd.com",path:"/"}),webmd.cookie.deleteCookie("ads_sess",{domain:"webmd.com",path:"/"}),void webmd.debug("NLHover cookie reset | PIM counter reset")):void(!a&&n?($("#newsletterHoverContainer").length<1&&$("body").append(s),t.init(o.config),setTimeout(function(){t.show(),wmdPageLink("nl-hov_imp");var e=$(".nls-email");$("#newsletterHoverContainer"),i&&(e.on("mousedown focus",function(){$("body").css({overflow:"hidden",position:"fixed"})}),e.on("blur",function(){setTimeout(function(){$("body").css({overflow:"auto",position:"static"})},1e3)}))},0)):webmd.overlay.open({width:window.nlOverlayWidth||o.getOptions(o.id).width,html:s,scrolling:!1,transition:"none",onComplete:function(){t.init(o.config),wmdPageLink("nl-hov_imp"),$("#webmdHoverWrapper").addClass(l),$("#webmdHoverOverlay").addClass(l),"570px"!==$("#webmdHoverLoadedContent").css("width")&&$("#webmdHoverLoadedContent").css({width:"570px"}),webmd.overlay.resize(),webmd.overlay.autoClosed=!1},onClosed:function(){clearTimeout(window.nlsOverlayTimeout),webmd.overlay.autoClosed||wmdPageLink("nl-hov_x")}}))})},e)},deactivate:function(){this.active=!1,this.cookieSet()},cap:function(e){return e=e>this.viewsCap?this.viewsCap:e},debug:function(e){webmd.debug("Newsletter hover: "+e)}}});
