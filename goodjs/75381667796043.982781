var IndexAction={init:function(){var e=[this.initHeadSlider,this.initDiscountBox];isModuleActive("DK_Recommendation")&&e.push(this.initDKRecommendations),isModuleActive("ml_main_page_ab_test")&&e.push(this.initMyLandingMainPageTestSwiper),isModuleActive("data_layer_carousels")&&e.push(this.setGACarouselsImpressionEvent),isModuleActive("dk_ask_to_login_tooltip")&&this.initAskUserToLoginBox(),isModuleActive("dk_banner_view_impression_event")&&e.push(this.setBannerViewImpressionEvent),Services.callListInTryCatch(e,this)},initDKRecommendations:function(){var a=$("#product-template").clone()[0].innerHTML,o=this;Services.ajaxGETRequestJSON("/recommendation/v1/",{},function(e){$.map(e,function(e){var i,t,s,n="";if("personal"===e.id)try{i=$(".js-promo-single-box"),$.map(e.products,function(e){e.image&&(n+=o.createTemplate(a,{id:e.id,image:e.image,title:40<e.title.length?e.title.substr(0,40)+"...":e.title,url:e.url,discount:Services.convertToFaDigit(e.price.discount_percent),isFMCG:e.fast_shopping_badge?"":"u-hidden",hasDiscount:0<e.price.discount_percent?"":"u-hidden",price:Services.convertToFaDigit(Services.formatCurrency(e.price.selling_price,!0,"")),oldValue:Services.convertToFaDigit(Services.formatCurrency(e.price.rrp_price,!0,""))})),i.find(".js-promo-single-wrapper").html(n),$.map(i.find(".js-template-img"),function(e){$(e).attr("src",$(e).data("img"))})}),o.initSinglePromoBoxSwiperWithObservers()}catch(e){console.log(11,e)}else 0<(i=$("#recommendation-"+e.id)).length&&(i.find(".o-headline").find("span").html(e.title),$.map(e.products,function(e){e.image&&(n+=o.createTemplate(a,{id:e.id,image:e.image,title:e.title,url:e.url,discount:Services.convertToFaDigit(e.price.discount_percent),isFMCG:e.fast_shopping_badge?"":"u-hidden",hasDiscount:0<e.price.discount_percent?"":"u-hidden",price:Services.convertToFaDigit(Services.formatCurrency(e.price.selling_price,!0,"")),oldValue:Services.convertToFaDigit(Services.formatCurrency(e.price.rrp_price,!0,""))}))}),i.find(".js-products-container").html(n),$.map(i.find(".js-template-img"),function(e){$(e).attr("src",$(e).data("img"))}),i.removeClass("u-hidden"),new window.Swiper(i.find(".swiper-container"),{slidesPerView:6,slidesPerGroup:5,lazy:{enabled:!0},navigation:{nextEl:".js-swiper-button-next",prevEl:".js-swiper-button-prev"},keyboard:{enabled:!0,onlyInViewport:!0},breakpoints:{1367:{slidesPerView:4,slidesPerGroup:3,spaceBetweenSlides:1},1679:{slidesPerView:5,slidesPerGroup:4,spaceBetweenSlides:1}}}));try{e.data_layer&&(t="personal"===e.id?"instant-offer":"recommendation-"+e.id,s=IndexAction.replaceGaImpressionDimension19(e.data_layer,t),window.Main.setImpressionEventOnAjax(s));var r={id:"recommendation-"+e.id,carouselPosition:"sn-"+e.id,title:e.title,title_en:"SN "+e.id,products:e.products_tracker,recomm:!0,page:window.dataGTM};window.carouselData.push(r)}catch(e){}})},function(e){},!1,!1)},replaceGaImpressionDimension19:function(e,i){return e.replace(/"dimension19":"carousel-recommendation"/g,'"dimension19":"'+i+'"')},initDiscountBox:function(){var s,e,n,i,t,r=$(".js-discount-item"),a=$(".js-discount-container"),o=null;$(".js-counter-incredible").each(function(){var e,i=$(this),t=$(this).data("countdownseconds");i.attr("data-countdownseconds")&&t?(e=new Date).setSeconds(e.getSeconds()+t):e=(""+$(this).data("countdown")).replace(/-/g,"/"),e&&i.countdown({hoursOnly:!0,rtlTemplate:"<span>%h</span>:<span>%i</span>:<span>%s</span>",template:"<span>%h</span>:<span>%i</span>:<span>%s</span>",leadingZero:!0,date:e,onComplete:function(){var e=i.closest(".js-discount-product");e.hasClass("c-discount__product--invisible")||e.addClass("c-discount__product--finished-incredible")}})}),r.length<=1||(a.off(),r.off(),a.hover(function(){o.pause()},function(){o.resume()}),s=function(e,i){if(r.removeClass("is-active"),e.addClass("is-active"),setTimeout(function(){a.removeClass("is-active"),a.filter('[data-id="'+i+'"]').addClass("is-active").animateCss("fadeIn"),dispatchEvent(new Event("scroll"))},100),t)try{t.slideTo(i-3)}catch(e){}},e=function(e,i){if(!e||"function"!=typeof e)throw TypeError("Callback should be a Function");if(!i||"number"!=typeof i)throw TypeError("Delay should be a Number");return this.callback=e,this.delay=i,this.startDate=new Date,this.remaining=this.delay,this.currentInterval=null,this.currentTimeout=null,this.resume=function(){return this.clear(),this.currentTimeout=setTimeout(function(){this.startDate=new Date,this.callback(),this.remaining=this.delay,this.currentInterval=setInterval(function(){this.startDate=new Date,this.callback()}.bind(this),this.delay)}.bind(this),this.remaining),this.startDate=new Date,this},this.pause=function(){return this.clear(),this.remaining=(0<this.remaining?this.remaining:this.delay)-(new Date-this.startDate),this.remaining=0<this.remaining&&this.remaining<=this.delay?this.remaining:this.delay,this},this.clear=function(){return this.currentInterval&&clearInterval(this.currentInterval),this.currentTimeout&&clearTimeout(this.currentTimeout),this},this.callCallback=function(){return this.clear(),this.callback(),this.resume()},this.reset=function(){return this.remaining=this.delay,this},this.resume()},(n=function(){o&&o.clear(),o=new e(function(){var e=r.filter(".is-active"),i=Number(e.attr("data-id"))+1;i>r.length&&(i=1);e=r.filter('[data-id="'+i+'"]');s(e,i)},7e3)})(),r.on("click",function(e){var i=$(this),t=i.attr("data-id");o.clear(),s(i,t),n(),e.preventDefault()}),(i=new UserClass).isLogged()||$(".btn-light--sign-up").click(function(){i.showLoginForm()}),enquire.register("screen and (max-width:1365px)",{match:function(){t=new Swiper(".js-discount-slider",{slidesPerView:"auto",slidesPerGroup:1,slideClass:"c-discount__aside-li",slideActiveClass:"c-discount__aside-ul--active",wrapperClass:"c-discount__aside-ul"}),$(".js-discount-slider-next").on("click",function(){o&&o.callCallback()}),$(".js-discount-slider-prev").on("click",function(){var e=r.filter(".is-active"),i=Number(e.attr("data-id"))-1;i>r.length?i=1:i<=0&&(i=r.length);e=r.filter('[data-id="'+i+'"]');s(e,i)})},unmatch:function(){t&&t.destroy()}}))},seedSinglePromoBoxSwiper:function(e){var t="";$.each(e,$.proxy(function(e,i){t+=this.createTemplate('<a class="swiper-slide {extraClass}" href="/product/dkp-{id}/" title="{title}" data-id="{id}" data-carousel="emarsys-promo-single"><span class="c-promo-single__img"> <img data-src-swiper="{image}" class="swiper-lazy"/>{badge}</span><span class="c-promo-single__desc"><span class="c-promo-single__title">{title}</span><span class="c-promo-single__prince-container"><del class="c-promo-single__discount">{discount}</del><span class="c-promo-single__price">{price} تومان</span></span></span></a>',{title:i.title.slice(0,50)+(50<i.title.length?"...":""),image:i.image.replace("/120/","/220/"),price:Emarsys.convertToFaDigit(Emarsys.formatCurrency(String(i.price),!1,"")),id:i.id,discount:0<i.msrp&&i.msrp!=i.price?Emarsys.convertToFaDigit(Emarsys.formatCurrency(String(i.msrp),!1,"")):"",extraClass:i.c_has_quick_view?"js-fast-shopping has-more":"",badge:i.c_fast_shopping_badge?'<img class="c-product-box__fmcg-symbol" src="/fresh-badge.svg">':""})},this)),$(".js-promo-single-loader").fadeOut(500,$.proxy(function(){$(".js-promo-single-wrapper").html(t),this.initSinglePromoBoxSwiper()},this))},createTemplate:function(e,i){for(var t in i)e=e.replace(new RegExp("{"+t+"}","g"),i[t]);return e},initSinglePromoBoxSwiperWithObservers(){window.swipers=[],$(".js-promo-single").each(function(e){var i=$(this),t=i.find(".js-promo-single-bar"),i=i.find(".js-promo-single-box");function s(){swipers[e].pauseTime=(new Date).getTime(),swipers[e].autoplay.stop(),t.removeClass("is-active"),swipers[e].autoplay.stop()}function n(){swipers[e].autoplay.start(),swipers[e].pauseTime=0,t.addClass("is-active")}swipers[e]=new Swiper(i.get(0),{slidesPerView:1,speed:500,allowTouchMove:!1,autoplay:{delay:7e3},lazy:!0,loop:!0,on:{slideChangeTransitionEnd:function(){t.addClass("is-active")},slideChange:function(){t.removeClass("is-active")},resize:function(){setTimeout($.proxy(function(){this.detachEvents(),this.attachEvents(),this.update(),this.autoplay.run()},this),500)}}});i=$(".js-promo-single-box");i.on("mouseenter",function(e){s()}),i.on("mouseleave",function(e){n()}),IntersectionObserver&&new IntersectionObserver(function(e){"use strict";e.map(function(e){(e.isIntersecting?n:s)()})}).observe(this)})},initSinglePromoBoxSwiper:function(){window.swipers=[],$(".js-promo-single").each(function(i){var e=$(this),t=e.find(".js-promo-single-bar"),e=e.find(".js-promo-single-box");swipers[i]=new Swiper(e.get(0),{slidesPerView:1,speed:500,allowTouchMove:!1,autoplay:{delay:7e3},lazy:!0,loop:!0,on:{init:function(){t.addClass("is-active")},slideChangeTransitionEnd:function(){t.addClass("is-active")},slideChange:function(){t.removeClass("is-active")},resize:function(){setTimeout($.proxy(function(){this.detachEvents(),this.attachEvents(),this.update(),this.autoplay.run()},this),500)}}});e=$(".js-promo-single-box");e.on("mouseenter",function(e){swipers[i].pauseTime=(new Date).getTime(),swipers[i].autoplay.stop(),t.addClass("is-paused"),console.log(swipers[i].autoplay.stop())}),e.on("mouseleave",function(e){swipers[i].autoplay.start(),swipers[i].pauseTime=0,t.removeClass("is-paused")})})},initMyLandingMainPageTestSwiper:function(){new window.Swiper(".js-my-landing-fmcg",{slidesPerView:5,slidesPerGroup:4,spaceBetween:15,lazy:{enabled:!0},navigation:{nextEl:".js-fmcg-swiper-button-next",prevEl:".js-fmcg-swiper-button-prev"},keyboard:{enabled:!0,onlyInViewport:!0},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{1125:{slidesPerView:4,slidesPerGroup:3,spaceBetween:15},1300:{slidesPerView:5,slidesPerGroup:4,spaceBetween:15}}}),new window.Swiper(".js-my-landing-wish-list",{slidesPerView:5,slidesPerGroup:4,spaceBetween:15,lazy:{enabled:!0},navigation:{nextEl:".js-wish-swiper-button-next",prevEl:".js-wish-swiper-button-prev"},keyboard:{enabled:!0,onlyInViewport:!0},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{1125:{slidesPerView:4,slidesPerGroup:3,spaceBetween:15},1300:{slidesPerView:5,slidesPerGroup:4,spaceBetween:15}}}),new window.Swiper(".js-my-landing-last-buy",{slidesPerView:4,slidesPerGroup:3,lazy:{enabled:!0},navigation:{nextEl:".js-swiper-button-next",prevEl:".js-swiper-button-prev"},keyboard:{enabled:!0,onlyInViewport:!0}}),new window.Swiper(".js-my-landing-category-carousel",{slidesPerView:4,slidesPerGroup:3,lazy:{enabled:!0},navigation:{nextEl:".js-swiper-button-next",prevEl:".js-swiper-button-prev"},keyboard:{enabled:!0,onlyInViewport:!0},breakpoints:{1125:{slidesPerView:3,slidesPerGroup:2},1367:{slidesPerView:4,slidesPerGroup:3}}})},initHeadSlider:function(){var s=$(window),e=$(".js-main-page-slider"),n=e.offset().top,r=e.height(),a=n+r,o=[];this.slidersImpressionsData=[],new Swiper(".js-main-page-slider",{autoplay:{delay:5e3},effect:"fade",cubeEffect:{slideShadows:!1},pagination:{el:".swiper-pagination",clickable:!0,type:"bullets"},loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},on:{slideChange:function(){var e=s.scrollTop(),i=$(this.slides[this.activeIndex]),t=i.data("id");Services.isScrolledIntoView(i)&&isModuleActive("dk_banner_view_impression_event")&&$(document).ready(function(){if(!i.data("observed"))try{var e=Services.retrieveProductFromDataLayer({productId:t,eventName:"eec.promoView",pathArray:["ecommerce","promoView","promotions"]});e&&(i.data("observed",1),ga("ec:addPromo",e))}catch(e){console.log("Load Error: Slider View Impression")}}),t&&o.indexOf(t)<0&&(e<=n&&n<=e+r||e<=a&&a<=e+r)&&(snt("dkBannerViewed",{bannerId:t,created_at:Date.now()}),o.push(t))},click:function(){$(this.slides[this.activeIndex]).data("id")}}})},setGAClickImpressionEvent:function(e){try{var i=function(e){e=Object.assign({},e);return delete e.list,e}(Services.retrieveProductFromDataLayer({productId:e,eventName:"eec.productImpression",pathArray:["ecommerce","impressions"]})),t={event:"eec.impressionClick",ecommerce:{click:{actionField:{list:Main.gaListName},products:[i]}}};window.dataLayer.push(t)}catch(e){window.Sentry&&window.Sentry.captureException(e),console.warn(e)}},setGACarouselsImpressionEvent:function(){$(document).on("click",".js-carousel-ga-product-box",function(){var e=$(this).data("id");e&&IndexAction.setGAClickImpressionEvent(e)})},initAskUserToLoginBox:function(){var e=$(".js-ask-to-login-box"),i=$(".js-ask-to-login-recommendation");window.userId?(e.addClass("u-hidden"),i.removeClass("u-hidden")):(e.removeClass("u-hidden"),i.addClass("u-hidden"))},setBannerViewImpressionEvent:function(){$(document).ready(function(){var e=$(".js-ad-placement-column-item");0<e.length&&e.each(function(){try{var e=$(this).data("id"),i=$(this).data("observed");if(!e||i||!Services.isScrolledIntoView(this))return;var t=Services.retrieveProductFromDataLayer({productId:e,eventName:"eec.promoView",pathArray:["ecommerce","promoView","promotions"]});t&&(--s,$(this).data("observed",1),this.setAttribute("data-observed",1),ga("ec:addPromo",t))}catch(e){console.log("GA Error: Home Page Top Left Banners View Impression")}})});var s=$('.js-banner-impression-adro:not([data-id=""])').length;$(window).on("scroll",Services.throttle(function(){0!==s&&$(".js-banner-impression-adro").each(function(){try{var e=$(this).data("id"),i=$(this).data("observed");if(!e||i||!Services.isScrolledIntoView(this))return;var t=Services.retrieveProductFromDataLayer({productId:e,eventName:"eec.promoView",pathArray:["ecommerce","promoView","promotions"]});t&&(--s,$(this).data("observed",1),this.setAttribute("data-observed",1),ga("ec:addPromo",t))}catch(e){console.log("GA Error: Home Page Banner View Impression")}})},500))}};$(function(){IndexAction.init()});
