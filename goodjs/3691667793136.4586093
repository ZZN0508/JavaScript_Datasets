YUI.add("model-list",function(n,t){function e(){e.superclass.constructor.apply(this,arguments)}var i=n.Attribute.prototype,r=n.Lang,o=n.Array,a="error",d="load",h="remove",s="reset";n.ModelList=n.extend(e,n.Base,{model:n.Model,_isYUIModelList:!0,initializer:function(t){var e=this.model=(t=t||{}).model||this.model;"string"==typeof e&&(this.model=n.Object.getValue(n,e.split(".")),this.model||n.error("ModelList: Model class not found: "+e)),this.publish("add",{defaultFn:this._defAddFn}),this.publish(s,{defaultFn:this._defResetFn}),this.publish(h,{defaultFn:this._defRemoveFn}),this.after("*:idChange",this._afterIdChange),this._clear(),t.items&&this.add(t.items,{silent:!0})},destructor:function(){this._clear()},add:function(t,s){var e=t._isYUIModelList;return e||r.isArray(t)?o.map(e?t.toArray():t,function(t,e){var i=s||{};return"index"in i&&(i=n.merge(i,{index:i.index+e})),this._add(t,i)},this):this._add(t,s)},create:function(e,i,s){var r=this;return"function"==typeof i&&(s=i,i={}),i=i||{},e._isYUIModel||(e=new this.model(e)),r.fire("create",n.merge(i,{model:e})),e.save(i,function(t){t||r.add(e,i),s&&s.apply(null,arguments)})},each:function(t,e){for(var i,s=this._items.concat(),r=0,n=s.length;r<n;r++)i=s[r],t.call(e||i,i,r,this);return this},filter:function(t,e){var i,s,r,n=[],o=this._items;for("function"==typeof t&&(e=t,t={}),i=0,r=o.length;i<r;++i)s=o[i],e.call(this,s,i,this)&&n.push(s);return t.asList?(t=new this.constructor({model:this.model}),n.length&&t.add(n,{silent:!0}),t):n},get:function(t){return this.attrAdded(t)?i.get.apply(this,arguments):this.invoke("get",t)},getAsHTML:function(t){return this.attrAdded(t)?n.Escape.html(i.get.apply(this,arguments)):this.invoke("getAsHTML",t)},getAsURL:function(t){return this.attrAdded(t)?encodeURIComponent(i.get.apply(this,arguments)):this.invoke("getAsURL",t)},getByClientId:function(t){return this._clientIdMap[t]||null},getById:function(t){return this._idMap[t]||null},invoke:function(t){var e=[this._items,t].concat(o(arguments,1,!0));return o.invoke.apply(o,e)},load:function(r,n){var o=this;return"function"==typeof r&&(n=r,r={}),r=r||{},this.sync("read",r,function(t,e){var i,s={options:r,response:e};t?(s.error=t,s.src="load",o.fire(a,s)):(o._loadEvent||(o._loadEvent=o.publish(d,{preventable:!1})),i=s.parsed=o._parse(e),o.reset(i,r),o.fire(d,s)),n&&n.apply(null,arguments)}),this},map:function(t,e){return o.map(this._items,t,e)},parse:function(e){if("string"==typeof e)try{return n.JSON.parse(e)||[]}catch(t){return this.fire(a,{error:t,response:e,src:"parse"}),null}return e||[]},remove:function(t,e){var i=t._isYUIModelList;return i||r.isArray(t)?(t=o.map(i?t.toArray():t,function(t){return r.isNumber(t)?this.item(t):t},this),o.map(t,function(t){return this._remove(t,e)},this)):this._remove(t,e)},reset:function(t,e){t=t||[];var i=n.merge({src:"reset"},e=e||{});return t=t._isYUIModelList?t.toArray():o.map(t,function(t){return t._isYUIModel?t:new this.model(t)},this),i.models=t,e.silent?this._defResetFn(i):(this.comparator&&t.sort(n.bind(this._sort,this)),this.fire(s,i)),this},some:function(t,e){for(var i,s=this._items.concat(),r=0,n=s.length;r<n;r++)if(i=s[r],t.call(e||i,i,r,this))return!0;return!1},sort:function(t){if(!this.comparator)return this;var e=this._items.concat();return e.sort(n.rbind(this._sort,this,t=t||{})),e=n.merge(t,{models:e,src:"sort"}),t.silent?this._defResetFn(e):this.fire(s,e),this},sync:function(){var t=o(arguments,0,!0).pop();"function"==typeof t&&t()},toArray:function(){return this._items.concat()},toJSON:function(){return this.map(function(t){return t.toJSON()})},_add:function(t,e){var i;if(e=e||{},i=(t=!t._isYUIModel?new this.model(t):t).get("id"),!(this._clientIdMap[t.get("clientId")]||r.isValue(i)&&this._idMap[i]))return i=n.merge(e,{index:"index"in e?e.index:this._findIndex(t),model:t}),e.silent?this._defAddFn(i):this.fire("add",i),t;this.fire(a,{error:"Model is already in the list.",model:t,src:"add"})},_attachList:function(t){t.lists.push(this),t.addTarget(this)},_clear:function(){o.each(this._items,this._detachList,this),this._clientIdMap={},this._idMap={},this._items=[]},_compare:function(t,e){return t<e?-1:e<t?1:0},_detachList:function(t){var e=o.indexOf(t.lists,this);-1<e&&(t.lists.splice(e,1),t.removeTarget(this))},_findIndex:function(t){var e,i,s,r=this._items,n=r.length,o=0;if(!this.comparator||!n)return n;for(s=this.comparator(t);o<n;)e=r[i=o+n>>1],this._compare(this.comparator(e),s)<0?o=1+i:n=i;return o},_parse:function(t){return this.parse(t)},_remove:function(t,e){var i,s;if(e=e||{},r.isNumber(t)?(i=t,t=this.item(i)):i=this.indexOf(t),-1!==i&&t)return s=n.merge(e,{index:i,model:t}),e.silent?this._defRemoveFn(s):this.fire(h,s),t;this.fire(a,{error:"Model is not in the list.",index:i,model:t,src:"remove"})},_sort:function(t,e,i){e=this._compare(this.comparator(t),this.comparator(e));return 0!==e&&i&&i.descending?-e:e},_afterIdChange:function(t){var e=t.newVal,i=t.prevVal,t=t.target;if(r.isValue(i)){if(this._idMap[i]!==t)return;delete this._idMap[i]}else if(-1===this.indexOf(t))return;r.isValue(e)&&(this._idMap[e]=t)},_defAddFn:function(t){var e=t.model,i=e.get("id");this._clientIdMap[e.get("clientId")]=e,r.isValue(i)&&(this._idMap[i]=e),this._attachList(e),this._items.splice(t.index,0,e)},_defRemoveFn:function(t){var e=t.model,i=e.get("id");this._detachList(e),delete this._clientIdMap[e.get("clientId")],r.isValue(i)&&delete this._idMap[i],this._items.splice(t.index,1)},_defResetFn:function(t){"sort"!==t.src?(this._clear(),t.models.length&&this.add(t.models,{silent:!0})):this._items=t.models.concat()}},{NAME:"modelList"}),n.augment(e,n.ArrayList)},"3.12.0",{requires:["array-extras","array-invoke","arraylist","base-build","escape","json-parse","model"]});
