window.datalayerClientWeb=function(t){var r={};function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=r,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(n,e){if(1&e&&(n=o(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)o.d(t,r,function(e){return n[e]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="",o(o.s=0)}([function(e,n,t){"use strict";t.r(n),t.d(n,"initializeGTM",function(){return d}),t.d(n,"initializeGTMWithIris",function(){return T}),t.d(n,"initializeIris",function(){return E});const a=e=>e instanceof Array,o=e=>"function"==typeof e,s=(n,t,r)=>{if(r&&r.debug){let e=a(t)?t:[t];r&&r.style&&(e=[`%c ${[t].join(" ")}`,r.style]),console[n](...e)}return!0},i=[["domainHash","string"],["uuid","string"],["initialVisit","number"],["beginningPrev","number"],["beginningCurr","number"],["counter","number"]],c=(e,n)=>!(!window||!document||window.pollingDone||(o(n)?(e.map(e=>n([],e)),window.pollingDone=!0):a(n)&&n.forEach(n=>{o(n)&&(e.map(e=>n([],e)),window.pollingDone=!0)}),0)),u=(t,e)=>{const r=window[t]["push"];window[t].push=(...n)=>{try{r(...n)}catch(e){console.log("error: ",e)}"function"==typeof e?(c(window[t],e),e(window[t],...n)):e instanceof Array&&e.forEach(e=>{o(e)&&(c(window[t],e),e(window[t],...n))})}};var d=(e="dataLayer",t,r="GTM-TN8CNF")=>{var o;if(window&&document&&!window.init_iris_new){let n=!1;var i=document.getElementsByTagName("script");for(let e=0;e<i.length;e++)if(null!==(o=null===(o=i[e])||void 0===o?void 0:o.src)&&void 0!==o&&o.includes(`www.googletagmanager.com/gtm.js?id=${r}`)){n=!0;break}try{if(window[e]=window[e]||[],n)u(e,t);else{const a=document.getElementsByTagName("script")[0],o=document.createElement("script"),s="dataLayer"!==e?`&l=${e}`:"";o.async=!0,o.src=`//www.googletagmanager.com/gtm.js?id=${r}${s}`,t&&o.addEventListener("load",()=>{u(e,t),t||window[e].push({"gtm.start":(new Date).getTime(),event:"gtm.js"})}),a.parentNode.insertBefore(o,a)}return window.init_iris_new=!0}catch(e){return s("error","[GTM] Error Initializing GTM"),s("error",e),!1}}return s("warn","[GTM] Warning! window or document object not found"),!1};const r=Boolean("undefined"!=typeof window&&window.document&&window.document.createElement),l=e=>{if(!e)return null;if(!r||!document||!document.cookie)return null;e=encodeURIComponent(e).replace(/[-.+*]/g,"\\$&"),e=new RegExp(`(?:(?:^|.*;)\\s*${e}\\s*\\=\\s*([^;]*).*$)|^.*$`);return decodeURIComponent(document.cookie.replace(e,"$1"))||null};function m(c,u){return u=u||{},new Promise(function(e,n){var t,r=new XMLHttpRequest,o=[],i=[],a={},s=function(){return{ok:2==(r.status/100|0),statusText:r.statusText,status:r.status,url:r.responseURL,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(JSON.parse(r.responseText))},blob:function(){return Promise.resolve(new Blob([r.response]))},clone:s,headers:{keys:function(){return o},entries:function(){return i},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(t in r.open(u.method||"get",c,!0),r.onload=function(){r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,n,t){o.push(n=n.toLowerCase()),i.push([n,t]),a[n]=a[n]?a[n]+","+t:t}),e(s())},r.onerror=n,r.withCredentials="include"==u.credentials,u.headers)r.setRequestHeader(t,u.headers[t]);r.send(u.body||null)})}const w=(e,n)=>"boolean"==typeof n||"number"==typeof n||null==n||"symbol"==typeof n?String(n):(a(n)&&n.forEach(e=>{w(void 0,e)}),n),f=e=>JSON.stringify(e,w);function g(e,a,s,c){return new(s=s||Promise)(function(t,n){function r(e){try{i(c.next(e))}catch(e){n(e)}}function o(e){try{i(c.throw(e))}catch(e){n(e)}}function i(e){var n;e.done?t(e.value):((n=e.value)instanceof s?n:new s(function(e){e(n)})).then(r,o)}i((c=c.apply(e,a||[])).next())})}const v=(()=>{let t,r=[];const o=e=>{e=m("https://hub.tokopedia.com/iris/v1/track/multi-event",Object.assign(Object.assign({},e),{method:"POST",body:f({data:r}),headers:{"Content-Type":"application/json"}}));return r=[],e};return(e,n)=>{for(const t of r)if(t["gtm.uniqueEventId"]===e["gtm.uniqueEventId"])return Promise.resolve({});return r.push(e),t=t||setTimeout(()=>(t=void 0,o(n)),2e3),5<=r.length?(clearTimeout(t),t=void 0,o(n)):Promise.resolve({})}})();var p={trackIrisEvent:(e,n)=>m("https://hub.tokopedia.com/iris/v1/track/event",Object.assign(Object.assign({},n),{method:"POST",body:f({data:e}),headers:{"Content-Type":"application/json"}})).then(()=>{}),trackIrisEventBatch:v,beaconDispatch:e=>{try{return navigator.sendBeacon("https://hub.tokopedia.com/iris/v1/track/event",JSON.stringify({data:e})),!0}catch(e){return console.error("[Failed Send Beacon]"),!1}return!0},backgroundSyncBatch:o=>function(e,a,s,c){return new(s=s||Promise)(function(t,n){function r(e){try{i(c.next(e))}catch(e){n(e)}}function o(e){try{i(c.throw(e))}catch(e){n(e)}}function i(e){var n;e.done?t(e.value):((n=e.value)instanceof s?n:new s(function(e){e(n)})).then(r,o)}i((c=c.apply(e,a||[])).next())})}(void 0,void 0,void 0,function*(){const e=([{name:c,version:u,schemas:d}]=[{name:"toped-iris-bgs",version:1,schemas:["iris-bgs-batch"]}],yield new Promise((n,t)=>{let o;const e=indexedDB.open(c,u);function r(e,r){return g(this,void 0,void 0,function*(){const t=o.transaction([e],"readwrite").objectStore(e).add(r);return new Promise((e,n)=>{t.onerror=function(e){n(e)},t.onsuccess=function(){e(r)}})})}function i(n){return g(this,void 0,void 0,function*(){const e=o.transaction([n],"readonly").objectStore(n),t=yield e.getAll();return new Promise((e,n)=>{t.onerror=function(e){n(e)},t.onsuccess=function(){e(t.result)}})})}function a(n){return g(this,void 0,void 0,function*(){const e=o.transaction([n],"readwrite").objectStore(n),t=yield e.clear();return new Promise((e,n)=>{t.onerror=function(e){n(e)},t.onsuccess=function(){e(t.result)}})})}function s(){o.close()}e.onupgradeneeded=function(e){o=e.target.result,d.forEach(e=>{o.objectStoreNames.contains(e)||o.createObjectStore(e,{keyPath:"id"})})},e.onsuccess=function(e){o=e.target.result,n({db:o,addItem:r,getItems:i,clear:a,close:s})},e.onerror=function(e){console.error(e),t(e)}}));var c,u,d;if((yield e.getItems("iris-bgs-batch")).find(e=>JSON.parse(e.data)["gtm.uniqueEventId"]===o["gtm.uniqueEventId"]))return Promise.resolve({});var n=f(o),t=Math.floor(Math.random()*Math.floor(100));yield e.addItem("iris-bgs-batch",{id:Date.now()+"-"+t,data:n,endpoint:"https://hub.tokopedia.com/iris/v1/track/multi-event"});const r=yield navigator.serviceWorker.ready;try{yield r.sync.register("iris-bgs-sync-batch")}catch(e){console.warn("[Failed Background Sync]: "+e.message),v(o)}})};const h=e=>btoa(e),y=()=>{let n="",t=4294967296*Math.random()>>>0;for(let e=0;e<32;e++){const r="xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx"[e-1],o=15&t,i="x"===r?o:3&o|8;n+="-"===r||"4"===r?r:i.toString(16),t=e%8==0?4294967296*Math.random()>>>0:t>>4}return n.toString()},b=t=>i.reduce((e,n)=>{var[n]=n;return e+`.${t[n]}`},"").slice(1),x=(e,n,o)=>{const t=l("ISID"),i=t?JSON.parse(t):{};i[e]=n;try{(()=>{const{cname:e,cvalue:n,options:t}={cname:"ISID",cvalue:JSON.stringify(i),options:o},r=Object.assign({domain:"tokopedia.com"},t);document.cookie=`${e}=${encodeURIComponent(n)}${Object.keys(r).map(e=>{return`;${n=e,n.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}=${r[e]}`;var n}).join("")};path=/`})()}catch(e){return s("error",e),!1}return!0},S=(e,n)=>{const t=(e=>{var n=l("ISID");let t,r,o;if(n){try{t=JSON.parse(n)}catch(e){s("error",e)}t&&t[e]&&(r={},o=t[e],o.split(".").forEach((e,n)=>{var t;n<i.length&&([t,n]=i[n],r[t]="number"===n?parseInt(e,10):e)}))}return{sessionData:r,sessionString:o}})(e)["sessionData"],{sessionString:r,sessionData:o}=((e,n,t)=>{var r=n&&n.currentTime?n.currentTime:(new Date).getTime();let o;e&&e.domainHash&&e.uuid&&e.initialVisit&&e.beginningCurr&&e.beginningPrev&&e.counter?(o=e,n&&n.increment?(o.domainHash=h(t),o.counter+=1):(o.domainHash=h(t),o.beginningPrev=o.beginningCurr,o.initialVisit=r,o.beginningCurr=r,o.uuid=y(),o.counter=1)):o={domainHash:h(t),uuid:y(),initialVisit:r,beginningPrev:r,beginningCurr:r,counter:1};r=b(o);return{sessionData:o,sessionString:r}})(t,n,e);return window.irisSessionRaw=o,window.irisSession=r.split(".").slice(0,3).join("."),x(e,r,{domain:window.location.hostname,maxAge:n.maxAge})},j=e=>(S(e,{increment:!0,maxAge:31536e3}),window.addEventListener("beforeunload",()=>{var e,n;e=window.location.hostname,n=window.irisSessionRaw,n=b(n),x(e,n,{domain:window.location.hostname,maxAge:31536e3})}),!0);var I=function(){return"undefined"!=typeof window&&"serviceWorker"in navigator&&"SyncManager"in window&&"indexedDB"in window},O=function(e,n){var t={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)n.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(t[o[r]]=e[o[r]]);return t},k=i=>(e,n)=>{try{let e;var t=(new Date).getTime();if("object"!=typeof(o=n)||a(o)||null===o)"string"==typeof n?(e={event:null,event_ga:null},i.customEventField?(e[i.customEventField]=n,e.event=i.defaultEventValue||"default_v2"):e.event=n):s("warn","[Iris Tracker] Iris tracker only accepts object or string!");else if(n.event){const a=n["event"],o=O(n,["event"]);o["gtm.element"]&&(o["gtm.element"]=`${o["gtm.element"].id&&""!==o["gtm.element"].id?`#${o["gtm.element"].id}`:""}${o["gtm.element"].className&&""!==o["gtm.element"].className?`.${o["gtm.element"].className.replace(/\s/g,".")}`:""}`),e=o,i.customEventField?(e[i.customEventField]=a,e.event=i.defaultEventValue||"default_v2"):e.event=a}else s("warn","[Iris Tracker] Event pushed without event name, data will be rejected"),s("warn",n);if(e&&("string"==typeof(r=e).event&&!r.event_ga.includes("gtm."))){(e=>{const n=window.location.hostname,t=window.irisSessionRaw.beginningCurr,r=new Date(e),o=new Date(t),i=r.getDate()!==o.getDate(),a=18e5<=e-t;(i||a)&&S(n,{currentTime:e,maxAge:31536e3}),window.irisSessionRaw.beginningCurr=e})(t);const n=Object.assign(Object.assign(Object.assign({},e),{container:i.container,iris_session_id:window.irisSession,url:window.location.href,hits_time:t,userId:l("tuid"),deviceId:l("DID_JS"),version:"2.1.6"}),"performance_v2"===e.event_ga&&{event:e.event_ga});i.backgroundSync&&I()?p.backgroundSyncBatch(n):i.batching?p.trackIrisEventBatch(n):Boolean(navigator&&navigator.sendBeacon)?p.beaconDispatch(n):p.trackIrisEvent(n)}return!0}catch(e){return s("error","[Iris Tracker] PUSH event error"),s("error",e),!1}var r,o};const T=(e,n,t)=>{var{sessionName:r=window.location.hostname}=e;j(r),d(n,k(e),t)},E=(e,t="dataLayer",r)=>{if(window&&document&&!window.init_iris_new)try{var{sessionName:n=window.location.hostname}=e;if(j(n),window[t]=[],window[t].push=k(e),r){const e=window[t]["push"];window[t].push=(...n)=>{e(window[t],...n),"function"==typeof r?r(window[t],...n):r instanceof Array&&r.forEach(e=>{"function"==typeof e&&e(window[t],...n)})}}return window.init_iris_new=!0}catch(e){return s("error","[Iris Tracker] Error initializing Iris instance"),s("error",e),!1}return s("error","[Iris Tracker] No window and document instance found"),!1}}]);
