!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("wafer-template",[],t):"object"==typeof exports?exports["wafer-template"]=t():(e.wafer=e.wafer||{},e.wafer.wafers=e.wafer.wafers||{},e.wafer.wafers["wafer-template"]=t())}("undefined"!=typeof self?self:this,function(){return r={"./src/base.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function i(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(r):void 0:null===(e=Object.getPrototypeOf(e))?void 0:i(e,t,r)}var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n=function(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e},o=window.wafer,f=o.base,a=o.constants,s=o.WaferBaseClass,o=o.utils,p=o.getTemplateContent,d=o.setTimeout,m=a.ATTR_PREFIX,v=["stateTrigger"],w=["click","mouseenter","mouseleave"],n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(y,s),n(y,[{key:"renderTemplate",value:function(o){var e=this._util,a=e.allowRerender,i=e.elem,s=e.successClass,l=e.targetSelector,c=e.templateText,u=e.templateId;return new Promise(function(t,r){var n=l?document.querySelector(l):i;i.classList.add("wafer-template-trigger-in-progress"),n.classList.add("wafer-template-target-in-progress"),d(function(){return c?void(n?(f.destroy(n),n.innerHTML=c,f.sync(n),n.classList.add(s),i.classList.remove("wafer-template-trigger-in-progress"),n.classList.remove("wafer-template-target-in-progress"),f._emit({elem:i,meta:{eventName:o,target:n},name:y.name},"template:render"),a?t(!1):((e=window.wafer.wafers["wafer-template"])&&(!0===e.__esModule?e.default:e).destroy(i),t(!0))):r(new Error("[wafer-template] Cannot find target element"))):(i.classList.remove("wafer-template-trigger-in-progress"),n.classList.remove("wafer-template-target-in-progress"),void r(new Error("[wafer-template] Cannot find template with id = "+u)));var e},0)})}},{key:"addEventListeners",value:function(){var n=this,e=this._util,o=e.elem,a=e.events;0!==a.size&&window.wafer.ready(function(){for(var e,t=!1,r=0;e=a[r];++r)"click"===e?o.classList.add("has-template-click","has-wafer-click"):"mouseenter"===e?t=!0:e.indexOf(":")&&window.wafer.on(e,n.onWaferEvent);t&&i(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"addEventListeners",n).call(n)})}},{key:"click",value:function(){-1!==this._util.events.indexOf("click")&&this.renderTemplate("click").catch(function(e){})}},{key:"onWaferEvent",value:function(e){e.elem===this._util.elem&&this.renderTemplate(e.type).catch(function(e){})}},{key:"remove",value:function(){this._util.elem.remove()}},{key:"stateDidUpdate",value:function(){-1!==this._util.events.indexOf("stateChange")&&this.renderTemplate("stateChange")}},{key:"mouseenter",value:function(){var e=this,t=this._util.delay;this._state.mouseEnterTimeout=d(function(){e.renderTemplate("mouseenter").catch(function(e){})},t,this)}},{key:"mouseleave",value:function(){this._state.mouseEnterTimeout&&clearTimeout(this._state.mouseEnterTimeout)}},{key:"destroy",value:function(){for(var e,t=this._util,r=t.elem,n=t.events,o=0;e=n[o];++o)e.indexOf(":")&&window.wafer.removeListener(e,this.onWaferEvent);r.classList.add("wafer-template-destroyed"),i(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"destroy",this).call(this)}},{key:"config",get:function(){return{viewportTrigger:this._util.viewportTrigger}}}]),y);function y(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.errorClass,n=void 0===r?"wafer-template-error":r,o=t.selector,a=t.successClass,i=void 0===a?"wafer-template-success":a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,e,{errorClass:n,selector:o,successClass:i},{STATE_ATTRS:v})),l=e.getAttribute(m+"template-target")||"",c=e.getAttribute(m+"template-id"),r=document.getElementById(c),t=r&&p(r),a=e.getAttribute(m+"template-render-delay"),o=e.getAttribute(m+"template-on")||"click",r=e.hasAttribute(m+"template-allow-rerender");return s._util=u({},s._util,{allowRerender:r,delay:null==a?0:Number(a),elem:e,errorClass:n,events:o?o.split(","):[],successClass:i,targetSelector:l,templateId:c,templateText:t}),-1!==s._util.events.indexOf("viewport")&&(s._util.viewportTrigger=!0),s._state={},w.forEach(function(e){s[e]=s[e].bind(s)}),s.onWaferEvent=s.onWaferEvent.bind(s),s.addEventListeners(),s}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}n.events={click:[["has-template-click","click"]],mouseenter:[["_self","mouseenter"]],mouseleave:[["_self","mouseleave"]]},t.default=n,e.exports=t.default},"./src/controller.js":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=function(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e},n=window.wafer,i=n.base,s=n.controllers,n=n.utils,l=n.elementInView,c=n.throttle,s=s.WaferBaseController,r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,s),r(u,[{key:"trigger",value:function(e){e=this._state.elementInstances.get(e);!e||(e=e.instance)&&e.renderTemplate("trigger").catch(function(e){})}},{key:"handleScroll",value:function(){this._validateWithThrottle()}},{key:"handleResize",value:function(){this._validateWithThrottle()}},{key:"willValidate",value:function(e){var r=this._state.elementInstances;e.forEach(function(e){var t=r.get(e).instance;t.config.viewportTrigger&&l(e,{offsetX:0,offsetY:0},i.viewport)&&t.renderTemplate("viewport").catch(function(e){})})}}]),u);function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.root,r=void 0===t?document:t,t=e.selector,t=void 0===t?".wafer-template":t,e=e.validateDelay,e=void 0===e?25:e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,{root:r,selector:t,WaferClass:(a||(t=o("./src/base.js"),a=t&&t.__esModule?t:{default:t})).default}));return n._validateWithThrottle=c(function(){n.validate()},e,n),n.sync(),n}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}t.default=r,e.exports=t.default},"./src/entry.js":function(e,t,r){"use strict";var n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.default=new(n||(o=r("./src/controller.js"),n=o&&o.__esModule?o:{default:o})).default({selector:".wafer-template"}),e.exports=t.default}},o={},n.m=r,n.c=o,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="https://s.yimg.com/aaq/wf/",n(n.s="./src/entry.js");function n(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var r,o});
