!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.hulk=e():t.hulk=e()}(window,function(){return r=[function(t,e,r){var n=function(){return function(){return function(t){var e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);t[0].match(/^[^/:]+:\/*$/)&&1<t.length&&(o=t.shift(),t[0]=o+t[0]),t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(var r=0;r<t.length;r++){var n=t[r];if("string"!=typeof n)throw new TypeError("Url must be a string. Received "+n);""!==n&&(0<r&&(n=n.replace(/^[\/]+/,"")),n=r<t.length-1?n.replace(/[\/]+$/,""):n.replace(/[\/]+$/,"/"),e.push(n))}var o=e.join("/");return(o=(o=o.replace(/\/(\?|&|#[^!])/g,"$1")).split("?")).shift()+(0<o.length?"?":"")+o.join("&")}("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}};t.exports?t.exports=n():void 0===(n="function"==typeof(n=n)?n.call(e,r,e,t):n)||(t.exports=n)},function(t,e,r){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),g=this&&this.__assign||function(){return(g=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},_=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s,u=a(r(8)),c=a(r(12)),l=r(2),S=(s=Error,o(f,s),f);function f(t,e,r,n,o){t=s.call(this,t)||this;return Object.setPrototypeOf?Object.setPrototypeOf(t,f.prototype):t.__proto__=f.prototype,t.url=e,t.method=r,t.requestBody=n,t.responseStatus=o,t}e.FetchError=S,e.fRetry=function(r){return function(v,m,b,w){return void 0===b&&(b=!0),i(void 0,void 0,void 0,function(){var y,e;return _(this,function(t){return y=c.default(l.trackClientErrors,500),e=function(h){return i(void 0,void 0,void 0,function(){var e,r,n,o,i,a,s,u,c,l,f,p,d;return _(this,function(t){switch(t.label){case 0:return m&&m.method&&"GET"!==m.method.toUpperCase()&&m.headers&&"string"==typeof m.body&&(e=function(t){for(var e=0,r=Object.keys(t);e<r.length;e++){var n=r[e];if("content-type"===n.toLowerCase())return t[n]}return null}(m.headers))&&"application/json"===e.toLowerCase()&&"object"==typeof(r=JSON.parse(m.body))&&(m.body=JSON.stringify(g({__numberOfAttempts:h},r))),n="string"==typeof v?v:v.url,o=m&&m.method||"string"!=typeof v&&v.method||"get",s=(a=JSON).parse,(u=m&&m.body)?[3,3]:(c="string"!=typeof v)?[4,v.clone().text()]:[3,2];case 1:c=t.sent(),t.label=2;case 2:u=c,t.label=3;case 3:i=s.apply(a,[u.toString()])||void 0,t.label=4;case 4:return t.trys.push([4,8,9,10]),[4,fetch(v,g(g({},m),{credentials:(null==m?void 0:m.credentials)||"omit"}))];case 5:return l=t.sent(),(f=w)?[4,w(l)]:[3,7];case 6:f=!t.sent(),t.label=7;case 7:if(p=f,!l.ok||p)throw p=p?"Failed response validation":l.statusText,new S(p,n,o,i,l.status);return[2,l];case 8:if((d=t.sent())instanceof S)throw d;throw new S(d.message||"Unexpected fetch error",n,o,i);case 9:return b&&y(null===(d=null==m?void 0:m.headers)||void 0===d?void 0:d.Authorization),[7];case 10:return[2]}})})},[2,u.default(e,r)]})})}};o=e.fRetry({retries:5});e.default=o},function(t,a,e){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},r=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},u=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},n=this&&this.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(a,"__esModule",{value:!0});var c,i=o(e(3)),l=e(6),f=o(e(0)),p=o(e(1)),d=new i.default("MOL-FE-WEB-PUSH_CLIENT_SUBSCRIPTION_ERRORS",sessionStorage);a.setBaseEndpoint=function(t){return c=t},a.getErrors=function(){return d.get()},a.addError=function(t){var e=l.serializeError(t),t=a.getErrors();null!=t&&t.find(function(t){return JSON.stringify(t)===JSON.stringify(e)})||d.set(n(t||[],[e]))},a.clear=function(){return d.clear()},a.trackClientErrors=function(i){return r(void 0,void 0,void 0,function(){var e,r,n,o;return u(this,function(t){switch(t.label){case 0:if(!(e=a.getErrors())||0===e.length)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),r=f.default(c,"analytics/client/error"),n={body:JSON.stringify({errors:e}),headers:{"Content-type":"application/json"},method:"post"},i&&(n.headers=s(s({},n.headers),{Authorization:i})),[4,p.default(r,n,!1)];case 2:if(!(o=t.sent()).ok)throw new Error(o.statusText);return a.clear(),[3,4];case 3:return o=t.sent(),console.error("Track Client Errors",o),[3,4];case 4:return[2]}})})}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.get=function(){try{var t=this.storage.getItem(this.name);if(null!==t)return JSON.parse(t)}catch(t){console.error(t)}return null},o.prototype.set=function(t){try{this.storage.setItem(this.name,JSON.stringify(t))}catch(t){console.error(t)}},o.prototype.clear=function(){try{this.storage.removeItem(this.name)}catch(t){console.error(t)}},o);function o(t,e){void 0===e&&(e=localStorage),this.name=t,this.storage=e}e.default=n},function(t,u,e){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},l=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(u,"__esModule",{value:!0});var n=r(e(13)),f=r(e(1)),p=r(e(7));u.isWebPushSupported=function(){return"serviceWorker"in navigator&&"PushManager"in window},u.needsMigration=function(t,e){return t.options.applicationServerKey instanceof ArrayBuffer&&!n.default(e,new Uint8Array(t.options.applicationServerKey,0))},u.willExpireSoon=function(t){return!!t.expirationTime&&t.expirationTime<Date.now()+6048e5},u.registerPushSubscription=function(r,t,n){var o=t.subscription,i=t.metadata;return c(void 0,void 0,void 0,function(){var e;return l(this,function(t){return function(t){var e,r;try{e=t.getKey("auth"),r=t.getKey("p256dh")}catch(e){return console.error("Unable to get auth and p256dh keys, subscription "+JSON.stringify(t,null,2)),0}return null!==e&&null!==r}(o)?(e={metadata:s(s({},i),{browserLanguage:navigator.language,subscribedUrl:location.href}),subscription:o},e={body:JSON.stringify(e),headers:{"Content-type":"application/json"},method:"POST",mode:"cors"},n&&(e.headers=s(s({},e.headers),{Authorization:"ApiKey "+n})),[2,f.default(r,e)]):[2,void 0]})})},u.subscribePushNotifications=function(t){var n=t.apiKey,o=t.appServerKey,i=t.metadata,a=t.subscriptionEndpoint,s=t.registration;return c(void 0,void 0,void 0,function(){var e,r;return l(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,s.pushManager.subscribe({applicationServerKey:o,userVisibleOnly:!0})];case 1:return e=t.sent(),[4,u.registerPushSubscription(a,{subscription:e,metadata:i},n)];case 2:return t.sent(),[2,e];case 3:throw r=t.sent(),new p.default(r.message,"register",r);case 4:return[2]}})})},u.requestPushNotificationPermission=function(){return c(void 0,void 0,void 0,function(){return l(this,function(t){return[2,new Promise(function(e,t){var r=Notification.requestPermission(function(t){e(t)});r instanceof Promise&&r.then(e,t)})]})})},u.requestPushPermissionAndSubscribe=function(r){return c(void 0,void 0,void 0,function(){var e;return l(this,function(t){switch(t.label){case 0:return[4,u.requestPushNotificationPermission()];case 1:return"granted"!==(e=t.sent())?[3,3]:[4,u.subscribePushNotifications(s({},r))];case 2:t.sent(),t.label=3;case 3:return[2,e]}})})},u.updatePushSubscription=function(n,t,o){var i=t.subscription,a=t.metadata;return c(void 0,void 0,void 0,function(){var e,r;return l(this,function(t){switch(t.label){case 0:r={metadata:s(s({},a),{browserLanguage:navigator.language,subscribedUrl:location.href}),subscription:i},e={body:JSON.stringify(r),headers:{"Content-type":"application/json"},method:"PATCH",mode:"cors"},o&&(e.headers=s(s({},e.headers),{Authorization:"ApiKey "+o})),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,f.default(n,e)];case 2:return t.sent(),[3,4];case 3:throw r=t.sent(),new p.default(r.message,"update",r);case 4:return[2]}})})},u.replaceSubscription=function(t){var e=t.apiKey,r=t.appServerKey,n=t.metadata,o=t.registration,i=t.subscription,a=t.subscriptionEndpoint;return c(void 0,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return[4,i.unsubscribe()];case 1:return t.sent(),[2,u.subscribePushNotifications({apiKey:e,appServerKey:r,metadata:n,registration:o,subscriptionEndpoint:a})]}})})}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=new(n(r(3)).default)("MOL-FE-WEB-PUSH_SUBSCRIPTION_STATUS");e.setStatus=function(t,e){o.set({state:t,metadata:e})},e.getStatus=function(){return o.get()},e.clearStatus=function(){return o.clear()}},function(t,e,r){"use strict";class n extends Error{constructor(t){super(n._prepareSuperMessage(t)),Object.defineProperty(this,"name",{value:"NonError",configurable:!0,writable:!0}),Error.captureStackTrace&&Error.captureStackTrace(this,n)}static _prepareSuperMessage(e){try{return JSON.stringify(e)}catch(t){return String(e)}}}const i=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],a=({from:t,seen:e,to_:r,forceEnumerable:n})=>{const o=r||(Array.isArray(t)?[]:{});e.push(t);for(const[r,i]of Object.entries(t))"function"!=typeof i&&(i&&"object"==typeof i?e.includes(t[r])?o[r]="[Circular]":o[r]=a({from:t[r],seen:e.slice(),forceEnumerable:n}):o[r]=i);for(const{property:e,enumerable:r}of i)"string"==typeof t[e]&&Object.defineProperty(o,e,{value:t[e],enumerable:!!n||r,configurable:!0,writable:!0});return o};t.exports={serializeError:t=>"object"==typeof t&&null!==t?a({from:t,seen:[],forceEnumerable:!0}):"function"==typeof t?`[Function: ${t.name||"anonymous"}]`:t,deserializeError:t=>{if(t instanceof Error)return t;if("object"!=typeof t||null===t||Array.isArray(t))return new n(t);var e=new Error;return a({from:t,seen:[],to_:e}),e}}},function(t,e,r){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i,o=(i=Error,o(a,i),a);function a(t,e,r){t=i.call(this,t)||this;return Object.setPrototypeOf?Object.setPrototypeOf(t,a.prototype):t.__proto__=a.prototype,t.type=e,t.cause=r,t}e.default=o},function(t,e,r){"use strict";const n=r(9);class u extends Error{constructor(t){super(),t instanceof Error?t=(this.originalError=t)["message"]:(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}}r=(a,s)=>new Promise((t,o)=>{s={onFailedAttempt:()=>{},retries:10,...s};const i=n.operation(s);i.attempt(async e=>{try{t(await a(e))}catch(t){if(!(t instanceof Error))return void o(new TypeError(`Non-error was thrown: "${t}". You should only throw errors.`));if(t instanceof u)i.stop(),o(t.originalError);else if(t instanceof TypeError)i.stop(),o(t);else{r=t,n=s.retries-(e-1),r.attemptNumber=e,r.retriesLeft=n;try{await s.onFailedAttempt(t)}catch(t){return void o(t)}i.retry(t)||o(i.mainError())}}var r,n})});t.exports=r,t.exports.default=r,t.exports.AbortError=u},function(t,e,r){t.exports=r(10)},function(t,s,e){var r=e(11);s.operation=function(t){var e=s.timeouts(t);return new r(e,{forever:t&&t.forever,unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},s.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e,r={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(e in t)r[e]=t[e];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<r.retries;o++)n.push(this.createTimeout(o,r));return t&&t.forever&&!n.length&&n.push(this.createTimeout(o,r)),n.sort(function(t,e){return t-e}),n},s.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,t=Math.round(r*e.minTimeout*Math.pow(e.factor,t));return Math.min(t,e.maxTimeout)},s.wrap=function(o,i,t){if(i instanceof Array&&(t=i,i=null),!t)for(var e in t=[],o)"function"==typeof o[e]&&t.push(e);for(var r=0;r<t.length;r++){var n=t[r],a=o[n];o[n]=function(t){var e=s.operation(i),r=Array.prototype.slice.call(arguments,1),n=r.pop();r.push(function(t){e.retry(t)||(t&&(arguments[0]=e.mainError()),n.apply(this,arguments))}),e.attempt(function(){t.apply(o,r)})}.bind(o,a),o[n].options=i}}},function(t,e){function r(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}(t.exports=r).prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);t=this._timeouts.shift();if(void 0===t){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),t=this._timeouts.shift()}var r=this,t=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t);return this._options.unref&&t.unref(),!0},r.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},r.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,r=0,n=0;n<this._errors.length;n++){var o=this._errors[n],i=o.message,a=(t[i]||0)+1;r<=(t[i]=a)&&(e=o,r=a)}return e}},function(t,e,r){"use strict";t.exports=function(u){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},f=void 0,p=void 0,d=void 0,h=[];return function(){var t,e="function"==typeof(t=c)?t():t,r=(new Date).getTime(),t=!f||e<r-f;f=r;for(var n,o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];if(t&&l.leading)return l.accumulate?Promise.resolve(u.call(this,[i])).then(function(t){return t[0]}):Promise.resolve(u.call.apply(u,[this].concat(i)));if(p?clearTimeout(d):((n={}).promise=new Promise(function(t,e){n.resolve=t,n.reject=e}),p=n),h.push(i),d=setTimeout(function(){var t=p;clearTimeout(d),Promise.resolve(l.accumulate?u.call(this,h):u.apply(this,h[h.length-1])).then(t.resolve,t.reject),h=[],p=null}.bind(this),e),l.accumulate){var s=h.length-1;return p.promise.then(function(t){return t[s]})}return p.promise}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(t.byteLength!==e.byteLength)return!1;for(var r=0;r!==t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){switch(t){case"production":return"https://hulkprod.anm.co.uk/api/web-push-notification";case"integration":return"https://hulkint.anm.co.uk/api/web-push-notification";default:return"/public"}}},function(t,e,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(7)),a=r(5),s=r(6);r(2),e.default=function(t,e){var r=e.emit,n=e.metadata,e=e.rawAppServerKey;t instanceof i.default&&("register"===t.type?a.setStatus("register_pending",n):"update"===t.type&&a.setStatus("update_pending",n)),r("error",o(o({},s.serializeError(t)),{organisation:n.organisation,rawAppServerKey:e,userAgent:n.userAgent}))}},function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},a=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=n(r(23));e.default=function(r,n,o){return i(void 0,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,s.default(r,n,o)];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),console.error("TrackEvent Error",e),[3,3];case 3:return[2]}})})}},function(t,e,r){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},a=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},s=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c,l=u(r(0)),f=u(r(18)),p=u(r(19)),d=u(r(21)),h=u(r(26)),y=u(r(14)),v=r(4),m=u(r(28)),o=(c=f.default,o(b,c),b.isWebPushSupported=function(){return v.isWebPushSupported()},b.prototype.init=function(){return a(this,void 0,void 0,function(){var e,r,n,o=this;return s(this,function(t){switch(t.label){case 0:return[4,this.getAppServerKey()];case 1:return n=t.sent()||{},e=n.parsed,r=n.raw,n=this,[4,d.default(i(i({},this.options),{appServerKey:e,baseEndpoint:this.baseEndpoint,emit:function(t,e){return o.emit(t,e)},rawAppServerKey:r,subscriptionEndpoint:this.subscriptionEndpoint}))];case 2:return n.registration=t.sent(),[2,this.registration]}})})},b.prototype.showPrompt=function(){return a(this,void 0,void 0,function(){var e,r,n=this;return s(this,function(t){switch(t.label){case 0:return[4,this.getAppServerKey()];case 1:if(r=t.sent()||{},e=r.parsed,r=r.raw,null===this.registration)throw new Error("Init must be called before attempting to call showPrompt");return[2,h.default(this.registration,i(i({},this.options),{appServerKey:e,baseEndpoint:this.baseEndpoint,emit:function(t,e){return n.emit(t,e)},rawAppServerKey:r,subscriptionEndpoint:this.subscriptionEndpoint}))]}})})},b.prototype.getAppServerKey=function(r){return void 0===r&&(r=!1),a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return null===this.appServerKey||r?(e=this,[4,p.default(l.default(this.subscriptionEndpoint,"publicKey"),this.options.apiKey)]):[3,2];case 1:e.appServerKey=t.sent(),t.label=2;case 2:return[2,this.appServerKey]}})})},b);function b(t){var e=c.call(this)||this;e.appServerKey=null,e.registration=null;var r=t.environment?y.default(t.environment):t.baseEndpoint||"";return e.options=m.default(i({},t)),e.baseEndpoint=l.default(r,"/v1/organisation",e.options.metadata.organisation),e.subscriptionEndpoint=l.default(e.baseEndpoint,"subscription"),e}e.Register=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.on=function(t,e){var r=this.events;return(r[t]||(r[t]=[])).push(e),this},o.prototype.removeListener=function(t,e){var r=this.events,n=r[t]||(r[t]=[]);return r[t]=n.filter(function(t){return t!==e}),this},o.prototype.removeAllListeners=function(t){return t?this.events[t]=null:this.events={},this},o.prototype.emit=function(t){for(var e=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=this.events,i=o[t]||(o[t]=[]),o=0<i.length,a=r;try{a=JSON.parse(JSON.stringify(r))}catch(t){}return i.forEach(function(t){try{t.apply(void 0,a)}catch(t){e.logger.error(t,t.stack)}}),o},o);function o(t){this.events={},this.logger=t||console}e.default=n},function(t,e,r){"use strict";var o=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},i=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(r(20)),s=n(r(1));e.default=function(r,n){return o(void 0,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return e={mode:"cors"},n&&(e.headers={Authorization:"ApiKey "+n}),[4,s.default(r,e,!0,function(e){return o(void 0,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,e.clone().text()];case 1:return[2,""!==t.sent().trim()]}})})})];case 1:return[4,t.sent().text()];case 2:return e=t.sent(),[2,{parsed:a.default(e),raw:e}]}})})}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var t=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),e=function(){try{return window.atob(),1}catch(t){return}}()?function(t){for(var e,r,n={},o=0,i=0,a="",s=t.length,u=0;u<64;u++)n["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(u)]=u;for(e=0;e<s;e++)for(o=(o<<6)+(u=n[t.charAt(e)]),i+=6;8<=i;)((r=255&o>>>(i-=8))||e<s-2)&&(a+=String.fromCharCode(r));return a}(t):window.atob(t),r=new Uint8Array(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}},function(t,e,r){"use strict";var j=this&&this.__assign||function(){return(j=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},M=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},I=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},K=this&&this.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var N=n(r(22)),U=r(4),C=r(5),R=n(r(15)),L=r(2),J=n(r(16)),z=r(24);e.default=function(T){return M(void 0,void 0,void 0,function(){var e,r,n,s,u,c,l,f,p,d,h,y,v,m,b,w,g,_,S,O,E,P,x,k,A;return I(this,function(t){switch(t.label){case 0:e=T.apiKey,r=T.appServerKey,n=T.notificationMacros,s=T.emit,u=T.metadata,c=T.baseEndpoint,l=T.swUrl,f=T.subscriptionEndpoint,p=T.rawAppServerKey,d=Array.isArray(u.visitorIds)?u.visitorIds[0]:void 0,h=u.userAgent,t.label=1;case 1:return t.trys.push([1,21,,22]),[4,N.default];case 2:return t.sent(),y=new URLSearchParams(window.location.search),v=y.get("ito"),L.setBaseEndpoint(c),m=C.getStatus(),[4,(o=u,i=s,a=p,M(void 0,void 0,void 0,function(){var e,r,n;return I(this,function(t){switch(t.label){case 0:r=C.getStatus(),e=o.organisation,r=r&&Array.isArray(r.metadata.crossOrgUserIds)?r.metadata.crossOrgUserIds:[],t.label=1;case 1:return t.trys.push([1,3,,4]),[4,z.getCrossOrgUserIdFromCentral(e)];case 2:return(n=t.sent()||void 0)&&!r.includes(n)&&z.updateCrossOrgUserIdOnOtherOrgs(e,n).catch(function(t){R.default(t,{emit:i,metadata:o,rawAppServerKey:a})}),[2,n];case 3:return n=t.sent(),R.default(n,{emit:i,metadata:o,rawAppServerKey:a}),[3,4];case 4:return[2,r[r.length-1]]}})}))];case 3:return b=t.sent(),w=b?[b]:void 0,u.crossOrgUserIds=w,"push-notification"!==v?[3,5]:(g=y.get("ci"),S=y.get("si"),_=y.get("ai"),g&&S?(S={action:"click",campaignId:g,crossOrgUserId:b,organisation:u.organisation,platform:u.platform,subscriptionId:S,type:"notification",userAgent:h,visitorId:d},_&&(S.assetId=_),s("notification_click",S),[4,J.default(c,j(j({},S),{action:"click_page_load"}),e)]):[3,5]);case 4:t.sent(),t.label=5;case 5:if(!l)return[3,9];t.label=6;case 6:return t.trys.push([6,8,,9]),[4,navigator.serviceWorker.register(l,{scope:"/"})];case 7:return t.sent(),[3,9];case 8:return P=t.sent(),console.error("ServiceWorker registration failed: ",P),[3,9];case 9:return[4,navigator.serviceWorker.ready];case 10:return[4,(O=t.sent()).pushManager.getSubscription()];case 11:return E=t.sent(),A=!!E&&U.needsMigration(E,r),m=C.getStatus(),P={apiKey:e,baseEndpoint:c,crossOrgUserId:b,navigatorPlatform:window.navigator.platform,notificationMacros:n,organisation:u.organisation,permission:Notification.permission,subscription:A?null:E,type:"web-push-sw-init-data",userAgent:u.userAgent,visitorId:d},O.active.postMessage(JSON.stringify(P)),m&&"undecided"===m.state&&"granted"===Notification.permission&&(C.setStatus("register_pending",m.metadata),m=C.getStatus()),m&&"undecided"!==m.state&&m.metadata&&(m.metadata.userAgent!==u.userAgent||m.metadata.profilingAllowed!==u.profilingAllowed||(m.metadata.visitorIds||[]).join(",")!==(u.visitorIds||[]).join(",")||(m.metadata.crossOrgUserIds||[]).join(",")!==(w||[]).join(",")||"push-notification"===v)&&(x=j(j({},m.metadata),{crossOrgUserIds:Array.from(new Set(K(m.metadata.crossOrgUserIds||[],w||[]))),keywords:Array.from(new Set(K(m.metadata.keywords||[],u.keywords||[]))),profilingAllowed:u.profilingAllowed,userAgent:u.userAgent,visitorIds:Array.from(new Set(K(m.metadata.visitorIds||[],u.visitorIds||[])))}),P="ready"===m.state?"update_pending":m.state,C.setStatus(P,x),m=C.getStatus()),E?(x=m?m.metadata:u,A||U.willExpireSoon(E)?[4,U.replaceSubscription({apiKey:e,appServerKey:r,metadata:j(j({},u),{migrated:A,migratedSubscriptionEndpoint:A?E.endpoint:void 0}),registration:O,subscription:E,subscriptionEndpoint:f})]:[3,13]):[3,18];case 12:return t.sent(),[3,17];case 13:return m&&"register_pending"===m.state?[4,U.registerPushSubscription(f,{subscription:E,metadata:x},e)]:[3,15];case 14:return t.sent(),[3,17];case 15:return m&&"update_pending"===m.state||!m?[4,U.updatePushSubscription(f,{subscription:E,metadata:x},e)]:[3,17];case 16:t.sent(),t.label=17;case 17:return C.setStatus("ready",u),[3,20];case 18:return"granted"!==Notification.permission?[3,20]:(k=m?m.metadata:u,[4,U.subscribePushNotifications({apiKey:e,appServerKey:r,metadata:k,registration:O,subscriptionEndpoint:f})]);case 19:t.sent(),C.setStatus("ready",k),t.label=20;case 20:return[2,O];case 21:return A=t.sent(),R.default(A,{emit:s,metadata:u,rawAppServerKey:p}),[3,22];case 22:return[2,null]}var o,i,a})})}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},o=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(e,"__esModule",{value:!0});n=n(void 0,void 0,void 0,function(){return o(this,function(t){return[2,new Promise(function(t){"complete"!==document.readyState?document.addEventListener("readystatechange",function(){"complete"===document.readyState&&t()}):t()})]})});e.default=n},function(t,e,r){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},s=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},u=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=n(r(0)),l=n(r(1));e.default=function(n,o,i){return s(void 0,void 0,void 0,function(){var e,r;return u(this,function(t){return e=o.type,r=o.action,e=c.default(n,"analytics/track",e,r),r={body:JSON.stringify(o),headers:{"Content-type":"application/json"},method:"post",mode:"cors"},i&&(r.headers=a(a({},r.headers),{Authorization:"ApiKey "+i})),[2,l.default(e,r)]})})}},function(t,i,e){"use strict";var a=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},s=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(i,"__esModule",{value:!0});var u=e(25);i.API_ROOT_BY_ENV={development:{central:location.protocol+"//"+location.host+"/public/v1/static/latest/mol-fe-web-push-browser-register",metro:location.protocol+"//"+location.host+"/public/v1/static/latest/mol-fe-web-push-browser-register",mol:location.protocol+"//"+location.host+"/public/v1/static/latest/mol-fe-web-push-browser-register",newzit:location.protocol+"//"+location.host+"/public/v1/static/latest/mol-fe-web-push-browser-register"},integration:{central:"https://hulkint.anm.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",metro:"https://test1.metro.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",mol:"https://www.dailymailint.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",newzit:"https://www.newzitint.com/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register"},production:{central:"https://hulkprod.anm.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",metro:"https://metro.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",mol:"https://www.dailymail.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register",newzit:"https://www.newzit.com/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register"}};function c(t,e){if("localhost"===(e=new URL(e).hostname)||e.endsWith("ngrok.io"))return"development";if(!r[t])throw new Error("No hostnames for organisation: "+t);return r[t].includes(e)?"production":"integration"}var r={metro:["metro.co.uk"],mol:["www.dailymail.co.uk","a.dailymail.co.uk","b.dailymail.co.uk","c.dailymail.co.uk"],newzit:["www.newzit.com"]},l=["mol","newzit","metro"];i.getCrossOrgUserIdFromCentral=function(r){return a(void 0,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return e=c(r,location.href),e=i.API_ROOT_BY_ENV[e].central+"/crossOrgInlinedMin.html?command=getCrossOrgUserId",[4,u.loadIframeAndWaitForMessage(e,"mol-fe-web-push-cross-org-user-id")];case 1:return[2,(e=t.sent())&&e.crossOrgUserId]}})})},i.updateCrossOrgUserIdOnOtherOrgs=function(e,o){return a(void 0,void 0,void 0,function(){var n;return s(this,function(t){switch(t.label){case 0:return l.includes(e)?(n=c(e,location.href),[4,Promise.all(l.filter(function(t){return t!==e}).map(function(r){return a(void 0,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return e=i.API_ROOT_BY_ENV[n][r]+"/crossOrgInlinedMin.html?command=updateCrossOrgUserId&crossOrgUserId="+o+"&environment="+n,[4,u.loadIframeAndWaitForMessage(e,"mol-fe-web-push-cross-org-update")];case 1:return t.sent(),[2]}})})}))]):[2];case 1:return t.sent(),[2]}})})}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},o=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.loadIframeAndWaitForMessage=function(s,u){return n(void 0,void 0,void 0,function(){var a;return o(this,function(t){return a=new URL(s).origin,[2,new Promise(function(e,r){function n(t){t.data.scope===u&&t.origin===a&&(window.removeEventListener("message",n),o&&clearTimeout(o),void 0!==t.data.data?e(t.data.data):r(new Error("Invalid data posted back from crossOrg iframe")),i&&i.remove())}var o,i=null;window.addEventListener("message",n),(i=document.createElement("iframe")).style.width="0px",i.style.height="0px",i.style.border="none",i.src=s,document.body.appendChild(i),o=window.setTimeout(function(){window.removeEventListener("message",n),r(new Error("crossOrg iframe timed out")),i&&i.remove()},1e4)})]})})}},function(t,w,e){"use strict";var r=this&&this.__awaiter||function(t,a,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function o(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,o)}i((u=u.apply(t,a||[])).next())})},g=this&&this.__generator||function(r,n){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,i=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(w,"__esModule",{value:!0});var _=n(e(27)),S=e(4),O=e(5),E=n(e(16)),P=n(e(15));w.LAST_PROMPT_EPOCH="mol-fe-browser-notifications-last-prompt-epoch",w.default=function(m,b){return r(void 0,void 0,void 0,function(){var e,r,n,o,i,a,s,u,c,l,f,p,d,h,y,v;return g(this,function(t){switch(t.label){case 0:e=b.apiKey,r=b.appServerKey,n=b.emit,o=b.metadata,i=b.baseEndpoint,a=b.subscriptionEndpoint,s=b.promptFrequency,u=b.rawAppServerKey,t.label=1;case 1:return t.trys.push([1,10,,11]),d=o.channels,p=o.crossOrgUserIds,c=o.platform,h=o.subChannels,l=o.userAgent,f=o.visitorIds,f=Array.isArray(f)?f[0]:void 0,p=Array.isArray(p)?p[0]:void 0,d=Array.isArray(d)?d[0]:void 0,h=Array.isArray(h)?h[0]:void 0,function(t){if(!t)return 1;var e=_.default(t);if("number"!=typeof e)throw new TypeError("Prompt frequency must be a valid string like `1d` or `1h`");if(!("localStorage"in window))return 1;t=JSON.parse(window.localStorage.getItem(w.LAST_PROMPT_EPOCH)||"0");return Date.now()-t>=e}(s)?[3,2]:(n("prompt_discarded",{action:"discarded",channel:d,crossOrgUserId:p,organisation:o.organisation,permission:Notification.permission,platform:c,subChannel:h,type:"prompt",userAgent:l,visitorId:f}),[3,9]);case 2:return"default"!==Notification.permission?[3,6]:(y={action:"impression",channel:d,crossOrgUserId:p,organisation:o.organisation,permission:Notification.permission,platform:c,subChannel:h,type:"prompt",userAgent:l,visitorId:f},n("prompt_impression",y),[4,E.default(i,y,e)]);case 3:return t.sent(),[4,S.requestPushPermissionAndSubscribe({apiKey:e,appServerKey:r,metadata:o,registration:m,subscriptionEndpoint:a})];case 4:return y=t.sent(),y={action:"click",channel:d,crossOrgUserId:p,organisation:o.organisation,permission:y,platform:c,subChannel:h,type:"prompt",userAgent:l,visitorId:f},n("prompt_click",y),[4,E.default(i,y,e)];case 5:t.sent(),"localStorage"in window&&window.localStorage.setItem(w.LAST_PROMPT_EPOCH,JSON.stringify(Date.now())),t.label=6;case 6:return"granted"!==Notification.permission?[3,8]:[4,m.pushManager.getSubscription()];case 7:return v=t.sent(),v={subscription:v,type:"web-push-sw-subscription-ready"},m.active.postMessage(JSON.stringify(v)),O.setStatus("ready",o),[3,9];case 8:"default"===Notification.permission?O.setStatus("undecided",o):O.clearStatus(),t.label=9;case 9:return[3,11];case 10:return v=t.sent(),P.default(v,{emit:n,metadata:o,rawAppServerKey:u}),[3,11];case 11:return[2]}})})}},function(t,e){var i=36e5,a=864e5;function s(t,e,r,n){e=1.5*r<=e;return Math.round(t/r)+" "+n+(e?"s":"")}t.exports=function(r,t){t=t||{};var e,n,o=typeof r;if("string"==o&&0<r.length)return function(t){if(!(100<(t=String(r)).length)){t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(t){var e=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e;case"weeks":case"week":case"w":return 6048e5*e;case"days":case"day":case"d":return e*a;case"hours":case"hour":case"hrs":case"hr":case"h":return e*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}(r);if("number"==o&&isFinite(r))return t.long?(e=r,n=Math.abs(e),a<=n?s(e,n,a,"day"):i<=n?s(e,n,i,"hour"):6e4<=n?s(e,n,6e4,"minute"):1e3<=n?s(e,n,1e3,"second"):e+" ms"):(n=r,e=Math.abs(n),a<=e?Math.round(n/a)+"d":i<=e?Math.round(n/i)+"h":6e4<=e?Math.round(n/6e4)+"m":1e3<=e?Math.round(n/1e3)+"s":n+"ms");throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function a(t,e){return void 0===e&&(e=0),"string"!=typeof t||0===t.length||e&&e<t.length}function s(t){return!Array.isArray(t)||t.length&&t.map(a).every(Boolean)}var u=["organisation","platform","profilingAllowed","userAgent"];e.default=function(t){var e,r,n,o,i;if(function(t,e){if(null===t||"object"!=typeof t)return 1;var r=Object.keys(t),e=e&&e.map(function(t){return r.includes(t)}).filter(Boolean).length===e.length;return!r.length||!e}(t.metadata,u))throw new Error("metadata is required and must be object containing the following required fields "+u.join(", ")+".");if(a(null===(e=t.metadata)||void 0===e?void 0:e.organisation))throw new Error("metadata.organisation is required and must be a non empty string.");if(a(null===(e=t.metadata)||void 0===e?void 0:e.platform))throw new Error("metadata.platform is required and must be a non empty string.");if("boolean"!=typeof(null===(e=t.metadata)||void 0===e?void 0:e.profilingAllowed))throw new Error("metadata.profilingAllowed is required and must be a boolean.");if(a(null===(e=t.metadata)||void 0===e?void 0:e.userAgent))throw new Error("metadata.userAgent is required and must be a non empty string.");if(void 0!==t.swUrl&&a(t.swUrl))throw new Error("swUrl is optional but must be non empty string when provided.");if(void 0!==(null===(e=t.metadata)||void 0===e?void 0:e.visitorIds)&&s(null===(r=t.metadata)||void 0===r?void 0:r.visitorIds))throw new Error("metadata.visitorIds is optional but must be a non empty string array.");if(void 0!==(null===(r=t.metadata)||void 0===r?void 0:r.crossOrgUserIds)&&s(null===(n=t.metadata)||void 0===n?void 0:n.crossOrgUserIds))throw new Error("metadata.crossOrgUserIds is optional but must be a non empty string array.");if(void 0!==(null===(n=t.metadata)||void 0===n?void 0:n.keywords)&&s(null===(o=t.metadata)||void 0===o?void 0:o.keywords))throw new Error("metadata.keywords is optional but must be a non empty string array when provided.");if(void 0!==(null===(o=t.metadata)||void 0===o?void 0:o.channels)&&s(null===(i=t.metadata)||void 0===i?void 0:i.channels))throw new Error("metadata.channels is optional but must be a non empty string array when provided.");if(void 0!==(null===(i=t.metadata)||void 0===i?void 0:i.subChannels)&&s(null===(i=t.metadata)||void 0===i?void 0:i.subChannels))throw new Error("metadata.subChannels is optional but must be a non empty string array when provided.");return t}}],n={},o.m=r,o.c=n,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/",o(o.s=17);function o(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}var r,n});
