AdsPlugin=function(){function i(e){window.performance&&performance.mark&&performance.mark(e)}function t(e){i("ad-manager-loaded"),M.dispatchEvent({type:He,id:"adManagerLoaded"});var t=new google.ima.AdsRenderingSettings;t.disableUi=!0,t.uiElements=[],t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.useStyledLinearAds=!0,(ge=e.getAdsManager(H,t)).addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,at),ge.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,it),ge.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,dt),ge.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,ot),ge.addEventListener(google.ima.AdEvent.Type.LOADED,Je),ge.addEventListener(google.ima.AdEvent.Type.COMPLETE,nt),ge.addEventListener(google.ima.AdEvent.Type.STARTED,et),ge.addEventListener(google.ima.AdEvent.Type.CLICK,lt),ge.addEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,$e),ge.addEventListener(google.ima.AdEvent.Type.IMPRESSION,tt),ge.addEventListener(google.ima.AdEvent.Type.LOG,Xe),ge.addEventListener(google.ima.AdEvent.Type.PAUSED,Ye),ge.addEventListener(google.ima.AdEvent.Type.RESUMED,Ze),ge.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,Ke),ge.addEventListener(google.ima.AdEvent.Type.MIDPOINT,Ke),ge.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,Ke),ge.addEventListener(google.ima.AdEvent.Type.COMPLETE,Ke),Ue&&We()}function o(e,t,n){return(e=document.createElement(e)).id=t,n.appendChild(e),e}function d(e,t,n,a,i,o,d){var s=document.createElement("button");return s.id=e,s.className=t,s.title=n,(t=document.createElement("span")).className="ads_hiddenElement",t.innerHTML=n,t.setAttribute("aria-hidden","true"),s.appendChild(t),(t=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("width",a),t.setAttribute("height",i),t.setAttribute("viewBox",o),(o=document.createElementNS("http://www.w3.org/2000/svg","use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+d),t.appendChild(o),s.appendChild(t),s}function s(){P(),i("ad-sdk-loaded"),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(Ae),H=M.requestVideoElement(!0),ue=window.Device&&Device.iPhoneOutOfPagePlayback?new google.ima.AdDisplayContainer(K):(google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),new google.ima.AdDisplayContainer(K,H)),(ce=new google.ima.AdsLoader(ue)).addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,t),ce.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,dt),M.listenerObject={playlistLoading:Ge,playlistLoaded:c,userPlay:g,playing:p,ended:m,resize:E,fullscreenEnter:a,fullscreenExit:r,error:u,"bbc.smp.plugins.ads.event.updateAdTag":y,"bbc.smp.plugins.preview.complete":n,pluginLoaded:l};var e=M.playlist;e&&c({playlist:e}),M.addContextMenuItem("AdsPluginHTML","AdsPluginHTML.5.2.3")}function l(e){-1===e.url.indexOf("dfpAds")&&(fe=M.datastore.get("plugins").slice()),w()}function n(e){(Oe=!0)!==F.hasAds&&!0!==ve||(Le=!0,Qe())}function a(e){Pe=!0,rt($,"ads_exitFullScreenButton","Exit Full Screen","22","22","0 0 32 32","fullscreen-return"),U=setTimeout(ze,510)}function r(e){Pe=!1,rt($,"ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),U=setTimeout(ze,510)}function u(e){"critical"==e.severity&&Ge()}function c(e){F||!0!==(F=e.playlist).hasAds&&!0!==ve||(Le=!0,Qe())}function g(e){!0===Le&&!1===Se&&(i("ad-container-init"),ue.initialize(),qe())}function p(e){Ue=!0,Le&&(Se?!Ie&&ge&&We():(ue.initialize(),qe()))}function m(e){(Ne=!0)===Le&&!1===Ce?(we=!1,ct(),gt(q),ce.contentComplete()):(me||Ee)&&H.webkitExitFullScreen()}function E(e){ze()}function y(e){D=e.data.adTag}function v(e,t,n,a){for(var i="object"==typeof t?t:t.split(/\s+/g),o=0;o<i.length;o++)e.addEventListener(i[o],n,a)}function f(e){this.style.backgroundColor=O,this.style.fill=R}function A(e){this.style.backgroundColor="",this.style.fill=""}function h(e){this.style.border="1px solid rgba(255,255,255,1)",this.style.borderRight="0"}function T(e){this.style.border="1px solid rgba(255,255,255,0.5)",this.style.borderRight="0"}function L(e){e.stopPropagation(),he<=0&&ge.skip()}function b(e){Me||(Me=!0,x=setTimeout(function(){Me=!1},500),ye?("fadedOut"===le.className?ft:At)():(ke||C(),ge.clicked()))}function I(e){ye||ft()}function S(e){ye||At()}function k(e){Me||(Me=!0,x=setTimeout(function(){Me=!1},500),ge.clicked())}function _(){Me||(Me=!0,x=setTimeout(function(){Me=!1},500),_e?(rt(J,"ads_muteButton","Mute","44","44","0 0 44 44","audio"),ge.setVolume(1)):(rt(J,"ads_unmuteButton","UnMute","44","44","0 0 44 44","mute"),ge.setVolume(0)),_e=!_e)}function C(e){Me||(Me=!0,x=setTimeout(function(){Me=!1},500),ke?(rt(X,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),ge.resume(),j=setInterval(yt,250),W.isSkippable&&0<he&&xe&&(G=setInterval(Et,250))):(rt(X,"ads_playButton","Play","31","31","0 0 44 44","play"),ge.pause(),clearInterval(j),clearInterval(G)),ke=!ke)}function N(){Me||(Me=!0,x=setTimeout(function(){Me=!1},500),M.toggleFullscreen())}function P(){clearTimeout(B),M.updateUiConfig({cta:{enabled:!0}})}function w(){for(var e=0;e<fe.length;e++)"PreviewPluginHTML"===fe[e].id&&(De=!0)}var M,D,O,R,B,x,U,H,F,V,j,G,W,z,Q,q,K,Y,Z,X,J,$,ee,te,ne,ae,ie,oe,de,se,le,re,ue,ce,ge,pe,e=/windows phone/i.test(navigator.userAgent),me=/iPhone/i.test(navigator.userAgent)&&!e,Ee=/iPod/i.test(navigator.userAgent)&&!e,ye=!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i)),ve=!1,fe=[],Ae="en",he=Number.POSITIVE_INFINITY,Te=function(){},Le=!1,be=!1,Ie=!1,Se=!1,ke=!1,_e=!1,Ce=!1,Ne=!1,Pe=!1,we=!0,Me=!1,De=!1,Oe=!1,Re=!1,Be=!1,xe=!1,Ue=!1,He="adsPlugin",Fe="adError",Ve="adDuration",je={en:"ADVERTISEMENT",pl:"REKLAMA",da:"REKLAME",nl:"ADVERTENTIE",fi:"MAINOS",fr:"RÃ‰CLAME",de:"ANKÃœNDIGUNG",id:"ADPERTENSI",it:"INSERZIONE",ja:"åºƒå‘Š",nn:"ANNONSE",pt:"PROPAGANDA",es:"RECLAMO",sw:"TANGAZO",sv:"REKLAM"},Ge=function(e){st(!0),F=null,Me=Be=Re=Oe=Ne=Ce=_e=ke=Se=Ie=be=Le=!1,he=Number.POSITIVE_INFINITY,xe=!1,clearInterval(j),clearInterval(G),clearInterval(x)},We=function(){Ie=!0;try{ge.init(K.clientWidth,K.clientHeight,google.ima.ViewMode.NORMAL),ge.start()}catch(e){st()}},ze=function(){ge&&ge.resize(K.clientWidth,K.clientHeight,Pe?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},Qe=function(){De&&!Oe||(M.pauseAt([0]),be||(be=!0,Te()))},qe=function(){i("ad-request"),we=!1,Q.style.display="block",ct(),gt(q),M.datastore.set({name:"adsPlaying",data:!0});var e=new google.ima.AdsRequest;e.adTagUrl=D,e.linearAdSlotWidth=K.clientWidth,e.linearAdSlotHeight=K.clientHeight,e.nonLinearAdSlotWidth=K.clientWidth,e.nonLinearAdSlotHeight=K.clientHeight,ce.requestAds(e),M.dispatchEvent({type:He,id:"adRequest"}),Se=!0},Ke=function(e){M.dispatchEvent({type:He,id:"adProgress",progress:e.type})},Ye=function(e){rt(X,"ads_playButton","Play","31","31","0 0 44 44","play"),clearInterval(j),clearInterval(G),ke=!0},Ze=function(e){!0===ke&&(rt(X,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),j=setInterval(yt,250),W.isSkippable&&0<he&&xe&&(G=setInterval(Et,250)),ke=!1)},Xe=function(e){(e=e.getAdData())&&e.adError&&("1009"===(e=e.adError).getErrorCode()&&i("ad-empty"),M.dispatchEvent({type:He,id:Fe,code:e.getErrorCode(),msg:e.getMessage()}))},Je=function(e){i("ad-loaded");var t=e.getAd();V=parseInt(t.getDuration()),M.dispatchEvent({type:He,id:Ve,duration:V}),e={adId:(e=e.getAdData()).adWrapperIds[0]||e.adId||"NULL",adQueryId:e.adQueryId,adSystem:e.adSystem,creativeId:e.adWrapperCreativeIds[0]||e.creativeId||"NULL",duration:e.duration,mediaUrl:e.mediaUrl,title:e.title},M.dispatchEvent({type:He,id:"adData",info:e})},$e=function(e){0<e.getAd().getDuration()&&(V=parseInt(e.getAd().getDuration()),M.dispatchEvent({type:He,id:Ve,duration:V}))},et=function(e){i("ad-started"),!0===(W=e.getAd()).isUiDisabled()?(xe=!0,gt(re),le.style.bottom="",le.style.height="100%",ye&&gt(de)):(xe=!1,le.style.bottom="0",le.style.height="47px",ye&&(pt(de),gt(re))),Be=!1,M.dispatchEvent({type:He,id:"adStarted"}),pt(q),le&&(le.style.display="block",se.style.display="block"),gt(ee),-1==X.className.indexOf("ads_pauseButton")&&rt(X,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),yt(),j=setInterval(yt,250),W.isSkippable()&&xe?(ae.style.display="block",ie.style.display="block",ne.style.display="none",G=setInterval(Et,250)):(ae.style.display="none",ie.style.display="none",ne.style.display="none")},tt=function(e){M.dispatchEvent({type:He,id:"adImpression"})},nt=function(e){i("ad-complete"),M.datastore.set({name:"adsPlaying",data:!1}),M.dispatchEvent({type:He,id:"adEnded"}),st()},at=function(e){Be||st()},it=function(){!1===M.paused&&M.pause()},ot=function(e){i("ad-all-complete"),Be||(we||st(),ge&&(i("ad-manager-destroy"),ge.destroy()),Ce=!0,M.datastore.set({name:"adsPlaying",data:!1}),M.dispatchEvent({type:"bbc.smp.plugins.ads.event.AdsPluginExternalEvent.ALL_ADS_COMPLETED"}))},dt=function(e){i("ad-error");var t=e.getError(),n=t.getErrorCode(),a=t.getInnerError(),e=0;a&&a.getErrorCode&&(e=a.getErrorCode()),M.dispatchEvent({type:He,id:Fe,code:t.getErrorCode(),msg:t.getMessage()}),n===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED||e===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED?(Be=!0,st(),M.stop(),Se=!(Le=!0),Qe()):(st(),ot())},st=function(e){we||(pt(q),At(),mt(),ut(),pt(ee),clearInterval(j),clearInterval(G),M.pauseAt([]),e?ge&&(i("ad-manager-destroy2"),ge.destroy()):Ne||M.play(!0),we=!0)},lt=function(){M.dispatchEvent({type:He,id:"adClick"}),ke||C()},rt=function(e,t,n,a,i,o,d){e.className=t,e.title=n,(t=e.getElementsByClassName("ads_hiddenElement")[0])&&(t.innerHTML=n),(n=e.getElementsByTagName("svg")[0]).setAttribute("width",a),n.setAttribute("height",i),n.setAttribute("viewBox",o),(e=e.getElementsByTagName("use")[0])&&e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+d)},ut=function(){z&&(z.style.display="none",Q.style.display="none"),M.updateUiConfig({controls:{enabled:!0},cta:{enabled:!0}})},ct=function(){M.updateUiConfig({controls:{enabled:!1},cta:{enabled:!1}}),z&&(z.style.display="block",ze())},gt=function(e){e&&(e.style.display="block")},pt=function(e){e&&(e.style.display="none")},mt=function(){le&&(le.style.display="none",se.style.display="none")},Et=function(){var e=W.getDuration()-ge.getRemainingTime();0<(he=Math.ceil(W.getSkipTimeOffset()-e))?oe.innerText="Skip ad in "+he:(ne.style.display="block",ie.style.display="none",clearInterval(G))},yt=function(){var e=ge.getRemainingTime();Re||V<e&&(V=e,Re=!0);var t=(V-e)/V;te.innerHTML=vt(e),Y.clientWidth<50||isNaN(t)||(Z.style.width=100*t+"%")},vt=function(e){return(e=Math.round(e))<0&&(e=0),[Math.floor(e/60%60),e=(e=Math.floor(e%60))<10?"0"+e:e].join(":")},ft=function(){le.className="fadedIn",X.style.pointerEvents="auto",$.style.pointerEvents="auto",ne.style.pointerEvents="auto",J.style.pointerEvents="auto"},At=function(){le.className="fadedOut",X.style.pointerEvents="none",$.style.pointerEvents="none",ne.style.pointerEvents="none",J.style.pointerEvents="none"};return{pluginInitialisation:function(e){var t;i("ad-plugin-init"),a={id:"dfpAds",version:"5.2.3"},t=(M=e.playerInterface).datastore.get("plugins"),fe=t?((t=t.slice()).push(a),t):[a],M.datastore.set({name:"plugins",data:fe.slice()}),w(),M.listenerObject={pluginLoaded:l};var n,a=M.datastore.get("AdsPluginParameters")||{};M.updateUiConfig({cta:{enabled:!1}}),e.loadCSS(a.cssPath||"../css/dfpAds.css"),ve=!!a.pretendPlaylistHasAds,D=a.adTag,pe=!!a.debug,O=M.settings.ui.colour,R=M.settings.ui.foreColour,Te="function"==typeof a.setupCompanionAds?a.setupCompanionAds:function(){},function(){i("ad-create-ux"),z=o("div","ads_adsUX",M.container),v(z,"mouseenter focus",I),v(z,"mouseleave blur",S),K=o("div","ads_adContainer",z),(Q=o("div","ads_customUI",z)).style.display="none",function(){(q=document.createElement("div")).id="ads_spinner",q.style.width="62px",q.style.height="62px",q.style.marginLeft="-31px",q.style.marginTop="-31px",q.style.top="50%",q.style.left="50%",q.style.display="none";var e=document.createElement("canvas"),t=new Sonic(e);t.width=50,t.height=50,t.colour=O,t.thickness=10,t.draw(),q.appendChild(e),Q.appendChild(q)}(),(le=o("div","ads_controlsContainer",Q)).className="fadedOut",se=o("div","ads_bottomFade",le),re=o("div","ads_clickDiv",Q),v(re,"touchend click mouseup",b),pt(re),Y=o("div","ads_seekBar",le),(Z=o("div","ads_progressBar",Y)).style.backgroundColor=O;var e=o("div","ads_buttonBar",le);X=d("ads_playPauseButton","ads_pauseButton","Pause","31","31","0 0 44 44","pause"),v(X,"touchend click mouseup",C),v(X,"mouseenter focus",f),v(X,"mouseleave blur",A),e.appendChild(X),J=d("ads_volumeButton","ads_audioButton","Mute","44","44","0 0 44 44","audio"),v(J,"touchend click mouseup",_),v(J,"mouseenter focus",f),v(J,"mouseleave blur",A),e.appendChild(J),$=d("ads_fullScreenButton","ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),v($,"touchend click mouseup",N),v($,"mouseenter focus",f),v($,"mouseleave blur",A),e.appendChild($),ae=o("div","ads_skipContainer",Q),ne=o("button","ads_skipButton",ae),o("div","ads_skipButtonText",ne).innerHTML+="Skip Ad",o("div","ads_skipButtonIcon",ne),v(ne,"touchend click mouseup",L),v(ne,"mouseenter focus",h),v(ne,"mouseleave blur",T),ie=o("div","",ae),(oe=o("div","ads_skipText",ie)).innerHTML+="Skip ad in ",ye&&(de=o("div","ads_learnmore",Q),v(de,"touchend click mouseup",k),de.innerHTML+="Learn More",pt(de)),ee=o("div","ads_countdownText",Q),pt(ee);var t=o("span","",ee);(e={"en-GB":"en","en-gb":"en","cy-GB":"cy","cy-gb":"cy","gd-GB":"gd","gd-gb":"gd","ga-GB":"ga","ga-gb":"ga","ru-uk":"ru",zh:"zh-hans"})[Ae=M.settings.ui.locale.lang]&&(Ae=e[Ae]),t.innerHTML=(je[Ae]||je.en)+" ",(te=o("span","",ee)).innerHTML="0:00",i("ad-create-ux-complete")}(),B=setTimeout(function(){P()},5e3),n=s,i("ad-sdk-load"),window.google&&window.google.ima?n():((a=document.createElement("script")).async=!0,a.type="text/javascript",a.onload=function(){n()},a.src=document.location.protocol+(!0==pe?"//imasdk.googleapis.com/js/sdkloader/ima3_debug.js":"//imasdk.googleapis.com/js/sdkloader/ima3.js"),document.getElementsByTagName("head")[0].appendChild(a))},reset:function(){clearTimeout(x),clearTimeout(U),clearTimeout(B),Ge()}}}();var runPlugin=function(e,t){return e.register({name:"dfpAds.js"}),AdsPlugin};
