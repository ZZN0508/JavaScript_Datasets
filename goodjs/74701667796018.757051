!function(){function e(e){this._placementID=e}var n={},a={};e.prototype._getKey=function(){return"adnw_prebid:"+this._placementID},e.prototype._tryGetToken=function(){var t=null;try{t=window.localStorage.getItem(this._getKey())}catch(e){t=n[this._getKey()]}if(t)if((t=JSON.parse(t)).hasToken){if(t.createdTime>Date.now()-54e6)return t.token}else if(t.createdTime>Date.now()-108e5)return t.token;return null},e.prototype._tryStoreToken=function(t){t=JSON.stringify({hasToken:"nobid"!==t,token:t,createdTime:Date.now()});try{window.localStorage.setItem(this._getKey(),t)}catch(e){n[this._getKey()]=t}},e.prototype.getProfile=function(n){var o={placementid:this._placementID},t=this._tryGetToken();if(t)n&&n({token:t});else{t=function(){n({token:"nobid"})};try{var e=a[this._getKey()];if(e||(e=[],a[this._getKey()]=e),e.push({onError:t,onLoad:function(e){var t=JSON.parse(e),e="nobid";"object"==typeof t&&"string"==typeof t.token&&(e=t.token),this._tryStoreToken(e);try{n({token:e})}catch(e){}}}),1<e.length)return;var r=new XMLHttpRequest;if(!("withCredentials"in r))return void t();r.open("POST","https://an.facebook.com/v1/prebid.json",!0),r.withCredentials=!0,r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){4===r.readyState&&(a[this._getKey()]=[],e.forEach(function(e){200===r.status?e.onLoad.apply(this,[r.responseText]):e.onError.apply(this)}.bind(this)))}.bind(this);var i=[];Object.keys(o).forEach(function(e){var t=o[e];i.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}),r.send(i.join("&"))}catch(e){t()}}},window.AudienceNetworkPrebid=e}();
