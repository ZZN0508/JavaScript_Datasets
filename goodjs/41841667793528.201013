YUI.add("photo-groups-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-photos-getAllContexts"].run(e,this.appContext)}},attributes:{id:{},groups:{isCollection:!0},total:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]}),YUI.add("flickr-photos-getAllContexts-fetcher",function(g,r){"use strict";g.namespace("ModelFetchers")["flickr-photos-getAllContexts"]={run:function(t,e){var o=this;return e.flipper.isFlipped("enable-scrappy-photo-page")&&(t.scrappy=!0),g.Promise.all([e.callAPI("flickr.photos.getAllContexts",this._processParams(t),!0),e.getModelRegistry("person-models"),e.getModelRegistry("photo-contexts-models"),e.getModelRegistry("favorite-models"),e.getModelRegistry("gallery-models"),e.getModelRegistry("group-pool-models"),e.getModelRegistry("set-models"),e.getModelRegistry("photostream-models"),e.getModelRegistry("photo-groups-models"),e.getModelRegistry("photo-sets-models"),e.getModelRegistry("photo-galleries-models"),e.getModelRegistry("group-models")]).then(function(e){return o._processResponse(e,t)},g.FetcherErrorLogger(r))},_processParams:function(e){var t={photo_id:e.id,extras:g.APIHelper.request.getRebootPhotoExtras()+","+g.APIHelper.request.getRebootGroupExtras()+","+g.APIHelper.request.getRebootAlbumsListExtras(),primary_photo_extras:"url_sq, url_t, url_s, url_m, needs_interstitial"};return e.scrappy&&(t.get_all_galleries=1,t.no_faves_context=1,t.per_type_limit=6,t.get_totals=1,t.sort="date-desc"),t},_processResponse:function(e,t){var o,r=e[0],l=e[1],s=e[2],i={},a=[],n=e[8],d=e[9],u=e[10],p=e[11];return i.faves=e[3],i.gallery=e[4],i.pool=e[5],i.set=e[6],i.stream=e[7],g.Object.each(i,function(t,e){r[e]&&g.Array.each(r[e],function(e){g.APIHelper.response.addContextToRegistry(e,t,l,p),a.push(t.proxy(e.id))})}),s.exists(t.id)||(o=s.add({id:t.id,totalGroups:r.totals&&r.totals.groups,totalSets:r.totals&&r.totals.sets,totalGalleries:r.totals&&r.totals.galleries}),s.setValue(t.id,"contexts",a)),n.addOrUpdate({id:t.id,total:r.totals&&r.totals.groups,groups:s.getContextsOfType(t.id,"group-pool-models")}),(n=s.getContextsOfType(t.id,"set-models")).forEach(function(e){e.setValue("totalCount",parseInt(e.getValue("photoCount"),10)+parseInt(e.getValue("videoCount"),10))}),d.addOrUpdate({id:t.id,total:r.totals&&r.totals.sets,sets:n}),u.addOrUpdate({id:t.id,total:r.totals&&r.totals.galleries,galleries:s.getContextsOfType(t.id,"gallery-models")}),o}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-contexts-models","favorite-models","gallery-models","group-pool-models","photostream-models","set-models","photo-groups-models","photo-sets-models","photo-galleries-models","group-models"]}),YUI.add("photo-galleries-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-photos-getAllContexts"].run(e,this.appContext)}},attributes:{id:{},galleries:{isListProxy:!0},total:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]}),YUI.add("gallery-photo-association-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,attributes:{id:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},galleryId:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},photoId:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}}}})},"@VERSION@",{requires:["flickr-model-registry"],langBundles:["models"]}),YUI.add("flickr-galleries-removePhoto-deletor",function(o,r){"use strict";o.namespace("ModelDeletors")["flickr-galleries-removePhoto"]={run:function(a,e){var t={full_response:1},n=a.galleryCompoundID?a.galleryCompoundID.split("-").pop():a.galleryID;return t.photo_id=a.photoID,t.gallery_id=n,o.Promise.all([e.callAPI("flickr.galleries.removePhoto",t),e.getModel("gallery-models",n),e.getModel("photo-models",a.photoID),e.getModelRegistry("photo-galleries-models"),e.getModelRegistry("photo-contexts-models"),e.getModelRegistry("gallery-info-models"),e.getModelRegistry("gallery-photo-association-models")]).then(function(e){var t=e[0],o=e[1],r=e[2],l=e[3],s=e[4],i=e[5],e=e[6];if("ok"===t.stat)return t=t.gallery,o&&(o.hasPhoto(r.getValue("id"))&&o.removePhoto(r),o.setValue("photoCount",t.countPhotos),o.setValue("videoCount",t.countVideos),o.getValue("photoCount")+o.getValue("videoCount")===0&&(o.setValue("primary",null),o.setValue("primaryPhotoSizes",{}))),i.exists(n)&&i.hasPhoto(n,r.getValue("id"))&&(i.getValue(n,"photoList").removeFromList(r.getValue("id")),i.setValue(n,"photoCount",t.countPhotos),i.setValue(n,"videoCount",t.countVideos),i.getValue(n,"photoList").totalItems=t.countPhotos+t.countVideos||0,i.setValue(n,"primaryPhotoId",t.primaryPhotoId),i.setValue(n,"currentState",t.current_state)),s.exists(a.photoID)&&s.getValue(a.photoID,"contexts").getFromListByID(n)&&(s.setValue(a.photoID,"totalGalleries",s.getValue(a.photoID,"totalGalleries")-1),s.getValue(a.photoID,"contexts").removeFromList(n)),l.exists(a.photoID)&&l.getValue(a.photoID,"galleries").getFromListByID(n)&&(l.setValue(a.photoID,"total",l.getValue(a.photoID,"total")-1),l.getValue(a.photoID,"galleries").removeFromList(n)),e.exists(n+"-"+a.photoID)&&e.remove(n+"-"+a.photoID),o},o.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models","gallery-info-models","gallery-photo-association-models"]}),YUI.add("flickr-galleries-setPrimaryPhoto-updater",function(r,l){"use strict";r.namespace("ModelUpdaters")["flickr-galleries-setPrimaryPhoto"]={run:function(e,t){var o={};return o.gallery_id=e.galleryId,o.primary_photo_id=e.photoId,t.callAPI("flickr.galleries.setPrimaryPhoto",o).then(null,r.FetcherErrorLogger(l))}}},"@VERSION@",{requires:["flickr-promise"]}),YUI.add("flickr-galleries-editPhotos-updater",function(r,l){"use strict";r.namespace("ModelUpdaters")["flickr-galleries-editPhotos"]={run:function(e,t){var o={gallery_id:e.galleryId,primary_photo_id:e.primaryPhotoId};return e.photoIds&&0<e.photoIds.length&&(o.photo_ids=e.photoIds.join(",")),t.callAPI("flickr.galleries.editPhotos",o).then(null,r.FetcherErrorLogger(l))}}},"@VERSION@",{requires:[]});
