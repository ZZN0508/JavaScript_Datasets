YUI.add("search-photos-lite-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return e.getPhotoLiteModels=!0,t.ListFetchers["flickr-photos-search"].run(e,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{fetchParams:{getPhotoLiteModels:!0},listFetcher:t.ListFetchers["flickr-photos-search"],listItemIdField:"photoId"}},totalItems:{setter:function(e){return e=(e=t.AttributeHelpers.coerceInteger(e))<0?0:e},defaultValue:0},apiParams:{writeOnce:"initOnly"},emptyQuery:{defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-search-fetcher","attribute-helpers"]}),YUI.add("flickr-photos-search-fetcher",function(d,a){"use strict";var l=require("superagent"),n=require("hermes-core/flog")(a);d.namespace("ListFetchers")["flickr-photos-search"]={run:function(t,e){var o,s,i=this,r=t.emptyQuery?{}:this._processParams(d.merge({lang:e.lang||d.config.lang},t),e);return r||(t.emptyQuery=!0),r=t.useV2API?(s={orderBy:"interestingness",query:o=t.apiParams.tags||t.apiParams.text,pageNumber:0<=t.page-1?t.page-1:0,pageSize:t.perPage,format:"json",nojsoncallback:1},t.minDateTaken&&t.maxDateTaken&&(t.apiParams.tags||t.apiParams.text)&&(s.query=d.SearchHelper.normalizeTag(o),s.context="tag:"+d.SearchHelper.normalizeTag(o)+" dateUploaded:["+t.minDateTaken+" TO "+t.maxDateTaken+"]"),[l.get("https://api.flickr.com/v2/media/search").use(require("hermes-core/req-id")).query(s).catch(function(e){return n.warn("API V2 Search returned a non valid response",{err:e}),{body:[],headers:{"x-total-count":0}}})]):[t.emptyQuery?d.Promise.resolve({photos:{photo:[]}}):e.callAPI("flickr.photos.search",r)],r=t.getPhotoLiteModels?r.concat([e.getModelRegistry("search-photos-lite-models"),e.getModelRegistry("photo-lite-models")]):r.concat([e.getModelRegistry("search-photos-models"),e.getModelRegistry("photo-models"),e.getModelRegistry("person-models"),e.getModelRegistry("photo-engagement-models"),e.getModelRegistry("photo-stats-models"),e.getModelRegistry("photo-geo-models")]),d.Promise.all(r).then(function(e){return i._processResponse(e,t)},d.FetcherErrorLogger(a))},_processParams:function(e,t){var o=d.merge(d.SearchHelper.UNIFIED_DEFAULT_PARAMS,{extras:d.APIHelper.request[e.getPhotoLiteModels?"getRebootPhotoLiteExtras":"getRebootPhotoExtras"](),per_page:e.perPage||50,page:e.page||"1",lang:e.lang});return e.fetchGeo&&(o.extras+=",geo"),e.additionalExtras&&(o.extras+=","+e.additionalExtras.join(",")),o=d.merge(o,e.apiParams||{}),e.privacyFilter&&(o.privacy_filter=e.privacyFilter),YUI.Env.isServer&&d.SearchHelper.unescapeParameters(o),d.SearchHelper.isParameterlessSearch(o)?null:o},_processResponse:function(e,t){var o,s,i,r,a,l=e[0],n=e[1],h=e[2],p={id:t.id||d.SearchUrl.EMPTY_SEARCH_ID,apiParams:{},emptyQuery:!!t.emptyQuery,photos:[]};if(t.id&&t.id!==d.SearchUrl.EMPTY_SEARCH_ID&&(p.apiParams=d.QueryString.parse(t.id)),!t.id)throw new ReferenceError("No `id` provided by request.");if(!(t.useV2API||l.photos&&l.photos.photo)){var c=new Error("No `photos.photo` property returned by search API v1.");throw c.fatal=!0,c}c=t.useV2API?l.body:l.photos.photo;return t.getPhotoLiteModels?s=c.map(function(e){return r=d.APIHelper.response.parsePhotoLite(e),h.addOrUpdate(r)}):(s=d.APIHelper.response.parsePhotos({photos:l.photos.photo,photoModelRegistry:h,personModelRegistry:e[3],photoEngagementModelRegistry:e[4],photoStatsModelRegistry:e[5]}),t.fetchGeo&&(o=e[6],l.photos.photo.forEach(function(e){i=void 0!==e.latitude?{id:e.id,hasGeo:!0,latitude:e.latitude,longitude:e.longitude}:{id:e.id,hasGeo:!1},o.addOrUpdate(i)}))),p.photos={perPage:t.useV2API?t.perPage:l.photos.perpage,page:(t.useV2API?t:l.photos).page,pageContent:s,totalItems:t.useV2API?l.headers["x-total-count"]:parseInt(l.photos.total,10),totalPages:t.useV2API?parseInt(l.headers["x-total-count"]/t.perPage,10):l.photos.pages/t.perPage},!t.useV2API&&l.photos.maxAllowedResults&&(p.photos.totalItems=Math.min(l.photos.maxAllowedResults,parseInt(l.photos.total,10))),!t.useV2API&&l.photos.maxAllowedPages&&(p.photos.totalPages=Math.min(l.photos.maxAllowedPages,l.photos.pages)),p.totalItems=t.useV2API?l.headers["x-total-count"]:parseInt(l.photos.total,10),n.exists(p.id)?(l=n.getValue(p.id,"photos").getList(),a=l.filter(function(e){return!!e}).reduce(function(e,t){return e[t.id]=!0,e},{}),p.photos.pageContent=p.photos.pageContent.filter(function(e){return!a[e.id]}),1===p.photos.page&&(p.photos.forceAppend=!0),n.addOrUpdate(p)):n.add(p),s}}},"@VERSION@",{requires:["flickr-promise","search-helper","search-url","api-helper","querystring-parse-simple"],optional:["search-photos-models","search-photos-lite-models","photo-models","photo-lite-models","person-models","photo-engagement-models","photo-stats-models","photo-geo-models"],optionalRequires:["superagent"]}),YUI.add("search-photos-models",function(t){function o(e){o.superclass.constructor.call(this,e)}t.Models[this.name]=o,t.extend(o,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-photos-search"].run(e,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-photos-search"],listItemIdField:"photoId"}},totalItems:{setter:function(e){return e=(e=t.AttributeHelpers.coerceInteger(e))<0?0:e},defaultValue:0},apiParams:{writeOnce:"initOnly"},emptyQuery:{defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-search-fetcher"]}),YUI.add("photo-selector-limited-rows-photolist-view",function(t){t.namespace("Views")[this.name]=t.Base.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return e.photolistViewClasses&&(e.additionalViewClasses=e.photolistViewClasses),e.photoListConfig=t.merge(e.primaryPhotoListConfig),this.searchUrl=e.searchUrl,this.listId=e.listId,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},subviewConfig:{"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){return this.appContext.getModel("search-photos-lite-models",this.searchUrl.getId(),{}).then(function(e){(this.searchModel=e).getValue("totalItems")<=0&&this.set("emptySearch",!0)}.bind(this))},buildContainer:function(){var e="search.YOUR_PHOTOS";return"contacts"===this.listId?e="search.FROM_YOUR_CONTACTS":"everyone"===this.listId&&(e="search.EVERYONES_PHOTOS"),this.setContainerWithTemplate("search-photos-single-row",{emptySearch:this.get("emptySearch"),total:this.searchModel.getValue("totalItems"),singleResult:1===this.searchModel.getValue("totalItems"),viewAll:"#"+this.listId,"photo-list-view":this.subviews["photo-list-view"].get("container"),title:this.intlMessage({intlName:e})}),this},activate:function(){return this.registerEventHandler(this.get("container").on("click",this.handleClick.bind(this))),this},handleClick:function(e){e.halt();var e=e.target;e.hasClass("view-more-link")&&(e=e.getDOMNode().href.split("#")[1],this.fire("subviewViewEvent","viewEntireSearchList",{list:e,searchUrl:this.searchUrl}))}},{ATTRS:{emptySearch:{value:!1}}})},"@VERSION@",{requires:["flickr-view","photo-list-view","hermes-template-search-photos-single-row","search-photos-lite-models"],langBundles:["common","search"]}),YUI.add("hermes-template-photo-selector-photo-list-photo-interaction",function(o,e){var s=o.Template.Handlebars.revive({1:function(e,t,o,s,i){var r,a=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<a href="'+a(e.lambda(null!=(r=null!=(r=null!=t?l(t,"photo"):t)?l(r,"owner"):r)?l(r,"url"):r,t))+'" class="attribution">'+a((l(o,"intlMessage")||t&&l(t,"intlMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlMessage",hash:{user:null!=(r=null!=(r=null!=t?l(t,"photo"):t)?l(r,"owner"):r)?l(r,"displayname"):r,intlName:"common.BY_USER"},data:i,loc:{start:{line:7,column:84},end:{line:7,column:154}}}))+"</a>"},compiler:[8,">= 4.3.0"],main:function(e,t,o,s,i){var r,a=null!=t?t:e.nullContext||{},l=e.escapeExpression,n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="photo-list-photo-interaction">\n\t<div class="square"></div>\n\t<div class="interaction-bar">\n\t\t<div class="text">\n\t\t\t<a href="'+l("function"==typeof(r=null!=(r=n(o,"photoPageUrl")||(null!=t?n(t,"photoPageUrl"):t))?r:e.hooks.helperMissing)?r.call(a,{name:"photoPageUrl",hash:{},data:i,loc:{start:{line:6,column:12},end:{line:6,column:28}}}):r)+'" class="title">'+l(e.lambda(null!=(l=null!=t?n(t,"photo"):t)?n(l,"title"):l,t))+"</a>\n\t\t\t"+(null!=(l=n(o,"if").call(a,null!=(l=null!=(l=null!=t?n(t,"photo"):t)?n(l,"owner"):l)?n(l,"displayname"):l,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i,loc:{start:{line:7,column:3},end:{line:7,column:165}}}))?l:"")+'\n\t\t</div>\n\t</div>\n</div>\n<div class="disabled-overlay"></div>\n'},useData:!0}),i={};o.Array.each([],function(e){var t=o.Template.get("hermes/"+e);t&&(i[e]=t)}),o.Template.register("hermes/photo-selector-photo-list-photo-interaction",function(e,t){return(t=t||{}).partials=t.partials?o.merge(i,t.partials):i,s(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]}),YUI.add("photo-selector-photolist-interaction-view",function(i){var o=require("hermes-core/type-validator");i.namespace("Views")[this.name]=i.Base.create(this.name,i.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.hasMultiSelect=e.primaryPhotoListConfig&&e.primaryPhotoListConfig.hasMultiSelect,this.multiSelectLimit=void 0===e.primaryPhotoListConfig.multiSelectLimit?1:e.primaryPhotoListConfig.multiSelectLimit,this.listType=e.primaryPhotoListConfig.type,this.galleryId=e.primaryPhotoListConfig.galleryId,this.isDisabled=!1,this.isDisabledSelected=!1,this},loadState:function(){var o=this,e=[];return"galleryFaves"===this.listType&&this.galleryId&&(e.push(this.appContext.getModelRegistry("gallery-photo-association-models").then(function(e){e.exists(o.galleryId+"-"+o.get("id"))&&(o.isDisabled=!0,o.isDisabledSelected=!0)})),e.push(this.appContext.getModel("gallery-faves-models",this.appContext.getViewer().nsid+"-"+o.galleryId).then(function(e){var t=e.getValue("nonGalleryAddablePhotos").getList(),e=!1;(e=t?t.some(function(e){return e.id===o.get("model").id}):e)&&(o.isDisabled=!0)}))),e.push(this.appContext.getModel("profile-selected-photos-models",this.appContext.getViewer().nsid).then(function(e){e.getValue("photos").getFromListByID(this.get("model").getValue("id"))&&this.set("isActive",!0)}.bind(this))),i.Promise.all(e)},buildContainer:function(){var e=this.get("model");return this.setContainerWithTemplate("photo-selector-photo-list-photo-interaction",{photo:e.toJSON(),photoPageUrl:this.get("photoPageUrl")}),this},activate:function(){var e,t,o=this.get("container"),s=o.one(".disabled-overlay");return this.galleryId&&(e=this.intlMessage({intlName:"gallery.PHOTO_CANT_ADD_TO_GALLERY",mediaType:this.get("model").getValue("mediaType")}),t=this.intlMessage({intlName:"gallery.PHOTO_ALREADY_IN_GALLERY",mediaType:this.get("model").getValue("mediaType")})),this.registerEventHandler(o.on("click",this.selectPhoto.bind(this))),this.hasMultiSelect||this.registerEventHandler(i.on("photoSelector:subviewEvent",this.handleOtherPhotoSelected,this)),this.get("isActive")?this.get("isActive")&&o.addClass("active"):o.removeClass("active"),this.isDisabled&&(o.addClass("disabled"),s.setAttribute("title",e)),this.isDisabledSelected&&(o.addClass("disabled-selected"),s.setAttribute("title",t)),this},selectPhoto:function(e){if(e.halt(),!this.isDisabled)if(this.get("isActive")&&this.hasMultiSelect)this.set("isActive",!1),this.get("container").removeClass("active"),i.fire("photoSelector:subviewEvent",{eventName:"unselectPhotoFromPhotoList",id:this.get("id")});else{if(this.hasMultiSelect)return this.appContext.getModel("profile-selected-photos-models",this.appContext.getViewer().nsid).then(function(e){e.getValue("photos").size()+1<=this.multiSelectLimit&&(this.set("isActive",!0),this.get("container").addClass("active"),i.fire("photoSelector:subviewEvent",{eventName:"selectPhotoFromPhotoList",id:this.get("id")}))}.bind(this));this.set("isActive",!0),this.get("container").addClass("active"),i.fire("photoSelector:subviewEvent",{eventName:"selectPhotoFromPhotoList",id:this.get("id")})}},handleOtherPhotoSelected:function(e){"selectPhotoFromPhotoList"===e.eventName&&this.get("isActive")&&e.id!==this.get("id")&&(this.set("isActive",!1),this.get("container")._node&&this.get("container").removeClass("active"))}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,t){return o.photoId(e)}},model:{writeOnce:"initOnly"},photoPageUrl:{writeOnce:"initOnly"}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-selector-photo-list-photo-interaction","attribute-helpers"],optionalRequires:["fluid"],langBundles:["common","gallery"]});
