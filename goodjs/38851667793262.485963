var autoComplete=function(e){if(document.querySelector){var t,l={selector:0,source:0,minChars:3,delay:150,cache:1,menuClass:"",cacheMax:3e3,minSuggestionsBoxSize:250,renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");t=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+e+'">'+e.replace(t,"<b>$1</b>")+"</div>"},filterItems:function(e,t){return e},onSelect:function(e,t,o){}};for(t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);for(var a="",r="",o="object"==typeof l.selector?[l.selector]:document.querySelectorAll(l.selector),n=0;n<o.length;n++){var i=o[n];i.sc=document.createElement("div"),i.sc.className="autocomplete-suggestions "+l.menuClass,i.autocompleteAttr=i.getAttribute("autocomplete"),i.setAttribute("autocomplete","off"),i.cache=[],i.searches=[],i.last_val="",enterUseSuggestion=!1,i.updateSC=function(e,t){var o=i.getBoundingClientRect();i.sc.style.left=o.left+(window.pageXOffset||document.documentElement.scrollLeft)+"px",i.sc.style.top=o.bottom+(window.pageYOffset||document.documentElement.scrollTop)+1+"px",o.right-o.left>=l.minSuggestionsBoxSize?i.sc.style.width=o.right-o.left+"px":i.sc.style.width=l.minSuggestionsBoxSize+"px",!e&&i.sc.querySelector(".autocomplete-suggestion")&&(i.sc.style.display="block",i.sc.maxHeight||(i.sc.maxHeight=parseInt((window.getComputedStyle?getComputedStyle(i.sc,null):i.sc.currentStyle).maxHeight)),i.sc.suggestionHeight||(i.sc.suggestionHeight=i.sc.querySelector(".autocomplete-suggestion").offsetHeight),i.sc.suggestionHeight)&&(t?(e=i.sc.scrollTop,0<(t=t.getBoundingClientRect().top-i.sc.getBoundingClientRect().top)+i.sc.suggestionHeight-i.sc.maxHeight?i.sc.scrollTop=t+i.sc.suggestionHeight+e-i.sc.maxHeight:t<0&&(i.sc.scrollTop=t+e)):i.sc.scrollTop=0)},m(window,"resize",i.updateSC),document.body.appendChild(i.sc),d("autocomplete-suggestion","mouseleave",function(e){var t=i.sc.querySelector(".autocomplete-suggestion.hover");t&&setTimeout(function(){t.className=t.className.replace("hover","")},20),enterUseSuggestion=!1},i.sc),d("autocomplete-suggestion","mouseover",function(e){var t;(t=i.sc.querySelector(".autocomplete-suggestion.hover"))&&(t.className=t.className.replace("hover","")),this.className+=" hover",(t=i.sc.querySelector(".autocomplete-footer.hover"))&&(t.className=t.className.replace(" hover","")),enterUseSuggestion=!1},i.sc),d("autocomplete-suggestion","mousedown",function(e){var t;u(this,"autocomplete-suggestion")&&(t=this.getAttribute("data-val"),i.value=t,l.onSelect(e,t,this),setTimeout(function(){i.sc.style.display="none"},250))},i.sc),d("autocomplete-footer","mousedown",function(e){var t;u(this,"autocomplete-footer")&&(t=this.getAttribute("data-val"),l.onSelect(e,t,this),setTimeout(function(){i.sc.style.display="none"},250))},i.sc),d("autocomplete-footer","mouseover",function(e){var t=i.sc.querySelector(".autocomplete-suggestion.hover");t&&(t.className=t.className.replace(" hover","")),this.className+=" hover",enterUseSuggestion=!1},i.sc),i.blurHandler=function(e){var t=document.querySelector(".autocomplete-suggestions.hover"),o=document.querySelector(".autocomplete-footer.hover"),n=document.getElementById("kbd_mka");t||o||n&&"none"!==n.style?i!==document.activeElement&&setTimeout(function(){i.focus()},20):(i.last_val=i.value,i.sc.style.display="none",setTimeout(function(){i.sc.style.display="none"},350))},m(i,"blur",i.blurHandler);function c(t){var e=i.value;i.cache.length>=i.cacheMax&&(i.cache=[]);for(var o=t.length,n=0;n<o;n++)i.cache.some(function(e){return e.term==t[n].term&&e.language==t[n].language&&e.pinyn==t[n].pinyn&&e.transcription==t[n].transcription})||i.cache.push(t[n]);if(t.length&&e.length>=l.minChars){t=l.filterItems(t,e);for(var s=a,c=0;c<t.length;c++)s+=l.renderItem(t[c],e);s+=r,i.sc.innerHTML=s,i.updateSC(0)}else i.sc.style.display="none"}i.keydownHandler=function(e){var t=window.event?e.keyCode:e.which;if(38==t&&e.preventDefault(),(40==t||38==t)&&i.sc.innerHTML&&("none"!=i.sc.style.display||0<i.value.length)){var o,n,s,c=i.sc.querySelector(".autocomplete-suggestion.hover"),a=i.sc.querySelector(".autocomplete-footer.hover");return c?(o=40==t?c.nextSibling:c.previousSibling)?(c.className=c.className.replace("hover",""),o.className+=" hover",n=u(o,"autocomplete-footer"),s=u(o,"autocomplete-header"),n||s||!o.hasAttribute("data-val")?(i.value=i.last_val,o=0):i.value=JSON.parse(decodeURIComponent(o.getAttribute("data-val"))).term):(c.className=c.className.replace("hover",""),i.value=i.last_val,o=0):(a?(o=40==t?i.sc.querySelector(".autocomplete-suggestion"):a.previousSibling,a.className=a.className.replace("hover","")):o=40==t?i.sc.querySelector(".autocomplete-suggestion"):i.sc.childNodes[i.sc.childNodes.length-1],o.className+=" hover",n=u(o,"autocomplete-footer"),s=u(o,"autocomplete-header"),n||s||!o.hasAttribute("data-val")?(i.value=i.last_val,o=0):i.value=JSON.parse(decodeURIComponent(o.getAttribute("data-val"))).term),enterUseSuggestion=!0,i.updateSC(0,o),!1}27==t?(i.value=i.last_val,i.sc.style.display="none",enterUseSuggestion=!1):13!=t&&9!=t||!0!==enterUseSuggestion||(c=i.sc.querySelector(".autocomplete-suggestion.hover"),(c=(a=i.sc.querySelector(".autocomplete-footer.hover"))?a:c)&&"none"!=i.sc.style.display&&(e.preventDefault(),l.onSelect(e,c.getAttribute("data-val"),c),setTimeout(function(){i.sc.style.display="none"},20)))},m(i,"keydown",i.keydownHandler),i.keyupHandler=function(e){!function(e){var t=i.cache,o=[];if(0<e.length){for(var n=0;n<t.length;n++)void 0===t[n].ls&&o.push(t[n]);i.cache=o}else if(0==e.length){for(n=0;n<t.length;n++)1==typeof t[n].ls&&o.push(t[n]);i.cache=o,i.searches=[]}}(i.value);var t=window.event?e.keyCode:e.which;if(!t||(t<35||40<t)&&13!=t&&27!=t){var o=deaccent(i.value);if(o.length>=l.minChars){if(o!=i.last_val){e=i.last_val;if(i.last_val=o,clearTimeout(i.timer),1==l.cache&&1==i.searches.some(function(e){return-1<o.indexOf(e)})&&(e.length<o.length||i.cache.some(function(e){return-1<e.term.indexOf(o)||e.pinyn&&-1<e.pinyn.indexOf(o)}))){var n,s,e=[];if(0<(e=32==t||189==t||109==t?(n=o.substr(0,o.length-1),i.cache.filter(function(e){return 0==deaccent(e.term).indexOf(n+" ")||0==deaccent(e.term).indexOf(n+"-")||e.pinyn&&(0==deaccent(e.pinyn).indexOf(n+" ")||0==deaccent(e.pinyn).indexOf(n+"-"))})):(s=new RegExp("^"+o,"i"),i.cache.filter(function(e){return s.test(deaccent(e.term))||e.pinyn&&s.test(deaccent(e.pinyn))||e.transcription&&s.test(deaccent(e.transcription))}))).length)return void c(e)}i.timer=setTimeout(function(){!i.searches.some(function(e){return e===o})&&0<o.length&&i.searches.push(o),l.source(o,c)},l.delay)}}else i.last_val=o,i.sc.style.display="none"}},m(i,"keyup",i.keyupHandler),i.clickHandler=function(e){i.last_val="\n",i.keyupHandler(e)},l.minChars||m(i,"click",i.clickHandler)}this.setHeader=function(e){a=e},this.setFooter=function(e){r=e},this.destroy=function(){for(var e=0;e<o.length;e++){var t=o[e];s(window,"resize",t.updateSC),s(t,"blur",t.blurHandler),s(t,"click",t.clickHandler),s(t,"keydown",t.keydownHandler),s(t,"keyup",t.keyupHandler),t.autocompleteAttr?t.setAttribute("autocomplete",t.autocompleteAttr):t.removeAttribute("autocomplete"),document.body.removeChild(t.sc),t=null}}}function u(e,t){return e.classList?e.classList.contains(t):new RegExp("\\b"+t+"\\b").test(e.className)}function m(e,t,o){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener(t,o)}function s(e,t,o){e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener(t,o)}function d(n,e,s,t){m(t||document,e,function(e){for(var t,o=e.target||e.srcElement;o&&!(t=u(o,n));)o=o.parentElement;t&&s.call(o,e)})}};"function"==typeof define&&define.amd?define("autoComplete",function(){return autoComplete}):"undefined"!=typeof module&&module.exports?module.exports=autoComplete:window.autoComplete=autoComplete;
