YUI.add("notification-event-upload-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{},photo:{},title:{}}})},"@VERSION@",{requires:["flickr-model-registry"]}),YUI.add("notification-event-group-reply-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{},replyId:{}}})},"@VERSION@",{requires:["flickr-model-registry"]}),YUI.add("notification-event-flickrmail-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},mail:{},timestamp:{}}})},"@VERSION@",{requires:["flickr-model-registry"]}),YUI.add("notification-event-testimonial-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{},url:{}}})},"@VERSION@",{requires:["flickr-model-registry"]}),YUI.add("notification-event-photo-moderated-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{},fromSafetyLevel:{},toSafetyLevel:{},moderatedBy:{},photo:{}}})},"@VERSION@",{requires:["flickr-model-registry"]}),YUI.add("flickr-activity-recentByType-OLD-fetcher",function(E,e){"use strict";E.namespace("ListFetchers")["flickr-activity-recentByType-OLD"]={run:function(t,o){var i=this,r=this._processParams(t);return new E.FlickrPromise({apiResponse:o.callAPI("flickr.activity.recentByType",r),notificationModelRegistry:o.getModelRegistry("notification-OLD-models"),notificationsModelRegistry:o.getModelRegistry("person-notifications-models"),groupInfoModelRegistry:o.getModelRegistry("group-info-models"),groupModelRegistry:o.getModelRegistry("group-models"),personModelRegistry:o.getModelRegistry("person-models"),photoModelRegistry:o.getModelRegistry("photo-models"),contactModelRegistry:o.getModelRegistry("contact-models"),photoEngagementModelRegistry:o.getModelRegistry("photo-engagement-models"),personRelationshipModelRegistry:o.getModelRegistry("person-relationship-models"),photoStatsRegistry:o.getModelRegistry("photo-stats-models"),discussionModelRegistry:o.getModelRegistry("notification-group-discussion-models"),galleryModelRegistry:o.getModelRegistry("notification-gallery-models"),flickrMailModelRegistry:o.getModelRegistry("notification-flickrmail-models"),faveEventModelRegistry:o.getModelRegistry("notification-event-fave-models"),commentEventModelRegistry:o.getModelRegistry("notification-event-comment-models"),followerEventModelRegistry:o.getModelRegistry("notification-event-follower-models"),addedToGalleryEventModelRegistry:o.getModelRegistry("notification-event-added-to-gallery-models"),tagEventModelRegistry:o.getModelRegistry("notification-event-tag-models"),peopleEventModelRegistry:o.getModelRegistry("notification-event-people-models"),photoCommentMentionNotifRegisty:o.getModelRegistry("notification-event-photo-comment-mention-models"),photoGroupInviteNotifRegistry:o.getModelRegistry("notification-event-photo-group-invite-models"),groupNotifModelRegistry:o.getModelRegistry("notification-event-group-models"),noteEventModelRegistry:o.getModelRegistry("notification-event-note-models"),shareEventModelRegistry:o.getModelRegistry("notification-event-share-models"),uploadEventModelRegistry:o.getModelRegistry("notification-event-upload-models"),groupReplyEventModelRegistry:o.getModelRegistry("notification-event-group-reply-models"),friendJoinEventModelRegistry:o.getModelRegistry("notification-event-friend-join-models"),groupTopicNewEventModelRegistry:o.getModelRegistry("notification-event-group-topic-new-models"),flickrMailEventModelRegistry:o.getModelRegistry("notification-event-flickrmail-models"),testimonialEventModelRegistry:o.getModelRegistry("notification-event-testimonial-models"),photoModeratedEventModelRegistry:o.getModelRegistry("notification-event-photo-moderated-models")}).then(function(e){return i._processResponse(e,t,r,o)},E.FetcherErrorLogger(e))},_processParams:function(e){var t={extras:["sizes","icon_urls","ignored","rev_ignored","tags","autotags","datecreate"].join(",")+","+E.APIHelper.request.getRebootPhotoExtras(),per_page:e.perPage||30,count:30,page:e.page||1,per_object:50,notification_groups:"default, bot_moderation"},e=E.merge(t,e.apiParams||{});return YUI.Env.isServer&&E.SearchHelper.unescapeParameters(e),e},_processResponse:function(e,t,o,a){var d,i=e.apiResponse,r=e.notificationModelRegistry,s=e.notificationsModelRegistry,p=e.photoModelRegistry,g=e.personModelRegistry,c=e.contactModelRegistry,y=e.groupModelRegistry,m=(e.personRelationshipModelRegistry,e.photoEngagementModelRegistry),u=e.photoStatsRegistry,f=e.discussionModelRegistry,M=e.galleryModelRegistry,R=e.flickrMailModelRegistry,v=[],h={fave:e.faveEventModelRegistry,comment:e.commentEventModelRegistry,contacted:e.followerEventModelRegistry,gallery:e.addedToGalleryEventModelRegistry,tag:e.tagEventModelRegistry,people:e.peopleEventModelRegistry,photo_comment_mention:e.photoCommentMentionNotifRegisty,group_invite:e.photoGroupInviteNotifRegistry,group_user_invite:e.groupNotifModelRegistry,note:e.noteEventModelRegistry,share:e.shareEventModelRegistry,upload:e.uploadEventModelRegistry,reply_reply:e.groupReplyEventModelRegistry,topic_reply:e.groupReplyEventModelRegistry,friend_join:e.friendJoinEventModelRegistry,group_topic_new:e.groupTopicNewEventModelRegistry,flickrmail:e.flickrMailEventModelRegistry,testimonial:e.testimonialEventModelRegistry,photo_bot_moderated:e.photoModeratedEventModelRegistry};return i.items.item.forEach(function(s){var n,e,t,o=s.activity?s.activity.event:[],l={objectType:s.type,seen:!!s.seen,id:E.guid(),events:[],isMuted:!!s.is_muted};"photo"===s.type?((e=E.clone(s)).title&&(t=e.title.content||e.title._content,e.title=t),l.object=E.APIHelper.response.parsePhotos({photos:[e],photoModelRegistry:p,personModelRegistry:g,photoEngagementModelRegistry:m,photoStatsModelRegistry:u}).shift()):"person"===s.type?g.exists(s.id)?l.object=g.proxy(s.id):l.object=g.add(E.APIHelper.response.parsePerson({nsid:s.user,pathAlias:s.pathAlias,username:s.username,realname:s.realname,isAdFree:s.isAdFree,ispro:s.ispro,proBadge:s.proBadge,datecreate:s.datecreate,iconurls:s.iconurls})):"group"===s.type?y.exists(s.id)?l.object=y.proxy(s.id):l.object=y.add(y.parseGroupModel(s.id,s.pathAlias,s)):"discussion"===s.type?((e=E.clone(s)).id=s.group_id,e.title=s.group_name,e=y.exists(s.group_id)?y.proxy(s.group_id):y.add(y.parseGroupModel(s.group_id,s.pathAlias,e)),f.exists(s.id)?l.object=f.proxy(s.id):l.object=f.add(f.parseDiscussionModel(s.id,s.pathAlias,s,e))):"gallery"===s.type?l.object=M.addOrUpdate(M.parseGalleryModel(s)):"flickrmail"===s.type&&(l.object=R.addOrUpdate(R.parseFlickrMailModel(s))),o.forEach(function(e){var t,o,i,r;if(e.type in h){if("people"===e.type)d={},t=E.APIHelper.response.parseContact({nsid:e.person,username:e.personname}),o=E.APIHelper.response.parseContact({nsid:e.user,username:e.realname}),d.personTagged=c.exists(t.id)?c.proxy(t.id):c.add(t),d.tagger=c.exists(o.id)?c.proxy(o.id):c.add(o);else if("group_invite"===e.type)e.name=e.groupName,e.id=e.groupId,e.iconurls=e.group_iconurls,d=y.exists(e.id)?y.proxy(e.id):y.add(y.parseGroupModel(e.groupId,e.pathAlias,e));else{if("note"===e.type&&!a.flipper.isFlipped("enable-scrappy-notes"))return;"gallery"===e.type?d={id:e.galleryid,title:e.title,url:"/photos/"+e.owner+"/galleries/"+e.galleryid,iconurls:e.gallery_iconurls}:"flickrmail"===e.type?d={mail:{id:s.id,title:s.title,url:"/mail/"+s.id},owner:{nsid:s.user,username:s.username,realname:s.realname,iconserver:s.iconserver,iconfarm:s.iconfarm,pathAlias:s.pathalias,iconUrls:s.iconurls}}:"testimonial"===e.type?(i=g.proxy(a.getViewer().nsid),(i=E.URLHelper.generatePersonUrls(i)).profile,i=i.profile.slice(0,i.profile.length-1)+"#testimonial"+s.id,d={id:s.id,owner:{nsid:s.user,username:s.username,realname:s.realname,iconserver:s.iconserver,iconfarm:s.iconfarm,pathAlias:s.pathalias,iconUrls:s.iconurls},url:i}):"contacted"===e.type?e.iconurls=s.iconurls:"upload"===e.type?(i=E.APIHelper.response.parsePhoto(e,s.id),d={title:e.title.content,url:s.url,photo:i,owner:i.owner}):"photo_bot_moderated"===e.type&&(r=E.APIHelper.response.parsePhoto(s,s.owner),d={photo:r,owner:r.owner})}(r=E.APIHelper.response.parseNotificationsEvents[e.type](e,d)).owner=c.addOrUpdate(r.owner),r.owner.getValue("isMe")&&"group_user_invite"!==e.type||(n=h[e.type].addOrUpdate(r),l.events.push(n))}}),r.exists(l.id)||v.push(r.add(l))}),e={notifications:v},s.exists(t.id)?s.getValue(t.id,"notifications").addPage({page:o.page,perPage:o.per_page,pageContent:v,totalItems:parseInt(i.items.total||0,10)}):s.add(e),v}}},"@VERSION@",{requires:["flickr-promise","search-helper","querystring-parse-simple"],optional:["url-helper","notification-OLD-models","person-notifications-models","contact-models","photo-models","notification-group-discussion-models","notification-gallery-models","notification-flickrmail-models","notification-event-fave-models","notification-event-comment-models","notification-event-follower-models","notification-event-added-to-gallery-models","notification-event-people-models","notification-event-tag-models","notification-event-photo-comment-mention-models","notification-event-photo-group-invite-models","notification-event-group-models","notification-event-note-models","notification-event-share-models","notification-event-upload-models","notification-event-group-reply-models","notification-event-flickrmail-models","notification-event-testimonial-models","notification-event-photo-moderated-models"]});
