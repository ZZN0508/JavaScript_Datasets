function sendAppStateChanged(e){window.electronSafeIpc&&window.electronSafeIpc.send("appStateChanged",e)}sendAppStateChanged("AuthstrapInitialize")
document.addEventListener("DOMContentLoaded",function(){var t,e,o;function r(t,e,o,n,i,r,a,s,c,h,l,d,u){this.authContext=t,this.redirectUrl=e,this.$window=o,this.feCookieName=n,this.localStorage=i,this.sessionStorage=r,this.console=a,this.document=s,this.lastLocationHashName=c,this.showError=h,this.secureCookie=l,this.enableCookieStore=d,this.signInStateCookieName=u}sendAppStateChanged("AuthstrapDomContentLoaded"),t=d=d||{},e=t.auth||(t.auth={}),r.prototype.isInIFrame=function(){try{return this.$window.self!==this.$window.top}catch(t){return this.showError(t),!0}},r.prototype.updateFECookie=function(t){var e;t=t||"",this.enableCookieStore?(e=new Date(Date.now()+432e6),this.document.cookie=this.feCookieName+"="+t+"; expires="+e+"; path=/"+(this.secureCookie?"; secure":"")):this.document.cookie=this.feCookieName+"="+t+"; path=/"+(this.secureCookie?"; secure":"")},r.prototype.updatePreSignInCookie=function(t){t=t||"";var e=new Date(Date.now()+31536e6);this.document.cookie=this.signInStateCookieName+"="+t+"; expires="+e+"; path=/"+(this.secureCookie?"; secure":"")},r.prototype.sendTelemetry=function(t){var e=this.redirectUrl+"auth/"+t,o=new XMLHttpRequest;o.open("GET",e,!0),o.send(null)},r.prototype.handleRedirect=function(t){this.tryWarnLog("Redirecting to index"),t&&(this.updateFECookie(this.authContext.getCachedToken(t.profile.aud)),this.updatePreSignInCookie("true"));var e,o,n,i=this.redirectUrl;o="/",0<(e=i).length&&e.charAt(e.length-1)===o||(i+="/"),i+="_",r.shouldIgnoreHashForRedirect(this.document.location.hash)&&""===this.document.location.search?(n=this.getLocationForNonLoggedInUser())?(i+=n,this.localStorage&&this.localStorage.removeItem(r.nonLoggedInUserLocationKey),this.sessionStorage&&this.sessionStorage.removeItem(r.nonLoggedInUserLocationKey)):t&&(i+=this.getLocationForLoggedInUser(t.profile)):i+=this.document.location.search+this.document.location.hash,this.sessionStorage&&this.sessionStorage.setItem(r.redirect_authstrap_duration,performance.now()),this.document.location.replace(i)},r.prototype.getLocationForNonLoggedInUser=function(){var t="";return this.document.location.hash&&0<=this.document.location.hash.indexOf(r.idTokenString)?t=this.document.location.hash:this.localStorage?t=this.localStorage.getItem(r.nonLoggedInUserLocationKey):this.sessionStorage&&(t=this.sessionStorage.getItem(r.nonLoggedInUserLocationKey)),t},r.prototype.getLocationForLoggedInUser=function(t){var e="",o=this.document.location.hash;return!o&&this.localStorage&&t&&t.oid&&(o=this.localStorage.getItem("ts."+t.oid+"."+this.lastLocationHashName)),o&&(e+="#"+o.replace(/^#|#$/,"")),e},r.prototype.tryWarnLog=function(t){this.console&&console.warn(t)},r.shouldIgnoreHashForRedirect=function(t){return t&&0<=t.indexOf(r.idTokenString)||""===t||"#"===t},r.nonLoggedInUserLocationKey="ts.nonLoggedInUserLocation",r.redirect_authstrap_duration="ts.redirect_authstrap_duration",r.idTokenString="id_token=",o=r,e.AuthStrapBase=o;var n,i,a,I,s,c=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});function h(t,e,o,n,i,r,a,s,c,h,l,d,u,p,g){var f=I.call(this,t,e,o,n,i,r,a,s,c,l,d,u,p)||this;return f.redirectRoute=h,f.enableGuestAccess=g,f.authContext.getLoginError()&&f.console&&f.console.error("Authorization error: "+f.authContext.getLoginError()),f}i=d=d||{},a=i.auth||(i.auth={}),I=a.AuthStrapBase,c(h,I),h.prototype.storeLocationForNonLoggedInUser=function(){var t=window.location.href.replace(this.redirectUrl,"");0===t.indexOf("/")&&(t=t.substr(1)),t&&this.localStorage&&0!==t.indexOf(this.redirectRoute)&&this.localStorage.setItem(a.AuthStrapBase.nonLoggedInUserLocationKey,t)},h.prototype.shouldLogoutInvalidProfile=function(t){if(!t.profile.aud)return this.tryWarnLog("User profile type is missing aud"),!0;if(!t.profile.oid&&t.profile.altsecid&&0===t.profile.altsecid.indexOf("1:"))return!(t.profile.oid="msaDefaultOid");var e=t.profile.iss&&t.profile.idp&&t.profile.iss!==t.profile.idp;return e&&!t.profile.oid?!(t.profile.oid="aadDefaultOid"):!(e||t.profile.oid&&t.profile.upn)&&(this.tryWarnLog("User profile is missing oid or upn"),!0)},h.prototype.profileExpiresIn=function(t,e){return(t&&t.profile&&(t.profile.exp?1e3*parseInt(t.profile.exp,10):Date.now()))-Date.now()<=6e4*e},h.prototype.shouldLogInInvalidProfile=function(t,e){var o=!t||!t.profile||!this.authContext.getCachedToken(t.profile.aud);return o?(e&&(this.authContext.config.tenant=e),this.tryWarnLog("User profile not found")):e&&t.profile.tid!=e&&this.enableGuestAccess?(this.sendTelemetry("changeTenant?tid="+t.profile.tid+"&newTid="+e),this.tryWarnLog("User is logged into a different tenant"),this.authContext.config.tenant=e,this.authContext.clearCache(),o=!0):(o=this.profileExpiresIn(t,2))&&this.tryWarnLog("User profile expired"),o},h.prototype.transferUser=function(t){this.updateFECookie(null),this.sendTelemetry("prelogin"),t?(this.tryWarnLog("Logging user in"),window.electronSafeIpc&&window.electronSafeIpc.send("telemetryEvent",{name:"desktop_adal_login",reason:"authstrap"}),this.authContext.login()):(this.tryWarnLog("Logging user out"),window.electronSafeIpc&&window.electronSafeIpc.send("telemetryEvent",{name:"desktop_adal_logout",reason:"authstrap"}),this.authContext.logOut())},h.prototype.setDomainHintIfPresentAsQSP=function(){var t;this.document.location.href&&this.authContext.config&&((t=this.getQueryParameterByName("domain_hint",this.document.location.href))&&this.setExtraQueryParameter("domain_hint",t))},h.prototype.handleWindow=function(){if(0<=window.location.hash.indexOf("AADSTS50000"))window.location.assign(this.redirectUrl+"error/incompatible_compliance_policy");else if(this.authContext.handleWindowCallback(),this.setDomainHintIfPresentAsQSP(),!this.isInIFrame())try{var t=this.authContext.getCachedUser();this.setLoginHint();var e=this.getQueryParamByName(window.location.href,"tenantId");this.shouldLogInInvalidProfile(t,e)?(this.storeLocationForNonLoggedInUser(),this.transferUser(!0)):this.shouldLogoutInvalidProfile(t)?this.transferUser(!1):(this.sendTelemetry("postlogin"),this.handleRedirect(t))}catch(t){this.showError(t)}},h.prototype.getQueryParameterByName=function(t,e){e=e||window.location.href,t=t.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null},h.prototype.getQueryParamByName=function(t,e){if(t)return this.getQueryParameterByName(e,t)},h.prototype.setLoginHint=function(){var t=this.getQueryParamByName(window.location.href,"login_hint");t&&this.setExtraQueryParameter("login_hint",t)},h.prototype.setExtraQueryParameter=function(t,e){var o=t+"="+e;this.authContext.config.extraQueryParameter&&0<this.authContext.config.extraQueryParameter.length?this.authContext.config.extraQueryParameter+="&"+o:this.authContext.config.extraQueryParameter=o},s=h,a.AuthStrap=s;var l,d,u,p,g,f,c=this&&this.__extends||(l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});function y(t,e,o,n,i,r,a,s,c,h,l,d,u){var p=g.call(this,t,e,o,n,i,r,a,s,c,h,l,d,u)||this;return p.adalIdTokenKey="adal.idtoken",p.adalAccessTokenKey="adal.access.token.key",p.adalTokenExpirationKey="adal.expiration.key",p.adalTokenKeys="adal.token.keys",p.defaultNativeAuthTokenExpirationTimeUnderUwpPPI=3600,p}u=d=d||{},p=u.auth||(u.auth={}),g=p.AuthStrapBase,c(y,g),y.prototype.isRunningInPPIUwpContainer=function(){var t=this.$window,e=!!(t.Microsoft&&t.Microsoft.PPISkype&&t.Microsoft.PPISkype.Authentication&&t.OAuthToken&&t.OAuthToken.COAuthToken);return e=e&&t.Microsoft.PPISkype.Authentication.CredentialsHandler.getInstance().isRunningInPPIOs(),this.console.warn("Is Running in uwp ppi container?: ",e),e},y.prototype.fetchTokenInPPIUwpContainer=function(t){var e=this.$window,o=e.Microsoft.PPISkype.Authentication.CredentialsHandler.getInstance().getPlaintextAllCredentials();return null==o?null:e.OAuthToken.COAuthToken.getOrCreateInstance().acquireToken(o.signInAddress,o.password,"","","",t)},y.prototype.cacheAdalOAuthTokenInIdTokenCacheUnderPPIUwp=function(t){if(null!=t){if(this.localStorage)try{this.localStorage.setItem(this.adalIdTokenKey,t)}catch(t){this.showError("Failed to set item in local storage "+t)}var e=this.authContext.getCachedUser();!(e&&e.profile&&e.profile.aud&&e.profile.exp)||this.cacheTokenInAccessCacheUnderPPIUwp(t,e.profile.aud,e.profile.exp)}},y.prototype.cacheTokenInAccessCacheUnderPPIUwp=function(t,e,o){if(null!=t&&this.localStorage)try{o=o||Math.round((new Date).getTime()/1e3)+this.defaultNativeAuthTokenExpirationTimeUnderUwpPPI,this.localStorage.setItem(this.adalAccessTokenKey+e,t),this.localStorage.setItem(this.adalTokenExpirationKey+e,o);var n=this.localStorage.getItem(this.adalTokenKeys)||"";n.indexOf(e)<0&&this.localStorage.setItem(this.adalTokenKeys,n+e+"|")}catch(t){this.showError("Failed requests to local storage "+t)}},y.prototype.tryFetchAndCacheIdTokenInPPIUwpContainer=function(){var t;this.isRunningInPPIUwpContainer()&&(t=this.fetchTokenInPPIUwpContainer(this.authContext.config.clientId),this.cacheAdalOAuthTokenInIdTokenCacheUnderPPIUwp(t))},y.prototype.handleWindow=function(){if(0<=window.location.hash.indexOf("AADSTS50000"))window.location.assign(this.redirectUrl+"error/incompatible_compliance_policy");else if(!this.isInIFrame())try{this.tryFetchAndCacheIdTokenInPPIUwpContainer(),this.sendTelemetry("postloginppiuwp");var t=this.authContext.getCachedUser();this.handleRedirect(t)}catch(t){this.showError(t)}},f=y,p.AuthStrapPPIUwp=f;var w="https://teams.microsoft.com/";"["===w.charAt(0)&&"/"!==(w="{SETINENVIRONMENTTRANSFORM}").charAt(w.length-1)&&(w+="/");var m="5e3ce6c0-2b1f-4285-8d4b-75ee78787346";"["===m.charAt(0)&&(m="5e3ce6c0-2b1f-4285-8d4b-75ee78787346");var P=w+"go",S="[[correlationId]]";"["===S.charAt(0)&&(S=void 0),window.config={redirectUri:P,postLogoutRedirectUri:P,instance:"https://login.microsoftonline.com/",clientId:m,correlationId:S,globalResource:void 0,cacheLocation:"localStorage",extraQueryParameter:"",enableErrorPageRedirect:"",enableGuestAccess:!0};function C(){window.location.assign(w+"error/DOM_storage_disabled")}function k(t){console.error("Error occurred logging in "+JSON.stringify(t)),window.electronSafeIpc&&window.electronSafeIpc.send("pageContentError"),C()}var A;!function(){var t="skypeStorageTest";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return k(t),!1}}()?C():(A=new AuthenticationContext(config),(window.Microsoft&&window.Microsoft.PPISkype&&window.Microsoft.PPISkype.Authentication&&window.Microsoft.PPISkype.Authentication.CredentialsHandler&&window.Microsoft.PPISkype.Authentication.CredentialsHandler.getInstance().isRunningInPPIOs()?new d.auth.AuthStrapPPIUwp(A,w,window,"TSAUTHCOOKIE",localStorage,sessionStorage,console,document,"lastLocationHash",k,!0,!0,"TSPREAUTHCOOKIE"):new d.auth.AuthStrap(A,w,window,"TSAUTHCOOKIE",localStorage,sessionStorage,console,document,"lastLocationHash","go",k,!0,!0,"TSPREAUTHCOOKIE",!0)).handleWindow(),sendAppStateChanged("AuthstrapJsLoaded"))})
sendAppStateChanged("AuthstrapHtmlLoaded")